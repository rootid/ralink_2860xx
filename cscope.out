cscope 15 $HOME/2010_07_16_RT2860_Linux_STA_v2.4.0.0               0002744898
	@common/action.c

39 
	~"_cfig.h
"

40 
	~"ai.h
"

42 
UCHAR
 
ZoSsid
[32];

44 
VOID
 
RervedAi
(

45 
IN
 
PRTMP_ADAPTER
 
pAd
,

46 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

66 
VOID
 
	$AiSMacheIn
(

67 
IN
 
PRTMP_ADAPTER
 
pAd
,

68 
IN
 
STATE_MACHINE
 *
S
,

69 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[])

71 
	`SMacheIn
(
S
, (
STATE_MACHINE_FUNC
 *)
Tns
, 
MAX_ACT_STATE
, 
MAX_ACT_MSG
, (STATE_MACHINE_FUNC)
Dr
, 
ACT_IDLE
, 
ACT_MACHINE_BASE
);

73 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_PEER_SPECTRUM_CATE
, (
STATE_MACHINE_FUNC
)
PrSrumAi
);

74 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_PEER_QOS_CATE
, (
STATE_MACHINE_FUNC
)
PrQOSAi
);

76 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_PEER_DLS_CATE
, (
STATE_MACHINE_FUNC
)
RervedAi
);

77 #ifde
QOS_DLS_SUPPORT


78 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_PEER_DLS_CATE
, (
STATE_MACHINE_FUNC
)
PrDLSAi
);

81 #ifde
DOT11_N_SUPPORT


82 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_PEER_BA_CATE
, (
STATE_MACHINE_FUNC
)
PrBAAi
);

83 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_PEER_HT_CATE
, (
STATE_MACHINE_FUNC
)
PrHTAi
);

84 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_MLME_ADD_BA_CATE
, (
STATE_MACHINE_FUNC
)
MlmeADDBAAi
);

85 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_MLME_ORI_DELBA_CATE
, (
STATE_MACHINE_FUNC
)
MlmeDELBAAi
);

86 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_MLME_REC_DELBA_CATE
, (
STATE_MACHINE_FUNC
)
MlmeDELBAAi
);

89 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_PEER_PUBLIC_CATE
, (
STATE_MACHINE_FUNC
)
PrPublicAi
);

90 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_PEER_RM_CATE
, (
STATE_MACHINE_FUNC
)
PrRMAi
);

92 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_MLME_QOS_CATE
, (
STATE_MACHINE_FUNC
)
MlmeQOSAi
);

93 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_MLME_DLS_CATE
, (
STATE_MACHINE_FUNC
)
MlmeDLSAi
);

94 
	`SMacheSAi
(
S
, 
ACT_IDLE
, 
MT2_ACT_INVALID
, (
STATE_MACHINE_FUNC
)
MlmeInvidAi
);

100 
	}
}

102 #ifde
DOT11_N_SUPPORT


103 
VOID
 
	$MlmeADDBAAi
(

104 
IN
 
PRTMP_ADAPTER
 
pAd
,

105 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

108 
MLME_ADDBA_REQ_STRUCT
 *
pInfo
;

109 
UCHAR
 
Addr
[6];

110 
PUCHAR
 
pOutBufr
 = 
NULL
;

111 
NDIS_STATUS
 
NStus
;

112 
ULONG
 
Idx
;

113 
FRAME_ADDBA_REQ
 
Fme
;

114 
ULONG
 
FmeL
;

115 
BA_ORI_ENTRY
 *
pBAEry
 = 
NULL
;

117 
pInfo
 = (
MLME_ADDBA_REQ_STRUCT
 *)
Em
->
Msg
;

118 
	`NdisZoMemy
(&
Fme
, (
FRAME_ADDBA_REQ
));

120 if(
	`MlmeAddBAReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
Addr
))

122 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

123 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

125 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("BA - MlmeADDBAAction()llocate memory failed \n"));

129 
Idx
 = 
pAd
->
MacTab
.
Cڋ
[
pInfo
->
Wcid
].
BAOriWcidAay
[pInfo->
TID
];

130 i(
Idx
 == 0)

132 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

133 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("BA - MlmeADDBAAction() can't find BAOriEntry \n"));

138 
pBAEry
 =&
pAd
->
BATab
.
BAOriEry
[
Idx
];

141 #ifde
CONFIG_STA_SUPPORT


142 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

144 i(
	`ADHOC_ON
(
pAd
)

145 #ifde
QOS_DLS_SUPPORT


146 || (
	`IS_ENTRY_DLS
(&
pAd
->
MacTab
.
Cڋ
[
pInfo
->
Wcid
]))

149 
	`AHdIn
(
pAd
, &
Fme
.
Hdr
, 
pInfo
->
pAddr
,Ad->
CutAddss
,Ad->
CommCfg
.
Bssid
);

151 
	`AHdIn
(
pAd
, &
Fme
.
Hdr
,Ad->
CommCfg
.
Bssid
,Ad->
CutAddss
, 
pInfo
->
pAddr
);

155 
Fme
.
Cegy
 = 
CATEGORY_BA
;

156 
Fme
.
Ai
 = 
ADDBA_REQ
;

157 
Fme
.
BaPm
.
AMSDUSu܋d
 = 0;

158 
Fme
.
BaPm
.
BAPicy
 = 
IMMED_BA
;

159 
Fme
.
BaPm
.
TID
 = 
pInfo
->TID;

160 
Fme
.
BaPm
.
BufSize
 = 
pInfo
->
BaBufSize
;

161 
Fme
.
Tok
 = 
pInfo
->Token;

162 
Fme
.
TimeOutVue
 = 
pInfo
->TimeOutValue;

163 
Fme
.
BaSSeq
.
fld
.
FgNum
 = 0;

164 
Fme
.
BaSSeq
.
fld
.
SSeq
 = 
pAd
->
MacTab
.
Cڋ
[
pInfo
->
Wcid
].
TxSeq
[pInfo->
TID
];

166 *(
USHORT
 *)(&
Fme
.
BaPm

	`u216
(*(USHORT *)(&Frame.BaParm));

167 
Fme
.
TimeOutVue
 = 
	`u216
(Frame.TimeOutValue);

168 
Fme
.
BaSSeq
.
wd
 = 
	`u216
(Frame.BaStartSeq.word);

170 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

171 (
FRAME_ADDBA_REQ
), &
Fme
,

172 
END_OF_ARGS
);

174 
	`MtMMReque
(
pAd
, (
MGMT_USE_QUEUE_FLAG
 | 
MUrPriܙyToAcssCegy
[
pInfo
->
TID
]), 
pOutBufr
, 
FmeL
);

176 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

178 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BA - Sd ADDBAeque. SSeq = %x, FmeL = %ld. BufSiz%d\n", 
Fme
.
BaSSeq
.
fld
.
SSeq
, 
FmeL
, Fme.
BaPm
.
BufSize
));

180 
	}
}

193 
VOID
 
	$MlmeDELBAAi
(

194 
IN
 
PRTMP_ADAPTER
 
pAd
,

195 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

197 
MLME_DELBA_REQ_STRUCT
 *
pInfo
;

198 
PUCHAR
 
pOutBufr
 = 
NULL
;

199 
PUCHAR
 
pOutBufr2
 = 
NULL
;

200 
NDIS_STATUS
 
NStus
;

201 
ULONG
 
Idx
;

202 
FRAME_DELBA_REQ
 
Fme
;

203 
ULONG
 
FmeL
;

204 
FRAME_BAR
 
FmeB
;

206 
pInfo
 = (
MLME_DELBA_REQ_STRUCT
 *)
Em
->
Msg
;

208 
	`NdisZoMemy
(&
Fme
, (
FRAME_DELBA_REQ
));

209 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==> MlmeDELBAAi(), Int(%d\n", 
pInfo
->
Int
));

211 if(
	`MlmeDBAReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
))

213 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

214 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

216 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("BA - MlmeDELBAAction()llocate memory failed 1. \n"));

220 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr2
);

221 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

223 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

224 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("BA - MlmeDELBAAction()llocate memory failed 2. \n"));

229 
Idx
 = 
pAd
->
MacTab
.
Cڋ
[
pInfo
->
Wcid
].
BAOriWcidAay
[pInfo->
TID
];

231 #ifde
CONFIG_STA_SUPPORT


232 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

233 
	`BHdIn
(
pAd
, &
FmeB
,Ad->
MacTab
.
Cڋ
[
pInfo
->
Wcid
].
Addr
,Ad->
CutAddss
);

236 
FmeB
.
SgSeq
.
fld
.
FgNum
 = 0;

237 
FmeB
.
SgSeq
.
fld
.
SSeq
 = 
pAd
->
MacTab
.
Cڋ
[
pInfo
->
Wcid
].
TxSeq
[pInfo->
TID
];

238 
FmeB
.
BCڌ
.
TID
 = 
pInfo
->TID;

239 
FmeB
.
BCڌ
.
ACKPicy
 = 
IMMED_BA
;

240 
FmeB
.
BCڌ
.
Comesd
 = 1;

241 
FmeB
.
BCڌ
.
MTID
 = 0;

243 
	`MakeOutgogFme
(
pOutBufr2
, &
FmeL
,

244 (
FRAME_BAR
), &
FmeB
,

245 
END_OF_ARGS
);

246 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr2
, 
FmeL
);

247 
	`MlmeFeMemy
(
pAd
, 
pOutBufr2
);

248 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("BA - MlmeDELBAAction() . Send BARoefresheereordering buffer \n"));

251 
FmeL
 = 0;

252 #ifde
CONFIG_STA_SUPPORT


253 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

255 i(
	`ADHOC_ON
(
pAd
)

256 #ifde
QOS_DLS_SUPPORT


257 || (
	`IS_ENTRY_DLS
(&
pAd
->
MacTab
.
Cڋ
[
pInfo
->
Wcid
]))

260 
	`AHdIn
(
pAd
, &
Fme
.
Hdr
,Ad->
MacTab
.
Cڋ
[
pInfo
->
Wcid
].
Addr
,Ad->
CutAddss
,Ad->
CommCfg
.
Bssid
);

262 
	`AHdIn
(
pAd
, &
Fme
.
Hdr
,Ad->
CommCfg
.
Bssid
,Ad->
CutAddss
,Ad->
MacTab
.
Cڋ
[
pInfo
->
Wcid
].
Addr
);

265 
Fme
.
Cegy
 = 
CATEGORY_BA
;

266 
Fme
.
Ai
 = 
DELBA
;

267 
Fme
.
DbaPm
.
Int
 = 
pInfo
->Initiator;

268 
Fme
.
DbaPm
.
TID
 = 
pInfo
->TID;

269 
Fme
.
RsCode
 = 39;

270 *(
USHORT
 *)(&
Fme
.
DbaPm

	`u216
(*(USHORT *)(&Frame.DelbaParm));

271 
Fme
.
RsCode
 = 
	`u216
(Frame.ReasonCode);

273 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

274 (
FRAME_DELBA_REQ
), &
Fme
,

275 
END_OF_ARGS
);

276 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

277 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

278 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BA - MlmeDELBAAi(. 3 DELBA st. Int(%d)\n", 
pInfo
->
Int
));

280 
	}
}

283 
VOID
 
	$MlmeQOSAi
(

284 
IN
 
PRTMP_ADAPTER
 
pAd
,

285 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

287 
	}
}

289 
VOID
 
	$MlmeDLSAi
(

290 
IN
 
PRTMP_ADAPTER
 
pAd
,

291 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

293 
	}
}

295 
VOID
 
	$MlmeInvidAi
(

296 
IN
 
PRTMP_ADAPTER
 
pAd
,

297 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

301 
	}
}

303 
VOID
 
	$PrQOSAi
(

304 
IN
 
PRTMP_ADAPTER
 
pAd
,

305 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

307 
	}
}

309 #ifde
QOS_DLS_SUPPORT


310 
VOID
 
	$PrDLSAi
(

311 
IN
 
PRTMP_ADAPTER
 
pAd
,

312 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

314 
UCHAR
 
Ai
 = 
Em
->
Msg
[
LENGTH_802_11
+1];

316 
Ai
)

318 
ACTION_DLS_REQUEST
:

319 #ifde
CONFIG_STA_SUPPORT


320 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

321 
	`PrDlsReqAi
(
pAd
, 
Em
);

325 
ACTION_DLS_RESPONSE
:

326 #ifde
CONFIG_STA_SUPPORT


327 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

328 
	`PrDlsRAi
(
pAd
, 
Em
);

332 
ACTION_DLS_TEARDOWN
:

333 #ifde
CONFIG_STA_SUPPORT


334 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

335 
	`PrDlsTrDownAi
(
pAd
, 
Em
);

339 
	}
}

344 #ifde
DOT11_N_SUPPORT


345 
VOID
 
	$PrBAAi
(

346 
IN
 
PRTMP_ADAPTER
 
pAd
,

347 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

349 
UCHAR
 
Ai
 = 
Em
->
Msg
[
LENGTH_802_11
+1];

351 
Ai
)

353 
ADDBA_REQ
:

354 
	`PrAddBAReqAi
(
pAd
,
Em
);

356 
ADDBA_RESP
:

357 
	`PrAddBARAi
(
pAd
,
Em
);

359 
DELBA
:

360 
	`PrDBAAi
(
pAd
,
Em
);

363 
	}
}

366 #ifde
DOT11N_DRAFT3


368 #ifde
CONFIG_STA_SUPPORT


369 
VOID
 
	$SPublicAi
(

370 
IN
 
PRTMP_ADAPTER
 
pAd
,

371 
IN
 
BSS_2040_COEXIST_IE
 *
pBssCxIE
)

373 
MLME_SCAN_REQ_STRUCT
 
SnReq
;

375 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ACTION - SPrPublicAi Bss2040Cxi = %x\n", *((
PUCHAR
)
pBssCxIE
)));

378 i((
pBssCxIE
->
fld
.
InfoReq
 =1&& (
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_SCAN_2040
)))

381 
pAd
->
CommCfg
.
BSSCxi2040
.
fld
.
InfoReq
 = 1;

382 
pAd
->
CommCfg
.
BSSCxi2040
.
fld
.
Iޔt40
 = 0;

383 
pAd
->
CommCfg
.
BSSCxi2040
.
fld
.
BSS20WidthReq
 = 0;

385 
	`TriEvtIn
(
pAd
);

387 
	`SnPmFl
(
pAd
, &
SnReq
, 
ZoSsid
, 0, 
BSS_ANY
, 
SCAN_2040_BSS_COEXIST
);

388 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_SCAN_REQ
, (
MLME_SCAN_REQ_STRUCT
), &
SnReq
, 0);

389 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_LIST_SCAN
;

390 
	`RTMP_MLME_HANDLER
(
pAd
);

392 
	}
}

399 
ULONG
 
	$BudIޔtChlR
(

400 
IN
 
PRTMP_ADAPTER
 
pAd
,

401 
IN
 
PUCHAR
 
pDe
)

403 
ULONG
 
FmeL
 = 0;

404 
ULONG
 
RdOfft
 = 0;

405 
UCHAR
 
i
, 
j
, 
k
, 
idx
 = 0;

407 
UCHAR
 
ChlLi
[
MAX_TRIGGER_EVENT
];

408 
UCHAR
 
TmpRegCss
;

409 
UCHAR
 
RegCssAay
[7] = {0, 11,12, 32, 33, 54,55};

412 
	`RTMPZoMemy
(
ChlLi
, 
MAX_TRIGGER_EVENT
);

415  
k
 = 0;k < 7;k++)

417 
TmpRegCss
 = 
RegCssAay
[
k
];

419 
idx
 = 0;

421  
i
 = 0;< 
pAd
->
CommCfg
.
TriggEvtTab
.
EvtANo
;i++)

423 i(
pAd
->
CommCfg
.
TriggEvtTab
.
EvtA
[
i
].
bVid
 =
TRUE
)

425 i(
pAd
->
CommCfg
.
TriggEvtTab
.
EvtA
[
i
].
RegCss
 =
TmpRegCss
)

427 
j
 = 0;j < 
idx
;j++)

429 i(
ChlLi
[
j
] =(
UCHAR
)
pAd
->
CommCfg
.
TriggEvtTab
.
EvtA
[
i
].
Chl
)

432 i((
j
 =
idx
))

434 
ChlLi
[
idx
] = (
UCHAR
)
pAd
->
CommCfg
.
TriggEvtTab
.
EvtA
[
i
].
Chl
;

435 
idx
++;

437 
pAd
->
CommCfg
.
TriggEvtTab
.
EvtA
[
i
].
bVid
 = 
FALSE
;

439 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("ACT - BudIޔtChlR , Tٮ Chnumb = %d \n", 
idx
));

444 i(
idx
 > 0)

447 *(
pDe
 + 
RdOfft

IE_2040_BSS_INTOLERANT_REPORT
;

448 *(
pDe
 + 
RdOfft
 + 11+ 
idx
;

449 *(
pDe
 + 
RdOfft
 + 2
TmpRegCss
;

450 
	`RTMPMoveMemy
(
pDe
 + 
RdOfft
 + 3, 
ChlLi
, 
idx
);

452 
FmeL
 +(3 + 
idx
);

453 
RdOfft
 +(3 + 
idx
);

458 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("ACT-BudIޔtChlR(Size=%ld)\n", 
FmeL
));

459 
	`hex_dump
("ACT-pDeMsg", 
pDe
, 
FmeL
);

461  
FmeL
;

462 
	}
}

473 
VOID
 
	$Upde2040CxiFmeAndNify
(

474 
IN
 
PRTMP_ADAPTER
 
pAd
,

475 
IN
 
UCHAR
 
Wcid
,

476 
IN
 
BOOLEAN
 
bAddIޔtCha
)

478 
BSS_2040_COEXIST_IE
 
OldVue
;

480 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("ACT - Upde2040CxiFmeAndNify. BSSCxi2040 = %x. EvtAN%d. \n", 
pAd
->
CommCfg
.
BSSCxi2040
.
wd
,Ad->CommCfg.
TriggEvtTab
.
EvtANo
));

481 
OldVue
.
wd
 = 
pAd
->
CommCfg
.
BSSCxi2040
.word;

483 
pAd
->
CommCfg
.
BSSCxi2040
.
wd
 = 0;

485 i(
pAd
->
CommCfg
.
TriggEvtTab
.
EvtBCouDown
 > 0)

486 
pAd
->
CommCfg
.
BSSCxi2040
.
fld
.
BSS20WidthReq
 = 1;

493 
	`Sd2040CxiAi
(
pAd
, 
Wcid
, 
bAddIޔtCha
);

495 
	}
}

500 
VOID
 
	$Sd2040CxiAi
(

501 
IN
 
PRTMP_ADAPTER
 
pAd
,

502 
IN
 
UCHAR
 
Wcid
,

503 
IN
 
BOOLEAN
 
bAddIޔtCha
)

505 
PUCHAR
 
pOutBufr
 = 
NULL
;

506 
NDIS_STATUS
 
NStus
;

507 
FRAME_ACTION_HDR
 
Fme
;

508 
ULONG
 
FmeL
;

509 
UINT32
 
IޔtChaRL
;

510 
UCHAR
 
HtL
 = 1;

512 
IޔtChaRL
 = 0;

513 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

514 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

516 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("ACT - Send2040CoexistAction()llocate memory failed \n"));

520 
	`AHdIn
(
pAd
, &
Fme
.
Hdr
,Ad->
MacTab
.
Cڋ
[
Wcid
].
Addr
,Ad->
CutAddss
,Ad->
CommCfg
.
Bssid
);

522 
Fme
.
Cegy
 = 
CATEGORY_PUBLIC
;

523 
Fme
.
Ai
 = 
ACTION_BSS_2040_COEXIST
;

525 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

526 (
FRAME_ACTION_HDR
), &
Fme
,

527 1, &
BssCxiIe
,

528 1, &
HtL
,

529 1, &
pAd
->
CommCfg
.
BSSCxi2040
.
wd
,

530 
END_OF_ARGS
);

532 i(
bAddIޔtCha
 =
TRUE
)

533 
IޔtChaRL
 = 
	`BudIޔtChlR
(
pAd
, 
pOutBufr
 + 
FmeL
);

537 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IntolerantChaRepLen=%d, BSSCoexist2040=0x%x!\n",

538 
IޔtChaRL
, 
pAd
->
CommCfg
.
BSSCxi2040
.
wd
));

539 i(!((
IޔtChaRL
 =0&& (
pAd
->
CommCfg
.
BSSCxi2040
.
wd
 == 0)))

540 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
 + 
IޔtChaRL
);

542 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

544 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ACT - Sd2040CxiAiBSSCxi2040 = 0x%x ) \n", 
pAd
->
CommCfg
.
BSSCxi2040
.
wd
));

545 
	}
}

547 
VOID
 
	$UpdeBssSnPm
(

548 
IN
 
PRTMP_ADAPTER
 
pAd
,

549 
IN
 
OVERLAP_BSS_SCAN_IE
 
APBssSn
)

551 
pAd
->
CommCfg
.
D11BssWidthChTnDayFa
 = 
	`2u16
(
APBssSn
.
DayFa
);

553 i((
pAd
->
CommCfg
.
D11BssWidthChTnDayFa
 <5) || (pAd->CommonCfg.Dot11BssWidthChanTranDelayFactor > 100))

556 
pAd
->
CommCfg
.
D11BssWidthChTnDayFa
 = 5;

559 
pAd
->
CommCfg
.
D11BssWidthTriggSnI
 = 
	`2u16
(
APBssSn
.
TriggSnI
);

561 i((
pAd
->
CommCfg
.
D11BssWidthTriggSnI
 < 10) ||(pAd->CommonCfg.Dot11BssWidthTriggerScanInt > 900))

564 
pAd
->
CommCfg
.
D11BssWidthTriggSnI
 = 900;

567 
pAd
->
CommCfg
.
D11OBssSnPassiveDwl
 = 
	`2u16
(
APBssSn
.
SnPassiveDwl
);

569 i((
pAd
->
CommCfg
.
D11OBssSnPassiveDwl
 < 5) ||(pAd->CommonCfg.Dot11OBssScanPassiveDwell > 1000))

572 
pAd
->
CommCfg
.
D11OBssSnPassiveDwl
 = 20;

575 
pAd
->
CommCfg
.
D11OBssSnAiveDwl
 = 
	`2u16
(
APBssSn
.
SnAiveDwl
);

577 i((
pAd
->
CommCfg
.
D11OBssSnAiveDwl
 < 10) ||(pAd->CommonCfg.Dot11OBssScanActiveDwell > 1000))

580 
pAd
->
CommCfg
.
D11OBssSnAiveDwl
 = 10;

583 
pAd
->
CommCfg
.
D11OBssSnPassiveTٮPChl
 = 
	`2u16
(
APBssSn
.
PassiveTPChl
);

585 i((
pAd
->
CommCfg
.
D11OBssSnPassiveTٮPChl
 < 200) ||(pAd->CommonCfg.Dot11OBssScanPassiveTotalPerChannel > 10000))

588 
pAd
->
CommCfg
.
D11OBssSnPassiveTٮPChl
 = 200;

591 
pAd
->
CommCfg
.
D11OBssSnAiveTٮPChl
 = 
	`2u16
(
APBssSn
.
AiveTPChl
);

593 i((
pAd
->
CommCfg
.
D11OBssSnAiveTٮPChl
 < 20) ||(pAd->CommonCfg.Dot11OBssScanActiveTotalPerChannel > 10000))

596 
pAd
->
CommCfg
.
D11OBssSnAiveTٮPChl
 = 20;

599 
pAd
->
CommCfg
.
D11OBssSnAivyTh
 = 
	`2u16
(
APBssSn
.
SnATh
);

601 i(
pAd
->
CommCfg
.
D11OBssSnAivyTh
 > 100)

604 
pAd
->
CommCfg
.
D11OBssSnAivyTh
 = 25;

607 
pAd
->
CommCfg
.
D11BssWidthChTnDay
 = (pAd->CommCfg.
D11BssWidthTriggSnI
 *Ad->CommCfg.
D11BssWidthChTnDayFa
);

609 
	}
}

614 
BOOLEAN
 
	$ChlSwchSyCheck
(

615 
IN
 
PRTMP_ADAPTER
 
pAd
,

616 
IN
 
UCHAR
 
Wcid
,

617 
IN
 
UCHAR
 
NewChl
,

618 
IN
 
UCHAR
 
Secdy
)

620 
UCHAR
 
i
;

622 i(
Wcid
 >
MAX_LEN_OF_MAC_TABLE
)

623  
FALSE
;

625 i((
NewChl
 > 7&& (
Secdy
 == 1))

626  
FALSE
;

628 i((
NewChl
 < 5&& (
Secdy
 == 3))

629  
FALSE
;

632 
i
 = 0;< 
pAd
->
ChlLiNum
;i++)

634 i(
pAd
->
ChlLi
[
i
].
Chl
 =
NewChl
)

640 i(
i
 =
pAd
->
ChlLiNum
)

641  
FALSE
;

643  
TRUE
;

644 
	}
}

647 
VOID
 
	$ChlSwchAi
(

648 
IN
 
PRTMP_ADAPTER
 
pAd
,

649 
IN
 
UCHAR
 
Wcid
,

650 
IN
 
UCHAR
 
NewChl
,

651 
IN
 
UCHAR
 
Secdy
)

653 
UCHAR
 
BBPVue
 = 0;

654 
ULONG
 
MACVue
;

656 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("SPECTRUM - ChlSwchAi(NewCh%d , Secdy = %d \n", 
NewChl
, 
Secdy
));

658 i(
	`ChlSwchSyCheck
(
pAd
, 
Wcid
, 
NewChl
, 
Secdy
=
FALSE
)

662 i(
Secdy
 == 0)

664 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BBPVue
);

665 
BBPVue
&= (~0x18);

666 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BBPVue
);

667 i(
pAd
->
MACVsi
 == 0x28600100)

669 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x16);

670 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x08);

671 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x11);

672 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!rt2860C !!! \n" ));

674 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_20
;

675 
pAd
->
CommCfg
.
Chl
 = 
NewChl
;

676 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
;

677 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
,
FALSE
);

678 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

679 
pAd
->
MacTab
.
Cڋ
[
Wcid
].
HTPhyMode
.
fld
.
BW
 = 0;

680 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!20MHz !!! \n" ));

683 i(((
Secdy
 =1|| (Secdy =3)&& (
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
 == 1))

685 
pAd
->
CommCfg
.
Chl
 = 
NewChl
;

687 i(
Secdy
 == 1)

690 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
 + 2;

691 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
MACVue
);

692 
MACVue
 &= 0xfe;

693 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
MACVue
);

694 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BBPVue
);

695 
BBPVue
&= (~0x18);

697 
BBPVue
|= (0x10);

698 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BBPVue
);

699 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BBPVue
);

700 
BBPVue
&= (~0x20);

701 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BBPVue
);

702 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!40MHz Low LINK UP !!! Cڌ Chȩ Bow. C = %d \n", 
pAd
->
CommCfg
.
CChl
 ));

708 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
 - 2;

709 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
MACVue
);

710 
MACVue
 &= 0xfe;

711 
MACVue
 |= 0x1;

712 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
MACVue
);

713 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BBPVue
);

714 
BBPVue
&= (~0x18);

715 
BBPVue
|= (0x10);

716 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BBPVue
);

717 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BBPVue
);

718 
BBPVue
&= (~0x20);

719 
BBPVue
|= (0x20);

720 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BBPVue
);

721 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!40MHz U LINK UP !!! Cڌ Chȩ UC = %d \n", 
pAd
->
CommCfg
.
CChl
 ));

723 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_40
;

724 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

725 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

726 
pAd
->
MacTab
.
Cڋ
[
Wcid
].
HTPhyMode
.
fld
.
BW
 = 1;

728 
	}
}

732 
VOID
 
	$PrPublicAi
(

733 
IN
 
PRTMP_ADAPTER
 
pAd
,

734 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

736 #ifde
DOT11_N_SUPPORT


737 #ifde
DOT11N_DRAFT3


738 
UCHAR
 
Ai
 = 
Em
->
Msg
[
LENGTH_802_11
+1];

741 i(
Em
->
Wcid
 >
MAX_LEN_OF_MAC_TABLE
)

744 #ifde
DOT11_N_SUPPORT


745 #ifde
DOT11N_DRAFT3


746 
Ai
)

748 
ACTION_BSS_2040_COEXIST
:

751 
BSS_2040_COEXIST_ELEMENT
 *
pCxiInfo
;

752 
BSS_2040_COEXIST_IE
 *
pBssCxiIe
;

753 
BSS_2040_INTOLERANT_CH_REPORT
 *
pIޔtRt
 = 
NULL
;

755 i(
Em
->
MsgL
 <(
LENGTH_802_11
 + (
BSS_2040_COEXIST_ELEMENT
)) )

757 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("ACTION - 20/40 BSS Cxi MagemFmngthosht! = %ld!\n", 
Em
->
MsgL
));

760 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ACTION - 20/40 BSS Coexistence Managementction----> \n"));

761 
	`hex_dump
("CxiMgmtFme", 
Em
->
Msg
, Em->
MsgL
);

764 
pCxiInfo
 = (
BSS_2040_COEXIST_ELEMENT
 *&
Em
->
Msg
[
LENGTH_802_11
+2];

766 i(
Em
->
MsgL
 >(
LENGTH_802_11
 + (
BSS_2040_COEXIST_ELEMENT
+ (
BSS_2040_INTOLERANT_CH_REPORT
)))

768 
pIޔtRt
 = (
BSS_2040_INTOLERANT_CH_REPORT
 *)((
PUCHAR
)
pCxiInfo
 + (
BSS_2040_COEXIST_ELEMENT
));

772 if(
pAd
->
CommCfg
.
bBssCxEb
 =
FALSE
 || (pAd->CommCfg.
bFty_Mhz_Iޔt
 =
TRUE
))

774 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("20/40 BSS CoexMgmt=%d, bForty_Mhz_Intolerant=%d, ignorehisction!!\n",

775 
pAd
->
CommCfg
.
bBssCxEb
,

776 
pAd
->
CommCfg
.
bFty_Mhz_Iޔt
));

780 
pBssCxiIe
 = (
BSS_2040_COEXIST_IE
 *)(&
pCxiInfo
->
BssCxiIe
);

782 #ifde
CONFIG_STA_SUPPORT


783 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

785 i(
	`INFRA_ON
(
pAd
))

787 
	`SPublicAi
(
pAd
, 
pBssCxiIe
);

799 
	}
}

802 
VOID
 
	$RervedAi
(

803 
IN
 
PRTMP_ADAPTER
 
pAd
,

804 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

806 
UCHAR
 
Cegy
;

808 i(
Em
->
MsgL
 <
LENGTH_802_11
)

813 
Cegy
 = 
Em
->
Msg
[
LENGTH_802_11
];

814 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Rcverved cegy(%dAi Fme\n", 
Cegy
));

815 
	`hex_dump
("Rerved Ai Fme", &
Em
->
Msg
[0], Em->
MsgL
);

816 
	}
}

818 
VOID
 
	$PrRMAi
(

819 
IN
 
PRTMP_ADAPTER
 
pAd
,

820 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

824 
	}
}

826 #ifde
DOT11_N_SUPPORT


827 
VOID
 
	$d_ht_fmi_exchge_ai
(

828 
IN
 
PRTMP_ADAPTER
 
pAd
,

829 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

831 
PUCHAR
 
pOutBufr
 = 
NULL
;

832 
NDIS_STATUS
 
NStus
;

833 
ULONG
 
FmeL
;

834 
FRAME_HT_INFO
 
HTINFOame
, *
pFme
;

835 
UCHAR
 *
pAddr
;

839 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

841 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

843 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ACTION -espond_ht_information_exchange_action()llocate memory failed \n"));

848 
pFme
 = (
FRAME_HT_INFO
 *&
Em
->
Msg
[0];

849 
pAddr
 = 
pFme
->
Hdr
.
Addr2
;

851 
	`NdisZoMemy
(&
HTINFOame
, (
FRAME_HT_INFO
));

853 #ifde
CONFIG_STA_SUPPORT


854 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

856 i(
	`ADHOC_ON
(
pAd
))

857 
	`AHdIn
(
pAd
, &
HTINFOame
.
Hdr
, 
pAddr
,Ad->
CutAddss
,Ad->
CommCfg
.
Bssid
);

859 
	`AHdIn
(
pAd
, &
HTINFOame
.
Hdr
,Ad->
CommCfg
.
Bssid
,Ad->
CutAddss
, 
pAddr
);

863 
HTINFOame
.
Cegy
 = 
CATEGORY_HT
;

864 
HTINFOame
.
Ai
 = 
HT_INFO_EXCHANGE
;

865 
HTINFOame
.
HT_Info
.
Reque
 = 0;

866 
HTINFOame
.
HT_Info
.
Fty_MHz_Iޔt
 = 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
Fty_Mhz_Iޔt
;

867 
HTINFOame
.
HT_Info
.
STA_Chl_Width
 = 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
RecomWidth
;

869 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

870 (
FRAME_HT_INFO
), &
HTINFOame
,

871 
END_OF_ARGS
);

873 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

874 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

875 
	}
}

880 
VOID
 
	$PrHTAi
(

881 
IN
 
PRTMP_ADAPTER
 
pAd
,

882 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

884 
UCHAR
 
Ai
 = 
Em
->
Msg
[
LENGTH_802_11
+1];

886 i(
Em
->
Wcid
 >
MAX_LEN_OF_MAC_TABLE
)

889 
Ai
)

891 
NOTIFY_BW_ACTION
:

892 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ACTION - HT Notify Channel bandwidthction----> \n"));

893 #ifde
CONFIG_STA_SUPPORT


894 if(
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 =
FALSE
)

899 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ACTION -Ignore HT Notify Channel BW wheninksegacy mode. BW = %d---> \n",

900 
Em
->
Msg
[
LENGTH_802_11
+2] ));

905 i(
Em
->
Msg
[
LENGTH_802_11
+2] == 0)

906 
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
].
HTPhyMode
.
fld
.
BW
 = 0;

909 
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
].
HTPhyMode
.
fld
.
BW
 =

910 
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
].
MaxHTPhyMode
.
fld
.
BW
 &Ad->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
;

915 
SMPS_ACTION
:

917 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ACTION - SMPSction----> \n"));

918 i(((
Em
->
Msg
[
LENGTH_802_11
+2]&0x1) == 0))

920 
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
].
MmpsMode
 = 
MMPS_ENABLE
;

922 i(((
Em
->
Msg
[
LENGTH_802_11
+2]&0x2) == 0))

924 
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
].
MmpsMode
 = 
MMPS_STATIC
;

928 
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
].
MmpsMode
 = 
MMPS_DYNAMIC
;

931 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Aid(%dMIMO PS = %d\n", 
Em
->
Wcid
, 
pAd
->
MacTab
.
Cڋ
[Em->Wcid].
MmpsMode
));

935 
SETPCO_ACTION
:

938 
MIMO_CHA_MEASURE_ACTION
:

941 
HT_INFO_EXCHANGE
:

943 
HT_INFORMATION_OCTET
 *
pHT_fo
;

945 
pHT_fo
 = (
HT_INFORMATION_OCTET
 *&
Em
->
Msg
[
LENGTH_802_11
+2];

947 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ACTION - HT Information Exchangection----> \n"));

948 i(
pHT_fo
->
Reque
)

950 
	`d_ht_fmi_exchge_ai
(
pAd
, 
Em
);

955 
	}
}

972 
VOID
 
	$ORIBATimTimeout
(

973 
IN
 
PRTMP_ADAPTER
 
pAd
)

975 
MAC_TABLE_ENTRY
 *
pEry
;

976 
INT
 
i
, 
tٮ
;

982 
UCHAR
 
TID
;

984 #ifde
RALINK_ATE


985 i(
	`ATE_ON
(
pAd
))

989 
tٮ
 = 
pAd
->
MacTab
.
Size
 * 
NUM_OF_TID
;

991 
i
 = 1; ((<
MAX_LEN_OF_BA_ORI_TABLE
&& (
tٮ
 > 0)) ; i++)

993 i(
pAd
->
BATab
.
BAOriEry
[
i
].
ORI_BA_Stus
 =
Orig_De
)

995 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[pAd->
BATab
.
BAOriEry
[
i
].
Wcid
];

996 
TID
 = 
pAd
->
BATab
.
BAOriEry
[
i
].TID;

998 
	`ASSERT
(
pAd
->
BATab
.
BAOriEry
[
i
].
Wcid
 < 
MAX_LEN_OF_MAC_TABLE
);

1000 
tٮ
 --;

1002 
	}
}

1005 
VOID
 
	$SdReeshBAR
(

1006 
IN
 
PRTMP_ADAPTER
 
pAd
,

1007 
IN
 
MAC_TABLE_ENTRY
 *
pEry
)

1009 
FRAME_BAR
 
FmeB
;

1010 
ULONG
 
FmeL
;

1011 
NDIS_STATUS
 
NStus
;

1012 
PUCHAR
 
pOutBufr
 = 
NULL
;

1013 
USHORT
 
Sequ
;

1014 
UCHAR
 
i
, 
TID
;

1015 
USHORT
 
idx
;

1016 
BA_ORI_ENTRY
 *
pBAEry
;

1018 
i
 = 0; i <
NUM_OF_TID
; i++)

1020 
idx
 = 
pEry
->
BAOriWcidAay
[
i
];

1021 i(
idx
 == 0)

1025 
pBAEry
 = &
pAd
->
BATab
.
BAOriEry
[
idx
];

1027 i(
pBAEry
->
ORI_BA_Stus
 =
Orig_De
)

1029 
TID
 = 
pBAEry
->TID;

1031 
	`ASSERT
(
pBAEry
->
Wcid
 < 
MAX_LEN_OF_MAC_TABLE
);

1033 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

1034 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

1036 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("BA - MlmeADDBAAction()llocate memory failed \n"));

1040 
Sequ
 = 
pEry
->
TxSeq
[
TID
];

1043 #ifde
CONFIG_STA_SUPPORT


1044 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1045 
	`BHdIn
(
pAd
, &
FmeB
, 
pEry
->
Addr
,Ad->
CutAddss
);

1048 
FmeB
.
SgSeq
.
fld
.
FgNum
 = 0;

1049 
FmeB
.
SgSeq
.
fld
.
SSeq
 = 
Sequ
;

1050 
FmeB
.
BCڌ
.
TID
 = TID;

1052 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1053 (
FRAME_BAR
), &
FmeB
,

1054 
END_OF_ARGS
);

1059 
	`MtMMReque
(
pAd
, (
MGMT_USE_QUEUE_FLAG
 | 
MUrPriܙyToAcssCegy
[
TID
]), 
pOutBufr
, 
FmeL
);

1062 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1065 
	}
}

1068 
VOID
 
	$AHdIn
(

1069 
IN
 
PRTMP_ADAPTER
 
pAd
,

1070 
IN
 
OUT
 
PHEADER_802_11
 
pHdr80211
,

1071 
IN
 
PUCHAR
 
Addr1
,

1072 
IN
 
PUCHAR
 
Addr2
,

1073 
IN
 
PUCHAR
 
Addr3
)

1075 
	`NdisZoMemy
(
pHdr80211
, (
HEADER_802_11
));

1076 
pHdr80211
->
FC
.
Ty
 = 
BTYPE_MGMT
;

1077 
pHdr80211
->
FC
.
SubTy
 = 
SUBTYPE_ACTION
;

1079 
	`COPY_MAC_ADDR
(
pHdr80211
->
Addr1
, Addr1);

1080 
	`COPY_MAC_ADDR
(
pHdr80211
->
Addr2
, Addr2);

1081 
	`COPY_MAC_ADDR
(
pHdr80211
->
Addr3
, Addr3);

1082 
	}
}

1084 
VOID
 
	$BHdIn
(

1085 
IN
 
PRTMP_ADAPTER
 
pAd
,

1086 
IN
 
OUT
 
PFRAME_BAR
 
pClB
,

1087 
IN
 
PUCHAR
 
pDA
,

1088 
IN
 
PUCHAR
 
pSA
)

1092 
	`NdisZoMemy
(
pClB
, (
FRAME_BAR
));

1093 
pClB
->
FC
.
Ty
 = 
BTYPE_CNTL
;

1094 
pClB
->
FC
.
SubTy
 = 
SUBTYPE_BLOCK_ACK_REQ
;

1095 
pClB
->
BCڌ
.
MTID
 = 0;

1096 
pClB
->
BCڌ
.
Comesd
 = 1;

1097 
pClB
->
BCڌ
.
ACKPicy
 = 0;

1100 
pClB
->
Duti
 = 16 + 
	`RTMPCcDuti
(
pAd
, 
RATE_1
, (
FRAME_BA
));

1102 
	`COPY_MAC_ADDR
(
pClB
->
Addr1
, 
pDA
);

1103 
	`COPY_MAC_ADDR
(
pClB
->
Addr2
, 
pSA
);

1104 
	}
}

1121 
VOID
 
	$InAFld
(

1122 
IN
 
PRTMP_ADAPTER
 
pAd
,

1123 
OUT
 
PUCHAR
 
pFmeBuf
,

1124 
OUT
 
PULONG
 
pFmeL
,

1125 
IN
 
UINT8
 
Cegy
,

1126 
IN
 
UINT8
 
ACode
)

1128 
ULONG
 
TempL
;

1130 
	`MakeOutgogFme

pFmeBuf
, &
TempL
,

1131 1, &
Cegy
,

1132 1, &
ACode
,

1133 
END_OF_ARGS
);

1135 *
pFmeL
 = *pFmeL + 
TempL
;

1138 
	}
}

	@common/ba_action.c

29 #ifde
DOT11_N_SUPPORT


31 
	~"_cfig.h
"

35 
	#BA_ORI_INIT_SEQ
 (
pEry
->
TxSeq
[
TID
])

36 

	)

37 
	#ORI_SESSION_MAX_RETRY
 8

	)

38 
	#ORI_BA_SESSION_TIMEOUT
 (2000)

39 
	#REC_BA_SESSION_IDLE_TIMEOUT
 (1000)

40 

	)

41 
	#REORDERING_PACKET_TIMEOUT
 ((100 * 
OS_HZ
)/1000)

42 
	#MAX_REORDERING_PACKET_TIMEOUT
 ((3000 * 
OS_HZ
)/1000)

43 

	)

44 
	#RESET_RCV_SEQ
 (0xFFFF)

	)

46 
ba_mpdu_blk_
(
PRTMP_ADAPTER
 
pAd
, 
dg_mpdu
 *
mpdu_blk
);

49 
BA_ORI_ENTRY
 *
BATabAocOriEry
(

50 
IN
 
PRTMP_ADAPTER
 
pAd
,

51 
OUT
 
USHORT
 *
Idx
);

53 
BA_REC_ENTRY
 *
BATabAocRecEry
(

54 
IN
 
PRTMP_ADAPTER
 
pAd
,

55 
OUT
 
USHORT
 *
Idx
);

57 
VOID
 
BAOriSessiSupTimeout
(

58 
IN
 
PVOID
 
SyemScific1
,

59 
IN
 
PVOID
 
FuniCڋxt
,

60 
IN
 
PVOID
 
SyemScific2
,

61 
IN
 
PVOID
 
SyemScific3
);

63 
VOID
 
BARecSessiIdTimeout
(

64 
IN
 
PVOID
 
SyemScific1
,

65 
IN
 
PVOID
 
FuniCڋxt
,

66 
IN
 
PVOID
 
SyemScific2
,

67 
IN
 
PVOID
 
SyemScific3
);

70 
BUILD_TIMER_FUNCTION
(
BAOriSessiSupTimeout
);

71 
BUILD_TIMER_FUNCTION
(
BARecSessiIdTimeout
);

73 
	#ANNOUNCE_REORDERING_PACKET
(
_pAd
, 
_mpdu_blk
) \

74 
	`Aoun_Redg_Pack
(
_pAd
, 
_mpdu_blk
);

	)

76 
VOID
 
	$BA_MaxWSizeRsign
(

77 
IN
 
PRTMP_ADAPTER
 
pAd
,

78 
IN
 
MAC_TABLE_ENTRY
 *
pEryPr
,

79 
OUT
 
UCHAR
 *
pWSize
)

81 
UCHAR
 
MaxSize
;

82 
UCHAR
 
MaxPrRxSize
;

85 
MaxPrRxSize
 = (((1 << (
pEryPr
->
MaxRAmpduFa
 + 3)) * 10) / 16) -1;

86 i(
pAd
->
MACVsi
 >
RALINK_2883_VERSION
)

88 i(
pAd
->
MACVsi
 >
RALINK_3070_VERSION
)

90 i(
pEryPr
->
WStus
 !
Ndis802_11EnyiDibd
)

91 
MaxSize
 = 7;

93 
MaxSize
 = 13;

96 
MaxSize
 = 31;

98 i(
pAd
->
MACVsi
 >
RALINK_2880E_VERSION
)

100 i(
pEryPr
->
WStus
 !
Ndis802_11EnyiDibd
)

101 
MaxSize
 = 7;

103 
MaxSize
 = 13;

106 
MaxSize
 = 7;

109 #ifde
CONFIG_STA_SUPPORT


113 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ba>WinSize=%d, MaxSize=%d, MaxPeerRxSize=%d\n",

114 *
pWSize
, 
MaxSize
, 
MaxPrRxSize
));

116 
MaxSize
 = 
	`m
(
MaxPrRxSize
, MaxSize);

117 i((*
pWSize
> 
MaxSize
)

119 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ba>eassign max win size from %do %d\n",

120 *
pWSize
, 
MaxSize
));

122 *
pWSize
 = 
MaxSize
;

124 
	}
}

126 
	$Aoun_Redg_Pack
(
IN
 
PRTMP_ADAPTER
 
pAd
,

127 
IN
 
dg_mpdu
 *
mpdu
)

129 
PNDIS_PACKET
 
pPack
;

131 
pPack
 = 
mpdu
->pPacket;

133 i(
mpdu
->
bAMSDU
)

136 
	`BA_Red_AMSDU_Anoun
(
pAd
, 
pPack
);

144 #ifde
CONFIG_STA_SUPPORT


145 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

146 
	`ANNOUNCE_OR_FORWARD_802_3_PACKET
(
pAd
, 
pPack
, 
	`RTMP_GET_PACKET_IF
(pPacket));

149 
	}
}

154 
BOOLEAN
 
	$ba_dg_mpdu_s܋d
(
dg_li
 *
li
, 
dg_mpdu
 *
mpdu
)

157 
dg_mpdu
 **
Sn
 = &
li
->
xt
;

159 *
Sn
 !
NULL
)

161 i(
	`SEQ_SMALLER
((*
Sn
)->
Sequ
, 
mpdu
->Sequ, 
MAXSEQ
))

163 
Sn
 = &(*Sn)->
xt
;

165 i((*
Sn
)->
Sequ
 =
mpdu
->Sequence)

168 (
FALSE
);

177 
mpdu
->
xt
 = *
Sn
;

178 *
Sn
 = 
mpdu
;

179 
li
->
qn
++;

180  
TRUE
;

181 
	}
}

187 
le
 
	$ba_queue
(
dg_li
 *
li
, 
dg_mpdu
 *
mpdu_blk
)

189 
li
->
qn
++;

190 
mpdu_blk
->
xt
 = 
li
->next;

191 
li
->
xt
 = 
mpdu_blk
;

192 
	}
}

197 
le
 
dg_mpdu
 * 
	$ba_dequeue
(
dg_li
 *
li
)

199 
dg_mpdu
 *
mpdu_blk
 = 
NULL
;

201 
	`ASSERT
(
li
);

203 i(
li
->
qn
)

205 
li
->
qn
--;

206 
mpdu_blk
 = 
li
->
xt
;

207 i(
mpdu_blk
)

209 
li
->
xt
 = 
mpdu_blk
->next;

210 
mpdu_blk
->
xt
 = 
NULL
;

213  
mpdu_blk
;

214 
	}
}

217 
le
 
dg_mpdu
 *
	$ba_dg_mpdu_dequeue
(
dg_li
 *
li
)

219 (
	`ba_dequeue
(
li
));

220 
	}
}

223 
le
 
dg_mpdu
 *
	$ba_dg_mpdu_obe
(
dg_li
 *
li
)

225 
	`ASSERT
(
li
);

227 (
li
->
xt
);

228 
	}
}

234 
	$ba_dg_sour_a
(
PRTMP_ADAPTER
 
pAd
)

236 
BA_TABLE
 *
Tab
;

237 
PBA_REC_ENTRY
 
pBAEry
;

238 
dg_mpdu
 *
mpdu_blk
;

239 
i
;

241 
Tab
 = &
pAd
->
BATab
;

244 
	`NdisAcqueSpLock
(&
pAd
->
BATabLock
);

245 
i
 = 0; i < 
MAX_LEN_OF_BA_REC_TABLE
; i++)

247 
pBAEry
 = &
Tab
->
BARecEry
[
i
];

248 i(
pBAEry
->
REC_BA_Stus
 !
Rec_NONE
)

250 (
mpdu_blk
 = 
	`ba_dg_mpdu_dequeue
(&
pBAEry
->
li
)))

252 
	`ASSERT
(
mpdu_blk
->
pPack
);

253 
	`RELEASE_NDIS_PACKET
(
pAd
, 
mpdu_blk
->
pPack
, 
NDIS_STATUS_FAILURE
);

254 
	`ba_mpdu_blk_
(
pAd
, 
mpdu_blk
);

258 
	`NdisRSpLock
(&
pAd
->
BATabLock
);

260 
	`ASSERT
(
pBAEry
->
li
.
qn
 == 0);

262 
	`NdisAcqueSpLock
(&
pAd
->
mpdu_blk_po
.
lock
);

263 
	`os__mem
(
pAd
,Ad->
mpdu_blk_po
.
mem
);

264 
	`NdisRSpLock
(&
pAd
->
mpdu_blk_po
.
lock
);

265 
	}
}

272 
BOOLEAN
 
	$ba_dg_sour_
(
PRTMP_ADAPTER
 
pAd
, 
num
)

274 
i
;

275 
PUCHAR
 
mem
;

276 
dg_mpdu
 *
mpdu_blk
;

277 
dg_li
 *
li
;

280 
	`NdisAoSpLock
(&
pAd
->
mpdu_blk_po
.
lock
);

283 
li
 = &
pAd
->
mpdu_blk_po
.freelist;

284 
li
->
xt
 = 
NULL
;

285 
li
->
qn
 = 0;

287 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ao %d memy f BAedg\n", (
UINT32
)(
num
*(
dg_mpdu
))));

290 
	`os_loc_mem
(
pAd
, (
PUCHAR
 *)&
mem
, (
num
*(
dg_mpdu
)));

292 
pAd
->
mpdu_blk_po
.
mem
 = mem;

294 i(
mem
 =
NULL
)

296 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Can't Allocate Memory for BA Reordering\n"));

297 (
FALSE
);

301 
i
=0; i<
num
; i++)

304 
mpdu_blk
 = (
dg_mpdu
 *
mem
;

306 
	`NdisZoMemy
(
mpdu_blk
, (
dg_mpdu
));

308 
mem
 +(
dg_mpdu
);

310 
	`ba_queue
(
li
, 
mpdu_blk
);

313 (
TRUE
);

314 
	}
}

318 
dg_mpdu
 *
	$ba_mpdu_blk_loc
(
PRTMP_ADAPTER
 
pAd
)

320 
dg_mpdu
 *
mpdu_blk
;

322 
	`NdisAcqueSpLock
(&
pAd
->
mpdu_blk_po
.
lock
);

323 
mpdu_blk
 = 
	`ba_dequeue
(&
pAd
->
mpdu_blk_po
.
li
);

324 i(
mpdu_blk
)

328 
	`NdisZoMemy
(
mpdu_blk
, (
dg_mpdu
));

330 
	`NdisRSpLock
(&
pAd
->
mpdu_blk_po
.
lock
);

331  
mpdu_blk
;

332 
	}
}

334 
	$ba_mpdu_blk_
(
PRTMP_ADAPTER
 
pAd
, 
dg_mpdu
 *
mpdu_blk
)

336 
	`ASSERT
(
mpdu_blk
);

338 
	`NdisAcqueSpLock
(&
pAd
->
mpdu_blk_po
.
lock
);

340 
	`ba_queue
(&
pAd
->
mpdu_blk_po
.
li
, 
mpdu_blk
);

341 
	`NdisRSpLock
(&
pAd
->
mpdu_blk_po
.
lock
);

342 
	}
}

345 
USHORT
 
	$ba_di_dg_mpdus__d
(

346 
IN
 
PRTMP_ADAPTER
 
pAd
,

347 
IN
 
PBA_REC_ENTRY
 
pBAEry
,

348 
IN
 
USHORT
 
SSeq
)

350 
dg_mpdu
 *
mpdu_blk
;

351 
USHORT
 
LaIndSeq
 = 
RESET_RCV_SEQ
;

353 
	`NdisAcqueSpLock
(&
pBAEry
->
RxReRgLock
);

355 (
mpdu_blk
 = 
	`ba_dg_mpdu_obe
(&
pBAEry
->
li
)))

358 i(!
	`SEQ_STEPONE
(
mpdu_blk
->
Sequ
, 
SSeq
, 
MAXSEQ
))

363 
mpdu_blk
 = 
	`ba_dg_mpdu_dequeue
(&
pBAEry
->
li
);

365 
	`ANNOUNCE_REORDERING_PACKET
(
pAd
, 
mpdu_blk
);

367 
SSeq
 = 
mpdu_blk
->
Sequ
;

368 
LaIndSeq
 = 
SSeq
;

370 
	`ba_mpdu_blk_
(
pAd
, 
mpdu_blk
);

373 
	`NdisRSpLock
(&
pBAEry
->
RxReRgLock
);

376  
LaIndSeq
;

377 
	}
}

379 
	$ba_di_dg_mpdus__q
(

380 
IN
 
PRTMP_ADAPTER
 
pAd
,

381 
IN
 
PBA_REC_ENTRY
 
pBAEry
,

382 
IN
 
USHORT
 
Sequ
)

384 
dg_mpdu
 *
mpdu_blk
;

386 
	`NdisAcqueSpLock
(&
pBAEry
->
RxReRgLock
);

387 (
mpdu_blk
 = 
	`ba_dg_mpdu_obe
(&
pBAEry
->
li
)))

390 i((
mpdu_blk
->
Sequ
 =Sequ|| 
	`SEQ_SMALLER
(mpdu_blk->Sequ, Sequ, 
MAXSEQ
))

393 
mpdu_blk
 = 
	`ba_dg_mpdu_dequeue
(&
pBAEry
->
li
);

395 
	`ANNOUNCE_REORDERING_PACKET
(
pAd
, 
mpdu_blk
);

397 
	`ba_mpdu_blk_
(
pAd
, 
mpdu_blk
);

404 
	`NdisRSpLock
(&
pBAEry
->
RxReRgLock
);

405 
	}
}

408 
	$ba_esh_dg_mpdus
(

409 
IN
 
PRTMP_ADAPTER
 
pAd
,

410 
PBA_REC_ENTRY
 
pBAEry
)

412 
dg_mpdu
 *
mpdu_blk
;

414 
	`NdisAcqueSpLock
(&
pBAEry
->
RxReRgLock
);

417 (
mpdu_blk
 = 
	`ba_dg_mpdu_dequeue
(&
pBAEry
->
li
)))

420 
	`ANNOUNCE_REORDERING_PACKET
(
pAd
, 
mpdu_blk
);

422 
pBAEry
->
LaIndSeq
 = 
mpdu_blk
->
Sequ
;

423 
	`ba_mpdu_blk_
(
pAd
, 
mpdu_blk
);

427 
	`ASSERT
(
pBAEry
->
li
.
qn
 == 0);

428 
pBAEry
->
LaIndSeq
 = 
RESET_RCV_SEQ
;

429 
	`NdisRSpLock
(&
pBAEry
->
RxReRgLock
);

430 
	}
}

434 
	$ba_ush_dg_timeout_mpdus
(

435 
IN
 
PRTMP_ADAPTER
 
pAd
,

436 
IN
 
PBA_REC_ENTRY
 
pBAEry
,

437 
IN
 
ULONG
 
Now32
)

440 
USHORT
 
Sequ
;

446 i(
	`RTMP_TIME_AFTER
(()
Now32
, ()(
pBAEry
->
LaIndSeqAtTim
+(
MAX_REORDERING_PACKET_TIMEOUT
/6)))

447 &&(
pBAEry
->
li
.
qn
 > 1)

450 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("timeout[%d] (%08lx-%08lx = %d > %d): %x, flush!\", 
pBAEry
->
li
.
qn
, 
Now32
, (pBAEry->
LaIndSeqAtTim
),

451 ()((
Now32
 - ()(
pBAEry
->
LaIndSeqAtTim
)), 
MAX_REORDERING_PACKET_TIMEOUT
,

452 
pBAEry
->
LaIndSeq
));

453 
	`ba_esh_dg_mpdus
(
pAd
, 
pBAEry
);

454 
pBAEry
->
LaIndSeqAtTim
 = 
Now32
;

457 i(
	`RTMP_TIME_AFTER
(()
Now32
, ()(
pBAEry
->
LaIndSeqAtTim
+(
REORDERING_PACKET_TIMEOUT
)))

458 && (
pBAEry
->
li
.
qn
 > 0)

467 
Sequ
 = (
pBAEry
->
LaIndSeq
+1& 
MAXSEQ
;

468 
	`ba_di_dg_mpdus__q
(
pAd
, 
pBAEry
, 
Sequ
);

469 
pBAEry
->
LaIndSeqAtTim
 = 
Now32
;

470 
pBAEry
->
LaIndSeq
 = 
Sequ
;

474 
Sequ
 = 
	`ba_di_dg_mpdus__d
(
pAd
, 
pBAEry
, Sequence);

475 i(
Sequ
 !
RESET_RCV_SEQ
)

477 
pBAEry
->
LaIndSeq
 = 
Sequ
;

480 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%x, flush o!\n", 
pBAEry
->
LaIndSeq
));

483 
	}
}

490 
VOID
 
	$BAOriSessiSUp
(

491 
IN
 
PRTMP_ADAPTER
 
pAd
,

492 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

493 
IN
 
UCHAR
 
TID
,

494 
IN
 
USHORT
 
TimeOut
,

495 
IN
 
ULONG
 
DayTime
,

496 
IN
 
BOOLEAN
 
isFd
)

500 
BA_ORI_ENTRY
 *
pBAEry
 = 
NULL
;

501 
USHORT
 
Idx
;

502 
BOOLEAN
 
Ced
;

504 
	`ASSERT
(
TID
 < 
NUM_OF_TID
);

506 i((
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 !
TRUE
&& (
isFd
 =
FALSE
))

510 i(
	`RTMPSFixedTxMode
(
pAd
, 
pEry
!
FIXED_TXMODE_HT
)

513 i((
pEry
->
BADeeBm
 & (1<<
TID
)&& (
isFd
 =
FALSE
))

516 
DayTime
 = 3000;

522 
Idx
 = 
pEry
->
BAOriWcidAay
[
TID
];

523 i(
Idx
 == 0)

526 
pBAEry
 = 
	`BATabAocOriEry
(
pAd
, &
Idx
);

527 i(
pBAEry
 =
NULL
)

529 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ADDBA - MlmeADDBAAction()llocate BA session failed \n"));

535 
pBAEry
 =&
pAd
->
BATab
.
BAOriEry
[
Idx
];

538 i(
pBAEry
->
ORI_BA_Stus
 >
Orig_WaRes
)

543 
pEry
->
BAOriWcidAay
[
TID
] = 
Idx
;

546 
pBAEry
->
ORI_BA_Stus
 = 
Orig_WaRes
;

547 
pBAEry
->
Wcid
 = 
pEry
->
Aid
;

548 
pBAEry
->
BAWSize
 = 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
;

549 
pBAEry
->
Sequ
 = 
BA_ORI_INIT_SEQ
;

550 
pBAEry
->
Tok
 = 1;

551 
pBAEry
->
TID
 = TID;

552 
pBAEry
->
TimeOutVue
 = 
TimeOut
;

553 
pBAEry
->
pAdr
 = 
pAd
;

555 i(!(
pEry
->
TXBAbm
 & (1<<
TID
)))

557 
	`RTMPInTim
(
pAd
, &
pBAEry
->
ORIBATim
, 
	`GET_TIMER_FUNCTION
(
BAOriSessiSupTimeout
),BAEry, 
FALSE
);

560 
	`RTMPClTim
(&
pBAEry
->
ORIBATim
, &
Ced
);

563 
	`RTMPSTim
(&
pBAEry
->
ORIBATim
, 
DayTime
);

564 
	}
}

566 
VOID
 
	$BAOriSessiAdd
(

567 
IN
 
PRTMP_ADAPTER
 
pAd
,

568 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

569 
IN
 
PFRAME_ADDBA_RSP
 
pFme
)

571 
BA_ORI_ENTRY
 *
pBAEry
 = 
NULL
;

572 
BOOLEAN
 
Ced
;

573 
UCHAR
 
TID
;

574 
USHORT
 
Idx
;

575 
PUCHAR
 
pOutBufr2
 = 
NULL
;

576 
NDIS_STATUS
 
NStus
;

577 
ULONG
 
FmeL
;

578 
FRAME_BAR
 
FmeB
;

580 
TID
 = 
pFme
->
BaPm
.TID;

581 
Idx
 = 
pEry
->
BAOriWcidAay
[
TID
];

582 
pBAEry
 =&
pAd
->
BATab
.
BAOriEry
[
Idx
];

585 i((
Idx
 !=0&& (
pBAEry
->
TID
 =TID&& (pBAEry->
ORI_BA_Stus
 =
Orig_WaRes
))

587 
pBAEry
->
BAWSize
 = 
	`m
BAEry->BAWSize, ((
UCHAR
)
pFme
->
BaPm
.
BufSize
));

588 
	`BA_MaxWSizeRsign
(
pAd
, 
pEry
, &
pBAEry
->
BAWSize
);

590 
pBAEry
->
TimeOutVue
 = 
pFme
->TimeOutValue;

591 
pBAEry
->
ORI_BA_Stus
 = 
Orig_De
;

592 
pAd
->
BATab
.
numDeOrig
 ++;

595 
pBAEry
->
Sequ
 = 
BA_ORI_INIT_SEQ
;

597 
pEry
->
TXBAbm
 |(1<<
TID
);

598 
	`RTMPClTim
(&
pBAEry
->
ORIBATim
, &
Ced
);

600 
pBAEry
->
ORIBATim
.
TimVue
 = 0;

602 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("%: TXBAbm = %x, BAWSiz%d, TimeOu%ld\n", 
__FUNCTION__
, 
pEry
->
TXBAbm
,

603 
pBAEry
->
BAWSize
,BAEry->
ORIBATim
.
TimVue
));

606 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr2
);

607 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

609 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("BA - BAOriSessionAdd()llocate memory failed \n"));

614 #ifde
CONFIG_STA_SUPPORT


615 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

616 
	`BHdIn
(
pAd
, &
FmeB
,Ad->
MacTab
.
Cڋ
[
pBAEry
->
Wcid
].
Addr
,Ad->
CutAddss
);

619 
FmeB
.
SgSeq
.
fld
.
FgNum
 = 0;

620 
FmeB
.
SgSeq
.
fld
.
SSeq
 = 
pBAEry
->
Sequ
;

621 
FmeB
.
BCڌ
.
TID
 = 
pBAEry
->TID;

622 
	`MakeOutgogFme
(
pOutBufr2
, &
FmeL
,

623 (
FRAME_BAR
), &
FmeB
,

624 
END_OF_ARGS
);

625 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr2
, 
FmeL
);

626 
	`MlmeFeMemy
(
pAd
, 
pOutBufr2
);

629 i(
pBAEry
->
ORIBATim
.
TimVue
)

630 
	`RTMPSTim
(&
pBAEry
->
ORIBATim
,BAEry->ORIBATim.
TimVue
);

632 
	}
}

634 
BOOLEAN
 
	$BARecSessiAdd
(

635 
IN
 
PRTMP_ADAPTER
 
pAd
,

636 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

637 
IN
 
PFRAME_ADDBA_REQ
 
pFme
)

639 
BA_REC_ENTRY
 *
pBAEry
 = 
NULL
;

640 
BOOLEAN
 
Stus
 = 
TRUE
;

641 
BOOLEAN
 
Ced
;

642 
USHORT
 
Idx
;

643 
UCHAR
 
TID
;

644 
UCHAR
 
BAWSize
;

649 
	`ASSERT
(
pEry
);

652 
TID
 = 
pFme
->
BaPm
.TID;

654 
BAWSize
 = 
	`m
(((
UCHAR
)
pFme
->
BaPm
.
BufSize
), (UCHAR)
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
);

657 i(
BAWSize
 == 0)

659 
BAWSize
 = 64;

663 
Idx
 = 
pEry
->
BARecWcidAay
[
TID
];

666 i(
Idx
 == 0)

669 
pBAEry
 = 
	`BATabAocRecEry
(
pAd
, &
Idx
);

673 
pBAEry
 = &
pAd
->
BATab
.
BARecEry
[
Idx
];

675 
	`ba_esh_dg_mpdus
(
pAd
, 
pBAEry
);

678 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("%s(%ld): Idx = %d, BAWSizeeq %d%d\n", 
__FUNCTION__
, 
pAd
->
BATab
.
numAsRec
, 
Idx
,

679 
pFme
->
BaPm
.
BufSize
, 
BAWSize
));

682 i(
pBAEry
 !
NULL
)

684 
	`ASSERT
(
pBAEry
->
li
.
qn
 == 0);

686 
pBAEry
->
REC_BA_Stus
 = 
Rec_HdRes
;

687 
pBAEry
->
BAWSize
 = BAWinSize;

688 
pBAEry
->
Wcid
 = 
pEry
->
Aid
;

689 
pBAEry
->
TID
 = TID;

690 
pBAEry
->
TimeOutVue
 = 
pFme
->TimeOutValue;

691 
pBAEry
->
REC_BA_Stus
 = 
Rec_Ac
;

693 
pBAEry
->
LaIndSeq
 = 
RESET_RCV_SEQ
;

695 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("S Seq = %08x\n", 
pFme
->
BaSSeq
.
fld
.
SSeq
));

697 i(
pEry
->
RXBAbm
 & (1<<
TID
))

699 
	`RTMPClTim
(&
pBAEry
->
RECBATim
, &
Ced
);

703 
	`RTMPInTim
(
pAd
, &
pBAEry
->
RECBATim
, 
	`GET_TIMER_FUNCTION
(
BARecSessiIdTimeout
),BAEry, 
TRUE
);

708 
pEry
->
RXBAbm
 |(1<<
TID
);

709 
pEry
->
BARecWcidAay
[
TID
] = 
Idx
;

711 
pEry
->
BADeeBm
 &~(1<<
TID
);

714 
	`RTMP_ADD_BA_SESSION_TO_ASIC
(
pAd
, 
pEry
->
Aid
, 
TID
);

716 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("MACEntry[%d]RXBAbitmap = 0x%x. BARecWcidArray=%d\n",

717 
pEry
->
Aid
,Ery->
RXBAbm
,Ery->
BARecWcidAay
[
TID
]));

721 
Stus
 = 
FALSE
;

722 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Can't Accept ADDBA for %02x:%02x:%02x:%02x:%02x:%02x TID = %d\n",

723 
	`PRINT_MAC
(
pEry
->
Addr
), 
TID
));

725 (
Stus
);

726 
	}
}

729 
BA_REC_ENTRY
 *
	$BATabAocRecEry
(

730 
IN
 
PRTMP_ADAPTER
 
pAd
,

731 
OUT
 
USHORT
 *
Idx
)

733 
i
;

734 
BA_REC_ENTRY
 *
pBAEry
 = 
NULL
;

737 
	`NdisAcqueSpLock
(&
pAd
->
BATabLock
);

739 i(
pAd
->
BATab
.
numAsRec
 >(
MAX_LEN_OF_BA_REC_TABLE
 - 1))

741 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("BA Recipeint Session (%ld) > %d\n",

742 
pAd
->
BATab
.
numAsRec
, (
MAX_LEN_OF_BA_REC_TABLE
 - 1)));

743 
de
;

747 
i
=1; i < 
MAX_LEN_OF_BA_REC_TABLE
; i++)

749 
pBAEry
 =&
pAd
->
BATab
.
BARecEry
[
i
];

750 i((
pBAEry
->
REC_BA_Stus
 =
Rec_NONE
))

753 
pAd
->
BATab
.
numAsRec
++;

754 
pBAEry
->
REC_BA_Stus
 = 
Rec_USED
;

755 *
Idx
 = 
i
;

760 
de
:

761 
	`NdisRSpLock
(&
pAd
->
BATabLock
);

762  
pBAEry
;

763 
	}
}

765 
BA_ORI_ENTRY
 *
	$BATabAocOriEry
(

766 
IN
 
PRTMP_ADAPTER
 
pAd
,

767 
OUT
 
USHORT
 *
Idx
)

769 
i
;

770 
BA_ORI_ENTRY
 *
pBAEry
 = 
NULL
;

772 
	`NdisAcqueSpLock
(&
pAd
->
BATabLock
);

774 i(
pAd
->
BATab
.
numAsOrig
 >(
MAX_LEN_OF_BA_ORI_TABLE
 - 1))

776 
de
;

780 
i
=1; i<
MAX_LEN_OF_BA_ORI_TABLE
; i++)

782 
pBAEry
 =&
pAd
->
BATab
.
BAOriEry
[
i
];

783 i((
pBAEry
->
ORI_BA_Stus
 =
Orig_NONE
))

786 
pAd
->
BATab
.
numAsOrig
++;

787 
pBAEry
->
ORI_BA_Stus
 = 
Orig_USED
;

788 
pBAEry
->
pAdr
 = 
pAd
;

789 *
Idx
 = 
i
;

794 
de
:

795 
	`NdisRSpLock
(&
pAd
->
BATabLock
);

796  
pBAEry
;

797 
	}
}

800 
VOID
 
	$BATabFeOriEry
(

801 
IN
 
PRTMP_ADAPTER
 
pAd
,

802 
IN
 
ULONG
 
Idx
)

804 
BA_ORI_ENTRY
 *
pBAEry
 = 
NULL
;

805 
MAC_TABLE_ENTRY
 *
pEry
;

808 i((
Idx
 =0|| (Idx >
MAX_LEN_OF_BA_ORI_TABLE
))

811 
pBAEry
 =&
pAd
->
BATab
.
BAOriEry
[
Idx
];

813 i(
pBAEry
->
ORI_BA_Stus
 !
Orig_NONE
)

815 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
pBAEry
->
Wcid
];

816 
pEry
->
BAOriWcidAay
[
pBAEry
->
TID
] = 0;

819 
	`NdisAcqueSpLock
(&
pAd
->
BATabLock
);

820 i(
pBAEry
->
ORI_BA_Stus
 =
Orig_De
)

822 
pAd
->
BATab
.
numDeOrig
 -= 1;

823 
pEry
->
TXBAbm
 &(~(1<<(
pBAEry
->
TID
) ));

824 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BATabFeOriEryumAsOrig%ld\n", 
pAd
->
BATab
.
numAsRec
));

828 
	`ASSERT
(
pAd
->
BATab
.
numAsOrig
 != 0);

830 
pAd
->
BATab
.
numAsOrig
 -= 1;

832 
pBAEry
->
ORI_BA_Stus
 = 
Orig_NONE
;

833 
pBAEry
->
Tok
 = 0;

834 
	`NdisRSpLock
(&
pAd
->
BATabLock
);

836 
	}
}

839 
VOID
 
	$BATabFeRecEry
(

840 
IN
 
PRTMP_ADAPTER
 
pAd
,

841 
IN
 
ULONG
 
Idx
)

843 
BA_REC_ENTRY
 *
pBAEry
 = 
NULL
;

844 
MAC_TABLE_ENTRY
 *
pEry
;

847 i((
Idx
 =0|| (Idx >
MAX_LEN_OF_BA_REC_TABLE
))

850 
pBAEry
 =&
pAd
->
BATab
.
BARecEry
[
Idx
];

852 i(
pBAEry
->
REC_BA_Stus
 !
Rec_NONE
)

854 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
pBAEry
->
Wcid
];

855 
pEry
->
BARecWcidAay
[
pBAEry
->
TID
] = 0;

857 
	`NdisAcqueSpLock
(&
pAd
->
BATabLock
);

859 
	`ASSERT
(
pAd
->
BATab
.
numAsRec
 != 0);

861 
pAd
->
BATab
.
numAsRec
 -= 1;

863 
pBAEry
->
REC_BA_Stus
 = 
Rec_NONE
;

864 
	`NdisRSpLock
(&
pAd
->
BATabLock
);

866 
	}
}

869 
VOID
 
	$BAOriSessiTrDown
(

870 
IN
 
OUT
 
PRTMP_ADAPTER
 
pAd
,

871 
IN
 
UCHAR
 
Wcid
,

872 
IN
 
UCHAR
 
TID
,

873 
IN
 
BOOLEAN
 
bPassive
,

874 
IN
 
BOOLEAN
 
bFSd
)

876 
ULONG
 
Idx
 = 0;

877 
BA_ORI_ENTRY
 *
pBAEry
;

878 
BOOLEAN
 
Ced
;

880 i(
Wcid
 >
MAX_LEN_OF_MAC_TABLE
)

888 
Idx
 = 
pAd
->
MacTab
.
Cڋ
[
Wcid
].
BAOriWcidAay
[
TID
];

889 i((
Idx
 =0|| (Idx >
MAX_LEN_OF_BA_ORI_TABLE
))

891 i(
bFSd
 =
TRUE
)

894 
MLME_DELBA_REQ_STRUCT
 
DbaReq
;

895 
MLME_QUEUE_ELEM
 *
Em
 = (MLME_QUEUE_ELEM *
	`kmloc
((MLME_QUEUE_ELEM), 
MEM_ALLOC_FLAG
);

896 i(
Em
 !
NULL
)

898 
	`NdisZoMemy
(&
DbaReq
, (DelbaReq));

899 
	`NdisZoMemy
(
Em
, (
MLME_QUEUE_ELEM
));

901 
	`COPY_MAC_ADDR
(
DbaReq
.
Addr
, 
pAd
->
MacTab
.
Cڋ
[
Wcid
].Addr);

902 
DbaReq
.
Wcid
 = Wcid;

903 
DbaReq
.
TID
 = TID;

904 
DbaReq
.
Int
 = 
ORIGINATOR
;

905 
Em
->
MsgL
 = (
DbaReq
);

906 
	`NdisMoveMemy
(
Em
->
Msg
, &
DbaReq
, (DelbaReq));

907 
	`MlmeDELBAAi
(
pAd
, 
Em
);

908 
	`k
(
Em
);

912 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s(bFSd):lomemy faed!\n", 
__FUNCTION__
));

919 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("%s===>Wcid=%d.TID=%d \n", 
__FUNCTION__
, 
Wcid
, 
TID
));

921 
pBAEry
 = &
pAd
->
BATab
.
BAOriEry
[
Idx
];

922 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("\t===>Idx = %ld, Wcid=%d.TID=%d, ORI_BA_Stu%d \n", 
Idx
, 
Wcid
, 
TID
, 
pBAEry
->
ORI_BA_Stus
));

926 i((
bPassive
 =
FALSE
&& (
TID
 =
pBAEry
->TID&& (pBAEry->
ORI_BA_Stus
 =
Orig_De
))

928 
MLME_DELBA_REQ_STRUCT
 
DbaReq
;

929 
MLME_QUEUE_ELEM
 *
Em
 = (MLME_QUEUE_ELEM *
	`kmloc
((MLME_QUEUE_ELEM), 
MEM_ALLOC_FLAG
);

930 i(
Em
 !
NULL
)

932 
	`NdisZoMemy
(&
DbaReq
, (DelbaReq));

933 
	`NdisZoMemy
(
Em
, (
MLME_QUEUE_ELEM
));

935 
	`COPY_MAC_ADDR
(
DbaReq
.
Addr
, 
pAd
->
MacTab
.
Cڋ
[
Wcid
].Addr);

936 
DbaReq
.
Wcid
 = Wcid;

937 
DbaReq
.
TID
 = 
pBAEry
->TID;

938 
DbaReq
.
Int
 = 
ORIGINATOR
;

939 
Em
->
MsgL
 = (
DbaReq
);

940 
	`NdisMoveMemy
(
Em
->
Msg
, &
DbaReq
, (DelbaReq));

941 
	`MlmeDELBAAi
(
pAd
, 
Em
);

942 
	`k
(
Em
);

946 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s():lomemy faed!\n", 
__FUNCTION__
));

950 
	`RTMPClTim
(&
pBAEry
->
ORIBATim
, &
Ced
);

951 
	`BATabFeOriEry
(
pAd
, 
Idx
);

953 i(
bPassive
)

957 
	}
}

959 
VOID
 
	$BARecSessiTrDown
(

960 
IN
 
OUT
 
PRTMP_ADAPTER
 
pAd
,

961 
IN
 
UCHAR
 
Wcid
,

962 
IN
 
UCHAR
 
TID
,

963 
IN
 
BOOLEAN
 
bPassive
)

965 
ULONG
 
Idx
 = 0;

966 
BA_REC_ENTRY
 *
pBAEry
;

968 i(
Wcid
 >
MAX_LEN_OF_MAC_TABLE
)

976 
Idx
 = 
pAd
->
MacTab
.
Cڋ
[
Wcid
].
BARecWcidAay
[
TID
];

977 i(
Idx
 == 0)

980 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("%s===>Wcid=%d.TID=%d \n", 
__FUNCTION__
, 
Wcid
, 
TID
));

983 
pBAEry
 = &
pAd
->
BATab
.
BARecEry
[
Idx
];

984 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("\t===>Idx = %ld, Wcid=%d.TID=%d, REC_BA_Stu%d \n", 
Idx
, 
Wcid
, 
TID
, 
pBAEry
->
REC_BA_Stus
));

988 i((
TID
 =
pBAEry
->TID&& (pBAEry->
REC_BA_Stus
 =
Rec_Ac
))

990 
MLME_DELBA_REQ_STRUCT
 
DbaReq
;

991 
BOOLEAN
 
Ced
;

995 
	`RTMPClTim
(&
pBAEry
->
RECBATim
, &
Ced
);

1000 i(
bPassive
 =
FALSE
)

1002 
MLME_QUEUE_ELEM
 *
Em
 = (MLME_QUEUE_ELEM *
	`kmloc
((MLME_QUEUE_ELEM), 
MEM_ALLOC_FLAG
);

1003 i(
Em
 !
NULL
)

1005 
	`NdisZoMemy
(&
DbaReq
, (DelbaReq));

1006 
	`NdisZoMemy
(
Em
, (
MLME_QUEUE_ELEM
));

1008 
	`COPY_MAC_ADDR
(
DbaReq
.
Addr
, 
pAd
->
MacTab
.
Cڋ
[
Wcid
].Addr);

1009 
DbaReq
.
Wcid
 = Wcid;

1010 
DbaReq
.
TID
 = TID;

1011 
DbaReq
.
Int
 = 
RECIPIENT
;

1012 
Em
->
MsgL
 = (
DbaReq
);

1013 
	`NdisMoveMemy
(
Em
->
Msg
, &
DbaReq
, (DelbaReq));

1014 
	`MlmeDELBAAi
(
pAd
, 
Em
);

1015 
	`k
(
Em
);

1019 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s():lomemy faed!\n", 
__FUNCTION__
));

1029 
	`ba_esh_dg_mpdus
(
pAd
, 
pBAEry
);

1031 
	`NdisAcqueSpLock
(&
pAd
->
BATabLock
);

1034 
pBAEry
->
LaIndSeq
 = 
RESET_RCV_SEQ
;

1035 
pBAEry
->
BAWSize
 = 0;

1037 
pAd
->
MacTab
.
Cڋ
[
Wcid
].
RXBAbm
 &(~(1<<(
pBAEry
->
TID
)));

1038 
pAd
->
MacTab
.
Cڋ
[
Wcid
].
BARecWcidAay
[
TID
] = 0;

1040 
	`RTMP_DEL_BA_SESSION_FROM_ASIC
(
pAd
, 
Wcid
, 
TID
);

1042 
	`NdisRSpLock
(&
pAd
->
BATabLock
);

1046 
	`BATabFeRecEry
(
pAd
, 
Idx
);

1047 
	}
}

1049 
VOID
 
	$BASessiTrDownALL
(

1050 
IN
 
OUT
 
PRTMP_ADAPTER
 
pAd
,

1051 
IN
 
UCHAR
 
Wcid
)

1053 
i
;

1055 
i
=0; i<
NUM_OF_TID
; i++)

1057 
	`BAOriSessiTrDown
(
pAd
, 
Wcid
, 
i
, 
FALSE
, FALSE);

1058 
	`BARecSessiTrDown
(
pAd
, 
Wcid
, 
i
, 
FALSE
);

1060 
	}
}

1077 
VOID
 
	$BAOriSessiSupTimeout
(

1078 
IN
 
PVOID
 
SyemScific1
,

1079 
IN
 
PVOID
 
FuniCڋxt
,

1080 
IN
 
PVOID
 
SyemScific2
,

1081 
IN
 
PVOID
 
SyemScific3
)

1083 
BA_ORI_ENTRY
 *
pBAEry
 = (BA_ORI_ENTRY *)
FuniCڋxt
;

1084 
MAC_TABLE_ENTRY
 *
pEry
;

1085 
PRTMP_ADAPTER
 
pAd
;

1087 i(
pBAEry
 =
NULL
)

1090 
pAd
 = 
pBAEry
->
pAdr
;

1092 #ifde
CONFIG_STA_SUPPORT


1093 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1096 i(
	`MONITOR_ON
(
pAd
))

1101 #ifde
RALINK_ATE


1103 i(
	`ATE_ON
(
pAd
))

1107 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
pBAEry
->
Wcid
];

1109 i((
pBAEry
->
ORI_BA_Stus
 =
Orig_WaRes
&& (pBAEry->
Tok
 < 
ORI_SESSION_MAX_RETRY
))

1111 
MLME_ADDBA_REQ_STRUCT
 
AddbaReq
;

1113 #ifde
CONFIG_STA_SUPPORT


1114 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1116 i(
	`INFRA_ON
(
pAd
) &&

1117 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
) &&

1118 (
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
)))

1121 
	`RTMPSTim
(&
pBAEry
->
ORIBATim
, 
ORI_BA_SESSION_TIMEOUT
);

1127 
	`NdisZoMemy
(&
AddbaReq
, (AddbaReq));

1128 
	`COPY_MAC_ADDR
(
AddbaReq
.
pAddr
, 
pEry
->
Addr
);

1129 
AddbaReq
.
Wcid
 = (
UCHAR
)(
pEry
->
Aid
);

1130 
AddbaReq
.
TID
 = 
pBAEry
->TID;

1131 
AddbaReq
.
BaBufSize
 = 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
;

1132 
AddbaReq
.
TimeOutVue
 = 0;

1133 
AddbaReq
.
Tok
 = 
pBAEry
->Token;

1134 
	`MlmeEnqueue
(
pAd
, 
ACTION_STATE_MACHINE
, 
MT2_MLME_ADD_BA_CATE
, (
MLME_ADDBA_REQ_STRUCT
), (
PVOID
)&
AddbaReq
, 0);

1135 
	`RTMP_MLME_HANDLER
(
pAd
);

1136 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("BA OrSessi Timeout(%d: Sd ADD BAga\n", 
pBAEry
->
Tok
));

1138 
pBAEry
->
Tok
++;

1139 
	`RTMPSTim
(&
pBAEry
->
ORIBATim
, 
ORI_BA_SESSION_TIMEOUT
);

1143 
	`BATabFeOriEry
(
pAd
, 
pEry
->
BAOriWcidAay
[
pBAEry
->
TID
]);

1145 
	}
}

1161 
VOID
 
	$BARecSessiIdTimeout
(

1162 
IN
 
PVOID
 
SyemScific1
,

1163 
IN
 
PVOID
 
FuniCڋxt
,

1164 
IN
 
PVOID
 
SyemScific2
,

1165 
IN
 
PVOID
 
SyemScific3
)

1168 
BA_REC_ENTRY
 *
pBAEry
 = (BA_REC_ENTRY *)
FuniCڋxt
;

1169 
PRTMP_ADAPTER
 
pAd
;

1170 
ULONG
 
Now32
;

1172 i(
pBAEry
 =
NULL
)

1175 i((
pBAEry
->
REC_BA_Stus
 =
Rec_Ac
))

1177 
	`NdisGSyemUpTime
(&
Now32
);

1179 i(
	`RTMP_TIME_AFTER
(()
Now32
, ()(
pBAEry
->
LaIndSeqAtTim
 + 
REC_BA_SESSION_IDLE_TIMEOUT
)))

1181 
pAd
 = 
pBAEry
->
pAdr
;

1183 
	`ba_esh_dg_mpdus
(
pAd
, 
pBAEry
);

1184 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%ld: REC BA sessi Timeout\n", 
Now32
));

1187 
	}
}

1190 
VOID
 
	$PrAddBAReqAi
(

1191 
IN
 
PRTMP_ADAPTER
 
pAd
,

1192 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1197 
UCHAR
 
Stus
 = 1;

1198 
UCHAR
 
pAddr
[6];

1199 
FRAME_ADDBA_RSP
 
ADDame
;

1200 
PUCHAR
 
pOutBufr
 = 
NULL
;

1201 
NDIS_STATUS
 
NStus
;

1202 
PFRAME_ADDBA_REQ
 
pAddqFme
 = 
NULL
;

1204 
ULONG
 
FmeL
;

1205 
PULONG
 
emp
;

1206 
PMAC_TABLE_ENTRY
 
pMacEry
;

1208 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%==> (Wcid = %d)\n", 
__FUNCTION__
, 
Em
->
Wcid
));

1213 i(
Em
->
Wcid
 >
MAX_LEN_OF_MAC_TABLE
)

1216 
pMacEry
 = &
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
];

1217 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("BA - PeerAddBAReqAction----> \n"));

1218 
emp
 = (
PULONG
)
Em
->
Msg
;

1221 i(
	`PrAddBAReqAiSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
pAddr
))

1224 i((
pAd
->
CommCfg
.
bBADee
 =
FALSE
&& 
	`IS_HT_STA
(
pMacEry
))

1226 
pAddqFme
 = (
PFRAME_ADDBA_REQ
)(&
Em
->
Msg
[0]);

1227 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Rcv Wcid(%dAddBAReq\n", 
Em
->
Wcid
));

1228 i(
	`BARecSessiAdd
(
pAd
, &pAd->
MacTab
.
Cڋ
[
Em
->
Wcid
], 
pAddqFme
))

1229 
Stus
 = 0;

1231 
Stus
 = 38;

1235 
Stus
 = 37;

1239 i(
	`IS_ENTRY_CLIENT
(&
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
]))

1240 
	`ASSERT
(
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
].
S
 =
SST_ASSOC
);

1242 
pAddqFme
 = (
PFRAME_ADDBA_REQ
)(&
Em
->
Msg
[0]);

1244 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

1245 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

1247 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ACTION - PeerBAAction()llocate memory failed \n"));

1251 
	`NdisZoMemy
(&
ADDame
, (
FRAME_ADDBA_RSP
));

1253 #ifde
CONFIG_STA_SUPPORT


1254 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1256 i(
	`ADHOC_ON
(
pAd
)

1257 #ifde
QOS_DLS_SUPPORT


1258 || (
	`IS_ENTRY_DLS
(&
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
]))

1261 
	`AHdIn
(
pAd
, &
ADDame
.
Hdr
, 
pAddr
,Ad->
CutAddss
,Ad->
CommCfg
.
Bssid
);

1263 
	`AHdIn
(
pAd
, &
ADDame
.
Hdr
,Ad->
CommCfg
.
Bssid
,Ad->
CutAddss
, 
pAddr
);

1266 
ADDame
.
Cegy
 = 
CATEGORY_BA
;

1267 
ADDame
.
Ai
 = 
ADDBA_RESP
;

1268 
ADDame
.
Tok
 = 
pAddqFme
->Token;

1270 
ADDame
.
StusCode
 = 
Stus
;

1271 
ADDame
.
BaPm
.
BAPicy
 = 
IMMED_BA
;

1272 
ADDame
.
BaPm
.
AMSDUSu܋d
 = 0;

1273 
ADDame
.
BaPm
.
TID
 = 
pAddqFme
->BaParm.TID;

1274 
ADDame
.
BaPm
.
BufSize
 = 
	`m
(((
UCHAR
)
pAddqFme
->BaPm.BufSize), (UCHAR)
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
);

1275 i(
ADDame
.
BaPm
.
BufSize
 == 0)

1277 
ADDame
.
BaPm
.
BufSize
 = 64;

1279 
ADDame
.
TimeOutVue
 = 0;

1281 *(
USHORT
 *)(&
ADDame
.
BaPm

	`u216
(*(USHORT *)(&ADDframe.BaParm));

1282 
ADDame
.
StusCode
 = 
	`u216
(ADDframe.StatusCode);

1283 
ADDame
.
TimeOutVue
 = 
	`u216
(ADDframe.TimeOutValue);

1285 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1286 (
FRAME_ADDBA_RSP
), &
ADDame
,

1287 
END_OF_ARGS
);

1288 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

1289 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1291 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s(%d): TID(%d), BufSize(%d<=\n", 
__FUNCTION__
, 
Em
->
Wcid
, 
ADDame
.
BaPm
.
TID
,

1292 
ADDame
.
BaPm
.
BufSize
));

1293 
	}
}

1296 
VOID
 
	$PrAddBARAi
(

1297 
IN
 
PRTMP_ADAPTER
 
pAd
,

1298 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1303 
PFRAME_ADDBA_RSP
 
pFme
 = 
NULL
;

1307 i(
Em
->
Wcid
 >
MAX_LEN_OF_MAC_TABLE
)

1310 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%==> Wcid(%d)\n", 
__FUNCTION__
, 
Em
->
Wcid
));

1314 i(
	`PrAddBARAiSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
))

1316 
pFme
 = (
PFRAME_ADDBA_RSP
)(&
Em
->
Msg
[0]);

1318 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("\t\StusCod%d\n", 
pFme
->
StusCode
));

1319 
pFme
->
StusCode
)

1323 
	`BAOriSessiAdd
(
pAd
, &pAd->
MacTab
.
Cڋ
[
Em
->
Wcid
], 
pFme
);

1327 
	`BAOriSessiTrDown
(
pAd
, 
Em
->
Wcid
, 
pFme
->
BaPm
.
TID
, 
TRUE
, 
FALSE
);

1331 i((
pFme
->
StusCode
 == 37)

1332 #ifde
CONFIG_STA_SUPPORT


1333 || ((
pAd
->
OpMode
 =
OPMODE_STA
&& 
	`STA_TGN_WIFI_ON
Ad&& (
pFme
->
StusCode
 != 0))

1337 
pAd
->
MacTab
.
Cڋ
[
Em
->
Wcid
].
BADeeBm
 |1<<
pFme
->
BaPm
.
TID
;

1340 
	}
}

1342 
VOID
 
	$PrDBAAi
(

1343 
IN
 
PRTMP_ADAPTER
 
pAd
,

1344 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1349 
PFRAME_DELBA_REQ
 
pDFme
 = 
NULL
;

1351 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("%==>\n", 
__FUNCTION__
));

1353 i(
	`PrDBAAiSy
(
pAd
, 
Em
->
Wcid
, Em->
Msg
, Em->
MsgL
))

1355 
pDFme
 = (
PFRAME_DELBA_REQ
)(&
Em
->
Msg
[0]);

1356 i(
pDFme
->
DbaPm
.
Int
 =
ORIGINATOR
)

1358 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("BA - PeerDelBAAction----> ORIGINATOR\n"));

1359 
	`BARecSessiTrDown
(
pAd
, 
Em
->
Wcid
, 
pDFme
->
DbaPm
.
TID
, 
TRUE
);

1363 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("BA - PrDBAAi----> RECIPIENT, Rs = %d\n", 
pDFme
->
RsCode
));

1365 
	`BAOriSessiTrDown
(
pAd
, 
Em
->
Wcid
, 
pDFme
->
DbaPm
.
TID
, 
TRUE
, 
FALSE
);

1368 
	}
}

1371 
BOOLEAN
 
	$ClEnqueueFRecv
(

1372 
IN
 
PRTMP_ADAPTER
 
pAd
,

1373 
IN
 
ULONG
 
Wcid
,

1374 
IN
 
ULONG
 
MsgL
,

1375 
IN
 
PFRAME_BA_REQ
 
pMsg
)

1377 
PFRAME_BA_REQ
 
pFme
 = 
pMsg
;

1380 
PBA_REC_ENTRY
 
pBAEry
;

1382 
ULONG
 
Idx
;

1384 
UCHAR
 
TID
;

1386 
TID
 = (
UCHAR
)
pFme
->
BARCڌ
.TID;

1388 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s(): BAR-Wcid(%ld), Tid (%d)\n", 
__FUNCTION__
, 
Wcid
, 
TID
));

1392 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

1393  
FALSE
;

1396 i(
MsgL
 > 
MGMT_DMA_BUFFER_SIZE
)

1398 
	`DBGPRINT_ERR
(("ClEnqueueFRecv: fmtorge, siz%ld \n", 
MsgL
));

1399  
FALSE
;

1401 i(
MsgL
 !(
FRAME_BA_REQ
))

1403 
	`DBGPRINT_ERR
(("ClEnqueueFRecv: BlockAck Reque fmngth siz%ld incܻ\n", 
MsgL
));

1404  
FALSE
;

1406 i(
MsgL
 !(
FRAME_BA_REQ
))

1408 
	`DBGPRINT_ERR
(("ClEnqueueFRecv: BlockAck Reque fmngth siz%ld incܻ\n", 
MsgL
));

1409  
FALSE
;

1412 i((
Wcid
 < 
MAX_LEN_OF_MAC_TABLE
&& (
TID
 < 8))

1415 
Idx
 = 
pAd
->
MacTab
.
Cڋ
[
Wcid
].
BARecWcidAay
[
TID
];

1416 
pBAEry
 = &
pAd
->
BATab
.
BARecEry
[
Idx
];

1420  
FALSE
;

1423 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BAR(%ld: Tid (%d- %04x:%04x\n", 
Wcid
, 
TID
, 
pFme
->
BASgSeq
.
fld
.
SSeq
, 
pBAEry
->
LaIndSeq
 ));

1425 i(
	`SEQ_SMALLER
(
pBAEry
->
LaIndSeq
, 
pFme
->
BASgSeq
.
fld
.
SSeq
, 
MAXSEQ
))

1428 
	`ba_di_dg_mpdus__q
(
pAd
, 
pBAEry
, 
pFme
->
BASgSeq
.
fld
.
SSeq
);

1429 
pBAEry
->
LaIndSeq
 = (
pFme
->
BASgSeq
.
fld
.
SSeq
 =0? 
MAXSEQ
 :(pFrame->BAStartingSeq.field.StartSeq -1);

1432  
TRUE
;

1433 
	}
}

1438 
VOID
 
	$SdPSMPAi
(

1439 
IN
 
PRTMP_ADAPTER
 
pAd
,

1440 
IN
 
UCHAR
 
Wcid
,

1441 
IN
 
UCHAR
 
Psmp
)

1443 
PUCHAR
 
pOutBufr
 = 
NULL
;

1444 
NDIS_STATUS
 
NStus
;

1446 
FRAME_PSMP_ACTION
 
Fme
;

1447 
ULONG
 
FmeL
;

1449 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

1450 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

1452 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("BA - MlmeADDBAAction()llocate memory failed \n"));

1455 #ifde
CONFIG_STA_SUPPORT


1456 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1457 
	`AHdIn
(
pAd
, &
Fme
.
Hdr
,Ad->
CommCfg
.
Bssid
,Ad->
CutAddss
,Ad->
MacTab
.
Cڋ
[
Wcid
].
Addr
);

1460 
Fme
.
Cegy
 = 
CATEGORY_HT
;

1461 
Fme
.
Ai
 = 
SMPS_ACTION
;

1462 
Psmp
)

1464 
MMPS_ENABLE
:

1465 
Fme
.
Psmp
 = 0;

1467 
MMPS_DYNAMIC
:

1468 
Fme
.
Psmp
 = 3;

1470 
MMPS_STATIC
:

1471 
Fme
.
Psmp
 = 1;

1474 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1475 (
FRAME_PSMP_ACTION
), &
Fme
,

1476 
END_OF_ARGS
);

1477 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

1478 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1479 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("HT - SdPSMPAi%d ) \n", 
Fme
.
Psmp
));

1480 
	}
}

1483 
	#RADIO_MEASUREMENT_REQUEST_ACTION
 0

	)

1485 
	sGNU_PACKED


1487 
UCHAR
 
	mRegutyCss
;

1488 
UCHAR
 
	mChlNumb
;

1489 
USHORT
 
	mRdomIv
;

1490 
USHORT
 
	mMsumtDuti
;

1491 
UCHAR
 
	mMsumtMode
;

1492 
UCHAR
 
	mBSSID
[
MAC_ADDR_LEN
];

1493 
UCHAR
 
	mRtgCdi
;

1494 
UCHAR
 
	mThshd
;

1495 
UCHAR
 
	mSSIDIE
[2];

1496 } 
	tBEACON_REQUEST
;

1498 
	sGNU_PACKED


1500 
UCHAR
 
	mID
;

1501 
UCHAR
 
	mLgth
;

1502 
UCHAR
 
	mTok
;

1503 
UCHAR
 
	mRequeMode
;

1504 
UCHAR
 
	mTy
;

1505 } 
	tMEASUREMENT_REQ
;

1510 
	$cvt_dg_ck_to_eAMSDU__802_3_ck
(

1511 
IN
 
PRTMP_ADAPTER
 
pAd
,

1512 
IN
 
RX_BLK
 *
pRxBlk
,

1513 
IN
 
UCHAR
 
FromWhichBSSID
)

1515 
PNDIS_PACKET
 
pRxPkt
;

1516 
UCHAR
 
Hd802_3
[
LENGTH_802_3
];

1523 #ifde
CONFIG_STA_SUPPORT


1524 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1525 
	`RTMP_802_11_REMOVE_LLC_AND_CONVERT_TO_802_3
(
pRxBlk
, 
Hd802_3
);

1528 
	`ASSERT
(
pRxBlk
->
pRxPack
);

1529 
pRxPkt
 = 
	`RTPKT_TO_OSPKT
(
pRxBlk
->
pRxPack
);

1531 
	`SET_OS_PKT_NETDEV
(
pRxPkt
, 
	`g_tdev_om_bssid
(
pAd
, 
FromWhichBSSID
));

1532 
	`SET_OS_PKT_DATAPTR
(
pRxPkt
, 
pRxBlk
->
pDa
);

1533 
	`SET_OS_PKT_LEN
(
pRxPkt
, 
pRxBlk
->
DaSize
);

1534 
	`SET_OS_PKT_DATATAIL
(
pRxPkt
, 
pRxBlk
->
pDa
,RxBlk->
DaSize
);

1539 i(!
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_AMSDU
))

1542 #ifde
CONFIG_STA_SUPPORT


1543 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1545 #ifde
LINUX


1546 
	`NdisMoveMemy
(
	`skb_push
(
pRxPkt
, 
LENGTH_802_3
), 
Hd802_3
, LENGTH_802_3);

1551 
	}
}

1554 
	#INDICATE_LEGACY_OR_AMSDU
(
_pAd
, 
_pRxBlk
, 
_omWhichBSSID
) \

1557 i(
	`RX_BLK_TEST_FLAG
(
_pRxBlk
, 
fRX_AMSDU
)) \

1559 
	`Indi_AMSDU_Pack
(
_pAd
, 
_pRxBlk
, 
_omWhichBSSID
); \

1561 i(
	`RX_BLK_TEST_FLAG
(
_pRxBlk
, 
fRX_EAP
)) \

1563 
	`Indi_EAPOL_Pack
(
_pAd
, 
_pRxBlk
, 
_omWhichBSSID
); \

1567 
	`Indi_Legacy_Pack
(
_pAd
, 
_pRxBlk
, 
_omWhichBSSID
); \

1569 } 0);

	)

1573 
VOID
 
	$ba_queue_dg_ck
(

1574 
IN
 
PRTMP_ADAPTER
 
pAd
,

1575 
IN
 
PBA_REC_ENTRY
 
pBAEry
,

1576 
IN
 
RX_BLK
 *
pRxBlk
,

1577 
IN
 
UCHAR
 
FromWhichBSSID
)

1579 
dg_mpdu
 *
mpdu_blk
;

1580 
UINT16
 
Sequ
 = (UINT16
pRxBlk
->
pHd
->Sequence;

1582 
mpdu_blk
 = 
	`ba_mpdu_blk_loc
(
pAd
);

1583 i((
mpdu_blk
 !
NULL
) &&

1584 (!
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_EAP
)))

1587 
	`NdisAcqueSpLock
(&
pBAEry
->
RxReRgLock
);

1589 
mpdu_blk
->
Sequ
 = Sequence;

1591 
mpdu_blk
->
bAMSDU
 = 
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_AMSDU
);

1593 
	`cvt_dg_ck_to_eAMSDU__802_3_ck
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

1595 
	`STATS_INC_RX_PACKETS
(
pAd
, 
FromWhichBSSID
);

1601 
	`RTMP_SET_PACKET_IF
(
pRxBlk
->
pRxPack
, 
FromWhichBSSID
);

1603 
mpdu_blk
->
pPack
 = 
pRxBlk
->
pRxPack
;

1605 i(
	`ba_dg_mpdu_s܋d
(&
pBAEry
->
li
, 
mpdu_blk
=
FALSE
)

1609 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_SUCCESS
);

1610 
	`ba_mpdu_blk_
(
pAd
, 
mpdu_blk
);

1613 
	`ASSERT
((0<
pBAEry
->
li
.
qn
&& (pBAEry->li.q<pBAEry->
BAWSize
));

1614 
	`NdisRSpLock
(&
pBAEry
->
RxReRgLock
);

1618 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!! (%d) Can'tllocateeordering mpdu blk\n",

1619 
pBAEry
->
li
.
qn
));

1626 
	`ba_di_dg_mpdus__q
(
pAd
, 
pBAEry
, 
Sequ
);

1628 
pBAEry
->
LaIndSeq
 = 
Sequ
;

1629 
	`INDICATE_LEGACY_OR_AMSDU
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

1631 
	}
}

1652 
VOID
 
	$Indi_AMPDU_Pack
(

1653 
IN
 
PRTMP_ADAPTER
 
pAd
,

1654 
IN
 
RX_BLK
 *
pRxBlk
,

1655 
IN
 
UCHAR
 
FromWhichBSSID
)

1657 
USHORT
 
Idx
;

1658 
PBA_REC_ENTRY
 
pBAEry
 = 
NULL
;

1659 
UINT16
 
Sequ
 = 
pRxBlk
->
pHd
->Sequence;

1660 
ULONG
 
Now32
;

1661 
UCHAR
 
Wcid
 = 
pRxBlk
->
pRxWI
->
WessCliID
;

1662 
UCHAR
 
TID
 = 
pRxBlk
->
pRxWI
->TID;

1665 i(!
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_AMSDU
&& (pRxBlk->
DaSize
 > 
MAX_RX_PKT_LEN
))

1667 
r_size
;

1669 
r_size
++;

1670 i(
r_size
 > 20) {

1671 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AMPDU DaSiz%d\n", 
pRxBlk
->
DaSize
));

1672 
	`hex_dump
("802.11 Hd", (
UCHAR
 *)
pRxBlk
->
pHd
, 24);

1673 
	`hex_dump
("Payld", 
pRxBlk
->
pDa
, 64);

1674 
r_size
 = 0;

1678 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

1684 i(
Wcid
 < 
MAX_LEN_OF_MAC_TABLE
)

1686 
Idx
 = 
pAd
->
MacTab
.
Cڋ
[
Wcid
].
BARecWcidAay
[
TID
];

1687 i(
Idx
 == 0)

1690 
	`INDICATE_LEGACY_OR_AMSDU
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

1693 
pBAEry
 = &
pAd
->
BATab
.
BARecEry
[
Idx
];

1698 
	`ASSERT
(0);

1700 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

1704 
	`ASSERT
(
pBAEry
);

1707 
	`NdisGSyemUpTime
(&
Now32
);

1709 
pBAEry
->
rcvSeq
 = 
Sequ
;

1712 
	`ba_ush_dg_timeout_mpdus
(
pAd
, 
pBAEry
, 
Now32
);

1713 
pBAEry
->
LaIndSeqAtTim
 = 
Now32
;

1718 i(
pBAEry
->
LaIndSeq
 =
RESET_RCV_SEQ
)

1720 
	`ASSERT
((
pBAEry
->
li
.
qn
 =0&& (pBAEry->li.
xt
 =
NULL
));

1723 
pBAEry
->
LaIndSeq
 = 
Sequ
;

1724 
pBAEry
->
LaIndSeqAtTim
 = 
Now32
;

1725 
	`INDICATE_LEGACY_OR_AMSDU
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

1732 i(
	`SEQ_STEPONE
(
Sequ
, 
pBAEry
->
LaIndSeq
, 
MAXSEQ
))

1734 
USHORT
 
LaIndSeq
;

1736 
pBAEry
->
LaIndSeq
 = 
Sequ
;

1737 
	`INDICATE_LEGACY_OR_AMSDU
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

1738 
LaIndSeq
 = 
	`ba_di_dg_mpdus__d
(
pAd
, 
pBAEry
,BAEntry->LastIndSeq);

1739 i(
LaIndSeq
 !
RESET_RCV_SEQ
)

1741 
pBAEry
->
LaIndSeq
 = LastIndSeq;

1743 
pBAEry
->
LaIndSeqAtTim
 = 
Now32
;

1748 i(
Sequ
 =
pBAEry
->
LaIndSeq
)

1752 
pBAEry
->
nDrPack
++;

1753 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

1758 i(
	`SEQ_SMALLER
(
Sequ
, 
pBAEry
->
LaIndSeq
, 
MAXSEQ
))

1762 
pBAEry
->
nDrPack
++;

1763 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

1768 i(
	`SEQ_SMALLER
(
Sequ
, (((
pBAEry
->
LaIndSeq
+pBAEry->
BAWSize
+1)& 
MAXSEQ
), MAXSEQ))

1770 
	`ba_queue_dg_ck
(
pAd
, 
pBAEry
, 
pRxBlk
, 
FromWhichBSSID
);

1777 
LONG
 
WSSeq
, 
TmpSeq
;

1780 
TmpSeq
 = 
Sequ
 - (
pBAEry
->
BAWSize
) -1;

1781 i(
TmpSeq
 < 0)

1783 
TmpSeq
 = (
MAXSEQ
+1) + TmpSeq;

1785 
WSSeq
 = (
TmpSeq
+1& 
MAXSEQ
;

1786 
	`ba_di_dg_mpdus__q
(
pAd
, 
pBAEry
, 
WSSeq
);

1787 
pBAEry
->
LaIndSeq
 = 
WSSeq
;

1789 
pBAEry
->
LaIndSeqAtTim
 = 
Now32
;

1791 
	`ba_queue_dg_ck
(
pAd
, 
pBAEry
, 
pRxBlk
, 
FromWhichBSSID
);

1793 
TmpSeq
 = 
	`ba_di_dg_mpdus__d
(
pAd
, 
pBAEry
,BAEry->
LaIndSeq
);

1794 i(
TmpSeq
 !
RESET_RCV_SEQ
)

1796 
pBAEry
->
LaIndSeq
 = 
TmpSeq
;

1799 
	}
}

	@common/client_wds.c

34 #ifde
CLIENT_WDS


36 
	~"_cfig.h
"

38 
VOID
 
	$CliWds_ProxyTabIn
(

39 
IN
 
PRTMP_ADAPTER
 
pAd
)

41 
INT
 
idx
;

42 
ULONG
 
i
;

44 
	`NdisAoSpLock
(&
pAd
->
ApCfg
.
CliWdsTabLock
);

46 
pAd
->
ApCfg
.
pCliWdsEryPo
 = 
	`kmloc
((
CLIWDS_PROXY_ENTRY
* 
CLIWDS_POOL_SIZE
, 
GFP_ATOMIC
);

47 i(
pAd
->
ApCfg
.
pCliWdsEryPo
)

49 
	`NdisZoMemy
(
pAd
->
ApCfg
.
pCliWdsEryPo
, (
CLIWDS_PROXY_ENTRY
* 
CLIWDS_POOL_SIZE
);

50 
	`Li
(&
pAd
->
ApCfg
.
CliWdsEryFeLi
);

51 
i
 = 0; i < 
CLIWDS_POOL_SIZE
; i++)

52 
	`TaLi
(&
pAd
->
ApCfg
.
CliWdsEryFeLi
, (
PLIST_ENTRY
)Ad->ApCfg.
pCliWdsEryPo
 + (
ULONG
)
i
));

56 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%Faخlomemy f܅Ad->CommCfg.pCliWdsEryPo", 
__FUNCTION__
));

59 
idx
 = 0; idx < 
CLIWDS_HASH_TAB_SIZE
; idx++)

60 
	`Li
(&
pAd
->
ApCfg
.
CliWdsProxyTab
[
idx
]);

63 
	}
}

66 
VOID
 
	$CliWds_ProxyTabDey
(

67 
IN
 
PRTMP_ADAPTER
 
pAd
)

69 
INT
 
idx
;

70 
PCLIWDS_PROXY_ENTRY
 
pCliWdsEry
;

72 
	`NdisFeSpLock
(&
pAd
->
ApCfg
.
CliWdsTabLock
);

74 
idx
 = 0; idx < 
CLIWDS_HASH_TAB_SIZE
; idx++)

76 
pCliWdsEry
 =

77 (
PCLIWDS_PROXY_ENTRY
)
pAd
->
ApCfg
.
CliWdsProxyTab
[
idx
].
pHd
;

78 
pCliWdsEry
)

80 
PCLIWDS_PROXY_ENTRY
 
pCliWdsEryNext
 = 
pCliWdsEry
->
pNext
;

81 
	`CliWdsEyFe
(
pAd
, 
pCliWdsEry
);

82 
pCliWdsEry
 = 
pCliWdsEryNext
;

86 i(
pAd
->
ApCfg
.
pCliWdsEryPo
)

87 
	`k
(
pAd
->
ApCfg
.
pCliWdsEryPo
);

88 
pAd
->
ApCfg
.
pCliWdsEryPo
 = 
NULL
;

91 
	}
}

94 
PCLIWDS_PROXY_ENTRY
 
	$CliWdsEyAoc
(

95 
IN
 
PRTMP_ADAPTER
 
pAd
)

97 
PCLIWDS_PROXY_ENTRY
 
pCliWdsEry
;

99 
	`RTMP_SEM_LOCK
(&
pAd
->
ApCfg
.
CliWdsTabLock
);

101 
pCliWdsEry
 = (
PCLIWDS_PROXY_ENTRY
)
	`moveHdLi
(&
pAd
->
ApCfg
.
CliWdsEryFeLi
);

103 
	`RTMP_SEM_UNLOCK
(&
pAd
->
ApCfg
.
CliWdsTabLock
);

105  
pCliWdsEry
;

106 
	}
}

109 
VOID
 
	$CliWdsEyFe
(

110 
IN
 
PRTMP_ADAPTER
 
pAd
,

111 
IN
 
PCLIWDS_PROXY_ENTRY
 
pCliWdsEry
)

113 
	`RTMP_SEM_LOCK
(&
pAd
->
ApCfg
.
CliWdsTabLock
);

115 
	`TaLi
(&
pAd
->
ApCfg
.
CliWdsEryFeLi
, (
PLIST_ENTRY
)
pCliWdsEry
);

117 
	`RTMP_SEM_UNLOCK
(&
pAd
->
ApCfg
.
CliWdsTabLock
);

120 
	}
}

123 
PUCHAR
 
	$CliWds_ProxyLookup
(

124 
IN
 
PRTMP_ADAPTER
 
pAd
,

125 
IN
 
PUCHAR
 
pMac
)

127 
UINT8
 
HashId
 = (*(
pMac
 + 5& (
CLIWDS_HASH_TAB_SIZE
 - 1));

128 
PCLIWDS_PROXY_ENTRY
 
pCliWdsEry
;

130 
pCliWdsEry
 =

131 (
PCLIWDS_PROXY_ENTRY
)
pAd
->
ApCfg
.
CliWdsProxyTab
[
HashId
].
pHd
;

132 
pCliWdsEry
)

134 i(
	`MAC_ADDR_EQUAL
(
pMac
, 
pCliWdsEry
->
Addr
))

136 
ULONG
 
Now
;

137 
	`NdisGSyemUpTime
(&
Now
);

139 
pCliWdsEry
->
LaRefTime
 = 
Now
;

140 i(
	`VALID_WCID
(
pCliWdsEry
->
Aid
))

141  
pAd
->
MacTab
.
Cڋ
[
pCliWdsEry
->
Aid
].
Addr
;

143  
NULL
;

145 
pCliWdsEry
 =CliWdsEry->
pNext
;

147  
NULL
;

148 
	}
}

151 
VOID
 
	$CliWds_ProxyTabUpde
(

152 
IN
 
PRTMP_ADAPTER
 
pAd
,

153 
IN
 
SHORT
 
Aid
,

154 
IN
 
PUCHAR
 
pMac
)

156 
UINT8
 
HashId
 = (*(
pMac
 + 5& (
CLIWDS_HASH_TAB_SIZE
 - 1));

157 
PCLIWDS_PROXY_ENTRY
 
pCliWdsEry
;

159 i(
	`CliWds_ProxyLookup
(
pAd
, 
pMac
!
NULL
)

162 
pCliWdsEry
 = 
	`CliWdsEyAoc
(
pAd
);

163 i(
pCliWdsEry
)

165 
ULONG
 
Now
;

166 
	`NdisGSyemUpTime
(&
Now
);

168 
pCliWdsEry
->
Aid
 = Aid;

169 
	`COPY_MAC_ADDR
(&
pCliWdsEry
->
Addr
, 
pMac
);

170 
pCliWdsEry
->
LaRefTime
 = 
Now
;

171 
pCliWdsEry
->
pNext
 = 
NULL
;

172 
	`TaLi
(&
pAd
->
ApCfg
.
CliWdsProxyTab
[
HashId
], (
PLIST_ENTRY
)
pCliWdsEry
);

175 
	}
}

178 
VOID
 
	$CliWds_ProxyTabMa
(

179 
IN
 
PRTMP_ADAPTER
 
pAd
)

181 
ULONG
 
idx
;

182 
PCLIWDS_PROXY_ENTRY
 
pCliWdsEry
;

183 
ULONG
 
Now
;

185 
	`NdisGSyemUpTime
(&
Now
);

186 
idx
 = 0; idx < 
CLIWDS_HASH_TAB_SIZE
; idx++)

188 
pCliWdsEry
 = (
PCLIWDS_PROXY_ENTRY
)(
pAd
->
ApCfg
.
CliWdsProxyTab
[
idx
].
pHd
);

189 
pCliWdsEry
)

191 
PCLIWDS_PROXY_ENTRY
 
pCliWdsEryNext
 = 
pCliWdsEry
->
pNext
;

192 i(
	`RTMP_TIME_AFTER
(
Now
, 
pCliWdsEry
->
LaRefTime
 + (
CLI_WDS_ENTRY_AGEOUT
 * 
OS_HZ
 / 1000)))

194 
	`dEryLi
(&
pAd
->
ApCfg
.
CliWdsProxyTab
[
idx
], (
PLIST_ENTRY
)
pCliWdsEry
);

195 
	`CliWdsEyFe
(
pAd
, 
pCliWdsEry
);

197 
pCliWdsEry
 = 
pCliWdsEryNext
;

201 
	}
}

	@common/cmm_aes.c

38 
	~"_cfig.h
"

46 
UCHAR
 
	gSboxTab
[256] =

82 
VOID
 
	$x_32
(

83 
IN
 
PUCHAR
 
a
,

84 
IN
 
PUCHAR
 
b
,

85 
OUT
 
PUCHAR
 
out
)

87 
INT
 
i
;

89 
i
=0;i<4; i++)

91 
out
[
i
] = 
a
[i] ^ 
b
[i];

93 
	}
}

95 
VOID
 
	$x_128
(

96 
IN
 
PUCHAR
 
a
,

97 
IN
 
PUCHAR
 
b
,

98 
OUT
 
PUCHAR
 
out
)

100 
INT
 
i
;

102 
i
=0;i<16; i++)

104 
out
[
i
] = 
a
[i] ^ 
b
[i];

106 
	}
}

108 
UCHAR
 
	$RTMPCkSbox
(

109 
IN
 
UCHAR
 
a
)

111  
SboxTab
[()
a
];

112 
	}
}

114 
VOID
 
	$xt_key
(

115 
IN
 
PUCHAR
 
key
,

116 
IN
 
INT
 
round
)

118 
UCHAR
 
rc
;

119 
UCHAR
 
sbox_key
[4];

120 
UCHAR
 
rc_b
[12] =

126 
sbox_key
[0] = 
	`RTMPCkSbox
(
key
[13]);

127 
sbox_key
[1] = 
	`RTMPCkSbox
(
key
[14]);

128 
sbox_key
[2] = 
	`RTMPCkSbox
(
key
[15]);

129 
sbox_key
[3] = 
	`RTMPCkSbox
(
key
[12]);

131 
rc
 = 
rc_b
[
round
];

133 
	`x_32
(&
key
[0], 
sbox_key
, &key[0]);

134 
key
[0] = key[0] ^ 
rc
;

136 
	`x_32
(&
key
[4], &key[0], &key[4]);

137 
	`x_32
(&
key
[8], &key[4], &key[8]);

138 
	`x_32
(&
key
[12], &key[8], &key[12]);

139 
	}
}

141 
VOID
 
	$by_sub
(

142 
IN
 
PUCHAR
 

,

143 
OUT
 
PUCHAR
 
out
)

145 
INT
 
i
;

147 
i
=0; i< 16; i++)

149 
out
[
i
] = 
	`RTMPCkSbox
(

[i]);

151 
	}
}

158 
	$bwi_x
(*
a
, *
b
, *
out
)

160 
i
;

161 
i
=0; i<16; i++)

163 
out
[
i
] = 
a
[i] ^ 
b
[i];

165 
	}
}

167 
VOID
 
	$shi_row
(

168 
IN
 
PUCHAR
 

,

169 
OUT
 
PUCHAR
 
out
)

171 
out
[0] = 

[0];

172 
out
[1] = 

[5];

173 
out
[2] = 

[10];

174 
out
[3] = 

[15];

175 
out
[4] = 

[4];

176 
out
[5] = 

[9];

177 
out
[6] = 

[14];

178 
out
[7] = 

[3];

179 
out
[8] = 

[8];

180 
out
[9] = 

[13];

181 
out
[10] = 

[2];

182 
out
[11] = 

[7];

183 
out
[12] = 

[12];

184 
out
[13] = 

[1];

185 
out
[14] = 

[6];

186 
out
[15] = 

[11];

187 
	}
}

189 
VOID
 
	$mix_cumn
(

190 
IN
 
PUCHAR
 

,

191 
OUT
 
PUCHAR
 
out
)

193 
INT
 
i
;

194 
UCHAR
 
add1b
[4];

195 
UCHAR
 
add1bf7
[4];

196 
UCHAR
 
rl
[4];

197 
UCHAR
 
sw_hfs
[4];

198 
UCHAR
 
df7
[4];

199 
UCHAR
 
rr
[4];

200 
UCHAR
 
mp
[4];

201 
UCHAR
 
mpb
[4];

203 
i
=0 ; i<4; i++)

205 i((

[
i
] & 0x80)== 0x80)

206 
add1b
[
i
] = 0x1b;

208 
add1b
[
i
] = 0x00;

211 
sw_hfs
[0] = 

[2];

212 
sw_hfs
[1] = 

[3];

213 
sw_hfs
[2] = 

[0];

214 
sw_hfs
[3] = 

[1];

216 
rl
[0] = 

[3];

217 
rl
[1] = 

[0];

218 
rl
[2] = 

[1];

219 
rl
[3] = 

[2];

221 
df7
[0] = 

[0] & 0x7f;

222 
df7
[1] = 

[1] & 0x7f;

223 
df7
[2] = 

[2] & 0x7f;

224 
df7
[3] = 

[3] & 0x7f;

226 
i
 = 3; i>0; i--)

228 
df7
[
i
] =ndf7[i] << 1;

229 i((
df7
[
i
-1] & 0x80) == 0x80)

231 
df7
[
i
] = (andf7[i] | 0x01);

234 
df7
[0] =ndf7[0] << 1;

235 
df7
[0] =ndf7[0] & 0xfe;

237 
	`x_32
(
add1b
, 
df7
, 
add1bf7
);

239 
	`x_32
(

, 
add1bf7
, 
rr
);

241 
mp
[0] = 
rr
[0];

242 
rr
[0] =otr[1];

243 
rr
[1] =otr[2];

244 
rr
[2] =otr[3];

245 
rr
[3] = 
mp
[0];

247 
	`x_32
(
add1bf7
, 
rr
, 
mp
);

248 
	`x_32
(
sw_hfs
, 
rl
,
mpb
);

249 
	`x_32
(
mp
, 
mpb
, 
out
);

250 
	}
}

259 
	$cڡru_mic_hd1
(

260 *
mic_hd1
,

261 
hd_ngth
,

262 *
mpdu
)

264 
mic_hd1
[0] = ()((
hd_ngth
 - 2) / 256);

265 
mic_hd1
[1] = ()((
hd_ngth
 - 2) % 256);

266 
mic_hd1
[2] = 
mpdu
[0] & 0xcf;

267 
mic_hd1
[3] = 
mpdu
[1] & 0xc7;

268 
mic_hd1
[4] = 
mpdu
[4];

269 
mic_hd1
[5] = 
mpdu
[5];

270 
mic_hd1
[6] = 
mpdu
[6];

271 
mic_hd1
[7] = 
mpdu
[7];

272 
mic_hd1
[8] = 
mpdu
[8];

273 
mic_hd1
[9] = 
mpdu
[9];

274 
mic_hd1
[10] = 
mpdu
[10];

275 
mic_hd1
[11] = 
mpdu
[11];

276 
mic_hd1
[12] = 
mpdu
[12];

277 
mic_hd1
[13] = 
mpdu
[13];

278 
mic_hd1
[14] = 
mpdu
[14];

279 
mic_hd1
[15] = 
mpdu
[15];

280 
	}
}

288 
	$cڡru_mic_hd2
(

289 *
mic_hd2
,

290 *
mpdu
,

291 
a4_exis
,

292 
qc_exis
)

294 
i
;

296 
i
 = 0; i<16; i++
mic_hd2
[i]=0x00;

298 
mic_hd2
[0] = 
mpdu
[16];

299 
mic_hd2
[1] = 
mpdu
[17];

300 
mic_hd2
[2] = 
mpdu
[18];

301 
mic_hd2
[3] = 
mpdu
[19];

302 
mic_hd2
[4] = 
mpdu
[20];

303 
mic_hd2
[5] = 
mpdu
[21];

306 
mic_hd2
[6] = 
mpdu
[22] & 0x0f;

307 
mic_hd2
[7] = 0x00;

309 i((!
qc_exis
& 
a4_exis
)

311 
i
=0;i<6;i++
mic_hd2
[8+i] = 
mpdu
[24+i];

315 i(
qc_exis
 && (!
a4_exis
))

317 
mic_hd2
[8] = 
mpdu
[24] & 0x0f;

318 
mic_hd2
[9] = 
mpdu
[25] & 0x00;

321 i(
qc_exis
 && 
a4_exis
)

323 
i
=0;i<6;i++
mic_hd2
[8+i] = 
mpdu
[24+i];

325 
mic_hd2
[14] = 
mpdu
[30] & 0x0f;

326 
mic_hd2
[15] = 
mpdu
[31] & 0x00;

328 
	}
}

336 
	$cڡru_mic_iv
(

337 *
mic_iv
,

338 
qc_exis
,

339 
a4_exis
,

340 *
mpdu
,

341 
yld_ngth
,

342 *
_ve
)

344 
i
;

346 
mic_iv
[0] = 0x59;

347 i(
qc_exis
 && 
a4_exis
)

348 
mic_iv
[1] = 
mpdu
[30] & 0x0f;

349 i(
qc_exis
 && !
a4_exis
)

350 
mic_iv
[1] = 
mpdu
[24] & 0x0f;

351 i(!
qc_exis
)

352 
mic_iv
[1] = 0x00;

353 
i
 = 2; i < 8; i++)

354 
mic_iv
[
i
] = 
mpdu
[i + 8];

355 #ifde
CONSISTENT_PN_ORDER


356 
i
 = 8; i < 14; i++)

357 
mic_iv
[
i
] = 
_ve
[i - 8];

359 
i
 = 8; i < 14; i++)

360 
mic_iv
[
i
] = 
_ve
[13 - i];

362 
i
 = (
yld_ngth
 / 256);

363 
i
 = (
yld_ngth
 % 256);

364 
mic_iv
[14] = ((
yld_ngth
 / 256);

365 
mic_iv
[15] = ((
yld_ngth
 % 256);

367 
	}
}

374 
	$s128k128d
(*
key
, *
da
, *
chxt
)

376 
round
;

377 
i
;

378 
rmeda
[16];

379 
rmedb
[16];

380 
round_key
[16];

382 
i
=0; i<16; i++
round_key
[i] = 
key
[i];

384 
round
 = 0;ound < 11;ound++)

386 i(
round
 == 0)

388 
	`x_128
(
round_key
, 
da
, 
chxt
);

389 
	`xt_key
(
round_key
, 
round
);

391 i(
round
 == 10)

393 
	`by_sub
(
chxt
, 
rmeda
);

394 
	`shi_row
(
rmeda
, 
rmedb
);

395 
	`x_128
(
rmedb
, 
round_key
, 
chxt
);

399 
	`by_sub
(
chxt
, 
rmeda
);

400 
	`shi_row
(
rmeda
, 
rmedb
);

401 
	`mix_cumn
(&
rmedb
[0], &
rmeda
[0]);

402 
	`mix_cumn
(&
rmedb
[4], &
rmeda
[4]);

403 
	`mix_cumn
(&
rmedb
[8], &
rmeda
[8]);

404 
	`mix_cumn
(&
rmedb
[12], &
rmeda
[12]);

405 
	`x_128
(
rmeda
, 
round_key
, 
chxt
);

406 
	`xt_key
(
round_key
, 
round
);

410 
	}
}

412 
	$cڡru_r_d
(

413 *
r_d
,

414 
a4_exis
,

415 
qc_exis
,

416 *
mpdu
,

417 *
_ve
,

418 
c
)

421 
i
 = 0;

422 
i
=0; i<16; i++
r_d
[i] = 0x00;

423 
i
 = 0;

425 
r_d
[0] = 0x01;

426 i(
qc_exis
 && 
a4_exis

r_d
[1] = 
mpdu
[30] & 0x0f;

427 i(
qc_exis
 && !
a4_exis

r_d
[1] = 
mpdu
[24] & 0x0f;

429 
i
 = 2; i < 8; i++)

430 
r_d
[
i
] = 
mpdu
[i + 8];

431 #ifde
CONSISTENT_PN_ORDER


432 
i
 = 8; i < 14; i++)

433 
r_d
[
i
] = 
_ve
[i - 8];

435 
i
 = 8; i < 14; i++)

436 
r_d
[
i
] = 
_ve
[13 - i];

438 
r_d
[14] = ((
c
 / 256);

439 
r_d
[15] = ((
c
 % 256);

441 
	}
}

443 
BOOLEAN
 
	$RTMPSoDeyAES
(

444 
IN
 
PRTMP_ADAPTER
 
pAd
,

445 
IN
 
PUCHAR
 
pDa
,

446 
IN
 
ULONG
 
DaByC
,

447 
IN
 
PCIPHER_KEY
 
pWKey
)

449 
UINT
 
HdL
;

450 
UCHAR
 
PN
[6];

451 
UINT
 
yld_n
;

452 
UINT
 
num_blocks
;

453 
UINT
 
yld_mad
;

454 
USHORT
 
fc
;

455 
UCHAR
 
fc0
;

456 
UCHAR
 
fc1
;

457 
UINT
 
ame_ty
;

458 
UINT
 
ame_subty
;

459 
UINT
 
om_ds
;

460 
UINT
 
to_ds
;

461 
INT
 
a4_exis
;

462 
INT
 
qc_exis
;

463 
UCHAR
 
s_out
[16];

464 
yld_dex
;

465 
UINT
 
i
;

466 
UCHAR
 
r_d
[16];

467 
UCHAR
 
cha_bufr
[16];

468 
UCHAR
 
dded_bufr
[16];

469 
UCHAR
 
mic_iv
[16];

470 
UCHAR
 
mic_hd1
[16];

471 
UCHAR
 
mic_hd2
[16];

472 
UCHAR
 
MIC
[8];

473 
UCHAR
 
TMIC
[8];

475 #ifde
RT_BIG_ENDIAN


476 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pDa
, 
DIR_READ
, 
FALSE
);

479 
fc0
 = *
pDa
;

480 
fc1
 = *(
pDa
 + 1);

482 
fc
 = *((
PUSHORT
)
pDa
);

484 
ame_ty
 = ((
fc0
 >> 2) & 0x03);

485 
ame_subty
 = ((
fc0
 >> 4) & 0x0f);

487 
om_ds
 = (
fc1
 & 0x2) >> 1;

488 
to_ds
 = (
fc1
 & 0x1);

490 
a4_exis
 = (
om_ds
 & 
to_ds
);

491 
qc_exis
 = ((
ame_subty
 == 0x08) ||

492 (
ame_subty
 == 0x09) ||

493 (
ame_subty
 == 0x0a) ||

494 (
ame_subty
 == 0x0b)

497 
HdL
 = 24;

499 i(
a4_exis
)

500 
HdL
 += 6;

502 i(
qc_exis
)

503 
HdL
 += 2;

505 i(
pWKey
->
KeyL
 == 0)

507 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPSoftDecryptAES failed!(the Length canot be 0)\n"));

508  
FALSE
;

511 
PN
[0] = *(
pDa
+ 
HdL
);

512 
PN
[1] = *(
pDa
+ 
HdL
 + 1);

513 
PN
[2] = *(
pDa
+ 
HdL
 + 4);

514 
PN
[3] = *(
pDa
+ 
HdL
 + 5);

515 
PN
[4] = *(
pDa
+ 
HdL
 + 6);

516 
PN
[5] = *(
pDa
+ 
HdL
 + 7);

518 
yld_n
 = 
DaByC
 - 
HdL
 - 8 - 8;

519 
yld_mad
 = (
yld_n
) % 16;

520 
num_blocks
 = (
yld_n
) / 16;

525 
yld_dex
 = 
HdL
 + 8;

527 
i
=0; i< 
num_blocks
; i++)

529 
	`cڡru_r_d
(
r_d
,

530 
a4_exis
,

531 
qc_exis
,

532 
pDa
,

533 
PN
,

534 
i
+1 );

536 
	`s128k128d
(
pWKey
->
Key
, 
r_d
, 
s_out
);

538 
	`bwi_x
(
s_out
, 
pDa
 + 
yld_dex
, 
cha_bufr
);

539 
	`NdisMoveMemy
(
pDa
 + 
yld_dex
 - 8, 
cha_bufr
, 16);

540 
yld_dex
 += 16;

547 i(
yld_mad
 > 0)

549 
	`cڡru_r_d
(
r_d
,

550 
a4_exis
,

551 
qc_exis
,

552 
pDa
,

553 
PN
,

554 
num_blocks
 + 1);

556 
	`NdisZoMemy
(
dded_bufr
, 16);

557 
	`NdisMoveMemy
(
dded_bufr
, 
pDa
 + 
yld_dex
, 
yld_mad
);

559 
	`s128k128d
(
pWKey
->
Key
, 
r_d
, 
s_out
);

561 
	`bwi_x
(
s_out
, 
dded_bufr
, 
cha_bufr
);

562 
	`NdisMoveMemy
(
pDa
 + 
yld_dex
 - 8, 
cha_bufr
, 
yld_mad
);

563 
yld_dex
 +
yld_mad
;

569 
	`cڡru_r_d
(
r_d
,

570 
a4_exis
,

571 
qc_exis
,

572 
pDa
,

573 
PN
,

575 
	`NdisZoMemy
(
dded_bufr
, 16);

576 
	`NdisMoveMemy
(
dded_bufr
, 
pDa
 + 
yld_dex
, 8);

578 
	`s128k128d
(
pWKey
->
Key
, 
r_d
, 
s_out
);

580 
	`bwi_x
(
s_out
, 
dded_bufr
, 
cha_bufr
);

582 
	`NdisMoveMemy
(
TMIC
, 
cha_bufr
, 8);

590 *(
pDa
 + 1) = *(pData + 1) | 0x40;

594 
yld_dex
 = 
HdL
;

596 
	`cڡru_mic_iv
(

597 
mic_iv
,

598 
qc_exis
,

599 
a4_exis
,

600 
pDa
,

601 
yld_n
,

602 
PN
);

604 
	`cڡru_mic_hd1
(

605 
mic_hd1
,

606 
HdL
,

607 
pDa
);

609 
	`cڡru_mic_hd2
(

610 
mic_hd2
,

611 
pDa
,

612 
a4_exis
,

613 
qc_exis
);

615 
	`s128k128d
(
pWKey
->
Key
, 
mic_iv
, 
s_out
);

616 
	`bwi_x
(
s_out
, 
mic_hd1
, 
cha_bufr
);

617 
	`s128k128d
(
pWKey
->
Key
, 
cha_bufr
, 
s_out
);

618 
	`bwi_x
(
s_out
, 
mic_hd2
, 
cha_bufr
);

619 
	`s128k128d
(
pWKey
->
Key
, 
cha_bufr
, 
s_out
);

622 
i
 = 0; i < 
num_blocks
; i++)

624 
	`bwi_x
(
s_out
, 
pDa
 + 
yld_dex
, 
cha_bufr
);

625 
yld_dex
 += 16;

626 
	`s128k128d
(
pWKey
->
Key
, 
cha_bufr
, 
s_out
);

630 i(
yld_mad
 > 0)

632 
	`NdisZoMemy
(
dded_bufr
, 16);

633 
	`NdisMoveMemy
(
dded_bufr
, 
pDa
 + 
yld_dex
, 
yld_mad
);

635 
	`bwi_x
(
s_out
, 
dded_bufr
, 
cha_bufr
);

636 
	`s128k128d
(
pWKey
->
Key
, 
cha_bufr
, 
s_out
);

641 
i
 = 0 ; i < 8; i++
MIC
[i] = 
s_out
[i];

643 i(!
	`NdisEquMemy
(
MIC
, 
TMIC
, 8))

645 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RTMPSoftDecryptAES, MIC Error !\n"));

646  
FALSE
;

649 #ifde
RT_BIG_ENDIAN


650 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pDa
, 
DIR_READ
, 
FALSE
);

653  
TRUE
;

654 
	}
}

673 
VOID
 
	$RTMPCڡruCCMPAAD
(

674 
IN
 
PUCHAR
 
pHdr
,

675 
IN
 
BOOLEAN
 
isDaFme
,

676 
IN
 
UINT8
 
a4_exis
,

677 
IN
 
UINT8
 
qc_exis
,

678 
OUT
 
UCHAR
 *
d_hdr
,

679 
OUT
 
UINT
 *
d_n
)

681 
UINT
 
n
 = 0;

689 i(
isDaFme
)

690 
d_hdr
[0] = (*
pHdr
) & 0x8f;

692 
d_hdr
[0] = (*
pHdr
);

693 
d_hdr
[1] = (*(
pHdr
 + 1)) & 0xc7;

694 
d_hdr
[1] =ad_hdr[1] | 0x40;

695 
n
 = 2;

698 
	`NdisMoveMemy
(&
d_hdr
[
n
], 
pHdr
 + 4, 3 * 
MAC_ADDR_LEN
);

699 
n
 +(3 * 
MAC_ADDR_LEN
);

705 
d_hdr
[
n
] = (*(
pHdr
 + 22)) & 0x0f;

706 
d_hdr
[
n
 + 1] = 0x00;

707 
n
 += 2;

711 i(
a4_exis
)

713 
	`NdisMoveMemy
(&
d_hdr
[
n
], 
pHdr
 + 24, 
MAC_ADDR_LEN
);

714 
n
 +
MAC_ADDR_LEN
;

722 i(
qc_exis
 & 
a4_exis
)

724 
d_hdr
[
n
] = (*(
pHdr
 + 30)) & 0x0f;

725 
d_hdr
[
n
 + 1] = 0x00;

726 
n
 += 2;

728 i(
qc_exis
 & !
a4_exis
)

730 
d_hdr
[
n
] = (*(
pHdr
 + 24)) & 0x0f;

731 
d_hdr
[
n
 + 1] = 0x00;

732 
n
 += 2;

735 *
d_n
 = 
n
;

736 
	}
}

752 
VOID
 
	$RTMPCڡruCCMPN
(

753 
IN
 
PUCHAR
 
pHdr
,

754 
IN
 
UINT8
 
a4_exis
,

755 
IN
 
UINT8
 
qc_exis
,

756 
IN
 
BOOLEAN
 
isMgmtFme
,

757 
IN
 
UCHAR
 *

,

758 
OUT
 
UCHAR
 *
n_hdr
,

759 
OUT
 
UINT
 *
n_hdr_n
)

761 
UINT
 
n_offt
 = 0;

762 
INT
 
i
;

770 i(
qc_exis
 && 
a4_exis
)

771 
n_hdr
[0] = (*(
pHdr
 + 30)) & 0x0f;

772 i(
qc_exis
 && !
a4_exis
)

773 
n_hdr
[0] = (*(
pHdr
 + 24)) & 0x0f;

775 
n_offt
 += 1;

778 
	`NdisMoveMemy
(&
n_hdr
[
n_offt
], 
pHdr
 + 10, 
MAC_ADDR_LEN
);

779 
n_offt
 +
MAC_ADDR_LEN
;

784 
i
 = 0; i < 6; i++)

785 
n_hdr
[
n_offt
 + 
i
] = 

[5 - i];

786 
n_offt
 +
LEN_PN
;

788 *
n_hdr_n
 = 
n_offt
;

790 
	}
}

807 
VOID
 
	$RTMPCڡruCCMPHdr
(

808 
IN
 
UINT8
 
key_idx
,

809 
IN
 
UCHAR
 *

,

810 
OUT
 
UCHAR
 *
ccmp_hdr
)

812 
	`NdisZoMemy
(
ccmp_hdr
, 
LEN_CCMP_HDR
);

814 
ccmp_hdr
[0] = 

[0];

815 
ccmp_hdr
[1] = 

[1];

816 
ccmp_hdr
[3] = (
key_idx
 <<6) | 0x20;

817 
ccmp_hdr
[4] = 

[2];

818 
ccmp_hdr
[5] = 

[3];

819 
ccmp_hdr
[6] = 

[4];

820 
ccmp_hdr
[7] = 

[5];

821 
	}
}

836 
BOOLEAN
 
	$RTMPSoEnyCCMP
(

837 
IN
 
PRTMP_ADAPTER
 
pAd
,

838 
IN
 
PUCHAR
 
pHdr
,

839 
IN
 
PUCHAR
 
pIV
,

840 
IN
 
PUCHAR
 
pKey
,

841 
INOUT
 
PUCHAR
 
pDa
,

842 
IN
 
UINT32
 
DaL
)

844 
UINT8
 
ame_ty
, 
ame_subty
;

845 
UINT8
 
om_ds
, 
to_ds
;

846 
UINT8
 
a4_exis
, 
qc_exis
;

847 
UINT8
 
d_hdr
[30];

848 
UINT
 
d_n
 = 0;

849 
UINT8
 
n_hdr
[13];

850 
UINT32
 
n_hdr_n
 = 0;

851 
UINT32
 
out_n
 = 
DaL
 + 8;

853 #ifde
RT_BIG_ENDIAN


854 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pHdr
, 
DIR_READ
, 
FALSE
);

858 
	`NdisZoMemy
(
d_hdr
, 30);

859 
	`NdisZoMemy
(
n_hdr
, 13);

862 
ame_ty
 = (((*
pHdr
) >> 2) & 0x03);

863 
ame_subty
 = (((*
pHdr
) >> 4) & 0x0f);

866 
om_ds
 = ((*(
pHdr
 + 1)) & 0x2) >> 1;

867 
to_ds
 = ((*(
pHdr
 + 1)) & 0x1);

870 
a4_exis
 = (
om_ds
 & 
to_ds
);

871 
qc_exis
 = ((
ame_subty
 =
SUBTYPE_QDATA
) ||

872 (
ame_subty
 =
SUBTYPE_QDATA_CFACK
) ||

873 (
ame_subty
 =
SUBTYPE_QDATA_CFPOLL
) ||

874 (
ame_subty
 =
SUBTYPE_QDATA_CFACK_CFPOLL
));

877 
	`RTMPCڡruCCMPAAD
(
pHdr
,

878 (
ame_ty
 =
BTYPE_DATA
),

879 
a4_exis
,

880 
qc_exis
,

881 
d_hdr
,

882 &
d_n
);

885 
	`RTMPCڡruCCMPN
(
pHdr
,

886 
a4_exis
,

887 
qc_exis
,

888 (
ame_ty
 =
BTYPE_MGMT
),

889 
pIV
,

890 
n_hdr
,

891 &
n_hdr_n
);

896 i(
	`AES_CCM_Eny
(
pDa
, 
DaL
,

897 
pKey
, 16,

898 
n_hdr
, 
n_hdr_n
,

899 
d_hdr
, 
d_n
, 
LEN_CCMP_MIC
,

900 
pDa
, &
out_n
))

901  
FALSE
;

903 #ifde
RT_BIG_ENDIAN


904 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pHdr
, 
DIR_READ
, 
FALSE
);

907  
TRUE
;

908 
	}
}

924 
BOOLEAN
 
	$RTMPSoDeyCCMP
(

925 
IN
 
PRTMP_ADAPTER
 
pAd
,

926 
IN
 
PUCHAR
 
pHdr
,

927 
IN
 
PCIPHER_KEY
 
pKey
,

928 
INOUT
 
PUCHAR
 
pDa
,

929 
INOUT
 
UINT16
 *
DaL
)

931 
UINT8
 
ame_ty
, 
ame_subty
;

932 
UINT8
 
om_ds
, 
to_ds
;

933 
UINT8
 
a4_exis
, 
qc_exis
;

934 
UINT8
 
d_hdr
[30];

935 
UINT
 
d_n
 = 0;

936 
UINT8
 

[
LEN_PN
];

937 
PUCHAR
 
chDa_r
;

938 
UINT32
 
chDa_n
;

939 
UINT8
 
n_hdr
[13];

940 
UINT32
 
n_hdr_n
 = 0;

941 
UINT32
 
out_n
 = *
DaL
;

943 #ifde
RT_BIG_ENDIAN


944 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pHdr
, 
DIR_READ
, 
FALSE
);

948 i(
pKey
->
KeyL
 == 0)

950 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: Thkey inهvaab !\n", 
__FUNCTION__
));

951  
FALSE
;

955 
	`NdisZoMemy
(
d_hdr
, 30);

956 
	`NdisZoMemy
(
n_hdr
, 13);

959 
ame_ty
 = (((*
pHdr
) >> 2) & 0x03);

960 
ame_subty
 = (((*
pHdr
) >> 4) & 0x0f);

963 
om_ds
 = ((*(
pHdr
 + 1)) & 0x2) >> 1;

964 
to_ds
 = ((*(
pHdr
 + 1)) & 0x1);

967 
a4_exis
 = (
om_ds
 & 
to_ds
);

968 
qc_exis
 = ((
ame_subty
 =
SUBTYPE_QDATA
) ||

969 (
ame_subty
 =
SUBTYPE_QDATA_CFACK
) ||

970 (
ame_subty
 =
SUBTYPE_QDATA_CFPOLL
) ||

971 (
ame_subty
 =
SUBTYPE_QDATA_CFACK_CFPOLL
));

974 

[0] = 
pDa
[0];

975 

[1] = 
pDa
[1];

976 

[2] = 
pDa
[4];

977 

[3] = 
pDa
[5];

978 

[4] = 
pDa
[6];

979 

[5] = 
pDa
[7];

982 
chDa_r
 = 
pDa
 + 
LEN_CCMP_HDR
;

983 
chDa_n
 = *
DaL
 - 
LEN_CCMP_HDR
;

986 
	`RTMPCڡruCCMPAAD
(
pHdr
,

987 (
ame_ty
 =
BTYPE_DATA
),

988 
a4_exis
,

989 
qc_exis
,

990 
d_hdr
,

991 &
d_n
);

994 
	`RTMPCڡruCCMPN
(
pHdr
,

995 
a4_exis
,

996 
qc_exis
,

997 (
ame_ty
 =
BTYPE_MGMT
),

998 

,

999 
n_hdr
,

1000 &
n_hdr_n
);

1005 i(
	`AES_CCM_Dey
(
chDa_r
, 
chDa_n
,

1006 
pKey
->
Key
, 16,

1007 
n_hdr
, 
n_hdr_n
,

1008 
d_hdr
, 
d_n
, 
LEN_CCMP_MIC
,

1009 
pDa
, &
out_n
))

1010  
FALSE
;

1012 *
DaL
 = 
out_n
;

1014 #ifde
RT_BIG_ENDIAN


1015 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pHdr
, 
DIR_READ
, 
FALSE
);

1018  
TRUE
;

1019 
	}
}

1035 
VOID
 
	$CCMP__ve
(

1036 
IN
 
PRTMP_ADAPTER
 
pAd
,

1037 
IN
 
INT
 
put
)

1039 
UINT8
 
Key_ID
 = 0;

1043 
UINT8
 
TK
[16] = {0xc9, 0x7c, 0x1f, 0x67, 0xce, 0x37, 0x11, 0x85,

1045 
UINT8
 
PN
[6] = {0x0C, 0xE7, 0x76, 0x97, 0x03, 0xB5};

1046 
UINT8
 
HDR
[24]= {0x08, 0x48, 0xc3, 0x2c, 0x0f, 0xd2, 0xe1, 0x28,

1049 
UINT8
 
AAD
[22] = {0x08, 0x40, 0x0f, 0xd2, 0xe1, 0x28, 0xa5, 0x7c,

1052 
UINT8
 
CCMP_HDR
[8] = {0x0c, 0xe7, 0x00, 0x20, 0x76, 0x97, 0x03, 0xb5};

1053 
UINT8
 
CCM_NONCE
[13] = {0x00, 0x50, 0x30, 0xf1, 0x84, 0x44, 0x08, 0xb5,

1055 
UINT8
 
P_TEXT_DATA
[20] = {0xf8, 0xba, 0x1a, 0x55, 0xd0, 0x2f, 0x85, 0xae,

1058 
UINT8
 
C_TEXT_DATA
[28] = {0xf3, 0xd0, 0xa2, 0xfe, 0x9a, 0x3d, 0xbf, 0x23,

1062 
UINT8
 
s_buf
[100];

1063 
UINT
 
s_n
 = 0;

1065 
	`tk
("== CCMPest vector == \n");

1068 
	`NdisZoMemy
(
s_buf
, 100);

1069 
s_n
 = 0;

1070 
	`RTMPCڡruCCMPAAD
(
HDR
, 
TRUE
, 0, 0, 
s_buf
, &
s_n
);

1071 i(
s_n
 =22 && 
	`NdisEquMemy
(
s_buf
, 
AAD
,es_len))

1072 
	`tk
("Construct AAD is OK!!!\n");

1075 
	`tk
("\n!!!Construct AAD is FAILURE!!!\n\n");

1076 
	`hex_dump
("Ccuϋ AAD", 
s_buf
, 
s_n
);

1079 
	`NdisZoMemy
(
s_buf
, 100);

1080 
s_n
 = 0;

1081 
	`RTMPCڡruCCMPN
(
HDR
, 0, 0, 
FALSE
, 
PN
, 
s_buf
, &
s_n
);

1082 i(
s_n
 =13 && 
	`NdisEquMemy
(
s_buf
, 
CCM_NONCE
,es_len))

1083 
	`tk
("Construct NONCE is OK!!!\n");

1086 
	`tk
("\n!!!Construct NONCE is FAILURE!!!\n\n");

1087 
	`hex_dump
("Ccuϋ NONCE", 
s_buf
, 
s_n
);

1090 
	`NdisZoMemy
(
s_buf
, 100);

1091 
s_n
 = 0;

1092 
	`RTMPCڡruCCMPHdr
(
Key_ID
, 
PN
, 
s_buf
);

1093 i(
	`NdisEquMemy
(
s_buf
, 
CCMP_HDR
, 8))

1094 
	`tk
("Construct CCMP_HDR is OK!!!\n");

1097 
	`tk
("\n!!!Construct CCMP_HDR is FAILURE!!!\n\n");

1098 
	`hex_dump
("Ccuϋ CCMP_HDR", 
s_buf
, 8);

1102 
	`NdisZoMemy
(
s_buf
, 100);

1103 
	`NdisMoveMemy
(
s_buf
, 
P_TEXT_DATA
, (P_TEXT_DATA));

1104 
s_n
 = (
C_TEXT_DATA
);

1105 i(
	`AES_CCM_Eny
(
s_buf
, (
P_TEXT_DATA
),

1106 
TK
, (TK),

1107 
CCM_NONCE
, (CCM_NONCE),

1108 
AAD
, (AAD), 8,

1109 
s_buf
, &
s_n
) == 0)

1111 i(
s_n
 =(
C_TEXT_DATA
) &&

1112 
	`NdisEquMemy
(
s_buf
, 
C_TEXT_DATA
, 
s_n
))

1113 
	`tk
("CCM_Encrypt is OK!!!\n");

1116 
	`tk
("\n!!!CCM_Encrypt is FAILURE!!!\n\n");

1117 
	`hex_dump
("CCM_Eny", 
s_buf
, 
s_n
);

1122 
	`NdisZoMemy
(
s_buf
, 100);

1123 
	`NdisMoveMemy
(
s_buf
, 
C_TEXT_DATA
, (C_TEXT_DATA));

1124 
s_n
 = (
P_TEXT_DATA
);

1125 i(
	`AES_CCM_Dey
(
s_buf
, (
C_TEXT_DATA
), 
TK
, 16,

1126 
CCM_NONCE
, (CCM_NONCE),

1127 
AAD
, (AAD), 8,

1128 
s_buf
, &
s_n
) == 0)

1130 i(
s_n
 =(
P_TEXT_DATA
) &&

1131 
	`NdisEquMemy
(
s_buf
, 
P_TEXT_DATA
, 
s_n
))

1132 
	`tk
("CCM_Decrypt is OK!!!\n");

1135 
	`tk
("\n!!!CCM_Decrypt is FAILURE!!!\n\n");

1136 
	`hex_dump
("CCM_Dey", 
s_buf
, 
s_n
);

1141 
	`tk
("== CCMPest vector == \n");

1143 
	}
}

	@common/cmm_asic.c

38 
	~"_cfig.h
"

41 #i
defed
(
RT28xx
|| defed(
RT2883
)

43 
RTMP_RF_REGS
 
	gRF2850RegTab
[] = {

121 
UCHAR
 
	gNUM_OF_2850_CHNL
 = ((
RF2850RegTab
/ (
RTMP_RF_REGS
));

126 
FREQUENCY_ITEM
 
	gFqIms3020
[] =

149 
UCHAR
 
	gNUM_OF_3020_CHNL
 = ((
FqIms3020
/ (
FREQUENCY_ITEM
));

154 #ifde
RTMP_INTERNAL_TX_ALC


156 
TX_POWER_TUNING_ENTRY_STRUCT
 
	gTxPowTungTab
[] =

239 
CHAR
 
	gdesedTSSIOvCCK
[4] = {0};

242 
CHAR
 
	gdesedTSSIOvOFDM
[8] = {0};

245 
CHAR
 
	gdesedTSSIOvHT
[8] = {0};

248 
CHAR
 
	gdesedTSSIOvHTUsgSTBC
[8] = {0};

251 #ifde
CONFIG_STA_SUPPORT


252 
VOID
 
	$AsicUpdeAutoFlBackTab
(

253 
IN
 
PRTMP_ADAPTER
 
pAd
,

254 
IN
 
PUCHAR
 
pReTab
)

256 
UCHAR
 
i
;

257 
HT_FBK_CFG0_STRUC
 
HtCfg0
;

258 
HT_FBK_CFG1_STRUC
 
HtCfg1
;

259 
LG_FBK_CFG0_STRUC
 
LgCfg0
;

260 
LG_FBK_CFG1_STRUC
 
LgCfg1
;

262 
PRTMP_TX_RATE_SWITCH
 
pCuTxRe
, 
pNextTxRe
;

266 
HtCfg0
.
wd
 = 0x65432100;

267 
HtCfg1
.
wd
 = 0xedcba980;

268 
LgCfg0
.
wd
 = 0xedcba988;

269 
LgCfg1
.
wd
 = 0x00002100;

272 
pNextTxRe
 = (
PRTMP_TX_RATE_SWITCH
)
pReTab
+1;

274 
i
 = 1; i < *((
PUCHAR

pReTab
); i++)

276 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH
)
pReTab
+1+
i
;

278 
pCuTxRe
->
Mode
)

284 
pCuTxRe
->
CuMCS
)

287 
LgCfg0
.
fld
.
OFDMMCS0FBK
 = (
pNextTxRe
->
Mode
 =
MODE_OFDM
? (pNextTxRe->
CuMCS
+8):NextTxRate->CurrMCS;

290 
LgCfg0
.
fld
.
OFDMMCS1FBK
 = (
pNextTxRe
->
Mode
 =
MODE_OFDM
? (pNextTxRe->
CuMCS
+8):NextTxRate->CurrMCS;

293 
LgCfg0
.
fld
.
OFDMMCS2FBK
 = (
pNextTxRe
->
Mode
 =
MODE_OFDM
? (pNextTxRe->
CuMCS
+8):NextTxRate->CurrMCS;

296 
LgCfg0
.
fld
.
OFDMMCS3FBK
 = (
pNextTxRe
->
Mode
 =
MODE_OFDM
? (pNextTxRe->
CuMCS
+8):NextTxRate->CurrMCS;

299 
LgCfg0
.
fld
.
OFDMMCS4FBK
 = (
pNextTxRe
->
Mode
 =
MODE_OFDM
? (pNextTxRe->
CuMCS
+8):NextTxRate->CurrMCS;

302 
LgCfg0
.
fld
.
OFDMMCS5FBK
 = (
pNextTxRe
->
Mode
 =
MODE_OFDM
? (pNextTxRe->
CuMCS
+8):NextTxRate->CurrMCS;

305 
LgCfg0
.
fld
.
OFDMMCS6FBK
 = (
pNextTxRe
->
Mode
 =
MODE_OFDM
? (pNextTxRe->
CuMCS
+8):NextTxRate->CurrMCS;

308 
LgCfg0
.
fld
.
OFDMMCS7FBK
 = (
pNextTxRe
->
Mode
 =
MODE_OFDM
? (pNextTxRe->
CuMCS
+8):NextTxRate->CurrMCS;

313 #ifde
DOT11_N_SUPPORT


317 i((
pNextTxRe
->
Mode
 >
MODE_HTMIX
&& (
pCuTxRe
->
CuMCS
 !=NextTxRate->CurrMCS))

319 
pCuTxRe
->
CuMCS
)

322 
HtCfg0
.
fld
.
HTMCS0FBK
 = 
pNextTxRe
->
CuMCS
;

325 
HtCfg0
.
fld
.
HTMCS1FBK
 = 
pNextTxRe
->
CuMCS
;

328 
HtCfg0
.
fld
.
HTMCS2FBK
 = 
pNextTxRe
->
CuMCS
;

331 
HtCfg0
.
fld
.
HTMCS3FBK
 = 
pNextTxRe
->
CuMCS
;

334 
HtCfg0
.
fld
.
HTMCS4FBK
 = 
pNextTxRe
->
CuMCS
;

337 
HtCfg0
.
fld
.
HTMCS5FBK
 = 
pNextTxRe
->
CuMCS
;

340 
HtCfg0
.
fld
.
HTMCS6FBK
 = 
pNextTxRe
->
CuMCS
;

343 
HtCfg0
.
fld
.
HTMCS7FBK
 = 
pNextTxRe
->
CuMCS
;

346 
HtCfg1
.
fld
.
HTMCS8FBK
 = 
pNextTxRe
->
CuMCS
;

349 
HtCfg1
.
fld
.
HTMCS9FBK
 = 
pNextTxRe
->
CuMCS
;

352 
HtCfg1
.
fld
.
HTMCS10FBK
 = 
pNextTxRe
->
CuMCS
;

355 
HtCfg1
.
fld
.
HTMCS11FBK
 = 
pNextTxRe
->
CuMCS
;

358 
HtCfg1
.
fld
.
HTMCS12FBK
 = 
pNextTxRe
->
CuMCS
;

361 
HtCfg1
.
fld
.
HTMCS13FBK
 = 
pNextTxRe
->
CuMCS
;

364 
HtCfg1
.
fld
.
HTMCS14FBK
 = 
pNextTxRe
->
CuMCS
;

367 
HtCfg1
.
fld
.
HTMCS15FBK
 = 
pNextTxRe
->
CuMCS
;

371 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AsicUpdeAutoFlBackTab: su܈CuMCS=%d\n", 
pCuTxRe
->
CuMCS
));

379 
pNextTxRe
 = 
pCuTxRe
;

382 
	`RTMP_IO_WRITE32
(
pAd
, 
HT_FBK_CFG0
, 
HtCfg0
.
wd
);

383 
	`RTMP_IO_WRITE32
(
pAd
, 
HT_FBK_CFG1
, 
HtCfg1
.
wd
);

384 
	`RTMP_IO_WRITE32
(
pAd
, 
LG_FBK_CFG0
, 
LgCfg0
.
wd
);

385 
	`RTMP_IO_WRITE32
(
pAd
, 
LG_FBK_CFG1
, 
LgCfg1
.
wd
);

389 
	}
}

409 
VOID
 
	$AsicUpdePre
(

410 
IN
 
PRTMP_ADAPTER
 
pAd
,

411 
IN
 
USHORT
 
OtiMode
,

412 
IN
 
UCHAR
 
SMask
,

413 
IN
 
BOOLEAN
 
bDibBGPre
,

414 
IN
 
BOOLEAN
 
bNGFExi
)

416 
PROT_CFG_STRUC
 
PrCfg
, 
PrCfg4
;

417 
UINT32
 
Pre
[6];

418 
USHORT
 
offt
;

419 
UCHAR
 
i
;

420 
UINT32
 
MacReg
 = 0;

422 #ifde
RALINK_ATE


423 i(
	`ATE_ON
(
pAd
))

427 #ifde
DOT11_N_SUPPORT


428 i(!(
pAd
->
CommCfg
.
bHTPre
&& (
OtiMode
 != 8))

433 i(
pAd
->
BATab
.
numDeOrig
)

438 
SMask
 |
ALLN_SETPROTECT
;

439 
OtiMode
 = 8;

444 
	`RTMP_IO_READ32
(
pAd
, 
TX_RTS_CFG
, &
MacReg
);

445 
MacReg
 &= 0xFF0000FF;

448 #ifde
DOT11_N_SUPPORT


449 (
pAd
->
CommCfg
.
BACaby
.
fld
.
AmsduEb
) ||

451 (
pAd
->
CommCfg
.
bAgggiCab
 =
TRUE
))

452 && 
pAd
->
CommCfg
.
RtsThshd
 =
MAX_RTS_THRESHOLD
)

454 
MacReg
 |= (0x1000 << 8);

458 
MacReg
 |(
pAd
->
CommCfg
.
RtsThshd
 << 8);

461 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_RTS_CFG
, 
MacReg
);

464 
	`RTMPZoMemy
(
Pre
, (Protect));

465 
PrCfg4
.
wd
 = 0;

466 
PrCfg
.
wd
 = 0;

467 
PrCfg
.
fld
.
TxAowGF40
 = 1;

468 
PrCfg
.
fld
.
TxAowGF20
 = 1;

469 
PrCfg
.
fld
.
TxAowMM40
 = 1;

470 
PrCfg
.
fld
.
TxAowMM20
 = 1;

471 
PrCfg
.
fld
.
TxAowOfdm
 = 1;

472 
PrCfg
.
fld
.
TxAowCck
 = 1;

473 
PrCfg
.
fld
.
RTSThEn
 = 1;

474 
PrCfg
.
fld
.
PreNav
 = 
ASIC_SHORTNAV
;

477 i(
pAd
->
CommCfg
.
Chl
 > 14)

478 
PrCfg
.
fld
.
PreRe
 = 0x4000;

479 
PrCfg
.
fld
.
PreRe
 |
pAd
->
CommCfg
.
RtsRe
;

482 i(
bDibBGPre
)

485 
PrCfg
.
fld
.
PreCl
 = 0;

486 
Pre
[0] = 
PrCfg
.
wd
;

487 
Pre
[1] = 
PrCfg
.
wd
;

488 
pAd
->
FlgCtsEbd
 = 0;

493 
PrCfg
.
fld
.
PreCl
 = 0;

494 
Pre
[0] = 
PrCfg
.
wd
;

495 
PrCfg
.
fld
.
PreCl
 = 
ASIC_CTS
;

496 
Pre
[1] = 
PrCfg
.
wd
;

497 
pAd
->
FlgCtsEbd
 = 1;

500 #ifde
DOT11_N_SUPPORT


502 i((
SMask
 & 
ALLN_SETPROTECT
) != 0)

504 
OtiMode
)

519 
Pre
[2] = 0x01744004;

527 
Pre
[3] = 0x03f44084;

535 
Pre
[4] = 0x01744004;

543 
Pre
[5] = 0x03f44084;

545 i(
bNGFExi
)

549 
Pre
[4] = 0x01754004;

550 
Pre
[5] = 0x03f54084;

552 
pAd
->
CommCfg
.
IOTePm
.
bRTSLgPrOn
 = 
FALSE
;

558 
PrCfg
.
wd
 = 0x01744004;

559 
PrCfg4
.
wd
 = 0x03f44084;

560 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_BG_PROTECTION_INUSED
))

562 
PrCfg
.
wd
 = 0x01740003;

563 
PrCfg4
.
wd
 = 0x03f40003;

566 
PrCfg
.
fld
.
PreCl
 = 
ASIC_RTS
;

567 
PrCfg
.
fld
.
PreNav
 = 
ASIC_SHORTNAV
;

568 
PrCfg4
.
fld
.
PreCl
 = 
ASIC_RTS
;

569 
PrCfg4
.
fld
.
PreNav
 = 
ASIC_SHORTNAV
;

570 
Pre
[2] = 
PrCfg
.
wd
;

571 
Pre
[3] = 
PrCfg4
.
wd
;

572 
Pre
[4] = 
PrCfg
.
wd
;

573 
Pre
[5] = 
PrCfg4
.
wd
;

574 
pAd
->
CommCfg
.
IOTePm
.
bRTSLgPrOn
 = 
TRUE
;

579 
PrCfg
.
wd
 = 0x01744004;

580 
PrCfg4
.
wd
 = 0x03f44084;

581 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_BG_PROTECTION_INUSED
))

583 
PrCfg
.
wd
 = 0x01740003;

584 
PrCfg4
.
wd
 = 0x03f40003;

587 
PrCfg4
.
fld
.
PreCl
 = 
ASIC_RTS
;

588 
PrCfg4
.
fld
.
PreNav
 = 
ASIC_SHORTNAV
;

589 
Pre
[2] = 
PrCfg
.
wd
;

590 
Pre
[3] = 
PrCfg4
.
wd
;

591 i(
bNGFExi
)

593 
PrCfg
.
fld
.
PreCl
 = 
ASIC_RTS
;

594 
PrCfg
.
fld
.
PreNav
 = 
ASIC_SHORTNAV
;

596 
Pre
[4] = 
PrCfg
.
wd
;

597 
Pre
[5] = 
PrCfg4
.
wd
;

599 
pAd
->
CommCfg
.
IOTePm
.
bRTSLgPrOn
 = 
FALSE
;

605 
PrCfg
.
wd
 = 0x01744004;

606 
PrCfg4
.
wd
 = 0x03f44084;

608 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_BG_PROTECTION_INUSED
))

610 
PrCfg
.
wd
 = 0x01740003;

611 
PrCfg4
.
wd
 = 0x03f40003;

614 
PrCfg
.
fld
.
PreCl
 = 
ASIC_RTS
;

615 
PrCfg
.
fld
.
PreNav
 = 
ASIC_SHORTNAV
;

616 
PrCfg4
.
fld
.
PreCl
 = 
ASIC_RTS
;

617 
PrCfg4
.
fld
.
PreNav
 = 
ASIC_SHORTNAV
;

618 
Pre
[2] = 
PrCfg
.
wd
;

619 
Pre
[3] = 
PrCfg4
.
wd
;

620 
Pre
[4] = 
PrCfg
.
wd
;

621 
Pre
[5] = 
PrCfg4
.
wd
;

622 
pAd
->
CommCfg
.
IOTePm
.
bRTSLgPrOn
 = 
TRUE
;

627 
PrCfg
.
wd
 = 0x01754004;

628 
PrCfg4
.
wd
 = 0x03f54084;

629 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_BG_PROTECTION_INUSED
))

631 
PrCfg
.
wd
 = 0x01750003;

632 
PrCfg4
.
wd
 = 0x03f50003;

635 
Pre
[2] = 
PrCfg
.
wd
;

636 
Pre
[3] = 
PrCfg4
.
wd
;

637 
Pre
[4] = 
PrCfg
.
wd
;

638 
Pre
[5] = 
PrCfg4
.
wd
;

639 
pAd
->
CommCfg
.
IOTePm
.
bRTSLgPrOn
 = 
TRUE
;

645 
offt
 = 
CCK_PROT_CFG
;

646 
i
 = 0;i < 6;i++)

648 i((
SMask
 & (1<< 
i
)))

650 
	`RTMP_IO_WRITE32
(
pAd
, 
offt
 + 
i
*4, 
Pre
[i]);

653 
	}
}

656 
VOID
 
	$AsicBBPAdju
(
RTMP_ADAPTER
 *
pAd
)

658 
UINT32
 
Vue
;

659 
UCHAR
 
byVue
 = 0;

663 #ifde
DOT11_N_SUPPORT


664 i((
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
) &&

665 (
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 =
EXTCHA_ABOVE
)

670 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_40
;

671 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
 + 2;

674 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Vue
);

675 
Vue
 &= (~0x1);

676 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

679 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
byVue
);

680 
byVue
 &= (~0x20);

681 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
byVue
);

683 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
byVue
);

684 
byVue
 &= (~0x18);

685 
byVue
 |= 0x10;

686 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
byVue
);

688 i(
pAd
->
CommCfg
.
Chl
 > 14)

690 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 0x48);

694 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 0x38);

697 i(
pAd
->
MACVsi
 == 0x28600100)

699 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x1A);

700 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x0A);

701 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x16);

705 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x12);

706 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x0A);

707 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x10);

710 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ApStartUp : ExtAbove, ChannelWidth=%d, Channel=%d, ExtChanOffset=%d(%d) \n",

711 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
,

712 
pAd
->
CommCfg
.
Chl
,

713 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
,

714 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
ExtChOfft
));

716 i((
pAd
->
CommCfg
.
Chl
 > 2) &&

717 (
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
) &&

718 (
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 =
EXTCHA_BELOW
)

721 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_40
;

723 i(
pAd
->
CommCfg
.
Chl
 == 14)

724 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
 - 1;

726 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
 - 2;

728 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Vue
);

729 
Vue
 |= (0x1);

730 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

733 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
byVue
);

734 
byVue
 |= (0x20);

735 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
byVue
);

737 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
byVue
);

738 
byVue
 &= (~0x18);

739 
byVue
 |= 0x10;

740 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
byVue
);

742 i(
pAd
->
CommCfg
.
Chl
 > 14)

744 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 0x48);

748 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 0x38);

752 i(
pAd
->
MACVsi
 == 0x28600100)

754 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x1A);

755 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x0A);

756 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x16);

760 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x12);

761 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x0A);

762 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x10);

764 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ApStartUp : ExtBlow, ChannelWidth=%d, Channel=%d, ExtChanOffset=%d(%d) \n",

765 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
,

766 
pAd
->
CommCfg
.
Chl
,

767 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
,

768 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
ExtChOfft
));

773 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_20
;

774 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
;

777 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Vue
);

778 
Vue
 &= (~0x1);

779 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

781 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
byVue
);

782 
byVue
 &= (~0x18);

783 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
byVue
);

786 i(
pAd
->
CommCfg
.
Chl
 > 14)

788 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 0x40);

794 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 0x38);

797 i(
pAd
->
MACVsi
 == 0x28600100)

799 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x16);

800 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x08);

801 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x11);

805 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x12);

806 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x0a);

807 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x10);

810 #ifde
DOT11_N_SUPPORT


811 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ApStartUp : 20MHz, ChannelWidth=%d, Channel=%d, ExtChanOffset=%d(%d) \n",

812 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
,

813 
pAd
->
CommCfg
.
Chl
,

814 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
,

815 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
ExtChOfft
));

819 i(
pAd
->
CommCfg
.
Chl
 > 14)

821 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R62
, 0x1D);

822 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R63
, 0x1D);

823 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R64
, 0x1D);

828 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R62
, 0x2D);

829 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R63
, 0x2D);

830 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R64
, 0x2D);

834 
	}
}

846 
VOID
 
	$AsicSwchChl
(

847 
IN
 
PRTMP_ADAPTER
 
pAd
,

848 
IN
 
UCHAR
 
Chl
,

849 
IN
 
BOOLEAN
 
bSn
)

851 
CHAR
 
TxPw
 = 0, 
TxPw2
 = 
DEFAULT_RF_TX_POWER
;

852 
UCHAR
 
dex
;

853 
UINT32
 
Vue
 = 0;

854 
UCHAR
 
RFVue
;

855 #ifde
RTMP_MAC_PCI


860 
RFVue
 = 0;

867 
dex
 = 0; index < 
MAX_NUM_OF_CHANNELS
; index++)

869 i(
Chl
 =
pAd
->
TxPow
[
dex
].Channel)

871 
TxPw
 = 
pAd
->
TxPow
[
dex
].
Pow
;

872 
TxPw2
 = 
pAd
->
TxPow
[
dex
].
Pow2
;

879 i(
dex
 =
MAX_NUM_OF_CHANNELS
)

881 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AsicSwchChl: C'fdhChl#%d \n", 
Chl
));

884 #i
	`defed
(
RT28xx
|| defed(
RT2880
|| defed(
RT2883
)

885 
ULONG
 
R2
 = 0, 
R3
 = 
DEFAULT_RF_TX_POWER
, 
R4
 = 0;

886 
RTMP_RF_REGS
 *
RFRegTab
;

888 
RFRegTab
 = 
RF2850RegTab
;

891 
pAd
->
RfIcTy
)

893 #i
	`defed
(
RT28xx
|| defed(
RT2880
|| defed(
RT2883
)

894 #i
	`defed
(
RT28xx
|| defed(
RT2880
)

895 
RFIC_2820
:

896 
RFIC_2850
:

897 
RFIC_2720
:

898 
RFIC_2750
:

900 
dex
 = 0; index < 
NUM_OF_2850_CHNL
; index++)

902 i(
Chl
 =
RFRegTab
[
dex
].Channel)

904 
R2
 = 
RFRegTab
[
dex
].R2;

905 i(
pAd
->
A
.
fld
.
TxPh
 == 1)

907 
R2
 |= 0x4000;

910 i(
pAd
->
A
.
fld
.
RxPh
 == 2

913 
R2
 |= 0x40;

915 i(
pAd
->
A
.
fld
.
RxPh
 == 1

918 
R2
 |= 0x20040;

921 i(
Chl
 > 14)

924 
R3
 = (
RFRegTab
[
dex
].R3 & 0xffffc1ff);

925 
R4
 = (
RFRegTab
[
dex
].R4 & (~0x001f87c0)| (
pAd
->
RfFqOfft
 << 15);

929 i((
TxPw
 >= -7) && (TxPwer < 0))

931 
TxPw
 = (7+TxPwer);

936 
R3
 |(
TxPw
 << 10);

937 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AsicSwchChl: TxPw=%d \n", 
TxPw
));

941 
TxPw
 = (TxPwer > 0xF) ? (0xF) : (TxPwer);

942 
R3
 |(
TxPw
 << 10) | (1 << 9);

946 i((
TxPw2
 >= -7) && (TxPwer2 < 0))

948 
TxPw2
 = (7+TxPwer2);

949 
TxPw2
 = (TxPwer2 > 0xF) ? (0xF) : (TxPwer2);

950 
R4
 |(
TxPw2
 << 7);

951 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AsicSwchChl: TxPw2=%d \n", 
TxPw2
));

955 
TxPw2
 = (TxPwer2 > 0xF) ? (0xF) : (TxPwer2);

956 
R4
 |(
TxPw2
 << 7) | (1 << 6);

961 
R3
 = (
RFRegTab
[
dex
].R3 & 0xffffc1ff| (
TxPw
 << 9);

962 
R4
 = (
RFRegTab
[
dex
].R4 & (~0x001f87c0)| (
pAd
->
RfFqOfft
 << 15| (
TxPw2
 <<6);

966 i(!
bSn
 && (
pAd
->
CommCfg
.
BBPCutBW
 =
BW_40
)

969 
R4
 |=0x200000;

973 
pAd
->
LchRfRegs
.
Chl
 = Channel;

974 
pAd
->
LchRfRegs
.
R1
 = 
RFRegTab
[
dex
].R1;

975 
pAd
->
LchRfRegs
.
R2
 = R2;

976 
pAd
->
LchRfRegs
.
R3
 = R3;

977 
pAd
->
LchRfRegs
.
R4
 = R4;

980 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R1
);

981 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R2
);

982 
	`RTMP_RF_IO_WRITE32
(
pAd
, (pAd->
LchRfRegs
.
R3
 & (~0x04)));

983 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R4
);

985 
	`RTMPucDay
(200);

988 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R1
);

989 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R2
);

990 
	`RTMP_RF_IO_WRITE32
(
pAd
, (pAd->
LchRfRegs
.
R3
 | 0x04));

991 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R4
);

993 
	`RTMPucDay
(200);

996 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R1
);

997 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R2
);

998 
	`RTMP_RF_IO_WRITE32
(
pAd
, (pAd->
LchRfRegs
.
R3
 & (~0x04)));

999 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R4
);

1005 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SwitchChannel#%d(RF=%d, Pwr0=%lu, Pwr1=%lu, %dT)o , R1=0x%08x, R2=0x%08x, R3=0x%08x, R4=0x%08x\n",

1006 
Chl
,

1007 
pAd
->
RfIcTy
,

1008 (
R3
 & 0x00003e00) >> 9,

1009 (
R4
 & 0x000007c0) >> 6,

1010 
pAd
->
A
.
fld
.
TxPh
,

1011 
pAd
->
LchRfRegs
.
R1
,

1012 
pAd
->
LchRfRegs
.
R2
,

1013 
pAd
->
LchRfRegs
.
R3
,

1014 
pAd
->
LchRfRegs
.
R4
));

1019 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SwitchChannel#%d : unknown RFIC=%d\n",

1020 
Chl
, 
pAd
->
RfIcTy
));

1026 i(
Chl
 <= 14)

1028 
ULONG
 
TxPCfg
 = 0x00050F0A;

1031 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R62
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

1032 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R63
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

1033 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R64
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

1034 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R86
, 0);

1038 i(
pAd
->
NicCfig2
.
fld
.
ExLNAFG
)

1040 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R82
, 0x62);

1041 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R75
, 0x46);

1045 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R82
, 0x84);

1046 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R75
, 0x50);

1051 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Vue
);

1052 
Vue
 &= (~0x6);

1053 
Vue
 |= (0x04);

1054 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

1059 i(
pAd
->
A
.
fld
.
TxPh
 == 1)

1061 
TxPCfg
 &= 0xFFFFFFF3;

1063 i(
pAd
->
A
.
fld
.
RxPh
 == 1)

1065 
TxPCfg
 &= 0xFFFFF3FF;

1069 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_PIN_CFG
, 
TxPCfg
);

1075 
ULONG
 
TxPCfg
 = 0x00050F05;

1076 
UINT8
 
bbpVue
;

1079 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R62
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

1080 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R63
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

1081 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R64
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

1082 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R86
, 0);

1085 
bbpVue
 = 0xF2;

1086 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R82
, 
bbpVue
);

1090 i(
pAd
->
NicCfig2
.
fld
.
ExLNAFA
)

1092 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R75
, 0x46);

1096 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R75
, 0x50);

1100 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Vue
);

1101 
Vue
 &= (~0x6);

1102 
Vue
 |= (0x02);

1103 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

1109 i(
pAd
->
A
.
fld
.
TxPh
 == 1)

1111 
TxPCfg
 &= 0xFFFFFFF3;

1113 i(
pAd
->
A
.
fld
.
RxPh
 == 1)

1115 
TxPCfg
 &= 0xFFFFF3FF;

1119 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_PIN_CFG
, 
TxPCfg
);

1129 i(
bSn
)

1130 
	`RTMPSAGCInVue
(
pAd
, 
BW_20
);

1132 
	`RTMPSAGCInVue
(
pAd
,Ad->
CommCfg
.
BBPCutBW
);

1139 
	`RTMPucDay
(1000);

1140 
	}
}

1155 
VOID
 
	$AsicLockChl
(

1156 
IN
 
PRTMP_ADAPTER
 
pAd
,

1157 
IN
 
UCHAR
 
Chl
)

1159 
	}
}

1171 #ifde
RTMP_INTERNAL_TX_ALC


1181 
VOID
 
	$InDesedTSSITab
(

1182 
IN
 
PRTMP_ADAPTER
 
pAd
)

1184 
UCHAR
 
TSSIBa
 = 0;

1185 
USHORT
 
TSSISpOv2d4G
 = 0;

1186 
UCHAR
 
RFVue
 = 0;

1187 
BBP_R49_STRUC
 
BbpR49
 = {0};

1188 
ULONG
 
i
 = 0;

1189 
CHAR
 
Tx0PowStg
 = 0;

1190 
USHORT
 
TxPow
 = 0, 
TxPowOFDM54
 = 0, 
mp
 = 0;

1192 i(
pAd
->
TxPowCl
.
bIlTxALC
 =
FALSE
)

1197 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("---> %s\n", 
__FUNCTION__
));

1199 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_TSSI_OVER_OFDM_54
, 
mp
);

1200 
TSSIBa
 = (
mp
 & 0x000F);

1202 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_TSSI_STEP_OVER_2DOT4G
 - 1), 
TSSISpOv2d4G
);

1203 
TSSISpOv2d4G
 = (0x000F & (TSSIStepOver2dot4G >> 8));

1205 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_OFDM_MCS6_MCS7
 - 1), 
TxPowOFDM54
);

1206 
TxPowOFDM54
 = (0x000F & (TxPowerOFDM54 >> 8));

1208 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: TSSIBase = %d, TSSIStepOver2dot4G = %d, TxPowerOFDM54 = %d\n",

1209 
__FUNCTION__
,

1210 
TSSIBa
,

1211 
TSSISpOv2d4G
,

1212 
TxPowOFDM54
));

1217 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_CCK_MCS0_MCS1
, 
TxPow
);

1218 
TxPow
 = (TxPower & 0x000F);

1219 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xDE = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1220 
desedTSSIOvCCK
[
MCS_0
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)) + 6);

1221 
desedTSSIOvCCK
[
MCS_1
] = desedTSSIOvCCK[
MCS_0
];

1222 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_CCK_MCS2_MCS3
 - 1), 
TxPow
);

1223 
TxPow
 = ((TxPower >> 8) & 0x000F);

1224 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xDF = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1225 
desedTSSIOvCCK
[
MCS_2
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)) + 6);

1226 
desedTSSIOvCCK
[
MCS_3
] = desedTSSIOvCCK[
MCS_2
];

1231 
i
 = 0; i < 4; i++)

1233 i(
desedTSSIOvCCK
[
i
] < 0x00)

1235 
desedTSSIOvCCK
[
i
] = 0x00;

1237 i(
desedTSSIOvCCK
[
i
] > 0x1F)

1239 
desedTSSIOvCCK
[
i
] = 0x1F;

1247 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: desiredTSSIOverCCK[0] = %d, desiredTSSIOverCCK[1] = %d, desiredTSSIOverCCK[2] = %d, desiredTSSIOverCCK[3] = %d\n",

1248 
__FUNCTION__
,

1249 
desedTSSIOvCCK
[0],

1250 
desedTSSIOvCCK
[1],

1251 
desedTSSIOvCCK
[2],

1252 
desedTSSIOvCCK
[3]));

1257 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_OFDM_MCS0_MCS1
, 
TxPow
);

1258 
TxPow
 = (TxPower & 0x000F);

1259 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xE0 = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1260 
desedTSSIOvOFDM
[
MCS_0
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1261 
desedTSSIOvOFDM
[
MCS_1
] = desedTSSIOvOFDM[
MCS_0
];

1262 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_OFDM_MCS2_MCS3
 - 1), 
TxPow
);

1263 
TxPow
 = ((TxPower >> 8) & 0x000F);

1264 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xE1 = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1265 
desedTSSIOvOFDM
[
MCS_2
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1266 
desedTSSIOvOFDM
[
MCS_3
] = desedTSSIOvOFDM[
MCS_2
];

1267 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_OFDM_MCS4_MCS5
, 
TxPow
);

1268 
TxPow
 = (TxPower & 0x000F);

1269 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xE2 = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1270 
desedTSSIOvOFDM
[
MCS_4
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1271 
desedTSSIOvOFDM
[
MCS_5
] = desedTSSIOvOFDM[
MCS_4
];

1272 
desedTSSIOvOFDM
[
MCS_6
] = 
TSSIBa
;

1273 
desedTSSIOvOFDM
[
MCS_7
] = 
TSSIBa
;

1278 
i
 = 0; i < 8; i++)

1280 i(
desedTSSIOvOFDM
[
i
] < 0x00)

1282 
desedTSSIOvOFDM
[
i
] = 0x00;

1284 i(
desedTSSIOvOFDM
[
i
] > 0x1F)

1286 
desedTSSIOvOFDM
[
i
] = 0x1F;

1294 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: desiredTSSIOverOFDM[0] = %d, desiredTSSIOverOFDM[1] = %d, desiredTSSIOverOFDM[2] = %d, desiredTSSIOverOFDM[3] = %d\n",

1295 
__FUNCTION__
,

1296 
desedTSSIOvOFDM
[0],

1297 
desedTSSIOvOFDM
[1],

1298 
desedTSSIOvOFDM
[2],

1299 
desedTSSIOvOFDM
[3]));

1300 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: desiredTSSIOverOFDM[4] = %d, desiredTSSIOverOFDM[5] = %d, desiredTSSIOverOFDM[6] = %d, desiredTSSIOverOFDM[7] = %d\n",

1301 
__FUNCTION__
,

1302 
desedTSSIOvOFDM
[4],

1303 
desedTSSIOvOFDM
[5],

1304 
desedTSSIOvOFDM
[6],

1305 
desedTSSIOvOFDM
[7]));

1310 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_HT_MCS0_MCS1
, 
TxPow
);

1311 
TxPow
 = (TxPower & 0x000F);

1312 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xE4 = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1313 
desedTSSIOvHT
[
MCS_0
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1314 
desedTSSIOvHT
[
MCS_1
] = desedTSSIOvHT[
MCS_0
];

1315 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_HT_MCS2_MCS3
 - 1), 
TxPow
);

1316 
TxPow
 = ((TxPower >> 8) & 0x000F);

1317 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xE5 = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1318 
desedTSSIOvHT
[
MCS_2
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1319 
desedTSSIOvHT
[
MCS_3
] = desedTSSIOvHT[
MCS_2
];

1320 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_HT_MCS4_MCS5
, 
TxPow
);

1321 
TxPow
 = (TxPower & 0x000F);

1322 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xE6 = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1323 
desedTSSIOvHT
[
MCS_4
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1324 
desedTSSIOvHT
[
MCS_5
] = desedTSSIOvHT[
MCS_4
];

1325 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_HT_MCS6_MCS7
 - 1), 
TxPow
);

1326 
TxPow
 = ((TxPower >> 8) & 0x000F);

1327 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xE7 = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1328 
desedTSSIOvHT
[
MCS_6
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1329 
desedTSSIOvHT
[
MCS_7
] = desedTSSIOvHT[
MCS_6
];

1334 
i
 = 0; i < 8; i++)

1336 i(
desedTSSIOvHT
[
i
] < 0x00)

1338 
desedTSSIOvHT
[
i
] = 0x00;

1340 i(
desedTSSIOvHT
[
i
] > 0x1F)

1342 
desedTSSIOvHT
[
i
] = 0x1F;

1350 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: desiredTSSIOverHT[0] = %d, desiredTSSIOverHT[1] = %d, desiredTSSIOverHT[2] = %d, desiredTSSIOverHT[3] = %d\n",

1351 
__FUNCTION__
,

1352 
desedTSSIOvHT
[0],

1353 
desedTSSIOvHT
[1],

1354 
desedTSSIOvHT
[2],

1355 
desedTSSIOvHT
[3]));

1356 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: desiredTSSIOverHT[4] = %d, desiredTSSIOverHT[5] = %d, desiredTSSIOverHT[6] = %d, desiredTSSIOverHT[7] = %d\n",

1357 
__FUNCTION__
,

1358 
desedTSSIOvHT
[4],

1359 
desedTSSIOvHT
[5],

1360 
desedTSSIOvHT
[6],

1361 
desedTSSIOvHT
[7]));

1366 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_HT_USING_STBC_MCS0_MCS1
, 
TxPow
);

1367 
TxPow
 = (TxPower & 0x000F);

1368 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xEC = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1369 
desedTSSIOvHTUsgSTBC
[
MCS_0
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1370 
desedTSSIOvHTUsgSTBC
[
MCS_1
] = desedTSSIOvHTUsgSTBC[
MCS_0
];

1371 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_HT_USING_STBC_MCS2_MCS3
 - 1), 
TxPow
);

1372 
TxPow
 = ((TxPower >> 8) & 0x000F);

1373 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xED = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1374 
desedTSSIOvHTUsgSTBC
[
MCS_2
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1375 
desedTSSIOvHTUsgSTBC
[
MCS_3
] = desedTSSIOvHTUsgSTBC[
MCS_2
];

1376 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_HT_USING_STBC_MCS4_MCS5
, 
TxPow
);

1377 
TxPow
 = (TxPower & 0x000F);

1378 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xEE = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1379 
desedTSSIOvHTUsgSTBC
[
MCS_4
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1380 
desedTSSIOvHTUsgSTBC
[
MCS_5
] = desedTSSIOvHTUsgSTBC[
MCS_4
];

1381 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_HT_USING_STBC_MCS6_MCS7
 - 1), 
TxPow
);

1382 
TxPow
 = ((TxPower >> 8) & 0x000F);

1383 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: 0xEF = 0x%X\n", 
__FUNCTION__
, 
TxPow
));

1384 
desedTSSIOvHTUsgSTBC
[
MCS_6
] = (
TSSIBa
 + ((
TxPow
 - 
TxPowOFDM54
* (
TSSISpOv2d4G
 * 2)));

1385 
desedTSSIOvHTUsgSTBC
[
MCS_7
] = desedTSSIOvHTUsgSTBC[
MCS_6
];

1390 
i
 = 0; i < 8; i++)

1392 i(
desedTSSIOvHTUsgSTBC
[
i
] < 0x00)

1394 
desedTSSIOvHTUsgSTBC
[
i
] = 0x00;

1396 i(
desedTSSIOvHTUsgSTBC
[
i
] > 0x1F)

1398 
desedTSSIOvHTUsgSTBC
[
i
] = 0x1F;

1406 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: desiredTSSIOverHTUsingSTBC[0] = %d, desiredTSSIOverHTUsingSTBC[1] = %d, desiredTSSIOverHTUsingSTBC[2] = %d, desiredTSSIOverHTUsingSTBC[3] = %d\n",

1407 
__FUNCTION__
,

1408 
desedTSSIOvHTUsgSTBC
[0],

1409 
desedTSSIOvHTUsgSTBC
[1],

1410 
desedTSSIOvHTUsgSTBC
[2],

1411 
desedTSSIOvHTUsgSTBC
[3]));

1412 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: desiredTSSIOverHTUsingSTBC[4] = %d, desiredTSSIOverHTUsingSTBC[5] = %d, desiredTSSIOverHTUsingSTBC[6] = %d, desiredTSSIOverHTUsingSTBC[7] = %d\n",

1413 
__FUNCTION__
,

1414 
desedTSSIOvHTUsgSTBC
[4],

1415 
desedTSSIOvHTUsgSTBC
[5],

1416 
desedTSSIOvHTUsgSTBC
[6],

1417 
desedTSSIOvHTUsgSTBC
[7]));

1419 
	`RT30xxRdRFRegi
(
pAd
, 
RF_R27
, (
PUCHAR
)(&
RFVue
));

1420 
RFVue
 = (RFValue | 0x88);

1421 
	`RT30xxWreRFRegi
(
pAd
, 
RF_R27
, 
RFVue
);

1423 
	`RT30xxRdRFRegi
(
pAd
, 
RF_R28
, (
PUCHAR
)(&
RFVue
));

1424 
RFVue
 = (RFValue & (~0x60));

1425 
	`RT30xxWreRFRegi
(
pAd
, 
RF_R28
, 
RFVue
);

1427 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R49
, &
BbpR49
.
by
);

1428 
BbpR49
.
fld
.
adc5__l
 = 1;

1429 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R49
, 
BbpR49
.
by
);

1431 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<--- %s\n", 
__FUNCTION__
));

1432 
	}
}

1446 
UCHAR
 
	$GDesedTSSI
(

1447 
IN
 
PRTMP_ADAPTER
 
pAd
)

1449 
PHTTRANSMIT_SETTING
 
pLeTxHTStg
 = (PHTTRANSMIT_SETTING)(&
pAd
->
LaTxRe
);

1450 
UCHAR
 
desedTSSI
 = 0;

1451 
UCHAR
 
MCS
 = 0;

1453 
MCS
 = (
UCHAR
)(
pLeTxHTStg
->
fld
.MCS);

1455 i(
pLeTxHTStg
->
fld
.
MODE
 =
MODE_CCK
)

1457 i((
MCS
 < 0) || (MCS > 3))

1459 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: incorrect MCS: MCS = %d\n",

1460 
__FUNCTION__
,

1461 
MCS
));

1463 
MCS
 = 0;

1466 
desedTSSI
 = 
desedTSSIOvCCK
[
MCS
];

1468 i(
pLeTxHTStg
->
fld
.
MODE
 =
MODE_OFDM
)

1470 i((
MCS
 < 0) || (MCS > 7))

1472 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: incorrect MCS: MCS = %d\n",

1473 
__FUNCTION__
,

1474 
MCS
));

1476 
MCS
 = 0;

1479 
desedTSSI
 = 
desedTSSIOvOFDM
[
MCS
];

1481 i((
pLeTxHTStg
->
fld
.
MODE
 =
MODE_HTMIX
|| (pLeTxHTStg->fld.MODE =
MODE_HTGREENFIELD
))

1483 i((
MCS
 < 0) || (MCS > 7))

1485 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: incorrect MCS: MCS = %d\n",

1486 
__FUNCTION__
,

1487 
MCS
));

1489 
MCS
 = 0;

1492 i(
pLeTxHTStg
->
fld
.
STBC
 == 1)

1494 
desedTSSI
 = 
desedTSSIOvHT
[
MCS
];

1498 
desedTSSI
 = 
desedTSSIOvHTUsgSTBC
[
MCS
];

1504 i((
pLeTxHTStg
->
fld
.
BW
 =
BW_40
&& (
MCS
 =
MCS_7
))

1506 
desedTSSI
 -= 1;

1510 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("%s: desiredTSSI = %d, Latest Tx HT setting: MODE = %d, MCS = %d, STBC = %d\n",

1511 
__FUNCTION__
,

1512 
desedTSSI
,

1513 
pLeTxHTStg
->
fld
.
MODE
,

1514 
pLeTxHTStg
->
fld
.
MCS
,

1515 
pLeTxHTStg
->
fld
.
STBC
));

1517 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("<--- %s\n", 
__FUNCTION__
));

1519  
desedTSSI
;

1520 
	}
}

1523 
VOID
 
	$AsicGAutoAgcOfft
(

1524 
IN
 
PRTMP_ADAPTER
 
pAd
,

1525 
IN
 
PCHAR
 
pDPwr
,

1526 
IN
 
PCHAR
 
pTٮDPwr
,

1527 
IN
 
PCHAR
 
pAgcComn
,

1528 
IN
 
PUCHAR
 
pBbpR49
)

1530 
CHAR
 
DPwr
 = 0;

1531 
BOOLEAN
 
bAutoTxAgc
 = 
FALSE
;

1532 
UCHAR
 
TssiRef
, *
pTssiMusBoundy
, *
pTssiPlusBoundy
, 
TxAgcSp
;

1534 
UCHAR
 
idx
;

1535 
PCHAR
 
pTxAgcComn
;

1536 
BBP_R49_STRUC
 
BbpR49
;

1537 
CHAR
 
TٮDPow
 = 0;

1538 #ifde
RTMP_INTERNAL_TX_ALC


1539 
UCHAR
 
desedTSSI
 = 0, 
cutTSSI
 = 0;

1540 
PTX_POWER_TUNING_ENTRY_STRUCT
 
pTxPowTungEry
 = 
NULL
;

1541 
UCHAR
 
RFVue
 = 0;

1543 #i
	`defed
(
RT3090
|| defed(
RT3572
|| defed(
RT3390
|| defed(
RT3593
)

1544 
ags
;

1547 
BbpR49
.
by
 = 0;

1549 #ifde
RTMP_INTERNAL_TX_ALC


1551 i(
pAd
->
TxPowCl
.
bIlTxALC
 =
TRUE
)

1553 i(
pAd
->
Mlme
.
OSecPiodicRound
 % 4 == 0)

1555 
desedTSSI
 = 
	`GDesedTSSI
(
pAd
);

1557 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R49
, &
BbpR49
.
by
);

1558 
cutTSSI
 = 
BbpR49
.
fld
.
TSSI
;

1560 i(
desedTSSI
 > 
cutTSSI
)

1562 
pAd
->
TxPowCl
.
idxTxPowTab
++;

1565 i(
desedTSSI
 < 
cutTSSI
)

1567 
pAd
->
TxPowCl
.
idxTxPowTab
--;

1570 i(
pAd
->
TxPowCl
.
idxTxPowTab
 < 
LOWERBOUND_TX_POWER_TUNING_ENTRY
)

1572 
pAd
->
TxPowCl
.
idxTxPowTab
 = 
LOWERBOUND_TX_POWER_TUNING_ENTRY
;

1575 i(
pAd
->
TxPowCl
.
idxTxPowTab
 >
UPPERBOUND_TX_POWER_TUNING_ENTRY
)

1577 
pAd
->
TxPowCl
.
idxTxPowTab
 = 
UPPERBOUND_TX_POWER_TUNING_ENTRY
;

1584 
pTxPowTungEry
 = &
TxPowTungTab
[
pAd
->
TxPowCl
.
idxTxPowTab
 + 
TX_POWER_TUNING_ENTRY_OFFSET
];

1585 
pAd
->
TxPowCl
.
RF_R12_Vue
 = 
pTxPowTungEry
->RF_R12_Value;

1586 
pAd
->
TxPowCl
.
MAC_PowD
 = 
pTxPowTungEry
->MAC_PowerDelta;

1591 
	`RT30xxRdRFRegi
(
pAd
, 
RF_R12
, (
PUCHAR
)(&
RFVue
));

1592 
RFVue
 = ((RFVu& 0xE0| 
pAd
->
TxPowCl
.
RF_R12_Vue
);

1593 
	`RT30xxWreRFRegi
(
pAd
, 
RF_R12
, (
UCHAR
)(
RFVue
));

1598 
TٮDPow
 +
pAd
->
TxPowCl
.
MAC_PowD
;

1600 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: desiredTSSI = %d, currentTSSI = %d, idxTxPowerTable = %d, {RF_R12_Value = %d, MAC_PowerDelta = %d}\n",

1601 
__FUNCTION__
,

1602 
desedTSSI
,

1603 
cutTSSI
,

1604 
pAd
->
TxPowCl
.
idxTxPowTab
,

1605 
pTxPowTungEry
->
RF_R12_Vue
,

1606 
pTxPowTungEry
->
MAC_PowD
));

1613 
	`RT30xxRdRFRegi
(
pAd
, 
RF_R12
, (
PUCHAR
)(&
RFVue
));

1614 
RFVue
 = ((RFVu& 0xE0| 
pAd
->
TxPowCl
.
RF_R12_Vue
);

1615 
	`RT30xxWreRFRegi
(
pAd
, 
RF_R12
, (
UCHAR
)(
RFVue
));

1620 
TٮDPow
 +
pAd
->
TxPowCl
.
MAC_PowD
;

1627 i(
pAd
->
Mlme
.
OSecPiodicRound
 % 4 == 0)

1629 i(
pAd
->
CommCfg
.
Chl
 <= 14)

1632 
bAutoTxAgc
 = 
pAd
->
bAutoTxAgcG
;

1633 
TssiRef
 = 
pAd
->
TssiRefG
;

1634 
pTssiMusBoundy
 = &
pAd
->
TssiMusBoundyG
[0];

1635 
pTssiPlusBoundy
 = &
pAd
->
TssiPlusBoundyG
[0];

1636 
TxAgcSp
 = 
pAd
->
TxAgcSpG
;

1637 
pTxAgcComn
 = &
pAd
->
TxAgcComnG
;

1642 
bAutoTxAgc
 = 
pAd
->
bAutoTxAgcA
;

1643 
TssiRef
 = 
pAd
->
TssiRefA
;

1644 
pTssiMusBoundy
 = &
pAd
->
TssiMusBoundyA
[0];

1645 
pTssiPlusBoundy
 = &
pAd
->
TssiPlusBoundyA
[0];

1646 
TxAgcSp
 = 
pAd
->
TxAgcSpA
;

1647 
pTxAgcComn
 = &
pAd
->
TxAgcComnA
;

1650 i(
bAutoTxAgc
)

1653 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R49
, &
BbpR49
.
by
);

1667 i(
BbpR49
.
by
 > 
pTssiMusBoundy
[1])

1671 
idx
 = 1; idx < 5; idx++)

1673 i(
BbpR49
.
by
 <
pTssiMusBoundy
[
idx
])

1678 *
pTxAgcComn
 = -(
TxAgcSp
 * (
idx
-1));

1682 
DPwr
 +(*
pTxAgcComn
);

1683 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("-- Tx Power, BBP R49=%x, TssiRef=%x, TxAgcStep=%x, step = -%d\n",

1684 
BbpR49
.
by
, 
TssiRef
, 
TxAgcSp
, 
idx
-1));

1686 i(
BbpR49
.
by
 < 
pTssiPlusBoundy
[1])

1690 
idx
 = 1; idx < 5; idx++)

1692 i(
BbpR49
.
by
 >
pTssiPlusBoundy
[
idx
])

1696 *
pTxAgcComn
 = 
TxAgcSp
 * (
idx
-1);

1697 
DPwr
 +(*
pTxAgcComn
);

1698 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("++ Tx Power, BBP R49=%x, TssiRef=%x, TxAgcStep=%x, step = +%d\n",

1699 
BbpR49
.
by
, 
TssiRef
, 
TxAgcSp
, 
idx
-1));

1703 *
pTxAgcComn
 = 0;

1704 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" Tx Power, BBP R49=%x, TssiRef=%x, TxAgcStep=%x, step = +%d\n",

1705 
BbpR49
.
by
, 
TssiRef
, 
TxAgcSp
, 0));

1711 i(
pAd
->
CommCfg
.
Chl
 <= 14)

1713 
bAutoTxAgc
 = 
pAd
->
bAutoTxAgcG
;

1714 
pTxAgcComn
 = &
pAd
->
TxAgcComnG
;

1718 
bAutoTxAgc
 = 
pAd
->
bAutoTxAgcA
;

1719 
pTxAgcComn
 = &
pAd
->
TxAgcComnA
;

1722 i(
bAutoTxAgc
)

1723 
DPwr
 +(*
pTxAgcComn
);

1726 *
pBbpR49
 = 
BbpR49
.
by
;

1727 *
pDPwr
 = 
DPwr
;

1728 *
pTٮDPwr
 = 
TٮDPow
;

1729 *
pAgcComn
 = *
pTxAgcComn
;

1730 
	}
}

1732 
VOID
 
	$AsicGTxPowOfft
(

1733 
IN
 
PRTMP_ADAPTER
 
pAd
,

1734 
IN
 
PULONG
 
TxPwr
)

1736 
CONFIGURATION_OF_TX_POWER_CONTROL_OVER_MAC
 
CfgOfTxPwrClOvMAC
;

1740 
CfgOfTxPwrClOvMAC
.
NumOfErs
 = 5;

1742 i(
pAd
->
CommCfg
.
BBPCutBW
 =
BW_40
)

1744 i(
pAd
->
CommCfg
.
CChl
 > 14)

1746 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[0].
MACRegiOfft
 = 
TX_PWR_CFG_0
;

1747 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[0].
RegiVue
 = 
pAd
->
Tx40MPwrCfgABd
[0];

1748 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[1].
MACRegiOfft
 = 
TX_PWR_CFG_1
;

1749 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[1].
RegiVue
 = 
pAd
->
Tx40MPwrCfgABd
[1];

1750 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[2].
MACRegiOfft
 = 
TX_PWR_CFG_2
;

1751 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[2].
RegiVue
 = 
pAd
->
Tx40MPwrCfgABd
[2];

1752 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[3].
MACRegiOfft
 = 
TX_PWR_CFG_3
;

1753 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[3].
RegiVue
 = 
pAd
->
Tx40MPwrCfgABd
[3];

1754 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[4].
MACRegiOfft
 = 
TX_PWR_CFG_4
;

1755 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[4].
RegiVue
 = 
pAd
->
Tx40MPwrCfgABd
[4];

1759 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[0].
MACRegiOfft
 = 
TX_PWR_CFG_0
;

1760 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[0].
RegiVue
 = 
pAd
->
Tx40MPwrCfgGBd
[0];

1761 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[1].
MACRegiOfft
 = 
TX_PWR_CFG_1
;

1762 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[1].
RegiVue
 = 
pAd
->
Tx40MPwrCfgGBd
[1];

1763 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[2].
MACRegiOfft
 = 
TX_PWR_CFG_2
;

1764 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[2].
RegiVue
 = 
pAd
->
Tx40MPwrCfgGBd
[2];

1765 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[3].
MACRegiOfft
 = 
TX_PWR_CFG_3
;

1766 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[3].
RegiVue
 = 
pAd
->
Tx40MPwrCfgGBd
[3];

1767 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[4].
MACRegiOfft
 = 
TX_PWR_CFG_4
;

1768 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[4].
RegiVue
 = 
pAd
->
Tx40MPwrCfgGBd
[4];

1773 i(
pAd
->
CommCfg
.
CChl
 > 14)

1775 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[0].
MACRegiOfft
 = 
TX_PWR_CFG_0
;

1776 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[0].
RegiVue
 = 
pAd
->
Tx20MPwrCfgABd
[0];

1777 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[1].
MACRegiOfft
 = 
TX_PWR_CFG_1
;

1778 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[1].
RegiVue
 = 
pAd
->
Tx20MPwrCfgABd
[1];

1779 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[2].
MACRegiOfft
 = 
TX_PWR_CFG_2
;

1780 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[2].
RegiVue
 = 
pAd
->
Tx20MPwrCfgABd
[2];

1781 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[3].
MACRegiOfft
 = 
TX_PWR_CFG_3
;

1782 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[3].
RegiVue
 = 
pAd
->
Tx20MPwrCfgABd
[3];

1783 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[4].
MACRegiOfft
 = 
TX_PWR_CFG_4
;

1784 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[4].
RegiVue
 = 
pAd
->
Tx20MPwrCfgABd
[4];

1788 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[0].
MACRegiOfft
 = 
TX_PWR_CFG_0
;

1789 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[0].
RegiVue
 = 
pAd
->
Tx20MPwrCfgGBd
[0];

1790 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[1].
MACRegiOfft
 = 
TX_PWR_CFG_1
;

1791 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[1].
RegiVue
 = 
pAd
->
Tx20MPwrCfgGBd
[1];

1792 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[2].
MACRegiOfft
 = 
TX_PWR_CFG_2
;

1793 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[2].
RegiVue
 = 
pAd
->
Tx20MPwrCfgGBd
[2];

1794 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[3].
MACRegiOfft
 = 
TX_PWR_CFG_3
;

1795 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[3].
RegiVue
 = 
pAd
->
Tx20MPwrCfgGBd
[3];

1796 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[4].
MACRegiOfft
 = 
TX_PWR_CFG_4
;

1797 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[4].
RegiVue
 = 
pAd
->
Tx20MPwrCfgGBd
[4];

1801 
	`NdisCyMemy
(
TxPwr
, (
UCHAR
 *)&
CfgOfTxPwrClOvMAC
, (CfgOfTxPwrCtrlOverMAC));

1805 
	}
}

1807 #ifde
SINGLE_SKU


1825 
VOID
 
	$AsicAdjuSgSkuTxPow
(

1826 
IN
 
PRTMP_ADAPTER
 
pAd
)

1828 
INT
 
i
, 
j
;

1829 
CHAR
 
DPwr
 = 0;

1830 
UCHAR
 
BbpR1
 = 0, 
BbpR49
 = 0, 
BbpR1Offt
 = 0;

1831 
CHAR
 
TxAgcComn
;

1833 
ULONG
 
TٮDPwr
[
MAX_TXPOWER_ARRAY_SIZE
];

1834 
CHAR
 
Vue
, 
MVue
 = 127;

1835 
CHAR
 
TٮDPow
 = 0;

1836 
CONFIGURATION_OF_TX_POWER_CONTROL_OVER_MAC
 
CfgOfTxPwrClOvMAC
 = {0};

1838 #ifde
CONFIG_STA_SUPPORT


1839 
CHAR
 
Rssi
 = -127;

1843 #ifde
CONFIG_STA_SUPPORT


1844 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
) ||

1845 #ifde
RTMP_MAC_PCI


1846 (
pAd
->
bPCIkOff
 =
TRUE
) ||

1847 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
) ||

1849 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

1854 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1855 
Rssi
 = 
	`RTMPMaxRssi
(
pAd
,

1856 
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
,

1857 
pAd
->
SCfg
.
RssiSame
.
AvgRssi1
,

1858 
pAd
->
SCfg
.
RssiSame
.
AvgRssi2
);

1861 
	`NdisZoMemy
(
TٮDPwr
, (TotalDeltaPwr));

1863 
	`AsicGTxPowOfft
(
pAd
, &
CfgOfTxPwrClOvMAC
);

1865 
	`AsicGAutoAgcOfft
(
pAd
, &
DPwr
, &
TٮDPow
, &
TxAgcComn
, &
BbpR49
);

1867 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R1
, &
BbpR1
);

1868 
BbpR1
 &= 0xFC;

1873 
UCHAR
 
TxPwrInEEPROM
 = 0xFF, 
CouryTxPwr
 = 0xFF, 
i
;

1875 
UCHAR
 
AdjuMaxTxPwr
[(
MAX_TX_PWR_CONTROL_OVER_MAC_REGISTERS
 * 8)];

1878 i(
pAd
->
CommCfg
.
Chl
 > 14)

1879 
TxPwrInEEPROM
 = ((
pAd
->
CommCfg
.
DefeMaxTxPwr
 & 0xFF00) >> 8);

1881 
TxPwrInEEPROM
 = (
pAd
->
CommCfg
.
DefeMaxTxPwr
 & 0x00FF);

1884 
CouryTxPwr
 = 
	`GCuryMaxTxPwr
(
pAd
,Ad->
CommCfg
.
Chl
);

1890 
i
 = (
UCHAR
)((
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[0].
RegiVue
 & 0x000F0000) >> 16);

1892 
	`DBGPRINT_RAW
(
RT_DEBUG_INFO
, ("AsicAdjuSgSkuTxPow (i=%d, TxPwrInEEPROM=%d, CouryTxPwr=%d)\n", 
i
, 
TxPwrInEEPROM
, 
CouryTxPwr
));

1896 
i
=0; i<
CfgOfTxPwrClOvMAC
.
NumOfErs
; i++)

1900 i(
i
 == 0)

1902 
j
=0; j<8; j++)

1905 
Vue
 = (
CHAR
)((
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 >> 
j
*4) & 0x0F);

1907 i(
j
 < 4)

1910 
AdjuMaxTxPwr
[
i
*8+
j
] = 
TxPwrInEEPROM
 + (
Vue
 - 
i
) + 4;

1914 
AdjuMaxTxPwr
[
i
*8+
j
] = 
TxPwrInEEPROM
 + (
Vue
 - 
i
);

1918 
	`DBGPRINT_RAW
(
RT_DEBUG_INFO
, ("AsicAdjustSingleSkuTxPower (offset = 0x%04X, i/j=%d/%d, Value=%d, %d)\n",

1919 
i
,

1920 
j
,

1921 
Vue
,

1922 
AdjuMaxTxPwr
[
i
*8+
j
],

1923 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
MACRegiOfft
));

1928 
j
=0; j<8; j++)

1930 
Vue
 = (
CHAR
)((
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 >> 
j
*4) & 0x0F);

1932 
AdjuMaxTxPwr
[
i
*8+
j
] = 
TxPwrInEEPROM
 + (
Vue
 - 
i
);

1935 
	`DBGPRINT_RAW
(
RT_DEBUG_INFO
, ("AsicAdjustSingleSkuTxPower (offset = 0x%04X, i/j=%d/%d, Value=%d, %d)\n",

1936 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
MACRegiOfft
,

1937 
i
,

1938 
j
,

1939 
Vue
,

1940 
AdjuMaxTxPwr
[
i
*8+
j
]));

1947 
i
=0; i<
CfgOfTxPwrClOvMAC
.
NumOfErs
; i++)

1950 i(
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 != 0xffffffff)

1952 
j
=0; j<8; j++)

1955 
Vue
 = (
CHAR
)((
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 >> 
j
*4) & 0x0F);

1958 i(
AdjuMaxTxPwr
[
i
*8+
j
] > 
CouryTxPwr
)

1960 
Vue
 = (
AdjuMaxTxPwr
[
i
*8+
j
] - 
CouryTxPwr
);

1961 i(
Vue
 > 0xF)

1966 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,("AsicAdjuSgSkuTxPow: Vuovow - %d\n", 
Vue
));

1968 
TٮDPwr
[
i
] = (TٮDPwr[i] & ~(0x0000000F << 
j
*4)| (
Vue
 << j*4);

1971 
	`DBGPRINT_RAW
(
RT_DEBUG_INFO
,("AsicAdjustSingleSkuTxPower (offset = 0x%04X, i/j=%d/%d, Value=%d, %d)\n",

1972 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
MACRegiOfft
,

1973 
i
,

1974 
j
,

1975 
Vue
,

1976 
AdjuMaxTxPwr
[
i
*8+
j
]));

1981 
	`DBGPRINT_RAW
(
RT_DEBUG_INFO
,("AsicAdjustSingleSkuTxPower (offset = 0x%04X, i/j=%d/%d, Value=%d, %d,o change)\n",

1982 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
MACRegiOfft
,

1983 
i
,

1984 
j
,

1985 
Vue
,

1986 
AdjuMaxTxPwr
[
i
*8+
j
]));

1991 } 
FALSE
);

1995 
DPwr
 +
TٮDPow
;

2000 i(
pAd
->
CommCfg
.
TxPowPage
 == 0xffffffff)

2002 #ifde
CONFIG_STA_SUPPORT


2003 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2006 i(
Rssi
 > -35)

2008 
DPwr
 -= 12;

2010 i(
Rssi
 > -40)

2012 
DPwr
 -= 6;

2019 i(
pAd
->
CommCfg
.
TxPowPage
 > 90)

2021 i(
pAd
->
CommCfg
.
TxPowPage
 > 60)

2023 
DPwr
 -= 1;

2025 i(
pAd
->
CommCfg
.
TxPowPage
 > 30)

2027 
DPwr
 -= 3;

2029 i(
pAd
->
CommCfg
.
TxPowPage
 > 15)

2031 
DPwr
 -= 6;

2033 i(
pAd
->
CommCfg
.
TxPowPage
 > 9)

2035 
DPwr
 -= 9;

2039 
DPwr
 -= 12;

2046 
i
=0; i<
CfgOfTxPwrClOvMAC
.
NumOfErs
; i++)

2049 i(
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 != 0xffffffff)

2051 
j
=0; j<8; j++)

2056 
CHAR
 
PwrChge
;

2061 
Vue
 = (
CHAR
)((
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 >> 
j
*4) & 0x0F);

2064 i(
Vue
 == 0xF)

2068 
PwrChge
 = (
CHAR
)((
TٮDPwr
[
i
] >> 
j
*4) & 0x0F);

2069 
PwrChge
 -
DPwr
;

2071 
Vue
 -
PwrChge
;

2073 if(
MVue
 > 
Vue
)

2074 
MVue
 = 
Vue
;

2082 if((
MVue
 < 0)&&(MinValue >= -6))

2084 
BbpR1
 |= 0x01;

2085 
BbpR1Offt
 = 6;

2087 i((
MVue
 < -6)&&(MinValue >= -12))

2089 
BbpR1
 |= 0x02;

2090 
BbpR1Offt
 = 12;

2092 i(
MVue
 < -12)

2094 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("AsicAdjustTxPower: ASICimit..\n"));

2095 
BbpR1
 |= 0x02;

2096 
BbpR1Offt
 = 12;

2099 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
BbpR1
);

2103 
i
=0; i < 
CfgOfTxPwrClOvMAC
.
NumOfErs
; i++)

2106 i(
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 != 0xffffffff)

2108 
j
=0; j<8; j++)

2113 
CHAR
 
PwrChge
;

2118 
Vue
 = (
CHAR
)((
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 >> 
j
*4) & 0x0F);

2121 
PwrChge
 = (
CHAR
)((
TٮDPwr
[
i
] >> 
j
*4) & 0x0F);

2122 
PwrChge
 -
DPwr
;

2124 
Vue
 -(
PwrChge
 - 
BbpR1Offt
);

2126 i(
Vue
 < 0)

2127 
Vue
 = 0;

2129 i(
Vue
 > 0xF)

2130 
Vue
 = 0xF;

2134 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 = (CfgOfTxPwrClOvMAC.TxPwrClOvMAC[i].RegiVu& ~(0x0000000F << 
j
*4)| (
Vue
 << j*4);

2143 
	`RTMP_IO_WRITE32
(
pAd
, 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
MACRegiOfft
, CfgOfTxPwrClOvMAC.TxPwrClOvMAC[i].
RegiVue
);

2150 
	}
}

2170 
	#MDSM_NORMAL_TX_POWER
 0x00

	)

2171 
	#MDSM_DROP_TX_POWER_BY_6dBm
 0x01

	)

2172 
	#MDSM_DROP_TX_POWER_BY_12dBm
 0x02

	)

2173 
	#MDSM_ADD_TX_POWER_BY_6dBm
 0x03

	)

2174 
	#MDSM_BBP_R1_STATIC_TX_POWER_CONTROL_MASK
 0x03

	)

2175 
VOID
 
	$AsicAdjuTxPow
(

2176 
IN
 
PRTMP_ADAPTER
 
pAd
)

2178 
INT
 
i
, 
j
;

2179 
CHAR
 
DPwr
 = 0;

2180 
UCHAR
 
BbpR1
 = 0, 
BbpR49
 = 0;

2181 
CHAR
 
TxAgcComn
;

2183 
CHAR
 
Vue
;

2184 
CHAR
 
DPowByBbpR1
 = 0;

2185 
CHAR
 
TٮDPow
 = 0;

2186 
CONFIGURATION_OF_TX_POWER_CONTROL_OVER_MAC
 
CfgOfTxPwrClOvMAC
 = {0};

2188 #ifde
CONFIG_STA_SUPPORT


2189 
CHAR
 
Rssi
 = -127;

2192 #ifde
CONFIG_STA_SUPPORT


2193 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
) ||

2194 #ifde
RTMP_MAC_PCI


2195 (
pAd
->
bPCIkOff
 =
TRUE
) ||

2196 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
) ||

2198 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

2203 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2204 
Rssi
 = 
	`RTMPMaxRssi
(
pAd
,

2205 
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
,

2206 
pAd
->
SCfg
.
RssiSame
.
AvgRssi1
,

2207 
pAd
->
SCfg
.
RssiSame
.
AvgRssi2
);

2210 #ifde
SINGLE_SKU


2211 i(
pAd
->
CommCfg
.
bSKUMode
 =
TRUE
)

2213 
	`AsicAdjuSgSkuTxPow
(
pAd
);

2220 
	`AsicGTxPowOfft
(
pAd
, (
PULONG
&
CfgOfTxPwrClOvMAC
);

2222 
	`AsicGAutoAgcOfft
(
pAd
, &
DPwr
, &
TٮDPow
, &
TxAgcComn
, &
BbpR49
);

2224 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R1
, &
BbpR1
);

2225 
BbpR1
 &= 0xFC;

2230 i(
pAd
->
CommCfg
.
TxPowPage
 == 0xffffffff)

2232 #ifde
CONFIG_STA_SUPPORT


2233 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2236 i(
Rssi
 > -35)

2238 
BbpR1
 |= 0x02;

2240 i(
Rssi
 > -40)

2242 
BbpR1
 |= 0x01;

2249 i(
pAd
->
CommCfg
.
TxPowPage
 > 90)

2251 i(
pAd
->
CommCfg
.
TxPowPage
 > 60)

2253 
DPwr
 -= 1;

2255 i(
pAd
->
CommCfg
.
TxPowPage
 > 30)

2257 
DPwr
 -= 3;

2259 i(
pAd
->
CommCfg
.
TxPowPage
 > 15)

2261 
DPowByBbpR1
 -= 6;

2263 i(
pAd
->
CommCfg
.
TxPowPage
 > 9)

2265 
DPowByBbpR1
 -= 6;

2266 
DPwr
 -= 3;

2270 
DPowByBbpR1
 -= 12;

2272 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
BbpR1
);

2275 
TٮDPow
 +
DPowByBbpR1
;

2276 
TٮDPow
 +
DPwr
;

2279 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R1
, &
BbpR1
);

2280 
BbpR1
 &~
MDSM_BBP_R1_STATIC_TX_POWER_CONTROL_MASK
;

2282 i(
TٮDPow
 <= -12)

2284 
TٮDPow
 += 12;

2285 
BbpR1
 |
MDSM_DROP_TX_POWER_BY_12dBm
;

2287 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
BbpR1
);

2289 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("TPC: %s: Dr݁hsmow by 12 dBm (BBP R1)\n", 
__FUNCTION__
));

2291 i((
TٮDPow
 <= -6) && (TotalDeltaPower > -12))

2293 
TٮDPow
 += 6;

2294 
BbpR1
 |
MDSM_DROP_TX_POWER_BY_6dBm
;

2296 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
BbpR1
);

2298 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("TPC: %s: Dr݁hsmow by 6 dBm (BBP R1)\n", 
__FUNCTION__
));

2303 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
BbpR1
);

2308 
i
=0; i < 
CfgOfTxPwrClOvMAC
.
NumOfErs
; i++)

2310 i(
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 != 0xffffffff)

2312 
j
=0; j<8; j++)

2314 
Vue
 = (
CHAR
)((
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 >> 
j
*4) & 0x0F);

2316 #ifde
RTMP_INTERNAL_TX_ALC


2318 i(
pAd
->
TxPowCl
.
bIlTxALC
 =
TRUE
)

2320 
TX_PWR_CFG_0
 + (
i
 * 4))

2322 
TX_PWR_CFG_0
:

2324 i((
Vue
 + 
TٮDPow
) < 0)

2326 
Vue
 = 0;

2328 i((
Vue
 + 
TٮDPow
) > 0xE)

2330 
Vue
 = 0xE;

2334 
Vue
 +
TٮDPow
;

2339 
TX_PWR_CFG_1
:

2341 i((
j
 >= 0) && (j <= 3))

2343 i((
Vue
 + 
TٮDPow
) < 0)

2345 
Vue
 = 0;

2347 i((
Vue
 + 
TٮDPow
) > 0xC)

2349 
Vue
 = 0xC;

2353 
Vue
 +
TٮDPow
;

2358 i((
Vue
 + 
TٮDPow
) < 0)

2360 
Vue
 = 0;

2362 i((
Vue
 + 
TٮDPow
) > 0xE)

2364 
Vue
 = 0xE;

2368 
Vue
 +
TٮDPow
;

2374 
TX_PWR_CFG_2
:

2376 i((
j
 == 0) || (j == 2) || (j == 3))

2378 i((
Vue
 + 
TٮDPow
) < 0)

2380 
Vue
 = 0;

2382 i((
Vue
 + 
TٮDPow
) > 0xC)

2384 
Vue
 = 0xC;

2388 
Vue
 +
TٮDPow
;

2393 i((
Vue
 + 
TٮDPow
) < 0)

2395 
Vue
 = 0;

2397 i((
Vue
 + 
TٮDPow
) > 0xE)

2399 
Vue
 = 0xE;

2403 
Vue
 +
TٮDPow
;

2409 
TX_PWR_CFG_3
:

2411 i((
j
 == 0) || (j == 2) || (j == 3) ||

2412 ((
j
 >= 4) && (j <= 7)))

2414 i((
Vue
 + 
TٮDPow
) < 0)

2416 
Vue
 = 0;

2418 i((
Vue
 + 
TٮDPow
) > 0xC)

2420 
Vue
 = 0xC;

2424 
Vue
 +
TٮDPow
;

2429 i((
Vue
 + 
TٮDPow
) < 0)

2431 
Vue
 = 0;

2433 i((
Vue
 + 
TٮDPow
) > 0xE)

2435 
Vue
 = 0xE;

2439 
Vue
 +
TٮDPow
;

2445 
TX_PWR_CFG_4
:

2447 i((
Vue
 + 
TٮDPow
) < 0)

2449 
Vue
 = 0;

2451 i((
Vue
 + 
TٮDPow
) > 0xC)

2453 
Vue
 = 0xC;

2457 
Vue
 +
TٮDPow
;

2465 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: unknownegister = 0x%X\n",

2466 
__FUNCTION__
,

2467 (
TX_PWR_CFG_0
 + (
i
 * 4))));

2475 i((
Vue
 + 
TٮDPow
) < 0)

2477 
Vue
 = 0;

2479 i((
Vue
 + 
TٮDPow
) > 0xC)

2481 
Vue
 = 0xC;

2485 
Vue
 +
TٮDPow
;

2489 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
RegiVue
 = (CfgOfTxPwrClOvMAC.TxPwrClOvMAC[i].RegiVu& ~(0x0000000F << 
j
*4)| (
Vue
 << j*4);

2501 
	`RTMP_IO_WRITE32
(
pAd
, 
CfgOfTxPwrClOvMAC
.
TxPwrClOvMAC
[
i
].
MACRegiOfft
, CfgOfTxPwrClOvMAC.TxPwrClOvMAC[i].
RegiVue
);

2508 
	}
}

2511 #ifde
CONFIG_STA_SUPPORT


2512 
VOID
 
	$AsicRetBBPAgt
(

2513 
IN
 
PRTMP_ADAPTER
 
pAd
)

2515 
BBP_CSR_CFG_STRUC
 
BbpC
;

2516 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Reset BBP Agent busy bit.!! \n"));

2518 
	`RTMP_IO_READ32
(
pAd
, 
H2M_BBP_AGENT
, &
BbpC
.
wd
);

2519 
BbpC
.
fld
.
Busy
 = 0;

2520 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_BBP_AGENT
, 
BbpC
.
wd
);

2521 
	}
}

2534 
VOID
 
	$AsicS˕ThAutoWakeup
(

2535 
IN
 
PRTMP_ADAPTER
 
pAd
,

2536 
IN
 
USHORT
 
TbNumToNextWakeUp
)

2538 
	`RTMP_STA_SLEEP_THEN_AUTO_WAKEUP
(
pAd
, 
TbNumToNextWakeUp
);

2539 
	}
}

2549 
VOID
 
	$AsicFS˕
(

2550 
IN
 
PRTMP_ADAPTER
 
pAd
)

2553 
	}
}

2565 
VOID
 
	$AsicFWakeup
(

2566 
IN
 
PRTMP_ADAPTER
 
pAd
,

2567 
IN
 
BOOLEAN
 
bFromTx
)

2569 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("--> AsicForceWakeup \n"));

2570 
	`RTMP_STA_FORCE_WAKEUP
(
pAd
, 
bFromTx
);

2571 
	}
}

2584 
VOID
 
	$AsicSBssid
(

2585 
IN
 
PRTMP_ADAPTER
 
pAd
,

2586 
IN
 
PUCHAR
 
pBssid
)

2588 
ULONG
 
Addr4
;

2589 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==============> AsicSetBssid %x:%x:%x:%x:%x:%x\n",

2590 
pBssid
[0],pBssid[1],pBssid[2],pBssid[3],Bssid[4],pBssid[5]));

2592 
Addr4
 = (
ULONG
)(
pBssid
[0]) |

2593 (
ULONG
)(
pBssid
[1] << 8) |

2594 (
ULONG
)(
pBssid
[2] << 16) |

2595 (
ULONG
)(
pBssid
[3] << 24);

2596 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_BSSID_DW0
, 
Addr4
);

2598 
Addr4
 = 0;

2600 
Addr4
 = (
ULONG
)(
pBssid
[4]) | (ULONG)(pBssid[5] << 8);

2602 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_BSSID_DW1
, 
Addr4
);

2603 
	}
}

2605 
VOID
 
	$AsicSMWC
(

2606 
IN
 
PRTMP_ADAPTER
 
pAd
)

2608 
MAC_TABLE_ENTRY
 *
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
MCAST_WCID
];

2609 
USHORT
 
offt
;

2611 
pEry
->
S
 = 
SST_ASSOC
;

2612 
pEry
->
Aid
 = 
MCAST_WCID
;

2613 
pEry
->
PsMode
 = 
PWR_ACTIVE
;

2614 
pEry
->
CuTxRe
 = 
pAd
->
CommCfg
.
MlmeRe
;

2615 
offt
 = 
MAC_WCID_BASE
 + 
BSS0M_WCID
 * 
HW_WCID_ENTRY_SIZE
;

2616 
	}
}

2626 
VOID
 
	$AsicDWcidTab
(

2627 
IN
 
PRTMP_ADAPTER
 
pAd
,

2628 
IN
 
UCHAR
 
Wcid
)

2630 
ULONG
 
Addr0
 = 0x0, 
Addr1
 = 0x0;

2631 
ULONG
 
offt
;

2633 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AsicDWcidTab==>Wcid = 0x%x\n",
Wcid
));

2634 
offt
 = 
MAC_WCID_BASE
 + 
Wcid
 * 
HW_WCID_ENTRY_SIZE
;

2635 
	`RTMP_IO_WRITE32
(
pAd
, 
offt
, 
Addr0
);

2636 
offt
 += 4;

2637 
	`RTMP_IO_WRITE32
(
pAd
, 
offt
, 
Addr1
);

2638 
	}
}

2640 #ifde
DOT11_N_SUPPORT


2649 
VOID
 
	$AsicEbRDG
(

2650 
IN
 
PRTMP_ADAPTER
 
pAd
)

2652 
TX_LINK_CFG_STRUC
 
TxLkCfg
;

2653 
UINT32
 
Da
 = 0;

2655 
	`RTMP_IO_READ32
(
pAd
, 
TX_LINK_CFG
, &
TxLkCfg
.
wd
);

2656 
TxLkCfg
.
fld
.
TxRDGEn
 = 1;

2657 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_LINK_CFG
, 
TxLkCfg
.
wd
);

2659 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC0_CFG
, &
Da
);

2660 
Da
 &= 0xFFFFFF00;

2661 
Da
 |= 0x80;

2662 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC0_CFG
, 
Da
);

2665 
	}
}

2675 
VOID
 
	$AsicDibRDG
(

2676 
IN
 
PRTMP_ADAPTER
 
pAd
)

2678 
TX_LINK_CFG_STRUC
 
TxLkCfg
;

2679 
UINT32
 
Da
 = 0;

2683 
	`RTMP_IO_READ32
(
pAd
, 
TX_LINK_CFG
, &
TxLkCfg
.
wd
);

2684 
TxLkCfg
.
fld
.
TxRDGEn
 = 0;

2685 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_LINK_CFG
, 
TxLkCfg
.
wd
);

2687 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC0_CFG
, &
Da
);

2689 
Da
 &= 0xFFFFFF00;

2691 #ide
WIFI_TEST


2695 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_DYNAMIC_BE_TXOP_ACTIVE
)

2696 #ifde
DOT11_N_SUPPORT


2697 && (
pAd
->
MacTab
.
fAnyStiMIMOPSDymic
 =
FALSE
)

2702 i(
pAd
->
CommCfg
.
bEbTxBur
)

2703 
Da
 |= 0x20;

2705 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC0_CFG
, 
Da
);

2707 
	}
}

2719 
VOID
 
	$AsicDibSync
(

2720 
IN
 
PRTMP_ADAPTER
 
pAd
)

2722 
BCN_TIME_CFG_STRUC
 
c
;

2724 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--->Disable TSF synchronization\n"));

2729 
pAd
->
TbTickCou
 = 0;

2730 
	`RTMP_IO_READ32
(
pAd
, 
BCN_TIME_CFG
, &
c
.
wd
);

2731 
c
.
fld
.
bBcG
 = 0;

2732 
c
.
fld
.
bTBTTEb
 = 0;

2733 
c
.
fld
.
TsfSyncMode
 = 0;

2734 
c
.
fld
.
bTsfTickg
 = 0;

2735 
	`RTMP_IO_WRITE32
(
pAd
, 
BCN_TIME_CFG
, 
c
.
wd
);

2737 
	}
}

2747 
VOID
 
	$AsicEbBssSync
(

2748 
IN
 
PRTMP_ADAPTER
 
pAd
)

2750 
BCN_TIME_CFG_STRUC
 
c
;

2752 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--->AsicEnableBssSync(INFRA mode)\n"));

2754 
	`RTMP_IO_READ32
(
pAd
, 
BCN_TIME_CFG
, &
c
.
wd
);

2756 #ifde
CONFIG_STA_SUPPORT


2757 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2759 
c
.
fld
.
BcIv
 = 
pAd
->
CommCfg
.
BcPiod
 << 4;

2760 
c
.
fld
.
bTsfTickg
 = 1;

2761 
c
.
fld
.
TsfSyncMode
 = 1;

2762 
c
.
fld
.
bBcG
 = 0;

2763 
c
.
fld
.
bTBTTEb
 = 1;

2766 
	`RTMP_IO_WRITE32
(
pAd
, 
BCN_TIME_CFG
, 
c
.
wd
);

2767 
	}
}

2781 
VOID
 
	$AsicEbIbssSync
(

2782 
IN
 
PRTMP_ADAPTER
 
pAd
)

2784 
BCN_TIME_CFG_STRUC
 
c9
;

2785 
PUCHAR
 
r
;

2786 
UINT
 
i
;

2787 
ULONG
 
bcBaLoti
 = 0;

2788 
USHORT
 
bcL
 = 
pAd
->
BcTxWI
.
MPDUtٮByCou
;

2789 #ifde
SPECIFIC_BCN_BUF_SUPPORT


2790 
qFg
;

2793 #ifde
RT_BIG_ENDIAN


2794 
TXWI_STRUC
 
lolTxWI
;

2796 
	`NdisMoveMemy
((
PUCHAR
)&
lolTxWI
, (PUCHAR)&
pAd
->
BcTxWI
, 
TXWI_SIZE
);

2797 
	`RTMPWIEndnChge
((
PUCHAR
)&
lolTxWI
, 
TYPE_TXWI
);

2798 
bcL
 = 
lolTxWI
.
MPDUtٮByCou
;

2801 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--->AsicEbIbssSync(MPDUtٮByCou=%d, bcL=%d)\n", 
pAd
->
BcTxWI
.
MPDUtٮByCou
, 
bcL
));

2804 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--->AsicEbIbssSync(ADHOC mode. MPDUtٮByCou = %d)\n", 
pAd
->
BcTxWI
.
MPDUtٮByCou
));

2806 
	`RTMP_IO_READ32
(
pAd
, 
BCN_TIME_CFG
, &
c9
.
wd
);

2807 
c9
.
fld
.
bBcG
 = 0;

2808 
c9
.
fld
.
bTBTTEb
 = 0;

2809 
c9
.
fld
.
bTsfTickg
 = 0;

2810 
	`RTMP_IO_WRITE32
(
pAd
, 
BCN_TIME_CFG
, 
c9
.
wd
);

2813 
bcBaLoti
 = 
HW_BEACON_BASE0
;

2816 #ifde
SPECIFIC_BCN_BUF_SUPPORT


2817 
	`RTMP_MAC_SHR_MSEL_LOCK
(
pAd
, 
HIGHER_SHRMEM
, 
qFg
);

2820 #ifde
RTMP_MAC_PCI


2822 
r
 = (
PUCHAR
)&
pAd
->
BcTxWI
;

2823 
i
=0; i<
TXWI_SIZE
; i+=4)

2825 
UINT32
 
lgr
 = *
r
 + (*(ptr+1)<<8) + (*(ptr+2)<<16) + (*(ptr+3)<<24);

2826 
	`RTMP_IO_WRITE32
(
pAd
, 
HW_BEACON_BASE0
 + 
i
, 
lgr
);

2827 
r
 += 4;

2831 
r
 = 
pAd
->
BcBuf
;

2832 
i
=0; i< 
pAd
->
BcTxWI
.
MPDUtٮByCou
; i+=4)

2834 
UINT32
 
lgr
 = *
r
 + (*(ptr+1)<<8) + (*(ptr+2)<<16) + (*(ptr+3)<<24);

2835 
	`RTMP_IO_WRITE32
(
pAd
, 
HW_BEACON_BASE0
 + 
TXWI_SIZE
 + 
i
, 
lgr
);

2836 
r
 +=4;

2845 #ifde
SPECIFIC_BCN_BUF_SUPPORT


2846 
	`RTMP_MAC_SHR_MSEL_UNLOCK
(
pAd
, 
LOWER_SHRMEM
, 
qFg
);

2856 
c9
.
fld
.
BcIv
 = 
pAd
->
CommCfg
.
BcPiod
 << 4;

2857 
c9
.
fld
.
bTsfTickg
 = 1;

2858 
c9
.
fld
.
TsfSyncMode
 = 2;

2859 
c9
.
fld
.
bTBTTEb
 = 1;

2860 
c9
.
fld
.
bBcG
 = 1;

2861 
	`RTMP_IO_WRITE32
(
pAd
, 
BCN_TIME_CFG
, 
c9
.
wd
);

2862 
	}
}

2873 
VOID
 
	$AsicSEdPm
(

2874 
IN
 
PRTMP_ADAPTER
 
pAd
,

2875 
IN
 
PEDCA_PARM
 
pEdPm
)

2877 
EDCA_AC_CFG_STRUC
 
Ac0Cfg
, 
Ac1Cfg
, 
Ac2Cfg
, 
Ac3Cfg
;

2878 
AC_TXOP_CSR0_STRUC
 
c0
;

2879 
AC_TXOP_CSR1_STRUC
 
c1
;

2880 
AIFSN_CSR_STRUC
 
AifC
;

2881 
CWMIN_CSR_STRUC
 
CwmC
;

2882 
CWMAX_CSR_STRUC
 
CwmaxC
;

2883 
i
;

2885 
Ac0Cfg
.
wd
 = 0;

2886 
Ac1Cfg
.
wd
 = 0;

2887 
Ac2Cfg
.
wd
 = 0;

2888 
Ac3Cfg
.
wd
 = 0;

2889 i((
pEdPm
 =
NULL
|| (pEdPm->
bVid
 =
FALSE
))

2891 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("AsicSetEdcaParm\n"));

2892 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_WMM_INUSED
);

2893 
i
=0; i<
MAX_LEN_OF_MAC_TABLE
; i++)

2895 i(
	`IS_ENTRY_CLIENT
(&
pAd
->
MacTab
.
Cڋ
[
i
]|| 
	`IS_ENTRY_APCLI
(&pAd->MacTab.Content[i]))

2896 
	`CLIENT_STATUS_CLEAR_FLAG
(&
pAd
->
MacTab
.
Cڋ
[
i
], 
fCLIENT_STATUS_WMM_CAPABLE
);

2903 if
pAd
->
CommCfg
.
bEbTxBur
 )

2906 
Ac0Cfg
.
fld
.
AcTx
 = 0x20;

2909 
Ac0Cfg
.
fld
.
AcTx
 = 0;

2913 
Ac0Cfg
.
fld
.
Cwm
 = 
CW_MIN_IN_BITS
;

2914 
Ac0Cfg
.
fld
.
Cwmax
 = 
CW_MAX_IN_BITS
;

2915 
Ac0Cfg
.
fld
.
Aif
 = 2;

2916 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC0_CFG
, 
Ac0Cfg
.
wd
);

2918 
Ac1Cfg
.
fld
.
AcTx
 = 0;

2919 
Ac1Cfg
.
fld
.
Cwm
 = 
CW_MIN_IN_BITS
;

2920 
Ac1Cfg
.
fld
.
Cwmax
 = 
CW_MAX_IN_BITS
;

2921 
Ac1Cfg
.
fld
.
Aif
 = 2;

2922 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC1_CFG
, 
Ac1Cfg
.
wd
);

2924 i(
pAd
->
CommCfg
.
PhyMode
 =
PHY_11B
)

2926 
Ac2Cfg
.
fld
.
AcTx
 = 192;

2927 
Ac3Cfg
.
fld
.
AcTx
 = 96;

2931 
Ac2Cfg
.
fld
.
AcTx
 = 96;

2932 
Ac3Cfg
.
fld
.
AcTx
 = 48;

2934 
Ac2Cfg
.
fld
.
Cwm
 = 
CW_MIN_IN_BITS
;

2935 
Ac2Cfg
.
fld
.
Cwmax
 = 
CW_MAX_IN_BITS
;

2936 
Ac2Cfg
.
fld
.
Aif
 = 2;

2937 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC2_CFG
, 
Ac2Cfg
.
wd
);

2938 
Ac3Cfg
.
fld
.
Cwm
 = 
CW_MIN_IN_BITS
;

2939 
Ac3Cfg
.
fld
.
Cwmax
 = 
CW_MAX_IN_BITS
;

2940 
Ac3Cfg
.
fld
.
Aif
 = 2;

2941 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC3_CFG
, 
Ac3Cfg
.
wd
);

2946 
c0
.
fld
.
Ac0Tx
 = 0;

2947 
c0
.
fld
.
Ac1Tx
 = 0;

2948 
	`RTMP_IO_WRITE32
(
pAd
, 
WMM_TXOP0_CFG
, 
c0
.
wd
);

2949 i(
pAd
->
CommCfg
.
PhyMode
 =
PHY_11B
)

2951 
c1
.
fld
.
Ac2Tx
 = 192;

2952 
c1
.
fld
.
Ac3Tx
 = 96;

2956 
c1
.
fld
.
Ac2Tx
 = 96;

2957 
c1
.
fld
.
Ac3Tx
 = 48;

2959 
	`RTMP_IO_WRITE32
(
pAd
, 
WMM_TXOP1_CFG
, 
c1
.
wd
);

2961 
CwmC
.
wd
 = 0;

2962 
CwmC
.
fld
.
Cwm0
 = 
CW_MIN_IN_BITS
;

2963 
CwmC
.
fld
.
Cwm1
 = 
CW_MIN_IN_BITS
;

2964 
CwmC
.
fld
.
Cwm2
 = 
CW_MIN_IN_BITS
;

2965 
CwmC
.
fld
.
Cwm3
 = 
CW_MIN_IN_BITS
;

2966 
	`RTMP_IO_WRITE32
(
pAd
, 
WMM_CWMIN_CFG
, 
CwmC
.
wd
);

2968 
CwmaxC
.
wd
 = 0;

2969 
CwmaxC
.
fld
.
Cwmax0
 = 
CW_MAX_IN_BITS
;

2970 
CwmaxC
.
fld
.
Cwmax1
 = 
CW_MAX_IN_BITS
;

2971 
CwmaxC
.
fld
.
Cwmax2
 = 
CW_MAX_IN_BITS
;

2972 
CwmaxC
.
fld
.
Cwmax3
 = 
CW_MAX_IN_BITS
;

2973 
	`RTMP_IO_WRITE32
(
pAd
, 
WMM_CWMAX_CFG
, 
CwmaxC
.
wd
);

2975 
	`RTMP_IO_WRITE32
(
pAd
, 
WMM_AIFSN_CFG
, 0x00002222);

2977 
	`NdisZoMemy
(&
pAd
->
CommCfg
.
APEdPm
, (
EDCA_PARM
));

2982 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_WMM_INUSED
);

2992 
Ac0Cfg
.
fld
.
AcTx
 = 
pEdPm
->
Tx
[
QID_AC_BE
];

2993 
Ac0Cfg
.
fld
.
Cwm

pEdPm
->Cwm[
QID_AC_BE
];

2994 
Ac0Cfg
.
fld
.
Cwmax
 = 
pEdPm
->Cwmax[
QID_AC_BE
];

2995 
Ac0Cfg
.
fld
.
Aif
 = 
pEdPm
->Aif[
QID_AC_BE
];

2997 
Ac1Cfg
.
fld
.
AcTx
 = 
pEdPm
->
Tx
[
QID_AC_BK
];

2998 
Ac1Cfg
.
fld
.
Cwm
 = 
pEdPm
->Cwm[
QID_AC_BK
];

2999 
Ac1Cfg
.
fld
.
Cwmax
 = 
pEdPm
->Cwmax[
QID_AC_BK
];

3000 
Ac1Cfg
.
fld
.
Aif
 = 
pEdPm
->Aif[
QID_AC_BK
];

3003 
Ac2Cfg
.
fld
.
AcTx
 = (
pEdPm
->
Tx
[
QID_AC_VI
] * 6) / 10;

3004 if(
pAd
->
A
.
fld
.
TxPh
 == 1)

3006 
Ac2Cfg
.
fld
.
Cwm
 = 
pEdPm
->Cwm[
QID_AC_VI
] + 1;

3007 
Ac2Cfg
.
fld
.
Cwmax
 = 
pEdPm
->Cwmax[
QID_AC_VI
] + 1;

3011 
Ac2Cfg
.
fld
.
Cwm
 = 
pEdPm
->Cwm[
QID_AC_VI
];

3012 
Ac2Cfg
.
fld
.
Cwmax
 = 
pEdPm
->Cwmax[
QID_AC_VI
];

3014 
Ac2Cfg
.
fld
.
Aif
 = 
pEdPm
->Aif[
QID_AC_VI
] + 1;

3015 #ifde
CONFIG_STA_SUPPORT


3018 #ifde
INF_AMAZON_SE


3021 #ifde
CONFIG_STA_SUPPORT


3022 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3025 i(
pAd
->
CommCfg
.
bWiFiTe
 &&

3026 
pEdPm
->
Aif
[
QID_AC_VI
] == 10)

3027 
Ac2Cfg
.
fld
.
Aif
 -= 1;

3031 i(
	`STA_TGN_WIFI_ON
(
pAd
) &&

3032 
pEdPm
->
Aif
[
QID_AC_VI
] == 10)

3034 
Ac0Cfg
.
fld
.
Aif
 = 3;

3035 
Ac2Cfg
.
fld
.
AcTx
 = 5;

3041 
Ac3Cfg
.
fld
.
AcTx
 = 
pEdPm
->
Tx
[
QID_AC_VO
];

3042 
Ac3Cfg
.
fld
.
Cwm
 = 
pEdPm
->Cwm[
QID_AC_VO
];

3043 
Ac3Cfg
.
fld
.
Cwmax
 = 
pEdPm
->Cwmax[
QID_AC_VO
];

3044 
Ac3Cfg
.
fld
.
Aif
 = 
pEdPm
->Aif[
QID_AC_VO
];

3047 i(
pAd
->
CommCfg
.
bWiFiTe
)

3049 i(
Ac3Cfg
.
fld
.
AcTx
 == 102)

3051 
Ac0Cfg
.
fld
.
AcTx
 = 
pEdPm
->
Tx
[
QID_AC_BE
] ?EdcaParm->Txop[QID_AC_BE] : 10;

3052 
Ac0Cfg
.
fld
.
Aif
 = 
pEdPm
->Aif[
QID_AC_BE
]-1;

3053 
Ac1Cfg
.
fld
.
AcTx
 = 
pEdPm
->
Tx
[
QID_AC_BK
];

3054 
Ac1Cfg
.
fld
.
Aif
 = 
pEdPm
->Aif[
QID_AC_BK
];

3055 
Ac2Cfg
.
fld
.
AcTx
 = 
pEdPm
->
Tx
[
QID_AC_VI
];

3060 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC0_CFG
, 
Ac0Cfg
.
wd
);

3061 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC1_CFG
, 
Ac1Cfg
.
wd
);

3062 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC2_CFG
, 
Ac2Cfg
.
wd
);

3063 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC3_CFG
, 
Ac3Cfg
.
wd
);

3069 
c0
.
fld
.
Ac0Tx
 = 
Ac0Cfg
.fld.
AcTx
;

3070 
c0
.
fld
.
Ac1Tx
 = 
Ac1Cfg
.fld.
AcTx
;

3071 
	`RTMP_IO_WRITE32
(
pAd
, 
WMM_TXOP0_CFG
, 
c0
.
wd
);

3073 
c1
.
fld
.
Ac2Tx
 = 
Ac2Cfg
.fld.
AcTx
;

3074 
c1
.
fld
.
Ac3Tx
 = 
Ac3Cfg
.fld.
AcTx
;

3075 
	`RTMP_IO_WRITE32
(
pAd
, 
WMM_TXOP1_CFG
, 
c1
.
wd
);

3077 
CwmC
.
wd
 = 0;

3078 
CwmC
.
fld
.
Cwm0
 = 
pEdPm
->
Cwm
[
QID_AC_BE
];

3079 
CwmC
.
fld
.
Cwm1
 = 
pEdPm
->
Cwm
[
QID_AC_BK
];

3080 
CwmC
.
fld
.
Cwm2
 = 
pEdPm
->
Cwm
[
QID_AC_VI
];

3081 #ifde
CONFIG_STA_SUPPORT


3082 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3083 
CwmC
.
fld
.
Cwm3
 = 
pEdPm
->
Cwm
[
QID_AC_VO
] - 1;

3085 
	`RTMP_IO_WRITE32
(
pAd
, 
WMM_CWMIN_CFG
, 
CwmC
.
wd
);

3087 
CwmaxC
.
wd
 = 0;

3088 
CwmaxC
.
fld
.
Cwmax0
 = 
pEdPm
->
Cwmax
[
QID_AC_BE
];

3089 
CwmaxC
.
fld
.
Cwmax1
 = 
pEdPm
->
Cwmax
[
QID_AC_BK
];

3090 
CwmaxC
.
fld
.
Cwmax2
 = 
pEdPm
->
Cwmax
[
QID_AC_VI
];

3091 
CwmaxC
.
fld
.
Cwmax3
 = 
pEdPm
->
Cwmax
[
QID_AC_VO
];

3092 
	`RTMP_IO_WRITE32
(
pAd
, 
WMM_CWMAX_CFG
, 
CwmaxC
.
wd
);

3094 
AifC
.
wd
 = 0;

3095 
AifC
.
fld
.
Aif0
 = 
Ac0Cfg
.fld.
Aif
;

3096 
AifC
.
fld
.
Aif1
 = 
Ac1Cfg
.fld.
Aif
;

3097 #ifde
CONFIG_STA_SUPPORT


3099 
AifC
.
fld
.
Aif2
 = 
Ac2Cfg
.fld.
Aif
;

3100 #ifde
INF_AMAZON_SE


3103 #ifde
CONFIG_STA_SUPPORT


3104 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3107 i(
pAd
->
CommCfg
.
bWiFiTe
 &&

3108 
pEdPm
->
Aif
[
QID_AC_VI
] == 10)

3109 
AifC
.
fld
.
Aif2
 = 
Ac2Cfg
.fld.
Aif
 - 4;

3113 i(
	`STA_TGN_WIFI_ON
(
pAd
) &&

3114 
pEdPm
->
Aif
[
QID_AC_VI
] == 10)

3116 
AifC
.
fld
.
Aif0
 = 3;

3117 
AifC
.
fld
.
Aif2
 = 7;

3120 i(
	`INFRA_ON
(
pAd
))

3121 
	`CLIENT_STATUS_SET_FLAG
(&
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
], 
fCLIENT_STATUS_WMM_CAPABLE
);

3125 #ifde
CONFIG_STA_SUPPORT


3126 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3128 
AifC
.
fld
.
Aif3
 = 
Ac3Cfg
.fld.
Aif
 - 1;

3131 
	`RTMP_IO_WRITE32
(
pAd
, 
WMM_AIFSN_CFG
, 
AifC
.
wd
);

3133 
	`NdisMoveMemy
(&
pAd
->
CommCfg
.
APEdPm
, 
pEdPm
, (
EDCA_PARM
));

3134 i(!
	`ADHOC_ON
(
pAd
))

3136 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("EDCA [#%d]: AIFSN CWm CWmax TXOP(us ACM\n", 
pEdPm
->
EdUpdeCou
));

3137 
	`DBGPRINT
(
RT_DEBUG_TRACE
,(" AC_BE %2d %2d %2d %4d %d\n",

3138 
pEdPm
->
Aif
[0],

3139 
pEdPm
->
Cwm
[0],

3140 
pEdPm
->
Cwmax
[0],

3141 
pEdPm
->
Tx
[0]<<5,

3142 
pEdPm
->
bACM
[0]));

3143 
	`DBGPRINT
(
RT_DEBUG_TRACE
,(" AC_BK %2d %2d %2d %4d %d\n",

3144 
pEdPm
->
Aif
[1],

3145 
pEdPm
->
Cwm
[1],

3146 
pEdPm
->
Cwmax
[1],

3147 
pEdPm
->
Tx
[1]<<5,

3148 
pEdPm
->
bACM
[1]));

3149 
	`DBGPRINT
(
RT_DEBUG_TRACE
,(" AC_VI %2d %2d %2d %4d %d\n",

3150 
pEdPm
->
Aif
[2],

3151 
pEdPm
->
Cwm
[2],

3152 
pEdPm
->
Cwmax
[2],

3153 
pEdPm
->
Tx
[2]<<5,

3154 
pEdPm
->
bACM
[2]));

3155 
	`DBGPRINT
(
RT_DEBUG_TRACE
,(" AC_VO %2d %2d %2d %4d %d\n",

3156 
pEdPm
->
Aif
[3],

3157 
pEdPm
->
Cwm
[3],

3158 
pEdPm
->
Cwmax
[3],

3159 
pEdPm
->
Tx
[3]<<5,

3160 
pEdPm
->
bACM
[3]));

3164 
	}
}

3175 
VOID
 
	$AsicSSlTime
(

3176 
IN
 
PRTMP_ADAPTER
 
pAd
,

3177 
IN
 
BOOLEAN
 
bUShtSlTime
)

3179 
ULONG
 
SlTime
;

3180 
UINT32
 
RegVue
 = 0;

3182 #ifde
CONFIG_STA_SUPPORT


3183 i(
pAd
->
CommCfg
.
Chl
 > 14)

3184 
bUShtSlTime
 = 
TRUE
;

3187 i(
bUShtSlTime
 && 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_SHORT_SLOT_INUSED
))

3189 i((!
bUShtSlTime
&& (!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_SHORT_SLOT_INUSED
)))

3192 i(
bUShtSlTime
)

3193 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_SHORT_SLOT_INUSED
);

3195 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_SHORT_SLOT_INUSED
);

3197 
SlTime
 = (
bUShtSlTime
)? 9 : 20;

3199 #ifde
CONFIG_STA_SUPPORT


3200 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3203 i(((
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 =
FALSE
&& (
	`OPSTATUS_TEST_FLAG
Ad, 
fOP_STATUS_WMM_INUSED
)))

3204 #ifde
DOT11_N_SUPPORT


3205 || ((
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 =
TRUE
&& (pAd->
CommCfg
.
BACaby
.
fld
.
Picy
 =
BA_NOTUSE
))

3212 i(
pAd
->
CommCfg
.
bEbTxBur
)

3214 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_SHORT_SLOT_INUSED
);

3215 
SlTime
 = 9;

3225 #ifde
CONFIG_STA_SUPPORT


3226 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3228 i(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
)

3230 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_SHORT_SLOT_INUSED
);

3231 
SlTime
 = 20;

3236 
	`RTMP_IO_READ32
(
pAd
, 
BKOFF_SLOT_CFG
, &
RegVue
);

3237 
RegVue
 = RegValue & 0xFFFFFF00;

3239 
RegVue
 |
SlTime
;

3241 
	`RTMP_IO_WRITE32
(
pAd
, 
BKOFF_SLOT_CFG
, 
RegVue
);

3242 
	}
}

3254 
VOID
 
	$AsicAddShedKeyEry
(

3255 
IN
 
PRTMP_ADAPTER
 
pAd
,

3256 
IN
 
UCHAR
 
BssIndex
,

3257 
IN
 
UCHAR
 
KeyIdx
,

3258 
IN
 
PCIPHER_KEY
 
pChKey
)

3260 
ULONG
 
offt
;

3261 
SHAREDKEY_MODE_STRUC
 
c1
;

3262 #ifde
RTMP_MAC_PCI


3263 
INT
 
i
;

3266 
PUCHAR
 
pKey
 = 
pChKey
->
Key
;

3267 
PUCHAR
 
pTxMic
 = 
pChKey
->
TxMic
;

3268 
PUCHAR
 
pRxMic
 = 
pChKey
->
RxMic
;

3269 
UCHAR
 
ChAlg
 = 
pChKey
->CipherAlg;

3271 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AsicAddShedKeyEry BssIndex=%d, KeyIdx=%d\n", 
BssIndex
,
KeyIdx
));

3274 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("AsicAddShedKeyEry: %key #%d\n", 
ChName
[
ChAlg
], 
BssIndex
*4 + 
KeyIdx
));

3275 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, (" Key = %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x\n",

3276 
pKey
[0],pKey[1],pKey[2],pKey[3],pKey[4],pKey[5],pKey[6],pKey[7],pKey[8],pKey[9],pKey[10],pKey[11],pKey[12],pKey[13],pKey[14],pKey[15]));

3277 i(
pRxMic
)

3279 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, (" Rx MIC Key = %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x\n",

3280 
pRxMic
[0],pRxMic[1],pRxMic[2],pRxMic[3],pRxMic[4],pRxMic[5],pRxMic[6],pRxMic[7]));

3282 i(
pTxMic
)

3284 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, (" Tx MIC Key = %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x\n",

3285 
pTxMic
[0],pTxMic[1],pTxMic[2],pTxMic[3],pTxMic[4],pTxMic[5],pTxMic[6],pTxMic[7]));

3291 #ifde
RTMP_MAC_PCI


3292 
offt
 = 
SHARED_KEY_TABLE_BASE
 + (4*
BssIndex
 + 
KeyIdx
)*
HW_KEY_ENTRY_SIZE
;

3293 
i
=0; i<
MAX_LEN_OF_SHARE_KEY
; i++)

3295 
	`RTMP_IO_WRITE8
(
pAd
, 
offt
 + 
i
, 
pKey
[i]);

3298 
offt
 +
MAX_LEN_OF_SHARE_KEY
;

3299 i(
pTxMic
)

3301 
i
=0; i<8; i++)

3303 
	`RTMP_IO_WRITE8
(
pAd
, 
offt
 + 
i
, 
pTxMic
[i]);

3307 
offt
 += 8;

3308 i(
pRxMic
)

3310 
i
=0; i<8; i++)

3312 
	`RTMP_IO_WRITE8
(
pAd
, 
offt
 + 
i
, 
pRxMic
[i]);

3321 
	`RTMP_IO_READ32
(
pAd
, 
SHARED_KEY_MODE_BASE
+4*(
BssIndex
/2), &
c1
.
wd
);

3322 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Rd: SHARED_KEY_MODE_BASEthiBss[%d] KeyIdx[%d]0x%x \n", 
BssIndex
,
KeyIdx
, 
c1
.
wd
));

3323 i((
BssIndex
%2) == 0)

3325 i(
KeyIdx
 == 0)

3326 
c1
.
fld
.
Bss0Key0ChAlg
 = 
ChAlg
;

3327 i(
KeyIdx
 == 1)

3328 
c1
.
fld
.
Bss0Key1ChAlg
 = 
ChAlg
;

3329 i(
KeyIdx
 == 2)

3330 
c1
.
fld
.
Bss0Key2ChAlg
 = 
ChAlg
;

3332 
c1
.
fld
.
Bss0Key3ChAlg
 = 
ChAlg
;

3336 i(
KeyIdx
 == 0)

3337 
c1
.
fld
.
Bss1Key0ChAlg
 = 
ChAlg
;

3338 i(
KeyIdx
 == 1)

3339 
c1
.
fld
.
Bss1Key1ChAlg
 = 
ChAlg
;

3340 i(
KeyIdx
 == 2)

3341 
c1
.
fld
.
Bss1Key2ChAlg
 = 
ChAlg
;

3343 
c1
.
fld
.
Bss1Key3ChAlg
 = 
ChAlg
;

3345 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Wre: SHARED_KEY_MODE_BASEthiBss[%d] = 0x%x \n", 
BssIndex
, 
c1
.
wd
));

3346 
	`RTMP_IO_WRITE32
(
pAd
, 
SHARED_KEY_MODE_BASE
+4*(
BssIndex
/2), 
c1
.
wd
);

3348 
	}
}

3351 
VOID
 
	$AsicRemoveShedKeyEry
(

3352 
IN
 
PRTMP_ADAPTER
 
pAd
,

3353 
IN
 
UCHAR
 
BssIndex
,

3354 
IN
 
UCHAR
 
KeyIdx
)

3357 
SHAREDKEY_MODE_STRUC
 
c1
;

3359 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("AsicRemoveShedKeyEry: #%d \n", 
BssIndex
*4 + 
KeyIdx
));

3361 
	`RTMP_IO_READ32
(
pAd
, 
SHARED_KEY_MODE_BASE
+4*(
BssIndex
/2), &
c1
.
wd
);

3362 i((
BssIndex
%2) == 0)

3364 i(
KeyIdx
 == 0)

3365 
c1
.
fld
.
Bss0Key0ChAlg
 = 0;

3366 i(
KeyIdx
 == 1)

3367 
c1
.
fld
.
Bss0Key1ChAlg
 = 0;

3368 i(
KeyIdx
 == 2)

3369 
c1
.
fld
.
Bss0Key2ChAlg
 = 0;

3371 
c1
.
fld
.
Bss0Key3ChAlg
 = 0;

3375 i(
KeyIdx
 == 0)

3376 
c1
.
fld
.
Bss1Key0ChAlg
 = 0;

3377 i(
KeyIdx
 == 1)

3378 
c1
.
fld
.
Bss1Key1ChAlg
 = 0;

3379 i(
KeyIdx
 == 2)

3380 
c1
.
fld
.
Bss1Key2ChAlg
 = 0;

3382 
c1
.
fld
.
Bss1Key3ChAlg
 = 0;

3384 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Wre: SHARED_KEY_MODE_BASEthiBss[%d] = 0x%x \n", 
BssIndex
, 
c1
.
wd
));

3385 
	`RTMP_IO_WRITE32
(
pAd
, 
SHARED_KEY_MODE_BASE
+4*(
BssIndex
/2), 
c1
.
wd
);

3386 
	`ASSERT
(
BssIndex
 < 4);

3387 
	`ASSERT
(
KeyIdx
 < 4);

3389 
	}
}

3391 
VOID
 
	$AsicUpdeWCIDIVEIV
(

3392 
IN
 
PRTMP_ADAPTER
 
pAd
,

3393 
IN
 
USHORT
 
WCID
,

3394 
IN
 
ULONG
 
uIV
,

3395 
IN
 
ULONG
 
uEIV
)

3397 
ULONG
 
offt
;

3399 
offt
 = 
MAC_IVEIV_TABLE_BASE
 + (
WCID
 * 
HW_IVEIV_ENTRY_SIZE
);

3401 
	`RTMP_IO_WRITE32
(
pAd
, 
offt
, 
uIV
);

3402 
	`RTMP_IO_WRITE32
(
pAd
, 
offt
 + 4, 
uEIV
);

3404 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: wcid(%d) 0x%08lx, 0x%08lx \n",

3405 
__FUNCTION__
, 
WCID
, 
uIV
, 
uEIV
));

3406 
	}
}

3408 
VOID
 
	$AsicUpdeRxWCIDTab
(

3409 
IN
 
PRTMP_ADAPTER
 
pAd
,

3410 
IN
 
USHORT
 
WCID
,

3411 
IN
 
PUCHAR
 
pAddr
)

3413 
ULONG
 
offt
;

3414 
ULONG
 
Addr
;

3416 
offt
 = 
MAC_WCID_BASE
 + (
WCID
 * 
HW_WCID_ENTRY_SIZE
);

3417 
Addr
 = 
pAddr
[0] + (pAddr[1] << 8) +(pAddr[2] << 16) +(pAddr[3] << 24);

3418 
	`RTMP_IO_WRITE32
(
pAd
, 
offt
, 
Addr
);

3419 
Addr
 = 
pAddr
[4] + (pAddr[5] << 8);

3420 
	`RTMP_IO_WRITE32
(
pAd
, 
offt
 + 4, 
Addr
);

3421 
	}
}

3440 
VOID
 
	$AsicUpdeWcidAribuEry
(

3441 
IN
 
PRTMP_ADAPTER
 
pAd
,

3442 
IN
 
UCHAR
 
BssIdx
,

3443 
IN
 
UCHAR
 
KeyIdx
,

3444 
IN
 
UCHAR
 
ChAlg
,

3445 
IN
 
UINT8
 
Wcid
,

3446 
IN
 
UINT8
 
KeyTabFg
)

3448 
WCID_ATTRIBUTE_STRUC
 
WCIDAri
;

3449 
USHORT
 
offt
;

3452 
WCIDAri
.
wd
 = 0;

3455 i
Wcid
 > 254)

3457 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("%s: Wcid is invalid (%d). \n",

3458 
__FUNCTION__
, 
Wcid
));

3464 
WCIDAri
.
fld
.
PaKeyModeExt
 = ((
ChAlg
 & 0x08) >> 3);

3465 
WCIDAri
.
fld
.
PaKeyMode
 = (
ChAlg
 & 0x07);

3469 
WCIDAri
.
fld
.
BSSIdxExt
 = ((
BssIdx
 & 0x08) >> 3);

3470 
WCIDAri
.
fld
.
BSSIdx
 = (
BssIdx
 & 0x07);

3474 
WCIDAri
.
fld
.
KeyTab
 = 
KeyTabFg
;

3477 
offt
 = 
MAC_WCID_ATTRIBUTE_BASE
 + (
Wcid
 * 
HW_WCID_ATTRI_SIZE
);

3478 
	`RTMP_IO_WRITE32
(
pAd
, 
offt
, 
WCIDAri
.
wd
);

3480 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%: WCID #%d, KeyIndex #%d, Alg=%s\n", 
__FUNCTION__
, 
Wcid
, 
KeyIdx
, 
ChName
[
ChAlg
]));

3481 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" WCIDAr0x%x \n", 
WCIDAri
.
wd
));

3483 
	}
}

3495 
VOID
 
	$AsicAddPawiKeyEry
(

3496 
IN
 
PRTMP_ADAPTER
 
pAd
,

3497 
IN
 
UCHAR
 
WCID
,

3498 
IN
 
PCIPHER_KEY
 
pChKey
)

3500 
INT
 
i
;

3501 
ULONG
 
offt
;

3502 
PUCHAR
 
pKey
 = 
pChKey
->
Key
;

3503 
PUCHAR
 
pTxMic
 = 
pChKey
->
TxMic
;

3504 
PUCHAR
 
pRxMic
 = 
pChKey
->
RxMic
;

3505 
UCHAR
 
ChAlg
 = 
pChKey
->CipherAlg;

3506 #ifde
SPECIFIC_BCN_BUF_SUPPORT


3507 
qFg
;

3510 #ifde
SPECIFIC_BCN_BUF_SUPPORT


3511 
	`RTMP_MAC_SHR_MSEL_LOCK
(
pAd
, 
LOWER_SHRMEM
, 
qFg
);

3515 
offt
 = 
PAIRWISE_KEY_TABLE_BASE
 + (
WCID
 * 
HW_KEY_ENTRY_SIZE
);

3516 #ifde
RTMP_MAC_PCI


3517 
i
=0; i<
MAX_LEN_OF_PEER_KEY
; i++)

3519 
	`RTMP_IO_WRITE8
(
pAd
, 
offt
 + 
i
, 
pKey
[i]);

3522 
i
=0; i<
MAX_LEN_OF_PEER_KEY
; i+=4)

3524 
UINT32
 
Vue
;

3525 
	`RTMP_IO_READ32
(
pAd
, 
offt
 + 
i
, &
Vue
);

3528 
offt
 +
MAX_LEN_OF_PEER_KEY
;

3531 i(
pTxMic
)

3533 #ifde
RTMP_MAC_PCI


3534 
i
=0; i<8; i++)

3536 
	`RTMP_IO_WRITE8
(
pAd
, 
offt
+
i
, 
pTxMic
[i]);

3540 
offt
 += 8;

3541 i(
pRxMic
)

3543 #ifde
RTMP_MAC_PCI


3544 
i
=0; i<8; i++)

3546 
	`RTMP_IO_WRITE8
(
pAd
, 
offt
+
i
, 
pRxMic
[i]);

3551 #ifde
SPECIFIC_BCN_BUF_SUPPORT


3552 
	`RTMP_MAC_SHR_MSEL_UNLOCK
(
pAd
, 
LOWER_SHRMEM
, 
qFg
);

3555 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("AsicAddPawiKeyEry: WCID #%d Alg=%s\n",
WCID
, 
ChName
[
ChAlg
]));

3556 
	`DBGPRINT
(
RT_DEBUG_TRACE
,(" Key = %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x\n",

3557 
pKey
[0],pKey[1],pKey[2],pKey[3],pKey[4],pKey[5],pKey[6],pKey[7],pKey[8],pKey[9],pKey[10],pKey[11],pKey[12],pKey[13],pKey[14],pKey[15]));

3558 i(
pRxMic
)

3560 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" Rx MIC Key = %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x\n",

3561 
pRxMic
[0],pRxMic[1],pRxMic[2],pRxMic[3],pRxMic[4],pRxMic[5],pRxMic[6],pRxMic[7]));

3563 i(
pTxMic
)

3565 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" Tx MIC Key = %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x\n",

3566 
pTxMic
[0],pTxMic[1],pTxMic[2],pTxMic[3],pTxMic[4],pTxMic[5],pTxMic[6],pTxMic[7]));

3568 
	}
}

3577 
VOID
 
	$AsicRemovePawiKeyEry
(

3578 
IN
 
PRTMP_ADAPTER
 
pAd
,

3579 
IN
 
UCHAR
 
Wcid
)

3582 
	`AsicUpdeWcidAribuEry
(
pAd
,

3583 
BSS0
,

3585 
CIPHER_NONE
,

3586 
Wcid
,

3587 
PAIRWISEKEYTABLE
);

3589 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%: Wcid #%d \n", 
__FUNCTION__
, 
Wcid
));

3590 
	}
}

3592 
BOOLEAN
 
	$AsicSdCommdToMcu
(

3593 
IN
 
PRTMP_ADAPTER
 
pAd
,

3594 
IN
 
UCHAR
 
Commd
,

3595 
IN
 
UCHAR
 
Tok
,

3596 
IN
 
UCHAR
 
Arg0
,

3597 
IN
 
UCHAR
 
Arg1
)

3599 i(
pAd
->
chOps
.
ndCommdToMcu
)

3600  
pAd
->
chOps
.
	`ndCommdToMcu
Ad, 
Commd
, 
Tok
, 
Arg0
, 
Arg1
);

3602  
FALSE
;

3603 
	}
}

3606 
VOID
 
	$AsicSRxA
(

3607 
IN
 
PRTMP_ADAPTER
 
pAd
,

3608 
IN
 
UCHAR
 
A
)

3610 
	}
}

3613 
VOID
 
	$AsicTuOffRFClk
(

3614 
IN
 
PRTMP_ADAPTER
 
pAd
,

3615 
IN
 
UCHAR
 
Chl
)

3617 i(
pAd
->
chOps
.
AsicRfTuOff
)

3619 
pAd
->
chOps
.
	`AsicRfTuOff
(pAd);

3623 #i
	`defed
(
RT28xx
|| defed(
RT2880
|| defed(
RT2883
)

3625 
UINT32
 
R1
 = 0, 
R2
 = 0, 
R3
 = 0;

3626 
UCHAR
 
dex
;

3627 
RTMP_RF_REGS
 *
RFRegTab
;

3629 
RFRegTab
 = 
RF2850RegTab
;

3632 
pAd
->
RfIcTy
)

3634 #i
	`defed
(
RT28xx
|| defed(
RT2880
|| defed(
RT2883
)

3635 #i
	`defed
(
RT28xx
|| defed(
RT2880
)

3636 
RFIC_2820
:

3637 
RFIC_2850
:

3638 
RFIC_2720
:

3639 
RFIC_2750
:

3641 
dex
 = 0; index < 
NUM_OF_2850_CHNL
; index++)

3643 i(
Chl
 =
RFRegTab
[
dex
].Channel)

3645 
R1
 = 
RFRegTab
[
dex
].R1 & 0xffffdfff;

3646 
R2
 = 
RFRegTab
[
dex
].R2 & 0xfffbffff;

3647 
R3
 = 
RFRegTab
[
dex
].R3 & 0xfff3ffff;

3649 
	`RTMP_RF_IO_WRITE32
(
pAd
, 
R1
);

3650 
	`RTMP_RF_IO_WRITE32
(
pAd
, 
R2
);

3657 
	`RTMP_RF_IO_WRITE32
(
pAd
, 
R3
);

3659 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AsicTurnOffRFClk#%d(RF=%d, ) , R2=0x%08x, R3 = 0x%08x \n",

3660 
Chl
, 
pAd
->
RfIcTy
, 
R2
, 
R3
));

3663 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AsicTurnOffRFClk#%d(RF=%d, ) , R2=0x%08x \n",

3664 
Chl
, 
pAd
->
RfIcTy
, 
R2
));

3671 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AsicTurnOffRFClk#%d : Unkonwn RFIC=%d\n",

3672 
Chl
, 
pAd
->
RfIcTy
));

3676 
	}
}

	@common/cmm_cfg.c

40 
	~"_cfig.h
"

44 
INT
 
	$CompuChecksum
(

45 
IN
 
UINT
 
PIN
)

47 
INT
 
dig_s
;

48 
UINT
 
accum
 = 0;

50 
PIN
 *= 10;

51 
accum
 +3 * ((
PIN
 / 10000000) % 10);

52 
accum
 +1 * ((
PIN
 / 1000000) % 10);

53 
accum
 +3 * ((
PIN
 / 100000) % 10);

54 
accum
 +1 * ((
PIN
 / 10000) % 10);

55 
accum
 +3 * ((
PIN
 / 1000) % 10);

56 
accum
 +1 * ((
PIN
 / 100) % 10);

57 
accum
 +3 * ((
PIN
 / 10) % 10);

59 
dig_s
 = (
accum
 % 10);

60  ((10 - 
dig_s
) % 10);

61 
	}
}

63 
UINT
 
	$GeWpsPCode
(

64 
IN
 
PRTMP_ADAPTER
 
pAd
,

65 
IN
 
BOOLEAN
 
bFromApi
,

66 
IN
 
UCHAR
 
idx
)

68 
UCHAR
 
macAddr
[
MAC_ADDR_LEN
];

69 
UINT
 
iP
;

70 
UINT
 
checksum
;

72 #ifde
CONFIG_STA_SUPPORT


73 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

74 
	`NdisMoveMemy
(&
macAddr
[0], 
pAd
->
CutAddss
, 
MAC_ADDR_LEN
);

77 
iP
 = 
macAddr
[3] * 256 * 256 + macAddr[4] * 256 + macAddr[5];

79 
iP
 = iPin % 10000000;

80 
checksum
 = 
	`CompuChecksum

iP
 );

81 
iP
 = iP*10 + 
checksum
;

83  
iP
;

84 
	}
}

86 * 
	$GPhyMode
(

87 
Mode
)

89 
Mode
)

91 
MODE_CCK
:

94 
MODE_OFDM
:

96 #ifde
DOT11_N_SUPPORT


97 
MODE_HTMIX
:

100 
MODE_HTGREENFIELD
:

106 
	}
}

109 * 
	$GBW
(

110 
BW
)

112 
BW
)

114 
BW_10
:

117 
BW_20
:

119 #ifde
DOT11_N_SUPPORT


120 
BW_40
:

126 
	}
}

139 
INT
 
	$RT_CfgSCouryRegi
(

140 
IN
 
PRTMP_ADAPTER
 
pAd
,

141 
IN
 
PSTRING
 
g
,

142 
IN
 
INT
 
bd
)

144 
LONG
 
gi
;

145 
UCHAR
 *
pCouryRegi
;

147 
gi
 = 
	`sime_
(
g
, 0, 10);

149 i(
bd
 =
BAND_24G
)

150 
pCouryRegi
 = &
pAd
->
CommCfg
.
CouryRegi
;

152 
pCouryRegi
 = &
pAd
->
CommCfg
.
CouryRegiFABd
;

156 i(*
pCouryRegi
 & 0x80)

158 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("CfgSetCountryRegion():CountryRegion ineprom wasrogrammed\n"));

159  
FALSE
;

162 if((
gi
 >= 0) &&

163 (((
bd
 =
BAND_24G
&& ((
gi
 <
REGION_MAXIMUM_BG_BAND
|| (gi =
REGION_31_BG_BAND
))) ||

164 ((
bd
 =
BAND_5G
&& (
gi
 <
REGION_MAXIMUM_A_BAND
) ))

167 *
pCouryRegi
(
UCHAR

gi
;

171 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("CfgSCouryRegi():gi(%ldouonge!\n", 
gi
));

172  
FALSE
;

175  
TRUE
;

177 
	}
}

188 
INT
 
	$RT_CfgSWessMode
(

189 
IN
 
PRTMP_ADAPTER
 
pAd
,

190 
IN
 
PSTRING
 
g
)

192 
INT
 
MaxPhyMode
 = 
PHY_11G
;

193 
LONG
 
WessMode
;

195 #ifde
DOT11_N_SUPPORT


196 i(!
	`RTMP_TEST_MORE_FLAG
(
pAd
, 
fRTMP_ADAPTER_DISABLE_DOT_11N
))

197 
MaxPhyMode
 = 
PHY_11N_5G
;

200 
WessMode
 = 
	`sime_
(
g
, 0, 10);

203 i(
	`PHY_MODE_IS_5G_BAND
(
WessMode
))

205 i(!
	`RFIC_IS_5G_BAND
(
pAd
))

207 
	`DBGPRINT
(
RT_DEBUG_ERROR
,

209 
pAd
->
RfIcTy
));

210  
FALSE
;

214 i(
WessMode
 <
MaxPhyMode
)

216 
pAd
->
CommCfg
.
PhyMode
 = 
WessMode
;

217 
pAd
->
CommCfg
.
DesedPhyMode
 = 
WessMode
;

218  
TRUE
;

221  
FALSE
;

223 
	}
}

229 
INT
 
	$RT_CfgSShtSl
(

230 
IN
 
PRTMP_ADAPTER
 
pAd
,

231 
IN
 
PSTRING
 
g
)

233 
LONG
 
ShtSl
;

235 
ShtSl
 = 
	`sime_
(
g
, 0, 10);

237 i(
ShtSl
 == 1)

238 
pAd
->
CommCfg
.
bUShtSlTime
 = 
TRUE
;

239 i(
ShtSl
 == 0)

240 
pAd
->
CommCfg
.
bUShtSlTime
 = 
FALSE
;

242  
FALSE
;

244  
TRUE
;

245 
	}
}

256 
INT
 
	$RT_CfgSWKey
(

257 
IN
 
PRTMP_ADAPTER
 
pAd
,

258 
IN
 
PSTRING
 
keySg
,

259 
IN
 
CIPHER_KEY
 *
pShedKey
,

260 
IN
 
INT
 
keyIdx
)

262 
INT
 
KeyL
;

263 
INT
 
i
;

265 
BOOLEAN
 
bKeyIsHex
 = 
FALSE
;

268 
	`memt
(
pShedKey
, 0, (
CIPHER_KEY
));

269 
KeyL
 = 
	`
(
keySg
);

270 
KeyL
)

274 
bKeyIsHex
 = 
FALSE
;

275 
pShedKey
->
KeyL
 = KeyLen;

276 
	`NdisMoveMemy
(
pShedKey
->
Key
, 
keySg
, 
KeyL
);

281 
i
=0; i < 
KeyL
; i++)

283 if!
	`isxdig
(*(
keySg
+
i
)) )

284  
FALSE
;

286 
bKeyIsHex
 = 
TRUE
;

287 
pShedKey
->
KeyL
 = KeyLen/2 ;

288 
	`AtoH
(
keySg
, 
pShedKey
->
Key
,ShedKey->
KeyL
);

292 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RT_CfgSWKey(keyIdx=%d):Invidrgumrg=%s)\n", 
keyIdx
, 
keySg
));

293  
FALSE
;

296 
pShedKey
->
ChAlg
 = ((
KeyL
 % 5? 
CIPHER_WEP128
 : 
CIPHER_WEP64
);

297 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RT_CfgSetWepKey:(KeyIdx=%d,type=%s, Alg=%s)\n",

298 
keyIdx
, (
bKeyIsHex
 =
FALSE
 ? "Ascii" : "Hex"), 
ChName
[
pShedKey
->
ChAlg
]));

300  
TRUE
;

301 
	}
}

320 
INT
 
	$RT_CfgSWPAPSKKey
(

321 
IN
 
RTMP_ADAPTER
 *
pAd
,

322 
IN
 
PSTRING
 
keySg
,

323 
IN
 
UCHAR
 *
pHashS
,

324 
IN
 
INT
 
hashSL
,

325 
OUT
 
PUCHAR
 
pPMKBuf
)

327 
keyL
;

328 
UCHAR
 
keyMl
[40];

330 
keyL
 = 
	`
(
keySg
);

331 i((
keyL
 < 8) || (keyLen > 64))

333 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("WPAPSK Keyength(%d)rror,equired 8 ~ 64 characters!(keyStr=%s)\n",

334 
keyL
, 
keySg
));

335  
FALSE
;

338 
	`memt
(
pPMKBuf
, 0, 32);

339 i(
keyL
 == 64)

341 
	`AtoH
(
keySg
, 
pPMKBuf
, 32);

345 
	`RtmpPasswdHash
(
keySg
, 
pHashS
, 
hashSL
, 
keyMl
);

346 
	`NdisMoveMemy
(
pPMKBuf
, 
keyMl
, 32);

349  
TRUE
;

350 
	}
}

352 
INT
 
	$RT_CfgSFixedTxPhyMode
(

353 
IN
 
PSTRING
 
g
)

355 
INT
 
fix_tx_mode
 = 
FIXED_TXMODE_HT
;

356 
UINT32
 
vue
;

358 i(
	`rcmp
(
g
, "OFDM") == 0 || strcmp(arg, "ofdm") == 0)

360 
fix_tx_mode
 = 
FIXED_TXMODE_OFDM
;

362 i(
	`rcmp
(
g
, "CCK") == 0 || strcmp(arg, "cck") == 0)

364 
fix_tx_mode
 = 
FIXED_TXMODE_CCK
;

366 i(
	`rcmp
(
g
, "HT") == 0 || strcmp(arg, "ht") == 0)

368 
fix_tx_mode
 = 
FIXED_TXMODE_HT
;

372 
vue
 = 
	`sime_
(
g
, 0, 10);

376 i(
vue
 =
FIXED_TXMODE_CCK
 || vu=
FIXED_TXMODE_OFDM
)

377 
fix_tx_mode
 = 
vue
;

379 
fix_tx_mode
 = 
FIXED_TXMODE_HT
;

382  
fix_tx_mode
;

384 
	}
}

386 
INT
 
	$RT_CfgSMacAddss
(

387 
IN
 
PRTMP_ADAPTER
 
pAd
,

388 
IN
 
PSTRING
 
g
)

390 
INT
 
i
, 
mac_n
;

393 
mac_n
 = 
	`
(
g
);

394 if(
mac_n
 != 17)

396 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: invidgth (%d)\n", 
__FUNCTION__
, 
mac_n
));

397  
FALSE
;

400 if(
	`rcmp
(
g
, "00:00:00:00:00:00") == 0)

402 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: invid mag \n", 
__FUNCTION__
));

403  
FALSE
;

406 
i
 = 0; i < 
MAC_ADDR_LEN
; i++)

408 
	`AtoH
(
g
, &
pAd
->
CutAddss
[
i
], 1);

409 
g
 =rg + 3;

412 
pAd
->
bLolAdmMAC
 = 
TRUE
;

413  
TRUE
;

414 
	}
}

416 
INT
 
	$RT_CfgSTxMCSProc
(

417 
IN
 
PSTRING
 
g
,

418 
OUT
 
BOOLEAN
 *
pAutoRe
)

420 
INT
 
Vue
 = 
	`sime_
(
g
, 0, 10);

421 
INT
 
TxMcs
;

423 i((
Vue
 >= 0 && Value <= 23) || (Value == 32))

425 
TxMcs
 = 
Vue
;

426 *
pAutoRe
 = 
FALSE
;

430 
TxMcs
 = 
MCS_AUTO
;

431 *
pAutoRe
 = 
TRUE
;

434  
TxMcs
;

436 
	}
}

438 
INT
 
	$RT_CfgSAutoFlBack
(

439 
IN
 
PRTMP_ADAPTER
 
pAd
,

440 
IN
 
PSTRING
 
g
)

442 
TX_RTY_CFG_STRUC
 
tx_y_cfg
;

443 
UCHAR
 
AutoFlBack
 = (UCHAR)
	`sime_
(
g
, 0, 10);

445 
	`RTMP_IO_READ32
(
pAd
, 
TX_RTY_CFG
, &
tx_y_cfg
.
wd
);

446 
tx_y_cfg
.
fld
.
TxautoFBEb
 = (
AutoFlBack
) ? 1 : 0;

447 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_RTY_CFG
, 
tx_y_cfg
.
wd
);

448 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RT_CfgSAutoFlBack::x_y_cfg=0x%x)\n", 
tx_y_cfg
.
wd
));

449  
TRUE
;

450 
	}
}

	@common/cmm_cmd.c

40 
	~"_cfig.h
"

60 
VOID
 
	$RTInlizeCmdQ
(

61 
IN
 
PCmdQ
 
cmdq
)

63 
cmdq
->
hd
 = 
NULL
;

64 
cmdq
->

 = 
NULL
;

65 
cmdq
->
size
 = 0;

66 
cmdq
->
CmdQS
 = 
RTMP_TASK_STAT_INITED
;

67 
	}
}

85 
VOID
 
	$RTThadDequeueCmd
(

86 
IN
 
PCmdQ
 
cmdq
,

87 
OUT
 
PCmdQElmt
 *
pcmdqmt
)

89 *
pcmdqmt
 = 
cmdq
->
hd
;

91 i(*
pcmdqmt
 !
NULL
)

93 
cmdq
->
hd
 = cmdq->hd->
xt
;

94 
cmdq
->
size
--;

95 i(
cmdq
->
size
 == 0)

96 
cmdq
->

 = 
NULL
;

98 
	}
}

116 
NDIS_STATUS
 
	$RTEnqueueIlCmd
(

117 
IN
 
PRTMP_ADAPTER
 
pAd
,

118 
IN
 
NDIS_OID
 
Oid
,

119 
IN
 
PVOID
 
pInfmiBufr
,

120 
IN
 
UINT32
 
InfmiBufrLgth
)

122 
NDIS_STATUS
 
us
;

123 
PCmdQElmt
 
cmdqmt
 = 
NULL
;

126 
us
 = 
	`os_loc_mem
(
pAd
, (
PUCHAR
 *)&
cmdqmt
, (
CmdQElmt
));

127 i((
us
 !
NDIS_STATUS_SUCCESS
|| (
cmdqmt
 =
NULL
))

128  (
NDIS_STATUS_RESOURCES
);

129 
	`NdisZoMemy
(
cmdqmt
, (
CmdQElmt
));

131 if(
InfmiBufrLgth
 > 0)

133 
us
 = 
	`os_loc_mem
(
pAd
, (
PUCHAR
 *)&
cmdqmt
->
bufr
, 
InfmiBufrLgth
);

134 i((
us
 !
NDIS_STATUS_SUCCESS
|| (
cmdqmt
->
bufr
 =
NULL
))

136 
	`os__mem
(
pAd
, 
cmdqmt
);

137  (
NDIS_STATUS_RESOURCES
);

141 
	`NdisMoveMemy
(
cmdqmt
->
bufr
, 
pInfmiBufr
, 
InfmiBufrLgth
);

142 
cmdqmt
->
buf㾒gth
 = 
InfmiBufrLgth
;

147 
cmdqmt
->
bufr
 = 
NULL
;

148 
cmdqmt
->
buf㾒gth
 = 0;

151 
cmdqmt
->
commd
 = 
Oid
;

152 
cmdqmt
->
CmdFromNdis
 = 
FALSE
;

154 i(
cmdqmt
 !
NULL
)

156 
	`NdisAcqueSpLock
(&
pAd
->
CmdQLock
);

157 i(
pAd
->
CmdQ
.
CmdQS
 & 
RTMP_TASK_CAN_DO_INSERT
)

159 
	`EnqueueCmd
((&
pAd
->
CmdQ
), 
cmdqmt
);

160 
us
 = 
NDIS_STATUS_SUCCESS
;

164 
us
 = 
NDIS_STATUS_FAILURE
;

166 
	`NdisRSpLock
(&
pAd
->
CmdQLock
);

168 i(
us
 =
NDIS_STATUS_FAILURE
)

170 i(
cmdqmt
->
bufr
)

171 
	`os__mem
(
pAd
, 
cmdqmt
->
bufr
);

172 
	`os__mem
(
pAd
, 
cmdqmt
);

175 
	`RTCMDUp
(
pAd
);

177 (
NDIS_STATUS_SUCCESS
);

178 
	}
}

	@common/cmm_data.c

38 
	~"_cfig.h
"

41 
UCHAR
 
	gSNAP_802_1H
[] = {0xaa, 0xaa, 0x03, 0x00, 0x00, 0x00};

42 
UCHAR
 
	gSNAP_BRIDGE_TUNNEL
[] = {0xaa, 0xaa, 0x03, 0x00, 0x00, 0xf8};

43 
UCHAR
 
	gEAPOL
[] = {0x88, 0x8e};

44 
UCHAR
 
	gTPID
[] = {0x81, 0x00};

46 
UCHAR
 
	gIPX
[] = {0x81, 0x37};

47 
UCHAR
 
	gAPPLE_TALK
[] = {0x80, 0xf3};

49 
UCHAR
 
	gOfdmReToRxwiMCS
[12] = {

54 
UCHAR
 
	gRxwiMCSToOfdmRe
[12] = {

55 
RATE_6
, 
RATE_9
, 
RATE_12
, 
RATE_18
,

56 
RATE_24
, 
RATE_36
, 
RATE_48
, 
RATE_54
,

60 
UCHAR
 
	gMUrPriܙyToAcssCegy
[8] = {
QID_AC_BE
, 
QID_AC_BK
, QID_AC_BK, QID_AC_BE, 
QID_AC_VI
, QID_AC_VI, 
QID_AC_VO
, QID_AC_VO};

87 
NDIS_STATUS
 
	$MtMMReque
(

88 
IN
 
PRTMP_ADAPTER
 
pAd
,

89 
IN
 
UCHAR
 
QueIdx
,

90 
IN
 
PUCHAR
 
pDa
,

91 
IN
 
UINT
 
Lgth
)

93 
PNDIS_PACKET
 
pPack
;

94 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

95 
ULONG
 
FeNum
;

96 
UCHAR
 
mpHwHdr
[
TXINFO_SIZE
 + 
TXWI_SIZE
];

97 #ifde
RTMP_MAC_PCI


98 
IrqFgs
 = 0;

99 
UCHAR
 
IrqS
;

101 
BOOLEAN
 
bUDaQ
 = 
FALSE
;

102 
yC
 = 0;

104 
	`ASSERT
(
Lgth
 <
MGMT_DMA_BUFFER_SIZE
);

106 i((
QueIdx
 & 
MGMT_USE_QUEUE_FLAG
) == MGMT_USE_QUEUE_FLAG)

108 
bUDaQ
 = 
TRUE
;

109 
QueIdx
 &(~
MGMT_USE_QUEUE_FLAG
);

112 #ifde
RTMP_MAC_PCI


114 
IrqS
 = 
pAd
->
q_dibd
;

115 i(
pAd
->
MACVsi
 == 0x28600100)

117 
QueIdx
 = (
bUDaQ
 ==
TRUE
 ? QueIdx : 3);

118 
bUDaQ
 = 
TRUE
;

120 i(
bUDaQ
 && (!
IrqS
))

121 
	`RTMP_IRQ_LOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

127 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RESET_IN_PROGRESS
) ||

128 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
)||

129 !
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_START_UP
))

131 
Stus
 = 
NDIS_STATUS_FAILURE
;

137 #ifde
RTMP_MAC_PCI


138 i(
bUDaQ
)

140 
yC
 = 
MAX_DATAMM_RETRY
;

142 
	`RTMPFeTXDUpTxDmaDe
(
pAd
, 
QueIdx
);

143 
FeNum
 = 
	`GET_TXRING_FREENO
(
pAd
, 
QueIdx
);

148 
FeNum
 = 
	`GET_MGMTRING_FREENO
(
pAd
);

151 i((
FeNum
 > 0))

154 
	`NdisZoMemy
(&
mpHwHdr
, (
TXINFO_SIZE
 + 
TXWI_SIZE
));

155 
Stus
 = 
	`RTMPAoNdisPack
(
pAd
, &
pPack
, (
PUCHAR
)&
mpHwHdr
, (
TXINFO_SIZE
 + 
TXWI_SIZE
), 
pDa
, 
Lgth
);

156 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

158 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("MiniportMMRequest (error:: can'tllocate NDIS PACKET)\n"));

166 #ifde
RTMP_MAC_PCI


167 i(
bUDaQ
)

169 
Stus
 = 
	`MlmeDaHdTnsm
(
pAd
, 
QueIdx
, 
pPack
);

170 
yC
--;

174 
Stus
 = 
	`MlmeHdTnsm
(
pAd
, 
QueIdx
, 
pPack
);

175 i(
Stus
 =
NDIS_STATUS_SUCCESS
)

176 
yC
 = 0;

178 
	`RTMPFeNdisPack
(
pAd
, 
pPack
);

182 
pAd
->
RkCous
.
MgmtRgFuCou
++;

183 #ifde
RTMP_MAC_PCI


184 i(
bUDaQ
)

186 
yC
--;

187 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("yC %d\n", 
yC
));

188 i(
yC
 == 0)

190 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Qidx(%d),otnough space in DataRing, MgmtRingFullCount=%ld!\n",

191 
QueIdx
, 
pAd
->
RkCous
.
MgmtRgFuCou
));

195 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Qidx(%d),otnough space in MgmtRing, MgmtRingFullCount=%ld!\n",

196 
QueIdx
, 
pAd
->
RkCous
.
MgmtRgFuCou
));

198 } 
yC
 > 0);

201 #ifde
RTMP_MAC_PCI


202 i(
bUDaQ
 && (!
IrqS
))

203 
	`RTMP_IRQ_UNLOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

206  
Stus
;

207 
	}
}

236 
NDIS_STATUS
 
	$MlmeHdTnsm
(

237 
IN
 
PRTMP_ADAPTER
 
pAd
,

238 
IN
 
UCHAR
 
QueIdx
,

239 
IN
 
PNDIS_PACKET
 
pPack
)

241 
PACKET_INFO
 
PackInfo
;

242 
PUCHAR
 
pSrcBufVA
;

243 
UINT
 
SrcBufL
;

246 i((
pAd
->
CommCfg
.
RadDe
.
RDMode
 !
RD_NORMAL_MODE
)

247 #ifde
CARRIER_DETECTION_SUPPORT


251  
NDIS_STATUS_FAILURE
;

254 
	`RTMP_QuyPackInfo
(
pPack
, &
PackInfo
, &
pSrcBufVA
, &
SrcBufL
);

255 i(
pSrcBufVA
 =
NULL
)

256  
NDIS_STATUS_FAILURE
;

259 #ifde
RTMP_MAC_PCI


260 i
pAd
->
MACVsi
 == 0x28600100 )

261  
	`MlmeHdTnsmTxRg
(
pAd
,
QueIdx
,
pPack
);

264  
	`MlmeHdTnsmMgmtRg
(
pAd
,
QueIdx
,
pPack
);

266 
	}
}

269 
NDIS_STATUS
 
	$MlmeHdTnsmMgmtRg
(

270 
IN
 
PRTMP_ADAPTER
 
pAd
,

271 
IN
 
UCHAR
 
QueIdx
,

272 
IN
 
PNDIS_PACKET
 
pPack
)

274 
PACKET_INFO
 
PackInfo
;

275 
PUCHAR
 
pSrcBufVA
;

276 
UINT
 
SrcBufL
;

277 
PHEADER_802_11
 
pHd_802_11
;

278 
BOOLEAN
 
bAckRequed
, 
bInTimeamp
;

279 
UCHAR
 
MlmeRe
;

280 
PTXWI_STRUC
 
pFTxWI
;

281 
MAC_TABLE_ENTRY
 *
pMacEry
 = 
NULL
;

282 
UCHAR
 
PID
;

284 
	`RTMP_QuyPackInfo
(
pPack
, &
PackInfo
, &
pSrcBufVA
, &
SrcBufL
);

287 
	`RTMP_SEM_LOCK
(&
pAd
->
MgmtRgLock
);

288 i(
pSrcBufVA
 =
NULL
)

291 
	`RTMP_SEM_UNLOCK
(&
pAd
->
MgmtRgLock
);

292  
NDIS_STATUS_FAILURE
;

295 #ifde
CONFIG_STA_SUPPORT


296 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

299 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

300 
	`AsicFWakeup
(
pAd
, 
TRUE
);

304 
pFTxWI
 = (
PTXWI_STRUC
)(
pSrcBufVA
 + 
TXINFO_SIZE
);

305 
pHd_802_11
 = (
PHEADER_802_11
(
pSrcBufVA
 + 
TXINFO_SIZE
 + 
TXWI_SIZE
);

307 i(
pHd_802_11
->
Addr1
[0] & 0x01)

309 
MlmeRe
 = 
pAd
->
CommCfg
.
BasicMlmeRe
;

313 
MlmeRe
 = 
pAd
->
CommCfg
.MlmeRate;

317 i((
pAd
->
LchRfRegs
.
Chl
 > 14&& (
MlmeRe
 < 
RATE_6
))

318 
MlmeRe
 = 
RATE_6
;

320 i((
pHd_802_11
->
FC
.
Ty
 =
BTYPE_DATA
) &&

321 (
pHd_802_11
->
FC
.
SubTy
 =
SUBTYPE_QOS_NULL
))

323 
pMacEry
 = 
	`MacTabLookup
(
pAd
, 
pHd_802_11
->
Addr1
);

326 #ifde
CONFIG_STA_SUPPORT


327 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

330 i(
pAd
->
CommCfg
.
PhyMode
 =
PHY_11ABG_MIXED


331 #ifde
DOT11_N_SUPPORT


332 || 
pAd
->
CommCfg
.
PhyMode
 =
PHY_11ABGN_MIXED


336 i(
pAd
->
LchRfRegs
.
Chl
 > 14)

337 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 1;

339 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 0;

349 #ifde
CONFIG_STA_SUPPORT


350 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

352 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

358 
pHd_802_11
->
FC
.
PwrMgmt
 = 
PWR_ACTIVE
;

359 #ifde
CONFIG_STA_SUPPORT


363 #ifde
CONFIG_STA_SUPPORT


368 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

370 i((
pHd_802_11
->
FC
.
SubTy
 =
SUBTYPE_ACTION
) ||

371 ((
pHd_802_11
->
FC
.
Ty
 =
BTYPE_DATA
) &&

372 ((
pHd_802_11
->
FC
.
SubTy
 =
SUBTYPE_QOS_NULL
) ||

373 (
pHd_802_11
->
FC
.
SubTy
 =
SUBTYPE_NULL_FUNC
))))

375 i(
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
)

376 
pHd_802_11
->
FC
.
PwrMgmt
 = 
PWR_SAVE
;

377 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
) &&

378 
	`INFRA_ON
(
pAd
) &&

379 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

385 
pHd_802_11
->
FC
.
PwrMgmt
 = 
pAd
->
CommCfg
.
bAPSDFPowSave
;

395 
bInTimeamp
 = 
FALSE
;

396 i(
pHd_802_11
->
FC
.
Ty
 =
BTYPE_CNTL
)

398 #ifde
CONFIG_STA_SUPPORT


400 i((
pAd
->
OpMode
 =
OPMODE_STA
&& (
pHd_802_11
->
FC
.
SubTy
 =
SUBTYPE_PS_POLL
))

402 
pHd_802_11
->
FC
.
PwrMgmt
 = 
PWR_SAVE
;

405 
bAckRequed
 = 
FALSE
;

409 i(
pHd_802_11
->
Addr1
[0] & 0x01)

411 
bAckRequed
 = 
FALSE
;

412 
pHd_802_11
->
Duti
 = 0;

416 
bAckRequed
 = 
TRUE
;

417 
pHd_802_11
->
Duti
 = 
	`RTMPCcDuti
(
pAd
, 
MlmeRe
, 14);

418 i((
pHd_802_11
->
FC
.
SubTy
 =
SUBTYPE_PROBE_RSP
&& (pHd_802_11->FC.
Ty
 =
BTYPE_MGMT
))

420 
bInTimeamp
 = 
TRUE
;

421 
bAckRequed
 = 
FALSE
;

423 i((
pHd_802_11
->
FC
.
SubTy
 =
SUBTYPE_PROBE_REQ
&& (pHd_802_11->FC.
Ty
 =
BTYPE_MGMT
))

425 
bAckRequed
 = 
FALSE
;

430 
pHd_802_11
->
Sequ
 = 
pAd
->Sequence++;

431 i(
pAd
->
Sequ
 >0xfff)

432 
pAd
->
Sequ
 = 0;

436 i((
pHd_802_11
->
FC
.
SubTy
 !
SUBTYPE_PROBE_REQ
)

437 && (
pAd
->
CommCfg
.
bIEEE80211H
 == 1)

438 && (
pAd
->
CommCfg
.
RadDe
.
RDMode
 !
RD_NORMAL_MODE
))

440 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("MlmeHardTransmit -->adar detectot inormal mode !!!\n"));

442 
	`RTMP_SEM_UNLOCK
(&
pAd
->
MgmtRgLock
);

443  (
NDIS_STATUS_FAILURE
);

447 #ifde
RT_BIG_ENDIAN


448 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pHd_802_11
, 
DIR_WRITE
, 
FALSE
);

463 
PID
 = 
PID_MGMT
;

466 i(
pMacEry
 =
NULL
)

468 
	`RTMPWreTxWI
(
pAd
, 
pFTxWI
, 
FALSE
, FALSE, 
bInTimeamp
, FALSE, 
bAckRequed
, FALSE,

469 0, 
RESERVED_WCID
, (
SrcBufL
 - 
TXINFO_SIZE
 - 
TXWI_SIZE
), 
PID
, 0, (
UCHAR
)
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
, 
IFS_BACKOFF
, 
FALSE
, &pAd->CommonCfg.MlmeTransmit);

474 
	`RTMPWreTxWI
(
pAd
, 
pFTxWI
, 
FALSE
, FALSE,

475 
bInTimeamp
, 
FALSE
, 
bAckRequed
, FALSE,

476 0, 
pMacEry
->
Aid
, (
SrcBufL
 - 
TXINFO_SIZE
 - 
TXWI_SIZE
),

477 
pMacEry
->
MaxHTPhyMode
.
fld
.
MCS
, 0,

478 (
UCHAR
)
pMacEry
->
MaxHTPhyMode
.
fld
.
MCS
,

479 
IFS_BACKOFF
, 
FALSE
, &
pMacEry
->
MaxHTPhyMode
);

482 #ifde
RT_BIG_ENDIAN


483 
	`RTMPWIEndnChge
((
PUCHAR
)
pFTxWI
, 
TYPE_TXWI
);

487 
	`HAL_KickOutMgmtTx
(
pAd
, 
QueIdx
, 
pPack
, 
pSrcBufVA
, 
SrcBufL
);

491 
	`RTMP_SEM_UNLOCK
(&
pAd
->
MgmtRgLock
);

492  
NDIS_STATUS_SUCCESS
;

502 
	#DEQUEUE_LOCK
(
lock
, 
bICڋxt
, 
IrqFgs
) \

504 i(
bICڋxt
 =
FALSE
) \

505 
	`RTMP_IRQ_LOCK
((
lock
), 
IrqFgs
); \

506 }0)

	)

508 
	#DEQUEUE_UNLOCK
(
lock
, 
bICڋxt
, 
IrqFgs
) \

510 i(
bICڋxt
 =
FALSE
) \

511 
	`RTMP_IRQ_UNLOCK
((
lock
), 
IrqFgs
); \

512 }0)

	)

562 
UCHAR
 
	`TxPktCssifiti
(

563 
IN
 
RTMP_ADAPTER
 *
pAd
,

564 
IN
 
PNDIS_PACKET
 
pPack
)

566 
UCHAR
 
TxFmeTy
 = 
TX_UNKOWN_FRAME
;

567 
UCHAR
 
Wcid
;

568 
MAC_TABLE_ENTRY
 *
pMacEry
 = 
NULL
;

569 #ifde
DOT11_N_SUPPORT


570 
BOOLEAN
 
bHTRe
 = 
FALSE
;

573 
Wcid
 = 
	`RTMP_GET_PACKET_WCID
(
pPack
);

574 i(
Wcid
 =
MCAST_WCID
)

576  
TX_MCAST_FRAME
;

580 
pMacEry
 = &
pAd
->
MacTab
.
Cڋ
[
Wcid
];

581 i(
	`RTMP_GET_PACKET_LOWRATE
(
pPack
))

583 
TxFmeTy
 = 
TX_LEGACY_FRAME
;

585 #ifde
DOT11_N_SUPPORT


586 i(
	`IS_HT_RATE
(
pMacEry
))

591 
bHTRe
 = 
TRUE
;

592 i(
	`RTMP_GET_PACKET_MOREDATA
(
pPack
|| (
pMacEry
->
PsMode
 =
PWR_SAVE
))

593 
TxFmeTy
 = 
TX_LEGACY_FRAME
;

594 #ifde
UAPSD_AP_SUPPORT


595 i(
	`RTMP_GET_PACKET_EOSP
(
pPack
))

596 
TxFmeTy
 = 
TX_LEGACY_FRAME
;

598 if((
pMacEry
->
TXBAbm
 & (1<<(
	`RTMP_GET_PACKET_UP
(
pPack
)))) != 0)

599  
TX_AMPDU_FRAME
;

600 if(
	`CLIENT_STATUS_TEST_FLAG
(
pMacEry
, 
fCLIENT_STATUS_AMSDU_INUSED
))

601  
TX_AMSDU_FRAME
;

603 
TxFmeTy
 = 
TX_LEGACY_FRAME
;

608 i((
	`CLIENT_STATUS_TEST_FLAG
(
pMacEry
, 
fCLIENT_STATUS_AGGREGATION_CAPABLE
&& 
pAd
->
CommCfg
.
bAgggiCab
) &&

609 (
	`RTMP_GET_PACKET_TXRATE
(
pPack
>
RATE_6
) &&

610 (!(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_WMM_INUSED
&& 
	`CLIENT_STATUS_TEST_FLAG
(
pMacEry
, 
fCLIENT_STATUS_WMM_CAPABLE
))))

612 
TxFmeTy
 = 
TX_RALINK_FRAME
;

616 
TxFmeTy
 = 
TX_LEGACY_FRAME
;

621 i((
	`RTMP_GET_PACKET_FRAGMENTS
(
pPack
) > 1)

622 && (
TxFmeTy
 =
TX_LEGACY_FRAME
)

623 #ifde
DOT11_N_SUPPORT


624 && ((
pMacEry
->
TXBAbm
 & (1<<(
	`RTMP_GET_PACKET_UP
(
pPack
)))) == 0)

627 
TxFmeTy
 = 
TX_FRAG_FRAME
;

629  
TxFmeTy
;

633 
BOOLEAN
 
	`RTMP_FlTxBlkInfo
(

634 
IN
 
RTMP_ADAPTER
 *
pAd
,

635 
IN
 
TX_BLK
 *
pTxBlk
)

637 
PACKET_INFO
 
PackInfo
;

638 
PNDIS_PACKET
 
pPack
;

639 
PMAC_TABLE_ENTRY
 
pMacEry
 = 
NULL
;

641 
pPack
 = 
pTxBlk
->pPacket;

642 
	`RTMP_QuyPackInfo
(
pPack
, &
PackInfo
, &
pTxBlk
->
pSrcBufHd
, &pTxBlk->
SrcBufL
);

644 
pTxBlk
->
Wcid
 = 
	`RTMP_GET_PACKET_WCID
(
pPack
);

645 
pTxBlk
->
idx
 = 
	`RTMP_GET_PACKET_IF
(
pPack
);

646 
pTxBlk
->
UrPriܙy
 = 
	`RTMP_GET_PACKET_UP
(
pPack
);

647 
pTxBlk
->
FmeG
 = 
IFS_HTTXOP
;

649 i(
	`RTMP_GET_PACKET_CLEAR_EAP_FRAME
(
pTxBlk
->
pPack
))

650 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bCˬEAPFme
);

652 
	`TX_BLK_CLEAR_FLAG
(
pTxBlk
, 
fTX_bCˬEAPFme
);

655 
	`TX_BLK_CLEAR_FLAG
(
pTxBlk
, 
fTX_bFNQoS
);

658 i(
pTxBlk
->
Wcid
 =
MCAST_WCID
)

660 
pTxBlk
->
pMacEry
 = 
NULL
;

662 #ifde
MCAST_RATE_SPECIFIC


663 
PUCHAR
 
pDA
 = 
	`GET_OS_PKT_DATAPTR
(
pPack
);

664 i(((*
pDA
 & 0x01) == 0x01) && (*pDA != 0xff))

665 
pTxBlk
->
pTnsm
 = &
pAd
->
CommCfg
.
MCaPhyMode
;

668 
pTxBlk
->
pTnsm
 = &
pAd
->
MacTab
.
Cڋ
[
MCAST_WCID
].
HTPhyMode
;

671 
	`TX_BLK_CLEAR_FLAG
(
pTxBlk
, 
fTX_bAckRequed
);

673 
	`TX_BLK_CLEAR_FLAG
(
pTxBlk
, 
fTX_bAowFg
);

674 
	`TX_BLK_CLEAR_FLAG
(
pTxBlk
, 
fTX_bWMM
);

675 i(
	`RTMP_GET_PACKET_MOREDATA
(
pPack
))

677 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bMeDa
);

682 
pTxBlk
->
pMacEry
 = &
pAd
->
MacTab
.
Cڋ
[pTxBlk->
Wcid
];

683 
pTxBlk
->
pTnsm
 = &pTxBlk->
pMacEry
->
HTPhyMode
;

685 
pMacEry
 = 
pTxBlk
->pMacEntry;

688 i(
pAd
->
CommCfg
.
AckPicy
[
pTxBlk
->
QueIdx
] !
NORMAL_ACK
)

689 
	`TX_BLK_CLEAR_FLAG
(
pTxBlk
, 
fTX_bAckRequed
);

691 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bAckRequed
);

693 #ifde
CONFIG_STA_SUPPORT


694 #ifde
XLINK_SUPPORT


695 i((
pAd
->
OpMode
 =
OPMODE_STA
) &&

696 (
	`ADHOC_ON
(
pAd
))

699 if(
pAd
->
SCfg
.
PSPXlk
)

700 
	`TX_BLK_CLEAR_FLAG
(
pTxBlk
, 
fTX_bAckRequed
);

707 #ifde
CONFIG_STA_SUPPORT


708 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

713 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_WMM_INUSED
) &&

714 
	`CLIENT_STATUS_TEST_FLAG
(
pMacEry
, 
fCLIENT_STATUS_WMM_CAPABLE
))

715 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bWMM
);

723 i(
pTxBlk
->
TxFmeTy
 =
TX_LEGACY_FRAME
)

725 i(
	`RTMP_GET_PACKET_LOWRATE
(
pPack
)) ||

726 ((
pAd
->
OpMode
 =
OPMODE_AP
&& (
pMacEry
->
MaxHTPhyMode
.
fld
.
MODE
 =
MODE_CCK
&& (pMacEry->MaxHTPhyMode.fld.
MCS
 =
RATE_1
)))

728 
pTxBlk
->
pTnsm
 = &
pAd
->
MacTab
.
Cڋ
[
MCAST_WCID
].
HTPhyMode
;

730 #ifde
DOT11_N_SUPPORT


732 i(
	`IS_HT_STA
(
pTxBlk
->
pMacEry
) &&

733 (
	`CLIENT_STATUS_TEST_FLAG
(
pMacEry
, 
fCLIENT_STATUS_RALINK_CHIPSET
)) &&

734 ((
pAd
->
CommCfg
.
bRdg
 =
TRUE
&& 
	`CLIENT_STATUS_TEST_FLAG
(
pMacEry
, 
fCLIENT_STATUS_RDG_CAPABLE
)))

736 
	`TX_BLK_CLEAR_FLAG
(
pTxBlk
, 
fTX_bWMM
);

737 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bFNQoS
);

742 #ifde
DOT11_N_SUPPORT


743 i(
	`IS_HT_RATE
(
pMacEry
=
FALSE
) &&

744 (
	`CLIENT_STATUS_TEST_FLAG
(
pMacEry
, 
fCLIENT_STATUS_PIGGYBACK_CAPABLE
)))

746 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bPiggyBack
);

750 i(
	`RTMP_GET_PACKET_MOREDATA
(
pPack
))

752 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bMeDa
);

754 #ifde
UAPSD_AP_SUPPORT


755 i(
	`RTMP_GET_PACKET_EOSP
(
pPack
))

757 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bWMM_UAPSD_EOSP
);

761 i(
pTxBlk
->
TxFmeTy
 =
TX_FRAG_FRAME
)

763 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bAowFg
);

766 
pMacEry
->
DebugTxCou
++;

769 #ifde
CONFIG_STA_SUPPORT


770 
pAd
->
LaTxRe
 = (
USHORT
)
pTxBlk
->
pTnsm
->
wd
;

773  
TRUE
;

777 
BOOLEAN
 
	`CDoAgggeTnsm
(

778 
IN
 
RTMP_ADAPTER
 *
pAd
,

779 
IN
 
NDIS_PACKET
 *
pPack
,

780 
IN
 
TX_BLK
 *
pTxBlk
)

785 i(
	`RTMP_GET_PACKET_WCID
(
pPack
=
MCAST_WCID
)

786  
FALSE
;

788 i(
	`RTMP_GET_PACKET_DHCP
(
pPack
) ||

789 
	`RTMP_GET_PACKET_EAPOL
(
pPack
) ||

790 
	`RTMP_GET_PACKET_WAI
(
pPack
))

791  
FALSE
;

793 i((
pTxBlk
->
TxFmeTy
 =
TX_AMSDU_FRAME
) &&

794 ((
pTxBlk
->
TٮFmeL
 + 
	`GET_OS_PKT_LEN
(
pPack
))> (
RX_BUFFER_AGGRESIZE
 - 100)))

796  
FALSE
;

799 i((
pTxBlk
->
TxFmeTy
 =
TX_RALINK_FRAME
) &&

800 (
pTxBlk
->
TxPackLi
.
Numb
 == 2))

802  
FALSE
;

805 #ifde
CONFIG_STA_SUPPORT


806 i((
	`INFRA_ON
(
pAd
)&& (pAd->
OpMode
 =
OPMODE_STA
))

807  
TRUE
;

810  
FALSE
;

837 
VOID
 
	`RTMPDeQueuePack
(

838 
IN
 
PRTMP_ADAPTER
 
pAd
,

839 
IN
 
BOOLEAN
 
bICڋxt
,

840 
IN
 
UCHAR
 
QIdx
,

841 
IN
 
UCHAR
 
Max_Tx_Packs
)

843 
PQUEUE_ENTRY
 
pEry
 = 
NULL
;

844 
PNDIS_PACKET
 
pPack
;

845 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

846 
UCHAR
 
Cou
=0;

847 
PQUEUE_HEADER
 
pQueue
;

848 
ULONG
 
FeNumb
[
NUM_OF_TX_RING
];

849 
UCHAR
 
QueIdx
, 
sQIdx
, 
eQIdx
;

850 
IrqFgs
 = 0;

851 
BOOLEAN
 
hasTxDesc
 = 
FALSE
;

852 
TX_BLK
 
TxBlk
;

853 
TX_BLK
 *
pTxBlk
;

855 #ifde
DBG_DIAGNOSE


856 
BOOLEAN
 
fRound
;

857 
RtmpDgSu
 *
pDgSu
 = &
pAd
->
DgSu
;

861 i(
QIdx
 =
NUM_OF_TX_RING
)

863 
sQIdx
 = 0;

864 
eQIdx
 = 3;

868 
sQIdx
 = 
eQIdx
 = 
QIdx
;

871 
QueIdx
=
sQIdx
; QueIdx <
eQIdx
; QueIdx++)

873 
Cou
=0;

875 
	`RTMP_START_DEQUEUE
(
pAd
, 
QueIdx
, 
IrqFgs
);

877 #ifde
DBG_DIAGNOSE


878 
fRound
 = ((
QueIdx
 =0? 
TRUE
 : 
FALSE
);

883 i((
	`RTMP_TEST_FLAG
(
pAd
, (
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
 |

884 
fRTMP_ADAPTER_RADIO_OFF
 |

885 
fRTMP_ADAPTER_RESET_IN_PROGRESS
 |

886 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 |

887 
fRTMP_ADAPTER_NIC_NOT_EXIST
))))

889 
	`RTMP_STOP_DEQUEUE
(
pAd
, 
QueIdx
, 
IrqFgs
);

893 i(
Cou
 >
Max_Tx_Packs
)

896 
	`DEQUEUE_LOCK
(&
pAd
->
q_lock
, 
bICڋxt
, 
IrqFgs
);

897 i(&
pAd
->
TxSwQueue
[
QueIdx
] =
NULL
)

899 #ifde
DBG_DIAGNOSE


900 i(
fRound
 =
TRUE
)

901 
pDgSu
->
TxSWQueC
[pDgSu->
AayCurIdx
][0]++;

903 
	`DEQUEUE_UNLOCK
(&
pAd
->
q_lock
, 
bICڋxt
, 
IrqFgs
);

907 #ifde
RTMP_MAC_PCI


908 
FeNumb
[
QueIdx
] = 
	`GET_TXRING_FREENO
(
pAd
, QueIdx);

910 #ifde
DBG_DIAGNOSE


911 i(
fRound
 =
TRUE
)

913 
UCHAR
 
txDescNumLev
, 
txSwQNumLev
;

915 
txDescNumLev
 = (
TX_RING_SIZE
 - 
FeNumb
[
QueIdx
]);

916 
txDescNumLev
 = ((txDescNumLevel <=15) ?xDescNumLevel : 15);

917 
pDgSu
->
TxDescC
[pDgSu->
AayCurIdx
][
txDescNumLev
]++;

919 
txSwQNumLev
 = ((
pAd
->
TxSwQueue
[
QueIdx
].
Numb
 <=7) ?Ad->TxSwQueue[QueIdx].Number : 8);

920 
pDgSu
->
TxSWQueC
[pDgSu->
AayCurIdx
][
txSwQNumLev
]++;

922 
fRound
 = 
FALSE
;

926 i(
FeNumb
[
QueIdx
] <= 5)

929 
	`RTMPFeTXDUpTxDmaDe
(
pAd
, 
QueIdx
);

930 
FeNumb
[
QueIdx
] = 
	`GET_TXRING_FREENO
(
pAd
, QueIdx);

935 
pQueue
 = &
pAd
->
TxSwQueue
[
QueIdx
];

936 i((
pEry
 = 
pQueue
->
Hd
=
NULL
)

938 
	`DEQUEUE_UNLOCK
(&
pAd
->
q_lock
, 
bICڋxt
, 
IrqFgs
);

942 
pTxBlk
 = &
TxBlk
;

943 
	`NdisZoMemy
((
PUCHAR
)
pTxBlk
, (
TX_BLK
));

945 
pTxBlk
->
QueIdx
 = QueIdx;

947 #ifde
VENDOR_FEATURE1_SUPPORT


948 
pTxBlk
->
HdBuf
 = (
UCHAR
 *TxBlk->
HdBufr
;

951 
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pEry
);

955 
hasTxDesc
 = 
	`RTMP_HAS_ENOUGH_FREE_DESC
(
pAd
, 
pTxBlk
, 
FeNumb
[
QueIdx
], 
pPack
);

956 i(!
hasTxDesc
)

958 
pAd
->
PriveInfo
.
TxRgFuC
++;

960 
	`DEQUEUE_UNLOCK
(&
pAd
->
q_lock
, 
bICڋxt
, 
IrqFgs
);

965 
pTxBlk
->
TxFmeTy
 = 
	`TxPktCssifiti
(
pAd
, 
pPack
);

966 
pEry
 = 
	`RemoveHdQueue
(
pQueue
);

967 
pTxBlk
->
TٮFmeNum
++;

968 
pTxBlk
->
TٮFgNum
 +
	`RTMP_GET_PACKET_FRAGMENTS
(
pPack
);

969 
pTxBlk
->
TٮFmeL
 +
	`GET_OS_PKT_LEN
(
pPack
);

970 
pTxBlk
->
pPack
 =Packet;

971 
	`InTaQueue
(&
pTxBlk
->
TxPackLi
, 
	`PACKET_TO_QUEUE_ENTRY
(
pPack
));

974 i(
pTxBlk
->
TxFmeTy
 =
TX_RALINK_FRAME
 ||TxBlk->TxFmeTy =
TX_AMSDU_FRAME
)

977 i(
	`NEED_QUEUE_BACK_FOR_AGG
(
pAd
, 
QueIdx
, 
FeNumb
[QueIdx], 
pTxBlk
->
TxFmeTy
))

979 
	`InHdQueue
(
pQueue
, 
	`PACKET_TO_QUEUE_ENTRY
(
pPack
));

980 
	`DEQUEUE_UNLOCK
(&
pAd
->
q_lock
, 
bICڋxt
, 
IrqFgs
);

985 if((
pEry
 = 
pQueue
->
Hd
=
NULL
)

989 
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pEry
);

990 
FeNumb
[
QueIdx
] = 
	`GET_TXRING_FREENO
(
pAd
, QueIdx);

991 
hasTxDesc
 = 
	`RTMP_HAS_ENOUGH_FREE_DESC
(
pAd
, 
pTxBlk
, 
FeNumb
[
QueIdx
], 
pPack
);

992 i((
hasTxDesc
 =
FALSE
|| (
	`CDoAgggeTnsm
(
pAd
, 
pPack
, 
pTxBlk
) == FALSE))

996 
pEry
 = 
	`RemoveHdQueue
(
pQueue
);

997 
	`ASSERT
(
pEry
);

998 
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pEry
);

1001 
pTxBlk
->
TٮFmeNum
++;

1002 
pTxBlk
->
TٮFgNum
 +
	`RTMP_GET_PACKET_FRAGMENTS
(
pPack
);

1003 
pTxBlk
->
TٮFmeL
 +
	`GET_OS_PKT_LEN
(
pPack
);

1004 
	`InTaQueue
(&
pTxBlk
->
TxPackLi
, 
	`PACKET_TO_QUEUE_ENTRY
(
pPack
));

1007 i(
pTxBlk
->
TxPackLi
.
Numb
 == 1)

1008 
pTxBlk
->
TxFmeTy
 = 
TX_LEGACY_FRAME
;

1012 
Cou
 +
pTxBlk
->
TxPackLi
.
Numb
;

1015 #ifde
CONFIG_STA_SUPPORT


1016 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1017 
Stus
 = 
	`STAHdTnsm
(
pAd
, 
pTxBlk
, 
QueIdx
);

1020 #ifde
RTMP_MAC_PCI


1021 
	`DEQUEUE_UNLOCK
(&
pAd
->
q_lock
, 
bICڋxt
, 
IrqFgs
);

1024 #ifde
VENDOR_FEATURE1_SUPPORT


1025 i(++
pAd
->
FifoUpdeDe
 >= 4)

1027 
	`NICUpdeFifoSCous
(
pAd
);

1028 
pAd
->
FifoUpdeDe
 = 0;

1031 
	`NICUpdeFifoSCous
(
pAd
);

1037 
	`RTMP_STOP_DEQUEUE
(
pAd
, 
QueIdx
, 
IrqFgs
);

1040 #ifde
BLOCK_NET_IF


1041 i((
pAd
->
blockQueueTab
[
QueIdx
].
SwTxQueueBlockFg
 =
TRUE
)

1042 && (
pAd
->
TxSwQueue
[
QueIdx
].
Numb
 < 1))

1044 
	`aNIf
(&
pAd
->
blockQueueTab
[
QueIdx
]);

1075 
USHORT
 
	`RTMPCcDuti
(

1076 
IN
 
PRTMP_ADAPTER
 
pAd
,

1077 
IN
 
UCHAR
 
Re
,

1078 
IN
 
ULONG
 
Size
)

1080 
ULONG
 
Duti
 = 0;

1082 i(
Re
 < 
RATE_FIRST_OFDM_RATE
)

1084 i((
Re
 > 
RATE_1
&& 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_SHORT_PREAMBLE_INUSED
))

1085 
Duti
 = 96;

1087 
Duti
 = 192;

1089 
Duti
 +(
USHORT
)((
Size
 << 4/ 
ReIdTo500Kbps
[
Re
]);

1090 i((
Size
 << 4% 
ReIdTo500Kbps
[
Re
])

1091 
Duti
 ++;

1093 i(
Re
 <
RATE_LAST_OFDM_RATE
)

1095 
Duti
 = 20 + 6;

1096 
Duti
 +4 * (
USHORT
)((11 + 
Size
 * 4/ 
ReIdTo500Kbps
[
Re
]);

1097 i((11 + 
Size
 * 4% 
ReIdTo500Kbps
[
Re
])

1098 
Duti
 += 4;

1102 
Duti
 = 20 + 6;

1105  (
USHORT
)
Duti
;

1138 
VOID
 
	`RTMPWreTxWI
(

1139 
IN
 
PRTMP_ADAPTER
 
pAd
,

1140 
IN
 
PTXWI_STRUC
 
pOutTxWI
,

1141 
IN
 
BOOLEAN
 
FRAG
,

1142 
IN
 
BOOLEAN
 
CFACK
,

1143 
IN
 
BOOLEAN
 
InsTimeamp
,

1144 
IN
 
BOOLEAN
 
AMPDU
,

1145 
IN
 
BOOLEAN
 
Ack
,

1146 
IN
 
BOOLEAN
 
NSeq
,

1147 
IN
 
UCHAR
 
BASize
,

1148 
IN
 
UCHAR
 
WCID
,

1149 
IN
 
ULONG
 
Lgth
,

1150 
IN
 
UCHAR
 
PID
,

1151 
IN
 
UCHAR
 
TID
,

1152 
IN
 
UCHAR
 
TxRe
,

1153 
IN
 
UCHAR
 
Txmode
,

1154 
IN
 
BOOLEAN
 
CfAck
,

1155 
IN
 
HTTRANSMIT_SETTING
 *
pTnsm
)

1157 
PMAC_TABLE_ENTRY
 
pMac
 = 
NULL
;

1158 
TXWI_STRUC
 
TxWI
;

1159 
PTXWI_STRUC
 
pTxWI
;

1161 i(
WCID
 < 
MAX_LEN_OF_MAC_TABLE
)

1162 
pMac
 = &
pAd
->
MacTab
.
Cڋ
[
WCID
];

1168 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_SHORT_PREAMBLE_INUSED
);

1169 
	`NdisZoMemy
(&
TxWI
, 
TXWI_SIZE
);

1170 
pTxWI
 = &
TxWI
;

1172 
pTxWI
->
FRAG
= FRAG;

1174 
pTxWI
->
CFACK
 = CFACK;

1175 
pTxWI
->
TS

InsTimeamp
;

1176 
pTxWI
->
AMPDU
 = AMPDU;

1177 
pTxWI
->
ACK
 = 
Ack
;

1178 
pTxWI
->
tx

Txmode
;

1180 
pTxWI
->
NSEQ
 = 
NSeq
;

1182 #ifde
DOT11_N_SUPPORT


1183 
BASize
 = 
pAd
->
CommCfg
.
TxBASize
;

1184 i(
pAd
->
MACVsi
 == 0x28720200)

1186 if
BASize
 >13 )

1187 
BASize
 =13;

1191 if
BASize
 >7 )

1192 
BASize
 =7;

1195 
pTxWI
->
BAWSize
 = 
BASize
;

1196 
pTxWI
->
ShtGI
 = 
pTnsm
->
fld
.ShortGI;

1197 
pTxWI
->
STBC
 = 
pTnsm
->
fld
.STBC;

1201 
pTxWI
->
WessCliID
 = 
WCID
;

1202 
pTxWI
->
MPDUtٮByCou
 = 
Lgth
;

1203 
pTxWI
->
PackId
 = 
PID
;

1206 
pTxWI
->
BW
 = (
pTnsm
->
fld
.
MODE
 <
MODE_OFDM
? (
BW_20
) : (pTransmit->field.BW);

1207 #ifde
DOT11_N_SUPPORT


1208 #ifde
DOT11N_DRAFT3


1209 i(
pTxWI
->
BW
)

1210 
pTxWI
->
BW
 = (
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
RecomWidth
 =0? (
BW_20
: (
pTnsm
->
fld
.BW);

1214 
pTxWI
->
MCS
 = 
pTnsm
->
fld
.MCS;

1215 
pTxWI
->
PHYMODE
 = 
pTnsm
->
fld
.
MODE
;

1216 
pTxWI
->
CFACK
 = 
CfAck
;

1218 #ifde
DOT11_N_SUPPORT


1219 i(
pMac
)

1221 i(
pAd
->
CommCfg
.
bMIMOPSEb
)

1223 i((
pMac
->
MmpsMode
 =
MMPS_DYNAMIC
&& (
pTnsm
->
fld
.
MCS
 > 7))

1226 
pTxWI
->
MIMOps
 = 1;

1228 i(
pMac
->
MmpsMode
 =
MMPS_STATIC
)

1231 i(
pTnsm
->
fld
.
MODE
 >
MODE_HTMIX
 &&Tnsm->fld.
MCS
 > 7)

1233 
pTxWI
->
MCS
 = 7;

1234 
pTxWI
->
MIMOps
 = 0;

1240 i(
pMac
->
bIAmBadAthos
 && (pMac->
WStus
 !
Ndis802_11WEPDibd
))

1242 
pTxWI
->
MpduDsy
 = 7;

1246 
pTxWI
->
MpduDsy
 = 
pMac
->MpduDensity;

1252 
pTxWI
->
PackId
 =TxWI->
MCS
;

1253 
	`NdisMoveMemy
(
pOutTxWI
, &
TxWI
, (
TXWI_STRUC
));

1257 
VOID
 
	`RTMPWreTxWI_Da
(

1258 
IN
 
PRTMP_ADAPTER
 
pAd
,

1259 
IN
 
OUT
 
PTXWI_STRUC
 
pTxWI
,

1260 
IN
 
TX_BLK
 *
pTxBlk
)

1262 
HTTRANSMIT_SETTING
 *
pTnsm
;

1263 
PMAC_TABLE_ENTRY
 
pMacEry
;

1264 #ifde
DOT11_N_SUPPORT


1265 
UCHAR
 
BASize
;

1269 
	`ASSERT
(
pTxWI
);

1271 
pTnsm
 = 
pTxBlk
->pTransmit;

1272 
pMacEry
 = 
pTxBlk
->pMacEntry;

1279 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_SHORT_PREAMBLE_INUSED
);

1280 
	`NdisZoMemy
(
pTxWI
, 
TXWI_SIZE
);

1282 
pTxWI
->
FRAG
 = 
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bAowFg
);

1283 
pTxWI
->
ACK
 = 
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bAckRequed
);

1284 
pTxWI
->
tx
 = 
pTxBlk
->
FmeG
;

1286 #ifde
CONFIG_STA_SUPPORT


1287 #ifde
QOS_DLS_SUPPORT


1288 i(
pMacEry
 &&

1289 (
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
) &&

1290 
	`IS_ENTRY_DLS
(
pMacEry
))

1291 
pTxWI
->
WessCliID
 = 
BSSID_WCID
;

1295 
pTxWI
->
WessCliID
 = 
pTxBlk
->
Wcid
;

1297 
pTxWI
->
MPDUtٮByCou
 = 
pTxBlk
->
MpduHdL
 +TxBlk->
SrcBufL
;

1298 
pTxWI
->
CFACK
 = 
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bPiggyBack
);

1301 
pTxWI
->
BW
 = (
pTnsm
->
fld
.
MODE
 <
MODE_OFDM
? (
BW_20
) : (pTransmit->field.BW);

1302 #ifde
DOT11_N_SUPPORT


1303 #ifde
DOT11N_DRAFT3


1304 i(
pTxWI
->
BW
)

1305 
pTxWI
->
BW
 = (
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
RecomWidth
 =0? (
BW_20
: (
pTnsm
->
fld
.BW);

1307 
pTxWI
->
AMPDU
 = ((
pTxBlk
->
TxFmeTy
 =
TX_AMPDU_FRAME
? 
TRUE
 : 
FALSE
);

1309 
BASize
 = 
pAd
->
CommCfg
.
TxBASize
;

1311 if((
pTxBlk
->
TxFmeTy
 =
TX_AMPDU_FRAME
&& (
pMacEry
))

1313 
UCHAR
 
RABAOriIdx
 = 0;

1315 
RABAOriIdx
 = 
pTxBlk
->
pMacEry
->
BAOriWcidAay
[pTxBlk->
UrPriܙy
];

1316 
BASize
 = 
pAd
->
BATab
.
BAOriEry
[
RABAOriIdx
].
BAWSize
;

1320 
pTxWI
->
BAWSize
 = 
BASize
;

1321 
pTxWI
->
ShtGI
 = 
pTnsm
->
fld
.ShortGI;

1322 
pTxWI
->
STBC
 = 
pTnsm
->
fld
.STBC;

1326 
pTxWI
->
MCS
 = 
pTnsm
->
fld
.MCS;

1327 
pTxWI
->
PHYMODE
 = 
pTnsm
->
fld
.
MODE
;

1331 #ifde
DOT11_N_SUPPORT


1332 i(
pMacEry
)

1334 i((
pMacEry
->
MmpsMode
 =
MMPS_DYNAMIC
&& (
pTnsm
->
fld
.
MCS
 > 7))

1337 
pTxWI
->
MIMOps
 = 1;

1339 i(
pMacEry
->
MmpsMode
 =
MMPS_STATIC
)

1342 i(
pTnsm
->
fld
.
MODE
 >
MODE_HTMIX
 &&Tnsm->fld.
MCS
 > 7)

1344 
pTxWI
->
MCS
 = 7;

1345 
pTxWI
->
MIMOps
 = 0;

1349 i(
pMacEry
->
bIAmBadAthos
 && (pMacEry->
WStus
 !
Ndis802_11WEPDibd
))

1351 
pTxWI
->
MpduDsy
 = 7;

1355 
pTxWI
->
MpduDsy
 = 
pMacEry
->MpduDensity;

1362 #ifde
DBG_DIAGNOSE


1363 i(
pTxBlk
->
QueIdx
== 0)

1365 
pAd
->
DgSu
.
TxDaC
[pAd->DgSu.
AayCurIdx
]++;

1366 
pAd
->
DgSu
.
TxMcsC
[pAd->DgSu.
AayCurIdx
][
pTxWI
->
MCS
]++;

1371 
pTxWI
->
PackId
 =TxWI->
MCS
;

1372 #ifde
INF_AMAZON_SE


1374 if
	`RTMP_GET_PACKET_NOBULKOUT
(
pTxBlk
->
pPack
))

1376 if(
pTxWI
->
PHYMODE
 =
MODE_CCK
)

1378 
pTxWI
->
PackId
 = 6;

1386 
VOID
 
	`RTMPWreTxWI_Cache
(

1387 
IN
 
PRTMP_ADAPTER
 
pAd
,

1388 
IN
 
OUT
 
PTXWI_STRUC
 
pTxWI
,

1389 
IN
 
TX_BLK
 *
pTxBlk
)

1391 
PHTTRANSMIT_SETTING
 
pTnsm
;

1392 
PMAC_TABLE_ENTRY
 
pMacEry
;

1393 #ifde
DOT11_N_SUPPORT


1399 
pMacEry
 = 
pTxBlk
->pMacEntry;

1400 
pTnsm
 = 
pTxBlk
->pTransmit;

1405 i(
pMacEry
->
bAutoTxReSwch
)

1407 
pTxWI
->
tx
 = 
IFS_HTTXOP
;

1410 
pTxWI
->
BW
 = (
pTnsm
->
fld
.
MODE
 <
MODE_OFDM
? (
BW_20
) : (pTransmit->field.BW);

1411 
pTxWI
->
ShtGI
 = 
pTnsm
->
fld
.ShortGI;

1412 
pTxWI
->
STBC
 = 
pTnsm
->
fld
.STBC;

1415 
pTxWI
->
MCS
 = 
pTnsm
->
fld
.MCS;

1416 
pTxWI
->
PHYMODE
 = 
pTnsm
->
fld
.
MODE
;

1419 
pTxWI
->
PackId
 = 
pTnsm
->
fld
.
MCS
;

1422 #ifde
DOT11_N_SUPPORT


1423 
pTxWI
->
AMPDU
 = ((
pMacEry
->
NoBADaCouDown
 =0? 
TRUE
: 
FALSE
);

1424 
pTxWI
->
MIMOps
 = 0;

1426 #ifde
DOT11N_DRAFT3


1427 i(
pTxWI
->
BW
)

1428 
pTxWI
->
BW
 = (
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
RecomWidth
 =0? (
BW_20
: (
pTnsm
->
fld
.BW);

1431 i(
pAd
->
CommCfg
.
bMIMOPSEb
)

1434 i((
pMacEry
->
MmpsMode
 =
MMPS_DYNAMIC
&& (
pTnsm
->
fld
.
MCS
 > 7))

1437 
pTxWI
->
MIMOps
 = 1;

1439 i(
pMacEry
->
MmpsMode
 =
MMPS_STATIC
)

1442 i((
pTnsm
->
fld
.
MODE
 >
MODE_HTMIX
&& (pTnsm->fld.
MCS
 > 7))

1444 
pTxWI
->
MCS
 = 7;

1445 
pTxWI
->
MIMOps
 = 0;

1452 #ifde
DBG_DIAGNOSE


1453 i(
pTxBlk
->
QueIdx
== 0)

1455 
pAd
->
DgSu
.
TxDaC
[pAd->DgSu.
AayCurIdx
]++;

1456 
pAd
->
DgSu
.
TxMcsC
[pAd->DgSu.
AayCurIdx
][
pTxWI
->
MCS
]++;

1461 
pTxWI
->
MPDUtٮByCou
 = 
pTxBlk
->
MpduHdL
 +TxBlk->
SrcBufL
;

1483 
VOID
 
	`RTMPSudMsduTnsmissi
(

1484 
IN
 
PRTMP_ADAPTER
 
pAd
)

1486 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("SCANNING, suspend MSDUransmission ...\n"));

1493 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R66
, &pAd->
BbpTung
.
R66CutVue
);

1497 
	`RTMPSAGCInVue
(
pAd
, 
BW_20
);

1499 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
);

1522 
VOID
 
	`RTMPResumeMsduTnsmissi
(

1523 
IN
 
PRTMP_ADAPTER
 
pAd
)

1527 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("SCAN done,esume MSDUransmission ...\n"));

1532 i(
pAd
->
BbpTung
.
R66CutVue
 == 0)

1534 
pAd
->
BbpTung
.
R66CutVue
 = 0x38;

1535 
	`DBGPRINT_ERR
(("RTMPResumeMsduTransmission, R66CurrentValue=0...\n"));

1538 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
,Ad->
BbpTung
.
R66CutVue
);

1540 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
);

1546 
	`RTMPDeQueuePack
(
pAd
, 
FALSE
, 
NUM_OF_TX_RING
, 
MAX_TX_PROCESS
);

1549 #ifde
DOT11_N_SUPPORT


1550 
UINT
 
	`dggge_AMSDU_noun
(

1551 
IN
 
PRTMP_ADAPTER
 
pAd
,

1552 
PNDIS_PACKET
 
pPack
,

1553 
IN
 
PUCHAR
 
pDa
,

1554 
IN
 
ULONG
 
DaSize
)

1556 
USHORT
 
PayldSize
;

1557 
USHORT
 
SubFmeSize
;

1558 
PHEADER_802_3
 
pAMSDUsubhd
;

1559 
UINT
 
nMSDU
;

1560 
UCHAR
 
Hd802_3
[14];

1562 
PUCHAR
 
pPayld
, 
pDA
, 
pSA
, 
pRemovedLLCSNAP
;

1563 
PNDIS_PACKET
 
pClePack
;

1567 
nMSDU
 = 0;

1569 
DaSize
 > 
LENGTH_802_3
)

1572 
nMSDU
++;

1575 
pAMSDUsubhd
 = (
PHEADER_802_3
)
pDa
;

1577 
PayldSize
 = 
pAMSDUsubhd
->
O
[1] + (pAMSDUsubheader->Octet[0]<<8);

1578 
SubFmeSize
 = 
PayldSize
 + 
LENGTH_802_3
;

1581 i((
DaSize
 < 
SubFmeSize
|| (
PayldSize
 > 1518 ))

1588 
pPayld
 = 
pDa
 + 
LENGTH_802_3
;

1589 
pDA
 = 
pDa
;

1590 
pSA
 = 
pDa
 + 
MAC_ADDR_LEN
;

1593 
	`CONVERT_TO_802_3
(
Hd802_3
, 
pDA
, 
pSA
, 
pPayld
, 
PayldSize
, 
pRemovedLLCSNAP
);

1595 #ifde
CONFIG_STA_SUPPORT


1596 i((
Hd802_3
[12] == 0x88) && (Header802_3[13] == 0x8E) )

1599 
MLME_QUEUE_ELEM
 *
Em
 = (MLME_QUEUE_ELEM *
	`kmloc
((MLME_QUEUE_ELEM), 
MEM_ALLOC_FLAG
);

1600 i(
Em
 !
NULL
)

1602 
	`memmove
(
Em
->
Msg
+(
LENGTH_802_11
 + 
LENGTH_802_1_H
), 
pPayld
, 
PayldSize
);

1603 
Em
->
MsgL
 = 
LENGTH_802_11
 + 
LENGTH_802_1_H
 + 
PayldSize
;

1605 
	`REPORT_MGMT_FRAME_TO_MLME
(
pAd
, 
BSSID_WCID
, 
Em
->
Msg
, Em->
MsgL
, 0, 0, 0, 0);

1606 
	`k
(
Em
);

1611 #ifde
CONFIG_STA_SUPPORT


1612 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1614 i(
pRemovedLLCSNAP
)

1616 
pPayld
 -
LENGTH_802_3
;

1617 
PayldSize
 +
LENGTH_802_3
;

1618 
	`NdisMoveMemy
(
pPayld
, &
Hd802_3
[0], 
LENGTH_802_3
);

1623 
pClePack
 = 
	`ClePack
(
pAd
, 
pPack
, 
pPayld
, 
PayldSize
);

1624 i(
pClePack
)

1626 #ifde
CONFIG_STA_SUPPORT


1627 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1628 
	`ANNOUNCE_OR_FORWARD_802_3_PACKET
(
pAd
, 
pClePack
, 
	`RTMP_GET_PACKET_IF
(
pPack
));

1635 
SubFmeSize
 = (SubFrameSize+3)&(~0x3);

1638 i(
SubFmeSize
 > 1528 || SubFrameSize < 32)

1643 i(
DaSize
 > 
SubFmeSize
)

1645 
pDa
 +
SubFmeSize
;

1646 
DaSize
 -
SubFmeSize
;

1651 
DaSize
 = 0;

1656 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

1658  
nMSDU
;

1662 
UINT
 
	`BA_Red_AMSDU_Anoun
(

1663 
IN
 
PRTMP_ADAPTER
 
pAd
,

1664 
IN
 
PNDIS_PACKET
 
pPack
)

1666 
PUCHAR
 
pDa
;

1667 
USHORT
 
DaSize
;

1668 
UINT
 
nMSDU
 = 0;

1670 
pDa
 = (
PUCHAR

	`GET_OS_PKT_DATAPTR
(
pPack
);

1671 
DaSize
 = (
USHORT

	`GET_OS_PKT_LEN
(
pPack
);

1673 
nMSDU
 = 
	`dggge_AMSDU_noun
(
pAd
, 
pPack
, 
pDa
, 
DaSize
);

1675  
nMSDU
;

1678 
VOID
 
	`Indi_AMSDU_Pack
(

1679 
IN
 
PRTMP_ADAPTER
 
pAd
,

1680 
IN
 
RX_BLK
 *
pRxBlk
,

1681 
IN
 
UCHAR
 
FromWhichBSSID
)

1683 
UINT
 
nMSDU
;

1685 
	`upde_os_ck_fo
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

1686 
	`RTMP_SET_PACKET_IF
(
pRxBlk
->
pRxPack
, 
FromWhichBSSID
);

1687 
nMSDU
 = 
	`dggge_AMSDU_noun
(
pAd
, 
pRxBlk
->
pRxPack
,RxBlk->
pDa
,RxBlk->
DaSize
);

1699 
MAC_TABLE_ENTRY
 *
	`MacTabLookup
(

1700 
IN
 
PRTMP_ADAPTER
 
pAd
,

1701 
PUCHAR
 
pAddr
)

1703 
ULONG
 
HashIdx
;

1704 
MAC_TABLE_ENTRY
 *
pEry
 = 
NULL
;

1706 
HashIdx
 = 
	`MAC_ADDR_HASH_INDEX
(
pAddr
);

1707 
pEry
 = 
pAd
->
MacTab
.
Hash
[
HashIdx
];

1709 
pEry
 && !
	`IS_ENTRY_NONE
(pEntry))

1711 i(
	`MAC_ADDR_EQUAL
(
pEry
->
Addr
, 
pAddr
))

1716 
pEry
 =Ery->
pNext
;

1719  
pEry
;

1722 
MAC_TABLE_ENTRY
 *
	`MacTabInEry
(

1723 
IN
 
PRTMP_ADAPTER
 
pAd
,

1724 
IN
 
PUCHAR
 
pAddr
,

1725 
IN
 
UCHAR
 
idx
,

1726 
IN
 
BOOLEAN
 
C˪A
)

1728 
UCHAR
 
HashIdx
;

1729 
i
, 
FWcid
;

1730 
MAC_TABLE_ENTRY
 *
pEry
 = 
NULL
, *
pCuEry
;

1735 i(
pAd
->
MacTab
.
Size
 >
MAX_LEN_OF_MAC_TABLE
)

1736  
NULL
;

1738 
FWcid
 = 1;

1739 #ifde
CONFIG_STA_SUPPORT


1740 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1741 i(
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
)

1742 
FWcid
 = 2;

1746 
	`NdisAcqueSpLock
(&
pAd
->
MacTabLock
);

1747 
i
 = 
FWcid
; i< 
MAX_LEN_OF_MAC_TABLE
; i++)

1750 i(
	`IS_ENTRY_NONE
(&
pAd
->
MacTab
.
Cڋ
[
i
]))

1752 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
i
];

1753 i(
C˪A
 =
TRUE
)

1755 
pEry
->
MaxSu܋dRe
 = 
RATE_11
;

1756 
pEry
->
CuTxRe
 = 
RATE_11
;

1757 
	`NdisZoMemy
(
pEry
, (
MAC_TABLE_ENTRY
));

1758 
pEry
->
PawiKey
.
KeyL
 = 0;

1759 
pEry
->
PawiKey
.
ChAlg
 = 
CIPHER_NONE
;

1761 #ifde
CONFIG_STA_SUPPORT


1762 #ifde
QOS_DLS_SUPPORT


1763 i(
idx
 >
MIN_NET_DEVICE_FOR_DLS
)

1765 
	`SET_ENTRY_DLS
(
pEry
);

1766 
pEry
->
isCached
 = 
FALSE
;

1773 #ifde
CONFIG_STA_SUPPORT


1774 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1776 
	`SET_ENTRY_CLIENT
(
pEry
);

1781 
pEry
->
bIAmBadAthos
 = 
FALSE
;

1782 
	`RTMPInTim
(
pAd
, &
pEry
->
EnqueueSFPSKTim
, 
	`GET_TIMER_FUNCTION
(
EnqueueSFPSKExec
),Ery, 
FALSE
);

1783 #ifde
CONFIG_STA_SUPPORT


1786 
pEry
->
pAd
 =Ad;

1787 
pEry
->
CMTimRug
 = 
FALSE
;

1788 
pEry
->
EnqueueESTimRug
 = 
EAPOL_START_DISABLE
;

1789 
pEry
->
RSNIE_L
 = 0;

1790 
	`NdisZoMemy
(
pEry
->
R_Cou
, (pEntry->R_Counter));

1791 
pEry
->
ReTryCou
 = 
PEER_MSG1_RETRY_TIMER_CTR
;

1793 i(
	`IS_ENTRY_MESH
(
pEry
))

1794 
pEry
->
idx
 = (idx - 
MIN_NET_DEVICE_FOR_MESH
);

1795 i(
	`IS_ENTRY_APCLI
(
pEry
))

1796 
pEry
->
idx
 = (idx - 
MIN_NET_DEVICE_FOR_APCLI
);

1797 i(
	`IS_ENTRY_WDS
(
pEry
))

1798 
pEry
->
idx
 = (idx - 
MIN_NET_DEVICE_FOR_WDS
);

1799 #ifde
CONFIG_STA_SUPPORT


1800 #ifde
QOS_DLS_SUPPORT


1801 i(
	`IS_ENTRY_DLS
(
pEry
))

1802 
pEry
->
idx
 = (idx - 
MIN_NET_DEVICE_FOR_DLS
);

1806 
pEry
->
idx
 =pidx;

1811 #ifde
CONFIG_STA_SUPPORT


1812 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1814 
pEry
->
AuthMode
 = 
pAd
->
SCfg
.AuthMode;

1815 
pEry
->
WStus
 = 
pAd
->
SCfg
.WepStatus;

1816 
pEry
->
PrivacyFr
 = 
Ndis802_11PrivFrAcA
;

1821 
pEry
->
GTKS
 = 
REKEY_NEGOTIATING
;

1822 
pEry
->
PawiKey
.
KeyL
 = 0;

1823 
pEry
->
PawiKey
.
ChAlg
 = 
CIPHER_NONE
;

1824 #ifde
CONFIG_STA_SUPPORT


1825 #ifde
QOS_DLS_SUPPORT


1826 i(
	`IS_ENTRY_DLS
(
pEry
))

1827 
pEry
->
PtSecud
 = 
WPA_802_1X_PORT_SECURED
;

1831 
pEry
->
PtSecud
 = 
WPA_802_1X_PORT_NOT_SECURED
;

1833 
pEry
->
PMKID_CacheIdx
 = 
ENTRY_NOT_FOUND
;

1834 
	`COPY_MAC_ADDR
(
pEry
->
Addr
, 
pAddr
);

1835 
pEry
->
S
 = 
SST_NOT_AUTH
;

1836 
pEry
->
AuthS
 = 
AS_NOT_AUTH
;

1837 
pEry
->
Aid
 = (
USHORT
)
i
;

1838 
pEry
->
CabyInfo
 = 0;

1839 
pEry
->
PsMode
 = 
PWR_ACTIVE
;

1840 
pEry
->
PsQIdCou
 = 0;

1841 
pEry
->
NoDaIdCou
 = 0;

1842 
pEry
->
AssocDdLe
 = 
MAC_TABLE_ASSOC_TIMEOUT
;

1843 
pEry
->
CtueTxFaC
 = 0;

1844 #ifde
WDS_SUPPORT


1845 
pEry
->
LockEryTx
 = 
FALSE
;

1846 
pEry
->
TimeSmp_toTxRg
 = 0;

1848 
	`InlizeQueueHd
(&
pEry
->
PsQueue
);

1852 
pAd
->
MacTab
.
Size
 ++;

1856 
	`RTMP_REMOVE_PAIRWISE_KEY_ENTRY
(
pAd
, (
UCHAR
)
i
);

1859 
	`RTMP_STA_ENTRY_ADD
(
pAd
, 
pEry
);

1865 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MacTabInEry -ory #%d, Tٮ%d\n",
i
, 
pAd
->
MacTab
.
Size
));

1871 i(
pEry
)

1873 
HashIdx
 = 
	`MAC_ADDR_HASH_INDEX
(
pAddr
);

1874 i(
pAd
->
MacTab
.
Hash
[
HashIdx
] =
NULL
)

1876 
pAd
->
MacTab
.
Hash
[
HashIdx
] = 
pEry
;

1880 
pCuEry
 = 
pAd
->
MacTab
.
Hash
[
HashIdx
];

1881 
pCuEry
->
pNext
 !
NULL
)

1882 
pCuEry
 =CuEry->
pNext
;

1883 
pCuEry
->
pNext
 = 
pEry
;

1887 
	`NdisRSpLock
(&
pAd
->
MacTabLock
);

1888  
pEry
;

1897 
BOOLEAN
 
	`MacTabDeEry
(

1898 
IN
 
PRTMP_ADAPTER
 
pAd
,

1899 
IN
 
USHORT
 
wcid
,

1900 
IN
 
PUCHAR
 
pAddr
)

1902 
USHORT
 
HashIdx
;

1903 
MAC_TABLE_ENTRY
 *
pEry
, *
pPvEry
, *
pProbeEry
;

1904 
BOOLEAN
 
Ced
;

1908 i(
wcid
 >
MAX_LEN_OF_MAC_TABLE
)

1909  
FALSE
;

1911 
	`NdisAcqueSpLock
(&
pAd
->
MacTabLock
);

1913 
HashIdx
 = 
	`MAC_ADDR_HASH_INDEX
(
pAddr
);

1915 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
wcid
];

1917 i(
pEry
 && !
	`IS_ENTRY_NONE
(pEntry))

1919 i(
	`MAC_ADDR_EQUAL
(
pEry
->
Addr
, 
pAddr
))

1923 
	`RTMP_STA_ENTRY_MAC_RESET
(
pAd
, 
wcid
);

1925 #ifde
DOT11_N_SUPPORT


1927 
	`BASessiTrDownALL
(
pAd
, 
pEry
->
Aid
);

1930 #ifde
CONFIG_STA_SUPPORT


1935 
pPvEry
 = 
NULL
;

1936 
pProbeEry
 = 
pAd
->
MacTab
.
Hash
[
HashIdx
];

1937 
	`ASSERT
(
pProbeEry
);

1942 i(
pProbeEry
 =
pEry
)

1944 i(
pPvEry
 =
NULL
)

1946 
pAd
->
MacTab
.
Hash
[
HashIdx
] = 
pEry
->
pNext
;

1950 
pPvEry
->
pNext
 = 
pEry
->pNext;

1955 
pPvEry
 = 
pProbeEry
;

1956 
pProbeEry
 =ProbeEry->
pNext
;

1957 } 
pProbeEry
);

1960 
	`ASSERT
(
pProbeEry
 !
NULL
);

1965 i(
pEry
->
EnqueueESTimRug
 !
EAPOL_START_DISABLE
)

1967 
	`RTMPClTim
(&
pEry
->
EnqueueSFPSKTim
, &
Ced
);

1968 
pEry
->
EnqueueESTimRug
 = 
EAPOL_START_DISABLE
;

1973 
	`NdisZoMemy
(
pEry
, (
MAC_TABLE_ENTRY
));

1974 
pAd
->
MacTab
.
Size
 --;

1975 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MacTabDeEry1 - Tٮ%d\n", 
pAd
->
MacTab
.
Size
));

1979 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n%s: Impossib Wcid = %d !!!!!\n", 
__FUNCTION__
, 
wcid
));

1983 
	`NdisRSpLock
(&
pAd
->
MacTabLock
);

1986 i(
pAd
->
MacTab
.
Size
 == 0)

1988 #ifde
DOT11_N_SUPPORT


1989 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo2
.
OiMode
 = 0;

1992 
	`RTMP_UPDATE_PROTECT
(
pAd
);

1995  
TRUE
;

2006 
VOID
 
	`MacTabRet
(

2007 
IN
 
PRTMP_ADAPTER
 
pAd
)

2009 
i
;

2010 
BOOLEAN
 
Ced
;

2012 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MacTableReset\n"));

2016 
i
=1; i<
MAX_LEN_OF_MAC_TABLE
; i++)

2018 i(
	`IS_ENTRY_CLIENT
(&
pAd
->
MacTab
.
Cڋ
[
i
]))

2023 
	`RTMPClTim
(&
pAd
->
MacTab
.
Cڋ
[
i
].
EnqueueSFPSKTim
, &
Ced
);

2024 #ifde
CONFIG_STA_SUPPORT


2026 
pAd
->
MacTab
.
Cڋ
[
i
].
EnqueueESTimRug
 = 
EAPOL_START_DISABLE
;

2030 
	`MacTabDeEry
(
pAd
, 
i
,Ad->
MacTab
.
Cڋ
[i].
Addr
);

2045 
VOID
 
	`AssocPmFl
(

2046 
IN
 
PRTMP_ADAPTER
 
pAd
,

2047 
IN
 
OUT
 
MLME_ASSOC_REQ_STRUCT
 *
AssocReq
,

2048 
IN
 
PUCHAR
 
pAddr
,

2049 
IN
 
USHORT
 
CabyInfo
,

2050 
IN
 
ULONG
 
Timeout
,

2051 
IN
 
USHORT
 
LiIv
)

2053 
	`COPY_MAC_ADDR
(
AssocReq
->
Addr
, 
pAddr
);

2055 
AssocReq
->
CabyInfo
 = CabyInf& 
SUPPORTED_CAPABILITY_INFO
;

2056 
AssocReq
->
Timeout
 = Timeout;

2057 
AssocReq
->
LiIv
 = ListenIntv;

2069 
VOID
 
	`DissocPmFl
(

2070 
IN
 
PRTMP_ADAPTER
 
pAd
,

2071 
IN
 
OUT
 
MLME_DISASSOC_REQ_STRUCT
 *
DissocReq
,

2072 
IN
 
PUCHAR
 
pAddr
,

2073 
IN
 
USHORT
 
Rs
)

2075 
	`COPY_MAC_ADDR
(
DissocReq
->
Addr
, 
pAddr
);

2076 
DissocReq
->
Rs
 = Reason;

2080 
BOOLEAN
 
	`RTMPCheckEthTy
(

2081 
IN
 
PRTMP_ADAPTER
 
pAd
,

2082 
IN
 
PNDIS_PACKET
 
pPack
,

2083 
IN
 
PMAC_TABLE_ENTRY
 
pMacEry
,

2084 
OUT
 
PUCHAR
 
pUrPriܙy
,

2085 
OUT
 
PUCHAR
 
pQueIdx
)

2087 
USHORT
 
TyL
;

2088 
UCHAR
 
By0
, 
By1
;

2089 
PUCHAR
 
pSrcBuf
;

2090 
UINT32
 
pktL
;

2091 
UINT16
 
cPt
, 
dPt
;

2092 
BOOLEAN
 
bWmmReq
;

2095 
bWmmReq
 = (

2096 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_WMM_INUSED
))

2097 && ((
pMacEry
&& 
	`CLIENT_STATUS_TEST_FLAG
MacEry, 
fCLIENT_STATUS_WMM_CAPABLE
));

2099 
pSrcBuf
 = 
	`GET_OS_PKT_DATAPTR
(
pPack
);

2100 
pktL
 = 
	`GET_OS_PKT_LEN
(
pPack
);

2102 
	`ASSERT
(
pSrcBuf
);

2104 
	`RTMP_SET_PACKET_SPECIFIC
(
pPack
, 0);

2107 
TyL
 = (
pSrcBuf
[12] << 8) |SrcBuf[13];

2109 
pSrcBuf
 +
LENGTH_802_3
;

2111 i(
TyL
 <= 1500)

2119 i(
pSrcBuf
[0] == 0xAA &&SrcBuf[1] == 0xAA &&SrcBuf[2] == 0x03)

2121 
	`Sniff2BysFromNdisBufr
((
PNDIS_BUFFER
)
pSrcBuf
, 6, &
By0
, &
By1
);

2122 
	`RTMP_SET_PACKET_LLCSNAP
(
pPack
, 1);

2123 
TyL
 = (
USHORT
)((
By0
 << 8+ 
By1
);

2124 
pSrcBuf
 += 8;

2133 i(
TyL
 == 0x8100)

2147 
	`RTMP_SET_PACKET_VLAN
(
pPack
, 1);

2148 
	`Sniff2BysFromNdisBufr
((
PNDIS_BUFFER
)
pSrcBuf
, 2, &
By0
, &
By1
);

2149 
TyL
 = (
USHORT
)((
By0
 << 8+ 
By1
);

2152 i(
bWmmReq
)

2154 *
pUrPriܙy
 = (*
pSrcBuf
 & 0xe0) >> 5;

2155 *
pQueIdx
 = 
MUrPriܙyToAcssCegy
[*
pUrPriܙy
];

2158 
pSrcBuf
 += 4;

2160 i(
TyL
 == 0x0800)

2162 i(
bWmmReq
)

2164 *
pUrPriܙy
 = (*(
pSrcBuf
 + 1) & 0xe0) >> 5;

2165 *
pQueIdx
 = 
MUrPriܙyToAcssCegy
[*
pUrPriܙy
];

2169 
TyL
)

2174 i(
bWmmReq
 && (*
pSrcBuf
 & 0xf0) != 0x40)

2176 *
pUrPriܙy
 = 0;

2177 *
pQueIdx
 = 
QID_AC_BE
;

2180 
	`RTMP_SET_PACKET_IPV4
(
pPack
, 1);

2182 
	`ASSERT
((
pktL
 > 34));

2183 i(*(
pSrcBuf
 + 9) == 0x11)

2185 
	`ASSERT
((
pktL
 > 34));

2187 
pSrcBuf
 += 20;

2188 
cPt
 = 
	`OS_NTOHS
(
	`g_uligd
((
PUINT16
)(
pSrcBuf
)));

2189 
dPt
 = 
	`OS_NTOHS
(
	`g_uligd
((
PUINT16
)(
pSrcBuf
+2)));

2191 i((
cPt
==0x44 && 
dPt
==0x43) || (srcPort==0x43 && dstPort==0x44))

2193 
	`RTMP_SET_PACKET_DHCP
(
pPack
, 1);

2201 
	`RTMP_SET_PACKET_DHCP
(
pPack
, 1);

2207 
	`RTMP_SET_PACKET_EAPOL
(
pPack
, 1);

2214 #ifde
VENDOR_FEATURE1_SUPPORT


2215 
	`RTMP_SET_PACKET_PROTOCOL
(
pPack
, 
TyL
);

2226 i(
pAd
->
CommCfg
.
APEdPm
.
bACM
[*
pQueIdx
])

2228 *
pUrPriܙy
 = 0;

2229 *
pQueIdx
 = 
QID_AC_BE
;

2232  
TRUE
;

2237 
VOID
 
	`Upde_Rssi_Same
(

2238 
IN
 
PRTMP_ADAPTER
 
pAd
,

2239 
IN
 
RSSI_SAMPLE
 *
pRssi
,

2240 
IN
 
PRXWI_STRUC
 
pRxWI
)

2242 
CHAR
 
rssi0
 = 
pRxWI
->
RSSI0
;

2243 
CHAR
 
rssi1
 = 
pRxWI
->
RSSI1
;

2244 
CHAR
 
rssi2
 = 
pRxWI
->
RSSI2
;

2245 
UCHAR
 
r0
 = 
pRxWI
->
SNR0
;

2246 
UCHAR
 
r1
 = 
pRxWI
->
SNR1
;

2247 
CHAR
 
Phymode
 = 
pRxWI
->
PHYMODE
;

2248 
BOOLEAN
 
bInl
 = 
FALSE
;

2250 i(!(
pRssi
->
AvgRssi0
 |Rssi->
AvgRssi0X8
 |Rssi->
LaRssi0
))

2252 
bInl
 = 
TRUE
;

2255 i(
rssi0
 != 0)

2258 
pRssi
->
LaRssi0
 = 
	`CvtToRssi
(
pAd
, (
CHAR
)
rssi0
, 
RSSI_0
);

2260 i(
bInl
)

2262 
pRssi
->
AvgRssi0X8
 =Rssi->
LaRssi0
 << 3;

2263 
pRssi
->
AvgRssi0
 =Rssi->
LaRssi0
;

2267 
pRssi
->
AvgRssi0X8
 = (pRssi->AvgRssi0X8 -Rssi->
AvgRssi0
+Rssi->
LaRssi0
;

2270 
pRssi
->
AvgRssi0
 =Rssi->
AvgRssi0X8
 >> 3;

2273 i(
r0
 !0 && 
Phymode
 !
MODE_CCK
)

2275 
pRssi
->
LaS0
 = 
	`CvtToS
(
pAd
, (
UCHAR
)
r0
);

2277 i(
bInl
)

2279 
pRssi
->
AvgS0X8
 =Rssi->
LaS0
 << 3;

2280 
pRssi
->
AvgS0
 =Rssi->
LaS0
;

2284 
pRssi
->
AvgS0X8
 = (pRssi->AvgS0X8 -Rssi->
AvgS0
+Rssi->
LaS0
;

2287 
pRssi
->
AvgS0
 =Rssi->
AvgS0X8
 >> 3;

2291 i(
rssi1
 != 0)

2293 
pRssi
->
LaRssi1
 = 
	`CvtToRssi
(
pAd
, (
CHAR
)
rssi1
, 
RSSI_1
);

2295 i(
bInl
)

2297 
pRssi
->
AvgRssi1X8
 =Rssi->
LaRssi1
 << 3;

2298 
pRssi
->
AvgRssi1
 =Rssi->
LaRssi1
;

2302 
pRssi
->
AvgRssi1X8
 = (pRssi->AvgRssi1X8 -Rssi->
AvgRssi1
+Rssi->
LaRssi1
;

2305 
pRssi
->
AvgRssi1
 =Rssi->
AvgRssi1X8
 >> 3;

2308 i(
r1
 !0 && 
Phymode
 !
MODE_CCK
)

2310 
pRssi
->
LaS1
 = 
	`CvtToS
(
pAd
, (
UCHAR
)
r1
);

2312 i(
bInl
)

2314 
pRssi
->
AvgS1X8
 =Rssi->
LaS1
 << 3;

2315 
pRssi
->
AvgS1
 =Rssi->
LaS1
;

2319 
pRssi
->
AvgS1X8
 = (pRssi->AvgS1X8 -Rssi->
AvgS1
+Rssi->
LaS1
;

2322 
pRssi
->
AvgS1
 =Rssi->
AvgS1X8
 >> 3;

2326 i(
rssi2
 != 0)

2328 
pRssi
->
LaRssi2
 = 
	`CvtToRssi
(
pAd
, (
CHAR
)
rssi2
, 
RSSI_2
);

2330 i(
bInl
)

2332 
pRssi
->
AvgRssi2X8
 =Rssi->
LaRssi2
 << 3;

2333 
pRssi
->
AvgRssi2
 =Rssi->
LaRssi2
;

2337 
pRssi
->
AvgRssi2X8
 = (pRssi->AvgRssi2X8 -Rssi->
AvgRssi2
+Rssi->
LaRssi2
;

2340 
pRssi
->
AvgRssi2
 =Rssi->
AvgRssi2X8
 >> 3;

2347 
VOID
 
	`Indi_Legacy_Pack
(

2348 
IN
 
PRTMP_ADAPTER
 
pAd
,

2349 
IN
 
RX_BLK
 *
pRxBlk
,

2350 
IN
 
UCHAR
 
FromWhichBSSID
)

2352 
PNDIS_PACKET
 
pRxPack
 = 
pRxBlk
->pRxPacket;

2353 
UCHAR
 
Hd802_3
[
LENGTH_802_3
];

2359 #ifde
CONFIG_STA_SUPPORT


2360 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2361 
	`RTMP_802_11_REMOVE_LLC_AND_CONVERT_TO_802_3
(
pRxBlk
, 
Hd802_3
);

2364 i(
pRxBlk
->
DaSize
 > 
MAX_RX_PKT_LEN
)

2368 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

2373 
	`STATS_INC_RX_PACKETS
(
pAd
, 
FromWhichBSSID
);

2376 
	`wn_802_11_to_802_3_ck
(
pAd
, 
pRxBlk
, 
Hd802_3
, 
FromWhichBSSID
, 
TPID
);

2381 #ifde
CONFIG_STA_SUPPORT


2382 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2383 
	`ANNOUNCE_OR_FORWARD_802_3_PACKET
(
pAd
, 
pRxPack
, 
FromWhichBSSID
);

2390 
VOID
 
	`CmmRxnRkFmeIndi
(

2391 
IN
 
PRTMP_ADAPTER
 
pAd
,

2392 
IN
 
RX_BLK
 *
pRxBlk
,

2393 
IN
 
UCHAR
 
FromWhichBSSID
)

2395 #ifde
DOT11_N_SUPPORT


2396 i(
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_AMPDU
&& (
pAd
->
CommCfg
.
bDibRedg
 == 0))

2398 
	`Indi_AMPDU_Pack
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

2403 #ifde
DOT11_N_SUPPORT


2404 i(
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_AMSDU
))

2407 
	`Indi_AMSDU_Pack
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

2412 
	`Indi_Legacy_Pack
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

2418 
VOID
 
	`CmmRxRkFmeIndi
(

2419 
IN
 
PRTMP_ADAPTER
 
pAd
,

2420 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

2421 
IN
 
RX_BLK
 *
pRxBlk
,

2422 
IN
 
UCHAR
 
FromWhichBSSID
)

2424 
UCHAR
 
Hd802_3
[
LENGTH_802_3
];

2425 
UINT16
 
Msdu2Size
;

2426 
UINT16
 
Payld1Size
, 
Payld2Size
;

2427 
PUCHAR
 
pDa2
;

2428 
PNDIS_PACKET
 
pPack2
 = 
NULL
;

2432 
Msdu2Size
 = *(
pRxBlk
->
pDa
) + (*(pRxBlk->pData+1) << 8);

2434 i((
Msdu2Size
 <1536&& (Msdu2Siz< 
pRxBlk
->
DaSize
))

2437 
pRxBlk
->
pDa
 += 2;

2438 
pRxBlk
->
DaSize
 -= 2;

2443 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

2448 #ifde
CONFIG_STA_SUPPORT


2449 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2450 
	`RTMP_802_11_REMOVE_LLC_AND_CONVERT_TO_802_3
(
pRxBlk
, 
Hd802_3
);

2454 
	`ASSERT
(
pRxBlk
->
pRxPack
);

2457 
pAd
->
RkCous
.
OSecRxAgggiCou
 ++;

2458 
Payld1Size
 = 
pRxBlk
->
DaSize
 - 
Msdu2Size
;

2459 
Payld2Size
 = 
Msdu2Size
 - 
LENGTH_802_3
;

2461 
pDa2
 = 
pRxBlk
->
pDa
 + 
Payld1Size
 + 
LENGTH_802_3
;

2462 #ifde
CONFIG_STA_SUPPORT


2463 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2464 
pPack2
 = 
	`dui_pkt
(
pAd
, (
pDa2
-
LENGTH_802_3
), LENGTH_802_3,Da2, 
Payld2Size
, 
FromWhichBSSID
);

2467 i(!
pPack2
)

2470 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

2475 
pRxBlk
->
DaSize
 = 
Payld1Size
;

2476 
	`wn_802_11_to_802_3_ck
(
pAd
, 
pRxBlk
, 
Hd802_3
, 
FromWhichBSSID
, 
TPID
);

2478 #ifde
CONFIG_STA_SUPPORT


2479 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2480 
	`ANNOUNCE_OR_FORWARD_802_3_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
FromWhichBSSID
);

2483 i(
pPack2
)

2485 #ifde
CONFIG_STA_SUPPORT


2486 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2487 
	`ANNOUNCE_OR_FORWARD_802_3_PACKET
(
pAd
, 
pPack2
, 
FromWhichBSSID
);

2493 
	#RESET_FRAGFRAME
(
_agFme
) \

2495 
_agFme
.
RxSize
 = 0; \

2496 
_agFme
.
Sequ
 = 0; \

2497 
_agFme
.
LaFg
 = 0; \

2498 
_agFme
.
Fgs
 = 0; \

2499 }

	)

2502 
PNDIS_PACKET
 
	`RTMPDeFgmtDaFme
(

2503 
IN
 
PRTMP_ADAPTER
 
pAd
,

2504 
IN
 
RX_BLK
 *
pRxBlk
)

2506 
PHEADER_802_11
 
pHd
 = 
pRxBlk
->pHeader;

2507 
PNDIS_PACKET
 
pRxPack
 = 
pRxBlk
->pRxPacket;

2508 
UCHAR
 *
pDa
 = 
pRxBlk
->pData;

2509 
USHORT
 
DaSize
 = 
pRxBlk
->DataSize;

2510 
PNDIS_PACKET
 
pRPack
 = 
NULL
;

2511 
UCHAR
 *
pFgBufr
 = 
NULL
;

2512 
BOOLEAN
 
bRssDe
 = 
FALSE
;

2513 
UCHAR
 
HdRoom
 = 0;

2516 
	`ASSERT
(
pHd
);

2518 
HdRoom
 = 
pDa
 - (
UCHAR
 *)
pHd
;

2521 i(
pHd
->
Fg
 == 0)

2524 i(
pHd
->
FC
.
MeFg
)

2526 
	`ASSERT
(
pAd
->
FgFme
.
pFgPack
);

2527 
pFgBufr
 = 
	`GET_OS_PKT_DATAPTR
(
pAd
->
FgFme
.
pFgPack
);

2528 
pAd
->
FgFme
.
RxSize
 = 
DaSize
 + 
HdRoom
;

2529 
	`NdisMoveMemy
(
pFgBufr
, 
pHd
, 
pAd
->
FgFme
.
RxSize
);

2530 
pAd
->
FgFme
.
Sequ
 = 
pHd
->Sequence;

2531 
pAd
->
FgFme
.
LaFg
 = 
pHd
->
Fg
;

2532 
	`ASSERT
(
pAd
->
FgFme
.
LaFg
 == 0);

2533 
de
;

2538 i((
pHd
->
Sequ
 !
pAd
->
FgFme
.Sequence) ||

2539 (
pHd
->
Fg
 !(
pAd
->
FgFme
.
LaFg
 + 1)))

2543 
	`RESET_FRAGFRAME
(
pAd
->
FgFme
);

2544 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Fragment isothe same sequence or out of fragmentumber order.\n"));

2545 
de
;

2547 i((
pAd
->
FgFme
.
RxSize
 + 
DaSize
> 
MAX_FRAME_SIZE
)

2551 
	`RESET_FRAGFRAME
(
pAd
->
FgFme
);

2552 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Fragment frame isooarge, itxeedshe maximum frame size.\n"));

2553 
de
;

2560 i(
	`NdisEquMemy
(
pDa
, 
SNAP_802_1H
, (SNAP_802_1H)))

2562 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Fdnh LLCMidd oEnd fgmt(SN=%d, Fg=%d)\n", 
pHd
->
Sequ
,Hd->
Fg
));

2563 
de
;

2566 
pFgBufr
 = 
	`GET_OS_PKT_DATAPTR
(
pAd
->
FgFme
.
pFgPack
);

2569 
	`NdisMoveMemy
((
pFgBufr
 + 
pAd
->
FgFme
.
RxSize
), 
pDa
, 
DaSize
);

2570 
pAd
->
FgFme
.
RxSize
 +
DaSize
;

2571 
pAd
->
FgFme
.
LaFg
 = 
pHd
->
Fg
;

2574 i(
pHd
->
FC
.
MeFg
 =
FALSE
)

2576 
bRssDe
 = 
TRUE
;

2580 
de
:

2582 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

2586 i(
bRssDe
)

2588 
PNDIS_PACKET
 
pNewFgPack
;

2591 
pNewFgPack
 = 
	`RTMP_AoFgPackBufr
(
pAd
, 
RX_BUFFER_NORMSIZE
);

2592 i(
pNewFgPack
)

2595 
pRPack
 = 
pAd
->
FgFme
.
pFgPack
;

2596 
pAd
->
FgFme
.
pFgPack
 = 
pNewFgPack
;

2597 
pRxBlk
->
pHd
 = (
PHEADER_802_11

	`GET_OS_PKT_DATAPTR
(
pRPack
);

2598 
pRxBlk
->
pDa
 = (
UCHAR
 *RxBlk->
pHd
 + 
HdRoom
;

2599 
pRxBlk
->
DaSize
 = 
pAd
->
FgFme
.
RxSize
 - 
HdRoom
;

2600 
pRxBlk
->
pRxPack
 = 
pRPack
;

2604 
	`RESET_FRAGFRAME
(
pAd
->
FgFme
);

2608  
pRPack
;

2611 
VOID
 
	`Indi_EAPOL_Pack
(

2612 
IN
 
PRTMP_ADAPTER
 
pAd
,

2613 
IN
 
RX_BLK
 *
pRxBlk
,

2614 
IN
 
UCHAR
 
FromWhichBSSID
)

2616 
MAC_TABLE_ENTRY
 *
pEry
 = 
NULL
;

2619 #ifde
CONFIG_STA_SUPPORT


2620 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2622 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
];

2623 
	`STARxEAPOLFmeIndi
(
pAd
, 
pEry
, 
pRxBlk
, 
FromWhichBSSID
);

2628 i(
pEry
 =
NULL
)

2630 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("Indicate_EAPOL_Packet: dropndeleasehe invalidacket.\n"));

2632 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

2637 
	#BCN_TBTT_OFFSET
 64

2638 
VOID
 
	`ReSyncBcTime
(

	)

2639 
IN
 
PRTMP_ADAPTER
 
pAd
)

2642 
UINT32
 
Offt
;

2645 
Offt
 = (
pAd
->
TbTickCou
% (
BCN_TBTT_OFFSET
);

2647 
pAd
->
TbTickCou
++;

2653 i(
Offt
 =(
BCN_TBTT_OFFSET
-2))

2655 
BCN_TIME_CFG_STRUC
 
c
;

2656 
	`RTMP_IO_READ32
(
pAd
, 
BCN_TIME_CFG
, &
c
.
wd
);

2657 
c
.
fld
.
BcIv
 = (
pAd
->
CommCfg
.
BcPiod
 << 4) - 1 ;

2658 
	`RTMP_IO_WRITE32
(
pAd
, 
BCN_TIME_CFG
, 
c
.
wd
);

2662 i(
Offt
 =(
BCN_TBTT_OFFSET
-1))

2664 
BCN_TIME_CFG_STRUC
 
c
;

2666 
	`RTMP_IO_READ32
(
pAd
, 
BCN_TIME_CFG
, &
c
.
wd
);

2667 
c
.
fld
.
BcIv
 = (
pAd
->
CommCfg
.
BcPiod
) << 4;

2668 
	`RTMP_IO_WRITE32
(
pAd
, 
BCN_TIME_CFG
, 
c
.
wd
);

2673 #ifde
SOFT_ENCRYPT


2674 
BOOLEAN
 
	`RTMPExndPackFSwEny
(

2675 
IN
 
PRTMP_ADAPTER
 
pAd
,

2676 
IN
 
PTX_BLK
 
pTxBlk
)

2678 
PACKET_INFO
 
PackInfo
;

2679 
UINT32
 
ex_hd
 = 0, 
ex_
 = 0;

2680 
UCHAR
 
NumbOfFg
 = 
	`RTMP_GET_PACKET_FRAGMENTS
(
pTxBlk
->
pPack
);

2682 i(
pTxBlk
->
ChAlg
 =
CIPHER_AES
)

2683 
ex_
 = 
LEN_CCMP_MIC
;

2685 
ex_
 = (
NumbOfFg
 *x_tail);

2687 
pTxBlk
->
pPack
 = 
	`ExndPack
(
pAd
,TxBlk->pPack, 
ex_hd
, 
ex_
);

2688 i(
pTxBlk
->
pPack
 =
NULL
)

2690 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: ouosour.\n", 
__FUNCTION__
));

2691  
FALSE
;

2693 
	`RTMP_QuyPackInfo
(
pTxBlk
->
pPack
, &
PackInfo
, &pTxBlk->
pSrcBufHd
, &pTxBlk->
SrcBufL
);

2695  
TRUE
;

2698 
VOID
 
	`RTMPUpdeSwCacheChInfo
(

2699 
IN
 
PRTMP_ADAPTER
 
pAd
,

2700 
IN
 
PTX_BLK
 
pTxBlk
,

2701 
IN
 
PUCHAR
 
pHdr
)

2703 
PHEADER_802_11
 
pHd_802_11
;

2704 
PMAC_TABLE_ENTRY
 
pMacEry
;

2706 
pHd_802_11
 = (
HEADER_802_11
 *
pHdr
;

2707 
pMacEry
 = 
pTxBlk
->pMacEntry;

2709 i(
pMacEry
 && 
pHd_802_11
->
FC
.
W
 &&

2710 
	`CLIENT_STATUS_TEST_FLAG
(
pMacEry
, 
fCLIENT_STATUS_SOFTWARE_ENCRYPT
))

2712 
PCIPHER_KEY
 
pKey
 = &
pMacEry
->
PawiKey
;

2714 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bSwEny
);

2716 
pTxBlk
->
ChAlg
 = 
pKey
->CipherAlg;

2717 
pTxBlk
->
pKey
 =Key;

2718 i((
pKey
->
ChAlg
 =
CIPHER_WEP64
|| (pKey->ChAlg =
CIPHER_WEP128
))

2719 
	`c_iv_by
(
pKey
->
TxTsc
, 
LEN_WEP_TSC
, 1);

2720 i((
pKey
->
ChAlg
 =
CIPHER_TKIP
|| (pKey->ChAlg =
CIPHER_AES
))

2721 
	`c_iv_by
(
pKey
->
TxTsc
, 
LEN_WPA_TSC
, 1);

	@common/cmm_data_pci.c

42 
	~"_cfig.h
"

45 
USHORT
 
	$RtmpPCI_WreSgTxResour
(

46 
IN
 
PRTMP_ADAPTER
 
pAd
,

47 
IN
 
TX_BLK
 *
pTxBlk
,

48 
IN
 
BOOLEAN
 
bIsLa
,

49 
OUT
 
USHORT
 *
FeNumb
)

52 
UCHAR
 *
pDMAHdBufVA
;

53 
USHORT
 
TxIdx
, 
RTxIdx
;

54 
PTXD_STRUC
 
pTxD
;

55 #ifde
RT_BIG_ENDIAN


56 
PTXD_STRUC
 
pDeTxD
;

57 
TXD_STRUC
 
TxD
;

59 
UINT32
 
BufBaPaLow
;

60 
PRTMP_TX_RING
 
pTxRg
;

61 
USHORT
 
hwHdL
;

66 
pTxRg
 = &
pAd
->
TxRg
[
pTxBlk
->
QueIdx
];

67 
TxIdx
 = 
pAd
->
TxRg
[
pTxBlk
->
QueIdx
].
TxCpuIdx
;

68 
pDMAHdBufVA
 = (
PUCHAR

pTxRg
->
Cl
[
TxIdx
].
DmaBuf
.
AocVa
;

69 
BufBaPaLow
 = 
	`RTMP_GPhysilAddssLow
(
pTxRg
->
Cl
[
TxIdx
].
DmaBuf
.
AocPa
);

73 
hwHdL
 = 
pTxBlk
->
MpduHdL
 +TxBlk->
HdrPadL
;

75 
	`NdisMoveMemy
(
pDMAHdBufVA
, 
pTxBlk
->
HdBuf
, 
TXINFO_SIZE
 + 
TXWI_SIZE
 + 
hwHdL
);

77 
pTxRg
->
Cl
[
TxIdx
].
pNdisPack
 = 
pTxBlk
->
pPack
;

78 
pTxRg
->
Cl
[
TxIdx
].
pNextNdisPack
 = 
NULL
;

83 #ide
RT_BIG_ENDIAN


84 
pTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
TxIdx
].
AocVa
;

86 
pDeTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
TxIdx
].
AocVa
;

87 
TxD
 = *
pDeTxD
;

88 
pTxD
 = &
TxD
;

90 
	`NdisZoMemy
(
pTxD
, 
TXD_SIZE
);

92 
pTxD
->
SDP0
 = 
BufBaPaLow
;

93 
pTxD
->
SDL0
 = 
TXINFO_SIZE
 + 
TXWI_SIZE
 + 
hwHdL
;

94 
pTxD
->
SDP1
 = 
	`PCI_MAP_SINGLE
(
pAd
, 
pTxBlk
, 0, 1, 
PCI_DMA_TODEVICE
);;

95 
pTxD
->
SDL1
 = 
pTxBlk
->
SrcBufL
;

96 
pTxD
->
LaSec0
 = 0;

97 
pTxD
->
LaSec1
 = (
bIsLa
) ? 1 : 0;

99 
	`RTMPWreTxDest
(
pAd
, 
pTxD
, 
FALSE
, 
FIFO_EDCA
);

100 #ifde
RT_BIG_ENDIAN


101 
	`RTMPWIEndnChge
((
PUCHAR
)(
pDMAHdBufVA
 + 
TXINFO_SIZE
), 
TYPE_TXWI
);

102 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)(
pDMAHdBufVA
 + 
TXINFO_SIZE
 + 
TXWI_SIZE
), 
DIR_WRITE
, 
FALSE
);

103 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

104 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

107 
RTxIdx
 = 
TxIdx
;

111 
	`INC_RING_INDEX
(
TxIdx
, 
TX_RING_SIZE
);

112 
pTxRg
->
TxCpuIdx
 = 
TxIdx
;

114 *
FeNumb
 -= 1;

116  
RTxIdx
;

117 
	}
}

120 
USHORT
 
	$RtmpPCI_WreMuiTxResour
(

121 
IN
 
PRTMP_ADAPTER
 
pAd
,

122 
IN
 
TX_BLK
 *
pTxBlk
,

123 
IN
 
UCHAR
 
ameNum
,

124 
OUT
 
USHORT
 *
FeNumb
)

126 
BOOLEAN
 
bIsLa
;

127 
UCHAR
 *
pDMAHdBufVA
;

128 
USHORT
 
TxIdx
, 
RTxIdx
;

129 
PTXD_STRUC
 
pTxD
;

130 #ifde
RT_BIG_ENDIAN


131 
PTXD_STRUC
 
pDeTxD
;

132 
TXD_STRUC
 
TxD
;

134 
UINT32
 
BufBaPaLow
;

135 
PRTMP_TX_RING
 
pTxRg
;

136 
USHORT
 
hwHdrL
;

137 
UINT32
 
fDMAL
;

139 
bIsLa
 = ((
ameNum
 =(
pTxBlk
->
TٮFmeNum
 - 1)) ? 1 : 0);

144 
pTxRg
 = &
pAd
->
TxRg
[
pTxBlk
->
QueIdx
];

145 
TxIdx
 = 
pAd
->
TxRg
[
pTxBlk
->
QueIdx
].
TxCpuIdx
;

146 
pDMAHdBufVA
 = (
PUCHAR

pTxRg
->
Cl
[
TxIdx
].
DmaBuf
.
AocVa
;

147 
BufBaPaLow
 = 
	`RTMP_GPhysilAddssLow
(
pTxRg
->
Cl
[
TxIdx
].
DmaBuf
.
AocPa
);

149 i(
ameNum
 == 0)

152 i(
pTxBlk
->
TxFmeTy
 =
TX_AMSDU_FRAME
)

154 
hwHdrL
 = 
pTxBlk
->
MpduHdL
 - 
LENGTH_AMSDU_SUBFRAMEHEAD
 +TxBlk->
HdrPadL
 + LENGTH_AMSDU_SUBFRAMEHEAD;

155 i(
pTxBlk
->
TxFmeTy
 =
TX_RALINK_FRAME
)

157 
hwHdrL
 = 
pTxBlk
->
MpduHdL
 - 
LENGTH_ARALINK_HEADER_FIELD
 +TxBlk->
HdrPadL
 + LENGTH_ARALINK_HEADER_FIELD;

160 
hwHdrL
 = 
pTxBlk
->
MpduHdL
 +TxBlk->
HdrPadL
;

162 
fDMAL
 = 
TXINFO_SIZE
 + 
TXWI_SIZE
 + 
hwHdrL
;

166 
fDMAL
 = 
pTxBlk
->
MpduHdL
;

169 
	`NdisMoveMemy
(
pDMAHdBufVA
, 
pTxBlk
->
HdBuf
, 
fDMAL
);

171 
pTxRg
->
Cl
[
TxIdx
].
pNdisPack
 = 
pTxBlk
->
pPack
;

172 
pTxRg
->
Cl
[
TxIdx
].
pNextNdisPack
 = 
NULL
;

177 #ide
RT_BIG_ENDIAN


178 
pTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
TxIdx
].
AocVa
;

180 
pDeTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
TxIdx
].
AocVa
;

181 
TxD
 = *
pDeTxD
;

182 
pTxD
 = &
TxD
;

184 
	`NdisZoMemy
(
pTxD
, 
TXD_SIZE
);

186 
pTxD
->
SDP0
 = 
BufBaPaLow
;

187 
pTxD
->
SDL0
 = 
fDMAL
;

188 
pTxD
->
SDP1
 = 
	`PCI_MAP_SINGLE
(
pAd
, 
pTxBlk
, 0, 1, 
PCI_DMA_TODEVICE
);;

189 
pTxD
->
SDL1
 = 
pTxBlk
->
SrcBufL
;

190 
pTxD
->
LaSec0
 = 0;

191 
pTxD
->
LaSec1
 = (
bIsLa
) ? 1 : 0;

193 
	`RTMPWreTxDest
(
pAd
, 
pTxD
, 
FALSE
, 
FIFO_EDCA
);

195 #ifde
RT_BIG_ENDIAN


196 i(
ameNum
 == 0)

197 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)(
pDMAHdBufVA
+ 
TXINFO_SIZE
 + 
TXWI_SIZE
), 
DIR_WRITE
, 
FALSE
);

199 i(
ameNum
 != 0)

200 
	`RTMPWIEndnChge
((
PUCHAR
)(
pDMAHdBufVA
 + 
TXINFO_SIZE
), 
TYPE_TXWI
);

202 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

203 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

206 
RTxIdx
 = 
TxIdx
;

210 
	`INC_RING_INDEX
(
TxIdx
, 
TX_RING_SIZE
);

211 
pTxRg
->
TxCpuIdx
 = 
TxIdx
;

213 *
FeNumb
 -= 1;

215  
RTxIdx
;

217 
	}
}

220 
VOID
 
	$RtmpPCI_FWreTxResour
(

221 
IN
 
PRTMP_ADAPTER
 
pAd
,

222 
IN
 
TX_BLK
 *
pTxBlk
,

223 
IN
 
USHORT
 
tٮMPDUSize
,

224 
IN
 
USHORT
 
FTxIdx
)

227 
PTXWI_STRUC
 
pTxWI
;

228 
PRTMP_TX_RING
 
pTxRg
;

233 
pTxRg
 = &
pAd
->
TxRg
[
pTxBlk
->
QueIdx
];

234 
pTxWI
 = (
PTXWI_STRUC

pTxRg
->
Cl
[
FTxIdx
].
DmaBuf
.
AocVa
;

235 
pTxWI
->
MPDUtٮByCou
 = 
tٮMPDUSize
;

236 #ifde
RT_BIG_ENDIAN


237 
	`RTMPWIEndnChge
((
PUCHAR
)
pTxWI
, 
TYPE_TXWI
);

240 
	}
}

242 
USHORT
 
	$RtmpPCI_WreFgTxResour
(

243 
IN
 
PRTMP_ADAPTER
 
pAd
,

244 
IN
 
TX_BLK
 *
pTxBlk
,

245 
IN
 
UCHAR
 
agNum
,

246 
OUT
 
USHORT
 *
FeNumb
)

248 
UCHAR
 *
pDMAHdBufVA
;

249 
USHORT
 
TxIdx
, 
RTxIdx
;

250 
PTXD_STRUC
 
pTxD
;

251 #ifde
RT_BIG_ENDIAN


252 
PTXD_STRUC
 
pDeTxD
;

253 
TXD_STRUC
 
TxD
;

255 
UINT32
 
BufBaPaLow
;

256 
PRTMP_TX_RING
 
pTxRg
;

257 
USHORT
 
hwHdL
;

258 
UINT32
 
fDMAL
;

263 
pTxRg
 = &
pAd
->
TxRg
[
pTxBlk
->
QueIdx
];

264 
TxIdx
 = 
pAd
->
TxRg
[
pTxBlk
->
QueIdx
].
TxCpuIdx
;

265 
pDMAHdBufVA
 = (
PUCHAR

pTxRg
->
Cl
[
TxIdx
].
DmaBuf
.
AocVa
;

266 
BufBaPaLow
 = 
	`RTMP_GPhysilAddssLow
(
pTxRg
->
Cl
[
TxIdx
].
DmaBuf
.
AocPa
);

272 
hwHdL
 = 
pTxBlk
->
MpduHdL
 +TxBlk->
HdrPadL
;

274 
fDMAL
 = 
TXINFO_SIZE
 + 
TXWI_SIZE
 + 
hwHdL
;

275 
	`NdisMoveMemy
(
pDMAHdBufVA
, 
pTxBlk
->
HdBuf
, 
fDMAL
);

281 #ide
RT_BIG_ENDIAN


282 
pTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
TxIdx
].
AocVa
;

284 
pDeTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
TxIdx
].
AocVa
;

285 
TxD
 = *
pDeTxD
;

286 
pTxD
 = &
TxD
;

288 
	`NdisZoMemy
(
pTxD
, 
TXD_SIZE
);

290 i(
agNum
 =
pTxBlk
->
TٮFgNum
)

292 
pTxRg
->
Cl
[
TxIdx
].
pNdisPack
 = 
pTxBlk
->
pPack
;

293 
pTxRg
->
Cl
[
TxIdx
].
pNextNdisPack
 = 
NULL
;

296 
pTxD
->
SDP0
 = 
BufBaPaLow
;

297 
pTxD
->
SDL0
 = 
fDMAL
;

298 
pTxD
->
SDP1
 = 
	`PCI_MAP_SINGLE
(
pAd
, 
pTxBlk
, 0, 1, 
PCI_DMA_TODEVICE
);

299 
pTxD
->
SDL1
 = 
pTxBlk
->
SrcBufL
;

300 
pTxD
->
LaSec0
 = 0;

301 
pTxD
->
LaSec1
 = 1;

303 
	`RTMPWreTxDest
(
pAd
, 
pTxD
, 
FALSE
, 
FIFO_EDCA
);

305 #ifde
RT_BIG_ENDIAN


306 
	`RTMPWIEndnChge
((
PUCHAR
)(
pDMAHdBufVA
 + 
TXINFO_SIZE
), 
TYPE_TXWI
);

307 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)(
pDMAHdBufVA
 + 
TXINFO_SIZE
 + 
TXWI_SIZE
), 
DIR_WRITE
, 
FALSE
);

308 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

309 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

312 
RTxIdx
 = 
TxIdx
;

313 
pTxBlk
->
Priv
 +pTxBlk->
SrcBufL
;

318 
	`INC_RING_INDEX
(
TxIdx
, 
TX_RING_SIZE
);

319 
pTxRg
->
TxCpuIdx
 = 
TxIdx
;

321 *
FeNumb
 -= 1;

323  
RTxIdx
;

325 
	}
}

332 
	$RtmpPCIMgmtKickOut
(

333 
IN
 
RTMP_ADAPTER
 *
pAd
,

334 
IN
 
UCHAR
 
QueIdx
,

335 
IN
 
PNDIS_PACKET
 
pPack
,

336 
IN
 
PUCHAR
 
pSrcBufVA
,

337 
IN
 
UINT
 
SrcBufL
)

339 
PTXD_STRUC
 
pTxD
;

340 #ifde
RT_BIG_ENDIAN


341 
PTXD_STRUC
 
pDeTxD
;

342 
TXD_STRUC
 
TxD
;

344 
ULONG
 
SwIdx
 = 
pAd
->
MgmtRg
.
TxCpuIdx
;

346 #ifde
RT_BIG_ENDIAN


347 
pDeTxD
 = (
PTXD_STRUC
)
pAd
->
MgmtRg
.
Cl
[
SwIdx
].
AocVa
;

348 
TxD
 = *
pDeTxD
;

349 
pTxD
 = &
TxD
;

350 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

352 
pTxD
 = (
PTXD_STRUC

pAd
->
MgmtRg
.
Cl
[
SwIdx
].
AocVa
;

355 
pAd
->
MgmtRg
.
Cl
[
SwIdx
].
pNdisPack
 = 
pPack
;

356 
pAd
->
MgmtRg
.
Cl
[
SwIdx
].
pNextNdisPack
 = 
NULL
;

358 
	`RTMPWreTxDest
(
pAd
, 
pTxD
, 
TRUE
, 
FIFO_MGMT
);

359 
pTxD
->
LaSec0
 = 1;

360 
pTxD
->
LaSec1
 = 1;

361 
pTxD
->
DMADONE
 = 0;

362 
pTxD
->
SDL1
 = 0;

363 
pTxD
->
SDP0
 = 
	`PCI_MAP_SINGLE
(
pAd
, 
pSrcBufVA
, 
SrcBufL
, 0, 
PCI_DMA_TODEVICE
);

364 
pTxD
->
SDL0
 = 
SrcBufL
;

366 #ifde
RT_BIG_ENDIAN


367 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

368 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

385 
pAd
->
RkCous
.
KickTxCou
++;

386 
pAd
->
RkCous
.
OSecTxDeCou
++;

389 
	`INC_RING_INDEX
(
pAd
->
MgmtRg
.
TxCpuIdx
, 
MGMT_RING_SIZE
);

391 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_MGMTCTX_IDX
,Ad->
MgmtRg
.
TxCpuIdx
);

394 
	}
}

397 #ifde
CONFIG_STA_SUPPORT


415 
NDIS_STATUS
 
	$RTMPCheckRxE
(

416 
IN
 
PRTMP_ADAPTER
 
pAd
,

417 
IN
 
PHEADER_802_11
 
pHd
,

418 
IN
 
PRXWI_STRUC
 
pRxWI
,

419 
IN
 
PRT28XX_RXD_STRUC
 
pRxD
)

421 
PCIPHER_KEY
 
pWKey
;

422 
INT
 
dBm
;

425 i(
pRxD
->
Crc
))

428 
dBm
 = (
INT
(
pRxWI
->
RSSI0
- 
pAd
->
BbpRssiToDbmD
;

429 i(
dBm
 <= -87)

430 
pAd
->
SCfg
.
RPIDsy
[0] += 1;

431 i(
dBm
 <= -82)

432 
pAd
->
SCfg
.
RPIDsy
[1] += 1;

433 i(
dBm
 <= -77)

434 
pAd
->
SCfg
.
RPIDsy
[2] += 1;

435 i(
dBm
 <= -72)

436 
pAd
->
SCfg
.
RPIDsy
[3] += 1;

437 i(
dBm
 <= -67)

438 
pAd
->
SCfg
.
RPIDsy
[4] += 1;

439 i(
dBm
 <= -62)

440 
pAd
->
SCfg
.
RPIDsy
[5] += 1;

441 i(
dBm
 <= -57)

442 
pAd
->
SCfg
.
RPIDsy
[6] += 1;

443 i(
dBm
 > -57)

444 
pAd
->
SCfg
.
RPIDsy
[7] += 1;

446 (
NDIS_STATUS_FAILURE
);

450 
pAd
->
SCfg
.
CLBusyBys
 +(
pRxD
->
SDL0
 + 14);

453 i(
pHd
 !
NULL
)

455 #ide
CLIENT_WDS


456 i(
pHd
->
FC
.
ToDs


459 (
NDIS_STATUS_FAILURE
);

470 i(
pRxD
->
ChE
)

472 i(
pRxD
->
ChE
 == 2)

473 {
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("pRxD ERROR: ICV ok but MICErr "));}

474 i(
pRxD
->
ChE
 == 1)

475 {
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("pRxD ERROR: ICV Err "));}

476 i(
pRxD
->
ChE
 == 3)

477 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("pRxD ERROR: Keyot valid "));

479 i(((
pRxD
->
ChE
 & 1=1&& 
	`INFRA_ON
(
pAd
))

480 
	`RTMPSdWessEvt
(
pAd
, 
IW_ICV_ERROR_EVENT_FLAG
,Ad->
MacTab
.
Cڋ
[
BSSID_WCID
].
Addr
, 
BSS0
, 0);

482 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,(" %d (len=%d, Mcast=%d, MyBss=%d, Wcid=%d, KeyId=%d)\n",

483 
pRxD
->
ChE
,

484 
pRxD
->
SDL0
,

485 
pRxD
->
M
 |RxD->
B
,

486 
pRxD
->
MyBss
,

487 
pRxWI
->
WessCliID
,

489 
pRxWI
->
KeyIndex
));

494 i(
pRxD
->
ChE
 == 2)

496 
pWKey
 = &
pAd
->
ShedKey
[
BSS0
][
pRxWI
->
KeyIndex
];

497 #ifde
WPA_SUPPLICANT_SUPPORT


498 i(
pAd
->
SCfg
.
WSuliUP
)

499 
	`WSdMicFauToWSuli
(
pAd
,

500 (
pWKey
->
Ty
 =
PAIRWISEKEY
? 
TRUE
:
FALSE
);

503 
	`RTMPRtMicE
(
pAd
, 
pWKey
);

505 i(((
pRxD
->
ChE
 & 2=2&& 
	`INFRA_ON
(
pAd
))

506 
	`RTMPSdWessEvt
(
pAd
, 
IW_MIC_ERROR_EVENT_FLAG
,Ad->
MacTab
.
Cڋ
[
BSSID_WCID
].
Addr
, 
BSS0
, 0);

508 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,("Rx MIC Valuerror\n"));

511 i(
pHd
 =
NULL
)

512 (
NDIS_STATUS_SUCCESS
);

522 (
NDIS_STATUS_FAILURE
);

525 (
NDIS_STATUS_SUCCESS
);

526 
	}
}

530 
BOOLEAN
 
	$RTMPFeTXDUpTxDmaDe
(

531 
IN
 
PRTMP_ADAPTER
 
pAd
,

532 
IN
 
UCHAR
 
QueIdx
)

534 
PRTMP_TX_RING
 
pTxRg
;

535 
PTXD_STRUC
 
pTxD
;

536 #ifdef 
RT_BIG_ENDIAN


537 
PTXD_STRUC
 
pDeTxD
;

539 
PNDIS_PACKET
 
pPack
;

540 
UCHAR
 
FREE
 = 0;

541 
TXD_STRUC
 
TxD
, *
pOriTxD
;

543 
BOOLEAN
 
bReschedu
 = 
FALSE
;

546 
	`ASSERT
(
QueIdx
 < 
NUM_OF_TX_RING
);

547 
pTxRg
 = &
pAd
->
TxRg
[
QueIdx
];

549 
	`RTMP_IO_READ32
(
pAd
, 
TX_DTX_IDX0
 + 
QueIdx
 * 
RINGREG_DIFF
, &
pTxRg
->
TxDmaIdx
);

550 
pTxRg
->
TxSwFeIdx
 !pTxRg->
TxDmaIdx
)

553 #ifde
RALINK_ATE


554 #ifde
RALINK_QA


555 
PHEADER_802_11
 
pHd80211
;

557 i((
	`ATE_ON
(
pAd
)&& (pAd->
e
.
bQATxS
 =
TRUE
))

559 i(
pAd
->
e
.
QID
 =
QueIdx
)

561 
pAd
->
e
.
TxDeCou
++;

562 
pAd
->
RkCous
.
KickTxCou
++;

565 
	`ASSERT
(
pAd
->
e
.
QID
 == 0);

566 
pAd
->
e
.
TxAc0
++;

568 
FREE
++;

569 #ide
RT_BIG_ENDIAN


570 
pTxD
 = (
PTXD_STRUC
(
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
AocVa
);

571 
pOriTxD
 = 
pTxD
;

572 
	`NdisMoveMemy
(&
TxD
, 
pTxD
, (
TXD_STRUC
));

573 
pTxD
 = &
TxD
;

575 
pDeTxD
 = (
PTXD_STRUC
(
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
AocVa
);

576 
pOriTxD
 = 
pDeTxD
 ;

577 
TxD
 = *
pDeTxD
;

578 
pTxD
 = &
TxD
;

579 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

581 
pTxD
->
DMADONE
 = 0;

583 
pHd80211
 = 
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
DmaBuf
.
AocVa
 + (
TXWI_STRUC
);

584 #ifde
RT_BIG_ENDIAN


585 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pHd80211
, 
DIR_READ
, 
FALSE
);

587 
pHd80211
->
Sequ
 = ++
pAd
->
e
.
q
;

588 #ifde
RT_BIG_ENDIAN


589 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pHd80211
, 
DIR_WRITE
, 
FALSE
);

592 i((
pAd
->
e
.
bQATxS
 =
TRUE
&& (pAd->e.
Mode
 & 
ATE_TXFRAME
&& (pAd->e.
TxDeCou
 <Ad->e.
TxCou
))

594 
pAd
->
RkCous
.
TnsmdByCou
 +(
pTxD
->
SDL1
 +TxD->
SDL0
);

595 
pAd
->
RkCous
.
OSecTnsmdByCou
 +(
pTxD
->
SDL1
 +TxD->
SDL0
);

596 
pAd
->
RkCous
.
OSecDmaDeCou
[
QueIdx
] ++;

597 
	`INC_RING_INDEX
(
pTxRg
->
TxSwFeIdx
, 
TX_RING_SIZE
);

600 
	`RTMP_IO_READ32
(
pAd
, 
TX_DTX_IDX0
 + 
QueIdx
 * 
RINGREG_DIFF
 , &
pTxRg
->
TxDmaIdx
);

601 
kick_out
;

603 i((
pAd
->
e
.
TxStus
 =1&& (pAd->e.
TxDeCou
 =pAd->e.
TxCou
))

605 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("all Tx is done\n"));

608 
pAd
->
e
.
TxStus
 = 0;

610 i(!(
pAd
->
e
.
Mode
 & 
ATE_TXFRAME
))

613 
	`DBGPRINT
(
RT_DEBUG_INFO
,("not complete sending yet, but someoneressedhe Stop TX bottom\n"));

614 
	`DBGPRINT
(
RT_DEBUG_INFO
,("pAd->e.Mod0x%02x\n", 
pAd
->
e
.
Mode
));

618 
	`DBGPRINT
(
RT_DEBUG_OFF
,("pTxRg->TxSwFeIdx = %d\n", 
pTxRg
->
TxSwFeIdx
));

621 #ide
RT_BIG_ENDIAN


622 
	`NdisMoveMemy
(
pOriTxD
, 
pTxD
, (
TXD_STRUC
));

624 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

625 *
pDeTxD
 = 
TxD
;

628 
	`INC_RING_INDEX
(
pTxRg
->
TxSwFeIdx
, 
TX_RING_SIZE
);

637 #ifde
VENDOR_FEATURE1_SUPPORT


648 i(++
pAd
->
FifoUpdeRx
 >= 4)

650 
	`NICUpdeFifoSCous
(
pAd
);

651 
pAd
->
FifoUpdeRx
 = 0;

654 
	`NICUpdeFifoSCous
(
pAd
);

658 
FREE
++;

659 #ide
RT_BIG_ENDIAN


660 
pTxD
 = (
PTXD_STRUC
(
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
AocVa
);

661 
pOriTxD
 = 
pTxD
;

662 
	`NdisMoveMemy
(&
TxD
, 
pTxD
, (
TXD_STRUC
));

663 
pTxD
 = &
TxD
;

665 
pDeTxD
 = (
PTXD_STRUC
(
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
AocVa
);

666 
pOriTxD
 = 
pDeTxD
 ;

667 
TxD
 = *
pDeTxD
;

668 
pTxD
 = &
TxD
;

669 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

672 
pTxD
->
DMADONE
 = 0;

675 #ifde
RALINK_ATE


677 i(!(
	`ATE_ON
(
pAd
)))

680 
pPack
 = 
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
pNdisPack
;

681 i(
pPack
)

683 #ifde
CONFIG_5VT_ENHANCE


684 i(
	`RTMP_GET_PACKET_5VT
(
pPack
))

685 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
, 16, 
PCI_DMA_TODEVICE
);

688 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

689 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

692 
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
pNdisPack
 = 
NULL
;

694 
pPack
 = 
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
pNextNdisPack
;

695 i(
pPack
)

697 #ifde
CONFIG_5VT_ENHANCE


698 i(
	`RTMP_GET_PACKET_5VT
(
pPack
))

699 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
, 16, 
PCI_DMA_TODEVICE
);

702 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

703 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

706 
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
pNextNdisPack
 = 
NULL
;

709 
pAd
->
RkCous
.
TnsmdByCou
 +(
pTxD
->
SDL1
 +TxD->
SDL0
);

710 
pAd
->
RkCous
.
OSecTnsmdByCou
 +(
pTxD
->
SDL1
 +TxD->
SDL0
);

711 
pAd
->
RkCous
.
OSecDmaDeCou
[
QueIdx
] ++;

712 
	`INC_RING_INDEX
(
pTxRg
->
TxSwFeIdx
, 
TX_RING_SIZE
);

714 
	`RTMP_IO_READ32
(
pAd
, 
TX_DTX_IDX0
 + 
QueIdx
 * 
RINGREG_DIFF
 , &
pTxRg
->
TxDmaIdx
);

715 #ifde
RT_BIG_ENDIAN


716 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

717 *
pDeTxD
 = 
TxD
;

719 
	`NdisMoveMemy
(
pOriTxD
, 
pTxD
, (
TXD_STRUC
));

722 #ifde
RALINK_ATE


723 #ifde
RALINK_QA


724 
kick_out
:

732 i((
pAd
->
e
.
Mode
 & 
ATE_TXFRAME
&& (pAd->e.
QID
 =
QueIdx
))

735 i(
pAd
->
e
.
bQATxS
 =
FALSE
)

737 
pAd
->
e
.
TxDeCou
++;

739 i(((
pAd
->
e
.
TxCou
 -Ad->e.
TxDeCou
 + 1>
TX_RING_SIZE
))

742 
	`INC_RING_INDEX
(
pAd
->
TxRg
[
QueIdx
].
TxCpuIdx
, 
TX_RING_SIZE
);

743 #ide
RT_BIG_ENDIAN


744 
pTxD
 = (
PTXD_STRUC
(
pTxRg
->
Cl
[
pAd
->
TxRg
[
QueIdx
].
TxCpuIdx
].
AocVa
);

745 
pOriTxD
 = 
pTxD
;

746 
	`NdisMoveMemy
(&
TxD
, 
pTxD
, (
TXD_STRUC
));

747 
pTxD
 = &
TxD
;

749 
pDeTxD
 = (
PTXD_STRUC
(
pTxRg
->
Cl
[
pAd
->
TxRg
[
QueIdx
].
TxCpuIdx
].
AocVa
);

750 
pOriTxD
 = 
pDeTxD
 ;

751 
TxD
 = *
pDeTxD
;

752 
pTxD
 = &
TxD
;

753 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

755 
pTxD
->
DMADONE
 = 0;

756 #ide
RT_BIG_ENDIAN


757 
	`NdisMoveMemy
(
pOriTxD
, 
pTxD
, (
TXD_STRUC
));

759 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

760 *
pDeTxD
 = 
TxD
;

763 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_CTX_IDX0
 + 
QueIdx
 * 
RINGREG_DIFF
,Ad->
TxRg
[QueIdx].
TxCpuIdx
);

764 
pAd
->
RkCous
.
KickTxCou
++;

772  
bReschedu
;

774 
	}
}

793 
BOOLEAN
 
	$RTMPHdTxRgDmaDeIru
(

794 
IN
 
PRTMP_ADAPTER
 
pAd
,

795 
IN
 
INT_SOURCE_CSR_STRUC
 
TxRgBm
)

798 
IrqFgs
;

799 
BOOLEAN
 
bReschedu
 = 
FALSE
;

804 
	`RTMP_IRQ_LOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

806 i(
TxRgBm
.
fld
.
Ac0DmaDe
)

807 
bReschedu
 = 
	`RTMPFeTXDUpTxDmaDe
(
pAd
, 
QID_AC_BE
);

809 i(
TxRgBm
.
fld
.
HcDmaDe
)

810 
bReschedu
 |
	`RTMPFeTXDUpTxDmaDe
(
pAd
, 
QID_HCCA
);

812 i(
TxRgBm
.
fld
.
Ac3DmaDe
)

813 
bReschedu
 |
	`RTMPFeTXDUpTxDmaDe
(
pAd
, 
QID_AC_VO
);

815 i(
TxRgBm
.
fld
.
Ac2DmaDe
)

816 
bReschedu
 |
	`RTMPFeTXDUpTxDmaDe
(
pAd
, 
QID_AC_VI
);

818 i(
TxRgBm
.
fld
.
Ac1DmaDe
)

819 
bReschedu
 |
	`RTMPFeTXDUpTxDmaDe
(
pAd
, 
QID_AC_BK
);

823 
	`RTMP_IRQ_UNLOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

826 
	`RTMPDeQueuePack
(
pAd
, 
FALSE
, 
NUM_OF_TX_RING
, 
MAX_TX_PROCESS
);

828  
bReschedu
;

829 
	}
}

850 
VOID
 
	$RTMPHdMgmtRgDmaDeIru
(

851 
IN
 
PRTMP_ADAPTER
 
pAd
)

853 
PTXD_STRUC
 
pTxD
;

854 #ifde
RT_BIG_ENDIAN


855 
PTXD_STRUC
 
pDeTxD
;

856 
TXD_STRUC
 
TxD
;

858 
PNDIS_PACKET
 
pPack
;

860 
UCHAR
 
FREE
 = 0;

861 
PRTMP_MGMT_RING
 
pMgmtRg
 = &
pAd
->
MgmtRg
;

863 
	`NdisAcqueSpLock
(&
pAd
->
MgmtRgLock
);

865 
	`RTMP_IO_READ32
(
pAd
, 
TX_MGMTDTX_IDX
, &
pMgmtRg
->
TxDmaIdx
);

866 
pMgmtRg
->
TxSwFeIdx
!pMgmtRg->
TxDmaIdx
)

868 
FREE
++;

869 #ifde
RT_BIG_ENDIAN


870 
pDeTxD
 = (
PTXD_STRUC
(
pMgmtRg
->
Cl
[
pAd
->
MgmtRg
.
TxSwFeIdx
].
AocVa
);

871 
TxD
 = *
pDeTxD
;

872 
pTxD
 = &
TxD
;

873 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

875 
pTxD
 = (
PTXD_STRUC
(
pMgmtRg
->
Cl
[
pAd
->
MgmtRg
.
TxSwFeIdx
].
AocVa
);

877 
pTxD
->
DMADONE
 = 0;

878 
pPack
 = 
pMgmtRg
->
Cl
[pMgmtRg->
TxSwFeIdx
].
pNdisPack
;

880 i(
pPack
 =
NULL
)

884 i(
pPack
)

886 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP0
,TxD->
SDL0
, 
PCI_DMA_TODEVICE
);

887 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

889 
pMgmtRg
->
Cl
[pMgmtRg->
TxSwFeIdx
].
pNdisPack
 = 
NULL
;

891 
pPack
 = 
pMgmtRg
->
Cl
[pMgmtRg->
TxSwFeIdx
].
pNextNdisPack
;

892 i(
pPack
)

894 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

895 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

897 
pMgmtRg
->
Cl
[pMgmtRg->
TxSwFeIdx
].
pNextNdisPack
 = 
NULL
;

898 
	`INC_RING_INDEX
(
pMgmtRg
->
TxSwFeIdx
, 
MGMT_RING_SIZE
);

900 #ifde
RT_BIG_ENDIAN


901 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

902 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
TRUE
, 
TYPE_TXD
);

905 
	`NdisRSpLock
(&
pAd
->
MgmtRgLock
);

907 #ifde
CONFIG_STA_SUPPORT


909 
	}
}

923 
VOID
 
	$RTMPHdTBTTIru
(

924 
IN
 
PRTMP_ADAPTER
 
pAd
)

927 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

931 
	}
}

945 
VOID
 
	$RTMPHdPTBTTIru
(

946 
IN
 
PRTMP_ADAPTER
 
pAd
)

949 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

951 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPHandlePreTBTTInterrupt...\n"));

956 
	}
}

958 
VOID
 
	$RTMPHdRxCohtIru
(

959 
IN
 
PRTMP_ADAPTER
 
pAd
)

961 
WPDMA_GLO_CFG_STRUC
 
GloCfg
;

963 i(
pAd
 =
NULL
)

965 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====>Ad is NULL,eturn.\n"));

969 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==> RTMPHandleRxCoherentInterrupt \n"));

971 
	`RTMP_IO_READ32
(
pAd
, 
WPDMA_GLO_CFG
 , &
GloCfg
.
wd
);

973 
GloCfg
.
fld
.
EnTXWreBackDDONE
 = 0;

974 
GloCfg
.
fld
.
EbRxDMA
 = 0;

975 
GloCfg
.
fld
.
EbTxDMA
 = 0;

976 
	`RTMP_IO_WRITE32
(
pAd
, 
WPDMA_GLO_CFG
, 
GloCfg
.
wd
);

978 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_BE
);

979 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_BK
);

980 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_VI
);

981 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_VO
);

982 
	`RTMPRgC˪Up
(
pAd
, 
QID_HCCA
);

983 
	`RTMPRgC˪Up
(
pAd
, 
QID_MGMT
);

984 
	`RTMPRgC˪Up
(
pAd
, 
QID_RX
);

986 
	`RTMPEbRxTx
(
pAd
);

988 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<== RTMPHandleRxCoherentInterrupt \n"));

989 
	}
}

993 
PNDIS_PACKET
 
	$GPackFromRxRg
(

994 
IN
 
PRTMP_ADAPTER
 
pAd
,

995 
OUT
 
PRT28XX_RXD_STRUC
 
pSaveRxD
,

996 
OUT
 
BOOLEAN
 *
pbReschedu
,

997 
IN
 
OUT
 
UINT32
 *
pRxPdg
)

999 
PRXD_STRUC
 
pRxD
;

1000 #ifde
RT_BIG_ENDIAN


1001 
PRXD_STRUC
 
pDeRxD
;

1002 
RXD_STRUC
 
RxD
;

1004 
PNDIS_PACKET
 
pRxPack
 = 
NULL
;

1005 
PNDIS_PACKET
 
pNewPack
;

1006 
PVOID
 
AocVa
;

1007 
NDIS_PHYSICAL_ADDRESS
 
AocPa
;

1008 
BOOLEAN
 
bReschedu
 = 
FALSE
;

1009 
RTMP_DMACB
 *
pRxCl
;

1011 
	`RTMP_SEM_LOCK
(&
pAd
->
RxRgLock
);

1013 i(*
pRxPdg
 == 0)

1016 
	`RTMP_IO_READ32
(
pAd
, 
RX_DRX_IDX
 , &pAd->
RxRg
.
RxDmaIdx
);

1018 i(
pAd
->
RxRg
.
RxSwRdIdx
 =pAd->RxRg.
RxDmaIdx
)

1021 
bReschedu
 = 
FALSE
;

1022 
de
;

1026 i(
pAd
->
RxRg
.
RxDmaIdx
 >Ad->RxRg.
RxSwRdIdx
)

1027 *
pRxPdg
 = 
pAd
->
RxRg
.
RxDmaIdx
 -Ad->RxRg.
RxSwRdIdx
;

1029 *
pRxPdg
 = 
pAd
->
RxRg
.
RxDmaIdx
 + 
RX_RING_SIZE
 -Ad->RxRg.
RxSwRdIdx
;

1033 
pRxCl
 = &
pAd
->
RxRg
.
Cl
[pAd->RxRg.
RxSwRdIdx
];

1035 #ifde
RT_BIG_ENDIAN


1036 
pDeRxD
 = (
PRXD_STRUC

pRxCl
->
AocVa
;

1037 
RxD
 = *
pDeRxD
;

1038 
pRxD
 = &
RxD
;

1039 
	`RTMPDestEndnChge
((
PUCHAR
)
pRxD
, 
TYPE_RXD
);

1042 
pRxD
 = (
PRXD_STRUC

pRxCl
->
AocVa
;

1045 i(
pRxD
->
DDONE
 == 0)

1047 *
pRxPdg
 = 0;

1049 
bReschedu
 = 
TRUE
;

1050 
de
;

1055 
	`NdisMoveMemy
(
pSaveRxD
, 
pRxD
, 
RXD_SIZE
);

1057 
pNewPack
 = 
	`RTMP_AoRxPackBufr
(
pAd
, 
RX_BUFFER_AGGRESIZE
, 
FALSE
, &
AocVa
, &
AocPa
);

1059 i(
pNewPack
)

1062 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pRxCl
->
DmaBuf
.
AocPa
,

1063 
pRxCl
->
DmaBuf
.
AocSize
, 
PCI_DMA_FROMDEVICE
);

1064 
pRxPack
 = 
pRxCl
->
pNdisPack
;

1066 
pRxCl
->
DmaBuf
.
AocSize
 = 
RX_BUFFER_AGGRESIZE
;

1067 
pRxCl
->
pNdisPack
 = (
PNDIS_PACKET

pNewPack
;

1068 
pRxCl
->
DmaBuf
.
AocVa
 = AllocVa;

1069 
pRxCl
->
DmaBuf
.
AocPa
 = AllocPa;

1071 
pRxD
->
SDP0
 = 
AocPa
;

1076 
pRxPack
 = 
NULL
;

1077 
bReschedu
 = 
TRUE
;

1080 
pRxD
->
DDONE
 = 0;

1083 *
pRxPdg
 = *pRxPending - 1;

1086 #ifde
RT_BIG_ENDIAN


1087 
	`RTMPDestEndnChge
((
PUCHAR
)
pRxD
, 
TYPE_RXD
);

1088 
	`WreBackToDest
((
PUCHAR
)
pDeRxD
, (PUCHAR)
pRxD
, 
FALSE
, 
TYPE_RXD
);

1090 
	`INC_RING_INDEX
(
pAd
->
RxRg
.
RxSwRdIdx
, 
RX_RING_SIZE
);

1092 
pAd
->
RxRg
.
RxCpuIdx
 = (pAd->RxRg.
RxSwRdIdx
 =0? (
RX_RING_SIZE
-1) : (pAd->RxRing.RxSwReadIdx-1);

1093 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_CRX_IDX
,Ad->
RxRg
.
RxCpuIdx
);

1095 
de
:

1096 
	`RTMP_SEM_UNLOCK
(&
pAd
->
RxRgLock
);

1097 *
pbReschedu
 = 
bReschedu
;

1098  
pRxPack
;

1099 
	}
}

1102 
NDIS_STATUS
 
	$MlmeHdTnsmTxRg
(

1103 
IN
 
PRTMP_ADAPTER
 
pAd
,

1104 
IN
 
UCHAR
 
QueIdx
,

1105 
IN
 
PNDIS_PACKET
 
pPack
)

1107 
PACKET_INFO
 
PackInfo
;

1108 
PUCHAR
 
pSrcBufVA
;

1109 
UINT
 
SrcBufL
;

1110 
PTXD_STRUC
 
pTxD
;

1111 #ifde
RT_BIG_ENDIAN


1112 
PTXD_STRUC
 
pDeTxD
;

1113 
TXD_STRUC
 
TxD
;

1115 
PHEADER_802_11
 
pHd_802_11
;

1116 
BOOLEAN
 
bAckRequed
, 
bInTimeamp
;

1117 
ULONG
 
SrcBufPA
;

1119 
UCHAR
 
MlmeRe
;

1120 
ULONG
 
SwIdx
 = 
pAd
->
TxRg
[
QueIdx
].
TxCpuIdx
;

1121 
PTXWI_STRUC
 
pFTxWI
;

1124 
ULONG
 
FeNum
;

1125 
MAC_TABLE_ENTRY
 *
pMacEry
 = 
NULL
;

1128 
	`RTMP_QuyPackInfo
(
pPack
, &
PackInfo
, &
pSrcBufVA
, &
SrcBufL
);

1131 i(
pSrcBufVA
 =
NULL
)

1134  
NDIS_STATUS_FAILURE
;

1140 
FeNum
 = 
	`GET_TXRING_FREENO
(
pAd
, 
QueIdx
);

1142 i(
FeNum
 == 0)

1145  
NDIS_STATUS_FAILURE
;

1148 
SwIdx
 = 
pAd
->
TxRg
[
QueIdx
].
TxCpuIdx
;

1150 #ide
RT_BIG_ENDIAN


1151 
pTxD
 = (
PTXD_STRUC

pAd
->
TxRg
[
QueIdx
].
Cl
[
SwIdx
].
AocVa
;

1153 
pDeTxD
 = (
PTXD_STRUC
)
pAd
->
TxRg
[
QueIdx
].
Cl
[
SwIdx
].
AocVa
;

1154 
TxD
 = *
pDeTxD
;

1155 
pTxD
 = &
TxD
;

1156 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

1159 i(
pAd
->
TxRg
[
QueIdx
].
Cl
[
SwIdx
].
pNdisPack
)

1161 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("MlmeHardTransmit Error\n"));

1163  
NDIS_STATUS_FAILURE
;

1167 #ifde
CONFIG_STA_SUPPORT


1168 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1172 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

1173 
	`AsicFWakeup
(
pAd
, 
TRUE
);

1176 
pFTxWI
 =(
PTXWI_STRUC
)
pSrcBufVA
;

1178 
pHd_802_11
 = (
PHEADER_802_11
(
pSrcBufVA
 + 
TXWI_SIZE
);

1179 i(
pHd_802_11
->
Addr1
[0] & 0x01)

1181 
MlmeRe
 = 
pAd
->
CommCfg
.
BasicMlmeRe
;

1185 
MlmeRe
 = 
pAd
->
CommCfg
.MlmeRate;

1188 i((
pHd_802_11
->
FC
.
Ty
 =
BTYPE_DATA
) &&

1189 (
pHd_802_11
->
FC
.
SubTy
 =
SUBTYPE_QOS_NULL
))

1191 
pMacEry
 = 
	`MacTabLookup
(
pAd
, 
pHd_802_11
->
Addr1
);

1195 i((
pAd
->
LchRfRegs
.
Chl
 > 14&& (
MlmeRe
 < 
RATE_6
))

1196 
MlmeRe
 = 
RATE_6
;

1205 #ifde
CONFIG_STA_SUPPORT


1207 i(
pHd_802_11
->
FC
.
Ty
 !
BTYPE_DATA
)

1209 i((
pHd_802_11
->
FC
.
SubTy
 =
SUBTYPE_PROBE_REQ
|| !(
pAd
->
CommCfg
.
bAPSDCab
 &&Ad->CommCfg.
APEdPm
.bAPSDCapable))

1211 
pHd_802_11
->
FC
.
PwrMgmt
 = 
PWR_ACTIVE
;

1215 
pHd_802_11
->
FC
.
PwrMgmt
 = 
pAd
->
CommCfg
.
bAPSDFPowSave
;

1220 
bInTimeamp
 = 
FALSE
;

1221 i(
pHd_802_11
->
FC
.
Ty
 =
BTYPE_CNTL
)

1223 
bAckRequed
 = 
FALSE
;

1227 i(
pHd_802_11
->
Addr1
[0] & 0x01)

1229 
bAckRequed
 = 
FALSE
;

1230 
pHd_802_11
->
Duti
 = 0;

1234 
bAckRequed
 = 
TRUE
;

1235 
pHd_802_11
->
Duti
 = 
	`RTMPCcDuti
(
pAd
, 
MlmeRe
, 14);

1236 i(
pHd_802_11
->
FC
.
SubTy
 =
SUBTYPE_PROBE_RSP
)

1238 
bInTimeamp
 = 
TRUE
;

1242 
pHd_802_11
->
Sequ
 = 
pAd
->Sequence++;

1243 i(
pAd
->
Sequ
 > 0xfff)

1244 
pAd
->
Sequ
 = 0;

1247 i((
pHd_802_11
->
FC
.
SubTy
 !
SUBTYPE_PROBE_REQ
)

1248 && (
pAd
->
CommCfg
.
bIEEE80211H
 == 1)

1249 && (
pAd
->
CommCfg
.
RadDe
.
RDMode
 !
RD_NORMAL_MODE
))

1251 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("MlmeHardTransmit -->adar detectot inormal mode !!!\n"));

1253  (
NDIS_STATUS_FAILURE
);

1257 #ifde
RT_BIG_ENDIAN


1258 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pHd_802_11
, 
DIR_WRITE
, 
FALSE
);

1273 i(
pMacEry
 =
NULL
)

1275 
	`RTMPWreTxWI
(
pAd
, 
pFTxWI
, 
FALSE
, FALSE, 
bInTimeamp
, FALSE, 
bAckRequed
, FALSE,

1276 0, 
RESERVED_WCID
, (
SrcBufL
 - 
TXWI_SIZE
), 
PID_MGMT
, 0, (
UCHAR
)
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
, 
IFS_BACKOFF
, 
FALSE
, &pAd->CommonCfg.MlmeTransmit);

1280 
	`RTMPWreTxWI
(
pAd
, 
pFTxWI
, 
FALSE
, FALSE,

1281 
bInTimeamp
, 
FALSE
, 
bAckRequed
, FALSE,

1282 0, 
pMacEry
->
Aid
, (
SrcBufL
 - 
TXWI_SIZE
),

1283 
pMacEry
->
MaxHTPhyMode
.
fld
.
MCS
, 0,

1284 (
UCHAR
)
pMacEry
->
MaxHTPhyMode
.
fld
.
MCS
,

1285 
IFS_BACKOFF
, 
FALSE
, &
pMacEry
->
MaxHTPhyMode
);

1288 
pAd
->
TxRg
[
QueIdx
].
Cl
[
SwIdx
].
pNdisPack
 = 
pPack
;

1289 
pAd
->
TxRg
[
QueIdx
].
Cl
[
SwIdx
].
pNextNdisPack
 = 
NULL
;

1291 #ifde
RT_BIG_ENDIAN


1292 
	`RTMPWIEndnChge
((
PUCHAR
)
pFTxWI
, 
TYPE_TXWI
);

1294 
SrcBufPA
 = 
	`PCI_MAP_SINGLE
(
pAd
, 
pSrcBufVA
, 
SrcBufL
, 0, 
PCI_DMA_TODEVICE
);

1297 
	`RTMPWreTxDest
(
pAd
, 
pTxD
, 
TRUE
, 
FIFO_EDCA
);

1298 
pTxD
->
LaSec0
 = 1;

1299 
pTxD
->
LaSec1
 = 1;

1300 
pTxD
->
SDL0
 = 
SrcBufL
;

1301 
pTxD
->
SDL1
 = 0;

1302 
pTxD
->
SDP0
 = 
SrcBufPA
;

1303 
pTxD
->
DMADONE
 = 0;

1305 #ifde
RT_BIG_ENDIAN


1306 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

1307 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

1310 
pAd
->
RkCous
.
KickTxCou
++;

1311 
pAd
->
RkCous
.
OSecTxDeCou
++;

1314 
	`INC_RING_INDEX
(
pAd
->
TxRg
[
QueIdx
].
TxCpuIdx
, 
TX_RING_SIZE
);

1316 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_CTX_IDX0
 + 
QueIdx
*0x10,Ad->
TxRg
[QueIdx].
TxCpuIdx
);

1321  
NDIS_STATUS_SUCCESS
;

1322 
	}
}

1325 
NDIS_STATUS
 
	$MlmeDaHdTnsm
(

1326 
IN
 
PRTMP_ADAPTER
 
pAd
,

1327 
IN
 
UCHAR
 
QueIdx
,

1328 
IN
 
PNDIS_PACKET
 
pPack
)

1330 i((
pAd
->
CommCfg
.
RadDe
.
RDMode
 !
RD_NORMAL_MODE
)

1333  
NDIS_STATUS_FAILURE
;

1336  
	`MlmeHdTnsmTxRg
(
pAd
,
QueIdx
,
pPack
);

1337 
	}
}

1367 
VOID
 
	$RTMPWreTxDest
(

1368 
IN
 
PRTMP_ADAPTER
 
pAd
,

1369 
IN
 
PTXD_STRUC
 
pTxD
,

1370 
IN
 
BOOLEAN
 
bWIV
,

1371 
IN
 
UCHAR
 
QueueSEL
)

1377 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_SHORT_PREAMBLE_INUSED
);

1379 
pTxD
->
WIV
 = (
bWIV
) ? 1: 0;

1380 
pTxD
->
QSEL
(
QueueSEL
);

1383 i(
pAd
->
bGOHCCA
 =
TRUE
)

1384 
pTxD
->
QSEL

FIFO_HCCA
;

1385 
pTxD
->
DMADONE
 = 0;

1386 
	}
}

	@common/cmm_info.c

37 
	~"_cfig.h
"

40 
INT
 
Show_SSID_Proc
(

41 
IN
 
PRTMP_ADAPTER
 
pAd
,

42 
OUT
 
PSTRING
 
pBuf
);

44 
INT
 
Show_WessMode_Proc
(

45 
IN
 
PRTMP_ADAPTER
 
pAd
,

46 
OUT
 
PSTRING
 
pBuf
);

48 
INT
 
Show_TxBur_Proc
(

49 
IN
 
PRTMP_ADAPTER
 
pAd
,

50 
OUT
 
PSTRING
 
pBuf
);

52 
INT
 
Show_TxPamb_Proc
(

53 
IN
 
PRTMP_ADAPTER
 
pAd
,

54 
OUT
 
PSTRING
 
pBuf
);

56 
INT
 
Show_TxPow_Proc
(

57 
IN
 
PRTMP_ADAPTER
 
pAd
,

58 
OUT
 
PSTRING
 
pBuf
);

60 
INT
 
Show_Chl_Proc
(

61 
IN
 
PRTMP_ADAPTER
 
pAd
,

62 
OUT
 
PSTRING
 
pBuf
);

64 
INT
 
Show_BGPrei_Proc
(

65 
IN
 
PRTMP_ADAPTER
 
pAd
,

66 
OUT
 
PSTRING
 
pBuf
);

68 
INT
 
Show_RTSThshd_Proc
(

69 
IN
 
PRTMP_ADAPTER
 
pAd
,

70 
OUT
 
PSTRING
 
pBuf
);

72 
INT
 
Show_FgThshd_Proc
(

73 
IN
 
PRTMP_ADAPTER
 
pAd
,

74 
OUT
 
PSTRING
 
pBuf
);

76 #ifde
DOT11_N_SUPPORT


77 
INT
 
Show_HtBw_Proc
(

78 
IN
 
PRTMP_ADAPTER
 
pAd
,

79 
OUT
 
PSTRING
 
pBuf
);

81 
INT
 
Show_HtMcs_Proc
(

82 
IN
 
PRTMP_ADAPTER
 
pAd
,

83 
OUT
 
PSTRING
 
pBuf
);

85 
INT
 
Show_HtGi_Proc
(

86 
IN
 
PRTMP_ADAPTER
 
pAd
,

87 
OUT
 
PSTRING
 
pBuf
);

89 
INT
 
Show_HtOpMode_Proc
(

90 
IN
 
PRTMP_ADAPTER
 
pAd
,

91 
OUT
 
PSTRING
 
pBuf
);

93 
INT
 
Show_HtExtcha_Proc
(

94 
IN
 
PRTMP_ADAPTER
 
pAd
,

95 
OUT
 
PSTRING
 
pBuf
);

97 
INT
 
Show_HtMpduDsy_Proc
(

98 
IN
 
PRTMP_ADAPTER
 
pAd
,

99 
OUT
 
PSTRING
 
pBuf
);

101 
INT
 
Show_HtBaWSize_Proc
(

102 
IN
 
PRTMP_ADAPTER
 
pAd
,

103 
OUT
 
PSTRING
 
pBuf
);

105 
INT
 
Show_HtRdg_Proc
(

106 
IN
 
PRTMP_ADAPTER
 
pAd
,

107 
OUT
 
PSTRING
 
pBuf
);

109 
INT
 
Show_HtAmsdu_Proc
(

110 
IN
 
PRTMP_ADAPTER
 
pAd
,

111 
OUT
 
PSTRING
 
pBuf
);

113 
INT
 
Show_HtAutoBa_Proc
(

114 
IN
 
PRTMP_ADAPTER
 
pAd
,

115 
OUT
 
PSTRING
 
pBuf
);

118 
INT
 
Show_CouryRegi_Proc
(

119 
IN
 
PRTMP_ADAPTER
 
pAd
,

120 
OUT
 
PSTRING
 
pBuf
);

122 
INT
 
Show_CouryRegiABd_Proc
(

123 
IN
 
PRTMP_ADAPTER
 
pAd
,

124 
OUT
 
PSTRING
 
pBuf
);

126 
INT
 
Show_CouryCode_Proc
(

127 
IN
 
PRTMP_ADAPTER
 
pAd
,

128 
OUT
 
PSTRING
 
pBuf
);

130 #ifde
AGGREGATION_SUPPORT


131 
INT
 
Show_PktAggge_Proc
(

132 
IN
 
PRTMP_ADAPTER
 
pAd
,

133 
OUT
 
PSTRING
 
pBuf
);

136 #ifde
WMM_SUPPORT


137 
INT
 
Show_WmmCab_Proc
(

138 
IN
 
PRTMP_ADAPTER
 
pAd
,

139 
OUT
 
PSTRING
 
pBuf
);

142 
INT
 
Show_IEEE80211H_Proc
(

143 
IN
 
PRTMP_ADAPTER
 
pAd
,

144 
OUT
 
PSTRING
 
pBuf
);

146 #ifde
CONFIG_STA_SUPPORT


147 
INT
 
Show_NwkTy_Proc
(

148 
IN
 
PRTMP_ADAPTER
 
pAd
,

149 
OUT
 
PSTRING
 
pBuf
);

152 
INT
 
Show_WPAPSK_Proc
(

153 
IN
 
PRTMP_ADAPTER
 
pAd
,

154 
OUT
 
PSTRING
 
pBuf
);

156 
INT
 
Show_AutoRec_Proc
(

157 
IN
 
PRTMP_ADAPTER
 
pAd
,

158 
OUT
 
PSTRING
 
pBuf
);

162 
INT
 
Show_AuthMode_Proc
(

163 
IN
 
PRTMP_ADAPTER
 
pAd
,

164 
OUT
 
PSTRING
 
pBuf
);

166 
INT
 
Show_EnypTy_Proc
(

167 
IN
 
PRTMP_ADAPTER
 
pAd
,

168 
OUT
 
PSTRING
 
pBuf
);

170 
INT
 
Show_DeuKeyID_Proc
(

171 
IN
 
PRTMP_ADAPTER
 
pAd
,

172 
OUT
 
PSTRING
 
pBuf
);

174 
INT
 
Show_Key1_Proc
(

175 
IN
 
PRTMP_ADAPTER
 
pAd
,

176 
OUT
 
PSTRING
 
pBuf
);

178 
INT
 
Show_Key2_Proc
(

179 
IN
 
PRTMP_ADAPTER
 
pAd
,

180 
OUT
 
PSTRING
 
pBuf
);

182 
INT
 
Show_Key3_Proc
(

183 
IN
 
PRTMP_ADAPTER
 
pAd
,

184 
OUT
 
PSTRING
 
pBuf
);

186 
INT
 
Show_Key4_Proc
(

187 
IN
 
PRTMP_ADAPTER
 
pAd
,

188 
OUT
 
PSTRING
 
pBuf
);

190 
INT
 
Show_PMK_Proc
(

191 
IN
 
PRTMP_ADAPTER
 
pAd
,

192 
OUT
 
PSTRING
 
pBuf
);

194 
INT
 
S_AP_WscCfStus_Proc
(

195 
IN
 
PRTMP_ADAPTER
 
pAd
,

196 
IN
 
PSTRING
 
g
);

198 
INT
 
S_AP_AuthMode_Proc
(

199 
IN
 
PRTMP_ADAPTER
 
pAd
,

200 
IN
 
PSTRING
 
g
);

202 
INT
 
S_AP_EnypTy_Proc
(

203 
IN
 
PRTMP_ADAPTER
 
pAd
,

204 
IN
 
PSTRING
 
g
);

206 
INT
 
S_AP_SSID_Proc
(

207 
IN
 
PRTMP_ADAPTER
 
pAd
,

208 
IN
 
PSTRING
 
g
);

210 
INT
 
S_AP_WPAPSK_Proc
(

211 
IN
 
PRTMP_ADAPTER
 
pAd
,

212 
IN
 
PSTRING
 
g
);

215 
PSTRING
 
	mme
;

216 
INT
 (*
show_oc
)(
PRTMP_ADAPTER
 
	mpAdr
, 
PSTRING
 
	mg
);

217 } *
	gPRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC
, 
	gRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC
[] = {

218 #ifde
DBG


219 {"SSID", 
Show_SSID_Proc
},

220 {"WessMode", 
Show_WessMode_Proc
},

221 {"TxBur", 
Show_TxBur_Proc
},

222 {"TxPamb", 
Show_TxPamb_Proc
},

223 {"TxPow", 
Show_TxPow_Proc
},

224 {"Chl", 
Show_Chl_Proc
},

225 {"BGPrei", 
Show_BGPrei_Proc
},

226 {"RTSThshd", 
Show_RTSThshd_Proc
},

227 {"FgThshd", 
Show_FgThshd_Proc
},

228 #ifde
DOT11_N_SUPPORT


229 {"HtBw", 
Show_HtBw_Proc
},

230 {"HtMcs", 
Show_HtMcs_Proc
},

231 {"HtGi", 
Show_HtGi_Proc
},

232 {"HtOpMode", 
Show_HtOpMode_Proc
},

233 {"HtExtcha", 
Show_HtExtcha_Proc
},

234 {"HtMpduDsy", 
Show_HtMpduDsy_Proc
},

235 {"HtBaWSize", 
Show_HtBaWSize_Proc
},

236 {"HtRdg", 
Show_HtRdg_Proc
},

237 {"HtAmsdu", 
Show_HtAmsdu_Proc
},

238 {"HtAutoBa", 
Show_HtAutoBa_Proc
},

240 {"CouryRegi", 
Show_CouryRegi_Proc
},

241 {"CouryRegiABd", 
Show_CouryRegiABd_Proc
},

242 {"CouryCode", 
Show_CouryCode_Proc
},

243 #ifde
AGGREGATION_SUPPORT


244 {"PktAggge", 
Show_PktAggge_Proc
},

247 #ifde
WMM_SUPPORT


248 {"WmmCab", 
Show_WmmCab_Proc
},

250 {"IEEE80211H", 
Show_IEEE80211H_Proc
},

251 #ifde
CONFIG_STA_SUPPORT


252 {"NwkTy", 
Show_NwkTy_Proc
},

253 {"WPAPSK", 
Show_WPAPSK_Proc
},

254 {"AutoRec", 
Show_AutoRec_Proc
},

256 {"AuthMode", 
Show_AuthMode_Proc
},

257 {"EnypTy", 
Show_EnypTy_Proc
},

258 {"DeuKeyID", 
Show_DeuKeyID_Proc
},

259 {"Key1", 
Show_Key1_Proc
},

260 {"Key2", 
Show_Key2_Proc
},

261 {"Key3", 
Show_Key3_Proc
},

262 {"Key4", 
Show_Key4_Proc
},

263 {"PMK", 
Show_PMK_Proc
},

265 {
NULL
, NULL}

276 
INT
 
	$S_DrivVsi_Proc
(

277 
IN
 
PRTMP_ADAPTER
 
pAd
,

278 
IN
 
PSTRING
 
g
)

281 #ifde
CONFIG_STA_SUPPORT


282 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

283 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Driv vsi-%s\n", 
STA_DRIVER_VERSION
));

286  
TRUE
;

287 
	}
}

298 
INT
 
	$S_CouryRegi_Proc
(

299 
IN
 
PRTMP_ADAPTER
 
pAd
,

300 
IN
 
PSTRING
 
g
)

302 
tv
;

304 #ifde
EXT_BUILD_CHANNEL_LIST


305  -
EOPNOTSUPP
;

308 
tv
 = 
	`RT_CfgSCouryRegi
(
pAd
, 
g
, 
BAND_24G
);

309 i(
tv
 =
FALSE
)

310  
FALSE
;

313 
	`BudChlLi
(
pAd
);

315 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_CouryRegi_Proc::(CouryRegi=%d)\n", 
pAd
->
CommCfg
.
CouryRegi
));

317  
TRUE
;

318 
	}
}

330 
INT
 
	$S_CouryRegiABd_Proc
(

331 
IN
 
PRTMP_ADAPTER
 
pAd
,

332 
IN
 
PSTRING
 
g
)

334 
tv
;

336 #ifde
EXT_BUILD_CHANNEL_LIST


337  -
EOPNOTSUPP
;

340 
tv
 = 
	`RT_CfgSCouryRegi
(
pAd
, 
g
, 
BAND_5G
);

341 i(
tv
 =
FALSE
)

342  
FALSE
;

345 
	`BudChlLi
(
pAd
);

347 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_CouryRegiABd_Proc::(CouryRegi=%d)\n", 
pAd
->
CommCfg
.
CouryRegiFABd
));

349  
TRUE
;

350 
	}
}

353 
INT
 
	$S_Cmm_WessMode_Proc
(

354 
IN
 
PRTMP_ADAPTER
 
pAd
,

355 
IN
 
PSTRING
 
g
,

356 
IN
 
BOOLEAN
 
FlgIsDiffMbssModeUd
)

358 
INT
 
sucss
 = 
TRUE
;

362 #ifde
CONFIG_STA_SUPPORT


363 
sucss
 = 
	`RT_CfgSWessMode
(
pAd
, 
g
);

366 i(
sucss
)

369 #ifde
CONFIG_STA_SUPPORT


370 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

372 
LONG
 
WessMode
 = 
pAd
->
CommCfg
.
PhyMode
;

375 
	`BssTabIn
(&
pAd
->
SnTab
);

376 i(
pAd
->
SCfg
.
LaSnTime
 > 10 * 
OS_HZ
)

377 
pAd
->
SCfg
.
LaSnTime
 -(10 * 
OS_HZ
);

379 
	`RTMPSPhyMode
(
pAd
, 
WessMode
);

380 #ifde
DOT11_N_SUPPORT


381 i(
WessMode
 >
PHY_11ABGN_MIXED
)

383 
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 = 
TRUE
;

384 
pAd
->
CommCfg
.
REGBACaby
.
fld
.
AutoBA
 = 
TRUE
;

388 
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 = 
FALSE
;

389 
pAd
->
CommCfg
.
REGBACaby
.
fld
.
AutoBA
 = 
FALSE
;

393 i(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
)

395 
	`MlmeUpdeTxRes
(
pAd
, 
FALSE
, 0);

396 
	`MakeIbssBc
(
pAd
);

397 
	`AsicEbIbssSync
(
pAd
);

403 #ifde
DOT11_N_SUPPORT


404 
	`SCommHT
(
pAd
);

411 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Set_WirelessMode_Proc::parameters out ofange\n"));

414  
sucss
;

415 
	}
}

427 
INT
 
	$S_WessMode_Proc
(

428 
IN
 
PRTMP_ADAPTER
 
pAd
,

429 
IN
 
PSTRING
 
g
)

431  
	`S_Cmm_WessMode_Proc
(
pAd
, 
g
, 0);

432 
	}
}

442 
INT
 
	$S_Chl_Proc
(

443 
IN
 
PRTMP_ADAPTER
 
pAd
,

444 
IN
 
PSTRING
 
g
)

446 
INT
 
sucss
 = 
TRUE
;

447 
UCHAR
 
Chl
;

449 
Chl
 = (
UCHAR

	`sime_
(
g
, 0, 10);

452 i(
	`ChlSy
(
pAd
, 
Chl
=
TRUE
)

454 #ifde
CONFIG_STA_SUPPORT


455 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

457 
pAd
->
CommCfg
.
Chl
 = Channel;

462 
pAd
->
MlmeAux
.
Chl
 =Ad->
CommCfg
.Channel;

464 i(
	`MONITOR_ON
(
pAd
))

466 #ifde
DOT11_N_SUPPORT


467 
	`N_ChlCheck
(
pAd
);

468 i(
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
 &&

469 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 =
BW_40
)

471 
	`N_SCCh
(
pAd
);

472 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

473 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

474 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BW_40, control_channel(%d), CentralChannel(%d) \n",

475 
pAd
->
CommCfg
.
Chl
,Ad->CommCfg.
CChl
));

480 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

481 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

482 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BW_20, Chl(%d)\n", 
pAd
->
CommCfg
.
Chl
));

488 
sucss
 = 
TRUE
;

493 #ifde
CONFIG_STA_SUPPORT


494 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

495 
sucss
 = 
FALSE
;

496 
	`DBGPRINT
(
RT_DEBUG_WARN
,("This channel is out of channelist,othingo do!\n "));

501 i(
sucss
 =
TRUE
)

502 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Chl_Proc::(Chl=%d)\n", 
pAd
->
CommCfg
.
Chl
));

504  
sucss
;

505 
	}
}

516 
INT
 
	$S_ShtSl_Proc
(

517 
IN
 
PRTMP_ADAPTER
 
pAd
,

518 
IN
 
PSTRING
 
g
)

520 
tv
;

522 
tv
 = 
	`RT_CfgSShtSl
(
pAd
, 
g
);

523 i(
tv
 =
TRUE
)

524 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ShtSl_Proc::(ShtSl=%d)\n", 
pAd
->
CommCfg
.
bUShtSlTime
));

526  
tv
;

527 
	}
}

538 
INT
 
	$S_TxPow_Proc
(

539 
IN
 
PRTMP_ADAPTER
 
pAd
,

540 
IN
 
PSTRING
 
g
)

542 
LONG
 
TxPow
;

543 
INT
 
sucss
 = 
FALSE
;

545 
TxPow
 = 
	`sime_
(
g
, 0, 10);

546 i(
TxPow
 <= 100)

549 #ifde
CONFIG_STA_SUPPORT


550 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

552 
pAd
->
CommCfg
.
TxPowDeu
 = 
TxPow
;

553 
pAd
->
CommCfg
.
TxPowPage
 =Ad->CommCfg.
TxPowDeu
;

556 
sucss
 = 
TRUE
;

559 
sucss
 = 
FALSE
;

561 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_TxPow_Proc::(TxPowPage=%ld)\n", 
pAd
->
CommCfg
.
TxPowPage
));

563  
sucss
;

564 
	}
}

574 
INT
 
	$S_BGPrei_Proc
(

575 
IN
 
PRTMP_ADAPTER
 
pAd
,

576 
IN
 
PSTRING
 
g
)

578 
	`sime_
(
g
, 0, 10))

581 
pAd
->
CommCfg
.
UBGPrei
 = 0;

584 
pAd
->
CommCfg
.
UBGPrei
 = 1;

587 
pAd
->
CommCfg
.
UBGPrei
 = 2;

590  
FALSE
;

594 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_BGPrei_Proc::(BGPrei=%ld)\n", 
pAd
->
CommCfg
.
UBGPrei
));

596  
TRUE
;

597 
	}
}

607 
INT
 
	$S_TxPamb_Proc
(

608 
IN
 
PRTMP_ADAPTER
 
pAd
,

609 
IN
 
PSTRING
 
g
)

611 
RT_802_11_PREAMBLE
 
Pamb
;

613 
Pamb
 = (
RT_802_11_PREAMBLE
)
	`sime_
(
g
, 0, 10);

616 
Pamb
)

618 
Rt802_11PambSht
:

619 
pAd
->
CommCfg
.
TxPamb
 = 
Pamb
;

620 #ifde
CONFIG_STA_SUPPORT


621 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

622 
	`MlmeSTxPamb
(
pAd
, 
Rt802_11PambSht
);

625 
Rt802_11PambLg
:

626 #ifde
CONFIG_STA_SUPPORT


627 
Rt802_11PambAuto
:

631 
pAd
->
CommCfg
.
TxPamb
 = 
Pamb
;

632 #ifde
CONFIG_STA_SUPPORT


633 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

634 
	`MlmeSTxPamb
(
pAd
, 
Rt802_11PambLg
);

638  
FALSE
;

641 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_TxPamb_Proc::(TxPamb=%ld)\n", 
pAd
->
CommCfg
.
TxPamb
));

643  
TRUE
;

644 
	}
}

654 
INT
 
	$S_RTSThshd_Proc
(

655 
IN
 
PRTMP_ADAPTER
 
pAd
,

656 
IN
 
PSTRING
 
g
)

658 
NDIS_802_11_RTS_THRESHOLD
 
RtsThsh
;

660 
RtsThsh
 = 
	`sime_
(
g
, 0, 10);

662 if((
RtsThsh
 > 0&& (RtsThsh <
MAX_RTS_THRESHOLD
))

663 
pAd
->
CommCfg
.
RtsThshd
 = (
USHORT
)
RtsThsh
;

664 #ifde
CONFIG_STA_SUPPORT


665 i(
RtsThsh
 == 0)

666 
pAd
->
CommCfg
.
RtsThshd
 = 
MAX_RTS_THRESHOLD
;

669  
FALSE
;

671 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_RTSThshd_Proc::(RTSThshd=%d)\n", 
pAd
->
CommCfg
.
RtsThshd
));

673  
TRUE
;

674 
	}
}

684 
INT
 
	$S_FgThshd_Proc
(

685 
IN
 
PRTMP_ADAPTER
 
pAd
,

686 
IN
 
PSTRING
 
g
)

688 
NDIS_802_11_FRAGMENTATION_THRESHOLD
 
FgThsh
;

690 
FgThsh
 = 
	`sime_
(
g
, 0, 10);

692 i(
FgThsh
 > 
MAX_FRAG_THRESHOLD
 || FgThsh < 
MIN_FRAG_THRESHOLD
)

695 
pAd
->
CommCfg
.
FgmtThshd
 = 
MAX_FRAG_THRESHOLD
;

697 i(
FgThsh
 % 2 == 1)

701 
pAd
->
CommCfg
.
FgmtThshd
 = (
USHORT
)(
FgThsh
 - 1);

705 
pAd
->
CommCfg
.
FgmtThshd
 = (
USHORT
)
FgThsh
;

708 #ifde
CONFIG_STA_SUPPORT


709 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

711 i(
pAd
->
CommCfg
.
FgmtThshd
 =
MAX_FRAG_THRESHOLD
)

712 
pAd
->
CommCfg
.
bUZoToDibFgmt
 = 
TRUE
;

714 
pAd
->
CommCfg
.
bUZoToDibFgmt
 = 
FALSE
;

718 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_FgThshd_Proc::(FgThshd=%d)\n", 
pAd
->
CommCfg
.
FgmtThshd
));

720  
TRUE
;

721 
	}
}

731 
INT
 
	$S_TxBur_Proc
(

732 
IN
 
PRTMP_ADAPTER
 
pAd
,

733 
IN
 
PSTRING
 
g
)

735 
LONG
 
TxBur
;

737 
TxBur
 = 
	`sime_
(
g
, 0, 10);

738 i(
TxBur
 == 1)

739 
pAd
->
CommCfg
.
bEbTxBur
 = 
TRUE
;

740 i(
TxBur
 == 0)

741 
pAd
->
CommCfg
.
bEbTxBur
 = 
FALSE
;

743  
FALSE
;

745 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_TxBur_Proc::(TxBur=%d)\n", 
pAd
->
CommCfg
.
bEbTxBur
));

747  
TRUE
;

748 
	}
}

751 #ifde
RTMP_MAC_PCI


752 
INT
 
	$S_ShowRF_Proc
(

753 
IN
 
PRTMP_ADAPTER
 
pAd
,

754 
IN
 
PSTRING
 
g
)

756 
ShowRF
 = 
	`sime_
(
g
, 0, 10);

758 i(
ShowRF
 == 1)

759 
pAd
->
ShowRf
 = 
TRUE
;

761 
pAd
->
ShowRf
 = 
FALSE
;

763  
TRUE
;

764 
	}
}

768 #ifde
AGGREGATION_SUPPORT


777 
INT
 
	$S_PktAggge_Proc
(

778 
IN
 
PRTMP_ADAPTER
 
pAd
,

779 
IN
 
PSTRING
 
g
)

781 
LONG
 
agg
;

783 
agg
 = 
	`sime_
(
g
, 0, 10);

785 i(
agg
 == 1)

786 
pAd
->
CommCfg
.
bAgggiCab
 = 
TRUE
;

787 i(
agg
 == 0)

788 
pAd
->
CommCfg
.
bAgggiCab
 = 
FALSE
;

790  
FALSE
;

793 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_PktAggge_Proc::(AGGRE=%d)\n", 
pAd
->
CommCfg
.
bAgggiCab
));

795  
TRUE
;

796 
	}
}

800 #ifde
INF_PPA_SUPPORT


801 
INT
 
	$S_INF_AMAZON_SE_PPA_Proc
(

802 
IN
 
PRTMP_ADAPTER
 
pAd
,

803 
IN
 
PUCHAR
 
g
)

805 
ULONG
 
agg
;

806 
UINT
 
us
;

808 
agg
 = 
	`sime_
(
g
, 0, 10);

810 i(
agg
 == 1)

812 if(
pAd
->
PPAEb
==
TRUE
)

814 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INF_AMAZON_SE_PPAlreadynabled \n"));

818 i(
a_hook_deth_gi_dev_
)

820 
UINT32
 
g_if_id
;

822 i(
pAd
->
pDethCb
 =
NULL
)

824 
pAd
->
pDethCb
 = (
PPA_DIRECTPATH_CB
 *
	`kmloc
 ((PPA_DIRECTPATH_CB), 
GFP_ATOMIC
);

825 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Realloc memory forDirectpathCb ??\n"));

829 
pAd
->
pDethCb
->
rx_
 = 
NULL
;

830 
pAd
->
pDethCb
->
_tx_
 = 
NULL
;

831 
pAd
->
pDethCb
->
t_tx_
 = 
NULL
;

833 
us
 = 
	`a_hook_deth_gi_dev_
(&
g_if_id
, 
pAd
->
t_dev
,Ad->
pDethCb
, 
PPA_F_DIRECTPATH_ETH_IF
);

835 if(
us
==1)

837 
pAd
->
g_if_id
=g_if_id;

838 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("gi INF_AMAZON_SE_PPA sucs:t:%d id:%d:%d\n",
us
,
pAd
->
g_if_id
,g_if_id));

839 
pAd
->
PPAEb
=
TRUE
;

843 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("gi INF_AMAZON_SE_PPA fa :t:%d\n",
us
));

849 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INF_AMAZON_SE_PPAnable fail :here iso INF_AMAZON_SE_PPA module . \n"));

855 i(
agg
 == 0)

857 if(
pAd
->
PPAEb
==
FALSE
)

859 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INF_AMAZON_SE_PPAlready disable \n"));

863 i(
a_hook_deth_gi_dev_
)

865 
UINT32
 
g_if_id
;

866 
g_if_id
=
pAd
->g_if_id;

868 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("g_if_id=%d \n",
pAd
->
g_if_id
));

869 
us
=
	`a_hook_deth_gi_dev_
(&
g_if_id
, 
pAd
->
t_dev
, 
NULL
, 
PPA_F_DIRECTPATH_REGISTER
);

871 if(
us
==1)

873 
pAd
->
g_if_id
=0;

874 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("uegi INF_AMAZON_SE_PPA sucs:t:%d\n",
us
));

875 
pAd
->
PPAEb
=
FALSE
;

879 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("uegi INF_AMAZON_SE_PPA fa :t:%d\n",
us
));

885 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INF_AMAZON_SE_PPAnable fail :here iso INF_AMAZON_SE_PPA module . \n"));

892 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Invidrgum%d \n",
agg
));

893  
FALSE
;

896  
TRUE
;

898 
	}
}

911 
INT
 
	$S_IEEE80211H_Proc
(

912 
IN
 
PRTMP_ADAPTER
 
pAd
,

913 
IN
 
PSTRING
 
g
)

915 
LONG
 
80211h
;

917 
80211h
 = 
	`sime_
(
g
, 0, 10);

919 i(
80211h
 == 1)

920 
pAd
->
CommCfg
.
bIEEE80211H
 = 
TRUE
;

921 i(
80211h
 == 0)

922 
pAd
->
CommCfg
.
bIEEE80211H
 = 
FALSE
;

924  
FALSE
;

926 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_IEEE80211H_Proc::(IEEE80211H=%d)\n", 
pAd
->
CommCfg
.
bIEEE80211H
));

928  
TRUE
;

929 
	}
}

932 #ifde
DBG


941 
INT
 
	$S_Debug_Proc
(

942 
IN
 
PRTMP_ADAPTER
 
pAd
,

943 
IN
 
PSTRING
 
g
)

945 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==> Set_Debug_Proc *******************\n"));

947 if(
	`sime_
(
g
, 0, 10<
RT_DEBUG_LOUD
)

948 
RTDebugLev
 = 
	`sime_
(
g
, 0, 10);

950 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=S_Debug_Proc(RTDebugLev = %ld)\n", 
RTDebugLev
));

952  
TRUE
;

953 
	}
}

956 
INT
 
	$Show_DescInfo_Proc
(

957 
IN
 
PRTMP_ADAPTER
 
pAd
,

958 
IN
 
PSTRING
 
g
)

960 #ifde
RTMP_MAC_PCI


961 
INT
 
i
, 
QueIdx
=0;

963 
PRT28XX_RXD_STRUC
 
pRxD
;

964 
PTXD_STRUC
 
pTxD
;

965 
PRTMP_TX_RING
 
pTxRg
 = &
pAd
->
TxRg
[
QueIdx
];

966 
PRTMP_MGMT_RING
 
pMgmtRg
 = &
pAd
->
MgmtRg
;

967 
PRTMP_RX_RING
 
pRxRg
 = &
pAd
->
RxRg
;

969 
i
=0;i<
TX_RING_SIZE
;i++)

971 
pTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
i
].
AocVa
;

972 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Des#%d\n",
i
));

973 
	`hex_dump
("Tx Dest", (
PUCHAR
)
pTxD
, 16);

974 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("pTxD->DMADONE = %x\n", 
pTxD
->
DMADONE
));

976 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("---------------------------------------------------\n"));

977 
i
=0;i<
MGMT_RING_SIZE
;i++)

979 
pTxD
 = (
PTXD_STRUC

pMgmtRg
->
Cl
[
i
].
AocVa
;

980 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Des#%d\n",
i
));

981 
	`hex_dump
("MgmDest", (
PUCHAR
)
pTxD
, 16);

982 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("pMgmt->DMADONE = %x\n", 
pTxD
->
DMADONE
));

984 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("---------------------------------------------------\n"));

985 
i
=0;i<
RX_RING_SIZE
;i++)

987 
pRxD
 = (
PRT28XX_RXD_STRUC

pRxRg
->
Cl
[
i
].
AocVa
;

988 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Des#%d\n",
i
));

989 
	`hex_dump
("Rx Dest", (
PUCHAR
)
pRxD
, 16);

990 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("pRxD->DDONE = %x\n", 
pRxD
->
DDONE
));

994  
TRUE
;

995 
	}
}

1010 
INT
 
	$S_RetStCou_Proc
(

1011 
IN
 
PRTMP_ADAPTER
 
pAd
,

1012 
IN
 
PSTRING
 
g
)

1017 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==>Set_ResetStatCounter_Proc\n"));

1020 
	`NICUpdeRawCous
(
pAd
);

1022 
	`NdisZoMemy
(&
pAd
->
WnCous
, (
COUNTER_802_11
));

1023 
	`NdisZoMemy
(&
pAd
->
Cous8023
, (
COUNTER_802_3
));

1024 
	`NdisZoMemy
(&
pAd
->
RkCous
, (
COUNTER_RALINK
));

1030  
TRUE
;

1031 
	}
}

1054 
BOOLEAN
 
	$RTMPCheckSPrtAb
(

1055 
IN
 
CHAR
 *
pInPutS
,

1056 
IN
 
UCHAR
 
rL
)

1058 
UCHAR
 
i
=0;

1060 
i
=0; i<
rL
; i++)

1062 i((
pInPutS
[
i
] < 0x20) ||

1063 (
pInPutS
[
i
] > 0x7E))

1064  
FALSE
;

1067  
TRUE
;

1068 
	}
}

1089 #ifde
CONFIG_STA_SUPPORT


1090 
VOID
 
	$RTMPSDesedRes
(

1091 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1092 
IN
 
LONG
 
Res
)

1094 
NDIS_802_11_RATES
 
yRes
;

1096 
	`memt
(&
yRes
, 0x00, (
NDIS_802_11_RATES
));

1097 
pAdr
->
CommCfg
.
PhyMode
)

1099 
PHY_11A
:

1100 
Res
)

1103 
yRes
[0] = 0x0c;

1104 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_0
;

1107 
yRes
[0] = 0x12;

1108 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_1
;

1111 
yRes
[0] = 0x18;

1112 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_2
;

1115 
yRes
[0] = 0x24;

1116 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_3
;

1119 
yRes
[0] = 0x30;

1120 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_4
;

1123 
yRes
[0] = 0x48;

1124 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_5
;

1127 
yRes
[0] = 0x60;

1128 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_6
;

1131 
yRes
[0] = 0x6c;

1132 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_7
;

1136 
yRes
[0] = 0x6c;

1137 
yRes
[1] = 0x60;

1138 
yRes
[2] = 0x48;

1139 
yRes
[3] = 0x30;

1140 
yRes
[4] = 0x24;

1141 
yRes
[5] = 0x18;

1142 
yRes
[6] = 0x12;

1143 
yRes
[7] = 0x0c;

1144 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_AUTO
;

1148 
PHY_11BG_MIXED
:

1149 
PHY_11B
:

1150 
PHY_11ABG_MIXED
:

1152 
Res
)

1155 
yRes
[0] = 0x02;

1156 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_0
;

1159 
yRes
[0] = 0x04;

1160 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_1
;

1163 
yRes
[0] = 0x0b;

1164 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_2
;

1167 
yRes
[0] = 0x16;

1168 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_3
;

1171 
yRes
[0] = 0x0c;

1172 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_0
;

1175 
yRes
[0] = 0x12;

1176 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_1
;

1179 
yRes
[0] = 0x18;

1180 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_2
;

1183 
yRes
[0] = 0x24;

1184 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_3
;

1187 
yRes
[0] = 0x30;

1188 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_4
;

1191 
yRes
[0] = 0x48;

1192 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_5
;

1195 
yRes
[0] = 0x60;

1196 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_6
;

1199 
yRes
[0] = 0x6c;

1200 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_7
;

1204 i(
pAdr
->
CommCfg
.
PhyMode
 =
PHY_11B
)

1206 
yRes
[0] = 0x16;

1207 
yRes
[1] = 0x0b;

1208 
yRes
[2] = 0x04;

1209 
yRes
[3] = 0x02;

1213 
yRes
[0] = 0x6c;

1214 
yRes
[1] = 0x60;

1215 
yRes
[2] = 0x48;

1216 
yRes
[3] = 0x30;

1217 
yRes
[4] = 0x16;

1218 
yRes
[5] = 0x0b;

1219 
yRes
[6] = 0x04;

1220 
yRes
[7] = 0x02;

1222 
pAdr
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_AUTO
;

1228 
	`NdisZoMemy
(
pAdr
->
CommCfg
.
DeseRe
, 
MAX_LEN_OF_SUPPORTED_RATES
);

1229 
	`NdisMoveMemy
(
pAdr
->
CommCfg
.
DeseRe
, &
yRes
, (
NDIS_802_11_RATES
));

1230 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" RTMPSetDesiredRates (%02x,%02x,%02x,%02x,%02x,%02x,%02x,%02x)\n",

1231 
pAdr
->
CommCfg
.
DeseRe
[0],pAdapter->CommonCfg.DesireRate[1],

1232 
pAdr
->
CommCfg
.
DeseRe
[2],pAdapter->CommonCfg.DesireRate[3],

1233 
pAdr
->
CommCfg
.
DeseRe
[4],pAdapter->CommonCfg.DesireRate[5],

1234 
pAdr
->
CommCfg
.
DeseRe
[6],pAdapter->CommonCfg.DesireRate[7] ));

1236 
	`MlmeUpdeTxRes
(
pAdr
, 
FALSE
, 0);

1237 
	}
}

1239 
NDIS_STATUS
 
	$RTMPWPARemoveKeyProc
(

1240 
IN
 
PRTMP_ADAPTER
 
pAd
,

1241 
IN
 
PVOID
 
pBuf
)

1243 
PNDIS_802_11_REMOVE_KEY
 
pKey
;

1244 
ULONG
 
KeyIdx
;

1245 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_FAILURE
;

1246 
BOOLEAN
 
bTxKey
;

1247 
BOOLEAN
 
bPawi
;

1248 
BOOLEAN
 
bKeyRSC
;

1250 
BOOLEAN
 
bAuthtit
;

1251 
INT
 
i
;

1253 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("---> RTMPWPARemoveKeyProc\n"));

1255 
pKey
 = (
PNDIS_802_11_REMOVE_KEY

pBuf
;

1256 
KeyIdx
 = 
pKey
->
KeyIndex
 & 0xff;

1258 
bTxKey
 = (
pKey
->
KeyIndex
 & 0x80000000? 
TRUE
 : 
FALSE
;

1260 
bPawi
 = (
pKey
->
KeyIndex
 & 0x40000000? 
TRUE
 : 
FALSE
;

1262 
bKeyRSC
 = (
pKey
->
KeyIndex
 & 0x20000000? 
TRUE
 : 
FALSE
;

1264 
bAuthtit
 = (
pKey
->
KeyIndex
 & 0x10000000? 
TRUE
 : 
FALSE
;

1267 i(
bTxKey
 =
TRUE
)

1268 (
NDIS_STATUS_INVALID_DATA
);

1271 i(
bPawi
)

1275 
i
 = 0; i < 
SHARE_KEY_NUM
; i++)

1277 i(
	`MAC_ADDR_EQUAL
(
pAd
->
ShedKey
[
BSS0
][
i
].
BssId
, 
pKey
->
BSSID
))

1279 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RTMPWPARemoveKeyProc(KeyIdx=%d)\n", 
i
));

1280 
pAd
->
ShedKey
[
BSS0
][
i
].
KeyL
 = 0;

1281 
pAd
->
ShedKey
[
BSS0
][
i
].
ChAlg
 = 
CIPHER_NONE
;

1282 
	`AsicRemoveShedKeyEry
(
pAd
, 
BSS0
, (
UCHAR
)
i
);

1283 
Stus
 = 
NDIS_STATUS_SUCCESS
;

1293 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RTMPWPARemoveKeyProc(KeyIdx=%ld)\n", 
KeyIdx
));

1294 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
KeyL
 = 0;

1295 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
ChAlg
 = 
CIPHER_NONE
;

1296 
	`AsicRemoveShedKeyEry
(
pAd
, 
BSS0
, (
UCHAR
)
KeyIdx
);

1297 
Stus
 = 
NDIS_STATUS_SUCCESS
;

1300  (
Stus
);

1301 
	}
}

1305 #ifde
CONFIG_STA_SUPPORT


1324 
VOID
 
	$RTMPWPARemoveAKeys
(

1325 
IN
 
PRTMP_ADAPTER
 
pAd
)

1328 
UCHAR
 
i
;

1330 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RTMPWPARemoveAKeys(AuthMode=%d, WStus=%d)\n", 
pAd
->
SCfg
.
AuthMode
,Ad->SCfg.
WStus
));

1331 #ifde
PCIE_PS_SUPPORT


1332 
	`RTMP_CLEAR_PSFLAG
(
pAd
, 
fRTMP_PS_CAN_GO_SLEEP
);

1336 i(
pAd
->
SCfg
.
AuthMode
 < 
Ndis802_11AuthModeWPA
)

1341 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPANe
)

1345 
	`AsicRemovePawiKeyEry
(
pAd
, 
BSSID_WCID
);

1348 
i
 = 0; i < 
SHARE_KEY_NUM
; i++)

1350 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("mov%key #%d\n", 
ChName
[
pAd
->
ShedKey
[
BSS0
][
i
].
ChAlg
], i));

1351 
	`NdisZoMemy
(&
pAd
->
ShedKey
[
BSS0
][
i
], (
CIPHER_KEY
));

1353 
	`AsicRemoveShedKeyEry
(
pAd
, 
BSS0
, 
i
);

1355 #ifde
PCIE_PS_SUPPORT


1356 
	`RTMP_SET_PSFLAG
(
pAd
, 
fRTMP_PS_CAN_GO_SLEEP
);

1359 
	}
}

1401 
VOID
 
	$RTMPSPhyMode
(

1402 
IN
 
PRTMP_ADAPTER
 
pAd
,

1403 
IN
 
ULONG
 
phymode
)

1405 
INT
 
i
;

1408 
pAd
->
CommCfg
.
PhyMode
 = (
UCHAR
)
phymode
;

1410 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RTMPSPhyMod: PhyMode=%d, chl=%d \n", 
pAd
->
CommCfg
.
PhyMode
,Ad->CommCfg.
Chl
));

1411 #ifde
EXT_BUILD_CHANNEL_LIST


1412 
	`BudChlLiEx
(
pAd
);

1414 
	`BudChlLi
(
pAd
);

1418 
i
 = 0; i < 
pAd
->
ChlLiNum
; i++)

1420 i(
pAd
->
CommCfg
.
Chl
 =pAd->
ChlLi
[
i
].Channel)

1424 i(
i
 =
pAd
->
ChlLiNum
)

1426 #ifde
CONFIG_STA_SUPPORT


1427 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1428 
pAd
->
CommCfg
.
Chl
 = 
	`FChl
(pAd);

1430 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RTMPSPhyMode: chiouonge, u f chl=%d \n", 
pAd
->
CommCfg
.
Chl
));

1433 
	`NdisZoMemy
(
pAd
->
CommCfg
.
SupRe
, 
MAX_LEN_OF_SUPPORTED_RATES
);

1434 
	`NdisZoMemy
(
pAd
->
CommCfg
.
ExtRe
, 
MAX_LEN_OF_SUPPORTED_RATES
);

1435 
	`NdisZoMemy
(
pAd
->
CommCfg
.
DeseRe
, 
MAX_LEN_OF_SUPPORTED_RATES
);

1436 
phymode
) {

1437 
PHY_11B
:

1438 
pAd
->
CommCfg
.
SupRe
[0] = 0x82;

1439 
pAd
->
CommCfg
.
SupRe
[1] = 0x84;

1440 
pAd
->
CommCfg
.
SupRe
[2] = 0x8B;

1441 
pAd
->
CommCfg
.
SupRe
[3] = 0x96;

1442 
pAd
->
CommCfg
.
SupReL
 = 4;

1443 
pAd
->
CommCfg
.
ExtReL
 = 0;

1444 
pAd
->
CommCfg
.
DeseRe
[0] = 2;

1445 
pAd
->
CommCfg
.
DeseRe
[1] = 4;

1446 
pAd
->
CommCfg
.
DeseRe
[2] = 11;

1447 
pAd
->
CommCfg
.
DeseRe
[3] = 22;

1451 
PHY_11G
:

1452 
PHY_11BG_MIXED
:

1453 
PHY_11ABG_MIXED
:

1454 #ifde
DOT11_N_SUPPORT


1455 
PHY_11N_2_4G
:

1456 
PHY_11ABGN_MIXED
:

1457 
PHY_11BGN_MIXED
:

1458 
PHY_11GN_MIXED
:

1460 
pAd
->
CommCfg
.
SupRe
[0] = 0x82;

1461 
pAd
->
CommCfg
.
SupRe
[1] = 0x84;

1462 
pAd
->
CommCfg
.
SupRe
[2] = 0x8B;

1463 
pAd
->
CommCfg
.
SupRe
[3] = 0x96;

1464 
pAd
->
CommCfg
.
SupRe
[4] = 0x12;

1465 
pAd
->
CommCfg
.
SupRe
[5] = 0x24;

1466 
pAd
->
CommCfg
.
SupRe
[6] = 0x48;

1467 
pAd
->
CommCfg
.
SupRe
[7] = 0x6c;

1468 
pAd
->
CommCfg
.
SupReL
 = 8;

1469 
pAd
->
CommCfg
.
ExtRe
[0] = 0x0C;

1470 
pAd
->
CommCfg
.
ExtRe
[1] = 0x18;

1471 
pAd
->
CommCfg
.
ExtRe
[2] = 0x30;

1472 
pAd
->
CommCfg
.
ExtRe
[3] = 0x60;

1473 
pAd
->
CommCfg
.
ExtReL
 = 4;

1474 
pAd
->
CommCfg
.
DeseRe
[0] = 2;

1475 
pAd
->
CommCfg
.
DeseRe
[1] = 4;

1476 
pAd
->
CommCfg
.
DeseRe
[2] = 11;

1477 
pAd
->
CommCfg
.
DeseRe
[3] = 22;

1478 
pAd
->
CommCfg
.
DeseRe
[4] = 12;

1479 
pAd
->
CommCfg
.
DeseRe
[5] = 18;

1480 
pAd
->
CommCfg
.
DeseRe
[6] = 24;

1481 
pAd
->
CommCfg
.
DeseRe
[7] = 36;

1482 
pAd
->
CommCfg
.
DeseRe
[8] = 48;

1483 
pAd
->
CommCfg
.
DeseRe
[9] = 72;

1484 
pAd
->
CommCfg
.
DeseRe
[10] = 96;

1485 
pAd
->
CommCfg
.
DeseRe
[11] = 108;

1488 
PHY_11A
:

1489 #ifde
DOT11_N_SUPPORT


1490 
PHY_11AN_MIXED
:

1491 
PHY_11AGN_MIXED
:

1492 
PHY_11N_5G
:

1494 
pAd
->
CommCfg
.
SupRe
[0] = 0x8C;

1495 
pAd
->
CommCfg
.
SupRe
[1] = 0x12;

1496 
pAd
->
CommCfg
.
SupRe
[2] = 0x98;

1497 
pAd
->
CommCfg
.
SupRe
[3] = 0x24;

1498 
pAd
->
CommCfg
.
SupRe
[4] = 0xb0;

1499 
pAd
->
CommCfg
.
SupRe
[5] = 0x48;

1500 
pAd
->
CommCfg
.
SupRe
[6] = 0x60;

1501 
pAd
->
CommCfg
.
SupRe
[7] = 0x6c;

1502 
pAd
->
CommCfg
.
SupReL
 = 8;

1503 
pAd
->
CommCfg
.
ExtReL
 = 0;

1504 
pAd
->
CommCfg
.
DeseRe
[0] = 12;

1505 
pAd
->
CommCfg
.
DeseRe
[1] = 18;

1506 
pAd
->
CommCfg
.
DeseRe
[2] = 24;

1507 
pAd
->
CommCfg
.
DeseRe
[3] = 36;

1508 
pAd
->
CommCfg
.
DeseRe
[4] = 48;

1509 
pAd
->
CommCfg
.
DeseRe
[5] = 72;

1510 
pAd
->
CommCfg
.
DeseRe
[6] = 96;

1511 
pAd
->
CommCfg
.
DeseRe
[7] = 108;

1520 
pAd
->
CommCfg
.
BdS
 = 
UNKNOWN_BAND
;

1521 
	}
}

1524 #ifde
DOT11_N_SUPPORT


1537 
VOID
 
	$RTMPSHT
(

1538 
IN
 
PRTMP_ADAPTER
 
pAd
,

1539 
IN
 
OID_SET_HT_PHYMODE
 *
pHTPhyMode
)

1542 
UINT32
 
Vue
 = 0;

1543 
UCHAR
 
BBPVue
 = 0;

1544 
UCHAR
 
BBP3Vue
 = 0;

1545 
UCHAR
 
RxSm
 = 
pAd
->
CommCfg
.RxStream;

1548 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPSetHT : HT_mode(%d), ExtOffset(%d), MCS(%d), BW(%d), STBC(%d), SHORTGI(%d)\n",

1549 
pHTPhyMode
->
HtMode
,HTPhyMode->
ExtOfft
,

1550 
pHTPhyMode
->
MCS
,HTPhyMode->
BW
,

1551 
pHTPhyMode
->
STBC
,HTPhyMode->
SHORTGI
));

1554 
	`RTMPZoMemy
(&
pAd
->
CommCfg
.
HtCaby
, (pAd->CommonCfg.HtCapability));

1555 
	`RTMPZoMemy
(&
pAd
->
CommCfg
.
AddHTInfo
, (pAd->CommonCfg.AddHTInfo));

1556 
	`RTMPZoMemy
(&
pAd
->
CommCfg
.
NewExtChOfft
, (pAd->CommonCfg.NewExtChanOffset));

1557 
	`RTMPZoMemy
(&
pAd
->
CommCfg
.
DesedHtPhy
, (pAd->CommonCfg.DesiredHtPhy));

1559 i(
pAd
->
CommCfg
.
bRdg
)

1561 
pAd
->
CommCfg
.
HtCaby
.
ExtHtCInfo
.
PlusHTC
 = 1;

1562 
pAd
->
CommCfg
.
HtCaby
.
ExtHtCInfo
.
RDGSut
 = 1;

1566 
pAd
->
CommCfg
.
HtCaby
.
ExtHtCInfo
.
PlusHTC
 = 0;

1567 
pAd
->
CommCfg
.
HtCaby
.
ExtHtCInfo
.
RDGSut
 = 0;

1570 
pAd
->
CommCfg
.
HtCaby
.
HtCPm
.
MaxRAmpduFa
 = 3;

1571 
pAd
->
CommCfg
.
DesedHtPhy
.
MaxRAmpduFa
 = 3;

1573 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPSHT : RxBAWLim = %d\n", 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
));

1576 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduEb
 = (
USHORT
Ad->CommCfg.
BACaby
.
fld
.AmsduEnable;

1577 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduSize
 = (
UCHAR
Ad->CommCfg.
BACaby
.
fld
.AmsduSize;

1578 
pAd
->
CommCfg
.
DesedHtPhy
.
MimoPs
 = (
UCHAR
Ad->CommCfg.
BACaby
.
fld
.
MMPSmode
;

1579 
pAd
->
CommCfg
.
DesedHtPhy
.
MpduDsy
 = (
UCHAR
Ad->CommCfg.
BACaby
.
fld
.MpduDensity;

1581 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
AMsduSize
 = (
USHORT
Ad->CommCfg.
BACaby
.
fld
.
AmsduSize
;

1582 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
MimoPs
 = (
USHORT
Ad->CommCfg.
BACaby
.
fld
.
MMPSmode
;

1583 
pAd
->
CommCfg
.
HtCaby
.
HtCPm
.
MpduDsy
 = (
UCHAR
Ad->CommCfg.
BACaby
.
fld
.MpduDensity;

1585 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPSetHT : AMsduSize = %d, MimoPs = %d, MpduDensity = %d, MaxRAmpduFactor = %d\n",

1586 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduSize
,

1587 
pAd
->
CommCfg
.
DesedHtPhy
.
MimoPs
,

1588 
pAd
->
CommCfg
.
DesedHtPhy
.
MpduDsy
,

1589 
pAd
->
CommCfg
.
DesedHtPhy
.
MaxRAmpduFa
));

1591 if(
pHTPhyMode
->
HtMode
 =
HTMODE_GF
)

1593 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
GF
 = 1;

1594 
pAd
->
CommCfg
.
DesedHtPhy
.
GF
 = 1;

1597 
pAd
->
CommCfg
.
DesedHtPhy
.
GF
 = 0;

1600 
RxSm
)

1603 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[0] = 0xff;

1604 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[1] = 0x00;

1608 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[0] = 0xff;

1609 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[1] = 0xff;

1613 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[0] = 0xff;

1614 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[1] = 0xff;

1615 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[2] = 0xff;

1619 i(
pAd
->
CommCfg
.
bFty_Mhz_Iޔt
 && (
pHTPhyMode
->
BW
 =
BW_40
) )

1621 
pHTPhyMode
->
BW
 = 
BW_20
;

1622 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
Fty_Mhz_Iޔt
 = 1;

1625 if(
pHTPhyMode
->
BW
 =
BW_40
)

1627 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[4] = 0x1;

1628 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
 = 1;

1629 i(
pAd
->
CommCfg
.
Chl
 <= 14)

1630 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
CCKmode40
 = 1;

1632 
pAd
->
CommCfg
.
DesedHtPhy
.
ChlWidth
 = 1;

1633 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
RecomWidth
 = 1;

1634 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
ExtChOfft
 = (
pHTPhyMode
->
ExtOfft
 =
EXTCHA_BELOW
)? (EXTCHA_BELOW): 
EXTCHA_ABOVE
;

1636 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Vue
);

1637 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BBP3Vue
);

1638 i((
pHTPhyMode
->
ExtOfft
 =
EXTCHA_BELOW
))

1640 
Vue
 |= 0x1;

1641 
BBP3Vue
 |= (0x20);

1642 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

1644 i((
pHTPhyMode
->
ExtOfft
 =
EXTCHA_ABOVE
))

1646 
Vue
 &= 0xfe;

1647 
BBP3Vue
 &= (~0x20);

1648 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

1653 i((
pAd
->
OpMode
 =
OPMODE_AP
|| 
	`INFRA_ON
Ad|| 
	`ADHOC_ON
(pAd)

1656 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BBPVue
);

1657 
BBPVue
 &= (~0x18);

1658 
BBPVue
 |= 0x10;

1659 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BBPVue
);

1661 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BBP3Vue
);

1662 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_40
;

1669 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
 = 0;

1670 
pAd
->
CommCfg
.
DesedHtPhy
.
ChlWidth
 = 0;

1671 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
RecomWidth
 = 0;

1672 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
ExtChOfft
 = 
EXTCHA_NONE
;

1673 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
;

1676 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BBPVue
);

1677 
BBPVue
 &= (~0x18);

1678 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BBPVue
);

1679 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_20
;

1684 if(
pHTPhyMode
->
STBC
 =
STBC_USE
)

1688 i(
pAd
->
A
.
fld
.
TxPh
 >= 2)

1690 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
TxSTBC
 = 1;

1691 
pAd
->
CommCfg
.
DesedHtPhy
.
TxSTBC
 = 1;

1695 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
TxSTBC
 = 0;

1696 
pAd
->
CommCfg
.
DesedHtPhy
.
TxSTBC
 = 0;

1702 i(
pAd
->
A
.
fld
.
RxPh
 >= 1)

1704 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
RxSTBC
 = 1;

1705 
pAd
->
CommCfg
.
DesedHtPhy
.
RxSTBC
 = 1;

1709 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
RxSTBC
 = 0;

1710 
pAd
->
CommCfg
.
DesedHtPhy
.
RxSTBC
 = 0;

1715 
pAd
->
CommCfg
.
DesedHtPhy
.
TxSTBC
 = 0;

1716 
pAd
->
CommCfg
.
DesedHtPhy
.
RxSTBC
 = 0;

1719 if(
pHTPhyMode
->
SHORTGI
 =
GI_400
)

1721 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ShtGIf20
 = 1;

1722 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ShtGIf40
 = 1;

1723 
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf20
 = 1;

1724 
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf40
 = 1;

1728 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ShtGIf20
 = 0;

1729 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ShtGIf40
 = 0;

1730 
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf20
 = 0;

1731 
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf40
 = 0;

1736 
pAd
->
CommCfg
.
AddHTInfo
.
CڌCh
 =Ad->CommCfg.
Chl
;

1740 i(
pAd
->
CommCfg
.
APEdPm
.
bVid
 =
FALSE
)

1742 
pAd
->
CommCfg
.
APEdPm
.
bVid
 = 
TRUE
;

1743 
pAd
->
CommCfg
.
APEdPm
.
Aif
[0] = 3;

1744 
pAd
->
CommCfg
.
APEdPm
.
Aif
[1] = 7;

1745 
pAd
->
CommCfg
.
APEdPm
.
Aif
[2] = 1;

1746 
pAd
->
CommCfg
.
APEdPm
.
Aif
[3] = 1;

1748 
pAd
->
CommCfg
.
APEdPm
.
Cwm
[0] = 4;

1749 
pAd
->
CommCfg
.
APEdPm
.
Cwm
[1] = 4;

1750 
pAd
->
CommCfg
.
APEdPm
.
Cwm
[2] = 3;

1751 
pAd
->
CommCfg
.
APEdPm
.
Cwm
[3] = 2;

1753 
pAd
->
CommCfg
.
APEdPm
.
Cwmax
[0] = 6;

1754 
pAd
->
CommCfg
.
APEdPm
.
Cwmax
[1] = 10;

1755 
pAd
->
CommCfg
.
APEdPm
.
Cwmax
[2] = 4;

1756 
pAd
->
CommCfg
.
APEdPm
.
Cwmax
[3] = 3;

1758 
pAd
->
CommCfg
.
APEdPm
.
Tx
[0] = 0;

1759 
pAd
->
CommCfg
.
APEdPm
.
Tx
[1] = 0;

1760 
pAd
->
CommCfg
.
APEdPm
.
Tx
[2] = 94;

1761 
pAd
->
CommCfg
.
APEdPm
.
Tx
[3] = 47;

1763 
	`AsicSEdPm
(
pAd
, &pAd->
CommCfg
.
APEdPm
);

1767 #ifde
CONFIG_STA_SUPPORT


1768 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1770 
	`RTMPSIndividuHT
(
pAd
, 0);

1774 
	}
}

1788 
VOID
 
	$RTMPSIndividuHT
(

1789 
IN
 
PRTMP_ADAPTER
 
pAd
,

1790 
IN
 
UCHAR
 
idx
)

1792 
PRT_HT_PHY_INFO
 
pDesed_ht_phy
 = 
NULL
;

1793 
UCHAR
 
TxSm
 = 
pAd
->
CommCfg
.TxStream;

1794 
UCHAR
 
DesedMcs
 = 
MCS_AUTO
;

1795 
UCHAR
 
y_mode
 = 
Ndis802_11EnyiDibd
;

1800 #ifde
CONFIG_STA_SUPPORT


1801 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1803 
pDesed_ht_phy
 = &
pAd
->
SCfg
.
DesedHtPhyInfo
;

1804 
DesedMcs
 = 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
;

1805 
y_mode
 = 
pAd
->
SCfg
.
WStus
;

1810 } 
FALSE
);

1812 i(
pDesed_ht_phy
 =
NULL
)

1814 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RTMPSIndividuHT: invidpidx(%d)\n", 
idx
));

1817 
	`RTMPZoMemy
(
pDesed_ht_phy
, (
RT_HT_PHY_INFO
));

1819 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPSIndividuHT : Desed MCS = %d\n", 
DesedMcs
));

1821 i((
TxSm
 =1&& ((
DesedMcs
 >
MCS_8
&& (DesedMc<
MCS_15
)))

1823 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("RTMPSIndividuHT: MCS(%divid i1S,eMCS_7\n", 
DesedMcs
));

1824 
DesedMcs
 = 
MCS_7
;

1827 i((
pAd
->
CommCfg
.
DesedHtPhy
.
ChlWidth
 =
BW_20
&& (
DesedMcs
 =
MCS_32
))

1829 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("RTMPSetIndividualHT: MCS_32 is only supported in 40-MHz,eset its MCS_0\n"));

1830 
DesedMcs
 = 
MCS_0
;

1833 #ifde
CONFIG_STA_SUPPORT


1834 i((
pAd
->
OpMode
 =
OPMODE_STA
&& (pAd->
SCfg
.
BssTy
 =
BSS_INFRA
&& (
idx
 =
MIN_NET_DEVICE_FOR_MBSSID
))

1842 i(
pAd
->
CommCfg
.
HT_DiowTKIP
 && 
	`IS_INVALID_HT_SECURITY
(
y_mode
))

1844 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("%s : Useegacyate in WEP/TKIPncryption mode (apidx=%d)\n",

1845 
__FUNCTION__
, 
idx
));

1849 i(
pAd
->
CommCfg
.
HT_Dib
)

1851 #ifde
CONFIG_STA_SUPPORT


1852 
pAd
->
SCfg
.
bAdhocN
 = 
FALSE
;

1854 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%: HT idibd\n", 
__FUNCTION__
));

1858 
pDesed_ht_phy
->
bHtEb
 = 
TRUE
;

1861 
TxSm
)

1864 i(
DesedMcs
 =
MCS_AUTO
)

1866 
pDesed_ht_phy
->
MCSS
[0]= 0xff;

1867 
pDesed_ht_phy
->
MCSS
[1]= 0x00;

1869 i(
DesedMcs
 <
MCS_7
)

1871 
pDesed_ht_phy
->
MCSS
[0]1<<
DesedMcs
;

1872 
pDesed_ht_phy
->
MCSS
[1]= 0x00;

1877 i(
DesedMcs
 =
MCS_AUTO
)

1879 
pDesed_ht_phy
->
MCSS
[0]= 0xff;

1880 
pDesed_ht_phy
->
MCSS
[1]= 0xff;

1882 i(
DesedMcs
 <
MCS_15
)

1884 
ULONG
 
mode
;

1886 
mode
 = 
DesedMcs
 / 8;

1887 i(
mode
 < 2)

1888 
pDesed_ht_phy
->
MCSS
[
mode
] = (1 << (
DesedMcs
 - mode * 8));

1893 i(
DesedMcs
 =
MCS_AUTO
)

1896 
pDesed_ht_phy
->
MCSS
[0]= 0xff;

1897 
pDesed_ht_phy
->
MCSS
[1]= 0xff;

1898 
pDesed_ht_phy
->
MCSS
[2]= 0xff;

1900 i(
DesedMcs
 <
MCS_23
)

1902 
ULONG
 
mode
;

1904 
mode
 = 
DesedMcs
 / 8;

1905 i(
mode
 < 3)

1906 
pDesed_ht_phy
->
MCSS
[
mode
] = (1 << (
DesedMcs
 - mode * 8));

1911 if(
pAd
->
CommCfg
.
DesedHtPhy
.
ChlWidth
 =
BW_40
)

1913 i(
DesedMcs
 =
MCS_AUTO
 || DesedMc=
MCS_32
)

1914 
pDesed_ht_phy
->
MCSS
[4] = 0x1;

1918 i(
pAd
->
OpMode
 =
OPMODE_STA
)

1919 
	`MlmeUpdeHtTxRes
(
pAd
, 
BSS0
);

1921 
	`MlmeUpdeHtTxRes
(
pAd
, 
idx
);

1922 
	}
}

1933 
VOID
 
	$RTMPDibDesedHtInfo
(

1934 
IN
 
PRTMP_ADAPTER
 
pAd
)

1938 #ifde
CONFIG_STA_SUPPORT


1939 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1941 
	`RTMPZoMemy
(&
pAd
->
SCfg
.
DesedHtPhyInfo
, (
RT_HT_PHY_INFO
));

1945 
	}
}

1948 
INT
 
	$SCommHT
(

1949 
IN
 
PRTMP_ADAPTER
 
pAd
)

1951 
OID_SET_HT_PHYMODE
 
SHT
;

1953 i(
pAd
->
CommCfg
.
PhyMode
 < 
PHY_11ABGN_MIXED
)

1956 
	`RTMPDibDesedHtInfo
(
pAd
);

1957  
FALSE
;

1960 
SHT
.
PhyMode
 = (
RT_802_11_PHY_MODE
)
pAd
->
CommCfg
.PhyMode;

1961 
SHT
.
TnsmNo
 = ((
UCHAR
)
pAd
->
A
.
fld
.
TxPh
);

1962 
SHT
.
HtMode
 = (
UCHAR
)
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
HTMODE
;

1963 
SHT
.
ExtOfft
 = (
UCHAR
)
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
;

1964 
SHT
.
MCS
 = 
MCS_AUTO
;

1965 
SHT
.
BW
 = (
UCHAR
)
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.BW;

1966 
SHT
.
STBC
 = (
UCHAR
)
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.STBC;

1967 
SHT
.
SHORTGI
 = (
UCHAR
)
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
ShtGI
;

1969 
	`RTMPSHT
(
pAd
, &
SHT
);

1971  
TRUE
;

1972 
	}
}

1985 
VOID
 
	$RTMPUpdeHTIE
(

1986 
IN
 
RT_HT_CAPABILITY
 *
pRtHt
,

1987 
IN
 
UCHAR
 *
pMcsS
,

1988 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
,

1989 
OUT
 
ADD_HT_INFO_IE
 *
pAddHtInfo
)

1991 
	`RTMPZoMemy
(
pHtCaby
, (
HT_CAPABILITY_IE
));

1992 
	`RTMPZoMemy
(
pAddHtInfo
, (
ADD_HT_INFO_IE
));

1994 
pHtCaby
->
HtCInfo
.
ChlWidth
 = 
pRtHt
->ChannelWidth;

1995 
pHtCaby
->
HtCInfo
.
MimoPs
 = 
pRtHt
->MimoPs;

1996 
pHtCaby
->
HtCInfo
.
GF
 = 
pRtHt
->GF;

1997 
pHtCaby
->
HtCInfo
.
ShtGIf20
 = 
pRtHt
->ShortGIfor20;

1998 
pHtCaby
->
HtCInfo
.
ShtGIf40
 = 
pRtHt
->ShortGIfor40;

1999 
pHtCaby
->
HtCInfo
.
TxSTBC
 = 
pRtHt
->TxSTBC;

2000 
pHtCaby
->
HtCInfo
.
RxSTBC
 = 
pRtHt
->RxSTBC;

2001 
pHtCaby
->
HtCInfo
.
AMsduSize
 = 
pRtHt
->
AmsduSize
;

2002 
pHtCaby
->
HtCPm
.
MaxRAmpduFa
 = 
pRtHt
->MaxRAmpduFactor;

2003 
pHtCaby
->
HtCPm
.
MpduDsy
 = 
pRtHt
->MpduDensity;

2005 
pAddHtInfo
->
AddHtInfo
.
ExtChOfft
 = 
pRtHt
->ExtChanOffset ;

2006 
pAddHtInfo
->
AddHtInfo
.
RecomWidth
 = 
pRtHt
->RecomWidth;

2007 
pAddHtInfo
->
AddHtInfo2
.
OiMode
 = 
pRtHt
->OperaionMode;

2008 
pAddHtInfo
->
AddHtInfo2
.
NGfP
 = 
pRtHt
->NonGfPresent;

2009 
	`RTMPMoveMemy
(
pAddHtInfo
->
MCSS
, 
pMcsS
, 4);

2011 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RTMPUpdateHTIE <== \n"));

2012 
	}
}

2022 
VOID
 
	$RTMPAddWcidAribuEry
(

2023 
IN
 
PRTMP_ADAPTER
 
pAd
,

2024 
IN
 
UCHAR
 
BssIdx
,

2025 
IN
 
UCHAR
 
KeyIdx
,

2026 
IN
 
UCHAR
 
ChAlg
,

2027 
IN
 
MAC_TABLE_ENTRY
 *
pEry
)

2029 
UINT32
 
WCIDAri
 = 0;

2030 
USHORT
 
offt
;

2031 
UCHAR
 
IVEIV
 = 0;

2032 
USHORT
 
Wcid
 = 0;

2035 #ifde
CONFIG_STA_SUPPORT


2036 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2038 i(
BssIdx
 > 
BSS0
)

2040 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RTMPAddWcidAribuEry: ThBSS-dex(%diouongf Inlk. \n", 
BssIdx
));

2047 i(
pEry
)

2048 
Wcid
 = 
pEry
->
Aid
;

2050 
Wcid
 = 
MCAST_WCID
;

2056 
offt
 = 
MAC_WCID_ATTRIBUTE_BASE
 + (
Wcid
 * 
HW_WCID_ATTRI_SIZE
);

2058 #ifde
CONFIG_STA_SUPPORT


2059 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2061 i(
pEry
 && 
	`IS_ENTRY_MESH
(pEntry))

2062 
WCIDAri
 = (
ChAlg
<<1| 
PAIRWISEKEYTABLE
;

2063 #i
	`defed
(
DOT11Z_TDLS_SUPPORT
|| defed(
QOS_DLS_SUPPORT
)

2064 i((
pEry
&& (
	`IS_ENTRY_DLS
Ery|| 
	`IS_ENTRY_TDLS
(pEntry)) &&

2065 ((
ChAlg
 =
CIPHER_TKIP
) ||

2066 (
ChAlg
 =
CIPHER_AES
) ||

2067 (
ChAlg
 =
CIPHER_NONE
)))

2068 
WCIDAri
 = (
ChAlg
<<1| 
PAIRWISEKEYTABLE
;

2071 
WCIDAri
 = (
ChAlg
<<1| 
SHAREDKEYTABLE
;

2075 
	`RTMP_IO_WRITE32
(
pAd
, 
offt
, 
WCIDAri
);

2079 
offt
 = 
MAC_IVEIV_TABLE_BASE
 + (
Wcid
 * 
HW_IVEIV_ENTRY_SIZE
);

2082 i((
ChAlg
 =
CIPHER_TKIP
|| (ChAlg =
CIPHER_AES
))

2085 
IVEIV
 = (
KeyIdx
 <<6) | 0x20;

2090 
IVEIV
 = (
KeyIdx
 << 6);

2094 #ifde
RTMP_MAC_PCI


2095 
	`RTMP_IO_WRITE8
(
pAd
, 
offt
+3, 
IVEIV
);

2098 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RTMPAddWcidAribuEry: WCID #%d, KeyIndex #%d, Alg=%s\n",
Wcid
, 
KeyIdx
, 
ChName
[
ChAlg
]));

2099 
	`DBGPRINT
(
RT_DEBUG_TRACE
,(" WCIDAr0x%x \n", 
WCIDAri
));

2101 
	}
}

2117 
PSTRING
 
	$GEnyTy
(
CHAR
 
c
)

2119 if(
c
 =
Ndis802_11WEPDibd
)

2121 if(
c
 =
Ndis802_11WEPEbd
)

2123 if(
c
 =
Ndis802_11Enyi2Ebd
)

2125 if(
c
 =
Ndis802_11Enyi3Ebd
)

2127 if(
c
 =
Ndis802_11Enyi4Ebd
)

2131 
	}
}

2133 
PSTRING
 
	$GAuthMode
(
CHAR
 
auth
)

2135 if(
auth
 =
Ndis802_11AuthModeOn
)

2137 if(
auth
 =
Ndis802_11AuthModeShed
)

2139 if(
auth
 =
Ndis802_11AuthModeAutoSwch
)

2141 if(
auth
 =
Ndis802_11AuthModeWPA
)

2143 if(
auth
 =
Ndis802_11AuthModeWPAPSK
)

2145 if(
auth
 =
Ndis802_11AuthModeWPANe
)

2147 if(
auth
 =
Ndis802_11AuthModeWPA2
)

2149 if(
auth
 =
Ndis802_11AuthModeWPA2PSK
)

2151 if(
auth
 =
Ndis802_11AuthModeWPA1WPA2
)

2153 if(
auth
 =
Ndis802_11AuthModeWPA1PSKWPA2PSK
)

2157 
	}
}

2178 
	#LINE_LEN
 (4+33+20+23+9+7+7+3)

2179 #ifde
CONFIG_STA_SUPPORT


	)

2181 
VOID
 
	$RTMPCommSeSurveyDa
(

2182 
IN
 
PSTRING
 
msg
,

2183 
IN
 
PBSS_ENTRY
 
pBss
)

2185 
INT
 
Rssi
 = 0;

2186 
UINT
 
Rssi_Quy
 = 0;

2187 
NDIS_802_11_NETWORK_TYPE
 
wess_mode
;

2188 
CHAR
 
Ssid
[
MAX_LEN_OF_SSID
 +1];

2189 
STRING
 
SecuryS
[32] = {0};

2190 
NDIS_802_11_ENCRYPTION_STATUS
 
_ch
 = 
Ndis802_11EnyiDibd
;

2191 
NDIS_802_11_AUTHENTICATION_MODE
 
_auth_mode
 = 
Ndis802_11AuthModeOn
;

2194 
	`rtf
(
msg
+
	`
(msg),"%-4d", 
pBss
->
Chl
);

2197 
	`NdisZoMemy
(
Ssid
, (
MAX_LEN_OF_SSID
 +1));

2198 i(
	`RTMPCheckSPrtAb
((
PCHAR
)
pBss
->
Ssid
,Bss->
SsidL
))

2199 
	`NdisMoveMemy
(
Ssid
, 
pBss
->Ssid,Bss->
SsidL
);

2202 
INT
 
idx
 = 0;

2203 
	`rtf
(
Ssid
, "0x");

2204 
idx
 = 0; (idx < 14&& (idx < 
pBss
->
SsidL
); idx++)

2205 
	`rtf
(
Ssid
 + 2 + (
idx
*2), "%02X", (
UCHAR
)
pBss
->Ssid[idx]);

2207 
	`rtf
(
msg
+
	`
(msg),"%-33s", 
Ssid
);

2210 
	`rtf
(
msg
+
	`
(msg),"%02x:%02x:%02x:%02x:%02x:%02x ",

2211 
pBss
->
Bssid
[0],

2212 
pBss
->
Bssid
[1],

2213 
pBss
->
Bssid
[2],

2214 
pBss
->
Bssid
[3],

2215 
pBss
->
Bssid
[4],

2216 
pBss
->
Bssid
[5]);

2219 i((
Ndis802_11AuthModeWPA
 <
pBss
->
AuthMode
) &&

2220 (
pBss
->
AuthMode
 <
Ndis802_11AuthModeWPA1PSKWPA2PSK
))

2222 i(
pBss
->
AuthMode
 =
Ndis802_11AuthModeWPANe
)

2224 
_auth_mode
 = 
pBss
->
AuthMode
;

2225 
_ch
 = 
pBss
->
WPA
.
PaCh
;

2227 i(
pBss
->
AuthModeAux
 =
Ndis802_11AuthModeOn
)

2229 
_auth_mode
 = 
pBss
->
AuthMode
;

2230 i((
_auth_mode
 =
Ndis802_11AuthModeWPA
) ||

2231 (
_auth_mode
 =
Ndis802_11AuthModeWPAPSK
))

2233 i(
pBss
->
WPA
.
PaChAux
 =
Ndis802_11WEPDibd
)

2234 
_ch
 = 
pBss
->
WPA
.
PaCh
;

2236 
_ch
 = 
Ndis802_11Enyi4Ebd
;

2238 i((
_auth_mode
 =
Ndis802_11AuthModeWPA2
) ||

2239 (
_auth_mode
 =
Ndis802_11AuthModeWPA2PSK
))

2241 i(
pBss
->
WPA2
.
PaChAux
 =
Ndis802_11WEPDibd
)

2242 
_ch
 = 
pBss
->
WPA2
.
PaCh
;

2244 
_ch
 = 
Ndis802_11Enyi4Ebd
;

2247 i((
pBss
->
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

2248 (
pBss
->
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
))

2250 i((
pBss
->
AuthModeAux
 =
Ndis802_11AuthModeWPAPSK
) ||

2251 (
pBss
->
AuthModeAux
 =
Ndis802_11AuthModeWPA2PSK
))

2252 
_auth_mode
 = 
Ndis802_11AuthModeWPA1PSKWPA2PSK
;

2254 
_auth_mode
 = 
pBss
->
AuthMode
;

2256 i(
pBss
->
WPA
.
PaCh
 !pBss->
WPA2
.PairCipher)

2257 
_ch
 = 
Ndis802_11Enyi4Ebd
;

2258 i((
pBss
->
WPA
.
PaCh
 =pBss->
WPA2
.PairCipher) &&

2259 (
pBss
->
WPA
.
PaChAux
 !pBss->
WPA2
.PairCipherAux))

2260 
_ch
 = 
Ndis802_11Enyi4Ebd
;

2261 i((
pBss
->
WPA
.
PaCh
 =pBss->
WPA2
.PairCipher) &&

2262 (
pBss
->
WPA
.
PaChAux
 =pBss->
WPA2
.PairCipherAux) &&

2263 (
pBss
->
WPA
.
PaChAux
 !
Ndis802_11WEPDibd
))

2264 
_ch
 = 
Ndis802_11Enyi4Ebd
;

2265 i((
pBss
->
WPA
.
PaCh
 =pBss->
WPA2
.PairCipher) &&

2266 (
pBss
->
WPA
.
PaChAux
 =pBss->
WPA2
.PairCipherAux) &&

2267 (
pBss
->
WPA
.
PaChAux
 =
Ndis802_11WEPDibd
))

2268 
_ch
 = 
pBss
->
WPA
.
PaCh
;

2270 i((
pBss
->
AuthMode
 =
Ndis802_11AuthModeWPA
) ||

2271 (
pBss
->
AuthMode
 =
Ndis802_11AuthModeWPA2
))

2273 i((
pBss
->
AuthModeAux
 =
Ndis802_11AuthModeWPA
) ||

2274 (
pBss
->
AuthMode
 =
Ndis802_11AuthModeWPA2
))

2275 
_auth_mode
 = 
Ndis802_11AuthModeWPA1WPA2
;

2277 
_auth_mode
 = 
pBss
->
AuthMode
;

2279 i(
pBss
->
WPA
.
PaCh
 !pBss->
WPA2
.PairCipher)

2280 
_ch
 = 
Ndis802_11Enyi4Ebd
;

2281 i((
pBss
->
WPA
.
PaCh
 =pBss->
WPA2
.PairCipher) &&

2282 (
pBss
->
WPA
.
PaChAux
 !pBss->
WPA2
.PairCipherAux))

2283 
_ch
 = 
Ndis802_11Enyi4Ebd
;

2284 i((
pBss
->
WPA
.
PaCh
 =pBss->
WPA2
.PairCipher) &&

2285 (
pBss
->
WPA
.
PaChAux
 =pBss->
WPA2
.PairCipherAux) &&

2286 (
pBss
->
WPA
.
PaChAux
 !
Ndis802_11WEPDibd
))

2287 
_ch
 = 
Ndis802_11Enyi4Ebd
;

2288 i((
pBss
->
WPA
.
PaCh
 =pBss->
WPA2
.PairCipher) &&

2289 (
pBss
->
WPA
.
PaChAux
 =pBss->
WPA2
.PairCipherAux) &&

2290 (
pBss
->
WPA
.
PaChAux
 =
Ndis802_11WEPDibd
))

2291 
_ch
 = 
pBss
->
WPA
.
PaCh
;

2294 
	`rtf
(
SecuryS
, "%s/%s", 
	`GAuthMode
((
CHAR
)
_auth_mode
), 
	`GEnyTy
((CHAR)
_ch
));

2298 
_auth_mode
 = 
pBss
->
AuthMode
;

2299 
_ch
 = 
pBss
->
WStus
;

2300 i(
_ch
 =
Ndis802_11WEPDibd
)

2301 
	`rtf
(
SecuryS
, "NONE");

2302 i(
_ch
 =
Ndis802_11WEPEbd
)

2303 
	`rtf
(
SecuryS
, "WEP");

2305 
	`rtf
(
SecuryS
, "%s/%s", 
	`GAuthMode
((
CHAR
)
_auth_mode
), 
	`GEnyTy
((CHAR)
_ch
));

2308 
	`rtf
(
msg
+
	`
(msg), "%-23s", 
SecuryS
);

2311 
Rssi
 = (
INT
)
pBss
->Rssi;

2313 i(
Rssi
 >= -50)

2314 
Rssi_Quy
 = 100;

2315 i(
Rssi
 >= -80)

2316 
Rssi_Quy
 = (
UINT
)(24 + ((
Rssi
 + 80) * 26)/10);

2317 i(
Rssi
 >= -90)

2318 
Rssi_Quy
 = (
UINT
)(((
Rssi
 + 90) * 26)/10);

2320 
Rssi_Quy
 = 0;

2321 
	`rtf
(
msg
+
	`
(msg),"%-9d", 
Rssi_Quy
);

2323 
wess_mode
 = 
	`NwkTyInUSy
(
pBss
);

2324 i(
wess_mode
 =
Ndis802_11FH
 ||

2325 
wess_mode
 =
Ndis802_11DS
)

2326 
	`rtf
(
msg
+
	`
(msg),"%-7s", "11b");

2327 i(
wess_mode
 =
Ndis802_11OFDM5
)

2328 
	`rtf
(
msg
+
	`
(msg),"%-7s", "11a");

2329 i(
wess_mode
 =
Ndis802_11OFDM5_N
)

2330 
	`rtf
(
msg
+
	`
(msg),"%-7s", "11a/n");

2331 i(
wess_mode
 =
Ndis802_11OFDM24
)

2332 
	`rtf
(
msg
+
	`
(msg),"%-7s", "11b/g");

2333 i(
wess_mode
 =
Ndis802_11OFDM24_N
)

2334 
	`rtf
(
msg
+
	`
(msg),"%-7s", "11b/g/n");

2336 
	`rtf
(
msg
+
	`
(msg),"%-7s", "unknow");

2339 i(
pBss
->
AddHtInfoL
 > 0)

2341 i(
pBss
->
AddHtInfo
.AddHtInfo.
ExtChOfft
 =
EXTCHA_ABOVE
)

2342 
	`rtf
(
msg
+
	`
(msg),"%-7s", " ABOVE");

2343 i(
pBss
->
AddHtInfo
.AddHtInfo.
ExtChOfft
 =
EXTCHA_BELOW
)

2344 
	`rtf
(
msg
+
	`
(msg),"%-7s", " BELOW");

2346 
	`rtf
(
msg
+
	`
(msg),"%-7s", " NONE");

2350 
	`rtf
(
msg
+
	`
(msg),"%-7s", " NONE");

2354 i(
pBss
->
BssTy
 =
BSS_ADHOC
)

2355 
	`rtf
(
msg
+
	`
(msg),"%-3s", " Ad");

2357 
	`rtf
(
msg
+
	`
(msg),"%-3s", " In");

2359 
	`rtf
(
msg
+
	`
(msg),"\n");

2362 
	}
}

2364 #i
defed
 (
AP_SCAN_SUPPORT
|| defed (
CONFIG_STA_SUPPORT
)

2365 
VOID
 
	$RTMPIolGSeSurvey
(

2366 
IN
 
PRTMP_ADAPTER
 
pAdr
,

2367 
IN
 
iwq
 *
wrq
)

2369 
PSTRING
 
msg
;

2370 
INT
 
i
=0;

2371 
INT
 
WaC
;

2372 
INT
 
Stus
=0;

2373 
INT
 
max_n
 = 
LINE_LEN
;

2374 
PBSS_ENTRY
 
pBss
;

2376 #ifde
CONFIG_STA_SUPPORT


2379 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
msg
, (
CHAR
)*((
MAX_LEN_OF_BSS_TABLE
)*
max_n
));

2381 i(
msg
 =
NULL
)

2383 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPIoctlGetSiteSurvey - msg memorylloc fail.\n"));

2387 
	`memt
(
msg
, 0 ,(
MAX_LEN_OF_BSS_TABLE
)*
max_n
 );

2388 
	`rtf
(
msg
,"%s","\n");

2389 
	`rtf
(
msg
+
	`
(msg),"%-4s%-33s%-20s%-23s%-9s%-7s%-7s%-3s\n",

2393 #ifde
CONFIG_STA_SUPPORT


2396 
WaC
 = 0;

2397 #ifde
CONFIG_STA_SUPPORT


2398 
pAdr
->
SCfg
.
bSnReqIsFromWebUI
 = 
TRUE
;

2400 (
	`SnRug
(
pAdr
=
TRUE
&& (
WaC
++ < 200))

2401 
	`OS_WAIT
(500);

2403 
i
=0; i<
pAdr
->
SnTab
.
BssNr
 ;i++)

2405 
pBss
 = &
pAdr
->
SnTab
.
BssEry
[
i
];

2407 if
pBss
->
Chl
==0)

2410 if((
	`
(
msg
)+
max_n
 ) >
IW_SCAN_MAX_DATA
)

2414 
	`RTMPCommSeSurveyDa
(
msg
, 
pBss
);

2417 #ifde
CONFIG_STA_SUPPORT


2421 #ifde
CONFIG_STA_SUPPORT


2422 
pAdr
->
SCfg
.
bSnReqIsFromWebUI
 = 
FALSE
;

2424 
wrq
->
u
.
da
.
ngth
 = 
	`
(
msg
);

2425 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
msg
, wrq->u.da.
ngth
);

2427 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPIolGSeSurvey - wrq->u.da.ngth = %d\n", 
wrq
->
u
.
da
.
ngth
));

2428 
	`os__mem
(
NULL
, (
PUCHAR
)
msg
);

2429 
	}
}

2435 
	#MAC_LINE_LEN
 (14+4+4+10+10+10+6+6)

2436 
VOID
 
	`RTMPIolGMacTab
(

	)

2437 
IN
 
PRTMP_ADAPTER
 
	gpAd
,

2438 
IN
 
iwq
 *
	gwrq
)

2440 
INT
 
	gi
;

2441 
RT_802_11_MAC_TABLE
 
	gMacTab
;

2442 *
	gmsg
;

2444 
	gMacTab
.
	gNum
 = 0;

2445 
	gi
=0; i<
	gMAX_LEN_OF_MAC_TABLE
; i++)

2447 i(
IS_ENTRY_CLIENT
(&
pAd
->
MacTab
.
Cڋ
[
i
]&& (
	gpAd
->
	gMacTab
.
	gCڋ
[i].
	gS
 =
SST_ASSOC
))

2449 
MacTab
.
Ery
[MacTab.
Num
].
ApIdx
 = (
UCHAR
)
pAd
->MacTab.
Cڋ
[
i
].
idx
;

2450 
COPY_MAC_ADDR
(
MacTab
.
Ery
[MacTab.
Num
].
Addr
, &
pAd
->MacTab.
Cڋ
[
i
].Addr);

2451 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gAid
 = (
UCHAR
)
pAd
->MacTab.
Cڋ
[
i
].
Aid
;

2452 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gPsm
 = 
pAd
->MacTab.
Cڋ
[
i
].
PsMode
;

2453 #ifde
DOT11_N_SUPPORT


2454 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gMimoPs
 = 
pAd
->MacTab.
Cڋ
[
i
].
MmpsMode
;

2458 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gAvgRssi0
 = 
pAd
->MacTab.
Cڋ
[
i
].
RssiSame
.
AvgRssi0
;

2459 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gAvgRssi1
 = 
pAd
->MacTab.
Cڋ
[
i
].
RssiSame
.
AvgRssi1
;

2460 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gAvgRssi2
 = 
pAd
->MacTab.
Cڋ
[
i
].
RssiSame
.
AvgRssi2
;

2463 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gCedTime
 = 
pAd
->MacTab.
Cڋ
[
i
].
SCTime
;

2464 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gTxRe
.
	gfld
.
	gMCS
 = 
pAd
->MacTab.
Cڋ
[
i
].
HTPhyMode
.
fld
.
MCS
;

2465 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gTxRe
.
	gfld
.
	gBW
 = 
pAd
->MacTab.
Cڋ
[
i
].
HTPhyMode
.
fld
.
BW
;

2466 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gTxRe
.
	gfld
.
	gShtGI
 = 
pAd
->MacTab.
Cڋ
[
i
].
HTPhyMode
.
fld
.
ShtGI
;

2467 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gTxRe
.
	gfld
.
	gSTBC
 = 
pAd
->MacTab.
Cڋ
[
i
].
HTPhyMode
.
fld
.
STBC
;

2468 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gTxRe
.
	gfld
.
	grsv
 = 
pAd
->MacTab.
Cڋ
[
i
].
HTPhyMode
.
fld
.
rsv
;

2469 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gTxRe
.
	gfld
.
	gMODE
 = 
pAd
->MacTab.
Cڋ
[
i
].
HTPhyMode
.
fld
.
MODE
;

2470 
	gMacTab
.
	gEry
[
MacTab
.
Num
].
	gTxRe
.
	gwd
 = 
pAd
->MacTab.
Cڋ
[
i
].
HTPhyMode
.
wd
;

2473 
	gMacTab
.
	gNum
 += 1;

2477 
	gwrq
->
	gu
.
	gda
.
	gngth
 = (
RT_802_11_MAC_TABLE
);

2478 i(
cy_to_ur
(
wrq
->
u
.
da
.
por
, &
MacTab
, wrq->u.da.
ngth
))

2480 
DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: cy_to_ur(\n", 
__FUNCTION__
));

2484 
	gmsg
 = 
kmloc
((
CHAR
)*(
MAX_LEN_OF_MAC_TABLE
*
MAC_LINE_LEN
), 
MEM_ALLOC_FLAG
);

2485 i(
	gmsg
 =
NULL
)

2487 
DBGPRINT
(
RT_DEBUG_ERROR
, ("%s():Aomemy faed\n", 
__FUNCTION__
));

2490 
memt
(
msg
, 0 ,
MAX_LEN_OF_MAC_TABLE
*
MAC_LINE_LEN
 );

2491 
rtf
(
msg
,"%s","\n");

2492 
rtf
(
msg
+

(msg),"%-14s%-4s%-4s%-4s%-4s%-6s%-6s%-10s%-10s%-10s\n",

2495 
	gi
=0; i<
	gMAX_LEN_OF_MAC_TABLE
; i++)

2497 
PMAC_TABLE_ENTRY
 
	gpEry
 = &
pAd
->
MacTab
.
Cڋ
[
i
];

2498 i(
IS_ENTRY_CLIENT
(
pEry
&& (
	gpEry
->
	gS
 =
SST_ASSOC
))

2500 if((

(
msg
)+
MAC_LINE_LEN
 ) >(
MAX_LEN_OF_MAC_TABLE
*MAC_LINE_LEN) )

2502 
rtf
(
msg
+

(msg),"%02x%02x%02x%02x%02x%02x ",

2503 
pEry
->
Addr
[0],Entry->Addr[1],Entry->Addr[2],

2504 
pEry
->
Addr
[3],Entry->Addr[4],Entry->Addr[5]);

2505 
rtf
(
msg
+

(msg),"%-4d", ()
pEry
->
idx
);

2506 
rtf
(
msg
+

(msg),"%-4d", ()
pEry
->
Aid
);

2507 
rtf
(
msg
+

(msg),"%-4d", ()
pEry
->
PsMode
);

2508 
rtf
(
msg
+

(msg),"%-4d", ()
pEry
->
AuthS
);

2509 
rtf
(
msg
+

(msg),"%-6d",
ReIdToMbps
[
pAd
->
MacTab
.
Cڋ
[
i
].
CuTxRe
]);

2510 
rtf
(
msg
+

(msg),"%-6d",0 );

2511 
rtf
(
msg
+

(msg),"%-10d",0 );

2512 
rtf
(
msg
+

(msg),"%-10d",0 );

2513 
rtf
(
msg
+

(msg),"%-10d\n",0 );

2519 
DBGPRINT
(
RT_DEBUG_TRACE
, ("%s", 
msg
));

2520 
k
(
msg
);

2523 #ifde
INF_AR9


2524 #ifde
AR9_MAPI_SUPPORT


2528 #ifde
DOT11_N_SUPPORT


2529 
INT
 
	$S_BASup_Proc
(

2530 
IN
 
PRTMP_ADAPTER
 
pAd
,

2531 
IN
 
PSTRING
 
g
)

2533 
UCHAR
 
mac
[6], 
tid
;

2534 
PSTRING
 
tok
;

2535 
STRING
 
pVue
[] = ":", 
DASH
 = '-';

2536 
INT
 
i
;

2537 
MAC_TABLE_ENTRY
 *
pEry
;

2546 if(
	`
(
g
) < 19)

2547  
FALSE
;

2549 
tok
 = 
	`rchr
(
g
, 
DASH
);

2550 i((
tok
 !
NULL
&& (
	`
(token)>1))

2552 
tid
 = (
UCHAR

	`sime_
((
tok
+1), 0, 10);

2554 i(
tid
 > (
NUM_OF_TID
-1))

2555  
FALSE
;

2557 *
tok
 = '\0';

2558 
i
 = 0, 
tok
 = 
	`rok
(
g
, &
pVue
[0]);ok;ok =ok(
NULL
, &sepValue[0]), i++)

2560 if((
	`
(
tok
!2|| (!
	`isxdig
(*token)) || (!isxdigit(*(token+1))))

2561  
FALSE
;

2562 
	`AtoH
(
tok
, (&
mac
[
i
]), 1);

2564 if(
i
 != 6)

2565  
FALSE
;

2567 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n%02x:%02x:%02x:%02x:%02x:%02x-%02x\n",

2568 
mac
[0], mac[1], mac[2], mac[3], mac[4], mac[5], 
tid
));

2570 
pEry
 = 
	`MacTabLookup
(
pAd
, (
PUCHAR

mac
);

2572 i(
pEry
) {

2573 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\nSuBA Sessi: Tid = %d\n", 
tid
));

2574 
	`BAOriSessiSUp
(
pAd
, 
pEry
, 
tid
, 0, 100, 
TRUE
);

2577  
TRUE
;

2580  
FALSE
;

2582 
	}
}

2584 
INT
 
	$S_BADee_Proc
(

2585 
IN
 
PRTMP_ADAPTER
 
pAd
,

2586 
IN
 
PSTRING
 
g
)

2588 
ULONG
 
bBADee
;

2590 
bBADee
 = 
	`sime_
(
g
, 0, 10);

2592 i(
bBADee
 == 0)

2594 
pAd
->
CommCfg
.
bBADee
 = 
FALSE
;

2596 i(
bBADee
 == 1)

2598 
pAd
->
CommCfg
.
bBADee
 = 
TRUE
;

2602  
FALSE
;

2605 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_BADee_Proc::(BADee=%d)\n", 
pAd
->
CommCfg
.
bBADee
));

2607  
TRUE
;

2608 
	}
}

2610 
INT
 
	$S_BAOriTrDown_Proc
(

2611 
IN
 
PRTMP_ADAPTER
 
pAd
,

2612 
IN
 
PSTRING
 
g
)

2614 
UCHAR
 
mac
[6], 
tid
;

2615 
PSTRING
 
tok
;

2616 
STRING
 
pVue
[] = ":", 
DASH
 = '-';

2617 
INT
 
i
;

2618 
MAC_TABLE_ENTRY
 *
pEry
;

2626 if(
	`
(
g
) < 19)

2627  
FALSE
;

2629 
tok
 = 
	`rchr
(
g
, 
DASH
);

2630 i((
tok
 !
NULL
&& (
	`
(token)>1))

2632 
tid
 = 
	`sime_
((
tok
+1), 0, 10);

2634 i(
tid
 > (
NUM_OF_TID
-1))

2635  
FALSE
;

2637 *
tok
 = '\0';

2638 
i
 = 0, 
tok
 = 
	`rok
(
g
, &
pVue
[0]);ok;ok =ok(
NULL
, &sepValue[0]), i++)

2640 if((
	`
(
tok
!2|| (!
	`isxdig
(*token)) || (!isxdigit(*(token+1))))

2641  
FALSE
;

2642 
	`AtoH
(
tok
, (&
mac
[
i
]), 1);

2644 if(
i
 != 6)

2645  
FALSE
;

2647 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n%02x:%02x:%02x:%02x:%02x:%02x-%02x",

2648 
mac
[0], mac[1], mac[2], mac[3], mac[4], mac[5], 
tid
));

2650 
pEry
 = 
	`MacTabLookup
(
pAd
, (
PUCHAR

mac
);

2652 i(
pEry
) {

2653 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\nTdowOrBA Sessi: Tid = %d\n", 
tid
));

2654 
	`BAOriSessiTrDown
(
pAd
, 
pEry
->
Aid
, 
tid
, 
FALSE
, 
TRUE
);

2657  
TRUE
;

2660  
FALSE
;

2662 
	}
}

2664 
INT
 
	$S_BARecTrDown_Proc
(

2665 
IN
 
PRTMP_ADAPTER
 
pAd
,

2666 
IN
 
PSTRING
 
g
)

2668 
UCHAR
 
mac
[6], 
tid
;

2669 
PSTRING
 
tok
;

2670 
STRING
 
pVue
[] = ":", 
DASH
 = '-';

2671 
INT
 
i
;

2672 
MAC_TABLE_ENTRY
 *
pEry
;

2680 if(
	`
(
g
) < 19)

2681  
FALSE
;

2683 
tok
 = 
	`rchr
(
g
, 
DASH
);

2684 i((
tok
 !
NULL
&& (
	`
(token)>1))

2686 
tid
 = 
	`sime_
((
tok
+1), 0, 10);

2688 i(
tid
 > (
NUM_OF_TID
-1))

2689  
FALSE
;

2691 *
tok
 = '\0';

2692 
i
 = 0, 
tok
 = 
	`rok
(
g
, &
pVue
[0]);ok;ok =ok(
NULL
, &sepValue[0]), i++)

2694 if((
	`
(
tok
!2|| (!
	`isxdig
(*token)) || (!isxdigit(*(token+1))))

2695  
FALSE
;

2696 
	`AtoH
(
tok
, (&
mac
[
i
]), 1);

2698 if(
i
 != 6)

2699  
FALSE
;

2701 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n%02x:%02x:%02x:%02x:%02x:%02x-%02x",

2702 
mac
[0], mac[1], mac[2], mac[3], mac[4], mac[5], 
tid
));

2704 
pEry
 = 
	`MacTabLookup
(
pAd
, (
PUCHAR

mac
);

2706 i(
pEry
) {

2707 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\nTdowReBA Sessi: Tid = %d\n", 
tid
));

2708 
	`BARecSessiTrDown
(
pAd
, 
pEry
->
Aid
, 
tid
, 
FALSE
);

2711  
TRUE
;

2714  
FALSE
;

2716 
	}
}

2718 
INT
 
	$S_HtBw_Proc
(

2719 
IN
 
PRTMP_ADAPTER
 
pAd
,

2720 
IN
 
PSTRING
 
g
)

2722 
ULONG
 
HtBw
;

2724 
HtBw
 = 
	`sime_
(
g
, 0, 10);

2725 i(
HtBw
 =
BW_40
)

2726 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 = 
BW_40
;

2727 i(
HtBw
 =
BW_20
)

2728 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 = 
BW_20
;

2730  
FALSE
;

2732 
	`SCommHT
(
pAd
);

2734 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtBw_Proc::(HtBw=%d)\n", 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
));

2736  
TRUE
;

2737 
	}
}

2739 
INT
 
	$S_HtMcs_Proc
(

2740 
IN
 
PRTMP_ADAPTER
 
pAd
,

2741 
IN
 
PSTRING
 
g
)

2743 
ULONG
 
HtMcs
, 
Mcs_tmp
, 
VidMcs
 = 15;

2744 #ifde
CONFIG_STA_SUPPORT


2745 
BOOLEAN
 
bAutoRe
 = 
FALSE
;

2749 
Mcs_tmp
 = 
	`sime_
(
g
, 0, 10);

2751 i(
Mcs_tmp
 <
VidMcs
 || Mcs_tmp == 32)

2752 
HtMcs
 = 
Mcs_tmp
;

2754 
HtMcs
 = 
MCS_AUTO
;

2756 #ifde
CONFIG_STA_SUPPORT


2757 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2759 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
HtMcs
;

2760 
pAd
->
SCfg
.
bAutoTxReSwch
 = (
HtMcs
 =
MCS_AUTO
? 
TRUE
:
FALSE
;

2761 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set_HtMcs_Proc::(HtMcs=%d, bAutoTxRateSwitch = %d)\n",

2762 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
,Ad->SCfg.
bAutoTxReSwch
));

2764 i((
pAd
->
CommCfg
.
PhyMode
 < 
PHY_11ABGN_MIXED
) ||

2765 (
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
MODE
 < 
MODE_HTMIX
))

2767 i((
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 !
MCS_AUTO
) &&

2768 (
HtMcs
 <= 3) &&

2769 (
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
 =
FIXED_TXMODE_CCK
))

2771 
	`RTMPSDesedRes
(
pAd
, (
LONG
(
ReIdToMbps
[
HtMcs
] * 1000000));

2773 i((
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 !
MCS_AUTO
) &&

2774 (
HtMcs
 <= 7) &&

2775 (
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
 =
FIXED_TXMODE_OFDM
))

2777 
	`RTMPSDesedRes
(
pAd
, (
LONG
(
ReIdToMbps
[
HtMcs
+4] * 1000000));

2780 
bAutoRe
 = 
TRUE
;

2782 i(
bAutoRe
)

2784 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_AUTO
;

2785 
	`RTMPSDesedRes
(
pAd
, -1);

2787 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtMcs_Proc::(FixedTxMode=%d)\n",
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
));

2789 i(
	`ADHOC_ON
(
pAd
))

2790  
TRUE
;

2794 
	`SCommHT
(
pAd
);

2796  
TRUE
;

2797 
	}
}

2799 
INT
 
	$S_HtGi_Proc
(

2800 
IN
 
PRTMP_ADAPTER
 
pAd
,

2801 
IN
 
PSTRING
 
g
)

2803 
ULONG
 
HtGi
;

2805 
HtGi
 = 
	`sime_
(
g
, 0, 10);

2807 i
HtGi
 =
GI_400
)

2808 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
ShtGI
 = 
GI_400
;

2809 i
HtGi
 =
GI_800
 )

2810 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
ShtGI
 = 
GI_800
;

2812  
FALSE
;

2814 
	`SCommHT
(
pAd
);

2816 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtGi_Proc::(ShtGI=%d)\n",
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
ShtGI
));

2818  
TRUE
;

2819 
	}
}

2822 
INT
 
	$S_HtTxBASize_Proc
(

2823 
IN
 
PRTMP_ADAPTER
 
pAd
,

2824 
IN
 
PSTRING
 
g
)

2826 
UCHAR
 
Size
;

2828 
Size
 = 
	`sime_
(
g
, 0, 10);

2830 i(
Size
 <=0 || Size >=64)

2832 
Size
 = 8;

2834 
pAd
->
CommCfg
.
TxBASize
 = 
Size
-1;

2835 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("S_HtTxBASiz::(TxBASize%d)\n", 
Size
));

2837  
TRUE
;

2838 
	}
}

2840 
INT
 
	$S_HtDiowTKIP_Proc
(

2841 
IN
 
PRTMP_ADAPTER
 
pAd
,

2842 
IN
 
PSTRING
 
g
)

2844 
ULONG
 
Vue
;

2846 
Vue
 = 
	`sime_
(
g
, 0, 10);

2848 i(
Vue
 == 1)

2850 
pAd
->
CommCfg
.
HT_DiowTKIP
 = 
TRUE
;

2854 
pAd
->
CommCfg
.
HT_DiowTKIP
 = 
FALSE
;

2857 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set_HtDisallowTKIP_Proc ::%s\n",

2858 (
pAd
->
CommCfg
.
HT_DiowTKIP
 =
TRUE
) ? "enabled" : "disabled"));

2860  
TRUE
;

2861 
	}
}

2863 
INT
 
	$S_HtOpMode_Proc
(

2864 
IN
 
PRTMP_ADAPTER
 
pAd
,

2865 
IN
 
PSTRING
 
g
)

2868 
ULONG
 
Vue
;

2870 
Vue
 = 
	`sime_
(
g
, 0, 10);

2872 i(
Vue
 =
HTMODE_GF
)

2873 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
HTMODE
 = 
HTMODE_GF
;

2874 i
Vue
 =
HTMODE_MM
 )

2875 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
HTMODE
 = 
HTMODE_MM
;

2877  
FALSE
;

2879 
	`SCommHT
(
pAd
);

2881 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtOpMode_Proc::(HtOpMode=%d)\n",
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
HTMODE
));

2883  
TRUE
;

2885 
	}
}

2887 
INT
 
	$S_HtStbc_Proc
(

2888 
IN
 
PRTMP_ADAPTER
 
pAd
,

2889 
IN
 
PSTRING
 
g
)

2892 
ULONG
 
Vue
;

2894 
Vue
 = 
	`sime_
(
g
, 0, 10);

2896 i(
Vue
 =
STBC_USE
)

2897 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
STBC
 = 
STBC_USE
;

2898 i
Vue
 =
STBC_NONE
 )

2899 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
STBC
 = 
STBC_NONE
;

2901  
FALSE
;

2903 
	`SCommHT
(
pAd
);

2905 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Stbc_Proc::(HtStbc=%d)\n",
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
STBC
));

2907  
TRUE
;

2908 
	}
}

2910 
INT
 
	$S_HtHtc_Proc
(

2911 
IN
 
PRTMP_ADAPTER
 
pAd
,

2912 
IN
 
PSTRING
 
g
)

2915 
ULONG
 
Vue
;

2917 
Vue
 = 
	`sime_
(
g
, 0, 10);

2918 i(
Vue
 == 0)

2919 
pAd
->
HTCEb
 = 
FALSE
;

2920 i
Vue
 ==1 )

2921 
pAd
->
HTCEb
 = 
TRUE
;

2923  
FALSE
;

2925 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtHtc_Proc::(HtHtc=%d)\n",
pAd
->
HTCEb
));

2927  
TRUE
;

2928 
	}
}

2930 
INT
 
	$S_HtExtcha_Proc
(

2931 
IN
 
PRTMP_ADAPTER
 
pAd
,

2932 
IN
 
PSTRING
 
g
)

2935 
ULONG
 
Vue
;

2937 
Vue
 = 
	`sime_
(
g
, 0, 10);

2939 i(
Vue
 == 0)

2940 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 = 
EXTCHA_BELOW
;

2941 i
Vue
 ==1 )

2942 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 = 
EXTCHA_ABOVE
;

2944  
FALSE
;

2946 
	`SCommHT
(
pAd
);

2948 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtExtcha_Proc::(HtExtcha=%d)\n",
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
));

2950  
TRUE
;

2951 
	}
}

2953 
INT
 
	$S_HtMpduDsy_Proc
(

2954 
IN
 
PRTMP_ADAPTER
 
pAd
,

2955 
IN
 
PSTRING
 
g
)

2957 
ULONG
 
Vue
;

2959 
Vue
 = 
	`sime_
(
g
, 0, 10);

2961 i(
Vue
 <=7)

2962 
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
 = 
Vue
;

2964 
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
 = 4;

2966 
	`SCommHT
(
pAd
);

2968 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtMpduDsy_Proc::(HtMpduDsy=%d)\n",
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
));

2970  
TRUE
;

2971 
	}
}

2973 
INT
 
	$S_HtBaWSize_Proc
(

2974 
IN
 
PRTMP_ADAPTER
 
pAd
,

2975 
IN
 
PSTRING
 
g
)

2977 
ULONG
 
Vue
;

2979 
Vue
 = 
	`sime_
(
g
, 0, 10);

2982 i(
Vue
 >=1 && Value <= 64)

2984 
pAd
->
CommCfg
.
REGBACaby
.
fld
.
RxBAWLim
 = 
Vue
;

2985 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
 = 
Vue
;

2989 
pAd
->
CommCfg
.
REGBACaby
.
fld
.
RxBAWLim
 = 64;

2990 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
 = 64;

2993 
	`SCommHT
(
pAd
);

2995 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtBaWSize_Proc::(HtBaWSize=%d)\n",
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
));

2997  
TRUE
;

2998 
	}
}

3000 
INT
 
	$S_HtRdg_Proc
(

3001 
IN
 
PRTMP_ADAPTER
 
pAd
,

3002 
IN
 
PSTRING
 
g
)

3004 
ULONG
 
Vue
;

3006 
Vue
 = 
	`sime_
(
g
, 0, 10);

3008 i(
Vue
 == 0)

3009 
pAd
->
CommCfg
.
bRdg
 = 
FALSE
;

3010 i
Vue
 ==1 )

3012 
pAd
->
HTCEb
 = 
TRUE
;

3013 
pAd
->
CommCfg
.
bRdg
 = 
TRUE
;

3016  
FALSE
;

3018 
	`SCommHT
(
pAd
);

3020 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtRdg_Proc::(HtRdg=%d)\n",
pAd
->
CommCfg
.
bRdg
));

3022  
TRUE
;

3023 
	}
}

3025 
INT
 
	$S_HtLkAdt_Proc
(

3026 
IN
 
PRTMP_ADAPTER
 
pAd
,

3027 
IN
 
PSTRING
 
g
)

3029 
ULONG
 
Vue
;

3031 
Vue
 = 
	`sime_
(
g
, 0, 10);

3032 i(
Vue
 == 0)

3033 
pAd
->
bLkAdt
 = 
FALSE
;

3034 i
Vue
 ==1 )

3036 
pAd
->
HTCEb
 = 
TRUE
;

3037 
pAd
->
bLkAdt
 = 
TRUE
;

3040  
FALSE
;

3042 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtLkAdt_Proc::(HtLkAdt=%d)\n",
pAd
->
bLkAdt
));

3044  
TRUE
;

3045 
	}
}

3047 
INT
 
	$S_HtAmsdu_Proc
(

3048 
IN
 
PRTMP_ADAPTER
 
pAd
,

3049 
IN
 
PSTRING
 
g
)

3051 
ULONG
 
Vue
;

3053 
Vue
 = 
	`sime_
(
g
, 0, 10);

3054 i(
Vue
 == 0)

3055 
pAd
->
CommCfg
.
BACaby
.
fld
.
AmsduEb
 = 
FALSE
;

3056 i
Vue
 == 1 )

3057 
pAd
->
CommCfg
.
BACaby
.
fld
.
AmsduEb
 = 
TRUE
;

3059  
FALSE
;

3061 
	`SCommHT
(
pAd
);

3063 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtAmsdu_Proc::(HtAmsdu=%d)\n",
pAd
->
CommCfg
.
BACaby
.
fld
.
AmsduEb
));

3065  
TRUE
;

3066 
	}
}

3068 
INT
 
	$S_HtAutoBa_Proc
(

3069 
IN
 
PRTMP_ADAPTER
 
pAd
,

3070 
IN
 
PSTRING
 
g
)

3072 
ULONG
 
Vue
;

3074 
Vue
 = 
	`sime_
(
g
, 0, 10);

3075 i(
Vue
 == 0)

3077 
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 = 
FALSE
;

3078 
pAd
->
CommCfg
.
BACaby
.
fld
.
Picy
 = 
BA_NOTUSE
;

3080 i(
Vue
 == 1)

3082 
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 = 
TRUE
;

3083 
pAd
->
CommCfg
.
BACaby
.
fld
.
Picy
 = 
IMMED_BA
;

3086  
FALSE
;

3088 
pAd
->
CommCfg
.
REGBACaby
.
fld
.
AutoBA
 =Ad->CommCfg.
BACaby
.field.AutoBA;

3089 
pAd
->
CommCfg
.
REGBACaby
.
fld
.
Picy
 =Ad->CommCfg.
BACaby
.field.Policy;

3090 
	`SCommHT
(
pAd
);

3092 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtAutoBa_Proc::(HtAutoBa=%d)\n",
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
));

3094  
TRUE
;

3096 
	}
}

3098 
INT
 
	$S_HtPre_Proc
(

3099 
IN
 
PRTMP_ADAPTER
 
pAd
,

3100 
IN
 
PSTRING
 
g
)

3102 
ULONG
 
Vue
;

3104 
Vue
 = 
	`sime_
(
g
, 0, 10);

3105 i(
Vue
 == 0)

3106 
pAd
->
CommCfg
.
bHTPre
 = 
FALSE
;

3107 i(
Vue
 == 1)

3108 
pAd
->
CommCfg
.
bHTPre
 = 
TRUE
;

3110  
FALSE
;

3112 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtPre_Proc::(HtPre=%d)\n",
pAd
->
CommCfg
.
bHTPre
));

3114  
TRUE
;

3115 
	}
}

3117 
INT
 
	$S_SdPSMPAi_Proc
(

3118 
IN
 
PRTMP_ADAPTER
 
pAd
,

3119 
IN
 
PSTRING
 
g
)

3121 
UCHAR
 
mac
[6], 
mode
;

3122 
PSTRING
 
tok
;

3123 
STRING
 
pVue
[] = ":", 
DASH
 = '-';

3124 
INT
 
i
;

3125 
MAC_TABLE_ENTRY
 *
pEry
;

3133 if(
	`
(
g
) < 19)

3134  
FALSE
;

3136 
tok
 = 
	`rchr
(
g
, 
DASH
);

3137 i((
tok
 !
NULL
&& (
	`
(token)>1))

3139 
mode
 = 
	`sime_
((
tok
+1), 0, 10);

3140 i(
mode
 > 
MMPS_ENABLE
)

3141  
FALSE
;

3143 *
tok
 = '\0';

3144 
i
 = 0, 
tok
 = 
	`rok
(
g
, &
pVue
[0]);ok;ok =ok(
NULL
, &sepValue[0]), i++)

3146 if((
	`
(
tok
!2|| (!
	`isxdig
(*token)) || (!isxdigit(*(token+1))))

3147  
FALSE
;

3148 
	`AtoH
(
tok
, (&
mac
[
i
]), 1);

3150 if(
i
 != 6)

3151  
FALSE
;

3153 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n%02x:%02x:%02x:%02x:%02x:%02x-%02x",

3154 
mac
[0], mac[1], mac[2], mac[3], mac[4], mac[5], 
mode
));

3156 
pEry
 = 
	`MacTabLookup
(
pAd
, 
mac
);

3158 i(
pEry
) {

3159 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\nSdPSMPAi MIPS mod%d\n", 
mode
));

3160 
	`SdPSMPAi
(
pAd
, 
pEry
->
Aid
, 
mode
);

3163  
TRUE
;

3166  
FALSE
;

3169 
	}
}

3171 
INT
 
	$S_HtMIMOPSmode_Proc
(

3172 
IN
 
PRTMP_ADAPTER
 
pAd
,

3173 
IN
 
PSTRING
 
g
)

3175 
ULONG
 
Vue
;

3177 
Vue
 = 
	`sime_
(
g
, 0, 10);

3179 i(
Vue
 <=3)

3180 
pAd
->
CommCfg
.
BACaby
.
fld
.
MMPSmode
 = 
Vue
;

3182 
pAd
->
CommCfg
.
BACaby
.
fld
.
MMPSmode
 = 3;

3184 
	`SCommHT
(
pAd
);

3186 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtMIMOPSmode_Proc::(MIMOPS mode=%d)\n",
pAd
->
CommCfg
.
BACaby
.
fld
.
MMPSmode
));

3188  
TRUE
;

3189 
	}
}

3192 
INT
 
	$S_FShtGI_Proc
(

3193 
IN
 
PRTMP_ADAPTER
 
pAd
,

3194 
IN
 
PSTRING
 
g
)

3196 
ULONG
 
Vue
;

3198 
Vue
 = 
	`sime_
(
g
, 0, 10);

3199 i(
Vue
 == 0)

3200 
pAd
->
WIFIbed
.
bShtGI
 = 
FALSE
;

3201 i(
Vue
 == 1)

3202 
pAd
->
WIFIbed
.
bShtGI
 = 
TRUE
;

3204  
FALSE
;

3206 
	`SCommHT
(
pAd
);

3208 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_FShtGI_Proc::(FShtGI=%d)\n", 
pAd
->
WIFIbed
.
bShtGI
));

3210  
TRUE
;

3211 
	}
}

3215 
INT
 
	$S_FGF_Proc
(

3216 
IN
 
PRTMP_ADAPTER
 
pAd
,

3217 
IN
 
PSTRING
 
g
)

3219 
ULONG
 
Vue
;

3221 
Vue
 = 
	`sime_
(
g
, 0, 10);

3222 i(
Vue
 == 0)

3223 
pAd
->
WIFIbed
.
bGFld
 = 
FALSE
;

3224 i(
Vue
 == 1)

3225 
pAd
->
WIFIbed
.
bGFld
 = 
TRUE
;

3227  
FALSE
;

3229 
	`SCommHT
(
pAd
);

3231 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_FGF_Proc::(FGF=%d)\n", 
pAd
->
WIFIbed
.
bGFld
));

3233  
TRUE
;

3234 
	}
}

3236 
INT
 
	$S_HtMimoPs_Proc
(

3237 
IN
 
PRTMP_ADAPTER
 
pAd
,

3238 
IN
 
PSTRING
 
g
)

3240 
ULONG
 
Vue
;

3242 
Vue
 = 
	`sime_
(
g
, 0, 10);

3243 i(
Vue
 == 0)

3244 
pAd
->
CommCfg
.
bMIMOPSEb
 = 
FALSE
;

3245 i(
Vue
 == 1)

3246 
pAd
->
CommCfg
.
bMIMOPSEb
 = 
TRUE
;

3248  
FALSE
;

3250 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_HtMimoPs_Proc::(HtMimoPs=%d)\n",
pAd
->
CommCfg
.
bMIMOPSEb
));

3252  
TRUE
;

3253 
	}
}

3256 #ifde
DOT11N_DRAFT3


3257 
INT
 
	$S_HT_BssCx_Proc
(

3258 
IN
 
PRTMP_ADAPTER
 
pAd
,

3259 
IN
 
PSTRING
 
pPam
)

3261 
UCHAR
 
bBssCxEb
 = 
	`sime_
(
pPam
, 0, 10);

3263 
pAd
->
CommCfg
.
bBssCxEb
 = ((bBssCxEb =1? 
TRUE
: 
FALSE
);

3265 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S bBssCxEb=%d!\n", 
pAd
->
CommCfg
.
bBssCxEb
));

3267  
TRUE
;

3268 
	}
}

3271 
INT
 
	$S_HT_BssCxApCThr_Proc
(

3272 
IN
 
PRTMP_ADAPTER
 
pAd
,

3273 
IN
 
PSTRING
 
pPam
)

3275 
pAd
->
CommCfg
.
BssCxApCThr
 = 
	`sime_
(
pPam
, 0, 10);

3277 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S BssCxApCThr=%d!\n", 
pAd
->
CommCfg
.
BssCxApCThr
));

3279  
TRUE
;

3280 
	}
}

3286 
INT
 
	$S_FixedTxMode_Proc
(

3287 
IN
 
PRTMP_ADAPTER
 
pAd
,

3288 
IN
 
PSTRING
 
g
)

3290 
INT
 
fix_tx_mode
 = 
FIXED_TXMODE_HT
;

3292 
fix_tx_mode
 = 
	`RT_CfgSFixedTxPhyMode
(
g
);

3294 #ifde
CONFIG_STA_SUPPORT


3295 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3296 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
 = 
fix_tx_mode
;

3299 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_FixedTxMode_Proc::(FixedTxMode=%d)\n", 
fix_tx_mode
));

3301  
TRUE
;

3302 
	}
}

3304 #ifde
CONFIG_APSTA_MIXED_SUPPORT


3305 
INT
 
	$S_OpMode_Proc
(

3306 
IN
 
PRTMP_ADAPTER
 
pAd
,

3307 
IN
 
PSTRING
 
g
)

3309 
ULONG
 
Vue
;

3311 
Vue
 = 
	`sime_
(
g
, 0, 10);

3313 #ifde
RTMP_MAC_PCI


3314 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

3317 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Canot switch operate mode on interface up !! \n"));

3318  
FALSE
;

3321 i(
Vue
 == 0)

3322 
pAd
->
OpMode
 = 
OPMODE_STA
;

3323 i(
Vue
 == 1)

3324 
pAd
->
OpMode
 = 
OPMODE_AP
;

3326  
FALSE
;

3328 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_OpMode_Proc::(OpMode=%s)\n", 
pAd
->
OpMode
 == 1 ? "AP Mode" : "STA Mode"));

3330  
TRUE
;

3331 
	}
}

3337 
INT
 
	$S_LgRryLim_Proc
(

3338 
IN
 
PRTMP_ADAPTER
 
pAdr
,

3339 
IN
 
PSTRING
 
g
)

3341 
TX_RTY_CFG_STRUC
 
tx_y_cfg
;

3342 
UCHAR
 
LgRryLim
 = (UCHAR)
	`sime_
(
g
, 0, 10);

3344 
	`RTMP_IO_READ32
(
pAdr
, 
TX_RTY_CFG
, &
tx_y_cfg
.
wd
);

3345 
tx_y_cfg
.
fld
.
LgRtyLim
 = 
LgRryLim
;

3346 
	`RTMP_IO_WRITE32
(
pAdr
, 
TX_RTY_CFG
, 
tx_y_cfg
.
wd
);

3347 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IF S_LgRryLim_Proc::x_y_cfg=0x%x)\n", 
tx_y_cfg
.
wd
));

3348  
TRUE
;

3349 
	}
}

3351 
INT
 
	$S_ShtRryLim_Proc
(

3352 
IN
 
PRTMP_ADAPTER
 
pAdr
,

3353 
IN
 
PSTRING
 
g
)

3355 
TX_RTY_CFG_STRUC
 
tx_y_cfg
;

3356 
UCHAR
 
ShtRryLim
 = (UCHAR)
	`sime_
(
g
, 0, 10);

3358 
	`RTMP_IO_READ32
(
pAdr
, 
TX_RTY_CFG
, &
tx_y_cfg
.
wd
);

3359 
tx_y_cfg
.
fld
.
ShtRtyLim
 = 
ShtRryLim
;

3360 
	`RTMP_IO_WRITE32
(
pAdr
, 
TX_RTY_CFG
, 
tx_y_cfg
.
wd
);

3361 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IF S_ShtRryLim_Proc::x_y_cfg=0x%x)\n", 
tx_y_cfg
.
wd
));

3362  
TRUE
;

3363 
	}
}

3365 
INT
 
	$S_AutoFlBack_Proc
(

3366 
IN
 
PRTMP_ADAPTER
 
pAdr
,

3367 
IN
 
PSTRING
 
g
)

3369  
	`RT_CfgSAutoFlBack
(
pAdr
, 
g
);

3370 
	}
}

3375 
PSTRING
 
	$RTMPGRkAuthModeS
(

3376 
IN
 
NDIS_802_11_AUTHENTICATION_MODE
 
authMode
)

3378 
authMode
)

3380 
Ndis802_11AuthModeOn
:

3382 
Ndis802_11AuthModeWPAPSK
:

3384 
Ndis802_11AuthModeShed
:

3386 
Ndis802_11AuthModeAutoSwch
:

3388 
Ndis802_11AuthModeWPA
:

3390 
Ndis802_11AuthModeWPA2
:

3392 
Ndis802_11AuthModeWPA2PSK
:

3394 
Ndis802_11AuthModeWPA1PSKWPA2PSK
:

3396 
Ndis802_11AuthModeWPA1WPA2
:

3398 
Ndis802_11AuthModeWPANe
:

3403 
	}
}

3405 
PSTRING
 
	$RTMPGRkEnyModeS
(

3406 
IN
 
USHORT
 
yMode
)

3408 
yMode
)

3410 
Ndis802_11WEPDibd
:

3412 
Ndis802_11WEPEbd
:

3414 
Ndis802_11Enyi2Ebd
:

3416 
Ndis802_11Enyi3Ebd
:

3418 
Ndis802_11Enyi4Ebd
:

3423 
	}
}

3425 
INT
 
	$RTMPShowCfgVue
(

3426 
IN
 
PRTMP_ADAPTER
 
pAd
,

3427 
IN
 
PSTRING
 
pName
,

3428 
IN
 
PSTRING
 
pBuf
)

3430 
INT
 
Stus
 = 0;

3432 
PRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC
 = 
RTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC
; PRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC->
me
; PRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC++)

3434 i(!
	`rcmp
(
pName
, 
PRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC
->
me
))

3436 if(
PRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC
->
	`show_oc
(
pAd
, 
pBuf
))

3437 
Stus
 = -
EINVAL
;

3442 if(
PRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC
->
me
 =
NULL
)

3444 
	`rtf
(
pBuf
, "\n");

3445 
PRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC
 = 
RTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC
; PRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC->
me
; PRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC++)

3446 
	`rtf
(
pBuf
, "%s%s\n",Buf, 
PRTMP_PRIVATE_STA_SHOW_CFG_VALUE_PROC
->
me
);

3449  
Stus
;

3450 
	}
}

3452 
INT
 
	$Show_SSID_Proc
(

3453 
IN
 
PRTMP_ADAPTER
 
pAd
,

3454 
OUT
 
PSTRING
 
pBuf
)

3457 #ifde
CONFIG_STA_SUPPORT


3458 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3459 
	`rtf
(
pBuf
, "\t%s", 
pAd
->
CommCfg
.
Ssid
);

3462 
	}
}

3464 
INT
 
	$Show_WessMode_Proc
(

3465 
IN
 
PRTMP_ADAPTER
 
pAd
,

3466 
OUT
 
PSTRING
 
pBuf
)

3468 
pAd
->
CommCfg
.
PhyMode
)

3470 
PHY_11BG_MIXED
:

3471 
	`rtf
(
pBuf
, "\t11B/G");

3473 
PHY_11B
:

3474 
	`rtf
(
pBuf
, "\t11B");

3476 
PHY_11A
:

3477 
	`rtf
(
pBuf
, "\t11A");

3479 
PHY_11ABG_MIXED
:

3480 
	`rtf
(
pBuf
, "\t11A/B/G");

3482 
PHY_11G
:

3483 
	`rtf
(
pBuf
, "\t11G");

3485 #ifde
DOT11_N_SUPPORT


3486 
PHY_11ABGN_MIXED
:

3487 
	`rtf
(
pBuf
, "\t11A/B/G/N");

3489 
PHY_11N_2_4G
:

3490 
	`rtf
(
pBuf
, "\t11N only with 2.4G");

3492 
PHY_11GN_MIXED
:

3493 
	`rtf
(
pBuf
, "\t11G/N");

3495 
PHY_11AN_MIXED
:

3496 
	`rtf
(
pBuf
, "\t11A/N");

3498 
PHY_11BGN_MIXED
:

3499 
	`rtf
(
pBuf
, "\t11B/G/N");

3501 
PHY_11AGN_MIXED
:

3502 
	`rtf
(
pBuf
, "\t11A/G/N");

3504 
PHY_11N_5G
:

3505 
	`rtf
(
pBuf
, "\t11N only with 5G");

3509 
	`rtf
(
pBuf
, "\tUnknow Vue(%d)", 
pAd
->
CommCfg
.
PhyMode
);

3513 
	}
}

3516 
INT
 
	$Show_TxBur_Proc
(

3517 
IN
 
PRTMP_ADAPTER
 
pAd
,

3518 
OUT
 
PSTRING
 
pBuf
)

3520 
	`rtf
(
pBuf
, "\t%s", 
pAd
->
CommCfg
.
bEbTxBur
 ? "TRUE":"FALSE");

3522 
	}
}

3524 
INT
 
	$Show_TxPamb_Proc
(

3525 
IN
 
PRTMP_ADAPTER
 
pAd
,

3526 
OUT
 
PSTRING
 
pBuf
)

3528 
pAd
->
CommCfg
.
TxPamb
)

3530 
Rt802_11PambSht
:

3531 
	`rtf
(
pBuf
, "\tShort");

3533 
Rt802_11PambLg
:

3534 
	`rtf
(
pBuf
, "\tLong");

3536 
Rt802_11PambAuto
:

3537 
	`rtf
(
pBuf
, "\tAuto");

3540 
	`rtf
(
pBuf
, "\tUnknowVue(%lu)", 
pAd
->
CommCfg
.
TxPamb
);

3545 
	}
}

3547 
INT
 
	$Show_TxPow_Proc
(

3548 
IN
 
PRTMP_ADAPTER
 
pAd
,

3549 
OUT
 
PSTRING
 
pBuf
)

3551 
	`rtf
(
pBuf
, "\t%lu", 
pAd
->
CommCfg
.
TxPowPage
);

3553 
	}
}

3555 
INT
 
	$Show_Chl_Proc
(

3556 
IN
 
PRTMP_ADAPTER
 
pAd
,

3557 
OUT
 
PSTRING
 
pBuf
)

3559 
	`rtf
(
pBuf
, "\t%d", 
pAd
->
CommCfg
.
Chl
);

3561 
	}
}

3563 
INT
 
	$Show_BGPrei_Proc
(

3564 
IN
 
PRTMP_ADAPTER
 
pAd
,

3565 
OUT
 
PSTRING
 
pBuf
)

3567 
pAd
->
CommCfg
.
UBGPrei
)

3570 
	`rtf
(
pBuf
, "\tON");

3573 
	`rtf
(
pBuf
, "\tOFF");

3576 
	`rtf
(
pBuf
, "\tAuto");

3579 
	`rtf
(
pBuf
, "\tUnknow Vue(%lu)", 
pAd
->
CommCfg
.
UBGPrei
);

3583 
	}
}

3585 
INT
 
	$Show_RTSThshd_Proc
(

3586 
IN
 
PRTMP_ADAPTER
 
pAd
,

3587 
OUT
 
PSTRING
 
pBuf
)

3589 
	`rtf
(
pBuf
, "\t%u", 
pAd
->
CommCfg
.
RtsThshd
);

3591 
	}
}

3593 
INT
 
	$Show_FgThshd_Proc
(

3594 
IN
 
PRTMP_ADAPTER
 
pAd
,

3595 
OUT
 
PSTRING
 
pBuf
)

3597 
	`rtf
(
pBuf
, "\t%u", 
pAd
->
CommCfg
.
FgmtThshd
);

3599 
	}
}

3601 #ifde
DOT11_N_SUPPORT


3602 
INT
 
	$Show_HtBw_Proc
(

3603 
IN
 
PRTMP_ADAPTER
 
pAd
,

3604 
OUT
 
PSTRING
 
pBuf
)

3606 i(
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 =
BW_40
)

3608 
	`rtf
(
pBuf
, "\t40 MHz");

3612 
	`rtf
(
pBuf
, "\t20 MHz");

3615 
	}
}

3617 
INT
 
	$Show_HtMcs_Proc
(

3618 
IN
 
PRTMP_ADAPTER
 
pAd
,

3619 
OUT
 
PSTRING
 
pBuf
)

3622 #ifde
CONFIG_STA_SUPPORT


3623 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3624 
	`rtf
(
pBuf
, "\t%u", 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
);

3627 
	}
}

3629 
INT
 
	$Show_HtGi_Proc
(

3630 
IN
 
PRTMP_ADAPTER
 
pAd
,

3631 
OUT
 
PSTRING
 
pBuf
)

3633 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
ShtGI
)

3635 
GI_400
:

3636 
	`rtf
(
pBuf
, "\tGI_400");

3638 
GI_800
:

3639 
	`rtf
(
pBuf
, "\tGI_800");

3642 
	`rtf
(
pBuf
, "\tUnknow Vue(%u)", 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
ShtGI
);

3646 
	}
}

3648 
INT
 
	$Show_HtOpMode_Proc
(

3649 
IN
 
PRTMP_ADAPTER
 
pAd
,

3650 
OUT
 
PSTRING
 
pBuf
)

3652 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
HTMODE
)

3654 
HTMODE_GF
:

3655 
	`rtf
(
pBuf
, "\tGF");

3657 
HTMODE_MM
:

3658 
	`rtf
(
pBuf
, "\tMM");

3661 
	`rtf
(
pBuf
, "\tUnknow Vue(%u)", 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
HTMODE
);

3665 
	}
}

3667 
INT
 
	$Show_HtExtcha_Proc
(

3668 
IN
 
PRTMP_ADAPTER
 
pAd
,

3669 
OUT
 
PSTRING
 
pBuf
)

3671 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
)

3673 
EXTCHA_BELOW
:

3674 
	`rtf
(
pBuf
, "\tBelow");

3676 
EXTCHA_ABOVE
:

3677 
	`rtf
(
pBuf
, "\tAbove");

3680 
	`rtf
(
pBuf
, "\tUnknow Vue(%u)", 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
);

3684 
	}
}

3687 
INT
 
	$Show_HtMpduDsy_Proc
(

3688 
IN
 
PRTMP_ADAPTER
 
pAd
,

3689 
OUT
 
PSTRING
 
pBuf
)

3691 
	`rtf
(
pBuf
, "\t%u", 
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
);

3693 
	}
}

3695 
INT
 
	$Show_HtBaWSize_Proc
(

3696 
IN
 
PRTMP_ADAPTER
 
pAd
,

3697 
OUT
 
PSTRING
 
pBuf
)

3699 
	`rtf
(
pBuf
, "\t%u", 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
);

3701 
	}
}

3703 
INT
 
	$Show_HtRdg_Proc
(

3704 
IN
 
PRTMP_ADAPTER
 
pAd
,

3705 
OUT
 
PSTRING
 
pBuf
)

3707 
	`rtf
(
pBuf
, "\t%s", 
pAd
->
CommCfg
.
bRdg
 ? "TRUE":"FALSE");

3709 
	}
}

3711 
INT
 
	$Show_HtAmsdu_Proc
(

3712 
IN
 
PRTMP_ADAPTER
 
pAd
,

3713 
OUT
 
PSTRING
 
pBuf
)

3715 
	`rtf
(
pBuf
, "\t%s", 
pAd
->
CommCfg
.
BACaby
.
fld
.
AmsduEb
 ? "TRUE":"FALSE");

3717 
	}
}

3719 
INT
 
	$Show_HtAutoBa_Proc
(

3720 
IN
 
PRTMP_ADAPTER
 
pAd
,

3721 
OUT
 
PSTRING
 
pBuf
)

3723 
	`rtf
(
pBuf
, "\t%s", 
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 ? "TRUE":"FALSE");

3725 
	}
}

3728 
INT
 
	$Show_CouryRegi_Proc
(

3729 
IN
 
PRTMP_ADAPTER
 
pAd
,

3730 
OUT
 
PSTRING
 
pBuf
)

3732 
	`rtf
(
pBuf
, "\t%d", 
pAd
->
CommCfg
.
CouryRegi
);

3734 
	}
}

3736 
INT
 
	$Show_CouryRegiABd_Proc
(

3737 
IN
 
PRTMP_ADAPTER
 
pAd
,

3738 
OUT
 
PSTRING
 
pBuf
)

3740 
	`rtf
(
pBuf
, "\t%d", 
pAd
->
CommCfg
.
CouryRegiFABd
);

3742 
	}
}

3744 
INT
 
	$Show_CouryCode_Proc
(

3745 
IN
 
PRTMP_ADAPTER
 
pAd
,

3746 
OUT
 
PSTRING
 
pBuf
)

3748 
	`rtf
(
pBuf
, "\t%s", 
pAd
->
CommCfg
.
CouryCode
);

3750 
	}
}

3752 #ifde
AGGREGATION_SUPPORT


3753 
INT
 
	$Show_PktAggge_Proc
(

3754 
IN
 
PRTMP_ADAPTER
 
pAd
,

3755 
OUT
 
PSTRING
 
pBuf
)

3757 
	`rtf
(
pBuf
, "\t%s", 
pAd
->
CommCfg
.
bAgggiCab
 ? "TRUE":"FALSE");

3759 
	}
}

3762 #ifde
WMM_SUPPORT


3763 
INT
 
	$Show_WmmCab_Proc
(

3764 
IN
 
PRTMP_ADAPTER
 
pAd
,

3765 
OUT
 
PSTRING
 
pBuf
)

3768 #ifde
CONFIG_STA_SUPPORT


3769 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3770 
	`rtf
(
pBuf
, "\t%s", 
pAd
->
CommCfg
.
bWmmCab
 ? "TRUE":"FALSE");

3774 
	}
}

3777 
INT
 
	$Show_IEEE80211H_Proc
(

3778 
IN
 
PRTMP_ADAPTER
 
pAd
,

3779 
OUT
 
PSTRING
 
pBuf
)

3781 
	`rtf
(
pBuf
, "\t%s", 
pAd
->
CommCfg
.
bIEEE80211H
 ? "TRUE":"FALSE");

3783 
	}
}

3785 #ifde
CONFIG_STA_SUPPORT


3786 
INT
 
	$Show_NwkTy_Proc
(

3787 
IN
 
PRTMP_ADAPTER
 
pAd
,

3788 
OUT
 
PSTRING
 
pBuf
)

3790 
pAd
->
SCfg
.
BssTy
)

3792 
BSS_ADHOC
:

3793 
	`rtf
(
pBuf
, "\tAdhoc");

3795 
BSS_INFRA
:

3796 
	`rtf
(
pBuf
, "\tInfra");

3798 
BSS_ANY
:

3799 
	`rtf
(
pBuf
, "\tAny");

3801 
BSS_MONITOR
:

3802 
	`rtf
(
pBuf
, "\tMonitor");

3805 
	`rtf
(
pBuf
, "\tUnknow Vue(%d)", 
pAd
->
SCfg
.
BssTy
);

3809 
	}
}

3812 
INT
 
	$Show_WPAPSK_Proc
(

3813 
IN
 
PRTMP_ADAPTER
 
pAd
,

3814 
OUT
 
PSTRING
 
pBuf
)

3816 i((
pAd
->
SCfg
.
WPassPhL
 >= 8) &&

3817 (
pAd
->
SCfg
.
WPassPhL
 < 64))

3818 
	`rtf
(
pBuf
, "\tWPAPSK = %s", 
pAd
->
SCfg
.
WPassPh
);

3821 
INT
 
idx
;

3822 
	`rtf
(
pBuf
, "\tWPAPSK = ");

3823 
idx
 = 0; idx < 32; idx++)

3824 
	`rtf
(
pBuf
+
	`
Buf), "%02X", 
pAd
->
SCfg
.
WPassPh
[
idx
]);

3828 
	}
}

3830 
INT
 
	$Show_AutoRec_Proc
(

3831 
IN
 
PRTMP_ADAPTER
 
pAd
,

3832 
OUT
 
PSTRING
 
pBuf
)

3834 
	`rtf
(
pBuf
, "\tAutoRec = %d", 
pAd
->
SCfg
.
bAutoRec
);

3836 
	}
}

3840 
INT
 
	$Show_AuthMode_Proc
(

3841 
IN
 
PRTMP_ADAPTER
 
pAd
,

3842 
OUT
 
PSTRING
 
pBuf
)

3844 
NDIS_802_11_AUTHENTICATION_MODE
 
AuthMode
 = 
Ndis802_11AuthModeOn
;

3846 #ifde
CONFIG_STA_SUPPORT


3847 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3848 
AuthMode
 = 
pAd
->
SCfg
.AuthMode;

3851 i((
AuthMode
 >
Ndis802_11AuthModeOn
) &&

3852 (
AuthMode
 <
Ndis802_11AuthModeWPA1PSKWPA2PSK
))

3853 
	`rtf
(
pBuf
, "\t%s", 
	`RTMPGRkAuthModeS
(
AuthMode
));

3855 
	`rtf
(
pBuf
, "\tUnknow Vue(%d)", 
AuthMode
);

3858 
	}
}

3860 
INT
 
	$Show_EnypTy_Proc
(

3861 
IN
 
PRTMP_ADAPTER
 
pAd
,

3862 
OUT
 
PSTRING
 
pBuf
)

3864 
NDIS_802_11_WEP_STATUS
 
WStus
 = 
Ndis802_11WEPDibd
;

3866 #ifde
CONFIG_STA_SUPPORT


3867 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3868 
WStus
 = 
pAd
->
SCfg
.WepStatus;

3871 i((
WStus
 >
Ndis802_11WEPEbd
) &&

3872 (
WStus
 <
Ndis802_11Enyi4KeyAb
))

3873 
	`rtf
(
pBuf
, "\t%s", 
	`RTMPGRkEnyModeS
(
WStus
));

3875 
	`rtf
(
pBuf
, "\tUnknow Vue(%d)", 
WStus
);

3878 
	}
}

3880 
INT
 
	$Show_DeuKeyID_Proc
(

3881 
IN
 
PRTMP_ADAPTER
 
pAd
,

3882 
OUT
 
PSTRING
 
pBuf
)

3884 
UCHAR
 
DeuKeyId
 = 0;

3886 #ifde
CONFIG_STA_SUPPORT


3887 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3888 
DeuKeyId
 = 
pAd
->
SCfg
.DefaultKeyId;

3891 
	`rtf
(
pBuf
, "\t%d", 
DeuKeyId
);

3894 
	}
}

3896 
INT
 
	$Show_WKey_Proc
(

3897 
IN
 
PRTMP_ADAPTER
 
pAd
,

3898 
IN
 
INT
 
KeyIdx
,

3899 
OUT
 
PSTRING
 
pBuf
)

3901 
UCHAR
 
Key
[16] = {0}, 
KeyLgth
 = 0;

3902 
INT
 
dex
 = 
BSS0
;

3904 
KeyLgth
 = 
pAd
->
ShedKey
[
dex
][
KeyIdx
].
KeyL
;

3905 
	`NdisMoveMemy
(
Key
, 
pAd
->
ShedKey
[
dex
][
KeyIdx
].Key, 
KeyLgth
);

3908 i(
	`RTMPCheckSPrtAb
((
PCHAR
)
Key
, 
KeyLgth
))

3909 
	`rtf
(
pBuf
, "\t%s", 
Key
);

3912 
idx
;

3913 
	`rtf
(
pBuf
, "\t");

3914 
idx
 = 0; idx < 
KeyLgth
; idx++)

3915 
	`rtf
(
pBuf
+
	`
Buf), "%02X", 
Key
[
idx
]);

3918 
	}
}

3920 
INT
 
	$Show_Key1_Proc
(

3921 
IN
 
PRTMP_ADAPTER
 
pAd
,

3922 
OUT
 
PSTRING
 
pBuf
)

3924 
	`Show_WKey_Proc
(
pAd
, 0, 
pBuf
);

3926 
	}
}

3928 
INT
 
	$Show_Key2_Proc
(

3929 
IN
 
PRTMP_ADAPTER
 
pAd
,

3930 
OUT
 
PSTRING
 
pBuf
)

3932 
	`Show_WKey_Proc
(
pAd
, 1, 
pBuf
);

3934 
	}
}

3936 
INT
 
	$Show_Key3_Proc
(

3937 
IN
 
PRTMP_ADAPTER
 
pAd
,

3938 
OUT
 
PSTRING
 
pBuf
)

3940 
	`Show_WKey_Proc
(
pAd
, 2, 
pBuf
);

3942 
	}
}

3944 
INT
 
	$Show_Key4_Proc
(

3945 
IN
 
PRTMP_ADAPTER
 
pAd
,

3946 
OUT
 
PSTRING
 
pBuf
)

3948 
	`Show_WKey_Proc
(
pAd
, 3, 
pBuf
);

3950 
	}
}

3952 
INT
 
	$Show_PMK_Proc
(

3953 
IN
 
PRTMP_ADAPTER
 
pAd
,

3954 
OUT
 
PSTRING
 
pBuf
)

3956 
INT
 
idx
;

3957 
UCHAR
 
PMK
[32] = {0};

3960 #ifde
CONFIG_STA_SUPPORT


3961 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3962 
	`NdisMoveMemy
(
PMK
, 
pAd
->
SCfg
.PMK, 32);

3965 
	`rtf
(
pBuf
, "\tPMK = ");

3966 
idx
 = 0; idx < 32; idx++)

3967 
	`rtf
(
pBuf
+
	`
Buf), "%02X", 
PMK
[
idx
]);

3970 
	}
}

3977 
	$gRe
(
HTTRANSMIT_SETTING
 
HTStg
, 
ULONG
* 
fLaTxRxRe
)

3980 
INT
 
MCSMpgReTab
[] =

3992 
_cou
 = (
MCSMpgReTab
)/();

3993 
_dex
 = 0;

3994 
vue
 = 0;

3996 #ifde
DOT11_N_SUPPORT


3997 i(
HTStg
.
fld
.
MODE
 >
MODE_HTMIX
)

4000 
_dex
 = 12 + ((
UCHAR
)
HTStg
.
fld
.
BW
 *24+ ((UCHAR)HTStg.fld.
ShtGI
 *48+ ((UCHAR)HTStg.fld.
MCS
);

4004 i(
HTStg
.
fld
.
MODE
 =
MODE_OFDM
)

4005 
_dex
 = (
UCHAR
)(
HTStg
.
fld
.
MCS
) + 4;

4006 i(
HTStg
.
fld
.
MODE
 =
MODE_CCK
)

4007 
_dex
 = (
UCHAR
)(
HTStg
.
fld
.
MCS
);

4009 i(
_dex
 < 0)

4010 
_dex
 = 0;

4012 i(
_dex
 > 
_cou
)

4013 
_dex
 = 
_cou
;

4015 
vue
 = (
MCSMpgReTab
[
_dex
] * 5)/10;

4016 *
fLaTxRxRe
=(
ULONG
)
vue
;

4018 
	}
}

	@common/cmm_mac_pci.c

29 #ifde
RTMP_MAC_PCI


30 
	~"_cfig.h
"

33 #ifde
RESOURCE_PRE_ALLOC


34 
VOID
 
	$RTMPRetTxRxRgMemy
(

35 
IN
 
RTMP_ADAPTER
 * 
pAd
)

37 
dex
, 
num
 , 
j
;

38 
PRTMP_TX_RING
 
pTxRg
;

39 
PTXD_STRUC
 
pTxD
;

40 
PNDIS_PACKET
 
pPack
;

41 
IrqFgs
;

45 
dex
=0; index <
NUM_OF_TX_RING
; index++)

47 
PQUEUE_ENTRY
 
pEry
;

48 
PNDIS_PACKET
 
pPack
;

49 
PQUEUE_HEADER
 
pQueue
;

51 
	`RTMP_IRQ_LOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

52 
pQueue
 = &
pAd
->
TxSwQueue
[
dex
];

53 
pQueue
->
Hd
)

55 
pEry
 = 
	`RemoveHdQueue
(
pQueue
);

56 
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pEry
);

57 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

59 
	`RTMP_IRQ_UNLOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

64 
dex
=0;dex< 
NUM_OF_TX_RING
;index++)

66 
pTxRg
 = &
pAd
->
TxRg
[
dex
];

68 
j
=0; j< 
TX_RING_SIZE
; j++)

70 
pTxD
 = (
PTXD_STRUC
(
pTxRg
->
Cl
[
j
].
AocVa
);

71 
pPack
 = 
pTxRg
->
Cl
[
j
].
pNdisPack
;

73 i(
pPack
)

75 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP0
,TxD->
SDL0
, 
PCI_DMA_TODEVICE
);

76 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

79 
pTxRg
->
Cl
[
j
].
pNdisPack
 = 
NULL
;

81 
pPack
 = 
pTxRg
->
Cl
[
j
].
pNextNdisPack
;

83 i(
pPack
)

85 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

86 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

89 
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
pNextNdisPack
 = 
NULL
;

95 
dex
 = 
RX_RING_SIZE
 - 1 ; index >= 0; index--)

97 i((
pAd
->
RxRg
.
Cl
[
dex
].
DmaBuf
.
AocVa
&& (pAd->RxRg.Cl[dex].
pNdisPack
))

99 
	`PCI_UNMAP_SINGLE
(
pAd
,Ad->
RxRg
.
Cl
[
dex
].
DmaBuf
.
AocPa
,Ad->RxRg.Cl[dex].DmaBuf.
AocSize
, 
PCI_DMA_FROMDEVICE
);

100 
	`RELEASE_NDIS_PACKET
(
pAd
,Ad->
RxRg
.
Cl
[
dex
].
pNdisPack
, 
NDIS_STATUS_SUCCESS
);

103 
	`NdisZoMemy
(
pAd
->
RxRg
.
Cl
, 
RX_RING_SIZE
 * (
RTMP_DMACB
));

105 i(
pAd
->
FgFme
.
pFgPack
)

107 
	`RELEASE_NDIS_PACKET
(
pAd
,Ad->
FgFme
.
pFgPack
, 
NDIS_STATUS_SUCCESS
);

108 
pAd
->
FgFme
.
pFgPack
 = 
NULL
;

110 
	}
}

113 
VOID
 
	$RTMPFeTxRxRgMemy
(

114 
IN
 
PRTMP_ADAPTER
 
pAd
)

116 
dex
, 
num
 , 
j
;

117 
PRTMP_TX_RING
 
pTxRg
;

118 
PTXD_STRUC
 
pTxD
;

119 
PNDIS_PACKET
 
pPack
;

120 
IrqFgs
;

123 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> RTMPFreeTxRxRingMemory\n"));

127 i(
pAd
->
RxDescRg
.
AocVa
)

129 
	`RTMP_FeDescMemy
(
pAd
,

130 
pAd
->
RxDescRg
.
AocSize
,

131 
pAd
->
RxDescRg
.
AocVa
,

132 
pAd
->
RxDescRg
.
AocPa
);

134 
	`NdisZoMemy
(&
pAd
->
RxDescRg
, (
RTMP_DMABUF
));

137 i(
pAd
->
MgmtDescRg
.
AocVa
)

139 
	`RTMP_FeDescMemy
(
pAd
,

140 
pAd
->
MgmtDescRg
.
AocSize
,

141 
pAd
->
MgmtDescRg
.
AocVa
,

142 
pAd
->
MgmtDescRg
.
AocPa
);

144 
	`NdisZoMemy
(&
pAd
->
MgmtDescRg
, (
RTMP_DMABUF
));

147 
num
 = 0;um < 
NUM_OF_TX_RING
;um++)

149 i(
pAd
->
TxBufS
[
num
].
AocVa
)

151 
	`RTMP_FeFTxBufr
(
pAd
,

152 
pAd
->
TxBufS
[
num
].
AocSize
,

153 
FALSE
, 
pAd
->
TxBufS
[
num
].
AocVa
,

154 
pAd
->
TxBufS
[
num
].
AocPa
);

156 
	`NdisZoMemy
(&
pAd
->
TxBufS
[
num
], (
RTMP_DMABUF
));

158 i(
pAd
->
TxDescRg
[
num
].
AocVa
)

160 
	`RTMP_FeDescMemy
(
pAd
,

161 
pAd
->
TxDescRg
[
num
].
AocSize
,

162 
pAd
->
TxDescRg
[
num
].
AocVa
,

163 
pAd
->
TxDescRg
[
num
].
AocPa
);

165 
	`NdisZoMemy
(&
pAd
->
TxDescRg
[
num
], (
RTMP_DMABUF
));

168 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- RTMPFreeTxRxRingMemory\n"));

169 
	}
}

172 
NDIS_STATUS
 
	gRTMPInTxRxRgMemy


173 (
IN
 
RTMP_ADAPTER
 *
	gpAd
)

175 
INT
 
	gnum
, 
	gdex
;

176 
ULONG
 
	gRgBaPaHigh
;

177 
ULONG
 
	gRgBaPaLow
;

178 
PVOID
 
	gRgBaVa
;

179 
PRTMP_TX_RING
 
	gpTxRg
;

180 
PRTMP_DMABUF
 
	gpDmaBuf
;

181 
PNDIS_PACKET
 
	gpPack
;

182 
PTXD_STRUC
 
	gpTxD
;

183 
PRXD_STRUC
 
	gpRxD
;

184 
ULONG
 
	gEVue
 = 0;

185 
NDIS_STATUS
 
	gStus
 = 
NDIS_STATUS_SUCCESS
;

189 
NdisAoSpLock
(&
pAd
->
CmdQLock
);

190 
NdisAcqueSpLock
(&
pAd
->
CmdQLock
);

191 
RTInlizeCmdQ
(&
pAd
->
CmdQ
);

192 
NdisRSpLock
(&
pAd
->
CmdQLock
);

198 
	gnum
=0;um<
	gNUM_OF_TX_RING
;um++)

200 
ULONG
 
	gBufBaPaHigh
;

201 
ULONG
 
	gBufBaPaLow
;

202 
PVOID
 
	gBufBaVa
;

205 
NdisZoMemy
(
pAd
->
TxDescRg
[
num
].
AocVa
,Ad->TxDescRg[num].
AocSize
);

207 
	gRgBaPaHigh
 = 
RTMP_GPhysilAddssHigh
(
pAd
->
TxDescRg
[
num
].
AocPa
);

208 
	gRgBaPaLow
 = 
RTMP_GPhysilAddssLow
 (
pAd
->
TxDescRg
[
num
].
AocPa
);

209 
	gRgBaVa
 = 
pAd
->
TxDescRg
[
num
].
AocVa
;

212 
NdisZoMemy
(
pAd
->
TxBufS
[
num
].
AocVa
,Ad->TxBufS[num].
AocSize
);

214 
	gBufBaPaHigh
 = 
RTMP_GPhysilAddssHigh
(
pAd
->
TxBufS
[
num
].
AocPa
);

215 
	gBufBaPaLow
 = 
RTMP_GPhysilAddssLow
 (
pAd
->
TxBufS
[
num
].
AocPa
);

216 
	gBufBaVa
 = 
pAd
->
TxBufS
[
num
].
AocVa
;

219 
	gpTxRg
 = &
pAd
->
TxRg
[
num
];

220 
	gdex
 = 0; index < 
	gTX_RING_SIZE
; index++)

222 
	gpTxRg
->
	gCl
[
dex
].
	gpNdisPack
 = 
NULL
;

223 
	gpTxRg
->
	gCl
[
dex
].
	gpNextNdisPack
 = 
NULL
;

225 
	gpTxRg
->
	gCl
[
dex
].
	gAocSize
 = 
TXD_SIZE
;

226 
	gpTxRg
->
	gCl
[
dex
].
	gAocVa
 = 
RgBaVa
;

227 
RTMP_SPhysilAddssHigh
(
pTxRg
->
Cl
[
dex
].
AocPa
, 
RgBaPaHigh
);

228 
RTMP_SPhysilAddssLow
 (
pTxRg
->
Cl
[
dex
].
AocPa
, 
RgBaPaLow
);

231 
	gpDmaBuf
 = &
pTxRg
->
Cl
[
dex
].
DmaBuf
;

232 
	gpDmaBuf
->
	gAocSize
 = 
TX_DMA_1ST_BUFFER_SIZE
;

233 
	gpDmaBuf
->
	gAocVa
 = 
BufBaVa
;

234 
RTMP_SPhysilAddssHigh
(
pDmaBuf
->
AocPa
, 
BufBaPaHigh
);

235 
RTMP_SPhysilAddssLow
(
pDmaBuf
->
AocPa
, 
BufBaPaLow
);

238 
	gpTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
dex
].
AocVa
;

239 
	gpTxD
->
	gSDP0
 = 
BufBaPaLow
;

241 
	gpTxD
->
	gDMADONE
 = 1;

242 #ifde
RT_BIG_ENDIAN


243 
RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

245 
	gRgBaPaLow
 +
TXD_SIZE
;

246 
	gRgBaVa
 = (
PUCHAR

RgBaVa
 + 
TXD_SIZE
;

249 
	gBufBaPaLow
 +
TX_DMA_1ST_BUFFER_SIZE
;

250 
	gBufBaVa
 = (
PUCHAR

BufBaVa
 + 
TX_DMA_1ST_BUFFER_SIZE
;

252 
DBGPRINT
(
RT_DEBUG_TRACE
, ("TxRg[%d]:ٮ %dry inlized\n", 
num
, 
dex
));

259 
	gRgBaPaHigh
 = 
RTMP_GPhysilAddssHigh
(
pAd
->
MgmtDescRg
.
AocPa
);

260 
	gRgBaPaLow
 = 
RTMP_GPhysilAddssLow
 (
pAd
->
MgmtDescRg
.
AocPa
);

261 
	gRgBaVa
 = 
pAd
->
MgmtDescRg
.
AocVa
;

262 
NdisZoMemy
(
pAd
->
MgmtDescRg
.
AocVa
,Ad->MgmtDescRg.
AocSize
);

263 
	gdex
 = 0; index < 
	gMGMT_RING_SIZE
; index++)

265 
	gpAd
->
	gMgmtRg
.
	gCl
[
dex
].
	gpNdisPack
 = 
NULL
;

266 
	gpAd
->
	gMgmtRg
.
	gCl
[
dex
].
	gpNextNdisPack
 = 
NULL
;

268 
	gpAd
->
	gMgmtRg
.
	gCl
[
dex
].
	gAocSize
 = 
TXD_SIZE
;

269 
	gpAd
->
	gMgmtRg
.
	gCl
[
dex
].
	gAocVa
 = 
RgBaVa
;

270 
RTMP_SPhysilAddssHigh
(
pAd
->
MgmtRg
.
Cl
[
dex
].
AocPa
, 
RgBaPaHigh
);

271 
RTMP_SPhysilAddssLow
 (
pAd
->
MgmtRg
.
Cl
[
dex
].
AocPa
, 
RgBaPaLow
);

274 
	gRgBaPaLow
 +
TXD_SIZE
;

275 
	gRgBaVa
 = (
PUCHAR

RgBaVa
 + 
TXD_SIZE
;

278 
	gpTxD
 = (
PTXD_STRUC

pAd
->
MgmtRg
.
Cl
[
dex
].
AocVa
;

279 
	gpTxD
->
	gDMADONE
 = 1;

281 #ifde
RT_BIG_ENDIAN


282 
RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

291 
NdisZoMemy
(
pAd
->
RxDescRg
.
AocVa
,Ad->RxDescRg.
AocSize
);

292 
DBGPRINT
(
RT_DEBUG_OFF
, ("RX DESC %p size = %ld\n",

293 
pAd
->
RxDescRg
.
AocVa
,Ad->RxDescRg.
AocSize
));

296 
	gRgBaPaHigh
 = 
RTMP_GPhysilAddssHigh
(
pAd
->
RxDescRg
.
AocPa
);

297 
	gRgBaPaLow
 = 
RTMP_GPhysilAddssLow
 (
pAd
->
RxDescRg
.
AocPa
);

298 
	gRgBaVa
 = 
pAd
->
RxDescRg
.
AocVa
;

301 
	gdex
 = 0; index < 
	gRX_RING_SIZE
; index++)

304 
	gpAd
->
	gRxRg
.
	gCl
[
dex
].
	gAocSize
 = 
RXD_SIZE
;

305 
	gpAd
->
	gRxRg
.
	gCl
[
dex
].
	gAocVa
 = 
RgBaVa
;

306 
RTMP_SPhysilAddssHigh
(
pAd
->
RxRg
.
Cl
[
dex
].
AocPa
, 
RgBaPaHigh
);

307 
RTMP_SPhysilAddssLow
 (
pAd
->
RxRg
.
Cl
[
dex
].
AocPa
, 
RgBaPaLow
);;

310 
	gRgBaPaLow
 +
RXD_SIZE
;

311 
	gRgBaVa
 = (
PUCHAR

RgBaVa
 + 
RXD_SIZE
;

314 
	gpDmaBuf
 = &
pAd
->
RxRg
.
Cl
[
dex
].
DmaBuf
;

315 
	gpDmaBuf
->
	gAocSize
 = 
RX_BUFFER_AGGRESIZE
;

316 
	gpPack
 = 
RTMP_AoRxPackBufr
(

317 
pAd
,

318 
pDmaBuf
->
AocSize
,

319 
FALSE
,

320 &
pDmaBuf
->
AocVa
,

321 &
pDmaBuf
->
AocPa
);

324 
	gpAd
->
	gRxRg
.
	gCl
[
dex
].
	gpNdisPack
 = 
pPack
;

327 i(
	gpDmaBuf
->
	gAocVa
 =
NULL
)

329 
EVue
 = 
ERRLOG_OUT_OF_SHARED_MEMORY
;

330 
DBGPRINT_ERR
(("Failedollocate RxRing's 1st buffer\n"));

331 
	gStus
 = 
NDIS_STATUS_RESOURCES
;

336 
NdisZoMemy
(
pDmaBuf
->
AocVa
,DmaBuf->
AocSize
);

339 
	gpRxD
 = (
PRXD_STRUC

pAd
->
RxRg
.
Cl
[
dex
].
AocVa
;

340 
	gpRxD
->
	gSDP0
 = 
RTMP_GPhysilAddssLow
(
pDmaBuf
->
AocPa
);

341 
	gpRxD
->
	gDDONE
 = 0;

343 #ifde
RT_BIG_ENDIAN


344 
RTMPDestEndnChge
((
PUCHAR
)
pRxD
, 
TYPE_RXD
);

349 
NdisZoMemy
(&
pAd
->
FgFme
, (
FRAGMENT_FRAME
));

350 
	gpAd
->
	gFgFme
.
	gpFgPack
 = 
RTMP_AoFgPackBufr
(
pAd
, 
RX_BUFFER_NORMSIZE
);

352 i(
	gpAd
->
	gFgFme
.
	gpFgPack
 =
NULL
)

354 
Stus
 = 
NDIS_STATUS_RESOURCES
;

360 
DBGPRINT
(
RT_DEBUG_TRACE
, ("--> NICInitTxRxRingAndBacklogQueue\n"));

371 
	gdex
 = 0; index < 
	gNUM_OF_TX_RING
; index++)

373 
InlizeQueueHd
(&
pAd
->
TxSwQueue
[
dex
]);

375 
	gpAd
->
	gTxRg
[
dex
].
	gTxSwFeIdx
 = 0;

376 
	gpAd
->
	gTxRg
[
dex
].
	gTxCpuIdx
 = 0;

381 
	gpAd
->
	gRxRg
.
	gRxSwRdIdx
 = 0;

382 
	gpAd
->
	gRxRg
.
	gRxCpuIdx
 = 
RX_RING_SIZE
 - 1;

387 
	gpAd
->
	gMgmtRg
.
	gTxSwFeIdx
 = 0;

388 
	gpAd
->
	gMgmtRg
.
	gTxCpuIdx
 = 0;

390 
	gpAd
->
	gPriveInfo
.
	gTxRgFuC
 = 0;

392 
DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- NICInitTxRxRingAndBacklogQueue\n"));

395  
	gStus
;

420 
NDIS_STATUS
 
	$RTMPAocTxRxRgMemy
(

421 
IN
 
PRTMP_ADAPTER
 
pAd
)

423 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

424 
ULONG
 
RgBaPaHigh
;

425 
ULONG
 
RgBaPaLow
;

426 
PVOID
 
RgBaVa
;

427 
INT
 
dex
, 
num
;

428 
PTXD_STRUC
 
pTxD
;

429 
PRXD_STRUC
 
pRxD
;

430 
ULONG
 
EVue
 = 0;

431 
PRTMP_TX_RING
 
pTxRg
;

432 
PRTMP_DMABUF
 
pDmaBuf
;

433 
PNDIS_PACKET
 
pPack
;

436 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> RTMPAllocTxRxRingMemory\n"));

444 
num
=0;um<
NUM_OF_TX_RING
;um++)

446 
ULONG
 
BufBaPaHigh
;

447 
ULONG
 
BufBaPaLow
;

448 
PVOID
 
BufBaVa
;

453 
pAd
->
TxDescRg
[
num
].
AocSize
 = 
TX_RING_SIZE
 * 
TXD_SIZE
;

454 
	`RTMP_AoTxDescMemy
(

455 
pAd
,

456 
num
,

457 
pAd
->
TxDescRg
[
num
].
AocSize
,

458 
FALSE
,

459 &
pAd
->
TxDescRg
[
num
].
AocVa
,

460 &
pAd
->
TxDescRg
[
num
].
AocPa
);

462 i(
pAd
->
TxDescRg
[
num
].
AocVa
 =
NULL
)

464 
EVue
 = 
ERRLOG_OUT_OF_SHARED_MEMORY
;

465 
	`DBGPRINT_ERR
(("Failedollocate big buffer\n"));

466 
Stus
 = 
NDIS_STATUS_RESOURCES
;

473 
pAd
->
TxBufS
[
num
].
AocSize
 = 
TX_RING_SIZE
 * 
TX_DMA_1ST_BUFFER_SIZE
;

474 
	`RTMP_AoFTxBufr
(

475 
pAd
,

476 
num
,

477 
pAd
->
TxBufS
[
num
].
AocSize
,

478 
FALSE
,

479 &
pAd
->
TxBufS
[
num
].
AocVa
,

480 &
pAd
->
TxBufS
[
num
].
AocPa
);

482 i(
pAd
->
TxBufS
[
num
].
AocVa
 =
NULL
)

484 
EVue
 = 
ERRLOG_OUT_OF_SHARED_MEMORY
;

485 
	`DBGPRINT_ERR
(("Failedollocate big buffer\n"));

486 
Stus
 = 
NDIS_STATUS_RESOURCES
;

490 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("TxRg[%d]:ٮ %dryod\n", 
num
, 
dex
));

492 i(
Stus
 =
NDIS_STATUS_RESOURCES
)

498 
pAd
->
MgmtDescRg
.
AocSize
 = 
MGMT_RING_SIZE
 * 
TXD_SIZE
;

499 
	`RTMP_AoMgmtDescMemy
(

500 
pAd
,

501 
pAd
->
MgmtDescRg
.
AocSize
,

502 
FALSE
,

503 &
pAd
->
MgmtDescRg
.
AocVa
,

504 &
pAd
->
MgmtDescRg
.
AocPa
);

506 i(
pAd
->
MgmtDescRg
.
AocVa
 =
NULL
)

508 
EVue
 = 
ERRLOG_OUT_OF_SHARED_MEMORY
;

509 
	`DBGPRINT_ERR
(("Failedollocate big buffer\n"));

510 
Stus
 = 
NDIS_STATUS_RESOURCES
;

513 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MGMT Rg:ٮ %dryod\n", 
dex
));

519 
pAd
->
RxDescRg
.
AocSize
 = 
RX_RING_SIZE
 * 
RXD_SIZE
;

520 
	`RTMP_AoRxDescMemy
(

521 
pAd
,

522 
pAd
->
RxDescRg
.
AocSize
,

523 
FALSE
,

524 &
pAd
->
RxDescRg
.
AocVa
,

525 &
pAd
->
RxDescRg
.
AocPa
);

527 i(
pAd
->
RxDescRg
.
AocVa
 =
NULL
)

529 
EVue
 = 
ERRLOG_OUT_OF_SHARED_MEMORY
;

530 
	`DBGPRINT_ERR
(("Failedollocate big buffer\n"));

531 
Stus
 = 
NDIS_STATUS_RESOURCES
;

534 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Rx Rg:ٮ %dryod\n", 
dex
));

536 } 
FALSE
);

539 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

542 
	`NdisWreELogEry
(

543 
pAd
->
AdrHd
,

544 
NDIS_ERROR_CODE_OUT_OF_RESOURCES
,

546 
EVue
);

549 
	`DBGPRINT_S
(
Stus
, ("<-- RTMPAllocTxRxRingMemory, Status=%x\n", Status));

550  
Stus
;

551 
	}
}

574 
NDIS_STATUS
 
	$RTMPAocTxRxRgMemy
(

575 
IN
 
PRTMP_ADAPTER
 
pAd
)

577 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

578 
ULONG
 
RgBaPaHigh
;

579 
ULONG
 
RgBaPaLow
;

580 
PVOID
 
RgBaVa
;

581 
INT
 
dex
, 
num
;

582 
PTXD_STRUC
 
pTxD
;

583 
PRXD_STRUC
 
pRxD
;

584 
ULONG
 
EVue
 = 0;

585 
PRTMP_TX_RING
 
pTxRg
;

586 
PRTMP_DMABUF
 
pDmaBuf
;

587 
PNDIS_PACKET
 
pPack
;

590 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> RTMPAllocTxRxRingMemory\n"));

594 
	`NdisAoSpLock
(&
pAd
->
CmdQLock
);

595 
	`NdisAcqueSpLock
(&
pAd
->
CmdQLock
);

596 
	`RTInlizeCmdQ
(&
pAd
->
CmdQ
);

597 
	`NdisRSpLock
(&
pAd
->
CmdQLock
);

604 
num
=0;um<
NUM_OF_TX_RING
;um++)

606 
ULONG
 
BufBaPaHigh
;

607 
ULONG
 
BufBaPaLow
;

608 
PVOID
 
BufBaVa
;

613 
pAd
->
TxDescRg
[
num
].
AocSize
 = 
TX_RING_SIZE
 * 
TXD_SIZE
;

614 
	`RTMP_AoTxDescMemy
(

615 
pAd
,

616 
num
,

617 
pAd
->
TxDescRg
[
num
].
AocSize
,

618 
FALSE
,

619 &
pAd
->
TxDescRg
[
num
].
AocVa
,

620 &
pAd
->
TxDescRg
[
num
].
AocPa
);

622 i(
pAd
->
TxDescRg
[
num
].
AocVa
 =
NULL
)

624 
EVue
 = 
ERRLOG_OUT_OF_SHARED_MEMORY
;

625 
	`DBGPRINT_ERR
(("Failedollocate big buffer\n"));

626 
Stus
 = 
NDIS_STATUS_RESOURCES
;

631 
	`NdisZoMemy
(
pAd
->
TxDescRg
[
num
].
AocVa
,Ad->TxDescRg[num].
AocSize
);

634 
RgBaPaHigh
 = 
	`RTMP_GPhysilAddssHigh
(
pAd
->
TxDescRg
[
num
].
AocPa
);

635 
RgBaPaLow
 = 
	`RTMP_GPhysilAddssLow
 (
pAd
->
TxDescRg
[
num
].
AocPa
);

636 
RgBaVa
 = 
pAd
->
TxDescRg
[
num
].
AocVa
;

641 
pAd
->
TxBufS
[
num
].
AocSize
 = 
TX_RING_SIZE
 * 
TX_DMA_1ST_BUFFER_SIZE
;

642 
	`RTMP_AoFTxBufr
(

643 
pAd
,

644 
num
,

645 
pAd
->
TxBufS
[
num
].
AocSize
,

646 
FALSE
,

647 &
pAd
->
TxBufS
[
num
].
AocVa
,

648 &
pAd
->
TxBufS
[
num
].
AocPa
);

650 i(
pAd
->
TxBufS
[
num
].
AocVa
 =
NULL
)

652 
EVue
 = 
ERRLOG_OUT_OF_SHARED_MEMORY
;

653 
	`DBGPRINT_ERR
(("Failedollocate big buffer\n"));

654 
Stus
 = 
NDIS_STATUS_RESOURCES
;

659 
	`NdisZoMemy
(
pAd
->
TxBufS
[
num
].
AocVa
,Ad->TxBufS[num].
AocSize
);

662 
BufBaPaHigh
 = 
	`RTMP_GPhysilAddssHigh
(
pAd
->
TxBufS
[
num
].
AocPa
);

663 
BufBaPaLow
 = 
	`RTMP_GPhysilAddssLow
 (
pAd
->
TxBufS
[
num
].
AocPa
);

664 
BufBaVa
 = 
pAd
->
TxBufS
[
num
].
AocVa
;

669 
pTxRg
 = &
pAd
->
TxRg
[
num
];

670 
dex
 = 0; index < 
TX_RING_SIZE
; index++)

672 
pTxRg
->
Cl
[
dex
].
pNdisPack
 = 
NULL
;

673 
pTxRg
->
Cl
[
dex
].
pNextNdisPack
 = 
NULL
;

675 
pTxRg
->
Cl
[
dex
].
AocSize
 = 
TXD_SIZE
;

676 
pTxRg
->
Cl
[
dex
].
AocVa
 = 
RgBaVa
;

677 
	`RTMP_SPhysilAddssHigh
(
pTxRg
->
Cl
[
dex
].
AocPa
, 
RgBaPaHigh
);

678 
	`RTMP_SPhysilAddssLow
 (
pTxRg
->
Cl
[
dex
].
AocPa
, 
RgBaPaLow
);

681 
pDmaBuf
 = &
pTxRg
->
Cl
[
dex
].
DmaBuf
;

682 
pDmaBuf
->
AocSize
 = 
TX_DMA_1ST_BUFFER_SIZE
;

683 
pDmaBuf
->
AocVa
 = 
BufBaVa
;

684 
	`RTMP_SPhysilAddssHigh
(
pDmaBuf
->
AocPa
, 
BufBaPaHigh
);

685 
	`RTMP_SPhysilAddssLow
(
pDmaBuf
->
AocPa
, 
BufBaPaLow
);

688 
pTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
dex
].
AocVa
;

689 
pTxD
->
SDP0
 = 
BufBaPaLow
;

691 
pTxD
->
DMADONE
 = 1;

692 #ifde
RT_BIG_ENDIAN


693 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

695 
RgBaPaLow
 +
TXD_SIZE
;

696 
RgBaVa
 = (
PUCHAR
RgBaV+ 
TXD_SIZE
;

699 
BufBaPaLow
 +
TX_DMA_1ST_BUFFER_SIZE
;

700 
BufBaVa
 = (
PUCHAR
BufBaV+ 
TX_DMA_1ST_BUFFER_SIZE
;

702 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("TxRg[%d]:ٮ %dryod\n", 
num
, 
dex
));

704 i(
Stus
 =
NDIS_STATUS_RESOURCES
)

710 
pAd
->
MgmtDescRg
.
AocSize
 = 
MGMT_RING_SIZE
 * 
TXD_SIZE
;

711 
	`RTMP_AoMgmtDescMemy
(

712 
pAd
,

713 
pAd
->
MgmtDescRg
.
AocSize
,

714 
FALSE
,

715 &
pAd
->
MgmtDescRg
.
AocVa
,

716 &
pAd
->
MgmtDescRg
.
AocPa
);

718 i(
pAd
->
MgmtDescRg
.
AocVa
 =
NULL
)

720 
EVue
 = 
ERRLOG_OUT_OF_SHARED_MEMORY
;

721 
	`DBGPRINT_ERR
(("Failedollocate big buffer\n"));

722 
Stus
 = 
NDIS_STATUS_RESOURCES
;

727 
	`NdisZoMemy
(
pAd
->
MgmtDescRg
.
AocVa
,Ad->MgmtDescRg.
AocSize
);

730 
RgBaPaHigh
 = 
	`RTMP_GPhysilAddssHigh
(
pAd
->
MgmtDescRg
.
AocPa
);

731 
RgBaPaLow
 = 
	`RTMP_GPhysilAddssLow
 (
pAd
->
MgmtDescRg
.
AocPa
);

732 
RgBaVa
 = 
pAd
->
MgmtDescRg
.
AocVa
;

737 
dex
 = 0; index < 
MGMT_RING_SIZE
; index++)

739 
pAd
->
MgmtRg
.
Cl
[
dex
].
pNdisPack
 = 
NULL
;

740 
pAd
->
MgmtRg
.
Cl
[
dex
].
pNextNdisPack
 = 
NULL
;

742 
pAd
->
MgmtRg
.
Cl
[
dex
].
AocSize
 = 
TXD_SIZE
;

743 
pAd
->
MgmtRg
.
Cl
[
dex
].
AocVa
 = 
RgBaVa
;

744 
	`RTMP_SPhysilAddssHigh
(
pAd
->
MgmtRg
.
Cl
[
dex
].
AocPa
, 
RgBaPaHigh
);

745 
	`RTMP_SPhysilAddssLow
 (
pAd
->
MgmtRg
.
Cl
[
dex
].
AocPa
, 
RgBaPaLow
);

748 
RgBaPaLow
 +
TXD_SIZE
;

749 
RgBaVa
 = (
PUCHAR
RgBaV+ 
TXD_SIZE
;

752 
pTxD
 = (
PTXD_STRUC

pAd
->
MgmtRg
.
Cl
[
dex
].
AocVa
;

753 
pTxD
->
DMADONE
 = 1;

755 #ifde
RT_BIG_ENDIAN


756 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

760 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MGMT Rg:ٮ %dryod\n", 
dex
));

765 
pAd
->
RxDescRg
.
AocSize
 = 
RX_RING_SIZE
 * 
RXD_SIZE
;

766 
	`RTMP_AoRxDescMemy
(

767 
pAd
,

768 
pAd
->
RxDescRg
.
AocSize
,

769 
FALSE
,

770 &
pAd
->
RxDescRg
.
AocVa
,

771 &
pAd
->
RxDescRg
.
AocPa
);

773 i(
pAd
->
RxDescRg
.
AocVa
 =
NULL
)

775 
EVue
 = 
ERRLOG_OUT_OF_SHARED_MEMORY
;

776 
	`DBGPRINT_ERR
(("Failedollocate big buffer\n"));

777 
Stus
 = 
NDIS_STATUS_RESOURCES
;

782 
	`NdisZoMemy
(
pAd
->
RxDescRg
.
AocVa
,Ad->RxDescRg.
AocSize
);

785 
	`DBGPRINT
(
RT_DEBUG_OFF
,

786 ("RX DESC % siz%ld\n", 
pAd
->
RxDescRg
.
AocVa
,Ad->RxDescRg.
AocSize
));

789 
RgBaPaHigh
 = 
	`RTMP_GPhysilAddssHigh
(
pAd
->
RxDescRg
.
AocPa
);

790 
RgBaPaLow
 = 
	`RTMP_GPhysilAddssLow
 (
pAd
->
RxDescRg
.
AocPa
);

791 
RgBaVa
 = 
pAd
->
RxDescRg
.
AocVa
;

796 
dex
 = 0; index < 
RX_RING_SIZE
; index++)

799 
pAd
->
RxRg
.
Cl
[
dex
].
AocSize
 = 
RXD_SIZE
;

800 
pAd
->
RxRg
.
Cl
[
dex
].
AocVa
 = 
RgBaVa
;

801 
	`RTMP_SPhysilAddssHigh
(
pAd
->
RxRg
.
Cl
[
dex
].
AocPa
, 
RgBaPaHigh
);

802 
	`RTMP_SPhysilAddssLow
 (
pAd
->
RxRg
.
Cl
[
dex
].
AocPa
, 
RgBaPaLow
);

807 
RgBaPaLow
 +
RXD_SIZE
;

808 
RgBaVa
 = (
PUCHAR
RgBaV+ 
RXD_SIZE
;

811 
pDmaBuf
 = &
pAd
->
RxRg
.
Cl
[
dex
].
DmaBuf
;

812 
pDmaBuf
->
AocSize
 = 
RX_BUFFER_AGGRESIZE
;

813 
pPack
 = 
	`RTMP_AoRxPackBufr
(

814 
pAd
,

815 
pDmaBuf
->
AocSize
,

816 
FALSE
,

817 &
pDmaBuf
->
AocVa
,

818 &
pDmaBuf
->
AocPa
);

821 
pAd
->
RxRg
.
Cl
[
dex
].
pNdisPack
 = 
pPack
;

824 i(
pDmaBuf
->
AocVa
 =
NULL
)

826 
EVue
 = 
ERRLOG_OUT_OF_SHARED_MEMORY
;

827 
	`DBGPRINT_ERR
(("Failedollocate RxRing's 1st buffer\n"));

828 
Stus
 = 
NDIS_STATUS_RESOURCES
;

833 
	`NdisZoMemy
(
pDmaBuf
->
AocVa
,DmaBuf->
AocSize
);

836 
pRxD
 = (
PRXD_STRUC

pAd
->
RxRg
.
Cl
[
dex
].
AocVa
;

837 
pRxD
->
SDP0
 = 
	`RTMP_GPhysilAddssLow
(
pDmaBuf
->
AocPa
);

838 
pRxD
->
DDONE
 = 0;

840 #ifde
RT_BIG_ENDIAN


841 
	`RTMPDestEndnChge
((
PUCHAR
)
pRxD
, 
TYPE_RXD
);

845 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Rx Rg:ٮ %dryod\n", 
dex
));

847 } 
FALSE
);

850 
	`NdisZoMemy
(&
pAd
->
FgFme
, (
FRAGMENT_FRAME
));

851 
pAd
->
FgFme
.
pFgPack
 = 
	`RTMP_AoFgPackBufr
Ad, 
RX_BUFFER_NORMSIZE
);

853 i(
pAd
->
FgFme
.
pFgPack
 =
NULL
)

855 
Stus
 = 
NDIS_STATUS_RESOURCES
;

858 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

861 
	`NdisWreELogEry
(

862 
pAd
->
AdrHd
,

863 
NDIS_ERROR_CODE_OUT_OF_RESOURCES
,

865 
EVue
);

870 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> NICInitTxRxRingAndBacklogQueue\n"));

881 
dex
 = 0; index < 
NUM_OF_TX_RING
; index++)

883 
	`InlizeQueueHd
(&
pAd
->
TxSwQueue
[
dex
]);

885 
pAd
->
TxRg
[
dex
].
TxSwFeIdx
 = 0;

886 
pAd
->
TxRg
[
dex
].
TxCpuIdx
 = 0;

891 
pAd
->
RxRg
.
RxSwRdIdx
 = 0;

892 
pAd
->
RxRg
.
RxCpuIdx
 = 
RX_RING_SIZE
 - 1;

897 
pAd
->
MgmtRg
.
TxSwFeIdx
 = 0;

898 
pAd
->
MgmtRg
.
TxCpuIdx
 = 0;

900 
pAd
->
PriveInfo
.
TxRgFuC
 = 0;

902 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- NICInitTxRxRingAndBacklogQueue\n"));

905 
	`DBGPRINT_S
(
Stus
, ("<-- RTMPAllocTxRxRingMemory, Status=%x\n", Status));

906  
Stus
;

907 
	}
}

912 
VOID
 
	$RTMPFeTxRxRgMemy
(

913 
IN
 
PRTMP_ADAPTER
 
pAd
)

915 
dex
, 
num
 , 
j
;

916 
PRTMP_TX_RING
 
pTxRg
;

917 
PTXD_STRUC
 
pTxD
;

918 
PNDIS_PACKET
 
pPack
;

919 
IrqFgs
;

923 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> RTMPFreeTxRxRingMemory\n"));

926 
dex
=0; index <
NUM_OF_TX_RING
; index++)

928 
PQUEUE_ENTRY
 
pEry
;

929 
PNDIS_PACKET
 
pPack
;

930 
PQUEUE_HEADER
 
pQueue
;

932 
	`RTMP_IRQ_LOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

933 
pQueue
 = &
pAd
->
TxSwQueue
[
dex
];

934 
pQueue
->
Hd
)

936 
pEry
 = 
	`RemoveHdQueue
(
pQueue
);

937 
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pEry
);

938 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

940 
	`RTMP_IRQ_UNLOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

944 
dex
=0;dex< 
NUM_OF_TX_RING
;index++)

946 
pTxRg
 = &
pAd
->
TxRg
[
dex
];

948 
j
=0; j< 
TX_RING_SIZE
; j++)

950 
pTxD
 = (
PTXD_STRUC
(
pTxRg
->
Cl
[
j
].
AocVa
);

951 
pPack
 = 
pTxRg
->
Cl
[
j
].
pNdisPack
;

953 i(
pPack
)

955 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP0
,TxD->
SDL0
, 
PCI_DMA_TODEVICE
);

956 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

959 
pTxRg
->
Cl
[
j
].
pNdisPack
 = 
NULL
;

961 
pPack
 = 
pTxRg
->
Cl
[
j
].
pNextNdisPack
;

963 i(
pPack
)

965 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

966 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

969 
pTxRg
->
Cl
[pTxRg->
TxSwFeIdx
].
pNextNdisPack
 = 
NULL
;

974 
dex
 = 
RX_RING_SIZE
 - 1 ; index >= 0; index--)

976 i((
pAd
->
RxRg
.
Cl
[
dex
].
DmaBuf
.
AocVa
&& (pAd->RxRg.Cl[dex].
pNdisPack
))

978 
	`PCI_UNMAP_SINGLE
(
pAd
,Ad->
RxRg
.
Cl
[
dex
].
DmaBuf
.
AocPa
,Ad->RxRg.Cl[dex].DmaBuf.
AocSize
, 
PCI_DMA_FROMDEVICE
);

979 
	`RELEASE_NDIS_PACKET
(
pAd
,Ad->
RxRg
.
Cl
[
dex
].
pNdisPack
, 
NDIS_STATUS_SUCCESS
);

982 
	`NdisZoMemy
(
pAd
->
RxRg
.
Cl
, 
RX_RING_SIZE
 * (
RTMP_DMACB
));

984 i(
pAd
->
RxDescRg
.
AocVa
)

986 
	`RTMP_FeDescMemy
(
pAd
,Ad->
RxDescRg
.
AocSize
,Ad->RxDescRg.
AocVa
,Ad->RxDescRg.
AocPa
);

988 
	`NdisZoMemy
(&
pAd
->
RxDescRg
, (
RTMP_DMABUF
));

990 i(
pAd
->
MgmtDescRg
.
AocVa
)

992 
	`RTMP_FeDescMemy
(
pAd
,Ad->
MgmtDescRg
.
AocSize
,Ad->MgmtDescRg.
AocVa
,Ad->MgmtDescRg.
AocPa
);

994 
	`NdisZoMemy
(&
pAd
->
MgmtDescRg
, (
RTMP_DMABUF
));

996 
num
 = 0;um < 
NUM_OF_TX_RING
;um++)

998 i(
pAd
->
TxBufS
[
num
].
AocVa
)

1000 
	`RTMP_FeFTxBufr
(
pAd
,Ad->
TxBufS
[
num
].
AocSize
, 
FALSE
,Ad->TxBufS[num].
AocVa
,Ad->TxBufS[num].
AocPa
);

1002 
	`NdisZoMemy
(&
pAd
->
TxBufS
[
num
], (
RTMP_DMABUF
));

1004 i(
pAd
->
TxDescRg
[
num
].
AocVa
)

1006 
	`RTMP_FeDescMemy
(
pAd
,Ad->
TxDescRg
[
num
].
AocSize
,Ad->TxDescRg[num].
AocVa
,Ad->TxDescRg[num].
AocPa
);

1008 
	`NdisZoMemy
(&
pAd
->
TxDescRg
[
num
], (
RTMP_DMABUF
));

1011 i(
pAd
->
FgFme
.
pFgPack
)

1012 
	`RELEASE_NDIS_PACKET
(
pAd
,Ad->
FgFme
.
pFgPack
, 
NDIS_STATUS_SUCCESS
);

1014 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- RTMPFreeTxRxRingMemory\n"));

1015 
	}
}

1040 
VOID
 
	$RTMPRgC˪Up
(

1041 
IN
 
PRTMP_ADAPTER
 
pAd
,

1042 
IN
 
UCHAR
 
RgTy
)

1044 
PTXD_STRUC
 
pTxD
;

1045 
PRXD_STRUC
 
pRxD
;

1046 
PQUEUE_ENTRY
 
pEry
;

1047 
PNDIS_PACKET
 
pPack
;

1048 
i
;

1049 
PRTMP_TX_RING
 
pTxRg
;

1050 
IrqFgs
;

1054 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RTMPRgC˪Up(RgIdx=%d, Pdg-NDIS=%ld)\n", 
RgTy
, 
pAd
->
RkCous
.
PdgNdisPackCou
));

1055 
RgTy
)

1057 
QID_AC_BK
:

1058 
QID_AC_BE
:

1059 
QID_AC_VI
:

1060 
QID_AC_VO
:

1061 
QID_HCCA
:

1063 
pTxRg
 = &
pAd
->
TxRg
[
RgTy
];

1065 
	`RTMP_IRQ_LOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

1067 
i
=0; i<
TX_RING_SIZE
; i++)

1069 
pTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
i
].
AocVa
;

1071 
pPack
 = (
PNDIS_PACKET

pTxRg
->
Cl
[
i
].
pNdisPack
;

1073 i(
pPack
)

1075 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1076 
pTxRg
->
Cl
[
i
].
pNdisPack
 = 
NULL
;

1079 
pPack
 = (
PNDIS_PACKET

pTxRg
->
Cl
[
i
].
pNextNdisPack
;

1081 i(
pPack
)

1083 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1084 
pTxRg
->
Cl
[
i
].
pNextNdisPack
 = 
NULL
;

1088 
	`RTMP_IO_READ32
(
pAd
, 
TX_DTX_IDX0
 + 
RgTy
 * 0x10, &
pTxRg
->
TxDmaIdx
);

1089 
pTxRg
->
TxSwFeIdx
 =TxRg->
TxDmaIdx
;

1090 
pTxRg
->
TxCpuIdx
 =TxRg->
TxDmaIdx
;

1091 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_CTX_IDX0
 + 
RgTy
 * 0x10, 
pTxRg
->
TxCpuIdx
);

1093 
	`RTMP_IRQ_UNLOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

1095 
	`RTMP_IRQ_LOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

1096 
pAd
->
TxSwQueue
[
RgTy
].
Hd
 !
NULL
)

1098 
pEry
 = 
	`RemoveHdQueue
(&
pAd
->
TxSwQueue
[
RgTy
]);

1099 
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pEry
);

1100 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1101 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Release 1 NDISacket from s/w backlog queue\n"));

1103 
	`RTMP_IRQ_UNLOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

1106 
QID_MGMT
:

1108 
	`NdisAcqueSpLock
(&
pAd
->
MgmtRgLock
);

1110 
i
=0; i<
MGMT_RING_SIZE
; i++)

1112 
pTxD
 = (
PTXD_STRUC

pAd
->
MgmtRg
.
Cl
[
i
].
AocVa
;

1114 
pPack
 = (
PNDIS_PACKET

pAd
->
MgmtRg
.
Cl
[
i
].
pNdisPack
;

1116 i(
pPack
)

1118 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP0
,TxD->
SDL0
, 
PCI_DMA_TODEVICE
);

1119 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1121 
pAd
->
MgmtRg
.
Cl
[
i
].
pNdisPack
 = 
NULL
;

1123 
pPack
 = (
PNDIS_PACKET

pAd
->
MgmtRg
.
Cl
[
i
].
pNextNdisPack
;

1125 i(
pPack
)

1127 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

1128 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1130 
pAd
->
MgmtRg
.
Cl
[
i
].
pNextNdisPack
 = 
NULL
;

1134 
	`RTMP_IO_READ32
(
pAd
, 
TX_MGMTDTX_IDX
, &pAd->
MgmtRg
.
TxDmaIdx
);

1135 
pAd
->
MgmtRg
.
TxSwFeIdx
 =Ad->MgmtRg.
TxDmaIdx
;

1136 
pAd
->
MgmtRg
.
TxCpuIdx
 =Ad->MgmtRg.
TxDmaIdx
;

1137 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_MGMTCTX_IDX
,Ad->
MgmtRg
.
TxCpuIdx
);

1139 
	`NdisRSpLock
(&
pAd
->
MgmtRgLock
);

1140 
pAd
->
RkCous
.
MgmtRgFuCou
 = 0;

1143 
QID_RX
:

1145 
	`NdisAcqueSpLock
(&
pAd
->
RxRgLock
);

1147 
i
=0; i<
RX_RING_SIZE
; i++)

1149 
pRxD
 = (
PRXD_STRUC

pAd
->
RxRg
.
Cl
[
i
].
AocVa
;

1150 
pRxD
->
DDONE
 = 0 ;

1153 
	`RTMP_IO_READ32
(
pAd
, 
RX_DRX_IDX
, &pAd->
RxRg
.
RxDmaIdx
);

1154 
pAd
->
RxRg
.
RxSwRdIdx
 =Ad->RxRg.
RxDmaIdx
;

1155 
pAd
->
RxRg
.
RxCpuIdx
 = (Ad->RxRg.
RxDmaIdx
 =0? (
RX_RING_SIZE
-1) : (pAd->RxRing.RxDmaIdx-1));

1156 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_CRX_IDX
,Ad->
RxRg
.
RxCpuIdx
);

1158 
	`NdisRSpLock
(&
pAd
->
RxRgLock
);

1164 
	}
}

1186 
VOID
 
	$RT28XXDMADib
(

1187 
IN
 
RTMP_ADAPTER
 *
pAd
)

1189 
WPDMA_GLO_CFG_STRUC
 
GloCfg
;

1192 
	`RTMP_IO_READ32
(
pAd
, 
WPDMA_GLO_CFG
, &
GloCfg
.
wd
);

1193 
GloCfg
.
wd
 &= 0xff0;

1194 
GloCfg
.
fld
.
EnTXWreBackDDONE
 =1;

1195 
	`RTMP_IO_WRITE32
(
pAd
, 
WPDMA_GLO_CFG
, 
GloCfg
.
wd
);

1196 
	}
}

1213 
VOID
 
	$RT28XXDMAEb
(

1214 
IN
 
RTMP_ADAPTER
 *
pAd
)

1216 
WPDMA_GLO_CFG_STRUC
 
GloCfg
;

1217 
i
 = 0;

1219 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 0x4);

1222 
	`RTMP_IO_READ32
(
pAd
, 
WPDMA_GLO_CFG
, &
GloCfg
.
wd
);

1223 i((
GloCfg
.
fld
.
TxDMABusy
 =0&& (GloCfg.fld.
RxDMABusy
 == 0))

1226 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==> DMABusy\n"));

1227 
	`RTMPucDay
(1000);

1228 
i
++;

1229 } 
i
 <200);

1231 
	`RTMPucDay
(50);

1233 
GloCfg
.
fld
.
EnTXWreBackDDONE
 = 1;

1234 
GloCfg
.
fld
.
WPDMABurSIZE
 = 2;

1235 
GloCfg
.
fld
.
EbRxDMA
 = 1;

1236 
GloCfg
.
fld
.
EbTxDMA
 = 1;

1238 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=WRITE DMA off0x208 = 0x%x\n", 
GloCfg
.
wd
));

1239 
	`RTMP_IO_WRITE32
(
pAd
, 
WPDMA_GLO_CFG
, 
GloCfg
.
wd
);

1241 
	}
}

1244 
BOOLEAN
 
	$AsicCheckCommOk
(

1245 
IN
 
PRTMP_ADAPTER
 
pAd
,

1246 
IN
 
UCHAR
 
Commd
)

1248 
UINT32
 
CmdStus
 = 0, 
CID
 = 0, 
i
;

1249 
UINT32
 
ThisCIDMask
 = 0;

1251 
i
 = 0;

1254 
	`RTMP_IO_READ32
(
pAd
, 
H2M_MAILBOX_CID
, &
CID
);

1256 i((
CID
 & 
CID0MASK
=
Commd
)

1258 
ThisCIDMask
 = 
CID0MASK
;

1261 i((((
CID
 & 
CID1MASK
)>>8& 0xff=
Commd
)

1263 
ThisCIDMask
 = 
CID1MASK
;

1266 i((((
CID
 & 
CID2MASK
)>>16& 0xff=
Commd
)

1268 
ThisCIDMask
 = 
CID2MASK
;

1271 i((((
CID
 & 
CID3MASK
)>>24& 0xff=
Commd
)

1273 
ThisCIDMask
 = 
CID3MASK
;

1277 
	`RTMPucDay
(100);

1278 
i
++;

1279 }
i
 < 200);

1282 
	`RTMP_IO_READ32
(
pAd
, 
H2M_MAILBOX_STATUS
, &
CmdStus
);

1285 i(
i
 < 200)

1288 i(((
CmdStus
 & 
ThisCIDMask
) == 0x1) || ((CmdStatus & ThisCIDMask) == 0x100)

1289 || ((
CmdStus
 & 
ThisCIDMask
) == 0x10000) || ((CmdStatus & ThisCIDMask) == 0x1000000))

1291 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> AsicCheckCommOk CID = 0x%x, CmdStus0x%x \n", 
CID
, 
CmdStus
));

1292 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_MAILBOX_STATUS
, 0xffffffff);

1293 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_MAILBOX_CID
, 0xffffffff);

1294  
TRUE
;

1296 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> AsicCheckCommFa1 CID = 0x%x, CmdStus0x%x \n", 
CID
, 
CmdStus
));

1300 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> AsicCheckCommFa2 TimeouCommd = %d, CmdStus0x%x \n", 
Commd
, 
CmdStus
));

1303 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_MAILBOX_STATUS
, 0xffffffff);

1304 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_MAILBOX_CID
, 0xffffffff);

1306  
FALSE
;

1307 
	}
}

1324 
VOID
 
	$RT28xx_UpdeBcToAsic
(

1325 
IN
 
RTMP_ADAPTER
 *
pAd
,

1326 
IN
 
INT
 
idx
,

1327 
IN
 
ULONG
 
FmeL
,

1328 
IN
 
ULONG
 
UpdePos
)

1330 
ULONG
 
CInfoPos
 = 0;

1331 
UCHAR
 *
r
, *
r_upde
, *
r_pfo
;

1332 
UINT
 
i
;

1333 
BOOLEAN
 
bBReq
 = 
FALSE
;

1334 
UCHAR
 
b_idx
 = 0;

1336 #ifde
SPECIFIC_BCN_BUF_SUPPORT


1337 
qFg
;

1341 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s(: Nvid I bfound.\n", 
__FUNCTION__
));

1345 i(
bBReq
 =
FALSE
)

1347 #ifde
SPECIFIC_BCN_BUF_SUPPORT


1348 
	`RTMP_MAC_SHR_MSEL_LOCK
(
pAd
, 
HIGHER_SHRMEM
, 
qFg
);

1353 
i
=0; i<
TXWI_SIZE
; i+=4)

1354 
	`RTMP_IO_WRITE32
(
pAd
,Ad->
BcOfft
[
b_idx
] + 
i
, 0x00);

1356 #ifde
SPECIFIC_BCN_BUF_SUPPORT


1357 
	`RTMP_MAC_SHR_MSEL_UNLOCK
(
pAd
, 
LOWER_SHRMEM
, 
qFg
);

1362 
r
 = (
PUCHAR
)&
pAd
->
BcTxWI
;

1363 #ifde
RT_BIG_ENDIAN


1364 
	`RTMPWIEndnChge
(
r
, 
TYPE_TXWI
);

1368 #ifde
SPECIFIC_BCN_BUF_SUPPORT


1372 
	`RTMP_MAC_SHR_MSEL_LOCK
(
pAd
, 
HIGHER_SHRMEM
, 
qFg
);

1375 
i
=0; i<
TXWI_SIZE
; i+=4)

1377 
UINT32
 
lgr
 = *
r
 + (*(ptr+1)<<8) + (*(ptr+2)<<16) + (*(ptr+3)<<24);

1378 
	`RTMP_IO_WRITE32
(
pAd
,Ad->
BcOfft
[
b_idx
] + 
i
, 
lgr
);

1379 
r
 += 4;

1383 
i
 = 
CInfoPos
; i < (CapInfoPos+2); i++)

1385 
	`RTMP_IO_WRITE8
(
pAd
,Ad->
BcOfft
[
b_idx
] + 
TXWI_SIZE
 + 
i
, *
r_pfo
);

1386 
r_pfo
 ++;

1389 i(
FmeL
 > 
UpdePos
)

1391 
i

UpdePos
; i< (
FmeL
); i++)

1393 
	`RTMP_IO_WRITE8
(
pAd
,Ad->
BcOfft
[
b_idx
] + 
TXWI_SIZE
 + 
i
, *
r_upde
);

1394 
r_upde
 ++;

1399 #ifde
SPECIFIC_BCN_BUF_SUPPORT


1403 
	`RTMP_MAC_SHR_MSEL_UNLOCK
(
pAd
, 
LOWER_SHRMEM
, 
qFg
);

1407 
	}
}

1410 #ifde
CONFIG_STA_SUPPORT


1411 
VOID
 
	$RT28xxPciSAsicFWakeup
(

1412 
IN
 
PRTMP_ADAPTER
 
pAd
,

1413 
IN
 
BOOLEAN
 
bFromTx
)

1415 
AUTO_WAKEUP_STRUC
 
AutoWakeupCfg
;

1417 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

1420 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_WAKEUP_NOW
))

1422 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("waking upow!\n"));

1426 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_WAKEUP_NOW
);

1429 #ifde
PCIE_PS_SUPPORT


1430 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)

1431 &&
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)

1434 i(
bFromTx
 =
TRUE


1435 &&(
pAd
->
Mlme
.
bPsPlTimRug
 =
TRUE
))

1437 
pAd
->
Mlme
.
bPsPlTimRug
 = 
FALSE
;

1438 
	`RTMPPCIeLkClVueRee
(
pAd
, 
RESTORE_WAKEUP
);

1439 
	`RTMPucDay
(3000);

1440 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("=======AsicForceWakeup===bFromTx\n"));

1443 
AutoWakeupCfg
.
wd
 = 0;

1444 
	`RTMP_IO_WRITE32
(
pAd
, 
AUTO_WAKEUP_CFG
, 
AutoWakeupCfg
.
wd
);

1446 i(
	`RT28xxPciAsicRadioOn
(
pAd
, 
DOT11POWERSAVE
))

1451 i(
	`INFRA_ON
(
pAd
&& (pAd->
CommCfg
.
CChl
 !pAd->CommCfg.
Chl
)

1452 && (
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
))

1455 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

1456 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

1461 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

1462 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

1471 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<==RT28xxPciStaAsicForceWakeup::Original PCI Power Saving\n"));

1472 
	`AsicSdCommdToMcu
(
pAd
, 0x31, 0xff, 0x00, 0x02);

1473 
AutoWakeupCfg
.
wd
 = 0;

1474 
	`RTMP_IO_WRITE32
(
pAd
, 
AUTO_WAKEUP_CFG
, 
AutoWakeupCfg
.
wd
);

1477 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_DOZE
);

1478 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_WAKEUP_NOW
);

1479 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=======RT28xxPciStaAsicForceWakeup\n"));

1480 
	}
}

1483 
VOID
 
	$RT28xxPciSAsicS˕ThAutoWakeup
(

1484 
IN
 
PRTMP_ADAPTER
 
pAd
,

1485 
IN
 
USHORT
 
TbNumToNextWakeUp
)

1487 #ifde
PCIE_PS_SUPPORT


1488 
BOOLEAN
 
brc
;

1491 i(
pAd
->
SCfg
.
bRadio
 =
FALSE
)

1493 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_DOZE
);

1496 #ifde
PCIE_PS_SUPPORT


1497 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)

1498 &&
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)

1500 
ULONG
 
Now
 = 0;

1501 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_WAKEUP_NOW
))

1503 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("waking upow!\n"));

1504 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_DOZE
);

1508 
	`NdisGSyemUpTime
(&
Now
);

1511 i(((
pAd
->
Mlme
.
LaSdNULLpsmTime
 + 8>
Now
) && (pAd->Mlme.LastSendNULLpsmTime <= Now))

1513 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Now = %lu, LaSdNULLpsmTime=%lu : RxCouSLaNULL = %lu. \n", 
Now
, 
pAd
->
Mlme
.
LaSdNULLpsmTime
,Ad->
RkCous
.
RxCouSLaNULL
));

1516 i((
pAd
->
RkCous
.
RxCouSLaNULL
 > 0&& (Ad->
Mlme
.
LaSdNULLpsmTime
 +Ad->
CommCfg
.
BcPiod
>
Now
))

1518 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Now = %lu, LaSdNULLpsmTime=%lu: RxCouSLaNULL = %lu > 0 \n", 
Now
, 
pAd
->
Mlme
.
LaSdNULLpsmTime
,Ad->
RkCous
.
RxCouSLaNULL
));

1522 
brc
 = 
	`RT28xxPciAsicRadioOff
(
pAd
, 
DOT11POWERSAVE
, 
TbNumToNextWakeUp
);

1523 i(
brc
==
TRUE
)

1524 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_DOZE
);

1529 
AUTO_WAKEUP_STRUC
 
AutoWakeupCfg
;

1531 i(
TbNumToNextWakeUp
 == 0)

1532 
TbNumToNextWakeUp
 = 1;

1536 
AutoWakeupCfg
.
wd
 = 0;

1537 
	`RTMP_IO_WRITE32
(
pAd
, 
AUTO_WAKEUP_CFG
, 
AutoWakeupCfg
.
wd
);

1538 
AutoWakeupCfg
.
fld
.
NumofS˕gTb
 = 
TbNumToNextWakeUp
 - 1;

1539 
AutoWakeupCfg
.
fld
.
EbAutoWakeup
 = 1;

1540 
AutoWakeupCfg
.
fld
.
AutoLdTime
 = 5;

1541 
	`RTMP_IO_WRITE32
(
pAd
, 
AUTO_WAKEUP_CFG
, 
AutoWakeupCfg
.
wd
);

1542 
	`AsicSdCommdToMcu
(
pAd
, 0x30, 0xff, 0xff, 0x00);

1543 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_DOZE
);

1544 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- %s, TbNumToNextWakeUp=%d \n", 
__FUNCTION__
, 
TbNumToNextWakeUp
));

1547 
	}
}

1549 #ifde
PCIE_PS_SUPPORT


1550 
VOID
 
	$PsPlWakeExec
(

1551 
IN
 
PVOID
 
SyemScific1
,

1552 
IN
 
PVOID
 
FuniCڋxt
,

1553 
IN
 
PVOID
 
SyemScific2
,

1554 
IN
 
PVOID
 
SyemScific3
)

1556 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

1557 
ags
;

1559 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("-->PsPollWakeExec \n"));

1561 
	`RTMP_INT_LOCK
(&
pAd
->
q_lock
, 
ags
);

1562 i(
pAd
->
Mlme
.
bPsPlTimRug
)

1564 
	`RTMPPCIeLkClVueRee
(
pAd
, 
RESTORE_WAKEUP
);

1566 
pAd
->
Mlme
.
bPsPlTimRug
 = 
FALSE
;

1567 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

1568 
	}
}

1571 
VOID
 
	$RadioOnExec
(

1572 
IN
 
PVOID
 
SyemScific1
,

1573 
IN
 
PVOID
 
FuniCڋxt
,

1574 
IN
 
PVOID
 
SyemScific2
,

1575 
IN
 
PVOID
 
SyemScific3
)

1577 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

1578 
RTMP_CHIP_OP
 *
pChOps
 = &
pAd
->
chOps
;

1579 
WPDMA_GLO_CFG_STRUC
 
DmaCfg
;

1580 
BOOLEAN
 
Ced
;

1582 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

1584 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("-->RadioOnExec()eturn on fOP_STATUS_DOZE == TRUE; \n"));

1585 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)

1586 &&
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)

1587 
	`RTMPSTim
(&
pAd
->
Mlme
.
RadioOnOffTim
, 10);

1591 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

1593 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("-->RadioOnExec()eturn on SCAN_IN_PROGRESS; \n"));

1596 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)

1597 &&
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)

1598 
	`RTMPSTim
(&
pAd
->
Mlme
.
RadioOnOffTim
, 10);

1602 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)

1603 &&
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)

1605 
pAd
->
Mlme
.
bPsPlTimRug
 = 
FALSE
;

1606 
	`RTMPClTim
(&
pAd
->
Mlme
.
PsPlTim
, &
Ced
);

1610 i(
pAd
->
SCfg
.
bRadio
 =
TRUE
)

1612 
pAd
->
bPCIkOff
 = 
FALSE
;

1613 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_BK
);

1614 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_BE
);

1615 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_VI
);

1616 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_VO
);

1617 
	`RTMPRgC˪Up
(
pAd
, 
QID_HCCA
);

1618 
	`RTMPRgC˪Up
(
pAd
, 
QID_MGMT
);

1619 
	`RTMPRgC˪Up
(
pAd
, 
QID_RX
);

1622 
	`AsicSdCommdToMcu
(
pAd
, 0x31, 
PowWakeCID
, 0x00, 0x02);

1624 
	`AsicCheckCommOk
(
pAd
, 
PowWakeCID
);

1628 
	`RTMP_ASIC_INTERRUPT_ENABLE
(
pAd
);

1631 
	`RTMP_IO_READ32
(
pAd
, 
WPDMA_GLO_CFG
, &
DmaCfg
.
wd
);

1632 
DmaCfg
.
fld
.
EbTxDMA
 = 1;

1633 
	`RTMP_IO_WRITE32
(
pAd
, 
WPDMA_GLO_CFG
, 
DmaCfg
.
wd
);

1636 i(
	`INFRA_ON
(
pAd
&& (pAd->
CommCfg
.
CChl
 !pAd->CommCfg.
Chl
)

1637 && (
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
))

1640 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

1641 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

1646 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

1647 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

1650 i(
pChOps
->
AsicRevRfFromS˕Mode
)

1651 
pChOps
->
	`AsicRevRfFromS˕Mode
(
pAd
);

1654 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
);

1656 #ifde
LED_CONTROL_SUPPORT


1658 
	`RTMPSLED
(
pAd
, 
LED_RADIO_ON
);

1661 i(
pAd
->
SCfg
.
Psm
 =
PWR_ACTIVE
)

1663 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
,Ad->
SCfg
.
BBPR3
);

1668 
	`RT28xxPciAsicRadioOff
(
pAd
, 
GUIRADIO_OFF
, 0);

1670 
	}
}

1686 
BOOLEAN
 
	$RT28xxPciAsicRadioOn
(

1687 
IN
 
PRTMP_ADAPTER
 
pAd
,

1688 
IN
 
UCHAR
 
Lev
)

1691 #ifde
CONFIG_STA_SUPPORT


1692 #ifde
PCIE_PS_SUPPORT


1693 
BOOLEAN
 
Ced
;

1698 i(
pAd
->
OpMode
 =
OPMODE_AP
 && 
Lev
==
DOT11POWERSAVE
)

1699  
FALSE
;

1701 #ifde
CONFIG_STA_SUPPORT


1702 #ifde
PCIE_PS_SUPPORT


1703 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

1705 i(
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)

1707 
pAd
->
Mlme
.
bPsPlTimRug
 = 
FALSE
;

1708 
	`RTMPClTim
(&
pAd
->
Mlme
.
PsPlTim
, &
Ced
);

1710 i((
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)&&

1711 ((
Lev
 =
GUIRADIO_OFF
|| (Lev =
GUI_IDLE_POWER_SAVE
))

1712 ||(
	`RTMP_TEST_PSFLAG
(
pAd
, 
fRTMP_PS_SET_PCI_CLK_OFF_COMMAND
)))

1722 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RT28xxPciAsicRadioOn ()\n"));

1724 
	`RTMPPCIeLkClVueRee
(
pAd
, 
RESTORE_WAKEUP
);

1725 
	`RTMPucDay
(6000);

1731 
pAd
->
bPCIkOff
 = 
FALSE
;

1732 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PSM :309xbPCIkOf=%d\n", 
pAd
->
bPCIkOff
));

1739 
	`AsicSdCommdToMcu
(
pAd
, 0x31, 
PowWakeCID
, 0x00, 0x02);

1740 
pAd
->
bPCIkOff
 = 
FALSE
;

1742 
	`AsicCheckCommOk
(
pAd
, 
PowWakeCID
);

1743 
	`RTMP_ASIC_INTERRUPT_ENABLE
(
pAd
);

1746 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
);

1747 i(
Lev
 =
GUI_IDLE_POWER_SAVE
)

1752 #ifde
CONFIG_STA_SUPPORT


1753 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1755 i(
	`INFRA_ON
(
pAd
&& (pAd->
CommCfg
.
CChl
 !pAd->CommCfg.
Chl
)

1756 && (
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
))

1759 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

1760 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

1765 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

1766 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

1772  
TRUE
;

1774 
	}
}

1789 
BOOLEAN
 
	$RT28xxPciAsicRadioOff
(

1790 
IN
 
PRTMP_ADAPTER
 
pAd
,

1791 
IN
 
UCHAR
 
Lev
,

1792 
IN
 
USHORT
 
TbNumToNextWakeUp
)

1794 #ifde
CONFIG_STA_SUPPORT


1795 
WPDMA_GLO_CFG_STRUC
 
DmaCfg
;

1796 
UCHAR
 
i
, 
mpBBP_R3
 = 0;

1797 #ifde
PCIE_PS_SUPPORT


1798 
ULONG
 
BcPiodTime
;

1799 
UINT32
 
PsPlTime
 = 0 ;

1800 
UINT32
 
TbTTTime
 = 0;

1801 
BOOLEAN
 
Ced
;

1804 #i
	`defed
(
CONFIG_STA_SUPPORT
|| defed(
RT2860
)

1805 
BOOLEAN
 
brc
 = 
FALSE
;

1807 
UINT32
 
RxDmaIdx
, 
RxCpuIdx
;

1808 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s ===> Lv= %d, TxCpuIdx = %d, TxDmaIdx = %d. RxCpuIdx = %d, RxDmaIdx = %d.\n",

1809 
__FUNCTION__
, 
Lev
,
pAd
->
TxRg
[0].
TxCpuIdx
,Ad->TxRg[0].
TxDmaIdx
,Ad->
RxRg
.
RxCpuIdx
,Ad->RxRg.
RxDmaIdx
));

1811 i(
pAd
->
OpMode
 =
OPMODE_AP
 && 
Lev
==
DOT11POWERSAVE
)

1812  
FALSE
;

1815 
	`RTMP_IO_READ32
(
pAd
, 
RX_DRX_IDX
 , &
RxDmaIdx
);

1816 
	`RTMP_IO_READ32
(
pAd
, 
RX_CRX_IDX
 , &
RxCpuIdx
);

1817 i((
RxDmaIdx
 > 
RxCpuIdx
&& ((RxDmaIdx - RxCpuIdx> 
RX_RING_SIZE
/3))

1819 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AsicRadioOf===>u1. RxDmaIdx = %d , RxCpuIdx = %d. \n", 
RxDmaIdx
, 
RxCpuIdx
));

1820  
FALSE
;

1822 i((
RxCpuIdx
 >
RxDmaIdx
&& ((RxCpuIdx - RxDmaIdx< 
RX_RING_SIZE
/3))

1824 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AsicRadioOf===>u2. RxCpuIdx = %d. RxDmaIdx = %d , \n", 
RxCpuIdx
, 
RxDmaIdx
));

1825  
FALSE
;

1830 #ifde
CONFIG_STA_SUPPORT


1831 #ifde
PCIE_PS_SUPPORT


1832 
	`RTMP_SET_PSFLAG
(
pAd
, 
fRTMP_PS_DISABLE_TX
);

1833 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)

1834 && 
pAd
->
OpMode
 =
OPMODE_STA


1835 &&
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE


1839 
	`RTMPClTim
(&
pAd
->
Mlme
.
RadioOnOffTim
, &
Ced
);

1840 
	`RTMPClTim
(&
pAd
->
Mlme
.
PsPlTim
, &
Ced
);

1842 i(
Lev
 =
DOT11POWERSAVE
)

1844 
	`RTMP_IO_READ32
(
pAd
, 
TBTT_TIMER
, &
TbTTTime
);

1845 
TbTTTime
 &= 0x1ffff;

1848 i(((64*
TbTTTime
<((
LEAD_TIME
*1024+ 40000)&& (
TbNumToNextWakeUp
 == 0))

1850 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("TbTTTim0x%x , givuthip. \n", 
TbTTTime
));

1851 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_DOZE
);

1853 
	`RTMP_CLEAR_PSFLAG
(
pAd
, 
fRTMP_PS_DISABLE_TX
);

1854  
FALSE
;

1858 
PsPlTime
 = (64*
TbTTTime
- 
LEAD_TIME
*1024)/1000;

1859 
PsPlTime
 -= 3;

1861 
BcPiodTime
 = 
pAd
->
CommCfg
.
BcPiod
*102/100;

1862 i(
TbNumToNextWakeUp
 > 0)

1863 
PsPlTime
 +((
TbNumToNextWakeUp
 -1* 
BcPiodTime
);

1865 
pAd
->
Mlme
.
bPsPlTimRug
 = 
TRUE
;

1866 
	`RTMPSTim
(&
pAd
->
Mlme
.
PsPlTim
, 
PsPlTime
);

1872 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RT28xxPciAsicRadioOff::Level!=DOT11POWERSAVE \n"));

1877 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
);

1879 #ifde
CONFIG_STA_SUPPORT


1881 i(
pAd
->
A
.
fld
.
RxPh
 > 1 &&Ad->
OpMode
 =
OPMODE_STA
)

1883 
mpBBP_R3
 = (
pAd
->
SCfg
.
BBPR3
 & 0xE7);

1884 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
mpBBP_R3
);

1889 i((
	`INFRA_ON
(
pAd
||Ad->
OpMode
 =
OPMODE_AP
&& (pAd->
CommCfg
.
CChl
 !pAd->CommCfg.
Chl
)

1890 && (
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
))

1893 
	`AsicTuOffRFClk
(
pAd
,Ad->
CommCfg
.
CChl
);

1898 
	`AsicTuOffRFClk
(
pAd
,Ad->
CommCfg
.
Chl
);

1901 i(
Lev
 !
RTMP_HALT
)

1905 
	`RTMP_IO_WRITE32
(
pAd
, 
INT_MASK_CSR
, 
AutoWakeupI
);

1909 
	`RTMP_ASIC_INTERRUPT_DISABLE
(
pAd
);

1913 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_CRX_IDX
,Ad->
RxRg
.
RxCpuIdx
);

1915 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_MAILBOX_STATUS
, 0xffffffff);

1916 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_MAILBOX_CID
, 0xffffffff);

1918 
	`AsicSdCommdToMcu
(
pAd
, 
SLEEP_MCU_CMD
, 
PowSaCID
, 0xff, 0x1);

1920 #ifde
RT2860


1922 i((
pAd
->
DeviID
 =
NIC2860_PCIe_DEVICE_ID
)

1923 ||(
pAd
->
DeviID
 =
NIC2790_PCIe_DEVICE_ID
))

1927 
brc
 = 
	`AsicCheckCommOk
(
pAd
, 
PowSaCID
);

1931 i((
Lev
 =
DOT11POWERSAVE
&& (
brc
 =
TRUE
))

1933 
	`AsicSdCommdToMcu
(
pAd
, 0x35, 
PowRadioOffCID
, 0, 0x00);

1935 
	`AsicCheckCommOk
(
pAd
, 
PowRadioOffCID
);

1937 i(
brc
 =
TRUE
)

1939 
	`AsicSdCommdToMcu
(
pAd
, 0x35, 
PowRadioOffCID
, 1, 0x00);

1941 
	`AsicCheckCommOk
(
pAd
, 
PowRadioOffCID
);

1946 #ifde
CONFIG_STA_SUPPORT


1948 
i
 = 0;

1951 
	`RTMP_IO_READ32
(
pAd
, 
WPDMA_GLO_CFG
, &
DmaCfg
.
wd
);

1952 i((
DmaCfg
.
fld
.
RxDMABusy
 =0&& (DmaCfg.fld.
TxDMABusy
 == 0))

1954 
	`RTMPucDay
(20);

1955 
i
++;

1956 }
i
 < 50);

1975 #ifde
CONFIG_STA_SUPPORT


1976 #ifde
PCIE_PS_SUPPORT


1979 i(
Lev
 =
DOT11POWERSAVE
)

1981 
AUTO_WAKEUP_STRUC
 
AutoWakeupCfg
;

1985 i(
TbNumToNextWakeUp
 == 0)

1986 
TbNumToNextWakeUp
 = 1;

1988 
AutoWakeupCfg
.
wd
 = 0;

1989 
	`RTMP_IO_WRITE32
(
pAd
, 
AUTO_WAKEUP_CFG
, 
AutoWakeupCfg
.
wd
);

1992 
AutoWakeupCfg
.
fld
.
NumofS˕gTb
 = 
TbNumToNextWakeUp
 - 1;

1993 
AutoWakeupCfg
.
fld
.
EbAutoWakeup
 = 1;

1994 
AutoWakeupCfg
.
fld
.
AutoLdTime
 = 
LEAD_TIME
;

1995 
	`RTMP_IO_WRITE32
(
pAd
, 
AUTO_WAKEUP_CFG
, 
AutoWakeupCfg
.
wd
);

1998 #ifde
CONFIG_STA_SUPPORT


1999 #ifde
PCIE_PS_SUPPORT


2002 i(
Lev
 =
RTMP_HALT
 && 
pAd
->
OpMode
 =
OPMODE_STA
)

2004 i((
brc
 =
TRUE
&& (
i
 < 50))

2005 
	`RTMPPCIeLkClStg
(
pAd
, 1);

2008 i(
pAd
->
OpMode
 =
OPMODE_STA
)

2010 i((
brc
 =
TRUE
&& (
i
 < 50))

2011 
	`RTMPPCIeLkClStg
(
pAd
, 3);

2013 
	`RTMP_CLEAR_PSFLAG
(
pAd
, 
fRTMP_PS_DISABLE_TX
);

2019  
TRUE
;

2020 
	}
}

2025 
VOID
 
	$RT28xxPciMlmeRadioOn
(

2026 
IN
 
PRTMP_ADAPTER
 
pAd
)

2028 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
))

2031 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("%s===>\n", 
__FUNCTION__
));

2033 i((
pAd
->
OpMode
 =
OPMODE_AP
) ||

2034 ((
pAd
->
OpMode
 =
OPMODE_STA
)

2035 #ifde
CONFIG_STA_SUPPORT


2036 #ifde
PCIE_PS_SUPPORT


2037 && (!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)

2038 ||
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
FALSE
)

2043 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_BK
);

2044 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_BE
);

2045 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_VI
);

2046 
	`RTMPRgC˪Up
(
pAd
, 
QID_AC_VO
);

2047 
	`RTMPRgC˪Up
(
pAd
, 
QID_HCCA
);

2048 
	`RTMPRgC˪Up
(
pAd
, 
QID_MGMT
);

2049 
	`RTMPRgC˪Up
(
pAd
, 
QID_RX
);

2051 #ifde
RTMP_PCI_SUPPORT


2052 i(
pAd
->
fTy
 =
RTMP_DEV_INF_PCI
 ||Ad->fTy =
RTMP_DEV_INF_PCIE
)

2053 
	`RT28xxPciAsicRadioOn
(
pAd
, 
GUI_IDLE_POWER_SAVE
);

2057 
	`RTMPEbRxTx
(
pAd
);

2060 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
);

2061 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
);

2063 #ifde
LED_CONTROL_SUPPORT


2065 
	`RTMPSLED
(
pAd
, 
LED_RADIO_ON
);

2069 #ifde
CONFIG_STA_SUPPORT


2070 #ifde
PCIE_PS_SUPPORT


2072 i((
pAd
->
OpMode
 =
OPMODE_STA
) &&

2073 (
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

2074 &&(
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
))

2076 
BOOLEAN
 
Ced
;

2078 
	`RTMPPCIeLkClVueRee
(
pAd
, 
RESTORE_WAKEUP
);

2080 
pAd
->
Mlme
.
bPsPlTimRug
 = 
FALSE
;

2081 
	`RTMPClTim
(&
pAd
->
Mlme
.
PsPlTim
, &
Ced
);

2082 
	`RTMPClTim
(&
pAd
->
Mlme
.
RadioOnOffTim
, &
Ced
);

2083 
	`RTMPSTim
(&
pAd
->
Mlme
.
RadioOnOffTim
, 40);

2087 
	}
}

2090 
VOID
 
	$RT28xxPciMlmeRadioOFF
(

2091 
IN
 
PRTMP_ADAPTER
 
pAd
)

2093 #ifde
RTMP_PCI_SUPPORT


2094 
BOOLEAN
 
brc
=
TRUE
;

2097 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
))

2100 #ifde
CONFIG_STA_SUPPORT


2102 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

2104 i(
	`INFRA_ON
(
pAd
|| 
	`ADHOC_ON
(pAd))

2106 
MLME_DISASSOC_REQ_STRUCT
 
DisReq
;

2107 
MLME_QUEUE_ELEM
 *
pMsgEm
 = (MLME_QUEUE_ELEM *
	`kmloc
((MLME_QUEUE_ELEM), 
MEM_ALLOC_FLAG
);

2109 i(
pMsgEm
)

2111 
	`COPY_MAC_ADDR
(&
DisReq
.
Addr
, 
pAd
->
CommCfg
.
Bssid
);

2112 
DisReq
.
Rs
 = 
REASON_DISASSOC_STA_LEAVING
;

2114 
pMsgEm
->
Mache
 = 
ASSOC_STATE_MACHINE
;

2115 
pMsgEm
->
MsgTy
 = 
MT2_MLME_DISASSOC_REQ
;

2116 
pMsgEm
->
MsgL
 = (
MLME_DISASSOC_REQ_STRUCT
);

2117 
	`NdisMoveMemy
(
pMsgEm
->
Msg
, &
DisReq
, (
MLME_DISASSOC_REQ_STRUCT
));

2119 
	`MlmeDissocReqAi
(
pAd
, 
pMsgEm
);

2120 
	`k
(
pMsgEm
);

2122 
	`RTMPucDay
(1000);

2128 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("%s===>\n", 
__FUNCTION__
));

2131 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
);

2133 #ifde
CONFIG_STA_SUPPORT


2134 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2136 
BOOLEAN
 
Ced
;

2137 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

2139 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
SnTim
, &
Ced
);

2140 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
);

2143 i(
pAd
->
SCfg
.
bRadio
 =
TRUE
)

2145 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("-->MlmeRadioOff()eturn on bRadio == TRUE; \n"));

2149 i(
	`IDLE_ON
(
pAd
) &&

2150 (
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
)))

2152 
	`RT28xxPciAsicRadioOn
(
pAd
, 
GUI_IDLE_POWER_SAVE
);

2154 #ifde
PCIE_PS_SUPPORT


2155 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)&&pAd->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)

2157 
BOOLEAN
 
Ced
;

2158 
pAd
->
Mlme
.
bPsPlTimRug
 = 
FALSE
;

2159 
	`RTMPClTim
(&
pAd
->
Mlme
.
PsPlTim
, &
Ced
);

2160 
	`RTMPClTim
(&
pAd
->
Mlme
.
RadioOnOffTim
, &
Ced
);

2166 i(
	`INFRA_ON
(
pAd
|| 
	`ADHOC_ON
(pAd))

2167 
	`LkDown
(
pAd
, 
FALSE
);

2168 
	`RTMPucDay
(10000);

2171 
	`BssTabIn
(&
pAd
->
SnTab
);

2183 #ifde
LED_CONTROL_SUPPORT


2184 
	`RTMPSLED
(
pAd
, 
LED_RADIO_OFF
);

2187 #ifde
CONFIG_STA_SUPPORT


2188 #ifde
PCIE_PS_SUPPORT


2192 i(
pAd
->
OpMode
 =
OPMODE_STA
&&

2193 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)&&

2194 
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)

2196 
	`RTMPSTim
(&
pAd
->
Mlme
.
RadioOnOffTim
, 10);

2201 #ifde
RTMP_PCI_SUPPORT


2202 i(
pAd
->
fTy
 =
RTMP_DEV_INF_PCI
 ||Ad->fTy =
RTMP_DEV_INF_PCIE
)

2204 
brc
=
	`RT28xxPciAsicRadioOff
(
pAd
, 
GUIRADIO_OFF
, 0);

2205 i(
brc
==
FALSE
)

2207 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("% RT28xxPciAsicRadioOf !!\n", 
__FUNCTION__
));

2212 
	}
}

	@common/cmm_profile.c

28 
	~"_cfig.h
"

31 
	#ETH_MAC_ADDR_STR_LEN
 17

32 

	)

34 
BOOLEAN
 
	$rmaohex
(
PSTRING
 
s1
, PSTRING 
s2
)

36 
i
 = 0;

37 
PSTRING
 
okS
 = 
s1
, 
okE
 = s1;

39 i(
	`
(
s1
!
ETH_MAC_ADDR_STR_LEN
)

40  
FALSE
;

42 (*
okS
) != '\0')

44 if((
okE
 = 
	`rchr
(
okS
, ':')!
NULL
)

45 *
okE
++ = '\0';

46 i((
	`
(
okS
!2|| (!
	`isxdig
(*ptokS)) || (!isxdigit(*(ptokS+1))))

48 
	`AtoH
(
okS
, (
PUCHAR
)&
s2
[
i
++], 1);

49 
okS
 = 
okE
;

50 i(
okS
 =
NULL
)

52 i(
i
 == 6)

56  ( 
i
 =6 ? 
TRUE
 : 
FALSE
);

58 
	}
}

62 
BOOLEAN
 
	$rcmp
(
PSTRING
 
s1
, PSTRING 
s2
)

64 
PSTRING
 
p1
 = 
s1
, 
p2
 = 
s2
;

66 i(
	`
(
s1
!𡾒(
s2
))

67  
FALSE
;

69 *
p1
 != '\0')

71 if((*
p1
 !*
p2
) && ((*p1 ^ *p2) != 0x20))

72  
FALSE
;

73 
p1
++;

74 
p2
++;

77  
TRUE
;

78 
	}
}

81 
PSTRING
 
	$rruncmp
(
PSTRING
 
s1
, PSTRING 
s2
)

83 
INT
 
l1
, 
l2
, 
i
;

84 
mp1
, 
mp2
;

86 
l2
 = 
	`
(
s2
);

87 i(!
l2
)

88  (*
s1
;

90 
l1
 = 
	`
(
s1
);

92 
l1
 >
l2
)

94 
l1
--;

96 
i
=0; i<
l2
; i++)

98 
mp1
 = *(
s1
+
i
);

99 
mp2
 = *(
s2
+
i
);

101 i(('a' <
mp1
) && (temp1 <= 'z'))

102 
mp1
 = 'A'+(temp1-'a');

103 i(('a' <
mp2
) && (temp2 <= 'z'))

104 
mp2
 = 'A'+(temp2-'a');

106 i(
mp1
 !
mp2
)

110 i(
i
 =
l2
)

111  (*
s1
;

113 
s1
++;

116  
NULL
;

117 
	}
}

126 
PSTRING
 
	$rr
(
PSTRING
 
s1
,cڡ PSTRING 
s2
)

128 
INT
 
l1
, 
l2
;

130 
l2
 = 
	`
(
s2
);

131 i(!
l2
)

132  
s1
;

134 
l1
 = 
	`
(
s1
);

136 
l1
 >
l2
)

138 
l1
--;

139 i(!
	`memcmp
(
s1
,
s2
,
l2
))

140  
s1
;

141 
s1
++;

144  
NULL
;

145 
	}
}

153 
PSTRING
 
	g__rok
;

154 
PSTRING
 
	$rok
(
PSTRING
 
s
,cڡ PSTRING 

)

156 
PSTRING
 
sbeg
, 
nd
;

158 
sbeg
 = 
s
 ? s : 
__rok
;

159 i(!
sbeg
)

161  
NULL
;

164 
sbeg
 +
	`rn
(sbeg,

);

165 i(*
sbeg
 == '\0')

167 
__rok
 = 
NULL
;

168 
NULL
 );

171 
nd
 = 
	`brk

sbeg
, 

);

172 i(
nd
 && *send != '\0')

173 *
nd
++ = '\0';

175 
__rok
 = 
nd
;

177  (
sbeg
);

178 
	}
}

186 
INT
 
	$dimt
(
PSTRING
 
s
,PSTRING 

)

188 
INT
 
cou
 = 0;

190 
PSTRING
 
tok
 = 
s
;

194 
tok
 = 
	`brk
ok, 

);

196 i
tok
 =
NULL
 )

202 ++
tok
;

209 ++
cou
;

211  
cou
;

212 
	}
}

219 
	$_
(
PSTRING
 

, *
addr
)

221 
v
;

222 
ba
, 
n
;

223 
STRING
 
c
;

224 
s
[4];

225 *

 = 
s
;

234 
v
 = 0;

235 
ba
 = 10;

236 i(*

 == '0')

238 i(*++

 == 'x' || *cp == 'X')

239 
ba
 = 16, 

++;

241 
ba
 = 8;

243 (
c
 = *

) != '\0')

245 i(
	`isdig
((
c
))

247 
v
 = (v * 
ba
+ (
c
 - '0');

248 

++;

251 i(
ba
 =16 && 
	`isxdig
((
c
))

253 
v
 = (val << 4) +

254 (
c
 + 10 - (
	`iow
(() c) ? 'a' : 'A'));

255 

++;

260 i(*

 == '.')

266 i(

 >
s
 + 3 || 
v
 > 0xff)

268 *

++ = 
v
, 

++;

277 *

)

278 i(!
	`isa
((*

++))

284 
n
 = 

 - 
s
 + 1;

285 
n
)

292 i(
v
 > 0xffffff)

294 
v
 |
s
[0] << 24;

298 i(
v
 > 0xffff)

300 
v
 |(
s
[0] << 24) | (parts[1] << 16);

304 i(
v
 > 0xff)

306 
v
 |(
s
[0] << 24) | (parts[1] << 16) | (parts[2] << 8);

310 *
addr
 = 
	`htl
(
v
);

313 
	}
}

330 
PSTRING
 
	$RTMPFdSei
(

331 
IN
 
PSTRING
 
bufr
)

333 
STRING
 
mp_buf
[32];

334 
PSTRING
 
r
;

336 
	`ry
(
mp_buf
, "Default");

338 if((
r
 = 
	`rr
(
bufr
, 
mp_buf
)!
NULL
)

339  (
r
+
	`
("\n"));

341  
NULL
;

342 
	}
}

366 
INT
 
	$RTMPGKeyPam
(

367 
IN
 
PSTRING
 
key
,

368 
OUT
 
PSTRING
 
de
,

369 
IN
 
INT
 
desize
,

370 
IN
 
PSTRING
 
bufr
,

371 
IN
 
BOOLEAN
 
bTrimS
)

373 
PSTRING
 
pMemBuf
, 
mp_buf1
 = 
NULL
, 
mp_buf2
 = NULL;

374 
PSTRING
 
t_r
, 
d_r
;

375 
PSTRING
 
r
;

376 
PSTRING
 
offt
 = 
NULL
;

377 
INT
 
n
, 
keyL
;

380 
keyL
 = 
	`
(
key
);

381 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
pMemBuf
, 
MAX_PARAM_BUFFER_SIZE
 * 2);

382 i(
pMemBuf
 =
NULL
)

383  (
FALSE
);

385 
	`memt
(
pMemBuf
, 0, 
MAX_PARAM_BUFFER_SIZE
 * 2);

386 
mp_buf1
 = 
pMemBuf
;

387 
mp_buf2
 = (
PSTRING
)(
pMemBuf
 + 
MAX_PARAM_BUFFER_SIZE
);

391 if((
offt
 = 
	`RTMPFdSei
(
bufr
)=
NULL
)

393 
	`os__mem
(
NULL
, (
PUCHAR
)
pMemBuf
);

394  (
FALSE
);

397 
	`ry
(
mp_buf1
, "\n");

398 
	`rt
(
mp_buf1
, 
key
);

399 
	`rt
(
mp_buf1
, "=");

402 if((
t_r
=
	`rr
(
offt
, 
mp_buf1
)=
NULL
)

404 
	`os__mem
(
NULL
, (
PUCHAR
)
pMemBuf
);

405  (
FALSE
);

408 
t_r
 +
	`
("\n");

409 if((
d_r
 = 
	`rr
(
t_r
, "\n"))==
NULL
)

410 
d_r
 = 
t_r
+
	`
(start_ptr);

412 i(
d_r
<
t_r
)

414 
	`os__mem
(
NULL
, (
PUCHAR
)
pMemBuf
);

415  (
FALSE
);

418 
	`NdisMoveMemy
(
mp_buf2
, 
t_r
, 
d_r
-start_ptr);

419 
mp_buf2
[
d_r
-
t_r
]='\0';

421 if((
t_r
=
	`rr
(
mp_buf2
, "=")=
NULL
)

423 
	`os__mem
(
NULL
, (
PUCHAR
)
pMemBuf
);

424  (
FALSE
);

426 
r
 = (
t_r
 +1);

428 *
t_r
 != 0x00)

430 if((*
r
 =' '&& 
bTrimS
) || (*ptr == '\t') )

431 
r
++;

435 
n
 = 
	`
(
t_r
);

437 
	`memt
(
de
, 0x00, 
desize
);

438 
	`y
(
de
, 
r
, ((
n
 >
desize
) ? destsize:en));

440 
	`os__mem
(
NULL
, (
PUCHAR
)
pMemBuf
);

442  
TRUE
;

443 
	}
}

466 
INT
 
	$RTMPGKeyPamWhOfft
(

467 
IN
 
PSTRING
 
key
,

468 
OUT
 
PSTRING
 
de
,

469 
OUT
 
USHORT
 *
d_offt
,

470 
IN
 
INT
 
desize
,

471 
IN
 
PSTRING
 
bufr
,

472 
IN
 
BOOLEAN
 
bTrimS
)

474 
PSTRING
 
mp_buf1
 = 
NULL
;

475 
PSTRING
 
mp_buf2
 = 
NULL
;

476 
PSTRING
 
t_r
;

477 
PSTRING
 
d_r
;

478 
PSTRING
 
r
;

479 
PSTRING
 
offt
 = 0;

480 
INT
 
n
;

482 i(*
d_offt
 >
MAX_INI_BUFFER_SIZE
)

483  (
FALSE
);

485 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mp_buf1
, 
MAX_PARAM_BUFFER_SIZE
);

487 if(
mp_buf1
 =
NULL
)

488  (
FALSE
);

490 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mp_buf2
, 
MAX_PARAM_BUFFER_SIZE
);

491 if(
mp_buf2
 =
NULL
)

493 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf1
);

494  (
FALSE
);

498 if(*
d_offt
 == 0)

500 i((
offt
 = 
	`RTMPFdSei
(
bufr
)=
NULL
)

502 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf1
);

503 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf2
);

504  (
FALSE
);

508 
offt
 = 
bufr
 + (*
d_offt
);

510 
	`ry
(
mp_buf1
, "\n");

511 
	`rt
(
mp_buf1
, 
key
);

512 
	`rt
(
mp_buf1
, "=");

515 if((
t_r
=
	`rr
(
offt
, 
mp_buf1
))==
NULL
)

517 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf1
);

518 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf2
);

519  (
FALSE
);

522 
t_r
+=
	`
("\n");

523 if((
d_r
=
	`rr
(
t_r
, "\n"))==
NULL
)

524 
d_r
=
t_r
+
	`
(start_ptr);

526 i(
d_r
<
t_r
)

528 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf1
);

529 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf2
);

530  (
FALSE
);

533 *
d_offt
 = 
d_r
 - 
bufr
;

535 
	`NdisMoveMemy
(
mp_buf2
, 
t_r
, 
d_r
-start_ptr);

536 
mp_buf2
[
d_r
-
t_r
]='\0';

537 
n
 = 
	`
(
mp_buf2
);

538 
	`ry
(
mp_buf1
, 
mp_buf2
);

539 if((
t_r
=
	`rr
(
mp_buf1
, "=")=
NULL
)

541 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf1
);

542 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf2
);

543  (
FALSE
);

546 
	`ry
(
mp_buf2
, 
t_r
+1);

547 
r
 = 
mp_buf2
;

549 *
r
 != 0x00)

551 if((
bTrimS
 && (*
r
 == ' ')) || (*ptr == '\t') )

552 
r
++;

557 
n
 = 
	`
(
r
);

558 
	`memt
(
de
, 0x00, 
desize
);

559 
	`y
(
de
, 
r
, 
n
 >
desize
 ? destsize:en);

561 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf1
);

562 
	`os__mem
(
NULL
, (
PUCHAR
)
mp_buf2
);

563  
TRUE
;

564 
	}
}

567 #ifde
CONFIG_STA_SUPPORT


568 
le
 
	$RTMPSSTADefKeyId
(
RTMP_ADAPTER
 *
pAd
, 
ULONG
 
KeyIdx
)

570 if((
KeyIdx
 >= 1 ) && (KeyIdx <= 4))

571 
pAd
->
SCfg
.
DeuKeyId
 = (
UCHAR
(
KeyIdx
 - 1);

573 
pAd
->
SCfg
.
DeuKeyId
 = 0;

574 
	}
}

578 
	$mp_r_key_bufr_om_fe
(
IN
 
PRTMP_ADAPTER
 
pAd
,IN 
PSTRING
 
bufr
,IN 
ULONG
 
KeyTy
,IN 
INT
 
BSSIdx
,IN INT 
KeyIdx
)

580 
PSTRING
 
keybuff
;

582 
ULONG
 
KeyL
;

584 
CIPHER_KEY
 *
pShedKey
;

586 
keybuff
 = 
bufr
;

587 
KeyL
 = 
	`
(
keybuff
);

588 
pShedKey
 = &
pAd
->
ShedKey
[
BSSIdx
][
KeyIdx
];

590 if(((
KeyTy
 != 0) && (KeyType != 1)) ||

591 ((
KeyTy
 =0&& (
KeyL
 != 10) && (KeyLen != 26)) ||

592 ((
KeyTy
=1&& (
KeyL
 != 5) && (KeyLen != 13)))

594 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Key%dStr is Invalid keyength(%ld) or Type(%ld)\n",

595 
KeyIdx
+1, 
KeyL
, 
KeyTy
));

596  
FALSE
;

600  
	`RT_CfgSWKey
(
pAd
, 
bufr
, 
pShedKey
, 
KeyIdx
);

603 
	}
}

606 
	$mp_ad_key_rms_om_fe
(
IN
 
PRTMP_ADAPTER
 
pAd
, 
PSTRING
 
tmpbuf
, PSTRING 
bufr
)

608 
STRING
 
tok_r
[16];

609 
PSTRING
 
ma
;

610 
INT
 
i
 = 0, 
idx
;

611 
ULONG
 
KeyTy
[
MAX_MBSSID_NUM
];

612 
ULONG
 
KeyIdx
;

614 
	`NdisZoMemy
(
KeyTy
, (KeyType));

617 if(
	`RTMPGKeyPam
("DeuKeyID", 
tmpbuf
, 25, 
bufr
, 
TRUE
))

620 #ifde
CONFIG_STA_SUPPORT


621 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

623 
KeyIdx
 = 
	`sime_
(
tmpbuf
, 0, 10);

624 
	`RTMPSSTADefKeyId
(
pAd
, 
KeyIdx
);

626 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("DeuKeyID(0~3)=%d\n", 
pAd
->
SCfg
.
DeuKeyId
));

632 
idx
 = 0; idx < 4; idx++)

634 
	`rtf
(
tok_r
, "Key%dTy", 
idx
 + 1);

636 i(
	`RTMPGKeyPam
(
tok_r
, 
tmpbuf
, 128, 
bufr
, 
TRUE
))

638 
i
 = 0, 
ma
 = 
	`rok
(
tmpbuf
,";"); ma; ma =ok(
NULL
,";"), i++)

646 i(
i
 < 
MAX_MBSSID_NUM
)

647 
KeyTy
[
i
] = 
	`sime_
(
ma
, 0, 10);

650 #ifde
CONFIG_STA_SUPPORT


651 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

653 
	`rtf
(
tok_r
, "Key%dS", 
idx
 + 1);

654 i(
	`RTMPGKeyPam
(
tok_r
, 
tmpbuf
, 128, 
bufr
, 
FALSE
))

656 
	`mp_r_key_bufr_om_fe
(
pAd
, 
tmpbuf
, 
KeyTy
[
BSS0
], BSS0, 
idx
);

662 
	}
}

666 #ifde
CONFIG_STA_SUPPORT


667 
	$mp_ad_a_wmm_rms_om_fe
(
IN
 
PRTMP_ADAPTER
 
pAd
, *
tmpbuf
, *
bufr
)

669 
PSTRING
 
ma
;

670 
INT
 
i
=0;

671 
BOOLEAN
 
bWmmEb
 = 
FALSE
;

674 if(
	`RTMPGKeyPam
("WmmCab", 
tmpbuf
, 32, 
bufr
, 
TRUE
))

676 if(
	`sime_
(
tmpbuf
, 0, 10) != 0)

678 
pAd
->
CommCfg
.
bWmmCab
 = 
TRUE
;

679 
bWmmEb
 = 
TRUE
;

683 
pAd
->
CommCfg
.
bWmmCab
 = 
FALSE
;

686 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("WmmCab=%d\n", 
pAd
->
CommCfg
.
bWmmCab
));

689 #ifde
QOS_DLS_SUPPORT


691 if(
	`RTMPGKeyPam
("DLSCab", 
tmpbuf
, 32, 
bufr
, 
TRUE
))

693 if(
	`sime_
(
tmpbuf
, 0, 10) != 0)

695 
pAd
->
CommCfg
.
bDLSCab
 = 
TRUE
;

699 
pAd
->
CommCfg
.
bDLSCab
 = 
FALSE
;

702 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("bDLSCab=%d\n", 
pAd
->
CommCfg
.
bDLSCab
));

707 if(
	`RTMPGKeyPam
("AckPicy", 
tmpbuf
, 32, 
bufr
, 
TRUE
))

709 
i
 = 0, 
ma
 = 
	`rok
(
tmpbuf
,";"); ma; ma =ok(
NULL
,";"), i++)

711 
pAd
->
CommCfg
.
AckPicy
[
i
] = (
UCHAR
)
	`sime_
(
ma
, 0, 10);

713 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AckPicy[%d]=%d\n", 
i
, 
pAd
->
CommCfg
.
AckPicy
[i]));

717 i(
bWmmEb
)

720 if(
	`RTMPGKeyPam
("APSDCab", 
tmpbuf
, 10, 
bufr
, 
TRUE
))

722 if(
	`sime_
(
tmpbuf
, 0, 10) != 0)

723 
pAd
->
CommCfg
.
bAPSDCab
 = 
TRUE
;

725 
pAd
->
CommCfg
.
bAPSDCab
 = 
FALSE
;

727 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("APSDCab=%d\n", 
pAd
->
CommCfg
.
bAPSDCab
));

731 if(
	`RTMPGKeyPam
("MaxSPLgth", 
tmpbuf
, 10, 
bufr
, 
TRUE
))

733 
pAd
->
CommCfg
.
MaxSPLgth
 = 
	`sime_
(
tmpbuf
, 0, 10);

735 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MaxSPLgth=%d\n", 
pAd
->
CommCfg
.
MaxSPLgth
));

739 if(
	`RTMPGKeyPam
("APSDAC", 
tmpbuf
, 32, 
bufr
, 
TRUE
))

741 
BOOLEAN
 
sd_ac
[4];

743 
i
 = 0, 
ma
 = 
	`rok
(
tmpbuf
,";"); ma; ma =ok(
NULL
,";"), i++)

745 
sd_ac
[
i
] = (
BOOLEAN
)
	`sime_
(
ma
, 0, 10);

747 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("APSDAC%d %d\n", 
i
, 
sd_ac
[i]));

750 
pAd
->
CommCfg
.
bAPSDAC_BE
 = 
sd_ac
[0];

751 
pAd
->
CommCfg
.
bAPSDAC_BK
 = 
sd_ac
[1];

752 
pAd
->
CommCfg
.
bAPSDAC_VI
 = 
sd_ac
[2];

753 
pAd
->
CommCfg
.
bAPSDAC_VO
 = 
sd_ac
[3];

755 
pAd
->
CommCfg
.
bACMAPSDTr
[0] = 
sd_ac
[0];

756 
pAd
->
CommCfg
.
bACMAPSDTr
[1] = 
sd_ac
[1];

757 
pAd
->
CommCfg
.
bACMAPSDTr
[2] = 
sd_ac
[2];

758 
pAd
->
CommCfg
.
bACMAPSDTr
[3] = 
sd_ac
[3];

762 
	}
}

764 #ifde
XLINK_SUPPORT


765 
	$mp_g_p_xlk_mode_om_fe
(
IN
 
PRTMP_ADAPTER
 
pAd
, *
tmpbuf
, *
bufr
)

767 
UINT32
 
Vue
 = 0;

770 i(
	`RTMPGKeyPam
("PSP_XLINK_MODE", 
tmpbuf
, 32, 
bufr
, 
TRUE
))

772 if(
	`sime_
(
tmpbuf
, 0, 10) != 0)

774 
pAd
->
SCfg
.
PSPXlk
 = 
TRUE
;

778 
pAd
->
SCfg
.
PSPXlk
 = 
FALSE
;

781 i(
pAd
->
SCfg
.
PSPXlk
)

782 
Vue
 = 
PSPXLINK
;

784 
Vue
 = 
STANORMAL
;

786 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 
Vue
);

788 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PSP_XLINK_MODE=%d\n", 
pAd
->
SCfg
.
PSPXlk
));

790 
	}
}

795 #ifde
DOT11_N_SUPPORT


796 
	$HTPamsHook
(

797 
IN
 
PRTMP_ADAPTER
 
pAd
,

798 
IN
 
PSTRING
 
pVueS
,

799 
IN
 
PSTRING
 
pIut
)

801 
Vue
;

803 i(
	`RTMPGKeyPam
("HT_PROTECT", 
pVueS
, 25, 
pIut
, 
TRUE
))

805 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

806 i(
Vue
 == 0)

808 
pAd
->
CommCfg
.
bHTPre
 = 
FALSE
;

812 
pAd
->
CommCfg
.
bHTPre
 = 
TRUE
;

814 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: Prei = %s\n", (
Vue
==0) ? "Disable" : "Enable"));

818 i(
	`RTMPGKeyPam
("HT_MIMOPSMode", 
pVueS
, 25, 
pIut
, 
TRUE
))

820 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

821 i(
Vue
 > 
MMPS_ENABLE
)

823 
pAd
->
CommCfg
.
BACaby
.
fld
.
MMPSmode
 = 
MMPS_ENABLE
;

828 
pAd
->
CommCfg
.
BACaby
.
fld
.
MMPSmode
 = 
MMPS_ENABLE
;

831 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: MIMOPS Mod = %d\n", (
INT

Vue
));

834 i(
	`RTMPGKeyPam
("HT_BADee", 
pVueS
, 25, 
pIut
, 
TRUE
))

836 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

837 i(
Vue
 == 0)

839 
pAd
->
CommCfg
.
bBADee
 = 
FALSE
;

843 
pAd
->
CommCfg
.
bBADee
 = 
TRUE
;

845 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: BA De = %s\n", (
Vue
==0) ? "Disable" : "Enable"));

849 i(
	`RTMPGKeyPam
("HT_AutoBA", 
pVueS
, 25, 
pIut
, 
TRUE
))

851 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

852 i(
Vue
 == 0)

854 
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 = 
FALSE
;

855 
pAd
->
CommCfg
.
BACaby
.
fld
.
Picy
 = 
BA_NOTUSE
;

859 
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 = 
TRUE
;

860 
pAd
->
CommCfg
.
BACaby
.
fld
.
Picy
 = 
IMMED_BA
;

862 
pAd
->
CommCfg
.
REGBACaby
.
fld
.
AutoBA
 =Ad->CommCfg.
BACaby
.field.AutoBA;

863 
pAd
->
CommCfg
.
REGBACaby
.
fld
.
Picy
 =Ad->CommCfg.
BACaby
.field.Policy;

864 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: AutBA = %s\n", (
Vue
==0) ? "Disable" : "Enable"));

868 i(
	`RTMPGKeyPam
("HT_HTC", 
pVueS
, 25, 
pIut
, 
TRUE
))

870 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

871 i(
Vue
 == 0)

873 
pAd
->
HTCEb
 = 
FALSE
;

877 
pAd
->
HTCEb
 = 
TRUE
;

879 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: Tx +HTC fm%s\n", (
Vue
==0) ? "Disable" : "Enable"));

884 i(
	`RTMPGKeyPam
("HT_RDG", 
pVueS
, 25, 
pIut
, 
TRUE
))

886 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

887 i(
Vue
 == 0)

889 
pAd
->
CommCfg
.
bRdg
 = 
FALSE
;

893 
pAd
->
HTCEb
 = 
TRUE
;

894 
pAd
->
CommCfg
.
bRdg
 = 
TRUE
;

896 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: RDG = %s\n", (
Vue
==0) ? "Disable" : "Enable(+HTC)"));

903 i(
	`RTMPGKeyPam
("HT_AMSDU", 
pVueS
, 25, 
pIut
, 
TRUE
))

905 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

906 i(
Vue
 == 0)

908 
pAd
->
CommCfg
.
BACaby
.
fld
.
AmsduEb
 = 
FALSE
;

912 
pAd
->
CommCfg
.
BACaby
.
fld
.
AmsduEb
 = 
TRUE
;

914 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: Tx A-MSDU = %s\n", (
Vue
==0) ? "Disable" : "Enable"));

918 i(
	`RTMPGKeyPam
("HT_MpduDsy", 
pVueS
, 25, 
pIut
, 
TRUE
))

920 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

921 i(
Vue
 <=7 && Value >= 0)

923 
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
 = 
Vue
;

924 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: MPDU Dsy = %d\n", (
INT

Vue
));

928 
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
 = 4;

929 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: MPDU Density = %d (Default)\n", 4));

934 i(
	`RTMPGKeyPam
("HT_BAWSize", 
pVueS
, 25, 
pIut
, 
TRUE
))

936 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

938 i(
Vue
 >=1 && Value <= 64)

940 
pAd
->
CommCfg
.
REGBACaby
.
fld
.
RxBAWLim
 = 
Vue
;

941 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
 = 
Vue
;

942 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: BA Wdw Siz%d\n", (
INT

Vue
));

946 
pAd
->
CommCfg
.
REGBACaby
.
fld
.
RxBAWLim
 = 64;

947 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
 = 64;

948 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: BA Windw Size = 64 (Defualt)\n"));

954 i(
	`RTMPGKeyPam
("HT_GI", 
pVueS
, 25, 
pIut
, 
TRUE
))

956 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

958 i(
Vue
 =
GI_400
)

960 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
ShtGI
 = 
GI_400
;

964 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
ShtGI
 = 
GI_800
;

967 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: Gud Iv = %s\n", (
Vue
==
GI_400
) ? "400" : "800" ));

971 i(
	`RTMPGKeyPam
("HT_OpMode", 
pVueS
, 25, 
pIut
, 
TRUE
))

973 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

975 i(
Vue
 =
HTMODE_GF
)

978 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
HTMODE
 = 
HTMODE_GF
;

982 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
HTMODE
 = 
HTMODE_MM
;

985 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: O Mod%s\n", (
Vue
==
HTMODE_GF
) ? "Green Field" : "Mixed Mode" ));

989 i(
	`RTMPGKeyPam
("FixedTxMode", 
pVueS
, 25, 
pIut
, 
TRUE
))

991 #ifde
CONFIG_STA_SUPPORT


992 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

994 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
 =

995 
	`RT_CfgSFixedTxPhyMode
(
pVueS
);

996 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Fixed Tx Mode = %d\n",

997 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
));

1004 i(
	`RTMPGKeyPam
("HT_BW", 
pVueS
, 25, 
pIut
, 
TRUE
))

1006 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

1008 i(
Vue
 =
BW_40
)

1010 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 = 
BW_40
;

1014 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 = 
BW_20
;

1017 #ifde
MCAST_RATE_SPECIFIC


1018 
pAd
->
CommCfg
.
MCaPhyMode
.
fld
.
BW
 =Ad->CommCfg.
RegTnsmStg
.field.BW;

1021 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: ChWidth = %s\n", (
Vue
==
BW_40
) ? "40 MHz" : "20 MHz" ));

1024 i(
	`RTMPGKeyPam
("HT_EXTCHA", 
pVueS
, 25, 
pIut
, 
TRUE
))

1026 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

1028 i(
Vue
 == 0)

1031 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 = 
EXTCHA_BELOW
;

1035 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 = 
EXTCHA_ABOVE
;

1038 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: ExCh%s\n", (
Vue
==0) ? "BELOW" : "ABOVE" ));

1042 i(
	`RTMPGKeyPam
("HT_MCS", 
pVueS
, 50, 
pIut
, 
TRUE
))

1045 #ifde
CONFIG_STA_SUPPORT


1046 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1048 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

1051 i((
Vue
 >= 0 && Value <= 23) || (Value == 32))

1053 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
Vue
;

1054 
pAd
->
SCfg
.
bAutoTxReSwch
 = 
FALSE
;

1055 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: MCS = %d\n", 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
));

1059 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_AUTO
;

1060 
pAd
->
SCfg
.
bAutoTxReSwch
 = 
TRUE
;

1061 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: MCS = AUTO\n"));

1068 i(
	`RTMPGKeyPam
("HT_STBC", 
pVueS
, 25, 
pIut
, 
TRUE
))

1070 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

1071 i(
Vue
 =
STBC_USE
)

1073 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
STBC
 = 
STBC_USE
;

1077 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
STBC
 = 
STBC_NONE
;

1079 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: STBC = %d\n", 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
STBC
));

1083 i(
	`RTMPGKeyPam
("HT_40MHZ_INTOLERANT", 
pVueS
, 25, 
pIut
, 
TRUE
))

1085 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

1086 i(
Vue
 == 0)

1088 
pAd
->
CommCfg
.
bFty_Mhz_Iޔt
 = 
FALSE
;

1092 
pAd
->
CommCfg
.
bFty_Mhz_Iޔt
 = 
TRUE
;

1094 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: 40MHZ INTOLERANT = %d\n", 
pAd
->
CommCfg
.
bFty_Mhz_Iޔt
));

1097 if(
	`RTMPGKeyPam
("HT_TxSm", 
pVueS
, 10, 
pIut
, 
TRUE
))

1099 
	`sime_
(
pVueS
, 0, 10))

1102 
pAd
->
CommCfg
.
TxSm
 = 1;

1105 
pAd
->
CommCfg
.
TxSm
 = 2;

1109 
pAd
->
CommCfg
.
TxSm
 = 3;

1111 i(
pAd
->
MACVsi
 < 
RALINK_2883_VERSION
)

1112 
pAd
->
CommCfg
.
TxSm
 = 2;

1115 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: Tx Sm = %d\n", 
pAd
->
CommCfg
.
TxSm
));

1118 if(
	`RTMPGKeyPam
("HT_RxSm", 
pVueS
, 10, 
pIut
, 
TRUE
))

1120 
	`sime_
(
pVueS
, 0, 10))

1123 
pAd
->
CommCfg
.
RxSm
 = 1;

1126 
pAd
->
CommCfg
.
RxSm
 = 2;

1130 
pAd
->
CommCfg
.
RxSm
 = 3;

1132 i(
pAd
->
MACVsi
 < 
RALINK_2883_VERSION
)

1133 
pAd
->
CommCfg
.
RxSm
 = 2;

1136 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: Rx Sm = %d\n", 
pAd
->
CommCfg
.
RxSm
));

1139 i(
	`RTMPGKeyPam
("HT_DiowTKIP", 
pVueS
, 25, 
pIut
, 
TRUE
))

1141 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

1143 i(
Vue
 == 1)

1145 
pAd
->
CommCfg
.
HT_DiowTKIP
 = 
TRUE
;

1149 
pAd
->
CommCfg
.
HT_DiowTKIP
 = 
FALSE
;

1152 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: Diow TKIP mod%s\n", (
pAd
->
CommCfg
.
HT_DiowTKIP
 =
TRUE
) ? "ON" : "OFF" ));

1155 #ifde
DOT11_N_SUPPORT


1156 #ifde
DOT11N_DRAFT3


1157 i(
	`RTMPGKeyPam
("OBSSSnPam", 
pVueS
, 32, 
pIut
, 
TRUE
))

1158 { 
ObssSnVue
, 
idx
;

1159 
PSTRING
 
ma
;

1160 
idx
 = 0, 
ma
 = 
	`rok
(
pVueS
,";"); ma; ma =ok(
NULL
,";"), idx++)

1162 
ObssSnVue
 = 
	`sime_
(
ma
, 0, 10);

1163 
idx
)

1166 i(
ObssSnVue
 < 5 || ObssScanValue > 1000)

1168 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Invid OBSSSnPam f D11OBssSnPassiveDwl(%d), should ing5~1000\n", 
ObssSnVue
));

1172 
pAd
->
CommCfg
.
D11OBssSnPassiveDwl
 = 
ObssSnVue
;

1173 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("OBSSSnPam f D11OBssSnPassiveDwl=%d\n", 
ObssSnVue
));

1177 i(
ObssSnVue
 < 10 || ObssScanValue > 1000)

1179 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Invid OBSSSnPam f D11OBssSnAiveDwl(%d), should ing10~1000\n", 
ObssSnVue
));

1183 
pAd
->
CommCfg
.
D11OBssSnAiveDwl
 = 
ObssSnVue
;

1184 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("OBSSSnPam f D11OBssSnAiveDwl=%d\n", 
ObssSnVue
));

1188 
pAd
->
CommCfg
.
D11BssWidthTriggSnI
 = 
ObssSnVue
;

1189 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("OBSSSnPam f D11BssWidthTriggSnI=%d\n", 
ObssSnVue
));

1192 i(
ObssSnVue
 < 200 || ObssScanValue > 10000)

1194 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Invid OBSSSnPam f D11OBssSnPassiveTٮPChl(%d), should ing200~10000\n", 
ObssSnVue
));

1198 
pAd
->
CommCfg
.
D11OBssSnPassiveTٮPChl
 = 
ObssSnVue
;

1199 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("OBSSSnPam f D11OBssSnPassiveTٮPChl=%d\n", 
ObssSnVue
));

1203 i(
ObssSnVue
 < 20 || ObssScanValue > 10000)

1205 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Invid OBSSSnPam f D11OBssSnAiveTٮPChl(%d), should ing20~10000\n", 
ObssSnVue
));

1209 
pAd
->
CommCfg
.
D11OBssSnAiveTٮPChl
 = 
ObssSnVue
;

1210 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("OBSSSnPam f D11OBssSnAiveTٮPChl=%d\n", 
ObssSnVue
));

1214 
pAd
->
CommCfg
.
D11BssWidthChTnDayFa
 = 
ObssSnVue
;

1215 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("OBSSSnPam f D11BssWidthChTnDayFa=%d\n", 
ObssSnVue
));

1218 
pAd
->
CommCfg
.
D11OBssSnAivyTh
 = 
ObssSnVue
;

1219 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("OBSSSnPam f D11BssWidthChTnDayFa=%d\n", 
ObssSnVue
));

1224 i(
idx
 != 7)

1226 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Wrong OBSSScanParamtetrs format in dat file!!!!! Use default value.\n"));

1228 
pAd
->
CommCfg
.
D11OBssSnPassiveDwl
 = 
d11OBSSSnPassiveDwl
;

1229 
pAd
->
CommCfg
.
D11OBssSnAiveDwl
 = 
d11OBSSSnAiveDwl
;

1230 
pAd
->
CommCfg
.
D11BssWidthTriggSnI
 = 
d11BSSWidthTriggSnIv
;

1231 
pAd
->
CommCfg
.
D11OBssSnPassiveTٮPChl
 = 
d11OBSSSnPassiveTٮPChl
;

1232 
pAd
->
CommCfg
.
D11OBssSnAiveTٮPChl
 = 
d11OBSSSnAiveTٮPChl
;

1233 
pAd
->
CommCfg
.
D11BssWidthChTnDayFa
 = 
d11BSSWidthChlTniDayFa
;

1234 
pAd
->
CommCfg
.
D11OBssSnAivyTh
 = 
d11BSSSnAivyThshd
;

1236 
pAd
->
CommCfg
.
D11BssWidthChTnDay
 = (pAd->CommCfg.
D11BssWidthTriggSnI
 *Ad->CommCfg.
D11BssWidthChTnDayFa
);

1237 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("OBSSSnPam f D11BssWidthChTnDay=%ld\n", 
pAd
->
CommCfg
.
D11BssWidthChTnDay
));

1240 i(
	`RTMPGKeyPam
("HT_BSSCxi", 
pVueS
, 25, 
pIut
, 
TRUE
))

1242 
Vue
 = 
	`sime_
(
pVueS
, 0, 10);

1243 
pAd
->
CommCfg
.
bBssCxEb
 = ((
Vue
 =1? 
TRUE
 : 
FALSE
);

1245 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: 20/40 BssCxSu܈%s\n", (
pAd
->
CommCfg
.
bBssCxEb
 =
TRUE
) ? "ON" : "OFF" ));

1249 i(
	`RTMPGKeyPam
("HT_BSSCxApCThr", 
pVueS
, 25, 
pIut
, 
TRUE
))

1251 
pAd
->
CommCfg
.
BssCxApCThr
 = 
	`sime_
(
pVueS
, 0, 10);;

1253 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("HT: 20/40 BssCxApCTh%d\n", 
pAd
->
CommCfg
.
BssCxApCThr
));

1261 
	}
}

1265 #ifde
CONFIG_STA_SUPPORT


1266 
	$RTMPSSTASSID
(
RTMP_ADAPTER
 *
pAd
, 
PSTRING
 
SSID
)

1268 
pAd
->
CommCfg
.
SsidL
 = (
UCHAR

	`
(
SSID
);

1269 
	`NdisZoMemy
(
pAd
->
CommCfg
.
Ssid
, 
NDIS_802_11_LENGTH_SSID
);

1270 
	`NdisMoveMemy
(
pAd
->
CommCfg
.
Ssid
, 
SSID
,Ad->CommCfg.
SsidL
);

1271 
pAd
->
CommCfg
.
LaSsidL
pAd->CommCfg.
SsidL
;

1272 
	`NdisZoMemy
(
pAd
->
CommCfg
.
LaSsid
, 
NDIS_802_11_LENGTH_SSID
);

1273 
	`NdisMoveMemy
(
pAd
->
CommCfg
.
LaSsid
, 
SSID
,Ad->CommCfg.
LaSsidL
);

1274 
pAd
->
MlmeAux
.
AutoRecSsidL
 =Ad->
CommCfg
.
SsidL
;

1275 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
, 
NDIS_802_11_LENGTH_SSID
);

1276 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
, 
SSID
,Ad->MlmeAux.
AutoRecSsidL
);

1277 
pAd
->
MlmeAux
.
SsidL
 =Ad->
CommCfg
.SsidLen;

1278 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
Ssid
, 
NDIS_802_11_LENGTH_SSID
);

1279 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
Ssid
, 
SSID
,Ad->MlmeAux.
SsidL
);

1280 
	}
}

1283 
	$RTMPSSTAPassPh
(
RTMP_ADAPTER
 *
pAd
, 
PSTRING
 
PassPh
)

1285 
t
 = 
TRUE
;

1287 
PassPh
[
	`
(PassPh)] = '\0';

1289 i((
pAd
->
SCfg
.
AuthMode
 !
Ndis802_11AuthModeWPAPSK
) &&

1290 (
pAd
->
SCfg
.
AuthMode
 !
Ndis802_11AuthModeWPA2PSK
) &&

1291 (
pAd
->
SCfg
.
AuthMode
 !
Ndis802_11AuthModeWPANe
)

1294 
t
 = 
FALSE
;

1298 
t
 = 
	`RT_CfgSWPAPSKKey
(
pAd
, 
PassPh
, (
PUCHAR
Ad->
CommCfg
.
Ssid
,Ad->CommCfg.
SsidL
,Ad->
SCfg
.
PMK
);

1301 i(
t
 =
TRUE
)

1303 
	`RTMPZoMemy
(
pAd
->
SCfg
.
WPassPh
, 64);

1304 
	`RTMPMoveMemy
(
pAd
->
SCfg
.
WPassPh
, 
PassPh
, 
	`
(PassPh));

1305 
pAd
->
SCfg
.
WPassPhL

	`
(
PassPh
);

1307 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

1308 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
))

1311 
pAd
->
SCfg
.
WS
 = 
SS_START
;

1313 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPANe
)

1315 
pAd
->
SCfg
.
WS
 = 
SS_NOTUSE
;

1317 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::(WPAPSK=%s)\n", 
__FUNCTION__
, 
PassPh
));

1319 
	}
}

1322 
le
 
	$RTMPSSTAChSues
(
RTMP_ADAPTER
 *
pAd
, 
NDIS_802_11_ENCRYPTION_STATUS
 
WStus
)

1325 
pAd
->
SCfg
.
PaCh
 = 
WStus
;

1326 
pAd
->
SCfg
.
GroupCh
 = 
WStus
;

1327 
pAd
->
SCfg
.
bMixCh
 = 
FALSE
;

1328 
	}
}

1332 
	$RTMPSCouryCode
(
RTMP_ADAPTER
 *
pAd
, 
PSTRING
 
CouryCode
)

1334 
	`NdisMoveMemy
(
pAd
->
CommCfg
.
CouryCode
, CountryCode , 2);

1335 
pAd
->
CommCfg
.
CouryCode
[2] = ' ';

1336 #ifde
CONFIG_STA_SUPPORT


1337 #ifde
EXT_BUILD_CHANNEL_LIST


1338 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1339 
	`NdisMoveMemy
(
pAd
->
SCfg
.
SOriCouryCode
, 
CouryCode
 , 2);

1342 i(
	`
((
PSTRING

pAd
->
CommCfg
.
CouryCode
) != 0)

1343 
pAd
->
CommCfg
.
bCouryFg
 = 
TRUE
;

1345 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CouryCode=%s\n", 
pAd
->
CommCfg
.
CouryCode
));

1346 
	}
}

1349 
NDIS_STATUS
 
	$RTMPSProfePams
(

1350 
IN
 
RTMP_ADAPTER
 *
pAd
,

1351 
IN
 
PSTRING
 
pBufr
)

1353 
PSTRING
 
tmpbuf
;

1354 
ULONG
 
RtsThsh
;

1355 
ULONG
 
FgThsh
;

1356 
PSTRING
 
ma
;

1357 
INT
 
i
 = 0, 
tv
;

1358 #ifde
DFS_HARDWARE_SUPPORT


1359 
INT
 
k
=0;

1361 
tmpbuf
 = 
	`kmloc
(
MAX_PARAM_BUFFER_SIZE
, 
MEM_ALLOC_FLAG
);

1362 if(
tmpbuf
 =
NULL
)

1363  
NDIS_STATUS_FAILURE
;

1368 i(
	`RTMPGKeyPam
("MacAddss", 
tmpbuf
, 25, 
pBufr
, 
TRUE
))

1370 
tv
 = 
	`RT_CfgSMacAddss
(
pAd
, 
tmpbuf
);

1371 i(
tv
)

1372 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MacAddress = %02x:%02x:%02x:%02x:%02x:%02x\n",

1373 
	`PRINT_MAC
(
pAd
->
CutAddss
)));

1376 if(
	`RTMPGKeyPam
("CouryRegi", 
tmpbuf
, 25, 
pBufr
, 
TRUE
))

1378 
tv
 = 
	`RT_CfgSCouryRegi
(
pAd
, 
tmpbuf
, 
BAND_24G
);

1379 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CouryRegi=%d\n", 
pAd
->
CommCfg
.
CouryRegi
));

1382 if(
	`RTMPGKeyPam
("CouryRegiABd", 
tmpbuf
, 25, 
pBufr
, 
TRUE
))

1384 
tv
 = 
	`RT_CfgSCouryRegi
(
pAd
, 
tmpbuf
, 
BAND_5G
);

1385 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CouryRegiABd=%d\n", 
pAd
->
CommCfg
.
CouryRegiFABd
));

1387 #ifde
RTMP_EFUSE_SUPPORT


1390 if(
	`RTMPGKeyPam
("CouryCode", 
tmpbuf
, 25, 
pBufr
, 
TRUE
))

1391 
	`RTMPSCouryCode
(
pAd
, 
tmpbuf
);

1393 #ifde
EXT_BUILD_CHANNEL_LIST


1395 if(
	`RTMPGKeyPam
("ChlGeogphy", 
tmpbuf
, 25, 
pBufr
, 
TRUE
))

1397 
UCHAR
 
Geogphy
 = (UCHAR
	`sime_
(
tmpbuf
, 0, 10);

1398 i(
Geogphy
 <
BOTH
)

1400 
pAd
->
CommCfg
.
Geogphy
 = Geography;

1401 
pAd
->
CommCfg
.
CouryCode
[2] =

1402 (
pAd
->
CommCfg
.
Geogphy
 =
BOTH
? ' ' : (Ad->CommCfg.Geogphy =
IDOR
) ? 'I' : 'O');

1403 #ifde
CONFIG_STA_SUPPORT


1404 #ifde
EXT_BUILD_CHANNEL_LIST


1405 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1406 
pAd
->
SCfg
.
SOriGeogphy
 =Ad->
CommCfg
.
Geogphy
;

1409 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ChlGeogphy=%d\n", 
pAd
->
CommCfg
.
Geogphy
));

1414 
pAd
->
CommCfg
.
Geogphy
 = 
BOTH
;

1415 
pAd
->
CommCfg
.
CouryCode
[2] = ' ';

1421 #ifde
CONFIG_STA_SUPPORT


1422 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1425 i(
	`RTMPGKeyPam
("SSID", 
tmpbuf
, 256, 
pBufr
, 
FALSE
))

1427 i(
	`
(
tmpbuf
) <= 32)

1429 
	`RTMPSSTASSID
(
pAd
, 
tmpbuf
);

1430 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::(SSID=%s)\n", 
__FUNCTION__
, 
tmpbuf
));

1436 #ifde
CONFIG_STA_SUPPORT


1437 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1440 i(
	`RTMPGKeyPam
("NwkTy", 
tmpbuf
, 25, 
pBufr
, 
TRUE
))

1442 
pAd
->
bCfigChged
 = 
TRUE
;

1443 i(
	`rcmp
(
tmpbuf
, "Adhoc") == 0)

1444 
pAd
->
SCfg
.
BssTy
 = 
BSS_ADHOC
;

1446 
pAd
->
SCfg
.
BssTy
 = 
BSS_INFRA
;

1448 
pAd
->
SCfg
.
WS
 = 
SS_NOTUSE
;

1449 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::(NwkTy=%d)\n", 
__FUNCTION__
, 
pAd
->
SCfg
.
BssTy
));

1454 if(
	`RTMPGKeyPam
("Chl", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1456 
pAd
->
CommCfg
.
Chl
 = (
UCHAR

	`sime_
(
tmpbuf
, 0, 10);

1457 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Chl=%d\n", 
pAd
->
CommCfg
.
Chl
));

1461 if(
	`RTMPGKeyPam
("WessMode", 
tmpbuf
, 32, 
pBufr
, 
TRUE
))

1463 
i
 = 0, 
ma
 = 
	`rok
(
tmpbuf
,";"); ma; ma =ok(
NULL
,";"), i++)

1466 i(
i
 == 0)

1470 
	`RT_CfgSWessMode
(
pAd
, 
ma
);

1474 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PhyMode=%d\n", 
pAd
->
CommCfg
.
PhyMode
));

1479 if(
	`RTMPGKeyPam
("BasicRe", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1481 
pAd
->
CommCfg
.
BasicReBm
 = (
ULONG

	`sime_
(
tmpbuf
, 0, 10);

1482 
pAd
->
CommCfg
.
BasicReBmOld
 = (
ULONG

	`sime_
(
tmpbuf
, 0, 10);

1483 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BasicRe=%ld\n", 
pAd
->
CommCfg
.
BasicReBm
));

1486 if(
	`RTMPGKeyPam
("BcPiod", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1488 
USHORT
 
b_v
 = (USHORT
	`sime_
(
tmpbuf
, 0, 10);

1491 i(
b_v
 >= 20 && bcn_val <= 1000)

1492 
pAd
->
CommCfg
.
BcPiod
 = 
b_v
;

1494 
pAd
->
CommCfg
.
BcPiod
 = 100;

1496 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BcPiod=%d\n", 
pAd
->
CommCfg
.
BcPiod
));

1502 if(
	`RTMPGKeyPam
("TxPow", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1504 
pAd
->
CommCfg
.
TxPowPage
 = (
ULONG

	`sime_
(
tmpbuf
, 0, 10);

1505 #ifde
CONFIG_STA_SUPPORT


1506 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1507 
pAd
->
CommCfg
.
TxPowDeu
 =Ad->CommCfg.
TxPowPage
;

1509 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("TxPow=%ld\n", 
pAd
->
CommCfg
.
TxPowPage
));

1512 if(
	`RTMPGKeyPam
("BGPrei", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1517 
	`sime_
(
tmpbuf
, 0, 10))

1520 
pAd
->
CommCfg
.
UBGPrei
 = 1;

1523 
pAd
->
CommCfg
.
UBGPrei
 = 2;

1527 
pAd
->
CommCfg
.
UBGPrei
 = 0;

1531 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BGPrei=%ld\n", 
pAd
->
CommCfg
.
UBGPrei
));

1535 if(
	`RTMPGKeyPam
("TxPamb", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1537 
	`sime_
(
tmpbuf
, 0, 10))

1539 
Rt802_11PambSht
:

1540 
pAd
->
CommCfg
.
TxPamb
 = 
Rt802_11PambSht
;

1542 
Rt802_11PambLg
:

1544 
pAd
->
CommCfg
.
TxPamb
 = 
Rt802_11PambLg
;

1547 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("TxPamb=%ld\n", 
pAd
->
CommCfg
.
TxPamb
));

1550 if(
	`RTMPGKeyPam
("RTSThshd", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1552 
RtsThsh
 = 
	`sime_
(
tmpbuf
, 0, 10);

1553 if(
RtsThsh
 >1&& (RtsThsh <
MAX_RTS_THRESHOLD
) )

1554 
pAd
->
CommCfg
.
RtsThshd
 = (
USHORT
)
RtsThsh
;

1556 
pAd
->
CommCfg
.
RtsThshd
 = 
MAX_RTS_THRESHOLD
;

1558 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTSThshd=%d\n", 
pAd
->
CommCfg
.
RtsThshd
));

1561 if(
	`RTMPGKeyPam
("FgThshd", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1563 
FgThsh
 = 
	`sime_
(
tmpbuf
, 0, 10);

1564 
pAd
->
CommCfg
.
bUZoToDibFgmt
 = 
FALSE
;

1566 i(
FgThsh
 > 
MAX_FRAG_THRESHOLD
 || FgThsh < 
MIN_FRAG_THRESHOLD
)

1568 
pAd
->
CommCfg
.
FgmtThshd
 = 
MAX_FRAG_THRESHOLD
;

1569 
pAd
->
CommCfg
.
bUZoToDibFgmt
 = 
TRUE
;

1571 i(
FgThsh
 % 2 == 1)

1575 
pAd
->
CommCfg
.
FgmtThshd
 = (
USHORT
)(
FgThsh
 - 1);

1579 
pAd
->
CommCfg
.
FgmtThshd
 = (
USHORT
)
FgThsh
;

1582 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("FgThshd=%d\n", 
pAd
->
CommCfg
.
FgmtThshd
));

1585 if(
	`RTMPGKeyPam
("TxBur", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1590 if(
	`sime_
(
tmpbuf
, 0, 10) != 0)

1591 
pAd
->
CommCfg
.
bEbTxBur
 = 
TRUE
;

1593 
pAd
->
CommCfg
.
bEbTxBur
 = 
FALSE
;

1595 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("TxBur=%d\n", 
pAd
->
CommCfg
.
bEbTxBur
));

1598 #ifde
AGGREGATION_SUPPORT


1600 if(
	`RTMPGKeyPam
("PktAggge", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1602 if(
	`sime_
(
tmpbuf
, 0, 10) != 0)

1603 
pAd
->
CommCfg
.
bAgggiCab
 = 
TRUE
;

1605 
pAd
->
CommCfg
.
bAgggiCab
 = 
FALSE
;

1606 #ifde
PIGGYBACK_SUPPORT


1607 
pAd
->
CommCfg
.
bPiggyBackCab
 =Ad->CommCfg.
bAgggiCab
;

1609 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PktAggge=%d\n", 
pAd
->
CommCfg
.
bAgggiCab
));

1612 
pAd
->
CommCfg
.
bAgggiCab
 = 
FALSE
;

1613 
pAd
->
CommCfg
.
bPiggyBackCab
 = 
FALSE
;

1618 #ifde
CONFIG_STA_SUPPORT


1619 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1621 
	`mp_ad_a_wmm_rms_om_fe
(
pAd
, 
tmpbuf
, 
pBufr
);

1622 #ifde
XLINK_SUPPORT


1623 
	`mp_g_p_xlk_mode_om_fe
(
pAd
, 
tmpbuf
, 
pBufr
);

1629 if(
	`RTMPGKeyPam
("ShtSl", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1631 
	`RT_CfgSShtSl
(
pAd
, 
tmpbuf
);

1632 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ShtSl=%d\n", 
pAd
->
CommCfg
.
bUShtSlTime
));

1636 if(
	`RTMPGKeyPam
("IEEE80211H", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1638 
i
 = 0, 
ma
 = 
	`rok
(
tmpbuf
,";"); ma; ma =ok(
NULL
,";"), i++)

1640 if(
	`sime_
(
ma
, 0, 10) != 0)

1641 
pAd
->
CommCfg
.
bIEEE80211H
 = 
TRUE
;

1643 
pAd
->
CommCfg
.
bIEEE80211H
 = 
FALSE
;

1645 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IEEE80211H=%d\n", 
pAd
->
CommCfg
.
bIEEE80211H
));

1649 if(
	`RTMPGKeyPam
("CSPiod", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1651 if(
	`sime_
(
tmpbuf
, 0, 10) != 0)

1652 
pAd
->
CommCfg
.
RadDe
.
CSPiod
 = 
	`sime_
(
tmpbuf
, 0, 10);

1654 
pAd
->
CommCfg
.
RadDe
.
CSPiod
 = 0;

1656 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CSPiod=%d\n", 
pAd
->
CommCfg
.
RadDe
.
CSPiod
));

1661 if(
	`RTMPGKeyPam
("RDRegi", 
tmpbuf
, 128, 
pBufr
, 
TRUE
))

1663 
RADAR_DETECT_STRUCT
 *
pRadDe
 = &
pAd
->
CommCfg
.
RadDe
;

1664 i((
	`cmp
(
tmpbuf
, "JAP_W53", 7) == 0) || (strncmp(tmpbuf, "jap_w53", 7) == 0))

1666 
pRadDe
->
RDDurRegi
 = 
JAP_W53
;

1667 
pRadDe
->
DfsSessiTime
 = 15;

1669 i((
	`cmp
(
tmpbuf
, "JAP_W56", 7) == 0) || (strncmp(tmpbuf, "jap_w56", 7) == 0))

1671 
pRadDe
->
RDDurRegi
 = 
JAP_W56
;

1672 
pRadDe
->
DfsSessiTime
 = 13;

1674 i((
	`cmp
(
tmpbuf
, "JAP", 3) == 0) || (strncmp(tmpbuf, "jap", 3) == 0))

1676 
pRadDe
->
RDDurRegi
 = 
JAP
;

1677 
pRadDe
->
DfsSessiTime
 = 5;

1679 i((
	`cmp
(
tmpbuf
, "FCC", 3) == 0) || (strncmp(tmpbuf, "fcc", 3) == 0))

1681 
pRadDe
->
RDDurRegi
 = 
FCC
;

1682 
pRadDe
->
DfsSessiTime
 = 5;

1684 i((
	`cmp
(
tmpbuf
, "CE", 2) == 0) || (strncmp(tmpbuf, "ce", 2) == 0))

1686 
pRadDe
->
RDDurRegi
 = 
CE
;

1687 
pRadDe
->
DfsSessiTime
 = 13;

1691 
pRadDe
->
RDDurRegi
 = 
CE
;

1692 
pRadDe
->
DfsSessiTime
 = 13;

1695 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RDRegi=%d\n", 
pRadDe
->
RDDurRegi
));

1699 
pAd
->
CommCfg
.
RadDe
.
RDDurRegi
 = 
CE
;

1700 
pAd
->
CommCfg
.
RadDe
.
DfsSessiTime
 = 13;

1703 #ifde
SYSTEM_LOG_SUPPORT


1705 if(
	`RTMPGKeyPam
("WessEvt", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1707 #i
WIRELESS_EXT
 >= 15

1708 if(
	`sime_
(
tmpbuf
, 0, 10) != 0)

1709 
pAd
->
CommCfg
.
bWessEvt
 = 
TRUE
;

1711 
pAd
->
CommCfg
.
bWessEvt
 = 
FALSE
;

1713 
pAd
->
CommCfg
.
bWessEvt
 = 
FALSE
;

1715 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("WessEvt=%d\n", 
pAd
->
CommCfg
.
bWessEvt
));

1721 if(
	`RTMPGKeyPam
("AuthMode", 
tmpbuf
, 128, 
pBufr
, 
TRUE
))

1723 #ifde
CONFIG_STA_SUPPORT


1724 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1726 i((
	`rcmp
(
tmpbuf
, "WEPAUTO") == 0) || (strcmp(tmpbuf, "wepauto") == 0))

1727 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeAutoSwch
;

1728 i((
	`rcmp
(
tmpbuf
, "SHARED") == 0) || (strcmp(tmpbuf, "shared") == 0))

1729 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeShed
;

1730 i((
	`rcmp
(
tmpbuf
, "WPAPSK") == 0) || (strcmp(tmpbuf, "wpapsk") == 0))

1731 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPAPSK
;

1732 i((
	`rcmp
(
tmpbuf
, "WPANONE") == 0) || (strcmp(tmpbuf, "wpanone") == 0))

1733 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPANe
;

1734 i((
	`rcmp
(
tmpbuf
, "WPA2PSK") == 0) || (strcmp(tmpbuf, "wpa2psk") == 0))

1735 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPA2PSK
;

1736 #ifde
WPA_SUPPLICANT_SUPPORT


1737 i((
	`rcmp
(
tmpbuf
, "WPA") == 0) || (strcmp(tmpbuf, "wpa") == 0))

1738 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPA
;

1739 i((
	`rcmp
(
tmpbuf
, "WPA2") == 0) || (strcmp(tmpbuf, "wpa2") == 0))

1740 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPA2
;

1743 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeOn
;

1745 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_NOT_SECURED
;

1747 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::(AuthMode=%d)\n", 
__FUNCTION__
, 
pAd
->
SCfg
.
AuthMode
));

1752 if(
	`RTMPGKeyPam
("EnypTy", 
tmpbuf
, 128, 
pBufr
, 
TRUE
))

1755 #ifde
CONFIG_STA_SUPPORT


1756 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1758 i((
	`rcmp
(
tmpbuf
, "WEP") == 0) || (strcmp(tmpbuf, "wep") == 0))

1759 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11WEPEbd
;

1760 i((
	`rcmp
(
tmpbuf
, "TKIP") == 0) || (strcmp(tmpbuf, "tkip") == 0))

1761 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11Enyi2Ebd
;

1762 i((
	`rcmp
(
tmpbuf
, "AES") == 0) || (strcmp(tmpbuf, "aes") == 0))

1763 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11Enyi3Ebd
;

1765 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11WEPDibd
;

1766 
	`RTMPSSTAChSues
(
pAd
,Ad->
SCfg
.
WStus
);

1768 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::(EnypTy=%d)\n", 
__FUNCTION__
, 
pAd
->
SCfg
.
WStus
));

1774 #ifde
CONFIG_STA_SUPPORT


1775 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1777 if(
	`RTMPGKeyPam
("WPAPSK", 
tmpbuf
, 512, 
pBufr
, 
FALSE
))

1778 
	`RTMPSSTAPassPh
(
pAd
, 
tmpbuf
);

1783 
	`mp_ad_key_rms_om_fe
(
pAd
, 
tmpbuf
, 
pBufr
);

1788 #ifde
DOT11_N_SUPPORT


1789 
	`HTPamsHook
(
pAd
, 
tmpbuf
, 
pBufr
);

1792 #ifde
CARRIER_DETECTION_SUPPORT


1794 if(
	`RTMPGKeyPam
("CrrDe", 
tmpbuf
, 128, 
pBufr
, 
TRUE
))

1796 i((
	`cmp
(
tmpbuf
, "0", 1) == 0))

1797 
pAd
->
CommCfg
.
CrrDe
.
Eb
 = 
FALSE
;

1798 i((
	`cmp
(
tmpbuf
, "1", 1) == 0))

1799 
pAd
->
CommCfg
.
CrrDe
.
Eb
 = 
TRUE
;

1801 
pAd
->
CommCfg
.
CrrDe
.
Eb
 = 
FALSE
;

1803 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CrrDe.Eb=%d\n", 
pAd
->
CommCfg
.
CrrDe
.
Eb
));

1806 
pAd
->
CommCfg
.
CrrDe
.
Eb
 = 
FALSE
;

1809 #ifde
CONFIG_STA_SUPPORT


1810 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1813 i(
	`RTMPGKeyPam
("PSMode", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1815 i(
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
)

1817 i((
	`rcmp
(
tmpbuf
, "MAX_PSP") == 0) || (strcmp(tmpbuf, "max_psp") == 0))

1822 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_RECEIVE_DTIM
);

1823 i(
pAd
->
SCfg
.
bWdowsACCAMEb
 =
FALSE
)

1824 
pAd
->
SCfg
.
WdowsPowMode
 = 
Ndis802_11PowModeMAX_PSP
;

1825 
pAd
->
SCfg
.
WdowsBryPowMode
 = 
Ndis802_11PowModeMAX_PSP
;

1826 
pAd
->
SCfg
.
DeuLiCou
 = 5;

1828 i((
	`rcmp
(
tmpbuf
, "Fast_PSP") == 0) || (strcmp(tmpbuf, "fast_psp") == 0)

1829 || (
	`rcmp
(
tmpbuf
, "FAST_PSP") == 0))

1833 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_RECEIVE_DTIM
);

1834 i(
pAd
->
SCfg
.
bWdowsACCAMEb
 =
FALSE
)

1835 
pAd
->
SCfg
.
WdowsPowMode
 = 
Ndis802_11PowModeFa_PSP
;

1836 
pAd
->
SCfg
.
WdowsBryPowMode
 = 
Ndis802_11PowModeFa_PSP
;

1837 
pAd
->
SCfg
.
DeuLiCou
 = 3;

1839 i((
	`rcmp
(
tmpbuf
, "Legacy_PSP") == 0) || (strcmp(tmpbuf, "legacy_psp") == 0)

1840 || (
	`rcmp
(
tmpbuf
, "LEGACY_PSP") == 0))

1844 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_RECEIVE_DTIM
);

1845 i(
pAd
->
SCfg
.
bWdowsACCAMEb
 =
FALSE
)

1846 
pAd
->
SCfg
.
WdowsPowMode
 = 
Ndis802_11PowModeLegacy_PSP
;

1847 
pAd
->
SCfg
.
WdowsBryPowMode
 = 
Ndis802_11PowModeLegacy_PSP
;

1848 
pAd
->
SCfg
.
DeuLiCou
 = 3;

1853 
	`RTMP_SET_PSM_BIT
(
pAd
, 
PWR_ACTIVE
);

1854 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_RECEIVE_DTIM
);

1855 i(
pAd
->
SCfg
.
bWdowsACCAMEb
 =
FALSE
)

1856 
pAd
->
SCfg
.
WdowsPowMode
 = 
Ndis802_11PowModeCAM
;

1857 
pAd
->
SCfg
.
WdowsBryPowMode
 = 
Ndis802_11PowModeCAM
;

1859 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PSMode=%ld\n", 
pAd
->
SCfg
.
WdowsPowMode
));

1863 i(
	`RTMPGKeyPam
("AutoRmg", 
tmpbuf
, 32, 
pBufr
, 
TRUE
))

1865 i(
	`sime_
(
tmpbuf
, 0, 10) == 0)

1866 
pAd
->
SCfg
.
bAutoRmg
 = 
FALSE
;

1868 
pAd
->
SCfg
.
bAutoRmg
 = 
TRUE
;

1870 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AutoRmg=%d\n", 
pAd
->
SCfg
.
bAutoRmg
));

1873 i(
	`RTMPGKeyPam
("RmThshd", 
tmpbuf
, 32, 
pBufr
, 
TRUE
))

1875 
lInfo
 = 
	`sime_
(
tmpbuf
, 0, 10);

1877 i(
lInfo
 > 90 ||Info < 60)

1878 
pAd
->
SCfg
.
dBmToRm
 = -70;

1880 
pAd
->
SCfg
.
dBmToRm
 = (
CHAR
)(-1)*
lInfo
;

1882 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RmThshd=%d dBm\n", 
pAd
->
SCfg
.
dBmToRm
));

1888 if(
	`RTMPGKeyPam
("TGnWifiTe", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1890 if(
	`sime_
(
tmpbuf
, 0, 10) == 0)

1891 
pAd
->
SCfg
.
bTGnWifiTe
 = 
FALSE
;

1893 
pAd
->
SCfg
.
bTGnWifiTe
 = 
TRUE
;

1894 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("TGnWifiTe=%d\n", 
pAd
->
SCfg
.
bTGnWifiTe
));

1898 i(
	`RTMPGKeyPam
("BcLoTime", 
tmpbuf
, 32, 
pBufr
, 
TRUE
))

1900 
ULONG
 
lInfo
 = (ULONG)
	`sime_
(
tmpbuf
, 0, 10);

1902 i((
lInfo
 != 0) && (lInfo <= 60))

1903 
pAd
->
SCfg
.
BcLoTime
 = (
lInfo
 * 
OS_HZ
);

1904 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BcLoTime=%ld \n", 
pAd
->
SCfg
.
BcLoTime
));

1908 i(
	`RTMPGKeyPam
("AutoC", 
tmpbuf
, 32, 
pBufr
, 
TRUE
))

1910 i(
	`sime_
(
tmpbuf
, 0, 10) == 0)

1911 
pAd
->
SCfg
.
bAutoCIfNoSSID
 = 
FALSE
;

1913 
pAd
->
SCfg
.
bAutoCIfNoSSID
 = 
TRUE
;

1919 if(
	`RTMPGKeyPam
("FaC", 
tmpbuf
, 32, 
pBufr
, 
TRUE
))

1921 i(
	`sime_
(
tmpbuf
, 0, 10) == 0)

1922 
pAd
->
SCfg
.
bFaC
 = 
FALSE
;

1924 
pAd
->
SCfg
.
bFaC
 = 
TRUE
;

1926 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("FaC=%d\n", 
pAd
->
SCfg
.
bFaC
));

1935 #ifde
SINGLE_SKU


1936 if(
	`RTMPGKeyPam
("AGa", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1938 
UCHAR
 
AGa
 = 
	`sime_
(
tmpbuf
, 0, 10);

1939 
pAd
->
CommCfg
.
AGa
= AntGain;

1941 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AGa=%d\n", 
pAd
->
CommCfg
.
AGa
));

1943 if(
	`RTMPGKeyPam
("BdedgeD", 
tmpbuf
, 10, 
pBufr
, 
TRUE
))

1945 
UCHAR
 
Bdedge
 = 
	`sime_
(
tmpbuf
, 0, 10);

1946 
pAd
->
CommCfg
.
BdedgeD
 = 
Bdedge
;

1948 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BdedgeD=%d\n", 
pAd
->
CommCfg
.
BdedgeD
));

1955 
	`k
(
tmpbuf
);

1957  
NDIS_STATUS_SUCCESS
;

1958 
	}
}

1961 #ifde
MULTIPLE_CARD_SUPPORT


1963 
UINT8
 
	gMC_CdUd
[
MAX_NUM_OF_MULTIPLE_CARD
];

1965 
UINT8
 
	gMC_CdMac
[
MAX_NUM_OF_MULTIPLE_CARD
][6];

1982 
BOOLEAN
 
	$RTMP_CdInfoRd
(

1983 
IN
 
PRTMP_ADAPTER
 
pAd
)

1985 
	#MC_SELECT_CARDID
 0

	)

1986 
	#MC_SELECT_MAC
 1

	)

1987 
	#MC_SELECT_CARDTYPE
 2

	)

1989 
	#LETTER_CASE_TRANSLATE
(
txt_p
, 
rd_id
) \

1990 { 
UINT32
 
_n
; 
_ch
; \

1991 
_n
=0; _n<
	`
(
rd_id
); _len++) { \

1992 
_ch
 = *(
txt_p
 + 
_n
); \

1993 i(('A' <
_ch
) && (_char <= 'Z')) \

1994 *(
txt_p
+
_n
'a'+(
_ch
-'A'); \

1995 } }

	)

1997 
RTMP_OS_FD
 
cf
;

1998 
INT
 
tv
;

1999 
PSTRING
 
bufr
, 
tmpbuf
;

2000 
STRING
 
rd_id_buf
[30], 
RFIC_wd
[30];

2001 
BOOLEAN
 
g_mch_ok
 = 
FALSE
;

2002 
INT32
 
rd__mhod
;

2003 
INT32
 
rd__id
, 
rd_nou_id
, 
rd_me_mac_id
, 
rd_mch_id
;

2004 
EEPROM_ANTENNA_STRUC
 
a
;

2005 
USHORT
 
addr01
, 
addr23
, 
addr45
;

2006 
UINT8
 
mac
[6];

2007 
UINT32
 
da
, 
rd_dex
;

2008 
UCHAR
 *
t_r
;

2009 
RTMP_OS_FS_INFO
 
osFSInfo
;

2012 
bufr
 = 
	`kmloc
(
MAX_INI_BUFFER_SIZE
, 
MEM_ALLOC_FLAG
);

2013 i(
bufr
 =
NULL
)

2014  
FALSE
;

2016 
tmpbuf
 = 
	`kmloc
(
MAX_PARAM_BUFFER_SIZE
, 
MEM_ALLOC_FLAG
);

2017 if(
tmpbuf
 =
NULL
)

2019 
	`k
(
bufr
);

2020  
NDIS_STATUS_FAILURE
;

2024 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
da
);

2026 i((
da
 & 0x30) == 0)

2027 
pAd
->
EEPROMAddssNum
 = 6;

2028 i((
da
 & 0x30) == 0x10)

2029 
pAd
->
EEPROMAddssNum
 = 8;

2031 
pAd
->
EEPROMAddssNum
 = 8;

2033 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_NIC1_OFFSET
, 
a
.
wd
);

2035 i((
a
.
fld
.
RfIcTy
 =
RFIC_2850
) ||

2036 (
a
.
fld
.
RfIcTy
 =
RFIC_2750
) ||

2037 (
a
.
fld
.
RfIcTy
 =
RFIC_2853
) ||

2038 (
a
.
fld
.
RfIcTy
 =
RFIC_3853
))

2041 
	`ry
(
RFIC_wd
, "abgn");

2046 
	`ry
(
RFIC_wd
, "bgn");

2050 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x04, 
addr01
);

2051 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x06, 
addr23
);

2052 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x08, 
addr45
);

2054 
mac
[0] = (
UCHAR
)(
addr01
 & 0xff);

2055 
mac
[1] = (
UCHAR
)(
addr01
 >> 8);

2056 
mac
[2] = (
UCHAR
)(
addr23
 & 0xff);

2057 
mac
[3] = (
UCHAR
)(
addr23
 >> 8);

2058 
mac
[4] = (
UCHAR
)(
addr45
 & 0xff);

2059 
mac
[5] = (
UCHAR
)(
addr45
 >> 8);

2061 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("maaddr=%02x:%02x:%02x:%02x:%02x:%02x!\n", 
	`PRINT_MAC
(
mac
)));

2063 
	`RtmpOSFSInfoChge
(&
osFSInfo
, 
TRUE
);

2065 
cf
 = 
	`RtmpOSFeOn
(
CARD_INFO_PATH
, 
O_RDONLY
, 0);

2066 i(
	`IS_FILE_OPEN_ERR
(
cf
))

2069 
	`DBGPRINT
(
RT_DEBUG_TRACE
,

2070 ("--> E ong %s\n", 
CARD_INFO_PATH
));

2071 
_sour
;

2075 
	`memt
(
bufr
, 0x00, 
MAX_INI_BUFFER_SIZE
);

2076 
tv
 = 
	`RtmpOSFeRd
(
cf
, 
bufr
, 
MAX_INI_BUFFER_SIZE
);

2077 i(
tv
 < 0)

2080 
	`DBGPRINT
(
RT_DEBUG_TRACE
,

2081 ("--> Rd %r %d\n", 
CARD_INFO_PATH
, -
tv
));

2086 
	`memt
(
tmpbuf
, 0x00, 
MAX_PARAM_BUFFER_SIZE
);

2087 
rd__mhod
 = 
MC_SELECT_CARDTYPE
;

2089 i(
	`RTMPGKeyPam
("SELECT", 
tmpbuf
, 256, 
bufr
, 
TRUE
))

2091 i(
	`rcmp
(
tmpbuf
, "CARDID") == 0)

2092 
rd__mhod
 = 
MC_SELECT_CARDID
;

2093 i(
	`rcmp
(
tmpbuf
, "MAC") == 0)

2094 
rd__mhod
 = 
MC_SELECT_MAC
;

2095 i(
	`rcmp
(
tmpbuf
, "CARDTYPE") == 0)

2096 
rd__mhod
 = 
MC_SELECT_CARDTYPE
;

2099 
	`DBGPRINT
(
RT_DEBUG_TRACE
,

2100 ("MC> Cd Sei = %d\n", 
rd__mhod
));

2103 
rd__id
 = -1;

2104 
rd_nou_id
 = -1;

2105 
rd_me_mac_id
 = -1;

2106 
rd_mch_id
 = -1;

2109 
rd_dex
=0;

2110 
rd_dex
<
MAX_NUM_OF_MULTIPLE_CARD
;

2111 
rd_dex
++)

2113 i((*(
UINT32
 *)&
MC_CdMac
[
rd_dex
][0] == 0) &&

2114 (*(
UINT16
 *)&
MC_CdMac
[
rd_dex
][4] == 0))

2117 
MC_CdUd
[
rd_dex
] = 0;

2119 i(
rd__id
 < 0)

2120 
rd__id
 = 
rd_dex
;

2124 i(
	`memcmp
(
MC_CdMac
[
rd_dex
], 
mac
, 6) == 0)

2127 i(
rd_me_mac_id
 < 0)

2128 
rd_me_mac_id
 = 
rd_dex
;

2133 i((
MC_CdUd
[
rd_dex
] == 0) &&

2134 (
rd_nou_id
 < 0))

2136 
rd_nou_id
 = 
rd_dex
;

2142 
	`DBGPRINT
(
RT_DEBUG_TRACE
,

2144 
rd__id
, 
rd_me_mac_id
, 
rd_nou_id
));

2146 i((
rd_me_mac_id
 >= 0) &&

2147 ((
rd__mhod
 =
MC_SELECT_CARDID
) ||

2148 (
rd__mhod
 =
MC_SELECT_CARDTYPE
)))

2151 
rd_mch_id
 = 
rd_me_mac_id
;

2153 i(
rd__mhod
 =
MC_SELECT_CARDTYPE
)

2156 
	`rtf
(
rd_id_buf
, "%02dCARDTYPE%s",

2157 
rd_mch_id
, 
RFIC_wd
);

2159 i((
t_r
 = (
PUCHAR
)
	`rruncmp
(
bufr
, 
rd_id_buf
)!
NULL
)

2162 
	`LETTER_CASE_TRANSLATE
(
t_r
, 
rd_id_buf
);

2169 
rd__mhod
)

2171 
MC_SELECT_CARDID
:

2173 i(
rd__id
 >= 0)

2174 
rd_mch_id
 = 
rd__id
;

2176 
rd_mch_id
 = 
rd_nou_id
;

2179 
MC_SELECT_MAC
:

2180 
	`rtf
(
rd_id_buf
, "MAC%02x:%02x:%02x:%02x:%02x:%02x",

2181 
mac
[0], mac[1], mac[2],

2182 
mac
[3], mac[4], mac[5]);

2185 i((
t_r
 = (
PUCHAR
)
	`rruncmp
(
bufr
, 
rd_id_buf
)!
NULL
)

2187 
	`LETTER_CASE_TRANSLATE
(
t_r
, 
rd_id_buf
);

2190 
t_r
 -= 2;

2191 
rd_id_buf
[0] = *(
t_r
);

2192 
rd_id_buf
[1] = *(
t_r
+1);

2193 
rd_id_buf
[2] = 0x00;

2195 
rd_mch_id
 = 
	`sime_
(
rd_id_buf
, 0, 10);

2199 
MC_SELECT_CARDTYPE
:

2200 
rd_nou_id
 = -1;

2202 
rd_dex
=0;

2203 
rd_dex
<
MAX_NUM_OF_MULTIPLE_CARD
;

2204 
rd_dex
++)

2206 
	`rtf
(
rd_id_buf
, "%02dCARDTYPE%s",

2207 
rd_dex
, 
RFIC_wd
);

2209 i((
t_r
 = (
PUCHAR
)
	`rruncmp
(
bufr
,

2210 
rd_id_buf
)!
NULL
)

2212 
	`LETTER_CASE_TRANSLATE
(
t_r
, 
rd_id_buf
);

2214 i(
MC_CdUd
[
rd_dex
] == 0)

2217 i((*(
UINT32
 *)&
MC_CdMac
[
rd_dex
][0] == 0) &&

2218 (*(
UINT16
 *)&
MC_CdMac
[
rd_dex
][4] == 0))

2221 
rd_mch_id
 = 
rd_dex
;

2227 i(
rd_nou_id
 < 0)

2228 
rd_nou_id
 = 
rd_dex
;

2235 i(
rd_mch_id
 < 0)

2236 
rd_mch_id
 = 
rd_nou_id
;

2241 i(
rd_mch_id
 >= 0)

2244 
rd__mhod
)

2246 
MC_SELECT_CARDID
:

2247 
	`rtf
(
rd_id_buf
, "%02dCARDID", 
rd_mch_id
);

2250 
MC_SELECT_MAC
:

2251 
	`rtf
(
rd_id_buf
,

2253 
rd_mch_id
,

2254 
mac
[0], mac[1], mac[2],

2255 
mac
[3], mac[4], mac[5]);

2258 
MC_SELECT_CARDTYPE
:

2260 
	`rtf
(
rd_id_buf
, "%02dcardtype%s",

2261 
rd_mch_id
, 
RFIC_wd
);

2265 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Srch Keywd = %s\n", 
rd_id_buf
));

2268 i(
	`RTMPGKeyPam
(
rd_id_buf
, 
tmpbuf
, 256, 
bufr
, 
TRUE
))

2270 i(
	`
(
tmpbuf
< (
pAd
->
MC_FeName
))

2273 
pAd
->
MC_RowID
 = 
rd_mch_id
;

2274 
MC_CdUd
[
rd_mch_id
] = 1;

2275 
	`memy
(
MC_CdMac
[
rd_mch_id
], 
mac
, (mac));

2278 
	`NdisMoveMemy
(
pAd
->
MC_FeName
, 
tmpbuf
 , 
	`
(tmpbuf));

2279 
pAd
->
MC_FeName
[
	`
(
tmpbuf
)] = '\0';

2280 
g_mch_ok
 = 
TRUE
;

2282 
	`DBGPRINT
(
RT_DEBUG_TRACE
,

2283 ("Cd ProfNam%s\n", 
pAd
->
MC_FeName
));

2287 
	`DBGPRINT
(
RT_DEBUG_ERROR
,

2293 
	`DBGPRINT
(
RT_DEBUG_ERROR
,

2297 i((
g_mch_ok
 !
TRUE
) &&

2298 (
rd_mch_id
 < 
MAX_NUM_OF_MULTIPLE_CARD
))

2300 
MC_CdUd
[
rd_mch_id
] = 0;

2301 
	`memt
(
MC_CdMac
[
rd_mch_id
], 0, (
mac
));

2308 
tv
 = 
	`RtmpOSFeClo
(
cf
);

2310 
_sour
:

2311 
	`RtmpOSFSInfoChge
(&
osFSInfo
, 
FALSE
);

2312 
	`k
(
bufr
);

2313 
	`k
(
tmpbuf
);

2315  
g_mch_ok
;

2316 
	}
}

	@common/cmm_sanity.c

37 
	~"_cfig.h
"

39 
UCHAR
 
CISCO_OUI
[];

41 
UCHAR
 
WPA_OUI
[];

42 
UCHAR
 
RSN_OUI
[];

43 
UCHAR
 
WME_INFO_ELEM
[];

44 
UCHAR
 
WME_PARM_ELEM
[];

45 
UCHAR
 
RALINK_OUI
[];

46 
UCHAR
 
BROADCOM_OUI
[];

47 
UCHAR
 
WPS_OUI
[];

49 
	swsc__obq_da


51 
UCHAR
 
	mssid
[32];

52 
UCHAR
 
	mmacAddr
[6];

53 
UCHAR
 
	mda
[2];

54 } 
	tWSC_IE_PROBREQ_DATA
;

67 
BOOLEAN
 
	$MlmeAddBAReqSy
(

68 
IN
 
PRTMP_ADAPTER
 
pAd
,

69 
IN
 
VOID
 *
Msg
,

70 
IN
 
ULONG
 
MsgL
,

71 
OUT
 
PUCHAR
 
pAddr2
)

73 
PMLME_ADDBA_REQ_STRUCT
 
pInfo
;

75 
pInfo
 = (
MLME_ADDBA_REQ_STRUCT
 *)
Msg
;

77 i((
MsgL
 !(
MLME_ADDBA_REQ_STRUCT
)))

79 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeAddBAReqSanity fail - messageenghtot correct.\n"));

80  
FALSE
;

83 i((
pInfo
->
Wcid
 >
MAX_LEN_OF_MAC_TABLE
))

85 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeAddBAReqSanity fail - Theeer Mac isotssociated yet.\n"));

86  
FALSE
;

97 i((
pInfo
->
pAddr
[0]&0x01) == 0x01)

99 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeAddBAReqSanity fail - broadcastddressot support BA\n"));

100  
FALSE
;

103  
TRUE
;

104 
	}
}

117 
BOOLEAN
 
	$MlmeDBAReqSy
(

118 
IN
 
PRTMP_ADAPTER
 
pAd
,

119 
IN
 
VOID
 *
Msg
,

120 
IN
 
ULONG
 
MsgL
)

122 
MLME_DELBA_REQ_STRUCT
 *
pInfo
;

123 
pInfo
 = (
MLME_DELBA_REQ_STRUCT
 *)
Msg
;

125 i((
MsgL
 !(
MLME_DELBA_REQ_STRUCT
)))

127 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("MlmeDelBAReqSanity fail - messageenghtot correct.\n"));

128  
FALSE
;

131 i((
pInfo
->
Wcid
 >
MAX_LEN_OF_MAC_TABLE
))

133 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("MlmeDelBAReqSanity fail - Theeer Mac isotssociated yet.\n"));

134  
FALSE
;

137 i((
pInfo
->
TID
 & 0xf0))

139 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("MlmeDelBAReqSanity fail - Theeer TID is incorrect.\n"));

140  
FALSE
;

143 i(
	`NdisEquMemy
(
pAd
->
MacTab
.
Cڋ
[
pInfo
->
Wcid
].
Addr
,Info->Addr, 
MAC_ADDR_LEN
) == 0)

145 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("MlmeDelBAReqSanity fail -heeerddr dosen'txist.\n"));

146  
FALSE
;

149  
TRUE
;

150 
	}
}

152 
BOOLEAN
 
	$PrAddBAReqAiSy
(

153 
IN
 
PRTMP_ADAPTER
 
pAd
,

154 
IN
 
VOID
 *
pMsg
,

155 
IN
 
ULONG
 
MsgL
,

156 
OUT
 
PUCHAR
 
pAddr2
)

158 
PFRAME_802_11
 
pFme
 = (PFRAME_802_11)
pMsg
;

159 
PFRAME_ADDBA_REQ
 
pAddFme
;

160 
pAddFme
 = (
PFRAME_ADDBA_REQ
)(
pMsg
);

161 i(
MsgL
 < ((
FRAME_ADDBA_REQ
)))

163 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("PrAddBAReqAiSy: ADDBA Reque fmngth siz%ld incܻ\n", 
MsgL
));

164  
FALSE
;

167 #ifde
UNALIGNMENT_SUPPORT


169 
BA_PARM
 
tmpBaPm
;

171 
	`NdisMoveMemy
((
PUCHAR
)(&
tmpBaPm
), (PUCHAR)(&
pAddFme
->
BaPm
), (
BA_PARM
));

172 *(
USHORT
 *)(&
tmpBaPm

	`u216
(*(USHORT *)(&tmpBaParm));

173 
	`NdisMoveMemy
((
PUCHAR
)(&
pAddFme
->
BaPm
), (PUCHAR)(&
tmpBaPm
), (
BA_PARM
));

176 *(
USHORT
 *)(&
pAddFme
->
BaPm

	`u216
(*(USHORT *)(&pAddFrame->BaParm));

178 
pAddFme
->
TimeOutVue
 = 
	`u216
(pAddFrame->TimeOutValue);

179 
pAddFme
->
BaSSeq
.
wd
 = 
	`u216
(pAddFrame->BaStartSeq.word);

181 i(
pAddFme
->
BaPm
.
BAPicy
 !
IMMED_BA
)

183 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("PrAddBAReqAiSy: ADDBA Reque BPicy[%d] sut\n", 
pAddFme
->
BaPm
.
BAPicy
));

184 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("ADDBA Reque.id=%x, Bufsize=%x, AMSDUSu܋d=%x \n", 
pAddFme
->
BaPm
.
TID
,AddFme->BaPm.
BufSize
,AddFme->BaPm.
AMSDUSu܋d
));

185  
FALSE
;

189 i(
pAddFme
->
BaPm
.
TID
 &0xfff0)

191 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("PrAddBAReqAiSy: ADDBA Reque incܻ TID = %d\n", 
pAddFme
->
BaPm
.
TID
));

192  
FALSE
;

194 
	`COPY_MAC_ADDR
(
pAddr2
, 
pFme
->
Hdr
.
Addr2
);

195  
TRUE
;

196 
	}
}

198 
BOOLEAN
 
	$PrAddBARAiSy
(

199 
IN
 
PRTMP_ADAPTER
 
pAd
,

200 
IN
 
VOID
 *
pMsg
,

201 
IN
 
ULONG
 
MsgL
)

204 
PFRAME_ADDBA_RSP
 
pAddFme
;

206 
pAddFme
 = (
PFRAME_ADDBA_RSP
)(
pMsg
);

207 i(
MsgL
 < ((
FRAME_ADDBA_RSP
)))

209 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("PrAddBARAiSy: ADDBA Reڣ fmngth siz%ld incܻ\n", 
MsgL
));

210  
FALSE
;

213 #ifde
UNALIGNMENT_SUPPORT


215 
BA_PARM
 
tmpBaPm
;

217 
	`NdisMoveMemy
((
PUCHAR
)(&
tmpBaPm
), (PUCHAR)(&
pAddFme
->
BaPm
), (
BA_PARM
));

218 *(
USHORT
 *)(&
tmpBaPm

	`u216
(*(USHORT *)(&tmpBaParm));

219 
	`NdisMoveMemy
((
PUCHAR
)(&
pAddFme
->
BaPm
), (PUCHAR)(&
tmpBaPm
), (
BA_PARM
));

222 *(
USHORT
 *)(&
pAddFme
->
BaPm

	`u216
(*(USHORT *)(&pAddFrame->BaParm));

224 
pAddFme
->
StusCode
 = 
	`u216
(pAddFrame->StatusCode);

225 
pAddFme
->
TimeOutVue
 = 
	`u216
(pAddFrame->TimeOutValue);

227 i(
pAddFme
->
BaPm
.
BAPicy
 !
IMMED_BA
)

229 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("PrAddBAReqAiSy: ADDBA Reڣ BPicy[%d] sut\n", 
pAddFme
->
BaPm
.
BAPicy
));

230  
FALSE
;

234 i(
pAddFme
->
BaPm
.
TID
 &0xfff0)

236 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("PrAddBARAiSy: ADDBA Reڣ incܻ TID = %d\n", 
pAddFme
->
BaPm
.
TID
));

237  
FALSE
;

239  
TRUE
;

241 
	}
}

243 
BOOLEAN
 
	$PrDBAAiSy
(

244 
IN
 
PRTMP_ADAPTER
 
pAd
,

245 
IN
 
UCHAR
 
Wcid
,

246 
IN
 
VOID
 *
pMsg
,

247 
IN
 
ULONG
 
MsgL
 )

250 
PFRAME_DELBA_REQ
 
pDFme
;

251 i(
MsgL
 !((
FRAME_DELBA_REQ
)))

252  
FALSE
;

254 i(
Wcid
 >
MAX_LEN_OF_MAC_TABLE
)

255  
FALSE
;

257 
pDFme
 = (
PFRAME_DELBA_REQ
)(
pMsg
);

259 *(
USHORT
 *)(&
pDFme
->
DbaPm

	`u216
(*(USHORT *)(&pDelFrame->DelbaParm));

260 
pDFme
->
RsCode
 = 
	`u216
(pDelFrame->ReasonCode);

262 i(
pDFme
->
DbaPm
.
TID
 &0xfff0)

263  
FALSE
;

265  
TRUE
;

266 
	}
}

279 
BOOLEAN
 
PrBcAndProbeRSy
(

280 
IN
 
PRTMP_ADAPTER
 
pAd
,

281 
IN
 
VOID
 *
Msg
,

282 
IN
 
ULONG
 
MsgL
,

283 
IN
 
UCHAR
 
MsgChl
,

284 
OUT
 
PUCHAR
 
pAddr2
,

285 
OUT
 
PUCHAR
 
pBssid
,

286 
OUT
 
CHAR
 
Ssid
[],

287 
OUT
 
UCHAR
 *
pSsidL
,

288 
OUT
 
UCHAR
 *
pBssTy
,

289 
OUT
 
USHORT
 *
pBcPiod
,

290 
OUT
 
UCHAR
 *
pChl
,

291 
OUT
 
UCHAR
 *
pNewChl
,

292 
OUT
 
LARGE_INTEGER
 *
pTimeamp
,

293 
OUT
 
CF_PARM
 *
pCfPm
,

294 
OUT
 
USHORT
 *
pAtimW
,

295 
OUT
 
USHORT
 *
pCabyInfo
,

296 
OUT
 
UCHAR
 *
pE
,

297 
OUT
 
UCHAR
 *
pDtimCou
,

298 
OUT
 
UCHAR
 *
pDtimPiod
,

299 
OUT
 
UCHAR
 *
pBFg
,

300 
OUT
 
UCHAR
 *
pMesgeToMe
,

301 
OUT
 
UCHAR
 
SupRe
[],

302 
OUT
 
UCHAR
 *
pSupReL
,

303 
OUT
 
UCHAR
 
ExtRe
[],

304 
OUT
 
UCHAR
 *
pExtReL
,

305 
OUT
 
UCHAR
 *
pCkFg
,

306 
OUT
 
UCHAR
 *
pAڑClPowLim
,

307 
OUT
 
PEDCA_PARM
 
pEdPm
,

308 
OUT
 
PQBSS_LOAD_PARM
 
pQbssLd
,

309 
OUT
 
PQOS_CAPABILITY_PARM
 
pQosCaby
,

310 
OUT
 
ULONG
 *
pRkIe
,

311 
OUT
 
UCHAR
 *
pHtCabyL
,

312 #ifde
CONFIG_STA_SUPPORT


313 
OUT
 
UCHAR
 *
pPNHtCabyL
,

315 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
,

316 
OUT
 
EXT_CAP_INFO_ELEMENT
 *
pExtCInfo
,

317 
OUT
 
UCHAR
 *
AddHtInfoL
,

318 
OUT
 
ADD_HT_INFO_IE
 *
AddHtInfo
,

319 
OUT
 
UCHAR
 *
NewExtChlOfft
,

320 
OUT
 
USHORT
 *
LgthVIE
,

321 
OUT
 
PNDIS_802_11_VARIABLE_IEs
 
pVIE
)

323 
UCHAR
 *
	gP
;

324 #ifde
CONFIG_STA_SUPPORT


325 
UCHAR
 
	gTimL
;

327 
PFRAME_802_11
 
	gpFme
;

328 
PEID_STRUCT
 
	gpEid
;

329 
UCHAR
 
	gSubTy
;

330 
UCHAR
 
	gSy
;

333 
ULONG
 
	gLgth
 = 0;

338 
UCHAR
 
	gClChl
 = 0;

341 
	gSy
 = 0;

343 *
	gpAtimW
 = 0;

344 *
	gpE
 = 0;

345 *
	gpDtimCou
 = 0;

346 *
	gpDtimPiod
 = 0;

347 *
	gpBFg
 = 0;

348 *
	gpMesgeToMe
 = 0;

349 *
	gpExtReL
 = 0;

350 *
	gpCkFg
 = 0;

351 *
	gpAڑClPowLim
 = 0xFF;

352 *
	gLgthVIE
 = 0;

353 *
	gpHtCabyL
 = 0;

354 #ifde
CONFIG_STA_SUPPORT


355 i(
	gpAd
->
	gOpMode
 =
OPMODE_STA
)

356 *
pPNHtCabyL
 = 0;

358 *
	gAddHtInfoL
 = 0;

359 
NdisZoMemy
(
pExtCInfo
, (
EXT_CAP_INFO_ELEMENT
));

360 *
	gpRkIe
 = 0;

361 *
	gpNewChl
 = 0;

362 *
	gNewExtChlOfft
 = 0xff;

363 
	gpCfPm
->
	gbVid
 = 
FALSE
;

364 
	gpQbssLd
->
	gbVid
 = 
FALSE
;

365 
	gpEdPm
->
	gbVid
 = 
FALSE
;

366 
	gpQosCaby
->
	gbVid
 = 
FALSE
;

368 
	gpFme
 = (
PFRAME_802_11
)
Msg
;

371 
	gSubTy
 = (
UCHAR
)
pFme
->
Hdr
.
FC
.
SubTy
;

374 
COPY_MAC_ADDR
(
pAddr2
, 
pFme
->
Hdr
.
Addr2
);

375 
COPY_MAC_ADDR
(
pBssid
, 
pFme
->
Hdr
.
Addr3
);

379 
	gP
 = 
pFme
->
O
;

380 
	gLgth
 +
LENGTH_802_11
;

383 
NdisMoveMemy
(
pTimeamp
, 
P
, 
TIMESTAMP_LEN
);

385 
	gpTimeamp
->
	gu
.
	gLowPt
 = 
u232
(
pTimeamp
->
u
.
LowPt
);

386 
	gpTimeamp
->
	gu
.
	gHighPt
 = 
u232
(
pTimeamp
->
u
.
HighPt
);

388 
	gP
 +
TIMESTAMP_LEN
;

389 
	gLgth
 +
TIMESTAMP_LEN
;

392 
NdisMoveMemy
(
pBcPiod
, 
P
, 2);

393 
	gP
 += 2;

394 
	gLgth
 += 2;

397 
NdisMoveMemy
(
pCabyInfo
, 
P
, 2);

398 
	gP
 += 2;

399 
	gLgth
 += 2;

401 i(
CAP_IS_ESS_ON
(*
pCabyInfo
))

402 *
	gpBssTy
 = 
BSS_INFRA
;

404 *
	gpBssTy
 = 
BSS_ADHOC
;

406 
	gpEid
 = (
PEID_STRUCT

P
;

409 (
	gLgth
 + 2 + 
	gpEid
->
	gL
<
MsgL
)

414 i((*
LgthVIE
 + 
pEid
->
L
 + 2>
MAX_VIE_LEN
)

416 
DBGPRINT
(
RT_DEBUG_WARN
, ("PeerBeaconAndProbeRspSanity - Variable IEs out ofesource [len(=%d) > MAX_VIE_LEN(=%d)]\n",

417 (*
LgthVIE
 + 
pEid
->
L
 + 2), 
MAX_VIE_LEN
));

421 
	gpEid
->
	gEid
)

423 
	gIE_SSID
:

425 i(
Sy
 & 0x1)

427 if(
	gpEid
->
	gL
 <
MAX_LEN_OF_SSID
)

429 
NdisMoveMemy
(
Ssid
, 
pEid
->
O
,Eid->
L
);

430 *
	gpSsidL
 = 
pEid
->
L
;

431 
	gSy
 |= 0x1;

435 
DBGPRINT
(
RT_DEBUG_TRACE
, ("PrBcAndProbeRSy - wrg IE_SSID (n=%d)\n",
pEid
->
L
));

436  
	gFALSE
;

440 
	gIE_SUPP_RATES
:

441 if(
pEid
->
L
 <
MAX_LEN_OF_SUPPORTED_RATES
)

443 
Sy
 |= 0x2;

444 
NdisMoveMemy
(
SupRe
, 
pEid
->
O
,Eid->
L
);

445 *
	gpSupReL
 = 
pEid
->
L
;

455 
DBGPRINT
(
RT_DEBUG_TRACE
, ("PrBcAndProbeRSy - wrg IE_SUPP_RATES (n=%d)\n",
pEid
->
L
));

456  
	gFALSE
;

460 
	gIE_HT_CAP
:

461 i(
pEid
->
L
 >
SIZE_HT_CAP_IE
)

463 
NdisMoveMemy
(
pHtCaby
, 
pEid
->
O
, (
HT_CAPABILITY_IE
));

464 *
	gpHtCabyL
 = 
SIZE_HT_CAP_IE
;

466 *(
	gUSHORT
 *)(&
	gpHtCaby
->
	gHtCInfo

u216
(*(
USHORT
 *)(&
pHtCaby
->
HtCInfo
));

467 #ifde
UNALIGNMENT_SUPPORT


469 
EXT_HT_CAP_INFO
 
	gextHtCInfo
;

470 
NdisMoveMemy
((
PUCHAR
)(&
extHtCInfo
), (PUCHAR)(&
pHtCaby
->
ExtHtCInfo
), (
EXT_HT_CAP_INFO
));

471 *(
	gUSHORT
 *)(&
	gextHtCInfo

u216
(*(
USHORT
 *)(&
extHtCInfo
));

472 
NdisMoveMemy
((
PUCHAR
)(&
pHtCaby
->
ExtHtCInfo
), (PUCHAR)(&
extHtCInfo
), (
EXT_HT_CAP_INFO
));

475 *(
	gUSHORT
 *)(&
	gpHtCaby
->
	gExtHtCInfo

u216
(*(
USHORT
 *)(&
pHtCaby
->
ExtHtCInfo
));

478 #ifde
CONFIG_STA_SUPPORT


479 
IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

481 *
	gpPNHtCabyL
 = 0;

483 
	gP
 = (
PUCHAR

pVIE
;

484 
NdisMoveMemy
(
P
 + *
LgthVIE
, &
pEid
->
Eid
,Eid->
L
 + 2);

485 *
	gLgthVIE
 +(
pEid
->
L
 + 2);

491 
DBGPRINT
(
RT_DEBUG_WARN
, ("PrBcAndProbeRSy - wrg IE_HT_CAP.Eid->L = %d\n", 
pEid
->
L
));

495 
	gIE_ADD_HT
:

496 i(
pEid
->
L
 >(
ADD_HT_INFO_IE
))

500 
NdisMoveMemy
(
AddHtInfo
, 
pEid
->
O
, (
ADD_HT_INFO_IE
));

501 *
	gAddHtInfoL
 = 
SIZE_ADD_HT_INFO_IE
;

503 
	gClChl
 = 
AddHtInfo
->
CڌCh
;

505 *(
	gUSHORT
 *)(&
	gAddHtInfo
->
	gAddHtInfo2

u216
(*(
USHORT
 *)(&
AddHtInfo
->
AddHtInfo2
));

506 *(
	gUSHORT
 *)(&
	gAddHtInfo
->
	gAddHtInfo3

u216
(*(
USHORT
 *)(&
AddHtInfo
->
AddHtInfo3
));

508 #ifde
CONFIG_STA_SUPPORT


509 
IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

511 
	gP
 = (
PUCHAR

pVIE
;

512 
NdisMoveMemy
(
P
 + *
LgthVIE
, &
pEid
->
Eid
,Eid->
L
 + 2);

513 *
	gLgthVIE
 +(
pEid
->
L
 + 2);

519 
DBGPRINT
(
RT_DEBUG_WARN
, ("PeerBeaconAndProbeRspSanity - wrong IE_ADD_HT. \n"));

523 
	gIE_SECONDARY_CH_OFFSET
:

524 i(
pEid
->
L
 == 1)

526 *
NewExtChlOfft
 = 
pEid
->
O
[0];

530 
DBGPRINT
(
RT_DEBUG_WARN
, ("PeerBeaconAndProbeRspSanity - wrong IE_SECONDARY_CH_OFFSET. \n"));

534 
	gIE_FH_PARM
:

535 
DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerBeaconAndProbeRspSanity(IE_FH_PARM) \n"));

538 
	gIE_DS_PARM
:

539 if(
pEid
->
L
 == 1)

541 *
pChl
 = *
pEid
->
O
;

542 #ifde
CONFIG_STA_SUPPORT


543 
IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

545 i(
ChlSy
(
pAd
, *
pChl
) == 0)

548  
FALSE
;

552 
	gSy
 |= 0x4;

556 
DBGPRINT
(
RT_DEBUG_TRACE
, ("PrBcAndProbeRSy - wrg IE_DS_PARM (n=%d)\n",
pEid
->
L
));

557  
	gFALSE
;

561 
	gIE_CF_PARM
:

562 if(
pEid
->
L
 == 6)

564 
pCfPm
->
bVid
 = 
TRUE
;

565 
	gpCfPm
->
	gCCou
 = 
pEid
->
O
[0];

566 
	gpCfPm
->
	gCPiod
 = 
pEid
->
O
[1];

567 
	gpCfPm
->
	gCMaxDuti
 = 
pEid
->
O
[2] + 256 *Eid->Octet[3];

568 
	gpCfPm
->
	gCDurRemag
 = 
pEid
->
O
[4] + 256 *Eid->Octet[5];

572 
DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerBeaconAndProbeRspSanity - wrong IE_CF_PARM\n"));

573  
	gFALSE
;

577 
	gIE_IBSS_PARM
:

578 if(
pEid
->
L
 == 2)

580 
NdisMoveMemy
(
pAtimW
, 
pEid
->
O
,Eid->
L
);

584 
DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerBeaconAndProbeRspSanity - wrong IE_IBSS_PARM\n"));

585  
	gFALSE
;

589 #ifde
CONFIG_STA_SUPPORT


590 
	gIE_TIM
:

591 if(
INFRA_ON
(
pAd
&& 
SubTy
 =
SUBTYPE_BEACON
)

593 
GTimB
((
PCHAR
)
pEid
, 
pAd
->
SAive
.
Aid
, &
TimL
, 
pBFg
, 
pDtimCou
, 
pDtimPiod
, 
pMesgeToMe
);

597 
	gIE_CHANNEL_SWITCH_ANNOUNCEMENT
:

598 if(
pEid
->
L
 == 3)

600 *
pNewChl
 = 
pEid
->
O
[1];

608 
	gIE_VENDOR_SPECIFIC
:

610 i(
NdisEquMemy
(
pEid
->
O
, 
RALINK_OUI
, 3&& (
	gpEid
->
	gL
 == 7))

613 i(
pEid
->
O
[3] != 0)

614 *
pRkIe
 = 
pEid
->
O
[3];

616 *
	gpRkIe
 = 0xf0000000;

618 #ifde
CONFIG_STA_SUPPORT


619 #ifde
DOT11_N_SUPPORT


624 i((*
	gpHtCabyL
 =0&& 
NdisEquMemy
(
pEid
->
O
, 
PRE_N_HT_OUI
, 3&& (
	gpEid
->
	gL
 >4&& (
pAd
->
OpMode
 =
OPMODE_STA
))

626 i((
pEid
->
O
[3] =
OUI_PREN_HT_CAP
&& (pEid->
L
 >30&& (*
pHtCabyL
 == 0))

628 
NdisMoveMemy
(
pHtCaby
, &
pEid
->
O
[4], (
HT_CAPABILITY_IE
));

629 *
	gpPNHtCabyL
 = 
SIZE_HT_CAP_IE
;

632 i((
	gpEid
->
	gO
[3] =
OUI_PREN_ADD_HT
&& (
pEid
->
L
 >= 26))

634 
NdisMoveMemy
(
AddHtInfo
, &
pEid
->
O
[4], (
ADD_HT_INFO_IE
));

635 *
	gAddHtInfoL
 = 
SIZE_ADD_HT_INFO_IE
;

640 i(
NdisEquMemy
(
pEid
->
O
, 
WPA_OUI
, 4))

643 
	gP
 = (
PUCHAR

pVIE
;

644 
NdisMoveMemy
(
P
 + *
LgthVIE
, &
pEid
->
Eid
,Eid->
L
 + 2);

645 *
	gLgthVIE
 +(
pEid
->
L
 + 2);

647 i(
NdisEquMemy
(
pEid
->
O
, 
WME_PARM_ELEM
, 6&& (
	gpEid
->
	gL
 == 24))

649 
PUCHAR
 
r
;

650 
	gi
;

653 
	gpEdPm
->
	gbVid
 = 
TRUE
;

654 
	gpEdPm
->
	gbQAck
 = 
FALSE
;

655 
	gpEdPm
->
	gbQueueReque
 = 
FALSE
;

656 
	gpEdPm
->
	gbTxReque
 = 
FALSE
;

657 
	gpEdPm
->
	gEdUpdeCou
 = 
pEid
->
O
[6] & 0x0f;

658 
	gpEdPm
->
	gbAPSDCab
 = (
pEid
->
O
[6] & 0x80) ? 1 : 0;

659 
	gr
 = &
pEid
->
O
[8];

660 
	gi
=0; i<4; i++)

662 
UCHAR
 
	gaci
 = (*
r
 & 0x60) >> 5;

663 
	gpEdPm
->
	gbACM
[
aci
] = (((*
r
) & 0x10) == 0x10);

664 
	gpEdPm
->
	gAif
[
aci
] = (*
r
) & 0x0f;

665 
	gpEdPm
->
	gCwm
[
aci
] = *(
r
+1) & 0x0f;

666 
	gpEdPm
->
	gCwmax
[
aci
] = *(
r
+1) >> 4;

667 
	gpEdPm
->
	gTx
[
aci
] = *(
r
+2) + 256 * (*(ptr+3));

668 
	gr
 += 4;

671 i(
NdisEquMemy
(
pEid
->
O
, 
WME_INFO_ELEM
, 6&& (
	gpEid
->
	gL
 == 7))

674 
pEdPm
->
bVid
 = 
TRUE
;

675 
	gpEdPm
->
	gbQAck
 = 
FALSE
;

676 
	gpEdPm
->
	gbQueueReque
 = 
FALSE
;

677 
	gpEdPm
->
	gbTxReque
 = 
FALSE
;

678 
	gpEdPm
->
	gEdUpdeCou
 = 
pEid
->
O
[6] & 0x0f;

679 
	gpEdPm
->
	gbAPSDCab
 = (
pEid
->
O
[6] & 0x80) ? 1 : 0;

682 
	gpEdPm
->
	gbACM
[
QID_AC_BE
] = 0;

683 
	gpEdPm
->
	gAif
[
QID_AC_BE
] = 3;

684 
	gpEdPm
->
	gCwm
[
QID_AC_BE
] = 
CW_MIN_IN_BITS
;

685 
	gpEdPm
->
	gCwmax
[
QID_AC_BE
] = 
CW_MAX_IN_BITS
;

686 
	gpEdPm
->
	gTx
[
QID_AC_BE
] = 0;

688 
	gpEdPm
->
	gbACM
[
QID_AC_BK
] = 0;

689 
	gpEdPm
->
	gAif
[
QID_AC_BK
] = 7;

690 
	gpEdPm
->
	gCwm
[
QID_AC_BK
] = 
CW_MIN_IN_BITS
;

691 
	gpEdPm
->
	gCwmax
[
QID_AC_BK
] = 
CW_MAX_IN_BITS
;

692 
	gpEdPm
->
	gTx
[
QID_AC_BK
] = 0;

694 
	gpEdPm
->
	gbACM
[
QID_AC_VI
] = 0;

695 
	gpEdPm
->
	gAif
[
QID_AC_VI
] = 2;

696 
	gpEdPm
->
	gCwm
[
QID_AC_VI
] = 
CW_MIN_IN_BITS
-1;

697 
	gpEdPm
->
	gCwmax
[
QID_AC_VI
] = 
CW_MAX_IN_BITS
;

698 
	gpEdPm
->
	gTx
[
QID_AC_VI
] = 96;

700 
	gpEdPm
->
	gbACM
[
QID_AC_VO
] = 0;

701 
	gpEdPm
->
	gAif
[
QID_AC_VO
] = 2;

702 
	gpEdPm
->
	gCwm
[
QID_AC_VO
] = 
CW_MIN_IN_BITS
-2;

703 
	gpEdPm
->
	gCwmax
[
QID_AC_VO
] = 
CW_MAX_IN_BITS
-1;

704 
	gpEdPm
->
	gTx
[
QID_AC_VO
] = 48;

706 i(
NdisEquMemy
(
pEid
->
O
, 
WPS_OUI
, 4))

709 
	gP
 = (
PUCHAR

pVIE
;

710 
NdisMoveMemy
(
P
 + *
LgthVIE
, &
pEid
->
Eid
,Eid->
L
 + 2);

711 *
	gLgthVIE
 +(
pEid
->
L
 + 2);

717 
	gIE_EXT_SUPP_RATES
:

718 i(
pEid
->
L
 <
MAX_LEN_OF_SUPPORTED_RATES
)

720 
NdisMoveMemy
(
ExtRe
, 
pEid
->
O
,Eid->
L
);

721 *
	gpExtReL
 = 
pEid
->
L
;

731 
	gIE_ERP
:

732 i(
pEid
->
L
 == 1)

734 *
pE
 = (
UCHAR
)
pEid
->
O
[0];

738 
	gIE_AIRONET_CKIP
:

742 i(
pEid
->
L
 < (
CKIP_NEGOTIATION_LENGTH
 - 2))

746 *
	gpCkFg
 = *(
pEid
->
O
 + 8);

749 
	gIE_AP_TX_POWER
:

752 i(
pEid
->
L
 != 0x06)

756 i(
NdisEquMemy
(
pEid
->
O
, 
CISCO_OUI
, 3) == 1)

757 *
pAڑClPowLim
 = *(
pEid
->
O
 + 4);

761 
	gIE_RSN
:

763 i(
RTMPEquMemy
(
pEid
->
O
 + 2, 
RSN_OUI
, 3))

766 
	gP
 = (
PUCHAR

pVIE
;

767 
NdisMoveMemy
(
P
 + *
LgthVIE
, &
pEid
->
Eid
,Eid->
L
 + 2);

768 *
	gLgthVIE
 +(
pEid
->
L
 + 2);

772 #ifde
CONFIG_STA_SUPPORT


773 #i
defed
 (
EXT_BUILD_CHANNEL_LIST
|| defed (
RT_CFG80211_SUPPORT
)

774 
	gIE_COUNTRY
:

775 
P
 = (
PUCHAR

pVIE
;

776 
NdisMoveMemy
(
P
 + *
LgthVIE
, &
pEid
->
Eid
,Eid->
L
 + 2);

777 *
	gLgthVIE
 +(
pEid
->
L
 + 2);

782 
	gIE_QBSS_LOAD
:

783 i(
pEid
->
L
 == 5)

785 
pQbssLd
->
bVid
 = 
TRUE
;

786 
	gpQbssLd
->
	gSNum
 = 
pEid
->
O
[0] +Eid->Octet[1] * 256;

787 
	gpQbssLd
->
	gChlUtizi
 = 
pEid
->
O
[2];

788 
	gpQbssLd
->
	gRemagAdmissiCڌ
 = 
pEid
->
O
[3] +Eid->Octet[4] * 256;

791 
	gP
 = (
PUCHAR

pVIE
;

792 
NdisMoveMemy
(
P
 + *
LgthVIE
, &
pEid
->
Eid
,Eid->
L
 + 2);

793 *
	gLgthVIE
 +(
pEid
->
L
 + 2);

799 
	gIE_EXT_CAPABILITY
:

800 i(
pEid
->
L
 >= 1)

802 
NdisMoveMemy
(
pExtCInfo
,&
pEid
->
O
[0], (
EXT_CAP_INFO_ELEMENT
) );

810 
	gLgth
 = 
Lgth
 + 2 + 
pEid
->
L
;

811 
	gpEid
 = (
PEID_STRUCT
)((
UCHAR
*)
pEid
 + 2 +Eid->
L
);

815 #ifde
CONFIG_STA_SUPPORT


816 
IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

818 
UCHAR
 
	gLchRfChl
 = 
MsgChl
;

819 i((
	gpAd
->
	gLchRfRegs
.
	gChl
 > 14&& ((
	gSy
 & 0x4) == 0))

821 i(
ClChl
 != 0)

822 *
pChl
 = 
ClChl
;

824 *
	gpChl
 = 
LchRfChl
;

825 
	gSy
 |= 0x4;

830 i(
	gSy
 != 0x7)

832 
DBGPRINT
(
RT_DEBUG_LOUD
, ("PrBcAndProbeRSy - missg fld, Sy=0x%02x\n", 
Sy
));

833  
	gFALSE
;

837  
	gTRUE
;

842 #ifde
DOT11N_DRAFT3


854 
BOOLEAN
 
	$PrBcAndProbeRSy2
(

855 
IN
 
PRTMP_ADAPTER
 
pAd
,

856 
IN
 
VOID
 *
Msg
,

857 
IN
 
ULONG
 
MsgL
,

858 
IN
 
OVERLAP_BSS_SCAN_IE
 *
BssSn
,

859 
OUT
 
UCHAR
 *
RegCss
)

861 
CHAR
 *
P
;

862 
PFRAME_802_11
 
pFme
;

863 
PEID_STRUCT
 
pEid
;

864 
ULONG
 
Lgth
 = 0;

865 
BOOLEAN
 
brc
;

867 
pFme
 = (
PFRAME_802_11
)
Msg
;

869 *
RegCss
 = 0;

870 
P
 = 
pFme
->
O
;

871 
Lgth
 +
LENGTH_802_11
;

874 
P
 +
TIMESTAMP_LEN
;

875 
Lgth
 +
TIMESTAMP_LEN
;

878 
P
 += 2;

879 
Lgth
 += 2;

882 
P
 += 2;

883 
Lgth
 += 2;

885 
pEid
 = (
PEID_STRUCT

P
;

886 
brc
 = 
FALSE
;

888 
	`RTMPZoMemy
(
BssSn
, (
OVERLAP_BSS_SCAN_IE
));

890 (
Lgth
 + 2 + 
pEid
->
L
<
MsgL
)

892 
pEid
->
Eid
)

894 
IE_SUPP_REG_CLASS
:

895 if(
pEid
->
L
 > 0)

897 *
RegCss
 = *
pEid
->
O
;

901 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrBcAndProbeRSy - wrg IE_SUPP_REG_CLASS (n=%d)\n",
pEid
->
L
));

904 
IE_OVERLAPBSS_SCAN_PARM
:

905 i(
pEid
->
L
 =(
OVERLAP_BSS_SCAN_IE
))

907 
brc
 = 
TRUE
;

908 
	`RTMPMoveMemy
(
BssSn
, 
pEid
->
O
, (
OVERLAP_BSS_SCAN_IE
));

912 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrBcAndProbeRSy - wrg IE_OVERLAPBSS_SCAN_PARM (n=%d)\n",
pEid
->
L
));

916 
IE_EXT_CHANNEL_SWITCH_ANNOUNCEMENT
:

917 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerBeaconAndProbeRspSanity - IE_EXT_CHANNEL_SWITCH_ANNOUNCEMENT\n"));

922 
Lgth
 = Lgth + 2 + 
pEid
->
L
;

923 
pEid
 = (
PEID_STRUCT
)((
UCHAR
*Eid + 2 +Eid->
L
);

926  
brc
;

928 
	}
}

931 #i
defed
(
AP_SCAN_SUPPORT
|| defed(
CONFIG_STA_SUPPORT
)

940 
BOOLEAN
 
	$MlmeSnReqSy
(

941 
IN
 
PRTMP_ADAPTER
 
pAd
,

942 
IN
 
VOID
 *
Msg
,

943 
IN
 
ULONG
 
MsgL
,

944 
OUT
 
UCHAR
 *
pBssTy
,

945 
OUT
 
CHAR
 
Ssid
[],

946 
OUT
 
UCHAR
 *
pSsidL
,

947 
OUT
 
UCHAR
 *
pSnTy
)

949 
MLME_SCAN_REQ_STRUCT
 *
Info
;

951 
Info
 = (
MLME_SCAN_REQ_STRUCT
 *)(
Msg
);

952 *
pBssTy
 = 
Info
->
BssTy
;

953 *
pSsidL
 = 
Info
->
SsidL
;

954 
	`NdisMoveMemy
(
Ssid
, 
Info
->Ssid, *
pSsidL
);

955 *
pSnTy
 = 
Info
->
SnTy
;

957 i((*
pBssTy
 =
BSS_INFRA
 || *pBssTy =
BSS_ADHOC
 || *pBssTy =
BSS_ANY
)

958 && (*
pSnTy
 =
SCAN_ACTIVE
 || *pSnTy =
SCAN_PASSIVE


959 #ifde
DOT11_N_SUPPORT


960 #ifde
DOT11N_DRAFT3


961 || (*
pSnTy
 =
SCAN_2040_BSS_COEXIST
)

966  
TRUE
;

970 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeScanReqSanity fail - wrong BssType or ScanType\n"));

971  
FALSE
;

973 
	}
}

977 
UCHAR
 
	$ChlSy
(

978 
IN
 
PRTMP_ADAPTER
 
pAd
,

979 
IN
 
UCHAR
 
chl
)

981 
i
;

983 
i
 = 0; i < 
pAd
->
ChlLiNum
; i ++)

985 i(
chl
 =
pAd
->
ChlLi
[
i
].
Chl
)

989 
	}
}

1002 
BOOLEAN
 
	$PrDuthSy
(

1003 
IN
 
PRTMP_ADAPTER
 
pAd
,

1004 
IN
 
VOID
 *
Msg
,

1005 
IN
 
ULONG
 
MsgL
,

1006 
OUT
 
PUCHAR
 
pAddr1
,

1007 
OUT
 
PUCHAR
 
pAddr2
,

1008 
OUT
 
PUCHAR
 
pAddr3
,

1009 
OUT
 
USHORT
 *
pRs
)

1011 
PFRAME_802_11
 
pFme
 = (PFRAME_802_11)
Msg
;

1013 
	`COPY_MAC_ADDR
(
pAddr1
, 
pFme
->
Hdr
.
Addr1
);

1014 
	`COPY_MAC_ADDR
(
pAddr2
, 
pFme
->
Hdr
.
Addr2
);

1015 
	`COPY_MAC_ADDR
(
pAddr3
, 
pFme
->
Hdr
.
Addr3
);

1016 
	`NdisMoveMemy
(
pRs
, &
pFme
->
O
[0], 2);

1018  
TRUE
;

1019 
	}
}

1032 
BOOLEAN
 
	$PrAuthSy
(

1033 
IN
 
PRTMP_ADAPTER
 
pAd
,

1034 
IN
 
VOID
 *
Msg
,

1035 
IN
 
ULONG
 
MsgL
,

1036 
OUT
 
PUCHAR
 
pAddr
,

1037 
OUT
 
USHORT
 *
pAlg
,

1038 
OUT
 
USHORT
 *
pSeq
,

1039 
OUT
 
USHORT
 *
pStus
,

1040 
CHAR
 *
pChlgText
)

1042 
PFRAME_802_11
 
pFme
 = (PFRAME_802_11)
Msg
;

1044 
	`COPY_MAC_ADDR
(
pAddr
, 
pFme
->
Hdr
.
Addr2
);

1045 
	`NdisMoveMemy
(
pAlg
, &
pFme
->
O
[0], 2);

1046 
	`NdisMoveMemy
(
pSeq
, &
pFme
->
O
[2], 2);

1047 
	`NdisMoveMemy
(
pStus
, &
pFme
->
O
[4], 2);

1049 i(*
pAlg
 =
AUTH_MODE_OPEN
)

1051 i(*
pSeq
 == 1 || *pSeq == 2)

1053  
TRUE
;

1057 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerAuthSanity fail - wrong Seg#\n"));

1058  
FALSE
;

1061 i(*
pAlg
 =
AUTH_MODE_KEY
)

1063 i(*
pSeq
 == 1 || *pSeq == 4)

1065  
TRUE
;

1067 i(*
pSeq
 == 2 || *pSeq == 3)

1069 
	`NdisMoveMemy
(
pChlgText
, &
pFme
->
O
[8], 
CIPHER_TEXT_LEN
);

1070  
TRUE
;

1074 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerAuthSanity fail - wrong Seg#\n"));

1075  
FALSE
;

1080 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerAuthSanity fail - wronglgorithm\n"));

1081  
FALSE
;

1083 
	}
}

1093 
BOOLEAN
 
	$MlmeAuthReqSy
(

1094 
IN
 
PRTMP_ADAPTER
 
pAd
,

1095 
IN
 
VOID
 *
Msg
,

1096 
IN
 
ULONG
 
MsgL
,

1097 
OUT
 
PUCHAR
 
pAddr
,

1098 
OUT
 
ULONG
 *
pTimeout
,

1099 
OUT
 
USHORT
 *
pAlg
)

1101 
MLME_AUTH_REQ_STRUCT
 *
pInfo
;

1103 
pInfo
 = (
MLME_AUTH_REQ_STRUCT
 *)
Msg
;

1104 
	`COPY_MAC_ADDR
(
pAddr
, 
pInfo
->
Addr
);

1105 *
pTimeout
 = 
pInfo
->
Timeout
;

1106 *
pAlg
 = 
pInfo
->
Alg
;

1108 i(((*
pAlg
 =
AUTH_MODE_KEY
||(*pAlg =
AUTH_MODE_OPEN
)

1110 ((*
pAddr
 & 0x01) == 0))

1112 #ifde
CONFIG_STA_SUPPORT


1114  
TRUE
;

1118 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeAuthReqSanity fail - wronglgorithm\n"));

1119  
FALSE
;

1121 
	}
}

1134 
BOOLEAN
 
	$MlmeAssocReqSy
(

1135 
IN
 
PRTMP_ADAPTER
 
pAd
,

1136 
IN
 
VOID
 *
Msg
,

1137 
IN
 
ULONG
 
MsgL
,

1138 
OUT
 
PUCHAR
 
pApAddr
,

1139 
OUT
 
USHORT
 *
pCabyInfo
,

1140 
OUT
 
ULONG
 *
pTimeout
,

1141 
OUT
 
USHORT
 *
pLiIv
)

1143 
MLME_ASSOC_REQ_STRUCT
 *
pInfo
;

1145 
pInfo
 = (
MLME_ASSOC_REQ_STRUCT
 *)
Msg
;

1146 *
pTimeout
 = 
pInfo
->
Timeout
;

1147 
	`COPY_MAC_ADDR
(
pApAddr
, 
pInfo
->
Addr
);

1148 *
pCabyInfo
 = 
pInfo
->
CabyInfo
;

1149 *
pLiIv
 = 
pInfo
->
LiIv
;

1151  
TRUE
;

1152 
	}
}

1165 
BOOLEAN
 
	$PrDissocSy
(

1166 
IN
 
PRTMP_ADAPTER
 
pAd
,

1167 
IN
 
VOID
 *
Msg
,

1168 
IN
 
ULONG
 
MsgL
,

1169 
OUT
 
PUCHAR
 
pAddr2
,

1170 
OUT
 
USHORT
 *
pRs
)

1172 
PFRAME_802_11
 
pFme
 = (PFRAME_802_11)
Msg
;

1174 
	`COPY_MAC_ADDR
(
pAddr2
, 
pFme
->
Hdr
.
Addr2
);

1175 
	`NdisMoveMemy
(
pRs
, &
pFme
->
O
[0], 2);

1177  
TRUE
;

1178 
	}
}

1197 
NDIS_802_11_NETWORK_TYPE
 
	$NwkTyInUSy
(

1198 
IN
 
PBSS_ENTRY
 
pBss
)

1200 
NDIS_802_11_NETWORK_TYPE
 
NWkTy
;

1201 
UCHAR
 

, 
i
;

1203 
NWkTy
 = 
Ndis802_11DS
;

1205 i(
pBss
->
Chl
 <= 14)

1210 
i
 = 0; i < 
pBss
->
SupReL
; i++)

1212 

 = 
pBss
->
SupRe
[
i
] & 0x7f;

1213 i((

 == 2) || (rate == 4) || (rate == 11) || (rate == 22))

1222 
NWkTy
 = 
Ndis802_11OFDM24
;

1230 i(
NWkTy
 !
Ndis802_11OFDM24
)

1232 
i
 = 0; i < 
pBss
->
ExtReL
; i++)

1234 

 = 
pBss
->
SupRe
[
i
] & 0x7f;

1235 i((

 == 2) || (rate == 4) || (rate == 11) || (rate == 22))

1244 
NWkTy
 = 
Ndis802_11OFDM24
;

1252 
NWkTy
 = 
Ndis802_11OFDM5
;

1255 i(
pBss
->
HtCabyL
 != 0)

1257 i(
NWkTy
 =
Ndis802_11OFDM5
)

1258 
NWkTy
 = 
Ndis802_11OFDM5_N
;

1260 
NWkTy
 = 
Ndis802_11OFDM24_N
;

1263  
NWkTy
;

1264 
	}
}

1266 #ifde
CONFIG_STA_SUPPORT


1267 #ifde
QOS_DLS_SUPPORT


1268 
BOOLEAN
 
	$MlmeDlsReqSy
(

1269 
IN
 
PRTMP_ADAPTER
 
pAd
,

1270 
IN
 
VOID
 *
Msg
,

1271 
IN
 
ULONG
 
MsgL
,

1272 
OUT
 
PRT_802_11_DLS
 *
pDLS
,

1273 
OUT
 
PUSHORT
 
pRs
)

1275 
MLME_DLS_REQ_STRUCT
 *
pInfo
;

1277 
pInfo
 = (
MLME_DLS_REQ_STRUCT
 *)
Msg
;

1279 *
pDLS
 = 
pInfo
->pDLS;

1280 *
pRs
 = 
pInfo
->
Rs
;

1282  
TRUE
;

1283 
	}
}

1287 #ifde
QOS_DLS_SUPPORT


1288 
BOOLEAN
 
	$PrDlsReqSy
(

1289 
IN
 
PRTMP_ADAPTER
 
pAd
,

1290 
IN
 
VOID
 *
Msg
,

1291 
IN
 
ULONG
 
MsgL
,

1292 
OUT
 
PUCHAR
 
pDA
,

1293 
OUT
 
PUCHAR
 
pSA
,

1294 
OUT
 
USHORT
 *
pCabyInfo
,

1295 
OUT
 
USHORT
 *
pDlsTimeout
,

1296 
OUT
 
UCHAR
 *
pResL
,

1297 
OUT
 
UCHAR
 
Res
[],

1298 
OUT
 
UCHAR
 *
pHtCabyL
,

1299 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
)

1301 
CHAR
 *
P
;

1302 
PFRAME_802_11
 
Fr
 = (PFRAME_802_11)
Msg
;

1303 
PEID_STRUCT
 
eid_r
;

1306 *
pCabyInfo
 = 0;

1307 *
pDlsTimeout
 = 0;

1308 *
pHtCabyL
 = 0;

1310 
P
 = (
PCHAR
)
Fr
->
O
;

1313 
P
 += 2;

1316 
	`NdisMoveMemy
(
pDA
, 
P
, 
MAC_ADDR_LEN
);

1317 
P
 +
MAC_ADDR_LEN
;

1320 
	`NdisMoveMemy
(
pSA
, 
P
, 
MAC_ADDR_LEN
);

1321 
P
 +
MAC_ADDR_LEN
;

1324 
	`NdisMoveMemy
(
pCabyInfo
, 
P
, 2);

1325 
P
 += 2;

1328 
	`NdisMoveMemy
(
pDlsTimeout
, 
P
, 2);

1329 
P
 += 2;

1332 
eid_r
 = (
PEID_STRUCT
&
Fr
->
O
[18];

1334 ((
UCHAR
*)
eid_r
 +id_r->
L
 + 1< ((UCHAR*)
Fr
 + 
MsgL
))

1336 
eid_r
->
Eid
)

1338 
IE_SUPP_RATES
:

1339 i((
eid_r
->
L
 <
MAX_LEN_OF_SUPPORTED_RATES
) && (eid_ptr->Len > 0))

1341 
	`NdisMoveMemy
(
Res
, 
eid_r
->
O
,id_r->
L
);

1342 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrDlsReqSy - IE_SUPP_RATES., L=%d. Res[0]=%x\n",
eid_r
->
L
, 
Res
[0]));

1343 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Res[1]=%x %x %x %x %x %x %x\n", 
Res
[1], Rates[2], Rates[3], Rates[4], Rates[5], Rates[6], Rates[7]));

1344 *
pResL
 = 
eid_r
->
L
;

1348 *
pResL
 = 8;

1349 
Res
[0] = 0x82;

1350 
Res
[1] = 0x84;

1351 
Res
[2] = 0x8b;

1352 
Res
[3] = 0x96;

1353 
Res
[4] = 0x12;

1354 
Res
[5] = 0x24;

1355 
Res
[6] = 0x48;

1356 
Res
[7] = 0x6c;

1357 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrDlsReqSy - wrg IE_SUPP_RATES., L=%d\n",
eid_r
->
L
));

1361 
IE_EXT_SUPP_RATES
:

1362 i(
eid_r
->
L
 + *
pResL
 <
MAX_LEN_OF_SUPPORTED_RATES
)

1364 
	`NdisMoveMemy
(&
Res
[*
pResL
], 
eid_r
->
O
,id_r->
L
);

1365 *
pResL
 = (*pResL+ 
eid_r
->
L
;

1369 
	`NdisMoveMemy
(&
Res
[*
pResL
], 
eid_r
->
O
, 
MAX_LEN_OF_SUPPORTED_RATES
 - (*pRatesLen));

1370 *
pResL
 = 
MAX_LEN_OF_SUPPORTED_RATES
;

1374 
IE_HT_CAP
:

1375 i(
eid_r
->
L
 >(
HT_CAPABILITY_IE
))

1377 
	`NdisMoveMemy
(
pHtCaby
, 
eid_r
->
O
, (
HT_CAPABILITY_IE
));

1379 *(
USHORT
 *)(&
pHtCaby
->
HtCInfo

	`u216
(*(USHORT *)(&pHtCapability->HtCapInfo));

1380 #ifde
UNALIGNMENT_SUPPORT


1382 
EXT_HT_CAP_INFO
 
extHtCInfo
;

1384 
	`NdisMoveMemy
((
PUCHAR
)(&
extHtCInfo
), (PUCHAR)(&
pHtCaby
->
ExtHtCInfo
), (
EXT_HT_CAP_INFO
));

1385 *(
USHORT
 *)(&
extHtCInfo

	`u216
(*(USHORT *)(&extHtCapInfo));

1386 
	`NdisMoveMemy
((
PUCHAR
)(&
pHtCaby
->
ExtHtCInfo
), (PUCHAR)(&
extHtCInfo
), (
EXT_HT_CAP_INFO
));

1389 *(
USHORT
 *)(&
pHtCaby
->
ExtHtCInfo

	`u216
(*(USHORT *)(&pHtCapability->ExtHtCapInfo));

1391 *
pHtCabyL
 = (
HT_CAPABILITY_IE
);

1393 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerDlsReqSanity - IE_HT_CAP\n"));

1397 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrDlsReqSy - wrg IE_HT_CAP.eid_r->L = %d\n", 
eid_r
->
L
));

1405 
eid_r
 = (
PEID_STRUCT
)((
UCHAR
*id_+ 2 +id_r->
L
);

1408  
TRUE
;

1409 
	}
}

1411 
BOOLEAN
 
	$PrDlsRSy
(

1412 
IN
 
PRTMP_ADAPTER
 
pAd
,

1413 
IN
 
VOID
 *
Msg
,

1414 
IN
 
ULONG
 
MsgL
,

1415 
OUT
 
PUCHAR
 
pDA
,

1416 
OUT
 
PUCHAR
 
pSA
,

1417 
OUT
 
USHORT
 *
pCabyInfo
,

1418 
OUT
 
USHORT
 *
pStus
,

1419 
OUT
 
UCHAR
 *
pResL
,

1420 
OUT
 
UCHAR
 
Res
[],

1421 
OUT
 
UCHAR
 *
pHtCabyL
,

1422 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
)

1424 
CHAR
 *
P
;

1425 
PFRAME_802_11
 
Fr
 = (PFRAME_802_11)
Msg
;

1426 
PEID_STRUCT
 
eid_r
;

1429 *
pStus
 = 0;

1430 *
pCabyInfo
 = 0;

1431 *
pHtCabyL
 = 0;

1433 
P
 = (
PCHAR
)
Fr
->
O
;

1436 
P
 += 2;

1439 
	`NdisMoveMemy
(
pStus
, 
P
, 2);

1440 
P
 += 2;

1443 
	`NdisMoveMemy
(
pDA
, 
P
, 
MAC_ADDR_LEN
);

1444 
P
 +
MAC_ADDR_LEN
;

1447 
	`NdisMoveMemy
(
pSA
, 
P
, 
MAC_ADDR_LEN
);

1448 
P
 +
MAC_ADDR_LEN
;

1450 i(
pStus
 == 0)

1453 
	`NdisMoveMemy
(
pCabyInfo
, 
P
, 2);

1454 
P
 += 2;

1458 
eid_r
 = (
PEID_STRUCT
&
Fr
->
O
[18];

1460 ((
UCHAR
*)
eid_r
 +id_r->
L
 + 1< ((UCHAR*)
Fr
 + 
MsgL
))

1462 
eid_r
->
Eid
)

1464 
IE_SUPP_RATES
:

1465 i((
eid_r
->
L
 <
MAX_LEN_OF_SUPPORTED_RATES
) && (eid_ptr->Len > 0))

1467 
	`NdisMoveMemy
(
Res
, 
eid_r
->
O
,id_r->
L
);

1468 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrDlsRSy - IE_SUPP_RATES., L=%d. Res[0]=%x\n",
eid_r
->
L
, 
Res
[0]));

1469 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Res[1]=%x %x %x %x %x %x %x\n", 
Res
[1], Rates[2], Rates[3], Rates[4], Rates[5], Rates[6], Rates[7]));

1470 *
pResL
 = 
eid_r
->
L
;

1474 *
pResL
 = 8;

1475 
Res
[0] = 0x82;

1476 
Res
[1] = 0x84;

1477 
Res
[2] = 0x8b;

1478 
Res
[3] = 0x96;

1479 
Res
[4] = 0x12;

1480 
Res
[5] = 0x24;

1481 
Res
[6] = 0x48;

1482 
Res
[7] = 0x6c;

1483 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrDlsRSy - wrg IE_SUPP_RATES., L=%d\n",
eid_r
->
L
));

1487 
IE_EXT_SUPP_RATES
:

1488 i(
eid_r
->
L
 + *
pResL
 <
MAX_LEN_OF_SUPPORTED_RATES
)

1490 
	`NdisMoveMemy
(&
Res
[*
pResL
], 
eid_r
->
O
,id_r->
L
);

1491 *
pResL
 = (*pResL+ 
eid_r
->
L
;

1495 
	`NdisMoveMemy
(&
Res
[*
pResL
], 
eid_r
->
O
, 
MAX_LEN_OF_SUPPORTED_RATES
 - (*pRatesLen));

1496 *
pResL
 = 
MAX_LEN_OF_SUPPORTED_RATES
;

1500 
IE_HT_CAP
:

1501 i(
eid_r
->
L
 >(
HT_CAPABILITY_IE
))

1503 
	`NdisMoveMemy
(
pHtCaby
, 
eid_r
->
O
, (
HT_CAPABILITY_IE
));

1505 *(
USHORT
 *)(&
pHtCaby
->
HtCInfo

	`u216
(*(USHORT *)(&pHtCapability->HtCapInfo));

1506 #ifde
UNALIGNMENT_SUPPORT


1508 
EXT_HT_CAP_INFO
 
extHtCInfo
;

1510 
	`NdisMoveMemy
((
PUCHAR
)(&
extHtCInfo
), (PUCHAR)(&
pHtCaby
->
ExtHtCInfo
), (
EXT_HT_CAP_INFO
));

1511 *(
USHORT
 *)(&
extHtCInfo

	`u216
(*(USHORT *)(&extHtCapInfo));

1512 
	`NdisMoveMemy
((
PUCHAR
)(&
pHtCaby
->
ExtHtCInfo
), (PUCHAR)(&
extHtCInfo
), (
EXT_HT_CAP_INFO
));

1515 *(
USHORT
 *)(&
pHtCaby
->
ExtHtCInfo

	`u216
(*(USHORT *)(&pHtCapability->ExtHtCapInfo));

1517 *
pHtCabyL
 = (
HT_CAPABILITY_IE
);

1519 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerDlsRspSanity - IE_HT_CAP\n"));

1523 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrDlsRSy - wrg IE_HT_CAP.eid_r->L = %d\n", 
eid_r
->
L
));

1531 
eid_r
 = (
PEID_STRUCT
)((
UCHAR
*id_+ 2 +id_r->
L
);

1534  
TRUE
;

1535 
	}
}

1537 
BOOLEAN
 
	$PrDlsTrDownSy
(

1538 
IN
 
PRTMP_ADAPTER
 
pAd
,

1539 
IN
 
VOID
 *
Msg
,

1540 
IN
 
ULONG
 
MsgL
,

1541 
OUT
 
PUCHAR
 
pDA
,

1542 
OUT
 
PUCHAR
 
pSA
,

1543 
OUT
 
USHORT
 *
pRs
)

1545 
CHAR
 *
P
;

1546 
PFRAME_802_11
 
Fr
 = (PFRAME_802_11)
Msg
;

1549 *
pRs
 = 0;

1551 
P
 = (
PCHAR
)
Fr
->
O
;

1554 
P
 += 2;

1557 
	`NdisMoveMemy
(
pDA
, 
P
, 
MAC_ADDR_LEN
);

1558 
P
 +
MAC_ADDR_LEN
;

1561 
	`NdisMoveMemy
(
pSA
, 
P
, 
MAC_ADDR_LEN
);

1562 
P
 +
MAC_ADDR_LEN
;

1565 
	`NdisMoveMemy
(
pRs
, 
P
, 2);

1566 
P
 += 2;

1568  
TRUE
;

1569 
	}
}

1580 
BOOLEAN
 
	$PrProbeReqSy
(

1581 
IN
 
PRTMP_ADAPTER
 
pAd
,

1582 
IN
 
VOID
 *
Msg
,

1583 
IN
 
ULONG
 
MsgL
,

1584 
OUT
 
PUCHAR
 
pAddr2
,

1585 
OUT
 
CHAR
 
Ssid
[],

1586 
OUT
 
UCHAR
 *
SsidL
,

1587 
OUT
 
BOOLEAN
 *
bRssiRequeed
)

1589 
PFRAME_802_11
 
Fr
 = (PFRAME_802_11)
Msg
;

1590 
UCHAR
 *
P
;

1591 
UCHAR
 
eid
 =0, 
eid_n
 = 0, *
eid_da
;

1592 
UINT
 
tٮ__n
 = 0;

1596 *
SsidL
 = 0;

1598 
	`COPY_MAC_ADDR
(
pAddr2
, &
Fr
->
Hdr
.
Addr2
);

1600 i(
Fr
->
O
[0] !
IE_SSID
 || Fr->O[1] > 
MAX_LEN_OF_SSID
)

1602 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("APPeerProbeReqSanity fail - wrong SSID IE\n"));

1603  
FALSE
;

1606 *
SsidL
 = 
Fr
->
O
[1];

1607 
	`NdisMoveMemy
(
Ssid
, &
Fr
->
O
[2], *
SsidL
);

1610 
P
 = 
Fr
->
O
;

1611 
eid
 = 
P
[0];

1612 
eid_n
 = 
P
[1];

1613 
tٮ__n
 = 
eid_n
 + 2;

1614 
eid_da
 = 
P
+2;

1617 (
eid_da
 + 
eid_n
<((
UCHAR
*)
Fr
 + 
MsgL
))

1619 
eid
)

1621 
IE_VENDOR_SPECIFIC
:

1622 i(
eid_n
 <= 4)

1624 #ifde
RSSI_FEEDBACK


1625 i(
bRssiRequeed
 && 
	`NdisEquMemy
(
eid_da
, 
RALINK_OUI
, 3&& (
eid_n
 == 7))

1627 i(*(
eid_da
 + 3 ) & 0x8)

1628 *
bRssiRequeed
 = 
TRUE
;

1633 i(
	`NdisEquMemy
(
eid_da
, 
WPS_OUI
, 4))

1642 
eid
 = 
P
[
tٮ__n
];

1643 
eid_n
 = 
P
[
tٮ__n
 + 1];

1644 
eid_da
 = 
P
 + 
tٮ__n
 + 2;

1645 
tٮ__n
 +(
eid_n
 + 2);

1648  
TRUE
;

1649 
	}
}

	@common/cmm_sync.c

37 
	~"_cfig.h
"

40 
	#BG_BAND_REGION_0_START
 0

41 
	#BG_BAND_REGION_0_SIZE
 11

	)

42 
	#BG_BAND_REGION_1_START
 0

43 
	#BG_BAND_REGION_1_SIZE
 13

	)

44 
	#BG_BAND_REGION_2_START
 9

45 
	#BG_BAND_REGION_2_SIZE
 2

	)

46 
	#BG_BAND_REGION_3_START
 9

47 
	#BG_BAND_REGION_3_SIZE
 4

	)

48 
	#BG_BAND_REGION_4_START
 13

49 
	#BG_BAND_REGION_4_SIZE
 1

	)

50 
	#BG_BAND_REGION_5_START
 0

51 
	#BG_BAND_REGION_5_SIZE
 14

	)

52 
	#BG_BAND_REGION_6_START
 2

53 
	#BG_BAND_REGION_6_SIZE
 7

	)

54 
	#BG_BAND_REGION_7_START
 4

55 
	#BG_BAND_REGION_7_SIZE
 9

	)

56 
	#BG_BAND_REGION_31_START
 0

57 
	#BG_BAND_REGION_31_SIZE
 14

	)

60 
UCHAR
 
	gA_BAND_REGION_0_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64, 149, 153, 157, 161, 165};

61 
UCHAR
 
	gA_BAND_REGION_1_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140};

62 
UCHAR
 
	gA_BAND_REGION_2_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64};

63 
UCHAR
 
	gA_BAND_REGION_3_CHANNEL_LIST
[]={52, 56, 60, 64, 149, 153, 157, 161};

64 
UCHAR
 
	gA_BAND_REGION_4_CHANNEL_LIST
[]={149, 153, 157, 161, 165};

65 
UCHAR
 
	gA_BAND_REGION_5_CHANNEL_LIST
[]={149, 153, 157, 161};

66 
UCHAR
 
	gA_BAND_REGION_6_CHANNEL_LIST
[]={36, 40, 44, 48};

67 
UCHAR
 
	gA_BAND_REGION_7_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 149, 153, 157, 161, 165, 169, 173};

68 
UCHAR
 
	gA_BAND_REGION_8_CHANNEL_LIST
[]={52, 56, 60, 64};

69 
UCHAR
 
	gA_BAND_REGION_9_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64, 100, 104, 108, 112, 116, 132, 136, 140, 149, 153, 157, 161, 165};

70 
UCHAR
 
	gA_BAND_REGION_10_CHANNEL_LIST
[]={36, 40, 44, 48, 149, 153, 157, 161, 165};

71 
UCHAR
 
	gA_BAND_REGION_11_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64, 100, 104, 108, 112, 116, 120, 149, 153, 157, 161};

72 
UCHAR
 
	gA_BAND_REGION_12_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140};

73 
UCHAR
 
	gA_BAND_REGION_13_CHANNEL_LIST
[]={52, 56, 60, 64, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 149, 153, 157, 161};

74 
UCHAR
 
	gA_BAND_REGION_14_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64, 100, 104, 108, 112, 116, 136, 140, 149, 153, 157, 161, 165};

75 
UCHAR
 
	gA_BAND_REGION_15_CHANNEL_LIST
[]={149, 153, 157, 161, 165, 169, 173};

76 
UCHAR
 
	gA_BAND_REGION_16_CHANNEL_LIST
[]={52, 56, 60, 64, 149, 153, 157, 161, 165};

77 
UCHAR
 
	gA_BAND_REGION_17_CHANNEL_LIST
[]={36, 40, 44, 48, 149, 153, 157, 161};

78 
UCHAR
 
	gA_BAND_REGION_18_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64, 100, 104, 108, 112, 116, 132, 136, 140};

79 
UCHAR
 
	gA_BAND_REGION_19_CHANNEL_LIST
[]={56, 60, 64, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 149, 153, 157, 161};

80 
UCHAR
 
	gA_BAND_REGION_20_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64, 100, 104, 108, 112, 116, 120, 124, 149, 153, 157, 161};

81 
UCHAR
 
	gA_BAND_REGION_21_CHANNEL_LIST
[]={36, 40, 44, 48, 52, 56, 60, 64, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 149, 153, 157, 161};

85 
UCHAR
 
	gBaSizeAay
[4] = {8,16,32,64};

99 
VOID
 
	$BudChlLi
(

100 
IN
 
PRTMP_ADAPTER
 
pAd
)

102 
UCHAR
 
i
, 
j
, 
dex
=0, 
num
=0;

103 
PUCHAR
 
pChlLi
 = 
NULL
;

105 
	`NdisZoMemy
(
pAd
->
ChlLi
, 
MAX_NUM_OF_CHANNELS
 * (
CHANNEL_TX_POWER
));

108 i((
pAd
->
CommCfg
.
PhyMode
 !
PHY_11A
)

109 #ifde
DOT11_N_SUPPORT


110 && (
pAd
->
CommCfg
.
PhyMode
 !
PHY_11AN_MIXED
&& (pAd->CommCfg.PhyMod!
PHY_11N_5G
)

114 
pAd
->
CommCfg
.
CouryRegi
 & 0x7f)

116 
REGION_0_BG_BAND
:

117 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
dex
], &pAd->
TxPow
[
BG_BAND_REGION_0_START
], (
CHANNEL_TX_POWER
* 
BG_BAND_REGION_0_SIZE
);

118 
dex
 +
BG_BAND_REGION_0_SIZE
;

120 
REGION_1_BG_BAND
:

121 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
dex
], &pAd->
TxPow
[
BG_BAND_REGION_1_START
], (
CHANNEL_TX_POWER
* 
BG_BAND_REGION_1_SIZE
);

122 
dex
 +
BG_BAND_REGION_1_SIZE
;

124 
REGION_2_BG_BAND
:

125 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
dex
], &pAd->
TxPow
[
BG_BAND_REGION_2_START
], (
CHANNEL_TX_POWER
* 
BG_BAND_REGION_2_SIZE
);

126 
dex
 +
BG_BAND_REGION_2_SIZE
;

128 
REGION_3_BG_BAND
:

129 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
dex
], &pAd->
TxPow
[
BG_BAND_REGION_3_START
], (
CHANNEL_TX_POWER
* 
BG_BAND_REGION_3_SIZE
);

130 
dex
 +
BG_BAND_REGION_3_SIZE
;

132 
REGION_4_BG_BAND
:

133 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
dex
], &pAd->
TxPow
[
BG_BAND_REGION_4_START
], (
CHANNEL_TX_POWER
* 
BG_BAND_REGION_4_SIZE
);

134 
dex
 +
BG_BAND_REGION_4_SIZE
;

136 
REGION_5_BG_BAND
:

137 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
dex
], &pAd->
TxPow
[
BG_BAND_REGION_5_START
], (
CHANNEL_TX_POWER
* 
BG_BAND_REGION_5_SIZE
);

138 
dex
 +
BG_BAND_REGION_5_SIZE
;

140 
REGION_6_BG_BAND
:

141 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
dex
], &pAd->
TxPow
[
BG_BAND_REGION_6_START
], (
CHANNEL_TX_POWER
* 
BG_BAND_REGION_6_SIZE
);

142 
dex
 +
BG_BAND_REGION_6_SIZE
;

144 
REGION_7_BG_BAND
:

145 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
dex
], &pAd->
TxPow
[
BG_BAND_REGION_7_START
], (
CHANNEL_TX_POWER
* 
BG_BAND_REGION_7_SIZE
);

146 
dex
 +
BG_BAND_REGION_7_SIZE
;

148 
REGION_31_BG_BAND
:

149 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
dex
], &pAd->
TxPow
[
BG_BAND_REGION_31_START
], (
CHANNEL_TX_POWER
* 
BG_BAND_REGION_31_SIZE
);

150 
dex
 +
BG_BAND_REGION_31_SIZE
;

155 
i
=0; i<
dex
; i++)

156 
pAd
->
ChlLi
[
i
].
MaxTxPwr
 = 20;

159 i((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11A
|| (pAd->CommCfg.PhyMod=
PHY_11ABG_MIXED
)

160 #ifde
DOT11_N_SUPPORT


161 || (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11ABGN_MIXED
|| (pAd->CommCfg.PhyMod=
PHY_11AN_MIXED
)

162 || (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11AGN_MIXED
|| (pAd->CommCfg.PhyMod=
PHY_11N_5G
)

166 
pAd
->
CommCfg
.
CouryRegiFABd
 & 0x7f)

168 
REGION_0_A_BAND
:

169 
num
 = (
A_BAND_REGION_0_CHANNEL_LIST
)/(
UCHAR
);

170 
pChlLi
 = 
A_BAND_REGION_0_CHANNEL_LIST
;

172 
REGION_1_A_BAND
:

173 
num
 = (
A_BAND_REGION_1_CHANNEL_LIST
)/(
UCHAR
);

174 
pChlLi
 = 
A_BAND_REGION_1_CHANNEL_LIST
;

176 
REGION_2_A_BAND
:

177 
num
 = (
A_BAND_REGION_2_CHANNEL_LIST
)/(
UCHAR
);

178 
pChlLi
 = 
A_BAND_REGION_2_CHANNEL_LIST
;

180 
REGION_3_A_BAND
:

181 
num
 = (
A_BAND_REGION_3_CHANNEL_LIST
)/(
UCHAR
);

182 
pChlLi
 = 
A_BAND_REGION_3_CHANNEL_LIST
;

184 
REGION_4_A_BAND
:

185 
num
 = (
A_BAND_REGION_4_CHANNEL_LIST
)/(
UCHAR
);

186 
pChlLi
 = 
A_BAND_REGION_4_CHANNEL_LIST
;

188 
REGION_5_A_BAND
:

189 
num
 = (
A_BAND_REGION_5_CHANNEL_LIST
)/(
UCHAR
);

190 
pChlLi
 = 
A_BAND_REGION_5_CHANNEL_LIST
;

192 
REGION_6_A_BAND
:

193 
num
 = (
A_BAND_REGION_6_CHANNEL_LIST
)/(
UCHAR
);

194 
pChlLi
 = 
A_BAND_REGION_6_CHANNEL_LIST
;

196 
REGION_7_A_BAND
:

197 
num
 = (
A_BAND_REGION_7_CHANNEL_LIST
)/(
UCHAR
);

198 
pChlLi
 = 
A_BAND_REGION_7_CHANNEL_LIST
;

200 
REGION_8_A_BAND
:

201 
num
 = (
A_BAND_REGION_8_CHANNEL_LIST
)/(
UCHAR
);

202 
pChlLi
 = 
A_BAND_REGION_8_CHANNEL_LIST
;

204 
REGION_9_A_BAND
:

205 
num
 = (
A_BAND_REGION_9_CHANNEL_LIST
)/(
UCHAR
);

206 
pChlLi
 = 
A_BAND_REGION_9_CHANNEL_LIST
;

208 
REGION_10_A_BAND
:

209 
num
 = (
A_BAND_REGION_10_CHANNEL_LIST
)/(
UCHAR
);

210 
pChlLi
 = 
A_BAND_REGION_10_CHANNEL_LIST
;

212 
REGION_11_A_BAND
:

213 
num
 = (
A_BAND_REGION_11_CHANNEL_LIST
)/(
UCHAR
);

214 
pChlLi
 = 
A_BAND_REGION_11_CHANNEL_LIST
;

216 
REGION_12_A_BAND
:

217 
num
 = (
A_BAND_REGION_12_CHANNEL_LIST
)/(
UCHAR
);

218 
pChlLi
 = 
A_BAND_REGION_12_CHANNEL_LIST
;

220 
REGION_13_A_BAND
:

221 
num
 = (
A_BAND_REGION_13_CHANNEL_LIST
)/(
UCHAR
);

222 
pChlLi
 = 
A_BAND_REGION_13_CHANNEL_LIST
;

224 
REGION_14_A_BAND
:

225 
num
 = (
A_BAND_REGION_14_CHANNEL_LIST
)/(
UCHAR
);

226 
pChlLi
 = 
A_BAND_REGION_14_CHANNEL_LIST
;

228 
REGION_15_A_BAND
:

229 
num
 = (
A_BAND_REGION_15_CHANNEL_LIST
)/(
UCHAR
);

230 
pChlLi
 = 
A_BAND_REGION_15_CHANNEL_LIST
;

232 
REGION_16_A_BAND
:

233 
num
 = (
A_BAND_REGION_16_CHANNEL_LIST
)/(
UCHAR
);

234 
pChlLi
 = 
A_BAND_REGION_16_CHANNEL_LIST
;

236 
REGION_17_A_BAND
:

237 
num
 = (
A_BAND_REGION_17_CHANNEL_LIST
)/(
UCHAR
);

238 
pChlLi
 = 
A_BAND_REGION_17_CHANNEL_LIST
;

240 
REGION_18_A_BAND
:

241 
num
 = (
A_BAND_REGION_18_CHANNEL_LIST
)/(
UCHAR
);

242 
pChlLi
 = 
A_BAND_REGION_18_CHANNEL_LIST
;

244 
REGION_19_A_BAND
:

245 
num
 = (
A_BAND_REGION_19_CHANNEL_LIST
)/(
UCHAR
);

246 
pChlLi
 = 
A_BAND_REGION_19_CHANNEL_LIST
;

248 
REGION_20_A_BAND
:

249 
num
 = (
A_BAND_REGION_20_CHANNEL_LIST
)/(
UCHAR
);

250 
pChlLi
 = 
A_BAND_REGION_20_CHANNEL_LIST
;

252 
REGION_21_A_BAND
:

253 
num
 = (
A_BAND_REGION_21_CHANNEL_LIST
)/(
UCHAR
);

254 
pChlLi
 = 
A_BAND_REGION_21_CHANNEL_LIST
;

257 
	`DBGPRINT
(
RT_DEBUG_WARN
,("courygi=%d sut", 
pAd
->
CommCfg
.
CouryRegiFABd
));

261 i(
num
 != 0)

263 
UCHAR
 
RadCh
[15]={52, 56, 60, 64, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140};

264 
PUCHAR
 
ChlLi
;

265 
ChlLi
=
pChlLi
;

266 
i
=0; i<
num
; i++)

268 
j
=0; j<
MAX_NUM_OF_CHANNELS
; j++)

270 i(
ChlLi
[
i
] =
pAd
->
TxPow
[
j
].
Chl
)

271 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
dex
+
i
], &pAd->
TxPow
[
j
], (
CHANNEL_TX_POWER
));

273 
j
=0; j<15; j++)

275 i(
ChlLi
[
i
] =
RadCh
[
j
])

276 
pAd
->
ChlLi
[
dex
+
i
].
DfsReq
 = 
TRUE
;

278 
pAd
->
ChlLi
[
dex
+
i
].
MaxTxPwr
 = 20;

280 
dex
 +
num
;

284 
pAd
->
ChlLiNum
 = 
dex
;

285 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("country code=%d/%d, RFIC=%d, PHY mode=%d, support %d channels\n",

286 
pAd
->
CommCfg
.
CouryRegi
,Ad->CommCfg.
CouryRegiFABd
,Ad->
RfIcTy
,Ad->CommCfg.
PhyMode
,Ad->
ChlLiNum
));

287 #ifde
DBG


288 
i
=0;i<
pAd
->
ChlLiNum
;i++)

290 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("BudCh# %d :: Pwr0 = %d, Pwr1 =%d, \", 
pAd
->
ChlLi
[
i
].
Chl
,Ad->ChlLi[i].
Pow
,Ad->ChlLi[i].
Pow2
));

293 
	}
}

308 
UCHAR
 
	$FChl
(

309 
IN
 
PRTMP_ADAPTER
 
pAd
)

311  
pAd
->
ChlLi
[0].
Chl
;

312 
	}
}

325 
UCHAR
 
	$NextChl
(

326 
IN
 
PRTMP_ADAPTER
 
pAd
,

327 
IN
 
UCHAR
 
chl
)

329 
i
;

330 
UCHAR
 
xt_chl
 = 0;

332 
i
 = 0; i < (
pAd
->
ChlLiNum
 - 1); i++)

334 i(
chl
 =
pAd
->
ChlLi
[
i
].
Chl
)

336 #ifde
DOT11_N_SUPPORT


337 #ifde
DOT11N_DRAFT3


340 i((
pAd
->
MlmeAux
.
SnTy
 =
SCAN_2040_BSS_COEXIST
&& (pAd->
ChlLi
[
i
+1].
Chl
 >14))

342 
chl
 = 
pAd
->
ChlLi
[
i
+1].
Chl
;

350 
xt_chl
 = 
pAd
->
ChlLi
[
i
+1].
Chl
;

356  
xt_chl
;

357 
	}
}

379 
VOID
 
	$ChgeToClPowLim
(

380 
IN
 
PRTMP_ADAPTER
 
pAd
,

381 
IN
 
UCHAR
 
AڑClPowLim
)

385 i(
AڑClPowLim
 == 0xFF)

388 i(
AڑClPowLim
 < 6)

389 
pAd
->
CommCfg
.
TxPowPage
 = 6;

390 i(
AڑClPowLim
 < 9)

391 
pAd
->
CommCfg
.
TxPowPage
 = 10;

392 i(
AڑClPowLim
 < 12)

393 
pAd
->
CommCfg
.
TxPowPage
 = 25;

394 i(
AڑClPowLim
 < 14)

395 
pAd
->
CommCfg
.
TxPowPage
 = 50;

396 i(
AڑClPowLim
 < 15)

397 
pAd
->
CommCfg
.
TxPowPage
 = 75;

399 
pAd
->
CommCfg
.
TxPowPage
 = 100;

401 i(
pAd
->
CommCfg
.
TxPowPage
 >Ad->CommCfg.
TxPowDeu
)

402 
pAd
->
CommCfg
.
TxPowPage
 =Ad->CommCfg.
TxPowDeu
;

404 
	}
}

406 
CHAR
 
	$CvtToRssi
(

407 
IN
 
PRTMP_ADAPTER
 
pAd
,

408 
IN
 
CHAR
 
Rssi
,

409 
IN
 
UCHAR
 
RssiNumb
)

411 
UCHAR
 
RssiOfft
, 
LNAGa
;

414 i(
Rssi
 == 0)

417 
LNAGa
 = 
	`GET_LNA_GAIN
(
pAd
);

418 i(
pAd
->
LchRfRegs
.
Chl
 > 14)

420 i(
RssiNumb
 == 0)

421 
RssiOfft
 = 
pAd
->
ARssiOfft0
;

422 i(
RssiNumb
 == 1)

423 
RssiOfft
 = 
pAd
->
ARssiOfft1
;

425 
RssiOfft
 = 
pAd
->
ARssiOfft2
;

429 i(
RssiNumb
 == 0)

430 
RssiOfft
 = 
pAd
->
BGRssiOfft0
;

431 i(
RssiNumb
 == 1)

432 
RssiOfft
 = 
pAd
->
BGRssiOfft1
;

434 
RssiOfft
 = 
pAd
->
BGRssiOfft2
;

437  (-12 - 
RssiOfft
 - 
LNAGa
 - 
Rssi
);

438 
	}
}

440 
CHAR
 
	$CvtToS
(

441 
IN
 
PRTMP_ADAPTER
 
pAd
,

442 
IN
 
UCHAR
 
S
)

444  ((0xeb - 
S
) * 3) / 16 ;

446 
	}
}

448 #i
defed
(
AP_SCAN_SUPPORT
|| defed(
CONFIG_STA_SUPPORT
)

455 
VOID
 
	$SnNextChl
(

456 
IN
 
PRTMP_ADAPTER
 
pAd
)

458 
HEADER_802_11
 
Hdr80211
;

459 
PUCHAR
 
pOutBufr
 = 
NULL
;

460 
NDIS_STATUS
 
NStus
;

461 
ULONG
 
FmeL
 = 0;

462 
UCHAR
 
SsidL
 = 0, 
SnTy
 = 
pAd
->
MlmeAux
.SnTy, 
BBPVue
 = 0;

463 #ifde
CONFIG_STA_SUPPORT


464 
USHORT
 
Stus
;

466 
UINT
 
SnTimeIn5gChl
 = 
SHORT_CHANNEL_TIME
;

467 
BOOLEAN
 
SnPdg
 = 
FALSE
;

469 #ifde
CONFIG_STA_SUPPORT


470 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

472 i(
	`MONITOR_ON
(
pAd
))

476 
SnPdg
 = ((
pAd
->
SCfg
.
bImovedSn
&& (pAd->SCfg.
SnChlC
>=7));

479 #ifde
RALINK_ATE


481 i(
	`ATE_ON
(
pAd
))

485 i((
pAd
->
MlmeAux
.
Chl
 =0|| 
SnPdg
)

487 i((
pAd
->
CommCfg
.
BBPCutBW
 =
BW_40
)

488 #ifde
CONFIG_STA_SUPPORT


489 && (
	`INFRA_ON
(
pAd
|| 
	`ADHOC_ON
(pAd)

490 || (
pAd
->
OpMode
 =
OPMODE_AP
))

494 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

495 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

496 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BBPVue
);

497 
BBPVue
 &= (~0x18);

498 
BBPVue
 |= 0x10;

499 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BBPVue
);

500 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - End oSCAN,eܐt40MHz ch%d, Tٮ BSS[%02d]\n",
pAd
->
CommCfg
.
CChl
,Ad->
SnTab
.
BssNr
));

504 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

505 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

506 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - End oSCAN,eܐtch%d, Tٮ BSS[%02d]\n",
pAd
->
CommCfg
.
Chl
,Ad->
SnTab
.
BssNr
));

509 #ifde
CONFIG_STA_SUPPORT


510 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

518 i(
	`ADHOC_ON
(
pAd
))

520 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
Ssid
, 
MAX_LEN_OF_SSID
);

521 
pAd
->
MlmeAux
.
SsidL
 =Ad->
CommCfg
.SsidLen;

522 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
Ssid
,Ad->
CommCfg
.Ssid,Ad->CommCfg.
SsidL
);

530 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
&& (
	`INFRA_ON
(pAd)))

532 
	`RTMPSdNuFme
(
pAd
,

533 
pAd
->
CommCfg
.
TxRe
,

534 (
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_WMM_INUSED
? 
TRUE
:
FALSE
));

535 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%-- Sd PSM Dame\n", 
__FUNCTION__
));

539 
pAd
->
SCfg
.
LaSnChl
 =Ad->
MlmeAux
.
Chl
;

541 
pAd
->
SCfg
.
SnChlC
 = 0;

544 i((
pAd
->
MlmeAux
.
Chl
 != 0) &&

545 (
pAd
->
SCfg
.
bImovedSn
))

547 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SCAN_PENDING
;

548 
Stus
 = 
MLME_SUCCESS
;

549 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("bFastRoamingScan ~~~~~~~~~~~~~ Get backo send data ~~~~~~~~~~~~~\n"));

551 
	`RTMPResumeMsduTnsmissi
(
pAd
);

555 
pAd
->
SCfg
.
BssNr
 =Ad->
SnTab
.BssNr;

556 
pAd
->
SCfg
.
bImovedSn
 = 
FALSE
;

558 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

559 
Stus
 = 
MLME_SUCCESS
;

560 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_SCAN_CONF
, 2, &
Stus
, 0);

562 
	`RTMPSdWessEvt
(
pAd
, 
IW_SCAN_COMPLETED_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

565 #ifde
LINUX


566 #ifde
RT_CFG80211_SUPPORT


567 
	`RTEnqueueIlCmd
(
pAd
, 
CMDTHREAD_SCAN_END
, 
NULL
, 0);

578 #ifde
CONFIG_STA_SUPPORT


579 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

582 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

583 
	`AsicFWakeup
(
pAd
, 
TRUE
);

586 i(
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
)

587 
	`RTMP_SET_PSM_BIT
(
pAd
, 
PWR_ACTIVE
);

591 
	`AsicSwchChl
(
pAd
,Ad->
MlmeAux
.
Chl
, 
TRUE
);

592 
	`AsicLockChl
(
pAd
,Ad->
MlmeAux
.
Chl
);

594 #ifde
CONFIG_STA_SUPPORT


595 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

597 i(
pAd
->
MlmeAux
.
Chl
 > 14)

599 i((
pAd
->
CommCfg
.
bIEEE80211H
 =1&& 
	`RadChlCheck
Ad,Ad->
MlmeAux
.
Chl
))

601 
SnTy
 = 
SCAN_PASSIVE
;

602 
SnTimeIn5gChl
 = 
MIN_CHANNEL_TIME
;

606 #ifde
CARRIER_DETECTION_SUPPORT


608 i(
pAd
->
CommCfg
.
CrrDe
.
Eb
 =
TRUE
)

610 
SnTy
 = 
SCAN_PASSIVE
;

611 
SnTimeIn5gChl
 = 
MIN_CHANNEL_TIME
;

619 i(((
pAd
->
MlmeAux
.
Chl
 <= 14) &&

620 (
pAd
->
MlmeAux
.
Chl
 >= 12) &&

621 ((
pAd
->
CommCfg
.
CouryRegi
 & 0x7f=
REGION_31_BG_BAND
)) ||

622 (
	`CHAN_PrݔtyCheck
(
pAd
,Ad->
MlmeAux
.
Chl
, 
CHANNEL_PASSIVE_SCAN
=
TRUE
))

624 
SnTy
 = 
SCAN_PASSIVE
;

629 i(
SnTy
 =
FAST_SCAN_ACTIVE
)

630 
	`RTMPSTim
(&
pAd
->
MlmeAux
.
SnTim
, 
FAST_ACTIVE_SCAN_TIME
);

633 #ifde
CONFIG_STA_SUPPORT


634 
pAd
->
SCfg
.
SnChlC
++;

636 i((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11ABG_MIXED
)

637 #ifde
DOT11_N_SUPPORT


638 || (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11ABGN_MIXED
|| (pAd->CommCfg.PhyMod=
PHY_11AGN_MIXED
)

643 i(
pAd
->
MlmeAux
.
Chl
 > 14)

644 
	`RTMPSTim
(&
pAd
->
MlmeAux
.
SnTim
, 
SnTimeIn5gChl
);

646 
	`RTMPSTim
(&
pAd
->
MlmeAux
.
SnTim
, 
MIN_CHANNEL_TIME
);

652 
	`RTMPSTim
(&
pAd
->
MlmeAux
.
SnTim
, 
MAX_CHANNEL_TIME
);

656 i((
SnTy
 =
SCAN_ACTIVE
)

657 || (
SnTy
 =
FAST_SCAN_ACTIVE
)

658 #ifde
DOT11_N_SUPPORT


659 #ifde
DOT11N_DRAFT3


660 || (
SnTy
 =
SCAN_2040_BSS_COEXIST
)

665 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

666 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

668 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - ScanNextChannel()llocate memory fail\n"));

669 #ifde
CONFIG_STA_SUPPORT


670 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

672 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

673 
Stus
 = 
MLME_FAIL_NO_RESOURCE
;

674 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_SCAN_CONF
, 2, &
Stus
, 0);

681 #ifde
DOT11_N_SUPPORT


682 #ifde
DOT11N_DRAFT3


683 i(
SnTy
 =
SCAN_2040_BSS_COEXIST
)

685 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - SCAN_2040_BSS_COEXIST !! Prepareo send Probe Request\n"));

691 i((
SnTy
 =
SCAN_ACTIVE
|| (SnTy =
FAST_SCAN_ACTIVE
)

693 
SsidL
 = 
pAd
->
MlmeAux
.SsidLen;

695 
SsidL
 = 0;

697 #ifde
CONFIG_STA_SUPPORT


698 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

699 
	`MgtMacHdIn
(
pAd
, &
Hdr80211
, 
SUBTYPE_PROBE_REQ
, 0, 
BROADCAST_ADDR
, BROADCAST_ADDR);

703 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

704 (
HEADER_802_11
), &
Hdr80211
,

705 1, &
SsidIe
,

706 1, &
SsidL
,

707 
SsidL
, 
pAd
->
MlmeAux
.
Ssid
,

708 1, &
SupReIe
,

709 1, &
pAd
->
CommCfg
.
SupReL
,

710 
pAd
->
CommCfg
.
SupReL
,Ad->CommCfg.
SupRe
,

711 
END_OF_ARGS
);

713 i(
pAd
->
CommCfg
.
ExtReL
)

715 
ULONG
 
Tmp
;

716 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
Tmp
,

717 1, &
ExtReIe
,

718 1, &
pAd
->
CommCfg
.
ExtReL
,

719 
pAd
->
CommCfg
.
ExtReL
,Ad->CommCfg.
ExtRe
,

720 
END_OF_ARGS
);

721 
FmeL
 +
Tmp
;

724 #ifde
DOT11_N_SUPPORT


725 i(
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
)

727 
ULONG
 
Tmp
;

728 
UCHAR
 
HtL
;

729 
UCHAR
 
BROADCOM
[4] = {0x0, 0x90, 0x4c, 0x33};

730 #ifde
RT_BIG_ENDIAN


731 
HT_CAPABILITY_IE
 
HtCabyTmp
;

733 i(
pAd
->
bBrdComHT
 =
TRUE
)

735 
HtL
 = 
pAd
->
MlmeAux
.
HtCabyL
 + 4;

736 #ifde
RT_BIG_ENDIAN


737 
	`NdisMoveMemy
(&
HtCabyTmp
, &
pAd
->
MlmeAux
.
HtCaby
, 
SIZE_HT_CAP_IE
);

738 *(
USHORT
 *)(&
HtCabyTmp
.
HtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.HtCapInfo));

739 #ifde
UNALIGNMENT_SUPPORT


741 
EXT_HT_CAP_INFO
 
extHtCInfo
;

743 
	`NdisMoveMemy
((
PUCHAR
)(&
extHtCInfo
), (PUCHAR)(&
HtCabyTmp
.
ExtHtCInfo
), (
EXT_HT_CAP_INFO
));

744 *(
USHORT
 *)(&
extHtCInfo

	`u216
(*(USHORT *)(&extHtCapInfo));

745 
	`NdisMoveMemy
((
PUCHAR
)(&
HtCabyTmp
.
ExtHtCInfo
), (PUCHAR)(&
extHtCInfo
), (
EXT_HT_CAP_INFO
));

748 *(
USHORT
 *)(&
HtCabyTmp
.
ExtHtCInfo

	`u216
(*(USHORT *)(&HtCapabilityTmp.ExtHtCapInfo));

751 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
Tmp
,

752 1, &
WIe
,

753 1, &
HtL
,

754 4, &
BROADCOM
[0],

755 
pAd
->
MlmeAux
.
HtCabyL
, &
HtCabyTmp
,

756 
END_OF_ARGS
);

758 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
Tmp
,

759 1, &
WIe
,

760 1, &
HtL
,

761 4, &
BROADCOM
[0],

762 
pAd
->
MlmeAux
.
HtCabyL
, &pAd->MlmeAux.
HtCaby
,

763 
END_OF_ARGS
);

768 
HtL
 = 
pAd
->
MlmeAux
.
HtCabyL
;

769 #ifde
RT_BIG_ENDIAN


770 
	`NdisMoveMemy
(&
HtCabyTmp
, &
pAd
->
CommCfg
.
HtCaby
, 
SIZE_HT_CAP_IE
);

771 *(
USHORT
 *)(&
HtCabyTmp
.
HtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.HtCapInfo));

772 #ifde
UNALIGNMENT_SUPPORT


774 
EXT_HT_CAP_INFO
 
extHtCInfo
;

776 
	`NdisMoveMemy
((
PUCHAR
)(&
extHtCInfo
), (PUCHAR)(&
HtCabyTmp
.
ExtHtCInfo
), (
EXT_HT_CAP_INFO
));

777 *(
USHORT
 *)(&
extHtCInfo

	`u216
(*(USHORT *)(&extHtCapInfo));

778 
	`NdisMoveMemy
((
PUCHAR
)(&
HtCabyTmp
.
ExtHtCInfo
), (PUCHAR)(&
extHtCInfo
), (
EXT_HT_CAP_INFO
));

781 *(
USHORT
 *)(&
HtCabyTmp
.
ExtHtCInfo

	`u216
(*(USHORT *)(&HtCapabilityTmp.ExtHtCapInfo));

784 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
Tmp
,

785 1, &
HtCIe
,

786 1, &
HtL
,

787 
HtL
, &
HtCabyTmp
,

788 
END_OF_ARGS
);

790 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
Tmp
,

791 1, &
HtCIe
,

792 1, &
HtL
,

793 
HtL
, &
pAd
->
CommCfg
.
HtCaby
,

794 
END_OF_ARGS
);

797 
FmeL
 +
Tmp
;

799 #ifde
DOT11N_DRAFT3


800 i((
pAd
->
MlmeAux
.
Chl
 <14&& (pAd->
CommCfg
.
bBssCxEb
 =
TRUE
))

802 
ULONG
 
Tmp
;

803 
HtL
 = 1;

804 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
Tmp
,

805 1, &
ExtHtCIe
,

806 1, &
HtL
,

807 1, &
pAd
->
CommCfg
.
BSSCxi2040
.
wd
,

808 
END_OF_ARGS
);

810 
FmeL
 +
Tmp
;

817 #ifde
WPA_SUPPLICANT_SUPPORT


818 i((
pAd
->
OpMode
 =
OPMODE_STA
) &&

819 (
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
) &&

820 (
pAd
->
SCfg
.
WpsProbeReqIeL
 != 0))

822 
ULONG
 
WpsTmpL
 = 0;

824 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
WpsTmpL
,

825 
pAd
->
SCfg
.
WpsProbeReqIeL
,Ad->SCfg.
pWpsProbeReqIe
,

826 
END_OF_ARGS
);

828 
FmeL
 +
WpsTmpL
;

832 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

834 #ifde
CONFIG_STA_SUPPORT


835 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

842 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
) &&

843 (
	`INFRA_ON
(
pAd
)) &&

844 (
pAd
->
CommCfg
.
Chl
 =pAd->
MlmeAux
.Channel))

846 
	`RTMPSdNuFme
(
pAd
,

847 
pAd
->
CommCfg
.
TxRe
,

848 (
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_WMM_INUSED
? 
TRUE
:
FALSE
));

849 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ScanNextChannel():Send PWA NullData frameootifyhessociated AP!\n"));

854 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

859 #ifde
CONFIG_STA_SUPPORT


860 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

861 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SCAN_LISTEN
;

865 
	}
}

870 
BOOLEAN
 
	$SnRug
(

871 
IN
 
PRTMP_ADAPTER
 
pAd
)

873 
BOOLEAN
 
rv
 = 
FALSE
;

875 #ifde
CONFIG_STA_SUPPORT


876 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

877 
rv
 = ((
pAd
->
Mlme
.
SyncMache
.
CuS
 =
SCAN_LISTEN
? 
TRUE
 : 
FALSE
);

880  
rv
;

881 
	}
}

	@common/cmm_tkip.c

38 
	~"_cfig.h
"

41 
	#ROL32

A
, 
n
 ) \

42 ((
A
<< (
n
)| ( ((A)>>(32-))& ( (1UL << (n)- 1 ) ) )

	)

43 
	#ROR32

A
, 
n
 ) 
	`ROL32
(A), 32-)

	)

45 
UINT
 
	gTk_Sbox_Low
[256] =

81 
UINT
 
	gTk_Sbox_U
[256] =

120 
GNU_PACKED
 
	t_IV_CONTROL_


122 
	uGNU_PACKED


124 
	sGNU_PACKED


126 
UCHAR
 
	grc0
;

127 
UCHAR
 
	grc1
;

128 
UCHAR
 
	grc2
;

130 
	uGNU_PACKED


132 
	sGNU_PACKED


134 #ifde
RT_BIG_ENDIAN


135 
UCHAR
 
	gKeyID
:2;

136 
UCHAR
 
	gExtIV
:1;

137 
UCHAR
 
	gRsvd
:5;

139 
UCHAR
 
	gRsvd
:5;

140 
UCHAR
 
	gExtIV
:1;

141 
UCHAR
 
	gKeyID
:2;

143 } 
	gfld
;

144 
UCHAR
 
	gBy
;

145 } 
	gCONTROL
;

146 } 
	gfld
;

148 
ULONG
 
	gwd
;

149 } 
	gIV16
;

151 
ULONG
 
	gIV32
;

152 } 
	tTKIP_IV
, *
	tPTKIP_IV
;

171 
ULONG
 
	$RTMPTkGUI32
(

172 
IN
 
PUCHAR
 
pMICKey
)

174 
ULONG
 
s
 = 0;

175 
INT
 
i
;

177 
i
 = 0; i < 4; i++)

179 
s
 |(*
pMICKey
++<< (8 * 
i
);

182  
s
;

183 
	}
}

204 
VOID
 
	$RTMPTkPutUI32
(

205 
IN
 
OUT
 
PUCHAR
 
pD
,

206 
IN
 
ULONG
 
v
)

208 
INT
 
i
;

210 
i
 = 0; i < 4; i++)

212 *
pD
++ = (
UCHAR
(
v
 & 0xff);

213 
v
 >>= 8;

215 
	}
}

236 
VOID
 
	$RTMPTkSMICKey
(

237 
IN
 
PTKIP_KEY_INFO
 
pTk
,

238 
IN
 
PUCHAR
 
pMICKey
)

241 
pTk
->
K0
 = 
	`RTMPTkGUI32
(
pMICKey
);

242 
pTk
->
K1
 = 
	`RTMPTkGUI32
(
pMICKey
 + 4);

244 
pTk
->
L
 =Tk->
K0
;

245 
pTk
->
R
 =Tk->
K1
;

246 
pTk
->
nBysInM
 = 0;

247 
pTk
->
M
 = 0;

248 
	}
}

269 
VOID
 
	$RTMPTkAdBy
(

270 
IN
 
PTKIP_KEY_INFO
 
pTk
,

271 
IN
 
UCHAR
 
uCh
)

274 
pTk
->
M
 |(
uCh
 << (8*Tk->
nBysInM
));

275 
pTk
->
nBysInM
++;

277 if
pTk
->
nBysInM
 >= 4 )

279 
pTk
->
L
 ^pTk->
M
;

280 
pTk
->
R
 ^
	`ROL32
pTk->
L
, 17 );

281 
pTk
->
L
 +pTk->
R
;

282 
pTk
->
R
 ^(Tk->
L
 & 0xff00ff00) >> 8) | ((pTkip->L & 0x00ff00ff) << 8);

283 
pTk
->
L
 +pTk->
R
;

284 
pTk
->
R
 ^
	`ROL32
pTk->
L
, 3 );

285 
pTk
->
L
 +pTk->
R
;

286 
pTk
->
R
 ^
	`ROR32
pTk->
L
, 2 );

287 
pTk
->
L
 +pTk->
R
;

289 
pTk
->
M
 = 0;

290 
pTk
->
nBysInM
 = 0;

292 
	}
}

314 
VOID
 
	$RTMPTkAd
(

315 
IN
 
PTKIP_KEY_INFO
 
pTk
,

316 
IN
 
PUCHAR
 
pSrc
,

317 
IN
 
UINT
 
nBys
)

320 
nBys
 > 0)

322 
	`RTMPTkAdBy
(
pTk
, *
pSrc
++);

323 
nBys
--;

325 
	}
}

345 
VOID
 
	$RTMPTkGMIC
(

346 
IN
 
PTKIP_KEY_INFO
 
pTk
)

349 
	`RTMPTkAdBy
(
pTk
, 0x5a );

350 
	`RTMPTkAdBy
(
pTk
, 0 );

351 
	`RTMPTkAdBy
(
pTk
, 0 );

352 
	`RTMPTkAdBy
(
pTk
, 0 );

353 
	`RTMPTkAdBy
(
pTk
, 0 );

355  
pTk
->
nBysInM
 != 0 )

357 
	`RTMPTkAdBy
(
pTk
, 0 );

360 
	`RTMPTkPutUI32
(
pTk
->
MIC
,Tk->
L
);

361 
	`RTMPTkPutUI32
(
pTk
->
MIC
 + 4,Tk->
R
);

362 
	}
}

386 
VOID
 
	$RTMPInMICEnge
(

387 
IN
 
PRTMP_ADAPTER
 
pAd
,

388 
IN
 
PUCHAR
 
pKey
,

389 
IN
 
PUCHAR
 
pDA
,

390 
IN
 
PUCHAR
 
pSA
,

391 
IN
 
UCHAR
 
UrPriܙy
,

392 
IN
 
PUCHAR
 
pMICKey
)

394 
ULONG
 
Priܙy
 = 
UrPriܙy
;

397 
	`RTMPTkSMICKey
(&
pAd
->
PriveInfo
.
Tx
, 
pMICKey
);

399 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Tx
, 
pDA
, 
MAC_ADDR_LEN
);

401 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Tx
, 
pSA
, 
MAC_ADDR_LEN
);

403 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Tx
, (
PUCHAR
)&
Priܙy
, 4);

404 
	}
}

430 
BOOLEAN
 
	$RTMPTkComMICVue
(

431 
IN
 
PRTMP_ADAPTER
 
pAd
,

432 
IN
 
PUCHAR
 
pSrc
,

433 
IN
 
PUCHAR
 
pDA
,

434 
IN
 
PUCHAR
 
pSA
,

435 
IN
 
PUCHAR
 
pMICKey
,

436 
IN
 
UCHAR
 
UrPriܙy
,

437 
IN
 
UINT
 
L
)

439 
UCHAR
 
OldMic
[8];

440 
ULONG
 
Priܙy
 = 
UrPriܙy
;

443 
	`RTMPTkSMICKey
(&
pAd
->
PriveInfo
.
Rx
, 
pMICKey
);

445 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Rx
, 
pDA
, 
MAC_ADDR_LEN
);

447 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Rx
, 
pSA
, 
MAC_ADDR_LEN
);

449 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Rx
, (
PUCHAR
)&
Priܙy
, 4);

452 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Rx
, 
pSrc
, 
L
);

455 
	`NdisMoveMemy
(
OldMic
, 
pSrc
 + 
L
, 8);

458 
	`RTMPTkGMIC
(&
pAd
->
PriveInfo
.
Rx
);

462 if(!
	`NdisEquMemy
(
pAd
->
PriveInfo
.
Rx
.
MIC
, 
OldMic
, 8))

464 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
, ("RTMPTkipCompareMICValue(): TKIP MIC Error !\n"));

467  (
FALSE
);

469  (
TRUE
);

470 
	}
}

494 
VOID
 
	$RTMPCcuϋMICVue
(

495 
IN
 
PRTMP_ADAPTER
 
pAd
,

496 
IN
 
PNDIS_PACKET
 
pPack
,

497 
IN
 
PUCHAR
 
pEnp
,

498 
IN
 
PCIPHER_KEY
 
pKey
,

499 
IN
 
UCHAR
 
idx
)

501 
PACKET_INFO
 
PackInfo
;

502 
PUCHAR
 
pSrcBufVA
;

503 
UINT
 
SrcBufL
;

504 
PUCHAR
 
pSrc
;

505 
UCHAR
 
UrPriܙy
;

506 
UCHAR
 
vn_offt
 = 0;

508 
	`RTMP_QuyPackInfo
(
pPack
, &
PackInfo
, &
pSrcBufVA
, &
SrcBufL
);

510 
UrPriܙy
 = 
	`RTMP_GET_PACKET_UP
(
pPack
);

511 
pSrc
 = 
pSrcBufVA
;

514 i(((*(
pSrc
 + 12) << 8) + *(pSrc + 13)) == 0x8100)

515 
vn_offt
 = 4;

517 #ifde
CONFIG_STA_SUPPORT


520 
	`RTMPInMICEnge
(

521 
pAd
,

522 
pKey
->
Key
,

523 
pSrc
,

524 
pSrc
 + 6,

525 
UrPriܙy
,

526 
pKey
->
TxMic
);

530 i(
pEnp
 !
NULL
)

533 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Tx
, 
pEnp
, 6);

535 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Tx
, 
pSrc
 + 12 + 
vn_offt
, 2);

537 
SrcBufL
 -(14 + 
vn_offt
);

538 
pSrc
 +(14 + 
vn_offt
);

541 i(
SrcBufL
 > 0)

543 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Tx
, 
pSrc
, 
SrcBufL
);

548 } 
TRUE
);

551 
	`RTMPTkGMIC
(&
pAd
->
PriveInfo
.
Tx
);

552 
	}
}

561 
UINT
 
	$tk_sbox
(
UINT
 
dex
)

563 
UINT
 
dex_low
;

564 
UINT
 
dex_high
;

565 
UINT
 

, 
right
;

567 
dex_low
 = (
dex
 % 256);

568 
dex_high
 = ((
dex
 >> 8) % 256);

570 

 = 
Tk_Sbox_Low
[
dex_low
] + (
Tk_Sbox_U
[index_low] * 256);

571 
right
 = 
Tk_Sbox_U
[
dex_high
] + (
Tk_Sbox_Low
[index_high] * 256);

573  (

 ^ 
right
);

574 
	}
}

576 
UINT
 
	$rr1
(
UINT
 
a
)

578 
b
;

580 i((
a
 & 0x01) == 0x01)

582 
b
 = (
a
 >> 1) | 0x8000;

586 
b
 = (
a
 >> 1) & 0x7fff;

588 
b
 = b % 65536;

589  
b
;

590 
	}
}

592 
VOID
 
	$RTMPTkMixKey
(

593 
UCHAR
 *
key
,

594 
UCHAR
 *

,

595 
ULONG
 
l
,

596 
ULONG
 
h
,

597 
UCHAR
 *
rc4key
,

598 
UINT
 *
p1k
)

601 
UINT
 
tsc0
;

602 
UINT
 
tsc1
;

603 
UINT
 
tsc2
;

605 
UINT
 
k0
;

606 
UINT
 
k1
;

607 
UINT
 
k2
;

608 
UINT
 
k3
;

609 
UINT
 
k4
;

610 
UINT
 
k5
;

612 
INT
 
i
;

613 
INT
 
j
;

615 
tsc0
 = ()((
h
 >> 16) % 65536);

616 
tsc1
 = ()(
h
 % 65536);

617 
tsc2
 = ()(
l
 % 65536);

620 
p1k
[0] = 
tsc1
;

621 
p1k
[1] = 
tsc0
;

622 
p1k
[2] = (
UINT
)(

[0] + (ta[1]*256));

623 
p1k
[3] = (
UINT
)(

[2] + (ta[3]*256));

624 
p1k
[4] = (
UINT
)(

[4] + (ta[5]*256));

627 
i
=0; i<8; i++)

629 
j
 = 2*(
i
 & 1);

630 
p1k
[0] = (p1k[0] + 
	`tk_sbox
1k[4] ^ ((256*
key
[1+
j
]) + key[j])) % 65536 )) % 65536;

631 
p1k
[1] = (p1k[1] + 
	`tk_sbox
1k[0] ^ ((256*
key
[5+
j
]) + key[4+j])) % 65536 )) % 65536;

632 
p1k
[2] = (p1k[2] + 
	`tk_sbox
1k[1] ^ ((256*
key
[9+
j
]) + key[8+j])) % 65536 )) % 65536;

633 
p1k
[3] = (p1k[3] + 
	`tk_sbox
1k[2] ^ ((256*
key
[13+
j
]) + key[12+j])) % 65536 )) % 65536;

634 
p1k
[4] = (p1k[4] + 
	`tk_sbox
1k[3] ^ (((256*
key
[1+
j
]) + key[j]))) % 65536 )) % 65536;

635 
p1k
[4] = (p1k[4] + 
i
) % 65536;

639 
k0
 = 
p1k
[0];

640 
k1
 = 
p1k
[1];

641 
k2
 = 
p1k
[2];

642 
k3
 = 
p1k
[3];

643 
k4
 = 
p1k
[4];

644 
k5
 = (
p1k
[4] + 
tsc2
) % 65536;

647 
k0
 =pk0 + 
	`tk_sbox
(
k5
 ^ ((256*
key
[1]) + key[0])) % 65536);

648 
k1
 =pk1 + 
	`tk_sbox
(
k0
 ^ ((256*
key
[3]) + key[2])) % 65536);

649 
k2
 =pk2 + 
	`tk_sbox
(
k1
 ^ ((256*
key
[5]) + key[4])) % 65536);

650 
k3
 =pk3 + 
	`tk_sbox
(
k2
 ^ ((256*
key
[7]) + key[6])) % 65536);

651 
k4
 =pk4 + 
	`tk_sbox
(
k3
 ^ ((256*
key
[9]) + key[8])) % 65536);

652 
k5
 =pk5 + 
	`tk_sbox
(
k4
 ^ ((256*
key
[11]) + key[10])) % 65536);

654 
k0
 =pk0 + 
	`rr1
(
k5
 ^ ((256*
key
[13]) + key[12]));

655 
k1
 =pk1 + 
	`rr1
(
k0
 ^ ((256*
key
[15]) + key[14]));

656 
k2
 =pk2 + 
	`rr1
(
k1
);

657 
k3
 =pk3 + 
	`rr1
(
k2
);

658 
k4
 =pk4 + 
	`rr1
(
k3
);

659 
k5
 =pk5 + 
	`rr1
(
k4
);

664 
tsc0
 = ()((
h
 >> 16) % 65536);

665 
tsc1
 = ()(
h
 % 65536);

666 
tsc2
 = ()(
l
 % 65536);

668 
rc4key
[0] = (
tsc2
 >> 8) % 256;

669 
rc4key
[1] = (((
tsc2
 >> 8) % 256) | 0x20) & 0x7f;

670 
rc4key
[2] = 
tsc2
 % 256;

671 
rc4key
[3] = ((
k5
 ^ ((256*
key
[1]) + key[0])) >> 1) % 256;

673 
rc4key
[4] = 
k0
 % 256;

674 
rc4key
[5] = (
k0
 >> 8) % 256;

676 
rc4key
[6] = 
k1
 % 256;

677 
rc4key
[7] = (
k1
 >> 8) % 256;

679 
rc4key
[8] = 
k2
 % 256;

680 
rc4key
[9] = (
k2
 >> 8) % 256;

682 
rc4key
[10] = 
k3
 % 256;

683 
rc4key
[11] = (
k3
 >> 8) % 256;

685 
rc4key
[12] = 
k4
 % 256;

686 
rc4key
[13] = (
k4
 >> 8) % 256;

688 
rc4key
[14] = 
k5
 % 256;

689 
rc4key
[15] = (
k5
 >> 8) % 256;

690 
	}
}

697 
BOOLEAN
 
	$RTMPSoDeyTKIP
(

698 
IN
 
PRTMP_ADAPTER
 
pAd
,

699 
IN
 
PUCHAR
 
pHdr
,

700 
IN
 
UCHAR
 
UrPriܙy
,

701 
IN
 
PCIPHER_KEY
 
pKey
,

702 
INOUT
 
PUCHAR
 
pDa
,

703 
IN
 
UINT16
 *
DaByC
)

705 
PHEADER_802_11
 
pFme
;

706 
UINT8
 
ame_ty
;

707 
UINT8
 
ame_subty
;

708 
UINT8
 
om_ds
;

709 
UINT8
 
to_ds
;

710 
UINT8
 
a4_exis
;

711 
UINT8
 
qc_exis
;

712 
UCHAR
 
TA
[
MAC_ADDR_LEN
];

713 
UCHAR
 
DA
[
MAC_ADDR_LEN
];

714 
UCHAR
 
SA
[
MAC_ADDR_LEN
];

715 
UCHAR
 
RC4Key
[16];

716 
UINT
 
p1k
[5];

717 
ULONG
 
l
;

718 
ULONG
 
h
;

719 
ARC4_CTX_STRUC
 
ARC4_CTX
;

720 
PUCHAR
 
axt_r
;

721 
UINT32
 
axt_n
;

722 
PUCHAR
 
chxt_r
;

723 
UINT32
 
chxt_n
;

724 
UINT
 
c32
 = 0;

725 
UINT
 
afcs
 = 0;

726 
UCHAR
 
MIC
[8];

727 
UCHAR
 
TMIC
[8];

729 #ifde
RT_BIG_ENDIAN


730 
	`RTMPFmeEndnChge
(
pAd
, 
pHdr
, 
DIR_READ
, 
FALSE
);

733 i(
pKey
->
KeyL
 == 0)

735 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%:hkey iemy)\n", 
__FUNCTION__
));

736  
FALSE
;

740 
ame_ty
 = (((*
pHdr
) >> 2) & 0x03);

741 
ame_subty
 = (((*
pHdr
) >> 4) & 0x0f);

744 
om_ds
 = ((*(
pHdr
 + 1)) & 0x2) >> 1;

745 
to_ds
 = ((*(
pHdr
 + 1)) & 0x1);

748 
a4_exis
 = (
om_ds
 & 
to_ds
);

749 
qc_exis
 = ((
ame_subty
 =
SUBTYPE_QDATA
) ||

750 (
ame_subty
 =
SUBTYPE_QDATA_CFACK
) ||

751 (
ame_subty
 =
SUBTYPE_QDATA_CFPOLL
) ||

752 (
ame_subty
 =
SUBTYPE_QDATA_CFACK_CFPOLL
));

755 
pFme
 = (
PHEADER_802_11
)
pHdr
;

758 i(
to_ds
 =0 && 
om_ds
 == 1)

760 
	`NdisMoveMemy
(
DA
, 
pFme
->
Addr1
, 
MAC_ADDR_LEN
);

761 
	`NdisMoveMemy
(
TA
, 
pFme
->
Addr2
, 
MAC_ADDR_LEN
);

762 
	`NdisMoveMemy
(
SA
, 
pFme
->
Addr3
, 
MAC_ADDR_LEN
);

764 i(
to_ds
 =0 && 
om_ds
 == 0 )

766 
	`NdisMoveMemy
(
DA
, 
pFme
->
Addr1
, 
MAC_ADDR_LEN
);

767 
	`NdisMoveMemy
(
TA
, 
pFme
->
Addr2
, 
MAC_ADDR_LEN
);

768 
	`NdisMoveMemy
(
SA
, 
pFme
->
Addr2
, 
MAC_ADDR_LEN
);

770 i(
to_ds
 =1 && 
om_ds
 == 0)

772 
	`NdisMoveMemy
(
SA
, 
pFme
->
Addr2
, 
MAC_ADDR_LEN
);

773 
	`NdisMoveMemy
(
TA
, 
pFme
->
Addr2
, 
MAC_ADDR_LEN
);

774 
	`NdisMoveMemy
(
DA
, 
pFme
->
Addr3
, 
MAC_ADDR_LEN
);

776 i(
to_ds
 =1 && 
om_ds
 == 1)

778 
	`NdisMoveMemy
(
TA
, 
pFme
->
Addr2
, 
MAC_ADDR_LEN
);

779 
	`NdisMoveMemy
(
DA
, 
pFme
->
Addr3
, 
MAC_ADDR_LEN
);

780 
	`NdisMoveMemy
(
SA
, 
pFme
->
O
, 
MAC_ADDR_LEN
);

783 
l
 = (*(
pDa
)) << 8 | (*(pData + 2));

784 
h
 = *((
PULONG
)(
pDa
 + 4));

785 
h
 = 
	`u232
(pnh);

786 
	`RTMPTkMixKey
(
pKey
->
Key
, 
TA
, 
l
, 
h
, 
RC4Key
, 
p1k
);

789 
chxt_r
 = 
pDa
 + 
LEN_TKIP_IV_HDR
;

790 
chxt_n
 = *
DaByC
 - 
LEN_TKIP_IV_HDR
;

794 
	`ARC4_INIT
(&
ARC4_CTX
, &
RC4Key
[0], 16);

799 
	`ARC4_Compu
(&
ARC4_CTX
, 
chxt_r
, 
chxt_n
, 
pDa
);

802 
axt_r
 = 
pDa
;

803 
axt_n
 = 
chxt_n
 - 
LEN_ICV
;

806 
	`NdisMoveMemy
(&
afcs
, 
axt_r
 + 
axt_n
, 
LEN_ICV
);

810 
c32
 = 
	`RTMP_CALC_FCS32
(
PPPINITFCS32
, 
axt_r
, 
axt_n
);

811 
c32
 ^= 0xffffffff;

813 if(
c32
 !
	`u232
(
afcs
))

815 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("! WEP Data CRC Error !\n"));

816  
FALSE
;

820 
axt_n
 -
LEN_TKIP_MIC
;

821 
	`NdisMoveMemy
(
TMIC
, 
axt_r
 + 
axt_n
, 
LEN_TKIP_MIC
);

822 
	`RTMPInMICEnge
(
pAd
, 
pKey
->
Key
, 
DA
, 
SA
, 
UrPriܙy
,Key->
RxMic
);

823 
	`RTMPTkAd
(&
pAd
->
PriveInfo
.
Tx
, 
axt_r
, 
axt_n
);

824 
	`RTMPTkGMIC
(&
pAd
->
PriveInfo
.
Tx
);

825 
	`NdisMoveMemy
(
MIC
, 
pAd
->
PriveInfo
.
Tx
.MIC, 
LEN_TKIP_MIC
);

827 i(!
	`NdisEquMemy
(
MIC
, 
TMIC
, 
LEN_TKIP_MIC
))

829 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("! TKIP MIC Error !\n"));

831  
FALSE
;

835 *
DaByC
 = 
axt_n
;

837 #ifde
RT_BIG_ENDIAN


838 
	`RTMPFmeEndnChge
(
pAd
, 
pHdr
, 
DIR_READ
, 
FALSE
);

840  
TRUE
;

841 
	}
}

859 
VOID
 
	$TKIP_GTK_KEY_WRAP
(

860 
IN
 
UCHAR
 *
key
,

861 
IN
 
UCHAR
 *
iv
,

862 
IN
 
UCHAR
 *
put_xt
,

863 
IN
 
UINT32
 
put_n
,

864 
OUT
 
UCHAR
 *
ouut_xt
)

866 
UCHAR
 
ekey
[
LEN_KEY_DESC_IV
 + 
LEN_PTK_KEK
];

867 
ARC4_CTX_STRUC
 
ARC4_CTX
;

871 
	`NdisMoveMemy
(
ekey
, 
iv
, 
LEN_KEY_DESC_IV
);

872 
	`NdisMoveMemy
(&
ekey
[
LEN_KEY_DESC_IV
], 
key
, 
LEN_PTK_KEK
);

875 
	`ARC4_INIT
(&
ARC4_CTX
, &
ekey
[0], 
LEN_KEY_DESC_IV
 + 
LEN_PTK_KEK
);

878 
	`ARC4_Disrd_KeyLgth
(&
ARC4_CTX
, 256);

881 
	`ARC4_Compu
(&
ARC4_CTX
, 
put_xt
, 
put_n
, 
ouut_xt
);

883 
	}
}

885 
VOID
 
	$TKIP_GTK_KEY_UNWRAP
(

886 
IN
 
UCHAR
 *
key
,

887 
IN
 
UCHAR
 *
iv
,

888 
IN
 
UCHAR
 *
put_xt
,

889 
IN
 
UINT32
 
put_n
,

890 
OUT
 
UCHAR
 *
ouut_xt
)

892 
	`TKIP_GTK_KEY_WRAP
(
key
, 
iv
, 
put_xt
, 
put_n
, 
ouut_xt
);

893 
	}
}

	@common/cmm_wep.c

38 
	~"_cfig.h
"

40 
UINT
 
	gFCSTAB_32
[256] =

128 
UINT
 
	$RTMP_CALC_FCS32
(

129 
IN
 
UINT
 
Fcs
,

130 
IN
 
PUCHAR
 
Cp
,

131 
IN
 
INT
 
L
)

133 
L
--)

134 
Fcs
 = (((Fcs>> 8^ 
FCSTAB_32
[((Fcs^ (*
Cp
++)) & 0xff]);

136  (
Fcs
);

137 
	}
}

161 
VOID
 
	$RTMPInWEnge
(

162 
IN
 
PUCHAR
 
pIv
,

163 
IN
 
PUCHAR
 
pKey
,

164 
IN
 
UCHAR
 
KeyL
,

165 
OUT
 
ARC4_CTX_STRUC
 *
pARC4_CTX
)

168 
PUCHAR
 
ed
 = 
NULL
;

169 
UINT8
 
ed_n
;

171 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
ed
, (UCHAR)*16);

172 i(
ed
 =
NULL
)

174 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: sd Ao memy fa!!!\n", 
__FUNCTION__
));

179 
	`NdisZoMemy
(
ed
, 16);

180 
	`NdisMoveMemy
(
ed
, 
pIv
, 3);

181 
	`NdisMoveMemy
(&
ed
[3], 
pKey
, 
KeyL
);

182 
ed_n
 = 3 + 
KeyL
;

186 
	`ARC4_INIT
(
pARC4_CTX
, &
ed
[0], 
ed_n
);

188 i(
ed
 !
NULL
)

189 
	`os__mem
(
NULL
, 
ed
);

190 
	}
}

207 
VOID
 
	$RTMPCڡruWEPIVHdr
(

208 
IN
 
UINT8
 
key_idx
,

209 
IN
 
UCHAR
 *

,

210 
OUT
 
UCHAR
 *
iv_hdr
)

212 
	`NdisZoMemy
(
iv_hdr
, 
LEN_WEP_IV_HDR
);

214 
	`NdisMoveMemy
(
iv_hdr
, 

, 
LEN_WEP_TSC
);

217 
iv_hdr
[3] = (
key_idx
 << 6);

218 
	}
}

237 
BOOLEAN
 
	$RTMPSoEnyWEP
(

238 
IN
 
PRTMP_ADAPTER
 
pAd
,

239 
IN
 
PUCHAR
 
pIvHdr
,

240 
IN
 
PCIPHER_KEY
 
pKey
,

241 
INOUT
 
PUCHAR
 
pDa
,

242 
IN
 
ULONG
 
DaByC
)

244 
ARC4_CTX_STRUC
 *
ARC4_CTX
 = 
NULL
;

245 
UINT
 
FCSCRC32
;

247 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
ARC4_CTX
, (
ARC4_CTX_STRUC
));

248 i(
ARC4_CTX
 =
NULL
)

250 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: ARC4_CTX Ao memy fa!!!\n", 
__FUNCTION__
));

251  
FALSE
;

254 i(
pKey
->
KeyL
 == 0)

256 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: Thkey iemy !\n", 
__FUNCTION__
));

257  
FALSE
;

261 
	`RTMPInWEnge
(
pIvHdr
,

262 
pKey
->
Key
,

263 
pKey
->
KeyL
,

264 
ARC4_CTX
);

267 
FCSCRC32
 = 
	`RTMP_CALC_FCS32
(
PPPINITFCS32
, 
pDa
, 
DaByC
);

268 
FCSCRC32
 ^= 0xffffffff;

269 
FCSCRC32
 = 
	`u232
(FCSCRC32);

272 
	`NdisMoveMemy
(
pDa
 + 
DaByC
, (
PUCHAR
)&
FCSCRC32
, 
LEN_ICV
);

275 
	`ARC4_Compu
(
ARC4_CTX
, 
pDa
, 
DaByC
 + 
LEN_ICV
,Data);

277 i(
ARC4_CTX
 !
NULL
)

278 
	`os__mem
(
NULL
, 
ARC4_CTX
);

280  
TRUE
;

281 
	}
}

303 
BOOLEAN
 
	$RTMPSoDeyWEP
(

304 
IN
 
PRTMP_ADAPTER
 
pAd
,

305 
IN
 
PCIPHER_KEY
 
pKey
,

306 
INOUT
 
PUCHAR
 
pDa
,

307 
INOUT
 
UINT16
 *
DaByC
)

310 
ARC4_CTX_STRUC
 *
ARC4_CTX
 = 
NULL
;

311 
PUCHAR
 
axt_r
;

312 
UINT16
 
axt_n
;

313 
PUCHAR
 
chxt_r
;

314 
UINT16
 
chxt_n
;

315 
UINT
 
afcs
;

316 
UINT
 
c32
;

318 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
ARC4_CTX
, (
ARC4_CTX_STRUC
));

319 i(
ARC4_CTX
 =
NULL
)

321 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: ARC4_CTX Ao memy fa!!!\n", 
__FUNCTION__
));

322  
FALSE
;

325 i(
pKey
->
KeyL
 == 0)

327 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: Thkey inهvaab !\n", 
__FUNCTION__
));

328  
FALSE
;

332 
	`RTMPInWEnge
(
pDa
,

333 
pKey
->
Key
,

334 
pKey
->
KeyL
,

335 
ARC4_CTX
);

338 
chxt_r
 = 
pDa
 + 
LEN_WEP_IV_HDR
;

339 
chxt_n
 = *
DaByC
 - 
LEN_WEP_IV_HDR
;

343 
	`ARC4_Compu
(
ARC4_CTX
,

344 
chxt_r
,

345 
chxt_n
,

346 
pDa
);

349 
axt_r
 = 
pDa
;

350 
axt_n
 = 
chxt_n
 - 
LEN_ICV
;

353 
	`NdisMoveMemy
(&
afcs
, 
axt_r
 + 
axt_n
, 
LEN_ICV
);

357 
c32
 = 
	`RTMP_CALC_FCS32
(
PPPINITFCS32
, 
axt_r
, 
axt_n
);

358 
c32
 ^= 0xffffffff;

360 if(
c32
 !
	`u232
(
afcs
))

362 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("! WEP Data CRC Error !\n"));

363  
FALSE
;

367 *
DaByC
 = 
axt_n
;

369 i(
ARC4_CTX
 !
NULL
)

370 
	`os__mem
(
NULL
, 
ARC4_CTX
);

372  
TRUE
;

373 
	}
}

	@common/cmm_wpa.c

38 
	~"_cfig.h
"

41 
UCHAR
 
	gOUI_WPA
[3] = {0x00, 0x50, 0xF2};

42 
UCHAR
 
	gOUI_WPA_NONE_AKM
[4] = {0x00, 0x50, 0xF2, 0x00};

43 
UCHAR
 
	gOUI_WPA_VERSION
[4] = {0x00, 0x50, 0xF2, 0x01};

44 
UCHAR
 
	gOUI_WPA_WEP40
[4] = {0x00, 0x50, 0xF2, 0x01};

45 
UCHAR
 
	gOUI_WPA_TKIP
[4] = {0x00, 0x50, 0xF2, 0x02};

46 
UCHAR
 
	gOUI_WPA_CCMP
[4] = {0x00, 0x50, 0xF2, 0x04};

47 
UCHAR
 
	gOUI_WPA_WEP104
[4] = {0x00, 0x50, 0xF2, 0x05};

48 
UCHAR
 
	gOUI_WPA_8021X_AKM
[4] = {0x00, 0x50, 0xF2, 0x01};

49 
UCHAR
 
	gOUI_WPA_PSK_AKM
[4] = {0x00, 0x50, 0xF2, 0x02};

51 
UCHAR
 
	gOUI_WPA2
[3] = {0x00, 0x0F, 0xAC};

52 
UCHAR
 
	gOUI_WPA2_WEP40
[4] = {0x00, 0x0F, 0xAC, 0x01};

53 
UCHAR
 
	gOUI_WPA2_TKIP
[4] = {0x00, 0x0F, 0xAC, 0x02};

54 
UCHAR
 
	gOUI_WPA2_CCMP
[4] = {0x00, 0x0F, 0xAC, 0x04};

55 
UCHAR
 
	gOUI_WPA2_8021X_AKM
[4] = {0x00, 0x0F, 0xAC, 0x01};

56 
UCHAR
 
	gOUI_WPA2_PSK_AKM
[4] = {0x00, 0x0F, 0xAC, 0x02};

57 
UCHAR
 
	gOUI_WPA2_WEP104
[4] = {0x00, 0x0F, 0xAC, 0x05};

61 
VOID
 
CڡruEKeyDa
(

62 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

63 
IN
 
UCHAR
 
GroupKeyWStus
,

64 
IN
 
UCHAR
 
keyDescV
,

65 
IN
 
UCHAR
 
MsgTy
,

66 
IN
 
UCHAR
 
DeuKeyIdx
,

67 
IN
 
UCHAR
 *
GTK
,

68 
IN
 
UCHAR
 *
RSNIE
,

69 
IN
 
UCHAR
 
RSNIE_LEN
,

70 
OUT
 
PEAPOL_PACKET
 
pMsg
);

72 
VOID
 
WEAPPackAi
(

73 
IN
 
PRTMP_ADAPTER
 
pAd
,

74 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

76 
VOID
 
WEAPOLASFA˹Ai
(

77 
IN
 
PRTMP_ADAPTER
 
pAd
,

78 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

80 
VOID
 
WEAPOLLogoffAi
(

81 
IN
 
PRTMP_ADAPTER
 
pAd
,

82 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

84 
VOID
 
WEAPOLSAi
(

85 
IN
 
PRTMP_ADAPTER
 
pAd
,

86 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

88 
VOID
 
WEAPOLKeyAi
(

89 
IN
 
PRTMP_ADAPTER
 
pAd
,

90 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

100 
VOID
 
	$WSMacheIn
(

101 
IN
 
PRTMP_ADAPTER
 
pAd
,

102 
IN
 
STATE_MACHINE
 *
S
,

103 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[])

105 
	`SMacheIn
(
S
, (
STATE_MACHINE_FUNC
 *)
Tns
, 
MAX_WPA_PTK_STATE
, 
MAX_WPA_MSG
, (STATE_MACHINE_FUNC)
Dr
, 
WPA_PTK
, 
WPA_MACHINE_BASE
);

107 
	`SMacheSAi
(
S
, 
WPA_PTK
, 
MT2_EAPPack
, (
STATE_MACHINE_FUNC
)
WEAPPackAi
);

108 
	`SMacheSAi
(
S
, 
WPA_PTK
, 
MT2_EAPOLS
, (
STATE_MACHINE_FUNC
)
WEAPOLSAi
);

109 
	`SMacheSAi
(
S
, 
WPA_PTK
, 
MT2_EAPOLLogoff
, (
STATE_MACHINE_FUNC
)
WEAPOLLogoffAi
);

110 
	`SMacheSAi
(
S
, 
WPA_PTK
, 
MT2_EAPOLKey
, (
STATE_MACHINE_FUNC
)
WEAPOLKeyAi
);

111 
	`SMacheSAi
(
S
, 
WPA_PTK
, 
MT2_EAPOLASFA˹
, (
STATE_MACHINE_FUNC
)
WEAPOLASFA˹Ai
);

112 
	}
}

123 
VOID
 
	$WEAPPackAi
(

124 
IN
 
PRTMP_ADAPTER
 
pAd
,

125 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

127 
	}
}

129 
VOID
 
	$WEAPOLASFA˹Ai
(

130 
IN
 
PRTMP_ADAPTER
 
pAd
,

131 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

133 
	}
}

135 
VOID
 
	$WEAPOLLogoffAi
(

136 
IN
 
PRTMP_ADAPTER
 
pAd
,

137 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

139 
	}
}

148 
VOID
 
	$WEAPOLSAi
(

149 
IN
 
PRTMP_ADAPTER
 
pAd
,

150 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

152 
MAC_TABLE_ENTRY
 *
pEry
;

153 
PHEADER_802_11
 
pHd
;

155 #ifde
CONFIG_STA_SUPPORT


158 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("WpaEAPOLStartAction ===> \n"));

160 
pHd
 = (
PHEADER_802_11
)
Em
->
Msg
;

163 i(
Em
->
MsgL
 == 6)

164 
pEry
 = 
	`MacTabLookup
(
pAd
, 
Em
->
Msg
);

167 
pEry
 = 
	`MacTabLookup
(
pAd
, 
pHd
->
Addr2
);

170 i(
pEry
)

172 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" PtSecud(%d), WS(%d), AuthMode(%d), PMKID_CacheIdx(%d\n", 
pEry
->
PtSecud
,Ery->
WS
,Ery->
AuthMode
,Ery->
PMKID_CacheIdx
));

174 i((
pEry
->
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
)

175 && (
pEry
->
WS
 < 
AS_PTKSTART
)

176 && ((
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPAPSK
|| (pEry->AuthMod=
Ndis802_11AuthModeWPA2PSK
|| (Ery->AuthMod=
Ndis802_11AuthModeWPA2
&& (pEry->
PMKID_CacheIdx
 !
ENTRY_NOT_FOUND
))))

178 
pEry
->
PrivacyFr
 = 
Ndis802_11PrivFr8021xWEP
;

179 
pEry
->
WS
 = 
AS_INITPSK
;

180 
pEry
->
PtSecud
 = 
WPA_802_1X_PORT_NOT_SECURED
;

181 
	`NdisZoMemy
(
pEry
->
R_Cou
, (pEntry->R_Counter));

182 
pEry
->
ReTryCou
 = 
PEER_MSG1_RETRY_TIMER_CTR
;

184 
	`WPAS4WayHS
(
pAd
, 
pEry
, 
PEER_MSG1_RETRY_EXEC_INTV
);

187 
	}
}

202 
VOID
 
	$WEAPOLKeyAi
(

203 
IN
 
PRTMP_ADAPTER
 
pAd
,

204 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

206 
MAC_TABLE_ENTRY
 *
pEry
;

207 
PHEADER_802_11
 
pHd
;

208 
PEAPOL_PACKET
 
pE_ck
;

209 
KEY_INFO
 
KeyInfo
;

210 
UINT
 
p_n
;

212 #ifde
CONFIG_STA_SUPPORT


215 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("WpaEAPOLKeyAction ===>\n"));

217 
pHd
 = (
PHEADER_802_11
)
Em
->
Msg
;

218 
pE_ck
 = (
PEAPOL_PACKET
)&
Em
->
Msg
[
LENGTH_802_11
 + 
LENGTH_802_1_H
];

219 
p_n
 = 
	`CONV_ARRARY_TO_UINT16
(
pE_ck
->
Body_L
+ 
LENGTH_EAPOL_H
;

221 
	`NdisZoMemy
((
PUCHAR
)&
KeyInfo
, (peerKeyInfo));

222 
	`NdisMoveMemy
((
PUCHAR
)&
KeyInfo
, (PUCHAR)&
pE_ck
->
KeyDesc
.
KeyInfo
, (
KEY_INFO
));

225 *((
USHORT
 *)&
KeyInfo

	`u216
(*((USHORT *)&peerKeyInfo));

229 
pEry
 = 
	`MacTabLookup
(
pAd
, 
pHd
->
Addr2
);

231 i(!
pEry
 || (!
	`IS_ENTRY_CLIENT
Ery&& !
	`IS_ENTRY_APCLI
(pEntry)))

234 i(
pEry
->
AuthMode
 < 
Ndis802_11AuthModeWPA
)

237 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ReivEAPoL-Key fmom STA %02X-%02X-%02X-%02X-%02X-%02X\n", 
	`PRINT_MAC
(
pEry
->
Addr
)));

239 i(
p_n
 > 
Em
->
MsgL
 - 
LENGTH_802_11
 - 
LENGTH_802_1_H
)

241 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Theength of EAPoLacket is invalid \n"));

245 i(((
pE_ck
->
ProV
 !
EAPOL_VER
&& (pE_ck->ProV !
EAPOL_VER2
)) ||

246 ((
pE_ck
->
KeyDesc
.
Ty
 !
WPA1_KEY_DESC
&& (pE_ck->KeyDesc.Ty !
WPA2_KEY_DESC
)))

248 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Key descripter doesot match with WPAule\n"));

254 i((
pEry
->
WStus
 =
Ndis802_11Enyi2Ebd
&& (
KeyInfo
.
KeyDescV
 !
KEY_DESC_TKIP
))

256 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Key descripter versionot match(TKIP) \n"));

261 i((
pEry
->
WStus
 =
Ndis802_11Enyi3Ebd
&& (
KeyInfo
.
KeyDescV
 !
KEY_DESC_AES
))

263 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Key descripter versionot match(AES) \n"));

268 i((
pEry
->
S
 =
SST_ASSOC
&& (pEry->
WS
 >
AS_INITPSK
))

274 i(
KeyInfo
.
KeyAck
 == 1)

279 i((
KeyInfo
.
Secu
 =0&& (KeyInfo.
Reque
 == 0) &&

280 (
KeyInfo
.
E
 =0&& (KeyInfo.
KeyTy
 =
PAIRWISEKEY
))

286 i(
KeyInfo
.
KeyMic
 == 0)

287 
	`PrPaMsg1Ai
(
pAd
, 
pEry
, 
Em
);

289 
	`PrPaMsg3Ai
(
pAd
, 
pEry
, 
Em
);

291 i((
KeyInfo
.
Secu
 == 1) &&

292 (
KeyInfo
.
KeyMic
 == 1) &&

293 (
KeyInfo
.
Reque
 == 0) &&

294 (
KeyInfo
.
E
 == 0))

300 i(
KeyInfo
.
KeyTy
 =
PAIRWISEKEY
)

301 
	`PrPaMsg3Ai
(
pAd
, 
pEry
, 
Em
);

303 
	`PrGroupMsg1Ai
(
pAd
, 
pEry
, 
Em
);

310 i((
KeyInfo
.
Reque
 == 0) &&

311 (
KeyInfo
.
E
 == 0) &&

312 (
KeyInfo
.
KeyMic
 == 1))

314 i(
KeyInfo
.
Secu
 =0 &&rKeyInfo.
KeyTy
 =
PAIRWISEKEY
)

319 i(
	`CONV_ARRARY_TO_UINT16
(
pE_ck
->
KeyDesc
.
KeyDaL
) == 0)

321 
	`PrPaMsg4Ai
(
pAd
, 
pEry
, 
Em
);

325 
	`PrPaMsg2Ai
(
pAd
, 
pEry
, 
Em
);

328 i(
KeyInfo
.
Secu
 =1 &&rKeyInfo.
KeyTy
 =
PAIRWISEKEY
)

332 
	`PrPaMsg4Ai
(
pAd
, 
pEry
, 
Em
);

334 i(
KeyInfo
.
Secu
 =1 &&rKeyInfo.
KeyTy
 =
GROUPKEY
)

338 
	`PrGroupMsg2Ai
(
pAd
, 
pEry
, &
Em
->
Msg
[
LENGTH_802_11
], (Em->
MsgL
 - LENGTH_802_11));

343 }
FALSE
);

344 
	}
}

366 
VOID
 
	$RTMPToWessS
(

367 
IN
 
PRTMP_ADAPTER
 
pAd
,

368 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

369 
IN
 
PUCHAR
 
pHd802_3
,

370 
IN
 
UINT
 
HdrL
,

371 
IN
 
PUCHAR
 
pDa
,

372 
IN
 
UINT
 
DaL
,

373 
IN
 
BOOLEAN
 
bCˬFme
)

375 
PNDIS_PACKET
 
pPack
;

376 
NDIS_STATUS
 
Stus
;

378 i((!
pEry
|| (!
	`IS_ENTRY_CLIENT
Ery&& !
	`IS_ENTRY_APCLI
(pEntry)

384 
Stus
 = 
	`RTMPAoNdisPack
(
pAd
, &
pPack
, 
pHd802_3
, 
HdrL
, 
pDa
, 
DaL
);

385 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

389 i(
bCˬFme
)

390 
	`RTMP_SET_PACKET_CLEAR_EAP_FRAME
(
pPack
, 1);

392 
	`RTMP_SET_PACKET_CLEAR_EAP_FRAME
(
pPack
, 0);

394 
	`RTMP_SET_PACKET_SOURCE
(
pPack
, 
PKTSRC_NDIS
);

396 
	`RTMP_SET_PACKET_NET_DEVICE_MBSSID
(
pPack
, 
MAIN_MBSSID
);

397 if(
pEry
->
idx
 != 0)

398 
	`RTMP_SET_PACKET_NET_DEVICE_MBSSID
(
pPack
, 
pEry
->
idx
);

400 
	`RTMP_SET_PACKET_WCID
(
pPack
, (
UCHAR
)
pEry
->
Aid
);

401 
	`RTMP_SET_PACKET_MOREDATA
(
pPack
, 
FALSE
);

404 #ifde
CONFIG_STA_SUPPORT


405 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

408 
Stus
 = 
	`STASdPack
(
pAd
, 
pPack
);

409 i(
Stus
 =
NDIS_STATUS_SUCCESS
)

411 
UCHAR
 
Index
;

418 if((!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
)) &&

419 (!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RESET_IN_PROGRESS
)))

421 
Index
 = 0; Index < 5; Index ++)

422 if(
pAd
->
TxSwQueue
[
Index
].
Numb
 > 0)

423 
	`RTMPDeQueuePack
(
pAd
, 
FALSE
, 
Index
, 
MAX_TX_PROCESS
);

429 } 
FALSE
);

430 
	}
}

441 
BOOLEAN
 
	$PrWMesgeSy
(

442 
IN
 
PRTMP_ADAPTER
 
pAd
,

443 
IN
 
PEAPOL_PACKET
 
pMsg
,

444 
IN
 
ULONG
 
MsgL
,

445 
IN
 
UCHAR
 
MsgTy
,

446 
IN
 
MAC_TABLE_ENTRY
 *
pEry
)

448 
UCHAR
 
mic
[
LEN_KEY_DESC_MIC
], 
dige
[80], 
KEYDATA
[
MAX_LEN_OF_RSNIE
];

449 
BOOLEAN
 
bRyDiff
 = 
FALSE
;

450 
BOOLEAN
 
bWPA2
 = 
FALSE
;

451 
KEY_INFO
 
EKeyInfo
;

452 
UCHAR
 
GroupKeyIndex
 = 0;

455 
	`NdisZoMemy
(
mic
, (mic));

456 
	`NdisZoMemy
(
dige
, (digest));

457 
	`NdisZoMemy
(
KEYDATA
, (KEYDATA));

458 
	`NdisZoMemy
((
PUCHAR
)&
EKeyInfo
, (EapolKeyInfo));

460 
	`NdisMoveMemy
((
PUCHAR
)&
EKeyInfo
, (PUCHAR)&
pMsg
->
KeyDesc
.
KeyInfo
, (
KEY_INFO
));

462 *((
USHORT
 *)&
EKeyInfo

	`u216
(*((USHORT *)&EapolKeyInfo));

465 i((
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2
|| (pEry->AuthMod=
Ndis802_11AuthModeWPA2PSK
))

466 
bWPA2
 = 
TRUE
;

469 i((
MsgTy
 > 
EAPOL_GROUP_MSG_2
|| (MsgTy < 
EAPOL_PAIR_MSG_1
))

471 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Thmesgty ivid(%d)! \n", 
MsgTy
));

472  
FALSE
;

476 i(
MsgTy
 =
EAPOL_PAIR_MSG_1
 || MsgTy =
EAPOL_PAIR_MSG_3
 || MsgTy =
EAPOL_GROUP_MSG_1
)

480 
UCHAR
 
ZoRy
[
LEN_KEY_DESC_REPLAY
];

482 
	`NdisZoMemy
(
ZoRy
, 
LEN_KEY_DESC_REPLAY
);

483 i((
	`RTMPComMemy
(
pMsg
->
KeyDesc
.
RyCou
, 
pEry
->
R_Cou
, 
LEN_KEY_DESC_REPLAY
) != 1) &&

484 (
	`RTMPComMemy
(
pMsg
->
KeyDesc
.
RyCou
, 
ZoRy
, 
LEN_KEY_DESC_REPLAY
) != 0))

486 
bRyDiff
 = 
TRUE
;

489 i(
MsgTy
 =
EAPOL_PAIR_MSG_2
 || MsgTy =
EAPOL_PAIR_MSG_4
 || MsgTy =
EAPOL_GROUP_MSG_2
)

492 i(!
	`NdisEquMemy
(
pMsg
->
KeyDesc
.
RyCou
, 
pEry
->
R_Cou
, 
LEN_KEY_DESC_REPLAY
))

494 
bRyDiff
 = 
TRUE
;

499 i(
bRyDiff
)

502 
	`RTMPSdWessEvt
(
pAd
, 
IW_REPLAY_COUNTER_DIFF_EVENT_FLAG
, 
pEry
->
Addr
,Ery->
idx
, 0);

504 i(
MsgTy
 < 
EAPOL_GROUP_MSG_1
)

506 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Ry Cou Dif iwi msg %d o4-way hdshake!\n", 
MsgTy
));

510 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Ry Cou Dif igroumsg %d o2-way hdshake!\n", (
MsgTy
 - 
EAPOL_PAIR_MSG_4
)));

513 
	`hex_dump
("Reivay cou ", 
pMsg
->
KeyDesc
.
RyCou
, 
LEN_KEY_DESC_REPLAY
);

514 
	`hex_dump
("Cuay cou ", 
pEry
->
R_Cou
, 
LEN_KEY_DESC_REPLAY
);

515  
FALSE
;

519 i(
MsgTy
 !
EAPOL_PAIR_MSG_1
)

521 
UCHAR
 
rcvd_mic
[
LEN_KEY_DESC_MIC
];

522 
UINT
 
p_n
 = 
	`CONV_ARRARY_TO_UINT16
(
pMsg
->
Body_L
) + 4;

525 
	`NdisMoveMemy
(
rcvd_mic
, 
pMsg
->
KeyDesc
.
KeyMic
, 
LEN_KEY_DESC_MIC
);

526 
	`NdisZoMemy
(
pMsg
->
KeyDesc
.
KeyMic
, 
LEN_KEY_DESC_MIC
);

528 i(
EKeyInfo
.
KeyDescV
 =
KEY_DESC_TKIP
)

530 
	`RT_HMAC_MD5
(
pEry
->
PTK
, 
LEN_PTK_KCK
, (
PUCHAR
)
pMsg
, 
p_n
, 
mic
, 
MD5_DIGEST_SIZE
);

532 i(
EKeyInfo
.
KeyDescV
 =
KEY_DESC_AES
)

534 
	`RT_HMAC_SHA1
(
pEry
->
PTK
, 
LEN_PTK_KCK
, (
PUCHAR
)
pMsg
, 
p_n
, 
dige
, 
SHA1_DIGEST_SIZE
);

535 
	`NdisMoveMemy
(
mic
, 
dige
, 
LEN_KEY_DESC_MIC
);

538 i(!
	`NdisEquMemy
(
rcvd_mic
, 
mic
, 
LEN_KEY_DESC_MIC
))

541 
	`RTMPSdWessEvt
(
pAd
, 
IW_MIC_DIFF_EVENT_FLAG
, 
pEry
->
Addr
,Ery->
idx
, 0);

543 i(
MsgTy
 < 
EAPOL_GROUP_MSG_1
)

545 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("MIC Dif iwi msg %d o4-way hdshake!\n", 
MsgTy
));

549 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("MIC Dif igroumsg %d o2-way hdshake!\n", (
MsgTy
 - 
EAPOL_PAIR_MSG_4
)));

552 
	`hex_dump
("Reived MIC", 
rcvd_mic
, 
LEN_KEY_DESC_MIC
);

553 
	`hex_dump
("Desed MIC", 
mic
, 
LEN_KEY_DESC_MIC
);

555  
FALSE
;

563 i(
	`CONV_ARRARY_TO_UINT16
(
pMsg
->
KeyDesc
.
KeyDaL
) > 0)

566 i((
MsgTy
 =
EAPOL_PAIR_MSG_3
 && 
bWPA2
|| (MsgTy =
EAPOL_GROUP_MSG_1
))

569 (
EKeyInfo
.
KeyDescV
 =
KEY_DESC_AES
))

571 
UINT
 
s_unwp_n
 = 0;

574 
	`AES_Key_Unwp
(
pMsg
->
KeyDesc
.
KeyDa
,

575 
	`CONV_ARRARY_TO_UINT16
(
pMsg
->
KeyDesc
.
KeyDaL
),

576 &
pEry
->
PTK
[
LEN_PTK_KCK
], 
LEN_PTK_KEK
,

577 
KEYDATA
, &
s_unwp_n
);

578 
	`SET_UINT16_TO_ARRARY
(
pMsg
->
KeyDesc
.
KeyDaL
, 
s_unwp_n
);

582 
	`TKIP_GTK_KEY_UNWRAP
(&
pEry
->
PTK
[
LEN_PTK_KCK
],

583 
pMsg
->
KeyDesc
.
KeyIv
,

584 
pMsg
->
KeyDesc
.
KeyDa
,

585 
	`CONV_ARRARY_TO_UINT16
(
pMsg
->
KeyDesc
.
KeyDaL
),

586 
KEYDATA
);

589 i(!
bWPA2
 && (
MsgTy
 =
EAPOL_GROUP_MSG_1
))

590 
GroupKeyIndex
 = 
EKeyInfo
.
KeyIndex
;

593 i((
MsgTy
 =
EAPOL_PAIR_MSG_2
|| (MsgTy =
EAPOL_PAIR_MSG_3
 && !
bWPA2
))

595 
	`NdisMoveMemy
(
KEYDATA
, 
pMsg
->
KeyDesc
.
KeyDa
, 
	`CONV_ARRARY_TO_UINT16
Msg->KeyDesc.
KeyDaL
));

600  
TRUE
;

607 i(!
	`RTMPPEKeyDa
(
pAd
, 
KEYDATA
,

608 
	`CONV_ARRARY_TO_UINT16
(
pMsg
->
KeyDesc
.
KeyDaL
),

609 
GroupKeyIndex
, 
MsgTy
, 
bWPA2
, 
pEry
))

611  
FALSE
;

615  
TRUE
;

617 
	}
}

629 
VOID
 
	$WPAS4WayHS
(

630 
IN
 
PRTMP_ADAPTER
 
pAd
,

631 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

632 
IN
 
ULONG
 
TimeIv
)

634 
UCHAR
 
Hd802_3
[14];

635 
UCHAR
 *
mpo
;

636 
PEAPOL_PACKET
 
pEFme
;

637 
PUINT8
 
pBssid
 = 
NULL
;

638 
UCHAR
 
group_ch
 = 
Ndis802_11WEPDibd
;

640 #ifde
CONFIG_STA_SUPPORT


643 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> WPAStart4WayHS\n"));

645 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RESET_IN_PROGRESS
 | 
fRTMP_ADAPTER_HALT_IN_PROGRESS
))

647 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("[ERROR]WPAStart4WayHS : The interface is closed...\n"));

652 i(
pBssid
 =
NULL
)

654 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("[ERROR]WPAStart4WayHS : No corresponding Authenticator.\n"));

659 i((
pEry
->
WS
 > 
AS_PTKSTART
|| (pEry->WS < 
AS_INITPMK
))

661 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("[ERROR]WPAStart4WayHS : Notxpect calling\n"));

667 
	`ADD_ONE_To_64BIT_VAR
(
pEry
->
R_Cou
);

670 
	`GRdom
(
pAd
, (
UCHAR
 *)
pBssid
, 
pEry
->
AN
);

673 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mpo
, 
TX_EAPOL_BUFFER
);

674 i(
mpo
 =
NULL
)

676 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!%:memy!!!\n", 
__FUNCTION__
));

680 
pEFme
 = (
PEAPOL_PACKET
)
mpo
;

681 
	`NdisZoMemy
(
pEFme
, 
TX_EAPOL_BUFFER
);

685 
	`CڡruEMsg
(
pEry
,

686 
group_ch
,

687 
EAPOL_PAIR_MSG_1
,

689 
pEry
->
AN
,

690 
NULL
,

691 
NULL
,

692 
NULL
,

694 
pEFme
);

698 
	`MAKE_802_3_HEADER
(
Hd802_3
, 
pEry
->
Addr
, 
pBssid
, 
EAPOL
);

699 
	`RTMPToWessS
(
pAd
, 
pEry
, 
Hd802_3
,

700 
LENGTH_802_3
, (
PUCHAR
)
pEFme
,

701 
	`CONV_ARRARY_TO_UINT16
(
pEFme
->
Body_L
) + 4,

702 (
pEry
->
PtSecud
 =
WPA_802_1X_PORT_SECURED
? 
FALSE
 : 
TRUE
);

705 
	`RTMPModTim
(&
pEry
->
RryTim
, 
TimeIv
);

708 
pEry
->
WS
 = 
AS_PTKSTART
;

710 
	`os__mem
(
NULL
, 
mpo
);

712 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=== WPAStart4WayHS: send Msg1 of 4-way \n"));

714 
	}
}

733 
VOID
 
	$PrPaMsg1Ai
(

734 
IN
 
PRTMP_ADAPTER
 
pAd
,

735 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

736 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

738 
UCHAR
 
PTK
[80];

739 
UCHAR
 
Hd802_3
[14];

740 
PEAPOL_PACKET
 
pMsg1
;

741 
UINT
 
MsgL
;

742 
UCHAR
 *
mpo
;

743 
PEAPOL_PACKET
 
pEFme
;

744 
PUINT8
 
pCutAddr
 = 
NULL
;

745 
PUINT8
 
pmk_r
 = 
NULL
;

746 
UCHAR
 
group_ch
 = 
Ndis802_11WEPDibd
;

747 
PUINT8
 
r_r
 = 
NULL
;

748 
UCHAR
 
r_n
 = 0;

750 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> PeerPairMsg1Action \n"));

752 i((!
pEry
|| (!
	`IS_ENTRY_CLIENT
Ery&& !
	`IS_ENTRY_APCLI
(pEntry)))

755 i(
Em
->
MsgL
 < (
LENGTH_802_11
 + 
LENGTH_802_1_H
 + 
LENGTH_EAPOL_H
 + 
MIN_LEN_OF_EAPOL_KEY_MSG
))

758 #ifde
CONFIG_STA_SUPPORT


759 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

761 
pCutAddr
 = 
pAd
->
CutAddss
;

762 
pmk_r
 = 
pAd
->
SCfg
.
PMK
;

763 
group_ch
 = 
pAd
->
SCfg
.
GroupCh
;

764 
r_r
 = 
pAd
->
SCfg
.
RSN_IE
;

765 
r_n
 = 
pAd
->
SCfg
.
RSNIE_L
;

770 
pMsg1
 = (
PEAPOL_PACKET
&
Em
->
Msg
[
LENGTH_802_11
 + 
LENGTH_802_1_H
];

771 
MsgL
 = 
Em
->MsgL - 
LENGTH_802_11
 - 
LENGTH_802_1_H
;

774 i(
	`PrWMesgeSy
(
pAd
, 
pMsg1
, 
MsgL
, 
EAPOL_PAIR_MSG_1
, 
pEry
=
FALSE
)

778 
	`NdisMoveMemy
(
pEry
->
R_Cou
, 
pMsg1
->
KeyDesc
.
RyCou
, 
LEN_KEY_DESC_REPLAY
);

781 
	`NdisMoveMemy
(
pEry
->
AN
, 
pMsg1
->
KeyDesc
.
KeyN
, 
LEN_KEY_DESC_NONCE
);

784 
	`GRdom
(
pAd
, (
UCHAR
 *)
pCutAddr
, 
pEry
->
SN
);

788 
	`WDivePTK
(
pAd
,

789 
pmk_r
,

790 
pEry
->
AN
,

791 
pEry
->
Addr
,

792 
pEry
->
SN
,

793 
pCutAddr
,

794 
PTK
,

795 
LEN_PTK
);

798 
	`NdisMoveMemy
(
pEry
->
PTK
, PTK, 
LEN_PTK
);

802 
pEry
->
WS
 = 
AS_PTKINIT_NEGOTIATING
;

805 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mpo
, 
TX_EAPOL_BUFFER
);

806 i(
mpo
 =
NULL
)

808 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!%:memy!!!\n", 
__FUNCTION__
));

812 
pEFme
 = (
PEAPOL_PACKET
)
mpo
;

813 
	`NdisZoMemy
(
pEFme
, 
TX_EAPOL_BUFFER
);

817 
	`CڡruEMsg
(
pEry
,

818 
group_ch
,

819 
EAPOL_PAIR_MSG_2
,

821 
pEry
->
SN
,

822 
NULL
,

823 
NULL
,

824 (
UCHAR
 *)
r_r
,

825 
r_n
,

826 
pEFme
);

829 
	`MAKE_802_3_HEADER
(
Hd802_3
, 
pEry
->
Addr
, 
pCutAddr
, 
EAPOL
);

831 
	`RTMPToWessS
(
pAd
, 
pEry
,

832 
Hd802_3
, (Hd802_3), (
PUCHAR
)
pEFme
,

833 
	`CONV_ARRARY_TO_UINT16
(
pEFme
->
Body_L
+ 4, 
TRUE
);

835 
	`os__mem
(
NULL
, 
mpo
);

837 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=== PeerPairMsg1Action: send Msg2 of 4-way \n"));

838 
	}
}

848 
VOID
 
	$PrPaMsg2Ai
(

849 
IN
 
PRTMP_ADAPTER
 
pAd
,

850 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

851 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

853 
UCHAR
 
PTK
[80];

854 
BOOLEAN
 
Ced
;

855 
PHEADER_802_11
 
pHd
;

856 
UCHAR
 *
mpo
;

857 
PEAPOL_PACKET
 
pEFme
;

858 
PEAPOL_PACKET
 
pMsg2
;

859 
UINT
 
MsgL
;

860 
UCHAR
 
Hd802_3
[
LENGTH_802_3
];

861 
UCHAR
 
TxTsc
[6];

862 
PUINT8
 
pBssid
 = 
NULL
;

863 
PUINT8
 
pmk_r
 = 
NULL
;

864 
PUINT8
 
gtk_r
 = 
NULL
;

865 
UCHAR
 
deu_key
 = 0;

866 
UCHAR
 
group_ch
 = 
Ndis802_11WEPDibd
;

867 
PUINT8
 
r_r
 = 
NULL
;

868 
UCHAR
 
r_n
 = 0;

870 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> PeerPairMsg2Action \n"));

872 i((!
pEry
|| !
	`IS_ENTRY_CLIENT
(pEntry))

875 i(
Em
->
MsgL
 < (
LENGTH_802_11
 + 
LENGTH_802_1_H
 + 
LENGTH_EAPOL_H
 + 
MIN_LEN_OF_EAPOL_KEY_MSG
))

879 i(
pEry
->
WS
 < 
AS_PTKSTART
)

885 
pHd
 = (
PHEADER_802_11
)
Em
->
Msg
;

888 
pMsg2
 = (
PEAPOL_PACKET
)&
Em
->
Msg
[
LENGTH_802_11
 + 
LENGTH_802_1_H
];

889 
MsgL
 = 
Em
->MsgL - 
LENGTH_802_11
 - 
LENGTH_802_1_H
;

892 
	`NdisMoveMemy
(
pEry
->
SN
, 
pMsg2
->
KeyDesc
.
KeyN
, 
LEN_KEY_DESC_NONCE
);

896 
	`WDivePTK
(
pAd
,

897 (
UCHAR
 *)
pmk_r
,

898 
pEry
->
AN
,

899 (
UCHAR
 *)
pBssid
,

900 
pEry
->
SN
,

901 
pEry
->
Addr
,

902 
PTK
,

903 
LEN_PTK
);

905 
	`NdisMoveMemy
(
pEry
->
PTK
, PTK, 
LEN_PTK
);

909 i(
	`PrWMesgeSy
(
pAd
, 
pMsg2
, 
MsgL
, 
EAPOL_PAIR_MSG_2
, 
pEry
=
FALSE
)

915 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mpo
, 
TX_EAPOL_BUFFER
);

916 i(
mpo
 =
NULL
)

918 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!%:memy!!!\n", 
__FUNCTION__
));

922 
pEFme
 = (
PEAPOL_PACKET
)
mpo
;

923 
	`NdisZoMemy
(
pEFme
, 
TX_EAPOL_BUFFER
);

926 
	`RTMPClTim
(&
pEry
->
RryTim
, &
Ced
);

929 
pEry
->
WS
 = 
AS_PTKINIT_NEGOTIATING
;

932 
	`ADD_ONE_To_64BIT_VAR
(
pEry
->
R_Cou
);

935 
	`CڡruEMsg
(
pEry
,

936 
group_ch
,

937 
EAPOL_PAIR_MSG_3
,

938 
deu_key
,

939 
pEry
->
AN
,

940 
TxTsc
,

941 (
UCHAR
 *)
gtk_r
,

942 (
UCHAR
 *)
r_r
,

943 
r_n
,

944 
pEFme
);

947 
	`MAKE_802_3_HEADER
(
Hd802_3
, 
pEry
->
Addr
, 
pBssid
, 
EAPOL
);

948 
	`RTMPToWessS
(
pAd
, 
pEry
, 
Hd802_3
, 
LENGTH_802_3
,

949 (
PUCHAR
)
pEFme
,

950 
	`CONV_ARRARY_TO_UINT16
(
pEFme
->
Body_L
) + 4,

951 (
pEry
->
PtSecud
 =
WPA_802_1X_PORT_SECURED
? 
FALSE
 : 
TRUE
);

953 
pEry
->
ReTryCou
 = 
PEER_MSG3_RETRY_TIMER_CTR
;

954 
	`RTMPSTim
(&
pEry
->
RryTim
, 
PEER_MSG3_RETRY_EXEC_INTV
);

957 
pEry
->
WS
 = 
AS_PTKINIT_NEGOTIATING
;

959 
	`os__mem
(
NULL
, 
mpo
);

961 }
FALSE
);

963 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=== PeerPairMsg2Action: send Msg3 of 4-way \n"));

964 
	}
}

983 
VOID
 
	$PrPaMsg3Ai
(

984 
IN
 
PRTMP_ADAPTER
 
pAd
,

985 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

986 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

988 
PHEADER_802_11
 
pHd
;

989 
UCHAR
 
Hd802_3
[14];

990 
UCHAR
 *
mpo
;

991 
PEAPOL_PACKET
 
pEFme
;

992 
PEAPOL_PACKET
 
pMsg3
;

993 
UINT
 
MsgL
;

994 
PUINT8
 
pCutAddr
 = 
NULL
;

995 
UCHAR
 
group_ch
 = 
Ndis802_11WEPDibd
;

997 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> PeerPairMsg3Action \n"));

999 i((!
pEry
|| (!
	`IS_ENTRY_CLIENT
Ery&& !
	`IS_ENTRY_APCLI
(pEntry)))

1002 i(
Em
->
MsgL
 < (
LENGTH_802_11
 + 
LENGTH_802_1_H
 + 
LENGTH_EAPOL_H
 + 
MIN_LEN_OF_EAPOL_KEY_MSG
))

1005 #ifde
CONFIG_STA_SUPPORT


1006 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1008 
pCutAddr
 = 
pAd
->
CutAddss
;

1009 
group_ch
 = 
pAd
->
SCfg
.
GroupCh
;

1015 
pHd
 = (
PHEADER_802_11

Em
->
Msg
;

1016 
pMsg3
 = (
PEAPOL_PACKET
&
Em
->
Msg
[
LENGTH_802_11
 + 
LENGTH_802_1_H
];

1017 
MsgL
 = 
Em
->MsgL - 
LENGTH_802_11
 - 
LENGTH_802_1_H
;

1020 i(
	`PrWMesgeSy
(
pAd
, 
pMsg3
, 
MsgL
, 
EAPOL_PAIR_MSG_3
, 
pEry
=
FALSE
)

1024 
	`NdisMoveMemy
(
pEry
->
R_Cou
, 
pMsg3
->
KeyDesc
.
RyCou
, 
LEN_KEY_DESC_REPLAY
);

1027 i(!
	`NdisEquMemy
(
pEry
->
AN
, 
pMsg3
->
KeyDesc
.
KeyN
, 
LEN_KEY_DESC_NONCE
))

1033 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mpo
, 
TX_EAPOL_BUFFER
);

1034 i(
mpo
 =
NULL
)

1036 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!%:memy!!!\n", 
__FUNCTION__
));

1040 
pEFme
 = (
PEAPOL_PACKET
)
mpo
;

1041 
	`NdisZoMemy
(
pEFme
, 
TX_EAPOL_BUFFER
);

1044 
	`CڡruEMsg
(
pEry
,

1045 
group_ch
,

1046 
EAPOL_PAIR_MSG_4
,

1048 
NULL
,

1049 
NULL
,

1050 
NULL
,

1051 
NULL
,

1053 
pEFme
);

1056 
pEry
->
WS
 = 
AS_PTKINITDONE
;

1059 #ifde
CONFIG_STA_SUPPORT


1060 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1062 
	`NdisMoveMemy
(
pAd
->
SCfg
.
PTK
, 
pEry
->PTK, 
LEN_PTK
);

1063 
	`WPAInlPawiKey
(
pAd
,

1064 
BSS0
,

1065 
pEry
,

1066 
FALSE
);

1067 
	`NdisMoveMemy
(&
pAd
->
ShedKey
[
BSS0
][0], &
pEry
->
PawiKey
, (
CIPHER_KEY
));

1072 i(
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
 ||

1073 
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2
)

1075 
pEry
->
PtSecud
 = 
WPA_802_1X_PORT_SECURED
;

1076 
pEry
->
PrivacyFr
 = 
Ndis802_11PrivFrAcA
;

1078 #ifde
CONFIG_STA_SUPPORT


1079 
	`STA_PORT_SECURED
(
pAd
);

1081 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerPairMsg3Action: AuthMode(%s) PairwiseCipher(%s) GroupCipher(%s) \n",

1082 
	`GAuthMode
(
pEry
->
AuthMode
),

1083 
	`GEnyTy
(
pEry
->
WStus
),

1084 
	`GEnyTy
(
group_ch
)));

1091 
	`MAKE_802_3_HEADER
(
Hd802_3
, 
pEry
->
Addr
, 
pCutAddr
, 
EAPOL
);

1092 
	`RTMPToWessS
(
pAd
, 
pEry
,

1093 
Hd802_3
, (Header802_3),

1094 (
PUCHAR
)
pEFme
,

1095 
	`CONV_ARRARY_TO_UINT16
(
pEFme
->
Body_L
+ 4, 
TRUE
);

1097 
	`os__mem
(
NULL
, 
mpo
);

1099 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=== PeerPairMsg3Action: send Msg4 of 4-way \n"));

1100 
	}
}

1110 
VOID
 
	$PrPaMsg4Ai
(

1111 
IN
 
PRTMP_ADAPTER
 
pAd
,

1112 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

1113 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1115 
PEAPOL_PACKET
 
pMsg4
;

1116 
PHEADER_802_11
 
pHd
;

1117 
UINT
 
MsgL
;

1118 
BOOLEAN
 
Ced
;

1119 
UCHAR
 
group_ch
 = 
Ndis802_11WEPDibd
;

1121 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> PeerPairMsg4Action\n"));

1125 i((!
pEry
|| !
	`IS_ENTRY_CLIENT
(pEntry))

1128 i(
Em
->
MsgL
 < (
LENGTH_802_11
 + 
LENGTH_802_1_H
 + 
LENGTH_EAPOL_H
 + 
MIN_LEN_OF_EAPOL_KEY_MSG
 ) )

1131 i(
pEry
->
WS
 < 
AS_PTKINIT_NEGOTIATING
)

1136 
pHd
 = (
PHEADER_802_11
)
Em
->
Msg
;

1139 
pMsg4
 = (
PEAPOL_PACKET
)&
Em
->
Msg
[
LENGTH_802_11
 + 
LENGTH_802_1_H
];

1140 
MsgL
 = 
Em
->MsgL - 
LENGTH_802_11
 - 
LENGTH_802_1_H
;

1143 i(
	`PrWMesgeSy
(
pAd
, 
pMsg4
, 
MsgL
, 
EAPOL_PAIR_MSG_4
, 
pEry
=
FALSE
)

1147 
	`WPAInlPawiKey
(
pAd
, 
pEry
->
idx
,Ery, 
TRUE
);

1150 
pEry
->
PrivacyFr
 = 
Ndis802_11PrivFrAcA
;

1151 
pEry
->
WS
 = 
AS_PTKINITDONE
;

1152 
pEry
->
PtSecud
 = 
WPA_802_1X_PORT_SECURED
;

1155 i(
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2
 ||

1156 
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
)

1158 
pEry
->
GTKS
 = 
REKEY_ESTABLISHED
;

1159 
	`RTMPClTim
(&
pEry
->
RryTim
, &
Ced
);

1163 
	`RTMPSdWessEvt
(
pAd
, 
IW_SET_KEY_DONE_WPA2_EVENT_FLAG
, 
pEry
->
Addr
,Ery->
idx
, 0);

1165 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("AP SETKEYS DONE - WPA2, AuthMode(%d)=%s, WepStatus(%d)=%s, GroupWepStatus(%d)=%s\n\n",

1166 
pEry
->
AuthMode
, 
	`GAuthMode
(pEntry->AuthMode),

1167 
pEry
->
WStus
, 
	`GEnyTy
(pEntry->WepStatus),

1168 
group_ch
,

1169 
	`GEnyTy
(
group_ch
)));

1174 
	`WPAS2WayGroupHS
(
pAd
, 
pEry
);

1176 
pEry
->
ReTryCou
 = 
GROUP_MSG1_RETRY_TIMER_CTR
;

1177 
	`RTMPModTim
(&
pEry
->
RryTim
, 
PEER_MSG3_RETRY_EXEC_INTV
);

1179 }
FALSE
);

1181 
	}
}

1191 
VOID
 
	$WPAS2WayGroupHS
(

1192 
IN
 
PRTMP_ADAPTER
 
pAd
,

1193 
IN
 
MAC_TABLE_ENTRY
 *
pEry
)

1195 
UCHAR
 
Hd802_3
[14];

1196 
UCHAR
 
TxTsc
[6];

1197 
UCHAR
 *
mpo
;

1198 
PEAPOL_PACKET
 
pEFme
;

1199 
UCHAR
 
group_ch
 = 
Ndis802_11WEPDibd
;

1200 
UCHAR
 
deu_key
 = 0;

1201 
PUINT8
 
gn_r
 = 
NULL
;

1202 
PUINT8
 
gtk_r
 = 
NULL
;

1203 
PUINT8
 
pBssid
 = 
NULL
;

1205 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> WPAStart2WayGroupHS\n"));

1207 i((!
pEry
|| !
	`IS_ENTRY_CLIENT
(pEntry))

1212 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mpo
, 
TX_EAPOL_BUFFER
);

1213 i(
mpo
 =
NULL
)

1215 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!%:memy!!!\n", 
__FUNCTION__
));

1219 
pEFme
 = (
PEAPOL_PACKET
)
mpo
;

1220 
	`NdisZoMemy
(
pEFme
, 
TX_EAPOL_BUFFER
);

1223 
	`ADD_ONE_To_64BIT_VAR
(
pEry
->
R_Cou
);

1226 
	`CڡruEMsg
(
pEry
,

1227 
group_ch
,

1228 
EAPOL_GROUP_MSG_1
,

1229 
deu_key
,

1230 (
UCHAR
 *)
gn_r
,

1231 
TxTsc
,

1232 (
UCHAR
 *)
gtk_r
,

1233 
NULL
,

1235 
pEFme
);

1238 
	`MAKE_802_3_HEADER
(
Hd802_3
, 
pEry
->
Addr
, 
pBssid
, 
EAPOL
);

1239 
	`RTMPToWessS
(
pAd
, 
pEry
,

1240 
Hd802_3
, 
LENGTH_802_3
,

1241 (
PUCHAR
)
pEFme
,

1242 
	`CONV_ARRARY_TO_UINT16
(
pEFme
->
Body_L
+ 4, 
FALSE
);

1244 
	`os__mem
(
NULL
, 
mpo
);

1246 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=== WPAStart2WayGroupHS : send out Group Message 1 \n"));

1249 
	}
}

1268 
VOID
 
	$PrGroupMsg1Ai
(

1269 
IN
 
PRTMP_ADAPTER
 
pAd
,

1270 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

1271 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1273 
UCHAR
 
Hd802_3
[14];

1274 
UCHAR
 *
mpo
;

1275 
PEAPOL_PACKET
 
pEFme
;

1276 
PEAPOL_PACKET
 
pGroup
;

1277 
UINT
 
MsgL
;

1278 
UCHAR
 
deu_key
 = 0;

1279 
UCHAR
 
group_ch
 = 
Ndis802_11WEPDibd
;

1280 
PUINT8
 
pCutAddr
 = 
NULL
;

1282 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> PeerGroupMsg1Action \n"));

1284 i((!
pEry
|| (!
	`IS_ENTRY_CLIENT
Ery&& !
	`IS_ENTRY_APCLI
(pEntry)))

1287 #ifde
CONFIG_STA_SUPPORT


1288 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1290 
pCutAddr
 = 
pAd
->
CutAddss
;

1291 
group_ch
 = 
pAd
->
SCfg
.
GroupCh
;

1292 
deu_key
 = 
pAd
->
SCfg
.
DeuKeyId
;

1297 
pGroup
 = (
PEAPOL_PACKET
&
Em
->
Msg
[
LENGTH_802_11
 + 
LENGTH_802_1_H
];

1298 
MsgL
 = 
Em
->MsgL - 
LENGTH_802_11
 - 
LENGTH_802_1_H
;

1301 i(
	`PrWMesgeSy
(
pAd
, 
pGroup
, 
MsgL
, 
EAPOL_GROUP_MSG_1
, 
pEry
=
FALSE
)

1307 
	`NdisMoveMemy
(
pEry
->
R_Cou
, 
pGroup
->
KeyDesc
.
RyCou
, 
LEN_KEY_DESC_REPLAY
);

1310 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mpo
, 
TX_EAPOL_BUFFER
);

1311 i(
mpo
 =
NULL
)

1313 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!%:memy!!!\n", 
__FUNCTION__
));

1317 
pEFme
 = (
PEAPOL_PACKET
)
mpo
;

1318 
	`NdisZoMemy
(
pEFme
, 
TX_EAPOL_BUFFER
);

1322 
	`CڡruEMsg
(
pEry
,

1323 
group_ch
,

1324 
EAPOL_GROUP_MSG_2
,

1325 
deu_key
,

1326 
NULL
,

1327 
NULL
,

1328 
NULL
,

1329 
NULL
,

1331 
pEFme
);

1334 
pEry
->
PtSecud
 = 
WPA_802_1X_PORT_SECURED
;

1335 
pEry
->
PrivacyFr
 = 
Ndis802_11PrivFrAcA
;

1337 #ifde
CONFIG_STA_SUPPORT


1338 
	`STA_PORT_SECURED
(
pAd
);

1341 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerGroupMsg1Action: AuthMode(%s) PairwiseCipher(%s) GroupCipher(%s) \n",

1342 
	`GAuthMode
(
pEry
->
AuthMode
),

1343 
	`GEnyTy
(
pEry
->
WStus
),

1344 
	`GEnyTy
(
group_ch
)));

1347 
	`MAKE_802_3_HEADER
(
Hd802_3
, 
pEry
->
Addr
, 
pCutAddr
, 
EAPOL
);

1349 #ifde
CONFIG_STA_SUPPORT


1350 i((
pAd
->
OpMode
 =
OPMODE_STA
&& 
	`INFRA_ON
(pAd) &&

1351 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
) &&

1352 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
) &&

1353 (
pAd
->
MlmeAux
.
Chl
 =pAd->
CommCfg
.Channel))

1356 
pAd
->
MlmeAux
.
Chl
 = 0;

1360 
	`RTMPToWessS
(
pAd
, 
pEry
,

1361 
Hd802_3
, (Header802_3),

1362 (
PUCHAR
)
pEFme
,

1363 
	`CONV_ARRARY_TO_UINT16
(
pEFme
->
Body_L
+ 4, 
FALSE
);

1365 
	`os__mem
(
NULL
, 
mpo
);

1367 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=== PeerGroupMsg1Action: send group message 2\n"));

1368 
	}
}

1371 
VOID
 
	$EnqueueSFPSKExec
(

1372 
IN
 
PVOID
 
SyemScific1
,

1373 
IN
 
PVOID
 
FuniCڋxt
,

1374 
IN
 
PVOID
 
SyemScific2
,

1375 
IN
 
PVOID
 
SyemScific3
)

1377 
MAC_TABLE_ENTRY
 *
pEry
 = (
PMAC_TABLE_ENTRY

FuniCڋxt
;

1379 i((
pEry
&& 
	`IS_ENTRY_CLIENT
Ery&& (pEry->
WS
 < 
AS_PTKSTART
))

1381 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pEry
->pAd;

1383 
pEry
->
EnqueueESTimRug
)

1385 
EAPOL_START_PSK
:

1386 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("EnqueuEAPoL-S-PSK f s(%02x:%02x:%02x:%02x:%02x:%02x\n", 
	`PRINT_MAC
(
pEry
->
Addr
)));

1388 
	`MlmeEnqueue
(
pAd
, 
WPA_STATE_MACHINE
, 
MT2_EAPOLS
, 6, &
pEry
->
Addr
, 0);

1395 
pEry
->
EnqueueESTimRug
 = 
EAPOL_START_DISABLE
;

1397 
	}
}

1400 
VOID
 
	$MlmeDeAuthAi
(

1401 
IN
 
PRTMP_ADAPTER
 
pAd
,

1402 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

1403 
IN
 
USHORT
 
Rs
,

1404 
IN
 
BOOLEAN
 
bDaFmeF
)

1406 
PUCHAR
 
pOutBufr
 = 
NULL
;

1407 
ULONG
 
FmeL
 = 0;

1408 
HEADER_802_11
 
DeAuthHdr
;

1409 
NDIS_STATUS
 
NStus
;

1411 i(
pEry
)

1414 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

1415 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

1419 
	`RTMPSdWessEvt
(
pAd
, 
IW_DEAUTH_EVENT_FLAG
, 
pEry
->
Addr
,Ery->
idx
, 0);

1421 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Sd DEAUTH fmwh RsCode(%dt%02x:%02x:%02x:%02x:%02x:%02x \n",
Rs
, 
	`PRINT_MAC
(
pEry
->
Addr
)));

1423 #ifde
CONFIG_STA_SUPPORT


1424 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1426 
	`MgtMacHdIn
(
pAd
, &
DeAuthHdr
, 
SUBTYPE_DEAUTH
, 0, 
pEry
->
Addr
,Ad->
CommCfg
.
Bssid
);

1429 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1430 (
HEADER_802_11
), &
DeAuthHdr
,

1431 2, &
Rs
,

1432 
END_OF_ARGS
);

1436 i(
bDaFmeF
)

1437 
	`MtMMReque
(
pAd
, 
MGMT_USE_QUEUE_FLAG
, 
pOutBufr
, 
FmeL
);

1439 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

1440 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1443 
	`MacTabDeEry
(
pAd
, 
pEry
->
Aid
,Ery->
Addr
);

1445 
	}
}

1455 
VOID
 
	$PrGroupMsg2Ai
(

1456 
IN
 
PRTMP_ADAPTER
 
pAd
,

1457 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

1458 
IN
 
VOID
 *
Msg
,

1459 
IN
 
UINT
 
MsgL
)

1461 
UINT
 
L
;

1462 
PUCHAR
 
pDa
;

1463 
BOOLEAN
 
Ced
;

1464 
PEAPOL_PACKET
 
pMsg2
;

1465 
UCHAR
 
group_ch
 = 
Ndis802_11WEPDibd
;

1467 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> PeerGroupMsg2Action \n"));

1469 i((!
pEry
|| !
	`IS_ENTRY_CLIENT
(pEntry))

1472 i(
MsgL
 < (
LENGTH_802_1_H
 + 
LENGTH_EAPOL_H
 + 
MIN_LEN_OF_EAPOL_KEY_MSG
))

1475 i(
pEry
->
WS
 !
AS_PTKINITDONE
)

1483 
pDa
 = (
PUCHAR
)
Msg
;

1484 
pMsg2
 = (
PEAPOL_PACKET
(
pDa
 + 
LENGTH_802_1_H
);

1485 
L
 = 
MsgL
 - 
LENGTH_802_1_H
;

1488 i(
	`PrWMesgeSy
(
pAd
, 
pMsg2
, 
L
, 
EAPOL_GROUP_MSG_2
, 
pEry
=
FALSE
)

1493 
	`RTMPClTim
(&
pEry
->
RryTim
, &
Ced
);

1494 
pEry
->
GTKS
 = 
REKEY_ESTABLISHED
;

1496 i((
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2
|| (pEry->AuthMod=
Ndis802_11AuthModeWPA2PSK
))

1499 
	`RTMPSdWessEvt
(
pAd
, 
IW_SET_KEY_DONE_WPA2_EVENT_FLAG
, 
pEry
->
Addr
,Ery->
idx
, 0);

1501 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("AP SETKEYS DONE - WPA2, AuthMode(%d)=%s, WepStatus(%d)=%s, GroupWepStatus(%d)=%s\n\n",

1502 
pEry
->
AuthMode
, 
	`GAuthMode
(pEntry->AuthMode),

1503 
pEry
->
WStus
, 
	`GEnyTy
(pEntry->WepStatus),

1504 
group_ch
, 
	`GEnyTy
(group_cipher)));

1509 
	`RTMPSdWessEvt
(
pAd
, 
IW_SET_KEY_DONE_WPA1_EVENT_FLAG
, 
pEry
->
Addr
,Ery->
idx
, 0);

1511 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("AP SETKEYS DONE - WPA1, AuthMode(%d)=%s, WepStatus(%d)=%s, GroupWepStatus(%d)=%s\n\n",

1512 
pEry
->
AuthMode
, 
	`GAuthMode
(pEntry->AuthMode),

1513 
pEry
->
WStus
, 
	`GEnyTy
(pEntry->WepStatus),

1514 
group_ch
, 
	`GEnyTy
(group_cipher)));

1516 }
FALSE
);

1517 
	}
}

1541 
BOOLEAN
 
	$WMsgTySub
(

1542 
IN
 
UCHAR
 
EAPTy
,

1543 
OUT
 
INT
 *
MsgTy
)

1545 
EAPTy
)

1547 
EAPPack
:

1548 *
MsgTy
 = 
MT2_EAPPack
;

1550 
EAPOLS
:

1551 *
MsgTy
 = 
MT2_EAPOLS
;

1553 
EAPOLLogoff
:

1554 *
MsgTy
 = 
MT2_EAPOLLogoff
;

1556 
EAPOLKey
:

1557 *
MsgTy
 = 
MT2_EAPOLKey
;

1559 
EAPOLASFA˹
:

1560 *
MsgTy
 = 
MT2_EAPOLASFA˹
;

1563  
FALSE
;

1565  
TRUE
;

1566 
	}
}

1577 
	$c_iv_by
(
UCHAR
 *
iv
, 
UINT
 
n
, UINT 
t
)

1579 
pos
 = 0;

1580 
y
 = 0;

1581 
UCHAR
 
e_iv
;

1583 
pos
 < 
n
)

1585 
e_iv
 = 
iv
[
pos
];

1587 i(
y
 == 1)

1588 
iv
[
pos
] ++;

1590 
iv
[
pos
] +
t
;

1592 i(
iv
[
pos
] > 
e_iv
)

1595 
y
 = 1;

1596 
pos
++;

1599 i(
pos
 >
n
)

1600 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("!!! inc_iv_byte overflow !!!\n"));

1601 
	}
}

1632 
VOID
 
	$PRF
(

1633 
IN
 
UCHAR
 *
key
,

1634 
IN
 
INT
 
key_n
,

1635 
IN
 
UCHAR
 *
efix
,

1636 
IN
 
INT
 
efix_n
,

1637 
IN
 
UCHAR
 *
da
,

1638 
IN
 
INT
 
da_n
,

1639 
OUT
 
UCHAR
 *
ouut
,

1640 
IN
 
INT
 
n
)

1642 
INT
 
i
;

1643 
UCHAR
 *
put
;

1644 
INT
 
cutdex
 = 0;

1645 
INT
 
tٮ_n
;

1648 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
put
, 1024);

1650 i(
put
 =
NULL
)

1652 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!PRF:o memory!!!\n"));

1657 
	`NdisMoveMemy
(
put
, 
efix
, 
efix_n
);

1660 
put
[
efix_n
] = 0;

1663 
	`NdisMoveMemy
(&
put
[
efix_n
 + 1], 
da
, 
da_n
);

1664 
tٮ_n
 = 
efix_n
 + 1 + 
da_n
;

1668 
put
[
tٮ_n
] = 0;

1669 
tٮ_n
++;

1673 
i
 = 0; i < (
n
 + 19) / 20; i++)

1675 
	`RT_HMAC_SHA1
(
key
, 
key_n
, 
put
, 
tٮ_n
, &
ouut
[
cutdex
], 
SHA1_DIGEST_SIZE
);

1676 
cutdex
 += 20;

1679 
put
[
tٮ_n
 - 1]++;

1681 
	`os__mem
(
NULL
, 
put
);

1682 
	}
}

1691 
	$F
(*
sswd
, *
ssid
, 
ssidngth
, 
is
, 
cou
, *
ouut
)

1693 
dige
[36], 
dige1
[
SHA1_DIGEST_SIZE
];

1694 
i
, 
j
, 
n
;

1696 
n
 = 
	`
(
sswd
);

1699 
	`memy
(
dige
, 
ssid
, 
ssidngth
);

1700 
dige
[
ssidngth
] = ()((
cou
>>24) & 0xff);

1701 
dige
[
ssidngth
+1] = ()((
cou
>>16) & 0xff);

1702 
dige
[
ssidngth
+2] = ()((
cou
>>8) & 0xff);

1703 
dige
[
ssidngth
+3] = ()(
cou
 & 0xff);

1704 
	`RT_HMAC_SHA1
((*
sswd
, 
n
, 
dige
, 
ssidngth
+4, 
dige1
, 
SHA1_DIGEST_SIZE
);

1707 
	`memy
(
ouut
, 
dige1
, 
SHA1_DIGEST_SIZE
);

1708 
i
 = 1; i < 
is
; i++)

1712 
	`RT_HMAC_SHA1
((*
sswd
, 
n
, 
dige1
, 
SHA1_DIGEST_SIZE
, 
dige
, SHA1_DIGEST_SIZE);

1713 
	`memy
(
dige1
, 
dige
, 
SHA1_DIGEST_SIZE
);

1716 
j
 = 0; j < 
SHA1_DIGEST_SIZE
; j++)

1718 
ouut
[
j
] ^
dige
[j];

1721 
	}
}

1729 
	$RtmpPasswdHash
(
PSTRING
 
sswd
, 
PUCHAR
 
ssid
, 
INT
 
ssidngth
, PUCHAR 
ouut
)

1731 i((
	`
(
sswd
> 63|| (
ssidngth
 > 32))

1734 
	`F
(
sswd
, 
ssid
, 
ssidngth
, 4096, 1, 
ouut
);

1735 
	`F
(
sswd
, 
ssid
, 
ssidngth
, 4096, 2, &
ouut
[
SHA1_DIGEST_SIZE
]);

1737 
	}
}

1768 
VOID
 
	$KDF
(

1769 
IN
 
PUINT8
 
key
,

1770 
IN
 
INT
 
key_n
,

1771 
IN
 
PUINT8
 
b
,

1772 
IN
 
INT
 
b_n
,

1773 
IN
 
PUINT8
 
da
,

1774 
IN
 
INT
 
da_n
,

1775 
OUT
 
PUINT8
 
ouut
,

1776 
IN
 
USHORT
 
n
)

1778 
USHORT
 
i
;

1779 
UCHAR
 *
put
;

1780 
INT
 
cutdex
 = 0;

1781 
INT
 
tٮ_n
;

1782 
UINT
 
n__bs
 = (
n
 << 3);

1784 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
put
, 1024);

1786 i(
put
 =
NULL
)

1788 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!KDF:o memory!!!\n"));

1792 
	`NdisZoMemy
(
put
, 1024);

1796 
put
[0] = 1;

1797 
put
[1] = 0;

1798 
tٮ_n
 = 2;

1801 
	`NdisMoveMemy
(&
put
[
tٮ_n
], 
b
, 
b_n
);

1802 
tٮ_n
 +
b_n
;

1805 
	`NdisMoveMemy
(&
put
[
tٮ_n
], 
da
, 
da_n
);

1806 
tٮ_n
 +
da_n
;

1809 
put
[
tٮ_n
] = (
n__bs
 & 0xFF);

1810 
put
[
tٮ_n
 + 1] = (
n__bs
 & 0xFF00) >> 8;

1811 
tٮ_n
 += 2;

1813 
i
 = 1; i <((
n__bs
 + 255) / 256); i++)

1816 
	`RT_HMAC_SHA256
((
UCHAR
 *)
key
, 
key_n
, 
put
, 
tٮ_n
, (UCHAR *)&
ouut
[
cutdex
], 32);

1818 
cutdex
 += 32;

1819 
put
[0]++;

1822 
	`os__mem
(
NULL
, 
put
);

1823 
	}
}

1838 
VOID
 
	$RTMPDivePMKID
(

1839 
IN
 
PUINT8
 
pAaddr
,

1840 
IN
 
PUINT8
 
pSddr
,

1841 
IN
 
PUINT8
 
pKey
,

1842 
IN
 
PUINT8
 
pAkm_oui
,

1843 
OUT
 
PUINT8
 
pPMKID
)

1845 
UCHAR
 
dige
[80], 
xt_buf
[20];

1846 
UINT8
 
xt_n
;

1849 
	`NdisMoveMemy
(&
xt_buf
[0], "PMK Name", 8);

1850 
	`NdisMoveMemy
(&
xt_buf
[8], 
pAaddr
, 
MAC_ADDR_LEN
);

1851 
	`NdisMoveMemy
(&
xt_buf
[14], 
pSddr
, 
MAC_ADDR_LEN
);

1852 
xt_n
 = 20;

1855 
	`RT_HMAC_SHA1
(
pKey
, 
PMK_LEN
, 
xt_buf
, 
xt_n
, 
dige
, 
SHA1_DIGEST_SIZE
);

1859 
	`NdisMoveMemy
(
pPMKID
, 
dige
, 
LEN_PMKID
);

1861 
	}
}

1889 
VOID
 
	$WDivePTK
(

1890 
IN
 
PRTMP_ADAPTER
 
pAd
,

1891 
IN
 
UCHAR
 *
PMK
,

1892 
IN
 
UCHAR
 *
AN
,

1893 
IN
 
UCHAR
 *
AA
,

1894 
IN
 
UCHAR
 *
SN
,

1895 
IN
 
UCHAR
 *
SA
,

1896 
OUT
 
UCHAR
 *
ouut
,

1897 
IN
 
UINT
 
n
)

1899 
UCHAR
 
cti
[76];

1900 
UINT
 
CuPos
 = 0;

1901 
UCHAR
 
mp
[32];

1902 
UCHAR
 
Pfix
[] = {'P', 'a', 'i', 'r', 'w', 'i', 's', 'e', ' ', 'k', 'e', 'y', ' ',

1906 
	`NdisZoMemy
(
mp
, (temp));

1907 
	`NdisZoMemy
(
cti
, 76);

1910 i(
	`RTMPComMemy
(
SA
, 
AA
, 6) == 1)

1911 
	`NdisMoveMemy
(
cti
, 
AA
, 6);

1913 
	`NdisMoveMemy
(
cti
, 
SA
, 6);

1914 
CuPos
 += 6;

1917 i(
	`RTMPComMemy
(
SA
, 
AA
, 6) == 1)

1918 
	`NdisMoveMemy
(&
cti
[
CuPos
], 
SA
, 6);

1920 
	`NdisMoveMemy
(&
cti
[
CuPos
], 
AA
, 6);

1924 
	`NdisMoveMemy
(
mp
, &
cti
[
CuPos
], 
MAC_ADDR_LEN
);

1925 
CuPos
 += 6;

1928 i(
	`RTMPComMemy
(
AN
, 
SN
, 32) == 0)

1929 
	`NdisMoveMemy
(&
cti
[
CuPos
], 
mp
, 32);

1930 i(
	`RTMPComMemy
(
AN
, 
SN
, 32) == 1)

1931 
	`NdisMoveMemy
(&
cti
[
CuPos
], 
SN
, 32);

1933 
	`NdisMoveMemy
(&
cti
[
CuPos
], 
AN
, 32);

1934 
CuPos
 += 32;

1937 i(
	`RTMPComMemy
(
AN
, 
SN
, 32) == 0)

1938 
	`NdisMoveMemy
(&
cti
[
CuPos
], 
mp
, 32);

1939 i(
	`RTMPComMemy
(
AN
, 
SN
, 32) == 1)

1940 
	`NdisMoveMemy
(&
cti
[
CuPos
], 
AN
, 32);

1942 
	`NdisMoveMemy
(&
cti
[
CuPos
], 
SN
, 32);

1943 
CuPos
 += 32;

1945 
	`hex_dump
("PMK", 
PMK
, 
LEN_PMK
);

1946 
	`hex_dump
("cti=", 
cti
, 76);

1949 
	`PRF
(
PMK
, 
LEN_PMK
, 
Pfix
, 22, 
cti
, 76, 
ouut
, 
n
);

1951 
	}
}

1953 
VOID
 
	$WDiveGTK
(

1954 
IN
 
UCHAR
 *
GMK
,

1955 
IN
 
UCHAR
 *
GN
,

1956 
IN
 
UCHAR
 *
AA
,

1957 
OUT
 
UCHAR
 *
ouut
,

1958 
IN
 
UINT
 
n
)

1960 
UCHAR
 
cti
[76];

1961 
UINT
 
CuPos
=0;

1962 
UCHAR
 
Pfix
[19];

1963 
UCHAR
 
mp
[80];

1965 
	`NdisMoveMemy
(&
cti
[
CuPos
], 
AA
, 6);

1966 
CuPos
 += 6;

1968 
	`NdisMoveMemy
(&
cti
[
CuPos
], 
GN
 , 32);

1969 
CuPos
 += 32;

1971 
Pfix
[0] = 'G';

1972 
Pfix
[1] = 'r';

1973 
Pfix
[2] = 'o';

1974 
Pfix
[3] = 'u';

1975 
Pfix
[4] = 'p';

1976 
Pfix
[5] = ' ';

1977 
Pfix
[6] = 'k';

1978 
Pfix
[7] = 'e';

1979 
Pfix
[8] = 'y';

1980 
Pfix
[9] = ' ';

1981 
Pfix
[10] = 'e';

1982 
Pfix
[11] = 'x';

1983 
Pfix
[12] = 'p';

1984 
Pfix
[13] = 'a';

1985 
Pfix
[14] = 'n';

1986 
Pfix
[15] = 's';

1987 
Pfix
[16] = 'i';

1988 
Pfix
[17] = 'o';

1989 
Pfix
[18] = 'n';

1991 
	`PRF
(
GMK
, 
PMK_LEN
, 
Pfix
, 19, 
cti
, 38 , 
mp
, 
n
);

1992 
	`NdisMoveMemy
(
ouut
, 
mp
, 
n
);

1993 
	}
}

2012 
VOID
 
	$GRdom
(

2013 
IN
 
PRTMP_ADAPTER
 
pAd
,

2014 
IN
 
UCHAR
 *
macAddr
,

2015 
OUT
 
UCHAR
 *
ndom
)

2017 
INT
 
i
, 
cu
;

2018 
UCHAR
 
lol
[80], 
KeyCou
[32];

2019 
UCHAR
 
su
[80];

2020 
ULONG
 
CutTime
;

2021 
UCHAR
 
efix
[] = {'I', 'n', 'i', 't', ' ', 'C', 'o', 'u', 'n', 't', 'e', 'r'};

2024 
	`NdisZoMemy
(
su
, 80);

2025 
	`NdisZoMemy
(
lol
, 80);

2026 
	`NdisZoMemy
(
KeyCou
, 32);

2028 
i
 = 0; i < 32; i++)

2031 
	`COPY_MAC_ADDR
(
lol
, 
macAddr
);

2032 
cu
 = 
MAC_ADDR_LEN
;

2035 
	`NdisGSyemUpTime
(&
CutTime
);

2036 
	`NdisMoveMemy
(&
lol
[
cu
], &
CutTime
, (CurrentTime));

2037 
cu
 +(
CutTime
);

2040 
	`NdisMoveMemy
(&
lol
[
cu
], 
su
, 32);

2041 
cu
 += 32;

2044 
	`NdisMoveMemy
(&
lol
[
cu
], &
i
, 2);

2045 
cu
 += 2;

2048 
	`PRF
(
KeyCou
, 32, 
efix
,12, 
lol
, 
cu
, 
su
, 32);

2051 
	`NdisMoveMemy
(
ndom
, 
su
, 32);

2052 
	}
}

2074 
VOID
 
	$RTMPMakeRIeCh
(

2075 
IN
 
PRTMP_ADAPTER
 
pAd
,

2076 
IN
 
UCHAR
 
EmtID
,

2077 
IN
 
UINT
 
WStus
,

2078 
IN
 
BOOLEAN
 
bMixCh
,

2079 
IN
 
UCHAR
 
FxibCh
,

2080 
OUT
 
PUCHAR
 
pRIe
,

2081 
OUT
 
UCHAR
 *
r_n
)

2083 
UCHAR
 
PawiC
;

2085 *
r_n
 = 0;

2088 i(
EmtID
 =
W2Ie
)

2090 
RSNIE2
 *
pR_ch
 = (RSNIE2*)
pRIe
;

2093 
pR_ch
->
vsi
 = 1;

2095 
WStus
)

2098 
Ndis802_11Enyi2Ebd
:

2099 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA2_TKIP
, 4);

2100 
pR_ch
->
ucou
 = 1;

2101 
	`NdisMoveMemy
(
pR_ch
->
u
[0].
oui
, 
OUI_WPA2_TKIP
, 4);

2102 *
r_n
 = (
RSNIE2
);

2106 
Ndis802_11Enyi3Ebd
:

2107 i(
bMixCh
)

2108 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA2_TKIP
, 4);

2110 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA2_CCMP
, 4);

2111 
pR_ch
->
ucou
 = 1;

2112 
	`NdisMoveMemy
(
pR_ch
->
u
[0].
oui
, 
OUI_WPA2_CCMP
, 4);

2113 *
r_n
 = (
RSNIE2
);

2117 
Ndis802_11Enyi4Ebd
:

2118 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA2_TKIP
, 4);

2120 
PawiC
 = 1;

2122 i(
	`MIX_CIPHER_WPA2_TKIP_ON
(
FxibCh
))

2124 
	`NdisMoveMemy
(
pR_ch
->
u
[0].
oui
, 
OUI_WPA2_TKIP
, 4);

2126 i(
	`MIX_CIPHER_WPA2_AES_ON
(
FxibCh
))

2128 
	`NdisMoveMemy
(
pR_ch
->
u
[0].
oui
 + 4, 
OUI_WPA2_CCMP
, 4);

2129 
PawiC
 = 2;

2135 
	`NdisMoveMemy
(
pR_ch
->
u
[0].
oui
, 
OUI_WPA2_CCMP
, 4);

2138 
pR_ch
->
ucou
 = 
PawiC
;

2139 *
r_n
 = (
RSNIE2
+ (4 * (
PawiC
 - 1));

2143 #ifde
CONFIG_STA_SUPPORT


2144 i((
pAd
->
OpMode
 =
OPMODE_STA
) &&

2145 (
pAd
->
SCfg
.
GroupCh
 !
Ndis802_11Enyi2Ebd
) &&

2146 (
pAd
->
SCfg
.
GroupCh
 !
Ndis802_11Enyi3Ebd
))

2148 
UINT
 
GroupCh
 = 
pAd
->
SCfg
.GroupCipher;

2149 
GroupCh
)

2151 
Ndis802_11GroupWEP40Ebd
:

2152 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA2_WEP40
, 4);

2154 
Ndis802_11GroupWEP104Ebd
:

2155 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA2_WEP104
, 4);

2162 
pR_ch
->
vsi
 = 
	`u216
(pRsnie_cipher->version);

2163 
pR_ch
->
ucou
 = 
	`u216
(pRsnie_cipher->ucount);

2167 
RSNIE
 *
pR_ch
 = (RSNIE*)
pRIe
;

2170 
	`NdisMoveMemy
(
pR_ch
->
oui
, 
OUI_WPA_VERSION
, 4);

2171 
pR_ch
->
vsi
 = 1;

2173 
WStus
)

2176 
Ndis802_11Enyi2Ebd
:

2177 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA_TKIP
, 4);

2178 
pR_ch
->
ucou
 = 1;

2179 
	`NdisMoveMemy
(
pR_ch
->
u
[0].
oui
, 
OUI_WPA_TKIP
, 4);

2180 *
r_n
 = (
RSNIE
);

2184 
Ndis802_11Enyi3Ebd
:

2185 i(
bMixCh
)

2186 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA_TKIP
, 4);

2188 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA_CCMP
, 4);

2189 
pR_ch
->
ucou
 = 1;

2190 
	`NdisMoveMemy
(
pR_ch
->
u
[0].
oui
, 
OUI_WPA_CCMP
, 4);

2191 *
r_n
 = (
RSNIE
);

2195 
Ndis802_11Enyi4Ebd
:

2196 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA_TKIP
, 4);

2198 
PawiC
 = 1;

2200 i(
	`MIX_CIPHER_WPA_TKIP_ON
(
FxibCh
))

2202 
	`NdisMoveMemy
(
pR_ch
->
u
[0].
oui
, 
OUI_WPA_TKIP
, 4);

2204 i(
	`MIX_CIPHER_WPA_AES_ON
(
FxibCh
))

2206 
	`NdisMoveMemy
(
pR_ch
->
u
[0].
oui
 + 4, 
OUI_WPA_CCMP
, 4);

2207 
PawiC
 = 2;

2213 
	`NdisMoveMemy
(
pR_ch
->
u
[0].
oui
, 
OUI_WPA_CCMP
, 4);

2216 
pR_ch
->
ucou
 = 
PawiC
;

2217 *
r_n
 = (
RSNIE
+ (4 * (
PawiC
 - 1));

2221 #ifde
CONFIG_STA_SUPPORT


2222 i((
pAd
->
OpMode
 =
OPMODE_STA
) &&

2223 (
pAd
->
SCfg
.
GroupCh
 !
Ndis802_11Enyi2Ebd
) &&

2224 (
pAd
->
SCfg
.
GroupCh
 !
Ndis802_11Enyi3Ebd
))

2226 
UINT
 
GroupCh
 = 
pAd
->
SCfg
.GroupCipher;

2227 
GroupCh
)

2229 
Ndis802_11GroupWEP40Ebd
:

2230 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA_WEP40
, 4);

2232 
Ndis802_11GroupWEP104Ebd
:

2233 
	`NdisMoveMemy
(
pR_ch
->
m
, 
OUI_WPA_WEP104
, 4);

2240 
pR_ch
->
vsi
 = 
	`u216
(pRsnie_cipher->version);

2241 
pR_ch
->
ucou
 = 
	`u216
(pRsnie_cipher->ucount);

2243 
	}
}

2264 
VOID
 
	$RTMPMakeRIeAKM
(

2265 
IN
 
PRTMP_ADAPTER
 
pAd
,

2266 
IN
 
UCHAR
 
EmtID
,

2267 
IN
 
UINT
 
AuthMode
,

2268 
IN
 
UCHAR
 
idx
,

2269 
OUT
 
PUCHAR
 
pRIe
,

2270 
OUT
 
UCHAR
 *
r_n
)

2272 
RSNIE_AUTH
 *
pR_auth
;

2273 
UCHAR
 
AkmC
 = 1;

2275 
pR_auth
 = (
RSNIE_AUTH
*)(
pRIe
 + (*
r_n
));

2278 i(
EmtID
 =
W2Ie
)

2281 
AuthMode
)

2283 
Ndis802_11AuthModeWPA2
:

2284 
Ndis802_11AuthModeWPA1WPA2
:

2285 
	`NdisMoveMemy
(
pR_auth
->
auth
[0].
oui
, 
OUI_WPA2_8021X_AKM
, 4);

2288 
Ndis802_11AuthModeWPA2PSK
:

2289 
Ndis802_11AuthModeWPA1PSKWPA2PSK
:

2290 
	`NdisMoveMemy
(
pR_auth
->
auth
[0].
oui
, 
OUI_WPA2_PSK_AKM
, 4);

2293 
AkmC
 = 0;

2300 
AuthMode
)

2302 
Ndis802_11AuthModeWPA
:

2303 
Ndis802_11AuthModeWPA1WPA2
:

2304 
	`NdisMoveMemy
(
pR_auth
->
auth
[0].
oui
, 
OUI_WPA_8021X_AKM
, 4);

2307 
Ndis802_11AuthModeWPAPSK
:

2308 
Ndis802_11AuthModeWPA1PSKWPA2PSK
:

2309 
	`NdisMoveMemy
(
pR_auth
->
auth
[0].
oui
, 
OUI_WPA_PSK_AKM
, 4);

2312 
Ndis802_11AuthModeWPANe
:

2313 
	`NdisMoveMemy
(
pR_auth
->
auth
[0].
oui
, 
OUI_WPA_NONE_AKM
, 4);

2316 
AkmC
 = 0;

2321 
pR_auth
->
acou
 = 
AkmC
;

2322 
pR_auth
->
acou
 = 
	`u216
(pRsnie_auth->acount);

2325 (*
r_n
+((
RSNIE_AUTH
+ (4 * (
AkmC
 - 1)));

2327 
	}
}

2347 
VOID
 
	$RTMPMakeRIeC
(

2348 
IN
 
PRTMP_ADAPTER
 
pAd
,

2349 
IN
 
UCHAR
 
EmtID
,

2350 
IN
 
UCHAR
 
idx
,

2351 
OUT
 
PUCHAR
 
pRIe
,

2352 
OUT
 
UCHAR
 *
r_n
)

2354 
RSN_CAPABILITIES
 *
pRSN_C
;

2357 i(
EmtID
 =
WIe
)

2360 
pRSN_C
 = (
RSN_CAPABILITIES
*)(
pRIe
 + (*
r_n
));

2362 #ifde
CONFIG_STA_SUPPORT


2363 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2368 
pRSN_C
->
wd
 = 
	`u216
(pRSN_Cap->word);

2370 (*
r_n
+(
RSN_CAPABILITIES
);

2372 
	}
}

2411 
VOID
 
	$RTMPMakeRSNIE
(

2412 
IN
 
PRTMP_ADAPTER
 
pAd
,

2413 
IN
 
UINT
 
AuthMode
,

2414 
IN
 
UINT
 
WStus
,

2415 
IN
 
UCHAR
 
idx
)

2417 
PUCHAR
 
pRIe
 = 
NULL
;

2418 
UCHAR
 *
rn_cur_p
 = 0;

2419 
UCHAR
 *
rn_ex_cur_p
 = 0;

2420 
UCHAR
 
PrimyR
;

2421 
BOOLEAN
 
bMixCh
 = 
FALSE
;

2422 
UCHAR
 
p_offt
;

2423 
WPA_MIX_PAIR_CIPHER
 
FxibCh
 = 
MIX_CIPHER_NOTUSE
;

2425 
rn_cur_p
 = 
NULL
;

2426 
rn_ex_cur_p
 = 
NULL
;

2429 #ifde
CONFIG_STA_SUPPORT


2430 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2432 #ifde
WPA_SUPPLICANT_SUPPORT


2433 i(
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
)

2435 i(
AuthMode
 < 
Ndis802_11AuthModeWPA
)

2443 i((
AuthMode
 !
Ndis802_11AuthModeWPAPSK
) &&

2444 (
AuthMode
 !
Ndis802_11AuthModeWPA2PSK
) &&

2445 (
AuthMode
 !
Ndis802_11AuthModeWPANe
)

2450 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("==> RTMPMakeRSNIE(STA)\n"));

2453 
pAd
->
SCfg
.
RSNIE_L
 = 0;

2454 
	`NdisZoMemy
(
pAd
->
SCfg
.
RSN_IE
, 
MAX_LEN_OF_RSNIE
);

2457 
rn_cur_p
 = &
pAd
->
SCfg
.
RSNIE_L
;

2458 
pRIe
 = 
pAd
->
SCfg
.
RSN_IE
;

2460 
bMixCh
 = 
pAd
->
SCfg
.bMixCipher;

2466 i((
AuthMode
 =
Ndis802_11AuthModeWPA
) ||

2467 (
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

2468 (
AuthMode
 =
Ndis802_11AuthModeWPANe
) ||

2469 (
AuthMode
 =
Ndis802_11AuthModeWPA1WPA2
) ||

2470 (
AuthMode
 =
Ndis802_11AuthModeWPA1PSKWPA2PSK
))

2471 
PrimyR
 = 
WIe
;

2473 
PrimyR
 = 
W2Ie
;

2478 
	`RTMPMakeRIeCh
(
pAd
, 
PrimyR
, 
WStus
, 
bMixCh
, 
FxibCh
, 
pRIe
, &
p_offt
);

2481 
	`RTMPMakeRIeAKM
(
pAd
, 
PrimyR
, 
AuthMode
, 
idx
, 
pRIe
, &
p_offt
);

2484 
	`RTMPMakeRIeC
(
pAd
, 
PrimyR
, 
idx
, 
pRIe
, &
p_offt
);

2489 *
rn_cur_p
 = 
p_offt
;

2491 
	`hex_dump
("Thimy RSNIE", 
pRIe
, (*
rn_cur_p
));

2494 
	}
}

2513 
BOOLEAN
 
	$RTMPCheckWPAame
(

2514 
IN
 
PRTMP_ADAPTER
 
pAd
,

2515 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

2516 
IN
 
PUCHAR
 
pDa
,

2517 
IN
 
ULONG
 
DaByCou
,

2518 
IN
 
UCHAR
 
FromWhichBSSID
)

2520 
ULONG
 
Body_n
;

2521 
BOOLEAN
 
Ced
;

2524 if(
DaByCou
 < (
LENGTH_802_1_H
 + 
LENGTH_EAPOL_H
))

2525  
FALSE
;

2529 i(
	`NdisEquMemy
(
SNAP_802_1H
, 
pDa
, 6) ||

2531 
	`NdisEquMemy
(
SNAP_BRIDGE_TUNNEL
, 
pDa
, 6))

2533 
pDa
 += 6;

2536 i(
	`NdisEquMemy
(
EAPOL
, 
pDa
, 2))

2539 
pDa
 += 2;

2542  
FALSE
;

2544 *(
pDa
+1))

2546 
EAPPack
:

2547 
Body_n
 = (*(
pDa
+2)<<8) | (*(pData+3));

2548 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ReivEAP-Pack fme, TYPE = 0, Lgth = %ld\n", 
Body_n
));

2550 
EAPOLS
:

2551 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Receive EAPOL-Start frame, TYPE = 1 \n"));

2552 i(
pEry
->
EnqueueESTimRug
 !
EAPOL_START_DISABLE
)

2554 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Cancelhe EnqueueEapolStartTimerRunning \n"));

2555 
	`RTMPClTim
(&
pEry
->
EnqueueSFPSKTim
, &
Ced
);

2556 
pEry
->
EnqueueESTimRug
 = 
EAPOL_START_DISABLE
;

2559 
EAPOLLogoff
:

2560 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Receive EAPOLLogoff frame, TYPE = 2 \n"));

2562 
EAPOLKey
:

2563 
Body_n
 = (*(
pDa
+2)<<8) | (*(pData+3));

2564 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ReivEAPOL-Key fme, TYPE = 3, Lgth = %ld\n", 
Body_n
));

2566 
EAPOLASFA˹
:

2567 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Receive EAPOLASFAlert frame, TYPE = 4 \n"));

2570  
FALSE
;

2573  
TRUE
;

2574 
	}
}

2594 
PSTRING
 
	$GEMsgTy
(
CHAR
 
msg
)

2596 if(
msg
 =
EAPOL_PAIR_MSG_1
)

2598 if(
msg
 =
EAPOL_PAIR_MSG_2
)

2600 if(
msg
 =
EAPOL_PAIR_MSG_3
)

2602 if(
msg
 =
EAPOL_PAIR_MSG_4
)

2604 if(
msg
 =
EAPOL_GROUP_MSG_1
)

2606 if(
msg
 =
EAPOL_GROUP_MSG_2
)

2610 
	}
}

2626 
BOOLEAN
 
	$RTMPCheckRSNIE
(

2627 
IN
 
PRTMP_ADAPTER
 
pAd
,

2628 
IN
 
PUCHAR
 
pDa
,

2629 
IN
 
UCHAR
 
DaL
,

2630 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

2631 
OUT
 
UCHAR
 *
Offt
)

2633 
PUCHAR
 
pVIE
;

2634 
UCHAR
 
n
;

2635 
PEID_STRUCT
 
pEid
;

2636 
BOOLEAN
 
su
 = 
FALSE
;

2638 
pVIE
 = 
pDa
;

2639 
n
 = 
DaL
;

2640 *
Offt
 = 0;

2642 
n
 > (
RSNIE2
))

2644 
pEid
 = (
PEID_STRUCT

pVIE
;

2646 i((
pEid
->
Eid
 =
IE_WPA
&& (
	`NdisEquMemy
Eid->
O
, 
WPA_OUI
, 4)))

2648 i((
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA
 ||Ery->AuthMod=
Ndis802_11AuthModeWPAPSK
) &&

2649 (
	`NdisEquMemy
(
pVIE
, 
pEry
->
RSN_IE
,Ery->
RSNIE_L
)) &&

2650 (
pEry
->
RSNIE_L
 =(
pEid
->
L
 + 2)))

2652 
su
 = 
TRUE
;

2655 *
Offt
 +(
pEid
->
L
 + 2);

2658 i((
pEid
->
Eid
 =
IE_RSN
&& (
	`NdisEquMemy
Eid->
O
 + 2, 
RSN_OUI
, 3)))

2660 i((
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2
 ||Ery->AuthMod=
Ndis802_11AuthModeWPA2PSK
) &&

2661 (
pEid
->
Eid
 =
pEry
->
RSN_IE
[0]) &&

2662 ((
pEid
->
L
 + 2>
pEry
->
RSNIE_L
) &&

2663 (
	`NdisEquMemy
(
pEid
->
O
, &
pEry
->
RSN_IE
[2],Ery->
RSNIE_L
 - 4)))

2666 
su
 = 
TRUE
;

2669 *
Offt
 +(
pEid
->
L
 + 2);

2676 
pVIE
 +(
pEid
->
L
 + 2);

2677 
n
 -(
pEid
->
L
 + 2);

2681  
su
;

2683 
	}
}

2702 
BOOLEAN
 
	$RTMPPEKeyDa
(

2703 
IN
 
PRTMP_ADAPTER
 
pAd
,

2704 
IN
 
PUCHAR
 
pKeyDa
,

2705 
IN
 
UCHAR
 
KeyDaL
,

2706 
IN
 
UCHAR
 
GroupKeyIndex
,

2707 
IN
 
UCHAR
 
MsgTy
,

2708 
IN
 
BOOLEAN
 
bWPA2
,

2709 
IN
 
MAC_TABLE_ENTRY
 *
pEry
)

2711 
PUCHAR
 
pMyKeyDa
 = 
pKeyDa
;

2712 
UCHAR
 
KeyDaLgth
 = 
KeyDaL
;

2713 
UCHAR
 
GTK
[
MAX_LEN_GTK
];

2714 
UCHAR
 
GTKLEN
 = 0;

2715 
UCHAR
 
DeuIdx
 = 0;

2716 
UCHAR
 
sk_offt
 = 0;

2719 i(
MsgTy
 =
EAPOL_PAIR_MSG_2
 || MsgTy =
EAPOL_PAIR_MSG_3
)

2722 i(!
	`RTMPCheckRSNIE
(
pAd
, 
pKeyDa
, 
KeyDaL
, 
pEry
, &
sk_offt
))

2725 
	`RTMPSdWessEvt
(
pAd
, 
IW_RSNIE_DIFF_EVENT_FLAG
, 
pEry
->
Addr
,Ery->
idx
, 0);

2727 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RSN_IE Dif imsg %d o4-way hdshake!\n", 
MsgTy
));

2728 
	`hex_dump
("ReivRSN_IE ", 
pKeyDa
, 
KeyDaL
);

2729 
	`hex_dump
("Desed RSN_IE ", 
pEry
->
RSN_IE
,Ery->
RSNIE_L
);

2731  
FALSE
;

2735 i(
bWPA2
 && 
MsgTy
 =
EAPOL_PAIR_MSG_3
)

2740 
pMyKeyDa
 +
sk_offt
;

2741 
KeyDaLgth
 -
sk_offt
;

2742 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPPEKeyD==> WPA2/WPA2PSK RSN IE mched iMsg 3, Lgth(%d\n", 
sk_offt
));

2745  
TRUE
;

2749 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RTMPPEKeyD==> KeyDaLgth %d whouRSN_IE \n", 
KeyDaLgth
));

2754 i(
bWPA2
 && (
MsgTy
 =
EAPOL_PAIR_MSG_3
 || MsgTy =
EAPOL_GROUP_MSG_1
))

2756 
PEID_STRUCT
 
pEid
;

2758 
pEid
 = (
PEID_STRUCT

pMyKeyDa
;

2759 
sk_offt
 = 0;

2760 (
sk_offt
 + 2 + 
pEid
->
L
<
KeyDaLgth
)

2762 
pEid
->
Eid
)

2764 
WPA_KDE_TYPE
:

2766 
PKDE_HDR
 
pKDE
;

2768 
pKDE
 = (
PKDE_HDR
)
pEid
;

2769 i(
	`NdisEquMemy
(
pKDE
->
OUI
, 
OUI_WPA2
, 3))

2771 i(
pKDE
->
DaTy
 =
KDE_GTK
)

2773 
PGTK_KDE
 
pKdeGtk
;

2775 
pKdeGtk
 = (
PGTK_KDE
&
pKDE
->
o
[0];

2776 
DeuIdx
 = 
pKdeGtk
->
Kid
;

2779 
GTKLEN
 = 
pKDE
->
L
 -6;

2780 i(
GTKLEN
 < 
LEN_AES_TK
)

2782 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("ERROR: GTK Keygth itosh܈(%d\n", 
GTKLEN
));

2783  
FALSE
;

2785 
	`NdisMoveMemy
(
GTK
, 
pKdeGtk
->GTK, 
GTKLEN
);

2786 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("GTK iKDE fm ,DeuKeyID=%d, KeyL=%d \n", 
DeuIdx
, 
GTKLEN
));

2792 
sk_offt
 = sk_off+ 2 + 
pEid
->
L
;

2793 
pEid
 = (
PEID_STRUCT
)((
UCHAR
*Eid + 2 +Eid->
L
);

2797 
pMyKeyDa
 +
sk_offt
;

2798 
KeyDaLgth
 -
sk_offt
;

2800 i(!
bWPA2
 && 
MsgTy
 =
EAPOL_GROUP_MSG_1
)

2802 
DeuIdx
 = 
GroupKeyIndex
;

2803 
GTKLEN
 = 
KeyDaLgth
;

2804 
	`NdisMoveMemy
(
GTK
, 
pMyKeyDa
, 
KeyDaLgth
);

2805 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("GTK whouKDE, DeuKeyID=%d, KeyL=%d \n", 
DeuIdx
, 
GTKLEN
));

2809 i(
DeuIdx
 > 3)

2811 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("ERROR: GTK Key index(%divid i%%\n", 
DeuIdx
, ((
bWPA2
? "WPA2" : "WPA"), 
	`GEMsgTy
(
MsgTy
)));

2812  
FALSE
;

2816 #ifde
CONFIG_STA_SUPPORT


2817 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2821 
	`NdisMoveMemy
(
pAd
->
SCfg
.
GTK
, GTK, 
GTKLEN
);

2822 
pAd
->
SCfg
.
DeuKeyId
 = 
DeuIdx
;

2824 
	`WPAInlShedKey
(
pAd
,

2825 
pAd
->
SCfg
.
GroupCh
,

2826 
BSS0
,

2827 
pAd
->
SCfg
.
DeuKeyId
,

2828 
MCAST_WCID
,

2829 
FALSE
,

2830 
pAd
->
SCfg
.
GTK
);

2835  
TRUE
;

2837 
	}
}

2865 
VOID
 
	$WPA_CڡruKdeHdr
(

2866 
IN
 
UINT8
 
da_ty
,

2867 
IN
 
UINT8
 
da_n
,

2868 
OUT
 
PUCHAR
 
pBuf
)

2870 
PKDE_HDR
 
pHdr
;

2872 
pHdr
 = (
PKDE_HDR
)
pBuf
;

2874 
	`NdisZoMemy
(
pHdr
, (
KDE_HDR
));

2876 
pHdr
->
Ty
 = 
WPA_KDE_TYPE
;

2880 
pHdr
->
L
 = 4 + 
da_n
;

2882 
	`NdisMoveMemy
(
pHdr
->
OUI
, 
OUI_WPA2
, 3);

2883 
pHdr
->
DaTy
 = 
da_ty
;

2885 
	}
}

2936 
VOID
 
	$CڡruEMsg
(

2937 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

2938 
IN
 
UCHAR
 
GroupKeyWStus
,

2939 
IN
 
UCHAR
 
MsgTy
,

2940 
IN
 
UCHAR
 
DeuKeyIdx
,

2941 
IN
 
UCHAR
 *
KeyN
,

2942 
IN
 
UCHAR
 *
TxRSC
,

2943 
IN
 
UCHAR
 *
GTK
,

2944 
IN
 
UCHAR
 *
RSNIE
,

2945 
IN
 
UCHAR
 
RSNIE_L
,

2946 
OUT
 
PEAPOL_PACKET
 
pMsg
)

2948 
BOOLEAN
 
bWPA2
 = 
FALSE
;

2949 
UCHAR
 
KeyDescV
;

2952 i((
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2
) ||

2953 (
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
))

2954 
bWPA2
 = 
TRUE
;

2957 
pMsg
->
ProV
 = 
EAPOL_VER
;

2958 
pMsg
->
ProTy
 = 
EAPOLKey
;

2961 
	`SET_UINT16_TO_ARRARY
(
pMsg
->
Body_L
, 
MIN_LEN_OF_EAPOL_KEY_MSG
);

2964 i(
bWPA2
)

2965 
pMsg
->
KeyDesc
.
Ty
 = 
WPA2_KEY_DESC
;

2967 
pMsg
->
KeyDesc
.
Ty
 = 
WPA1_KEY_DESC
;

2973 
KeyDescV
 = (((
pEry
->
WStus
 =
Ndis802_11Enyi3Ebd
) ||

2974 (
GroupKeyWStus
 =
Ndis802_11Enyi3Ebd
)? (
KEY_DESC_AES
: (
KEY_DESC_TKIP
));

2977 
pMsg
->
KeyDesc
.
KeyInfo
.
KeyDescV
 = KeyDescVer;

2980 i(
MsgTy
 >
EAPOL_GROUP_MSG_1
)

2981 
pMsg
->
KeyDesc
.
KeyInfo
.
KeyTy
 = 
GROUPKEY
;

2983 
pMsg
->
KeyDesc
.
KeyInfo
.
KeyTy
 = 
PAIRWISEKEY
;

2986 i(!
bWPA2
 && (
MsgTy
 >
EAPOL_GROUP_MSG_1
))

2987 
pMsg
->
KeyDesc
.
KeyInfo
.
KeyIndex
 = 
DeuKeyIdx
;

2989 i(
MsgTy
 =
EAPOL_PAIR_MSG_3
)

2990 
pMsg
->
KeyDesc
.
KeyInfo
.
Inl
 = 1;

2992 i((
MsgTy
 =
EAPOL_PAIR_MSG_1
|| (MsgTy =
EAPOL_PAIR_MSG_3
|| (MsgTy =
EAPOL_GROUP_MSG_1
))

2993 
pMsg
->
KeyDesc
.
KeyInfo
.
KeyAck
 = 1;

2995 i(
MsgTy
 !
EAPOL_PAIR_MSG_1
)

2996 
pMsg
->
KeyDesc
.
KeyInfo
.
KeyMic
 = 1;

2998 i((
bWPA2
 && (
MsgTy
 >
EAPOL_PAIR_MSG_3
)) ||

2999 (!
bWPA2
 && (
MsgTy
 >
EAPOL_GROUP_MSG_1
)))

3001 
pMsg
->
KeyDesc
.
KeyInfo
.
Secu
 = 1;

3006 i(
bWPA2
 && ((
MsgTy
 =
EAPOL_PAIR_MSG_3
) ||

3007 (
MsgTy
 =
EAPOL_GROUP_MSG_1
)))

3009 
pMsg
->
KeyDesc
.
KeyInfo
.
EKD_DL
 = 1;

3013 *(
USHORT
 *)(&
pMsg
->
KeyDesc
.
KeyInfo

	`u216
(*(USHORT *)(&pMsg->KeyDesc.KeyInfo));

3016 i(
bWPA2
)

3020 i((
MsgTy
 =
EAPOL_PAIR_MSG_1
|| (MsgTy =
EAPOL_PAIR_MSG_3
))

3021 
pMsg
->
KeyDesc
.
KeyLgth
[1] = ((
pEry
->
WStus
 =
Ndis802_11Enyi2Ebd
? 
LEN_TKIP_TK
 : 
LEN_AES_TK
);

3023 i(!
bWPA2
)

3025 i(
MsgTy
 >
EAPOL_GROUP_MSG_1
)

3028 
pMsg
->
KeyDesc
.
KeyLgth
[1] = ((
GroupKeyWStus
 =
Ndis802_11Enyi2Ebd
? 
LEN_TKIP_GTK
 : 
LEN_AES_GTK
);

3033 
pMsg
->
KeyDesc
.
KeyLgth
[1] = ((
pEry
->
WStus
 =
Ndis802_11Enyi2Ebd
? 
LEN_TKIP_TK
 : 
LEN_AES_TK
);

3038 
	`NdisMoveMemy
(
pMsg
->
KeyDesc
.
RyCou
, 
pEry
->
R_Cou
, 
LEN_KEY_DESC_REPLAY
);

3044 i((
MsgTy
 <
EAPOL_PAIR_MSG_3
|| ((!
bWPA2
 && (MsgTy =
EAPOL_GROUP_MSG_1
))))

3045 
	`NdisMoveMemy
(
pMsg
->
KeyDesc
.
KeyN
, KeyN, 
LEN_KEY_DESC_NONCE
);

3048 i(!
bWPA2
 && (
MsgTy
 =
EAPOL_GROUP_MSG_1
))

3051 
	`NdisMoveMemy
(
pMsg
->
KeyDesc
.
KeyIv
, &
KeyN
[16], 
LEN_KEY_DESC_IV
);

3052 
pMsg
->
KeyDesc
.
KeyIv
[15] += 2;

3057 i((
MsgTy
 =
EAPOL_PAIR_MSG_3
 && 
bWPA2
|| (MsgTy =
EAPOL_GROUP_MSG_1
))

3059 
	`NdisMoveMemy
(
pMsg
->
KeyDesc
.
KeyRsc
, 
TxRSC
, 6);

3063 
	`NdisZoMemy
(
pMsg
->
KeyDesc
.
KeyMic
, 
LEN_KEY_DESC_MIC
);

3065 
	`CڡruEKeyDa
(
pEry
,

3066 
GroupKeyWStus
,

3067 
KeyDescV
,

3068 
MsgTy
,

3069 
DeuKeyIdx
,

3070 
GTK
,

3071 
RSNIE
,

3072 
RSNIE_L
,

3073 
pMsg
);

3076 i(
MsgTy
 !
EAPOL_PAIR_MSG_1
)

3078 
	`CcuϋMIC
(
KeyDescV
, 
pEry
->
PTK
, 
pMsg
);

3081 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> CڡruEMsg f %%s\n", ((
bWPA2
? "WPA2" : "WPA"), 
	`GEMsgTy
(
MsgTy
)));

3082 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" Bodygth = %d \n", 
	`CONV_ARRARY_TO_UINT16
(
pMsg
->
Body_L
)));

3083 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" Keygth = %d \n", 
	`CONV_ARRARY_TO_UINT16
(
pMsg
->
KeyDesc
.
KeyLgth
)));

3086 
	}
}

3105 
VOID
 
	$CڡruEKeyDa
(

3106 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

3107 
IN
 
UCHAR
 
GroupKeyWStus
,

3108 
IN
 
UCHAR
 
keyDescV
,

3109 
IN
 
UCHAR
 
MsgTy
,

3110 
IN
 
UCHAR
 
DeuKeyIdx
,

3111 
IN
 
UCHAR
 *
GTK
,

3112 
IN
 
UCHAR
 *
RSNIE
,

3113 
IN
 
UCHAR
 
RSNIE_LEN
,

3114 
OUT
 
PEAPOL_PACKET
 
pMsg
)

3116 
UCHAR
 *
mpo
, *
Key_Da
, *
eGTK
;

3117 
ULONG
 
da_offt
;

3118 
BOOLEAN
 
bWPA2Cab
 = 
FALSE
;

3119 
BOOLEAN
 
GTK_Inuded
 = 
FALSE
;

3122 i((
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2
) ||

3123 (
pEry
->
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
))

3124 
bWPA2Cab
 = 
TRUE
;

3126 i(
MsgTy
 =
EAPOL_PAIR_MSG_1
 ||

3127 
MsgTy
 =
EAPOL_PAIR_MSG_4
 ||

3128 
MsgTy
 =
EAPOL_GROUP_MSG_2
)

3132 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mpo
, 1500);

3134 i(
mpo
 =
NULL
)

3138 
eGTK
 = (
UCHAR
 *
	`ROUND_UP
(
mpo
, 4);

3140 
Key_Da
 = (
UCHAR
 *
	`ROUND_UP
(
eGTK
 + 512, 4);

3142 
	`NdisZoMemy
(
Key_Da
, 512);

3143 
	`SET_UINT16_TO_ARRARY
(
pMsg
->
KeyDesc
.
KeyDaL
, 0);

3144 
da_offt
 = 0;

3147 i(
RSNIE_LEN
 && ((
MsgTy
 =
EAPOL_PAIR_MSG_2
|| (MsgTy =
EAPOL_PAIR_MSG_3
)))

3149 
PUINT8
 
pmkid_r
 = 
NULL
;

3150 
UINT8
 
pmkid_n
 = 0;

3153 
	`RTMPInRSNIE
(&
Key_Da
[
da_offt
],

3154 &
da_offt
,

3155 
RSNIE
,

3156 
RSNIE_LEN
,

3157 
pmkid_r
,

3158 
pmkid_n
);

3164 i((
MsgTy
 =
EAPOL_PAIR_MSG_3
 && 
bWPA2Cab
|| (MsgTy =
EAPOL_GROUP_MSG_1
))

3166 
UINT8
 
gtk_n
;

3169 i(
GroupKeyWStus
 =
Ndis802_11Enyi3Ebd
)

3170 
gtk_n
 = 
LEN_AES_GTK
;

3172 
gtk_n
 = 
LEN_TKIP_GTK
;

3175 i(
bWPA2Cab
)

3178 
	`WPA_CڡruKdeHdr
(
KDE_GTK
, 2 + 
gtk_n
, &
Key_Da
[
da_offt
]);

3179 
da_offt
 +(
KDE_HDR
);

3182 
Key_Da
[
da_offt
] = (
DeuKeyIdx
 & 0x03);

3183 
Key_Da
[
da_offt
 + 1] = 0x00;

3184 
da_offt
 += 2;

3188 
	`NdisMoveMemy
(&
Key_Da
[
da_offt
], 
GTK
, 
gtk_n
);

3189 
da_offt
 +
gtk_n
;

3192 
GTK_Inuded
 = 
TRUE
;

3201 i(
GTK_Inuded
)

3206 (
keyDescV
 =
KEY_DESC_AES
))

3208 
UCHAR
 
mad
 = 0;

3209 
UCHAR
 
d_n
 = 0;

3210 
UINT
 
wp_n
 =0;

3220 i((
mad
 = 
da_offt
 & 0x07) != 0)

3222 
INT
 
i
;

3224 
d_n
 = (8 - 
mad
);

3225 
Key_Da
[
da_offt
] = 0xDD;

3226 
i
 = 1; i < 
d_n
; i++)

3227 
Key_Da
[
da_offt
 + 
i
] = 0;

3229 
da_offt
 +
d_n
;

3232 
	`AES_Key_Wp
(
Key_Da
, (
UINT

da_offt
,

3233 &
pEry
->
PTK
[
LEN_PTK_KCK
], 
LEN_PTK_KEK
,

3234 
eGTK
, &
wp_n
);

3235 
da_offt
 = 
wp_n
;

3240 
	`TKIP_GTK_KEY_WRAP
(&
pEry
->
PTK
[
LEN_PTK_KCK
],

3241 
pMsg
->
KeyDesc
.
KeyIv
,

3242 
Key_Da
,

3243 
da_offt
,

3244 
eGTK
);

3247 
	`NdisMoveMemy
(
pMsg
->
KeyDesc
.
KeyDa
, 
eGTK
, 
da_offt
);

3251 
	`NdisMoveMemy
(
pMsg
->
KeyDesc
.
KeyDa
, 
Key_Da
, 
da_offt
);

3255 
	`SET_UINT16_TO_ARRARY
(
pMsg
->
KeyDesc
.
KeyDaL
, 
da_offt
);

3256 
	`INC_UINT16_TO_ARRARY
(
pMsg
->
Body_L
, 
da_offt
);

3258 
	`os__mem
(
NULL
, 
mpo
);

3260 
	}
}

3282 
VOID
 
	$CcuϋMIC
(

3283 
IN
 
UCHAR
 
KeyDescV
,

3284 
IN
 
UCHAR
 *
PTK
,

3285 
OUT
 
PEAPOL_PACKET
 
pMsg
)

3287 
UCHAR
 *
OutBufr
;

3288 
ULONG
 
FmeL
 = 0;

3289 
UCHAR
 
mic
[
LEN_KEY_DESC_MIC
];

3290 
UCHAR
 
dige
[80];

3293 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
OutBufr
, 512);

3295 i(
OutBufr
 =
NULL
)

3297 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!CalculateMIC:o memory!!!\n"));

3302 
	`MakeOutgogFme
(
OutBufr
, &
FmeL
,

3303 
	`CONV_ARRARY_TO_UINT16
(
pMsg
->
Body_L
) + 4,Msg,

3304 
END_OF_ARGS
);

3306 
	`NdisZoMemy
(
mic
, (mic));

3309 i(
KeyDescV
 =
KEY_DESC_AES
)

3311 
	`RT_HMAC_SHA1
(
PTK
, 
LEN_PTK_KCK
, 
OutBufr
, 
FmeL
, 
dige
, 
SHA1_DIGEST_SIZE
);

3312 
	`NdisMoveMemy
(
mic
, 
dige
, 
LEN_KEY_DESC_MIC
);

3316 
	`RT_HMAC_MD5
(
PTK
, 
LEN_PTK_KCK
, 
OutBufr
, 
FmeL
, 
mic
, 
MD5_DIGEST_SIZE
);

3320 
	`NdisMoveMemy
(
pMsg
->
KeyDesc
.
KeyMic
, 
mic
, 
LEN_KEY_DESC_MIC
);

3322 
	`os__mem
(
NULL
, 
OutBufr
);

3323 
	}
}

3325 
UCHAR
 
	$RTMPExaKeyIdxFromIVHdr
(

3326 
IN
 
PUCHAR
 
pIV
,

3327 
IN
 
UINT8
 
ChAlg
)

3329 
UCHAR
 
keyIdx
 = 0xFF;

3332 
ChAlg
)

3334 
Ndis802_11Enyi1Ebd
:

3335 
Ndis802_11Enyi2Ebd
:

3336 
Ndis802_11Enyi3Ebd
:

3337 
keyIdx
 = (*(
pIV
 + 3) & 0xc0) >> 6;

3342  
keyIdx
;

3344 
	}
}

3346 
PCIPHER_KEY
 
	$RTMPSwChKeySei
(

3347 
IN
 
PRTMP_ADAPTER
 
pAd
,

3348 
IN
 
PUCHAR
 
pIV
,

3349 
IN
 
RX_BLK
 *
pRxBlk
,

3350 
IN
 
PMAC_TABLE_ENTRY
 
pEry
)

3352 
PCIPHER_KEY
 
pKey
 = 
NULL
;

3353 
UCHAR
 
keyIdx
 = 0;

3354 
UINT8
 
ChAlg
 = 
Ndis802_11EnyiDibd
;

3355 
PRT28XX_RXD_STRUC
 
pRxD
 = &(
pRxBlk
->
RxD
);

3357 i((
pEry
 =
NULL
) ||

3358 (
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_APCLI
)) ||

3359 (
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_WDS
)) ||

3360 (
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_MESH
)))

3361  
NULL
;

3363 i(
pRxD
->
U2M
)

3365 
ChAlg
 = 
pEry
->
WStus
;

3369 #ifde
CONFIG_STA_SUPPORT


3370 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

3372 
ChAlg
 = 
pAd
->
SCfg
.
GroupCh
;

3377 i((
keyIdx
 = 
	`RTMPExaKeyIdxFromIVHdr
(
pIV
, 
ChAlg
)) > 3)

3379 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s : Invalid key index(%d) !!!\n",

3380 
__FUNCTION__
, 
keyIdx
));

3381  
NULL
;

3384 i(
ChAlg
 =
Ndis802_11Enyi1Ebd
)

3386 
pKey
 = &
pAd
->
ShedKey
[
pEry
->
idx
][
keyIdx
];

3388 i((
ChAlg
 =
Ndis802_11Enyi2Ebd
) ||

3389 (
ChAlg
 =
Ndis802_11Enyi3Ebd
))

3391 i(
pRxD
->
U2M
)

3392 
pKey
 = &
pEry
->
PawiKey
;

3394 #ifde
CONFIG_STA_SUPPORT


3396 
pKey
 = &
pAd
->
ShedKey
[
pEry
->
idx
][
keyIdx
];

3400  
pKey
;

3402 
	}
}

3420 
NDIS_STATUS
 
	$RTMPSoDeyiAi
(

3421 
IN
 
PRTMP_ADAPTER
 
pAd
,

3422 
IN
 
PUCHAR
 
pHdr
,

3423 
IN
 
UCHAR
 
UrPriܙy
,

3424 
IN
 
PCIPHER_KEY
 
pKey
,

3425 
INOUT
 
PUCHAR
 
pDa
,

3426 
INOUT
 
UINT16
 *
DaByC
)

3428 
pKey
->
ChAlg
)

3430 
CIPHER_WEP64
:

3431 
CIPHER_WEP128
:

3433 i(
	`RTMPSoDeyWEP
(
pAd
, 
pKey
, 
pDa
, &(*
DaByC
)=
FALSE
)

3435 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("ERROR : SW decrypt WEP data fails.\n"));

3437  
NDIS_STATUS_FAILURE
;

3441 
CIPHER_TKIP
:

3443 i(
	`RTMPSoDeyTKIP
(
pAd
, 
pHdr
, 
UrPriܙy
,

3444 
pKey
, 
pDa
, &(*
DaByC
)=
FALSE
)

3446 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("ERROR : SW decrypt TKIP data fails.\n"));

3448  
NDIS_STATUS_FAILURE
;

3452 
CIPHER_AES
:

3454 i(
	`RTMPSoDeyCCMP
(
pAd
, 
pHdr
, 
pKey
, 
pDa
, &(*
DaByC
)=
FALSE
)

3456 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("ERROR : SW decrypt AES data fails.\n"));

3458  
NDIS_STATUS_FAILURE
;

3463  
NDIS_STATUS_FAILURE
;

3467  
NDIS_STATUS_SUCCESS
;

3469 
	}
}

3471 
VOID
 
	$RTMPSoCڡruIVHdr
(

3472 
IN
 
UCHAR
 
ChAlg
,

3473 
IN
 
UCHAR
 
key_id
,

3474 
IN
 
PUCHAR
 
pTxIv
,

3475 
OUT
 
PUCHAR
 
pHdrIv
,

3476 
OUT
 
UINT8
 *
hdr_iv_n
)

3478 *
hdr_iv_n
 = 0;

3480 i((
ChAlg
 =
CIPHER_WEP64
|| (ChAlg =
CIPHER_WEP128
))

3483 
	`RTMPCڡruWEPIVHdr
(
key_id
, 
pTxIv
, 
pHdrIv
);

3484 *
hdr_iv_n
 = 
LEN_WEP_IV_HDR
;

3486 i(
ChAlg
 =
CIPHER_TKIP
)

3488 i(
ChAlg
 =
CIPHER_AES
)

3491 
	`RTMPCڡruCCMPHdr
(
key_id
, 
pTxIv
, 
pHdrIv
);

3492 *
hdr_iv_n
 = 
LEN_CCMP_HDR
;

3495 
	}
}

3497 
VOID
 
	$RTMPSoEnyiAi
(

3498 
IN
 
PRTMP_ADAPTER
 
pAd
,

3499 
IN
 
UCHAR
 
ChAlg
,

3500 
IN
 
PUCHAR
 
pHdr
,

3501 
IN
 
PUCHAR
 
pSrcBufDa
,

3502 
IN
 
UINT32
 
SrcBufL
,

3503 
IN
 
UCHAR
 
KeyIdx
,

3504 
IN
 
PCIPHER_KEY
 
pKey
,

3505 
OUT
 
UINT8
 *
ext_n
)

3507 *
ext_n
 = 0;

3509 i((
ChAlg
 =
CIPHER_WEP64
|| (ChAlg =
CIPHER_WEP128
))

3512 
	`RTMPSoEnyWEP
(
pAd
,

3513 
pKey
->
TxTsc
,

3514 
pKey
,

3515 
pSrcBufDa
,

3516 
SrcBufL
);

3518 *
ext_n
 = 
LEN_ICV
;

3520 i(
ChAlg
 =
CIPHER_TKIP
)

3522 i(
ChAlg
 =
CIPHER_AES
)

3525 
	`RTMPSoEnyCCMP
(
pAd
,

3526 
pHdr
,

3527 
pKey
->
TxTsc
,

3528 
pKey
->
Key
,

3529 
pSrcBufDa
,

3530 
SrcBufL
);

3532 *
ext_n
 = 
LEN_CCMP_MIC
;

3535 
	}
}

3537 
PUINT8
 
	$WPA_ExaSueFromRSNIE
(

3538 
IN
 
PUINT8
 
r
,

3539 
IN
 
UINT
 
r_n
,

3540 
IN
 
UINT8
 
ty
,

3541 
OUT
 
UINT8
 *
cou
)

3543 
PEID_STRUCT
 
pEid
;

3544 
INT
 
n
;

3545 
PUINT8
 
pBuf
;

3546 
INT
 
offt
 = 0;

3548 
pEid
 = (
PEID_STRUCT
)
r
;

3549 
n
 = 
r_n
 - 2;

3550 
pBuf
 = (
PUINT8
)&
pEid
->
O
[0];

3553 *
cou
 = 0;

3556 i((
n
 <0|| (
pEid
->
L
 !=en))

3558 
	`DBGPRINT_ERR
(("%: Thngth ivid\n", 
__FUNCTION__
));

3559 
out
;

3563 i(
pEid
->
Eid
 =
IE_WPA
)

3566 i(
n
 < (
RSNIE
))

3568 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: Thngth itosh܈f WPA\n", 
__FUNCTION__
));

3569 
out
;

3573 
PRSNIE
 
pR
;

3574 
UINT16
 
u_t
;

3576 
pR
 = (
PRSNIE
)
pBuf
;

3577 
u_t
 = 
	`u216
(
pR
->
ucou
);

3578 
offt
 = (
RSNIE
+ (
LEN_OUI_SUITE
 * (
u_t
 - 1));

3580 i(
n
 < 
offt
)

3582 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s : Thexpectedenght(%d)xceedheemainingength(%d) for WPA-RSN \n",

3583 
__FUNCTION__
, 
offt
, 
n
));

3584 
out
;

3589 i(
ty
 =
GROUP_SUITE
)

3591 *
cou
 = 1;

3592  
pR
->
m
;

3595 i(
ty
 =
PAIRWISE_SUITE
)

3597 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s : The count ofairwise cipher is %d\n",

3598 
__FUNCTION__
, 
u_t
));

3599 *
cou
 = 
u_t
;

3600  
pR
->
u
[0].
oui
;

3605 i(
pEid
->
Eid
 =
IE_RSN
)

3607 i(
n
 < (
RSNIE2
))

3609 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: Thngth itosh܈f WPA2\n", 
__FUNCTION__
));

3610 
out
;

3614 
PRSNIE2
 
pR2
;

3615 
UINT16
 
u_t
;

3617 
pR2
 = (
PRSNIE2
)
pBuf
;

3618 
u_t
 = 
	`u216
(
pR2
->
ucou
);

3619 
offt
 = (
RSNIE2
+ (
LEN_OUI_SUITE
 * (
u_t
 - 1));

3621 i(
n
 < 
offt
)

3623 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s : Thexpectedenght(%d)xceedheemainingength(%d) for WPA2-RSN \n",

3624 
__FUNCTION__
, 
offt
, 
n
));

3625 
out
;

3630 i(
ty
 =
GROUP_SUITE
)

3632 *
cou
 = 1;

3633  
pR2
->
m
;

3636 i(
ty
 =
PAIRWISE_SUITE
)

3638 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s : The count ofairwise cipher is %d\n",

3639 
__FUNCTION__
, 
u_t
));

3640 *
cou
 = 
u_t
;

3641  
pR2
->
u
[0].
oui
;

3648 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: UnknowIE (%d)\n", 
__FUNCTION__
, 
pEid
->
Eid
));

3649 
out
;

3653 
pBuf
 +
offt
;

3654 
n
 -
offt
;

3657 i(
n
 < (
RSNIE_AUTH
))

3659 
	`DBGPRINT_ERR
(("%: Thngth oAKM oRSN itosht\n", 
__FUNCTION__
));

3660 
out
;

3664 
PRSNIE_AUTH
 
pAkm
;

3665 
UINT16
 
a_t
;

3668 
pAkm
 = (
PRSNIE_AUTH
)
pBuf
;

3669 
a_t
 = 
	`u216
(
pAkm
->
acou
);

3670 
offt
 = (
RSNIE_AUTH
+ (
LEN_OUI_SUITE
 * (
a_t
 - 1));

3672 i(
n
 < 
offt
)

3674 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s : Thexpectedenght(%d)xceedheemainingength(%d) for AKM \n",

3675 
__FUNCTION__
, 
offt
, 
n
));

3676 
out
;

3681 i(
ty
 =
AKM_SUITE
)

3683 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s : The count of AKM is %d\n",

3684 
__FUNCTION__
, 
a_t
));

3685 *
cou
 = 
a_t
;

3686  
pAkm
->
auth
[0].
oui
;

3692 i(
pEid
->
Eid
 =
IE_WPA
)

3694 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s : Theemaining shall be ignored in WPA mode\n",

3695 
__FUNCTION__
));

3696 
out
;

3700 
pBuf
 +
offt
;

3701 
n
 -
offt
;

3704 i(
n
 < (
RSN_CAPABILITIES
))

3706 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%: Th RSNIE dۢ'udRSN-C\n", 
__FUNCTION__
));

3707 
out
;

3712 i(
ty
 =
RSN_CAP_INFO
)

3714 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%: Exa RSN Cabs\n", 
__FUNCTION__
));

3715 *
cou
 = 1;

3716  
pBuf
;

3720 
offt
 = (
RSN_CAPABILITIES
);

3721 
pBuf
 +
offt
;

3722 
n
 -
offt
;

3726 i(
n
 < (
UINT16
))

3728 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%: Th RSNIE dۢ'udPMKIDi Cou\n", 
__FUNCTION__
));

3729 
out
;

3733 
UINT16
 
p_cou
;

3734 
PUINT8
 
pPmkidLi
 = 
NULL
;

3736 
	`NdisMoveMemy
(&
p_cou
, 
pBuf
, (
UINT16
));

3737 
p_cou
 = 
	`u216
(p_count);

3740 i(
p_cou
 > 0)

3742 
PRSNIE_PMKID
 
pRPmkid
;

3745 
offt
 = (
RSNIE_PMKID
+ (
LEN_PMKID
 * (
p_cou
 - 1));

3748 i(
n
 < 
offt
)

3750 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s : Thexpectedenght(%d)xceedheemainingength(%d) in PMKID-field \n",

3751 
__FUNCTION__
, 
offt
, 
n
));

3752 
out
;

3756 
pRPmkid
 = (
PRSNIE_PMKID
)
pBuf
;

3757 
pPmkidLi
 = 
pRPmkid
->
pmkid
[0].
li
;

3763 
offt
 = (
UINT16
);

3764 
pPmkidLi
 = 
NULL
;

3769 i(
ty
 =
PMKID_LIST
)

3771 *
cou
 = 
p_cou
;

3772  
pPmkidLi
;

3776 
pBuf
 +
offt
;

3777 
n
 -
offt
;

3782 
out
:

3783 *
cou
 = 0;

3784  
NULL
;

3786 
	}
}

3788 
VOID
 
	$WShowAsue
(

3789 
IN
 
PUINT8
 
r
,

3790 
IN
 
UINT
 
r_n
)

3792 
PUINT8
 
pSue
 = 
NULL
;

3793 
UINT8
 
cou
;

3795 
	`hex_dump
("RSNIE", 
r
, 
r_n
);

3798 i((
pSue
 = 
	`WPA_ExaSueFromRSNIE
(
r
, 
r_n
, 
GROUP_SUITE
, &
cou
)!
NULL
)

3800 
	`hex_dump
("grouch", 
pSue
, 4*
cou
);

3804 i((
pSue
 = 
	`WPA_ExaSueFromRSNIE
(
r
, 
r_n
, 
PAIRWISE_SUITE
, &
cou
)!
NULL
)

3806 
	`hex_dump
("wi ch", 
pSue
, 4*
cou
);

3810 i((
pSue
 = 
	`WPA_ExaSueFromRSNIE
(
r
, 
r_n
, 
AKM_SUITE
, &
cou
)!
NULL
)

3812 
	`hex_dump
("AKM sue", 
pSue
, 4*
cou
);

3816 i((
pSue
 = 
	`WPA_ExaSueFromRSNIE
(
r
, 
r_n
, 
PMKID_LIST
, &
cou
)!
NULL
)

3818 
	`hex_dump
("PMKID", 
pSue
, 
LEN_PMKID
);

3821 
	}
}

3823 
VOID
 
	$RTMPInRSNIE
(

3824 
IN
 
PUCHAR
 
pFmeBuf
,

3825 
OUT
 
PULONG
 
pFmeL
,

3826 
IN
 
PUINT8
 
r_r
,

3827 
IN
 
UINT8
 
r_n
,

3828 
IN
 
PUINT8
 
pmkid_r
,

3829 
IN
 
UINT8
 
pmkid_n
)

3831 
PUCHAR
 
pTmpBuf
;

3832 
ULONG
 
TempL
 = 0;

3833 
UINT8
 
exa_n
 = 0;

3834 
UINT16
 
pmk_cou
 = 0;

3835 
UCHAR
 
_num
;

3836 
UINT8
 
tٮ_n
 = 0;

3837 
UCHAR
 
WPA2_OUI
[3]={0x00,0x0F,0xAC};

3839 
pTmpBuf
 = 
pFmeBuf
;

3842 i(
pmkid_n
 > 0 && ((pmkid_len & 0x0f) == 0))

3844 
exa_n
 = (
UINT16
+ 
pmkid_n
;

3846 
pmk_cou
 = (
pmkid_n
 >> 4);

3847 
pmk_cou
 = 
	`u216
(pmk_count);

3851 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s : Theength is PMKID-List is invalid (%d), so don't insert it.\n",

3852 
__FUNCTION__
, 
pmkid_n
));

3855 i(
r_n
 != 0)

3857 
_num
 = 
IE_WPA
;

3858 
tٮ_n
 = 
r_n
;

3860 i(
	`NdisEquMemy
(
r_r
 + 2, 
WPA2_OUI
, (WPA2_OUI)))

3862 
_num
 = 
IE_RSN
;

3863 
tٮ_n
 +
exa_n
;

3867 
	`MakeOutgogFme
(
pTmpBuf
, &
TempL
,

3868 1, &
_num
,

3869 1, &
tٮ_n
,

3870 
r_n
, 
r_r
,

3871 
END_OF_ARGS
);

3873 
pTmpBuf
 +
TempL
;

3874 *
pFmeL
 = *pFmeL + 
TempL
;

3876 i(
_num
 =
IE_RSN
)

3879 i(
exa_n
 > 0)

3881 
	`MakeOutgogFme
(
pTmpBuf
, &
TempL
,

3882 2, &
pmk_cou
,

3883 
pmkid_n
, 
pmkid_r
,

3884 
END_OF_ARGS
);

3886 
pTmpBuf
 +
TempL
;

3887 *
pFmeL
 = *pFmeL + 
TempL
;

3893 
	}
}

3896 
VOID
 
	$WPAInlPawiKey
(

3897 
PRTMP_ADAPTER
 
pAd
,

3898 
UINT8
 
BssIdx
,

3899 
PMAC_TABLE_ENTRY
 
pEry
,

3900 
BOOLEAN
 
bAE
)

3902 
	`NdisZoMemy
(&
pEry
->
PawiKey
, (
CIPHER_KEY
));

3905 i(
pEry
->
WStus
 =
Ndis802_11Enyi2Ebd
)

3906 
pEry
->
PawiKey
.
ChAlg
 = 
CIPHER_TKIP
;

3907 i(
pEry
->
WStus
 =
Ndis802_11Enyi3Ebd
)

3908 
pEry
->
PawiKey
.
ChAlg
 = 
CIPHER_AES
;

3911 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s : fails (wcid-%d)\n",

3912 
__FUNCTION__
, 
pEry
->
Aid
));

3917 
pEry
->
PawiKey
.
KeyL
 = 
LEN_TK
;

3918 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
Key
, &pEry->
PTK
[
OFFSET_OF_PTK_TK
], 
LEN_TK
);

3919 i(
pEry
->
PawiKey
.
ChAlg
 =
CIPHER_TKIP
)

3921 i(
bAE
)

3923 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
TxMic
, &pEry->
PTK
[
OFFSET_OF_AP_TKIP_TX_MIC
], 
LEN_TKIP_MIC
);

3924 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
RxMic
, &pEry->
PTK
[
OFFSET_OF_AP_TKIP_RX_MIC
], 
LEN_TKIP_MIC
);

3928 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
TxMic
, &pEry->
PTK
[
OFFSET_OF_STA_TKIP_TX_MIC
], 
LEN_TKIP_MIC
);

3929 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
RxMic
, &pEry->
PTK
[
OFFSET_OF_STA_TKIP_RX_MIC
], 
LEN_TKIP_MIC
);

3933 #ifde
SOFT_ENCRYPT


3934 i(
	`CLIENT_STATUS_TEST_FLAG
(
pEry
, 
fCLIENT_STATUS_SOFTWARE_ENCRYPT
))

3936 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> SW_ENC ON(wcid=%d\n", 
pEry
->
Aid
));

3937 
	`NdisZoMemy
(
pEry
->
PawiKey
.
TxTsc
, 
LEN_WPA_TSC
);

3938 
	`NdisZoMemy
(
pEry
->
PawiKey
.
RxTsc
, 
LEN_WPA_TSC
);

3944 
	`AsicAddPawiKeyEry
(

3945 
pAd
,

3946 (
UCHAR
)
pEry
->
Aid
,

3947 &
pEry
->
PawiKey
);

3949 
	`RTMPSWcidSecuryInfo
(
pAd
,

3950 
BssIdx
,

3952 
pEry
->
PawiKey
.
ChAlg
,

3953 (
UCHAR
)
pEry
->
Aid
,

3954 
PAIRWISEKEYTABLE
);

3957 
	}
}

3959 
VOID
 
	$WPAInlShedKey
(

3960 
PRTMP_ADAPTER
 
pAd
,

3961 
UINT8
 
GroupCh
,

3962 
UINT8
 
BssIdx
,

3963 
UINT8
 
KeyIdx
,

3964 
UINT8
 
Wcid
,

3965 
BOOLEAN
 
bAE
,

3966 
PUINT8
 
pGtk
)

3968 
PCIPHER_KEY
 
pShedKey
;

3970 i(
BssIdx
 >
MAX_MBSSID_NUM
)

3972 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s : The BSS-index(%d) is out ofange for MBSSIDink. \n",

3973 
__FUNCTION__
, 
BssIdx
));

3977 
pShedKey
 = &
pAd
->
ShedKey
[
BssIdx
][
KeyIdx
];

3978 
	`NdisZoMemy
(
pShedKey
, (
CIPHER_KEY
));

3980 i(
GroupCh
 =
Ndis802_11Enyi2Ebd
)

3981 
pShedKey
->
ChAlg
 = 
CIPHER_TKIP
;

3982 i(
GroupCh
 =
Ndis802_11Enyi3Ebd
)

3983 
pShedKey
->
ChAlg
 = 
CIPHER_AES
;

3986 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s : fails (IF/ra%d) \n",

3987 
__FUNCTION__
, 
BssIdx
));

3991 
pShedKey
->
KeyL
 = 
LEN_TK
;

3992 
	`NdisMoveMemy
(
pShedKey
->
Key
, 
pGtk
, 
LEN_TK
);

3993 i(
pShedKey
->
ChAlg
 =
CIPHER_TKIP
)

3995 i(
bAE
)

3997 
	`NdisMoveMemy
(
pShedKey
->
TxMic
, 
pGtk
 + 16, 
LEN_TKIP_MIC
);

3998 
	`NdisMoveMemy
(
pShedKey
->
RxMic
, 
pGtk
 + 24, 
LEN_TKIP_MIC
);

4002 
	`NdisMoveMemy
(
pShedKey
->
TxMic
, 
pGtk
 + 24, 
LEN_TKIP_MIC
);

4003 
	`NdisMoveMemy
(
pShedKey
->
RxMic
, 
pGtk
 + 16, 
LEN_TKIP_MIC
);

4008 
	`AsicAddShedKeyEry
(

4009 
pAd
,

4010 
BssIdx
,

4011 
KeyIdx
,

4012 
pShedKey
);

4017 i(
Wcid
 != 0)

4019 
	`RTMPSWcidSecuryInfo
(
pAd
,

4020 
BssIdx
,

4021 
KeyIdx
,

4022 
pShedKey
->
ChAlg
,

4023 
Wcid
,

4024 
SHAREDKEYTABLE
);

4026 
	}
}

4028 
VOID
 
	$RTMPSWcidSecuryInfo
(

4029 
PRTMP_ADAPTER
 
pAd
,

4030 
UINT8
 
BssIdx
,

4031 
UINT8
 
KeyIdx
,

4032 
UINT8
 
ChAlg
,

4033 
UINT8
 
Wcid
,

4034 
UINT8
 
KeyTabFg
)

4036 
UINT32
 
IV
 = 0;

4037 
UINT8
 
IV_KEYID
 = 0;

4040 i(
ChAlg
 =
CIPHER_WEP64
 || ChAlg =
CIPHER_WEP128
)

4042 
INT
 
i
;

4043 
UCHAR
 
TxTsc
[
LEN_WEP_TSC
];

4046 
i
 = 0; i < 
LEN_WEP_TSC
; i++)

4047 
TxTsc
[
i
] = 
	`RdomBy
(
pAd
);

4050 
IV_KEYID
 = (
KeyIdx
 << 6);

4051 
IV
 = (
IV_KEYID
 << 24) |

4052 (
TxTsc
[2] << 16) |

4053 (
TxTsc
[1] << 8) |

4054 (
TxTsc
[0]);

4056 i(
ChAlg
 =
CIPHER_TKIP
 || ChAlg =
CIPHER_AES
)

4063 
IV_KEYID
 = (
KeyIdx
 << 6) | 0x20;

4064 
IV
 = (
IV_KEYID
 << 24) | 1;

4068 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s : Unsupport cipher Alg (%d) for Wcid-%d \n",

4069 
__FUNCTION__
, 
ChAlg
, 
Wcid
));

4073 
	`AsicUpdeWCIDIVEIV
(
pAd
, 
Wcid
, 
IV
, 0);

4076 
	`AsicUpdeWcidAribuEry
(
pAd
,

4077 
BssIdx
,

4078 
KeyIdx
,

4079 
ChAlg
,

4080 
Wcid
,

4081 
KeyTabFg
);

4083 
	}
}

	@common/crypt_aes.c

28 
	~"y_s.h
"

31 
	#as
(
a
)

32 

	)

33 #unde
u32


34 
	#u32
 

	)

37 cڡ 
u32
 
	gTe0
[256] = {

103 cڡ 
u32
 
	gTe1
[256] = {

169 cڡ 
u32
 
	gTe2
[256] = {

235 cڡ 
u32
 
	gTe3
[256] = {

302 cڡ 
u32
 
	gTe4
[256] = {

369 cڡ 
u32
 
	gTd0
[256] = {

435 cڡ 
u32
 
	gTd1
[256] = {

501 cڡ 
u32
 
	gTd2
[256] = {

567 cڡ 
u32
 
	gTd3
[256] = {

634 cڡ 
u32
 
	gTd4
[256] = {

701 cڡ 
u32
 
	grc
[] = {

711 
	$evp_s_y
(cڡ *

, *
out
, cڡ 
AES_KEY
 *
key
)

714 cڡ 
u32
 *
rk
;

715 
u32
 
s0
, 
s1
, 
s2
, 
s3
, 
t0
, 
t1
, 
t2
, 
t3
;

716 #ide
FULL_UNROLL


717 
r
;

720 
	`as
(

 && 
out
 && 
key
);

721 
rk
 = 
key
->
rd_key
;

727 
s0
 = 
	`GETU32
(

 ) ^ 
rk
[0];

728 
s1
 = 
	`GETU32
(

 + 4^ 
rk
[1];

729 
s2
 = 
	`GETU32
(

 + 8^ 
rk
[2];

730 
s3
 = 
	`GETU32
(

 + 12^ 
rk
[3];

731 #ifde
FULL_UNROLL


733 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16& 0xff] ^ 
Te2
[(
s2
 >> 8& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[ 4];

734 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16& 0xff] ^ 
Te2
[(
s3
 >> 8& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[ 5];

735 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16& 0xff] ^ 
Te2
[(
s0
 >> 8& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[ 6];

736 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16& 0xff] ^ 
Te2
[(
s1
 >> 8& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[ 7];

738 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16& 0xff] ^ 
Te2
[(
t2
 >> 8& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[ 8];

739 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16& 0xff] ^ 
Te2
[(
t3
 >> 8& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[ 9];

740 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16& 0xff] ^ 
Te2
[(
t0
 >> 8& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[10];

741 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16& 0xff] ^ 
Te2
[(
t1
 >> 8& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[11];

743 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16& 0xff] ^ 
Te2
[(
s2
 >> 8& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[12];

744 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16& 0xff] ^ 
Te2
[(
s3
 >> 8& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[13];

745 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16& 0xff] ^ 
Te2
[(
s0
 >> 8& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[14];

746 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16& 0xff] ^ 
Te2
[(
s1
 >> 8& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[15];

748 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16& 0xff] ^ 
Te2
[(
t2
 >> 8& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[16];

749 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16& 0xff] ^ 
Te2
[(
t3
 >> 8& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[17];

750 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16& 0xff] ^ 
Te2
[(
t0
 >> 8& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[18];

751 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16& 0xff] ^ 
Te2
[(
t1
 >> 8& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[19];

753 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16& 0xff] ^ 
Te2
[(
s2
 >> 8& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[20];

754 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16& 0xff] ^ 
Te2
[(
s3
 >> 8& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[21];

755 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16& 0xff] ^ 
Te2
[(
s0
 >> 8& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[22];

756 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16& 0xff] ^ 
Te2
[(
s1
 >> 8& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[23];

758 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16& 0xff] ^ 
Te2
[(
t2
 >> 8& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[24];

759 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16& 0xff] ^ 
Te2
[(
t3
 >> 8& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[25];

760 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16& 0xff] ^ 
Te2
[(
t0
 >> 8& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[26];

761 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16& 0xff] ^ 
Te2
[(
t1
 >> 8& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[27];

763 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16& 0xff] ^ 
Te2
[(
s2
 >> 8& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[28];

764 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16& 0xff] ^ 
Te2
[(
s3
 >> 8& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[29];

765 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16& 0xff] ^ 
Te2
[(
s0
 >> 8& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[30];

766 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16& 0xff] ^ 
Te2
[(
s1
 >> 8& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[31];

768 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16& 0xff] ^ 
Te2
[(
t2
 >> 8& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[32];

769 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16& 0xff] ^ 
Te2
[(
t3
 >> 8& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[33];

770 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16& 0xff] ^ 
Te2
[(
t0
 >> 8& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[34];

771 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16& 0xff] ^ 
Te2
[(
t1
 >> 8& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[35];

773 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16& 0xff] ^ 
Te2
[(
s2
 >> 8& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[36];

774 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16& 0xff] ^ 
Te2
[(
s3
 >> 8& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[37];

775 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16& 0xff] ^ 
Te2
[(
s0
 >> 8& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[38];

776 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16& 0xff] ^ 
Te2
[(
s1
 >> 8& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[39];

777 i(
key
->
rounds
 > 10) {

779 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16& 0xff] ^ 
Te2
[(
t2
 >> 8& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[40];

780 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16& 0xff] ^ 
Te2
[(
t3
 >> 8& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[41];

781 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16& 0xff] ^ 
Te2
[(
t0
 >> 8& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[42];

782 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16& 0xff] ^ 
Te2
[(
t1
 >> 8& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[43];

784 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16& 0xff] ^ 
Te2
[(
s2
 >> 8& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[44];

785 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16& 0xff] ^ 
Te2
[(
s3
 >> 8& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[45];

786 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16& 0xff] ^ 
Te2
[(
s0
 >> 8& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[46];

787 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16& 0xff] ^ 
Te2
[(
s1
 >> 8& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[47];

788 i(
key
->
rounds
 > 12) {

790 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16& 0xff] ^ 
Te2
[(
t2
 >> 8& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[48];

791 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16& 0xff] ^ 
Te2
[(
t3
 >> 8& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[49];

792 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16& 0xff] ^ 
Te2
[(
t0
 >> 8& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[50];

793 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16& 0xff] ^ 
Te2
[(
t1
 >> 8& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[51];

795 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16& 0xff] ^ 
Te2
[(
s2
 >> 8& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[52];

796 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16& 0xff] ^ 
Te2
[(
s3
 >> 8& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[53];

797 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16& 0xff] ^ 
Te2
[(
s0
 >> 8& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[54];

798 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16& 0xff] ^ 
Te2
[(
s1
 >> 8& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[55];

801 
rk
 +
key
->
rounds
 << 2;

806 
r
 = 
key
->
rounds
 >> 1;

808 
t0
 =

809 
Te0
[(
s0
 >> 24) ] ^

810 
Te1
[(
s1
 >> 16) & 0xff] ^

811 
Te2
[(
s2
 >> 8) & 0xff] ^

812 
Te3
[(
s3
 ) & 0xff] ^

813 
rk
[4];

814 
t1
 =

815 
Te0
[(
s1
 >> 24) ] ^

816 
Te1
[(
s2
 >> 16) & 0xff] ^

817 
Te2
[(
s3
 >> 8) & 0xff] ^

818 
Te3
[(
s0
 ) & 0xff] ^

819 
rk
[5];

820 
t2
 =

821 
Te0
[(
s2
 >> 24) ] ^

822 
Te1
[(
s3
 >> 16) & 0xff] ^

823 
Te2
[(
s0
 >> 8) & 0xff] ^

824 
Te3
[(
s1
 ) & 0xff] ^

825 
rk
[6];

826 
t3
 =

827 
Te0
[(
s3
 >> 24) ] ^

828 
Te1
[(
s0
 >> 16) & 0xff] ^

829 
Te2
[(
s1
 >> 8) & 0xff] ^

830 
Te3
[(
s2
 ) & 0xff] ^

831 
rk
[7];

833 
rk
 += 8;

834 i(--
r
 == 0) {

838 
s0
 =

839 
Te0
[(
t0
 >> 24) ] ^

840 
Te1
[(
t1
 >> 16) & 0xff] ^

841 
Te2
[(
t2
 >> 8) & 0xff] ^

842 
Te3
[(
t3
 ) & 0xff] ^

843 
rk
[0];

844 
s1
 =

845 
Te0
[(
t1
 >> 24) ] ^

846 
Te1
[(
t2
 >> 16) & 0xff] ^

847 
Te2
[(
t3
 >> 8) & 0xff] ^

848 
Te3
[(
t0
 ) & 0xff] ^

849 
rk
[1];

850 
s2
 =

851 
Te0
[(
t2
 >> 24) ] ^

852 
Te1
[(
t3
 >> 16) & 0xff] ^

853 
Te2
[(
t0
 >> 8) & 0xff] ^

854 
Te3
[(
t1
 ) & 0xff] ^

855 
rk
[2];

856 
s3
 =

857 
Te0
[(
t3
 >> 24) ] ^

858 
Te1
[(
t0
 >> 16) & 0xff] ^

859 
Te2
[(
t1
 >> 8) & 0xff] ^

860 
Te3
[(
t2
 ) & 0xff] ^

861 
rk
[3];

868 
s0
 =

869 (
Te4
[(
t0
 >> 24) ] & 0xff000000) ^

870 (
Te4
[(
t1
 >> 16) & 0xff] & 0x00ff0000) ^

871 (
Te4
[(
t2
 >> 8) & 0xff] & 0x0000ff00) ^

872 (
Te4
[(
t3
 ) & 0xff] & 0x000000ff) ^

873 
rk
[0];

874 
	`PUTU32
(
out
 , 
s0
);

875 
s1
 =

876 (
Te4
[(
t1
 >> 24) ] & 0xff000000) ^

877 (
Te4
[(
t2
 >> 16) & 0xff] & 0x00ff0000) ^

878 (
Te4
[(
t3
 >> 8) & 0xff] & 0x0000ff00) ^

879 (
Te4
[(
t0
 ) & 0xff] & 0x000000ff) ^

880 
rk
[1];

881 
	`PUTU32
(
out
 + 4, 
s1
);

882 
s2
 =

883 (
Te4
[(
t2
 >> 24) ] & 0xff000000) ^

884 (
Te4
[(
t3
 >> 16) & 0xff] & 0x00ff0000) ^

885 (
Te4
[(
t0
 >> 8) & 0xff] & 0x0000ff00) ^

886 (
Te4
[(
t1
 ) & 0xff] & 0x000000ff) ^

887 
rk
[2];

888 
	`PUTU32
(
out
 + 8, 
s2
);

889 
s3
 =

890 (
Te4
[(
t3
 >> 24) ] & 0xff000000) ^

891 (
Te4
[(
t0
 >> 16) & 0xff] & 0x00ff0000) ^

892 (
Te4
[(
t1
 >> 8) & 0xff] & 0x0000ff00) ^

893 (
Te4
[(
t2
 ) & 0xff] & 0x000000ff) ^

894 
rk
[3];

895 
	`PUTU32
(
out
 + 12, 
s3
);

896 
	}
}

902 
	$evp_s_dey
(cڡ *

, *
out
, cڡ 
AES_KEY
 *
key
)

905 cڡ 
u32
 *
rk
;

906 
u32
 
s0
, 
s1
, 
s2
, 
s3
, 
t0
, 
t1
, 
t2
, 
t3
;

907 #ide
FULL_UNROLL


908 
r
;

911 
	`as
(

 && 
out
 && 
key
);

912 
rk
 = 
key
->
rd_key
;

918 
s0
 = 
	`GETU32
(

 ) ^ 
rk
[0];

919 
s1
 = 
	`GETU32
(

 + 4^ 
rk
[1];

920 
s2
 = 
	`GETU32
(

 + 8^ 
rk
[2];

921 
s3
 = 
	`GETU32
(

 + 12^ 
rk
[3];

922 #ifde
FULL_UNROLL


924 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16& 0xff] ^ 
Td2
[(
s2
 >> 8& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[ 4];

925 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16& 0xff] ^ 
Td2
[(
s3
 >> 8& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[ 5];

926 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16& 0xff] ^ 
Td2
[(
s0
 >> 8& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[ 6];

927 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16& 0xff] ^ 
Td2
[(
s1
 >> 8& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[ 7];

929 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16& 0xff] ^ 
Td2
[(
t2
 >> 8& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[ 8];

930 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16& 0xff] ^ 
Td2
[(
t3
 >> 8& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[ 9];

931 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16& 0xff] ^ 
Td2
[(
t0
 >> 8& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[10];

932 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16& 0xff] ^ 
Td2
[(
t1
 >> 8& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[11];

934 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16& 0xff] ^ 
Td2
[(
s2
 >> 8& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[12];

935 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16& 0xff] ^ 
Td2
[(
s3
 >> 8& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[13];

936 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16& 0xff] ^ 
Td2
[(
s0
 >> 8& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[14];

937 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16& 0xff] ^ 
Td2
[(
s1
 >> 8& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[15];

939 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16& 0xff] ^ 
Td2
[(
t2
 >> 8& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[16];

940 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16& 0xff] ^ 
Td2
[(
t3
 >> 8& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[17];

941 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16& 0xff] ^ 
Td2
[(
t0
 >> 8& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[18];

942 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16& 0xff] ^ 
Td2
[(
t1
 >> 8& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[19];

944 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16& 0xff] ^ 
Td2
[(
s2
 >> 8& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[20];

945 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16& 0xff] ^ 
Td2
[(
s3
 >> 8& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[21];

946 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16& 0xff] ^ 
Td2
[(
s0
 >> 8& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[22];

947 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16& 0xff] ^ 
Td2
[(
s1
 >> 8& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[23];

949 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16& 0xff] ^ 
Td2
[(
t2
 >> 8& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[24];

950 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16& 0xff] ^ 
Td2
[(
t3
 >> 8& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[25];

951 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16& 0xff] ^ 
Td2
[(
t0
 >> 8& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[26];

952 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16& 0xff] ^ 
Td2
[(
t1
 >> 8& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[27];

954 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16& 0xff] ^ 
Td2
[(
s2
 >> 8& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[28];

955 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16& 0xff] ^ 
Td2
[(
s3
 >> 8& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[29];

956 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16& 0xff] ^ 
Td2
[(
s0
 >> 8& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[30];

957 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16& 0xff] ^ 
Td2
[(
s1
 >> 8& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[31];

959 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16& 0xff] ^ 
Td2
[(
t2
 >> 8& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[32];

960 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16& 0xff] ^ 
Td2
[(
t3
 >> 8& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[33];

961 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16& 0xff] ^ 
Td2
[(
t0
 >> 8& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[34];

962 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16& 0xff] ^ 
Td2
[(
t1
 >> 8& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[35];

964 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16& 0xff] ^ 
Td2
[(
s2
 >> 8& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[36];

965 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16& 0xff] ^ 
Td2
[(
s3
 >> 8& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[37];

966 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16& 0xff] ^ 
Td2
[(
s0
 >> 8& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[38];

967 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16& 0xff] ^ 
Td2
[(
s1
 >> 8& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[39];

968 i(
key
->
rounds
 > 10) {

970 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16& 0xff] ^ 
Td2
[(
t2
 >> 8& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[40];

971 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16& 0xff] ^ 
Td2
[(
t3
 >> 8& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[41];

972 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16& 0xff] ^ 
Td2
[(
t0
 >> 8& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[42];

973 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16& 0xff] ^ 
Td2
[(
t1
 >> 8& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[43];

975 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16& 0xff] ^ 
Td2
[(
s2
 >> 8& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[44];

976 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16& 0xff] ^ 
Td2
[(
s3
 >> 8& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[45];

977 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16& 0xff] ^ 
Td2
[(
s0
 >> 8& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[46];

978 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16& 0xff] ^ 
Td2
[(
s1
 >> 8& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[47];

979 i(
key
->
rounds
 > 12) {

981 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16& 0xff] ^ 
Td2
[(
t2
 >> 8& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[48];

982 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16& 0xff] ^ 
Td2
[(
t3
 >> 8& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[49];

983 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16& 0xff] ^ 
Td2
[(
t0
 >> 8& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[50];

984 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16& 0xff] ^ 
Td2
[(
t1
 >> 8& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[51];

986 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16& 0xff] ^ 
Td2
[(
s2
 >> 8& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[52];

987 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16& 0xff] ^ 
Td2
[(
s3
 >> 8& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[53];

988 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16& 0xff] ^ 
Td2
[(
s0
 >> 8& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[54];

989 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16& 0xff] ^ 
Td2
[(
s1
 >> 8& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[55];

992 
rk
 +
key
->
rounds
 << 2;

997 
r
 = 
key
->
rounds
 >> 1;

999 
t0
 =

1000 
Td0
[(
s0
 >> 24) ] ^

1001 
Td1
[(
s3
 >> 16) & 0xff] ^

1002 
Td2
[(
s2
 >> 8) & 0xff] ^

1003 
Td3
[(
s1
 ) & 0xff] ^

1004 
rk
[4];

1005 
t1
 =

1006 
Td0
[(
s1
 >> 24) ] ^

1007 
Td1
[(
s0
 >> 16) & 0xff] ^

1008 
Td2
[(
s3
 >> 8) & 0xff] ^

1009 
Td3
[(
s2
 ) & 0xff] ^

1010 
rk
[5];

1011 
t2
 =

1012 
Td0
[(
s2
 >> 24) ] ^

1013 
Td1
[(
s1
 >> 16) & 0xff] ^

1014 
Td2
[(
s0
 >> 8) & 0xff] ^

1015 
Td3
[(
s3
 ) & 0xff] ^

1016 
rk
[6];

1017 
t3
 =

1018 
Td0
[(
s3
 >> 24) ] ^

1019 
Td1
[(
s2
 >> 16) & 0xff] ^

1020 
Td2
[(
s1
 >> 8) & 0xff] ^

1021 
Td3
[(
s0
 ) & 0xff] ^

1022 
rk
[7];

1024 
rk
 += 8;

1025 i(--
r
 == 0) {

1029 
s0
 =

1030 
Td0
[(
t0
 >> 24) ] ^

1031 
Td1
[(
t3
 >> 16) & 0xff] ^

1032 
Td2
[(
t2
 >> 8) & 0xff] ^

1033 
Td3
[(
t1
 ) & 0xff] ^

1034 
rk
[0];

1035 
s1
 =

1036 
Td0
[(
t1
 >> 24) ] ^

1037 
Td1
[(
t0
 >> 16) & 0xff] ^

1038 
Td2
[(
t3
 >> 8) & 0xff] ^

1039 
Td3
[(
t2
 ) & 0xff] ^

1040 
rk
[1];

1041 
s2
 =

1042 
Td0
[(
t2
 >> 24) ] ^

1043 
Td1
[(
t1
 >> 16) & 0xff] ^

1044 
Td2
[(
t0
 >> 8) & 0xff] ^

1045 
Td3
[(
t3
 ) & 0xff] ^

1046 
rk
[2];

1047 
s3
 =

1048 
Td0
[(
t3
 >> 24) ] ^

1049 
Td1
[(
t2
 >> 16) & 0xff] ^

1050 
Td2
[(
t1
 >> 8) & 0xff] ^

1051 
Td3
[(
t0
 ) & 0xff] ^

1052 
rk
[3];

1059 
s0
 =

1060 (
Td4
[(
t0
 >> 24) ] & 0xff000000) ^

1061 (
Td4
[(
t3
 >> 16) & 0xff] & 0x00ff0000) ^

1062 (
Td4
[(
t2
 >> 8) & 0xff] & 0x0000ff00) ^

1063 (
Td4
[(
t1
 ) & 0xff] & 0x000000ff) ^

1064 
rk
[0];

1065 
	`PUTU32
(
out
 , 
s0
);

1066 
s1
 =

1067 (
Td4
[(
t1
 >> 24) ] & 0xff000000) ^

1068 (
Td4
[(
t0
 >> 16) & 0xff] & 0x00ff0000) ^

1069 (
Td4
[(
t3
 >> 8) & 0xff] & 0x0000ff00) ^

1070 (
Td4
[(
t2
 ) & 0xff] & 0x000000ff) ^

1071 
rk
[1];

1072 
	`PUTU32
(
out
 + 4, 
s1
);

1073 
s2
 =

1074 (
Td4
[(
t2
 >> 24) ] & 0xff000000) ^

1075 (
Td4
[(
t1
 >> 16) & 0xff] & 0x00ff0000) ^

1076 (
Td4
[(
t0
 >> 8) & 0xff] & 0x0000ff00) ^

1077 (
Td4
[(
t3
 ) & 0xff] & 0x000000ff) ^

1078 
rk
[2];

1079 
	`PUTU32
(
out
 + 8, 
s2
);

1080 
s3
 =

1081 (
Td4
[(
t3
 >> 24) ] & 0xff000000) ^

1082 (
Td4
[(
t2
 >> 16) & 0xff] & 0x00ff0000) ^

1083 (
Td4
[(
t1
 >> 8) & 0xff] & 0x0000ff00) ^

1084 (
Td4
[(
t0
 ) & 0xff] & 0x000000ff) ^

1085 
rk
[3];

1086 
	`PUTU32
(
out
 + 12, 
s3
);

1087 
	}
}

1092 
	$AES_t_y_key
(cڡ *
urKey
, cڡ 
bs
, 
AES_KEY
 *
key
)

1095 
u32
 *
rk
;

1096 
i
 = 0;

1097 
u32
 
mp
;

1099 i(!
urKey
 || !
key
)

1101 i(
bs
 != 128 && bits != 192 && bits != 256)

1104 
rk
 = 
key
->
rd_key
;

1106 i(
bs
==128)

1107 
key
->
rounds
 = 10;

1108 i(
bs
==192)

1109 
key
->
rounds
 = 12;

1111 
key
->
rounds
 = 14;

1113 
rk
[0] = 
	`GETU32
(
urKey
 );

1114 
rk
[1] = 
	`GETU32
(
urKey
 + 4);

1115 
rk
[2] = 
	`GETU32
(
urKey
 + 8);

1116 
rk
[3] = 
	`GETU32
(
urKey
 + 12);

1117 i(
bs
 == 128) {

1119 
mp
 = 
rk
[3];

1120 
rk
[4] =k[0] ^

1121 (
Te4
[(
mp
 >> 16) & 0xff] & 0xff000000) ^

1122 (
Te4
[(
mp
 >> 8) & 0xff] & 0x00ff0000) ^

1123 (
Te4
[(
mp
 ) & 0xff] & 0x0000ff00) ^

1124 (
Te4
[(
mp
 >> 24) ] & 0x000000ff) ^

1125 
rc
[
i
];

1126 
rk
[5] =k[1] ^k[4];

1127 
rk
[6] =k[2] ^k[5];

1128 
rk
[7] =k[3] ^k[6];

1129 i(++
i
 == 10) {

1132 
rk
 += 4;

1135 
rk
[4] = 
	`GETU32
(
urKey
 + 16);

1136 
rk
[5] = 
	`GETU32
(
urKey
 + 20);

1137 i(
bs
 == 192) {

1139 
mp
 = 
rk
[ 5];

1140 
rk
[ 6] =k[ 0] ^

1141 (
Te4
[(
mp
 >> 16) & 0xff] & 0xff000000) ^

1142 (
Te4
[(
mp
 >> 8) & 0xff] & 0x00ff0000) ^

1143 (
Te4
[(
mp
 ) & 0xff] & 0x0000ff00) ^

1144 (
Te4
[(
mp
 >> 24) ] & 0x000000ff) ^

1145 
rc
[
i
];

1146 
rk
[ 7] =k[ 1] ^k[ 6];

1147 
rk
[ 8] =k[ 2] ^k[ 7];

1148 
rk
[ 9] =k[ 3] ^k[ 8];

1149 i(++
i
 == 8) {

1152 
rk
[10] =k[ 4] ^k[ 9];

1153 
rk
[11] =k[ 5] ^k[10];

1154 
rk
 += 6;

1157 
rk
[6] = 
	`GETU32
(
urKey
 + 24);

1158 
rk
[7] = 
	`GETU32
(
urKey
 + 28);

1159 i(
bs
 == 256) {

1161 
mp
 = 
rk
[ 7];

1162 
rk
[ 8] =k[ 0] ^

1163 (
Te4
[(
mp
 >> 16) & 0xff] & 0xff000000) ^

1164 (
Te4
[(
mp
 >> 8) & 0xff] & 0x00ff0000) ^

1165 (
Te4
[(
mp
 ) & 0xff] & 0x0000ff00) ^

1166 (
Te4
[(
mp
 >> 24) ] & 0x000000ff) ^

1167 
rc
[
i
];

1168 
rk
[ 9] =k[ 1] ^k[ 8];

1169 
rk
[10] =k[ 2] ^k[ 9];

1170 
rk
[11] =k[ 3] ^k[10];

1171 i(++
i
 == 7) {

1174 
mp
 = 
rk
[11];

1175 
rk
[12] =k[ 4] ^

1176 (
Te4
[(
mp
 >> 24) ] & 0xff000000) ^

1177 (
Te4
[(
mp
 >> 16) & 0xff] & 0x00ff0000) ^

1178 (
Te4
[(
mp
 >> 8) & 0xff] & 0x0000ff00) ^

1179 (
Te4
[(
mp
 ) & 0xff] & 0x000000ff);

1180 
rk
[13] =k[ 5] ^k[12];

1181 
rk
[14] =k[ 6] ^k[13];

1182 
rk
[15] =k[ 7] ^k[14];

1184 
rk
 += 8;

1188 
	}
}

1190 
	$evp_s_cbc_y
(cڡ *

, *
out
,

1191 cڡ 
ngth
, cڡ 
AES_KEY
 *
key
,

1192 *
ivec
, cڡ 
c
)

1195 
n
;

1196 
n
 = 
ngth
;

1197 
tmp
[
AES_BLOCK_SIZE
];

1198 cڡ *
iv
 = 
ivec
;

1200 
	`as
(

 && 
out
 && 
key
 && 
ivec
);

1201 
	`as
((
AES_ENCRYPT
 =
c
)||(
AES_DECRYPT
 ==nc));

1203 i(
AES_ENCRYPT
 =
c
) {

1204 
n
 >
AES_BLOCK_SIZE
) {

1205 
n
=0; < 
AES_BLOCK_SIZE
; ++n)

1206 
out
[
n
] = 

[n] ^ 
iv
[n];

1207 
	`evp_s_y
(
out
, out, 
key
);

1208 
iv
 = 
out
;

1209 
n
 -
AES_BLOCK_SIZE
;

1210 

 +
AES_BLOCK_SIZE
;

1211 
out
 +
AES_BLOCK_SIZE
;

1213 i(
n
) {

1214 
n
=0; < 
n
; ++n)

1215 
out
[
n
] = 

[n] ^ 
iv
[n];

1216 
n
=
n
; < 
AES_BLOCK_SIZE
; ++n)

1217 
out
[
n
] = 
iv
[n];

1218 
	`evp_s_y
(
out
, out, 
key
);

1219 
iv
 = 
out
;

1221 
	`memy
(
ivec
,
iv
,
AES_BLOCK_SIZE
);

1222 } i(

 !
out
) {

1223 
n
 >
AES_BLOCK_SIZE
) {

1224 
	`evp_s_dey
(

, 
out
, 
key
);

1225 
n
=0; < 
AES_BLOCK_SIZE
; ++n)

1226 
out
[
n
] ^
iv
[n];

1227 
iv
 = 

;

1228 
n
 -
AES_BLOCK_SIZE
;

1229 

 +
AES_BLOCK_SIZE
;

1230 
out
 +
AES_BLOCK_SIZE
;

1232 i(
n
) {

1233 
	`evp_s_dey
(

,
tmp
,
key
);

1234 
n
=0; < 
n
; ++n)

1235 
out
[
n
] = 
tmp
[n] ^ 
iv
[n];

1236 
iv
 = 

;

1238 
	`memy
(
ivec
,
iv
,
AES_BLOCK_SIZE
);

1240 
n
 >
AES_BLOCK_SIZE
) {

1241 
	`memy
(
tmp
, 

, 
AES_BLOCK_SIZE
);

1242 
	`evp_s_dey
(

, 
out
, 
key
);

1243 
n
=0; < 
AES_BLOCK_SIZE
; ++n)

1244 
out
[
n
] ^
ivec
[n];

1245 
	`memy
(
ivec
, 
tmp
, 
AES_BLOCK_SIZE
);

1246 
n
 -
AES_BLOCK_SIZE
;

1247 

 +
AES_BLOCK_SIZE
;

1248 
out
 +
AES_BLOCK_SIZE
;

1250 i(
n
) {

1251 
	`memy
(
tmp
, 

, 
AES_BLOCK_SIZE
);

1252 
	`evp_s_dey
(
tmp
, 
out
, 
key
);

1253 
n
=0; < 
n
; ++n)

1254 
out
[
n
] ^
ivec
[n];

1255 
n
=
n
; < 
AES_BLOCK_SIZE
; ++n)

1256 
out
[
n
] = 
tmp
[n];

1257 
	`memy
(
ivec
, 
tmp
, 
AES_BLOCK_SIZE
);

1260 
	}
}

1265 
	$AES_t_dey_key
(cڡ *
urKey
, cڡ 
bs
, 
AES_KEY
 *
key
)

1268 
u32
 *
rk
;

1269 
i
, 
j
, 
us
;

1270 
u32
 
mp
;

1273 
us
 = 
	`AES_t_y_key
(
urKey
, 
bs
, 
key
);

1274 i(
us
 < 0)

1275  
us
;

1277 
rk
 = 
key
->
rd_key
;

1280 
i
 = 0, 
j
 = 4*(
key
->
rounds
); i < j; i += 4, j -= 4) {

1281 
mp
 = 
rk
[
i
 ];k[] =k[
j
 ];k[j ] =emp;

1282 
mp
 = 
rk
[
i
 + 1];k[+ 1] =k[
j
 + 1];k[j + 1] =emp;

1283 
mp
 = 
rk
[
i
 + 2];k[+ 2] =k[
j
 + 2];k[j + 2] =emp;

1284 
mp
 = 
rk
[
i
 + 3];k[+ 3] =k[
j
 + 3];k[j + 3] =emp;

1287 
i
 = 1; i < (
key
->
rounds
); i++) {

1288 
rk
 += 4;

1289 
rk
[0] =

1290 
Td0
[
Te4
[(
rk
[0] >> 24) ] & 0xff] ^

1291 
Td1
[
Te4
[(
rk
[0] >> 16) & 0xff] & 0xff] ^

1292 
Td2
[
Te4
[(
rk
[0] >> 8) & 0xff] & 0xff] ^

1293 
Td3
[
Te4
[(
rk
[0] ) & 0xff] & 0xff];

1294 
rk
[1] =

1295 
Td0
[
Te4
[(
rk
[1] >> 24) ] & 0xff] ^

1296 
Td1
[
Te4
[(
rk
[1] >> 16) & 0xff] & 0xff] ^

1297 
Td2
[
Te4
[(
rk
[1] >> 8) & 0xff] & 0xff] ^

1298 
Td3
[
Te4
[(
rk
[1] ) & 0xff] & 0xff];

1299 
rk
[2] =

1300 
Td0
[
Te4
[(
rk
[2] >> 24) ] & 0xff] ^

1301 
Td1
[
Te4
[(
rk
[2] >> 16) & 0xff] & 0xff] ^

1302 
Td2
[
Te4
[(
rk
[2] >> 8) & 0xff] & 0xff] ^

1303 
Td3
[
Te4
[(
rk
[2] ) & 0xff] & 0xff];

1304 
rk
[3] =

1305 
Td0
[
Te4
[(
rk
[3] >> 24) ] & 0xff] ^

1306 
Td1
[
Te4
[(
rk
[3] >> 16) & 0xff] & 0xff] ^

1307 
Td2
[
Te4
[(
rk
[3] >> 8) & 0xff] & 0xff] ^

1308 
Td3
[
Te4
[(
rk
[3] ) & 0xff] & 0xff];

1311 
	}
}

1313 
	$EVP_s_128_cbc
()

1316 
	}
}

1318 
	$EVP_EnyIn
(
EVP_CIPHER_CTX
 *
x
, 
ty
, *
key
, *
iv
)

1320 
t
;

1322 
	`memt
(
x
, 0x00, (
EVP_CIPHER_CTX
));

1324 
x
->
ag
 = 1;

1325 
x
->
ty
 =ype;

1326 
x
->
y
 = 1;

1329 
	`memy
(
x
->
key
, key, 16);

1330 
	`memy
(
x
->
iv
, iv, 16);

1332 
t
 = 
	`AES_t_y_key
(
key
, 128, &
x
->
sKey
);

1334  
t
;

1335 
	}
}

1337 
	$EVP_EnyUpde
(
EVP_CIPHER_CTX
 *
x
, *
outbuf
, *
ou
, *
buf
, 
n
)

1339 
ySize
 = 0;

1341 i((
x
->
ag
 =0|| (
n
 =0|| (x->
y
 == 0))

1344 
n
 >
AES_BLOCK_SIZE
)

1346 
	`evp_s_cbc_y
(
buf
 + 
ySize
, 
outbuf
 +nySize, 
AES_BLOCK_SIZE
, &
x
->
sKey
, ctx->
iv
, ctx->
y
);

1347 
ySize
 +
AES_BLOCK_SIZE
;

1348 
n
 -
AES_BLOCK_SIZE
;

1351 i(
n
 == 0)

1353 *
ou
 = 
ySize
;

1354 
	`memt
(
x
->
bufr
, 
AES_BLOCK_SIZE
, AES_BLOCK_SIZE);

1355 
x
->
buf㾒
 = 
AES_BLOCK_SIZE
;

1359 *
ou
 = 
ySize
;

1360 
	`memy
(
x
->
bufr
, 
buf
 + 
ySize
, 
n
);

1361 
	`memt
(
x
->
bufr
 + 
n
, 
AES_BLOCK_SIZE
 - inlen, AES_BLOCK_SIZE - inlen);

1362 
x
->
buf㾒
 = 
AES_BLOCK_SIZE
;

1366 
	}
}

1368 
	$EVP_EnyF
(
EVP_CIPHER_CTX
 *
x
, *
outbuf
, *
ou
)

1370 i((
x
->
ag
 =0|| (x->
buf㾒
 =0|| (x->
y
 == 0))

1372 *
ou
 = 0;

1376 *
ou
 = 
AES_BLOCK_SIZE
;

1377 
	`evp_s_cbc_y
(
x
->
bufr
, 
outbuf
, 
AES_BLOCK_SIZE
, &x->
sKey
, ctx->
iv
, ctx->
y
);

1380 
	}
}

1382 
	$EVP_DeyIn
(
EVP_CIPHER_CTX
 *
x
, 
ty
, *
key
, *
iv
)

1384 
t
;

1386 
	`memt
(
x
, 0x00, (
EVP_CIPHER_CTX
));

1388 
x
->
ag
 = 1;

1389 
x
->
ty
 =ype;

1390 
x
->
y
 = 0;

1392 
	`memy
(
x
->
key
, key, 16);

1393 
	`memy
(
x
->
iv
, iv, 16);

1395 
t
 = 
	`AES_t_dey_key
(
key
, 128, &
x
->
sKey
);

1397  
t
;

1398 
	}
}

1400 
	$EVP_DeyUpde
(
EVP_CIPHER_CTX
 *
x
, *
outbuf
, *
ou
, *
buf
, 
n
)

1402 
deySize
 = 0;

1404 i((
x
->
ag
 =0|| (
n
 =0|| (x->
y
 == 1))

1407 
n
 >
AES_BLOCK_SIZE
)

1409 i(
n
 <
AES_BLOCK_SIZE
)

1412 
	`evp_s_cbc_y
(
buf
 + 
deySize
, 
outbuf
 + deySize, 
AES_BLOCK_SIZE
, &
x
->
sKey
, ctx->
iv
, ctx->
y
);

1413 
deySize
 +
AES_BLOCK_SIZE
;

1414 
n
 -
AES_BLOCK_SIZE
;

1417 i(
n
 =
AES_BLOCK_SIZE
)

1419 
x
->
buf㾒
 = 
n
;

1420 
	`evp_s_cbc_y
(
buf
 + 
deySize
, 
x
->
bufr
, 
AES_BLOCK_SIZE
, &x->
sKey
, ctx->
iv
, ctx->
y
);

1422 *
ou
 = 
deySize
;

1425 
	}
}

1427 
	$EVP_DeyF
(
EVP_CIPHER_CTX
 *
x
, *
outbuf
, *
ou
)

1429 
ϡch
 = 0;

1430 
dasize
 = 0;

1432 i((
x
->
ag
 =0|| (x->
buf㾒
 =0|| (x->
y
 == 1))

1434 *
ou
 = 0;

1438 
ϡch
 = 
x
->
bufr
[
AES_BLOCK_SIZE
 - 1];

1439 i(
ϡch
 < 
AES_BLOCK_SIZE
)

1441 
dasize
 = 
AES_BLOCK_SIZE
 - 
ϡch
;

1442 
	`memy
(
outbuf
, 
x
->
bufr
, 
dasize
);

1445 *
ou
 = 
dasize
;

1448 
	}
}

1464 
	$WscEnyDa
(

1465 *
aText
, 
x_n
,

1466 *
key
, *
iv
,

1467 *
chText
, *
x_n
)

1469 
EVP_CIPHER_CTX
 
x
;

1470 
bufL
 = 1024;

1471 
outBuf
[1024];

1472 
outL
, 
cutLgth
;

1477 
blockSize
 = 
bufL
 - 
AES_BLOCK_SIZE
;

1478 *
bufP
=
NULL
;

1479 
da_n
;

1482 
bufP
 = 
aText
;

1483 
da_n
 = 
x_n
;

1485 if(0 !
	`EVP_EnyIn
(&
x
, 
	`EVP_s_128_cbc
(), 
key
, 
iv
))

1487 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("WscEncryptData: EncryptInit failed\n"));

1490 *
x_n
 = 0;

1491 
da_n
)

1493 if(
da_n
 > 
blockSize
)

1494 
cutLgth
 = 
blockSize
;

1496 
cutLgth
 = 
da_n
;

1498 if(0 =
	`EVP_EnyUpde
(&
x
, 
outBuf
, &
outL
, 
bufP
, 
cutLgth
))

1500 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("WscEncryptData: EncryptUpdate failed\n"));

1504 
	`memy
(
chText
, 
outBuf
, 
outL
);

1505 
chText
 +
outL
;

1506 *
x_n
 +
outL
;

1508 
bufP
 +
cutLgth
;

1509 
da_n
 -
cutLgth
;

1513 if(0 =
	`EVP_EnyF
(&
x
, 
outBuf
, &
outL
))

1515 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("WscEncryptData: EncryptFinal failed\n"));

1519 
	`memy
(
chText
, 
outBuf
, 
outL
);

1520 *
x_n
 +
outL
;

1522 
	}
}

1533 
	$WscDeyDa
(

1534 *
chText
, 
x_n
,

1535 *
key
, *
iv
,

1536 *
aText
, *
x_n
)

1538 
EVP_CIPHER_CTX
 
x
;

1539 
bufL
 = 1024;

1540 
outBuf
[1024];

1541 
outL
 = 0, 
cutLgth
;

1546 
blockSize
 = 
bufL
 - 
AES_BLOCK_SIZE
;

1547 *
bufP
=
NULL
;

1548 
da_n
;

1551 
bufP
 = 
chText
;

1552 
da_n
 = 
x_n
;

1554 if(0 !
	`EVP_DeyIn
(&
x
, 
	`EVP_s_128_cbc
(), 
key
, 
iv
))

1556 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("WscEncryptData: DecryptInit failed\n"));

1559 *
x_n
=0;

1560 
da_n
)

1562 if(
da_n
 > 
blockSize
)

1563 
cutLgth
 = 
blockSize
;

1565 
cutLgth
 = 
da_n
;

1567 if(0 =
	`EVP_DeyUpde
(&
x
, 
outBuf
, &
outL
, 
bufP
, 
cutLgth
))

1569 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("WscDecryptData: DecryptUpdate failed\n"));

1574 
	`memy
(
aText
, 
outBuf
, 
outL
);

1575 
aText
 +
outL
;

1576 *
x_n
 +
outL
;

1578 
bufP
 +
cutLgth
;

1579 
da_n
 -
cutLgth
;

1583 if(0 =
	`EVP_DeyF
(&
x
, 
outBuf
, &
outL
))

1585 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("WscDecryptData: DecryptFinal failed\n"));

1589 
	`memy
(
aText
, 
outBuf
, 
outL
);

1590 *
x_n
 +
outL
;

1592 
	}
}

1597 
ut32
 
	gFSb
[256] =

1634 
	#FT
 \

	)

1636 
V
(
C6
,63,63,
A5
), V(
F8
,7C,7C,84), V(
EE
,77,77,99), V(
F6
,7B,7B,8D), \

1637 
V
(
FF
,
F2
,F2,0D), V(
D6
,6B,6B,
BD
), V(
DE
,6F,6F,
B1
), V(91,
C5
,C5,54), \

1638 
V
(60,30,30,50), V(02,01,01,03), V(
CE
,67,67,
A9
), V(56,2B,2B,7D), \

1639 
V
(
E7
,
FE
,FE,19), V(
B5
,
D7
,D7,62), V(4D,
AB
,AB,
E6
), V(
EC
,76,76,9A), \

1640 
V
(8F,
CA
,CA,45), V(1F,82,82,9D), V(89,
C9
,C9,40), V(
FA
,7D,7D,87), \

1641 
V
(
EF
,
FA
,FA,15), V(
B2
,59,59,
EB
), V(8E,47,47,
C9
), V(
FB
,
F0
,F0,0B), \

1642 
V
(41,
AD
,AD,
EC
), V(
B3
,
D4
,D4,67), V(5F,
A2
,A2,
FD
), V(45,
AF
,AF,
EA
), \

1643 
V
(23,9C,9C,
BF
), V(53,
A4
,A4,
F7
), V(
E4
,72,72,96), V(9B,
C0
,C0,5B), \

1644 
V
(75,
B7
,B7,
C2
), V(
E1
,
FD
,FD,1C), V(3D,93,93,
AE
), V(4C,26,26,6A), \

1645 
V
(6C,36,36,5A), V(7E,3F,3F,41), V(
F5
,
F7
,F7,02), V(83,
CC
,CC,4F), \

1646 
V
(68,34,34,5C), V(51,
A5
,A5,
F4
), V(
D1
,
E5
,E5,34), V(
F9
,
F1
,F1,08), \

1647 
V
(
E2
,71,71,93), V(
AB
,
D8
,D8,73), V(62,31,31,53), V(2A,15,15,3F), \

1648 
V
(08,04,04,0C), V(95,
C7
,C7,52), V(46,23,23,65), V(9D,
C3
,C3,5E), \

1649 
V
(30,18,18,28), V(37,96,96,
A1
), V(0A,05,05,0F), V(2F,9A,9A,
B5
), \

1650 
V
(0E,07,07,09), V(24,12,12,36), V(1B,80,80,9B), V(
DF
,
E2
,E2,3D), \

1651 
V
(
CD
,
EB
,EB,26), V(4E,27,27,69), V(7F,
B2
,B2,CD), V(
EA
,75,75,9F), \

1652 
V
(12,09,09,1B), V(1D,83,83,9E), V(58,2C,2C,74), V(34,1A,1A,2E), \

1653 
V
(36,1B,1B,2D), V(
DC
,6E,6E,
B2
), V(
B4
,5A,5A,
EE
), V(5B,
A0
,A0,
FB
), \

1654 
V
(
A4
,52,52,
F6
), V(76,3B,3B,4D), V(
B7
,
D6
,D6,61), V(7D,
B3
,B3,
CE
), \

1655 
V
(52,29,29,7B), V(
DD
,
E3
,E3,3E), V(5E,2F,2F,71), V(13,84,84,97), \

1656 
V
(
A6
,53,53,
F5
), V(
B9
,
D1
,D1,68), V(00,00,00,00), V(
C1
,
ED
,ED,2C), \

1657 
V
(40,20,20,60), V(
E3
,
FC
,FC,1F), V(79,
B1
,B1,
C8
), V(
B6
,5B,5B,
ED
), \

1658 
V
(
D4
,6A,6A,
BE
), V(8D,
CB
,CB,46), V(67,BE,BE,
D9
), V(72,39,39,4B), \

1659 
V
(94,4A,4A,
DE
), V(98,4C,4C,
D4
), V(
B0
,58,58,
E8
), V(85,
CF
,CF,4A), \

1660 
V
(
BB
,
D0
,D0,6B), V(
C5
,
EF
,EF,2A), V(4F,
AA
,AA,
E5
), V(
ED
,
FB
,FB,16), \

1661 
V
(86,43,43,
C5
), V(9A,4D,4D,
D7
), V(66,33,33,55), V(11,85,85,94), \

1662 
V
(8A,45,45,
CF
), V(
E9
,
F9
,F9,10), V(04,02,02,06), V(
FE
,7F,7F,81), \

1663 
V
(
A0
,50,50,
F0
), V(78,3C,3C,44), V(25,9F,9F,
BA
), V(4B,
A8
,A8,
E3
), \

1664 
V
(
A2
,51,51,
F3
), V(5D,
A3
,A3,
FE
), V(80,40,40,
C0
), V(05,8F,8F,8A), \

1665 
V
(3F,92,92,
AD
), V(21,9D,9D,
BC
), V(70,38,38,48), V(
F1
,
F5
,F5,04), \

1666 
V
(63,
BC
,BC,
DF
), V(77,
B6
,B6,
C1
), V(
AF
,
DA
,DA,75), V(42,21,21,63), \

1667 
V
(20,10,10,30), V(
E5
,
FF
,FF,1A), V(
FD
,
F3
,F3,0E), V(
BF
,
D2
,D2,6D), \

1668 
V
(81,
CD
,CD,4C), V(18,0C,0C,14), V(26,13,13,35), V(
C3
,
EC
,EC,2F), \

1669 
V
(
BE
,5F,5F,
E1
), V(35,97,97,
A2
), V(88,44,44,
CC
), V(2E,17,17,39), \

1670 
V
(93,
C4
,C4,57), V(55,
A7
,A7,
F2
), V(
FC
,7E,7E,82), V(7A,3D,3D,47), \

1671 
V
(
C8
,64,64,
AC
), V(
BA
,5D,5D,
E7
), V(32,19,19,2B), V(
E6
,73,73,95), \

1672 
V
(
C0
,60,60,
A0
), V(19,81,81,98), V(9E,4F,4F,
D1
), V(
A3
,
DC
,DC,7F), \

1673 
V
(44,22,22,66), V(54,2A,2A,7E), V(3B,90,90,
AB
), V(0B,88,88,83), \

1674 
V
(8C,46,46,
CA
), V(
C7
,
EE
,EE,29), V(6B,
B8
,B8,
D3
), V(28,14,14,3C), \

1675 
V
(
A7
,
DE
,DE,79), V(
BC
,5E,5E,
E2
), V(16,0B,0B,1D), V(
AD
,
DB
,DB,76), \

1676 
V
(
DB
,
E0
,E0,3B), V(64,32,32,56), V(74,3A,3A,4E), V(14,0A,0A,1E), \

1677 
V
(92,49,49,
DB
), V(0C,06,06,0A), V(48,24,24,6C), V(
B8
,5C,5C,
E4
), \

1678 
V
(9F,
C2
,C2,5D), V(
BD
,
D3
,D3,6E), V(43,
AC
,AC,
EF
), V(
C4
,62,62,
A6
), \

1679 
V
(39,91,91,
A8
), V(31,95,95,
A4
), V(
D3
,
E4
,E4,37), V(
F2
,79,79,8B), \

1680 
V
(
D5
,
E7
,E7,32), V(8B,
C8
,C8,43), V(6E,37,37,59), V(
DA
,6D,6D,
B7
), \

1681 
V
(01,8D,8D,8C), V(
B1
,
D5
,D5,64), V(9C,4E,4E,
D2
), V(49,
A9
,A9,
E0
), \

1682 
V
(
D8
,6C,6C,
B4
), V(
AC
,56,56,
FA
), V(
F3
,
F4
,F4,07), V(
CF
,
EA
,EA,25), \

1683 
V
(
CA
,65,65,
AF
), V(
F4
,7A,7A,8E), V(47,
AE
,AE,
E9
), V(10,08,08,18), \

1684 
V
(6F,
BA
,BA,
D5
), V(
F0
,78,78,88), V(4A,25,25,6F), V(5C,2E,2E,72), \

1685 
V
(38,1C,1C,24), V(57,
A6
,A6,
F1
), V(73,
B4
,B4,
C7
), V(97,
C6
,C6,51), \

1686 
V
(
CB
,
E8
,E8,23), V(
A1
,
DD
,DD,7C), V(E8,74,74,9C), V(3E,1F,1F,21), \

1687 
V
(96,4B,4B,
DD
), V(61,
BD
,BD,
DC
), V(0D,8B,8B,86), V(0F,8A,8A,85), \

1688 
V
(
E0
,70,70,90), V(7C,3E,3E,42), V(71,
B5
,B5,
C4
), V(
CC
,66,66,
AA
), \

1689 
V
(90,48,48,
D8
), V(06,03,03,05), V(
F7
,
F6
,F6,01), V(1C,0E,0E,12), \

1690 
V
(
C2
,61,61,
A3
), V(6A,35,35,5F), V(
AE
,57,57,
F9
), V(69,
B9
,B9,
D0
), \

1691 
V
(17,86,86,91), V(99,
C1
,C1,58), V(3A,1D,1D,27), V(27,9E,9E,
B9
), \

1692 
V
(
D9
,
E1
,E1,38), V(
EB
,
F8
,F8,13), V(2B,98,98,
B3
), V(22,11,11,33), \

1693 
V
(
D2
,69,69,
BB
), V(
A9
,
D9
,D9,70), V(07,8E,8E,89), V(33,94,94,
A7
), \

1694 
V
(2D,9B,9B,
B6
), V(3C,1E,1E,22), V(15,87,87,92), V(
C9
,
E9
,E9,20), \

1695 
V
(87,
CE
,CE,49), V(
AA
,55,55,
FF
), V(50,28,28,78), V(
A5
,
DF
,DF,7A), \

1696 
V
(03,8C,8C,8F), V(59,
A1
,A1,
F8
), V(09,89,89,80), V(1A,0D,0D,17), \

1697 
V
(65,
BF
,BF,
DA
), V(
D7
,
E6
,E6,31), V(84,42,42,
C6
), V(
D0
,68,68,
B8
), \

1698 
V
(82,41,41,
C3
), V(29,99,99,
B0
), V(5A,2D,2D,77), V(1E,0F,0F,11), \

1699 
V
(7B,
B0
,B0,
CB
), V(
A8
,54,54,
FC
), V(6D,
BB
,BB,
D6
), 
	$V
(2C,16,16,3A)

1701 
	#V
(
a
,
b
,
c
,
d
0x##a##b##c##
	)
d

1702 
ut32
 
FT0
[256] = { 
FT
 
	}
};

1703 #unde
V


1705 
	#V
(
a
,
b
,
c
,
d
0x##d##a##b##
	)
c

1706 
ut32
 
	gFT1
[256] = { 
FT
 };

1707 #unde
V


1709 
	#V
(
a
,
b
,
c
,
d
0x##c##d##a##
	)
b

1710 
ut32
 
	gFT2
[256] = { 
FT
 };

1711 #unde
V


1713 
	#V
(
a
,
b
,
c
,
d
0x##b##c##d##
	)
a

1714 
ut32
 
	gFT3
[256] = { 
FT
 };

1715 #unde
V


1717 #unde
FT


1721 
ut32
 
	gRSb
[256] =

1759 
	#RT
 \

	)

1761 
V
(51,
F4
,
A7
,50), V(7E,41,65,53), V(1A,17,
A4
,
C3
), V(3A,27,5E,96), \

1762 
V
(3B,
AB
,6B,
CB
), V(1F,9D,45,
F1
), V(
AC
,
FA
,58,AB), V(4B,
E3
,03,93), \

1763 
V
(20,30,
FA
,55), V(
AD
,76,6D,
F6
), V(88,
CC
,76,91), V(
F5
,02,4C,25), \

1764 
V
(4F,
E5
,
D7
,
FC
), V(
C5
,2A,
CB
,D7), V(26,35,44,80), V(
B5
,62,
A3
,8F), \

1765 
V
(
DE
,
B1
,5A,49), V(25,
BA
,1B,67), V(45,
EA
,0E,98), V(5D,
FE
,
C0
,
E1
), \

1766 
V
(
C3
,2F,75,02), V(81,4C,
F0
,12), V(8D,46,97,
A3
), V(6B,
D3
,
F9
,
C6
), \

1767 
V
(03,8F,5F,
E7
), V(15,92,9C,95), V(
BF
,6D,7A,
EB
), V(95,52,59,
DA
), \

1768 
V
(
D4
,
BE
,83,2D), V(58,74,21,
D3
), V(49,
E0
,69,29), V(8E,
C9
,
C8
,44), \

1769 
V
(75,
C2
,89,6A), V(
F4
,8E,79,78), V(99,58,3E,6B), V(27,
B9
,71,
DD
), \

1770 
V
(
BE
,
E1
,4F,
B6
), V(
F0
,88,
AD
,17), V(
C9
,20,
AC
,66), V(7D,
CE
,3A,
B4
), \

1771 
V
(63,
DF
,4A,18), V(
E5
,1A,31,82), V(97,51,33,60), V(62,53,7F,45), \

1772 
V
(
B1
,64,77,
E0
), V(
BB
,6B,
AE
,84), V(
FE
,81,
A0
,1C), V(
F9
,08,2B,94), \

1773 
V
(70,48,68,58), V(8F,45,
FD
,19), V(94,
DE
,6C,87), V(52,7B,
F8
,
B7
), \

1774 
V
(
AB
,73,
D3
,23), V(72,4B,02,
E2
), V(
E3
,1F,8F,57), V(66,55,AB,2A), \

1775 
V
(
B2
,
EB
,28,07), V(2F,
B5
,
C2
,03), V(86,
C5
,7B,9A), V(
D3
,37,08,
A5
), \

1776 
V
(30,28,87,
F2
), V(23,
BF
,
A5
,
B2
), V(02,03,6A,
BA
), V(
ED
,16,82,5C), \

1777 
V
(8A,
CF
,1C,2B), V(
A7
,79,
B4
,92), V(
F3
,07,
F2
,
F0
), V(4E,69,
E2
,
A1
), \

1778 
V
(65,
DA
,
F4
,
CD
), V(06,05,
BE
,
D5
), V(
D1
,34,62,1F), V(
C4
,
A6
,
FE
,8A), \

1779 
V
(34,2E,53,9D), V(
A2
,
F3
,55,
A0
), V(05,8A,
E1
,32), V(
A4
,
F6
,
EB
,75), \

1780 
V
(0B,83,
EC
,39), V(40,60,
EF
,
AA
), V(5E,71,9F,06), V(
BD
,6E,10,51), \

1781 
V
(3E,21,8A,
F9
), V(96,
DD
,06,3D), V(DD,3E,05,
AE
), V(4D,
E6
,
BD
,46), \

1782 
V
(91,54,8D,
B5
), V(71,
C4
,5D,05), V(04,06,
D4
,6F), V(60,50,15,
FF
), \

1783 
V
(19,98,
FB
,24), V(
D6
,
BD
,
E9
,97), V(89,40,43,
CC
), V(67,
D9
,9E,77), \

1784 
V
(
B0
,
E8
,42,
BD
), V(07,89,8B,88), V(
E7
,19,5B,38), V(79,
C8
,
EE
,
DB
), \

1785 
V
(
A1
,7C,0A,47), V(7C,42,0F,
E9
), V(
F8
,84,1E,
C9
), V(00,00,00,00), \

1786 
V
(09,80,86,83), V(32,2B,
ED
,48), V(1E,11,70,
AC
), V(6C,5A,72,4E), \

1787 
V
(
FD
,0E,
FF
,
FB
), V(0F,85,38,56), V(3D,
AE
,
D5
,1E), V(36,2D,39,27), \

1788 
V
(0A,0F,
D9
,64), V(68,5C,
A6
,21), V(9B,5B,54,
D1
), V(24,36,2E,3A), \

1789 
V
(0C,0A,67,
B1
), V(93,57,
E7
,0F), V(
B4
,
EE
,96,
D2
), V(1B,9B,91,9E), \

1790 
V
(80,
C0
,
C5
,4F), V(61,
DC
,20,
A2
), V(5A,77,4B,69), V(1C,12,1A,16), \

1791 
V
(
E2
,93,
BA
,0A), V(
C0
,
A0
,2A,
E5
), V(3C,22,
E0
,43), V(12,1B,17,1D), \

1792 
V
(0E,09,0D,0B), V(
F2
,8B,
C7
,
AD
), V(2D,
B6
,
A8
,
B9
), V(14,1E,
A9
,
C8
), \

1793 
V
(57,
F1
,19,85), V(
AF
,75,07,4C), V(
EE
,99,
DD
,
BB
), V(
A3
,7F,60,
FD
), \

1794 
V
(
F7
,01,26,9F), V(5C,72,
F5
,
BC
), V(44,66,3B,
C5
), V(5B,
FB
,7E,34), \

1795 
V
(8B,43,29,76), V(
CB
,23,
C6
,
DC
), V(
B6
,
ED
,
FC
,68), V(
B8
,
E4
,
F1
,63), \

1796 
V
(
D7
,31,
DC
,
CA
), V(42,63,85,10), V(13,97,22,40), V(84,
C6
,11,20), \

1797 
V
(85,4A,24,7D), V(
D2
,
BB
,3D,
F8
), V(
AE
,
F9
,32,11), V(
C7
,29,
A1
,6D), \

1798 
V
(1D,9E,2F,4B), V(
DC
,
B2
,30,
F3
), V(0D,86,52,
EC
), V(77,
C1
,
E3
,
D0
), \

1799 
V
(2B,
B3
,16,6C), V(
A9
,70,
B9
,99), V(11,94,48,
FA
), V(47,
E9
,64,22), \

1800 
V
(
A8
,
FC
,8C,
C4
), V(
A0
,
F0
,3F,1A), V(56,7D,2C,
D8
), V(22,33,90,
EF
), \

1801 
V
(87,49,4E,
C7
), V(
D9
,38,
D1
,
C1
), V(8C,
CA
,
A2
,
FE
), V(98,
D4
,0B,36), \

1802 
V
(
A6
,
F5
,81,
CF
), V(
A5
,7A,
DE
,28), V(
DA
,
B7
,8E,26), V(3F,
AD
,
BF
,
A4
), \

1803 
V
(2C,3A,9D,
E4
), V(50,78,92,0D), V(6A,5F,
CC
,9B), V(54,7E,46,62), \

1804 
V
(
F6
,8D,13,
C2
), V(90,
D8
,
B8
,
E8
), V(2E,39,
F7
,5E), V(82,
C3
,
AF
,
F5
), \

1805 
V
(9F,5D,80,
BE
), V(69,
D0
,93,7C), V(6F,
D5
,2D,
A9
), V(
CF
,25,12,
B3
), \

1806 
V
(
C8
,
AC
,99,3B), V(10,18,7D,
A7
), V(
E8
,9C,63,6E), V(
DB
,3B,
BB
,7B), \

1807 
V
(
CD
,26,78,09), V(6E,59,18,
F4
), V(
EC
,9A,
B7
,01), V(83,4F,9A,
A8
), \

1808 
V
(
E6
,95,6E,65), V(
AA
,
FF
,E6,7E), V(21,
BC
,
CF
,08), V(
EF
,15,
E8
,E6), \

1809 
V
(
BA
,
E7
,9B,
D9
), V(4A,6F,36,
CE
), V(
EA
,9F,09,
D4
), V(29,
B0
,7C,
D6
), \

1810 
V
(31,
A4
,
B2
,
AF
), V(2A,3F,23,31), V(
C6
,
A5
,94,30), V(35,
A2
,66,
C0
), \

1811 
V
(74,4E,
BC
,37), V(
FC
,82,
CA
,
A6
), V(
E0
,90,
D0
,
B0
), V(33,
A7
,
D8
,15), \

1812 
V
(
F1
,04,98,4A), V(41,
EC
,
DA
,
F7
), V(7F,
CD
,50,0E), V(17,91,
F6
,2F), \

1813 
V
(76,4D,
D6
,8D), V(43,
EF
,
B0
,4D), V(
CC
,
AA
,4D,54), V(
E4
,96,04,
DF
), \

1814 
V
(9E,
D1
,
B5
,
E3
), V(4C,6A,88,1B), V(
C1
,2C,1F,
B8
), V(46,65,51,7F), \

1815 
V
(9D,5E,
EA
,04), V(01,8C,35,5D), V(
FA
,87,74,73), V(
FB
,0B,41,2E), \

1816 
V
(
B3
,67,1D,5A), V(92,
DB
,
D2
,52), V(
E9
,10,56,33), V(6D,
D6
,47,13), \

1817 
V
(9A,
D7
,61,8C), V(37,
A1
,0C,7A), V(59,
F8
,14,8E), V(
EB
,13,3C,89), \

1818 
V
(
CE
,
A9
,27,
EE
), V(
B7
,61,
C9
,35), V(
E1
,1C,
E5
,
ED
), V(7A,47,
B1
,3C), \

1819 
V
(9C,
D2
,
DF
,59), V(55,
F2
,73,3F), V(18,14,
CE
,79), V(73,
C7
,37,
BF
), \

1820 
V
(53,
F7
,
CD
,
EA
), V(5F,
FD
,
AA
,5B), V(
DF
,3D,6F,14), V(78,44,
DB
,86), \

1821 
V
(
CA
,
AF
,
F3
,81), V(
B9
,68,
C4
,3E), V(38,24,34,2C), V(
C2
,
A3
,40,5F), \

1822 
V
(16,1D,
C3
,72), V(
BC
,
E2
,25,0C), V(28,3C,49,8B), V(
FF
,0D,95,41), \

1823 
V
(39,
A8
,01,71), V(08,0C,
B3
,
DE
), V(
D8
,
B4
,
E4
,9C), V(64,56,
C1
,90), \

1824 
V
(7B,
CB
,84,61), V(
D5
,32,
B6
,70), V(48,6C,5C,74), 
	$V
(
D0
,
B8
,57,42)

1826 
	#V
(
a
,
b
,
c
,
d
0x##a##b##c##
	)
d

1827 
ut32
 
RT0
[256] = { 
RT
 
	}
};

1828 #unde
V


1830 
	#V
(
a
,
b
,
c
,
d
0x##d##a##b##
	)
c

1831 
ut32
 
	gRT1
[256] = { 
RT
 };

1832 #unde
V


1834 
	#V
(
a
,
b
,
c
,
d
0x##c##d##a##
	)
b

1835 
ut32
 
	gRT2
[256] = { 
RT
 };

1836 #unde
V


1838 
	#V
(
a
,
b
,
c
,
d
0x##b##c##d##
	)
a

1839 
ut32
 
	gRT3
[256] = { 
RT
 };

1840 #unde
V


1842 #unde
RT


1846 
ut32
 
	gRCON
[10] =

1855 
	gKT_
 = 1;

1857 
ut32
 
	gKT0
[256];

1858 
ut32
 
	gKT1
[256];

1859 
ut32
 
	gKT2
[256];

1860 
ut32
 
	gKT3
[256];

1864 
	#GET_UINT32
(
n
,
b
,
i
\

	)

1866 (
	gn
(
ut32
(
b
)[(
i
) ] << 24 ) \

1867 | ( (
ut32
(
b
)[(
i
) + 1] << 16 ) \

1868 | ( (
ut32
(
b
)[(
i
) + 2] << 8 ) \

1869 | ( (
ut32
(
b
)[(
i
) + 3] ); \

1872 
	#PUT_UINT32
(
n
,
b
,
i
\

	)

1874 (
	gb
)[(
i
] = (
ut8
(
n
) >> 24 ); \

1875 (
	gb
)[(
i
+ 1] = (
ut8
(
n
) >> 16 ); \

1876 (
	gb
)[(
i
+ 2] = (
ut8
(
n
) >> 8 ); \

1877 (
	gb
)[(
i
+ 3] = (
ut8
(
n
) ); \

1882 
	$mp_s_t_key

s_cڋxt
 *
x
, 
ut8
 *
key
, 
nbs
 )

1884 
i
;

1885 
ut32
 *
RK
, *
SK
;

1887  
nbs
 )

1889 128: 
x
->

 = 10; ;

1890 192: 
x
->

 = 12; ;

1891 256: 
x
->

 = 14; ;

1895 
RK
 = 
x
->
k
;

1897  
i
 = 0; i < (
nbs
 >> 5); i++ )

1899 
	`GET_UINT32

RK
[
i
], 
key
, i * 4 );

1904  
nbs
 )

1908  
i
 = 0; i < 10; i++, 
RK
 += 4 )

1910 
RK
[4] = RK[0] ^ 
RCON
[
i
] ^

1911 
FSb
[ (
ut8

RK
[3] >> 16 ) ] << 24 ) ^

1912 
FSb
[ (
ut8

RK
[3] >> 8 ) ] << 16 ) ^

1913 
FSb
[ (
ut8

RK
[3] ) ] << 8 ) ^

1914 
FSb
[ (
ut8

RK
[3] >> 24 ) ] );

1916 
RK
[5] = RK[1] ^ RK[4];

1917 
RK
[6] = RK[2] ^ RK[5];

1918 
RK
[7] = RK[3] ^ RK[6];

1924  
i
 = 0; i < 8; i++, 
RK
 += 6 )

1926 
RK
[6] = RK[0] ^ 
RCON
[
i
] ^

1927 
FSb
[ (
ut8

RK
[5] >> 16 ) ] << 24 ) ^

1928 
FSb
[ (
ut8

RK
[5] >> 8 ) ] << 16 ) ^

1929 
FSb
[ (
ut8

RK
[5] ) ] << 8 ) ^

1930 
FSb
[ (
ut8

RK
[5] >> 24 ) ] );

1932 
RK
[7] = RK[1] ^ RK[6];

1933 
RK
[8] = RK[2] ^ RK[7];

1934 
RK
[9] = RK[3] ^ RK[8];

1935 
RK
[10] = RK[4] ^ RK[9];

1936 
RK
[11] = RK[5] ^ RK[10];

1942  
i
 = 0; i < 7; i++, 
RK
 += 8 )

1944 
RK
[8] = RK[0] ^ 
RCON
[
i
] ^

1945 
FSb
[ (
ut8

RK
[7] >> 16 ) ] << 24 ) ^

1946 
FSb
[ (
ut8

RK
[7] >> 8 ) ] << 16 ) ^

1947 
FSb
[ (
ut8

RK
[7] ) ] << 8 ) ^

1948 
FSb
[ (
ut8

RK
[7] >> 24 ) ] );

1950 
RK
[9] = RK[1] ^ RK[8];

1951 
RK
[10] = RK[2] ^ RK[9];

1952 
RK
[11] = RK[3] ^ RK[10];

1954 
RK
[12] = RK[4] ^

1955 
FSb
[ (
ut8

RK
[11] >> 24 ) ] << 24 ) ^

1956 
FSb
[ (
ut8

RK
[11] >> 16 ) ] << 16 ) ^

1957 
FSb
[ (
ut8

RK
[11] >> 8 ) ] << 8 ) ^

1958 
FSb
[ (
ut8

RK
[11] ) ] );

1960 
RK
[13] = RK[5] ^ RK[12];

1961 
RK
[14] = RK[6] ^ RK[13];

1962 
RK
[15] = RK[7] ^ RK[14];

1969 if
KT_
 )

1971  
i
 = 0; i < 256; i++ )

1973 
KT0
[
i
] = 
RT0
[ 
FSb
[i] ];

1974 
KT1
[
i
] = 
RT1
[ 
FSb
[i] ];

1975 
KT2
[
i
] = 
RT2
[ 
FSb
[i] ];

1976 
KT3
[
i
] = 
RT3
[ 
FSb
[i] ];

1979 
KT_
 = 0;

1982 
SK
 = 
x
->
drk
;

1984 *
SK
++ = *
RK
++;

1985 *
SK
++ = *
RK
++;

1986 *
SK
++ = *
RK
++;

1987 *
SK
++ = *
RK
++;

1989  
i
 = 1; i < 
x
->

; i++ )

1991 
RK
 -= 8;

1993 *
SK
++ = 
KT0
[ (
ut8
*
RK
 >> 24 ) ] ^

1994 
KT1
[ (
ut8
*
RK
 >> 16 ) ] ^

1995 
KT2
[ (
ut8
*
RK
 >> 8 ) ] ^

1996 
KT3
[ (
ut8
*
RK
 ) ]; RK++;

1998 *
SK
++ = 
KT0
[ (
ut8
*
RK
 >> 24 ) ] ^

1999 
KT1
[ (
ut8
*
RK
 >> 16 ) ] ^

2000 
KT2
[ (
ut8
*
RK
 >> 8 ) ] ^

2001 
KT3
[ (
ut8
*
RK
 ) ]; RK++;

2003 *
SK
++ = 
KT0
[ (
ut8
*
RK
 >> 24 ) ] ^

2004 
KT1
[ (
ut8
*
RK
 >> 16 ) ] ^

2005 
KT2
[ (
ut8
*
RK
 >> 8 ) ] ^

2006 
KT3
[ (
ut8
*
RK
 ) ]; RK++;

2008 *
SK
++ = 
KT0
[ (
ut8
*
RK
 >> 24 ) ] ^

2009 
KT1
[ (
ut8
*
RK
 >> 16 ) ] ^

2010 
KT2
[ (
ut8
*
RK
 >> 8 ) ] ^

2011 
KT3
[ (
ut8
*
RK
 ) ]; RK++;

2014 
RK
 -= 8;

2016 *
SK
++ = *
RK
++;

2017 *
SK
++ = *
RK
++;

2018 *
SK
++ = *
RK
++;

2019 *
SK
++ = *
RK
++;

2022 
	}
}

2026 
	$mp_s_y
(
s_cڋxt
 *
x
, 
ut8
 
put
[16], ut8 
ouut
[16] )

2028 
ut32
 *
RK
, 
X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
;

2030 
RK
 = 
x
->
k
;

2031 
	`GET_UINT32

X0
, 
put
, 0 ); X0 ^
RK
[0];

2032 
	`GET_UINT32

X1
, 
put
, 4 ); X1 ^
RK
[1];

2033 
	`GET_UINT32

X2
, 
put
, 8 ); X2 ^
RK
[2];

2034 
	`GET_UINT32

X3
, 
put
, 12 ); X3 ^
RK
[3];

2036 
	#AES_FROUND
(
X0
,
X1
,
X2
,
X3
,
Y0
,
Y1
,
Y2
,
Y3
\

	)

2038 
RK
 += 4; \

2040 
X0
 = 
RK
[0] ^ 
FT0
[ (
ut8

Y0
 >> 24 ) ] ^ \

2041 
FT1
[ (
ut8

Y1
 >> 16 ) ] ^ \

2042 
FT2
[ (
ut8

Y2
 >> 8 ) ] ^ \

2043 
FT3
[ (
ut8

Y3
 ) ]; \

2045 
X1
 = 
RK
[1] ^ 
FT0
[ (
ut8

Y1
 >> 24 ) ] ^ \

2046 
FT1
[ (
ut8

Y2
 >> 16 ) ] ^ \

2047 
FT2
[ (
ut8

Y3
 >> 8 ) ] ^ \

2048 
FT3
[ (
ut8

Y0
 ) ]; \

2050 
X2
 = 
RK
[2] ^ 
FT0
[ (
ut8

Y2
 >> 24 ) ] ^ \

2051 
FT1
[ (
ut8

Y3
 >> 16 ) ] ^ \

2052 
FT2
[ (
ut8

Y0
 >> 8 ) ] ^ \

2053 
FT3
[ (
ut8

Y1
 ) ]; \

2055 
X3
 = 
RK
[3] ^ 
FT0
[ (
ut8

Y3
 >> 24 ) ] ^ \

2056 
FT1
[ (
ut8

Y0
 >> 16 ) ] ^ \

2057 
FT2
[ (
ut8

Y1
 >> 8 ) ] ^ \

2058 
FT3
[ (
ut8

Y2
 ) ]; \

2061 
	`AES_FROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2062 
	`AES_FROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2063 
	`AES_FROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2064 
	`AES_FROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2065 
	`AES_FROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2066 
	`AES_FROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2067 
	`AES_FROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2068 
	`AES_FROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2069 
	`AES_FROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2071 if
x
->

 > 10 )

2073 
	`AES_FROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2074 
	`AES_FROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2077 if
x
->

 > 12 )

2079 
	`AES_FROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2080 
	`AES_FROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2085 
RK
 += 4;

2087 
X0
 = 
RK
[0] ^ ( 
FSb
[ (
ut8

Y0
 >> 24 ) ] << 24 ) ^

2088 
FSb
[ (
ut8

Y1
 >> 16 ) ] << 16 ) ^

2089 
FSb
[ (
ut8

Y2
 >> 8 ) ] << 8 ) ^

2090 
FSb
[ (
ut8

Y3
 ) ] );

2092 
X1
 = 
RK
[1] ^ ( 
FSb
[ (
ut8

Y1
 >> 24 ) ] << 24 ) ^

2093 
FSb
[ (
ut8

Y2
 >> 16 ) ] << 16 ) ^

2094 
FSb
[ (
ut8

Y3
 >> 8 ) ] << 8 ) ^

2095 
FSb
[ (
ut8

Y0
 ) ] );

2097 
X2
 = 
RK
[2] ^ ( 
FSb
[ (
ut8

Y2
 >> 24 ) ] << 24 ) ^

2098 
FSb
[ (
ut8

Y3
 >> 16 ) ] << 16 ) ^

2099 
FSb
[ (
ut8

Y0
 >> 8 ) ] << 8 ) ^

2100 
FSb
[ (
ut8

Y1
 ) ] );

2102 
X3
 = 
RK
[3] ^ ( 
FSb
[ (
ut8

Y3
 >> 24 ) ] << 24 ) ^

2103 
FSb
[ (
ut8

Y0
 >> 16 ) ] << 16 ) ^

2104 
FSb
[ (
ut8

Y1
 >> 8 ) ] << 8 ) ^

2105 
FSb
[ (
ut8

Y2
 ) ] );

2107 
	`PUT_UINT32

X0
, 
ouut
, 0 );

2108 
	`PUT_UINT32

X1
, 
ouut
, 4 );

2109 
	`PUT_UINT32

X2
, 
ouut
, 8 );

2110 
	`PUT_UINT32

X3
, 
ouut
, 12 );

2111 
	}
}

2115 
	$mp_s_dey

s_cڋxt
 *
x
, 
ut8
 
put
[16], ut8 
ouut
[16] )

2117 
ut32
 *
RK
, 
X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
;

2119 
RK
 = 
x
->
drk
;

2121 
	`GET_UINT32

X0
, 
put
, 0 ); X0 ^
RK
[0];

2122 
	`GET_UINT32

X1
, 
put
, 4 ); X1 ^
RK
[1];

2123 
	`GET_UINT32

X2
, 
put
, 8 ); X2 ^
RK
[2];

2124 
	`GET_UINT32

X3
, 
put
, 12 ); X3 ^
RK
[3];

2126 
	#AES_RROUND
(
X0
,
X1
,
X2
,
X3
,
Y0
,
Y1
,
Y2
,
Y3
\

	)

2128 
RK
 += 4; \

2130 
X0
 = 
RK
[0] ^ 
RT0
[ (
ut8

Y0
 >> 24 ) ] ^ \

2131 
RT1
[ (
ut8

Y3
 >> 16 ) ] ^ \

2132 
RT2
[ (
ut8

Y2
 >> 8 ) ] ^ \

2133 
RT3
[ (
ut8

Y1
 ) ]; \

2135 
X1
 = 
RK
[1] ^ 
RT0
[ (
ut8

Y1
 >> 24 ) ] ^ \

2136 
RT1
[ (
ut8

Y0
 >> 16 ) ] ^ \

2137 
RT2
[ (
ut8

Y3
 >> 8 ) ] ^ \

2138 
RT3
[ (
ut8

Y2
 ) ]; \

2140 
X2
 = 
RK
[2] ^ 
RT0
[ (
ut8

Y2
 >> 24 ) ] ^ \

2141 
RT1
[ (
ut8

Y1
 >> 16 ) ] ^ \

2142 
RT2
[ (
ut8

Y0
 >> 8 ) ] ^ \

2143 
RT3
[ (
ut8

Y3
 ) ]; \

2145 
X3
 = 
RK
[3] ^ 
RT0
[ (
ut8

Y3
 >> 24 ) ] ^ \

2146 
RT1
[ (
ut8

Y2
 >> 16 ) ] ^ \

2147 
RT2
[ (
ut8

Y1
 >> 8 ) ] ^ \

2148 
RT3
[ (
ut8

Y0
 ) ]; \

2151 
	`AES_RROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2152 
	`AES_RROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2153 
	`AES_RROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2154 
	`AES_RROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2155 
	`AES_RROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2156 
	`AES_RROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2157 
	`AES_RROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2158 
	`AES_RROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2159 
	`AES_RROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2161 if
x
->

 > 10 )

2163 
	`AES_RROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2164 
	`AES_RROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2167 if
x
->

 > 12 )

2169 
	`AES_RROUND

X0
, 
X1
, 
X2
, 
X3
, 
Y0
, 
Y1
, 
Y2
, 
Y3
 );

2170 
	`AES_RROUND

Y0
, 
Y1
, 
Y2
, 
Y3
, 
X0
, 
X1
, 
X2
, 
X3
 );

2175 
RK
 += 4;

2177 
X0
 = 
RK
[0] ^ ( 
RSb
[ (
ut8

Y0
 >> 24 ) ] << 24 ) ^

2178 
RSb
[ (
ut8

Y3
 >> 16 ) ] << 16 ) ^

2179 
RSb
[ (
ut8

Y2
 >> 8 ) ] << 8 ) ^

2180 
RSb
[ (
ut8

Y1
 ) ] );

2182 
X1
 = 
RK
[1] ^ ( 
RSb
[ (
ut8

Y1
 >> 24 ) ] << 24 ) ^

2183 
RSb
[ (
ut8

Y0
 >> 16 ) ] << 16 ) ^

2184 
RSb
[ (
ut8

Y3
 >> 8 ) ] << 8 ) ^

2185 
RSb
[ (
ut8

Y2
 ) ] );

2187 
X2
 = 
RK
[2] ^ ( 
RSb
[ (
ut8

Y2
 >> 24 ) ] << 24 ) ^

2188 
RSb
[ (
ut8

Y1
 >> 16 ) ] << 16 ) ^

2189 
RSb
[ (
ut8

Y0
 >> 8 ) ] << 8 ) ^

2190 
RSb
[ (
ut8

Y3
 ) ] );

2192 
X3
 = 
RK
[3] ^ ( 
RSb
[ (
ut8

Y3
 >> 24 ) ] << 24 ) ^

2193 
RSb
[ (
ut8

Y2
 >> 16 ) ] << 16 ) ^

2194 
RSb
[ (
ut8

Y1
 >> 8 ) ] << 8 ) ^

2195 
RSb
[ (
ut8

Y0
 ) ] );

2197 
	`PUT_UINT32

X0
, 
ouut
, 0 );

2198 
	`PUT_UINT32

X1
, 
ouut
, 4 );

2199 
	`PUT_UINT32

X2
, 
ouut
, 8 );

2200 
	`PUT_UINT32

X3
, 
ouut
, 12 );

2201 
	}
}

2212 
VOID
 
	$AES_GTK_KEY_WRAP
(

2213 
IN
 
UCHAR
 *
key
,

2214 
IN
 
UCHAR
 *
axt
,

2215 
IN
 
UINT
 
p_n
,

2216 
OUT
 
UCHAR
 *
chxt
,

2217 
OUT
 
UINT
 *
c_n
)

2219 
UCHAR
 
A
[8], 
BIN
[16], 
BOUT
[16];

2220 
UCHAR
 
R
[512];

2221 
INT
 
num_blocks
 = 
p_n
/8;

2222 
INT
 
i
, 
j
;

2223 
s_cڋxt
 
sx
;

2224 
UCHAR
 
x
;

2226 
	`mp_s_t_key
(&
sx
, 
key
, 128);

2229 
i
 = 0; i < 8; i++)

2230 
A
[
i
] = 0xa6;

2233 
i
 = 0; i < 
num_blocks
; i++)

2235 
j
 = 0 ; j < 8; j++)

2236 
R
[8 * (
i
 + 1+ 
j
] = 
axt
[8 * i + j];

2240 
j
 = 0; j < 6; j++)

2242 
i
 = 1; i <
num_blocks
; i++)

2245 
	`NdisMoveMemy
(
BIN
, 
A
, 8);

2246 
	`NdisMoveMemy
(&
BIN
[8], &
R
[8 * 
i
], 8);

2247 
	`mp_s_y
(&
sx
, 
BIN
, 
BOUT
);

2249 
	`NdisMoveMemy
(
A
, &
BOUT
[0], 8);

2250 
x
 = 
num_blocks
 * 
j
 + 
i
;

2251 
A
[7] = 
BOUT
[7] ^ 
x
;

2252 
	`NdisMoveMemy
(&
R
[8 * 
i
], &
BOUT
[8], 8);

2257 
	`NdisMoveMemy
(
chxt
, 
A
, 8);

2259 
i
 = 1; i <
num_blocks
; i++)

2261 
j
 = 0 ; j < 8; j++)

2262 
chxt
[8 * 
i
 + 
j
] = 
R
[8 * i + j];

2264 *
c_n
 = 
p_n
 + 8;

2265 
	}
}

2283 
VOID
 
	$AES_GTK_KEY_UNWRAP
(

2284 
IN
 
UCHAR
 *
key
,

2285 
OUT
 
UCHAR
 *
axt
,

2286 
OUT
 
UINT
 *
p_n
,

2287 
IN
 
UCHAR
 *
chxt
,

2288 
IN
 
UINT
 
c_n
)

2291 
UCHAR
 
A
[8], 
BIN
[16], 
BOUT
[16];

2292 
UCHAR
 
x
;

2293 
INT
 
i
, 
j
;

2294 
s_cڋxt
 
sx
;

2295 
UCHAR
 *
R
;

2296 
INT
 
num_blocks
 = 
c_n
/8;

2299 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
R
, 512);

2301 i(
R
 =
NULL
)

2303 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!AES_GTK_KEY_UNWRAP:o memory!!!\n"));

2308 
	`NdisMoveMemy
(
A
, 
chxt
, 8);

2310 
i
 = 0; i < (
c_n
-8); i++)

2312 
R
[ 
i
] = 
chxt
[i + 8];

2315 
	`mp_s_t_key
(&
sx
, 
key
, 128);

2317 
j
 = 5; j >= 0; j--)

2319 
i
 = (
num_blocks
-1); i > 0; i--)

2321 
x
 = (
num_blocks
 -1 )* 
j
 + 
i
;

2322 
	`NdisMoveMemy
(
BIN
, 
A
, 8);

2323 
BIN
[7] = 
A
[7] ^ 
x
;

2324 
	`NdisMoveMemy
(&
BIN
[8], &
R
[(
i
-1)*8], 8);

2325 
	`mp_s_dey
(&
sx
, 
BIN
, 
BOUT
);

2326 
	`NdisMoveMemy
(
A
, &
BOUT
[0], 8);

2327 
	`NdisMoveMemy
(&
R
[(
i
-1)*8], &
BOUT
[8], 8);

2332 
i
 = 0; i < 
c_n
; i++)

2334 
axt
[
i
] = 
R
[i];

2337 
	`DBGPRINT_RAW
(
RT_DEBUG_INFO
, ("plaintext = \n"));

2338 
i
 = 0; i < (
num_blocks
 *8); i++)

2340 
	`DBGPRINT_RAW
(
RT_DEBUG_INFO
, ("%2x ", 
axt
[
i
]));

2341 if(
i
%16 == 15)

2342 
	`DBGPRINT_RAW
(
RT_DEBUG_INFO
, ("\n "));

2344 
	`DBGPRINT_RAW
(
RT_DEBUG_INFO
, ("\n \n"));

2346 *
p_n
 = 
c_n
 - 8;

2347 
	`os__mem
(
NULL
, 
R
);

2348 
	}
}

2352 cڡ 
UINT32
 
	gs_rc
[] = {

2357 cڡ 
UINT8
 
	gs_sbox_c
[] = {

2377 cڡ 
UINT8
 
	gs_sbox_dec
[] = {

2398 cڡ 
UINT8
 
	gs_mul_2
[] = {

2419 cڡ 
UINT8
 
	gs_mul_3
[] = {

2440 cڡ 
UINT8
 
	gs_mul_9
[] = {

2461 cڡ 
UINT8
 
	gs_mul_b
[] = {

2482 cڡ 
UINT8
 
	gs_mul_d
[] = {

2503 cڡ 
UINT8
 
	gs_mul_e
[] = {

2524 
	#AES_MAC_LENGTH
 16

	)

2525 
UINT8
 
	gCڡ_Zo
[16] = {

2527 
UINT8
 
	gCڡ_Rb
[16] = {

2566 
VOID
 
	$RT_AES_KeyExnsi
 (

2567 
IN
 
UINT8
 
Key
[],

2568 
IN
 
UINT
 
KeyLgth
,

2569 
INOUT
 
AES_CTX_STRUC
 *
es_x
)

2571 
UINT
 
KeyIndex
 = 0;

2572 
UINT
 
NumbOfWdOfKey
, 
NumbOfWdOfKeyExnsi
;

2573 
UINT8
 
TempWd
[
AES_KEY_ROWS
], 
Temp
;

2574 
UINT32
 
Temc
;

2576 
NumbOfWdOfKey
 = 
KeyLgth
 >> 2;

2577 
KeyIndex
 < 
NumbOfWdOfKey
)

2579 
es_x
->
KeyWdExnsi
[0][
KeyIndex
] = 
Key
[4*KeyIndex];

2580 
es_x
->
KeyWdExnsi
[1][
KeyIndex
] = 
Key
[4*KeyIndex + 1];

2581 
es_x
->
KeyWdExnsi
[2][
KeyIndex
] = 
Key
[4*KeyIndex + 2];

2582 
es_x
->
KeyWdExnsi
[3][
KeyIndex
] = 
Key
[4*KeyIndex + 3];

2583 
KeyIndex
++;

2586 
NumbOfWdOfKeyExnsi
 = ((
UINT

AES_KEY_ROWS
* ((
KeyLgth
 >> 2) + 6 + 1);

2587 
KeyIndex
 < 
NumbOfWdOfKeyExnsi
)

2589 
TempWd
[0] = 
es_x
->
KeyWdExnsi
[0][
KeyIndex
 - 1];

2590 
TempWd
[1] = 
es_x
->
KeyWdExnsi
[1][
KeyIndex
 - 1];

2591 
TempWd
[2] = 
es_x
->
KeyWdExnsi
[2][
KeyIndex
 - 1];

2592 
TempWd
[3] = 
es_x
->
KeyWdExnsi
[3][
KeyIndex
 - 1];

2593 i((
KeyIndex
 % 
NumbOfWdOfKey
) == 0) {

2594 
Temc
 = 
s_rc
[
KeyIndex
/
NumbOfWdOfKey
];

2595 
Temp
 = 
s_sbox_c
[
TempWd
[1]]^((
Temc
 >> 24) & 0xff);

2596 
TempWd
[1] = 
s_sbox_c
[TempWd[2]]^((
Temc
 >> 16) & 0xff);

2597 
TempWd
[2] = 
s_sbox_c
[TempWd[3]]^((
Temc
 >> 8) & 0xff);

2598 
TempWd
[3] = 
s_sbox_c
[TempWd[0]]^((
Temc
 ) & 0xff);

2599 
TempWd
[0] = 
Temp
;

2600 } i((
NumbOfWdOfKey
 > 6&& ((
KeyIndex
 % NumberOfWordOfKey) == 4)) {

2601 
Temp
 = 
s_sbox_c
[
TempWd
[0]];

2602 
TempWd
[1] = 
s_sbox_c
[TempWord[1]];

2603 
TempWd
[2] = 
s_sbox_c
[TempWord[2]];

2604 
TempWd
[3] = 
s_sbox_c
[TempWord[3]];

2605 
TempWd
[0] = 
Temp
;

2607 
es_x
->
KeyWdExnsi
[0][
KeyIndex
] =s_x->KeyWdExnsi[0][KeyIndex - 
NumbOfWdOfKey
]^
TempWd
[0];

2608 
es_x
->
KeyWdExnsi
[1][
KeyIndex
] =s_x->KeyWdExnsi[1][KeyIndex - 
NumbOfWdOfKey
]^
TempWd
[1];

2609 
es_x
->
KeyWdExnsi
[2][
KeyIndex
] =s_x->KeyWdExnsi[2][KeyIndex - 
NumbOfWdOfKey
]^
TempWd
[2];

2610 
es_x
->
KeyWdExnsi
[3][
KeyIndex
] =s_x->KeyWdExnsi[3][KeyIndex - 
NumbOfWdOfKey
]^
TempWd
[3];

2611 
KeyIndex
++;

2613 
	}
}

2657 
VOID
 
	$RT_AES_Eny
 (

2658 
IN
 
UINT8
 
PϚBlock
[],

2659 
IN
 
UINT
 
PϚBlockSize
,

2660 
IN
 
UINT8
 
Key
[],

2661 
IN
 
UINT
 
KeyLgth
,

2662 
OUT
 
UINT8
 
ChBlock
[],

2663 
INOUT
 
UINT
 *
ChBlockSize
)

2665 
AES_CTX_STRUC
 
s_x
;

2666 
UINT
 
RowIndex
, 
CumnIndex
;

2667 
UINT
 
RoundIndex
, 
NumbOfRound
 = 0;

2668 
UINT8
 
Temp
, 
Row0
, 
Row1
, 
Row2
, 
Row3
;

2673 i(
PϚBlockSize
 !
AES_BLOCK_SIZES
) {

2674 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RT_AES_Encrypt:lain block size is %d bytes, it must be %d bytes(128 bits).\n",

2675 
PϚBlockSize
, 
AES_BLOCK_SIZES
));

2678 i((
KeyLgth
 !
AES_KEY128_LENGTH
&& (KeyLgth !
AES_KEY192_LENGTH
&& (KeyLgth !
AES_KEY256_LENGTH
)) {

2679 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RT_AES_Encrypt: keyength is %d bytes, it must be %d, %d, or %d bytes(128, 192, or 256 bits).\n",

2680 
KeyLgth
, 
AES_KEY128_LENGTH
, 
AES_KEY192_LENGTH
, 
AES_KEY256_LENGTH
));

2683 i(*
ChBlockSize
 < 
AES_BLOCK_SIZES
) {

2684 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RT_AES_Encrypt: cipher block size is %d bytes, it must be %d bytes(128 bits).\n",

2685 *
ChBlockSize
, 
AES_BLOCK_SIZES
));

2692 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2693 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2694 
s_x
.
S
[
RowIndex
][
CumnIndex
] = 
PϚBlock
[RowIndex + 4*ColumnIndex];

2699 
	`RT_AES_KeyExnsi
(
Key
, 
KeyLgth
, &
s_x
);

2700 
NumbOfRound
 = (
KeyLgth
 >> 2) + 6;

2703 
RoundIndex
 = 0;

2704 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2705 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2706 
s_x
.
S
[
RowIndex
][
CumnIndex
] ^s_x.
KeyWdExnsi
[RowIndex][(
RoundIndex
*((
UINT

AES_STATE_COLUMNS
)) + ColumnIndex];

2708 
RoundIndex
 = 1; RoundIndex < 
NumbOfRound
;RoundIndex++)

2711 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2712 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2713 
s_x
.
S
[
RowIndex
][
CumnIndex
] = 
s_sbox_c
[aes_ctx.State[RowIndex][ColumnIndex]];

2716 
Temp
 = 
s_x
.
S
[1][0];

2717 
s_x
.
S
[1][0] =es_ctx.State[1][1];

2718 
s_x
.
S
[1][1] =es_ctx.State[1][2];

2719 
s_x
.
S
[1][2] =es_ctx.State[1][3];

2720 
s_x
.
S
[1][3] = 
Temp
;

2721 
Temp
 = 
s_x
.
S
[2][0];

2722 
s_x
.
S
[2][0] =es_ctx.State[2][2];

2723 
s_x
.
S
[2][2] = 
Temp
;

2724 
Temp
 = 
s_x
.
S
[2][1];

2725 
s_x
.
S
[2][1] =es_ctx.State[2][3];

2726 
s_x
.
S
[2][3] = 
Temp
;

2727 
Temp
 = 
s_x
.
S
[3][3];

2728 
s_x
.
S
[3][3] =es_ctx.State[3][2];

2729 
s_x
.
S
[3][2] =es_ctx.State[3][1];

2730 
s_x
.
S
[3][1] =es_ctx.State[3][0];

2731 
s_x
.
S
[3][0] = 
Temp
;

2734 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2736 
Row0
 = 
s_x
.
S
[0][
CumnIndex
];

2737 
Row1
 = 
s_x
.
S
[1][
CumnIndex
];

2738 
Row2
 = 
s_x
.
S
[2][
CumnIndex
];

2739 
Row3
 = 
s_x
.
S
[3][
CumnIndex
];

2740 
s_x
.
S
[0][
CumnIndex
] = 
s_mul_2
[
Row0
]^
s_mul_3
[
Row1
]^
Row2
^
Row3
;

2741 
s_x
.
S
[1][
CumnIndex
] = 
Row0
^
s_mul_2
[
Row1
]^
s_mul_3
[
Row2
]^
Row3
;

2742 
s_x
.
S
[2][
CumnIndex
] = 
Row0
^
Row1
^
s_mul_2
[
Row2
]^
s_mul_3
[
Row3
];

2743 
s_x
.
S
[3][
CumnIndex
] = 
s_mul_3
[
Row0
]^
Row1
^
Row2
^
s_mul_2
[
Row3
];

2747 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2748 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2749 
s_x
.
S
[
RowIndex
][
CumnIndex
] ^s_x.
KeyWdExnsi
[RowIndex][(
RoundIndex
*((
UINT

AES_STATE_COLUMNS
)) + ColumnIndex];

2753 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2754 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2755 
s_x
.
S
[
RowIndex
][
CumnIndex
] = 
s_sbox_c
[aes_ctx.State[RowIndex][ColumnIndex]];

2757 
Temp
 = 
s_x
.
S
[1][0];

2758 
s_x
.
S
[1][0] =es_ctx.State[1][1];

2759 
s_x
.
S
[1][1] =es_ctx.State[1][2];

2760 
s_x
.
S
[1][2] =es_ctx.State[1][3];

2761 
s_x
.
S
[1][3] = 
Temp
;

2762 
Temp
 = 
s_x
.
S
[2][0];

2763 
s_x
.
S
[2][0] =es_ctx.State[2][2];

2764 
s_x
.
S
[2][2] = 
Temp
;

2765 
Temp
 = 
s_x
.
S
[2][1];

2766 
s_x
.
S
[2][1] =es_ctx.State[2][3];

2767 
s_x
.
S
[2][3] = 
Temp
;

2768 
Temp
 = 
s_x
.
S
[3][3];

2769 
s_x
.
S
[3][3] =es_ctx.State[3][2];

2770 
s_x
.
S
[3][2] =es_ctx.State[3][1];

2771 
s_x
.
S
[3][1] =es_ctx.State[3][0];

2772 
s_x
.
S
[3][0] = 
Temp
;

2774 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2775 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2776 
s_x
.
S
[
RowIndex
][
CumnIndex
] ^s_x.
KeyWdExnsi
[RowIndex][(
RoundIndex
*((
UINT

AES_STATE_COLUMNS
)) + ColumnIndex];

2781 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2782 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2783 
ChBlock
[
RowIndex
 + 4*
CumnIndex
] = 
s_x
.
S
[RowIndex][ColumnIndex];

2785 *
ChBlockSize
 = ((
UINT

AES_STATE_ROWS
)*((UINT
AES_STATE_COLUMNS
);

2786 
	}
}

2830 
VOID
 
	$RT_AES_Dey
 (

2831 
IN
 
UINT8
 
ChBlock
[],

2832 
IN
 
UINT
 
ChBlockSize
,

2833 
IN
 
UINT8
 
Key
[],

2834 
IN
 
UINT
 
KeyLgth
,

2835 
OUT
 
UINT8
 
PϚBlock
[],

2836 
INOUT
 
UINT
 *
PϚBlockSize
)

2838 
AES_CTX_STRUC
 
s_x
;

2839 
UINT
 
RowIndex
, 
CumnIndex
;

2840 
UINT
 
RoundIndex
, 
NumbOfRound
 = 0;

2841 
UINT8
 
Temp
, 
Row0
, 
Row1
, 
Row2
, 
Row3
;

2846 i(*
PϚBlockSize
 < 
AES_BLOCK_SIZES
) {

2847 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RT_AES_Decrypt:lain block size is %d bytes, it must be %d bytes(128 bits).\n",

2848 *
PϚBlockSize
, 
AES_BLOCK_SIZES
));

2851 i((
KeyLgth
 !
AES_KEY128_LENGTH
&& (KeyLgth !
AES_KEY192_LENGTH
&& (KeyLgth !
AES_KEY256_LENGTH
)) {

2852 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RT_AES_Decrypt: keyength is %d bytes, it must be %d, %d, or %d bytes(128, 192, or 256 bits).\n",

2853 
KeyLgth
, 
AES_KEY128_LENGTH
, 
AES_KEY192_LENGTH
, 
AES_KEY256_LENGTH
));

2856 i(
ChBlockSize
 !
AES_BLOCK_SIZES
) {

2857 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RT_AES_Decrypt: cipher block size is %d bytes, it must be %d bytes(128 bits).\n",

2858 
ChBlockSize
, 
AES_BLOCK_SIZES
));

2865 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2866 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2867 
s_x
.
S
[
RowIndex
][
CumnIndex
] = 
ChBlock
[RowIndex + 4*ColumnIndex];

2872 
	`RT_AES_KeyExnsi
(
Key
, 
KeyLgth
, &
s_x
);

2873 
NumbOfRound
 = (
KeyLgth
 >> 2) + 6;

2876 
RoundIndex
 = 
NumbOfRound
;

2877 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2878 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2879 
s_x
.
S
[
RowIndex
][
CumnIndex
] ^s_x.
KeyWdExnsi
[RowIndex][(
RoundIndex
*((
UINT

AES_STATE_COLUMNS
)) + ColumnIndex];

2881 
RoundIndex
 = (
NumbOfRound
 - 1); RoundIndex > 0 ;RoundIndex--)

2884 
Temp
 = 
s_x
.
S
[1][3];

2885 
s_x
.
S
[1][3] =es_ctx.State[1][2];

2886 
s_x
.
S
[1][2] =es_ctx.State[1][1];

2887 
s_x
.
S
[1][1] =es_ctx.State[1][0];

2888 
s_x
.
S
[1][0] = 
Temp
;

2889 
Temp
 = 
s_x
.
S
[2][0];

2890 
s_x
.
S
[2][0] =es_ctx.State[2][2];

2891 
s_x
.
S
[2][2] = 
Temp
;

2892 
Temp
 = 
s_x
.
S
[2][1];

2893 
s_x
.
S
[2][1] =es_ctx.State[2][3];

2894 
s_x
.
S
[2][3] = 
Temp
;

2895 
Temp
 = 
s_x
.
S
[3][0];

2896 
s_x
.
S
[3][0] =es_ctx.State[3][1];

2897 
s_x
.
S
[3][1] =es_ctx.State[3][2];

2898 
s_x
.
S
[3][2] =es_ctx.State[3][3];

2899 
s_x
.
S
[3][3] = 
Temp
;

2902 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2903 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2904 
s_x
.
S
[
RowIndex
][
CumnIndex
] = 
s_sbox_dec
[aes_ctx.State[RowIndex][ColumnIndex]];

2907 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2908 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2909 
s_x
.
S
[
RowIndex
][
CumnIndex
] ^s_x.
KeyWdExnsi
[RowIndex][(
RoundIndex
*((
UINT

AES_STATE_COLUMNS
)) + ColumnIndex];

2912 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2914 
Row0
 = 
s_x
.
S
[0][
CumnIndex
];

2915 
Row1
 = 
s_x
.
S
[1][
CumnIndex
];

2916 
Row2
 = 
s_x
.
S
[2][
CumnIndex
];

2917 
Row3
 = 
s_x
.
S
[3][
CumnIndex
];

2918 
s_x
.
S
[0][
CumnIndex
] = 
s_mul_e
[
Row0
]^
s_mul_b
[
Row1
]^
s_mul_d
[
Row2
]^
s_mul_9
[
Row3
];

2919 
s_x
.
S
[1][
CumnIndex
] = 
s_mul_9
[
Row0
]^
s_mul_e
[
Row1
]^
s_mul_b
[
Row2
]^
s_mul_d
[
Row3
];

2920 
s_x
.
S
[2][
CumnIndex
] = 
s_mul_d
[
Row0
]^
s_mul_9
[
Row1
]^
s_mul_e
[
Row2
]^
s_mul_b
[
Row3
];

2921 
s_x
.
S
[3][
CumnIndex
] = 
s_mul_b
[
Row0
]^
s_mul_d
[
Row1
]^
s_mul_9
[
Row2
]^
s_mul_e
[
Row3
];

2926 
Temp
 = 
s_x
.
S
[1][3];

2927 
s_x
.
S
[1][3] =es_ctx.State[1][2];

2928 
s_x
.
S
[1][2] =es_ctx.State[1][1];

2929 
s_x
.
S
[1][1] =es_ctx.State[1][0];

2930 
s_x
.
S
[1][0] = 
Temp
;

2931 
Temp
 = 
s_x
.
S
[2][0];

2932 
s_x
.
S
[2][0] =es_ctx.State[2][2];

2933 
s_x
.
S
[2][2] = 
Temp
;

2934 
Temp
 = 
s_x
.
S
[2][1];

2935 
s_x
.
S
[2][1] =es_ctx.State[2][3];

2936 
s_x
.
S
[2][3] = 
Temp
;

2937 
Temp
 = 
s_x
.
S
[3][0];

2938 
s_x
.
S
[3][0] =es_ctx.State[3][1];

2939 
s_x
.
S
[3][1] =es_ctx.State[3][2];

2940 
s_x
.
S
[3][2] =es_ctx.State[3][3];

2941 
s_x
.
S
[3][3] = 
Temp
;

2943 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2944 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2945 
s_x
.
S
[
RowIndex
][
CumnIndex
] = 
s_sbox_dec
[aes_ctx.State[RowIndex][ColumnIndex]];

2947 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2948 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2949 
s_x
.
S
[
RowIndex
][
CumnIndex
] ^s_x.
KeyWdExnsi
[RowIndex][(
RoundIndex
*((
UINT

AES_STATE_COLUMNS
)) + ColumnIndex];

2954 
RowIndex
 = 0; RowIndex < 
AES_STATE_ROWS
;RowIndex++)

2955 
CumnIndex
 = 0; CumnIndex < 
AES_STATE_COLUMNS
;ColumnIndex++)

2956 
PϚBlock
[
RowIndex
 + 4*
CumnIndex
] = 
s_x
.
S
[RowIndex][ColumnIndex];

2958 *
PϚBlockSize
 = ((
UINT

AES_STATE_ROWS
)*((UINT
AES_STATE_COLUMNS
);

2959 
	}
}

2986 
VOID
 
	$AES_CCM_MAC
 (

2987 
IN
 
UINT8
 
Payld
[],

2988 
IN
 
UINT
 
PayldLgth
,

2989 
IN
 
UINT8
 
Key
[],

2990 
IN
 
UINT
 
KeyLgth
,

2991 
IN
 
UINT8
 
N
[],

2992 
IN
 
UINT
 
NLgth
,

2993 
IN
 
UINT8
 
AAD
[],

2994 
IN
 
UINT
 
AADLgth
,

2995 
IN
 
UINT
 
MACLgth
,

2996 
OUT
 
UINT8
 
MACText
[])

2998 
UINT8
 
Block
[
AES_BLOCK_SIZES
], 
Block_MAC
[AES_BLOCK_SIZES];

2999 
UINT
 
Block_Index
 = 0, 
ADD_Index
 = 0, 
Payld_Index
 = 0;

3000 
UINT
 
Temp_Vue
 = 0, 
Temp_Index
 = 0, 
Temp_Lgth
 = 0, 
Cy_Lgth
 = 0;

3005 
	`NdisZoMemy
(
Block
, 
AES_BLOCK_SIZES
);

3006 i(
AADLgth
 > 0)

3007 
Block
[0] |= 0x40;

3008 
Temp_Vue
 = ((
MACLgth
 - 2) >> 1) << 3;

3009 
Block
[0] |
Temp_Vue
;

3010 
Temp_Vue
 = (15 - 
NLgth
) - 1;

3011 
Block
[0] |
Temp_Vue
;

3012 
Temp_Index
 = 0; Temp_Index < 
NLgth
; Temp_Index++)

3013 
Block
[
Temp_Index
 + 1] = 
N
[Temp_Index];

3014 i(
NLgth
 < 12)

3015 
Block
[12] = (
PayldLgth
 >> 24) & 0xff;

3016 i(
NLgth
 < 13)

3017 
Block
[13] = (
PayldLgth
 >> 16) & 0xff;

3018 
Block
[14] = (
PayldLgth
 >> 8) & 0xff;

3019 
Block
[15] = 
PayldLgth
 & 0xff;

3021 
	`NdisZoMemy
(
Block_MAC
, 
AES_BLOCK_SIZES
);

3022 
Temp_Lgth
 = (
Block_MAC
);

3023 
	`RT_AES_Eny
(
Block
, 
AES_BLOCK_SIZES
 , 
Key
, 
KeyLgth
, 
Block_MAC
, &
Temp_Lgth
);

3031 
	`NdisZoMemy
(
Block
, 
AES_BLOCK_SIZES
);

3032 i((
AADLgth
 > 0) && (AADLength < 0xFF00)) {

3033 
Block_Index
 = 2;

3034 
Block
[0] = (
AADLgth
 >> 8) & 0xff;

3035 
Block
[1] = 
AADLgth
 & 0xff;

3037 
Block_Index
 = 6;

3038 
Block
[2] = (
AADLgth
 >> 24) & 0xff;

3039 
Block
[3] = (
AADLgth
 >> 16) & 0xff;

3040 
Block
[4] = (
AADLgth
 >> 8) & 0xff;

3041 
Block
[5] = 
AADLgth
 & 0xff;

3044 
ADD_Index
 < 
AADLgth
)

3046 
Cy_Lgth
 = 
AADLgth
 - 
ADD_Index
;

3047 i(
Cy_Lgth
 > 
AES_BLOCK_SIZES
)

3048 
Cy_Lgth
 = 
AES_BLOCK_SIZES
;

3049 i((
Cy_Lgth
 + 
Block_Index
> 
AES_BLOCK_SIZES
) {

3050 
Cy_Lgth
 = 
AES_BLOCK_SIZES
 - 
Block_Index
;

3052 
Temp_Index
 = 0; Temp_Index < 
Cy_Lgth
; Temp_Index++)

3053 
Block
[
Temp_Index
 + 
Block_Index
] = 
AAD
[
ADD_Index
 + Temp_Index];

3054 
Temp_Index
 = 0; Temp_Index < 
AES_BLOCK_SIZES
; Temp_Index++)

3055 
Block
[
Temp_Index
] ^
Block_MAC
[Temp_Index];

3056 
	`NdisZoMemy
(
Block_MAC
, 
AES_BLOCK_SIZES
);

3057 
Temp_Lgth
 = (
Block_MAC
);

3058 
	`RT_AES_Eny
(
Block
, 
AES_BLOCK_SIZES
 , 
Key
, 
KeyLgth
, 
Block_MAC
, &
Temp_Lgth
);

3059 
ADD_Index
 +
Cy_Lgth
;

3060 
Block_Index
 = 0;

3061 
	`NdisZoMemy
(
Block
, 
AES_BLOCK_SIZES
);

3067 
Payld_Index
 < 
PayldLgth
)

3069 
	`NdisZoMemy
(
Block
, 
AES_BLOCK_SIZES
);

3070 
Cy_Lgth
 = 
PayldLgth
 - 
Payld_Index
;

3071 i(
Cy_Lgth
 > 
AES_BLOCK_SIZES
)

3072 
Cy_Lgth
 = 
AES_BLOCK_SIZES
;

3073 
Temp_Index
 = 0; Temp_Index < 
Cy_Lgth
; Temp_Index++)

3074 
Block
[
Temp_Index
] = 
Payld
[
Payld_Index
 + Temp_Index];

3075 
Temp_Index
 = 0; Temp_Index < 
AES_BLOCK_SIZES
; Temp_Index++)

3076 
Block
[
Temp_Index
] ^
Block_MAC
[Temp_Index];

3077 
	`NdisZoMemy
(
Block_MAC
, 
AES_BLOCK_SIZES
);

3078 
Temp_Lgth
 = (
Block_MAC
);

3079 
	`RT_AES_Eny
(
Block
, 
AES_BLOCK_SIZES
 , 
Key
, 
KeyLgth
, 
Block_MAC
, &
Temp_Lgth
);

3080 
Payld_Index
 +
Cy_Lgth
;

3082 
Temp_Index
 = 0; Temp_Index < 
MACLgth
; Temp_Index++)

3083 
MACText
[
Temp_Index
] = 
Block_MAC
[Temp_Index];

3084 
	}
}

3120 
INT
 
	$AES_CCM_Eny
 (

3121 
IN
 
UINT8
 
PϚText
[],

3122 
IN
 
UINT
 
PϚTextLgth
,

3123 
IN
 
UINT8
 
Key
[],

3124 
IN
 
UINT
 
KeyLgth
,

3125 
IN
 
UINT8
 
N
[],

3126 
IN
 
UINT
 
NLgth
,

3127 
IN
 
UINT8
 
AAD
[],

3128 
IN
 
UINT
 
AADLgth
,

3129 
IN
 
UINT
 
MACLgth
,

3130 
OUT
 
UINT8
 
ChText
[],

3131 
INOUT
 
UINT
 *
ChTextLgth
)

3133 
UINT8
 
Block_MAC
[
AES_BLOCK_SIZES
];

3134 
UINT8
 
Block_CTR
[
AES_BLOCK_SIZES
], 
Block_CTR_Ch
[AES_BLOCK_SIZES];

3135 
UINT
 
Ch_Index
 = 0;

3136 
UINT
 
Temp_Vue
 = 0, 
Temp_Index
 = 0, 
Temp_Lgth
 = 0, 
Cy_Lgth
 = 0;

3145 i(
KeyLgth
 !
AES_KEY128_LENGTH
) {

3146 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CCM_Eny: Thkeygth mu b%d bys\n", 
AES_KEY128_LENGTH
));

3150 i((
NLgth
 < 7) || (NonceLength > 13)) {

3151 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CCM_Encrypt: A validonceength is 7-13 bytes\n"));

3155 i((
MACLgth
 != 4) && (MACLength != 6) && (MACLength != 8) && (MACLength != 10)

3156 && (
MACLgth
 != 12) && (MACLength != 14) && (MACLength != 16)) {

3157 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CCM_Encrypt: The MACength must be 4, 6, 8, 10, 12, 14, or 16 bytes\n"));

3161 i(*
ChTextLgth
 < (
PϚTextLgth
 + 
MACLgth
)) {

3162 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CCM_Encrypt: The CipherTextLength isotnough.\n"));

3170 
	`NdisZoMemy
(
Block_CTR
, 
AES_BLOCK_SIZES
);

3171 
Temp_Vue
 = (15 - 
NLgth
) - 1;

3172 
Block_CTR
[0] |
Temp_Vue
;

3173 
Temp_Index
 = 0; Temp_Index < 
NLgth
; Temp_Index++)

3174 
Block_CTR
[
Temp_Index
 + 1] = 
N
[Temp_Index];

3179 
	`AES_CCM_MAC
(
PϚText
, 
PϚTextLgth
, 
Key
, 
KeyLgth
, 
N
, 
NLgth
, 
AAD
, 
AADLgth
, 
MACLgth
, 
Block_MAC
);

3180 
Temp_Lgth
 = (
Block_CTR_Ch
);

3181 
	`RT_AES_Eny
(
Block_CTR
, 
AES_BLOCK_SIZES
 , 
Key
, 
KeyLgth
, 
Block_CTR_Ch
, &
Temp_Lgth
);

3182 
Temp_Index
 = 0; Temp_Index < 
MACLgth
; Temp_Index++)

3183 
Block_MAC
[
Temp_Index
] ^
Block_CTR_Ch
[Temp_Index];

3188 
Ch_Index
 < 
PϚTextLgth
)

3190 
Block_CTR
[15] += 1;

3191 
Temp_Lgth
 = (
Block_CTR_Ch
);

3192 
	`RT_AES_Eny
(
Block_CTR
, 
AES_BLOCK_SIZES
 , 
Key
, 
KeyLgth
, 
Block_CTR_Ch
, &
Temp_Lgth
);

3194 
Cy_Lgth
 = 
PϚTextLgth
 - 
Ch_Index
;

3195 i(
Cy_Lgth
 > 
AES_BLOCK_SIZES
)

3196 
Cy_Lgth
 = 
AES_BLOCK_SIZES
;

3197 
Temp_Index
 = 0; Temp_Index < 
Cy_Lgth
; Temp_Index++)

3198 
ChText
[
Ch_Index
 + 
Temp_Index
] = 
PϚText
[Ch_Index + Temp_Index]^
Block_CTR_Ch
[Temp_Index];

3200 
Ch_Index
 +
Cy_Lgth
;

3202 
Temp_Index
 = 0; Temp_Index < 
MACLgth
; Temp_Index++)

3203 
ChText
[
PϚTextLgth
 + 
Temp_Index
] = 
Block_MAC
[Temp_Index];

3204 *
ChTextLgth
 = 
PϚTextLgth
 + 
MACLgth
;

3207 
	}
}

3243 
INT
 
	$AES_CCM_Dey
 (

3244 
IN
 
UINT8
 
ChText
[],

3245 
IN
 
UINT
 
ChTextLgth
,

3246 
IN
 
UINT8
 
Key
[],

3247 
IN
 
UINT
 
KeyLgth
,

3248 
IN
 
UINT8
 
N
[],

3249 
IN
 
UINT
 
NLgth
,

3250 
IN
 
UINT8
 
AAD
[],

3251 
IN
 
UINT
 
AADLgth
,

3252 
IN
 
UINT
 
MACLgth
,

3253 
OUT
 
UINT8
 
PϚText
[],

3254 
INOUT
 
UINT
 *
PϚTextLgth
)

3256 
UINT8
 
Block_MAC
[
AES_BLOCK_SIZES
], 
Block_MAC_From_Ch
[AES_BLOCK_SIZES];

3257 
UINT8
 
Block_CTR
[
AES_BLOCK_SIZES
], 
Block_CTR_Ch
[AES_BLOCK_SIZES];

3258 
UINT
 
Block_Index
 = 0, 
Ch_Index
 = 0;

3259 
UINT
 
Temp_Vue
 = 0, 
Temp_Index
 = 0, 
Temp_Lgth
 = 0, 
Cy_Lgth
 = 0;

3267 i(
KeyLgth
 !
AES_KEY128_LENGTH
) {

3268 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CCM_Dey: Thkeygth mu b%d bys\n", 
AES_KEY128_LENGTH
));

3272 i((
NLgth
 < 7) || (NonceLength > 13)) {

3273 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CCM_Decrypt: A validonceength is 7-13 bytes\n"));

3277 i((
MACLgth
 != 4) && (MACLength != 6) && (MACLength != 8) && (MACLength != 10)

3278 && (
MACLgth
 != 12) && (MACLength != 14) && (MACLength != 16)) {

3279 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CCM_Decrypt: The MACength must be 4, 6, 8, 10, 12, 14, or 16 bytes\n"));

3283 i(*
PϚTextLgth
 < (
ChTextLgth
 - 
MACLgth
)) {

3284 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CCM_Decrypt: The PlainTextLength isotnough.\n"));

3291 
	`NdisZoMemy
(
Block_CTR
, 
AES_BLOCK_SIZES
);

3292 
Temp_Vue
 = (15 - 
NLgth
) - 1;

3293 
Block_CTR
[0] |
Temp_Vue
;

3294 
Temp_Index
 = 0; Temp_Index < 
NLgth
; Temp_Index++)

3295 
Block_CTR
[
Temp_Index
 + 1] = 
N
[Temp_Index];

3296 
Temp_Lgth
 = (
Block_CTR_Ch
);

3297 
	`RT_AES_Eny
(
Block_CTR
, 
AES_BLOCK_SIZES
 , 
Key
, 
KeyLgth
, 
Block_CTR_Ch
, &
Temp_Lgth
);

3302 
Block_Index
 = 0;

3303 
Temp_Index
 = (
ChTextLgth
 - 
MACLgth
); Temp_Index < ChTextLgth; Temp_Index++, 
Block_Index
++)

3304 
Block_MAC_From_Ch
[
Block_Index
] = 
ChText
[
Temp_Index
]^
Block_CTR_Ch
[Block_Index];

3309 
Ch_Index
 < (
ChTextLgth
 - 
MACLgth
))

3311 
Block_CTR
[15] += 1;

3312 
Temp_Lgth
 = (
Block_CTR_Ch
);

3313 
	`RT_AES_Eny
(
Block_CTR
, 
AES_BLOCK_SIZES
 , 
Key
, 
KeyLgth
, 
Block_CTR_Ch
, &
Temp_Lgth
);

3315 
Cy_Lgth
 = (
ChTextLgth
 - 
MACLgth
- 
Ch_Index
;

3316 i(
Cy_Lgth
 > 
AES_BLOCK_SIZES
)

3317 
Cy_Lgth
 = 
AES_BLOCK_SIZES
;

3318 
Temp_Index
 = 0; Temp_Index < 
Cy_Lgth
; Temp_Index++)

3319 
PϚText
[
Ch_Index
 + 
Temp_Index
] = 
ChText
[Ch_Index + Temp_Index]^
Block_CTR_Ch
[Temp_Index];

3320 
Ch_Index
 +
Cy_Lgth
;

3322 *
PϚTextLgth
 = 
ChTextLgth
 - 
MACLgth
;

3327 
	`AES_CCM_MAC
(
PϚText
, *
PϚTextLgth
, 
Key
, 
KeyLgth
, 
N
, 
NLgth
, 
AAD
, 
AADLgth
, 
MACLgth
, 
Block_MAC
);

3332 i(
	`NdisCmpMemy
(
Block_MAC_From_Ch
, 
Block_MAC
, 
MACLgth
) != 0) {

3333 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CCM_Decrypt: The MIC doesot match.\n"));

3338 
	}
}

3367 
VOID
 
	$AES_CMAC_GeSubKey
 (

3368 
IN
 
UINT8
 
Key
[],

3369 
IN
 
UINT
 
KeyLgth
,

3370 
OUT
 
UINT8
 
SubKey1
[],

3371 
OUT
 
UINT8
 
SubKey2
[])

3373 
UINT8
 
MSB_L
 = 0, 
MSB_K1
 = 0, 
T_B
 = 0;

3374 
UINT
 
SubKey1_Lgth
 = 0;

3375 
INT
 
Index
 = 0;

3377 i(
KeyLgth
 !
AES_KEY128_LENGTH
) {

3378 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CMAC_GenerateSubKey: keyength is %d bytes, it must be %d bytes(128 bits).\n",

3379 
KeyLgth
, 
AES_KEY128_LENGTH
));

3384 
SubKey1_Lgth
 = 16;

3385 
	`RT_AES_Eny
(
Cڡ_Zo
, (Cڡ_Zo), 
Key
, 
KeyLgth
, 
SubKey1
, &
SubKey1_Lgth
);

3392 
MSB_L
 = 
SubKey1
[0] & 0x80;

3393 
Index
 = 0; Index < 15; Index++) {

3394 
T_B
 = (
SubKey1
[
Index
 + 1] & 0x80)?1:0;

3395 
SubKey1
[
Index
] <<= 1;

3396 
SubKey1
[
Index
] |
T_B
;

3398 
SubKey1
[15] <<= 1;

3399 i(
MSB_L
 > 0) {

3400 
Index
 = 0; Index < 16; Index++)

3401 
SubKey1
[
Index
] ^
Cڡ_Rb
[Index];

3409 
MSB_K1
 = 
SubKey1
[0] & 0x80;

3410 
Index
 = 0; Index < 15; Index++) {

3411 
T_B
 = (
SubKey1
[
Index
 + 1] & 0x80)?1:0;

3412 
SubKey2
[
Index
] = 
SubKey1
[Index] << 1;

3413 
SubKey2
[
Index
] |
T_B
;

3415 
SubKey2
[15] = 
SubKey1
[15] << 1;

3416 i(
MSB_K1
 > 0) {

3417 
Index
 = 0; Index < 16; Index++)

3418 
SubKey2
[
Index
] ^
Cڡ_Rb
[Index];

3420 
	}
}

3443 
VOID
 
	$AES_CMAC
 (

3444 
IN
 
UINT8
 
PϚText
[],

3445 
IN
 
UINT
 
PϚTextLgth
,

3446 
IN
 
UINT8
 
Key
[],

3447 
IN
 
UINT
 
KeyLgth
,

3448 
OUT
 
UINT8
 
MACText
[],

3449 
INOUT
 
UINT
 *
MACTextLgth
)

3451 
UINT
 
PϚBlockS
;

3452 
UINT8
 
X
[
AES_BLOCK_SIZES
], 
Y
[AES_BLOCK_SIZES];

3453 
UINT8
 
SubKey1
[16];

3454 
UINT8
 
SubKey2
[16];

3455 
INT
 
Index
;

3456 
UINT
 
X_Lgth
;

3458 i(*
MACTextLgth
 < 
AES_MAC_LENGTH
) {

3459 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CMAC: MACextength isesshan %d bytes).\n",

3460 
AES_MAC_LENGTH
));

3463 i(
KeyLgth
 !
AES_KEY128_LENGTH
) {

3464 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("AES_CMAC: keyength is %d bytes, it must be %d bytes(128 bits).\n",

3465 
KeyLgth
, 
AES_KEY128_LENGTH
));

3470 
	`NdisZoMemy
(
SubKey1
, 16);

3471 
	`NdisZoMemy
(
SubKey2
, 16);

3472 
	`AES_CMAC_GeSubKey
(
Key
, 
KeyLgth
, 
SubKey1
, 
SubKey2
);

3480 
PϚBlockS
 = 0;

3481 
	`NdisMoveMemy
(
X
, 
Cڡ_Zo
, 
AES_BLOCK_SIZES
);

3482 (
PϚTextLgth
 - 
PϚBlockS
> 
AES_BLOCK_SIZES
)

3484 
Index
 = 0; Index < 
AES_BLOCK_SIZES
; Index++)

3485 
Y
[
Index
] = 
PϚText
[
PϚBlockS
 + Index]^
X
[Index];

3487 
X_Lgth
 = (
X
);

3488 
	`RT_AES_Eny
(
Y
, (Y, 
Key
, 
KeyLgth
, 
X
, &
X_Lgth
);

3489 
PϚBlockS
 +((
UINT

AES_BLOCK_SIZES
);

3491 i((
PϚTextLgth
 - 
PϚBlockS
=
AES_BLOCK_SIZES
) {

3492 
Index
 = 0; Index < 
AES_BLOCK_SIZES
; Index++)

3493 
Y
[
Index
] = 
PϚText
[
PϚBlockS
 + Index]^
X
[Index]^
SubKey1
[Index];

3495 
	`NdisZoMemy
(
Y
, 
AES_BLOCK_SIZES
);

3496 
	`NdisMoveMemy
(
Y
, &
PϚText
[
PϚBlockS
], (
PϚTextLgth
 - PlainBlockStart));

3497 
Y
[(
PϚTextLgth
 - 
PϚBlockS
)] = 0x80;

3498 
Index
 = 0; Index < 
AES_BLOCK_SIZES
; Index++)

3499 
Y
[
Index
] = Y[Index]^
X
[Index]^
SubKey2
[Index];

3501 
	`RT_AES_Eny
(
Y
, (Y, 
Key
, 
KeyLgth
, 
MACText
, 
MACTextLgth
);

3502 
	}
}

	@common/crypt_arc4.c

41 
	~"y_c4.h
"

56 
VOID
 
	$ARC4_INIT
 (

57 
IN
 
ARC4_CTX_STRUC
 *
pARC4_CTX
,

58 
IN
 
PUCHAR
 
pKey
,

59 
IN
 
UINT
 
KeyLgth
)

61 
UINT
 
BlockIndex
 = 0, 
SWAPIndex
 = 0, 
KeyIndex
 = 0;

62 
UINT8
 
TempVue
 = 0;

65 
pARC4_CTX
->
BlockIndex1
 = 0;

66 
pARC4_CTX
->
BlockIndex2
 = 0;

67 
BlockIndex
 = 0; BlockIndex < 
ARC4_KEY_BLOCK_SIZE
; BlockIndex++)

68 
pARC4_CTX
->
KeyBlock
[
BlockIndex
] = (
UINT8
) BlockIndex;

71 
BlockIndex
 = 0; BlockIndex < 
ARC4_KEY_BLOCK_SIZE
; BlockIndex++)

73 
TempVue
 = 
pARC4_CTX
->
KeyBlock
[
BlockIndex
];

74 
KeyIndex
 = 
BlockIndex
 % 
KeyLgth
;

75 
SWAPIndex
 = (SWAPIndex + 
TempVue
 + 
pKey
[
KeyIndex
]) & 0xff;

76 
pARC4_CTX
->
KeyBlock
[
BlockIndex
] =ARC4_CTX->KeyBlock[
SWAPIndex
];

77 
pARC4_CTX
->
KeyBlock
[
SWAPIndex
] = 
TempVue
;

80 
	}
}

97 
VOID
 
	$ARC4_Compu
 (

98 
IN
 
ARC4_CTX_STRUC
 *
pARC4_CTX
,

99 
IN
 
UINT8
 
IutBlock
[],

100 
IN
 
UINT
 
IutBlockSize
,

101 
OUT
 
UINT8
 
OuutBlock
[])

103 
UINT
 
IutIndex
 = 0;

104 
UINT8
 
TempVue
 = 0;

106 
IutIndex
 = 0; IutIndex < 
IutBlockSize
; InputIndex++)

108 
pARC4_CTX
->
BlockIndex1
 = (pARC4_CTX->BlockIndex1 + 1) & 0xff;

109 
TempVue
 = 
pARC4_CTX
->
KeyBlock
[pARC4_CTX->
BlockIndex1
];

110 
pARC4_CTX
->
BlockIndex2
 = (pARC4_CTX->BlockIndex2 + 
TempVue
) & 0xff;

112 
pARC4_CTX
->
KeyBlock
[pARC4_CTX->
BlockIndex1
] =ARC4_CTX->KeyBlock[pARC4_CTX->
BlockIndex2
];

113 
pARC4_CTX
->
KeyBlock
[pARC4_CTX->
BlockIndex2
] = 
TempVue
;

115 
TempVue
 = (TempVu+ 
pARC4_CTX
->
KeyBlock
[pARC4_CTX->
BlockIndex1
]) & 0xff;

116 
OuutBlock
[
IutIndex
] = 
IutBlock
[IutIndex]^
pARC4_CTX
->
KeyBlock
[
TempVue
];

119 
	}
}

133 
VOID
 
	$ARC4_Disrd_KeyLgth
 (

134 
IN
 
ARC4_CTX_STRUC
 *
pARC4_CTX
,

135 
IN
 
UINT
 
Lgth
)

137 
UINT
 
Index
 = 0;

138 
UINT8
 
TempVue
 = 0;

140 
Index
 = 0; Index < 
Lgth
; Index++)

142 
pARC4_CTX
->
BlockIndex1
 = (pARC4_CTX->BlockIndex1 + 1) & 0xff;

143 
TempVue
 = 
pARC4_CTX
->
KeyBlock
[pARC4_CTX->
BlockIndex1
];

144 
pARC4_CTX
->
BlockIndex2
 = (pARC4_CTX->BlockIndex2 + 
TempVue
) & 0xff;

146 
pARC4_CTX
->
KeyBlock
[pARC4_CTX->
BlockIndex1
] =ARC4_CTX->KeyBlock[pARC4_CTX->
BlockIndex2
];

147 
pARC4_CTX
->
KeyBlock
[pARC4_CTX->
BlockIndex2
] = 
TempVue
;

150 
	}
}

	@common/crypt_hmac.c

28 
	~"y_hmac.h
"

31 #i
defed
(
__lulus
)

37 
hmac_sha_beg
(
hmac_x
 
cx
[1])

39 
memt
(
cx
, 0, (
hmac_x
));

43 
hmac_sha_key
(cڡ 
key
[], 
key_n
, 
hmac_x
 
cx
[1])

45 if(
cx
->
kn
 =
HMAC_IN_DATA
)

46  
HMAC_BAD_MODE
;

48 if(
cx
->
kn
 + 
key_n
 > 
HASH_INPUT_SIZE
)

50 if(
cx
->
kn
 <
HASH_INPUT_SIZE
)

52 
sha_beg
(
cx
->
x
);

53 
sha_hash
(
cx
->
key
, cx->
kn
, cx->
x
);

56 
sha_hash
(
key
, 
key_n
, 
cx
->
x
);

59 
memy
(
cx
->
key
 + cx->
kn
, key, 
key_n
);

61 
cx
->
kn
 +
key_n
;

62  
HMAC_OK
;

67 
hmac_sha_da
(cڡ 
da
[], 
da_n
, 
hmac_x
 
cx
[1])

68 { 
i
;

70 if(
cx
->
kn
 !
HMAC_IN_DATA
)

72 if(
cx
->
kn
 > 
HASH_INPUT_SIZE
)

74 
sha_d
(
cx
->
key
, cx->
x
);

75 
cx
->
kn
 = 
HASH_OUTPUT_SIZE
;

79 
memt
(
cx
->
key
 + cx->
kn
, 0, 
HASH_INPUT_SIZE
 - cx->klen);

82 
i
 = 0; i < (
HASH_INPUT_SIZE
 >> 2); ++i)

83 ((*)
cx
->
key
)[
i
] ^= 0x36363636;

86 
sha_beg
(
cx
->
x
);

87 
sha_hash
(
cx
->
key
, 
HASH_INPUT_SIZE
, cx->
x
);

90 
cx
->
kn
 = 
HMAC_IN_DATA
;

94 if(
da_n
)

95 
sha_hash
(
da
, 
da_n
, 
cx
->
x
);

99 
hmac_sha_d
(
mac
[], 
mac_n
, 
hmac_x
 
cx
[1])

100 { 
dig
[
HASH_OUTPUT_SIZE
];

101 
i
;

104 if(
cx
->
kn
 !
HMAC_IN_DATA
)

105 
hmac_sha_da
((cڡ *)0, 0, 
cx
);

107 
sha_d
(
dig
, 
cx
->
x
);

110 
i
 = 0; i < (
HASH_INPUT_SIZE
 >> 2); ++i)

111 ((*)
cx
->
key
)[
i
] ^= 0x36363636 ^ 0x5c5c5c5c;

114 
sha_beg
(
cx
->
x
);

115 
sha_hash
(
cx
->
key
, 
HASH_INPUT_SIZE
, cx->
x
);

116 
sha_hash
(
dig
, 
HASH_OUTPUT_SIZE
, 
cx
->
x
);

117 
sha_d
(
dig
, 
cx
->
x
);

120 
i
 = 0; i < 
mac_n
; ++i)

121 
mac
[
i
] = 
dig
[i];

125 
hmac_sha
(cڡ 
key
[], 
key_n
,

126 cڡ 
da
[], 
da_n
,

127 
mac
[], 
mac_n
)

128 { 
hmac_x
 
cx
[1];

130 
hmac_sha_beg
(
cx
);

131 
hmac_sha_key
(
key
, 
key_n
, 
cx
);

132 
hmac_sha_da
(
da
, 
da_n
, 
cx
);

133 
hmac_sha_d
(
mac
, 
mac_n
, 
cx
);

136 #i
defed
(
__lulus
)

	@common/crypt_md5.c

28 
	~"_cfig.h
"

43 
	$md5_mac
(
u8
 *
key
, 
size_t
 
key_n
, u8 *
da
, size_
da_n
, u8 *
mac
)

45 
MD5_CTX
 
cڋxt
;

47 
	`MD5In
(&
cڋxt
);

48 
	`MD5Upde
(&
cڋxt
, 
key
, 
key_n
);

49 
	`MD5Upde
(&
cڋxt
, 
da
, 
da_n
);

50 
	`MD5Upde
(&
cڋxt
, 
key
, 
key_n
);

51 
	`MD5F
(
mac
, &
cڋxt
);

52 
	}
}

66 
	$hmac_md5
(
u8
 *
key
, 
size_t
 
key_n
, u8 *
da
, size_
da_n
, u8 *
mac
)

68 
MD5_CTX
 
cڋxt
;

69 
u8
 
k_ad
[65];

70 
u8
 
k_ad
[65];

71 
u8
 
tk
[16];

72 
i
;

77 i(
key_n
 > 64) {

78 
MD5_CTX
 
cڋxt
;

80 
	`MD5In
(&
cڋxt
);

81 
	`MD5Upde
(&
cڋxt
, 
key
, 
key_n
);

82 
	`MD5F
(
tk
, &
cڋxt
);

84 
key
 = 
tk
;

85 
key_n
 = 16;

98 
	`NdisZoMemy
(
k_ad
, (k_ipad));

99 
	`NdisZoMemy
(
k_ad
, (k_opad));

101 
	`NdisMoveMemy
(
k_ad
, 
key
, 
key_n
);

102 
	`NdisMoveMemy
(
k_ad
, 
key
, 
key_n
);

105 
i
 = 0; i < 64; i++) {

106 
k_ad
[
i
] ^= 0x36;

107 
k_ad
[
i
] ^= 0x5c;

111 
	`MD5In
(&
cڋxt
);

112 
	`MD5Upde
(&
cڋxt
, 
k_ad
, 64);

113 
	`MD5Upde
(&
cڋxt
, 
da
, 
da_n
);

114 
	`MD5F
(
mac
, &
cڋxt
);

117 
	`MD5In
(&
cڋxt
);

118 
	`MD5Upde
(&
cڋxt
, 
k_ad
, 64);

119 
	`MD5Upde
(&
cڋxt
, 
mac
, 16);

120 
	`MD5F
(
mac
, &
cڋxt
);

121 
	}
}

123 #ide
RT_BIG_ENDIAN


124 
	#byRev
(
buf
, 
n


	)

126 
byRev
(*
buf
, 
lgs
);

127 
	$byRev
(*
buf
, 
lgs
)

130 *(
ULONG
 *)
buf
 = 
	`SWAP32
(*(ULONG *)buf);

131 
buf
 += 4;

132 } --
lgs
);

133 
	}
}

139 
	#MD5_F1
(
x
, 
y
, 
z
(((x& (y)| ((~x& (z)))

	)

140 
	#MD5_F2
(
x
, 
y
, 
z
(((x& (z)| ((y& (~z)))

	)

141 
	#MD5_F3
(
x
, 
y
, 
z
((x^ (y^ (z))

	)

142 
	#MD5_F4
(
x
, 
y
, 
z
((y^ ((x| (~z)))

	)

143 
	#CYCLIC_LEFT_SHIFT
(
w
, 
s
(((w<< (s)| ((w>> (32-(s))))

	)

145 
	#MD5Sp
(
f
, 
w
, 
x
, 
y
, 
z
, 
da
, 
t
, 
s
) \

146 
w
 +
	`f
(
x
, 
y
, 
z
+ 
da
 + 
t
, w = (
	`CYCLIC_LEFT_SHIFT
(w, 
s
)& 0xffffffff, w +x )

	)

159 
VOID
 
	$MD5In
(
MD5_CTX
 *
pCtx
)

161 
pCtx
->
Buf
[0]=0x67452301;

162 
pCtx
->
Buf
[1]=0xefcdab89;

163 
pCtx
->
Buf
[2]=0x98badcfe;

164 
pCtx
->
Buf
[3]=0x10325476;

166 
pCtx
->
LInBCou
[0]=0;

167 
pCtx
->
LInBCou
[1]=0;

168 
	}
}

187 
VOID
 
	$MD5Upde
(
MD5_CTX
 *
pCtx
, 
UCHAR
 *
pDa
, 
ULONG
 
LInBys
)

190 
ULONG
 
TfTimes
;

191 
ULONG
 
mp
;

192 
i
;

194 
mp
 = 
pCtx
->
LInBCou
[0];

196 
pCtx
->
LInBCou
[0] = (
ULONG
Ctx->LInBCou[0] + (
LInBys
 << 3));

198 i(
pCtx
->
LInBCou
[0] < 
mp
)

199 
pCtx
->
LInBCou
[1]++;

201 
pCtx
->
LInBCou
[1] +
LInBys
 >> 29;

204 
mp
 = (temp >> 3) & 0x3f;

207 i(
mp
)

209 
UCHAR
 *
pAds
 = (UCHAR *
pCtx
->
Iut
 + 
mp
;

211 i((
mp
+
LInBys
) < 64)

213 
	`NdisMoveMemy
(
pAds
, (
UCHAR
 *)
pDa
, 
LInBys
);

217 
	`NdisMoveMemy
(
pAds
, (
UCHAR
 *)
pDa
, 64-
mp
);

218 
	`byRev
(
pCtx
->
Iut
, 16);

219 
	`MD5Tnsfm
(
pCtx
->
Buf
, (
ULONG
 *Ctx->
Iut
);

221 
pDa
 +64-
mp
;

222 
LInBys
 -64-
mp
;

226 
TfTimes
 = (
LInBys
 >> 6);

228 
i
=
TfTimes
; i>0; i--)

230 
	`NdisMoveMemy
(
pCtx
->
Iut
, (
UCHAR
 *)
pDa
, 64);

231 
	`byRev
(
pCtx
->
Iut
, 16);

232 
	`MD5Tnsfm
(
pCtx
->
Buf
, (
ULONG
 *Ctx->
Iut
);

233 
pDa
 += 64;

234 
LInBys
 -= 64;

238 if(
LInBys
)

239 
	`NdisMoveMemy
(
pCtx
->
Iut
, (
UCHAR
 *)
pDa
, 
LInBys
);

241 
	}
}

259 
VOID
 
	$MD5F
(
UCHAR
 
Dige
[16], 
MD5_CTX
 *
pCtx
)

261 
UCHAR
 
Remad
;

262 
UCHAR
 
PadLInBys
;

263 
UCHAR
 *
pAd
=0;

264 
i
;

266 
Remad
 = (
UCHAR
)((
pCtx
->
LInBCou
[0] >> 3) & 0x3f);

268 
PadLInBys
 = (
Remad
 < 56) ? (56-Remainder) : (120-Remainder);

270 
pAd
 = (
UCHAR
 *)
pCtx
->
Iut
 + 
Remad
;

273 i(
Remad
 < 56)

275 *
pAd
 = 0x80;

276 
PadLInBys
 --;

278 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
 + 
Remad
+1, 
PadLInBys
);

281 
i
=0; i<4; i++)

283 
pCtx
->
Iut
[56+
i
] = (
UCHAR
)(Ctx->
LInBCou
[0] >> (i << 3)) & 0xff);

284 
pCtx
->
Iut
[60+
i
] = (
UCHAR
)(Ctx->
LInBCou
[1] >> (i << 3)) & 0xff);

287 
	`byRev
(
pCtx
->
Iut
, 16);

288 
	`MD5Tnsfm
(
pCtx
->
Buf
, (
ULONG
 *Ctx->
Iut
);

295 *
pAd
 = 0x80;

296 
PadLInBys
 --;

298 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
 + 
Remad
+1, (64-Remainder-1));

299 
PadLInBys
 -(64 - 
Remad
 - 1);

301 
	`byRev
(
pCtx
->
Iut
, 16);

302 
	`MD5Tnsfm
(
pCtx
->
Buf
, (
ULONG
 *Ctx->
Iut
);

306 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
, 
PadLInBys
);

309 
i
=0; i<4; i++)

311 
pCtx
->
Iut
[56+
i
] = (
UCHAR
)(Ctx->
LInBCou
[0] >> (i << 3)) & 0xff);

312 
pCtx
->
Iut
[60+
i
] = (
UCHAR
)(Ctx->
LInBCou
[1] >> (i << 3)) & 0xff);

315 
	`byRev
(
pCtx
->
Iut
, 16);

316 
	`MD5Tnsfm
(
pCtx
->
Buf
, (
ULONG
 *Ctx->
Iut
);

320 
	`NdisMoveMemy
((
UCHAR
 *)
Dige
, (
ULONG
 *)
pCtx
->
Buf
, 16);

321 
	`byRev
((
UCHAR
 *)
Dige
, 4);

322 
	`NdisZoMemy
(
pCtx
, (pCtx));

323 
	}
}

341 
VOID
 
	$MD5Tnsfm
(
ULONG
 
Buf
[4], ULONG 
Mes
[16])

343 
ULONG
 
Reg
[4], 
Temp
;

344 
i
;

346 
UCHAR
 
LShiV
[16] =

356 
ULONG
 
MD5Tab
[64] =

380 
i
=0; i<4; i++)

381 
Reg
[
i
]=
Buf
[i];

385 
i
=0; i<16; i++)

387 
	`MD5Sp
(
MD5_F1
, 
Reg
[0], Reg[1], Reg[2], Reg[3], 
Mes
[
i
],

388 
MD5Tab
[
i
], 
LShiV
[i & 0x3]);

391 
Temp
 = 
Reg
[3];

392 
Reg
[3] = Reg[2];

393 
Reg
[2] = Reg[1];

394 
Reg
[1] = Reg[0];

395 
Reg
[0] = 
Temp
;

397 
i
=16; i<32; i++)

399 
	`MD5Sp
(
MD5_F2
, 
Reg
[0], Reg[1], Reg[2], Reg[3], 
Mes
[(5*(
i
 & 0xf)+1) & 0xf],

400 
MD5Tab
[
i
], 
LShiV
[(0x1 << 2)+(i & 0x3)]);

403 
Temp
 = 
Reg
[3];

404 
Reg
[3] = Reg[2];

405 
Reg
[2] = Reg[1];

406 
Reg
[1] = Reg[0];

407 
Reg
[0] = 
Temp
;

409 
i
=32; i<48; i++)

411 
	`MD5Sp
(
MD5_F3
, 
Reg
[0], Reg[1], Reg[2], Reg[3], 
Mes
[(3*(
i
 & 0xf)+5) & 0xf],

412 
MD5Tab
[
i
], 
LShiV
[(0x1 << 3)+(i & 0x3)]);

415 
Temp
 = 
Reg
[3];

416 
Reg
[3] = Reg[2];

417 
Reg
[2] = Reg[1];

418 
Reg
[1] = Reg[0];

419 
Reg
[0] = 
Temp
;

421 
i
=48; i<64; i++)

423 
	`MD5Sp
(
MD5_F4
, 
Reg
[0], Reg[1], Reg[2], Reg[3], 
Mes
[(7*(
i
 & 0xf)) & 0xf],

424 
MD5Tab
[
i
], 
LShiV
[(0x3 << 2)+(i & 0x3)]);

427 
Temp
 = 
Reg
[3];

428 
Reg
[3] = Reg[2];

429 
Reg
[2] = Reg[1];

430 
Reg
[1] = Reg[0];

431 
Reg
[0] = 
Temp
;

436 
i
=0; i<4; i++)

437 
Buf
[
i
] +
Reg
[i];

439 
	}
}

445 
	#SHA1_F1
(
b
, 
c
, 
d
(((b& (c)| ((~b& (d)))

	)

446 
	#SHA1_F2
(
b
, 
c
, 
d
((b^ (c^ (d))

	)

447 
	#SHA1_F3
(
b
, 
c
, 
d
(((b& (c)| ((b& (d)| ((c& (d)))

	)

450 
	#SHA1Sp
(
f
, 
a
, 
b
, 
c
, 
d
, 
e
, 
w
, 
k
) \

451 
e
 +
	`f
(
b
, 
c
, 
d
+ 
w
 + 
k
 + 
	`CYCLIC_LEFT_SHIFT
(
a
, 5)) & 0xffffffff, \

452 
b
 = 
	`CYCLIC_LEFT_SHIFT
(b, 30)

	)

455 
VOID
 
	$SHAIn
(
SHA_CTX
 *
pCtx
)

457 
pCtx
->
Buf
[0]=0x67452301;

458 
pCtx
->
Buf
[1]=0xefcdab89;

459 
pCtx
->
Buf
[2]=0x98badcfe;

460 
pCtx
->
Buf
[3]=0x10325476;

461 
pCtx
->
Buf
[4]=0xc3d2e1f0;

463 
pCtx
->
LInBCou
[0]=0;

464 
pCtx
->
LInBCou
[1]=0;

465 
	}
}

483 
UCHAR
 
	$SHAUpde
(
SHA_CTX
 *
pCtx
, 
UCHAR
 *
pDa
, 
ULONG
 
LInBys
)

485 
ULONG
 
TfTimes
;

486 
ULONG
 
mp1
,
mp2
;

487 
i
;

488 
UCHAR
 
r
=1;

490 
mp1
 = 
pCtx
->
LInBCou
[0];

491 
mp2
 = 
pCtx
->
LInBCou
[1];

493 
pCtx
->
LInBCou
[0] = (
ULONG
Ctx->LInBCou[0] + (
LInBys
 << 3));

494 i(
pCtx
->
LInBCou
[0] < 
mp1
)

495 
pCtx
->
LInBCou
[1]++;

498 
pCtx
->
LInBCou
[1] = (
ULONG
Ctx->LInBCou[1] +(
LInBys
 >> 29));

499 i(
pCtx
->
LInBCou
[1] < 
mp2
)

500  (
r
);

504 
mp1
 = (temp1 >> 3) & 0x3f;

507 i(
mp1
)

509 
UCHAR
 *
pAds
 = (UCHAR *
pCtx
->
Iut
 + 
mp1
;

511 i((
mp1
+
LInBys
) < 64)

513 
	`NdisMoveMemy
(
pAds
, (
UCHAR
 *)
pDa
, 
LInBys
);

517 
	`NdisMoveMemy
(
pAds
, (
UCHAR
 *)
pDa
, 64-
mp1
);

518 
	`byRev
((
UCHAR
 *)
pCtx
->
Iut
, 16);

520 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
 + 64, 16);

521 
	`SHATnsfm
(
pCtx
->
Buf
, (
ULONG
 *Ctx->
Iut
);

523 
pDa
 +64-
mp1
;

524 
LInBys
 -64-
mp1
;

528 
TfTimes
 = (
LInBys
 >> 6);

530 
i
=
TfTimes
; i>0; i--)

532 
	`NdisMoveMemy
(
pCtx
->
Iut
, (
UCHAR
 *)
pDa
, 64);

533 
	`byRev
((
UCHAR
 *)
pCtx
->
Iut
, 16);

535 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
 + 64, 16);

536 
	`SHATnsfm
(
pCtx
->
Buf
, (
ULONG
 *Ctx->
Iut
);

537 
pDa
 += 64;

538 
LInBys
 -= 64;

542 if(
LInBys
)

543 
	`NdisMoveMemy
(
pCtx
->
Iut
, (
UCHAR
 *)
pDa
, 
LInBys
);

547 
	}
}

551 
VOID
 
	$SHAF
(
SHA_CTX
 *
pCtx
, 
UCHAR
 
Dige
[20])

553 
UCHAR
 
Remad
;

554 
UCHAR
 
PadLInBys
;

555 
UCHAR
 *
pAd
=0;

556 
i
;

558 
Remad
 = (
UCHAR
)((
pCtx
->
LInBCou
[0] >> 3) & 0x3f);

560 
pAd
 = (
UCHAR
 *)
pCtx
->
Iut
 + 
Remad
;

562 
PadLInBys
 = (
Remad
 < 56) ? (56-Remainder) : (120-Remainder);

565 i(
Remad
 < 56)

567 *
pAd
 = 0x80;

568 
PadLInBys
 --;

570 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
 + 
Remad
+1, 
PadLInBys
);

573 
i
=0; i<4; i++)

575 
pCtx
->
Iut
[56+
i
] = (
UCHAR
)(Ctx->
LInBCou
[1] >> ((3-i) << 3)) & 0xff);

576 
pCtx
->
Iut
[60+
i
] = (
UCHAR
)(Ctx->
LInBCou
[0] >> ((3-i) << 3)) & 0xff);

579 
	`byRev
((
UCHAR
 *)
pCtx
->
Iut
, 16);

580 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
 + 64, 14);

581 
	`SHATnsfm
(
pCtx
->
Buf
, (
ULONG
 *Ctx->
Iut
);

588 *
pAd
 = 0x80;

589 
PadLInBys
 --;

591 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
 + 
Remad
+1, (64-Remainder-1));

592 
PadLInBys
 -(64 - 
Remad
 - 1);

594 
	`byRev
((
UCHAR
 *)
pCtx
->
Iut
, 16);

595 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
 + 64, 16);

596 
	`SHATnsfm
(
pCtx
->
Buf
, (
ULONG
 *Ctx->
Iut
);

600 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
, 
PadLInBys
);

603 
i
=0; i<4; i++)

605 
pCtx
->
Iut
[56+
i
] = (
UCHAR
)(Ctx->
LInBCou
[1] >> ((3-i) << 3)) & 0xff);

606 
pCtx
->
Iut
[60+
i
] = (
UCHAR
)(Ctx->
LInBCou
[0] >> ((3-i) << 3)) & 0xff);

609 
	`byRev
((
UCHAR
 *)
pCtx
->
Iut
, 16);

610 
	`NdisZoMemy
((
UCHAR
 *)
pCtx
->
Iut
 + 64, 16);

611 
	`SHATnsfm
(
pCtx
->
Buf
, (
ULONG
 *Ctx->
Iut
);

616 
i
=0; i<20; i++)

618 
Dige
 [
i
] = (
UCHAR
)(
pCtx
->
Buf
[i>>2] >> 8*(3-(i & 0x3)));

621 
	`NdisZoMemy
(
pCtx
, (pCtx));

622 
	}
}

627 
VOID
 
	$SHATnsfm
(
ULONG
 
Buf
[5], ULONG 
Mes
[20])

629 
ULONG
 
Reg
[5],
Temp
;

630 
i
;

631 
ULONG
 
W
[80];

633 
ULONG
 
SHA1Tab
[4] = { 0x5a827999, 0x6ed9eba1,

636 
Reg
[0]=
Buf
[0];

637 
Reg
[1]=
Buf
[1];

638 
Reg
[2]=
Buf
[2];

639 
Reg
[3]=
Buf
[3];

640 
Reg
[4]=
Buf
[4];

643 
i
 = 0; i < 16; i++)

645 
W
[
i
] = (
Mes
[i] >> 24) & 0xff;

646 
W
[
i
] |(
Mes
[i] >> 8 ) & 0xff00;

647 
W
[
i
] |(
Mes
[i] << 8 ) & 0xff0000;

648 
W
[
i
] |(
Mes
[i] << 24) & 0xff000000;

652 
i
 = 0; i < 64; i++)

653 
W
[16+
i
] = 
	`CYCLIC_LEFT_SHIFT
(W[i] ^ W[2+i] ^ W[8+i] ^ W[13+i], 1);

657 
i
=0; i<80; i++)

659 i(
i
<20)

660 
	`SHA1Sp
(
SHA1_F1
, 
Reg
[0], Reg[1], Reg[2], Reg[3], Reg[4],

661 
W
[
i
], 
SHA1Tab
[0]);

663 i(
i
>=20 && i<40)

664 
	`SHA1Sp
(
SHA1_F2
, 
Reg
[0], Reg[1], Reg[2], Reg[3], Reg[4],

665 
W
[
i
], 
SHA1Tab
[1]);

667 i(
i
>=40 && i<60)

668 
	`SHA1Sp
(
SHA1_F3
, 
Reg
[0], Reg[1], Reg[2], Reg[3], Reg[4],

669 
W
[
i
], 
SHA1Tab
[2]);

672 
	`SHA1Sp
(
SHA1_F2
, 
Reg
[0], Reg[1], Reg[2], Reg[3], Reg[4],

673 
W
[
i
], 
SHA1Tab
[3]);

677 
Temp
 = 
Reg
[4];

678 
Reg
[4] = Reg[3];

679 
Reg
[3] = Reg[2];

680 
Reg
[2] = Reg[1];

681 
Reg
[1] = Reg[0];

682 
Reg
[0] = 
Temp
;

688 
i
=0; i<5; i++)

689 
Buf
[
i
] +
Reg
[i];

691 
	}
}

708 
VOID
 
	$HMAC_SHA1
(

709 
IN
 
UCHAR
 *
xt
,

710 
IN
 
UINT
 
xt_n
,

711 
IN
 
UCHAR
 *
key
,

712 
IN
 
UINT
 
key_n
,

713 
IN
 
UCHAR
 *
dige
)

715 
SHA_CTX
 
cڋxt
;

716 
UCHAR
 
k_ad
[65];

717 
UCHAR
 
k_ad
[65];

718 
INT
 
i
;

721 i(
key_n
 > 64)

723 
SHA_CTX
 
tx
;

724 
	`SHAIn
(&
tx
);

725 
	`SHAUpde
(&
tx
, 
key
, 
key_n
);

726 
	`SHAF
(&
tx
, 
key
);

727 
key_n
 = 20;

729 
	`NdisZoMemy
(
k_ad
, (k_ipad));

730 
	`NdisZoMemy
(
k_ad
, (k_opad));

731 
	`NdisMoveMemy
(
k_ad
, 
key
, 
key_n
);

732 
	`NdisMoveMemy
(
k_ad
, 
key
, 
key_n
);

735 
i
 = 0; i < 64; i++)

737 
k_ad
[
i
] ^= 0x36;

738 
k_ad
[
i
] ^= 0x5c;

742 
	`SHAIn
(&
cڋxt
);

743 
	`SHAUpde
(&
cڋxt
, 
k_ad
, 64);

744 
	`SHAUpde
(&
cڋxt
, 
xt
, 
xt_n
);

745 
	`SHAF
(&
cڋxt
, 
dige
);

748 
	`SHAIn
(&
cڋxt
);

749 
	`SHAUpde
(&
cڋxt
, 
k_ad
, 64);

750 
	`SHAUpde
(&
cڋxt
, 
dige
, 20);

751 
	`SHAF
(&
cڋxt
, 
dige
);

752 
	}
}

	@common/crypt_sha2.c

28 
	~"_cfig.h
"

31 #i
defed
(
__lulus
)

36 #ifde
_MSC_VER


37 #agm
sic
(
memy
)

40 #i0 && 
defed
(
_MSC_VER
)

41 
	#rl32
 
_l


	)

42 
	#rr32
 
_r


	)

44 
	#rl32
(
x
,
n
(((x<<| ((x>> (32 -)))

	)

45 
	#rr32
(
x
,
n
(((x>>| ((x<< (32 -)))

	)

48 #i!
defed
(
bsw_32
)

49 
	#bsw_32
(
x
((
	`rr32
((x), 24& 0x00ff00ff| (rr32((x), 8& 0xff00ff00))

	)

52 #ifdef 
__BIG_ENDIAN


53 #unde
SWAP_BYTES


55 
	#SWAP_BYTES


	)

59 
	#ch
(
x
,
y
,
z
((z^ ((x& ((y^ (z))))

	)

60 
	#maj
(
x
,
y
,
z
(((x& (y)| ((z& ((x^ (y))))

	)

65 
	#vf
(
n
,
i

v
[ - i& 7]

	)

67 
	#hf
(
i
(
p
[i & 15] += \

68 
	`g_1
(
p
[(
i
 + 14& 15]+[(+ 9& 15] + 
	`g_0
[(+ 1& 15]))

	)

70 
	#v_cye
(
i
,
j
) \

71 
	`vf
(7,
i
+(
j
 ? 
	`hf
(i: 
p
[i]+ 
k_0
[i+j] \

72 + 
	`s_1
(
	`vf
(4,
i
)+ 
	`ch
(vf(4,i),vf(5,i),vf(6,i)); \

73 
	`vf
(3,
i
) += vf(7,i); \

74 
	`vf
(7,
i
+
	`s_0
(vf(0,i))+ 
	`maj
(vf(0,i),vf(1,i),vf(2,i))

	)

76 #i
defed
(
SHA_224
|| defed(
SHA_256
)

78 
	#SHA256_MASK
 (
SHA256_BLOCK_SIZE
 - 1)

	)

80 #i
defed
(
SWAP_BYTES
)

81 
	#bsw_32
(
p
,
n
) \

82 { 
_i
 = (
n
); _i--((
ut_32t
*)
p
)[_i] = 
	`bsw_32
(((ut_32t*)[_i]); }

	)

84 
	#bsw_32
(
p
,
n
)

	)

87 
	#s_0
(
x
(
	`rr32
((x), 2^r32((x), 13^r32((x), 22))

	)

88 
	#s_1
(
x
(
	`rr32
((x), 6^r32((x), 11^r32((x), 25))

	)

89 
	#g_0
(
x
(
	`rr32
((x), 7^r32((x), 18^ ((x>> 3))

	)

90 
	#g_1
(
x
(
	`rr32
((x), 17^r32((x), 19^ ((x>> 10))

	)

91 
	#k_0
 
k256


	)

97 
	#q
(
n

v
##
	)
n

99 
	#e_cye
(
a
,
b
,
c
,
d
,
e
,
f
,
g
,
h
,
k
,
w
) \

100 
	`q
(
h
+
	`s_1
(q(
e
)+ 
	`ch
(q), q(
f
), q(
g
)+ 
k
 + 
w
; \

101 
	`q
(
d
+q(
h
); q(h+
	`s_0
(q(
a
)+ 
	`maj
(q), q(
b
), q(
c
))

	)

105 cڡ 
ut_32t
 
k256
[64] =

130 
void_t
 
sha256_compe
(
sha256_x
 
x
[1])

132 #i!
defed
(
UNROLL_SHA2
)

134 
ut_32t
 
j
, *
p
 = 
x
->
wbuf
, 
v
[8];

136 
memy
(
v
, 
x
->
hash
, 8 * (
ut_32t
));

138 
j
 = 0; j < 64; j += 16)

140 
v_cye
0, 
j
); v_cycle( 1, j);

141 
v_cye
2, 
j
); v_cycle( 3, j);

142 
v_cye
4, 
j
); v_cycle( 5, j);

143 
v_cye
6, 
j
); v_cycle( 7, j);

144 
v_cye
8, 
j
); v_cycle( 9, j);

145 
v_cye
(10, 
j
); v_cycle(11, j);

146 
v_cye
(12, 
j
); v_cycle(13, j);

147 
v_cye
(14, 
j
); v_cycle(15, j);

150 
x
->
hash
[0] +
v
[0]; ctx->hash[1] += v[1];

151 
x
->
hash
[2] +
v
[2]; ctx->hash[3] += v[3];

152 
x
->
hash
[4] +
v
[4]; ctx->hash[5] += v[5];

153 
x
->
hash
[6] +
v
[6]; ctx->hash[7] += v[7];

157 
ut_32t
 *
p
 = 
x
->
wbuf
,
v0
,
v1
,
v2
,
v3
,
v4
,
v5
,
v6
,
v7
;

159 
v0
 = 
x
->
hash
[0]; 
v1
 = ctx->hash[1];

160 
v2
 = 
x
->
hash
[2]; 
v3
 = ctx->hash[3];

161 
v4
 = 
x
->
hash
[4]; 
v5
 = ctx->hash[5];

162 
v6
 = 
x
->
hash
[6]; 
v7
 = ctx->hash[7];

164 
e_cye
(0,1,2,3,4,5,6,7,
k256
[ 0],
p
[ 0]);

165 
e_cye
(7,0,1,2,3,4,5,6,
k256
[ 1],
p
[ 1]);

166 
e_cye
(6,7,0,1,2,3,4,5,
k256
[ 2],
p
[ 2]);

167 
e_cye
(5,6,7,0,1,2,3,4,
k256
[ 3],
p
[ 3]);

168 
e_cye
(4,5,6,7,0,1,2,3,
k256
[ 4],
p
[ 4]);

169 
e_cye
(3,4,5,6,7,0,1,2,
k256
[ 5],
p
[ 5]);

170 
e_cye
(2,3,4,5,6,7,0,1,
k256
[ 6],
p
[ 6]);

171 
e_cye
(1,2,3,4,5,6,7,0,
k256
[ 7],
p
[ 7]);

172 
e_cye
(0,1,2,3,4,5,6,7,
k256
[ 8],
p
[ 8]);

173 
e_cye
(7,0,1,2,3,4,5,6,
k256
[ 9],
p
[ 9]);

174 
e_cye
(6,7,0,1,2,3,4,5,
k256
[10],
p
[10]);

175 
e_cye
(5,6,7,0,1,2,3,4,
k256
[11],
p
[11]);

176 
e_cye
(4,5,6,7,0,1,2,3,
k256
[12],
p
[12]);

177 
e_cye
(3,4,5,6,7,0,1,2,
k256
[13],
p
[13]);

178 
e_cye
(2,3,4,5,6,7,0,1,
k256
[14],
p
[14]);

179 
e_cye
(1,2,3,4,5,6,7,0,
k256
[15],
p
[15]);

181 
e_cye
(0,1,2,3,4,5,6,7,
k256
[16],
hf
( 0));

182 
e_cye
(7,0,1,2,3,4,5,6,
k256
[17],
hf
( 1));

183 
e_cye
(6,7,0,1,2,3,4,5,
k256
[18],
hf
( 2));

184 
e_cye
(5,6,7,0,1,2,3,4,
k256
[19],
hf
( 3));

185 
e_cye
(4,5,6,7,0,1,2,3,
k256
[20],
hf
( 4));

186 
e_cye
(3,4,5,6,7,0,1,2,
k256
[21],
hf
( 5));

187 
e_cye
(2,3,4,5,6,7,0,1,
k256
[22],
hf
( 6));

188 
e_cye
(1,2,3,4,5,6,7,0,
k256
[23],
hf
( 7));

189 
e_cye
(0,1,2,3,4,5,6,7,
k256
[24],
hf
( 8));

190 
e_cye
(7,0,1,2,3,4,5,6,
k256
[25],
hf
( 9));

191 
e_cye
(6,7,0,1,2,3,4,5,
k256
[26],
hf
(10));

192 
e_cye
(5,6,7,0,1,2,3,4,
k256
[27],
hf
(11));

193 
e_cye
(4,5,6,7,0,1,2,3,
k256
[28],
hf
(12));

194 
e_cye
(3,4,5,6,7,0,1,2,
k256
[29],
hf
(13));

195 
e_cye
(2,3,4,5,6,7,0,1,
k256
[30],
hf
(14));

196 
e_cye
(1,2,3,4,5,6,7,0,
k256
[31],
hf
(15));

198 
e_cye
(0,1,2,3,4,5,6,7,
k256
[32],
hf
( 0));

199 
e_cye
(7,0,1,2,3,4,5,6,
k256
[33],
hf
( 1));

200 
e_cye
(6,7,0,1,2,3,4,5,
k256
[34],
hf
( 2));

201 
e_cye
(5,6,7,0,1,2,3,4,
k256
[35],
hf
( 3));

202 
e_cye
(4,5,6,7,0,1,2,3,
k256
[36],
hf
( 4));

203 
e_cye
(3,4,5,6,7,0,1,2,
k256
[37],
hf
( 5));

204 
e_cye
(2,3,4,5,6,7,0,1,
k256
[38],
hf
( 6));

205 
e_cye
(1,2,3,4,5,6,7,0,
k256
[39],
hf
( 7));

206 
e_cye
(0,1,2,3,4,5,6,7,
k256
[40],
hf
( 8));

207 
e_cye
(7,0,1,2,3,4,5,6,
k256
[41],
hf
( 9));

208 
e_cye
(6,7,0,1,2,3,4,5,
k256
[42],
hf
(10));

209 
e_cye
(5,6,7,0,1,2,3,4,
k256
[43],
hf
(11));

210 
e_cye
(4,5,6,7,0,1,2,3,
k256
[44],
hf
(12));

211 
e_cye
(3,4,5,6,7,0,1,2,
k256
[45],
hf
(13));

212 
e_cye
(2,3,4,5,6,7,0,1,
k256
[46],
hf
(14));

213 
e_cye
(1,2,3,4,5,6,7,0,
k256
[47],
hf
(15));

215 
e_cye
(0,1,2,3,4,5,6,7,
k256
[48],
hf
( 0));

216 
e_cye
(7,0,1,2,3,4,5,6,
k256
[49],
hf
( 1));

217 
e_cye
(6,7,0,1,2,3,4,5,
k256
[50],
hf
( 2));

218 
e_cye
(5,6,7,0,1,2,3,4,
k256
[51],
hf
( 3));

219 
e_cye
(4,5,6,7,0,1,2,3,
k256
[52],
hf
( 4));

220 
e_cye
(3,4,5,6,7,0,1,2,
k256
[53],
hf
( 5));

221 
e_cye
(2,3,4,5,6,7,0,1,
k256
[54],
hf
( 6));

222 
e_cye
(1,2,3,4,5,6,7,0,
k256
[55],
hf
( 7));

223 
e_cye
(0,1,2,3,4,5,6,7,
k256
[56],
hf
( 8));

224 
e_cye
(7,0,1,2,3,4,5,6,
k256
[57],
hf
( 9));

225 
e_cye
(6,7,0,1,2,3,4,5,
k256
[58],
hf
(10));

226 
e_cye
(5,6,7,0,1,2,3,4,
k256
[59],
hf
(11));

227 
e_cye
(4,5,6,7,0,1,2,3,
k256
[60],
hf
(12));

228 
e_cye
(3,4,5,6,7,0,1,2,
k256
[61],
hf
(13));

229 
e_cye
(2,3,4,5,6,7,0,1,
k256
[62],
hf
(14));

230 
e_cye
(1,2,3,4,5,6,7,0,
k256
[63],
hf
(15));

232 
x
->
hash
[0] +
v0
; ctx->hash[1] +
v1
;

233 
x
->
hash
[2] +
v2
; ctx->hash[3] +
v3
;

234 
x
->
hash
[4] +
v4
; ctx->hash[5] +
v5
;

235 
x
->
hash
[6] +
v6
; ctx->hash[7] +
v7
;

242 
void_t
 
sha256_hash
(cڡ 
da
[], 
n
, 
sha256_x
 
x
[1])

243 { 
ut_32t
 
pos
 = (ut_32t)(
x
->
cou
[0] & 
SHA256_MASK
),

244 
a
 = 
SHA256_BLOCK_SIZE
 - 
pos
;

245 cڡ *

 = 
da
;

247 if((
x
->
cou
[0] +
n
) <en)

248 ++(
x
->
cou
[1]);

250 
n
 >
a
)

252 
memy
(((*)
x
->
wbuf
+ 
pos
, 

, 
a
);

253 

 +
a
; 
n
 -a; s = 
SHA256_BLOCK_SIZE
; 
pos
 = 0;

254 
bsw_32
(
x
->
wbuf
, 
SHA256_BLOCK_SIZE
 >> 2)

255 
sha256_compe
(
x
);

258 
memy
(((*)
x
->
wbuf
+ 
pos
, 

, 
n
);

263 
sha_d1
(
hv
[], 
sha256_x
 
x
[1], cڡ 
hn
)

264 { 
ut_32t
 
i
 = (ut_32t)(
x
->
cou
[0] & 
SHA256_MASK
);

269 
bsw_32
(
x
->
wbuf
, (
i
 + 3) >> 2)

275 
x
->
wbuf
[
i
 >> 2] &= 0xffffff80 << 8 * (~i & 3);

276 
x
->
wbuf
[
i
 >> 2] |= 0x00000080 << 8 * (~i & 3);

281 if(
i
 > 
SHA256_BLOCK_SIZE
 - 9)

283 if(
i
 < 60
x
->
wbuf
[15] = 0;

284 
sha256_compe
(
x
);

285 
i
 = 0;

288 
i
 = (i >> 2) + 1;

290 
i
 < 14)

291 
x
->
wbuf
[
i
++] = 0;

297 
x
->
wbuf
[14] = (x->
cou
[1] << 3) | (ctx->count[0] >> 29);

298 
x
->
wbuf
[15] = ctx->
cou
[0] << 3;

299 
sha256_compe
(
x
);

303 
i
 = 0; i < 
hn
; ++i)

304 
hv
[
i
] = ()(
x
->
hash
[i >> 2] >> (8 * (~i & 3)));

309 #i
defed
(
SHA_224
)

311 cڡ 
ut_32t
 
i224
[8] =

317 
void_t
 
sha224_beg
(
sha224_x
 
x
[1])

319 
x
->
cou
[0] = ctx->count[1] = 0;

320 
memy
(
x
->
hash
, 
i224
, 8 * (
ut_32t
));

323 
void_t
 
sha224_d
(
hv
[], 
sha224_x
 
x
[1])

325 
sha_d1
(
hv
, 
x
, 
SHA224_DIGEST_SIZE
);

328 
void_t
 
sha224
(
hv
[], cڡ 
da
[], 
n
)

329 { 
sha224_x
 
cx
[1];

331 
sha224_beg
(
cx
);

332 
sha224_hash
(
da
, 
n
, 
cx
);

333 
sha_d1
(
hv
, 
cx
, 
SHA224_DIGEST_SIZE
);

338 #i
defed
(
SHA_256
)

340 cڡ 
ut_32t
 
i256
[8] =

346 
void_t
 
sha256_beg
(
sha256_x
 
x
[1])

348 
x
->
cou
[0] = ctx->count[1] = 0;

349 
memy
(
x
->
hash
, 
i256
, 8 * (
ut_32t
));

352 
void_t
 
sha256_d
(
hv
[], 
sha256_x
 
x
[1])

354 
sha_d1
(
hv
, 
x
, 
SHA256_DIGEST_SIZE
);

357 
void_t
 
sha256
(
hv
[], cڡ 
da
[], 
n
)

358 { 
sha256_x
 
cx
[1];

360 
sha256_beg
(
cx
);

361 
sha256_hash
(
da
, 
n
, 
cx
);

362 
sha_d1
(
hv
, 
cx
, 
SHA256_DIGEST_SIZE
);

367 #i
defed
(
SHA_384
|| defed(
SHA_512
)

369 
	#SHA512_MASK
 (
SHA512_BLOCK_SIZE
 - 1)

	)

371 
	#rr64
(
x
,
n
(((x>>| ((x<< (64 -)))

	)

373 #i!
defed
(
bsw_64
)

374 
	#bsw_64
(
x
(((
ut_64t
)(
	`bsw_32
((
ut_32t
)(x)))<< 32 | bsw_32((ut_32t)((x>> 32)))

	)

377 #i
defed
(
SWAP_BYTES
)

378 
	#bsw_64
(
p
,
n
) \

379 { 
_i
 = (
n
); _i--((
ut_64t
*)
p
)[_i] = 
	`bsw_64
(((ut_64t*)[_i]); }

	)

381 
	#bsw_64
(
p
,
n
)

	)

386 #ifde 
s_0


387 #unde
s_0


388 #unde
s_1


389 #unde
g_0


390 #unde
g_1


391 #unde
k_0


394 
	#s_0
(
x
(
	`rr64
((x), 28^r64((x), 34^r64((x), 39))

	)

395 
	#s_1
(
x
(
	`rr64
((x), 14^r64((x), 18^r64((x), 41))

	)

396 
	#g_0
(
x
(
	`rr64
((x), 1^r64((x), 8^ ((x>> 7))

	)

397 
	#g_1
(
x
(
	`rr64
((x), 19^r64((x), 61^ ((x>> 6))

	)

398 
	#k_0
 
k512


	)

402 cڡ 
ut_64t
 
k512
[80] =

404 
li_64
(428a2f98d728ae22),i_64(7137449123ef65cd),

405 
li_64
(
b5c0fbcc4d3b2f
),i_64(
e9b5dba58189dbbc
),

406 
li_64
(3956c25bf348b538),i_64(59f111f1b605d019),

407 
li_64
(923f82a4af194f9b),i_64(
ab1c5ed5da6d8118
),

408 
li_64
(
d80798a3030242
),i_64(12835b0145706fbe),

409 
li_64
(243185be4ee4b28c),i_64(550c7dc3d5ffb4e2),

410 
li_64
(72be5d74f27b896f),i_64(80deb1fe3b1696b1),

411 
li_64
(9bdc06a725c71235),i_64(
c19bf174cf692694
),

412 
li_64
(
e49b69c19ef14ad2
),i_64(
efbe4786384f25e3
),

413 
li_64
(0fc19dc68b8cd5b5),i_64(240ca1cc77ac9c65),

414 
li_64
(2de92c6f592b0275),i_64(4a7484aa6ea6e483),

415 
li_64
(5cb0a9dcbd41fbd4),i_64(76f988da831153b5),

416 
li_64
(983e515266db),i_64(
a831c66d2db43210
),

417 
li_64
(
b00327c898fb213f
),i_64(
bf597fc7bf04
),

418 
li_64
(
c6e00bf33da88fc2
),i_64(
d5a79147930725
),

419 
li_64
(06ca6351e003826f),i_64(142929670a0e6e70),

420 
li_64
(27b70a8546d22ffc),i_64(2e1b21385c26c926),

421 
li_64
(4d2c6dfc5ac42aed),i_64(53380d139d95b3df),

422 
li_64
(650a73548baf63de),i_64(766a0abb3c77b2a8),

423 
li_64
(81c2c92e47edaee6),i_64(92722c851482353b),

424 
li_64
(
a2b8a14cf10364
),i_64(
a81a664bbc423001
),

425 
li_64
(
c24b8b70d0f89791
),i_64(
c76c51a30654be30
),

426 
li_64
(
d192e819d6ef5218
),i_64(
d69906245565a910
),

427 
li_64
(
f40e35855771202a
),i_64(106aa07032bbd1b8),

428 
li_64
(19a4c116b8d2d0c8),i_64(1e376c085141ab53),

429 
li_64
(2748774cdf8eeb99),i_64(34b0bcb5e19b48a8),

430 
li_64
(391c0cb3c5c95a63),i_64(4ed8aa4ae3418acb),

431 
li_64
(5b9cca4f7763e373),i_64(682e6ff3d6b2b8a3),

432 
li_64
(748f82ee5defb2fc),i_64(78a5636f43172f60),

433 
li_64
(84c87814a1f0ab72),i_64(8cc702081a6439ec),

434 
li_64
(90beff23631e28),i_64(
a4506bde82bde9
),

435 
li_64
(
bef9a3f7b2c67915
),i_64(
c67178f2e372532b
),

436 
li_64
(
273e26619c
),i_64(
d186b8c721c0c207
),

437 
li_64
(
da7dd6cde0eb1e
),i_64(
f57d4f7e6ed178
),

438 
li_64
(06f067aa72176fba),i_64(0a637dc5a2c898a6),

439 
li_64
(113f9804bef90dae),i_64(1b710b35131c471b),

440 
li_64
(28db77f523047d84),i_64(32caab7b40c72493),

441 
li_64
(3c9ebe0a15c9bebc),i_64(431d67c49c100d4c),

442 
li_64
(4cc5d4becb3e42b6),i_64(597f299cfc657e2a),

443 
li_64
(5fcb6fab3ad6faec),i_64(6c44198c4a475817)

452 
void_t
 
sha512_compe
(
sha512_x
 
x
[1])

453 { 
ut_64t
 
v
[8], *
p
 = 
x
->
wbuf
;

454 
ut_32t
 
j
;

456 
memy
(
v
, 
x
->
hash
, 8 * (
ut_64t
));

458 
j
 = 0; j < 80; j += 16)

460 
v_cye
0, 
j
); v_cycle( 1, j);

461 
v_cye
2, 
j
); v_cycle( 3, j);

462 
v_cye
4, 
j
); v_cycle( 5, j);

463 
v_cye
6, 
j
); v_cycle( 7, j);

464 
v_cye
8, 
j
); v_cycle( 9, j);

465 
v_cye
(10, 
j
); v_cycle(11, j);

466 
v_cye
(12, 
j
); v_cycle(13, j);

467 
v_cye
(14, 
j
); v_cycle(15, j);

470 
x
->
hash
[0] +
v
[0]; ctx->hash[1] += v[1];

471 
x
->
hash
[2] +
v
[2]; ctx->hash[3] += v[3];

472 
x
->
hash
[4] +
v
[4]; ctx->hash[5] += v[5];

473 
x
->
hash
[6] +
v
[6]; ctx->hash[7] += v[7];

483 
void_t
 
sha512_hash
(cڡ 
da
[], 
n
, 
sha512_x
 
x
[1])

484 { 
ut_32t
 
pos
 = (ut_32t)(
x
->
cou
[0] & 
SHA512_MASK
),

485 
a
 = 
SHA512_BLOCK_SIZE
 - 
pos
;

486 cڡ *

 = 
da
;

488 if((
x
->
cou
[0] +
n
) <en)

489 ++(
x
->
cou
[1]);

491 
n
 >
a
)

493 
memy
(((*)
x
->
wbuf
+ 
pos
, 

, 
a
);

494 

 +
a
; 
n
 -a; s = 
SHA512_BLOCK_SIZE
; 
pos
 = 0;

495 
bsw_64
(
x
->
wbuf
, 
SHA512_BLOCK_SIZE
 >> 3);

496 
sha512_compe
(
x
);

499 
memy
(((*)
x
->
wbuf
+ 
pos
, 

, 
n
);

504 
sha_d2
(
hv
[], 
sha512_x
 
x
[1], cڡ 
hn
)

505 { 
ut_32t
 
i
 = (ut_32t)(
x
->
cou
[0] & 
SHA512_MASK
);

510 
bsw_64
(
x
->
wbuf
, (
i
 + 7) >> 3);

516 
x
->
wbuf
[
i
 >> 3] &
li_64
(
ffffffffffffff00
) << 8 * (~i & 7);

517 
x
->
wbuf
[
i
 >> 3] |
li_64
(0000000000000080) << 8 * (~i & 7);

522 if(
i
 > 
SHA512_BLOCK_SIZE
 - 17)

524 if(
i
 < 120
x
->
wbuf
[15] = 0;

525 
sha512_compe
(
x
);

526 
i
 = 0;

529 
i
 = (i >> 3) + 1;

531 
i
 < 14)

532 
x
->
wbuf
[
i
++] = 0;

538 
x
->
wbuf
[14] = (x->
cou
[1] << 3) | (ctx->count[0] >> 61);

539 
x
->
wbuf
[15] = ctx->
cou
[0] << 3;

540 
sha512_compe
(
x
);

544 
i
 = 0; i < 
hn
; ++i)

545 
hv
[
i
] = ()(
x
->
hash
[i >> 3] >> (8 * (~i & 7)));

550 #i
defed
(
SHA_384
)

554 cڡ 
ut_64t
 
i384
[80] =

556 
li_64
(
cbbb9d5dc1059ed8
),i_64(629a292a367cd507),

557 
li_64
(9159015a3070dd17),i_64(152fecd8f70e5939),

558 
li_64
(67332667ffc00b31),i_64(8eb44a8768581511),

559 
li_64
(
db0c2e0d64f987
),i_64(47b5481dbefa4fa4)

562 
void_t
 
sha384_beg
(
sha384_x
 
x
[1])

564 
x
->
cou
[0] = ctx->count[1] = 0;

565 
memy
(
x
->
hash
, 
i384
, 8 * (
ut_64t
));

568 
void_t
 
sha384_d
(
hv
[], 
sha384_x
 
x
[1])

570 
sha_d2
(
hv
, 
x
, 
SHA384_DIGEST_SIZE
);

573 
void_t
 
sha384
(
hv
[], cڡ 
da
[], 
n
)

574 { 
sha384_x
 
cx
[1];

576 
sha384_beg
(
cx
);

577 
sha384_hash
(
da
, 
n
, 
cx
);

578 
sha_d2
(
hv
, 
cx
, 
SHA384_DIGEST_SIZE
);

583 #i
defed
(
SHA_512
)

587 cڡ 
ut_64t
 
i512
[80] =

589 
li_64
(6a09e667f3bcc908),i_64(
bb678584a73b
),

590 
li_64
(3c6ef37294f82b),i_64(
a54ff53a5f1d36f1
),

591 
li_64
(510e527fade682d1),i_64(9b05688c2b3e6c1f),

592 
li_64
(1f83d9abfb41bd6b),i_64(5be0cd19137e2179)

595 
void_t
 
sha512_beg
(
sha512_x
 
x
[1])

597 
x
->
cou
[0] = ctx->count[1] = 0;

598 
memy
(
x
->
hash
, 
i512
, 8 * (
ut_64t
));

601 
void_t
 
sha512_d
(
hv
[], 
sha512_x
 
x
[1])

603 
sha_d2
(
hv
, 
x
, 
SHA512_DIGEST_SIZE
);

606 
void_t
 
sha512
(
hv
[], cڡ 
da
[], 
n
)

607 { 
sha512_x
 
cx
[1];

609 
sha512_beg
(
cx
);

610 
sha512_hash
(
da
, 
n
, 
cx
);

611 
sha_d2
(
hv
, 
cx
, 
SHA512_DIGEST_SIZE
);

616 #i
defed
(
SHA_2
)

618 
	#CTX_224
(
x
((x)->
uu
->
x256
)

	)

619 
	#CTX_256
(
x
((x)->
uu
->
x256
)

	)

620 
	#CTX_384
(
x
((x)->
uu
->
x512
)

	)

621 
	#CTX_512
(
x
((x)->
uu
->
x512
)

	)

625 
t_t
 
sha2_beg
(
n
, 
sha2_x
 
x
[1])

627 
n
)

629 #i
defed
(
SHA_224
)

631 28: 
CTX_256
(
x
)->
cou
[0] = CTX_256(ctx)->count[1] = 0;

632 
memy
(
CTX_256
(
x
)->
hash
, 
i224
, 32);

633 
x
->
sha2_n
 = 28;  
EXIT_SUCCESS
;

635 #i
defed
(
SHA_256
)

637 32: 
CTX_256
(
x
)->
cou
[0] = CTX_256(ctx)->count[1] = 0;

638 
memy
(
CTX_256
(
x
)->
hash
, 
i256
, 32);

639 
x
->
sha2_n
 = 32;  
EXIT_SUCCESS
;

641 #i
defed
(
SHA_384
)

643 48: 
CTX_384
(
x
)->
cou
[0] = CTX_384(ctx)->count[1] = 0;

644 
memy
(
CTX_384
(
x
)->
hash
, 
i384
, 64);

645 
x
->
sha2_n
 = 48;  
EXIT_SUCCESS
;

647 #i
defed
(
SHA_512
)

649 64: 
CTX_512
(
x
)->
cou
[0] = CTX_512(ctx)->count[1] = 0;

650 
memy
(
CTX_512
(
x
)->
hash
, 
i512
, 64);

651 
x
->
sha2_n
 = 64;  
EXIT_SUCCESS
;

653 :  
EXIT_FAILURE
;

657 
void_t
 
sha2_hash
(cڡ 
da
[], 
n
, 
sha2_x
 
x
[1])

659 
x
->
sha2_n
)

661 #i
defed
(
SHA_224
)

662 28: 
sha224_hash
(
da
, 
n
, 
CTX_224
(
x
)); ;

664 #i
defed
(
SHA_256
)

665 32: 
sha256_hash
(
da
, 
n
, 
CTX_256
(
x
)); ;

667 #i
defed
(
SHA_384
)

668 48: 
sha384_hash
(
da
, 
n
, 
CTX_384
(
x
)); ;

670 #i
defed
(
SHA_512
)

671 64: 
sha512_hash
(
da
, 
n
, 
CTX_512
(
x
)); ;

676 
void_t
 
sha2_d
(
hv
[], 
sha2_x
 
x
[1])

678 
x
->
sha2_n
)

680 #i
defed
(
SHA_224
)

681 28: 
sha_d1
(
hv
, 
CTX_224
(
x
), 
SHA224_DIGEST_SIZE
); ;

683 #i
defed
(
SHA_256
)

684 32: 
sha_d1
(
hv
, 
CTX_256
(
x
), 
SHA256_DIGEST_SIZE
); ;

686 #i
defed
(
SHA_384
)

687 48: 
sha_d2
(
hv
, 
CTX_384
(
x
), 
SHA384_DIGEST_SIZE
); ;

689 #i
defed
(
SHA_512
)

690 64: 
sha_d2
(
hv
, 
CTX_512
(
x
), 
SHA512_DIGEST_SIZE
); ;

695 
t_t
 
sha2
(
hv
[], 
size
,

696 cڡ 
da
[], 
n
)

697 { 
sha2_x
 
cx
[1];

699 if(
sha2_beg
(
size
, 
cx
=
EXIT_SUCCESS
)

701 
sha2_hash
(
da
, 
n
, 
cx
); 
sha2_d
(
hv
, cx);  
EXIT_SUCCESS
;

704  
EXIT_FAILURE
;

709 #i
defed
(
__lulus
)

	@common/dfs.c

38 
	~"_cfig.h
"

40 
	s_RADAR_DURATION_TABLE


42 
ULONG
 
	mRDDurRegi
;

43 
ULONG
 
	mRadSiglDuti
;

44 
ULONG
 
	mTޔ
;

45 } 
	tRADAR_DURATION_TABLE
, *
	tPRADAR_DURATION_TABLE
;

49 
UCHAR
 
	gRdIdTimeTab
[
MAX_RD_REGION
][4] =

58 #ifde
TONE_RADAR_DETECT_SUPPORT


59 
TeRadProgm
(
PRTMP_ADAPTER
 
pAd
);

60 
TeRadEb
(
PRTMP_ADAPTER
 
pAd
);

63 #ifde
DFS_SUPPORT


64 #ifde
DFS_SOFTWARE_SUPPORT


78 
VOID
 
	$BbpRadDeiS
(

79 
IN
 
PRTMP_ADAPTER
 
pAd
)

81 
UINT8
 
RadPiod
;

83 i(
pAd
->
CommCfg
.
dfs_func
 >
HARDWARE_DFS_V1
)

88 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 114, 0x02);

89 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 121, 0x20);

90 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 122, 0x00);

91 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 123, 0x08 );

92 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 124, 0x28);

93 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 125, 0xff);

96 
RadPiod
 = ((
UINT
)
RdIdTimeTab
[
pAd
->
CommCfg
.
RadDe
.
RDDurRegi
][0] + (UINTAd->CommCfg.RadDe.
DfsSessiTime
) < 250 ?

97 (
RdIdTimeTab
[
pAd
->
CommCfg
.
RadDe
.
RDDurRegi
][0] +Ad->CommCfg.RadDe.
DfsSessiTime
) : 250;

99 
	`RTMP_IO_WRITE8
(
pAd
, 0x7020, 0x1d);

100 
	`RTMP_IO_WRITE8
(
pAd
, 0x7021, 0x40);

102 
	`RadDeiS
(
pAd
, 0, 
RadPiod
);

105 
	}
}

120 #ifde
DFS_SOFTWARE_SUPPORT


121 
VOID
 
	$BbpRadDeiSt
(

122 
IN
 
PRTMP_ADAPTER
 
pAd
)

124 i(
pAd
->
CommCfg
.
dfs_func
 >
HARDWARE_DFS_V1
)

129 
	`RTMP_IO_WRITE8
(
pAd
, 0x7020, 0x1d);

130 
	`RTMP_IO_WRITE8
(
pAd
, 0x7021, 0x60);

132 
	`RadDeiSt
(
pAd
);

134 
	}
}

149 
VOID
 
	$RadDeiS
(

150 
IN
 
PRTMP_ADAPTER
 
pAd
,

151 
IN
 
BOOLEAN
 
CTSPre
,

152 
IN
 
UINT8
 
CTSPiod
)

154 
UINT8
 
DfsAiveTime
 = (
pAd
->
CommCfg
.
RadDe
.
DfsSessiTime
 & 0x1f);

155 
UINT8
 
CtsPre
 = (
CTSPre
 == 1) ? 0x02 : 0x01;

157 i(
CTSPre
 != 0)

159 
pAd
->
CommCfg
.
RadDe
.
RDDurRegi
)

161 
FCC
:

162 
JAP_W56
:

163 
CtsPre
 = 0x03;

166 
JAP
:

168 
UCHAR
 
RDDurRegi
;

169 
RDDurRegi
 = 
	`JRadTy
(
pAd
);

170 i(
RDDurRegi
 =
JAP_W56
)

171 
CtsPre
 = 0x03;

173 
CtsPre
 = 0x02;

177 
CE
:

178 
JAP_W53
:

180 
CtsPre
 = 0x02;

185 
CtsPre
 = 0x01;

195 
	`AsicSdCommdToMcu
(
pAd
, 0x60, 0xff, 
CTSPiod
, 
DfsAiveTime
 | (
CtsPre
 << 5));

199 
	}
}

216 
VOID
 
	$RadDeiSt
(

217 
IN
 
PRTMP_ADAPTER
 
pAd
)

219 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RadarDetectionStop.\n"));

220 
	`AsicSdCommdToMcu
(
pAd
, 0x60, 0xff, 0x00, 0x00);

223 
	}
}

243 
BOOLEAN
 
	$RadChlCheck
(

244 
IN
 
PRTMP_ADAPTER
 
pAd
,

245 
IN
 
UCHAR
 
Ch
)

247 
INT
 
i
;

248 
BOOLEAN
 
su
 = 
FALSE
;

250 
i
=0; i<
pAd
->
ChlLiNum
; i++)

252 i(
Ch
 =
pAd
->
ChlLi
[
i
].
Chl
)

254 
su
 = 
pAd
->
ChlLi
[
i
].
DfsReq
;

259  
su
;

260 
	}
}

263 #ifde
DFS_SUPPORT


265 
ULONG
 
	$JRadTy
(

266 
IN
 
PRTMP_ADAPTER
 
pAd
)

268 
ULONG
 
i
;

269 cڡ 
UCHAR
 
Chl
[15]={52, 56, 60, 64, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140};

271 i(
pAd
->
CommCfg
.
RadDe
.
RDDurRegi
 !
JAP
)

273  
pAd
->
CommCfg
.
RadDe
.
RDDurRegi
;

276 
i
=0; i<15; i++)

278 i(
pAd
->
CommCfg
.
Chl
 =Chl[
i
])

284 i(
i
 < 4)

285  
JAP_W53
;

286 i(
i
 < 15)

287  
JAP_W56
;

289  
JAP
;

291 
	}
}

294 
ULONG
 
	$RTMPRdRadDuti
(

295 
IN
 
PRTMP_ADAPTER
 
pAd
)

297 
ULONG
 
su
 = 0;

299 #ifde
DFS_SUPPORT


300 
UINT8
 
duti1
 = 0, 
duti2
 = 0, 
duti3
 = 0;

303 
	`BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R116
, &
duti1
);

304 
	`BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R117
, &
duti2
);

305 
	`BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R118
, &
duti3
);

306 
su
 = (
duti1
 << 16+ (
duti2
 << 8+ 
duti3
;

309  
su
;

311 
	}
}

313 
VOID
 
	$RTMPC˪RadDuti
(

314 
IN
 
PRTMP_ADAPTER
 
pAd
)

317 
	}
}

332 
VOID
 
	$ApRadDePiodic
(

333 
IN
 
PRTMP_ADAPTER
 
pAd
)

335 
INT
 
i
;

337 
pAd
->
CommCfg
.
RadDe
.
InSviMڙCou
++;

339 
i
=0; i<
pAd
->
ChlLiNum
; i++)

341 i(
pAd
->
ChlLi
[
i
].
RemagTimeFU
 > 0)

343 
pAd
->
ChlLi
[
i
].
RemagTimeFU
 --;

344 i((
pAd
->
Mlme
.
PiodicRound
%5) == 0)

346 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RadDePiodi- ch=%d, RemagTimeFU=%d\n", 
pAd
->
ChlLi
[
i
].
Chl
,Ad->ChlLi[i].
RemagTimeFU
));

351 i((
pAd
->
CommCfg
.
Chl
 > 14)

352 && (
pAd
->
CommCfg
.
bIEEE80211H
 == 1)

353 && 
	`RadChlCheck
(
pAd
,Ad->
CommCfg
.
Chl
))

355 
	`RadDePiodic
(
pAd
);

358 
	}
}

362 
VOID
 
	$RadDePiodic
(

363 
IN
 
PRTMP_ADAPTER
 
pAd
)

367 i(
pAd
->
CommCfg
.
RadDe
.
RDMode
 !
RD_SILENCE_MODE
)

373 i(
pAd
->
CommCfg
.
RadDe
.
RDCou
++ >Ad->CommCfg.RadDe.
ChMovgTime
)

375 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Not foundadar signal, start send beaconndadar detection in service monitor\n\n"));

376 #ifde
DFS_SOFTWARE_SUPPORT


377 i(
pAd
->
CommCfg
.
dfs_func
 < 
HARDWARE_DFS_V1
)

378 
	`BbpRadDeiSt
(
pAd
);

382 
	`AsicEbBssSync
(
pAd
);

383 
pAd
->
CommCfg
.
RadDe
.
RDMode
 = 
RD_NORMAL_MODE
;

391 
	}
}

	@common/ee_prom.c

39 
	~"_cfig.h
"

44 
le
 
VOID
 
	$RaiClock
(

45 
IN
 
PRTMP_ADAPTER
 
pAd
,

46 
IN
 
UINT32
 *
x
)

48 *
x
 = *x | 
EESK
;

49 
	`RTMP_IO_WRITE32
(
pAd
, 
E2PROM_CSR
, *
x
);

50 
	`RTMPucDay
(1);

51 
	}
}

54 
le
 
VOID
 
	$LowClock
(

55 
IN
 
PRTMP_ADAPTER
 
pAd
,

56 
IN
 
UINT32
 *
x
)

58 *
x
 = *x & ~
EESK
;

59 
	`RTMP_IO_WRITE32
(
pAd
, 
E2PROM_CSR
, *
x
);

60 
	`RTMPucDay
(1);

61 
	}
}

64 
le
 
USHORT
 
	$ShiInBs
(

65 
IN
 
PRTMP_ADAPTER
 
pAd
)

67 
UINT32
 
x
,
i
;

68 
USHORT
 
da
=0;

70 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
x
);

72 
x
 &~
EEDO
 | 
EEDI
);

74 
i
=0; i<16; i++)

76 
da
 = data << 1;

77 
	`RaiClock
(
pAd
, &
x
);

79 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
x
);

80 
	`LowClock
(
pAd
, &
x
);

82 
x
 &~(
EEDI
);

83 if(
x
 & 
EEDO
)

84 
da
 |= 1;

87  
da
;

88 
	}
}

92 
le
 
VOID
 
	$ShiOutBs
(

93 
IN
 
PRTMP_ADAPTER
 
pAd
,

94 
IN
 
USHORT
 
da
,

95 
IN
 
USHORT
 
cou
)

97 
UINT32
 
x
,
mask
;

99 
mask
 = 0x01 << (
cou
 - 1);

100 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
x
);

102 
x
 &~(
EEDO
 | 
EEDI
);

106 
x
 &~
EEDI
;

107 if(
da
 & 
mask

x
 |
EEDI
;

109 
	`RTMP_IO_WRITE32
(
pAd
, 
E2PROM_CSR
, 
x
);

111 
	`RaiClock
(
pAd
, &
x
);

112 
	`LowClock
(
pAd
, &
x
);

114 
mask
 = mask >> 1;

115 } 
mask
);

117 
x
 &~
EEDI
;

118 
	`RTMP_IO_WRITE32
(
pAd
, 
E2PROM_CSR
, 
x
);

119 
	}
}

123 
le
 
VOID
 
	$EEomC˪up
(

124 
IN
 
PRTMP_ADAPTER
 
pAd
)

126 
UINT32
 
x
;

128 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
x
);

130 
x
 &~(
EECS
 | 
EEDI
);

131 
	`RTMP_IO_WRITE32
(
pAd
, 
E2PROM_CSR
, 
x
);

133 
	`RaiClock
(
pAd
, &
x
);

134 
	`LowClock
(
pAd
, &
x
);

135 
	}
}

138 
le
 
VOID
 
	$EWEN
(

139 
IN
 
PRTMP_ADAPTER
 
pAd
)

141 
UINT32
 
x
;

144 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
x
);

145 
x
 &~(
EEDI
 | 
EEDO
 | 
EESK
);

146 
x
 |
EECS
;

147 
	`RTMP_IO_WRITE32
(
pAd
, 
E2PROM_CSR
, 
x
);

150 
	`RaiClock
(
pAd
, &
x
);

151 
	`LowClock
(
pAd
, &
x
);

154 
	`ShiOutBs
(
pAd
, 
EEPROM_EWEN_OPCODE
, 5);

155 
	`ShiOutBs
(
pAd
, 0, 6);

157 
	`EEomC˪up
(
pAd
);

158 
	}
}

161 
le
 
VOID
 
	$EWDS
(

162 
IN
 
PRTMP_ADAPTER
 
pAd
)

164 
UINT32
 
x
;

167 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
x
);

168 
x
 &~(
EEDI
 | 
EEDO
 | 
EESK
);

169 
x
 |
EECS
;

170 
	`RTMP_IO_WRITE32
(
pAd
, 
E2PROM_CSR
, 
x
);

173 
	`RaiClock
(
pAd
, &
x
);

174 
	`LowClock
(
pAd
, &
x
);

177 
	`ShiOutBs
(
pAd
, 
EEPROM_EWDS_OPCODE
, 5);

178 
	`ShiOutBs
(
pAd
, 0, 6);

180 
	`EEomC˪up
(
pAd
);

181 
	}
}

185 
	$mp__om_ad16
(

186 
IN
 
PRTMP_ADAPTER
 
pAd
,

187 
IN
 
USHORT
 
Offt
,

188 
OUT
 
USHORT
 *
pVue
)

190 
UINT32
 
x
;

191 
USHORT
 
da
;

194 
Offt
 /= 2;

196 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
x
);

197 
x
 &~(
EEDI
 | 
EEDO
 | 
EESK
);

198 
x
 |
EECS
;

199 
	`RTMP_IO_WRITE32
(
pAd
, 
E2PROM_CSR
, 
x
);

202 i(!(
	`IS_RT3090
(
pAd
|| 
	`IS_RT3572
Ad|| 
	`IS_RT3390
Ad|| 
	`IS_RT3593
(pAd)))

205 
	`RaiClock
(
pAd
, &
x
);

206 
	`LowClock
(
pAd
, &
x
);

210 
	`ShiOutBs
(
pAd
, 
EEPROM_READ_OPCODE
, 3);

211 
	`ShiOutBs
(
pAd
, 
Offt
,Ad->
EEPROMAddssNum
);

214 
da
 = 
	`ShiInBs
(
pAd
);

216 
	`EEomC˪up
(
pAd
);

219 *
pVue
 = 
da
;

221  
NDIS_STATUS_SUCCESS
;

222 
	}
}

225 
	$mp__om_wre16
(

226 
IN
 
PRTMP_ADAPTER
 
pAd
,

227 
IN
 
USHORT
 
Offt
,

228 
IN
 
USHORT
 
Da
)

230 
UINT32
 
x
;

233 
Offt
 /= 2;

235 
	`EWEN
(
pAd
);

238 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
x
);

239 
x
 &~(
EEDI
 | 
EEDO
 | 
EESK
);

240 
x
 |
EECS
;

241 
	`RTMP_IO_WRITE32
(
pAd
, 
E2PROM_CSR
, 
x
);

244 i(!(
	`IS_RT3090
(
pAd
|| 
	`IS_RT3572
Ad|| 
	`IS_RT3390
Ad|| 
	`IS_RT3593
(pAd)))

247 
	`RaiClock
(
pAd
, &
x
);

248 
	`LowClock
(
pAd
, &
x
);

252 
	`ShiOutBs
(
pAd
, 
EEPROM_WRITE_OPCODE
, 3);

253 
	`ShiOutBs
(
pAd
, 
Offt
,Ad->
EEPROMAddssNum
);

254 
	`ShiOutBs
(
pAd
, 
Da
, 16);

257 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
x
);

259 
	`EEomC˪up
(
pAd
);

261 
	`RTMPucDay
(10000);

263 
	`EWDS
(
pAd
);

265 
	`EEomC˪up
(
pAd
);

268  
NDIS_STATUS_SUCCESS
;

270 
	}
}

	@common/eeprom.c

37 
	~"_cfig.h
"

40 
INT
 
	$RtmpChOpsEromHook
(

41 
IN
 
RTMP_ADAPTER
 *
pAd
,

42 
IN
 
INT
 
fTy
)

44 
RTMP_CHIP_OP
 *
pChOps
 = &
pAd
->
chOps
;

46 #ifde
RTMP_FLASH_SUPPORT


47 
pChOps
->

 = 
mp_nv_
;

48 
pChOps
->
ad
 = 
mp__ash_ad
;

49 
pChOps
->
wre
 = 
mp__ash_wre
;

54 
fTy
)

56 #ifde
RTMP_PCI_SUPPORT


57 
RTMP_DEV_INF_PCI
:

58 
RTMP_DEV_INF_PCIE
:

60 
pChOps
->

 = 
NULL
;

61 
pChOps
->
ad
 = 
mp__om_ad16
;

62 
pChOps
->
wre
 = 
mp__om_wre16
;

68 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("RtmpChipOpsEepromHook() failed!\n"));

73 
	}
}

	@common/mlme.c

39 
	~"_cfig.h
"

40 
	~<dg.h
>

43 
UCHAR
 
	gCISCO_OUI
[] = {0x00, 0x40, 0x96};

45 
UCHAR
 
	gRALINK_OUI
[] = {0x00, 0x0c, 0x43};

46 
UCHAR
 
	gWPA_OUI
[] = {0x00, 0x50, 0xf2, 0x01};

47 
UCHAR
 
	gRSN_OUI
[] = {0x00, 0x0f, 0xac};

48 
UCHAR
 
	gWAPI_OUI
[] = {0x00, 0x14, 0x72};

49 
UCHAR
 
	gWME_INFO_ELEM
[] = {0x00, 0x50, 0xf2, 0x02, 0x00, 0x01};

50 
UCHAR
 
	gWME_PARM_ELEM
[] = {0x00, 0x50, 0xf2, 0x02, 0x01, 0x01};

51 
UCHAR
 
	gBROADCOM_OUI
[] = {0x00, 0x90, 0x4c};

52 
UCHAR
 
	gWPS_OUI
[] = {0x00, 0x50, 0xf2, 0x04};

53 #ifde
CONFIG_STA_SUPPORT


54 #ifde
DOT11_N_SUPPORT


55 
UCHAR
 
	gPRE_N_HT_OUI
[] = {0x00, 0x90, 0x4c};

59 
UCHAR
 
	gReSwchTab
[] = {

96 
UCHAR
 
	gReSwchTab11B
[] = {

105 
UCHAR
 
	gReSwchTab11BG
[] = {

120 
UCHAR
 
	gReSwchTab11G
[] = {

133 #ifde
DOT11_N_SUPPORT


134 
UCHAR
 
	gReSwchTab11N1S
[] = {

152 
UCHAR
 
	gReSwchTab11N2S
[] = {

172 #ifde
NEW_RATE_ADAPT_SUPPORT


176 
UCHAR
 
	gReSwchTab11N3S
[] = {

207 
UCHAR
 
	gReSwchTab11N3S
[] = {

234 
UCHAR
 
	gReSwchTab11N3SRmt
[] = {

265 
UCHAR
 
	gReSwchTab11N2SFABd
[] = {

281 
UCHAR
 
	gReSwchTab11N3SFABd
[] = {

302 
UCHAR
 
	gReSwchTab11BGN1S
[] = {

320 
UCHAR
 
	gReSwchTab11BGN2S
[] = {

340 
UCHAR
 
	gReSwchTab11BGN3S
[] = {

361 
UCHAR
 
	gReSwchTab11BGN2SFABd
[] = {

378 
UCHAR
 
	gReSwchTab11BGN3SFABd
[] = {

403 
UCHAR
 
OfdmReToRxwiMCS
[];

406 
ULONG
 
	gBasicReMask
[12] = {0xfffff001 , 0xfffff003 , 0xfffff007 , 0xfffff00f ,

410 
UCHAR
 
	gBROADCAST_ADDR
[
MAC_ADDR_LEN
] = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff};

411 
UCHAR
 
	gZERO_MAC_ADDR
[
MAC_ADDR_LEN
] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

417 
CHAR
 
	gRssiSaLevFTxRe
[] ={ -92, -91, -90, -87, -88, -86, -85, -83, -81, -78, -72, -71, -40, -40 };

419 
UCHAR
 
	gReIdToMbps
[] = { 1, 2, 5, 11, 6, 9, 12, 18, 24, 36, 48, 54, 72, 100};

420 
USHORT
 
	gReIdTo500Kbps
[] = { 2, 4, 11, 22, 12, 18, 24, 36, 48, 72, 96, 108, 144, 200};

422 
UCHAR
 
	gSsidIe
 = 
IE_SSID
;

423 
UCHAR
 
	gSupReIe
 = 
IE_SUPP_RATES
;

424 
UCHAR
 
	gExtReIe
 = 
IE_EXT_SUPP_RATES
;

425 #ifde
DOT11_N_SUPPORT


426 
UCHAR
 
	gHtCIe
 = 
IE_HT_CAP
;

427 
UCHAR
 
	gAddHtInfoIe
 = 
IE_ADD_HT
;

428 
UCHAR
 
	gNewExtChIe
 = 
IE_SECONDARY_CH_OFFSET
;

429 
UCHAR
 
	gBssCxiIe
 = 
IE_2040_BSS_COEXIST
;

430 
UCHAR
 
	gExtHtCIe
 = 
IE_EXT_CAPABILITY
;

432 
UCHAR
 
	gExtCIe
 = 
IE_EXT_CAPABILITY
;

433 
UCHAR
 
	gEIe
 = 
IE_ERP
;

434 
UCHAR
 
	gDsIe
 = 
IE_DS_PARM
;

435 
UCHAR
 
	gTimIe
 = 
IE_TIM
;

436 
UCHAR
 
	gWIe
 = 
IE_WPA
;

437 
UCHAR
 
	gW2Ie
 = 
IE_WPA2
;

438 
UCHAR
 
	gIbssIe
 = 
IE_IBSS_PARM
;

439 
UCHAR
 
	gWiIe
 = 
IE_WAPI
;

441 
UCHAR
 
WPA_OUI
[];

443 
UCHAR
 
	gSES_OUI
[] = {0x00, 0x90, 0x4c};

445 
UCHAR
 
	gZoSsid
[32] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

449 #ifde
INF_AMAZON_SE


450 
UINT16
 
	gMaxBulkOutsSizeLim
[5][4] =

460 
VOID
 
	$SoweFlowCڌ
(

461 
IN
 
PRTMP_ADAPTER
 
pAd
)

464 
BOOLEAN
 
RetBulkOutSize
=
FALSE
;

465 
UCHAR
 
i
=0,
RugQueueNo
=0,
QueIdx
=0,
HighWkgAcCou
=0;

466 
UINT
 
PacksInQueueSize
=0;

467 
UCHAR
 
Priܙy
[]={1,0,2,3};

469 
i
=0;i<
NUM_OF_TX_RING
;i++)

472 i(
pAd
->
TxCڋxt
[
i
].
CurWrePosi
>Ad->TxCڋxt[i].
NextBulkOutPosi
)

474 
PacksInQueueSize
=
pAd
->
TxCڋxt
[
i
].
CurWrePosi
-pAd->TxCڋxt[i].
NextBulkOutPosi
;

478 
PacksInQueueSize
=
MAX_TXBULK_SIZE
-
pAd
->
TxCڋxt
[
i
].
NextBulkOutPosi
+pAd->TxCڋxt[i].
CurWrePosi
;

481 i(
pAd
->
BulkOutDaSizeCou
[
i
]>20480 || 
PacksInQueueSize
>6144)

483 
RugQueueNo
++;

484 
pAd
->
BulkOutDaFg
[
i
]=
TRUE
;

487 
pAd
->
BulkOutDaFg
[
i
]=
FALSE
;

489 
pAd
->
BulkOutDaSizeCou
[
i
]=0;

492 i(
RugQueueNo
>
pAd
->
LaRugQueueNo
)

494 
	`DBGPRINT
(
RT_DEBUG_INFO
,("SoweFlowCڌބe%d > %d \n",
RugQueueNo
,
pAd
->
LaRugQueueNo
));

496 
RetBulkOutSize
=
TRUE
;

497 
pAd
->
RugQueueNoCou
=0;

498 
pAd
->
LaRugQueueNo
=
RugQueueNo
;

500 i(
RugQueueNo
==
pAd
->
LaRugQueueNo
)

502 
pAd
->
RugQueueNoCou
=0;

504 i(
RugQueueNo
<
pAd
->
LaRugQueueNo
)

506 
	`DBGPRINT
(
RT_DEBUG_INFO
,("SoweFlowCڌބe%d < %d \n",
RugQueueNo
,
pAd
->
LaRugQueueNo
));

507 
pAd
->
RugQueueNoCou
++;

508 i(
pAd
->
RugQueueNoCou
>=6)

510 
RetBulkOutSize
=
TRUE
;

511 
pAd
->
RugQueueNoCou
=0;

512 
pAd
->
LaRugQueueNo
=
RugQueueNo
;

516 i(
RetBulkOutSize
==
TRUE
)

518 
QueIdx
=0;QueIdx<
NUM_OF_TX_RING
;QueIdx++)

520 
HighWkgAcCou
=0;

521 
i
=0;i<
NUM_OF_TX_RING
;i++)

523 i(
QueIdx
==
i
)

526 i(
pAd
->
BulkOutDaFg
[
i
]==
TRUE
 && 
Priܙy
[i]>Priܙy[
QueIdx
])

527 
HighWkgAcCou
++;

530 
pAd
->
BulkOutDaSizeLim
[
QueIdx
]=
MaxBulkOutsSizeLim
[
RugQueueNo
][
HighWkgAcCou
];

533 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RebulkousizAC0(BE):%7d AC1(BK):%7d AC2(VI):%7d AC3(VO):%7d %d\n",
pAd
->
BulkOutDaSizeLim
[0]

534 ,
pAd
->
BulkOutDaSizeLim
[1]

535 ,
pAd
->
BulkOutDaSizeLim
[2]

536 ,
pAd
->
BulkOutDaSizeLim
[3]

537 ,
RugQueueNo
));

540 
	}
}

556 
NDIS_STATUS
 
	$MlmeIn
(

557 
IN
 
PRTMP_ADAPTER
 
pAd
)

559 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

561 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> MLME Initialize\n"));

565 
Stus
 = 
	`MlmeQueueIn
(&
pAd
->
Mlme
.
Queue
);

566 if(
Stus
 !
NDIS_STATUS_SUCCESS
)

569 
pAd
->
Mlme
.
bRug
 = 
FALSE
;

570 
	`NdisAoSpLock
(&
pAd
->
Mlme
.
TaskLock
);

572 #ifde
CONFIG_STA_SUPPORT


573 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

575 
	`BssTabIn
(&
pAd
->
SnTab
);

578 
	`AssocSMacheIn
(
pAd
, &pAd->
Mlme
.
AssocMache
,Ad->Mlme.
AssocFunc
);

579 
	`AuthSMacheIn
(
pAd
, &pAd->
Mlme
.
AuthMache
,Ad->Mlme.
AuthFunc
);

580 
	`AuthRSMacheIn
(
pAd
, &pAd->
Mlme
.
AuthRMache
,Ad->Mlme.
AuthRFunc
);

581 
	`SyncSMacheIn
(
pAd
, &pAd->
Mlme
.
SyncMache
,Ad->Mlme.
SyncFunc
);

583 #ifde
QOS_DLS_SUPPORT


584 
	`DlsSMacheIn
(
pAd
, &pAd->
Mlme
.
DlsMache
,Ad->Mlme.
DlsFunc
);

593 
	`MlmeClIn
(
pAd
, &pAd->
Mlme
.
ClMache
, 
NULL
);

595 #ifde
PCIE_PS_SUPPORT


596 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

599 
	`RTMPInTim
(
pAd
, &pAd->
Mlme
.
PsPlTim
, 
	`GET_TIMER_FUNCTION
(
PsPlWakeExec
),Ad, 
FALSE
);

600 
	`RTMPInTim
(
pAd
, &pAd->
Mlme
.
RadioOnOffTim
, 
	`GET_TIMER_FUNCTION
(
RadioOnExec
),Ad, 
FALSE
);

604 
	`RTMPInTim
(
pAd
, &pAd->
Mlme
.
LkDownTim
, 
	`GET_TIMER_FUNCTION
(
LkDownExec
),Ad, 
FALSE
);

605 
	`RTMPInTim
(
pAd
, &pAd->
SCfg
.
SQuickReeFReUpTim
, 
	`GET_TIMER_FUNCTION
(
SQuickReeFReUpExec
),Ad, 
FALSE
);

606 
pAd
->
SCfg
.
SQuickReeFReUpTimRug
 = 
FALSE
;

607 
	`RTMPInTim
(
pAd
, &pAd->
SCfg
.
WDissocAndBlockAssocTim
, 
	`GET_TIMER_FUNCTION
(
WDissocApAndBlockAssoc
),Ad, 
FALSE
);

615 
	`WSMacheIn
(
pAd
, &pAd->
Mlme
.
WMache
,Ad->Mlme.
WFunc
);

618 
	`AiSMacheIn
(
pAd
, &pAd->
Mlme
.
AMache
,Ad->Mlme.
AFunc
);

621 
	`RTMPInTim
(
pAd
, &pAd->
Mlme
.
PiodicTim
, 
	`GET_TIMER_FUNCTION
(
MlmePiodicExec
),Ad, 
TRUE
);

624 
	`RTMPSTim
(&
pAd
->
Mlme
.
PiodicTim
, 
MLME_TASK_EXEC_INTV
);

627 
	`RTMPInTim
(
pAd
, &pAd->
Mlme
.
RxAEvTim
, 
	`GET_TIMER_FUNCTION
(
AsicRxAEvTimeout
),Ad, 
FALSE
);

629 } 
FALSE
);

631 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- MLME Initialize\n"));

633  
Stus
;

634 
	}
}

650 
VOID
 
	$MlmeHdr
(

651 
IN
 
PRTMP_ADAPTER
 
pAd
)

653 
MLME_QUEUE_ELEM
 *
Em
 = 
NULL
;

658 
	`NdisAcqueSpLock
(&
pAd
->
Mlme
.
TaskLock
);

659 if(
pAd
->
Mlme
.
bRug
)

661 
	`NdisRSpLock
(&
pAd
->
Mlme
.
TaskLock
);

666 
pAd
->
Mlme
.
bRug
 = 
TRUE
;

668 
	`NdisRSpLock
(&
pAd
->
Mlme
.
TaskLock
);

670 !
	`MlmeQueueEmy
(&
pAd
->
Mlme
.
Queue
))

672 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_MLME_RESET_IN_PROGRESS
) ||

673 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
) ||

674 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

676 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Devi Hd oRemoved oMlmeRe,x MlmeHdr! (queunum = %ld)\n", 
pAd
->
Mlme
.
Queue
.
Num
));

680 #ifde
RALINK_ATE


681 if(
	`ATE_ON
(
pAd
))

683 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("The driver is in ATE modeow in MlmeHandler\n"));

689 i(
	`MlmeDequeue
(&
pAd
->
Mlme
.
Queue
, &
Em
))

693 
Em
->
Mache
)

696 #ifde
CONFIG_STA_SUPPORT


697 
ASSOC_STATE_MACHINE
:

698 
	`SMachePfmAi
(
pAd
, &pAd->
Mlme
.
AssocMache
,

699 
Em
, 
pAd
->
Mlme
.
AssocMache
.
CuS
);

702 
AUTH_STATE_MACHINE
:

703 
	`SMachePfmAi
(
pAd
, &pAd->
Mlme
.
AuthMache
,

704 
Em
, 
pAd
->
Mlme
.
AuthMache
.
CuS
);

707 
AUTH_RSP_STATE_MACHINE
:

708 
	`SMachePfmAi
(
pAd
, &pAd->
Mlme
.
AuthRMache
,

709 
Em
, 
pAd
->
Mlme
.
AuthRMache
.
CuS
);

712 
SYNC_STATE_MACHINE
:

713 
	`SMachePfmAi
(
pAd
, &pAd->
Mlme
.
SyncMache
,

714 
Em
, 
pAd
->
Mlme
.
SyncMache
.
CuS
);

717 
MLME_CNTL_STATE_MACHINE
:

718 
	`MlmeClMachePfmAi
(
pAd
, &pAd->
Mlme
.
ClMache
, 
Em
);

721 
WPA_PSK_STATE_MACHINE
:

722 
	`SMachePfmAi
(
pAd
, &pAd->
Mlme
.
WPskMache
,

723 
Em
, 
pAd
->
Mlme
.
WPskMache
.
CuS
);

726 #ifde
QOS_DLS_SUPPORT


727 
DLS_STATE_MACHINE
:

728 
	`SMachePfmAi
(
pAd
, &pAd->
Mlme
.
DlsMache
,

729 
Em
, 
pAd
->
Mlme
.
DlsMache
.
CuS
);

738 
ACTION_STATE_MACHINE
:

739 
	`SMachePfmAi
(
pAd
, &pAd->
Mlme
.
AMache
,

740 
Em
, 
pAd
->
Mlme
.
AMache
.
CuS
);

743 
WPA_STATE_MACHINE
:

744 
	`SMachePfmAi
(
pAd
, &pAd->
Mlme
.
WMache
, 
Em
,Ad->Mlme.WMache.
CuS
);

749 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ERROR: Ieg mach%ld iMlmeHdr()\n", 
Em
->
Mache
));

754 
Em
->
Occupd
 = 
FALSE
;

755 
Em
->
MsgL
 = 0;

759 
	`DBGPRINT_ERR
(("MlmeHandler: MlmeQueuempty\n"));

763 
	`NdisAcqueSpLock
(&
pAd
->
Mlme
.
TaskLock
);

764 
pAd
->
Mlme
.
bRug
 = 
FALSE
;

765 
	`NdisRSpLock
(&
pAd
->
Mlme
.
TaskLock
);

766 
	}
}

781 
VOID
 
	$MlmeHt
(

782 
IN
 
PRTMP_ADAPTER
 
pAd
)

784 
BOOLEAN
 
Ced
;

786 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==> MlmeHalt\n"));

788 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

791 
	`AsicDibSync
(
pAd
);

794 
	`RTMPClTim
(&
pAd
->
Mlme
.
PiodicTim
, &
Ced
);

796 #ifde
CONFIG_STA_SUPPORT


797 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

799 #ifde
QOS_DLS_SUPPORT


800 
UCHAR
 
i
;

803 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
AssocTim
, &
Ced
);

804 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
RssocTim
, &
Ced
);

805 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
DissocTim
, &
Ced
);

806 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
AuthTim
, &
Ced
);

807 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
BcTim
, &
Ced
);

808 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
SnTim
, &
Ced
);

811 #ifde
PCIE_PS_SUPPORT


812 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)

813 &&(
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
))

815 
	`RTMPClTim
(&
pAd
->
Mlme
.
PsPlTim
, &
Ced
);

816 
	`RTMPClTim
(&
pAd
->
Mlme
.
RadioOnOffTim
, &
Ced
);

820 #ifde
QOS_DLS_SUPPORT


821 
i
=0; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

823 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
Ced
);

826 
	`RTMPClTim
(&
pAd
->
Mlme
.
LkDownTim
, &
Ced
);

831 i(
pAd
->
SCfg
.
SQuickReeFReUpTimRug
)

833 
	`RTMPClTim
(&
pAd
->
SCfg
.
SQuickReeFReUpTim
, &
Ced
);

834 
pAd
->
SCfg
.
SQuickReeFReUpTimRug
 = 
FALSE
;

836 
	`RTMPClTim
(&
pAd
->
SCfg
.
WDissocAndBlockAssocTim
, &
Ced
);

840 
	`RTMPClTim
(&
pAd
->
Mlme
.
RxAEvTim
, &
Ced
);

845 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

847 
RTMP_CHIP_OP
 *
pChOps
 = &
pAd
->
chOps
;

849 #ifde
LED_CONTROL_SUPPORT


851 
	`RTMPSLED
(
pAd
, 
LED_HALT
);

852 
	`RTMPSSiglLED
(
pAd
, -100);

855 i(
pChOps
->
AsicHtAi
)

856 
pChOps
->
	`AsicHtAi
(
pAd
);

859 
	`RTMPucDay
(5000);

861 
	`MlmeQueueDeroy
(&
pAd
->
Mlme
.
Queue
);

862 
	`NdisFeSpLock
(&
pAd
->
Mlme
.
TaskLock
);

864 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<== MlmeHalt\n"));

865 
	}
}

867 
VOID
 
	$MlmeRetRkCous
(

868 
IN
 
PRTMP_ADAPTER
 
pAd
)

870 
pAd
->
RkCous
.
LaOSecRxOkDaC
 =Ad->RkCous.
OSecRxOkDaC
;

874 
	`NdisZoMemy
(&
pAd
->
RkCous
,

875 (
UINT32
)&
pAd
->
RkCous
.
OSecEnd
 -

876 (
UINT32
)&
pAd
->
RkCous
.
OSecS
);

879 
	}
}

898 
	#ADHOC_BEACON_LOST_TIME
 (8*
OS_HZ
)

899 
VOID
 
	`MlmePiodicExec
(

	)

900 
IN
 
PVOID
 
	gSyemScific1
,

901 
IN
 
PVOID
 
	gFuniCڋxt
,

902 
IN
 
PVOID
 
	gSyemScific2
,

903 
IN
 
PVOID
 
	gSyemScific3
)

905 
ULONG
 
	gTxTٮC
;

906 
PRTMP_ADAPTER
 
	gpAd
 = (
RTMP_ADAPTER
 *)
FuniCڋxt
;

908 #ifde
RTMP_MAC_PCI


909 #ifde
CONFIG_STA_SUPPORT


913 #ifde
INF_AMAZON_SE


914 
SoweFlowCڌ
(
pAd
);

917 #ifde
CONFIG_STA_SUPPORT


918 #ifde
RTMP_MAC_PCI


919 
IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

923 i((
	gpAd
->
	gMlme
.
	gPiodicRound
 % (
	gMLME_TASK_EXEC_MULTIPLE
 * 2) == 0) &&

925 ((
IDLE_ON
(
pAd
)|| (pAd->
SCfg
.
Psm
 =
PWR_ACTIVE
)) &&

926 (!
RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
)) &&

927 (!
RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
)) &&

928 ((
	gpAd
->
	gSCfg
.
	gbHdweRadio
 =
TRUE
))

932 
UINT32
 
da
 = 0;

940 #ifde
PCIE_PS_SUPPORT


943 i((
	gpAd
->
	gOpMode
 =
OPMODE_STA
&& (
IDLE_ON
(
pAd
))

944 && (
RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
))

945 && (
	gpAd
->
	gSCfg
.
	gPSCڌ
.
	gfld
.
	gEbPSId
 =
TRUE
))

948 
RTMPPCIeLkClVueRee
(
pAd
, 0);

949 
RTMP_IO_FORCE_READ32
(
pAd
, 
GPIO_CTRL_CFG
, &
da
);

950 
RTMPPCIeLkClStg
(
pAd
, 3);

953 
RTMP_IO_FORCE_READ32
(
pAd
, 
GPIO_CTRL_CFG
, &
da
);

955 
RTMP_IO_READ32
(
pAd
, 
GPIO_CTRL_CFG
, &
da
);

960 i(
	gpAd
->
	gSCfg
.
	gbHdweRadio
 =
TRUE
)

962 i(
da
 & 0x04)

964 
pAd
->
SCfg
.
bHwRadio
 = 
TRUE
;

968 
	gpAd
->
	gSCfg
.
	gbHwRadio
 = 
FALSE
;

973 i(
	gpAd
->
	gSCfg
.
	gbHdweRadio
 =
TRUE
)

975 i(
pAd
->
SCfg
.
bRadio
 !Ad->SCfg.
bHwRadio
 &&Ad->SCfg.
bSwRadio
))

977 
pAd
->
SCfg
.
bRadio
 = (pAd->SCfg.
bHwRadio
 &&Ad->SCfg.
bSwRadio
);

978 i(
	gpAd
->
	gSCfg
.
	gbRadio
 =
TRUE
)

980 
MlmeRadioOn
(
pAd
);

982 
	gpAd
->
	gExaInfo
 = 
EXTRA_INFO_CLEAR
;

986 
MlmeRadioOff
(
pAd
);

988 
	gpAd
->
	gExaInfo
 = 
HW_RADIO_OFF
;

995 
IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

997 
RTMP_MLME_PRE_SANITY_CHECK
(
pAd
);

1003 i((
RTMP_TEST_FLAG
(
pAd
, (
fRTMP_ADAPTER_HALT_IN_PROGRESS
 |

1004 
fRTMP_ADAPTER_RADIO_OFF
 |

1005 
fRTMP_ADAPTER_RADIO_MEASUREMENT
 |

1006 
fRTMP_ADAPTER_RESET_IN_PROGRESS
 |

1007 
fRTMP_ADAPTER_NIC_NOT_EXIST
))))

1010 #ifde
RALINK_ATE


1012 i(
ATE_ON
(
pAd
))

1014 i(
	gpAd
->
	gMlme
.
	gPiodicRound
 % 
	gMLME_TASK_EXEC_MULTIPLE
 !(
MLME_TASK_EXEC_MULTIPLE
 - 1))

1016 
pAd
->
Mlme
.
PiodicRound
 ++;

1022 #ifde
CONFIG_STA_SUPPORT


1023 
IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1026 i(
MONITOR_ON
(
pAd
))

1029 i(
	gpAd
->
	gMlme
.
	gPiodicRound
 & 0x1)

1032 i(((
	gpAd
->
	gMACVsi
 & 0xffff) == 0x0101) &&

1033 (
STA_TGN_WIFI_ON
(
pAd
)) &&

1034 (
pAd
->
CommCfg
.
IOTePm
.
bTogg
 =
FALSE
))

1037 
RTMP_IO_WRITE32
(
pAd
, 
TXOP_CTRL_CFG
, 0x24Bf);

1038 
	gpAd
->
	gCommCfg
.
	gIOTePm
.
	gbTogg
 = 
TRUE
;

1040 i((
STA_TGN_WIFI_ON
(
pAd
)) &&

1041 ((
	gpAd
->
	gMACVsi
 & 0xffff) == 0x0101))

1043 
RTMP_IO_WRITE32
(
pAd
, 
TXOP_CTRL_CFG
, 0x243f);

1044 
	gpAd
->
	gCommCfg
.
	gIOTePm
.
	gbTogg
 = 
FALSE
;

1050 
	gpAd
->
	gbUpdeBCDe
 = 
FALSE
;

1053 
	gpAd
->
	gMlme
.
	gPiodicRound
 ++;

1054 
	gpAd
->
	gMlme
.
	gGPIORound
++;

1058 i((
	gpAd
->
	gMlme
.
	gPiodicRound
 % 5 =0&& 
RTMPAutoReSwchCheck
(
pAd
) )

1060 #ifde
CONFIG_STA_SUPPORT


1062 
IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1064 i((
OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
)

1066 && (!
OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
)))

1067 
MlmeDymicTxReSwchg
(
pAd
);

1073 i(
	gpAd
->
	gMlme
.
	gPiodicRound
 %
	gMLME_TASK_EXEC_MULTIPLE
 == 0)

1075 
pAd
->
Mlme
.
OSecPiodicRound
 ++;

1077 #ifde
RALINK_ATE


1078 i(
ATE_ON
(
pAd
))

1082 
NICUpdeRawCous
(
pAd
);

1083 i(
	gpAd
->
	ge
.
	gbRxFER
 == 1)

1085 
pAd
->
e
.
RxTٮC
 +pAd->e.
RxCPSec
;

1086 
e_t
(
KERN_EMERG
 "MlmePiodicExec: Rxack c = %d/%d\n", 
pAd
->
e
.
RxCPSec
,Ad->e.
RxTٮC
);

1087 
	gpAd
->
	ge
.
	gRxCPSec
 = 0;

1089 i(
	gpAd
->
	ge
.
	gRxAS
 == 0)

1090 
e_t
(
KERN_EMERG
 "MlmePeriodicExec: Rx AvgRssi0=%d, AvgRssi1=%d, AvgRssi2=%d\n\n",

1091 
pAd
->
e
.
AvgRssi0
,Ad->e.
AvgRssi1
,Ad->e.
AvgRssi2
);

1093 
e_t
(
KERN_EMERG
 "MlmePiodicExec: Rx AvgRssi=%d\n\n", 
pAd
->
e
.
AvgRssi0
);

1096 i(
	gpAd
->
	ge
.
	gbAutoTxAlc
 =
TRUE
)

1098 
ATEAsicAdjuTxPow
(
pAd
);

1101 
MlmeRetRkCous
(
pAd
);

1109 
NdisGSyemUpTime
(&
pAd
->
Mlme
.
Now32
);

1114 
NICUpdeRawCous
(
pAd
);

1117 #ifde
DOT11_N_SUPPORT


1119 
ORIBATimTimeout
(
pAd
);

1132 i(
	gpAd
->
	gMlme
.
	gbEbAutoACheck
)

1134 
	gTxTٮC
 = 
pAd
->
RkCous
.
OSecTxNoRryOkCou
 +

1135 
pAd
->
RkCous
.
OSecTxRryOkCou
 +

1136 
pAd
->
RkCous
.
OSecTxFaCou
;

1139 i(
	gTxTٮC
 > 50)

1141 i(
	gpAd
->
	gMlme
.
	gOSecPiodicRound
 % 10 == 0)

1143 
AsicEvueRxA
(
pAd
);

1148 i(
	gpAd
->
	gMlme
.
	gOSecPiodicRound
 % 3 == 0)

1150 
AsicEvueRxA
(
pAd
);

1156 #ifde
VIDEO_TURBINE_SUPPORT


1163 #ifde
CONFIG_STA_SUPPORT


1164 
IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1165 
STAMlmePiodicExec
(
pAd
);

1168 
MlmeRetRkCous
(
pAd
);

1170 #ifde
CONFIG_STA_SUPPORT


1171 
IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1173 #ifde
RTMP_MAC_PCI


1174 i(!
RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
&& (
	gpAd
->
	gbPCIkOff
 =
FALSE
))

1179 
UINT32
 
MacReg
 = 0;

1181 
RTMP_IO_READ32
(
pAd
, 0x10F4, &
MacReg
);

1182 i(((
	gMacReg
 & 0x20000000) && (MacReg & 0x80)) || ((MacReg & 0x20000000) && (MacReg & 0x20)))

1184 
RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 0x1);

1185 
RTMPucDay
(1);

1187 
RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 0xC);

1190 
DBGPRINT
(
RT_DEBUG_WARN
,("Warning, MAC specific condition occurs \n"));

1196 
RTMP_MLME_HANDLER
(
pAd
);

1200 
	gpAd
->
	gbUpdeBCDe
 = 
FALSE
;

1212 
BOOLEAN
 
	$MlmeVideSSID
(

1213 
IN
 
PUCHAR
 
pSsid
,

1214 
IN
 
UCHAR
 
SsidL
)

1216 
dex
;

1218 i(
SsidL
 > 
MAX_LEN_OF_SSID
)

1219  (
FALSE
);

1222 
dex
 = 0; index < 
SsidL
; index++)

1224 i(
pSsid
[
dex
] < 0x20)

1225  (
FALSE
);

1229  (
TRUE
);

1230 
	}
}

1232 
VOID
 
	$MlmeSeReSwchTab11N3SRmt
(

1233 
IN
 
PUCHAR
 *
Tab
)

1235 *
Tab
 = 
ReSwchTab11N3SRmt
;

1236 
	}
}

1238 
VOID
 
	$MlmeSeTxReTab
(

1239 
IN
 
PRTMP_ADAPTER
 
pAd
,

1240 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

1241 
IN
 
PUCHAR
 *
Tab
,

1242 
IN
 
PUCHAR
 
pTabSize
,

1243 
IN
 
PUCHAR
 
pInTxReIdx
)

1245 #ifde
NEW_RATE_ADAPT_SUPPORT


1246 
UCHAR
 
mpUch
[] = {

1249 
UCHAR
 
mpUch1
[] = {

1257 i(
pAd
->
CommCfg
.
TxReTabSize
 > 0)

1259 *
Tab
 = 
ReSwchTab
;

1260 *
pTabSize
 = 
ReSwchTab
[0];

1261 *
pInTxReIdx
 = 
ReSwchTab
[1];

1266 #ifde
CONFIG_STA_SUPPORT


1267 i((
pAd
->
OpMode
 =
OPMODE_STA
&& 
	`ADHOC_ON
(pAd))

1270 #ifde
DOT11_N_SUPPORT


1271 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
) &&

1272 (
pEry
->
HTCaby
.
MCSS
[0] == 0xff) &&

1273 ((
pEry
->
HTCaby
.
MCSS
[1] =0x00|| (
pAd
->
A
.
fld
.
TxPh
 == 1)))

1277 *
Tab
 = 
ReSwchTab11N1S
;

1278 *
pTabSize
 = 
ReSwchTab11N1S
[0];

1279 *
pInTxReIdx
 = 
ReSwchTab11N1S
[1];

1283 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
) &&

1284 (
pEry
->
HTCaby
.
MCSS
[0] == 0xff) &&

1285 (
pEry
->
HTCaby
.
MCSS
[1] == 0xff) &&

1286 (((
pAd
->
A
.
fld
.
TxPh
 =3&& (
pEry
->
HTCaby
.
MCSS
[2] == 0x00)) || (pAd->Antenna.field.TxPath == 2)))

1290 i(
pAd
->
LchRfRegs
.
Chl
 <= 14)

1292 *
Tab
 = 
ReSwchTab11N2S
;

1293 *
pTabSize
 = 
ReSwchTab11N2S
[0];

1294 *
pInTxReIdx
 = 
ReSwchTab11N2S
[1];

1298 *
Tab
 = 
ReSwchTab11N2SFABd
;

1299 *
pTabSize
 = 
ReSwchTab11N2SFABd
[0];

1300 *
pInTxReIdx
 = 
ReSwchTab11N2SFABd
[1];

1307 i((
pEry
->
ReL
 == 4)

1308 #ifde
DOT11_N_SUPPORT


1309 && (
pEry
->
HTCaby
.
MCSS
[0] == 0) && (pEntry->HTCapability.MCSSet[1] == 0)

1313 *
Tab
 = 
ReSwchTab11B
;

1314 *
pTabSize
 = 
ReSwchTab11B
[0];

1315 *
pInTxReIdx
 = 
ReSwchTab11B
[1];

1318 i(
pAd
->
LchRfRegs
.
Chl
 <= 14)

1320 *
Tab
 = 
ReSwchTab11BG
;

1321 *
pTabSize
 = 
ReSwchTab11BG
[0];

1322 *
pInTxReIdx
 = 
ReSwchTab11BG
[1];

1327 *
Tab
 = 
ReSwchTab11G
;

1328 *
pTabSize
 = 
ReSwchTab11G
[0];

1329 *
pInTxReIdx
 = 
ReSwchTab11G
[1];

1336 #ifde
DOT11_N_SUPPORT


1339 i(((
pEry
->
ReL
 =12|| (
pAd
->
OpMode
 =
OPMODE_STA
)&& (pEry->
HTCaby
.
MCSS
[0] == 0xff) &&

1340 ((
pEry
->
HTCaby
.
MCSS
[1] =0x00|| (
pAd
->
CommCfg
.
TxSm
 == 1)))

1343 *
Tab
 = 
ReSwchTab11BGN1S
;

1344 *
pTabSize
 = 
ReSwchTab11BGN1S
[0];

1345 *
pInTxReIdx
 = 
ReSwchTab11BGN1S
[1];

1354 i(((
pEry
->
ReL
 =12|| (
pAd
->
OpMode
 =
OPMODE_STA
)&& (pEry->
HTCaby
.
MCSS
[0] == 0xff) &&

1355 (
pEry
->
HTCaby
.
MCSS
[1] =0xff&& (((
pAd
->
A
.
fld
.
TxPh
 =3&& (pEry->HTCaby.MCSS[2] =0x00)|| (pAd->
CommCfg
.
TxSm
 == 2)))

1358 i(
pAd
->
LchRfRegs
.
Chl
 <= 14)

1360 *
Tab
 = 
ReSwchTab11BGN2S
;

1361 *
pTabSize
 = 
ReSwchTab11BGN2S
[0];

1362 *
pInTxReIdx
 = 
ReSwchTab11BGN2S
[1];

1367 *
Tab
 = 
ReSwchTab11BGN2SFABd
;

1368 *
pTabSize
 = 
ReSwchTab11BGN2SFABd
[0];

1369 *
pInTxReIdx
 = 
ReSwchTab11BGN2SFABd
[1];

1378 i((
pEry
->
HTCaby
.
MCSS
[0] =0xff&& (Ery->HTCaby.MCSS[1] =0x00|| (
pAd
->
CommCfg
.
TxSm
 == 1)))

1381 *
Tab
 = 
ReSwchTab11N1S
;

1382 *
pTabSize
 = 
ReSwchTab11N1S
[0];

1383 *
pInTxReIdx
 = 
ReSwchTab11N1S
[1];

1390 i((
pEry
->
HTCaby
.
MCSS
[0] =0xff&& (pEry->HTCaby.MCSS[1] =0xff&& (
pAd
->
CommCfg
.
TxSm
 == 2))

1393 i(
pAd
->
LchRfRegs
.
Chl
 <= 14)

1395 *
Tab
 = 
ReSwchTab11N2S
;

1396 *
pTabSize
 = 
ReSwchTab11N2S
[0];

1397 *
pInTxReIdx
 = 
ReSwchTab11N2S
[1];

1401 *
Tab
 = 
ReSwchTab11N2SFABd
;

1402 *
pTabSize
 = 
ReSwchTab11N2SFABd
[0];

1403 *
pInTxReIdx
 = 
ReSwchTab11N2SFABd
[1];

1413 i((
pEry
->
ReL
 =4 || 
pAd
->
CommCfg
.
PhyMode
==
PHY_11B
)

1414 #ifde
DOT11_N_SUPPORT


1420 *
Tab
 = 
ReSwchTab11B
;

1421 *
pTabSize
 = 
ReSwchTab11B
[0];

1422 *
pInTxReIdx
 = 
ReSwchTab11B
[1];

1428 i((
pEry
->
ReL
 > 8)

1429 #ifde
DOT11_N_SUPPORT


1430 && (
pEry
->
HTCaby
.
MCSS
[0] == 0) && (pEntry->HTCapability.MCSSet[1] == 0)

1434 *
Tab
 = 
ReSwchTab11BG
;

1435 *
pTabSize
 = 
ReSwchTab11BG
[0];

1436 *
pInTxReIdx
 = 
ReSwchTab11BG
[1];

1442 i((
pEry
->
ReL
 == 8)

1443 #ifde
DOT11_N_SUPPORT


1444 && (
pEry
->
HTCaby
.
MCSS
[0] == 0) && (pEntry->HTCapability.MCSSet[1] == 0)

1448 *
Tab
 = 
ReSwchTab11G
;

1449 *
pTabSize
 = 
ReSwchTab11G
[0];

1450 *
pInTxReIdx
 = 
ReSwchTab11G
[1];

1454 #ifde
DOT11_N_SUPPORT


1457 #ifde
CONFIG_STA_SUPPORT


1458 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1460 #ifde
DOT11_N_SUPPORT


1462 i((
pEry
->
HTCaby
.
MCSS
[0] == 0) && (pEntry->HTCapability.MCSSet[1] == 0))

1465 i(
pAd
->
CommCfg
.
MaxTxRe
 <
RATE_11
)

1467 *
Tab
 = 
ReSwchTab11B
;

1468 *
pTabSize
 = 
ReSwchTab11B
[0];

1469 *
pInTxReIdx
 = 
ReSwchTab11B
[1];

1471 i((
pAd
->
CommCfg
.
MaxTxRe
 > 
RATE_11
&& (pAd->CommCfg.
MTxRe
 > RATE_11))

1473 *
Tab
 = 
ReSwchTab11G
;

1474 *
pTabSize
 = 
ReSwchTab11G
[0];

1475 *
pInTxReIdx
 = 
ReSwchTab11G
[1];

1480 *
Tab
 = 
ReSwchTab11BG
;

1481 *
pTabSize
 = 
ReSwchTab11BG
[0];

1482 *
pInTxReIdx
 = 
ReSwchTab11BG
[1];

1486 #ifde
DOT11_N_SUPPORT


1488 i(
pAd
->
LchRfRegs
.
Chl
 <= 14)

1490 i(
pAd
->
CommCfg
.
TxSm
 == 1)

1492 *
Tab
 = 
ReSwchTab11N1S
;

1493 *
pTabSize
 = 
ReSwchTab11N1S
[0];

1494 *
pInTxReIdx
 = 
ReSwchTab11N1S
[1];

1495 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,("DRS: unkown mode,default use 11N 1S AP \n"));

1497 i(
pAd
->
CommCfg
.
TxSm
 == 2)

1499 *
Tab
 = 
ReSwchTab11N2S
;

1500 *
pTabSize
 = 
ReSwchTab11N2S
[0];

1501 *
pInTxReIdx
 = 
ReSwchTab11N2S
[1];

1502 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,("DRS: unkown mode,default use 11N 2S AP \n"));

1506 *
Tab
 = 
ReSwchTab11N2S
;

1507 *
pTabSize
 = 
ReSwchTab11N2S
[0];

1508 *
pInTxReIdx
 = 
ReSwchTab11N2S
[1];

1513 i(
pAd
->
CommCfg
.
TxSm
 == 1)

1515 *
Tab
 = 
ReSwchTab11N1S
;

1516 *
pTabSize
 = 
ReSwchTab11N1S
[0];

1517 *
pInTxReIdx
 = 
ReSwchTab11N1S
[1];

1518 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,("DRS: unkown mode,default use 11N 1S AP \n"));

1520 i(
pAd
->
CommCfg
.
TxSm
 == 2)

1522 *
Tab
 = 
ReSwchTab11N2S
;

1523 *
pTabSize
 = 
ReSwchTab11N2S
[0];

1524 *
pInTxReIdx
 = 
ReSwchTab11N2S
[1];

1525 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,("DRS: unkown mode,default use 11N 2S AP \n"));

1529 *
Tab
 = 
ReSwchTab11N2SFABd
;

1530 *
pTabSize
 = 
ReSwchTab11N2SFABd
[0];

1531 *
pInTxReIdx
 = 
ReSwchTab11N2SFABd
[1];

1536 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,("DRS: unkown mode (SupRateLen=%d, ExtRateLen=%d, MCSSet[0]=0x%x, MCSSet[1]=0x%x)\n",

1537 
pAd
->
SAive
.
SupReL
,

1538 
pAd
->
SAive
.
ExtReL
,

1539 
pAd
->
SAive
.
Su܋dPhyInfo
.
MCSS
[0],

1540 
pAd
->
SAive
.
Su܋dPhyInfo
.
MCSS
[1]));

1543 } 
FALSE
);

1545 #ifde
NEW_RATE_ADAPT_SUPPORT


1546 i(*
Tab
 =
ReSwchTab11N3S
)

1549 i((
pEry
->
HTCaby
.
MCSS
[0] == 0xff) &&

1550 (
pEry
->
HTCaby
.
MCSS
[1] == 0xff) &&

1551 (
pAd
->
CommCfg
.
TxSm
 > 1) &&

1552 ((
pAd
->
CommCfg
.
TxSm
 =2|| (
pEry
->
HTCaby
.
MCSS
[2] == 0x0)))

1553 
	`NdisMoveMemy
((*
Tab
)+10*16, 
mpUch
, 20);

1554 i((
pEry
->
HTCaby
.
MCSS
[0] == 0xff) &&

1555 ((
pEry
->
HTCaby
.
MCSS
[1] =0x00|| (
pAd
->
CommCfg
.
TxSm
 == 1)))

1556 
	`NdisMoveMemy
((*
Tab
)+10*8, 
mpUch1
, 20);

1559 
	}
}

1562 #ifde
CONFIG_STA_SUPPORT


1563 
VOID
 
	$STAMlmePiodicExec
(

1564 
PRTMP_ADAPTER
 
pAd
)

1566 
ULONG
 
TxTٮC
;

1567 
i
;

1574 #ifde
RALINK_ATE


1575 i(
	`ATE_ON
(
pAd
))

1581 #ifde
WPA_SUPPLICANT_SUPPORT


1582 i(
pAd
->
SCfg
.
WSuliUP
 =
WPA_SUPPLICANT_DISABLE
)

1586 i(
pAd
->
SCfg
.
bBlockAssoc
 &&

1587 
	`RTMP_TIME_AFTER
(
pAd
->
Mlme
.
Now32
,Ad->
SCfg
.
LaMicETime
 + (60*
OS_HZ
)))

1588 
pAd
->
SCfg
.
bBlockAssoc
 = 
FALSE
;

1594 i(
	`ADHOC_ON
(
pAd
))

1599 
	`AsicSBbpTung
(
pAd
);

1602 
TxTٮC
 = 
pAd
->
RkCous
.
OSecTxNoRryOkCou
 +

1603 
pAd
->
RkCous
.
OSecTxRryOkCou
 +

1604 
pAd
->
RkCous
.
OSecTxFaCou
;

1606 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
) &&

1607 (!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
)))

1610 i(
pAd
->
SCfg
.
bImovedSn
 =
FALSE
)

1613 
	`MlmeCcuϋChlQuy
(
pAd
, 
NULL
,Ad->
Mlme
.
Now32
);

1620 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

1621 
	`AsicAdjuTxPow
(
pAd
);

1627 
pAd
->
RkCous
.
LaOSecTٮTxCou
 = 
TxTٮC
;

1629 i(
	`INFRA_ON
(
pAd
))

1632 i((
pAd
->
SCfg
.
bImovedSn
) &&

1633 (
pAd
->
Mlme
.
SyncMache
.
CuS
 =
SCAN_PENDING
))

1635 
MLME_SCAN_REQ_STRUCT
 
SnReq
;

1637 
pAd
->
SCfg
.
LaSnTime
 =Ad->
Mlme
.
Now32
;

1639 
	`SnPmFl
(
pAd
, &
SnReq
, "", 0, 
BSS_ANY
, 
SCAN_ACTIVE
);

1640 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_SCAN_REQ
, (
MLME_SCAN_REQ_STRUCT
), &
SnReq
, 0);

1641 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("bImprovedScan ............. Resume for bImprovedScan, SCAN_PENDING .............. \n"));

1644 #ifde
QOS_DLS_SUPPORT


1646 
	`RTMPCheckDLSTimeOut
(
pAd
);

1652 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

1653 
	`MlmeCheckPsmChge
(
pAd
,Ad->
Mlme
.
Now32
);

1659 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
) &&

1660 (
	`RTMP_TIME_AFTER
(
pAd
->
Mlme
.
Now32
,Ad->
SCfg
.
LaBcRxTime
 + (1*
OS_HZ
))))

1662 
ULONG
 
BPtoJiffs
;

1663 
LONG
 
timeDiff
;

1665 
BPtoJiffs
 = (((
pAd
->
CommCfg
.
BcPiod
 * 1024 / 1000* 
OS_HZ
) / 1000);

1666 
timeDiff
 = (
pAd
->
Mlme
.
Now32
 -Ad->
SCfg
.
LaBcRxTime
/ 
BPtoJiffs
;

1667 i(
timeDiff
 > 0)

1668 
pAd
->
SCfg
.
LaBcRxTime
 +(
timeDiff
 * 
BPtoJiffs
);

1670 i(
	`RTMP_TIME_AFTER
(
pAd
->
SCfg
.
LaBcRxTime
,Ad->
Mlme
.
Now32
))

1672 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MMCHK - BeaconRxTimedjust wrong(BeaconRx=0x%lx, Now=0x%lx)\n",

1673 
pAd
->
SCfg
.
LaBcRxTime
,Ad->
Mlme
.
Now32
));

1677 i((
	`RTMP_TIME_AFTER
(
pAd
->
Mlme
.
Now32
,Ad->
SCfg
.
LaBcRxTime
 + (1*
OS_HZ
))) &&

1678 (!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
)) &&

1679 (
pAd
->
SCfg
.
bImovedSn
 =
FALSE
) &&

1680 (((
TxTٮC
 + 
pAd
->
RkCous
.
OSecRxOkC
) < 600)))

1682 
	`RTMPSAGCInVue
(
pAd
, 
BW_20
);

1683 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MMCHK - NBEACON.eܐR66thlow bound(%d\n", (0x2E + 
	`GET_LNA_GAIN
(
pAd
))));

1691 i((!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
)))

1693 i(
pAd
->
CommCfg
.
bAPSDCab
 &&Ad->CommCfg.
APEdPm
.bAPSDCapable)

1696 i((
pAd
->
Mlme
.
OSecPiodicRound
 % 20) == 8)

1698 
	`RTMPSdNuFme
(
pAd
,Ad->
CommCfg
.
TxRe
, 
TRUE
);

1704 i((
pAd
->
Mlme
.
OSecPiodicRound
 % 10) == 8)

1706 
	`RTMPSdNuFme
(
pAd
,

1707 
pAd
->
CommCfg
.
TxRe
,

1708 (
pAd
->
CommCfg
.
bWmmCab
 &Ad->CommCfg.
APEdPm
.
bVid
));

1713 i(
	`CQI_IS_DEAD
(
pAd
->
Mlme
.
ChlQuy
))

1715 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MMCHK - NBEACON. Dd CQI. AutRecovyem #%ld\n", 
pAd
->
RkCous
.
BadCQIAutoRecovyCou
));

1717 i(
pAd
->
SCfg
.
bAutoCByBssid
)

1718 
pAd
->
SCfg
.
bAutoCByBssid
 = 
FALSE
;

1720 #ifde
WPA_SUPPLICANT_SUPPORT


1721 i((
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
) &&

1722 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
))

1723 
pAd
->
SCfg
.
bLoAp
 = 
TRUE
;

1726 
pAd
->
MlmeAux
.
CuReqIsFromNdis
 = 
FALSE
;

1728 
	`LkDown
(
pAd
, 
FALSE
);

1731 #ifde
WPA_SUPPLICANT_SUPPORT


1732 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


1734 i(
pAd
->
SCfg
.
WSuliUP
)

1736 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, 
RT_DISASSOC_EVENT_FLAG
, 
NULL
, NULL, 0);

1741 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


1742 
	`RtmpOSWrssEvtSd
(
pAd
, 
SIOCGIWAP
, -1, 
NULL
, NULL, 0);

1746 
	`MlmeAutoRecLaSSID
(
pAd
);

1748 i(
	`CQI_IS_BAD
(
pAd
->
Mlme
.
ChlQuy
))

1750 
pAd
->
RkCous
.
BadCQIAutoRecovyCou
 ++;

1751 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MMCHK - Bad CQI. AutRecovyem #%ld\n", 
pAd
->
RkCous
.
BadCQIAutoRecovyCou
));

1752 
	`MlmeAutoRecLaSSID
(
pAd
);

1755 i(
pAd
->
SCfg
.
bAutoRmg
)

1757 
BOOLEAN
 
rv
 = 
FALSE
;

1758 
CHAR
 
dBmToRm
 = 
pAd
->
SCfg
.dBmToRoam;

1759 
CHAR
 
MaxRssi
 = 
	`RTMPMaxRssi
(
pAd
,

1760 
pAd
->
SCfg
.
RssiSame
.
LaRssi0
,

1761 
pAd
->
SCfg
.
RssiSame
.
LaRssi1
,

1762 
pAd
->
SCfg
.
RssiSame
.
LaRssi2
);

1764 i(
pAd
->
SCfg
.
bAutoCByBssid
)

1765 
pAd
->
SCfg
.
bAutoCByBssid
 = 
FALSE
;

1768 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
) &&

1769 (
pAd
->
Mlme
.
SyncMache
.
CuS
 =
SYNC_IDLE
) &&

1770 (
MaxRssi
 <
dBmToRm
))

1772 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Rssi=%d, dBmToRm=%d\n", 
MaxRssi
, (
CHAR
)
dBmToRm
));

1776 i(
rv
 =
FALSE
)

1777 
rv
 = 
	`MlmeCheckFFaRmg
(
pAd
);

1779 i(
rv
 =
FALSE
)

1781 i((
pAd
->
SCfg
.
LaSnTime
 + 10 * 
OS_HZ
<Ad->
Mlme
.
Now32
)

1783 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MMCHK - Roaming, Noligablentry,ryew scan!\n"));

1784 
pAd
->
SCfg
.
LaSnTime
 =Ad->
Mlme
.
Now32
;

1785 
	`MlmeAutoSn
(
pAd
);

1791 i(
	`ADHOC_ON
(
pAd
))

1799  
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
))

1802 
i
 = 1; i < 
MAX_LEN_OF_MAC_TABLE
; i++)

1804 
MAC_TABLE_ENTRY
 *
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
i
];

1806 i(!
	`IS_ENTRY_CLIENT
(
pEry
))

1809 i(
	`RTMP_TIME_AFTER
(
pAd
->
Mlme
.
Now32
, 
pEry
->
LaBcRxTime
 + 
ADHOC_BEACON_LOST_TIME
))

1810 
	`MlmeDeAuthAi
(
pAd
, 
pEry
, 
REASON_DISASSOC_STA_LEAVING
, 
FALSE
);

1813 i(
pAd
->
MacTab
.
Size
 == 0)

1815 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

1816 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSDisced
);

1818 
pAd
->
SCfg
.
LaSnTime
 =Ad->
Mlme
.
Now32
;

1825 #ifde
WPA_SUPPLICANT_SUPPORT


1826 i(
pAd
->
SCfg
.
WSuliUP
 & 
WPA_SUPPLICANT_ENABLE_WPS
)

1827 
SKIP_AUTO_SCAN_CONN
;

1830 i(
pAd
->
SCfg
.
bSnReqIsFromWebUI
 &&

1831 
	`RTMP_TIME_BEFORE
(
pAd
->
Mlme
.
Now32
,Ad->
SCfg
.
LaSnTime
 + (30 * 
OS_HZ
)))

1832 
SKIP_AUTO_SCAN_CONN
;

1834 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
FALSE
;

1836 i((
pAd
->
SCfg
.
bAutoRec
 =
TRUE
)

1837 && 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_START_UP
)

1838 && (
	`MlmeVideSSID
(
pAd
->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
AutoRecSsidL
=
TRUE
))

1840 i((
pAd
->
SnTab
.
BssNr
==0&& (pAd->
Mlme
.
ClMache
.
CuS
 =
CNTL_IDLE
))

1842 
MLME_SCAN_REQ_STRUCT
 
SnReq
;

1844 i(
	`RTMP_TIME_AFTER
(
pAd
->
Mlme
.
Now32
,Ad->
SCfg
.
LaSnTime
 + (10 * 
OS_HZ
))

1845 ||(
pAd
->
SCfg
.
bNFSn
 =
FALSE
))

1847 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("STAMlmePiodicExec():CNTL - SnTab.BssNr==0, sew ACTIVE sSSID[%s]\n", 
pAd
->
MlmeAux
.
AutoRecSsid
));

1848 i(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
)

1849 
pAd
->
SCfg
.
bNFSn
 = 
TRUE
;

1850 
	`SnPmFl
(
pAd
, &
SnReq
, (
PSTRING
pAd->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
AutoRecSsidL
, 
BSS_ANY
, 
SCAN_ACTIVE
);

1851 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_SCAN_REQ
, (
MLME_SCAN_REQ_STRUCT
), &
SnReq
, 0);

1852 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_LIST_SCAN
;

1854 
pAd
->
SCfg
.
LaSnTime
 =Ad->
Mlme
.
Now32
;

1857 
	`MlmeAutoRecLaSSID
(
pAd
);

1859 i(
pAd
->
Mlme
.
ClMache
.
CuS
 =
CNTL_IDLE
)

1861 #ifde
CARRIER_DETECTION_SUPPORT


1862 i(
pAd
->
CommCfg
.
CrrDe
.
Eb
 =
TRUE
)

1864 i((
pAd
->
Mlme
.
OSecPiodicRound
 % 5) == 1)

1865 
	`MlmeAutoRecLaSSID
(
pAd
);

1869 
	`MlmeAutoRecLaSSID
(
pAd
);

1874 
SKIP_AUTO_SCAN_CONN
:

1876 #ifde
DOT11_N_SUPPORT


1877 i((
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
TXBAbm
 !=0&& (pAd->MacTab.
fAnyBASessi
 =
FALSE
))

1879 
pAd
->
MacTab
.
fAnyBASessi
 = 
TRUE
;

1880 
	`AsicUpdePre
(
pAd
, 
HT_FORCERTSCTS
, 
ALLN_SETPROTECT
, 
FALSE
, FALSE);

1882 i((
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
TXBAbm
 ==0&& (pAd->MacTab.
fAnyBASessi
 =
TRUE
))

1884 
pAd
->
MacTab
.
fAnyBASessi
 = 
FALSE
;

1885 
	`AsicUpdePre
(
pAd
,Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
, 
ALLN_SETPROTECT
, 
FALSE
, FALSE);

1890 #ifde
DOT11_N_SUPPORT


1891 #ifde
DOT11N_DRAFT3


1893 i((
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_SCAN_2040
)) &&

1894 (
pAd
->
CommCfg
.
D11BssWidthTriggSnI
 != 0) &&

1895 ((
pAd
->
Mlme
.
OSecPiodicRound
 %Ad->
CommCfg
.
D11BssWidthTriggSnI
) == (pAd->CommonCfg.Dot11BssWidthTriggerScanInt-1)))

1897 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MMCHK - LastOneSecTotalTxCount/LastOneSecRxOkDataCnt = %d/%d \n",

1898 
pAd
->
RkCous
.
LaOSecTٮTxCou
,

1899 
pAd
->
RkCous
.
LaOSecRxOkDaC
));

1905 i((
pAd
->
RkCous
.
LaOSecTٮTxCou
 < 70&& (pAd->RkCous.
LaOSecRxOkDaC
 < 70)

1908 
MLME_SCAN_REQ_STRUCT
 
SnReq
;

1910 
	`SnPmFl
(
pAd
, &
SnReq
, 
ZoSsid
, 0, 
BSS_ANY
, 
SCAN_2040_BSS_COEXIST
);

1911 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_SCAN_REQ
, (
MLME_SCAN_REQ_STRUCT
), &
SnReq
, 0);

1912 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_LIST_SCAN
;

1914 
pAd
->
CommCfg
.
BSSCxi2040
.
fld
.
InfoReq
 = 1;

1915 
	`RTMP_MLME_HANDLER
(
pAd
);

1918 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" LastOneSecTotalTxCount/LastOneSecRxOkDataCnt = %d/%d \n",

1919 
pAd
->
RkCous
.
LaOSecTٮTxCou
,

1920 
pAd
->
RkCous
.
LaOSecRxOkDaC
));

1926 
	}
}

1929 
VOID
 
	$LkDownExec
(

1930 
IN
 
PVOID
 
SyemScific1
,

1931 
IN
 
PVOID
 
FuniCڋxt
,

1932 
IN
 
PVOID
 
SyemScific2
,

1933 
IN
 
PVOID
 
SyemScific3
)

1935 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

1937 i(
pAd
 !
NULL
)

1939 
MLME_DISASSOC_REQ_STRUCT
 
DissocReq
;

1941 i((
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
) &&

1942 (
	`INFRA_ON
(
pAd
)))

1944 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("LinkDownExec(): disassociate with current AP...\n"));

1945 
	`DissocPmFl
(
pAd
, &
DissocReq
,Ad->
CommCfg
.
Bssid
, 
REASON_DISASSOC_STA_LEAVING
);

1946 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_MLME_DISASSOC_REQ
,

1947 (
MLME_DISASSOC_REQ_STRUCT
), &
DissocReq
, 0);

1948 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_DISASSOC
;

1950 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSDisced
);

1951 
pAd
->
ExaInfo
 = 
GENERAL_LINK_DOWN
;

1954 
	}
}

1957 
VOID
 
	$MlmeAutoSn
(

1958 
IN
 
PRTMP_ADAPTER
 
pAd
)

1961 i(
pAd
->
Mlme
.
ClMache
.
CuS
 =
CNTL_IDLE
)

1963 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MMCHK - Driveruto scan\n"));

1964 
	`MlmeEnqueue
(
pAd
,

1965 
MLME_CNTL_STATE_MACHINE
,

1966 
OID_802_11_BSSID_LIST_SCAN
,

1967 
pAd
->
MlmeAux
.
AutoRecSsidL
,

1968 
pAd
->
MlmeAux
.
AutoRecSsid
, 0);

1969 
	`RTMP_MLME_HANDLER
(
pAd
);

1971 
	}
}

1974 
VOID
 
	$MlmeAutoRecLaSSID
(

1975 
IN
 
PRTMP_ADAPTER
 
pAd
)

1977 i(
pAd
->
SCfg
.
bAutoCByBssid
)

1979 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Driverutoeconnectoast OID_802_11_BSSID setting - %02X:%02X:%02X:%02X:%02X:%02X\n",

1980 
pAd
->
MlmeAux
.
Bssid
[0],

1981 
pAd
->
MlmeAux
.
Bssid
[1],

1982 
pAd
->
MlmeAux
.
Bssid
[2],

1983 
pAd
->
MlmeAux
.
Bssid
[3],

1984 
pAd
->
MlmeAux
.
Bssid
[4],

1985 
pAd
->
MlmeAux
.
Bssid
[5]));

1987 
pAd
->
MlmeAux
.
Chl
 =Ad->
CommCfg
.Channel;

1988 
	`MlmeEnqueue
(
pAd
,

1989 
MLME_CNTL_STATE_MACHINE
,

1990 
OID_802_11_BSSID
,

1991 
MAC_ADDR_LEN
,

1992 
pAd
->
MlmeAux
.
Bssid
, 0);

1994 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

1996 
	`RTMP_MLME_HANDLER
(
pAd
);

1999 i((
pAd
->
Mlme
.
ClMache
.
CuS
 =
CNTL_IDLE
) &&

2000 (
	`MlmeVideSSID
(
pAd
->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
AutoRecSsidL
=
TRUE
))

2002 
NDIS_802_11_SSID
 
OidSsid
;

2003 
OidSsid
.
SsidLgth
 = 
pAd
->
MlmeAux
.
AutoRecSsidL
;

2004 
	`NdisMoveMemy
(
OidSsid
.
Ssid
, 
pAd
->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
AutoRecSsidL
);

2006 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Drivutػcϡ OID_802_11_SSID stg - %s, - %d\n", 
pAd
->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
AutoRecSsidL
));

2007 
	`MlmeEnqueue
(
pAd
,

2008 
MLME_CNTL_STATE_MACHINE
,

2009 
OID_802_11_SSID
,

2010 (
NDIS_802_11_SSID
),

2011 &
OidSsid
, 0);

2012 
	`RTMP_MLME_HANDLER
(
pAd
);

2014 
	}
}

2029 
VOID
 
	$MlmeCheckFRmg
(

2030 
IN
 
PRTMP_ADAPTER
 
pAd
,

2031 
IN
 
ULONG
 
Now32
)

2033 
USHORT
 
i
;

2034 
BSS_TABLE
 *
pRmTab
 = &
pAd
->
MlmeAux
.
RmTab
;

2035 
BSS_ENTRY
 *
pBss
;

2037 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==> MlmeCheckForRoaming\n"));

2039 
	`BssTabIn
(
pRmTab
);

2040 
i
 = 0; i < 
pAd
->
SnTab
.
BssNr
; i++)

2042 
pBss
 = &
pAd
->
SnTab
.
BssEry
[
i
];

2044 i(
	`RTMP_TIME_AFTER
(
Now32
, 
pBss
->
LaBcRxTime
 + 
pAd
->
SCfg
.
BcLoTime
))

2046 i(
pBss
->
Rssi
 <
RSSI_THRESHOLD_FOR_ROAMING
)

2048 i(
	`MAC_ADDR_EQUAL
(
pBss
->
Bssid
, 
pAd
->
CommCfg
.Bssid))

2050 i(
pBss
->
Rssi
 < (
pAd
->
SCfg
.
RssiSame
.
LaRssi0
 + 
RSSI_DELTA
))

2054 
	`NdisMoveMemy
(&
pRmTab
->
BssEry
[pRmTab->
BssNr
], 
pBss
, (
BSS_ENTRY
));

2055 
pRmTab
->
BssNr
 += 1;

2058 i(
pRmTab
->
BssNr
 > 0)

2061 i(
pAd
->
Mlme
.
ClMache
.
CuS
 =
CNTL_IDLE
)

2063 
pAd
->
RkCous
.
PoCQIRmgCou
 ++;

2064 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MMCHK - Rmgem #%ld\n", 
pAd
->
RkCous
.
PoCQIRmgCou
));

2065 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_MLME_ROAMING_REQ
, 0, 
NULL
, 0);

2066 
	`RTMP_MLME_HANDLER
(
pAd
);

2069 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=MlmeCheckFRmg(# ondide%d)\n",
pRmTab
->
BssNr
));

2070 
	}
}

2084 
BOOLEAN
 
	$MlmeCheckFFaRmg
(

2085 
IN
 
PRTMP_ADAPTER
 
pAd
)

2087 
USHORT
 
i
;

2088 
BSS_TABLE
 *
pRmTab
 = &
pAd
->
MlmeAux
.
RmTab
;

2089 
BSS_ENTRY
 *
pBss
;

2091 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==> MlmeCheckForFastRoaming\n"));

2093 
	`BssTabIn
(
pRmTab
);

2094 
i
 = 0; i < 
pAd
->
SnTab
.
BssNr
; i++)

2096 
pBss
 = &
pAd
->
SnTab
.
BssEry
[
i
];

2098 i((
pBss
->
Rssi
 <-50&& (pBss->
Chl
 =
pAd
->
CommCfg
.Channel))

2100 i(
	`MAC_ADDR_EQUAL
(
pBss
->
Bssid
, 
pAd
->
CommCfg
.Bssid))

2102 i(!
	`SSID_EQUAL
(
pBss
->
Ssid
,Bss->
SsidL
, 
pAd
->
CommCfg
.Ssid,Ad->CommonCfg.SsidLen))

2104 i(
pBss
->
Rssi
 < (
	`RTMPMaxRssi
(
pAd
,Ad->
SCfg
.
RssiSame
.
LaRssi0
,Ad->SCfg.RssiSame.
LaRssi1
,Ad->SCfg.RssiSame.
LaRssi2
+ 
RSSI_DELTA
))

2107 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("LaRssi0 = %d,Bss->Rss%d\n", 
	`RTMPMaxRssi
(
pAd
,Ad->
SCfg
.
RssiSame
.
LaRssi0
,Ad->SCfg.RssiSame.
LaRssi1
,Ad->SCfg.RssiSame.
LaRssi2
), 
pBss
->
Rssi
));

2109 
	`NdisMoveMemy
(&
pRmTab
->
BssEry
[pRmTab->
BssNr
], 
pBss
, (
BSS_ENTRY
));

2110 
pRmTab
->
BssNr
 += 1;

2113 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=MlmeCheckFFaRmg (BssNr=%d)\n", 
pRmTab
->
BssNr
));

2114 i(
pRmTab
->
BssNr
 > 0)

2117 i(
pAd
->
Mlme
.
ClMache
.
CuS
 =
CNTL_IDLE
)

2119 
pAd
->
RkCous
.
PoCQIRmgCou
 ++;

2120 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MMCHK - Rmgem #%ld\n", 
pAd
->
RkCous
.
PoCQIRmgCou
));

2121 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_MLME_ROAMING_REQ
, 0, 
NULL
, 0);

2122 
	`RTMP_MLME_HANDLER
(
pAd
);

2123  
TRUE
;

2127  
FALSE
;

2128 
	}
}

2130 
VOID
 
	$MlmeSTxRe
(

2131 
IN
 
PRTMP_ADAPTER
 
pAd
,

2132 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

2133 
IN
 
PRTMP_TX_RATE_SWITCH
 
pTxRe
)

2135 
UCHAR
 
MaxMode
 = 
MODE_OFDM
;

2137 #ifde
DOT11_N_SUPPORT


2138 
MaxMode
 = 
MODE_HTGREENFIELD
;

2140 i(
pTxRe
->
STBC
 && (
pAd
->
SCfg
.
MaxHTPhyMode
.
fld
.STBC&& (pAd->
A
.fld.
TxPh
 == 2))

2141 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
STBC
 = 
STBC_USE
;

2144 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
STBC
 = 
STBC_NONE
;

2146 i(
pTxRe
->
CuMCS
 < 
MCS_AUTO
)

2147 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
MCS
 = 
pTxRe
->
CuMCS
;

2149 i(
pAd
->
SCfg
.
HTPhyMode
.
fld
.
MCS
 > 7)

2150 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
STBC
 = 
STBC_NONE
;

2152 i(
	`ADHOC_ON
(
pAd
))

2155 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
ShtGI
 = 
GI_800
;

2156 
pEry
->
HTPhyMode
.
fld
.
STBC
 = 
STBC_NONE
;

2161 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
pTxRe
->
Mode
;

2162 
pEry
->
HTPhyMode
.
fld
.
ShtGI
 = 
pAd
->
SCfg
.HTPhyMode.field.ShortGI;

2163 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.HTPhyMode.field.MCS;

2166 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
MODE
 = 
pEry
->HTPhyMode.field.MODE;

2170 #ifde
DOT11_N_SUPPORT


2171 i((
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
HTMODE
 =
HTMODE_GF
) &&

2172 (
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
GF
 =
HTMODE_GF
))

2173 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
MODE
 = 
MODE_HTGREENFIELD
;

2176 i(
pTxRe
->
Mode
 <
MaxMode
)

2177 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
MODE
 = 
pTxRe
->
Mode
;

2179 #ifde
DOT11_N_SUPPORT


2180 i(
pTxRe
->
ShtGI
 && (
pAd
->
SCfg
.
MaxHTPhyMode
.
fld
.ShortGI))

2181 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
ShtGI
 = 
GI_400
;

2184 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
ShtGI
 = 
GI_800
;

2186 #ifde
DOT11_N_SUPPORT


2188 i(
pAd
->
SCfg
.
HTPhyMode
.
fld
.
ShtGI
 =
GI_400
)

2190 i((
pEry
->
HTPhyMode
.
fld
.
BW
 =
BW_20
&& (!
	`CLIENT_STATUS_TEST_FLAG
Ery, 
fCLIENT_STATUS_SGI20_CAPABLE
)))

2191 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
ShtGI
 = 
GI_800
;

2192 i((
pEry
->
HTPhyMode
.
fld
.
BW
 =
BW_40
&& (!
	`CLIENT_STATUS_TEST_FLAG
Ery, 
fCLIENT_STATUS_SGI40_CAPABLE
)))

2193 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
ShtGI
 = 
GI_800
;

2197 i((
pEry
->
HTPhyMode
.
fld
.
MCS
 =0&& (
pAd
->
SCfg
.HTPhyMode.field.MCS != 0))

2199 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.HTPhyMode.field.MCS;

2200 i(
pAd
->
MacTab
.
fAnyBASessi
)

2202 
	`AsicUpdePre
(
pAd
, 
HT_FORCERTSCTS
, 
ALLN_SETPROTECT
, 
TRUE
, (
BOOLEAN
Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
NGfP
);

2206 
	`AsicUpdePre
(
pAd
,Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
, 
ALLN_SETPROTECT
, 
TRUE
, (
BOOLEAN
Ad->MlmeAux.AddHtInfo.AddHtInfo2.
NGfP
);

2209 i((
pEry
->
HTPhyMode
.
fld
.
MCS
 =8&& (
pAd
->
SCfg
.HTPhyMode.field.MCS != 8))

2211 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.HTPhyMode.field.MCS;

2212 i(
pAd
->
MacTab
.
fAnyBASessi
)

2214 
	`AsicUpdePre
(
pAd
, 
HT_FORCERTSCTS
, 
ALLN_SETPROTECT
, 
TRUE
, (
BOOLEAN
Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
NGfP
);

2218 
	`AsicUpdePre
(
pAd
,Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
, 
ALLN_SETPROTECT
, 
TRUE
, (
BOOLEAN
Ad->MlmeAux.AddHtInfo.AddHtInfo2.
NGfP
);

2221 i((
pEry
->
HTPhyMode
.
fld
.
MCS
 !0&& (
pAd
->
SCfg
.HTPhyMode.field.MCS == 0))

2223 
	`AsicUpdePre
(
pAd
, 
HT_RTSCTS_6M
, 
ALLN_SETPROTECT
, 
TRUE
, (
BOOLEAN
Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
NGfP
);

2226 i((
pEry
->
HTPhyMode
.
fld
.
MCS
 !8&& (
pAd
->
SCfg
.HTPhyMode.field.MCS == 8))

2228 
	`AsicUpdePre
(
pAd
, 
HT_RTSCTS_6M
, 
ALLN_SETPROTECT
, 
TRUE
, (
BOOLEAN
Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
NGfP
);

2232 
pEry
->
HTPhyMode
.
fld
.
STBC
 = 
pAd
->
SCfg
.HTPhyMode.field.STBC;

2233 
pEry
->
HTPhyMode
.
fld
.
ShtGI
 = 
pAd
->
SCfg
.HTPhyMode.field.ShortGI;

2234 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.HTPhyMode.field.MCS;

2235 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
pAd
->
SCfg
.HTPhyMode.field.MODE;

2238 
pAd
->
LaTxRe
 = (
USHORT
)(
pEry
->
HTPhyMode
.
wd
);

2239 
	}
}

2258 
VOID
 
	$MlmeDymicTxReSwchg
(

2259 
IN
 
PRTMP_ADAPTER
 
pAd
)

2261 
UCHAR
 
UpReIdx
 = 0, 
DownReIdx
 = 0, 
CuReIdx
;

2262 
ULONG
 
i
, 
AccuTxTٮC
 = 0, 
TxTٮC
;

2263 
ULONG
 
TxERio
 = 0;

2264 
BOOLEAN
 
bTxReChged
 = 
FALSE
, 
bUpgdeQuy
 = FALSE;

2265 
PRTMP_TX_RATE_SWITCH
 
pCuTxRe
, 
pNextTxRe
 = 
NULL
;

2266 
PUCHAR
 
pTab
;

2267 
UCHAR
 
TabSize
 = 0;

2268 
UCHAR
 
InTxReIdx
 = 0, 
TUp
, 
TDown
;

2269 
CHAR
 
Rssi
, 
RssiOfft
 = 0;

2270 
TX_STA_CNT1_STRUC
 
STx1
;

2271 
TX_STA_CNT0_STRUC
 
TxSC0
;

2272 
ULONG
 
TxRnsm
 = 0, 
TxSucss
 = 0, 
TxFaCou
 = 0;

2273 
MAC_TABLE_ENTRY
 *
pEry
;

2274 
RSSI_SAMPLE
 *
pRssi
 = &
pAd
->
SCfg
.
RssiSame
;

2275 
UCHAR
 
tmpTxRe
 = 0;

2277 #ifde
RALINK_ATE


2278 i(
	`ATE_ON
(
pAd
))

2285 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT0
, &
TxSC0
.
wd
);

2286 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT1
, &
STx1
.
wd
);

2287 
pAd
->
bUpdeBCDe
 = 
TRUE
;

2288 
TxRnsm
 = 
STx1
.
fld
.TxRetransmit;

2289 
TxSucss
 = 
STx1
.
fld
.TxSuccess;

2290 
TxFaCou
 = 
TxSC0
.
fld
.TxFailCount;

2291 
TxTٮC
 = 
TxRnsm
 + 
TxSucss
 + 
TxFaCou
;

2293 
pAd
->
RkCous
.
OSecTxRryOkCou
 +
STx1
.
fld
.
TxRnsm
;

2294 
pAd
->
RkCous
.
OSecTxNoRryOkCou
 +
STx1
.
fld
.
TxSucss
;

2295 
pAd
->
RkCous
.
OSecTxFaCou
 +
TxSC0
.
fld
.
TxFaCou
;

2297 #ifde
STATS_COUNT_SUPPORT


2298 
pAd
->
WnCous
.
TnsmdFgmtCou
.
u
.
LowPt
 +
STx1
.
fld
.
TxSucss
;

2299 
pAd
->
WnCous
.
RryCou
.
u
.
LowPt
 +
STx1
.
fld
.
TxRnsm
;

2300 
pAd
->
WnCous
.
FaedCou
.
u
.
LowPt
 +
TxSC0
.
fld
.
TxFaCou
;

2307 
i
 = 1; i < 
MAX_LEN_OF_MAC_TABLE
; i++)

2309 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
i
];

2311 i(
	`IS_ENTRY_NONE
(
pEry
))

2315 i(
	`RTMPCheckEryEbAutoReSwch
(
pAd
, 
pEry
=
FALSE
)

2318 
	`MlmeSeTxReTab
(
pAd
, 
pEry
, &
pTab
, &
TabSize
, &
InTxReIdx
);

2320 #ifde
NEW_RATE_ADAPT_SUPPORT


2321 i(
pTab
 =
ReSwchTab11N3S
)

2323 
	`MlmeDymicTxReSwchgAdt
(
pAd
, 
i
);

2328 i((
pAd
->
MacTab
.
Size
 =1|| 
	`IS_ENTRY_DLS
(
pEry
))

2330 
Rssi
 = 
	`RTMPMaxRssi
(
pAd
,

2331 
pRssi
->
AvgRssi0
,

2332 
pRssi
->
AvgRssi1
,

2333 
pRssi
->
AvgRssi2
);

2338 
AccuTxTٮC
 = 
pAd
->
RkCous
.
OSecTxNoRryOkCou
 +

2339 
pAd
->
RkCous
.
OSecTxRryOkCou
 +

2340 
pAd
->
RkCous
.
OSecTxFaCou
;

2342 i(
TxTٮC
)

2343 
TxERio
 = ((
TxRnsm
 + 
TxFaCou
* 100/ 
TxTٮC
;

2348 i(
	`INFRA_ON
(
pAd
&& (
i
 == 1))

2349 
Rssi
 = 
	`RTMPMaxRssi
(
pAd
,

2350 
pRssi
->
AvgRssi0
,

2351 
pRssi
->
AvgRssi1
,

2352 
pRssi
->
AvgRssi2
);

2354 
Rssi
 = 
	`RTMPMaxRssi
(
pAd
,

2355 
pEry
->
RssiSame
.
AvgRssi0
,

2356 
pEry
->
RssiSame
.
AvgRssi1
,

2357 
pEry
->
RssiSame
.
AvgRssi2
);

2359 
TxTٮC
 = 
pEry
->
OSecTxNoRryOkCou
 +

2360 
pEry
->
OSecTxRryOkCou
 +

2361 
pEry
->
OSecTxFaCou
;

2363 i(
TxTٮC
)

2364 
TxERio
 = ((
pEry
->
OSecTxRryOkCou
 +Ery->
OSecTxFaCou
* 100/ 
TxTٮC
;

2368 i(
TxTٮC
)

2374 i(
TxERio
 == 100)

2376 
TX_RTY_CFG_STRUC
 
TxRtyCfg
,
TxRtyCfgtmp
;

2377 
ULONG
 
Index
;

2378 
UINT32
 
MACVue
;

2380 
	`RTMP_IO_READ32
(
pAd
, 
TX_RTY_CFG
, &
TxRtyCfg
.
wd
);

2381 
TxRtyCfgtmp
.
wd
 = 
TxRtyCfg
.word;

2382 
TxRtyCfg
.
fld
.
LgRtyLim
 = 0x0;

2383 
TxRtyCfg
.
fld
.
ShtRtyLim
 = 0x0;

2384 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_RTY_CFG
, 
TxRtyCfg
.
wd
);

2386 
	`RTMPucDay
(1);

2388 
Index
 = 0;

2389 
MACVue
 = 0;

2392 
	`RTMP_IO_READ32
(
pAd
, 
TXRXQ_PCNT
, &
MACVue
);

2393 i((
MACVue
 & 0xffffff) == 0)

2395 
Index
++;

2396 
	`RTMPucDay
(1000);

2397 }(
Index
 < 330)&&(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
)));

2399 
	`RTMP_IO_READ32
(
pAd
, 
TX_RTY_CFG
, &
TxRtyCfg
.
wd
);

2400 
TxRtyCfg
.
fld
.
LgRtyLim
 = 
TxRtyCfgtmp
.field.LongRtyLimit;

2401 
TxRtyCfg
.
fld
.
ShtRtyLim
 = 
TxRtyCfgtmp
.field.ShortRtyLimit;

2402 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_RTY_CFG
, 
TxRtyCfg
.
wd
);

2406 
CuReIdx
 = 
pEry
->
CuTxReIndex
;

2411 i(
CuReIdx
 >
TabSize
)

2413 
CuReIdx
 = 
TabSize
 - 1;

2418 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
CuReIdx
+1)*5];

2419 i((
pEry
->
HTPhyMode
.
fld
.
MCS
 !
pCuTxRe
->
CuMCS
)

2426 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
InTxReIdx
+1)*5];

2427 
pEry
->
CuTxReIndex
 = 
InTxReIdx
;

2428 
	`MlmeSTxRe
(
pAd
, 
pEry
, 
pCuTxRe
);

2431 
	`RESET_ONE_SEC_TX_CNT
(
pEry
);

2436 i((
CuReIdx
 > 0&& (CuReIdx < (
TabSize
 - 1)))

2438 
UpReIdx
 = 
CuReIdx
 + 1;

2439 
DownReIdx
 = 
CuReIdx
 -1;

2441 i(
CuReIdx
 == 0)

2443 
UpReIdx
 = 
CuReIdx
 + 1;

2444 
DownReIdx
 = 
CuReIdx
;

2446 i(
CuReIdx
 =(
TabSize
 - 1))

2448 
UpReIdx
 = 
CuReIdx
;

2449 
DownReIdx
 = 
CuReIdx
 - 1;

2452 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
CuReIdx
+1)*5];

2454 #ifde
DOT11_N_SUPPORT


2456 i((
Rssi
 > -65&& (
pCuTxRe
->
Mode
 >
MODE_HTMIX
))

2458 
TUp
 = (
pCuTxRe
->TrainUp + (pCurrTxRate->TrainUp >> 1));

2459 
TDown
 = (
pCuTxRe
->TrainDown + (pCurrTxRate->TrainDown >> 1));

2464 
TUp
 = 
pCuTxRe
->TrainUp;

2465 
TDown
 = 
pCuTxRe
->TrainDown;

2473 
pEry
->
LaTimeTxReChgeAi
 =Ery->
LaSecTxReChgeAi
;

2481 i(
TxTٮC
 <= 15)

2483 
CHAR
 
idx
 = 0;

2484 
UCHAR
 
TxReIdx
;

2485 
UCHAR
 
MCS0
 = 0, 
MCS1
 = 0, 
MCS2
 = 0, 
MCS3
 = 0, 
MCS4
 = 0, 
MCS5
 =0, 
MCS6
 = 0, 
MCS7
 = 0;

2486 
UCHAR
 
MCS12
 = 0, 
MCS13
 = 0, 
MCS14
 = 0, 
MCS15
 = 0;

2489 
idx
 < 
pTab
[0])

2491 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
idx
+1)*5];

2493 i(
pCuTxRe
->
CuMCS
 =
MCS_0
)

2495 
MCS0
 = 
idx
;

2497 i(
pCuTxRe
->
CuMCS
 =
MCS_1
)

2499 
MCS1
 = 
idx
;

2501 i(
pCuTxRe
->
CuMCS
 =
MCS_2
)

2503 
MCS2
 = 
idx
;

2505 i(
pCuTxRe
->
CuMCS
 =
MCS_3
)

2507 
MCS3
 = 
idx
;

2509 i(
pCuTxRe
->
CuMCS
 =
MCS_4
)

2511 
MCS4
 = 
idx
;

2513 i(
pCuTxRe
->
CuMCS
 =
MCS_5
)

2515 
MCS5
 = 
idx
;

2517 i(
pCuTxRe
->
CuMCS
 =
MCS_6
)

2519 
MCS6
 = 
idx
;

2521 i((
pCuTxRe
->
CuMCS
 =
MCS_7
&& (pCuTxRe->
ShtGI
 =
GI_800
))

2523 
MCS7
 = 
idx
;

2525 i(
pCuTxRe
->
CuMCS
 =
MCS_12
)

2527 
MCS12
 = 
idx
;

2529 i(
pCuTxRe
->
CuMCS
 =
MCS_13
)

2531 
MCS13
 = 
idx
;

2533 i(
pCuTxRe
->
CuMCS
 =
MCS_14
)

2535 
MCS14
 = 
idx
;

2538 i((
pCuTxRe
->
CuMCS
 =
MCS_15
&& (pCuTxRe->
ShtGI
 =
GI_800
))

2540 
MCS15
 = 
idx
;

2542 
idx
 ++;

2545 i(
pAd
->
LchRfRegs
.
Chl
 <= 14)

2547 i(
pAd
->
NicCfig2
.
fld
.
ExLNAFG
)

2549 
RssiOfft
 = 2;

2553 
RssiOfft
 = 5;

2558 i(
pAd
->
NicCfig2
.
fld
.
ExLNAFA
)

2560 
RssiOfft
 = 5;

2564 
RssiOfft
 = 8;

2567 #ifde
DOT11_N_SUPPORT


2568 i((
pTab
 =
ReSwchTab11BGN2S
|| (pTab =
ReSwchTab11BGN2SFABd
||Tab =
ReSwchTab11N2S
||Tab =
ReSwchTab11N2SFABd
))

2570 i(
MCS15
 && (
Rssi
 >(-70+
RssiOfft
)))

2571 
TxReIdx
 = 
MCS15
;

2572 i(
MCS14
 && (
Rssi
 >(-72+
RssiOfft
)))

2573 
TxReIdx
 = 
MCS14
;

2574 i(
MCS13
 && (
Rssi
 >(-76+
RssiOfft
)))

2575 
TxReIdx
 = 
MCS13
;

2576 i(
MCS12
 && (
Rssi
 >(-78+
RssiOfft
)))

2577 
TxReIdx
 = 
MCS12
;

2578 i(
MCS4
 && (
Rssi
 >(-82+
RssiOfft
)))

2579 
TxReIdx
 = 
MCS4
;

2580 i(
MCS3
 && (
Rssi
 >(-84+
RssiOfft
)))

2581 
TxReIdx
 = 
MCS3
;

2582 i(
MCS2
 && (
Rssi
 >(-86+
RssiOfft
)))

2583 
TxReIdx
 = 
MCS2
;

2584 i(
MCS1
 && (
Rssi
 >(-88+
RssiOfft
)))

2585 
TxReIdx
 = 
MCS1
;

2587 
TxReIdx
 = 
MCS0
;

2589 i((
pTab
 =
ReSwchTab11BGN1S
|| (pTab =
ReSwchTab11N1S
))

2591 i(
MCS7
 && (
Rssi
 > (-72+
RssiOfft
)))

2592 
TxReIdx
 = 
MCS7
;

2593 i(
MCS6
 && (
Rssi
 > (-74+
RssiOfft
)))

2594 
TxReIdx
 = 
MCS6
;

2595 i(
MCS5
 && (
Rssi
 > (-77+
RssiOfft
)))

2596 
TxReIdx
 = 
MCS5
;

2597 i(
MCS4
 && (
Rssi
 > (-79+
RssiOfft
)))

2598 
TxReIdx
 = 
MCS4
;

2599 i(
MCS3
 && (
Rssi
 > (-81+
RssiOfft
)))

2600 
TxReIdx
 = 
MCS3
;

2601 i(
MCS2
 && (
Rssi
 > (-83+
RssiOfft
)))

2602 
TxReIdx
 = 
MCS2
;

2603 i(
MCS1
 && (
Rssi
 > (-86+
RssiOfft
)))

2604 
TxReIdx
 = 
MCS1
;

2606 
TxReIdx
 = 
MCS0
;

2611 i(
MCS7
 && (
Rssi
 > -70))

2612 
TxReIdx
 = 
MCS7
;

2613 i(
MCS6
 && (
Rssi
 > -74))

2614 
TxReIdx
 = 
MCS6
;

2615 i(
MCS5
 && (
Rssi
 > -78))

2616 
TxReIdx
 = 
MCS5
;

2617 i(
MCS4
 && (
Rssi
 > -82))

2618 
TxReIdx
 = 
MCS4
;

2619 i(
MCS4
 == 0)

2620 
TxReIdx
 = 
MCS3
;

2621 i(
MCS3
 && (
Rssi
 > -85))

2622 
TxReIdx
 = 
MCS3
;

2623 i(
MCS2
 && (
Rssi
 > -87))

2624 
TxReIdx
 = 
MCS2
;

2625 i(
MCS1
 && (
Rssi
 > -90))

2626 
TxReIdx
 = 
MCS1
;

2628 
TxReIdx
 = 
MCS0
;

2634 
pEry
->
CuTxReIndex
 = 
TxReIdx
;

2635 
pNextTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
pEry
->
CuTxReIndex
+1)*5];

2636 
	`MlmeSTxRe
(
pAd
, 
pEry
, 
pNextTxRe
);

2639 
	`NdisZoMemy
(
pEry
->
TxQuy
, (
USHORT
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

2640 
	`NdisZoMemy
(
pEry
->
PER
, (
UCHAR
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

2641 
pEry
->
fLaSecAccdgRSSI
 = 
TRUE
;

2643 
	`RESET_ONE_SEC_TX_CNT
(
pEry
);

2648 i(
pEry
->
fLaSecAccdgRSSI
 =
TRUE
)

2650 
pEry
->
fLaSecAccdgRSSI
 = 
FALSE
;

2651 
pEry
->
LaSecTxReChgeAi
 = 0;

2653 
	`RESET_ONE_SEC_TX_CNT
(
pEry
);

2660 
BOOLEAN
 
bTUpDown
 = 
FALSE
;

2662 
pEry
->
CuTxReSbTime
 ++;

2665 i(
TxERio
 >
TDown
)

2667 
bTUpDown
 = 
TRUE
;

2668 
pEry
->
TxQuy
[
CuReIdx
] = 
DRS_TX_QUALITY_WORST_BOUND
;

2671 i(
TxERio
 <
TUp
)

2673 
bTUpDown
 = 
TRUE
;

2674 
bUpgdeQuy
 = 
TRUE
;

2675 i(
pEry
->
TxQuy
[
CuReIdx
])

2676 
pEry
->
TxQuy
[
CuReIdx
] --;

2678 i(
pEry
->
TxReUpPty
)

2679 
pEry
->
TxReUpPty
 --;

2680 i(
pEry
->
TxQuy
[
UpReIdx
])

2681 
pEry
->
TxQuy
[
UpReIdx
] --;

2684 
pEry
->
PER
[
CuReIdx
] = (
UCHAR
)
TxERio
;

2686 i(
bTUpDown
)

2689 i((
CuReIdx
 !
DownReIdx
&& (
pEry
->
TxQuy
[CuReIdx] >
DRS_TX_QUALITY_WORST_BOUND
))

2691 
pEry
->
CuTxReIndex
 = 
DownReIdx
;

2693 i((
CuReIdx
 !
UpReIdx
&& (
pEry
->
TxQuy
[UpRateIdx] <= 0))

2695 
pEry
->
CuTxReIndex
 = 
UpReIdx
;

2698 } 
FALSE
);

2701 i(
pEry
->
CuTxReIndex
 > 
CuReIdx
)

2703 
pEry
->
CuTxReSbTime
 = 0;

2704 
pEry
->
TxReUpPty
 = 0;

2705 
pEry
->
LaSecTxReChgeAi
 = 1;

2706 
	`NdisZoMemy
(
pEry
->
TxQuy
, (
USHORT
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

2707 
	`NdisZoMemy
(
pEry
->
PER
, (
UCHAR
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

2712 i(!
pAd
->
SCfg
.
SQuickReeFReUpTimRug
)

2714 
	`RTMPSTim
(&
pAd
->
SCfg
.
SQuickReeFReUpTim
, 100);

2716 
pAd
->
SCfg
.
SQuickReeFReUpTimRug
 = 
TRUE
;

2718 
bTxReChged
 = 
TRUE
;

2721 i(
pEry
->
CuTxReIndex
 < 
CuReIdx
)

2723 
pEry
->
CuTxReSbTime
 = 0;

2724 
pEry
->
TxReUpPty
 = 0;

2725 
pEry
->
LaSecTxReChgeAi
 = 2;

2726 
pEry
->
TxQuy
[pEry->
CuTxReIndex
] = 0;

2727 
pEry
->
PER
[pEry->
CuTxReIndex
] = 0;

2732 i(!
pAd
->
SCfg
.
SQuickReeFReUpTimRug
)

2734 
	`RTMPSTim
(&
pAd
->
SCfg
.
SQuickReeFReUpTim
, 100);

2736 
pAd
->
SCfg
.
SQuickReeFReUpTimRug
 = 
TRUE
;

2738 
bTxReChged
 = 
TRUE
;

2742 
pEry
->
LaSecTxReChgeAi
 = 0;

2743 
bTxReChged
 = 
FALSE
;

2746 
pEry
->
LaTxOkCou
 = 
TxSucss
;

2748 
tmpTxRe
 = 
pEry
->
CuTxReIndex
;

2752 
pNextTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
tmpTxRe
+1)*5];

2753 i(
bTxReChged
 && 
pNextTxRe
)

2755 
	`MlmeSTxRe
(
pAd
, 
pEry
, 
pNextTxRe
);

2759 
	`RESET_ONE_SEC_TX_CNT
(
pEry
);

2761 
	}
}

2763 #ifde
TXBF_SUPPORT


2764 
VOID
 
	$aETxBFProbg
(

2765 
IN
 
PRTMP_ADAPTER
 
pAd
,

2766 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

2767 
IN
 
PRTMP_TX_RATE_SWITCH
 
pNextTxRe
)

2769 i(
pEry
->
eTxBfEnCd
 !=0)

2774 i(((
pEry
->
eTxBfEnCd
 =1 ||Ery->eTxBfEnCd =3&& (pEry->
bfS
 =
READY_FOR_SNDG0
 &&Ery->
noSndgC
 >pEry->
noSndgCThrd
))

2775 ||(
pEry
->
eTxBfEnCd
 =2 &&Ery->
LaSecTxReChgeAi
 !=0))

2779 i(
pEry
->
bfS
 =
READY_FOR_SNDG0
)

2781 
pEry
->
noSndgC
 ++;

2784 
pEry
->
noSndgC
 = 0;

2786 
	}
}

2789 #ifde
NEW_RATE_ADAPT_SUPPORT


2790 
VOID
 
	$MlmeDymicTxReSwchgAdt
(

2791 
IN
 
PRTMP_ADAPTER
 
pAd
,

2792 
IN
 
ULONG
 
i
)

2794 
UCHAR
 
UpReIdx
 = 0, 
DownReIdx
 = 0, 
CuReIdx
;

2795 
ULONG
 
AccuTxTٮC
 = 0, 
TxTٮC
;

2796 
ULONG
 
TxERio
 = 0;

2797 
BOOLEAN
 
bTxReChged
, 
bUpgdeQuy
 = 
FALSE
;

2798 
PRTMP_TX_RATE_SWITCH_3S
 
pCuTxRe
, 
pNextTxReIdx
;

2799 
PRTMP_TX_RATE_SWITCH
 
pNextTxRe
 = 
NULL
;

2800 
PUCHAR
 
pTab
;

2801 
UCHAR
 
TabSize
 = 0;

2802 
UCHAR
 
InTxReIdx
 = 0, 
TUp
, 
TDown
;

2803 
CHAR
 
Rssi
, 
RssiOfft
 = 0;

2804 
TX_STA_CNT1_STRUC
 
STx1
;

2805 
TX_STA_CNT0_STRUC
 
TxSC0
;

2806 
ULONG
 
TxRnsm
 = 0, 
TxSucss
 = 0, 
TxFaCou
 = 0;

2807 
MAC_TABLE_ENTRY
 *
pEry
;

2808 
ULONG
 
phyReLim20
 = 0;

2809 
UCHAR
 
tmpTxRe
 = 0;

2810 
PRTMP_TX_RATE_SWITCH_3S
 
pTempTxRe
 = 
NULL
;

2812 #ifde
RALINK_ATE


2813 i(
	`ATE_ON
(
pAd
))

2819 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
i
];

2821 
	`MlmeSeTxReTab
(
pAd
, 
pEry
, &
pTab
, &
TabSize
, &
InTxReIdx
);

2823 i((
pAd
->
MacTab
.
Size
 =1|| (
	`IS_ENTRY_DLS
(
pEry
)))

2828 if(
pAd
->
A
.
fld
.
RxPh
 == 3)

2830 
Rssi
 = ((
CHAR
)
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
 + (CHARAd->SCfg.RssiSame.
AvgRssi1
 + (CHARAd->SCfg.RssiSame.
AvgRssi2
)/3;

2832 if(
pAd
->
A
.
fld
.
RxPh
 == 2)

2834 
Rssi
 = ((
CHAR
)
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
 + (CHARAd->SCfg.RssiSame.
AvgRssi1
)>>1;

2838 
Rssi
 = (
CHAR
)
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
;

2842 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT0
, &
TxSC0
.
wd
);

2843 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT1
, &
STx1
.
wd
);

2844 
pAd
->
bUpdeBCDe
 = 
TRUE
;

2845 
TxRnsm
 = 
STx1
.
fld
.TxRetransmit;

2846 
TxSucss
 = 
STx1
.
fld
.TxSuccess;

2847 
TxFaCou
 = 
TxSC0
.
fld
.TxFailCount;

2848 
TxTٮC
 = 
TxRnsm
 + 
TxSucss
 + 
TxFaCou
;

2850 
pAd
->
RkCous
.
OSecTxRryOkCou
 +
STx1
.
fld
.
TxRnsm
;

2851 
pAd
->
RkCous
.
OSecTxNoRryOkCou
 +
STx1
.
fld
.
TxSucss
;

2852 
pAd
->
RkCous
.
OSecTxFaCou
 +
TxSC0
.
fld
.
TxFaCou
;

2853 
pAd
->
WnCous
.
TnsmdFgmtCou
.
u
.
LowPt
 +
STx1
.
fld
.
TxSucss
;

2854 
pAd
->
WnCous
.
RryCou
.
u
.
LowPt
 +
STx1
.
fld
.
TxRnsm
;

2855 
pAd
->
WnCous
.
FaedCou
.
u
.
LowPt
 +
TxSC0
.
fld
.
TxFaCou
;

2860 
AccuTxTٮC
 = 
pAd
->
RkCous
.
OSecTxNoRryOkCou
 +

2861 
pAd
->
RkCous
.
OSecTxRryOkCou
 +

2862 
pAd
->
RkCous
.
OSecTxFaCou
;

2864 i(
TxTٮC
)

2865 
TxERio
 = ((
TxRnsm
 + 
TxFaCou
* 100/ 
TxTٮC
;

2872 if(
pAd
->
A
.
fld
.
RxPh
 == 3)

2874 
Rssi
 = ((
CHAR
)
pEry
->
RssiSame
.
AvgRssi0
 + (CHAREry->RssiSame.
AvgRssi1
 + (CHAREry->RssiSame.
AvgRssi2
)/3;

2876 if(
pAd
->
A
.
fld
.
RxPh
 == 2)

2878 
Rssi
 = ((
CHAR
)
pEry
->
RssiSame
.
AvgRssi0
 + (CHAREry->RssiSame.
AvgRssi1
)>>1;

2882 
Rssi
 = (
CHAR
)
pEry
->
RssiSame
.
AvgRssi0
;

2885 
TxTٮC
 = 
pEry
->
OSecTxNoRryOkCou
 +

2886 
pEry
->
OSecTxRryOkCou
 +

2887 
pEry
->
OSecTxFaCou
;

2889 i(
TxTٮC
)

2890 
TxERio
 = ((
pEry
->
OSecTxRryOkCou
 +Ery->
OSecTxFaCou
* 100/ 
TxTٮC
;

2894 
CuReIdx
 = 
pEry
->
CuTxReIndex
;

2896 i(
CuReIdx
 >
TabSize
)

2898 
CuReIdx
 = 
TabSize
 - 1;

2902 #i
	`defed
 (
CONFIG_RALINK_RT2883
|| defed (
CONFIG_RALINK_RT3883
)

2903 
phyReLim20
 = 
pEry
->
HTPhyMode
.
fld
.
BW
==
BW_20
? 
pAd
->
CommCfg
.
PhyReLim
:Ad->CommonCfg.PhyRateLimit*13/27;

2906 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH_3S
&
pTab
[(
CuReIdx
+1)*10];

2911 i((
pEry
->
HTCaby
.
MCSS
[2] =0xff&& (
pAd
->
CommCfg
.
TxSm
 == 3))

2913 
pEry
->
mcsGroup
)

2916 
UpReIdx
 = 
pCuTxRe
->
upMcs3
;

2917 i(
pEry
->
TxQuy
[
UpReIdx
] >Ery->TxQuy[
pCuTxRe
->
upMcs2
] &&CuTxRe->upMcs2 !pCuTxRe->
ImNo
)

2918 
UpReIdx
 = 
pCuTxRe
->
upMcs2
;

2920 i(
pEry
->
TxQuy
[
UpReIdx
] >Ery->TxQuy[
pCuTxRe
->
upMcs1
] &&CuTxRe->upMcs1 !pCuTxRe->
ImNo
)

2921 
UpReIdx
 = 
pCuTxRe
->
upMcs1
;

2925 
UpReIdx
 = 
pCuTxRe
->
upMcs3
;

2929 
UpReIdx
 = 
pCuTxRe
->
upMcs2
;

2933 
UpReIdx
 = 
pCuTxRe
->
upMcs1
;

2937 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, ("wrong mcsGroup value\n"));

2941 i((
pEry
->
mcsGroup
 == 0) &&

2942 (((
pEry
->
TxQuy
[
pCuTxRe
->
upMcs3
] >Ery->TxQuy[pCuTxRe->
upMcs2
]&& (pCuTxRe->upMcs2 !pCuTxRe->
ImNo
)) ||

2943 ((
pEry
->
TxQuy
[
pCuTxRe
->
upMcs3
] >Ery->TxQuy[pCuTxRe->
upMcs1
]&& (pCuTxRe->upMcs1 !pCuTxRe->
ImNo
))))

2944 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("DRS: Before- mcsGroup=%d, TxQuality2[%d]=%d, TxQuality1[%d]=%d, TxQuality0[%d]=%d\n",

2945 
pEry
->
mcsGroup
,

2946 
pCuTxRe
->
upMcs3
,

2947 
pEry
->
TxQuy
[
pCuTxRe
->
upMcs3
],

2948 
pCuTxRe
->
upMcs2
,

2949 
pEry
->
TxQuy
[
pCuTxRe
->
upMcs2
],

2950 
pCuTxRe
->
upMcs1
,

2951 
pEry
->
TxQuy
[
pCuTxRe
->
upMcs1
]));

2953 i((
pEry
->
HTCaby
.
MCSS
[0] == 0xff) &&

2954 (
pEry
->
HTCaby
.
MCSS
[1] == 0xff) &&

2955 (
pAd
->
CommCfg
.
TxSm
 > 1) &&

2956 ((
pAd
->
CommCfg
.
TxSm
 =2|| (
pEry
->
HTCaby
.
MCSS
[2] == 0x0)))

2958 
pEry
->
mcsGroup
)

2961 
UpReIdx
 = 
pCuTxRe
->
upMcs2
;

2962 i(
pEry
->
TxQuy
[
UpReIdx
] >Ery->TxQuy[
pCuTxRe
->
upMcs1
] &&CuTxRe->upMcs1 !pCuTxRe->
ImNo
)

2963 
UpReIdx
 = 
pCuTxRe
->
upMcs1
;

2967 
UpReIdx
 = 
pCuTxRe
->
upMcs2
;

2971 
UpReIdx
 = 
pCuTxRe
->
upMcs1
;

2975 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, ("wrg mcsGrouvu%d\n", 
pEry
->
mcsGroup
));

2979 i((
pEry
->
mcsGroup
 == 0) &&

2980 (
pEry
->
TxQuy
[
pCuTxRe
->
upMcs2
] >Ery->TxQuy[pCuTxRe->
upMcs1
]) &&

2981 (
pCuTxRe
->
upMcs1
 !pCuTxRe->
ImNo
))

2983 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("DRS: Before- mcsGroup=%d, TxQuality1[%d]=%d, TxQuality0[%d]=%d\n",

2984 
pEry
->
mcsGroup
,

2985 
pCuTxRe
->
upMcs2
,

2986 
pEry
->
TxQuy
[
pCuTxRe
->
upMcs2
],

2987 
pCuTxRe
->
upMcs1
,

2988 
pEry
->
TxQuy
[
pCuTxRe
->
upMcs1
]));

2993 
pEry
->
mcsGroup
)

2997 
UpReIdx
 = 
pCuTxRe
->
upMcs1
;

3001 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, ("wrg mcsGrouvu%d\n", 
pEry
->
mcsGroup
));

3006 i(
UpReIdx
 =
pEry
->
CuTxReIndex
)

3008 
pEry
->
mcsGroup
 = 0;

3012 i((
pEry
->
TxQuy
[
UpReIdx
] > 0&& (pEry->
mcsGroup
 > 0))

3014 
pEry
->
mcsGroup
 --;

3022 
DownReIdx
 = 
pCuTxRe
->
downMcs
;

3024 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH_3S
&
pTab
[(
CuReIdx
+1)*10];

3027 i(
pAd
->
CommCfg
.
DebugFgs
 & 
DBF_LOW_RA_THRESHOLDS
)

3029 
TUp
 = 2;

3030 
TDown
 = 10;

3033 #ifde
DOT11_N_SUPPORT


3034 i((
Rssi
 > -65&& (
pCuTxRe
->
Mode
 >
MODE_HTMIX
&& 
pEry
->
rThrdAdj
 == 1)

3036 
TUp
 = (
pCuTxRe
->TrainUp + (pCurrTxRate->TrainUp >> 1));

3037 
TDown
 = (
pCuTxRe
->TrainDown + (pCurrTxRate->TrainDown >> 1));

3042 
TUp
 = 
pCuTxRe
->TrainUp;

3043 
TDown
 = 
pCuTxRe
->TrainDown;

3051 
pEry
->
LaTimeTxReChgeAi
 =Ery->
LaSecTxReChgeAi
;

3053 #ifde
RELASE_EXCLUDE


3054 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("DRS: TxSuccess=%lu, TxRetransmit=%lu, TxFailCount=%lu, TxErrorRatio=%lu\n",

3055 
TxSucss
, 
TxRnsm
, 
TxFaCou
, 
TxERio
));

3057 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("DRS: Before- CurrTxRateIdx=%d, MCS=%d, STBC=%d, ShortGI=%d, Mode=%d, TrainUp=%d, TrainDown=%d, NextUp=%d, NextDown=%d, CurrMCS=%d, mcsGroup=%d, PER=%lu%%, Retry=%lu, NoRetry=%lu\n",

3058 
CuReIdx
,

3059 
pCuTxRe
->
CuMCS
,

3060 
pCuTxRe
->
STBC
,

3061 
pCuTxRe
->
ShtGI
,

3062 
pCuTxRe
->
Mode
,

3063 
TUp
,

3064 
TDown
,

3065 
UpReIdx
,

3066 
DownReIdx
,

3067 
pEry
->
HTPhyMode
.
fld
.
MCS
,

3068 
pEry
->
mcsGroup
,

3069 
TxERio
,

3070 
TxRnsm
,

3071 
TxSucss
));

3074 i(
pEry
->
fLaChgeAccdgMfb
 =
TRUE
)

3076 
pEry
->
fLaChgeAccdgMfb
 = 
FALSE
;

3077 
pEry
->
LaSecTxReChgeAi
 = 0;

3078 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("DRS: MCS isccordingo MFB,nd ignoreuninghis sec \n"));

3081 
	`RESET_ONE_SEC_TX_CNT
(
pEry
);

3090 i(
TxTٮC
 <= 15)

3092 
CHAR
 
idx
 = 0;

3093 
UCHAR
 
TxReIdx
;

3095 
UCHAR
 
MCS0
 = 0, 
MCS1
 = 0, 
MCS2
 = 0, 
MCS3
 = 0, 
MCS4
 = 0, 
MCS5
 =0, 
MCS6
 = 0, 
MCS7
 = 0;

3096 
UCHAR
 
MCS8
 = 0, 
MCS9
 = 0, 
MCS10
 = 0, 
MCS11
 = 0;

3097 
UCHAR
 
MCS12
 = 0, 
MCS13
 = 0, 
MCS14
 = 0, 
MCS15
 = 0;

3098 
UCHAR
 
MCS16
 = 0, 
MCS17
 = 0, 
MCS18
 = 0, 
MCS19
 = 0;

3099 
UCHAR
 
MCS20
 = 0, 
MCS21
 = 0, 
MCS22
 = 0, 
MCS23
 = 0;

3102 
idx
 < 
pTab
[0])

3104 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH_3S
&
pTab
[(
idx
+1)*10];

3106 i(
pCuTxRe
->
CuMCS
 =
MCS_0
)

3108 
MCS0
 = 
idx
;

3110 i(
pCuTxRe
->
CuMCS
 =
MCS_1
)

3112 
MCS1
 = 
idx
;

3114 i(
pCuTxRe
->
CuMCS
 =
MCS_2
)

3116 
MCS2
 = 
idx
;

3118 i(
pCuTxRe
->
CuMCS
 =
MCS_3
)

3120 
MCS3
 = 
idx
;

3122 i(
pCuTxRe
->
CuMCS
 =
MCS_4
)

3124 
MCS4
 = 
idx
;

3126 i(
pCuTxRe
->
CuMCS
 =
MCS_5
)

3128 
MCS5
 = 
idx
;

3130 i(
pCuTxRe
->
CuMCS
 =
MCS_6
)

3132 
MCS6
 = 
idx
;

3134 i(
pCuTxRe
->
CuMCS
 =
MCS_7
)

3136 
MCS7
 = 
idx
;

3138 i(
pCuTxRe
->
CuMCS
 =
MCS_8
 && 
pAd
->
CommCfg
.
TxSm
 > 1)

3140 
MCS8
 = 
idx
;

3142 i(
pCuTxRe
->
CuMCS
 =
MCS_9
 && 
pAd
->
CommCfg
.
TxSm
 > 1)

3144 
MCS9
 = 
idx
;

3146 i(
pCuTxRe
->
CuMCS
 =
MCS_10
 && 
pAd
->
CommCfg
.
TxSm
 > 1)

3148 
MCS10
 = 
idx
;

3150 i(
pCuTxRe
->
CuMCS
 =
MCS_11
 && 
pAd
->
CommCfg
.
TxSm
 > 1)

3152 
MCS11
 = 
idx
;

3154 i(
pCuTxRe
->
CuMCS
 =
MCS_12
 && 
pAd
->
CommCfg
.
TxSm
 > 1)

3156 
MCS12
 = 
idx
;

3158 i(
pCuTxRe
->
CuMCS
 =
MCS_13
 && 
pAd
->
CommCfg
.
TxSm
 > 1)

3160 
MCS13
 = 
idx
;

3162 i(
pCuTxRe
->
CuMCS
 =
MCS_14
 && 
pAd
->
CommCfg
.
TxSm
 > 1)

3164 
MCS14
 = 
idx
;

3166 i(
pCuTxRe
->
CuMCS
 =
MCS_15
 && 
pAd
->
CommCfg
.
TxSm
 > 1)

3168 
MCS15
 = 
idx
;

3170 i(
pCuTxRe
->
CuMCS
 =
MCS_16
 && 
pAd
->
CommCfg
.
TxSm
 > 2)

3172 
MCS16
 = 
idx
;

3174 i(
pCuTxRe
->
CuMCS
 =
MCS_17
 && 
pAd
->
CommCfg
.
TxSm
 > 2)

3176 
MCS17
 = 
idx
;

3178 i(
pCuTxRe
->
CuMCS
 =
MCS_18
 && 
pAd
->
CommCfg
.
TxSm
 > 2)

3180 
MCS18
 = 
idx
;

3182 i(
pCuTxRe
->
CuMCS
 =
MCS_19
 && 
pAd
->
CommCfg
.
TxSm
 > 2)

3184 
MCS19
 = 
idx
;

3186 i(
pCuTxRe
->
CuMCS
 =
MCS_20
 && 
pAd
->
CommCfg
.
TxSm
 > 2)

3188 
MCS20
 = 
idx
;

3190 i(
pCuTxRe
->
CuMCS
 =
MCS_21
 && 
pAd
->
CommCfg
.
TxSm
 > 2)

3192 
MCS21
 = 
idx
;

3194 i(
pCuTxRe
->
CuMCS
 =
MCS_22
 && 
pAd
->
CommCfg
.
TxSm
 > 2)

3196 
MCS22
 = 
idx
;

3198 i((
pCuTxRe
->
CuMCS
 =
MCS_23
&& (
pAd
->
CommCfg
.
TxSm
 > 2&& (pCuTxRe->
ShtGI
 =
GI_800
))

3200 
MCS23
 = 
idx
;

3203 
idx
 ++;

3206 i(
pAd
->
LchRfRegs
.
Chl
 <= 14)

3208 i(
pAd
->
NicCfig2
.
fld
.
ExLNAFG
)

3210 
RssiOfft
 = 2;

3212 i(
pTab
 =
ReSwchTab11N3S
)

3214 
RssiOfft
 = 0;

3218 
RssiOfft
 = 5;

3223 i(
pAd
->
NicCfig2
.
fld
.
ExLNAFA
)

3225 
RssiOfft
 = 5;

3227 i(
pTab
 =
ReSwchTab11N3S
)

3229 
RssiOfft
 = 2;

3233 
RssiOfft
 = 8;

3238 i(
pAd
->
CommCfg
.
DebugFgs
 & 
DBF_INIT_MCS_MARGIN
)

3239 
RssiOfft
 += 6;

3242 i(
pAd
->
CommCfg
.
DebugFgs
 & 
DBF_INIT_MCS_DIS1
)

3243 
MCS23
 = 
MCS15
 = 
MCS7
 = 0;

3244 i(
pAd
->
CommCfg
.
DebugFgs
 & 
DBF_INIT_MCS_DIS2
)

3245 
MCS22
 = 
MCS14
 = 
MCS6
 = 0;

3248 i(
phyReLim20
 != 0)

3250 
MCS13
 = 
MCS14
 = 
MCS15
 = 
MCS20
 = 
MCS21
 = 
MCS22
 = 
MCS23
 = 0;

3252 i(
phyReLim20
 <= 65)

3253 
MCS7
 = 
MCS12
 = 
MCS19
 = 0;

3255 i(
phyReLim20
 <= 40)

3256 
MCS5
 = 
MCS6
 = 
MCS11
 = 
MCS18
 = 0;

3258 i(
phyReLim20
 <= 20)

3259 
MCS3
 = 
MCS4
 = 
MCS9
 = 
MCS10
 = 
MCS17
 = 0;

3262 #ifde
DOT11_N_SUPPORT


3264 i((
pTab
 =
ReSwchTab11BGN3S
) ||

3265 (
pTab
 =
ReSwchTab11BGN3SFABd
) ||

3266 (
pTab
 =
ReSwchTab11N3S
))

3269 i(
MCS23
 && (
Rssi
 >(-64+
RssiOfft
)))

3270 
TxReIdx
 = 
MCS23
;

3271 i(
MCS22
 && (
Rssi
 >(-66+
RssiOfft
)))

3272 
TxReIdx
 = 
MCS22
;

3273 i(
MCS21
 && (
Rssi
 >(-68+
RssiOfft
)))

3274 
TxReIdx
 = 
MCS21
;

3275 i(
MCS15
 && (
Rssi
 >(-70+
RssiOfft
)))

3276 
TxReIdx
 = 
MCS15
;

3277 i(
MCS14
 && (
Rssi
 >(-72+
RssiOfft
)))

3278 
TxReIdx
 = 
MCS14
;

3279 i(
MCS13
 && (
Rssi
 >(-76+
RssiOfft
)))

3280 
TxReIdx
 = 
MCS13
;

3281 i(
MCS12
 && (
Rssi
 >(-78+
RssiOfft
)))

3282 
TxReIdx
 = 
MCS12
;

3283 i(
MCS4
 && (
Rssi
 >(-82+
RssiOfft
)))

3284 
TxReIdx
 = 
MCS4
;

3285 i(
MCS3
 && (
Rssi
 >(-84+
RssiOfft
)))

3286 
TxReIdx
 = 
MCS3
;

3287 i(
MCS2
 && (
Rssi
 >(-86+
RssiOfft
)))

3288 
TxReIdx
 = 
MCS2
;

3289 i(
MCS1
 && (
Rssi
 >(-88+
RssiOfft
)))

3290 
TxReIdx
 = 
MCS1
;

3292 
TxReIdx
 = 
MCS0
;

3295 i((
pTab
 =
ReSwchTab11BGN2S
) ||

3296 (
pTab
 =
ReSwchTab11BGN2SFABd
) ||

3297 (
pTab
 =
ReSwchTab11N2S
) ||

3298 (
pTab
 =
ReSwchTab11N2SFABd
))

3300 i(
MCS15
 && (
Rssi
 >(-70+
RssiOfft
)))

3301 
TxReIdx
 = 
MCS15
;

3302 i(
MCS14
 && (
Rssi
 >(-72+
RssiOfft
)))

3303 
TxReIdx
 = 
MCS14
;

3304 i(
MCS13
 && (
Rssi
 >(-76+
RssiOfft
)))

3305 
TxReIdx
 = 
MCS13
;

3306 i(
MCS12
 && (
Rssi
 >(-78+
RssiOfft
)))

3307 
TxReIdx
 = 
MCS12
;

3308 i(
MCS4
 && (
Rssi
 >(-82+
RssiOfft
)))

3309 
TxReIdx
 = 
MCS4
;

3310 i(
MCS3
 && (
Rssi
 >(-84+
RssiOfft
)))

3311 
TxReIdx
 = 
MCS3
;

3312 i(
MCS2
 && (
Rssi
 >(-86+
RssiOfft
)))

3313 
TxReIdx
 = 
MCS2
;

3314 i(
MCS1
 && (
Rssi
 >(-88+
RssiOfft
)))

3315 
TxReIdx
 = 
MCS1
;

3317 
TxReIdx
 = 
MCS0
;

3319 i((
pTab
 =
ReSwchTab11BGN1S
|| (pTab =
ReSwchTab11N1S
))

3321 i(
MCS7
 && (
Rssi
 > (-72+
RssiOfft
)))

3322 
TxReIdx
 = 
MCS7
;

3323 i(
MCS6
 && (
Rssi
 > (-74+
RssiOfft
)))

3324 
TxReIdx
 = 
MCS6
;

3325 i(
MCS5
 && (
Rssi
 > (-77+
RssiOfft
)))

3326 
TxReIdx
 = 
MCS5
;

3327 i(
MCS4
 && (
Rssi
 > (-79+
RssiOfft
)))

3328 
TxReIdx
 = 
MCS4
;

3329 i(
MCS3
 && (
Rssi
 > (-81+
RssiOfft
)))

3330 
TxReIdx
 = 
MCS3
;

3331 i(
MCS2
 && (
Rssi
 > (-83+
RssiOfft
)))

3332 
TxReIdx
 = 
MCS2
;

3333 i(
MCS1
 && (
Rssi
 > (-86+
RssiOfft
)))

3334 
TxReIdx
 = 
MCS1
;

3336 
TxReIdx
 = 
MCS0
;

3338 i(
pTab
 =
ReSwchTab11N3S
)

3340 i((
pEry
->
HTCaby
.
MCSS
[2] =0xff&& (
pAd
->
CommCfg
.
TxSm
 == 3))

3342 i(
MCS23
 && (
Rssi
 > (-72+
RssiOfft
)))

3343 
TxReIdx
 = 
MCS23
;

3344 i(
MCS22
 && (
Rssi
 > (-74+
RssiOfft
)))

3345 
TxReIdx
 = 
MCS22
;

3346 i(
MCS21
 && (
Rssi
 > (-77+
RssiOfft
)))

3347 
TxReIdx
 = 
MCS21
;

3348 i(
MCS20
 && (
Rssi
 > (-79+
RssiOfft
)))

3349 
TxReIdx
 = 
MCS20
;

3350 i(
MCS19
 && (
Rssi
 > (-81+
RssiOfft
)))

3351 
TxReIdx
 = 
MCS19
;

3352 i(
MCS18
 && (
Rssi
 > (-83+
RssiOfft
)))

3353 
TxReIdx
 = 
MCS18
;

3354 i(
MCS17
 && (
Rssi
 > (-86+
RssiOfft
)))

3355 
TxReIdx
 = 
MCS17
;

3357 
TxReIdx
 = 
MCS16
;

3359 
pEry
->
mcsGroup
 = 3;

3361 i((
pEry
->
HTCaby
.
MCSS
[0] == 0xff) &&

3362 (
pEry
->
HTCaby
.
MCSS
[1] == 0xff) &&

3363 (
pAd
->
CommCfg
.
TxSm
 > 1) &&

3364 ((
pAd
->
CommCfg
.
TxSm
 =2|| (
pEry
->
HTCaby
.
MCSS
[2] == 0x0)))

3366 i(
MCS15
 && (
Rssi
 > (-72+
RssiOfft
)))

3367 
TxReIdx
 = 
MCS15
;

3368 i(
MCS14
 && (
Rssi
 > (-74+
RssiOfft
)))

3369 
TxReIdx
 = 
MCS14
;

3370 i(
MCS13
 && (
Rssi
 > (-77+
RssiOfft
)))

3371 
TxReIdx
 = 
MCS13
;

3372 i(
MCS12
 && (
Rssi
 > (-79+
RssiOfft
)))

3373 
TxReIdx
 = 
MCS12
;

3374 i(
MCS11
 && (
Rssi
 > (-81+
RssiOfft
)))

3375 
TxReIdx
 = 
MCS11
;

3376 i(
MCS10
 && (
Rssi
 > (-83+
RssiOfft
)))

3377 
TxReIdx
 = 
MCS10
;

3378 i(
MCS9
 && (
Rssi
 > (-86+
RssiOfft
)))

3379 
TxReIdx
 = 
MCS9
;

3381 
TxReIdx
 = 
MCS8
;

3383 
pEry
->
mcsGroup
 = 2;

3387 i(
MCS7
 && (
Rssi
 > (-72+
RssiOfft
)))

3388 
TxReIdx
 = 
MCS7
;

3389 i(
MCS6
 && (
Rssi
 > (-74+
RssiOfft
)))

3390 
TxReIdx
 = 
MCS6
;

3391 i(
MCS5
 && (
Rssi
 > (-77+
RssiOfft
)))

3392 
TxReIdx
 = 
MCS5
;

3393 i(
MCS4
 && (
Rssi
 > (-79+
RssiOfft
)))

3394 
TxReIdx
 = 
MCS4
;

3395 i(
MCS3
 && (
Rssi
 > (-81+
RssiOfft
)))

3396 
TxReIdx
 = 
MCS3
;

3397 i(
MCS2
 && (
Rssi
 > (-83+
RssiOfft
)))

3398 
TxReIdx
 = 
MCS2
;

3399 i(
MCS1
 && (
Rssi
 > (-86+
RssiOfft
)))

3400 
TxReIdx
 = 
MCS1
;

3402 
TxReIdx
 = 
MCS0
;

3404 
pEry
->
mcsGroup
 = 1;

3410 i(
MCS7
 && (
Rssi
 > -70))

3411 
TxReIdx
 = 
MCS7
;

3412 i(
MCS6
 && (
Rssi
 > -74))

3413 
TxReIdx
 = 
MCS6
;

3414 i(
MCS5
 && (
Rssi
 > -78))

3415 
TxReIdx
 = 
MCS5
;

3416 i(
MCS4
 && (
Rssi
 > -82))

3417 
TxReIdx
 = 
MCS4
;

3418 i(
MCS4
 == 0)

3419 
TxReIdx
 = 
MCS3
;

3420 i(
MCS3
 && (
Rssi
 > -85))

3421 
TxReIdx
 = 
MCS3
;

3422 i(
MCS2
 && (
Rssi
 > -87))

3423 
TxReIdx
 = 
MCS2
;

3424 i(
MCS1
 && (
Rssi
 > -90))

3425 
TxReIdx
 = 
MCS1
;

3427 
TxReIdx
 = 
MCS0
;

3430 (
pEry
->
wPktsC
) ++;

3431 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("f-s%d\n", 
pEry
->
wPktsC
));

3433 i(
pEry
->
wPktsC
 =
FEW_PKTS_CNT_THRD
)

3435 
pEry
->
wPktsC
 = 0;

3438 
pEry
->
ϡReIdx
 =Ery->
CuTxReIndex
;

3440 i((
pEry
->
HTCaby
.
MCSS
[2] =0xff&& (
pAd
->
CommCfg
.
TxSm
 == 3))

3441 
pEry
->
mcsGroup
 = 3;

3442 i((
pEry
->
HTCaby
.
MCSS
[0] == 0xff) &&

3443 (
pEry
->
HTCaby
.
MCSS
[1] == 0xff) &&

3444 (
pAd
->
CommCfg
.
TxSm
 > 1) &&

3445 (
pAd
->
CommCfg
.
TxSm
 =2 || 
pEry
->
HTCaby
.
MCSS
[2] == 0x0))

3446 
pEry
->
mcsGroup
 = 2;

3448 
pEry
->
mcsGroup
 = 1;

3450 
pEry
->
CuTxReIndex
 = 
TxReIdx
;

3451 
pNextTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
pEry
->
CuTxReIndex
+1)*10];

3453 
	`MlmeSTxRe
(
pAd
, 
pEry
, 
pNextTxRe
);

3454 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("c-s%d\n", 
pNextTxRe
->
CuMCS
));

3457 
	`NdisZoMemy
(
pEry
->
TxQuy
, (
USHORT
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

3458 
	`NdisZoMemy
(
pEry
->
PER
, (
UCHAR
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

3459 
pEry
->
fLaSecAccdgRSSI
 = 
TRUE
;

3460 #ifde
RELASE_EXCLUDE


3461 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("DRS: AccuTxTٮC <15, swch TxReIndex(%daccdgRSSI(%d), RssiOfft=%d\n", 
pEry
->
CuTxReIndex
, 
Rssi
, 
RssiOfft
));

3466 
	`RESET_ONE_SEC_TX_CNT
(
pEry
);

3471 
pEry
->
wPktsC
 = 0;

3472 i(
pEry
->
fLaSecAccdgRSSI
 =
TRUE
)

3474 
pEry
->
fLaSecAccdgRSSI
 = 
FALSE
;

3475 
pEry
->
LaSecTxReChgeAi
 = 0;

3476 #ifde
RELASE_EXCLUDE


3477 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("DRS: MCS isccordingo RSSI,nd ignoreuninghis sec \n"));

3481 
	`RESET_ONE_SEC_TX_CNT
(
pEry
);

3483 
pNextTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
pEry
->
CuTxReIndex
+1)*10];

3484 #ifde
TXBF_SUPPORT


3485 
	`aETxBFProbg
(
pAd
, 
pEry
, 
pNextTxRe
);

3492 
BOOLEAN
 
bTUpDown
 = 
FALSE
;

3494 
pEry
->
CuTxReSbTime
 ++;

3497 i(
TxERio
 >
TDown
 ||

3498 (
phyReLim20
!=0 && 
pCuTxRe
->
daRe
>=phyRateLimit20) )

3500 
bTUpDown
 = 
TRUE
;

3501 
pEry
->
TxQuy
[
CuReIdx
] = 
DRS_TX_QUALITY_WORST_BOUND
;

3504 i(
TxERio
 <
TUp
)

3506 
bTUpDown
 = 
TRUE
;

3507 
bUpgdeQuy
 = 
TRUE
;

3509 i(
pEry
->
TxQuy
[
CuReIdx
])

3510 
pEry
->
TxQuy
[
CuReIdx
] --;

3512 i(
pEry
->
TxReUpPty
)

3513 
pEry
->
TxReUpPty
 --;

3516 i(
pEry
->
TxQuy
[
pCuTxRe
->
upMcs3
] &&CuTxRe->upMcs3 !
CuReIdx
)

3517 
pEry
->
TxQuy
[
pCuTxRe
->
upMcs3
] --;

3519 i(
pEry
->
TxQuy
[
pCuTxRe
->
upMcs2
] &&CuTxRe->upMcs2 !
CuReIdx
)

3520 
pEry
->
TxQuy
[
pCuTxRe
->
upMcs2
] --;

3522 i(
pEry
->
TxQuy
[
pCuTxRe
->
upMcs1
] &&CuTxRe->upMcs1 !
CuReIdx
)

3523 
pEry
->
TxQuy
[
pCuTxRe
->
upMcs1
] --;

3529 i(
pEry
->
mcsGroup
 > 0)

3531 i(
UpReIdx
 != 0)

3533 
bTUpDown
 = 
TRUE
;

3535 i(
pEry
->
TxQuy
[
CuReIdx
])

3536 
pEry
->
TxQuy
[
CuReIdx
] --;

3542 i(
pEry
->
TxQuy
[
UpReIdx
])

3543 
pEry
->
TxQuy
[
UpReIdx
] --;

3547 
pEry
->
PER
[
CuReIdx
] = (
UCHAR
)
TxERio
;

3549 i(
bTUpDown
)

3551 
PRTMP_TX_RATE_SWITCH_3S
 
pUpReIdx
 = (PRTMP_TX_RATE_SWITCH_3S&
pTab
[(
UpReIdx
+1)*10];

3554 i((
CuReIdx
 !
DownReIdx
&& (
pEry
->
TxQuy
[CuReIdx] >
DRS_TX_QUALITY_WORST_BOUND
))

3556 
pEry
->
CuTxReIndex
 = 
DownReIdx
;

3557 
pEry
->
LaSecTxReChgeAi
 = 2;

3559 i((
CuReIdx
 !
UpReIdx
) &&

3560 (
pEry
->
TxQuy
[
UpReIdx
] <= 0) &&

3561 (
phyReLim20
==0 || 
pUpReIdx
->
daRe
<phyRateLimit20))

3563 
pEry
->
CuTxReIndex
 = 
UpReIdx
;

3564 
pEry
->
LaSecTxReChgeAi
 = 1;

3567 } 
FALSE
);

3571 i(
pEry
->
CuTxReIndex
 !
CuReIdx
 &&Ery->
LaSecTxReChgeAi
 == 1)

3573 #ifde
RELASE_EXCLUDE


3574 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("DRS: ++TXom %d%d \n", 
CuReIdx
, 
pEry
->
CuTxReIndex
));

3576 
pEry
->
CuTxReSbTime
 = 0;

3577 
pEry
->
TxReUpPty
 = 0;

3578 
pEry
->
LaSecTxReChgeAi
 = 1;

3580 
pNextTxReIdx
 = (
PRTMP_TX_RATE_SWITCH_3S
&
pTab
[(
pEry
->
CuTxReIndex
+1)*10];

3581 
	`NdisZoMemy
(
pEry
->
PER
, (
UCHAR
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

3582 
pEry
->
ϡReIdx
 = 
CuReIdx
;

3587 i(!
pAd
->
SCfg
.
SQuickReeFReUpTimRug
)

3589 
	`RTMPSTim
(&
pAd
->
SCfg
.
SQuickReeFReUpTim
, 100);

3591 
pAd
->
SCfg
.
SQuickReeFReUpTimRug
 = 
TRUE
;

3594 
bTxReChged
 = 
TRUE
;

3598 i(
pEry
->
CuTxReIndex
 !
CuReIdx
 &&Ery->
LaSecTxReChgeAi
 == 2)

3600 #ifde
RELASE_EXCLUDE


3601 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("DRS: --TXom %d%d \n", 
CuReIdx
, 
pEry
->
CuTxReIndex
));

3603 
pEry
->
CuTxReSbTime
 = 0;

3604 
pEry
->
TxReUpPty
 = 0;

3605 
pEry
->
LaSecTxReChgeAi
 = 2;

3606 
pEry
->
TxQuy
[pEry->
CuTxReIndex
] = 0;

3607 
pEry
->
PER
[pEry->
CuTxReIndex
] = 0;

3608 
pEry
->
ϡReIdx
 = 
CuReIdx
;

3613 i(!
pAd
->
SCfg
.
SQuickReeFReUpTimRug
)

3615 
	`RTMPSTim
(&
pAd
->
SCfg
.
SQuickReeFReUpTim
, 100);

3617 
pAd
->
SCfg
.
SQuickReeFReUpTimRug
 = 
TRUE
;

3619 
bTxReChged
 = 
TRUE
;

3623 
pEry
->
LaSecTxReChgeAi
 = 0;

3624 
bTxReChged
 = 
FALSE
;

3627 
pEry
->
LaTxOkCou
 = 
TxSucss
;

3629 
tmpTxRe
 = 
pEry
->
CuTxReIndex
;

3632 i(((
pTab
 =
ReSwchTab11BGN3S
|| (pTab =
ReSwchTab11BGN3SFABd
|| (pTab =
ReSwchTab11N3S
)) &&

3633 
pAd
->
RkCous
.
OSecReivedByCou
 > 50000 &&

3634 
pAd
->
RkCous
.
OSecTnsmdByCou
 > 50000 &&

3635 
	`CLIENT_STATUS_TEST_FLAG
(
pEry
, 
fCLIENT_STATUS_RDG_CAPABLE
))

3637 
TX_LINK_CFG_STRUC
 
TxLkCfg
;

3638 
ULONG
 
TxOpThs
;

3640 
pTempTxRe
 = (
PRTMP_TX_RATE_SWITCH
)(&
pTab
[(
tmpTxRe
 + 1)*10]);

3641 
	`RTMP_IO_READ32
(
pAd
, 
TX_LINK_CFG
, &
TxLkCfg
.
wd
);

3643 i((
pAd
->
RkCous
.
OSecReivedByCou
 > (pAd->RkCous.
OSecTnsmdByCou
 * 5)) &&

3644 (
pTempTxRe
->
CuMCS
 != 23))

3646 
	`DBGPRINT_RAW
(
RT_DEBUG_WARN
,("DRS: Rx(%d) > 5*Tx(%d)\n",

3647 
pAd
->
RkCous
.
OSecReivedByCou
,Ad->RkCous.
OSecTnsmdByCou
));

3649 i(
TxLkCfg
.
fld
.
TxRDGEn
 == 1)

3651 
TxLkCfg
.
fld
.
TxRDGEn
 = 0;

3652 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_LINK_CFG
, 
TxLkCfg
.
wd
);

3653 
	`RTMP_IO_READ32
(
pAd
, 
TXOP_THRES_CFG
, &
TxOpThs
);

3654 
TxOpThs
 |= 0xff00;

3655 
	`RTMP_IO_WRITE32
(
pAd
, 
TXOP_THRES_CFG
, 
TxOpThs
);

3656 
	`DBGPRINT_RAW
(
RT_DEBUG_WARN
,("DRS: RDG off!\n"));

3661 
	`DBGPRINT_RAW
(
RT_DEBUG_WARN
,("DRS: Rx(%d) <= 5*Tx(%d)\n",

3662 
pAd
->
RkCous
.
OSecReivedByCou
,Ad->RkCous.
OSecTnsmdByCou
));

3664 i(
TxLkCfg
.
fld
.
TxRDGEn
 == 0)

3666 
TxLkCfg
.
fld
.
TxRDGEn
 = 1;

3667 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_LINK_CFG
, 
TxLkCfg
.
wd
);

3668 
	`RTMP_IO_READ32
(
pAd
, 
TXOP_THRES_CFG
, &
TxOpThs
);

3669 
TxOpThs
 &= 0xffff00ff;

3670 
	`RTMP_IO_WRITE32
(
pAd
, 
TXOP_THRES_CFG
, 
TxOpThs
);

3671 
	`DBGPRINT_RAW
(
RT_DEBUG_WARN
,("DRS: RDG on!\n"));

3676 
pNextTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
tmpTxRe
+1)*10];

3677 i(
bTxReChged
 && 
pNextTxRe
)

3679 
	`MlmeSTxRe
(
pAd
, 
pEry
, 
pNextTxRe
);

3680 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("--s%d\n", 
pNextTxRe
->
CuMCS
));

3684 
	`RESET_ONE_SEC_TX_CNT
(
pEry
);

3685 
	}
}

3704 
VOID
 
	$SQuickReeFReUpExec
(

3705 
IN
 
PVOID
 
SyemScific1
,

3706 
IN
 
PVOID
 
FuniCڋxt
,

3707 
IN
 
PVOID
 
SyemScific2
,

3708 
IN
 
PVOID
 
SyemScific3
)

3710 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
FuniCڋxt
;

3711 
UCHAR
 
UpReIdx
 = 0, 
DownReIdx
 = 0, 
CuReIdx
 = 0;

3712 
ULONG
 
TxTٮC
 = 0;

3713 
ULONG
 
TxERio
 = 0;

3714 
BOOLEAN
 
bTxReChged
;

3715 
PRTMP_TX_RATE_SWITCH
 
pCuTxRe
, 
pNextTxRe
 = 
NULL
;

3716 
PUCHAR
 
pTab
;

3717 
UCHAR
 
TabSize
 = 0;

3718 
UCHAR
 
InTxReIdx
 = 0, 
TUp
, 
TDown
;

3719 
TX_STA_CNT1_STRUC
 
STx1
;

3720 
TX_STA_CNT0_STRUC
 
TxSC0
;

3721 
CHAR
 
Rssi
, 
tio
;

3722 
ULONG
 
TxRnsm
 = 0, 
TxSucss
 = 0, 
TxFaCou
 = 0;

3723 
MAC_TABLE_ENTRY
 *
pEry
;

3724 
ULONG
 
i
;

3726 
pAd
->
SCfg
.
SQuickReeFReUpTimRug
 = 
FALSE
;

3731 
i
 = 1; i < 
MAX_LEN_OF_MAC_TABLE
; i++)

3733 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
i
];

3736 i(
	`RTMPCheckEryEbAutoReSwch
(
pAd
, 
pEry
=
FALSE
)

3739 i(
	`INFRA_ON
(
pAd
&& (
i
 == 1))

3740 
Rssi
 = 
	`RTMPMaxRssi
(
pAd
,

3741 
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
,

3742 
pAd
->
SCfg
.
RssiSame
.
AvgRssi1
,

3743 
pAd
->
SCfg
.
RssiSame
.
AvgRssi2
);

3745 
Rssi
 = 
	`RTMPMaxRssi
(
pAd
,

3746 
pEry
->
RssiSame
.
AvgRssi0
,

3747 
pEry
->
RssiSame
.
AvgRssi1
,

3748 
pEry
->
RssiSame
.
AvgRssi2
);

3750 
CuReIdx
 = 
pAd
->
CommCfg
.
TxReIndex
;

3752 
	`MlmeSeTxReTab
(
pAd
, 
pEry
, &
pTab
, &
TabSize
, &
InTxReIdx
);

3755 i((
CuReIdx
 > 0&& (CuReIdx < (
TabSize
 - 1)))

3757 
UpReIdx
 = 
CuReIdx
 + 1;

3758 
DownReIdx
 = 
CuReIdx
 -1;

3760 i(
CuReIdx
 == 0)

3762 
UpReIdx
 = 
CuReIdx
 + 1;

3763 
DownReIdx
 = 
CuReIdx
;

3765 i(
CuReIdx
 =(
TabSize
 - 1))

3767 
UpReIdx
 = 
CuReIdx
;

3768 
DownReIdx
 = 
CuReIdx
 - 1;

3771 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
CuReIdx
+1)*5];

3773 #ifde
DOT11_N_SUPPORT


3774 i((
Rssi
 > -65&& (
pCuTxRe
->
Mode
 >
MODE_HTMIX
))

3776 
TUp
 = (
pCuTxRe
->TrainUp + (pCurrTxRate->TrainUp >> 1));

3777 
TDown
 = (
pCuTxRe
->TrainDown + (pCurrTxRate->TrainDown >> 1));

3782 
TUp
 = 
pCuTxRe
->TrainUp;

3783 
TDown
 = 
pCuTxRe
->TrainDown;

3786 i(
pAd
->
MacTab
.
Size
 == 1)

3789 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT0
, &
TxSC0
.
wd
);

3790 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT1
, &
STx1
.
wd
);

3792 
TxRnsm
 = 
STx1
.
fld
.TxRetransmit;

3793 
TxSucss
 = 
STx1
.
fld
.TxSuccess;

3794 
TxFaCou
 = 
TxSC0
.
fld
.TxFailCount;

3795 
TxTٮC
 = 
TxRnsm
 + 
TxSucss
 + 
TxFaCou
;

3797 
pAd
->
RkCous
.
OSecTxRryOkCou
 +
STx1
.
fld
.
TxRnsm
;

3798 
pAd
->
RkCous
.
OSecTxNoRryOkCou
 +
STx1
.
fld
.
TxSucss
;

3799 
pAd
->
RkCous
.
OSecTxFaCou
 +
TxSC0
.
fld
.
TxFaCou
;

3801 #ifde
STATS_COUNT_SUPPORT


3802 
pAd
->
WnCous
.
TnsmdFgmtCou
.
u
.
LowPt
 +
STx1
.
fld
.
TxSucss
;

3803 
pAd
->
WnCous
.
RryCou
.
u
.
LowPt
 +
STx1
.
fld
.
TxRnsm
;

3804 
pAd
->
WnCous
.
FaedCou
.
u
.
LowPt
 +
TxSC0
.
fld
.
TxFaCou
;

3807 i(
TxTٮC
)

3808 
TxERio
 = ((
TxRnsm
 + 
TxFaCou
* 100/ 
TxTٮC
;

3812 
TxTٮC
 = 
pEry
->
OSecTxNoRryOkCou
 +

3813 
pEry
->
OSecTxRryOkCou
 +

3814 
pEry
->
OSecTxFaCou
;

3816 i(
TxTٮC
)

3817 
TxERio
 = ((
pEry
->
OSecTxRryOkCou
 +Ery->
OSecTxFaCou
* 100/ 
TxTٮC
;

3825 i(
TxTٮC
 <= 12)

3827 
	`NdisZoMemy
(
pAd
->
DrsCous
.
TxQuy
, (
USHORT
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

3828 
	`NdisZoMemy
(
pAd
->
DrsCous
.
PER
, (
UCHAR
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

3830 i((
pAd
->
DrsCous
.
LaSecTxReChgeAi
 =1&& (
CuReIdx
 !
DownReIdx
))

3832 
pAd
->
CommCfg
.
TxReIndex
 = 
DownReIdx
;

3833 
pAd
->
DrsCous
.
TxQuy
[
CuReIdx
] = 
DRS_TX_QUALITY_WORST_BOUND
;

3835 i((
pAd
->
DrsCous
.
LaSecTxReChgeAi
 =2&& (
CuReIdx
 !
UpReIdx
))

3837 
pAd
->
CommCfg
.
TxReIndex
 = 
UpReIdx
;

3840 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("QuickDRS: TxTotalCnt <= 15,rain backo originalate \n"));

3846 
ULONG
 
OSecTxNoRryOKRiCou
;

3848 i(
pAd
->
DrsCous
.
LaTimeTxReChgeAi
 == 0)

3849 
tio
 = 5;

3851 
tio
 = 4;

3854 i(
TxERio
 >
TDown
)

3856 
pAd
->
DrsCous
.
TxQuy
[
CuReIdx
] = 
DRS_TX_QUALITY_WORST_BOUND
;

3859 
pAd
->
DrsCous
.
PER
[
CuReIdx
] = (
UCHAR
)
TxERio
;

3861 
OSecTxNoRryOKRiCou
 = (
TxSucss
 * 
tio
);

3864 i((
pAd
->
DrsCous
.
LaSecTxReChgeAi
 =1&& (
CuReIdx
 !
DownReIdx
))

3866 i((
pAd
->
DrsCous
.
LaTxOkCou
 + 2>
OSecTxNoRryOKRiCou
)

3868 
pAd
->
CommCfg
.
TxReIndex
 = 
DownReIdx
;

3869 
pAd
->
DrsCous
.
TxQuy
[
CuReIdx
] = 
DRS_TX_QUALITY_WORST_BOUND
;

3874 i((
pAd
->
DrsCous
.
LaSecTxReChgeAi
 =2&& (
CuReIdx
 !
UpReIdx
))

3876 i((
TxERio
 >50|| (TxERi>
TDown
))

3880 i((
pAd
->
DrsCous
.
LaTxOkCou
 + 2>
OSecTxNoRryOKRiCou
)

3882 
pAd
->
CommCfg
.
TxReIndex
 = 
UpReIdx
;

3885 }
FALSE
);

3888 i(
pAd
->
CommCfg
.
TxReIndex
 > 
CuReIdx
)

3890 
pAd
->
DrsCous
.
TxReUpPty
 = 0;

3891 
	`NdisZoMemy
(
pAd
->
DrsCous
.
TxQuy
, (
USHORT
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

3892 
	`NdisZoMemy
(
pAd
->
DrsCous
.
PER
, (
UCHAR
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

3893 
bTxReChged
 = 
TRUE
;

3896 i(
pAd
->
CommCfg
.
TxReIndex
 < 
CuReIdx
)

3898 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("QuickDRS: --TXom %d%d \n", 
CuReIdx
, 
pAd
->
CommCfg
.
TxReIndex
));

3900 
pAd
->
DrsCous
.
TxReUpPty
 = 0;

3901 
pAd
->
DrsCous
.
TxQuy
[pAd->
CommCfg
.
TxReIndex
] = 0;

3902 
pAd
->
DrsCous
.
PER
[pAd->
CommCfg
.
TxReIndex
] = 0;

3903 
bTxReChged
 = 
TRUE
;

3907 
bTxReChged
 = 
FALSE
;

3910 
pNextTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
pAd
->
CommCfg
.
TxReIndex
+1)*5];

3911 i(
bTxReChged
 && 
pNextTxRe
)

3913 
	`MlmeSTxRe
(
pAd
, 
pEry
, 
pNextTxRe
);

3916 
	}
}

3918 #ifde
NEW_RATE_ADAPT_SUPPORT


3919 
VOID
 
	$SQuickReeFReUpExecAdt
(

3920 
IN
 
PRTMP_ADAPTER
 
pAd
,

3921 
IN
 
ULONG
 
i
)

3923 
UCHAR
 
UpReIdx
 = 0, 
DownReIdx
 = 0, 
CuReIdx
 = 0;

3924 
ULONG
 
TxTٮC
;

3925 
ULONG
 
TxERio
 = 0;

3926 
BOOLEAN
 
bTxReChged
 = 
TRUE
;

3927 
PRTMP_TX_RATE_SWITCH_3S
 
pCuTxRe
;

3928 
PRTMP_TX_RATE_SWITCH
 
pNextTxRe
 = 
NULL
;

3929 
PUCHAR
 
pTab
;

3930 
UCHAR
 
TabSize
 = 0;

3931 
UCHAR
 
InTxReIdx
 = 0, 
TUp
, 
TDown
;

3932 
TX_STA_CNT1_STRUC
 
STx1
;

3933 
TX_STA_CNT0_STRUC
 
TxSC0
;

3934 
CHAR
 
Rssi
, 
tio
;

3935 
ULONG
 
TxRnsm
 = 0, 
TxSucss
 = 0, 
TxFaCou
 = 0;

3936 
PMAC_TABLE_ENTRY
 
pEry
;

3938 
pAd
->
SCfg
.
SQuickReeFReUpTimRug
 = 
FALSE
;

3940 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
i
];

3942 
	`MlmeSeTxReTab
(
pAd
, 
pEry
, &
pTab
, &
TabSize
, &
InTxReIdx
);

3953 if(
pAd
->
A
.
fld
.
RxPh
 == 3)

3955 
Rssi
 = ((
CHAR
)
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
 + (CHARAd->SCfg.RssiSame.
AvgRssi1
 + (CHARAd->SCfg.RssiSame.
AvgRssi2
)/3;

3957 if(
pAd
->
A
.
fld
.
RxPh
 == 2)

3959 
Rssi
 = ((
CHAR
)
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
 + (CHARAd->SCfg.RssiSame.
AvgRssi1
)>>1;

3963 
Rssi
 = (
CHAR
)
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
;

3968 
pAd
->
CommCfg
.
TxReIndex
 = 
pEry
->
CuTxReIndex
;

3969 
CuReIdx
 = 
pAd
->
CommCfg
.
TxReIndex
;

3975 
UpReIdx
 = 
DownReIdx
 = 
pEry
->
ϡReIdx
;

3977 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH_3S
&
pTab
[(
CuReIdx
+1)*10];

3979 #ifde
DOT11_N_SUPPORT


3981 i((
Rssi
 > -65&& (
pCuTxRe
->
Mode
 >
MODE_HTMIX
&& 
pEry
->
rThrdAdj
 == 1)

3983 
TUp
 = (
pCuTxRe
->TrainUp + (pCurrTxRate->TrainUp >> 1));

3984 
TDown
 = (
pCuTxRe
->TrainDown + (pCurrTxRate->TrainDown >> 1));

3989 
TUp
 = 
pCuTxRe
->TrainUp;

3990 
TDown
 = 
pCuTxRe
->TrainDown;

3993 i(
pAd
->
MacTab
.
Size
 == 1)

3996 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT0
, &
TxSC0
.
wd
);

3997 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT1
, &
STx1
.
wd
);

3999 
TxRnsm
 = 
STx1
.
fld
.TxRetransmit;

4000 
TxSucss
 = 
STx1
.
fld
.TxSuccess;

4001 
TxFaCou
 = 
TxSC0
.
fld
.TxFailCount;

4002 
TxTٮC
 = 
TxRnsm
 + 
TxSucss
 + 
TxFaCou
;

4004 
pAd
->
RkCous
.
OSecTxRryOkCou
 +
STx1
.
fld
.
TxRnsm
;

4005 
pAd
->
RkCous
.
OSecTxNoRryOkCou
 +
STx1
.
fld
.
TxSucss
;

4006 
pAd
->
RkCous
.
OSecTxFaCou
 +
TxSC0
.
fld
.
TxFaCou
;

4007 
pAd
->
WnCous
.
TnsmdFgmtCou
.
u
.
LowPt
 +
STx1
.
fld
.
TxSucss
;

4008 
pAd
->
WnCous
.
RryCou
.
u
.
LowPt
 +
STx1
.
fld
.
TxRnsm
;

4009 
pAd
->
WnCous
.
FaedCou
.
u
.
LowPt
 +
TxSC0
.
fld
.
TxFaCou
;

4011 i(
TxTٮC
)

4012 
TxERio
 = ((
TxRnsm
 + 
TxFaCou
* 100/ 
TxTٮC
;

4016 
TxTٮC
 = 
pEry
->
OSecTxNoRryOkCou
 +

4017 
pEry
->
OSecTxRryOkCou
 +

4018 
pEry
->
OSecTxFaCou
;

4020 i(
TxTٮC
)

4021 
TxERio
 = ((
pEry
->
OSecTxRryOkCou
 +Ery->
OSecTxFaCou
* 100/ 
TxTٮC
;

4024 i(
pEry
->
fLaChgeAccdgMfb
 =
TRUE
)

4026 
pEry
->
fLaChgeAccdgMfb
 = 
FALSE
;

4027 
pEry
->
LaSecTxReChgeAi
 = 0;

4028 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("DRS: MCS isccordingo MFB,nd ignoreuninghis sec \n"));

4031 
	`RESET_ONE_SEC_TX_CNT
(
pEry
);

4040 i(
TxTٮC
 <= 12)

4042 
	`NdisZoMemy
(
pAd
->
DrsCous
.
TxQuy
, (
USHORT
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

4043 
	`NdisZoMemy
(
pAd
->
DrsCous
.
PER
, (
UCHAR
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

4045 i((
pAd
->
DrsCous
.
LaSecTxReChgeAi
 =1&& (
CuReIdx
 !
DownReIdx
))

4047 
pAd
->
CommCfg
.
TxReIndex
 = 
DownReIdx
;

4048 
pAd
->
DrsCous
.
TxQuy
[
CuReIdx
] = 
DRS_TX_QUALITY_WORST_BOUND
;

4050 i((
pAd
->
DrsCous
.
LaSecTxReChgeAi
 =2&& (
CuReIdx
 !
UpReIdx
))

4052 
pAd
->
CommCfg
.
TxReIndex
 = 
UpReIdx
;

4055 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("QuickDRS: TxTotalCnt <= 15,rain backo originalate \n"));

4061 
ULONG
 
OSecTxNoRryOKRiCou
;

4063 i(
pAd
->
DrsCous
.
LaTimeTxReChgeAi
 == 0)

4064 
tio
 = 5;

4066 
tio
 = 4;

4069 i(
TxERio
 >
TDown
)

4071 
pAd
->
DrsCous
.
TxQuy
[
CuReIdx
] = 
DRS_TX_QUALITY_WORST_BOUND
;

4074 
pAd
->
DrsCous
.
PER
[
CuReIdx
] = (
UCHAR
)
TxERio
;

4076 
OSecTxNoRryOKRiCou
 = (
TxSucss
 * 
tio
);

4079 i((
pAd
->
DrsCous
.
LaSecTxReChgeAi
 =1&& (
CuReIdx
 !
DownReIdx
))

4081 i((
pAd
->
DrsCous
.
LaTxOkCou
 + 2>
OSecTxNoRryOKRiCou
)

4083 
pAd
->
CommCfg
.
TxReIndex
 = 
DownReIdx
;

4084 
pAd
->
DrsCous
.
TxQuy
[
CuReIdx
] = 
DRS_TX_QUALITY_WORST_BOUND
;

4088 i((
pAd
->
DrsCous
.
LaSecTxReChgeAi
 =2&& (
CuReIdx
 !
UpReIdx
))

4090 i((
TxERio
 >50|| (TxERi>
TDown
))

4092 i((
pEry
->
HTCaby
.
MCSS
[2] =0xff&& (
pAd
->
CommCfg
.
TxSm
 == 3))

4093 
pEry
->
mcsGroup
 = 3;

4094 i((
pEry
->
HTCaby
.
MCSS
[0] == 0xff) &&

4095 (
pEry
->
HTCaby
.
MCSS
[1] == 0xff) &&

4096 (
pAd
->
CommCfg
.
TxSm
 > 1) &&

4097 (
pAd
->
CommCfg
.
TxSm
 =2 || 
pEry
->
HTCaby
.
MCSS
[2] == 0x0))

4098 
pEry
->
mcsGroup
 = 2;

4100 
pEry
->
mcsGroup
 = 1;

4102 i((
pAd
->
DrsCous
.
LaTxOkCou
 + 2>
OSecTxNoRryOKRiCou
)

4104 
pAd
->
CommCfg
.
TxReIndex
 = 
UpReIdx
;

4107 }
FALSE
);

4110 i(
pEry
->
LaSecTxReChgeAi
 == 1)

4113 i(
pAd
->
CommCfg
.
TxReIndex
 !
CuReIdx
 && 
pEry
->
mcsGroup
 > 0)

4115 
pEry
->
mcsGroup
 --;

4116 
pCuTxRe
 = (
PRTMP_TX_RATE_SWITCH_3S
&
pTab
[(
DownReIdx
+1)*10];

4119 
pEry
->
mcsGroup
)

4122 
UpReIdx
 = 
pCuTxRe
->
upMcs3
;

4126 
UpReIdx
 = 
pCuTxRe
->
upMcs2
;

4130 
UpReIdx
 = 
pCuTxRe
->
upMcs1
;

4134 
UpReIdx
 = 
CuReIdx
;

4138 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, ("wrong mcsGroup value\n"));

4142 i(
UpReIdx
 =
pAd
->
CommCfg
.
TxReIndex
)

4143 
pEry
->
mcsGroup
 = 0;

4145 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,(" QuickDRS:exmcsGrou=%d \n", 
pEry
->
mcsGroup
));

4149 i(
pAd
->
CommCfg
.
TxReIndex
 !
CuReIdx
 && 
pEry
->
LaSecTxReChgeAi
 == 2)

4151 
pAd
->
DrsCous
.
TxReUpPty
 = 0;

4152 
	`NdisZoMemy
(
pAd
->
DrsCous
.
TxQuy
, (
USHORT
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

4153 
	`NdisZoMemy
(
pAd
->
DrsCous
.
PER
, (
UCHAR
* 
MAX_STEP_OF_TX_RATE_SWITCH
);

4154 
bTxReChged
 = 
TRUE
;

4157 i(
pAd
->
CommCfg
.
TxReIndex
 !
CuReIdx
 && 
pEry
->
LaSecTxReChgeAi
 == 1)

4159 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("QuickDRS: --TXom %d%d \n", 
CuReIdx
, 
pAd
->
CommCfg
.
TxReIndex
));

4161 
pAd
->
DrsCous
.
TxReUpPty
 = 0;

4162 
pAd
->
DrsCous
.
TxQuy
[pAd->
CommCfg
.
TxReIndex
] = 0;

4163 
pAd
->
DrsCous
.
PER
[pAd->
CommCfg
.
TxReIndex
] = 0;

4164 
bTxReChged
 = 
TRUE
;

4168 
bTxReChged
 = 
FALSE
;

4171 
pNextTxRe
 = (
PRTMP_TX_RATE_SWITCH
&
pTab
[(
pAd
->
CommCfg
.
TxReIndex
+1)*10];

4172 i(
bTxReChged
 && 
pNextTxRe
)

4174 
	`MlmeSTxRe
(
pAd
, 
pEry
, 
pNextTxRe
);

4176 
	}
}

4198 
VOID
 
	$MlmeCheckPsmChge
(

4199 
IN
 
PRTMP_ADAPTER
 
pAd
,

4200 
IN
 
ULONG
 
Now32
)

4202 
ULONG
 
PowMode
;

4210 
PowMode
 = 
pAd
->
SCfg
.
WdowsPowMode
;

4212 i(
	`INFRA_ON
(
pAd
) &&

4213 (
PowMode
 !
Ndis802_11PowModeCAM
) &&

4214 (
pAd
->
SCfg
.
Psm
 =
PWR_ACTIVE
) &&

4216 (
pAd
->
Mlme
.
ClMache
.
CuS
 =
CNTL_IDLE
)

4217 #ifde
PCIE_PS_SUPPORT


4218 && 
	`RTMP_TEST_PSFLAG
(
pAd
, 
fRTMP_PS_CAN_GO_SLEEP
)

4225 
	`NdisGSyemUpTime
(&
pAd
->
Mlme
.
LaSdNULLpsmTime
);

4226 
pAd
->
RkCous
.
RxCouSLaNULL
 = 0;

4227 
	`RTMP_SET_PSM_BIT
(
pAd
, 
PWR_SAVE
);

4228 i(!(
pAd
->
CommCfg
.
bAPSDCab
 &&Ad->CommCfg.
APEdPm
.bAPSDCapable))

4230 
	`RTMPSdNuFme
(
pAd
,Ad->
CommCfg
.
TxRe
, (
	`OPSTATUS_TEST_FLAG
Ad, 
fOP_STATUS_WMM_INUSED
? 
TRUE
:
FALSE
));

4234 
	`RTMPSdNuFme
(
pAd
,Ad->
CommCfg
.
TxRe
, 
TRUE
);

4238 
	}
}

4242 
VOID
 
	$MlmeSPsmB
(

4243 
IN
 
PRTMP_ADAPTER
 
pAd
,

4244 
IN
 
USHORT
 
psm
)

4247 
pAd
->
SCfg
.
Psm
 = 
psm
;

4249 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeSPsmB = %d\n", 
psm
));

4250 
	}
}

4272 
VOID
 
	$MlmeCcuϋChlQuy
(

4273 
IN
 
PRTMP_ADAPTER
 
pAd
,

4274 
IN
 
PMAC_TABLE_ENTRY
 
pMacEry
,

4275 
IN
 
ULONG
 
Now32
)

4277 
ULONG
 
TxOkC
, 
TxC
, 
TxPER
, 
TxPRR
;

4278 
ULONG
 
RxC
, 
RxPER
;

4279 
UCHAR
 
NRssi
;

4280 
CHAR
 
MaxRssi
;

4281 
RSSI_SAMPLE
 *
pRssiSame
 = 
NULL
;

4282 
UINT32
 
OSecTxNoRryOkCou
 = 0;

4283 
UINT32
 
OSecTxRryOkCou
 = 0;

4284 
UINT32
 
OSecTxFaCou
 = 0;

4285 
UINT32
 
OSecRxOkC
 = 0;

4286 
UINT32
 
OSecRxFcsEC
 = 0;

4287 
ULONG
 
ChlQuy
 = 0;

4288 #ifde
CONFIG_STA_SUPPORT


4289 
ULONG
 
BcLoTime
 = 
pAd
->
SCfg
.BeaconLostTime;

4292 #ifde
CONFIG_STA_SUPPORT


4293 #ifde
CARRIER_DETECTION_SUPPORT


4295 i(
pAd
->
CommCfg
.
CrrDe
.
Eb
 =
TRUE
)

4297 
BcLoTime
 = 
pAd
->
SCfg
.BeaconLostTime + (pAd->StaCfg.BeaconLostTime/2);

4302 #ifde
CONFIG_STA_SUPPORT


4303 i(
pAd
->
OpMode
 =
OPMODE_STA
)

4305 
pRssiSame
 = &
pAd
->
SCfg
.
RssiSame
;

4306 
OSecTxNoRryOkCou
 = 
pAd
->
RkCous
.OneSecTxNoRetryOkCount;

4307 
OSecTxRryOkCou
 = 
pAd
->
RkCous
.OneSecTxRetryOkCount;

4308 
OSecTxFaCou
 = 
pAd
->
RkCous
.OneSecTxFailCount;

4309 
OSecRxOkC
 = 
pAd
->
RkCous
.OneSecRxOkCnt;

4310 
OSecRxFcsEC
 = 
pAd
->
RkCous
.OneSecRxFcsErrCnt;

4314 
MaxRssi
 = 
	`RTMPMaxRssi
(
pAd
, 
pRssiSame
->
LaRssi0
,

4315 
pRssiSame
->
LaRssi1
,

4316 
pRssiSame
->
LaRssi2
);

4321 
TxOkC
 = 
OSecTxNoRryOkCou
 + 
OSecTxRryOkCou
;

4322 
TxC
 = 
TxOkC
 + 
OSecTxFaCou
;

4323 i(
TxC
 < 5)

4325 
TxPER
 = 0;

4326 
TxPRR
 = 0;

4330 
TxPER
 = (
OSecTxFaCou
 * 100/ 
TxC
;

4331 
TxPRR
 = ((
TxC
 - 
OSecTxNoRryOkCou
) * 100) / TxCnt;

4337 
RxC
 = 
OSecRxOkC
 + 
OSecRxFcsEC
;

4338 i(
RxC
 < 5)

4339 
RxPER
 = 0;

4341 
RxPER
 = (
OSecRxFcsEC
 * 100/ 
RxC
;

4346 #ifde
CONFIG_STA_SUPPORT


4347 i((
pAd
->
OpMode
 =
OPMODE_STA
) &&

4348 
	`INFRA_ON
(
pAd
) &&

4349 (
OSecTxNoRryOkCou
 < 2) &&

4350 
	`RTMP_TIME_AFTER
(
Now32
, 
pAd
->
SCfg
.
LaBcRxTime
 + 
BcLoTime
))

4352 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BEACONo > %ld mwh TxOkC=%ld -> CQI=0\n", 
BcLoTime
 * (1000 / 
OS_HZ
, 
TxOkC
));

4353 
ChlQuy
 = 0;

4359 i(
MaxRssi
 > -40)

4360 
NRssi
 = 100;

4361 i(
MaxRssi
 < -90)

4362 
NRssi
 = 0;

4364 
NRssi
 = (
MaxRssi
 + 90) * 2;

4367 
ChlQuy
 = (
RSSI_WEIGHTING
 * 
NRssi
 +

4368 
TX_WEIGHTING
 * (100 - 
TxPRR
) +

4369 
RX_WEIGHTING
* (100 - 
RxPER
)) / 100;

4373 #ifde
CONFIG_STA_SUPPORT


4374 i(
pAd
->
OpMode
 =
OPMODE_STA
)

4375 
pAd
->
Mlme
.
ChlQuy
 = (ChannelQuality > 100) ? 100 : ChannelQuality;

4379 
	}
}

4383 
VOID
 
	$MlmeSTxPamb
(

4384 
IN
 
PRTMP_ADAPTER
 
pAd
,

4385 
IN
 
USHORT
 
TxPamb
)

4387 
AUTO_RSP_CFG_STRUC
 
c4
;

4395 
	`RTMP_IO_READ32
(
pAd
, 
AUTO_RSP_CFG
, &
c4
.
wd
);

4396 i(
TxPamb
 =
Rt802_11PambLg
)

4398 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeSetTxPreamble (= LONG PREAMBLE)\n"));

4399 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_SHORT_PREAMBLE_INUSED
);

4400 
c4
.
fld
.
AutoRedPamb
 = 0;

4405 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeSetTxPreamble (= SHORT PREAMBLE)\n"));

4406 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_SHORT_PREAMBLE_INUSED
);

4407 
c4
.
fld
.
AutoRedPamb
 = 1;

4410 
	`RTMP_IO_WRITE32
(
pAd
, 
AUTO_RSP_CFG
, 
c4
.
wd
);

4411 
	}
}

4420 
VOID
 
	$UpdeBasicReBm
(

4421 
IN
 
PRTMP_ADAPTER
 
pAdr
)

4423 
INT
 
i
, 
j
;

4425 
UCHAR
 

[] = { 2, 4, 11, 22, 12, 18, 24, 36, 48, 72, 96, 108 };

4426 
UCHAR
 *
sup_p
 = 
pAdr
->
CommCfg
.
SupRe
;

4427 
UCHAR
 *
ext_p
 = 
pAdr
->
CommCfg
.
ExtRe
;

4428 
ULONG
 
bm
 = 
pAdr
->
CommCfg
.
BasicReBm
;

4432 i(
pAdr
->
CommCfg
.
Chl
 > 14)

4434 i(
pAdr
->
CommCfg
.
BasicReBm
 & 0xF)

4437 
pAdr
->
CommCfg
.
BasicReBmOld
 =Adr->CommCfg.
BasicReBm
;

4438 
pAdr
->
CommCfg
.
BasicReBm
 &= (~0xF);

4439 
pAdr
->
CommCfg
.
BasicReBm
 |= 0x150;

4445 
pAdr
->
CommCfg
.
BasicReBm
 =Adr->CommCfg.
BasicReBmOld
;

4448 i(
pAdr
->
CommCfg
.
BasicReBm
 > 4095)

4454 
i
=0; i<
MAX_LEN_OF_SUPPORTED_RATES
; i++)

4456 
sup_p
[
i
] &= 0x7f;

4457 
ext_p
[
i
] &= 0x7f;

4460 
i
=0; i<
MAX_LEN_OF_SUPPORTED_RATES
; i++)

4462 i(
bm
 & (1 << 
i
))

4464 
j
=0; j<
MAX_LEN_OF_SUPPORTED_RATES
; j++)

4466 i(
sup_p
[
j
] =

[
i
])

4467 
sup_p
[
j
] |= 0x80;

4471 
j
=0; j<
MAX_LEN_OF_SUPPORTED_RATES
; j++)

4473 i(
ext_p
[
j
] =

[
i
])

4474 
ext_p
[
j
] |= 0x80;

4479 
	}
}

4485 
VOID
 
	$MlmeUpdeTxRes
(

4486 
IN
 
PRTMP_ADAPTER
 
pAd
,

4487 
IN
 
BOOLEAN
 
bLkUp
,

4488 
IN
 
UCHAR
 
idx
)

4490 
i
, 
num
;

4491 
UCHAR
 
Re
 = 
RATE_6
, 
MaxDese
 = 
RATE_1
, 
MaxSut
 = RATE_1;

4492 
UCHAR
 
MSut
 = 
RATE_54
;

4493 
ULONG
 
BasicReBm
 = 0;

4494 
UCHAR
 
CuBasicRe
 = 
RATE_1
;

4495 
UCHAR
 *
pSupRe
, 
SupReL
, *
pExtRe
, 
ExtReL
;

4496 
PHTTRANSMIT_SETTING
 
pHtPhy
 = 
NULL
;

4497 
PHTTRANSMIT_SETTING
 
pMaxHtPhy
 = 
NULL
;

4498 
PHTTRANSMIT_SETTING
 
pMHtPhy
 = 
NULL
;

4499 
BOOLEAN
 *
auto__cur_p
;

4500 
UCHAR
 
HtMcs
 = 
MCS_AUTO
;

4503 
	`UpdeBasicReBm
(
pAd
);

4505 
num
 = 0;

4506 
auto__cur_p
 = 
NULL
;

4507 
i
=0; i<
MAX_LEN_OF_SUPPORTED_RATES
; i++)

4509 
pAd
->
CommCfg
.
DeseRe
[
i
] & 0x7f)

4511 2: 
Re
 = 
RATE_1
; 
num
++; ;

4512 4: 
Re
 = 
RATE_2
; 
num
++; ;

4513 11: 
Re
 = 
RATE_5_5
; 
num
++; ;

4514 22: 
Re
 = 
RATE_11
; 
num
++; ;

4515 12: 
Re
 = 
RATE_6
; 
num
++; ;

4516 18: 
Re
 = 
RATE_9
; 
num
++; ;

4517 24: 
Re
 = 
RATE_12
; 
num
++; ;

4518 36: 
Re
 = 
RATE_18
; 
num
++; ;

4519 48: 
Re
 = 
RATE_24
; 
num
++; ;

4520 72: 
Re
 = 
RATE_36
; 
num
++; ;

4521 96: 
Re
 = 
RATE_48
; 
num
++; ;

4522 108: 
Re
 = 
RATE_54
; 
num
++; ;

4525 i(
MaxDese
 < 
Re
) MaxDesire = Rate;

4531 #ifde
CONFIG_STA_SUPPORT


4532 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

4534 
pHtPhy
 = &
pAd
->
SCfg
.
HTPhyMode
;

4535 
pMaxHtPhy
 = &
pAd
->
SCfg
.
MaxHTPhyMode
;

4536 
pMHtPhy
 = &
pAd
->
SCfg
.
MHTPhyMode
;

4538 
auto__cur_p
 = &
pAd
->
SCfg
.
bAutoTxReSwch
;

4539 
HtMcs
 = 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
;

4541 i((
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
) &&

4542 (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11B
) &&

4543 (
MaxDese
 > 
RATE_11
))

4545 
MaxDese
 = 
RATE_11
;

4550 
pAd
->
CommCfg
.
MaxDesedRe
 = 
MaxDese
;

4551 
pMHtPhy
->
wd
 = 0;

4552 
pMaxHtPhy
->
wd
 = 0;

4553 
pHtPhy
->
wd
 = 0;

4557 i(
num
 <= 1)

4561 *
auto__cur_p
 = 
FALSE
;

4567 *
auto__cur_p
 = 
TRUE
;

4570 i(
HtMcs
 !
MCS_AUTO
)

4574 *
auto__cur_p
 = 
FALSE
;

4580 *
auto__cur_p
 = 
TRUE
;

4583 #ifde
CONFIG_STA_SUPPORT


4584 i((
	`ADHOC_ON
(
pAd
|| 
	`INFRA_ON
Ad)&& (pAd->
OpMode
 =
OPMODE_STA
))

4586 
pSupRe
 = &
pAd
->
SAive
.
SupRe
[0];

4587 
pExtRe
 = &
pAd
->
SAive
.
ExtRe
[0];

4588 
SupReL
 = 
pAd
->
SAive
.SupRateLen;

4589 
ExtReL
 = 
pAd
->
SAive
.ExtRateLen;

4594 
pSupRe
 = &
pAd
->
CommCfg
.
SupRe
[0];

4595 
pExtRe
 = &
pAd
->
CommCfg
.
ExtRe
[0];

4596 
SupReL
 = 
pAd
->
CommCfg
.SupRateLen;

4597 
ExtReL
 = 
pAd
->
CommCfg
.ExtRateLen;

4601 
i
=0; i<
SupReL
; i++)

4603 
pSupRe
[
i
] & 0x7f)

4605 2: 
Re
 = 
RATE_1
; i(
pSupRe
[
i
] & 0x80
BasicReBm
 |= 0x0001; ;

4606 4: 
Re
 = 
RATE_2
; i(
pSupRe
[
i
] & 0x80
BasicReBm
 |= 0x0002; ;

4607 11: 
Re
 = 
RATE_5_5
; i(
pSupRe
[
i
] & 0x80
BasicReBm
 |= 0x0004; ;

4608 22: 
Re
 = 
RATE_11
; i(
pSupRe
[
i
] & 0x80
BasicReBm
 |= 0x0008; ;

4609 12: 
Re
 = 
RATE_6
; 
BasicReBm
 |= 0x0010; ;

4610 18: 
Re
 = 
RATE_9
; i(
pSupRe
[
i
] & 0x80
BasicReBm
 |= 0x0020; ;

4611 24: 
Re
 = 
RATE_12
; 
BasicReBm
 |= 0x0040; ;

4612 36: 
Re
 = 
RATE_18
; i(
pSupRe
[
i
] & 0x80
BasicReBm
 |= 0x0080; ;

4613 48: 
Re
 = 
RATE_24
; 
BasicReBm
 |= 0x0100; ;

4614 72: 
Re
 = 
RATE_36
; i(
pSupRe
[
i
] & 0x80
BasicReBm
 |= 0x0200; ;

4615 96: 
Re
 = 
RATE_48
; i(
pSupRe
[
i
] & 0x80
BasicReBm
 |= 0x0400; ;

4616 108: 
Re
 = 
RATE_54
; i(
pSupRe
[
i
] & 0x80
BasicReBm
 |= 0x0800; ;

4617 : 
Re
 = 
RATE_1
; ;

4619 i(
MaxSut
 < 
Re
) MaxSupport = Rate;

4621 i(
MSut
 > 
Re
) MinSupport = Rate;

4624 
i
=0; i<
ExtReL
; i++)

4626 
pExtRe
[
i
] & 0x7f)

4628 2: 
Re
 = 
RATE_1
; i(
pExtRe
[
i
] & 0x80
BasicReBm
 |= 0x0001; ;

4629 4: 
Re
 = 
RATE_2
; i(
pExtRe
[
i
] & 0x80
BasicReBm
 |= 0x0002; ;

4630 11: 
Re
 = 
RATE_5_5
; i(
pExtRe
[
i
] & 0x80
BasicReBm
 |= 0x0004; ;

4631 22: 
Re
 = 
RATE_11
; i(
pExtRe
[
i
] & 0x80
BasicReBm
 |= 0x0008; ;

4632 12: 
Re
 = 
RATE_6
; 
BasicReBm
 |= 0x0010; ;

4633 18: 
Re
 = 
RATE_9
; i(
pExtRe
[
i
] & 0x80
BasicReBm
 |= 0x0020; ;

4634 24: 
Re
 = 
RATE_12
; 
BasicReBm
 |= 0x0040; ;

4635 36: 
Re
 = 
RATE_18
; i(
pExtRe
[
i
] & 0x80
BasicReBm
 |= 0x0080; ;

4636 48: 
Re
 = 
RATE_24
; 
BasicReBm
 |= 0x0100; ;

4637 72: 
Re
 = 
RATE_36
; i(
pExtRe
[
i
] & 0x80
BasicReBm
 |= 0x0200; ;

4638 96: 
Re
 = 
RATE_48
; i(
pExtRe
[
i
] & 0x80
BasicReBm
 |= 0x0400; ;

4639 108: 
Re
 = 
RATE_54
; i(
pExtRe
[
i
] & 0x80
BasicReBm
 |= 0x0800; ;

4640 : 
Re
 = 
RATE_1
; ;

4642 i(
MaxSut
 < 
Re
) MaxSupport = Rate;

4644 i(
MSut
 > 
Re
) MinSupport = Rate;

4647 
	`RTMP_IO_WRITE32
(
pAd
, 
LEGACY_BASIC_RATE
, 
BasicReBm
);

4649 
i
=0; i<
MAX_LEN_OF_SUPPORTED_RATES
; i++)

4651 i(
BasicReBm
 & (0x01 << 
i
))

4652 
CuBasicRe
 = (
UCHAR
)
i
;

4653 
pAd
->
CommCfg
.
ExedACKRe
[
i
] = 
CuBasicRe
;

4656 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("MlmeUpdeTxRes[MaxSu܈%d] = MaxDes%d Mbps\n", 
ReIdToMbps
[
MaxSut
], ReIdToMbps[
MaxDese
]));

4658 i(
MaxSut
 < 
MaxDese
)

4659 
pAd
->
CommCfg
.
MaxTxRe
 = 
MaxSut
;

4661 
pAd
->
CommCfg
.
MaxTxRe
 = 
MaxDese
;

4663 
pAd
->
CommCfg
.
MTxRe
 = 
MSut
;

4672 i(*
auto__cur_p
)

4674 
dbm
 = 0;

4675 #ifde
CONFIG_STA_SUPPORT


4676 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

4677 
dbm
 = 
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
 -Ad->
BbpRssiToDbmD
;

4679 i(
bLkUp
 =
TRUE
)

4680 
pAd
->
CommCfg
.
TxRe
 = 
RATE_24
;

4682 
pAd
->
CommCfg
.
TxRe
 =Ad->CommCfg.
MaxTxRe
;

4684 i(
dbm
 < -75)

4685 
pAd
->
CommCfg
.
TxRe
 = 
RATE_11
;

4686 i(
dbm
 < -70)

4687 
pAd
->
CommCfg
.
TxRe
 = 
RATE_24
;

4690 i(
pAd
->
CommCfg
.
TxRe
 >Ad->CommCfg.
MaxTxRe
)

4691 
pAd
->
CommCfg
.
TxRe
 =Ad->CommCfg.
MaxTxRe
;

4693 
pAd
->
CommCfg
.
TxReIndex
 = 0;

4698 
pAd
->
CommCfg
.
TxRe
 =Ad->CommCfg.
MaxTxRe
;

4703 i(
num
 > 
RATE_6
)

4705 i(
HtMcs
 <
MCS_7
)

4706 
MaxDese
 = 
RxwiMCSToOfdmRe
[
HtMcs
];

4708 
MaxDese
 = 
MSut
;

4712 i(
HtMcs
 <
MCS_3
)

4713 
MaxDese
 = 
HtMcs
;

4715 
MaxDese
 = 
MSut
;

4718 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
STBC
 = 
pHtPhy
->field.STBC;

4719 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
ShtGI
 = 
pHtPhy
->field.ShortGI;

4720 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
MCS
 = 
pHtPhy
->field.MCS;

4721 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
MODE
 = 
pHtPhy
->field.MODE;

4725 i(
pAd
->
CommCfg
.
TxRe
 <
RATE_11
)

4727 
pMaxHtPhy
->
fld
.
MODE
 = 
MODE_CCK
;

4729 #ifde
CONFIG_STA_SUPPORT


4730 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

4732 
pMaxHtPhy
->
fld
.
MCS
 = 
pAd
->
CommCfg
.
TxRe
;

4733 
pMHtPhy
->
fld
.
MCS
 = 
pAd
->
CommCfg
.
MTxRe
;

4740 
pMaxHtPhy
->
fld
.
MODE
 = 
MODE_OFDM
;

4742 #ifde
CONFIG_STA_SUPPORT


4743 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

4745 
pMaxHtPhy
->
fld
.
MCS
 = 
OfdmReToRxwiMCS
[
pAd
->
CommCfg
.
TxRe
];

4746 i(
pAd
->
CommCfg
.
MTxRe
 >
RATE_6
 && (pAd->CommCfg.MTxR<
RATE_54
))

4747 {
pMHtPhy
->
fld
.
MCS
 = 
OfdmReToRxwiMCS
[
pAd
->
CommCfg
.
MTxRe
];}

4749 {
pMHtPhy
->
fld
.
MCS
 = 
pAd
->
CommCfg
.
MTxRe
;}

4755 
pHtPhy
->
wd
 = (
pMaxHtPhy
->word);

4756 i(
bLkUp
 && (
pAd
->
OpMode
 =
OPMODE_STA
))

4758 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
wd
 = 
pHtPhy
->word;

4759 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
MaxHTPhyMode
.
wd
 = 
pMaxHtPhy
->word;

4760 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
MHTPhyMode
.
wd
 = 
pMHtPhy
->word;

4764 
pAd
->
CommCfg
.
PhyMode
)

4766 
PHY_11BG_MIXED
:

4767 
PHY_11B
:

4768 #ifde
DOT11_N_SUPPORT


4769 
PHY_11BGN_MIXED
:

4771 
pAd
->
CommCfg
.
MlmeRe
 = 
RATE_1
;

4772 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 
MODE_CCK
;

4773 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
 = 
RATE_1
;

4776 
pAd
->
CommCfg
.
RtsRe
 = 
RATE_11
;

4781 
PHY_11G
:

4782 
PHY_11A
:

4783 #ifde
DOT11_N_SUPPORT


4784 
PHY_11AGN_MIXED
:

4785 
PHY_11GN_MIXED
:

4786 
PHY_11N_2_4G
:

4787 
PHY_11AN_MIXED
:

4788 
PHY_11N_5G
:

4790 
pAd
->
CommCfg
.
MlmeRe
 = 
RATE_6
;

4791 
pAd
->
CommCfg
.
RtsRe
 = 
RATE_6
;

4792 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 
MODE_OFDM
;

4793 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pAd->CommCfg.
MlmeRe
];

4795 
PHY_11ABG_MIXED
:

4796 #ifde
DOT11_N_SUPPORT


4797 
PHY_11ABGN_MIXED
:

4799 i(
pAd
->
CommCfg
.
Chl
 <= 14)

4801 
pAd
->
CommCfg
.
MlmeRe
 = 
RATE_1
;

4802 
pAd
->
CommCfg
.
RtsRe
 = 
RATE_1
;

4803 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 
MODE_CCK
;

4804 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
 = 
RATE_1
;

4808 
pAd
->
CommCfg
.
MlmeRe
 = 
RATE_6
;

4809 
pAd
->
CommCfg
.
RtsRe
 = 
RATE_6
;

4810 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 
MODE_OFDM
;

4811 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pAd->CommCfg.
MlmeRe
];

4815 
pAd
->
CommCfg
.
MlmeRe
 = 
RATE_6
;

4816 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 
MODE_OFDM
;

4817 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pAd->CommCfg.
MlmeRe
];

4818 
pAd
->
CommCfg
.
RtsRe
 = 
RATE_1
;

4824 
pAd
->
MacTab
.
Cڋ
[
MCAST_WCID
].
HTPhyMode
.
wd
 =Ad->
CommCfg
.
MlmeTnsm
.word;

4825 i(
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 =
MODE_OFDM
)

4826 
pAd
->
MacTab
.
Cڋ
[
MCAST_WCID
].
HTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[
RATE_24
];

4828 
pAd
->
MacTab
.
Cڋ
[
MCAST_WCID
].
HTPhyMode
.
fld
.
MCS
 = 
RATE_1
;

4829 
pAd
->
CommCfg
.
BasicMlmeRe
 =Ad->CommCfg.
MlmeRe
;

4833 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" MlmeUpdateTxRates (MaxDesire=%d, MaxSupport=%d, MaxTxRate=%d, MinRate=%d, Rate Switching =%d)\n",

4834 
ReIdToMbps
[
MaxDese
], ReIdToMbps[
MaxSut
], ReIdToMbps[
pAd
->
CommCfg
.
MaxTxRe
], ReIdToMbps[pAd->CommCfg.
MTxRe
],

4835  *
auto__cur_p
));

4836 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" MlmeUpdateTxRates (TxRate=%d, RtsRate=%d, BasicRateBitmap=0x%04lx)\n",

4837 
ReIdToMbps
[
pAd
->
CommCfg
.
TxRe
], ReIdToMbps[pAd->CommCfg.
RtsRe
], 
BasicReBm
));

4838 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeUpdateTxRates (MlmeTransmit=0x%x, MinHTPhyMode=%x, MaxHTPhyMode=0x%x, HTPhyMode=0x%x)\n",

4839 
pAd
->
CommCfg
.
MlmeTnsm
.
wd
,Ad->
MacTab
.
Cڋ
[
BSSID_WCID
].
MHTPhyMode
.wd ,pAd->MacTab.Cڋ[BSSID_WCID].
MaxHTPhyMode
.wd ,pAd->MacTab.Cڋ[BSSID_WCID].
HTPhyMode
.word ));

4840 
	}
}

4842 #ifde
DOT11_N_SUPPORT


4855 
VOID
 
	$MlmeUpdeHtTxRes
(

4856 
IN
 
PRTMP_ADAPTER
 
pAd
,

4857 
IN
 
UCHAR
 
idx
)

4859 
UCHAR
 
StbcMcs
;

4860 
CHAR
 
i
;

4861 
RT_HT_CAPABILITY
 *
pRtHtC
 = 
NULL
;

4862 
RT_HT_PHY_INFO
 *
pAiveHtPhy
 = 
NULL
;

4863 
ULONG
 
BasicMCS
;

4864 
UCHAR
 
j
, 
bmask
;

4865 
PRT_HT_PHY_INFO
 
pDeseHtPhy
 = 
NULL
;

4866 
PHTTRANSMIT_SETTING
 
pHtPhy
 = 
NULL
;

4867 
PHTTRANSMIT_SETTING
 
pMaxHtPhy
 = 
NULL
;

4868 
PHTTRANSMIT_SETTING
 
pMHtPhy
 = 
NULL
;

4869 
BOOLEAN
 *
auto__cur_p
;

4871 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("MlmeUpdateHtTxRates===> \n"));

4873 
auto__cur_p
 = 
NULL
;

4875 #ifde
CONFIG_STA_SUPPORT


4876 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

4878 
pDeseHtPhy
 = &
pAd
->
SCfg
.
DesedHtPhyInfo
;

4879 
pAiveHtPhy
 = &
pAd
->
SCfg
.
DesedHtPhyInfo
;

4880 
pHtPhy
 = &
pAd
->
SCfg
.
HTPhyMode
;

4881 
pMaxHtPhy
 = &
pAd
->
SCfg
.
MaxHTPhyMode
;

4882 
pMHtPhy
 = &
pAd
->
SCfg
.
MHTPhyMode
;

4884 
auto__cur_p
 = &
pAd
->
SCfg
.
bAutoTxReSwch
;

4888 #ifde
CONFIG_STA_SUPPORT


4889 i((
	`ADHOC_ON
(
pAd
|| 
	`INFRA_ON
Ad)&& (pAd->
OpMode
 =
OPMODE_STA
))

4891 i(
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 =
FALSE
)

4894 
pRtHtC
 = &
pAd
->
SAive
.
Su܋dHtPhy
;

4895 
pAiveHtPhy
 = &
pAd
->
SAive
.
Su܋dPhyInfo
;

4896 
StbcMcs
 = (
UCHAR
)
pAd
->
MlmeAux
.
AddHtInfo
.
AddHtInfo3
.StbcMcs;

4897 
BasicMCS
 =
pAd
->
MlmeAux
.
AddHtInfo
.
MCSS
[0]+Ad->MlmeAux.AddHtInfo.MCSS[1]<<8)+(
StbcMcs
<<16);

4898 i((
pAd
->
CommCfg
.
DesedHtPhy
.
TxSTBC
&& (
pRtHtC
->
RxSTBC
&& (pAd->
A
.
fld
.
TxPh
 == 2))

4899 
pMaxHtPhy
->
fld
.
STBC
 = 
STBC_USE
;

4901 
pMaxHtPhy
->
fld
.
STBC
 = 
STBC_NONE
;

4906 i(
pDeseHtPhy
->
bHtEb
 =
FALSE
)

4909 
pRtHtC
 = &
pAd
->
CommCfg
.
DesedHtPhy
;

4910 
StbcMcs
 = (
UCHAR
)
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo3
.StbcMcs;

4911 
BasicMCS
 = 
pAd
->
CommCfg
.
AddHTInfo
.
MCSS
[0]+Ad->CommCfg.AddHTInfo.MCSS[1]<<8)+(
StbcMcs
<<16);

4912 i((
pAd
->
CommCfg
.
DesedHtPhy
.
TxSTBC
&& (
pRtHtC
->
RxSTBC
&& (pAd->
A
.
fld
.
TxPh
 == 2))

4913 
pMaxHtPhy
->
fld
.
STBC
 = 
STBC_USE
;

4915 
pMaxHtPhy
->
fld
.
STBC
 = 
STBC_NONE
;

4919 i((
pRtHtC
->
GF
&& (
pAd
->
CommCfg
.
DesedHtPhy
.GF))

4920 
pMaxHtPhy
->
fld
.
MODE
 = 
MODE_HTGREENFIELD
;

4922 
pMaxHtPhy
->
fld
.
MODE
 = 
MODE_HTMIX
;

4924 i((
pAd
->
CommCfg
.
DesedHtPhy
.
ChlWidth
&& (
pRtHtC
->ChannelWidth))

4925 
pMaxHtPhy
->
fld
.
BW
 = 
BW_40
;

4927 
pMaxHtPhy
->
fld
.
BW
 = 
BW_20
;

4929 i(
pMaxHtPhy
->
fld
.
BW
 =
BW_20
)

4930 
pMaxHtPhy
->
fld
.
ShtGI
 = (
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf20
 & 
pRtHtC
->ShortGIfor20);

4932 
pMaxHtPhy
->
fld
.
ShtGI
 = (
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf40
 & 
pRtHtC
->ShortGIfor40);

4934 i(
pDeseHtPhy
->
MCSS
[4] != 0)

4936 
pMaxHtPhy
->
fld
.
MCS
 = 32;

4939 
i
=23; i>=0; i--)

4941 
j
 = 
i
/8;

4942 
bmask
 = (1<<(
i
-(
j
*8)));

4944 i((
pAiveHtPhy
->
MCSS
[
j
] & 
bmask
&& (
pDeseHtPhy
->MCSSet[j] & bitmask))

4946 
pMaxHtPhy
->
fld
.
MCS
 = 
i
;

4950 i(
i
==0)

4955 
pMHtPhy
->
fld
.
BW
 = 
BW_20
;

4956 
pMHtPhy
->
fld
.
MCS
 = 0;

4957 
pMHtPhy
->
fld
.
STBC
 = 0;

4958 
pMHtPhy
->
fld
.
ShtGI
 = 0;

4960 #ifde
CONFIG_STA_SUPPORT


4961 i(
pAd
->
OpMode
 =
OPMODE_STA
&& (
pDeseHtPhy
->
MCSS
[0] != 0xff))

4963 i(
pDeseHtPhy
->
MCSS
[4] != 0)

4965 
pMaxHtPhy
->
fld
.
MCS
 = 32;

4966 
pMHtPhy
->
fld
.
MCS
 = 32;

4967 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("MlmeUpdeHtTxRes<==U Fixed MCS = %d\n",
pMHtPhy
->
fld
.
MCS
));

4970 
i
=23; (
CHAR
)i >= 0; i--)

4972 
j
 = 
i
/8;

4973 
bmask
 = (1<<(
i
-(
j
*8)));

4974 i(
pDeseHtPhy
->
MCSS
[
j
] & 
bmask
&& (
pAiveHtPhy
->MCSSet[j] & bitmask))

4976 
pMaxHtPhy
->
fld
.
MCS
 = 
i
;

4977 
pMHtPhy
->
fld
.
MCS
 = 
i
;

4980 i(
i
==0)

4988 
pHtPhy
->
fld
.
STBC
 = 
pMaxHtPhy
->field.STBC;

4989 
pHtPhy
->
fld
.
BW
 = 
pMaxHtPhy
->field.BW;

4990 
pHtPhy
->
fld
.
MODE
 = 
pMaxHtPhy
->field.MODE;

4991 
pHtPhy
->
fld
.
MCS
 = 
pMaxHtPhy
->field.MCS;

4992 
pHtPhy
->
fld
.
ShtGI
 = 
pMaxHtPhy
->field.ShortGI;

4995 i(
pDeseHtPhy
->
MCSS
[0] != 0xff)

4996 *
auto__cur_p
 = 
FALSE
;

4998 *
auto__cur_p
 = 
TRUE
;

5000 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" MlmeUpdeHtTxRes<---.AMsduSiz%d \n", 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduSize
 ));

5001 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("TX: MCS[0] = %x (choo %d), BW = %d, ShtGI = %d, MODE = %d, \n", 
pAiveHtPhy
->
MCSS
[0],
pHtPhy
->
fld
.
MCS
,

5002 
pHtPhy
->
fld
.
BW
,HtPhy->fld.
ShtGI
,HtPhy->fld.
MODE
));

5003 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("MlmeUpdateHtTxRates<=== \n"));

5004 
	}
}

5007 
VOID
 
	$BATabIn
(

5008 
IN
 
PRTMP_ADAPTER
 
pAd
,

5009 
IN
 
BA_TABLE
 *
Tab
)

5011 
i
;

5013 
Tab
->
numAsOrig
 = 0;

5014 
Tab
->
numAsRec
 = 0;

5015 
Tab
->
numDeOrig
 = 0;

5016 
	`NdisAoSpLock
(&
pAd
->
BATabLock
);

5017 
i
 = 0; i < 
MAX_LEN_OF_BA_REC_TABLE
; i++)

5019 
Tab
->
BARecEry
[
i
].
REC_BA_Stus
 = 
Rec_NONE
;

5020 
	`NdisAoSpLock
(&(
Tab
->
BARecEry
[
i
].
RxReRgLock
));

5022 
i
 = 0; i < 
MAX_LEN_OF_BA_ORI_TABLE
; i++)

5024 
Tab
->
BAOriEry
[
i
].
ORI_BA_Stus
 = 
Orig_NONE
;

5026 
	}
}

5028 
VOID
 
	$BATabEx
(

5029 
IN
 
RTMP_ADAPTER
 *
pAd
)

5031 
i
;

5033 
i
=0; i<
MAX_LEN_OF_BA_REC_TABLE
; i++)

5035 
	`NdisFeSpLock
(&
pAd
->
BATab
.
BARecEry
[
i
].
RxReRgLock
);

5037 
	`NdisFeSpLock
(&
pAd
->
BATabLock
);

5038 
	}
}

5042 
VOID
 
	$MlmeRadioOff
(

5043 
IN
 
PRTMP_ADAPTER
 
pAd
)

5045 
	`RTMP_MLME_RADIO_OFF
(
pAd
);

5046 
	}
}

5049 
VOID
 
	$MlmeRadioOn
(

5050 
IN
 
PRTMP_ADAPTER
 
pAd
)

5052 
	`RTMP_MLME_RADIO_ON
(
pAd
);

5053 
	}
}

5070 
VOID
 
	$BssTabIn
(

5071 
IN
 
BSS_TABLE
 *
Tab
)

5073 
i
;

5075 
Tab
->
BssNr
 = 0;

5076 
Tab
->
BssOvpNr
 = 0;

5078 
i
 = 0; i < 
MAX_LEN_OF_BSS_TABLE
; i++)

5080 
UCHAR
 *
pOldAddr
 = 
Tab
->
BssEry
[
i
].
pVIeFromProbR
;

5081 
	`NdisZoMemy
(&
Tab
->
BssEry
[
i
], (
BSS_ENTRY
));

5082 
Tab
->
BssEry
[
i
].
Rssi
 = -127;

5083 i(
pOldAddr
)

5085 
	`RTMPZoMemy
(
pOldAddr
, 
MAX_VIE_LEN
);

5086 
Tab
->
BssEry
[
i
].
pVIeFromProbR
 = 
pOldAddr
;

5089 
	}
}

5103 
ULONG
 
	$BssTabSrch
(

5104 
IN
 
BSS_TABLE
 *
Tab
,

5105 
IN
 
PUCHAR
 
pBssid
,

5106 
IN
 
UCHAR
 
Chl
)

5108 
UCHAR
 
i
;

5110 
i
 = 0; i < 
Tab
->
BssNr
; i++)

5116 i((((
Tab
->
BssEry
[
i
].
Chl
 <= 14) && (Channel <= 14)) ||

5117 ((
Tab
->
BssEry
[
i
].
Chl
 > 14) && (Channel > 14))) &&

5118 
	`MAC_ADDR_EQUAL
(
Tab
->
BssEry
[
i
].
Bssid
, 
pBssid
))

5120  
i
;

5123  (
ULONG
)
BSS_NOT_FOUND
;

5124 
	}
}

5126 
ULONG
 
	$BssSsidTabSrch
(

5127 
IN
 
BSS_TABLE
 *
Tab
,

5128 
IN
 
PUCHAR
 
pBssid
,

5129 
IN
 
PUCHAR
 
pSsid
,

5130 
IN
 
UCHAR
 
SsidL
,

5131 
IN
 
UCHAR
 
Chl
)

5133 
UCHAR
 
i
;

5135 
i
 = 0; i < 
Tab
->
BssNr
; i++)

5141 i((((
Tab
->
BssEry
[
i
].
Chl
 <= 14) && (Channel <= 14)) ||

5142 ((
Tab
->
BssEry
[
i
].
Chl
 > 14) && (Channel > 14))) &&

5143 
	`MAC_ADDR_EQUAL
(
Tab
->
BssEry
[
i
].
Bssid
, 
pBssid
) &&

5144 
	`SSID_EQUAL
(
pSsid
, 
SsidL
, 
Tab
->
BssEry
[
i
].
Ssid
, Tab->BssEntry[i].SsidLen))

5146  
i
;

5149  (
ULONG
)
BSS_NOT_FOUND
;

5150 
	}
}

5152 
ULONG
 
	$BssTabSrchWhSSID
(

5153 
IN
 
BSS_TABLE
 *
Tab
,

5154 
IN
 
PUCHAR
 
Bssid
,

5155 
IN
 
PUCHAR
 
pSsid
,

5156 
IN
 
UCHAR
 
SsidL
,

5157 
IN
 
UCHAR
 
Chl
)

5159 
UCHAR
 
i
;

5161 
i
 = 0; i < 
Tab
->
BssNr
; i++)

5163 i((((
Tab
->
BssEry
[
i
].
Chl
 <= 14) && (Channel <= 14)) ||

5164 ((
Tab
->
BssEry
[
i
].
Chl
 > 14) && (Channel > 14))) &&

5165 
	`MAC_ADDR_EQUAL
(&(
Tab
->
BssEry
[
i
].
Bssid
), Bssid) &&

5166 (
	`SSID_EQUAL
(
pSsid
, 
SsidL
, 
Tab
->
BssEry
[
i
].
Ssid
, Tab->BssEntry[i].SsidLen) ||

5167 (
	`NdisEquMemy
(
pSsid
, 
ZoSsid
, 
SsidL
)) ||

5168 (
	`NdisEquMemy
(
Tab
->
BssEry
[
i
].
Ssid
, 
ZoSsid
, Tab->BssEry[i].
SsidL
))))

5170  
i
;

5173  (
ULONG
)
BSS_NOT_FOUND
;

5174 
	}
}

5177 
ULONG
 
	$BssSsidTabSrchBySSID
(

5178 
IN
 
BSS_TABLE
 *
Tab
,

5179 
IN
 
PUCHAR
 
pSsid
,

5180 
IN
 
UCHAR
 
SsidL
)

5182 
UCHAR
 
i
;

5184 
i
 = 0; i < 
Tab
->
BssNr
; i++)

5186 i(
	`SSID_EQUAL
(
pSsid
, 
SsidL
, 
Tab
->
BssEry
[
i
].
Ssid
, Tab->BssEntry[i].SsidLen))

5188  
i
;

5191  (
ULONG
)
BSS_NOT_FOUND
;

5192 
	}
}

5196 
VOID
 
	$BssTabDeEry
(

5197 
IN
 
OUT
 
BSS_TABLE
 *
Tab
,

5198 
IN
 
PUCHAR
 
pBssid
,

5199 
IN
 
UCHAR
 
Chl
)

5201 
UCHAR
 
i
, 
j
;

5203 
i
 = 0; i < 
Tab
->
BssNr
; i++)

5205 i((
Tab
->
BssEry
[
i
].
Chl
 == Channel) &&

5206 (
	`MAC_ADDR_EQUAL
(
Tab
->
BssEry
[
i
].
Bssid
, 
pBssid
)))

5208 
UCHAR
 *
pOldAddr
 = 
NULL
;

5210 
j
 = 
i
; j < 
Tab
->
BssNr
 - 1; j++)

5212 
pOldAddr
 = 
Tab
->
BssEry
[
j
].
pVIeFromProbR
;

5213 
	`NdisMoveMemy
(&(
Tab
->
BssEry
[
j
]), &(Tab->BssEry[j + 1]), (
BSS_ENTRY
));

5214 i(
pOldAddr
)

5216 
	`RTMPZoMemy
(
pOldAddr
, 
MAX_VIE_LEN
);

5217 
	`NdisMoveMemy
(
pOldAddr
,

5218 
Tab
->
BssEry
[
j
 + 1].
pVIeFromProbR
,

5219 
Tab
->
BssEry
[
j
 + 1].
VIeFromProbeRL
);

5220 
Tab
->
BssEry
[
j
].
pVIeFromProbR
 = 
pOldAddr
;

5224 
pOldAddr
 = 
Tab
->
BssEry
[Tab->
BssNr
 - 1].
pVIeFromProbR
;

5225 
	`NdisZoMemy
(&(
Tab
->
BssEry
[Tab->
BssNr
 - 1]), (
BSS_ENTRY
));

5226 i(
pOldAddr
)

5228 
	`RTMPZoMemy
(
pOldAddr
, 
MAX_VIE_LEN
);

5229 
Tab
->
BssEry
[Tab->
BssNr
 - 1].
pVIeFromProbR
 = 
pOldAddr
;

5232 
Tab
->
BssNr
 -= 1;

5236 
	}
}

5248 
VOID
 
	$BssEryS
(

5249 
IN
 
PRTMP_ADAPTER
 
pAd
,

5250 
OUT
 
BSS_ENTRY
 *
pBss
,

5251 
IN
 
PUCHAR
 
pBssid
,

5252 
IN
 
CHAR
 
Ssid
[],

5253 
IN
 
UCHAR
 
SsidL
,

5254 
IN
 
UCHAR
 
BssTy
,

5255 
IN
 
USHORT
 
BcPiod
,

5256 
IN
 
PCF_PARM
 
pCfPm
,

5257 
IN
 
USHORT
 
AtimW
,

5258 
IN
 
USHORT
 
CabyInfo
,

5259 
IN
 
UCHAR
 
SupRe
[],

5260 
IN
 
UCHAR
 
SupReL
,

5261 
IN
 
UCHAR
 
ExtRe
[],

5262 
IN
 
UCHAR
 
ExtReL
,

5263 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

5264 
IN
 
ADD_HT_INFO_IE
 *
pAddHtInfo
,

5265 
IN
 
UCHAR
 
HtCabyL
,

5266 
IN
 
UCHAR
 
AddHtInfoL
,

5267 
IN
 
UCHAR
 
NewExtChOfft
,

5268 
IN
 
UCHAR
 
Chl
,

5269 
IN
 
CHAR
 
Rssi
,

5270 
IN
 
LARGE_INTEGER
 
TimeSmp
,

5271 
IN
 
UCHAR
 
CkFg
,

5272 
IN
 
PEDCA_PARM
 
pEdPm
,

5273 
IN
 
PQOS_CAPABILITY_PARM
 
pQosCaby
,

5274 
IN
 
PQBSS_LOAD_PARM
 
pQbssLd
,

5275 
IN
 
USHORT
 
LgthVIE
,

5276 
IN
 
PNDIS_802_11_VARIABLE_IEs
 
pVIE
)

5278 
	`COPY_MAC_ADDR
(
pBss
->
Bssid
, 
pBssid
);

5280 
pBss
->
Hidd
 = 1;

5281 i(
SsidL
 > 0)

5287 i(
	`NdisEquMemy
(
Ssid
, 
ZoSsid
, 
SsidL
) == 0)

5289 
	`NdisZoMemy
(
pBss
->
Ssid
, 
MAX_LEN_OF_SSID
);

5290 
	`NdisMoveMemy
(
pBss
->
Ssid
, Ssid, 
SsidL
);

5291 
pBss
->
SsidL
 = SsidLen;

5292 
pBss
->
Hidd
 = 0;

5298 i(
	`NdisEquMemy
(
pBss
->
Ssid
, 
ZoSsid
,Bss->
SsidL
))

5300 
	`NdisZoMemy
(
pBss
->
Ssid
, 
MAX_LEN_OF_SSID
);

5301 
pBss
->
SsidL
 = 0;

5305 
pBss
->
BssTy
 = BssType;

5306 
pBss
->
BcPiod
 = BeaconPeriod;

5307 i(
BssTy
 =
BSS_INFRA
)

5309 i(
pCfPm
->
bVid
)

5311 
pBss
->
CCou
 = 
pCfPm
->CfpCount;

5312 
pBss
->
CPiod
 = 
pCfPm
->CfpPeriod;

5313 
pBss
->
CMaxDuti
 = 
pCfPm
->CfpMaxDuration;

5314 
pBss
->
CDurRemag
 = 
pCfPm
->CfpDurRemaining;

5319 
pBss
->
AtimW
 = AtimWin;

5322 
pBss
->
CabyInfo
 = CapabilityInfo;

5325 
pBss
->
Privacy
 = 
	`CAP_IS_PRIVACY_ON
Bss->
CabyInfo
);

5326 
	`ASSERT
(
SupReL
 <
MAX_LEN_OF_SUPPORTED_RATES
);

5327 i(
SupReL
 <
MAX_LEN_OF_SUPPORTED_RATES
)

5328 
	`NdisMoveMemy
(
pBss
->
SupRe
, SupRe, 
SupReL
);

5330 
	`NdisMoveMemy
(
pBss
->
SupRe
, SupRe, 
MAX_LEN_OF_SUPPORTED_RATES
);

5331 
pBss
->
SupReL
 = SupRateLen;

5332 
	`ASSERT
(
ExtReL
 <
MAX_LEN_OF_SUPPORTED_RATES
);

5333 
	`NdisMoveMemy
(
pBss
->
ExtRe
, ExtRe, 
ExtReL
);

5334 
pBss
->
NewExtChOfft
 = NewExtChanOffset;

5335 
pBss
->
ExtReL
 = ExtRateLen;

5336 
pBss
->
Chl
 = Channel;

5337 
pBss
->
CChl
 = 
Chl
;

5338 
pBss
->
Rssi
 = Rssi;

5340 
pBss
->
CkFg
 = CkipFlag;

5343 
	`NdisMoveMemy
(
pBss
->
FixIEs
.
Timeamp
, &
TimeSmp
, 8);

5344 
pBss
->
FixIEs
.
BcIv
 = 
BcPiod
;

5345 
pBss
->
FixIEs
.
Cabs
 = 
CabyInfo
;

5348 i(
LgthVIE
 != 0)

5350 
pBss
->
VIEL
 = 
LgthVIE
;

5351 
	`NdisMoveMemy
(
pBss
->
VIEs
, 
pVIE
,Bss->
VIEL
);

5355 
pBss
->
VIEL
 = 0;

5358 
pBss
->
AddHtInfoL
 = 0;

5359 
pBss
->
HtCabyL
 = 0;

5360 #ifde
DOT11_N_SUPPORT


5361 i(
HtCabyL
> 0)

5363 
pBss
->
HtCabyL
 = HtCapabilityLen;

5364 
	`NdisMoveMemy
(&
pBss
->
HtCaby
, 
pHtCaby
, 
HtCabyL
);

5365 i(
AddHtInfoL
 > 0)

5367 
pBss
->
AddHtInfoL
 = AddHtInfoLen;

5368 
	`NdisMoveMemy
(&
pBss
->
AddHtInfo
, 
pAddHtInfo
, 
AddHtInfoL
);

5370 i((
pAddHtInfo
->
CڌCh
 > 2)&& (pAddHtInfo->
AddHtInfo
.
ExtChOfft
 =
EXTCHA_BELOW
&& (
pHtCaby
->
HtCInfo
.
ChlWidth
 =
BW_40
))

5372 
pBss
->
CChl
 = 
pAddHtInfo
->
CڌCh
 - 2;

5374 i((
pAddHtInfo
->
AddHtInfo
.
ExtChOfft
 =
EXTCHA_ABOVE
&& (
pHtCaby
->
HtCInfo
.
ChlWidth
 =
BW_40
))

5376 
pBss
->
CChl
 = 
pAddHtInfo
->
CڌCh
 + 2;

5382 
	`BssChP
(
pBss
);

5385 i(
pEdPm
)

5386 
	`NdisMoveMemy
(&
pBss
->
EdPm
, 
pEdPm
, (
EDCA_PARM
));

5388 
pBss
->
EdPm
.
bVid
 = 
FALSE
;

5389 i(
pQosCaby
)

5390 
	`NdisMoveMemy
(&
pBss
->
QosCaby
, 
pQosCaby
, (
QOS_CAPABILITY_PARM
));

5392 
pBss
->
QosCaby
.
bVid
 = 
FALSE
;

5393 i(
pQbssLd
)

5394 
	`NdisMoveMemy
(&
pBss
->
QbssLd
, 
pQbssLd
, (
QBSS_LOAD_PARM
));

5396 
pBss
->
QbssLd
.
bVid
 = 
FALSE
;

5399 
PEID_STRUCT
 
pEid
;

5400 
USHORT
 
Lgth
 = 0;

5403 #ifde
CONFIG_STA_SUPPORT


5404 
	`NdisZoMemy
(&
pBss
->
WIE
.
IE
[0], 
MAX_CUSTOM_LEN
);

5405 
	`NdisZoMemy
(&
pBss
->
RIE
.
IE
[0], 
MAX_CUSTOM_LEN
);

5406 
	`NdisZoMemy
(&
pBss
->
WpsIE
.
IE
[0], 
MAX_CUSTOM_LEN
);

5407 #ifde
EXT_BUILD_CHANNEL_LIST


5408 
	`NdisZoMemy
(&
pBss
->
CourySg
[0], 3);

5409 
pBss
->
bHasCouryIE
 = 
FALSE
;

5412 
pEid
 = (
PEID_STRUCT

pVIE
;

5413 (
Lgth
 + 2 + (
USHORT
)
pEid
->
L
<
LgthVIE
)

5415 
pEid
->
Eid
)

5417 
IE_WPA
:

5418 i(
	`NdisEquMemy
(
pEid
->
O
, 
WPS_OUI
, 4))

5420 #ifde
CONFIG_STA_SUPPORT


5421 i((
pEid
->
L
 + 2> 
MAX_CUSTOM_LEN
)

5423 
pBss
->
WpsIE
.
IEL
 = 0;

5426 
pBss
->
WpsIE
.
IEL
 = 
pEid
->
L
 + 2;

5427 
	`NdisMoveMemy
(
pBss
->
WpsIE
.
IE
, 
pEid
,Bss->WpsIE.
IEL
);

5431 #ifde
CONFIG_STA_SUPPORT


5432 i(
	`NdisEquMemy
(
pEid
->
O
, 
WPA_OUI
, 4))

5434 i((
pEid
->
L
 + 2> 
MAX_CUSTOM_LEN
)

5436 
pBss
->
WIE
.
IEL
 = 0;

5439 
pBss
->
WIE
.
IEL
 = 
pEid
->
L
 + 2;

5440 
	`NdisMoveMemy
(
pBss
->
WIE
.
IE
, 
pEid
,Bss->WIE.
IEL
);

5445 #ifde
CONFIG_STA_SUPPORT


5446 
IE_RSN
:

5447 i(
	`NdisEquMemy
(
pEid
->
O
 + 2, 
RSN_OUI
, 3))

5449 i((
pEid
->
L
 + 2> 
MAX_CUSTOM_LEN
)

5451 
pBss
->
RIE
.
IEL
 = 0;

5454 
pBss
->
RIE
.
IEL
 = 
pEid
->
L
 + 2;

5455 
	`NdisMoveMemy
(
pBss
->
RIE
.
IE
, 
pEid
,Bss->RIE.
IEL
);

5458 #ifde
EXT_BUILD_CHANNEL_LIST


5459 
IE_COUNTRY
:

5460 
	`NdisMoveMemy
(&
pBss
->
CourySg
[0], 
pEid
->
O
, 3);

5461 
pBss
->
bHasCouryIE
 = 
TRUE
;

5466 
Lgth
 = Lgth + 2 + (
USHORT
)
pEid
->
L
;

5467 
pEid
 = (
PEID_STRUCT
)((
UCHAR
*Eid + 2 +Eid->
L
);

5470 
	}
}

5495 
ULONG
 
	$BssTabSEry
(

5496 
IN
 
PRTMP_ADAPTER
 
pAd
,

5497 
OUT
 
BSS_TABLE
 *
Tab
,

5498 
IN
 
PUCHAR
 
pBssid
,

5499 
IN
 
CHAR
 
Ssid
[],

5500 
IN
 
UCHAR
 
SsidL
,

5501 
IN
 
UCHAR
 
BssTy
,

5502 
IN
 
USHORT
 
BcPiod
,

5503 
IN
 
CF_PARM
 *
CfPm
,

5504 
IN
 
USHORT
 
AtimW
,

5505 
IN
 
USHORT
 
CabyInfo
,

5506 
IN
 
UCHAR
 
SupRe
[],

5507 
IN
 
UCHAR
 
SupReL
,

5508 
IN
 
UCHAR
 
ExtRe
[],

5509 
IN
 
UCHAR
 
ExtReL
,

5510 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

5511 
IN
 
ADD_HT_INFO_IE
 *
pAddHtInfo
,

5512 
IN
 
UCHAR
 
HtCabyL
,

5513 
IN
 
UCHAR
 
AddHtInfoL
,

5514 
IN
 
UCHAR
 
NewExtChOfft
,

5515 
IN
 
UCHAR
 
ChlNo
,

5516 
IN
 
CHAR
 
Rssi
,

5517 
IN
 
LARGE_INTEGER
 
TimeSmp
,

5518 
IN
 
UCHAR
 
CkFg
,

5519 
IN
 
PEDCA_PARM
 
pEdPm
,

5520 
IN
 
PQOS_CAPABILITY_PARM
 
pQosCaby
,

5521 
IN
 
PQBSS_LOAD_PARM
 
pQbssLd
,

5522 
IN
 
USHORT
 
LgthVIE
,

5523 
IN
 
PNDIS_802_11_VARIABLE_IEs
 
pVIE
)

5525 
ULONG
 
Idx
;

5528 
Idx
 = 
	`BssTabSrch
(
Tab
, 
pBssid
, 
ChlNo
);

5529 i(
Idx
 =
BSS_NOT_FOUND
)

5531 i(
Tab
->
BssNr
 >
MAX_LEN_OF_BSS_TABLE
)

5538 if(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
))

5540 i(
	`MAC_ADDR_EQUAL
(
pAd
->
MlmeAux
.
Bssid
, 
pBssid
) ||

5541 
	`SSID_EQUAL
(
pAd
->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
, Ssid, SsidLen))

5543 
Idx
 = 
Tab
->
BssOvpNr
;

5544 
	`BssEryS
(
pAd
, &
Tab
->
BssEry
[
Idx
], 
pBssid
, 
Ssid
, 
SsidL
, 
BssTy
, 
BcPiod
, 
CfPm
, 
AtimW
,

5545 
CabyInfo
, 
SupRe
, 
SupReL
, 
ExtRe
, 
ExtReL
,
pHtCaby
, 
pAddHtInfo
,
HtCabyL
, 
AddHtInfoL
,

5546 
NewExtChOfft
, 
ChlNo
, 
Rssi
, 
TimeSmp
, 
CkFg
, 
pEdPm
, 
pQosCaby
, 
pQbssLd
, 
LgthVIE
, 
pVIE
);

5547 
Tab
->
BssOvpNr
 = (Tab->BssOvpNr++% 
MAX_LEN_OF_BSS_TABLE
;

5549  
Idx
;

5553  
BSS_NOT_FOUND
;

5556 
Idx
 = 
Tab
->
BssNr
;

5557 
	`BssEryS
(
pAd
, &
Tab
->
BssEry
[
Idx
], 
pBssid
, 
Ssid
, 
SsidL
, 
BssTy
, 
BcPiod
, 
CfPm
, 
AtimW
,

5558 
CabyInfo
, 
SupRe
, 
SupReL
, 
ExtRe
, 
ExtReL
,
pHtCaby
, 
pAddHtInfo
,
HtCabyL
, 
AddHtInfoL
,

5559 
NewExtChOfft
, 
ChlNo
, 
Rssi
, 
TimeSmp
, 
CkFg
, 
pEdPm
, 
pQosCaby
, 
pQbssLd
, 
LgthVIE
, 
pVIE
);

5560 
Tab
->
BssNr
++;

5564 
	`BssEryS
(
pAd
, &
Tab
->
BssEry
[
Idx
], 
pBssid
, 
Ssid
, 
SsidL
, 
BssTy
, 
BcPiod
,
CfPm
, 
AtimW
,

5565 
CabyInfo
, 
SupRe
, 
SupReL
, 
ExtRe
, 
ExtReL
,
pHtCaby
, 
pAddHtInfo
,
HtCabyL
, 
AddHtInfoL
,

5566 
NewExtChOfft
, 
ChlNo
, 
Rssi
, 
TimeSmp
, 
CkFg
, 
pEdPm
, 
pQosCaby
, 
pQbssLd
, 
LgthVIE
, 
pVIE
);

5569  
Idx
;

5570 
	}
}

5572 #ifde
CONFIG_STA_SUPPORT


5573 #ifde
DOT11_N_SUPPORT


5574 #ifde
DOT11N_DRAFT3


5575 
VOID
 
	$TriEvtIn
(

5576 
IN
 
PRTMP_ADAPTER
 
pAd
)

5578 
UCHAR
 
i
;

5580 
i
 = 0;< 
MAX_TRIGGER_EVENT
;i++)

5581 
pAd
->
CommCfg
.
TriggEvtTab
.
EvtA
[
i
].
bVid
 = 
FALSE
;

5583 
pAd
->
CommCfg
.
TriggEvtTab
.
EvtANo
 = 0;

5584 
pAd
->
CommCfg
.
TriggEvtTab
.
EvtBCouDown
 = 0;

5585 
	}
}

5587 
INT
 
	$TriEvtTabSEry
(

5588 
IN
 
PRTMP_ADAPTER
 
pAd
,

5589 
OUT
 
TRIGGER_EVENT_TAB
 *
Tab
,

5590 
IN
 
PUCHAR
 
pBssid
,

5591 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

5592 
IN
 
UCHAR
 
HtCabyL
,

5593 
IN
 
UCHAR
 
RegCss
,

5594 
IN
 
UCHAR
 
ChlNo
)

5597 i(
HtCabyL
 == 0)

5599 
UCHAR
 
dex
;

5604 
dex
 = 0; index<
MAX_TRIGGER_EVENT
; index++)

5606 i((
Tab
->
EvtA
[
dex
].
bVid
 =
TRUE
) &&

5607 (
Tab
->
EvtA
[
dex
].
Chl
 =
ChlNo
) &&

5608 (
Tab
->
EvtA
[
dex
].
RegCss
 == RegClass)

5618 i(
Tab
->
EvtANo
 < 
MAX_TRIGGER_EVENT
)

5620 
	`RTMPMoveMemy
(
Tab
->
EvtA
[Tab->
EvtANo
].
BSSID
, 
pBssid
, 6);

5621 
Tab
->
EvtA
[Tab->
EvtANo
].
bVid
 = 
TRUE
;

5622 
Tab
->
EvtA
[Tab->
EvtANo
].
Chl
 = 
ChlNo
;

5623 i(
RegCss
 != 0)

5626 
Tab
->
EvtA
[Tab->
EvtANo
].
RegCss
 = RegClass;

5633 
Tab
->
EvtA
[Tab->
EvtANo
].
RegCss
 = 0;

5635 
Tab
->
EvtANo
 ++;

5638 i(
pHtCaby
->
HtCInfo
.
Fty_Mhz_Iޔt
)

5641 
Tab
->
EvtBCouDown
 = 
pAd
->
CommCfg
.
D11BssWidthChTnDay
;

5645 
	}
}

5650 
VOID
 
	$BssTabSsidSt
(

5651 
IN
 
PRTMP_ADAPTER
 
pAd
,

5652 
OUT
 
BSS_TABLE
 *
OutTab
,

5653 
IN
 
CHAR
 
Ssid
[],

5654 
IN
 
UCHAR
 
SsidL
)

5656 
INT
 
i
;

5657 
	`BssTabIn
(
OutTab
);

5659 i((
SsidL
 == 0) &&

5660 (
pAd
->
SCfg
.
bAutoCIfNoSSID
 =
FALSE
))

5663 
i
 = 0; i < 
pAd
->
SnTab
.
BssNr
; i++)

5665 
BSS_ENTRY
 *
pInBss
 = &
pAd
->
SnTab
.
BssEry
[
i
];

5666 
BOOLEAN
 
bIsHiddApInuded
 = 
FALSE
;

5668 i(((
pAd
->
CommCfg
.
bIEEE80211H
 == 1) &&

5669 (
pAd
->
MlmeAux
.
Chl
 > 14) &&

5670 
	`RadChlCheck
(
pAd
, 
pInBss
->
Chl
))

5671 #ifde
CARRIER_DETECTION_SUPPORT


5672 || (
pAd
->
CommCfg
.
CrrDe
.
Eb
 =
TRUE
)

5676 i(
pInBss
->
Hidd
)

5677 
bIsHiddApInuded
 = 
TRUE
;

5680 i((
pInBss
->
BssTy
 =
pAd
->
SCfg
.BssType) &&

5681 (
	`SSID_EQUAL
(
Ssid
, 
SsidL
, 
pInBss
->Ssid,InBss->SsidL|| 
bIsHiddApInuded
))

5683 
BSS_ENTRY
 *
pOutBss
 = &
OutTab
->
BssEry
[OutTab->
BssNr
];

5685 #ifde
WPA_SUPPLICANT_SUPPORT


5686 i(
pAd
->
SCfg
.
WSuliUP
 & 0x80)

5689 
	`NdisMoveMemy
(
pOutBss
, 
pInBss
, (
BSS_ENTRY
));

5690 
OutTab
->
BssNr
++;

5696 #ifde
EXT_BUILD_CHANNEL_LIST


5698 i((
pAd
->
SCfg
.
IEEE80211dClMode
 =
Rt802_11_D_Si
) &&

5699 (
pInBss
->
bHasCouryIE
 =
FALSE
))

5701 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("StaCfg.IEEE80211dClientMode == Rt802_11_D_Strict, buthis AP doesn't have country IE.\n"));

5706 #ifde
DOT11_N_SUPPORT


5708 i((
pInBss
->
HtCabyL
 == 0) &&

5709 ((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11N_2_4G
|| (pAd->CommCfg.PhyMod=
PHY_11N_5G
)))

5711 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("STA is in N-only Mode,his AP don't have Ht capability in Beacon.\n"));

5715 i((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11GN_MIXED
) &&

5716 ((
pInBss
->
SupReL
 +InBss->
ExtReL
) < 12))

5718 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("STA is in GN-only Mode,his AP is in B mode.\n"));

5725 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

5728 i((
pAd
->
SCfg
.
AuthMode
 !
pInBss
->AuthMode&& (pAd->SCfg.AuthMod!pInBss->
AuthModeAux
))

5733 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPAPSK
))

5736 i(
pInBss
->
WPA
.
bMixMode
 =
FALSE
)

5737 i(
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA
.
GroupCh
)

5741 i((
pAd
->
SCfg
.
WStus
 < 
pInBss
->
WPA
.
GroupCh
) &&

5742 (
pInBss
->
WPA
.
GroupCh
 !
Ndis802_11GroupWEP40Ebd
) &&

5743 (
pInBss
->
WPA
.
GroupCh
 !
Ndis802_11GroupWEP104Ebd
))

5749 i((
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi2Ebd
) &&

5750 (
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA
.
PaCh
) &&

5751 (
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA
.
PaChAux
))

5754 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPA2PSK
))

5757 i(
pInBss
->
WPA2
.
bMixMode
 =
FALSE
)

5758 i(
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA2
.
GroupCh
)

5762 i((
pAd
->
SCfg
.
WStus
 < 
pInBss
->
WPA
.
GroupCh
) &&

5763 (
pInBss
->
WPA2
.
GroupCh
 !
Ndis802_11GroupWEP40Ebd
) &&

5764 (
pInBss
->
WPA2
.
GroupCh
 !
Ndis802_11GroupWEP104Ebd
))

5770 i((
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi2Ebd
) &&

5771 (
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA2
.
PaCh
) &&

5772 (
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA2
.
PaChAux
))

5778 i(
pAd
->
SCfg
.
WStus
 !
pInBss
->WepStatus)

5780 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("SCfg.WStus=%d, whpInBss->WStus=%d\n", 
pAd
->
SCfg
.
WStus
, 
pInBss
->WepStatus));

5784 i(!
pInBss
->
bSES
)

5791 i(
SsidL
 == 0)

5795 
	`NdisMoveMemy
(
pOutBss
, 
pInBss
, (
BSS_ENTRY
));

5797 
OutTab
->
BssNr
++;

5799 i((
pInBss
->
BssTy
 =
pAd
->
SCfg
.BssTy&& (
SsidL
 == 0))

5801 
BSS_ENTRY
 *
pOutBss
 = &
OutTab
->
BssEry
[OutTab->
BssNr
];

5804 #ifde
DOT11_N_SUPPORT


5806 i((
pInBss
->
HtCabyL
 == 0) &&

5807 ((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11N_2_4G
|| (pAd->CommCfg.PhyMod=
PHY_11N_5G
)))

5809 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("STA is in N-only Mode,his AP don't have Ht capability in Beacon.\n"));

5813 i((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11GN_MIXED
) &&

5814 ((
pInBss
->
SupReL
 +InBss->
ExtReL
) < 12))

5816 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("STA is in GN-only Mode,his AP is in B mode.\n"));

5823 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

5826 i((
pAd
->
SCfg
.
AuthMode
 !
pInBss
->AuthMode&& (pAd->SCfg.AuthMod!pInBss->
AuthModeAux
))

5831 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPAPSK
))

5834 i(
pInBss
->
WPA
.
bMixMode
 =
FALSE
)

5835 i(
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA
.
GroupCh
)

5839 i(
pAd
->
SCfg
.
WStus
 < 
pInBss
->
WPA
.
GroupCh
)

5845 i((
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi2Ebd
) &&

5846 (
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA
.
PaCh
) &&

5847 (
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA
.
PaChAux
))

5850 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPA2PSK
))

5853 i(
pInBss
->
WPA2
.
bMixMode
 =
FALSE
)

5854 i(
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA2
.
GroupCh
)

5858 i(
pAd
->
SCfg
.
WStus
 < 
pInBss
->
WPA2
.
GroupCh
)

5864 i((
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi2Ebd
) &&

5865 (
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA2
.
PaCh
) &&

5866 (
pAd
->
SCfg
.
WStus
 !
pInBss
->
WPA2
.
PaChAux
))

5872 i(
pAd
->
SCfg
.
WStus
 !
pInBss
->WepStatus)

5876 
	`NdisMoveMemy
(
pOutBss
, 
pInBss
, (
BSS_ENTRY
));

5878 
OutTab
->
BssNr
++;

5881 i(
OutTab
->
BssNr
 >
MAX_LEN_OF_BSS_TABLE
)

5885 
	`BssTabStByRssi
(
OutTab
);

5886 
	}
}

5890 
VOID
 
	$BssTabStByRssi
(

5891 
IN
 
OUT
 
BSS_TABLE
 *
OutTab
)

5893 
INT
 
i
, 
j
;

5894 
BSS_ENTRY
 *
TmpBss
 = 
NULL
;

5896 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
TmpBss
, (
BSS_ENTRY
));

5897 i(
TmpBss
 =
NULL
)

5900 
i
 = 0; i < 
OutTab
->
BssNr
 - 1; i++)

5902 
j
 = 
i
+1; j < 
OutTab
->
BssNr
; j++)

5904 i(
OutTab
->
BssEry
[
j
].
Rssi
 > OutTab->BssEry[
i
].Rssi)

5906 
	`NdisMoveMemy
(
TmpBss
, &
OutTab
->
BssEry
[
j
], (
BSS_ENTRY
));

5907 
	`NdisMoveMemy
(&
OutTab
->
BssEry
[
j
], &OutTab->BssEry[
i
], (
BSS_ENTRY
));

5908 
	`NdisMoveMemy
(&
OutTab
->
BssEry
[
i
], 
TmpBss
, (
BSS_ENTRY
));

5912 
	`os__mem
(
NULL
, 
TmpBss
);

5913 
	}
}

5917 
VOID
 
	$BssChP
(

5918 
IN
 
OUT
 
PBSS_ENTRY
 
pBss
)

5920 
PEID_STRUCT
 
pEid
;

5921 
PUCHAR
 
pTmp
;

5922 
PRSN_IE_HEADER_STRUCT
 
pRHd
;

5923 
PCIPHER_SUITE_STRUCT
 
pCh
;

5924 
PAKM_SUITE_STRUCT
 
pAKM
;

5925 
USHORT
 
Cou
;

5926 
INT
 
Lgth
;

5927 
NDIS_802_11_ENCRYPTION_STATUS
 
TmpCh
;

5932 i(
pBss
->
Privacy
)

5934 
pBss
->
WStus
 = 
Ndis802_11WEPEbd
;

5938 
pBss
->
WStus
 = 
Ndis802_11WEPDibd
;

5941 
pBss
->
AuthMode
 = 
Ndis802_11AuthModeOn
;

5942 
pBss
->
AuthModeAux
 = 
Ndis802_11AuthModeOn
;

5945 
pBss
->
WPA
.
PaCh
 = 
Ndis802_11WEPDibd
;

5946 
pBss
->
WPA
.
PaChAux
 = 
Ndis802_11WEPDibd
;

5947 
pBss
->
WPA
.
GroupCh
 = 
Ndis802_11WEPDibd
;

5948 
pBss
->
WPA
.
RCaby
 = 0;

5949 
pBss
->
WPA
.
bMixMode
 = 
FALSE
;

5952 
pBss
->
WPA2
.
PaCh
 = 
Ndis802_11WEPDibd
;

5953 
pBss
->
WPA2
.
PaChAux
 = 
Ndis802_11WEPDibd
;

5954 
pBss
->
WPA2
.
GroupCh
 = 
Ndis802_11WEPDibd
;

5955 
pBss
->
WPA2
.
RCaby
 = 0;

5956 
pBss
->
WPA2
.
bMixMode
 = 
FALSE
;

5959 
Lgth
 = (
INT

pBss
->
VIEL
;

5961 
Lgth
 > 0)

5964 
pTmp
 = ((
PUCHAR

pBss
->
VIEs
+Bss->
VIEL
 - 
Lgth
;

5965 
pEid
 = (
PEID_STRUCT

pTmp
;

5966 
pEid
->
Eid
)

5968 
IE_WPA
:

5969 i(
	`NdisEquMemy
(
pEid
->
O
, 
SES_OUI
, 3&& (pEid->
L
 == 7))

5971 
pBss
->
bSES
 = 
TRUE
;

5974 i(
	`NdisEquMemy
(
pEid
->
O
, 
WPA_OUI
, 4) != 1)

5983 
pTmp
 += 11;

5994 *
pTmp
)

5997 
pBss
->
WPA
.
GroupCh
 = 
Ndis802_11GroupWEP40Ebd
;

6000 
pBss
->
WPA
.
GroupCh
 = 
Ndis802_11GroupWEP104Ebd
;

6003 
pBss
->
WPA
.
GroupCh
 = 
Ndis802_11Enyi2Ebd
;

6006 
pBss
->
WPA
.
GroupCh
 = 
Ndis802_11Enyi3Ebd
;

6012 
pTmp
 += 1;

6016 
Cou
 = (
pTmp
[1]<<8) +Tmp[0];

6017 
pTmp
 +(
USHORT
);

6020 
Cou
 > 0)

6023 
pTmp
 += 3;

6024 
TmpCh
 = 
Ndis802_11WEPDibd
;

6025 *
pTmp
)

6029 
TmpCh
 = 
Ndis802_11Enyi1Ebd
;

6032 
TmpCh
 = 
Ndis802_11Enyi2Ebd
;

6035 
TmpCh
 = 
Ndis802_11Enyi3Ebd
;

6040 i(
TmpCh
 > 
pBss
->
WPA
.
PaCh
)

6043 
pBss
->
WPA
.
PaChAux
 =Bss->WPA.
PaCh
;

6044 
pBss
->
WPA
.
PaCh
 = 
TmpCh
;

6048 
pBss
->
WPA
.
PaChAux
 = 
TmpCh
;

6050 
pTmp
++;

6051 
Cou
--;

6056 
Cou
 = (
pTmp
[1]<<8) +Tmp[0];

6057 
pTmp
 +(
USHORT
);

6058 
pTmp
 += 3;

6060 *
pTmp
)

6064 i(
pBss
->
AuthMode
 =
Ndis802_11AuthModeOn
)

6065 
pBss
->
AuthMode
 = 
Ndis802_11AuthModeWPA
;

6067 
pBss
->
AuthModeAux
 = 
Ndis802_11AuthModeWPA
;

6071 i(
pBss
->
AuthMode
 =
Ndis802_11AuthModeOn
)

6072 
pBss
->
AuthMode
 = 
Ndis802_11AuthModeWPAPSK
;

6074 
pBss
->
AuthModeAux
 = 
Ndis802_11AuthModeWPAPSK
;

6079 
pTmp
 += 1;

6082 i(
pBss
->
BssTy
 =
BSS_ADHOC
)

6084 
pBss
->
AuthMode
 = 
Ndis802_11AuthModeWPANe
;

6085 
pBss
->
AuthModeAux
 = 
Ndis802_11AuthModeWPANe
;

6086 
pBss
->
WStus
 =Bss->
WPA
.
GroupCh
;

6088 i(
pBss
->
WPA
.
PaChAux
 =
Ndis802_11WEPDibd
)

6089 
pBss
->
WPA
.
PaChAux
 =Bss->WPA.
GroupCh
;

6092 
pBss
->
WStus
 =Bss->
WPA
.
PaCh
;

6095 i(
pBss
->
WPA
.
GroupCh
 !pBss->WPA.
PaCh
)

6096 
pBss
->
WPA
.
bMixMode
 = 
TRUE
;

6100 
IE_RSN
:

6101 
pRHd
 = (
PRSN_IE_HEADER_STRUCT

pTmp
;

6104 i(
	`2u16
(
pRHd
->
Vsi
) != 1)

6106 
pTmp
 +(
RSN_IE_HEADER_STRUCT
);

6109 
pCh
 = (
PCIPHER_SUITE_STRUCT

pTmp
;

6110 i(!
	`RTMPEquMemy
(
pTmp
, 
RSN_OUI
, 3))

6114 
pCh
->
Ty
)

6117 
pBss
->
WPA2
.
GroupCh
 = 
Ndis802_11GroupWEP40Ebd
;

6120 
pBss
->
WPA2
.
GroupCh
 = 
Ndis802_11GroupWEP104Ebd
;

6123 
pBss
->
WPA2
.
GroupCh
 = 
Ndis802_11Enyi2Ebd
;

6126 
pBss
->
WPA2
.
GroupCh
 = 
Ndis802_11Enyi3Ebd
;

6132 
pTmp
 +(
CIPHER_SUITE_STRUCT
);

6136 
Cou
 = (
pTmp
[1]<<8) +Tmp[0];

6137 
pTmp
 +(
USHORT
);

6141 
Cou
 > 0)

6144 
pCh
 = (
PCIPHER_SUITE_STRUCT

pTmp
;

6145 
TmpCh
 = 
Ndis802_11WEPDibd
;

6146 
pCh
->
Ty
)

6150 
TmpCh
 = 
Ndis802_11Enyi1Ebd
;

6153 
TmpCh
 = 
Ndis802_11Enyi2Ebd
;

6156 
TmpCh
 = 
Ndis802_11Enyi3Ebd
;

6161 i(
TmpCh
 > 
pBss
->
WPA2
.
PaCh
)

6164 
pBss
->
WPA2
.
PaChAux
 =Bss->WPA2.
PaCh
;

6165 
pBss
->
WPA2
.
PaCh
 = 
TmpCh
;

6169 
pBss
->
WPA2
.
PaChAux
 = 
TmpCh
;

6171 
pTmp
 +(
CIPHER_SUITE_STRUCT
);

6172 
Cou
--;

6177 
Cou
 = (
pTmp
[1]<<8) +Tmp[0];

6178 
pTmp
 +(
USHORT
);

6182 
Cou
 > 0)

6184 
pAKM
 = (
PAKM_SUITE_STRUCT

pTmp
;

6185 i(!
	`RTMPEquMemy
(
pTmp
, 
RSN_OUI
, 3))

6188 
pAKM
->
Ty
)

6191 i(
pBss
->
AuthMode
 =
Ndis802_11AuthModeOn
)

6192 
pBss
->
AuthMode
 = 
Ndis802_11AuthModeWPANe
;

6194 
pBss
->
AuthModeAux
 = 
Ndis802_11AuthModeWPANe
;

6198 i(
pBss
->
AuthMode
 =
Ndis802_11AuthModeOn
)

6199 
pBss
->
AuthMode
 = 
Ndis802_11AuthModeWPA2
;

6201 
pBss
->
AuthModeAux
 = 
Ndis802_11AuthModeWPA2
;

6205 i(
pBss
->
AuthMode
 =
Ndis802_11AuthModeOn
)

6206 
pBss
->
AuthMode
 = 
Ndis802_11AuthModeWPA2PSK
;

6208 
pBss
->
AuthModeAux
 = 
Ndis802_11AuthModeWPA2PSK
;

6211 i(
pBss
->
AuthMode
 =
Ndis802_11AuthModeOn
)

6212 
pBss
->
AuthMode
 = 
Ndis802_11AuthModeMax
;

6214 
pBss
->
AuthModeAux
 = 
Ndis802_11AuthModeMax
;

6217 
pTmp
 +(
Cou
 * (
AKM_SUITE_STRUCT
));

6218 
Cou
--;

6222 i(
pBss
->
BssTy
 =
BSS_ADHOC
)

6224 
pBss
->
WPA
.
PaChAux
 =Bss->
WPA2
.PairCipherAux;

6225 
pBss
->
WPA
.
GroupCh
 =Bss->
WPA2
.GroupCipher;

6226 
pBss
->
WStus
 =Bss->
WPA
.
GroupCh
;

6228 i(
pBss
->
WPA
.
PaChAux
 =
Ndis802_11WEPDibd
)

6229 
pBss
->
WPA
.
PaChAux
 =Bss->WPA.
GroupCh
;

6231 
pBss
->
WStus
 =Bss->
WPA2
.
PaCh
;

6235 
pBss
->
WPA2
.
RCaby
 = (
pTmp
[1]<<8) +Tmp[0];

6236 
pTmp
 +(
USHORT
);

6239 i(
pBss
->
WPA2
.
GroupCh
 !pBss->WPA2.
PaCh
)

6240 
pBss
->
WPA2
.
bMixMode
 = 
TRUE
;

6246 
Lgth
 -(
pEid
->
L
 + 2);

6248 
	}
}

6260 
VOID
 
	$MacAddrRdomBssid
(

6261 
IN
 
PRTMP_ADAPTER
 
pAd
,

6262 
OUT
 
PUCHAR
 
pAddr
)

6264 
INT
 
i
;

6266 
i
 = 0; i < 
MAC_ADDR_LEN
; i++)

6268 
pAddr
[
i
] = 
	`RdomBy
(
pAd
);

6271 
pAddr
[0] = (pAddr[0] & 0xfe) | 0x02;

6272 
	}
}

6289 
VOID
 
	$MgtMacHdIn
(

6290 
IN
 
PRTMP_ADAPTER
 
pAd
,

6291 
IN
 
OUT
 
PHEADER_802_11
 
pHdr80211
,

6292 
IN
 
UCHAR
 
SubTy
,

6293 
IN
 
UCHAR
 
ToDs
,

6294 
IN
 
PUCHAR
 
pDA
,

6295 
IN
 
PUCHAR
 
pBssid
)

6297 
	`NdisZoMemy
(
pHdr80211
, (
HEADER_802_11
));

6299 
pHdr80211
->
FC
.
Ty
 = 
BTYPE_MGMT
;

6300 
pHdr80211
->
FC
.
SubTy
 = SubType;

6303 
pHdr80211
->
FC
.
ToDs
 = ToDs;

6304 
	`COPY_MAC_ADDR
(
pHdr80211
->
Addr1
, 
pDA
);

6305 #ifde
CONFIG_STA_SUPPORT


6306 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

6307 
	`COPY_MAC_ADDR
(
pHdr80211
->
Addr2
, 
pAd
->
CutAddss
);

6309 
	`COPY_MAC_ADDR
(
pHdr80211
->
Addr3
, 
pBssid
);

6310 
	}
}

6334 
ULONG
 
	$MakeOutgogFme
(

6335 
OUT
 
UCHAR
 *
Bufr
,

6336 
OUT
 
ULONG
 *
FmeL
, ...)

6338 
UCHAR
 *
p
;

6339 
ng
;

6340 
ULONG
 
TLg
;

6341 
va_li
 
Args
;

6344 
TLg
 = 0;

6345 
	`va_t
(
Args
, 
FmeL
);

6348 
ng
 = 
	`va_g
(
Args
, );

6349 i(
ng
 =
END_OF_ARGS
)

6353 
p
 = 
	`va_g
(
Args
, 
PVOID
);

6354 
	`NdisMoveMemy
(&
Bufr
[
TLg
], 
p
, 
ng
);

6355 
TLg
 = TLg + 
ng
;

6356 } 
TRUE
);

6358 
	`va_d
(
Args
);

6359 *
FmeL
 = 
TLg
;

6360  
TLg
;

6361 
	}
}

6377 
NDIS_STATUS
 
	$MlmeQueueIn
(

6378 
IN
 
MLME_QUEUE
 *
Queue
)

6380 
INT
 
i
;

6382 
	`NdisAoSpLock
(&
Queue
->
Lock
);

6384 
Queue
->
Num
 = 0;

6385 
Queue
->
Hd
 = 0;

6386 
Queue
->
Ta
 = 0;

6388 
i
 = 0; i < 
MAX_LEN_OF_MLME_QUEUE
; i++)

6390 
Queue
->
Ery
[
i
].
Occupd
 = 
FALSE
;

6391 
Queue
->
Ery
[
i
].
MsgL
 = 0;

6392 
	`NdisZoMemy
(
Queue
->
Ery
[
i
].
Msg
, 
MGMT_DMA_BUFFER_SIZE
);

6395  
NDIS_STATUS_SUCCESS
;

6396 
	}
}

6413 
BOOLEAN
 
	$MlmeEnqueue
(

6414 
IN
 
PRTMP_ADAPTER
 
pAd
,

6415 
IN
 
ULONG
 
Mache
,

6416 
IN
 
ULONG
 
MsgTy
,

6417 
IN
 
ULONG
 
MsgL
,

6418 
IN
 
VOID
 *
Msg
,

6419 
IN
 
ULONG
 
Priv
)

6421 
INT
 
Ta
;

6422 
MLME_QUEUE
 *
Queue
 = (MLME_QUEUE *)&
pAd
->
Mlme
.Queue;

6426 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

6427  
FALSE
;

6430 i(
MsgL
 > 
MGMT_DMA_BUFFER_SIZE
)

6432 
	`DBGPRINT_ERR
(("MlmeEnqueue: msgorge, siz%ld \n", 
MsgL
));

6433  
FALSE
;

6436 i(
	`MlmeQueueFu
(
Queue
))

6438  
FALSE
;

6441 
	`NdisAcqueSpLock
(&(
Queue
->
Lock
));

6442 
Ta
 = 
Queue
->Tail;

6443 
Queue
->
Ta
++;

6444 
Queue
->
Num
++;

6445 i(
Queue
->
Ta
 =
MAX_LEN_OF_MLME_QUEUE
)

6447 
Queue
->
Ta
 = 0;

6450 
Queue
->
Ery
[
Ta
].
Wcid
 = 
RESERVED_WCID
;

6451 
Queue
->
Ery
[
Ta
].
Occupd
 = 
TRUE
;

6452 
Queue
->
Ery
[
Ta
].
Mache
 = Machine;

6453 
Queue
->
Ery
[
Ta
].
MsgTy
 = MsgType;

6454 
Queue
->
Ery
[
Ta
].
MsgL
 = MsgLen;

6455 
Queue
->
Ery
[
Ta
].
Priv
 = Priv;

6457 i(
Msg
 !
NULL
)

6459 
	`NdisMoveMemy
(
Queue
->
Ery
[
Ta
].
Msg
, Msg, 
MsgL
);

6462 
	`NdisRSpLock
(&(
Queue
->
Lock
));

6463  
TRUE
;

6464 
	}
}

6480 
BOOLEAN
 
	$MlmeEnqueueFRecv
(

6481 
IN
 
PRTMP_ADAPTER
 
pAd
,

6482 
IN
 
ULONG
 
Wcid
,

6483 
IN
 
ULONG
 
TimeSmpHigh
,

6484 
IN
 
ULONG
 
TimeSmpLow
,

6485 
IN
 
UCHAR
 
Rssi0
,

6486 
IN
 
UCHAR
 
Rssi1
,

6487 
IN
 
UCHAR
 
Rssi2
,

6488 
IN
 
ULONG
 
MsgL
,

6489 
IN
 
VOID
 *
Msg
,

6490 
IN
 
UCHAR
 
Sigl
)

6492 
INT
 
Ta
, 
Mache
;

6493 
PFRAME_802_11
 
pFme
 = (PFRAME_802_11)
Msg
;

6494 
INT
 
MsgTy
;

6495 
MLME_QUEUE
 *
Queue
 = (MLME_QUEUE *)&
pAd
->
Mlme
.Queue;

6497 #ifde
RALINK_ATE


6499 if(
	`ATE_ON
(
pAd
))

6500  
FALSE
;

6505 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

6507 
	`DBGPRINT_ERR
(("MlmeEnqueueForRecv: fRTMP_ADAPTER_HALT_IN_PROGRESS\n"));

6508  
FALSE
;

6512 i(
MsgL
 > 
MGMT_DMA_BUFFER_SIZE
)

6514 
	`DBGPRINT_ERR
(("MlmeEnqueueFRecv: fmtorge, siz%ld \n", 
MsgL
));

6515  
FALSE
;

6518 i(
	`MlmeQueueFu
(
Queue
))

6520  
FALSE
;

6523 #ifde
CONFIG_STA_SUPPORT


6524 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

6526 i(!
	`MsgTySub
(
pAd
, 
pFme
, &
Mache
, &
MsgTy
))

6528 
	`DBGPRINT_ERR
(("MlmeEnqueueFRecv: un-cgnized mgmt->subty=%d\n",
pFme
->
Hdr
.
FC
.
SubTy
));

6529  
FALSE
;

6535 
	`NdisAcqueSpLock
(&(
Queue
->
Lock
));

6536 
Ta
 = 
Queue
->Tail;

6537 
Queue
->
Ta
++;

6538 
Queue
->
Num
++;

6539 i(
Queue
->
Ta
 =
MAX_LEN_OF_MLME_QUEUE
)

6541 
Queue
->
Ta
 = 0;

6543 
Queue
->
Ery
[
Ta
].
Occupd
 = 
TRUE
;

6544 
Queue
->
Ery
[
Ta
].
Mache
 = Machine;

6545 
Queue
->
Ery
[
Ta
].
MsgTy
 = MsgType;

6546 
Queue
->
Ery
[
Ta
].
MsgL
 = MsgLen;

6547 
Queue
->
Ery
[
Ta
].
TimeSmp
.
u
.
LowPt
 = 
TimeSmpLow
;

6548 
Queue
->
Ery
[
Ta
].
TimeSmp
.
u
.
HighPt
 = 
TimeSmpHigh
;

6549 
Queue
->
Ery
[
Ta
].
Rssi0
 = Rssi0;

6550 
Queue
->
Ery
[
Ta
].
Rssi1
 = Rssi1;

6551 
Queue
->
Ery
[
Ta
].
Rssi2
 = Rssi2;

6552 
Queue
->
Ery
[
Ta
].
Sigl
 = Signal;

6553 
Queue
->
Ery
[
Ta
].
Wcid
 = (
UCHAR
)Wcid;

6555 
Queue
->
Ery
[
Ta
].
Chl
 = 
pAd
->
LchRfRegs
.Channel;

6557 i(
Msg
 !
NULL
)

6559 
	`NdisMoveMemy
(
Queue
->
Ery
[
Ta
].
Msg
, Msg, 
MsgL
);

6562 
	`NdisRSpLock
(&(
Queue
->
Lock
));

6564 
	`RTMP_MLME_HANDLER
(
pAd
);

6566  
TRUE
;

6567 
	}
}

6580 
BOOLEAN
 
	$MlmeDequeue
(

6581 
IN
 
MLME_QUEUE
 *
Queue
,

6582 
OUT
 
MLME_QUEUE_ELEM
 **
Em
)

6584 
	`NdisAcqueSpLock
(&(
Queue
->
Lock
));

6585 *
Em
 = &(
Queue
->
Ery
[Queue->
Hd
]);

6586 
Queue
->
Num
--;

6587 
Queue
->
Hd
++;

6588 i(
Queue
->
Hd
 =
MAX_LEN_OF_MLME_QUEUE
)

6590 
Queue
->
Hd
 = 0;

6592 
	`NdisRSpLock
(&(
Queue
->
Lock
));

6593  
TRUE
;

6594 
	}
}

6597 
VOID
 
	$MlmeRetSMache
(

6598 
IN
 
PRTMP_ADAPTER
 
pAd
)

6600 #ifde
RTMP_MAC_PCI


6601 
MLME_QUEUE_ELEM
 *
Em
 = 
NULL
;

6603 #ifde
CONFIG_STA_SUPPORT


6604 
BOOLEAN
 
Ced
;

6607 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeRestartStateMachine \n"));

6609 #ifde
RTMP_MAC_PCI


6610 
	`NdisAcqueSpLock
(&
pAd
->
Mlme
.
TaskLock
);

6611 if(
pAd
->
Mlme
.
bRug
)

6613 
	`NdisRSpLock
(&
pAd
->
Mlme
.
TaskLock
);

6618 
pAd
->
Mlme
.
bRug
 = 
TRUE
;

6620 
	`NdisRSpLock
(&
pAd
->
Mlme
.
TaskLock
);

6623 !
	`MlmeQueueEmy
(&
pAd
->
Mlme
.
Queue
))

6626 i(
	`MlmeDequeue
(&
pAd
->
Mlme
.
Queue
, &
Em
))

6629 
Em
->
Occupd
 = 
FALSE
;

6630 
Em
->
MsgL
 = 0;

6634 
	`DBGPRINT_ERR
(("MlmeRestartStateMachine: MlmeQueuempty\n"));

6639 #ifde
CONFIG_STA_SUPPORT


6640 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

6642 #ifde
QOS_DLS_SUPPORT


6643 
UCHAR
 
i
;

6647 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
AssocTim
, &
Ced
);

6648 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
RssocTim
, &
Ced
);

6649 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
DissocTim
, &
Ced
);

6650 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
AuthTim
, &
Ced
);

6651 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
BcTim
, &
Ced
);

6652 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
SnTim
, &
Ced
);

6654 #ifde
QOS_DLS_SUPPORT


6655 
i
=0; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

6657 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
Ced
);

6664 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

6665 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

6668 
	`RTMPResumeMsduTnsmissi
(
pAd
);

6670 #ifde
CONFIG_STA_SUPPORT


6671 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

6674 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

6675 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

6676 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

6677 
pAd
->
Mlme
.
AuthRMache
.
CuS
 = 
AUTH_RSP_IDLE
;

6678 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

6679 
pAd
->
Mlme
.
AMache
.
CuS
 = 
ACT_IDLE
;

6680 #ifde
QOS_DLS_SUPPORT


6681 
pAd
->
Mlme
.
DlsMache
.
CuS
 = 
DLS_IDLE
;

6687 #ifde
RTMP_MAC_PCI


6689 
	`NdisAcqueSpLock
(&
pAd
->
Mlme
.
TaskLock
);

6690 
pAd
->
Mlme
.
bRug
 = 
FALSE
;

6691 
	`NdisRSpLock
(&
pAd
->
Mlme
.
TaskLock
);

6693 
	}
}

6704 
BOOLEAN
 
	$MlmeQueueEmy
(

6705 
IN
 
MLME_QUEUE
 *
Queue
)

6707 
BOOLEAN
 
Ans
;

6709 
	`NdisAcqueSpLock
(&(
Queue
->
Lock
));

6710 
Ans
 = (
Queue
->
Num
 == 0);

6711 
	`NdisRSpLock
(&(
Queue
->
Lock
));

6713  
Ans
;

6714 
	}
}

6726 
BOOLEAN
 
	$MlmeQueueFu
(

6727 
IN
 
MLME_QUEUE
 *
Queue
)

6729 
BOOLEAN
 
Ans
;

6731 
	`NdisAcqueSpLock
(&(
Queue
->
Lock
));

6732 
Ans
 = (
Queue
->
Num
 =
MAX_LEN_OF_MLME_QUEUE
 || Queue->
Ery
[Queue->
Ta
].
Occupd
);

6733 
	`NdisRSpLock
(&(
Queue
->
Lock
));

6735  
Ans
;

6736 
	}
}

6748 
VOID
 
	$MlmeQueueDeroy
(

6749 
IN
 
MLME_QUEUE
 *
pQueue
)

6751 
	`NdisAcqueSpLock
(&(
pQueue
->
Lock
));

6752 
pQueue
->
Num
 = 0;

6753 
pQueue
->
Hd
 = 0;

6754 
pQueue
->
Ta
 = 0;

6755 
	`NdisRSpLock
(&(
pQueue
->
Lock
));

6756 
	`NdisFeSpLock
(&(
pQueue
->
Lock
));

6757 
	}
}

6771 #ifde
CONFIG_STA_SUPPORT


6772 
BOOLEAN
 
	$MsgTySub
(

6773 
IN
 
PRTMP_ADAPTER
 
pAd
,

6774 
IN
 
PFRAME_802_11
 
pFme
,

6775 
OUT
 
INT
 *
Mache
,

6776 
OUT
 
INT
 *
MsgTy
)

6778 
USHORT
 
Seq
, 
Alg
;

6779 
UCHAR
 
EAPTy
;

6780 
PUCHAR
 
pDa
;

6783 
pDa
 = (
PUCHAR

pFme
 + 
LENGTH_802_11
;

6786 i(
pFme
->
Hdr
.
FC
.
Ty
 =
BTYPE_DATA
)

6789 *
Mache
 = 
WPA_STATE_MACHINE
;

6790 
EAPTy
 = *((
UCHAR
*)
pFme
 + 
LENGTH_802_11
 + 
LENGTH_802_1_H
 + 1);

6791  (
	`WMsgTySub
(
EAPTy
, (
INT
 *
MsgTy
));

6795 
pFme
->
Hdr
.
FC
.
SubTy
)

6797 
SUBTYPE_ASSOC_REQ
:

6798 *
Mache
 = 
ASSOC_STATE_MACHINE
;

6799 *
MsgTy
 = 
MT2_PEER_ASSOC_REQ
;

6801 
SUBTYPE_ASSOC_RSP
:

6802 *
Mache
 = 
ASSOC_STATE_MACHINE
;

6803 *
MsgTy
 = 
MT2_PEER_ASSOC_RSP
;

6805 
SUBTYPE_REASSOC_REQ
:

6806 *
Mache
 = 
ASSOC_STATE_MACHINE
;

6807 *
MsgTy
 = 
MT2_PEER_REASSOC_REQ
;

6809 
SUBTYPE_REASSOC_RSP
:

6810 *
Mache
 = 
ASSOC_STATE_MACHINE
;

6811 *
MsgTy
 = 
MT2_PEER_REASSOC_RSP
;

6813 
SUBTYPE_PROBE_REQ
:

6814 *
Mache
 = 
SYNC_STATE_MACHINE
;

6815 *
MsgTy
 = 
MT2_PEER_PROBE_REQ
;

6817 
SUBTYPE_PROBE_RSP
:

6818 *
Mache
 = 
SYNC_STATE_MACHINE
;

6819 *
MsgTy
 = 
MT2_PEER_PROBE_RSP
;

6821 
SUBTYPE_BEACON
:

6822 *
Mache
 = 
SYNC_STATE_MACHINE
;

6823 *
MsgTy
 = 
MT2_PEER_BEACON
;

6825 
SUBTYPE_ATIM
:

6826 *
Mache
 = 
SYNC_STATE_MACHINE
;

6827 *
MsgTy
 = 
MT2_PEER_ATIM
;

6829 
SUBTYPE_DISASSOC
:

6830 *
Mache
 = 
ASSOC_STATE_MACHINE
;

6831 *
MsgTy
 = 
MT2_PEER_DISASSOC_REQ
;

6833 
SUBTYPE_AUTH
:

6835 
	`NdisMoveMemy
(&
Seq
, &
pFme
->
O
[2], (
USHORT
));

6836 
	`NdisMoveMemy
(&
Alg
, &
pFme
->
O
[0], (
USHORT
));

6837 i(
Seq
 == 1 || Seq == 3)

6839 *
Mache
 = 
AUTH_RSP_STATE_MACHINE
;

6840 *
MsgTy
 = 
MT2_PEER_AUTH_ODD
;

6842 i(
Seq
 == 2 || Seq == 4)

6844 i(
Alg
 =
AUTH_MODE_OPEN
 || Alg =
AUTH_MODE_KEY
)

6846 *
Mache
 = 
AUTH_STATE_MACHINE
;

6847 *
MsgTy
 = 
MT2_PEER_AUTH_EVEN
;

6852  
FALSE
;

6855 
SUBTYPE_DEAUTH
:

6856 *
Mache
 = 
AUTH_RSP_STATE_MACHINE
;

6857 *
MsgTy
 = 
MT2_PEER_DEAUTH
;

6859 
SUBTYPE_ACTION
:

6860 *
Mache
 = 
ACTION_STATE_MACHINE
;

6862 i((
pFme
->
O
[0]&0x7F> 
MAX_PEER_CATE_MSG
)

6864 *
MsgTy
 = 
MT2_ACT_INVALID
;

6868 *
MsgTy
 = (
pFme
->
O
[0]&0x7F);

6872  
FALSE
;

6876  
TRUE
;

6877 
	}
}

6898 
VOID
 
	$SMacheIn
(

6899 
IN
 
STATE_MACHINE
 *
S
,

6900 
IN
 
STATE_MACHINE_FUNC
 
Tns
[],

6901 
IN
 
ULONG
 
StNr
,

6902 
IN
 
ULONG
 
MsgNr
,

6903 
IN
 
STATE_MACHINE_FUNC
 
DefFunc
,

6904 
IN
 
ULONG
 
InS
,

6905 
IN
 
ULONG
 
Ba
)

6907 
ULONG
 
i
, 
j
;

6910 
S
->
NrS
 = 
StNr
;

6911 
S
->
NrMsg
 = 
MsgNr
;

6912 
S
->
Ba
 = Base;

6914 
S
->
TnsFunc
 = 
Tns
;

6917 
i
 = 0; i < 
StNr
; i++)

6919 
j
 = 0; j < 
MsgNr
; j++)

6921 
S
->
TnsFunc
[
i
 * 
MsgNr
 + 
j
] = 
DefFunc
;

6926 
S
->
CuS
 = 
InS
;

6927 
	}
}

6940 
VOID
 
	$SMacheSAi
(

6941 
IN
 
STATE_MACHINE
 *
S
,

6942 
IN
 
ULONG
 
St
,

6943 
IN
 
ULONG
 
Msg
,

6944 
IN
 
STATE_MACHINE_FUNC
 
Func
)

6946 
ULONG
 
MsgIdx
;

6948 
MsgIdx
 = 
Msg
 - 
S
->
Ba
;

6950 i(
St
 < 
S
->
NrS
 && 
MsgIdx
 < S->
NrMsg
)

6953 
S
->
TnsFunc
[
St
 * S->
NrMsg
 + 
MsgIdx
] = 
Func
;

6955 
	}
}

6966 
VOID
 
	$SMachePfmAi
(

6967 
IN
 
PRTMP_ADAPTER
 
pAd
,

6968 
IN
 
STATE_MACHINE
 *
S
,

6969 
IN
 
MLME_QUEUE_ELEM
 *
Em
,

6970 
IN
 
ULONG
 
CuS
)

6973 i(
S
->
TnsFunc
[(
CuS
* S->
NrMsg
 + 
Em
->
MsgTy
 - S->
Ba
])

6974 (*(
S
->
TnsFunc
[(
CuS
* S->
NrMsg
 + 
Em
->
MsgTy
 - S->
Ba
]))(
pAd
, Elem);

6975 
	}
}

6985 
VOID
 
	$Dr
(

6986 
IN
 
PRTMP_ADAPTER
 
pAd
,

6987 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

6989 
	}
}

6996 
UCHAR
 
	$RdomBy
(

6997 
IN
 
PRTMP_ADAPTER
 
pAd
)

6999 
ULONG
 
i
;

7000 
UCHAR
 
R
, 
Resu
;

7002 
R
 = 0;

7004 i(
pAd
->
Mlme
.
ShiReg
 == 0)

7005 
	`NdisGSyemUpTime
((
ULONG
 *)&
pAd
->
Mlme
.
ShiReg
);

7007 
i
 = 0; i < 8; i++)

7009 i(
pAd
->
Mlme
.
ShiReg
 & 0x00000001)

7011 
pAd
->
Mlme
.
ShiReg
 = (Ad->Mlme.ShiReg ^ 
LFSR_MASK
) >> 1) | 0x80000000;

7012 
Resu
 = 1;

7016 
pAd
->
Mlme
.
ShiReg
 =Ad->Mlme.ShiftReg >> 1;

7017 
Resu
 = 0;

7019 
R
 = (R << 1| 
Resu
;

7022  
R
;

7023 
	}
}

7026 
UCHAR
 
	$RdomBy2
(

7027 
IN
 
PRTMP_ADAPTER
 
pAd
)

7029 
UINT32
 
a
,
b
;

7030 
UCHAR
 
vue
, 
vue1
 = 0, 
vue2
 = 0, 
vue3
 = 0, 
vue4
 = 0, 
vue5
 = 0;

7033 
	`RTMP_IO_READ32
(
pAd
, 
RX_STA_CNT1
, &
a
);

7034 
a
 &= 0x0000ffff;

7035 
	`RTMP_IO_READ32
(
pAd
, 
RX_STA_CNT0
, &
b
);

7036 
b
 &= 0x0000ffff;

7037 
vue
 = (
a
<<16)|
b
;

7040 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R50
, &
vue1
);

7041 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R51
, &
vue2
);

7042 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R52
, &
vue3
);

7043 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R53
, &
vue4
);

7044 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R54
, &
vue5
);

7046  
vue
^
vue1
^
vue2
^
vue3
^
vue4
^
vue5
^
	`RdomBy
(
pAd
);

7047 
	}
}

7066 
VOID
 
	$RTMPCheckRes
(

7067 
IN
 
PRTMP_ADAPTER
 
pAd
,

7068 
IN
 
OUT
 
UCHAR
 
SupRe
[],

7069 
IN
 
OUT
 
UCHAR
 *
SupReL
)

7071 
UCHAR
 
ReIdx
, 
i
, 
j
;

7072 
UCHAR
 
NewRe
[12], 
NewReL
;

7074 
NewReL
 = 0;

7076 i(
pAd
->
CommCfg
.
PhyMode
 =
PHY_11B
)

7077 
ReIdx
 = 4;

7079 
ReIdx
 = 12;

7082 
i
 = 0; i < *
SupReL
; i++)

7083 
j
 = 0; j < 
ReIdx
; j++)

7084 i((
SupRe
[
i
] & 0x7f=
ReIdTo500Kbps
[
j
])

7085 
NewRe
[
NewReL
++] = 
SupRe
[
i
];

7087 *
SupReL
 = 
NewReL
;

7088 
	`NdisMoveMemy
(
SupRe
, 
NewRe
, 
NewReL
);

7089 
	}
}

7091 #ifde
CONFIG_STA_SUPPORT


7092 #ifde
DOT11_N_SUPPORT


7093 
BOOLEAN
 
	$RTMPCheckChl
(

7094 
IN
 
PRTMP_ADAPTER
 
pAd
,

7095 
IN
 
UCHAR
 
CChl
,

7096 
IN
 
UCHAR
 
Chl
)

7098 
UCHAR
 
k
;

7099 
UCHAR
 
UChl
 = 0, 
LowChl
 = 0;

7100 
UCHAR
 
NoEfChlLi
 = 0;

7103 i(
CChl
 < 
Chl
)

7105 
UChl
 = 
Chl
;

7106 i(
CChl
 > 2)

7107 
LowChl
 = 
CChl
 - 2;

7109  
FALSE
;

7111 i(
CChl
 > 
Chl
)

7113 
UChl
 = 
CChl
 + 2;

7114 
LowChl
 = 
Chl
;

7117 
k
 = 0;k < 
pAd
->
ChlLiNum
;k++)

7119 i(
pAd
->
ChlLi
[
k
].
Chl
 =
UChl
)

7121 
NoEfChlLi
 ++;

7123 i(
pAd
->
ChlLi
[
k
].
Chl
 =
LowChl
)

7125 
NoEfChlLi
 ++;

7129 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Tٮ ChȚ ChLi = [%d]\n", 
NoEfChlLi
));

7130 i(
NoEfChlLi
 == 2)

7131  
TRUE
;

7133  
FALSE
;

7134 
	}
}

7152 
BOOLEAN
 
	$RTMPCheckHt
(

7153 
IN
 
PRTMP_ADAPTER
 
pAd
,

7154 
IN
 
UCHAR
 
Wcid
,

7155 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

7156 
IN
 
ADD_HT_INFO_IE
 *
pAddHtInfo
)

7158 i(
Wcid
 >
MAX_LEN_OF_MAC_TABLE
)

7159  
FALSE
;

7162 i(
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduEb
)

7163 
	`CLIENT_STATUS_SET_FLAG
(&
pAd
->
MacTab
.
Cڋ
[
Wcid
], 
fCLIENT_STATUS_AMSDU_INUSED
);

7165 i(
pHtCaby
->
HtCInfo
.
ShtGIf20
)

7166 
	`CLIENT_STATUS_SET_FLAG
(&
pAd
->
MacTab
.
Cڋ
[
Wcid
], 
fCLIENT_STATUS_SGI20_CAPABLE
);

7167 i(
pHtCaby
->
HtCInfo
.
ShtGIf40
)

7168 
	`CLIENT_STATUS_SET_FLAG
(&
pAd
->
MacTab
.
Cڋ
[
Wcid
], 
fCLIENT_STATUS_SGI40_CAPABLE
);

7169 i(
pHtCaby
->
HtCInfo
.
TxSTBC
)

7170 
	`CLIENT_STATUS_SET_FLAG
(&
pAd
->
MacTab
.
Cڋ
[
Wcid
], 
fCLIENT_STATUS_TxSTBC_CAPABLE
);

7171 i(
pHtCaby
->
HtCInfo
.
RxSTBC
)

7172 
	`CLIENT_STATUS_SET_FLAG
(&
pAd
->
MacTab
.
Cڋ
[
Wcid
], 
fCLIENT_STATUS_RxSTBC_CAPABLE
);

7173 i(
pAd
->
CommCfg
.
bRdg
 && 
pHtCaby
->
ExtHtCInfo
.
RDGSut
)

7175 
	`CLIENT_STATUS_SET_FLAG
(&
pAd
->
MacTab
.
Cڋ
[
Wcid
], 
fCLIENT_STATUS_RDG_CAPABLE
);

7178 i(
Wcid
 < 
MAX_LEN_OF_MAC_TABLE
)

7180 
pAd
->
MacTab
.
Cڋ
[
Wcid
].
MpduDsy
 = 
pHtCaby
->
HtCPm
.MpduDensity;

7184 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[0] = 0xff;

7185 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[2] = 0x00;

7186 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[4] = 0x1;

7187 
pAd
->
CommCfg
.
RxSm
)

7190 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[0] = 0xff;

7191 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[1] = 0x00;

7192 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[2] = 0x00;

7193 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[3] = 0x00;

7196 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[0] = 0xff;

7197 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[1] = 0xff;

7198 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[2] = 0x00;

7199 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[3] = 0x00;

7202 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[0] = 0xff;

7203 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[1] = 0xff;

7204 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[2] = 0xff;

7205 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[3] = 0x00;

7209 
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
 = 
pAddHtInfo
->
AddHtInfo
.
RecomWidth
 &Ad->
CommCfg
.
DesedHtPhy
.ChannelWidth;

7215 i(
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
)

7217 i(
	`RTMPCheckChl
(
pAd
,Ad->
MlmeAux
.
CChl
,Ad->MlmeAux.
Chl
=
FALSE
)

7219 
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
 = 
BW_20
;

7223 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPCheckHt:: HtCapInfo.ChannelWidth=%d, RecomWidth=%d, DesiredHtPhy.ChannelWidth=%d, BW40MAvailForA/G=%d/%d, PhyMode=%d \n",

7224 
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
, 
pAddHtInfo
->
AddHtInfo
.
RecomWidth
,Ad->
CommCfg
.
DesedHtPhy
.ChannelWidth,

7225 
pAd
->
NicCfig2
.
fld
.
BW40MAvaFA
,Ad->NicCfig2.fld.
BW40MAvaFG
,Ad->
CommCfg
.
PhyMode
));

7227 
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
GF
 = 
pHtCaby
->HtCInfo.GF &pAd->
CommCfg
.
DesedHtPhy
.GF;

7230 
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
AMsduSize
 =Ad->
CommCfg
.
DesedHtPhy
.
AmsduSize
;

7231 
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
MimoPs
 =Ad->
CommCfg
.
DesedHtPhy
.MimoPs;

7232 
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ShtGIf20
 = (pAd->
CommCfg
.
DesedHtPhy
.ShtGIf20& (
pHtCaby
->HtCapInfo.ShortGIfor20);

7233 
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ShtGIf40
 = (pAd->
CommCfg
.
DesedHtPhy
.ShtGIf40& (
pHtCaby
->HtCapInfo.ShortGIfor40);

7234 
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
TxSTBC
 = (pAd->
CommCfg
.
DesedHtPhy
.TxSTBC)&(
pHtCaby
->HtCInfo.
RxSTBC
);

7235 
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
RxSTBC
 = (pAd->
CommCfg
.
DesedHtPhy
.RxSTBC)&(
pHtCaby
->HtCInfo.
TxSTBC
);

7236 
pAd
->
MlmeAux
.
HtCaby
.
HtCPm
.
MaxRAmpduFa
 =Ad->
CommCfg
.
DesedHtPhy
.MaxRAmpduFactor;

7237 
pAd
->
MlmeAux
.
HtCaby
.
HtCPm
.
MpduDsy
 =Ad->
CommCfg
.HtCapability.HtCapParm.MpduDensity;

7238 
pAd
->
MlmeAux
.
HtCaby
.
ExtHtCInfo
.
PlusHTC
 = 
pHtCaby
->ExtHtCapInfo.PlusHTC;

7239 
pAd
->
MacTab
.
Cڋ
[
Wcid
].
HTCaby
.
ExtHtCInfo
.
PlusHTC
 = 
pHtCaby
->ExtHtCapInfo.PlusHTC;

7240 i(
pAd
->
CommCfg
.
bRdg
)

7242 
pAd
->
MlmeAux
.
HtCaby
.
ExtHtCInfo
.
RDGSut
 = 
pHtCaby
->ExtHtCapInfo.RDGSupport;

7243 
pAd
->
MlmeAux
.
HtCaby
.
ExtHtCInfo
.
PlusHTC
 = 1;

7246 i(
pAd
->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_20
)

7247 
pAd
->
MlmeAux
.
HtCaby
.
MCSS
[4] = 0x0;

7249 
	`COPY_AP_HTSETTINGS_FROM_BEACON
(
pAd
, 
pHtCaby
);

7250  
TRUE
;

7251 
	}
}

7271 
VOID
 
	$RTMPUpdeMlmeRe
(

7272 
IN
 
PRTMP_ADAPTER
 
pAd
)

7274 
UCHAR
 
MimumRe
;

7275 
UCHAR
 
PrݔMlmeRe
;

7276 
UCHAR
 
i
, 
j
, 
ReIdx
 = 12;

7277 
BOOLEAN
 
bMch
 = 
FALSE
;

7279 
pAd
->
CommCfg
.
PhyMode
)

7281 
PHY_11B
:

7282 
PrݔMlmeRe
 = 
RATE_11
;

7283 
MimumRe
 = 
RATE_1
;

7285 
PHY_11BG_MIXED
:

7286 #ifde
DOT11_N_SUPPORT


7287 
PHY_11ABGN_MIXED
:

7288 
PHY_11BGN_MIXED
:

7290 i((
pAd
->
MlmeAux
.
SupReL
 == 4) &&

7291 (
pAd
->
MlmeAux
.
ExtReL
 == 0))

7293 
PrݔMlmeRe
 = 
RATE_11
;

7295 
PrݔMlmeRe
 = 
RATE_24
;

7297 i(
pAd
->
MlmeAux
.
Chl
 <= 14)

7298 
MimumRe
 = 
RATE_1
;

7300 
MimumRe
 = 
RATE_6
;

7302 
PHY_11A
:

7303 #ifde
DOT11_N_SUPPORT


7304 
PHY_11N_2_4G
:

7305 
PHY_11GN_MIXED
:

7306 
PHY_11AGN_MIXED
:

7307 
PHY_11AN_MIXED
:

7308 
PHY_11N_5G
:

7310 
PrݔMlmeRe
 = 
RATE_24
;

7311 
MimumRe
 = 
RATE_6
;

7313 
PHY_11ABG_MIXED
:

7314 
PrݔMlmeRe
 = 
RATE_24
;

7315 i(
pAd
->
MlmeAux
.
Chl
 <= 14)

7316 
MimumRe
 = 
RATE_1
;

7318 
MimumRe
 = 
RATE_6
;

7321 
PrݔMlmeRe
 = 
RATE_1
;

7322 
MimumRe
 = 
RATE_1
;

7326 
i
 = 0; i < 
pAd
->
MlmeAux
.
SupReL
; i++)

7328 
j
 = 0; j < 
ReIdx
; j++)

7330 i((
pAd
->
MlmeAux
.
SupRe
[
i
] & 0x7f=
ReIdTo500Kbps
[
j
])

7332 i(
j
 =
PrݔMlmeRe
)

7334 
bMch
 = 
TRUE
;

7340 i(
bMch
)

7344 i(
bMch
 =
FALSE
)

7346 
i
 = 0; i < 
pAd
->
MlmeAux
.
ExtReL
; i++)

7348 
j
 = 0; j < 
ReIdx
; j++)

7350 i((
pAd
->
MlmeAux
.
ExtRe
[
i
] & 0x7f=
ReIdTo500Kbps
[
j
])

7352 i(
j
 =
PrݔMlmeRe
)

7354 
bMch
 = 
TRUE
;

7360 i(
bMch
)

7365 i(
bMch
 =
FALSE
)

7367 
PrݔMlmeRe
 = 
MimumRe
;

7370 
pAd
->
CommCfg
.
MlmeRe
 = 
MimumRe
;

7371 
pAd
->
CommCfg
.
RtsRe
 = 
PrݔMlmeRe
;

7372 i(
pAd
->
CommCfg
.
MlmeRe
 >
RATE_6
)

7374 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 
MODE_OFDM
;

7375 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pAd->CommCfg.
MlmeRe
];

7376 
pAd
->
MacTab
.
Cڋ
[
BSS0M_WCID
].
HTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

7377 
pAd
->
MacTab
.
Cڋ
[
BSS0M_WCID
].
HTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pAd->
CommCfg
.
MlmeRe
];

7381 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 
MODE_CCK
;

7382 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
 =Ad->CommCfg.
MlmeRe
;

7383 
pAd
->
MacTab
.
Cڋ
[
BSS0M_WCID
].
HTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

7384 
pAd
->
MacTab
.
Cڋ
[
BSS0M_WCID
].
HTPhyMode
.
fld
.
MCS
 =Ad->
CommCfg
.
MlmeRe
;

7387 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPUpdeMlmeR==> MlmeTnsm = 0x%x \n" , 
pAd
->
CommCfg
.
MlmeTnsm
.
wd
));

7388 
	}
}

7390 
CHAR
 
	$RTMPMaxRssi
(

7391 
IN
 
PRTMP_ADAPTER
 
pAd
,

7392 
IN
 
CHAR
 
Rssi0
,

7393 
IN
 
CHAR
 
Rssi1
,

7394 
IN
 
CHAR
 
Rssi2
)

7396 
CHAR
 
rg
 = -127;

7398 i((
pAd
->
A
.
fld
.
RxPh
 =1&& (
Rssi0
 != 0))

7400 
rg
 = 
Rssi0
;

7403 i((
pAd
->
A
.
fld
.
RxPh
 >2&& (
Rssi1
 != 0))

7405 
rg
 = 
	`max
(
Rssi0
, 
Rssi1
);

7408 i((
pAd
->
A
.
fld
.
RxPh
 =3&& (
Rssi2
 != 0))

7410 
rg
 = 
	`max
֬g, 
Rssi2
);

7413 i(
rg
 == -127)

7414 
rg
 = 0;

7416  
rg
;

7417 
	}
}

7420 
CHAR
 
	$RTMPMS
(

7421 
IN
 
PRTMP_ADAPTER
 
pAd
,

7422 
IN
 
CHAR
 
S0
,

7423 
IN
 
CHAR
 
S1
)

7425 
CHAR
 
smr
 = 
S0
;

7427 i(
pAd
->
A
.
fld
.
RxPh
 == 1)

7429 
smr
 = 
S0
;

7432 i((
pAd
->
A
.
fld
.
RxPh
 >2&& (
S1
 != 0))

7434 
smr
 = 
	`m
(
S0
, 
S1
);

7437  
smr
;

7438 
	}
}

7453 
VOID
 
	$AsicEvueRxA
(

7454 
IN
 
PRTMP_ADAPTER
 
pAd
)

7456 #ifde
CONFIG_STA_SUPPORT


7457 
UCHAR
 
BBPR3
 = 0;

7460 #ifde
RALINK_ATE


7461 i(
	`ATE_ON
(
pAd
))

7465 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RESET_IN_PROGRESS
 |

7466 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 |

7467 
fRTMP_ADAPTER_RADIO_OFF
 |

7468 
fRTMP_ADAPTER_NIC_NOT_EXIST
 |

7469 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
) ||

7470 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
)

7475 #ifde
CONFIG_STA_SUPPORT


7476 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

7479 i(
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
)

7482 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BBPR3
);

7483 
BBPR3
 &= (~0x18);

7484 if(
pAd
->
A
.
fld
.
RxPh
 == 3)

7486 
BBPR3
 |= (0x10);

7488 if(
pAd
->
A
.
fld
.
RxPh
 == 2)

7490 
BBPR3
 |= (0x8);

7492 if(
pAd
->
A
.
fld
.
RxPh
 == 1)

7494 
BBPR3
 |= (0x0);

7496 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BBPR3
);

7497 #ifde
RTMP_MAC_PCI


7498 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

7499 
pAd
->
SCfg
.
BBPR3
 = BBPR3;

7501 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
)

7504 
ULONG
 
TxTٮC
 = 
pAd
->
RkCous
.
OSecTxNoRryOkCou
 +

7505 
pAd
->
RkCous
.
OSecTxRryOkCou
 +

7506 
pAd
->
RkCous
.
OSecTxFaCou
;

7509 i(
TxTٮC
 > 50)

7511 
	`RTMPSTim
(&
pAd
->
Mlme
.
RxAEvTim
, 20);

7512 
pAd
->
Mlme
.
bLowThroughput
 = 
FALSE
;

7516 
	`RTMPSTim
(&
pAd
->
Mlme
.
RxAEvTim
, 300);

7517 
pAd
->
Mlme
.
bLowThroughput
 = 
TRUE
;

7523 
	}
}

7538 
VOID
 
	$AsicRxAEvTimeout
(

7539 
IN
 
PVOID
 
SyemScific1
,

7540 
IN
 
PVOID
 
FuniCڋxt
,

7541 
IN
 
PVOID
 
SyemScific2
,

7542 
IN
 
PVOID
 
SyemScific3
)

7544 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

7545 #ifde
CONFIG_STA_SUPPORT


7546 
UCHAR
 
BBPR3
 = 0;

7547 
CHAR
 
rg
 = -127, 
rssi0
, 
rssi1
, 
rssi2
;

7552 #ifde
RALINK_ATE


7553 i(
	`ATE_ON
(
pAd
))

7557 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RESET_IN_PROGRESS
 |

7558 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 |

7559 
fRTMP_ADAPTER_RADIO_OFF
 |

7560 
fRTMP_ADAPTER_NIC_NOT_EXIST
) ||

7561 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
)

7566 #ifde
CONFIG_STA_SUPPORT


7567 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

7569 i(
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
)

7574 i(
pAd
->
Mlme
.
bLowThroughput
 =
TRUE
)

7576 
rssi0
 = 
pAd
->
SCfg
.
RssiSame
.
LaRssi0
;

7577 
rssi1
 = 
pAd
->
SCfg
.
RssiSame
.
LaRssi1
;

7578 
rssi2
 = 
pAd
->
SCfg
.
RssiSame
.
LaRssi2
;

7582 
rssi0
 = 
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
;

7583 
rssi1
 = 
pAd
->
SCfg
.
RssiSame
.
AvgRssi1
;

7584 
rssi2
 = 
pAd
->
SCfg
.
RssiSame
.
AvgRssi2
;

7587 if(
pAd
->
A
.
fld
.
RxPh
 == 3)

7589 
rg
 = 
	`max
(
rssi0
, 
rssi1
);

7590 i(
rg
 > (
rssi2
 + 20))

7591 
pAd
->
Mlme
.
RlRxPh
 = 2;

7593 
pAd
->
Mlme
.
RlRxPh
 = 3;

7595 if(
pAd
->
A
.
fld
.
RxPh
 == 2)

7597 i(
rssi0
 > (
rssi1
 + 20))

7598 
pAd
->
Mlme
.
RlRxPh
 = 1;

7600 
pAd
->
Mlme
.
RlRxPh
 = 2;

7603 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BBPR3
);

7604 
BBPR3
 &= (~0x18);

7605 if(
pAd
->
Mlme
.
RlRxPh
 == 3)

7607 
BBPR3
 |= (0x10);

7609 if(
pAd
->
Mlme
.
RlRxPh
 == 2)

7611 
BBPR3
 |= (0x8);

7613 if(
pAd
->
Mlme
.
RlRxPh
 == 1)

7615 
BBPR3
 |= (0x0);

7617 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BBPR3
);

7618 #ifde
RTMP_MAC_PCI


7619 
pAd
->
SCfg
.
BBPR3
 = BBPR3;

7624 
	}
}

7627 
VOID
 
	$APSDPiodicExec
(

7628 
IN
 
PVOID
 
SyemScific1
,

7629 
IN
 
PVOID
 
FuniCڋxt
,

7630 
IN
 
PVOID
 
SyemScific2
,

7631 
IN
 
PVOID
 
SyemScific3
)

7633 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

7635 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
))

7638 
pAd
->
CommCfg
.
TriggTimCou
++;

7652 
	}
}

7668 
VOID
 
	$RTMPSPiggyBack
(

7669 
IN
 
PRTMP_ADAPTER
 
pAd
,

7670 
IN
 
BOOLEAN
 
bPiggyBack
)

7672 
TX_LINK_CFG_STRUC
 
TxLkCfg
;

7674 
	`RTMP_IO_READ32
(
pAd
, 
TX_LINK_CFG
, &
TxLkCfg
.
wd
);

7676 
TxLkCfg
.
fld
.
TxCFAckEn
 = 
bPiggyBack
;

7677 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_LINK_CFG
, 
TxLkCfg
.
wd
);

7678 
	}
}

7695 
BOOLEAN
 
	$RTMPCheckEryEbAutoReSwch
(

7696 
IN
 
PRTMP_ADAPTER
 
pAd
,

7697 
IN
 
PMAC_TABLE_ENTRY
 
pEry
)

7699 
BOOLEAN
 
su
 = 
TRUE
;

7702 #ifde
CONFIG_STA_SUPPORT


7703 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

7706 i((
pEry
 && 
	`IS_ENTRY_CLIENT
Ery&& (pEry->
S
 =
SST_ASSOC
))

7707 #ifde
QOS_DLS_SUPPORT


7708 || (
pEry
 && 
	`IS_ENTRY_DLS
(pEntry))

7712 
su
 = 
pAd
->
SCfg
.
bAutoTxReSwch
;

7715 
su
 = 
FALSE
;

7721  
su
;

7722 
	}
}

7725 
BOOLEAN
 
	$RTMPAutoReSwchCheck
(

7726 
IN
 
PRTMP_ADAPTER
 
pAd
)

7729 #ifde
CONFIG_STA_SUPPORT


7730 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

7732 i(
pAd
->
SCfg
.
bAutoTxReSwch
)

7733  
TRUE
;

7736  
FALSE
;

7737 
	}
}

7755 
UCHAR
 
	$RTMPSFixedTxMode
(

7756 
IN
 
PRTMP_ADAPTER
 
pAd
,

7757 
IN
 
PMAC_TABLE_ENTRY
 
pEry
)

7759 
UCHAR
 
tx_mode
 = 
FIXED_TXMODE_HT
;

7762 #ifde
CONFIG_STA_SUPPORT


7763 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

7765 
tx_mode
 = (
UCHAR
)
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
;

7769  
tx_mode
;

7770 
	}
}

7787 
VOID
 
	$RTMPUpdeLegacyTxStg
(

7788 
UCHAR
 
fixed_tx_mode
,

7789 
PMAC_TABLE_ENTRY
 
pEry
)

7791 
HTTRANSMIT_SETTING
 
TnsmStg
;

7793 i(
fixed_tx_mode
 =
FIXED_TXMODE_HT
)

7796 
TnsmStg
.
wd
 = 0;

7798 
TnsmStg
.
fld
.
MODE
 = 
pEry
->
HTPhyMode
.field.MODE;

7799 
TnsmStg
.
fld
.
MCS
 = 
pEry
->
HTPhyMode
.field.MCS;

7801 i(
fixed_tx_mode
 =
FIXED_TXMODE_CCK
)

7803 
TnsmStg
.
fld
.
MODE
 = 
MODE_CCK
;

7805 i(
TnsmStg
.
fld
.
MCS
 > 
MCS_3
)

7806 
TnsmStg
.
fld
.
MCS
 = 
MCS_3
;

7810 
TnsmStg
.
fld
.
MODE
 = 
MODE_OFDM
;

7812 i(
TnsmStg
.
fld
.
MCS
 > 
MCS_7
)

7813 
TnsmStg
.
fld
.
MCS
 = 
MCS_7
;

7816 i(
pEry
->
HTPhyMode
.
fld
.
MODE
 >
TnsmStg
.field.MODE)

7818 
pEry
->
HTPhyMode
.
wd
 = 
TnsmStg
.word;

7819 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPUpdateLegacyTxSetting : wcid-%d, MODE=%s, MCS=%d \n",

7820 
pEry
->
Aid
, 
	`GPhyMode
Ery->
HTPhyMode
.
fld
.
MODE
),Ery->HTPhyMode.fld.
MCS
));

7824 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%:hfixed TxModivid \n", 
__FUNCTION__
));

7826 
	}
}

7828 #ifde
CONFIG_STA_SUPPORT


7839 
VOID
 
	$AsicSBbpTung
(

7840 
IN
 
PRTMP_ADAPTER
 
pAd
)

7842 
UCHAR
 
OrigR66Vue
 = 0, 
R66
;

7843 
CHAR
 
Rssi
;

7846 i(
pAd
->
MACVsi
 == 0x28600100)

7852 i(
pAd
->
Mlme
.
ClMache
.
CuS
 !
CNTL_IDLE
)

7855 i((
pAd
->
OpMode
 =
OPMODE_STA
)

7856 && (
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
)

7858 && !(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

7859 #ifde
RTMP_MAC_PCI


7860 && (
pAd
->
bPCIkOff
 =
FALSE
)

7864 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R66
, &
OrigR66Vue
);

7865 
R66
 = 
OrigR66Vue
;

7867 i(
pAd
->
A
.
fld
.
RxPh
 > 1)

7868 
Rssi
 = (
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
 +Ad->SCfg.RssiSame.
AvgRssi1
) >> 1;

7870 
Rssi
 = 
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
;

7872 i(
pAd
->
LchRfRegs
.
Chl
 <= 14)

7875 i(
Rssi
 > 
RSSI_FOR_MID_LOW_SENSIBILITY
)

7877 
R66
 = (0x2E + 
	`GET_LNA_GAIN
(
pAd
)) + 0x10;

7878 i(
OrigR66Vue
 !
R66
)

7880 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

7885 
R66
 = 0x2E + 
	`GET_LNA_GAIN
(
pAd
);

7886 i(
OrigR66Vue
 !
R66
)

7888 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

7895 i(
pAd
->
CommCfg
.
BBPCutBW
 =
BW_20
)

7897 i(
Rssi
 > 
RSSI_FOR_MID_LOW_SENSIBILITY
)

7899 
R66
 = 0x32 + (
	`GET_LNA_GAIN
(
pAd
)*5)/3 + 0x10;

7901 i(
OrigR66Vue
 !
R66
)

7903 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

7908 
R66
 = 0x32 + (
	`GET_LNA_GAIN
(
pAd
)*5)/3;

7911 i(
OrigR66Vue
 !
R66
)

7913 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

7919 i(
Rssi
 > 
RSSI_FOR_MID_LOW_SENSIBILITY
)

7921 
R66
 = 0x3A + (
	`GET_LNA_GAIN
(
pAd
)*5)/3 + 0x10;

7923 i(
OrigR66Vue
 !
R66
)

7925 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

7930 
R66
 = 0x3A + (
	`GET_LNA_GAIN
(
pAd
)*5)/3;

7932 i(
OrigR66Vue
 !
R66
)

7934 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

7942 
	}
}

7945 
VOID
 
	$RTMPSAGCInVue
(

7946 
IN
 
PRTMP_ADAPTER
 
pAd
,

7947 
IN
 
UCHAR
 
BdWidth
)

7949 
UCHAR
 
R66
 = 0x30;

7951 i(
pAd
->
LchRfRegs
.
Chl
 <= 14)

7954 
R66
 = 0x2E + 
	`GET_LNA_GAIN
(
pAd
);

7955 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

7961 i(
BdWidth
 =
BW_20
)

7963 
R66
 = (
UCHAR
)(0x32 + (
	`GET_LNA_GAIN
(
pAd
)*5)/3);

7965 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

7967 #ifde
DOT11_N_SUPPORT


7970 
R66
 = (
UCHAR
)(0x3A + (
	`GET_LNA_GAIN
(
pAd
)*5)/3);

7972 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

7978 
	}
}

7998 
BOOLEAN
 
	$CHAN_PrݔtyCheck
(

7999 
IN
 
PRTMP_ADAPTER
 
pAd
,

8000 
IN
 
UINT32
 
ChNum
,

8001 
IN
 
UCHAR
 
Prݔty
)

8003 
UINT32
 
IdCh
;

8007 
IdCh
=0; IdCh<
pAd
->
ChlLiNum
; IdChan++)

8009 i(
pAd
->
ChlLi
[
IdCh
].
Chl
 =
ChNum
)

8011 i((
pAd
->
ChlLi
[
IdCh
].
Fgs
 & 
Prݔty
) == Property)

8012  
TRUE
;

8019  
FALSE
;

8020 
	}
}

	@common/netif_block.c

27 #ifde
BLOCK_NET_IF


29 
	~"_cfig.h
"

30 
	~"tif_block.h
"

32 
NETIF_ENTRY
 
	gNIfEryPo
[
FREE_NETIF_POOL_SIZE
];

33 
LIST_HEADER
 
	gNIfEryLi
;

35 
	$blockQueueTab
(

36 
IN
 
PRTMP_ADAPTER
 
pAd
)

38 
i
;

40 
	`Li
(&
NIfEryLi
);

41 
i
 = 0; i < 
FREE_NETIF_POOL_SIZE
; i++)

42 
	`TaLi
(&
NIfEryLi
, (
PLIST_ENTRY
)&
NIfEryPo
[
i
]);

44 
i
=0; i < 
NUM_OF_TX_RING
; i++)

45 
	`Li
(&
pAd
->
blockQueueTab
[
i
].
NIfLi
);

48 
	}
}

50 
BOOLEAN
 
	$blockNIf
(

51 
IN
 
PBLOCK_QUEUE_ENTRY
 
pBlockQueueEry
,

52 
IN
 
PNET_DEV
 
pNDev
)

54 
PNETIF_ENTRY
 
pNIfEry
 = 
NULL
;

56 i((
pNIfEry
 = (
PNETIF_ENTRY
)
	`moveHdLi
(&
NIfEryLi
)!
NULL
)

58 
	`RTMP_OS_NETDEV_STOP_QUEUE
(
pNDev
);

59 
pNIfEry
->
pNDev
 =NetDev;

60 
	`TaLi
(&
pBlockQueueEry
->
NIfLi
, (
PLIST_ENTRY
)
pNIfEry
);

62 
pBlockQueueEry
->
SwTxQueueBlockFg
 = 
TRUE
;

63 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMP_OS_NETDEV_STOP_QUEUE(%s)\n", 
	`RTMP_OS_NETDEV_GET_DEVNAME
(
pNDev
)));

66  
FALSE
;

68  
TRUE
;

69 
	}
}

71 
VOID
 
	$aNIf
(

72 
IN
 
PBLOCK_QUEUE_ENTRY
 
pBlockQueueEry
)

74 
PNETIF_ENTRY
 
pNIfEry
 = 
NULL
;

75 
PLIST_HEADER
 
pNIfLi
 = &
pBlockQueueEry
->
NIfLi
;

77 (
pNIfEry
 = (
PNETIF_ENTRY
)
	`moveHdLi
(
pNIfLi
)!
NULL
)

79 
PNET_DEV
 
pNDev
 = 
pNIfEry
->pNetDev;

80 
	`RTMP_OS_NETDEV_WAKE_QUEUE
(
pNDev
);

81 
	`TaLi
(&
NIfEryLi
, (
PLIST_ENTRY
)
pNIfEry
);

83 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMP_OS_NETDEV_WAKE_QUEUE(%s)\n", 
	`RTMP_OS_NETDEV_GET_DEVNAME
(
pNDev
)));

85 
pBlockQueueEry
->
SwTxQueueBlockFg
 = 
FALSE
;

87 
	}
}

90 
VOID
 
	$StNIfQueue
(

91 
IN
 
PRTMP_ADAPTER
 
pAd
,

92 
IN
 
UCHAR
 
QueIdx
,

93 
IN
 
PNDIS_PACKET
 
pPack
)

95 
PNET_DEV
 
NDev
 = 
NULL
;

96 
UCHAR
 
IfIdx
 = 0;

97 
BOOLEAN
 
vid
 = 
FALSE
;

99 #ifde
WDS_SUPPORT


100 i(
	`RTMP_GET_PACKET_NET_DEVICE
(
pPack
>
MIN_NET_DEVICE_FOR_WDS
)

102 
IfIdx
 = (
	`RTMP_GET_PACKET_NET_DEVICE
(
pPack
- 
MIN_NET_DEVICE_FOR_WDS
% 
MAX_WDS_ENTRY
;

103 
NDev
 = 
pAd
->
WdsTab
.
WdsEry
[
IfIdx
].
dev
;

108 #ifde
MBSS_SUPPORT


109 i(
pAd
->
OpMode
 =
OPMODE_AP
)

111 
IfIdx
 = (
	`RTMP_GET_PACKET_NET_DEVICE
(
pPack
- 
MIN_NET_DEVICE_FOR_MBSSID
% 
MAX_MBSSID_NUM
;

112 
NDev
 = 
pAd
->
ApCfg
.
MBSSID
[
IfIdx
].
MSSIDDev
;

116 
IfIdx
 = 
MAIN_MBSSID
;

117 
NDev
 = 
pAd
->
t_dev
;

120 
IfIdx
 = 
MAIN_MBSSID
;

121 
NDev
 = 
pAd
->
t_dev
;

128 #ifde
CONFIG_STA_SUPPORT


129 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

130 
vid
 = (
pAd
->
CommCfg
.
bWmmCab
 =
TRUE
? 
FALSE
 : TRUE;

133 i(
vid
)

134 
	`blockNIf
(&
pAd
->
blockQueueTab
[
QueIdx
], 
NDev
);

136 
	}
}

	@common/rt_ate.c

28 
	~"_cfig.h
"

29 #ifde
LINUX


30 
	~"lux/time.h
"

34 #i
defed
(
RT30xx
|| defed(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

35 
	#ATE_BBP_REG_NUM
 168

	)

36 
UCHAR
 
	ge_BBP
[
ATE_BBP_REG_NUM
]={0};

40 
UCHAR
 
	gTemeFme
[24] = {0x08,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,

43 
RTMP_RF_REGS
 
RF2850RegTab
[];

44 
UCHAR
 
NUM_OF_2850_CHNL
;

46 
FREQUENCY_ITEM
 
FqIms3020
[];

47 
UCHAR
 
NUM_OF_3020_CHNL
;

52 
CHAR
 
	gCCKReTab
[] = {0, 1, 2, 3, 8, 9, 10, 11, -1};

53 
CHAR
 
	gOFDMReTab
[] = {0, 1, 2, 3, 4, 5, 6, 7, -1};

54 
CHAR
 
	gHTMIXReTab
[] = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, -1};

59 
INT
 
TxDmaBusy
(

60 
IN
 
PRTMP_ADAPTER
 
pAd
);

62 
INT
 
RxDmaBusy
(

63 
IN
 
PRTMP_ADAPTER
 
pAd
);

65 
VOID
 
RtmpDmaEb
(

66 
IN
 
PRTMP_ADAPTER
 
pAd
,

67 
IN
 
INT
 
Eb
);

69 
VOID
 
BbpSoRet
(

70 
IN
 
PRTMP_ADAPTER
 
pAd
);

72 
VOID
 
RtmpRfIoWre
(

73 
IN
 
PRTMP_ADAPTER
 
pAd
);

75 
INT
 
ATESUpFme
(

76 
IN
 
PRTMP_ADAPTER
 
pAd
,

77 
IN
 
UINT32
 
TxIdx
);

79 
INT
 
ATETxPwrHdr
(

80 
IN
 
PRTMP_ADAPTER
 
pAd
,

81 
IN
 
dex
);

83 
NDIS_STATUS
 
ATESTART
(

84 
IN
 
PRTMP_ADAPTER
 
pAd
);

86 
NDIS_STATUS
 
ATESTOP
(

87 
IN
 
PRTMP_ADAPTER
 
pAd
);

89 
NDIS_STATUS
 
TXCARR
(

90 
IN
 
PRTMP_ADAPTER
 
pAd
);

92 
NDIS_STATUS
 
TXCONT
(

93 
IN
 
PRTMP_ADAPTER
 
pAd
);

95 
NDIS_STATUS
 
TXFRAME
(

96 
IN
 
PRTMP_ADAPTER
 
pAd
);

98 
NDIS_STATUS
 
RXFRAME
(

99 
IN
 
PRTMP_ADAPTER
 
pAd
);

101 #ifde
RALINK_QA


102 
NDIS_STATUS
 
TXSTOP
(

103 
IN
 
PRTMP_ADAPTER
 
pAd
);

105 
NDIS_STATUS
 
RXSTOP
(

106 
IN
 
PRTMP_ADAPTER
 
pAd
);

109 
NDIS_STATUS
 
ATECmdHdr
(

110 
IN
 
PRTMP_ADAPTER
 
pAd
,

111 
IN
 
PSTRING
 
g
);

113 
CheckMCSVid
(

114 
IN
 
PRTMP_ADAPTER
 
pAd
,

115 
IN
 
UCHAR
 
Mode
,

116 
IN
 
UCHAR
 
Mcs
);

118 #ifde
RTMP_MAC_PCI


119 
VOID
 
ATEWreTxWI
(

120 
IN
 
PRTMP_ADAPTER
 
pAd
,

121 
IN
 
PTXWI_STRUC
 
pOutTxWI
,

122 
IN
 
BOOLEAN
 
FRAG
,

123 
IN
 
BOOLEAN
 
CFACK
,

124 
IN
 
BOOLEAN
 
InsTimeamp
,

125 
IN
 
BOOLEAN
 
AMPDU
,

126 
IN
 
BOOLEAN
 
Ack
,

127 
IN
 
BOOLEAN
 
NSeq
,

128 
IN
 
UCHAR
 
BASize
,

129 
IN
 
UCHAR
 
WCID
,

130 
IN
 
ULONG
 
Lgth
,

131 
IN
 
UCHAR
 
PID
,

132 
IN
 
UCHAR
 
TID
,

133 
IN
 
UCHAR
 
TxRe
,

134 
IN
 
UCHAR
 
Txmode
,

135 
IN
 
BOOLEAN
 
CfAck
,

136 
IN
 
HTTRANSMIT_SETTING
 *
pTnsm
);

140 
VOID
 
SJFr
(

141 
IN
 
PRTMP_ADAPTER
 
pAd
);

144 
	#LEN_OF_ARG
 16

	)

147 #ifde
RALINK_QA


149 
VOID
 
memy_exl
(
PRTMP_ADAPTER
 
pAd
, 
UCHAR
 *
d
, UCHAR *
c
, 
ULONG
 
n
);

150 
VOID
 
memy_exs
(
PRTMP_ADAPTER
 
pAd
, 
UCHAR
 *
d
, UCHAR *
c
, 
ULONG
 
n
);

151 
VOID
 
RTMP_IO_READ_BULK
(
PRTMP_ADAPTER
 
pAd
, 
UCHAR
 *
d
, UCHAR *
c
, 
UINT32
 
n
);

153 
INT
 
	$ReڣToGUI
(

154 
IN
 
e_cfghdr
 *
pRaCfg
,

155 
IN
 
iwq
 *
pwrq
,

156 
IN
 
INT
 
Lgth
,

157 
IN
 
INT
 
Stus
)

159 (
pRaCfg
)->
ngth
 = 
	`OS_HTONS
((
Lgth
));

160 (
pRaCfg
)->
us
 = 
	`OS_HTONS
((
Stus
));

161 (
pwrq
)->
u
.
da
.
ngth
 = ((
pRaCfg
)->
magic_no
+ (RaCfg)->
commd_ty
)

162 + ((
pRaCfg
)->
commd_id
+ (RaCfg)->
ngth
)

163 + ((
pRaCfg
)->
qu
+ 
	`OS_NTOHS
(RaCfg)->
ngth
);

164 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("wrq->u.da.ngth = %d\n", (
pwrq
)->
u
.
da
.
ngth
));

165 i(
	`cy_to_ur
((
pwrq
)->
u
.
da
.
por
, (
UCHAR
 *)(
pRaCfg
), (pwrq)->u.da.
ngth
))

167 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("cy_to_ur( i%s\n", 
__FUNCTION__
));

168  (-
EFAULT
);

172 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%idڐ!\n", 
__FUNCTION__
));

175  
NDIS_STATUS_SUCCESS
;

176 
	}
}

179 
INT
 
	$DO_RACFG_CMD_ATE_START
(

180 
IN
 
PRTMP_ADAPTER
 
pAdr
,

181 
IN
 
iwq
 *
wrq
,

182 
IN
 
e_cfghdr
 *
pRaCfg
)

184 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_START\n"));

187 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

189 #ifdef 
CONFIG_RT2880_ATE_CMD_NEW


190 
	`S_ATE_Proc
(
pAdr
, "ATESTART");

192 
	`S_ATE_Proc
(
pAdr
, "APSTOP");

195  
NDIS_STATUS_SUCCESS
;

196 
	}
}

199 
INT
 
	$DO_RACFG_CMD_ATE_STOP
(

200 
IN
 
PRTMP_ADAPTER
 
pAdr
,

201 
IN
 
iwq
 *
wrq
,

202 
IN
 
e_cfghdr
 *
pRaCfg
)

204 
INT32
 
t
;

206 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_STOP\n"));

215 
pRaCfg
->
ngth
 = 
	`OS_NTOHS
(pRaCfg->length);

217 i(
pRaCfg
->
ngth
 =(
pAdr
->
e
.
APid
))

223 
	`memy
((
UCHAR
 *)&
pAdr
->
e
.
APid
,

224 (&
pRaCfg
->
da
[0]) - 2 ,

225 (
pAdr
->
e
.
APid
));

228 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

236 
t
 = 
	`KILL_THREAD_PID
(
pAdr
->
e
.
APid
, 
SIGTERM
, 1);

238 i(
t
)

239 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: unableo killtehread\n",

240 
	`RTMP_OS_NETDEV_GET_DEVNAME
(
pAdr
->
t_dev
)));

245 i(
	`ATE_ON
(
pAdr
))

249 #ifdef 
CONFIG_RT2880_ATE_CMD_NEW


250 
	`S_ATE_Proc
(
pAdr
, "ATESTOP");

252 
	`S_ATE_Proc
(
pAdr
, "APSTART");

254 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RACFG_CMD_AP_START is done !\n"));

256  
NDIS_STATUS_SUCCESS
;

257 
	}
}

260 
INT
 
	$DO_RACFG_CMD_RF_WRITE_ALL
(

261 
IN
 
PRTMP_ADAPTER
 
pAdr
,

262 
IN
 
iwq
 *
wrq
,

263 
IN
 
e_cfghdr
 *
pRaCfg
)

265 
UINT32
 
R1
, 
R2
, 
R3
, 
R4
;

266 
USHORT
 
chl
;

268 
	`memy
(&
R1
, 
pRaCfg
->
da
-2, 4);

269 
	`memy
(&
R2
, 
pRaCfg
->
da
+2, 4);

270 
	`memy
(&
R3
, 
pRaCfg
->
da
+6, 4);

271 
	`memy
(&
R4
, 
pRaCfg
->
da
+10, 4);

272 
	`memy
(&
chl
, 
pRaCfg
->
da
+14, 2);

274 
pAdr
->
LchRfRegs
.
R1
 = 
	`OS_NTOHL
(R1);

275 
pAdr
->
LchRfRegs
.
R2
 = 
	`OS_NTOHL
(R2);

276 
pAdr
->
LchRfRegs
.
R3
 = 
	`OS_NTOHL
(R3);

277 
pAdr
->
LchRfRegs
.
R4
 = 
	`OS_NTOHL
(R4);

278 
pAdr
->
LchRfRegs
.
Chl
 = 
	`OS_NTOHS
(
chl
);

280 
	`RTMP_RF_IO_WRITE32
(
pAdr
,Adr->
LchRfRegs
.
R1
);

281 
	`RTMP_RF_IO_WRITE32
(
pAdr
,Adr->
LchRfRegs
.
R2
);

282 
	`RTMP_RF_IO_WRITE32
(
pAdr
,Adr->
LchRfRegs
.
R3
);

283 
	`RTMP_RF_IO_WRITE32
(
pAdr
,Adr->
LchRfRegs
.
R4
);

285 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

287  
NDIS_STATUS_SUCCESS
;

288 
	}
}

291 
INT
 
	$DO_RACFG_CMD_E2PROM_READ16
(

292 
IN
 
PRTMP_ADAPTER
 
pAdr
,

293 
IN
 
iwq
 *
wrq
,

294 
IN
 
e_cfghdr
 *
pRaCfg
)

296 
UINT16
 
offt
=0, 
vue
=0;

297 
USHORT
 
tmp
=0;

299 
offt
 = 
	`OS_NTOHS
(
pRaCfg
->
us
);

302 
	`RT28xx_EEPROM_READ16
(
pAdr
, 
offt
, 
tmp
);

303 
vue
 = 
tmp
;

304 
vue
 = 
	`OS_HTONS
(value);

306 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("EEPROM Rd off0x%04x, vu0x%04x\n", 
offt
, 
vue
));

307 
	`memy
(
pRaCfg
->
da
, &
vue
, 2);

309 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+2, 
NDIS_STATUS_SUCCESS
);

311  
NDIS_STATUS_SUCCESS
;

312 
	}
}

315 
INT
 
	$DO_RACFG_CMD_E2PROM_WRITE16
(

316 
IN
 
PRTMP_ADAPTER
 
pAdr
,

317 
IN
 
iwq
 *
wrq
,

318 
IN
 
e_cfghdr
 *
pRaCfg
)

320 
USHORT
 
offt
, 
vue
;

322 
offt
 = 
	`OS_NTOHS
(
pRaCfg
->
us
);

323 
	`memy
(&
vue
, 
pRaCfg
->
da
, 2);

324 
vue
 = 
	`OS_NTOHS
(value);

325 
	`RT28xx_EEPROM_WRITE16
(
pAdr
, 
offt
, 
vue
);

327 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

329  
NDIS_STATUS_SUCCESS
;

330 
	}
}

333 
INT
 
	$DO_RACFG_CMD_E2PROM_READ_ALL
(

334 
IN
 
PRTMP_ADAPTER
 
pAdr
,

335 
IN
 
iwq
 *
wrq
,

336 
IN
 
e_cfghdr
 *
pRaCfg
)

338 
USHORT
 
bufr
[
EEPROM_SIZE
/2];

340 
	`__ad_l
(
pAdr
,(
USHORT
 *)
bufr
);

341 
	`memy_exs
(
pAdr
, 
pRaCfg
->
da
, (
UCHAR
 *)
bufr
, 
EEPROM_SIZE
);

343 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+
EEPROM_SIZE
, 
NDIS_STATUS_SUCCESS
);

345  
NDIS_STATUS_SUCCESS
;

346 
	}
}

349 
INT
 
	$DO_RACFG_CMD_E2PROM_WRITE_ALL
(

350 
IN
 
PRTMP_ADAPTER
 
pAdr
,

351 
IN
 
iwq
 *
wrq
,

352 
IN
 
e_cfghdr
 *
pRaCfg
)

354 
USHORT
 
bufr
[
EEPROM_SIZE
/2];

356 
	`NdisZoMemy
((
UCHAR
 *)
bufr
, 
EEPROM_SIZE
);

357 
	`memy_exs
(
pAdr
, (
UCHAR
 *)
bufr
, (UCHAR *)&
pRaCfg
->
us
, 
EEPROM_SIZE
);

358 
	`__wre_l
(
pAdr
,(
USHORT
 *)
bufr
);

360 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

362  
NDIS_STATUS_SUCCESS
;

363 
	}
}

366 
INT
 
	$DO_RACFG_CMD_IO_READ
(

367 
IN
 
PRTMP_ADAPTER
 
pAdr
,

368 
IN
 
iwq
 *
wrq
,

369 
IN
 
e_cfghdr
 *
pRaCfg
)

371 
UINT32
 
offt
;

372 
UINT32
 
vue
;

374 
	`memy
(&
offt
, &
pRaCfg
->
us
, 4);

375 
offt
 = 
	`OS_NTOHL
(offset);

382 
offt
 &= 0x0000FFFF;

383 
	`RTMP_IO_READ32
(
pAdr
, 
offt
, &
vue
);

385 
vue
 = 
	`OS_HTONL
(value);

386 
	`memy
(
pRaCfg
->
da
, &
vue
, 4);

388 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+4, 
NDIS_STATUS_SUCCESS
);

390  
NDIS_STATUS_SUCCESS
;

391 
	}
}

394 
INT
 
	$DO_RACFG_CMD_IO_WRITE
(

395 
IN
 
PRTMP_ADAPTER
 
pAdr
,

396 
IN
 
iwq
 *
wrq
,

397 
IN
 
e_cfghdr
 *
pRaCfg
)

399 
UINT32
 
offt
, 
vue
;

401 
	`memy
(&
offt
, 
pRaCfg
->
da
-2, 4);

402 
	`memy
(&
vue
, 
pRaCfg
->
da
+2, 4);

404 
offt
 = 
	`OS_NTOHL
(offset);

410 
offt
 &= 0x0000FFFF;

411 
vue
 = 
	`OS_NTOHL
(value);

412 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_IO_WRITE: off%x, vu%x\n", 
offt
, 
vue
));

413 
	`RTMP_IO_WRITE32
(
pAdr
, 
offt
, 
vue
);

415 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

417  
NDIS_STATUS_SUCCESS
;

418 
	}
}

421 
INT
 
	$DO_RACFG_CMD_IO_READ_BULK
(

422 
IN
 
PRTMP_ADAPTER
 
pAdr
,

423 
IN
 
iwq
 *
wrq
,

424 
IN
 
e_cfghdr
 *
pRaCfg
)

426 
UINT32
 
offt
;

427 
USHORT
 
n
;

429 
	`memy
(&
offt
, &
pRaCfg
->
us
, 4);

430 
offt
 = 
	`OS_NTOHL
(offset);

436 
offt
 &= 0x0000FFFF;

437 
	`memy
(&
n
, 
pRaCfg
->
da
+2, 2);

438 
n
 = 
	`OS_NTOHS
(len);

440 i(
n
 > 371)

442 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("lengthequested isooarge, make it smaller\n"));

443 
pRaCfg
->
ngth
 = 
	`OS_HTONS
(2);

444 
pRaCfg
->
us
 = 
	`OS_HTONS
(1);

446  -
EFAULT
;

449 
	`RTMP_IO_READ_BULK
(
pAdr
, 
pRaCfg
->
da
, (
UCHAR
 *)
offt
, 
n
*4);

451 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+(
n
*4), 
NDIS_STATUS_SUCCESS
);

453  
NDIS_STATUS_SUCCESS
;

454 
	}
}

457 
INT
 
	$DO_RACFG_CMD_BBP_READ8
(

458 
IN
 
PRTMP_ADAPTER
 
pAdr
,

459 
IN
 
iwq
 *
wrq
,

460 
IN
 
e_cfghdr
 *
pRaCfg
)

462 
USHORT
 
offt
;

463 
UCHAR
 
vue
;

465 
vue
 = 0;

466 
offt
 = 
	`OS_NTOHS
(
pRaCfg
->
us
);

468 i(
	`ATE_ON
(
pAdr
))

470 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAdr
, 
offt
, &
vue
);

474 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAdr
, 
offt
, &
vue
);

477 
pRaCfg
->
da
[0] = 
vue
;

479 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+1, 
NDIS_STATUS_SUCCESS
);

481  
NDIS_STATUS_SUCCESS
;

482 
	}
}

485 
INT
 
	$DO_RACFG_CMD_BBP_WRITE8
(

486 
IN
 
PRTMP_ADAPTER
 
pAdr
,

487 
IN
 
iwq
 *
wrq
,

488 
IN
 
e_cfghdr
 *
pRaCfg
)

490 
USHORT
 
offt
;

491 
UCHAR
 
vue
;

493 
offt
 = 
	`OS_NTOHS
(
pRaCfg
->
us
);

494 
	`memy
(&
vue
, 
pRaCfg
->
da
, 1);

496 i(
	`ATE_ON
(
pAdr
))

498 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAdr
, 
offt
, 
vue
);

502 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAdr
, 
offt
, 
vue
);

505 i((
offt
 =
BBP_R1
|| (off=
BBP_R3
))

507 
	`SyncTxRxCfig
(
pAdr
, 
offt
, 
vue
);

510 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

512  
NDIS_STATUS_SUCCESS
;

513 
	}
}

516 
INT
 
	$DO_RACFG_CMD_BBP_READ_ALL
(

517 
IN
 
PRTMP_ADAPTER
 
pAdr
,

518 
IN
 
iwq
 *
wrq
,

519 
IN
 
e_cfghdr
 *
pRaCfg
)

521 
USHORT
 
bbp_g_dex
;

523 
bbp_g_dex
 = 0; bbp_g_dex < 
MAX_BBP_ID
+1; bbp_reg_index++)

525 
pRaCfg
->
da
[
bbp_g_dex
] = 0;

527 i(
	`ATE_ON
(
pAdr
))

529 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAdr
, 
bbp_g_dex
, &
pRaCfg
->
da
[bbp_reg_index]);

533 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAdr
, 
bbp_g_dex
, &
pRaCfg
->
da
[bbp_reg_index]);

537 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+
MAX_BBP_ID
+1, 
NDIS_STATUS_SUCCESS
);

539  
NDIS_STATUS_SUCCESS
;

540 
	}
}

543 
INT
 
	$DO_RACFG_CMD_GET_NOISE_LEVEL
(

544 
IN
 
PRTMP_ADAPTER
 
pAdr
,

545 
IN
 
iwq
 *
wrq
,

546 
IN
 
e_cfghdr
 *
pRaCfg
)

548 
UCHAR
 
chl
;

549 
INT32
 
bufr
[3][10];

551 
chl
 = (
	`OS_NTOHS
(
pRaCfg
->
us
) & 0x00FF);

552 
	`CNoiLev
(
pAdr
, 
chl
, 
bufr
);

553 
	`memy_exl
(
pAdr
, (
UCHAR
 *)
pRaCfg
->
da
, (UCHAR *)&(
bufr
[0][0]), ((
INT32
)*3*10));

555 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+((
INT32
)*3*10), 
NDIS_STATUS_SUCCESS
);

557  
NDIS_STATUS_SUCCESS
;

558 
	}
}

562 
INT
 
	$DO_RACFG_CMD_GET_COUNTER
(

563 
IN
 
PRTMP_ADAPTER
 
pAdr
,

564 
IN
 
iwq
 *
wrq
,

565 
IN
 
e_cfghdr
 *
pRaCfg
)

567 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[0], (
UCHAR
 *)&pAdr->
e
.
U2M
, 4);

568 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[4], (
UCHAR
 *)&pAdr->
e
.
OthDa
, 4);

569 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[8], (
UCHAR
 *)&pAdr->
e
.
Bc
, 4);

570 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[12], (
UCHAR
 *)&pAdr->
e
.
OthCou
, 4);

571 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[16], (
UCHAR
 *)&pAdr->
e
.
TxAc0
, 4);

572 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[20], (
UCHAR
 *)&pAdr->
e
.
TxAc1
, 4);

573 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[24], (
UCHAR
 *)&pAdr->
e
.
TxAc2
, 4);

574 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[28], (
UCHAR
 *)&pAdr->
e
.
TxAc3
, 4);

575 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[32], (
UCHAR
 *)&pAdr->
e
.
TxHCCA
, 4);

576 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[36], (
UCHAR
 *)&pAdr->
e
.
TxMgmt
, 4);

577 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[40], (
UCHAR
 *)&pAdr->
e
.
RSSI0
, 4);

578 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[44], (
UCHAR
 *)&pAdr->
e
.
RSSI1
, 4);

579 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[48], (
UCHAR
 *)&pAdr->
e
.
RSSI2
, 4);

580 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[52], (
UCHAR
 *)&pAdr->
e
.
SNR0
, 4);

581 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[56], (
UCHAR
 *)&pAdr->
e
.
SNR1
, 4);

582 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+60, 
NDIS_STATUS_SUCCESS
);

584  
NDIS_STATUS_SUCCESS
;

585 
	}
}

588 
INT
 
	$DO_RACFG_CMD_CLEAR_COUNTER
(

589 
IN
 
PRTMP_ADAPTER
 
pAdr
,

590 
IN
 
iwq
 *
wrq
,

591 
IN
 
e_cfghdr
 *
pRaCfg
)

593 
pAdr
->
e
.
U2M
 = 0;

594 
pAdr
->
e
.
OthDa
 = 0;

595 
pAdr
->
e
.
Bc
 = 0;

596 
pAdr
->
e
.
OthCou
 = 0;

597 
pAdr
->
e
.
TxAc0
 = 0;

598 
pAdr
->
e
.
TxAc1
 = 0;

599 
pAdr
->
e
.
TxAc2
 = 0;

600 
pAdr
->
e
.
TxAc3
 = 0;

601 
pAdr
->
e
.
TxHCCA
 = 0;

602 
pAdr
->
e
.
TxMgmt
 = 0;

603 
pAdr
->
e
.
TxDeCou
 = 0;

605 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

607  
NDIS_STATUS_SUCCESS
;

608 
	}
}

611 
INT
 
	$DO_RACFG_CMD_TX_START
(

612 
IN
 
PRTMP_ADAPTER
 
pAdr
,

613 
IN
 
iwq
 *
wrq
,

614 
IN
 
e_cfghdr
 *
pRaCfg
)

616 
USHORT
 *
p
;

617 
USHORT
 
r
 = 1;

618 
UCHAR
 
Bbp22Vue
 = 0, 
Bbp24Vue
 = 0;

620 i((
pAdr
->
e
.
TxStus
 !0&& (pAdr->e.
Mode
 & 
ATE_TXFRAME
))

622 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Ate Tx islreadyunning,ounext Tx, you must stop it first\n"));

623 
r
 = 2;

624 
tx_t_r
;

626 i((
pAdr
->
e
.
TxStus
 !0&& !Adr->e.
Mode
 & 
ATE_TXFRAME
))

628 
i
 = 0;

630 (
i
++ < 10&& (
pAdr
->
e
.
TxStus
 != 0))

632 
	`RTMPucDay
(5000);

636 
pAdr
->
e
.
TxStus
 = 0;

637 
pAdr
->
e
.
TxDeCou
 = 0;

638 
pAdr
->
e
.
bQATxS
 = 
FALSE
;

641 #ifde
NEW_TXCONT


644 i(
pAdr
->
e
.
Mode
 |
ATE_TXFRAME
)

646 
	`TXSTOP
(
pAdr
);

654 i(
	`OS_NTOHS
(
pRaCfg
->
ngth
) != 0)

658 
	`NdisMoveMemy
(&
pAdr
->
e
.
TxWI
, 
pRaCfg
->
da
 + 2, 16);

659 #ifde
RT_BIG_ENDIAN


660 
	`RTMPWIEndnChge
((
PUCHAR
)&
pAdr
->
e
.
TxWI
, 
TYPE_TXWI
);

663 
	`NdisMoveMemy
(&
pAdr
->
e
.
TxCou
, 
pRaCfg
->
da
 + 18, 4);

664 
pAdr
->
e
.
TxCou
 = 
	`OS_NTOHL
(pAdapter->ate.TxCount);

666 
p
 = (
USHORT
 *)(&
pRaCfg
->
da
[22]);

669 
pAdr
->
e
.
QID
 = 0;

671 
p
 = (
USHORT
 *)(&
pRaCfg
->
da
[24]);

672 
pAdr
->
e
.
HL
 = 
	`OS_NTOHS
(*
p
);

674 i(
pAdr
->
e
.
HL
 > 32)

676 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("pAdapter->ate.HLen > 32\n"));

677 
r
 = 3;

678 
tx_t_r
;

681 
	`NdisMoveMemy
(&
pAdr
->
e
.
Hd
, 
pRaCfg
->
da
 + 26,Adr->e.
HL
);

683 
pAdr
->
e
.
PL
 = 
	`OS_NTOHS
(
pRaCfg
->
ngth
- (pAdr->e.
HL
 + 28);

685 i(
pAdr
->
e
.
PL
 > 32)

687 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("pAdapter->ate.PLen > 32\n"));

688 
r
 = 4;

689 
tx_t_r
;

692 
	`NdisMoveMemy
(&
pAdr
->
e
.
P
, 
pRaCfg
->
da
 + 26 +Adr->e.
HL
,Adr->e.
PL
);

693 
pAdr
->
e
.
DL
 =Adr->e.
TxWI
.
MPDUtٮByCou
 -Adr->e.
HL
;

698 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAdr
, 
BBP_R22
, &
Bbp22Vue
);

700 
Bbp22Vue
)

702 
BBP22_TXFRAME
:

704 i(
pAdr
->
e
.
TxCou
 == 0)

706 #ifde
RTMP_MAC_PCI


707 
pAdr
->
e
.
TxCou
 = 0xFFFFFFFF;

710 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("START TXFRAME\n"));

711 
pAdr
->
e
.
bQATxS
 = 
TRUE
;

712 
	`S_ATE_Proc
(
pAdr
, "TXFRAME");

716 
BBP22_TXCONT_OR_CARRSUPP
:

718 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("BBP22_TXCONT_OR_CARRSUPP\n"));

719 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAdr
, 
BBP_R24
, &
Bbp24Vue
);

721 
Bbp24Vue
)

723 
BBP24_TXCONT
:

725 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("START TXCONT\n"));

726 
pAdr
->
e
.
bQATxS
 = 
TRUE
;

727 #ifde
NEW_TXCONT


731 
	`DBGPRINT
(
RT_DEBUG_OFF
,("ATE ERROR! It shouldoteach here!\n"));

732 
	`S_ATE_Proc
(
pAdr
, "TXFRAME");

734 
	`S_ATE_Proc
(
pAdr
, "TXCONT");

739 
BBP24_CARRSUPP
:

741 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("START TXCARRSUPP\n"));

742 
pAdr
->
e
.
bQATxS
 = 
TRUE
;

743 
pAdr
->
e
.
Mode
 |
ATE_TXCARRSUPP
;

749 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("Unknown TX subtype !"));

756 
BBP22_TXCARR
:

758 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("START TXCARR\n"));

759 
pAdr
->
e
.
bQATxS
 = 
TRUE
;

760 
	`S_ATE_Proc
(
pAdr
, "TXCARR");

766 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("Unknown Start TX subtype !"));

771 i(
pAdr
->
e
.
bQATxS
 =
TRUE
)

773 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

774  
NDIS_STATUS_SUCCESS
;

777 
tx_t_r
:

778 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
r
);

780  
r
;

781 
	}
}

784 
INT
 
	$DO_RACFG_CMD_GET_TX_STATUS
(

785 
IN
 
PRTMP_ADAPTER
 
pAdr
,

786 
IN
 
iwq
 *
wrq
,

787 
IN
 
e_cfghdr
 *
pRaCfg
)

789 
UINT32
 
cou
=0;

791 
cou
 = 
	`OS_HTONL
(
pAdr
->
e
.
TxDeCou
);

792 
	`NdisMoveMemy
(
pRaCfg
->
da
, &
cou
, 4);

794 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+4, 
NDIS_STATUS_SUCCESS
);

796  
NDIS_STATUS_SUCCESS
;

797 
	}
}

800 
INT
 
	$DO_RACFG_CMD_TX_STOP
(

801 
IN
 
PRTMP_ADAPTER
 
pAdr
,

802 
IN
 
iwq
 *
wrq
,

803 
IN
 
e_cfghdr
 *
pRaCfg
)

805 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_TX_STOP\n"));

807 
	`S_ATE_Proc
(
pAdr
, "TXSTOP");

809 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

811  
NDIS_STATUS_SUCCESS
;

812 
	}
}

815 
INT
 
	$DO_RACFG_CMD_RX_START
(

816 
IN
 
PRTMP_ADAPTER
 
pAdr
,

817 
IN
 
iwq
 *
wrq
,

818 
IN
 
e_cfghdr
 *
pRaCfg
)

820 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_RX_START\n"));

822 
pAdr
->
e
.
bQARxS
 = 
TRUE
;

823 
	`S_ATE_Proc
(
pAdr
, "RXFRAME");

825 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

827  
NDIS_STATUS_SUCCESS
;

828 
	}
}

831 
INT
 
	$DO_RACFG_CMD_RX_STOP
(

832 
IN
 
PRTMP_ADAPTER
 
pAdr
,

833 
IN
 
iwq
 *
wrq
,

834 
IN
 
e_cfghdr
 *
pRaCfg
)

836 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_RX_STOP\n"));

838 
	`S_ATE_Proc
(
pAdr
, "RXSTOP");

840 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

842  
NDIS_STATUS_SUCCESS
;

843 
	}
}

846 
INT
 
	$DO_RACFG_CMD_ATE_START_TX_CARRIER
(

847 
IN
 
PRTMP_ADAPTER
 
pAdr
,

848 
IN
 
iwq
 *
wrq
,

849 
IN
 
e_cfghdr
 *
pRaCfg
)

851 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_START_TX_CARRIER\n"));

853 
	`S_ATE_Proc
(
pAdr
, "TXCARR");

855 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

857  
NDIS_STATUS_SUCCESS
;

858 
	}
}

861 
INT
 
	$DO_RACFG_CMD_ATE_START_TX_CONT
(

862 
IN
 
PRTMP_ADAPTER
 
pAdr
,

863 
IN
 
iwq
 *
wrq
,

864 
IN
 
e_cfghdr
 *
pRaCfg
)

866 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_START_TX_CONT\n"));

868 
	`S_ATE_Proc
(
pAdr
, "TXCONT");

870 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

872  
NDIS_STATUS_SUCCESS
;

873 
	}
}

876 
INT
 
	$DO_RACFG_CMD_ATE_START_TX_FRAME
(

877 
IN
 
PRTMP_ADAPTER
 
pAdr
,

878 
IN
 
iwq
 *
wrq
,

879 
IN
 
e_cfghdr
 *
pRaCfg
)

881 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_START_TX_FRAME\n"));

883 
	`S_ATE_Proc
(
pAdr
, "TXFRAME");

885 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

887  
NDIS_STATUS_SUCCESS
;

888 
	}
}

891 
INT
 
	$DO_RACFG_CMD_ATE_SET_BW
(

892 
IN
 
PRTMP_ADAPTER
 
pAdr
,

893 
IN
 
iwq
 *
wrq
,

894 
IN
 
e_cfghdr
 *
pRaCfg
)

896 
SHORT
 
vue
 = 0;

897 
STRING
 
r
[
LEN_OF_ARG
];

899 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

901 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_BW\n"));

903 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

904 
vue
 = 
	`OS_NTOHS
(value);

905 
	`rtf
((*)
r
, "%d", 
vue
);

907 
	`S_ATE_TX_BW_Proc
(
pAdr
, 
r
);

909 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

911  
NDIS_STATUS_SUCCESS
;

912 
	}
}

915 
INT
 
	$DO_RACFG_CMD_ATE_SET_TX_POWER0
(

916 
IN
 
PRTMP_ADAPTER
 
pAdr
,

917 
IN
 
iwq
 *
wrq
,

918 
IN
 
e_cfghdr
 *
pRaCfg
)

920 
SHORT
 
vue
 = 0;

921 
STRING
 
r
[
LEN_OF_ARG
];

923 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

925 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_TX_POWER0\n"));

927 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

928 
vue
 = 
	`OS_NTOHS
(value);

929 
	`rtf
((*)
r
, "%d", 
vue
);

930 
	`S_ATE_TX_POWER0_Proc
(
pAdr
, 
r
);

932 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

934  
NDIS_STATUS_SUCCESS
;

935 
	}
}

938 
INT
 
	$DO_RACFG_CMD_ATE_SET_TX_POWER1
(

939 
IN
 
PRTMP_ADAPTER
 
pAdr
,

940 
IN
 
iwq
 *
wrq
,

941 
IN
 
e_cfghdr
 *
pRaCfg
)

943 
SHORT
 
vue
 = 0;

944 
STRING
 
r
[
LEN_OF_ARG
];

946 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

948 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_TX_POWER1\n"));

950 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

951 
vue
 = 
	`OS_NTOHS
(value);

952 
	`rtf
((*)
r
, "%d", 
vue
);

953 
	`S_ATE_TX_POWER1_Proc
(
pAdr
, 
r
);

955 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

957  
NDIS_STATUS_SUCCESS
;

958 
	}
}

963 
INT
 
	$DO_RACFG_CMD_ATE_SET_FREQ_OFFSET
(

964 
IN
 
PRTMP_ADAPTER
 
pAdr
,

965 
IN
 
iwq
 *
wrq
,

966 
IN
 
e_cfghdr
 *
pRaCfg
)

968 
SHORT
 
vue
 = 0;

969 
STRING
 
r
[
LEN_OF_ARG
];

971 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

973 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_FREQ_OFFSET\n"));

975 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

976 
vue
 = 
	`OS_NTOHS
(value);

977 
	`rtf
((*)
r
, "%d", 
vue
);

978 
	`S_ATE_TX_FREQOFFSET_Proc
(
pAdr
, 
r
);

980 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

982  
NDIS_STATUS_SUCCESS
;

983 
	}
}

986 
INT
 
	$DO_RACFG_CMD_ATE_GET_STATISTICS
(

987 
IN
 
PRTMP_ADAPTER
 
pAdr
,

988 
IN
 
iwq
 *
wrq
,

989 
IN
 
e_cfghdr
 *
pRaCfg
)

991 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_GET_STATISTICS\n"));

993 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[0], (
UCHAR
 *)&pAdr->
e
.
TxDeCou
, 4);

994 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[4], (
UCHAR
 *)&pAdr->
WnCous
.
RryCou
.
u
.
LowPt
, 4);

995 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[8], (
UCHAR
 *)&pAdr->
WnCous
.
FaedCou
.
u
.
LowPt
, 4);

996 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[12], (
UCHAR
 *)&pAdr->
WnCous
.
RTSSucssCou
.
u
.
LowPt
, 4);

997 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[16], (
UCHAR
 *)&pAdr->
WnCous
.
RTSFauCou
.
u
.
LowPt
, 4);

998 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[20], (
UCHAR
 *)&pAdr->
WnCous
.
ReivedFgmtCou
.
QuadPt
, 4);

999 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[24], (
UCHAR
 *)&pAdr->
WnCous
.
FCSECou
.
u
.
LowPt
, 4);

1000 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[28], (
UCHAR
 *)&pAdr->
Cous8023
.
RxNoBufr
, 4);

1001 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[32], (
UCHAR
 *)&pAdr->
WnCous
.
FmeDuiCou
.
u
.
LowPt
, 4);

1002 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[36], (
UCHAR
 *)&pAdr->
RkCous
.
OSecFCCAC
, 4);

1004 i(
pAdr
->
e
.
RxAS
 == 0)

1006 
INT32
 
RSSI0
 = 0;

1007 
INT32
 
RSSI1
 = 0;

1008 
INT32
 
RSSI2
 = 0;

1010 
RSSI0
 = (
INT32
)(
pAdr
->
e
.
LaRssi0
 -Adr->
BbpRssiToDbmD
);

1011 
RSSI1
 = (
INT32
)(
pAdr
->
e
.
LaRssi1
 -Adr->
BbpRssiToDbmD
);

1012 
RSSI2
 = (
INT32
)(
pAdr
->
e
.
LaRssi2
 -Adr->
BbpRssiToDbmD
);

1013 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[40], (
UCHAR
 *)&
RSSI0
, 4);

1014 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[44], (
UCHAR
 *)&
RSSI1
, 4);

1015 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[48], (
UCHAR
 *)&
RSSI2
, 4);

1016 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+52, 
NDIS_STATUS_SUCCESS
);

1020 
INT32
 
RSSI0
 = 0;

1022 
RSSI0
 = (
INT32
)(
pAdr
->
e
.
LaRssi0
 -Adr->
BbpRssiToDbmD
);

1023 
	`memy_exl
(
pAdr
, &
pRaCfg
->
da
[40], (
UCHAR
 *)&
RSSI0
, 4);

1024 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+44, 
NDIS_STATUS_SUCCESS
);

1027  
NDIS_STATUS_SUCCESS
;

1028 
	}
}

1031 
INT
 
	$DO_RACFG_CMD_ATE_RESET_COUNTER
(

1032 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1033 
IN
 
iwq
 *
wrq
,

1034 
IN
 
e_cfghdr
 *
pRaCfg
)

1036 
SHORT
 
vue
 = 1;

1037 
STRING
 
r
[
LEN_OF_ARG
];

1039 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

1041 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_RESET_COUNTER\n"));

1043 
	`rtf
((*)
r
, "%d", 
vue
);

1044 
	`S_RetStCou_Proc
(
pAdr
, 
r
);

1046 
pAdr
->
e
.
TxDeCou
 = 0;

1048 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1050  
NDIS_STATUS_SUCCESS
;

1051 
	}
}

1054 
INT
 
	$DO_RACFG_CMD_ATE_SEL_TX_ANTENNA
(

1055 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1056 
IN
 
iwq
 *
wrq
,

1057 
IN
 
e_cfghdr
 *
pRaCfg
)

1059 
SHORT
 
vue
 = 0;

1060 
STRING
 
r
[
LEN_OF_ARG
];

1062 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

1064 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SEL_TX_ANTENNA\n"));

1066 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

1067 
vue
 = 
	`OS_NTOHS
(value);

1068 
	`rtf
((*)
r
, "%d", 
vue
);

1069 
	`S_ATE_TX_A_Proc
(
pAdr
, 
r
);

1071 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1073  
NDIS_STATUS_SUCCESS
;

1074 
	}
}

1077 
INT
 
	$DO_RACFG_CMD_ATE_SEL_RX_ANTENNA
(

1078 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1079 
IN
 
iwq
 *
wrq
,

1080 
IN
 
e_cfghdr
 *
pRaCfg
)

1082 
SHORT
 
vue
 = 0;

1083 
STRING
 
r
[
LEN_OF_ARG
];

1085 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

1087 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SEL_RX_ANTENNA\n"));

1089 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

1090 
vue
 = 
	`OS_NTOHS
(value);

1091 
	`rtf
((*)
r
, "%d", 
vue
);

1092 
	`S_ATE_RX_A_Proc
(
pAdr
, 
r
);

1094 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1096  
NDIS_STATUS_SUCCESS
;

1097 
	}
}

1100 
INT
 
	$DO_RACFG_CMD_ATE_SET_PREAMBLE
(

1101 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1102 
IN
 
iwq
 *
wrq
,

1103 
IN
 
e_cfghdr
 *
pRaCfg
)

1105 
SHORT
 
vue
 = 0;

1106 
STRING
 
r
[
LEN_OF_ARG
];

1108 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

1110 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_PREAMBLE\n"));

1112 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

1113 
vue
 = 
	`OS_NTOHS
(value);

1114 
	`rtf
((*)
r
, "%d", 
vue
);

1115 
	`S_ATE_TX_MODE_Proc
(
pAdr
, 
r
);

1117 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1119  
NDIS_STATUS_SUCCESS
;

1120 
	}
}

1123 
INT
 
	$DO_RACFG_CMD_ATE_SET_CHANNEL
(

1124 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1125 
IN
 
iwq
 *
wrq
,

1126 
IN
 
e_cfghdr
 *
pRaCfg
)

1128 
SHORT
 
vue
 = 0;

1129 
STRING
 
r
[
LEN_OF_ARG
];

1131 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

1133 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_CHANNEL\n"));

1135 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

1136 
vue
 = 
	`OS_NTOHS
(value);

1137 
	`rtf
((*)
r
, "%d", 
vue
);

1138 
	`S_ATE_CHANNEL_Proc
(
pAdr
, 
r
);

1140 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1142  
NDIS_STATUS_SUCCESS
;

1143 
	}
}

1146 
INT
 
	$DO_RACFG_CMD_ATE_SET_ADDR1
(

1147 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1148 
IN
 
iwq
 *
wrq
,

1149 
IN
 
e_cfghdr
 *
pRaCfg
)

1151 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_ADDR1\n"));

1157 
	`memy
(
pAdr
->
e
.
Addr1
, (
PUCHAR
)(
pRaCfg
->
da
 - 2), 
MAC_ADDR_LEN
);

1159 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1161  
NDIS_STATUS_SUCCESS
;

1162 
	}
}

1165 
INT
 
	$DO_RACFG_CMD_ATE_SET_ADDR2
(

1166 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1167 
IN
 
iwq
 *
wrq
,

1168 
IN
 
e_cfghdr
 *
pRaCfg
)

1170 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_ADDR2\n"));

1176 
	`memy
(
pAdr
->
e
.
Addr2
, (
PUCHAR
)(
pRaCfg
->
da
 - 2), 
MAC_ADDR_LEN
);

1178 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1180  
NDIS_STATUS_SUCCESS
;

1181 
	}
}

1184 
INT
 
	$DO_RACFG_CMD_ATE_SET_ADDR3
(

1185 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1186 
IN
 
iwq
 *
wrq
,

1187 
IN
 
e_cfghdr
 *
pRaCfg
)

1189 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_ADDR3\n"));

1195 
	`memy
(
pAdr
->
e
.
Addr3
, (
PUCHAR
)(
pRaCfg
->
da
 - 2), 
MAC_ADDR_LEN
);

1197 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1199  
NDIS_STATUS_SUCCESS
;

1200 
	}
}

1203 
INT
 
	$DO_RACFG_CMD_ATE_SET_RATE
(

1204 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1205 
IN
 
iwq
 *
wrq
,

1206 
IN
 
e_cfghdr
 *
pRaCfg
)

1208 
SHORT
 
vue
 = 0;

1209 
STRING
 
r
[
LEN_OF_ARG
];

1211 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

1213 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_RATE\n"));

1215 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

1216 
vue
 = 
	`OS_NTOHS
(value);

1217 
	`rtf
((*)
r
, "%d", 
vue
);

1218 
	`S_ATE_TX_MCS_Proc
(
pAdr
, 
r
);

1220 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1222  
NDIS_STATUS_SUCCESS
;

1223 
	}
}

1226 
INT
 
	$DO_RACFG_CMD_ATE_SET_TX_FRAME_LEN
(

1227 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1228 
IN
 
iwq
 *
wrq
,

1229 
IN
 
e_cfghdr
 *
pRaCfg
)

1231 
SHORT
 
vue
 = 0;

1232 
STRING
 
r
[
LEN_OF_ARG
];

1234 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

1236 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_TX_FRAME_LEN\n"));

1238 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

1239 
vue
 = 
	`OS_NTOHS
(value);

1240 
	`rtf
((*)
r
, "%d", 
vue
);

1241 
	`S_ATE_TX_LENGTH_Proc
(
pAdr
, 
r
);

1243 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1245  
NDIS_STATUS_SUCCESS
;

1246 
	}
}

1249 
INT
 
	$DO_RACFG_CMD_ATE_SET_TX_FRAME_COUNT
(

1250 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1251 
IN
 
iwq
 *
wrq
,

1252 
IN
 
e_cfghdr
 *
pRaCfg
)

1254 
USHORT
 
vue
 = 0;

1255 
STRING
 
r
[
LEN_OF_ARG
];

1257 
	`NdisZoMemy
(
r
, 
LEN_OF_ARG
);

1259 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_ATE_SET_TX_FRAME_COUNT\n"));

1261 
	`memy
((
PUCHAR
)&
vue
, (PUCHAR)&(
pRaCfg
->
us
), 2);

1262 
vue
 = 
	`OS_NTOHS
(value);

1264 #ifde
RTMP_MAC_PCI


1266 i(
vue
 == 0)

1269 
pAdr
->
e
.
TxCou
 = 0xFFFFFFFF;

1270 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_TX_COUNT_Pro(TxCou = %d)\n", 
pAdr
->
e
.
TxCou
));

1271 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_TX_COUNT_Proc Success\n"));

1278 
	`rtf
((*)
r
, "%d", 
vue
);

1279 
	`S_ATE_TX_COUNT_Proc
(
pAdr
, 
r
);

1282 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1284  
NDIS_STATUS_SUCCESS
;

1285 
	}
}

1288 
INT
 
	$DO_RACFG_CMD_ATE_START_RX_FRAME
(

1289 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1290 
IN
 
iwq
 *
wrq
,

1291 
IN
 
e_cfghdr
 *
pRaCfg
)

1293 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RACFG_CMD_RX_START\n"));

1295 
	`S_ATE_Proc
(
pAdr
, "RXFRAME");

1297 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1299  
NDIS_STATUS_SUCCESS
;

1300 
	}
}

1303 
INT
 
	$DO_RACFG_CMD_ATE_E2PROM_READ_BULK
(

1304 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1305 
IN
 
iwq
 *
wrq
,

1306 
IN
 
e_cfghdr
 *
pRaCfg
)

1308 
USHORT
 
offt
;

1309 
USHORT
 
n
;

1310 
USHORT
 
bufr
[
EEPROM_SIZE
/2];

1312 
offt
 = 
	`OS_NTOHS
(
pRaCfg
->
us
);

1313 
	`memy
(&
n
, 
pRaCfg
->
da
, 2);

1314 
n
 = 
	`OS_NTOHS
(len);

1316 
	`__ad_l
(
pAdr
, (
USHORT
 *)
bufr
);

1318 i(
offt
 + 
n
 <
EEPROM_SIZE
)

1319 
	`memy_exs
(
pAdr
, 
pRaCfg
->
da
, (
UCHAR
 *)
bufr
+
offt
, 
n
);

1321 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("exceed EEPROM size\n"));

1323 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+
n
, 
NDIS_STATUS_SUCCESS
);

1325  
NDIS_STATUS_SUCCESS
;

1326 
	}
}

1329 
INT
 
	$DO_RACFG_CMD_ATE_E2PROM_WRITE_BULK
(

1330 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1331 
IN
 
iwq
 *
wrq
,

1332 
IN
 
e_cfghdr
 *
pRaCfg
)

1334 
USHORT
 
offt
;

1335 
USHORT
 
n
;

1336 
USHORT
 
bufr
[
EEPROM_SIZE
/2];

1338 
offt
 = 
	`OS_NTOHS
(
pRaCfg
->
us
);

1339 
	`memy
(&
n
, 
pRaCfg
->
da
, 2);

1340 
n
 = 
	`OS_NTOHS
(len);

1342 
	`__ad_l
(
pAdr
,(
USHORT
 *)
bufr
);

1343 
	`memy_exs
(
pAdr
, (
UCHAR
 *)
bufr
 + 
offt
, (UCHAR *)
pRaCfg
->
da
 + 2, 
n
);

1344 
	`__wre_l
(
pAdr
,(
USHORT
 *)
bufr
);

1346 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1348  
NDIS_STATUS_SUCCESS
;

1349 
	}
}

1352 
INT
 
	$DO_RACFG_CMD_ATE_IO_WRITE_BULK
(

1353 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1354 
IN
 
iwq
 *
wrq
,

1355 
IN
 
e_cfghdr
 *
pRaCfg
)

1357 
UINT32
 
offt
, 
i
, 
vue
;

1358 
USHORT
 
n
;

1360 
	`memy
(&
offt
, &
pRaCfg
->
us
, 4);

1361 
offt
 = 
	`OS_NTOHL
(offset);

1362 
	`memy
(&
n
, 
pRaCfg
->
da
+2, 2);

1363 
n
 = 
	`OS_NTOHS
(len);

1365 
i
 = 0; i < 
n
; i += 4)

1367 
	`memy_exl
(
pAdr
, (
UCHAR
 *)&
vue
, 
pRaCfg
->
da
+4+
i
, 4);

1368 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Wr%x %x\n", 
offt
 + 
i
, 
vue
));

1369 
	`RTMP_IO_WRITE32
(
pAdr
, ((
offt
+
i
& (0xffff)), 
vue
);

1372 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1374  
NDIS_STATUS_SUCCESS
;

1375 
	}
}

1378 
INT
 
	$DO_RACFG_CMD_ATE_BBP_READ_BULK
(

1379 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1380 
IN
 
iwq
 *
wrq
,

1381 
IN
 
e_cfghdr
 *
pRaCfg
)

1383 
USHORT
 
offt
;

1384 
USHORT
 
n
;

1385 
USHORT
 
j
;

1387 
offt
 = 
	`OS_NTOHS
(
pRaCfg
->
us
);

1388 
	`memy
(&
n
, 
pRaCfg
->
da
, 2);

1389 
n
 = 
	`OS_NTOHS
(len);

1391 
j
 = 
offt
; j < (offt+
n
); j++)

1393 
pRaCfg
->
da
[
j
 - 
offt
] = 0;

1395 i(
pAdr
->
e
.
Mode
 =
ATE_STOP
)

1397 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAdr
, 
j
, &
pRaCfg
->
da
[j - 
offt
]);

1401 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAdr
, 
j
, &
pRaCfg
->
da
[j - 
offt
]);

1405 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
)+
n
, 
NDIS_STATUS_SUCCESS
);

1407  
NDIS_STATUS_SUCCESS
;

1408 
	}
}

1411 
INT
 
	$DO_RACFG_CMD_ATE_BBP_WRITE_BULK
(

1412 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1413 
IN
 
iwq
 *
wrq
,

1414 
IN
 
e_cfghdr
 *
pRaCfg
)

1416 
USHORT
 
offt
;

1417 
USHORT
 
n
;

1418 
USHORT
 
j
;

1419 
UCHAR
 *
vue
;

1421 
offt
 = 
	`OS_NTOHS
(
pRaCfg
->
us
);

1422 
	`memy
(&
n
, 
pRaCfg
->
da
, 2);

1423 
n
 = 
	`OS_NTOHS
(len);

1425 
j
 = 
offt
; j < (offt+
n
); j++)

1427 
vue
 = 
pRaCfg
->
da
 + 2 + (
j
 - 
offt
);

1428 i(
pAdr
->
e
.
Mode
 =
ATE_STOP
)

1430 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAdr
, 
j
, *
vue
);

1434 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAdr
, 
j
, *
vue
);

1438 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

1440  
NDIS_STATUS_SUCCESS
;

1441 
	}
}

1447 
	$INT
 (*
	tRACFG_CMD_HANDLER
)(

1448 
	tIN
 
	tPRTMP_ADAPTER
 
	tpAdr
,

1449 
	tIN
 
	tiwq
 *
	twrq
,

1450 
	tIN
 
	te_cfghdr
 *
	tpRaCfg
);

1453 
RACFG_CMD_HANDLER
 
RACFG_CMD_SET1
[] =

1456 
DO_RACFG_CMD_RF_WRITE_ALL
,

1457 
DO_RACFG_CMD_E2PROM_READ16
,

1458 
DO_RACFG_CMD_E2PROM_WRITE16
,

1459 
DO_RACFG_CMD_E2PROM_READ_ALL
,

1460 
DO_RACFG_CMD_E2PROM_WRITE_ALL
,

1461 
DO_RACFG_CMD_IO_READ
,

1462 
DO_RACFG_CMD_IO_WRITE
,

1463 
DO_RACFG_CMD_IO_READ_BULK
,

1464 
DO_RACFG_CMD_BBP_READ8
,

1465 
DO_RACFG_CMD_BBP_WRITE8
,

1466 
DO_RACFG_CMD_BBP_READ_ALL
,

1467 
DO_RACFG_CMD_GET_COUNTER
,

1468 
DO_RACFG_CMD_CLEAR_COUNTER
,

1469 
NULL
 ,

1470 
NULL
 ,

1471 
NULL
 ,

1472 
DO_RACFG_CMD_TX_START
,

1473 
DO_RACFG_CMD_GET_TX_STATUS
,

1474 
DO_RACFG_CMD_TX_STOP
,

1475 
DO_RACFG_CMD_RX_START
,

1476 
DO_RACFG_CMD_RX_STOP
,

1477 
DO_RACFG_CMD_GET_NOISE_LEVEL
,

1478 
NULL


1481 
	}
};

1484 
RACFG_CMD_HANDLER
 
	gRACFG_CMD_SET2
[] =

1487 
DO_RACFG_CMD_ATE_START
,

1488 
DO_RACFG_CMD_ATE_STOP


1493 
RACFG_CMD_HANDLER
 
	gRACFG_CMD_SET3
[] =

1496 
DO_RACFG_CMD_ATE_START_TX_CARRIER
,

1497 
DO_RACFG_CMD_ATE_START_TX_CONT
,

1498 
DO_RACFG_CMD_ATE_START_TX_FRAME
,

1499 
DO_RACFG_CMD_ATE_SET_BW
,

1500 
DO_RACFG_CMD_ATE_SET_TX_POWER0
,

1501 
DO_RACFG_CMD_ATE_SET_TX_POWER1
,

1502 
DO_RACFG_CMD_ATE_SET_FREQ_OFFSET
,

1503 
DO_RACFG_CMD_ATE_GET_STATISTICS
,

1504 
DO_RACFG_CMD_ATE_RESET_COUNTER
,

1505 
DO_RACFG_CMD_ATE_SEL_TX_ANTENNA
,

1506 
DO_RACFG_CMD_ATE_SEL_RX_ANTENNA
,

1507 
DO_RACFG_CMD_ATE_SET_PREAMBLE
,

1508 
DO_RACFG_CMD_ATE_SET_CHANNEL
,

1509 
DO_RACFG_CMD_ATE_SET_ADDR1
,

1510 
DO_RACFG_CMD_ATE_SET_ADDR2
,

1511 
DO_RACFG_CMD_ATE_SET_ADDR3
,

1512 
DO_RACFG_CMD_ATE_SET_RATE
,

1513 
DO_RACFG_CMD_ATE_SET_TX_FRAME_LEN
,

1514 
DO_RACFG_CMD_ATE_SET_TX_FRAME_COUNT
,

1515 
DO_RACFG_CMD_ATE_START_RX_FRAME
,

1516 
DO_RACFG_CMD_ATE_E2PROM_READ_BULK
,

1517 
DO_RACFG_CMD_ATE_E2PROM_WRITE_BULK
,

1518 
DO_RACFG_CMD_ATE_IO_WRITE_BULK
,

1519 
DO_RACFG_CMD_ATE_BBP_READ_BULK
,

1520 
DO_RACFG_CMD_ATE_BBP_WRITE_BULK
,

1521 
NULL
,

1522 
NULL
,

1523 
NULL


1528 
RACFG_CMD_HANDLER
 
	gRACFG_CMD_SET4
[] =

1542 
	s_RACFG_CMD_TABLE_
{

1543 
RACFG_CMD_HANDLER
 *
	mcmdS
;

1544 
	mcmdSSize
;

1545 
	mcmdOfft
;

1546 }
	tRACFG_CMD_TABLE
;

1549 
RACFG_CMD_TABLE
 
	gRACFG_CMD_TABLES
[]={

1551 
RACFG_CMD_SET1
,

1552 (
RACFG_CMD_SET1
/ (
RACFG_CMD_HANDLER
),

1556 
RACFG_CMD_SET2
,

1557 (
RACFG_CMD_SET2
/ (
RACFG_CMD_HANDLER
),

1561 
RACFG_CMD_SET3
,

1562 (
RACFG_CMD_SET3
/ (
RACFG_CMD_HANDLER
),

1566 
RACFG_CMD_SET4
,

1567 (
RACFG_CMD_SET4
/ (
RACFG_CMD_HANDLER
),

1574 #ifde
RTMP_MAC_PCI


1575 
INT
 
	$TxDmaBusy
(

1576 
IN
 
PRTMP_ADAPTER
 
pAd
)

1578 
INT
 
su
;

1579 
WPDMA_GLO_CFG_STRUC
 
GloCfg
;

1581 
	`RTMP_IO_READ32
(
pAd
, 
WPDMA_GLO_CFG
, &
GloCfg
.
wd
);

1582 i(
GloCfg
.
fld
.
TxDMABusy
)

1583 
su
 = 1;

1585 
su
 = 0;

1587  
su
;

1588 
	}
}

1591 
INT
 
	$RxDmaBusy
(

1592 
IN
 
PRTMP_ADAPTER
 
pAd
)

1594 
INT
 
su
;

1595 
WPDMA_GLO_CFG_STRUC
 
GloCfg
;

1597 
	`RTMP_IO_READ32
(
pAd
, 
WPDMA_GLO_CFG
, &
GloCfg
.
wd
);

1598 i(
GloCfg
.
fld
.
RxDMABusy
)

1599 
su
 = 1;

1601 
su
 = 0;

1603  
su
;

1604 
	}
}

1607 
VOID
 
	$RtmpDmaEb
(

1608 
IN
 
PRTMP_ADAPTER
 
pAd
,

1609 
IN
 
INT
 
Eb
)

1611 
BOOLEAN
 
vue
;

1612 
ULONG
 
WaC
;

1613 
WPDMA_GLO_CFG_STRUC
 
GloCfg
;

1615 
vue
 = 
Eb
 > 0 ? 1 : 0;

1618 
WaC
 = 0;

1620 
	`TxDmaBusy
(
pAd
|| 
	`RxDmaBusy
(pAd))

1622 
	`RTMPucDay
(10);

1623 i(
WaC
++ > 100)

1627 
	`RTMP_IO_READ32
(
pAd
, 
WPDMA_GLO_CFG
, &
GloCfg
.
wd
);

1628 
GloCfg
.
fld
.
EbTxDMA
 = 
vue
;

1629 
GloCfg
.
fld
.
EbRxDMA
 = 
vue
;

1630 
	`RTMP_IO_WRITE32
(
pAd
, 
WPDMA_GLO_CFG
, 
GloCfg
.
wd
);

1631 
	`RTMPucDay
(5000);

1634 
	}
}

1640 
VOID
 
	$BbpSoRet
(

1641 
IN
 
PRTMP_ADAPTER
 
pAd
)

1643 
UCHAR
 
BbpDa
 = 0;

1646 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R21
, &
BbpDa
);

1647 
BbpDa
 |= 0x00000001;

1648 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R21
, 
BbpDa
);

1650 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R21
, &
BbpDa
);

1651 
BbpDa
 &= ~(0x00000001);

1652 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R21
, 
BbpDa
);

1655 
	}
}

1658 
VOID
 
	$RtmpRfIoWre
(

1659 
IN
 
PRTMP_ADAPTER
 
pAd
)

1662 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R1
);

1663 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R2
);

1664 
	`RTMP_RF_IO_WRITE32
(
pAd
, (pAd->
LchRfRegs
.
R3
 & (~0x04)));

1665 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R4
);

1667 
	`RTMPucDay
(200);

1670 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R1
);

1671 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R2
);

1672 
	`RTMP_RF_IO_WRITE32
(
pAd
, (pAd->
LchRfRegs
.
R3
 | 0x04));

1673 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R4
);

1675 
	`RTMPucDay
(200);

1678 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R1
);

1679 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R2
);

1680 
	`RTMP_RF_IO_WRITE32
(
pAd
, (pAd->
LchRfRegs
.
R3
 & (~0x04)));

1681 
	`RTMP_RF_IO_WRITE32
(
pAd
,Ad->
LchRfRegs
.
R4
);

1684 
	}
}

1687 
	$CheckMCSVid
(

1688 
IN
 
PRTMP_ADAPTER
 
pAd
,

1689 
IN
 
UCHAR
 
Mode
,

1690 
IN
 
UCHAR
 
Mcs
)

1692 
i
;

1693 
PCHAR
 
pReTab
 = 
NULL
;

1695 
Mode
)

1697 
MODE_CCK
:

1698 
pReTab
 = 
CCKReTab
;

1700 
MODE_OFDM
:

1701 
pReTab
 = 
OFDMReTab
;

1706 
pReTab
 = 
HTMIXReTab
;

1710 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("uecognizab Tx Mod%d\n", 
Mode
));

1715 
i
 = 0;

1716 
pReTab
[
i
] != -1)

1718 i(
pReTab
[
i
] =
Mcs
)

1720 
i
++;

1724 
	}
}

1727 
INT
 
	$ATETxPwrHdr
(

1728 
IN
 
PRTMP_ADAPTER
 
pAd
,

1729 
IN
 
dex
)

1731 
ULONG
 
R
;

1732 
CHAR
 
TxPow
 = 0;

1733 
UCHAR
 
Bbp94
 = 0;

1734 
BOOLEAN
 
bPowRedu
 = 
FALSE
;

1736 #ifde
RALINK_QA


1737 i((
pAd
->
e
.
bQATxS
 =
TRUE
|| (pAd->e.
bQARxS
 == TRUE))

1748 i(
dex
 == 0)

1750 
TxPow
 = 
pAd
->
e
.
TxPow0
;

1752 i(
dex
 == 1)

1754 
TxPow
 = 
pAd
->
e
.
TxPow1
;

1758 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Only TxPower0nd TxPower1redjustable !\n"));

1759 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("TxPow%d iouong!\n", 
dex
));

1763 i(
pAd
->
e
.
Chl
 <= 14)

1765 i(
TxPow
 > 31)

1768 
R
 = 31;

1769 i(
TxPow
 <= 36)

1770 
Bbp94
 = 
BBPR94_DEFAULT
 + (
UCHAR
)(
TxPow
 - 31);

1772 i(
TxPow
 < 0)

1775 
R
 = 0;

1776 i(
TxPow
 >= -6)

1777 
Bbp94
 = 
BBPR94_DEFAULT
 + 
TxPow
;

1782 
R
 = (
ULONG

TxPow
;

1783 
Bbp94
 = 
BBPR94_DEFAULT
;

1786 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%(TxPow=%d, R=%ld, BBP_R94=%d)\n", 
__FUNCTION__
, 
TxPow
, 
R
, 
Bbp94
));

1790 i(
TxPow
 > 15)

1793 
R
 = 15;

1795 i(
TxPow
 < 0)

1799 
	`ASSERT
((
TxPow
 >= -7));

1800 
R
 = (
ULONG
)(
TxPow
 + 7);

1801 
bPowRedu
 = 
TRUE
;

1806 
R
 = (
ULONG

TxPow
;

1809 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%(TxPow=%d, R=%lu)\n", 
__FUNCTION__
, 
TxPow
, 
R
));

1812 i(
pAd
->
e
.
Chl
 <= 14)

1814 i(
dex
 == 0)

1817 
R
 = R << 9;

1818 
R
 |(
pAd
->
LchRfRegs
.
R3
 & 0xffffc1ff);

1819 
pAd
->
LchRfRegs
.
R3
 = 
R
;

1824 
R
 = R << 6;

1825 
R
 |(
pAd
->
LchRfRegs
.
R4
 & 0xfffff83f);

1826 
pAd
->
LchRfRegs
.
R4
 = 
R
;

1831 i(
bPowRedu
 =
FALSE
)

1833 i(
dex
 == 0)

1836 
R
 = (R << 10) | (1 << 9);

1837 
R
 |(
pAd
->
LchRfRegs
.
R3
 & 0xffffc1ff);

1838 
pAd
->
LchRfRegs
.
R3
 = 
R
;

1843 
R
 = (R << 7) | (1 << 6);

1844 
R
 |(
pAd
->
LchRfRegs
.
R4
 & 0xfffff83f);

1845 
pAd
->
LchRfRegs
.
R4
 = 
R
;

1850 i(
dex
 == 0)

1853 
R
 = (R << 10);

1854 
R
 |(
pAd
->
LchRfRegs
.
R3
 & 0xffffc1ff);

1857 
pAd
->
LchRfRegs
.
R3
 = (
R
 & (~(1 << 9)));

1862 
R
 = (R << 7);

1863 
R
 |(
pAd
->
LchRfRegs
.
R4
 & 0xfffff83f);

1866 
pAd
->
LchRfRegs
.
R4
 = (
R
 & (~(1 << 6)));

1870 
	`RtmpRfIoWre
(
pAd
);

1874 
	}
}

1876 #ifde
NEW_TXCONT


1877 
UINT32
 
	gDeu_TX_PIN_CFG
;

1878 
	#RA_TX_PIN_CFG
 0x1328

	)

1879 
	#TXCONT_TX_PIN_CFG_A
 0x040C0050

	)

1880 
	#TXCONT_TX_PIN_CFG_G
 0x080C00A0

	)

1883 
NDIS_STATUS
 
	$ATESTART
(

1884 
IN
 
PRTMP_ADAPTER
 
pAd
)

1886 
UINT32
 
MacDa
=0, 
emode
=0, 
mp
=0;

1887 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

1888 #ifde
RTMP_MAC_PCI


1889 
UINT32
 
rg_dex
=0;

1890 
PTXD_STRUC
 
pTxD
 = 
NULL
;

1891 #ifde
RT_BIG_ENDIAN


1892 
PTXD_STRUC
 
pDeTxD
 = 
NULL
;

1893 
TXD_STRUC
 
TxD
;

1896 #i
	`defed
(
RT30xx
|| defed(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

1897 
UINT32
 
bbp_dex
=0;

1898 
UCHAR
 
ReeRfICTy
=
pAd
->
RfIcTy
;

1900 
UCHAR
 
BbpDa
 = 0;

1902 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : ===> %s\n", 
__FUNCTION__
));

1904 #ifde
RTMP_MAC_PCI


1906 i(!(
	`ATE_ON
(
pAd
)))

1908 
	`NICEFmwe
(
pAd
);

1912 
emode
 = 
pAd
->
e
.
Mode
;

1913 
pAd
->
e
.
Mode
 = 
ATE_START
;

1915 i(
emode
 =
ATE_STOP
)

1919 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

1921 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

1926 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

1927 
MacDa
 &= ~(1 << 3);

1928 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

1931 
	`RTMP_IO_READ32
(
pAd
, 
AUTO_RSP_CFG
, &
mp
);

1932 
mp
 =emp & 0xFFFFFFFE;

1933 
	`RTMP_IO_WRITE32
(
pAd
, 
AUTO_RSP_CFG
, 
mp
);

1935 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

1936 
MacDa
 &= 0xFFFFFFEF;

1937 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

1939 i(
emode
 =
ATE_TXCARR
)

1941 #i
	`defed
(
RT30xx
|| defed(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

1943 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
mp
);

1944 
mp
 =emp | 0x00000002;

1945 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
mp
);

1946 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
mp
);

1947 
mp
 =emp & ~(0x00000002);

1948 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
mp
);

1951 
bbp_dex
=0;bbp_dex<
ATE_BBP_REG_NUM
;bbp_index++)

1952 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
,
bbp_dex
,
e_BBP
[bbp_index]);

1958 
pAd
->
RfIcTy
=
ReeRfICTy
;

1962 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R22
, &
BbpDa
);

1963 
BbpDa
 &= 0xFFFFFF00;

1964 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

1966 i(
emode
 =
ATE_TXCARRSUPP
)

1968 #i
	`defed
(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

1970 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
mp
);

1971 
mp
 =emp | 0x00000002;

1972 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
mp
);

1973 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
mp
);

1974 
mp
 =emp & ~(0x00000002);

1975 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
mp
);

1978 
bbp_dex
=0;bbp_dex<
ATE_BBP_REG_NUM
;bbp_index++)

1979 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
,
bbp_dex
,
e_BBP
[bbp_index]);

1985 
pAd
->
RfIcTy
=
ReeRfICTy
;

1989 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R22
, &
BbpDa
);

1990 
BbpDa
 &= ~(1 << 7);

1991 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

1994 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R24
, &
BbpDa
);

1995 
BbpDa
 &= 0xFFFFFFFE;

1996 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R24
, 
BbpDa
);

2003 i((
emode
 & 
ATE_TXFRAME
|| (emod=
ATE_STOP
))

2005 #ifde
RTMP_MAC_PCI


2006 
PRTMP_TX_RING
 
pTxRg
 = &
pAd
->
TxRg
[
QID_AC_BE
];

2008 i((
emode
 =
ATE_TXCONT
))

2010 #i
	`defed
(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

2013 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
mp
);

2014 
mp
 =emp | 0x00000002;

2015 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
mp
);

2016 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
mp
);

2017 
mp
 =emp & ~(0x00000002);

2018 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
mp
);

2021 
bbp_dex
=0;bbp_dex<
ATE_BBP_REG_NUM
;bbp_index++)

2022 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
,
bbp_dex
,
e_BBP
[bbp_index]);

2025 
pAd
->
RfIcTy
=
ReeRfICTy
;

2029 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R22
, &
BbpDa
);

2030 
BbpDa
 &= ~(1 << 7);

2031 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2032 #ifde
NEW_TXCONT


2033 
	`BbpSoRet
(
pAd
);

2034 
	`RTMP_IO_WRITE32
(
pAd
, 
RA_TX_PIN_CFG
, 
Deu_TX_PIN_CFG
);

2039 
	`RtmpDmaEb
(
pAd
, 0);

2040 #ifde
RTMP_MAC_PCI


2041 
rg_dex
=0;g_dex<
TX_RING_SIZE
;ing_index++)

2043 
PNDIS_PACKET
 
pPack
;

2045 #ide
RT_BIG_ENDIAN


2046 
pTxD
 = (
PTXD_STRUC
)
pAd
->
TxRg
[
QID_AC_BE
].
Cl
[
rg_dex
].
AocVa
;

2048 
pDeTxD
 = (
PTXD_STRUC
)
pAd
->
TxRg
[
QID_AC_BE
].
Cl
[
rg_dex
].
AocVa
;

2049 
TxD
 = *
pDeTxD
;

2050 
pTxD
 = &
TxD
;

2051 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

2053 
pTxD
->
DMADONE
 = 0;

2054 
pPack
 = 
pTxRg
->
Cl
[
rg_dex
].
pNdisPack
;

2056 i(
pPack
)

2058 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP0
,TxD->
SDL0
, 
PCI_DMA_TODEVICE
);

2059 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

2063 
pTxRg
->
Cl
[
rg_dex
].
pNdisPack
 = 
NULL
;

2065 
pPack
 = 
pTxRg
->
Cl
[
rg_dex
].
pNextNdisPack
;

2067 i(
pPack
)

2069 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

2070 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

2074 
pTxRg
->
Cl
[
rg_dex
].
pNextNdisPack
 = 
NULL
;

2075 #ifde
RT_BIG_ENDIAN


2076 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

2077 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

2083 
	`RtmpDmaEb
(
pAd
, 1);

2088 
pAd
->
e
.
LaSNR0
 = 0;

2089 
pAd
->
e
.
LaSNR1
 = 0;

2090 
pAd
->
e
.
LaRssi0
 = 0;

2091 
pAd
->
e
.
LaRssi1
 = 0;

2092 
pAd
->
e
.
LaRssi2
 = 0;

2093 
pAd
->
e
.
AvgRssi0
 = 0;

2094 
pAd
->
e
.
AvgRssi1
 = 0;

2095 
pAd
->
e
.
AvgRssi2
 = 0;

2096 
pAd
->
e
.
AvgRssi0X8
 = 0;

2097 
pAd
->
e
.
AvgRssi1X8
 = 0;

2098 
pAd
->
e
.
AvgRssi2X8
 = 0;

2099 
pAd
->
e
.
NumOfAvgRssiSame
 = 0;

2101 #ifde
RALINK_QA


2103 
pAd
->
e
.
bQATxS
 = 
FALSE
;

2104 
pAd
->
e
.
bQARxS
 = 
FALSE
;

2105 
pAd
->
e
.
q
 = 0;

2108 
pAd
->
e
.
U2M
 = 0;

2109 
pAd
->
e
.
OthDa
 = 0;

2110 
pAd
->
e
.
Bc
 = 0;

2111 
pAd
->
e
.
OthCou
 = 0;

2112 
pAd
->
e
.
TxAc0
 = 0;

2113 
pAd
->
e
.
TxAc1
 = 0;

2114 
pAd
->
e
.
TxAc2
 = 0;

2115 
pAd
->
e
.
TxAc3
 = 0;

2116 
pAd
->
e
.
TxHCCA
 = 0;

2117 
pAd
->
e
.
TxMgmt
 = 0;

2118 
pAd
->
e
.
RSSI0
 = 0;

2119 
pAd
->
e
.
RSSI1
 = 0;

2120 
pAd
->
e
.
RSSI2
 = 0;

2121 
pAd
->
e
.
SNR0
 = 0;

2122 
pAd
->
e
.
SNR1
 = 0;

2125 
pAd
->
e
.
TxDeCou
 = 0;

2127 
pAd
->
e
.
TxStus
 = 0;

2131 
	`BbpSoRet
(
pAd
);

2134 #ifde
CONFIG_STA_SUPPORT


2138 
	`AsicDibSync
(
pAd
);

2139 #ifde
RTMP_MAC_PCI


2140 
	`RTMP_OS_NETDEV_STOP_QUEUE
(
pAd
->
t_dev
);

2146 
	`ATEDibAsicPre
(
pAd
);

2147 
	`RTMPStiSt
(
pAd
);

2150 #ifde
RTMP_MAC_PCI


2152 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2153 
MacDa
 &= ~(1 << 2);

2154 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2157 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2158 
MacDa
 &= ~(1 << 3);

2159 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2165 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : <==%s\n", 
__FUNCTION__
));

2166  
Stus
;

2167 
	}
}

2170 
NDIS_STATUS
 
	$ATESTOP
(

2171 
IN
 
PRTMP_ADAPTER
 
pAd
)

2173 
UINT32
 
MacDa
=0, 
rg_dex
=0;

2174 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

2175 #ifde
RTMP_MAC_PCI


2176 
PRXD_STRUC
 
pRxD
 = 
NULL
;

2178 #i
	`defed
(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

2179 
UINT32
 
bbp_dex
=0;

2180 
UCHAR
 
ReeRfICTy
=
pAd
->
RfIcTy
;

2182 
UCHAR
 
BbpDa
 = 0;

2184 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : ===> %s\n", 
__FUNCTION__
));

2186 #i
	`defed
(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

2189 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2190 
MacDa
 = MacData | 0x00000002;

2191 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2193 
	`RTMPucDay
(10000);

2195 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2196 
MacDa
 = MacData & ~(0x00000002);

2197 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2201 
bbp_dex
=0;bbp_dex<
ATE_BBP_REG_NUM
;bbp_index++)

2202 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
,
bbp_dex
,
e_BBP
[bbp_index]);

2208 
	`ASSERT
(
ReeRfICTy
 != 0);

2209 
pAd
->
RfIcTy
=
ReeRfICTy
;

2213 
BbpDa
 = 0;

2214 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2217 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2218 
MacDa
 &= 0xFFFFFFEF;

2219 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2222 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2223 
MacDa
 &= ~(1 << 3);

2224 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2227 
	`RtmpDmaEb
(
pAd
, 0);

2230 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2231 
MacDa
 &= ~(1 << 2);

2232 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2234 #ifde
RTMP_MAC_PCI


2235 
pAd
->
e
.
bFWLdg
 = 
TRUE
;

2237 
Stus
 = 
	`NICLdFmwe
(
pAd
);

2239 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

2241 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("NICLdFmwed, Stus[=0x%08x]\n", 
Stus
));

2242  
Stus
;

2244 
pAd
->
e
.
Mode
 = 
ATE_STOP
;

2251 
	`BbpSoRet
(
pAd
);

2253 
	`RTMP_ASIC_INTERRUPT_DISABLE
(
pAd
);

2255 
	`NICInlizeAdr
(
pAd
, 
TRUE
);

2261 
rg_dex
 = 0;g_dex < 
RX_RING_SIZE
;ing_index++)

2263 
pRxD
 = (
PRXD_STRUC

pAd
->
RxRg
.
Cl
[
rg_dex
].
AocVa
;

2264 
pRxD
->
DDONE
 = 0;

2268 
	`NICRdEEPROMPams
(
pAd
, 
NULL
);

2269 
	`NICInAsicFromEEPROM
(
pAd
);

2271 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

2274 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

2277 
	`RTMP_IO_WRITE32
(
pAd
, 
INT_SOURCE_CSR
, 0xffffffff);

2279 
	`RTMP_ASIC_INTERRUPT_ENABLE
(
pAd
);

2285 #ifde
CONFIG_STA_SUPPORT


2287 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 
STANORMAL
);

2291 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2292 
MacDa
 |= (1 << 2);

2293 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2296 
	`RtmpDmaEb
(
pAd
, 1);

2299 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2300 
MacDa
 |= (1 << 3);

2301 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2303 #ifde
RTMP_MAC_PCI


2305 #ifde
CONFIG_STA_SUPPORT


2306 
	`RTMPStiS
(
pAd
);

2310 
	`RTMP_OS_NETDEV_START_QUEUE
(
pAd
->
t_dev
);

2312 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : <==%s\n", 
__FUNCTION__
));

2313  
Stus
;

2314 
	}
}

2317 
NDIS_STATUS
 
	$TXCARR
(

2318 
IN
 
PRTMP_ADAPTER
 
pAd
)

2320 
UINT32
 
MacDa
=0;

2321 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

2322 #i
	`defed
(
RT30xx
|| defed(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

2323 
UINT32
 
bbp_dex
=0;

2325 
UCHAR
 
BbpDa
 = 0;

2327 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : ===> %s\n", 
__FUNCTION__
));

2329 
pAd
->
e
.
Mode
 = 
ATE_TXCARR
;

2331 #i
	`defed
(
RT30xx
|| defed(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

2333 
bbp_dex
=0;bbp_dex<
ATE_BBP_REG_NUM
;bbp_index++)

2334 
e_BBP
[
bbp_dex
]=0;

2337 
bbp_dex
=0;bbp_dex<
ATE_BBP_REG_NUM
;bbp_index++)

2338 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
,
bbp_dex
,&
e_BBP
[bbp_index]);

2343 i(
pAd
->
e
.
bQATxS
 =
FALSE
)

2347 
	`BbpSoRet
(
pAd
);

2350 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R22
, &
BbpDa
);

2351 
BbpDa
 &= 0xFFFFFF00;

2352 
BbpDa
 |= 0x000000C1;

2353 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2356 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2357 
MacDa
 = MacData | 0x00000010;

2358 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2361 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : <==%s\n", 
__FUNCTION__
));

2362  
Stus
;

2363 
	}
}

2366 
NDIS_STATUS
 
	$TXCONT
(

2367 
IN
 
PRTMP_ADAPTER
 
pAd
)

2369 
UINT32
 
MacDa
=0;

2370 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

2371 #ifde
RTMP_MAC_PCI


2372 
UINT32
 
rg_dex
=0;

2373 
PTXD_STRUC
 
pTxD
 = 
NULL
;

2374 
PRTMP_TX_RING
 
pTxRg
 = &
pAd
->
TxRg
[
QID_AC_BE
];

2375 #ifde
RT_BIG_ENDIAN


2376 
PTXD_STRUC
 
pDeTxD
 = 
NULL
;

2377 
TXD_STRUC
 
TxD
;

2380 #i
	`defed
(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

2381 
UINT32
 
bbp_dex
=0;

2383 
UCHAR
 
BbpDa
 = 0;

2385 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : ===> %s\n", 
__FUNCTION__
));

2387 i(
pAd
->
e
.
bQATxS
 =
TRUE
)

2393 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2394 
MacDa
 &= 0xFFFFFFEB;

2395 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2398 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R22
, &
BbpDa
);

2399 
BbpDa
 &= 0xFFFFFF7F;

2400 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2402 #ifde
NEW_TXCONT


2406 
	`RTMP_IO_READ32
(
pAd
, 
RA_TX_PIN_CFG
, &
Deu_TX_PIN_CFG
);

2410 #i
	`defed
(
RT305x
|| defed(
RT3350
|| defed(
RT3352
|| defed(
RT2883
)

2412 
bbp_dex
=0;bbp_dex<
ATE_BBP_REG_NUM
;bbp_index++)

2413 
e_BBP
[
bbp_dex
]=0;

2416 
bbp_dex
=0;bbp_dex<
ATE_BBP_REG_NUM
;bbp_index++)

2417 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
,
bbp_dex
,&
e_BBP
[bbp_index]);

2422 
pAd
->
e
.
Mode
 = 
ATE_TXCONT
;

2423 
pAd
->
e
.
TxCou
 = 50;

2427 
	`BbpSoRet
(
pAd
);

2430 
	`RtmpDmaEb
(
pAd
, 0);

2432 #ifde
RTMP_MAC_PCI


2434 
	`RTMP_IO_READ32
(
pAd
, 
TX_DTX_IDX0
 + 
QID_AC_BE
 * 0x10, &
pTxRg
->
TxDmaIdx
);

2435 
pTxRg
->
TxSwFeIdx
 =TxRg->
TxDmaIdx
;

2436 
pTxRg
->
TxCpuIdx
 =TxRg->
TxDmaIdx
;

2437 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_CTX_IDX0
 + 
QID_AC_BE
 * 0x10, 
pTxRg
->
TxCpuIdx
);

2442 
pAd
->
e
.
TxDeCou
 = 0;

2445 
	`SJFr
(
pAd
);

2447 #ifde
RTMP_MAC_PCI


2448 
rg_dex
 = 0; (rg_dex < 
TX_RING_SIZE
-1&& (rg_dex < 
pAd
->
e
.
TxCou
);ing_index++)

2450 
PNDIS_PACKET
 
pPack
;

2451 
UINT32
 
TxIdx
 = 
pTxRg
->
TxCpuIdx
;

2453 #ide
RT_BIG_ENDIAN


2454 
pTxD
 = (
PTXD_STRUC
)
pTxRg
->
Cl
[
TxIdx
].
AocVa
;

2456 
pDeTxD
 = (
PTXD_STRUC
)
pTxRg
->
Cl
[
TxIdx
].
AocVa
;

2457 
TxD
 = *
pDeTxD
;

2458 
pTxD
 = &
TxD
;

2459 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

2463 
pPack
 = 
pTxRg
->
Cl
[
TxIdx
].
pNdisPack
;

2465 i(
pPack
)

2467 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP0
,TxD->
SDL0
, 
PCI_DMA_TODEVICE
);

2468 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

2472 
pTxRg
->
Cl
[
TxIdx
].
pNdisPack
 = 
NULL
;

2474 
pPack
 = 
pTxRg
->
Cl
[
TxIdx
].
pNextNdisPack
;

2476 i(
pPack
)

2478 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

2479 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

2483 
pTxRg
->
Cl
[
TxIdx
].
pNextNdisPack
 = 
NULL
;

2485 #ifde
RT_BIG_ENDIAN


2486 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

2487 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

2490 i(
	`ATESUpFme
(
pAd
, 
TxIdx
) != 0)

2491  
NDIS_STATUS_FAILURE
;

2493 
	`INC_RING_INDEX
(
pTxRg
->
TxCpuIdx
, 
TX_RING_SIZE
);

2496 
	`ATESUpFme
(
pAd
, 
pTxRg
->
TxCpuIdx
);

2501 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2502 
MacDa
 |= (1 << 2);

2503 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2506 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2507 
MacDa
 &= ~(1 << 3);

2508 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2511 
	`RtmpDmaEb
(
pAd
, 1);

2514 #ifde
RALINK_QA


2515 i(
pAd
->
e
.
bQATxS
 =
TRUE
)

2517 
pAd
->
e
.
TxStus
 = 1;

2521 #ifde
RTMP_MAC_PCI


2523 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_CTX_IDX0
 + 
QID_AC_BE
 * 
RINGREG_DIFF
,Ad->
TxRg
[QID_AC_BE].
TxCpuIdx
);

2525 
	`RTMPucDay
(5000);

2529 #ifde
NEW_TXCONT


2531 i(
pAd
->
e
.
Chl
 < 14)

2534 
MacDa
 = 
TXCONT_TX_PIN_CFG_G
;

2535 
	`RTMP_IO_WRITE32
(
pAd
, 
RA_TX_PIN_CFG
, 
MacDa
);

2540 
MacDa
 = 
TXCONT_TX_PIN_CFG_A
;

2541 
	`RTMP_IO_WRITE32
(
pAd
, 
RA_TX_PIN_CFG
, 
MacDa
);

2545 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R22
, &
BbpDa
);

2546 
BbpDa
 |= 0x00000080;

2547 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2551 
	`RtmpDmaEb
(
pAd
, 0);

2554 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R22
, &
BbpDa
);

2555 
BbpDa
 |= 0x00000080;

2556 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2558 
pAd
->
e
.
TxCou
 = 50;

2559 #ifde
RTMP_MAC_PCI


2561 
	`RTMP_IO_READ32
(
pAd
, 
TX_DTX_IDX0
 + 
QID_AC_BE
 * 0x10, &
pTxRg
->
TxDmaIdx
);

2562 
pTxRg
->
TxSwFeIdx
 =TxRg->
TxDmaIdx
;

2563 
pTxRg
->
TxCpuIdx
 =TxRg->
TxDmaIdx
;

2564 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_CTX_IDX0
 + 
QID_AC_BE
 * 0x10, 
pTxRg
->
TxCpuIdx
);

2568 
pAd
->
e
.
TxDeCou
 = 0;

2569 
	`SJFr
(
pAd
);

2571 #ifde
RTMP_MAC_PCI


2572 
rg_dex
 = 0; (rg_dex < 
TX_RING_SIZE
-1&& (rg_dex < 
pAd
->
e
.
TxCou
);ing_index++)

2574 
PNDIS_PACKET
 
pPack
;

2575 
UINT32
 
TxIdx
 = 
pTxRg
->
TxCpuIdx
;

2577 #ide
RT_BIG_ENDIAN


2578 
pTxD
 = (
PTXD_STRUC
)
pTxRg
->
Cl
[
TxIdx
].
AocVa
;

2580 
pDeTxD
 = (
PTXD_STRUC
)
pTxRg
->
Cl
[
TxIdx
].
AocVa
;

2581 
TxD
 = *
pDeTxD
;

2582 
pTxD
 = &
TxD
;

2583 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

2586 
pPack
 = 
pTxRg
->
Cl
[
TxIdx
].
pNdisPack
;

2588 i(
pPack
)

2590 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP0
,TxD->
SDL0
, 
PCI_DMA_TODEVICE
);

2591 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

2595 
pTxRg
->
Cl
[
TxIdx
].
pNdisPack
 = 
NULL
;

2597 
pPack
 = 
pTxRg
->
Cl
[
TxIdx
].
pNextNdisPack
;

2599 i(
pPack
)

2601 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

2602 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

2606 
pTxRg
->
Cl
[
TxIdx
].
pNextNdisPack
 = 
NULL
;

2608 #ifde
RT_BIG_ENDIAN


2609 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

2610 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

2613 i(
	`ATESUpFme
(
pAd
, 
TxIdx
) != 0)

2614  
NDIS_STATUS_FAILURE
;

2616 
	`INC_RING_INDEX
(
pTxRg
->
TxCpuIdx
, 
TX_RING_SIZE
);

2619 
	`ATESUpFme
(
pAd
, 
pTxRg
->
TxCpuIdx
);

2624 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2625 
MacDa
 |= (1 << 2);

2626 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2629 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2630 
MacDa
 &= ~(1 << 3);

2631 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2634 
	`RtmpDmaEb
(
pAd
, 1);

2636 #ifde
RALINK_QA


2637 i(
pAd
->
e
.
bQATxS
 =
TRUE
)

2639 
pAd
->
e
.
TxStus
 = 1;

2643 #ifde
RTMP_MAC_PCI


2645 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_CTX_IDX0
 + 
QID_AC_BE
 * 
RINGREG_DIFF
,Ad->
TxRg
[QID_AC_BE].
TxCpuIdx
);

2648 
	`RTMPucDay
(500);

2651 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2652 
MacDa
 |= 0x00000010;

2653 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2656 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : <==%s\n", 
__FUNCTION__
));

2657  
Stus
;

2658 
	}
}

2661 
NDIS_STATUS
 
	$TXFRAME
(

2662 
IN
 
PRTMP_ADAPTER
 
pAd
)

2664 
UINT32
 
MacDa
=0;

2665 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

2666 #ifde
RTMP_MAC_PCI


2667 
UINT32
 
rg_dex
=0;

2668 
PRTMP_TX_RING
 
pTxRg
 = &
pAd
->
TxRg
[
QID_AC_BE
];

2669 
PTXD_STRUC
 
pTxD
 = 
NULL
;

2670 #ifde
RT_BIG_ENDIAN


2671 
PTXD_STRUC
 
pDeTxD
 = 
NULL
;

2672 
TXD_STRUC
 
TxD
;

2675 
UCHAR
 
BbpDa
 = 0;

2677 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : ===> %s(Cou=%d)\n", 
__FUNCTION__
, 
pAd
->
e
.
TxCou
));

2678 
pAd
->
e
.
Mode
 |
ATE_TXFRAME
;

2680 #ifde
RTMP_MAC_PCI


2682 
BbpDa
 = 0;

2683 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2687 
	`BbpSoRet
(
pAd
);

2690 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2691 
MacDa
 &= 0xFFFFFFEF;

2692 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2695 
	`RtmpDmaEb
(
pAd
, 0);

2698 
	`RTMP_IO_READ32
(
pAd
, 
TX_DTX_IDX0
 + 
QID_AC_BE
 * 
RINGREG_DIFF
, &
pTxRg
->
TxDmaIdx
);

2699 
pTxRg
->
TxSwFeIdx
 =TxRg->
TxDmaIdx
;

2700 
pTxRg
->
TxCpuIdx
 =TxRg->
TxDmaIdx
;

2701 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_CTX_IDX0
 + 
QID_AC_BE
 * 
RINGREG_DIFF
, 
pTxRg
->
TxCpuIdx
);

2704 
pAd
->
e
.
TxDeCou
 = 0;

2706 
	`SJFr
(
pAd
);

2708 
rg_dex
 = 0; (rg_dex < 
TX_RING_SIZE
-1&& (rg_dex < 
pAd
->
e
.
TxCou
);ing_index++)

2710 
PNDIS_PACKET
 
pPack
;

2711 
UINT32
 
TxIdx
 = 
pTxRg
->
TxCpuIdx
;

2713 #ide
RT_BIG_ENDIAN


2714 
pTxD
 = (
PTXD_STRUC
)
pTxRg
->
Cl
[
TxIdx
].
AocVa
;

2716 
pDeTxD
 = (
PTXD_STRUC
)
pTxRg
->
Cl
[
TxIdx
].
AocVa
;

2717 
TxD
 = *
pDeTxD
;

2718 
pTxD
 = &
TxD
;

2719 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

2722 
pPack
 = 
pTxRg
->
Cl
[
TxIdx
].
pNdisPack
;

2724 i(
pPack
)

2726 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP0
,TxD->
SDL0
, 
PCI_DMA_TODEVICE
);

2727 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

2731 
pTxRg
->
Cl
[
TxIdx
].
pNdisPack
 = 
NULL
;

2733 
pPack
 = 
pTxRg
->
Cl
[
TxIdx
].
pNextNdisPack
;

2735 i(
pPack
)

2737 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

2738 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

2742 
pTxRg
->
Cl
[
TxIdx
].
pNextNdisPack
 = 
NULL
;

2744 #ifde
RT_BIG_ENDIAN


2745 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

2746 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

2749 i(
	`ATESUpFme
(
pAd
, 
TxIdx
) != 0)

2750  
NDIS_STATUS_FAILURE
;

2752 
	`INC_RING_INDEX
(
pTxRg
->
TxCpuIdx
, 
TX_RING_SIZE
);

2756 
	`ATESUpFme
(
pAd
, 
pTxRg
->
TxCpuIdx
);

2759 
	`RtmpDmaEb
(
pAd
, 1);

2762 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2763 
MacDa
 |= (1 << 2);

2764 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2768 #ifde
RALINK_QA


2770 i(
pAd
->
e
.
bQARxS
 =
FALSE
)

2773 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2774 
MacDa
 &= ~(1 << 3);

2775 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2778 i(
pAd
->
e
.
bQATxS
 =
TRUE
)

2780 
pAd
->
e
.
TxStus
 = 1;

2784 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2785 
MacDa
 &= ~(1 << 3);

2786 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2789 #ifde
RTMP_MAC_PCI


2790 
	`RTMP_IO_READ32
(
pAd
, 
TX_DTX_IDX0
 + 
QID_AC_BE
 * 
RINGREG_DIFF
, &pAd->
TxRg
[QID_AC_BE].
TxDmaIdx
);

2792 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_CTX_IDX0
 + 
QID_AC_BE
 * 
RINGREG_DIFF
,Ad->
TxRg
[QID_AC_BE].
TxCpuIdx
);

2794 
pAd
->
RkCous
.
KickTxCou
++;

2798 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : <==%s\n", 
__FUNCTION__
));

2799  
Stus
;

2800 
	}
}

2803 
NDIS_STATUS
 
	$RXFRAME
(

2804 
IN
 
PRTMP_ADAPTER
 
pAd
)

2806 
UINT32
 
MacDa
=0;

2807 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

2808 
UCHAR
 
BbpDa
 = 0;

2810 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : ===> %s\n", 
__FUNCTION__
));

2813 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2814 
MacDa
 &= ~(1 << 3);

2815 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2818 
BbpDa
 = 0;

2819 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2823 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2824 
MacDa
 &= 0xFFFFFFEF;

2825 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2827 
pAd
->
e
.
Mode
 |
ATE_RXFRAME
;

2831 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2832 
MacDa
 &= ~(1 << 2);

2833 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2837 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2838 
MacDa
 |= (1 << 3);

2839 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2842 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : <==%s\n", 
__FUNCTION__
));

2843  
Stus
;

2844 
	}
}

2847 #ifde
RALINK_QA


2848 
NDIS_STATUS
 
	$TXSTOP
(

2849 
IN
 
PRTMP_ADAPTER
 
pAd
)

2851 
UINT32
 
MacDa
=0, 
emode
=0;

2852 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

2853 #ifde
RTMP_MAC_PCI


2854 
UINT32
 
rg_dex
=0;

2855 
PTXD_STRUC
 
pTxD
 = 
NULL
;

2856 
PRTMP_TX_RING
 
pTxRg
 = &
pAd
->
TxRg
[
QID_AC_BE
];

2857 #ifde
RT_BIG_ENDIAN


2858 
PTXD_STRUC
 
pDeTxD
 = 
NULL
;

2859 
TXD_STRUC
 
TxD
;

2862 
UCHAR
 
BbpDa
 = 0;

2864 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : ===> %s\n", 
__FUNCTION__
));

2866 
emode
 = 
pAd
->
e
.
Mode
;

2867 
pAd
->
e
.
Mode
 &
ATE_TXSTOP
;

2868 
pAd
->
e
.
bQATxS
 = 
FALSE
;

2870 i(
emode
 =
ATE_TXCARR
)

2873 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R22
, &
BbpDa
);

2874 
BbpDa
 &= 0xFFFFFF00;

2875 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2877 i(
emode
 =
ATE_TXCARRSUPP
)

2880 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R22
, &
BbpDa
);

2881 
BbpDa
 &= ~(1 << 7);

2882 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2885 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R24
, &
BbpDa
);

2886 
BbpDa
 &= 0xFFFFFFFE;

2887 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R24
, 
BbpDa
);

2894 i((
emode
 & 
ATE_TXFRAME
|| (emod=
ATE_STOP
))

2896 i(
emode
 =
ATE_TXCONT
)

2898 #ide
NEW_TXCONT


2901 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R22
, &
BbpDa
);

2902 
BbpDa
 &= ~(1 << 7);

2903 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R22
, 
BbpDa
);

2907 #ifde
RTMP_MAC_PCI


2909 
	`RtmpDmaEb
(
pAd
, 0);

2911 
rg_dex
=0;g_dex<
TX_RING_SIZE
;ing_index++)

2913 
PNDIS_PACKET
 
pPack
;

2915 #ide
RT_BIG_ENDIAN


2916 
pTxD
 = (
PTXD_STRUC
)
pAd
->
TxRg
[
QID_AC_BE
].
Cl
[
rg_dex
].
AocVa
;

2918 
pDeTxD
 = (
PTXD_STRUC
)
pAd
->
TxRg
[
QID_AC_BE
].
Cl
[
rg_dex
].
AocVa
;

2919 
TxD
 = *
pDeTxD
;

2920 
pTxD
 = &
TxD
;

2921 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

2923 
pTxD
->
DMADONE
 = 0;

2924 
pPack
 = 
pTxRg
->
Cl
[
rg_dex
].
pNdisPack
;

2926 i(
pPack
)

2928 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP0
,TxD->
SDL0
, 
PCI_DMA_TODEVICE
);

2929 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

2933 
pTxRg
->
Cl
[
rg_dex
].
pNdisPack
 = 
NULL
;

2935 
pPack
 = 
pTxRg
->
Cl
[
rg_dex
].
pNextNdisPack
;

2937 i(
pPack
)

2939 
	`PCI_UNMAP_SINGLE
(
pAd
, 
pTxD
->
SDP1
,TxD->
SDL1
, 
PCI_DMA_TODEVICE
);

2940 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_SUCCESS
);

2944 
pTxRg
->
Cl
[
rg_dex
].
pNextNdisPack
 = 
NULL
;

2945 #ifde
RT_BIG_ENDIAN


2946 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

2947 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

2951 
	`RtmpDmaEb
(
pAd
, 1);

2957 
pAd
->
e
.
TxStus
 = 0;

2959 #ide
NEW_TXCONT


2961 
	`BbpSoRet
(
pAd
);

2965 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2966 
MacDa
 &= ~(1 << 2);

2967 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2970 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : <==%s\n", 
__FUNCTION__
));

2971  
Stus
;

2972 
	}
}

2975 
NDIS_STATUS
 
	$RXSTOP
(

2976 
IN
 
PRTMP_ADAPTER
 
pAd
)

2978 
UINT32
 
MacDa
=0;

2979 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

2981 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : ===> %s\n", 
__FUNCTION__
));

2984 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
MacDa
);

2985 
MacDa
 &= ~(1 << 3);

2986 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
MacDa
);

2988 
pAd
->
e
.
Mode
 &
ATE_RXSTOP
;

2989 
pAd
->
e
.
bQARxS
 = 
FALSE
;

2995 
	`BbpSoRet
(
pAd
);

2997 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : <==%s\n", 
__FUNCTION__
));

2998  
Stus
;

2999 
	}
}

3022 
NDIS_STATUS
 
	$ATECmdHdr
(

3023 
IN
 
PRTMP_ADAPTER
 
pAd
,

3024 
IN
 
PSTRING
 
g
)

3026 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

3028 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> %s\n", 
__FUNCTION__
));

3030 #ifdef 
CONFIG_RT2880_ATE_CMD_NEW


3031 i(!
	`rcmp
(
g
, "ATESTART"))

3034 
Stus
 = 
	`ATESTART
(
pAd
);

3036 i(!
	`rcmp
(
g
, "ATESTOP"))

3039 
Stus
 = 
	`ATESTOP
(
pAd
);

3042 i(!
	`rcmp
(
g
, "APSTOP"))

3044 
Stus
 = 
	`ATESTART
(
pAd
);

3046 i(!
	`rcmp
(
g
, "APSTART"))

3048 
Stus
 = 
	`ATESTOP
(
pAd
);

3051 i(!
	`rcmp
(
g
, "TXCARR"))

3053 
	`ATEAsicSwchChl
(
pAd
);

3055 
	`AsicLockChl
(
pAd
,Ad->
e
.
Chl
);

3056 
	`RTMPucDay
(5000);

3057 
Stus
 = 
	`TXCARR
(
pAd
);

3059 i(!
	`rcmp
(
g
, "TXCONT"))

3061 
	`ATEAsicSwchChl
(
pAd
);

3063 
	`AsicLockChl
(
pAd
,Ad->
e
.
Chl
);

3064 
	`RTMPucDay
(5000);

3065 
Stus
 = 
	`TXCONT
(
pAd
);

3067 i(!
	`rcmp
(
g
, "TXFRAME"))

3069 
	`ATEAsicSwchChl
(
pAd
);

3071 
	`AsicLockChl
(
pAd
,Ad->
e
.
Chl
);

3072 
	`RTMPucDay
(5000);

3073 
Stus
 = 
	`TXFRAME
(
pAd
);

3075 i(!
	`rcmp
(
g
, "RXFRAME"))

3077 
	`ATEAsicSwchChl
(
pAd
);

3079 
	`AsicLockChl
(
pAd
,Ad->
e
.
Chl
);

3080 
	`RTMPucDay
(5000);

3081 
Stus
 = 
	`RXFRAME
(
pAd
);

3083 #ifde
RALINK_QA


3085 i(!
	`rcmp
(
g
, "TXSTOP"))

3087 
Stus
 = 
	`TXSTOP
(
pAd
);

3089 i(!
	`rcmp
(
g
, "RXSTOP"))

3091 
Stus
 = 
	`RXSTOP
(
pAd
);

3096 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATE : Invalidrg !\n"));

3097 
Stus
 = 
NDIS_STATUS_INVALID_DATA
;

3099 
	`RTMPucDay
(5000);

3101 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<==%s\n", 
__FUNCTION__
));

3102  
Stus
;

3103 
	}
}

3106 
INT
 
	$S_ATE_Proc
(

3107 
IN
 
PRTMP_ADAPTER
 
pAd
,

3108 
IN
 
PSTRING
 
g
)

3111 i(!
	`rcmp
(
g
, "ATEACTIVE"))

3113 
pAd
->
e
.
PassiveMode
 = 
FALSE
;

3114  
TRUE
;

3117 i(!
	`rcmp
(
g
, "ATEPASSIVE"))

3119 
pAd
->
e
.
PassiveMode
 = 
TRUE
;

3120  
TRUE
;

3124 i(
pAd
->
e
.
PassiveMode
)

3125  
TRUE
;

3127 i(
	`ATECmdHdr
(
pAd
, 
g
=
NDIS_STATUS_SUCCESS
)

3129 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_Proc Success\n"));

3131  
TRUE
;

3135 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_Proc Failed\n"));

3136  
FALSE
;

3138 
	}
}

3152 
INT
 
	$S_ATE_DA_Proc
(

3153 
IN
 
PRTMP_ADAPTER
 
pAd
,

3154 
IN
 
PSTRING
 
g
)

3156 
PSTRING
 
vue
;

3157 
INT
 
i
;

3160 i(
	`
(
g
) != 17)

3161  
FALSE
;

3163 
i
 = 0, 
vue
 = 
	`rok
(
g
, ":"); vue; vurok(
NULL
, ":"))

3166 i((
	`
(
vue
!2|| (!
	`isxdig
(*value)) || (!isxdigit(*(value+1))))

3168  
FALSE
;

3171 #ifde
CONFIG_STA_SUPPORT


3172 
	`AtoH
(
vue
, &
pAd
->
e
.
Addr3
[
i
++], 1);

3177 i(
i
 != 6)

3179  
FALSE
;

3182 #ifde
CONFIG_STA_SUPPORT


3183 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_DA_Pro(DA = %2X:%2X:%2X:%2X:%2X:%2X)\n", 
pAd
->
e
.
Addr3
[0],

3184 
pAd
->
e
.
Addr3
[1],Ad->ate.Addr3[2],Ad->ate.Addr3[3],Ad->ate.Addr3[4],Ad->ate.Addr3[5]));

3187 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_DA_Proc Success\n"));

3189  
TRUE
;

3190 
	}
}

3204 
INT
 
	$S_ATE_SA_Proc
(

3205 
IN
 
PRTMP_ADAPTER
 
pAd
,

3206 
IN
 
PSTRING
 
g
)

3208 
PSTRING
 
vue
;

3209 
INT
 
i
;

3212 i(
	`
(
g
) != 17)

3213  
FALSE
;

3215 
i
=0, 
vue
 = 
	`rok
(
g
, ":"); vue; vurok(
NULL
, ":"))

3218 i((
	`
(
vue
!2|| (!
	`isxdig
(*value)) || (!isxdigit(*(value+1))))

3220  
FALSE
;

3223 #ifde
CONFIG_STA_SUPPORT


3224 
	`AtoH
(
vue
, &
pAd
->
e
.
Addr2
[
i
++], 1);

3229 i(
i
 != 6)

3231  
FALSE
;

3234 #ifde
CONFIG_STA_SUPPORT


3235 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_SA_Pro(SA = %2X:%2X:%2X:%2X:%2X:%2X)\n", 
pAd
->
e
.
Addr2
[0],

3236 
pAd
->
e
.
Addr2
[1],Ad->ate.Addr2[2],Ad->ate.Addr2[3],Ad->ate.Addr2[4],Ad->ate.Addr2[5]));

3239 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_SA_Proc Success\n"));

3241  
TRUE
;

3242 
	}
}

3256 
INT
 
	$S_ATE_BSSID_Proc
(

3257 
IN
 
PRTMP_ADAPTER
 
pAd
,

3258 
IN
 
PSTRING
 
g
)

3260 
PSTRING
 
vue
;

3261 
INT
 
i
;

3264 i(
	`
(
g
) != 17)

3265  
FALSE
;

3267 
i
=0, 
vue
 = 
	`rok
(
g
, ":"); vue; vurok(
NULL
, ":"))

3270 i((
	`
(
vue
!2|| (!
	`isxdig
(*value)) || (!isxdigit(*(value+1))))

3272  
FALSE
;

3275 #ifde
CONFIG_STA_SUPPORT


3276 
	`AtoH
(
vue
, &
pAd
->
e
.
Addr1
[
i
++], 1);

3281 if(
i
 != 6)

3283  
FALSE
;

3286 #ifde
CONFIG_STA_SUPPORT


3287 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_BSSID_Pro(BSSID = %2X:%2X:%2X:%2X:%2X:%2X)\n", 
pAd
->
e
.
Addr1
[0],

3288 
pAd
->
e
.
Addr1
[1],Ad->ate.Addr1[2],Ad->ate.Addr1[3],Ad->ate.Addr1[4],Ad->ate.Addr1[5]));

3291 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_BSSID_Proc Success\n"));

3293  
TRUE
;

3294 
	}
}

3306 
INT
 
	$S_ATE_CHANNEL_Proc
(

3307 
IN
 
PRTMP_ADAPTER
 
pAd
,

3308 
IN
 
PSTRING
 
g
)

3310 
UCHAR
 
chl
;

3312 
chl
 = 
	`sime_
(
g
, 0, 10);

3315 i((
chl
 < 1) || (channel > 216))

3317 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Set_ATE_CHANNEL_Proc::Out ofange, it should be inange of 1~14.\n"));

3318  
FALSE
;

3322 
pAd
->
e
.
Chl
 = 
chl
;

3324 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_CHANNEL_Pro(ATE Ch%d)\n", 
pAd
->
e
.
Chl
));

3325 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_CHANNEL_Proc Success\n"));

3328  
TRUE
;

3329 
	}
}

3341 
INT
 
	$S_ATE_TX_POWER0_Proc
(

3342 
IN
 
PRTMP_ADAPTER
 
pAd
,

3343 
IN
 
PSTRING
 
g
)

3345 
CHAR
 
TxPow
;

3347 
TxPow
 = 
	`sime_
(
g
, 0, 10);

3349 i(
pAd
->
e
.
Chl
 <= 14)

3351 i((
TxPow
 > 31) || (TxPower < 0))

3353 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("S_ATE_TX_POWER0_Proc::Ouong(Vue=%d)\n", 
TxPow
));

3354  
FALSE
;

3359 i((
TxPow
 > 15) || (TxPower < -7))

3361 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("S_ATE_TX_POWER0_Proc::Ouong(Vue=%d)\n", 
TxPow
));

3362  
FALSE
;

3366 
pAd
->
e
.
TxPow0
 = 
TxPow
;

3367 
	`ATETxPwrHdr
(
pAd
, 0);

3370 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_TX_POWER0_Proc Success\n"));

3373  
TRUE
;

3374 
	}
}

3386 
INT
 
	$S_ATE_TX_POWER1_Proc
(

3387 
IN
 
PRTMP_ADAPTER
 
pAd
,

3388 
IN
 
PSTRING
 
g
)

3390 
CHAR
 
TxPow
;

3392 
TxPow
 = 
	`sime_
(
g
, 0, 10);

3394 i(
pAd
->
e
.
Chl
 <= 14)

3396 i((
TxPow
 > 31) || (TxPower < 0))

3398 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("S_ATE_TX_POWER1_Proc::Ouong(Vue=%d)\n", 
TxPow
));

3399  
FALSE
;

3404 i((
TxPow
 > 15) || (TxPower < -7))

3406 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("S_ATE_TX_POWER1_Proc::Ouong(Vue=%d)\n", 
TxPow
));

3407  
FALSE
;

3411 
pAd
->
e
.
TxPow1
 = 
TxPow
;

3412 
	`ATETxPwrHdr
(
pAd
, 1);

3415 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_TX_POWER1_Proc Success\n"));

3418  
TRUE
;

3419 
	}
}

3433 
INT
 
	$S_ATE_TX_A_Proc
(

3434 
IN
 
PRTMP_ADAPTER
 
pAd
,

3435 
IN
 
PSTRING
 
g
)

3437 
CHAR
 
vue
;

3439 
vue
 = 
	`sime_
(
g
, 0, 10);

3441 i((
vue
 > 2) || (value < 0))

3443 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("S_ATE_TX_A_Proc::Ouong(Vue=%d)\n", 
vue
));

3444  
FALSE
;

3447 
pAd
->
e
.
TxAS
 = 
vue
;

3449 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_TX_A_Pro(A = %d)\n", 
pAd
->
e
.
TxAS
));

3450 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Ralink: Set_ATE_TX_Antenna_Proc Success\n"));

3453 
	`ATEAsicSwchChl
(
pAd
);

3456  
TRUE
;

3457 
	}
}

3469 
INT
 
	$S_ATE_RX_A_Proc
(

3470 
IN
 
PRTMP_ADAPTER
 
pAd
,

3471 
IN
 
PSTRING
 
g
)

3473 
CHAR
 
vue
;

3475 
vue
 = 
	`sime_
(
g
, 0, 10);

3477 i((
vue
 > 3) || (value < 0))

3479 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("S_ATE_RX_A_Proc::Ouong(Vue=%d)\n", 
vue
));

3480  
FALSE
;

3483 
pAd
->
e
.
RxAS
 = 
vue
;

3485 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_RX_A_Pro(A = %d)\n", 
pAd
->
e
.
RxAS
));

3486 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_RX_Antenna_Proc Success\n"));

3489 
	`ATEAsicSwchChl
(
pAd
);

3492  
TRUE
;

3493 
	}
}

3507 
INT
 
	$S_ATE_TX_FREQOFFSET_Proc
(

3508 
IN
 
PRTMP_ADAPTER
 
pAd
,

3509 
IN
 
PSTRING
 
g
)

3511 
UCHAR
 
RFFqOfft
 = 0;

3512 
ULONG
 
R4
 = 0;

3514 
RFFqOfft
 = 
	`sime_
(
g
, 0, 10);

3516 i(
RFFqOfft
 >= 64)

3518 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Set_ATE_TX_FREQOFFSET_Proc::Out ofange(0 ~ 63).\n"));

3519  
FALSE
;

3522 
pAd
->
e
.
RFFqOfft
 = RFFreqOffset;

3527 
R4
 = 
pAd
->
e
.
RFFqOfft
 << 15;

3528 
R4
 |(
pAd
->
LchRfRegs
.R4 & ((~0x001f8000)));

3529 
pAd
->
LchRfRegs
.
R4
 = R4;

3531 
	`RtmpRfIoWre
(
pAd
);

3534 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_TX_FREQOFFSET_Pro(RFFqOff%d)\n", 
pAd
->
e
.
RFFqOfft
));

3535 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_TX_FREQOFFSET_Proc Success\n"));

3538  
TRUE
;

3539 
	}
}

3551 
INT
 
	$S_ATE_TX_BW_Proc
(

3552 
IN
 
PRTMP_ADAPTER
 
pAd
,

3553 
IN
 
PSTRING
 
g
)

3555 
INT
 
powIndex
;

3556 
UCHAR
 
vue
 = 0;

3557 
UCHAR
 
BBPCutBW
;

3559 
BBPCutBW
 = 
	`sime_
(
g
, 0, 10);

3561 i((
BBPCutBW
 == 0)

3564 
pAd
->
e
.
TxWI
.
BW
 = 
BW_20
;

3568 
pAd
->
e
.
TxWI
.
BW
 = 
BW_40
;

3574 i((
pAd
->
e
.
TxWI
.
PHYMODE
 =
MODE_CCK
&& (pAd->e.TxWI.
BW
 =
BW_40
))

3576 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Set_ATE_TX_BW_Proc!! Warning!! CCK only supports 20MHZ!!\nBandwidth switcho 20\n"));

3577 
pAd
->
e
.
TxWI
.
BW
 = 
BW_20
;

3580 i(
pAd
->
e
.
TxWI
.
BW
 =
BW_20
)

3582 i(
pAd
->
e
.
Chl
 <= 14)

3584 
powIndex
=0;owIndex<
MAX_TXPOWER_ARRAY_SIZE
;owerIndex++)

3586 i(
pAd
->
Tx20MPwrCfgGBd
[
powIndex
] == 0xffffffff)

3590 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_PWR_CFG_0
 + 
powIndex
*4,Ad->
Tx20MPwrCfgGBd
[powerIndex]);

3592 
	`RTMPucDay
(5000);

3597 
powIndex
=0;owIndex<
MAX_TXPOWER_ARRAY_SIZE
;owerIndex++)

3599 i(
pAd
->
Tx20MPwrCfgABd
[
powIndex
] == 0xffffffff)

3603 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_PWR_CFG_0
 + 
powIndex
*4,Ad->
Tx20MPwrCfgABd
[powerIndex]);

3605 
	`RTMPucDay
(5000);

3610 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
vue
);

3611 
vue
 &= (~0x18);

3612 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
vue
);

3616 
vue
 = 0x3C;

3617 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
vue
);

3621 
vue
 = 0x0B;

3622 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R68
, 
vue
);

3624 
vue
 = 0x16;

3625 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 
vue
);

3627 
vue
 = 0x08;

3628 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 
vue
);

3630 
vue
 = 0x11;

3631 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 
vue
);

3633 i(
pAd
->
e
.
Chl
 == 14)

3635 
INT
 
TxMode
 = 
pAd
->
e
.
TxWI
.
PHYMODE
;

3637 i(
TxMode
 =
MODE_CCK
)

3640 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
vue
);

3641 
vue
 |= 0x20;

3642 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
vue
);

3648 
pAd
->
LchRfRegs
.
R4
 &= ~0x00200000;

3649 
	`RtmpRfIoWre
(
pAd
);

3653 i(
pAd
->
e
.
TxWI
.
BW
 =
BW_40
)

3655 i(
pAd
->
e
.
Chl
 <= 14)

3657 
powIndex
=0;owIndex<
MAX_TXPOWER_ARRAY_SIZE
;owerIndex++)

3659 i(
pAd
->
Tx40MPwrCfgGBd
[
powIndex
] == 0xffffffff)

3663 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_PWR_CFG_0
 + 
powIndex
*4,Ad->
Tx40MPwrCfgGBd
[powerIndex]);

3665 
	`RTMPucDay
(5000);

3670 
powIndex
=0;owIndex<
MAX_TXPOWER_ARRAY_SIZE
;owerIndex++)

3672 i(
pAd
->
Tx40MPwrCfgABd
[
powIndex
] == 0xffffffff)

3676 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_PWR_CFG_0
 + 
powIndex
*4,Ad->
Tx40MPwrCfgABd
[powerIndex]);

3678 
	`RTMPucDay
(5000);

3681 i((
pAd
->
e
.
TxWI
.
PHYMODE
 >2&& (pAd->e.TxWI.
MCS
 == 7))

3683 
vue
 = 0x28;

3684 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R67
, 
vue
);

3689 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
vue
);

3690 
vue
 &= (~0x18);

3691 
vue
 |= 0x10;

3692 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
vue
);

3696 
vue
 = 0x3C;

3697 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
vue
);

3701 
vue
 = 0x0C;

3702 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R68
, 
vue
);

3704 
vue
 = 0x1A;

3705 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 
vue
);

3707 
vue
 = 0x0A;

3708 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 
vue
);

3710 
vue
 = 0x16;

3711 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 
vue
);

3716 
pAd
->
LchRfRegs
.
R4
 |= 0x00200000;

3717 
	`RtmpRfIoWre
(
pAd
);

3721 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_TX_BW_Pro(BBPCutBW = %d)\n", 
pAd
->
e
.
TxWI
.
BW
));

3722 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_TX_BW_Proc Success\n"));

3725  
TRUE
;

3726 
	}
}

3738 
INT
 
	$S_ATE_TX_LENGTH_Proc
(

3739 
IN
 
PRTMP_ADAPTER
 
pAd
,

3740 
IN
 
PSTRING
 
g
)

3742 
pAd
->
e
.
TxLgth
 = 
	`sime_
(
g
, 0, 10);

3744 i((
pAd
->
e
.
TxLgth
 < 24|| (pAd->e.TxLgth > (
MAX_FRAME_SIZE
 - 34 )))

3746 
pAd
->
e
.
TxLgth
 = (
MAX_FRAME_SIZE
 - 34 );

3747 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("S_ATE_TX_LENGTH_Proc::Ouonge, ishould bgo24~%d.\n", (
MAX_FRAME_SIZE
 - 34 )));

3748  
FALSE
;

3751 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_TX_LENGTH_Pro(TxLgth = %d)\n", 
pAd
->
e
.
TxLgth
));

3752 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_TX_LENGTH_Proc Success\n"));

3755  
TRUE
;

3756 
	}
}

3768 
INT
 
	$S_ATE_TX_COUNT_Proc
(

3769 
IN
 
PRTMP_ADAPTER
 
pAd
,

3770 
IN
 
PSTRING
 
g
)

3772 
pAd
->
e
.
TxCou
 = 
	`sime_
(
g
, 0, 10);

3774 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_TX_COUNT_Pro(TxCou = %d)\n", 
pAd
->
e
.
TxCou
));

3775 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_TX_COUNT_Proc Success\n"));

3778  
TRUE
;

3779 
	}
}

3791 
INT
 
	$S_ATE_TX_MCS_Proc
(

3792 
IN
 
PRTMP_ADAPTER
 
pAd
,

3793 
IN
 
PSTRING
 
g
)

3795 
UCHAR
 
MCS
;

3796 
INT
 
su
;

3798 
MCS
 = 
	`sime_
(
g
, 0, 10);

3799 
su
 = 
	`CheckMCSVid
(
pAd
,Ad->
e
.
TxWI
.
PHYMODE
, 
MCS
);

3801 i(
su
 != -1)

3803 
pAd
->
e
.
TxWI
.
MCS
 = (
UCHAR
)MCS;

3807 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Set_ATE_TX_MCS_Proc::Out ofange,eferoateable.\n"));

3808  
FALSE
;

3811 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_TX_MCS_Pro(MCS = %d)\n", 
pAd
->
e
.
TxWI
.
MCS
));

3812 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_TX_MCS_Proc Success\n"));

3815  
TRUE
;

3816 
	}
}

3832 
INT
 
	$S_ATE_TX_MODE_Proc
(

3833 
IN
 
PRTMP_ADAPTER
 
pAd
,

3834 
IN
 
PSTRING
 
g
)

3836 
UCHAR
 
BbpDa
 = 0;

3838 
pAd
->
e
.
TxWI
.
PHYMODE
 = 
	`sime_
(
g
, 0, 10);

3840 i(
pAd
->
e
.
TxWI
.
PHYMODE
 > 3)

3842 
pAd
->
e
.
TxWI
.
PHYMODE
 = 0;

3843 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Set_ATE_TX_MODE_Proc::Out ofange.\nIt should be inange of 0~3\n"));

3844 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("0: CCK, 1: OFDM, 2: HT_MIX, 3: HT_GREEN_FIELD.\n"));

3845  
FALSE
;

3849 i(
pAd
->
e
.
TxWI
.
PHYMODE
 =
MODE_CCK
)

3851 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BbpDa
);

3852 
BbpDa
 &= (~0x18);

3853 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BbpDa
);

3854 
pAd
->
e
.
TxWI
.
BW
 = 
BW_20
;

3855 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Set_ATE_TX_MODE_Proc::CCK Only support 20MHZ. Switcho 20MHZ.\n"));

3859 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_TX_MODE_Pro(TxMod%d)\n", 
pAd
->
e
.
TxWI
.
PHYMODE
));

3860 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_TX_MODE_Proc Success\n"));

3863  
TRUE
;

3864 
	}
}

3876 
INT
 
	$S_ATE_TX_GI_Proc
(

3877 
IN
 
PRTMP_ADAPTER
 
pAd
,

3878 
IN
 
PSTRING
 
g
)

3880 
pAd
->
e
.
TxWI
.
ShtGI
 = 
	`sime_
(
g
, 0, 10);

3882 i(
pAd
->
e
.
TxWI
.
ShtGI
 > 1)

3884 
pAd
->
e
.
TxWI
.
ShtGI
 = 0;

3885 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Set_ATE_TX_GI_Proc::Out ofange\n"));

3886  
FALSE
;

3889 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_TX_GI_Pro(GI = %d)\n", 
pAd
->
e
.
TxWI
.
ShtGI
));

3890 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_TX_GI_Proc Success\n"));

3893  
TRUE
;

3894 
	}
}

3897 
INT
 
	$S_ATE_RX_FER_Proc
(

3898 
IN
 
PRTMP_ADAPTER
 
pAd
,

3899 
IN
 
PSTRING
 
g
)

3901 
pAd
->
e
.
bRxFER
 = 
	`sime_
(
g
, 0, 10);

3903 i(
pAd
->
e
.
bRxFER
 == 1)

3905 
pAd
->
e
.
RxCPSec
 = 0;

3906 
pAd
->
e
.
RxTٮC
 = 0;

3909 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_RX_FER_Pro(bRxFER = %d)\n", 
pAd
->
e
.
bRxFER
));

3910 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_RX_FER_Proc Success\n"));

3913  
TRUE
;

3914 
	}
}

3917 
INT
 
	$S_ATE_Rd_RF_Proc
(

3918 
IN
 
PRTMP_ADAPTER
 
pAd
,

3919 
IN
 
PSTRING
 
g
)

3922 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("R1 = %x\n", 
pAd
->
LchRfRegs
.
R1
));

3923 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("R2 = %x\n", 
pAd
->
LchRfRegs
.
R2
));

3924 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("R3 = %x\n", 
pAd
->
LchRfRegs
.
R3
));

3925 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("R4 = %x\n", 
pAd
->
LchRfRegs
.
R4
));

3927  
TRUE
;

3928 
	}
}

3931 
INT
 
	$S_ATE_Wre_RF1_Proc
(

3932 
IN
 
PRTMP_ADAPTER
 
pAd
,

3933 
IN
 
PSTRING
 
g
)

3935 
UINT32
 
vue
 = (UINT32
	`sime_
(
g
, 0, 16);

3937 
pAd
->
LchRfRegs
.
R1
 = 
vue
;

3938 
	`RtmpRfIoWre
(
pAd
);

3940  
TRUE
;

3941 
	}
}

3944 
INT
 
	$S_ATE_Wre_RF2_Proc
(

3945 
IN
 
PRTMP_ADAPTER
 
pAd
,

3946 
IN
 
PSTRING
 
g
)

3948 
UINT32
 
vue
 = (UINT32
	`sime_
(
g
, 0, 16);

3950 
pAd
->
LchRfRegs
.
R2
 = 
vue
;

3951 
	`RtmpRfIoWre
(
pAd
);

3953  
TRUE
;

3954 
	}
}

3957 
INT
 
	$S_ATE_Wre_RF3_Proc
(

3958 
IN
 
PRTMP_ADAPTER
 
pAd
,

3959 
IN
 
PSTRING
 
g
)

3961 
UINT32
 
vue
 = (UINT32
	`sime_
(
g
, 0, 16);

3963 
pAd
->
LchRfRegs
.
R3
 = 
vue
;

3964 
	`RtmpRfIoWre
(
pAd
);

3966  
TRUE
;

3967 
	}
}

3970 
INT
 
	$S_ATE_Wre_RF4_Proc
(

3971 
IN
 
PRTMP_ADAPTER
 
pAd
,

3972 
IN
 
PSTRING
 
g
)

3974 
UINT32
 
vue
 = (UINT32
	`sime_
(
g
, 0, 16);

3976 
pAd
->
LchRfRegs
.
R4
 = 
vue
;

3977 
	`RtmpRfIoWre
(
pAd
);

3979  
TRUE
;

3980 
	}
}

3992 
INT
 
	$S_ATE_Ld_E2P_Proc
(

3993 
IN
 
PRTMP_ADAPTER
 
pAd
,

3994 
IN
 
PSTRING
 
g
)

3996 
BOOLEAN
 
t
 = 
FALSE
;

3997 
PSTRING
 
c
 = 
EEPROM_BIN_FILE_NAME
;

3998 
RTMP_OS_FD
 
cf
;

3999 
INT32
 
tv
;

4000 
USHORT
 
WreEEPROM
[(
EEPROM_SIZE
/2)];

4001 
INT
 
FeLgth
 = 0;

4002 
UINT32
 
vue
 = (UINT32
	`sime_
(
g
, 0, 10);

4003 
RTMP_OS_FS_INFO
 
osFSInfo
;

4005 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("===> %(vue=%d)\n\n", 
__FUNCTION__
, 
vue
));

4007 i(
vue
 > 0)

4010 
	`NdisZoMemy
((
PUCHAR
)
WreEEPROM
, 
EEPROM_SIZE
);

4012 
	`RtmpOSFSInfoChge
(&
osFSInfo
, 
TRUE
);

4017 
cf
 = 
	`RtmpOSFeOn
(
c
, 
O_RDONLY
, 0);

4019 i(
	`IS_FILE_OPEN_ERR
(
cf
))

4021 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%- E ong f%s\n", 
__FUNCTION__
, 
c
));

4026 
FeLgth
 = 
	`RtmpOSFeRd
(
cf
, (
PSTRING
)
WreEEPROM
, 
EEPROM_SIZE
);

4028 i(
FeLgth
 !
EEPROM_SIZE
)

4030 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:rror fileength (=%d) in2p.bin\n",

4031 
__FUNCTION__
, 
FeLgth
));

4037 #i
	`defed
(
RTMP_MAC_PCI
&& defed(
RTMP_PCI_SUPPORT
)

4039 
USHORT
 
dex
=0;

4040 
USHORT
 
vue
=0;

4042 
INT32
 
e2p_size
=512;

4043 
USHORT
 
mpDa
=0;

4044 
dex
 = 0 ; index < (
e2p_size
 / 2); )

4047 
mpDa
 = 
	`2u16
(
WreEEPROM
[
dex
]);

4048 
vue
 = 
mpDa
;

4049 
	`RT28xx_EEPROM_WRITE16
(
pAd
, 
dex
*2, 
vue
);

4050 
dex
 ++;

4054 
	`__wre_l
(
pAd
, 
WreEEPROM
);

4056 
t
 = 
TRUE
;

4059 } 
TRUE
);

4062 i(
	`IS_FILE_OPEN_ERR
(
cf
))

4068 
tv
 = 
	`RtmpOSFeClo
(
cf
);

4070 i(
tv
)

4072 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("--> E %d closg %s\n", -
tv
, 
c
));

4078 
	`RtmpOSFSInfoChge
(&
osFSInfo
, 
FALSE
);

4081 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("<==%ԑ=%d)\n", 
__FUNCTION__
, 
t
));

4083  
t
;

4085 
	}
}

4090 
INT
 
	$S_ATE_Rd_E2P_Proc
(

4091 
IN
 
PRTMP_ADAPTER
 
pAd
,

4092 
IN
 
PSTRING
 
g
)

4094 
USHORT
 
bufr
[
EEPROM_SIZE
/2];

4095 
USHORT
 *
p
;

4096 
i
;

4098 
	`__ad_l
(
pAd
, (
USHORT
 *)
bufr
);

4099 
p
 = 
bufr
;

4100 
i
 = 0; i < (
EEPROM_SIZE
/2); i++)

4102 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%4.4x ", *
p
));

4103 i(((
i
+1) % 16) == 0)

4104 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n"));

4105 
p
++;

4107  
TRUE
;

4108 
	}
}

4126 
INT
 
	$S_ATE_AUTO_ALC_Proc
(

4127 
IN
 
PRTMP_ADAPTER
 
pAd
,

4128 
IN
 
PSTRING
 
g
)

4130 
UINT32
 
vue
 = 
	`sime_
(
g
, 0, 10);

4132 i(
vue
 > 0)

4134 
pAd
->
e
.
bAutoTxAlc
 = 
TRUE
;

4135 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATEAUTOALC = TRUE ,utolcnabled!\n"));

4139 
pAd
->
e
.
bAutoTxAlc
 = 
FALSE
;

4140 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATEAUTOALC = FALSE ,utolc disabled!\n"));

4144  
TRUE
;

4145 
	}
}

4157 
INT
 
	$S_ATE_IPG_Proc
(

4158 
IN
 
PRTMP_ADAPTER
 
pAd
,

4159 
IN
 
PSTRING
 
g
)

4161 
UINT32
 
da
, 
vue
;

4163 
pAd
->
e
.
IPG
 = 
	`sime_
(
g
, 0, 10);

4164 
vue
 = 
pAd
->
e
.
IPG
;

4166 
	`RTMP_IO_READ32
(
pAd
, 
XIFS_TIME_CFG
, &
da
);

4168 i(
vue
 <= 0)

4170 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set_ATE_IPG_Proc::IPG is disabled(IPG == 0).\n"));

4171  
TRUE
;

4174 
	`ASSERT
(
vue
 > 0);

4176 i((
vue
 > 0) && (value < 256))

4178 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC0_CFG
, &
da
);

4179 
da
 &= 0x0;

4180 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC0_CFG
, 
da
);

4182 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC1_CFG
, &
da
);

4183 
da
 &= 0x0;

4184 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC1_CFG
, 
da
);

4186 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC2_CFG
, &
da
);

4187 
da
 &= 0x0;

4188 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC2_CFG
, 
da
);

4190 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC3_CFG
, &
da
);

4191 
da
 &= 0x0;

4192 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC3_CFG
, 
da
);

4196 
UINT32
 
aif
, 
time
;

4198 
	`RTMP_IO_READ32
(
pAd
, 
BKOFF_SLOT_CFG
, &
time
);

4199 
time
 &= 0x000000FF;

4201 
aif
 = 
vue
 / 
time
;

4202 
vue
 = vu% 
time
;

4204 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC0_CFG
, &
da
);

4205 
da
 &= 0x0;

4206 
da
 |(
aif
 << 8);

4207 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC0_CFG
, 
da
);

4209 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC1_CFG
, &
da
);

4210 
da
 &= 0x0;

4211 
da
 |(
aif
 << 8);

4212 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC1_CFG
, 
da
);

4214 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC2_CFG
, &
da
);

4215 
da
 &= 0x0;

4216 
da
 |(
aif
 << 8);

4217 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC2_CFG
, 
da
);

4219 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC3_CFG
, &
da
);

4220 
da
 &= 0x0;

4221 
da
 |(
aif
 << 8);

4222 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC3_CFG
, 
da
);

4225 
da
 = (
vue
 & 0xFFFF0000) | value | (value << 8);

4226 
	`RTMP_IO_WRITE32
(
pAd
, 
XIFS_TIME_CFG
, 
da
);

4228 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_IPG_Pro(IPG = %u)\n", 
pAd
->
e
.
IPG
));

4231 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_IPG_Proc Success\n"));

4233  
TRUE
;

4234 
	}
}

4246 
INT
 
	$S_ATE_Payld_Proc
(

4247 
IN
 
PRTMP_ADAPTER
 
pAd
,

4248 
IN
 
PSTRING
 
g
)

4250 
PSTRING
 
vue
;

4252 
vue
 = 
g
;

4255 i(
	`
(
vue
) != 2)

4256  
FALSE
;

4258 
	`AtoH
(
vue
, &(
pAd
->
e
.
Payld
), 1);

4260 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_ATE_Payld_Proԕd = 0x%2x)\n", 
pAd
->
e
.
Payld
));

4263 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink: Set_ATE_Payload_Proc Success\n"));

4265  
TRUE
;

4266 
	}
}

4269 
INT
 
	$S_ATE_Show_Proc
(

4270 
IN
 
PRTMP_ADAPTER
 
pAd
,

4271 
IN
 
PSTRING
 
g
)

4273 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Mode=%u\n", 
pAd
->
e
.
Mode
));

4274 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("TxPow0=%d\n", 
pAd
->
e
.
TxPow0
));

4275 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("TxPow1=%d\n", 
pAd
->
e
.
TxPow1
));

4276 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("TxAS=%d\n", 
pAd
->
e
.
TxAS
));

4277 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("RxAS=%d\n", 
pAd
->
e
.
RxAS
));

4278 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("BBPCutBW=%u\n", 
pAd
->
e
.
TxWI
.
BW
));

4279 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("GI=%u\n", 
pAd
->
e
.
TxWI
.
ShtGI
));

4280 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("MCS=%u\n", 
pAd
->
e
.
TxWI
.
MCS
));

4281 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("TxMode=%u\n", 
pAd
->
e
.
TxWI
.
PHYMODE
));

4282 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Addr1=%02x:%02x:%02x:%02x:%02x:%02x\n",

4283 
pAd
->
e
.
Addr1
[0],Ad->ate.Addr1[1],Ad->ate.Addr1[2],Ad->ate.Addr1[3],Ad->ate.Addr1[4],Ad->ate.Addr1[5]));

4284 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Addr2=%02x:%02x:%02x:%02x:%02x:%02x\n",

4285 
pAd
->
e
.
Addr2
[0],Ad->ate.Addr2[1],Ad->ate.Addr2[2],Ad->ate.Addr2[3],Ad->ate.Addr2[4],Ad->ate.Addr2[5]));

4286 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Addr3=%02x:%02x:%02x:%02x:%02x:%02x\n",

4287 
pAd
->
e
.
Addr3
[0],Ad->ate.Addr3[1],Ad->ate.Addr3[2],Ad->ate.Addr3[3],Ad->ate.Addr3[4],Ad->ate.Addr3[5]));

4288 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Chl=%u\n", 
pAd
->
e
.
Chl
));

4289 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("TxLgth=%u\n", 
pAd
->
e
.
TxLgth
));

4290 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("TxCou=%u\n", 
pAd
->
e
.
TxCou
));

4291 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("RFFqOfft=%u\n", 
pAd
->
e
.
RFFqOfft
));

4292 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("IPG=%u\n", 
pAd
->
e
.
IPG
));

4293 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Payld=0x%02x\n", 
pAd
->
e
.
Payld
));

4295 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("Set_ATE_Show_Proc Success\n"));

4296  
TRUE
;

4297 
	}
}

4300 
INT
 
	$S_ATE_Hp_Proc
(

4301 
IN
 
PRTMP_ADAPTER
 
pAd
,

4302 
IN
 
PSTRING
 
g
)

4304 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATE=ATESTART, ATESTOP, TXCONT, TXCARR, TXFRAME, RXFRAME\n"));

4305 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATEDA\n"));

4306 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATESA\n"));

4307 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATEBSSID\n"));

4308 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATECHANNEL,ange:0~14(unless A band !)\n"));

4309 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATETXPOW0, setowerevel ofntenna 1.\n"));

4310 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATETXPOW1, setowerevel ofntenna 2.\n"));

4311 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATETXANT, set TXntenna. 0:all, 1:antenna one, 2:antennawo.\n"));

4312 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATERXANT, set RXntenna.0:all, 1:antenna one, 2:antennawo, 3:antennahree.\n"));

4313 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATETXFREQOFFSET, set frequency offset,ange 0~63\n"));

4314 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATETXBW, set BandWidth, 0:20MHz, 1:40MHz.\n"));

4315 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATETXLEN, s Fmngth,g24~%d\n", (
MAX_FRAME_SIZE
 - 34 )));

4316 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATETXCNT, set how many frame goingoransmit.\n"));

4317 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATETXMCS, set MCS,eferenceoateable.\n"));

4318 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATETXMODE, set Mode 0:CCK, 1:OFDM, 2:HT-Mix, 3:GreenField,eferenceoateable.\n"));

4319 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATETXGI, set GI interval, 0:Long, 1:Short\n"));

4320 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATERXFER, 0:disable Rx Framerrorate. 1:enable Rx Framerrorate.\n"));

4321 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATERRF, showll RFegisters.\n"));

4322 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATEWRF1, set RF1egister.\n"));

4323 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATEWRF2, set RF2egister.\n"));

4324 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATEWRF3, set RF3egister.\n"));

4325 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATEWRF4, set RF4egister.\n"));

4326 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATELDE2P,oad EEPROM from .bin file.\n"));

4327 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATERE2P, displayll EEPROM content.\n"));

4328 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATEIPG, set ATE Tx frame IPG.\n"));

4329 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATEPAYLOAD, set ATEayloadattern for TxFrame.\n"));

4330 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATESHOW, displayllarameters of ATE.\n"));

4331 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("ATEHELP, online help.\n"));

4333  
TRUE
;

4334 
	}
}

4348 
VOID
 
	$ATEAsicSwchChl
(

4349 
IN
 
PRTMP_ADAPTER
 
pAd
)

4351 
UINT32
 
R2
 = 0, 
R3
 = 
DEFAULT_RF_TX_POWER
, 
R4
 = 0, 
Vue
 = 0;

4352 
RTMP_RF_REGS
 *
RFRegTab
 = 
NULL
;

4353 
UCHAR
 
dex
 = 0, 
BbpVue
 = 0, 
R66
 = 0x30, 
Chl
 = 0;

4354 
CHAR
 
TxPw
 = 0, 
TxPw2
 = 0;

4357 #ifde
RALINK_QA


4359 i((
pAd
->
e
.
bQATxS
 =
TRUE
|| (pAd->e.
bQARxS
 == TRUE))

4361 i(
pAd
->
e
.
Chl
 !pAd->
LchRfRegs
.Channel)

4363 
pAd
->
e
.
Chl
 =Ad->
LchRfRegs
.Channel;

4369 
Chl
 = 
pAd
->
e
.Channel;

4373 
TxPw
 = 
pAd
->
e
.
TxPow0
;

4374 
TxPw2
 = 
pAd
->
e
.
TxPow1
;

4377 #i
	`defed
(
RT28xx
|| defed(
RT2880
|| defed(
RT2883
)

4379 
RFRegTab
 = 
RF2850RegTab
;

4381 
pAd
->
RfIcTy
)

4383 #i
	`defed
(
RT28xx
|| defed(
RT2880
)

4385 
RFIC_2820
:

4386 
RFIC_2850
:

4387 
RFIC_2720
:

4388 
RFIC_2750
:

4390 
dex
 = 0; index < 
NUM_OF_2850_CHNL
; index++)

4392 i(
Chl
 =
RFRegTab
[
dex
].Channel)

4394 
R2
 = 
RFRegTab
[
dex
].R2;

4397 i(
pAd
->
A
.
fld
.
TxPh
 == 1)

4399 
R2
 |= 0x4000;

4401 i(
pAd
->
A
.
fld
.
TxPh
 == 2)

4403 i(
pAd
->
e
.
TxAS
 == 1)

4406 
R2
 |= 0x4000;

4407 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R1
, &
BbpVue
);

4408 
BbpVue
 &= 0xE7;

4409 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
BbpVue
);

4411 i(
pAd
->
e
.
TxAS
 == 2)

4414 
R2
 |= 0x8000;

4415 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R1
, &
BbpVue
);

4416 
BbpVue
 &= 0xE7;

4417 
BbpVue
 |= 0x08;

4418 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
BbpVue
);

4422 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R1
, &
BbpVue
);

4423 
BbpVue
 &= 0xE7;

4424 
BbpVue
 |= 0x10;

4425 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
BbpVue
);

4429 i(
pAd
->
A
.
fld
.
RxPh
 == 2)

4431 
pAd
->
e
.
RxAS
)

4434 
R2
 |= 0x20040;

4435 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BbpVue
);

4436 
BbpVue
 &= 0xE4;

4437 
BbpVue
 |= 0x00;

4438 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BbpVue
);

4441 
R2
 |= 0x10040;

4442 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BbpVue
);

4443 
BbpVue
 &= 0xE4;

4444 
BbpVue
 |= 0x01;

4445 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BbpVue
);

4448 
R2
 |= 0x40;

4449 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BbpVue
);

4450 
BbpVue
 &= 0xE4;

4452 
BbpVue
 |= 0x08;

4453 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BbpVue
);

4457 i(
pAd
->
A
.
fld
.
RxPh
 == 1)

4460 
R2
 |= 0x20040;

4463 i(
pAd
->
A
.
fld
.
RxPh
 == 3)

4465 
pAd
->
e
.
RxAS
)

4468 
R2
 |= 0x20040;

4469 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BbpVue
);

4470 
BbpVue
 &= 0xE4;

4471 
BbpVue
 |= 0x00;

4472 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BbpVue
);

4475 
R2
 |= 0x10040;

4476 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BbpVue
);

4477 
BbpVue
 &= 0xE4;

4478 
BbpVue
 |= 0x01;

4479 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BbpVue
);

4482 
R2
 |= 0x30000;

4483 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BbpVue
);

4484 
BbpVue
 &= 0xE4;

4485 
BbpVue
 |= 0x02;

4486 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BbpVue
);

4489 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BbpVue
);

4490 
BbpVue
 &= 0xE4;

4491 
BbpVue
 |= 0x10;

4492 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BbpVue
);

4497 i(
Chl
 > 14)

4500 
R3
 = (
RFRegTab
[
dex
].R3 & 0xffffc1ff);

4501 
R4
 = (
RFRegTab
[
dex
].R4 & (~0x001f87c0)| (
pAd
->
e
.
RFFqOfft
 << 15);

4510 i((
TxPw
 >= -7) && (TxPwer < 0))

4512 
TxPw
 = (7+TxPwer);

4513 
TxPw
 = (TxPwer > 0xF) ? (0xF) : (TxPwer);

4514 
R3
 |(
TxPw
 << 10);

4515 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATEAsicSwchChl: TxPw=%d \n", 
TxPw
));

4519 
TxPw
 = (TxPwer > 0xF) ? (0xF) : (TxPwer);

4520 
R3
 |(
TxPw
 << 10) | (1 << 9);

4524 i((
TxPw2
 >= -7) && (TxPwer2 < 0))

4526 
TxPw2
 = (7+TxPwer2);

4527 
TxPw2
 = (TxPwer2 > 0xF) ? (0xF) : (TxPwer2);

4528 
R4
 |(
TxPw2
 << 7);

4529 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ATEAsicSwchChl: TxPw2=%d \n", 
TxPw2
));

4533 
TxPw2
 = (TxPwer2 > 0xF) ? (0xF) : (TxPwer2);

4534 
R4
 |(
TxPw2
 << 7) | (1 << 6);

4540 
R3
 = (
RFRegTab
[
dex
].R3 & 0xffffc1ff| (
TxPw
 << 9);

4542 
R4
 = (
RFRegTab
[
dex
].R4 & (~0x001f87c0)| (
pAd
->
e
.
RFFqOfft
 << 15| (
TxPw2
 <<6);

4547 i(
pAd
->
e
.
TxWI
.
BW
 =
BW_40
)

4549 
R4
 |=0x200000;

4553 
pAd
->
LchRfRegs
.
Chl
 = Channel;

4554 
pAd
->
LchRfRegs
.
R1
 = 
RFRegTab
[
dex
].R1;

4555 
pAd
->
LchRfRegs
.
R2
 = R2;

4556 
pAd
->
LchRfRegs
.
R3
 = R3;

4557 
pAd
->
LchRfRegs
.
R4
 = R4;

4559 
	`RtmpRfIoWre
(
pAd
);

4573 i(
Chl
 <= 14)

4575 
UINT32
 
TxPCfg
 = 0x00050F0A;

4576 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R62
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

4577 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R63
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

4578 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R64
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

4579 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R86
, 0);

4583 i(
pAd
->
NicCfig2
.
fld
.
ExLNAFG
)

4585 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R82
, 0x62);

4586 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R75
, 0x46);

4590 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R82
, 0x84);

4591 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R75
, 0x50);

4595 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Vue
);

4596 
Vue
 &= (~0x6);

4597 
Vue
 |= (0x04);

4598 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

4601 i(
pAd
->
A
.
fld
.
TxPh
 == 1)

4603 
TxPCfg
 &= 0xFFFFFFF3;

4605 i(
pAd
->
A
.
fld
.
RxPh
 == 1)

4607 
TxPCfg
 &= 0xFFFFF3FF;

4611 i(
pAd
->
A
.
fld
.
TxPh
 == 2)

4613 i(
pAd
->
e
.
TxAS
 == 1)

4615 
TxPCfg
 &= 0xFFFFFFF7;

4617 i(
pAd
->
e
.
TxAS
 == 2)

4619 
TxPCfg
 &= 0xFFFFFFFD;

4623 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_PIN_CFG
, 
TxPCfg
);

4628 
UINT32
 
TxPCfg
 = 0x00050F05;

4630 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R62
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

4631 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R63
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

4632 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R64
, (0x37 - 
	`GET_LNA_GAIN
(pAd)));

4635 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R86
, 0);

4636 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R82
, 0xF2);

4640 i(
pAd
->
NicCfig2
.
fld
.
ExLNAFA
)

4642 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R75
, 0x46);

4646 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R75
, 0x50);

4649 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R91
, &
BbpVue
);

4650 
	`ASSERT
((
BbpVue
 == 0x04));

4653 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Vue
);

4654 
Vue
 &= (~0x6);

4655 
Vue
 |= (0x02);

4656 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

4659 i(
pAd
->
A
.
fld
.
TxPh
 == 1)

4661 
TxPCfg
 &= 0xFFFFFFF3;

4663 i(
pAd
->
A
.
fld
.
RxPh
 == 1)

4665 
TxPCfg
 &= 0xFFFFF3FF;

4668 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_PIN_CFG
, 
TxPCfg
);

4673 i(
Chl
 <= 14)

4676 
R66
 = 0x2E + 
	`GET_LNA_GAIN
(
pAd
);

4677 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

4682 i(
pAd
->
e
.
TxWI
.
BW
 =
BW_20
)

4684 
R66
 = (
UCHAR
)(0x32 + (
	`GET_LNA_GAIN
(
pAd
)*5)/3);

4686 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

4690 
R66
 = (
UCHAR
)(0x3A + (
	`GET_LNA_GAIN
(
pAd
)*5)/3);

4691 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
R66
);

4701 
	`RTMPucDay
(1000);

4703 i(
Chl
 > 14)

4706 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SwitchChannel#%d(RF=%d, %dT)o , R1=0x%08x, R2=0x%08x, R3=0x%08x, R4=0x%08x\n",

4707 
Chl
,

4708 
pAd
->
RfIcTy
,

4709 
pAd
->
A
.
fld
.
TxPh
,

4710 
pAd
->
LchRfRegs
.
R1
,

4711 
pAd
->
LchRfRegs
.
R2
,

4712 
pAd
->
LchRfRegs
.
R3
,

4713 
pAd
->
LchRfRegs
.
R4
));

4717 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SwitchChannel#%d(RF=%d, Pwr0=%u, Pwr1=%u, %dT)o , R1=0x%08x, R2=0x%08x, R3=0x%08x, R4=0x%08x\n",

4718 
Chl
,

4719 
pAd
->
RfIcTy
,

4720 (
R3
 & 0x00003e00) >> 9,

4721 (
R4
 & 0x000007c0) >> 6,

4722 
pAd
->
A
.
fld
.
TxPh
,

4723 
pAd
->
LchRfRegs
.
R1
,

4724 
pAd
->
LchRfRegs
.
R2
,

4725 
pAd
->
LchRfRegs
.
R3
,

4726 
pAd
->
LchRfRegs
.
R4
));

4728 
	}
}

4748 
VOID
 
	$ATEAsicAdjuTxPow
(

4749 
IN
 
PRTMP_ADAPTER
 
pAd
)

4751 
INT
 
i
, 
j
, 
maxTxPwrC
;

4752 
CHAR
 
DPwr
 = 0;

4753 
BOOLEAN
 
bAutoTxAgc
 = 
FALSE
;

4754 
UCHAR
 
TssiRef
, *
pTssiMusBoundy
, *
pTssiPlusBoundy
, 
TxAgcSp
;

4755 
UCHAR
 
BbpR49
 = 0, 
idx
;

4756 
PCHAR
 
pTxAgcComn
;

4757 
ULONG
 
TxPwr
[7];

4758 
CHAR
 
Vue
;

4760 
maxTxPwrC
 = 5;

4763 i(
pAd
->
e
.
TxWI
.
BW
 =
BW_40
)

4765 i(
pAd
->
e
.
Chl
 > 14)

4767 
i
 =0 ; i < 
maxTxPwrC
; i ++)

4769 
TxPwr
[
i
] = 
pAd
->
Tx40MPwrCfgABd
[i];

4774 
i
 =0 ; i < 
maxTxPwrC
; i ++)

4776 
TxPwr
[
i
] = 
pAd
->
Tx40MPwrCfgGBd
[i];

4782 i(
pAd
->
e
.
Chl
 > 14)

4784 
i
 =0 ; i < 
maxTxPwrC
; i ++)

4786 
TxPwr
[
i
] = 
pAd
->
Tx20MPwrCfgABd
[i];

4791 
i
 =0 ; i < 
maxTxPwrC
; i ++)

4793 
TxPwr
[
i
] = 
pAd
->
Tx20MPwrCfgGBd
[i];

4800 i(
pAd
->
Mlme
.
OSecPiodicRound
 % 4 == 0)

4802 i(
pAd
->
e
.
Chl
 <= 14)

4805 
bAutoTxAgc
 = 
pAd
->
bAutoTxAgcG
;

4806 
TssiRef
 = 
pAd
->
TssiRefG
;

4807 
pTssiMusBoundy
 = &
pAd
->
TssiMusBoundyG
[0];

4808 
pTssiPlusBoundy
 = &
pAd
->
TssiPlusBoundyG
[0];

4809 
TxAgcSp
 = 
pAd
->
TxAgcSpG
;

4810 
pTxAgcComn
 = &
pAd
->
TxAgcComnG
;

4815 
bAutoTxAgc
 = 
pAd
->
bAutoTxAgcA
;

4816 
TssiRef
 = 
pAd
->
TssiRefA
;

4817 
pTssiMusBoundy
 = &
pAd
->
TssiMusBoundyA
[0];

4818 
pTssiPlusBoundy
 = &
pAd
->
TssiPlusBoundyA
[0];

4819 
TxAgcSp
 = 
pAd
->
TxAgcSpA
;

4820 
pTxAgcComn
 = &
pAd
->
TxAgcComnA
;

4823 i(
bAutoTxAgc
)

4826 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R49
, &
BbpR49
);

4841 i(
BbpR49
 > 
pTssiMusBoundy
[1])

4845 
idx
 = 1; idx < 5; idx++)

4848 i(
BbpR49
 <
pTssiMusBoundy
[
idx
])

4854 *
pTxAgcComn
 = -(
TxAgcSp
 * (
idx
-1));

4858 
DPwr
 +(*
pTxAgcComn
);

4859 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("-- Tx Power, BBP R1=%x, TssiRef=%x, TxAgcStep=%x, step = -%d\n",

4860 
BbpR49
, 
TssiRef
, 
TxAgcSp
, 
idx
-1));

4862 i(
BbpR49
 < 
pTssiPlusBoundy
[1])

4866 
idx
 = 1; idx < 5; idx++)

4869 i(
BbpR49
 >
pTssiPlusBoundy
[
idx
])

4874 *
pTxAgcComn
 = 
TxAgcSp
 * (
idx
-1);

4875 
DPwr
 +(*
pTxAgcComn
);

4876 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("++ Tx Power, BBP R1=%x, TssiRef=%x, TxAgcStep=%x, step = +%d\n",

4877 
BbpR49
, 
TssiRef
, 
TxAgcSp
, 
idx
-1));

4881 *
pTxAgcComn
 = 0;

4882 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" Tx Power, BBP R1=%x, TssiRef=%x, TxAgcStep=%x, step = +%d\n",

4883 
BbpR49
, 
TssiRef
, 
TxAgcSp
, 0));

4889 i(
pAd
->
e
.
Chl
 <= 14)

4891 
bAutoTxAgc
 = 
pAd
->
bAutoTxAgcG
;

4892 
pTxAgcComn
 = &
pAd
->
TxAgcComnG
;

4896 
bAutoTxAgc
 = 
pAd
->
bAutoTxAgcA
;

4897 
pTxAgcComn
 = &
pAd
->
TxAgcComnA
;

4900 i(
bAutoTxAgc
)

4901 
DPwr
 +(*
pTxAgcComn
);

4907 i(
pAd
->
CommCfg
.
TxPowPage
 == 0xffffffff)

4909 i(
pAd
->
CommCfg
.
TxPowPage
 > 90)

4911 i(
pAd
->
CommCfg
.
TxPowPage
 > 60)

4913 
DPwr
 -= 1;

4915 i(
pAd
->
CommCfg
.
TxPowPage
 > 30)

4917 
DPwr
 -= 3;

4919 i(
pAd
->
CommCfg
.
TxPowPage
 > 15)

4921 
DPwr
 -= 6;

4923 i(
pAd
->
CommCfg
.
TxPowPage
 > 9)

4925 
DPwr
 -= 9;

4929 
DPwr
 -= 12;

4933 
i
=0; i<
maxTxPwrC
; i++)

4935 i(
TxPwr
[
i
] != 0xffffffff)

4937 
j
=0; j<8; j++)

4939 
Vue
 = (
CHAR
)((
TxPwr
[
i
] >> 
j
*4) & 0x0F);

4941 i((
Vue
 + 
DPwr
) < 0)

4943 
Vue
 = 0;

4945 i((
Vue
 + 
DPwr
) > 0xF)

4947 
Vue
 = 0xF;

4951 
Vue
 +
DPwr
;

4955 
TxPwr
[
i
] = (TxPwr[i] & ~(0x0000000F << 
j
*4)| (
Vue
 << j*4);

4964 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_PWR_CFG_0
 + 
i
*4, 
TxPwr
[i]);

4970 
	}
}

4982 #ifde
RTMP_MAC_PCI


4983 
VOID
 
	$ATEWreTxWI
(

4984 
IN
 
PRTMP_ADAPTER
 
pAd
,

4985 
IN
 
PTXWI_STRUC
 
pOutTxWI
,

4986 
IN
 
BOOLEAN
 
FRAG
,

4987 
IN
 
BOOLEAN
 
CFACK
,

4988 
IN
 
BOOLEAN
 
InsTimeamp
,

4989 
IN
 
BOOLEAN
 
AMPDU
,

4990 
IN
 
BOOLEAN
 
Ack
,

4991 
IN
 
BOOLEAN
 
NSeq
,

4992 
IN
 
UCHAR
 
BASize
,

4993 
IN
 
UCHAR
 
WCID
,

4994 
IN
 
ULONG
 
Lgth
,

4995 
IN
 
UCHAR
 
PID
,

4996 
IN
 
UCHAR
 
TID
,

4997 
IN
 
UCHAR
 
TxRe
,

4998 
IN
 
UCHAR
 
Txmode
,

4999 
IN
 
BOOLEAN
 
CfAck
,

5000 
IN
 
HTTRANSMIT_SETTING
 *
pTnsm
)

5002 
TXWI_STRUC
 
TxWI
;

5003 
PTXWI_STRUC
 
pTxWI
;

5009 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_SHORT_PREAMBLE_INUSED
);

5010 
	`NdisZoMemy
(&
TxWI
, 
TXWI_SIZE
);

5011 
pTxWI
 = &
TxWI
;

5013 
pTxWI
->
FRAG
= FRAG;

5015 
pTxWI
->
CFACK
 = CFACK;

5016 
pTxWI
->
TS

InsTimeamp
;

5017 
pTxWI
->
AMPDU
 = AMPDU;

5018 
pTxWI
->
ACK
 = 
Ack
;

5019 
pTxWI
->
tx

Txmode
;

5021 
pTxWI
->
NSEQ
 = 
NSeq
;

5024 i
BASize
 >7 )

5025 
BASize
 =7;

5027 
pTxWI
->
BAWSize
 = 
BASize
;

5028 
pTxWI
->
WessCliID
 = 
WCID
;

5029 
pTxWI
->
MPDUtٮByCou
 = 
Lgth
;

5030 
pTxWI
->
PackId
 = 
PID
;

5033 
pTxWI
->
BW
 = (
pTnsm
->
fld
.
MODE
 <
MODE_OFDM
? (
BW_20
) : (pTransmit->field.BW);

5034 
pTxWI
->
ShtGI
 = 
pTnsm
->
fld
.ShortGI;

5035 
pTxWI
->
STBC
 = 
pTnsm
->
fld
.STBC;

5037 
pTxWI
->
MCS
 = 
pTnsm
->
fld
.MCS;

5038 
pTxWI
->
PHYMODE
 = 
pTnsm
->
fld
.
MODE
;

5039 
pTxWI
->
CFACK
 = 
CfAck
;

5040 
pTxWI
->
MIMOps
 = 0;

5041 
pTxWI
->
MpduDsy
 = 0;

5043 
pTxWI
->
PackId
 =TxWI->
MCS
;

5044 
	`NdisMoveMemy
(
pOutTxWI
, &
TxWI
, (
TXWI_STRUC
));

5047 
	}
}

5060 
VOID
 
	$ATEDibAsicPre
(

5061 
IN
 
PRTMP_ADAPTER
 
pAd
)

5063 
PROT_CFG_STRUC
 
PrCfg
, 
PrCfg4
;

5064 
UINT32
 
Pre
[6];

5065 
USHORT
 
offt
;

5066 
UCHAR
 
i
;

5067 
UINT32
 
MacReg
 = 0;

5070 
	`RTMP_IO_READ32
(
pAd
, 
TX_RTS_CFG
, &
MacReg
);

5071 
MacReg
 &= 0xFF0000FF;

5072 
MacReg
 |= (0xFFF << 8);

5073 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_RTS_CFG
, 
MacReg
);

5076 
	`RTMPZoMemy
(
Pre
, (Protect));

5077 
PrCfg4
.
wd
 = 0;

5078 
PrCfg
.
wd
 = 0;

5079 
PrCfg
.
fld
.
TxAowGF40
 = 1;

5080 
PrCfg
.
fld
.
TxAowGF20
 = 1;

5081 
PrCfg
.
fld
.
TxAowMM40
 = 1;

5082 
PrCfg
.
fld
.
TxAowMM20
 = 1;

5083 
PrCfg
.
fld
.
TxAowOfdm
 = 1;

5084 
PrCfg
.
fld
.
TxAowCck
 = 1;

5085 
PrCfg
.
fld
.
RTSThEn
 = 1;

5086 
PrCfg
.
fld
.
PreNav
 = 
ASIC_SHORTNAV
;

5089 
PrCfg
.
fld
.
PreRe
 = 
pAd
->
CommCfg
.
RtsRe
;

5090 
PrCfg
.
fld
.
PreCl
 = 0;

5091 
Pre
[0] = 
PrCfg
.
wd
;

5092 
Pre
[1] = 
PrCfg
.
wd
;

5094 
pAd
->
FlgCtsEbd
 = 0;

5108 
Pre
[2] = 0x01744004;

5116 
Pre
[3] = 0x03f44084;

5124 
Pre
[4] = 0x01744004;

5132 
Pre
[5] = 0x03f44084;

5134 
pAd
->
CommCfg
.
IOTePm
.
bRTSLgPrOn
 = 
FALSE
;

5136 
offt
 = 
CCK_PROT_CFG
;

5137 
i
 = 0;i < 6;i++)

5138 
	`RTMP_IO_WRITE32
(
pAd
, 
offt
 + 
i
*4, 
Pre
[i]);

5140 
	}
}

5145 
CHAR
 
	$ATECvtToRssi
(

5146 
IN
 
PRTMP_ADAPTER
 
pAd
,

5147 
IN
 
CHAR
 
Rssi
,

5148 
IN
 
UCHAR
 
RssiNumb
)

5150 
UCHAR
 
RssiOfft
, 
LNAGa
;

5153 i(
Rssi
 == 0)

5156 
LNAGa
 = 
	`GET_LNA_GAIN
(
pAd
);

5157 i(
pAd
->
LchRfRegs
.
Chl
 > 14)

5159 i(
RssiNumb
 == 0)

5160 
RssiOfft
 = 
pAd
->
ARssiOfft0
;

5161 i(
RssiNumb
 == 1)

5162 
RssiOfft
 = 
pAd
->
ARssiOfft1
;

5164 
RssiOfft
 = 
pAd
->
ARssiOfft2
;

5168 i(
RssiNumb
 == 0)

5169 
RssiOfft
 = 
pAd
->
BGRssiOfft0
;

5170 i(
RssiNumb
 == 1)

5171 
RssiOfft
 = 
pAd
->
BGRssiOfft1
;

5173 
RssiOfft
 = 
pAd
->
BGRssiOfft2
;

5176  (-12 - 
RssiOfft
 - 
LNAGa
 - 
Rssi
);

5177 
	}
}

5191 
VOID
 
	$SJFr
(

5192 
IN
 
PRTMP_ADAPTER
 
pAd
)

5194 
UCHAR
 
BbpDa
 = 0;

5200 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BbpDa
);

5202 i((
pAd
->
e
.
TxWI
.
PHYMODE
 =
MODE_CCK
&& (pAd->e.
Chl
 =14&& (pAd->e.TxWI.
BW
 =
BW_20
))

5204 
BbpDa
 |= 0x20;

5205 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SetJapanFilter!!!\n"));

5209 
BbpDa
 &= 0xdf;

5210 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ClearJapanFilter!!!\n"));

5213 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BbpDa
);

5214 
	}
}

5217 
VOID
 
	$ATESameRssi
(

5218 
IN
 
PRTMP_ADAPTER
 
pAd
,

5219 
IN
 
PRXWI_STRUC
 
pRxWI
)

5221 i(
pRxWI
->
RSSI0
 != 0)

5223 
pAd
->
e
.
LaRssi0
 = 
	`ATECvtToRssi
Ad, (
CHAR

pRxWI
->
RSSI0
, 
RSSI_0
);

5224 
pAd
->
e
.
AvgRssi0X8
 = (pAd->e.AvgRssi0X8 -Ad->e.
AvgRssi0
+Ad->e.
LaRssi0
;

5225 
pAd
->
e
.
AvgRssi0
 =Ad->e.
AvgRssi0X8
 >> 3;

5227 i(
pRxWI
->
RSSI1
 != 0)

5229 
pAd
->
e
.
LaRssi1
 = 
	`ATECvtToRssi
Ad, (
CHAR

pRxWI
->
RSSI1
, 
RSSI_1
);

5230 
pAd
->
e
.
AvgRssi1X8
 = (pAd->e.AvgRssi1X8 -Ad->e.
AvgRssi1
+Ad->e.
LaRssi1
;

5231 
pAd
->
e
.
AvgRssi1
 =Ad->e.
AvgRssi1X8
 >> 3;

5233 i(
pRxWI
->
RSSI2
 != 0)

5235 
pAd
->
e
.
LaRssi2
 = 
	`ATECvtToRssi
Ad, (
CHAR

pRxWI
->
RSSI2
, 
RSSI_2
);

5236 
pAd
->
e
.
AvgRssi2X8
 = (pAd->e.AvgRssi2X8 -Ad->e.
AvgRssi2
+Ad->e.
LaRssi2
;

5237 
pAd
->
e
.
AvgRssi2
 =Ad->e.
AvgRssi2X8
 >> 3;

5240 
pAd
->
e
.
LaSNR0
 = (
CHAR
)(
pRxWI
->
SNR0
);

5241 
pAd
->
e
.
LaSNR1
 = (
CHAR
)(
pRxWI
->
SNR1
);

5243 
pAd
->
e
.
NumOfAvgRssiSame
 ++;

5244 
	}
}

5247 #ifde
CONFIG_STA_SUPPORT


5248 
VOID
 
	$RTMPStiSt
(

5249 
IN
 
PRTMP_ADAPTER
 
pAd
)

5252 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==> RTMPStationStop\n"));

5257 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<== RTMPStationStop\n"));

5258 
	}
}

5261 
VOID
 
	$RTMPStiS
(

5262 
IN
 
PRTMP_ADAPTER
 
pAd
)

5264 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==> RTMPStationStart\n"));

5266 #ifde
RTMP_MAC_PCI


5267 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

5273 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<== RTMPStationStart\n"));

5274 
	}
}

5286 #ifde
RTMP_MAC_PCI


5287 
INT
 
	$ATESUpFme
(

5288 
IN
 
PRTMP_ADAPTER
 
pAd
,

5289 
IN
 
UINT32
 
TxIdx
)

5291 
UINT
 
j
;

5292 
PTXD_STRUC
 
pTxD
;

5293 #ifde
RT_BIG_ENDIAN


5294 
PTXD_STRUC
 
pDeTxD
;

5295 
TXD_STRUC
 
TxD
;

5297 
PNDIS_PACKET
 
pPack
;

5298 
PUCHAR
 
pDe
;

5299 
PVOID
 
AocVa
;

5300 
NDIS_PHYSICAL_ADDRESS
 
AocPa
;

5301 
HTTRANSMIT_SETTING
 
TxHTPhyMode
;

5303 
PRTMP_TX_RING
 
pTxRg
 = &
pAd
->
TxRg
[
QID_AC_BE
];

5304 
PTXWI_STRUC
 
pTxWI
 = (PTXWI_STRUC
pTxRg
->
Cl
[
TxIdx
].
DmaBuf
.
AocVa
;

5305 
PUCHAR
 
pDMAHdBufVA
 = (PUCHAR
pTxRg
->
Cl
[
TxIdx
].
DmaBuf
.
AocVa
;

5307 #ifde
RALINK_QA


5308 
PHEADER_802_11
 
pHd80211
;

5311 i(
pAd
->
e
.
bQATxS
 =
TRUE
)

5316 
TxHTPhyMode
.
fld
.
BW
 = 
pAd
->
e
.
TxWI
.BW;

5317 
TxHTPhyMode
.
fld
.
ShtGI
 = 
pAd
->
e
.
TxWI
.ShortGI;

5318 
TxHTPhyMode
.
fld
.
STBC
 = 
pAd
->
e
.
TxWI
.STBC;

5319 
TxHTPhyMode
.
fld
.
MCS
 = 
pAd
->
e
.
TxWI
.MCS;

5320 
TxHTPhyMode
.
fld
.
MODE
 = 
pAd
->
e
.
TxWI
.
PHYMODE
;

5322 
	`ATEWreTxWI
(
pAd
, 
pTxWI
,Ad->
e
.
TxWI
.
FRAG
,Ad->e.TxWI.
CFACK
,

5323 
pAd
->
e
.
TxWI
.
TS
,Ad->e.TxWI.
AMPDU
,Ad->e.TxWI.
ACK
,Ad->e.TxWI.
NSEQ
,

5324 
pAd
->
e
.
TxWI
.
BAWSize
, 0,Ad->e.TxWI.
MPDUtٮByCou
,Ad->e.TxWI.
PackId
, 0, 0,

5325 
pAd
->
e
.
TxWI
.
tx
 ,Ad->e.TxWI.
CFACK
 , &
TxHTPhyMode
);

5327 #ifde
TXBF_SUPPORT


5329 i(
	`IS_RT2883
(
pAd
|| 
	`IS_RT3883
(pAd))

5332 
pTxWI
->
rsv
 = 
pAd
->
e
.
TxWI
.rsv;

5334 
pTxWI
->
iTxBF
 = 
pAd
->
e
.
TxWI
.iTxBF;

5335 
pTxWI
->
Soundg
 = 
pAd
->
e
.
TxWI
.Sounding;

5336 
pTxWI
->
eTxBF
 = 
pAd
->
e
.
TxWI
.eTxBF;

5337 
pTxWI
->
Autoback
 = 
pAd
->
e
.
TxWI
.Autofallback;

5338 
pTxWI
->
NDPSndBW
 = 
pAd
->
e
.
TxWI
.NDPSndBW;

5339 
pTxWI
->
NDPSndRe
 = 
pAd
->
e
.
TxWI
.NDPSndRate;

5345 
TxHTPhyMode
.
fld
.
BW
 = 
pAd
->
e
.
TxWI
.BW;

5346 
TxHTPhyMode
.
fld
.
ShtGI
 = 
pAd
->
e
.
TxWI
.ShortGI;

5347 
TxHTPhyMode
.
fld
.
STBC
 = 
pAd
->
e
.
TxWI
.STBC;

5348 
TxHTPhyMode
.
fld
.
MCS
 = 
pAd
->
e
.
TxWI
.MCS;

5349 
TxHTPhyMode
.
fld
.
MODE
 = 
pAd
->
e
.
TxWI
.
PHYMODE
;

5350 
	`ATEWreTxWI
(
pAd
, 
pTxWI
, 
FALSE
, FALSE, FALSE, FALSE, FALSE, FALSE,

5351 4, 0, 
pAd
->
e
.
TxLgth
, 0, 0, 0, 
IFS_HTTXOP
, 
FALSE
, &
TxHTPhyMode
);

5355 #ifde
RALINK_QA


5356 i(
pAd
->
e
.
bQATxS
 =
TRUE
)

5358 
	`NdisMoveMemy
(
pDMAHdBufVA
+
TXWI_SIZE
, 
pAd
->
e
.
Hd
,Ad->e.
HL
);

5363 
	`NdisMoveMemy
(
pDMAHdBufVA
+
TXWI_SIZE
, 
TemeFme
, 
LENGTH_802_11
);

5364 
	`NdisMoveMemy
(
pDMAHdBufVA
+
TXWI_SIZE
+4, 
pAd
->
e
.
Addr1
, 
ETH_LENGTH_OF_ADDRESS
);

5365 
	`NdisMoveMemy
(
pDMAHdBufVA
+
TXWI_SIZE
+10, 
pAd
->
e
.
Addr2
, 
ETH_LENGTH_OF_ADDRESS
);

5366 
	`NdisMoveMemy
(
pDMAHdBufVA
+
TXWI_SIZE
+16, 
pAd
->
e
.
Addr3
, 
ETH_LENGTH_OF_ADDRESS
);

5369 #ifde
RT_BIG_ENDIAN


5370 
	`RTMPFmeEndnChge
(
pAd
, (((
PUCHAR
)
pDMAHdBufVA
)+
TXWI_SIZE
), 
DIR_READ
, 
FALSE
);

5374 #ifde
RALINK_QA


5375 i(
pAd
->
e
.
bQATxS
 =
TRUE
)

5377 
pPack
 = 
	`RTMP_AoRxPackBufr
(
pAd
,Ad->
e
.
DL
 + 0x100, 
FALSE
, &
AocVa
, &
AocPa
);

5382 
pPack
 = 
	`RTMP_AoRxPackBufr
(
pAd
,Ad->
e
.
TxLgth
, 
FALSE
, &
AocVa
, &
AocPa
);

5385 i(
pPack
 =
NULL
)

5387 
pAd
->
e
.
TxCou
 = 0;

5388 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%瞁خlock s.\n", 
__FUNCTION__
));

5391 
pTxRg
->
Cl
[
TxIdx
].
pNextNdisPack
 = 
pPack
;

5393 
pDe
 = (
PUCHAR

AocVa
;

5395 #ifde
RALINK_QA


5396 i(
pAd
->
e
.
bQATxS
 =
TRUE
)

5398 
	`GET_OS_PKT_LEN
(
pPack

pAd
->
e
.
DL
;

5399 #ide
LINUX


5400 
	`GET_OS_PKT_TOTAL_LEN
(
pPack

pAd
->
e
.
DL
;

5406 
	`GET_OS_PKT_LEN
(
pPack

pAd
->
e
.
TxLgth
 - 
LENGTH_802_11
;

5407 #ide
LINUX


5408 
	`GET_OS_PKT_TOTAL_LEN
(
pPack

pAd
->
e
.
TxLgth
 - 
LENGTH_802_11
;

5413 #ifde
RALINK_QA


5414 i(
pAd
->
e
.
bQATxS
 =
TRUE
)

5417 i((
pAd
->
e
.
PL
 != 0))

5419 
j
;

5421 
j
 = 0; j < 
pAd
->
e
.
DL
; j+Ad->e.
PL
)

5423 
	`memy
(
	`GET_OS_PKT_DATAPTR
(
pPack
+ 
j
, 
pAd
->
e
.
P
,Ad->e.
PL
);

5430 
j
 = 0; j < 
	`GET_OS_PKT_LEN
(
pPack
); j++)

5432 
pDe
[
j
] = 
pAd
->
e
.
Payld
;

5436 #ide
RT_BIG_ENDIAN


5437 
pTxD
 = (
PTXD_STRUC

pTxRg
->
Cl
[
TxIdx
].
AocVa
;

5439 
pDeTxD
 = (
PTXD_STRUC
)
pTxRg
->
Cl
[
TxIdx
].
AocVa
;

5440 
TxD
 = *
pDeTxD
;

5441 
pTxD
 = &
TxD
;

5444 #ifde
RALINK_QA


5445 i(
pAd
->
e
.
bQATxS
 =
TRUE
)

5448 
	`NdisZoMemy
(
pTxD
, 
TXD_SIZE
);

5449 
	`RTMPWreTxDest
(
pAd
, 
pTxD
, 
FALSE
, 
FIFO_EDCA
);

5451 
pTxD
->
SDP0
 = 
	`RTMP_GPhysilAddssLow
(
pTxRg
->
Cl
[
TxIdx
].
DmaBuf
.
AocPa
);

5452 
pTxD
->
SDL0
 = 
TXWI_SIZE
 + 
pAd
->
e
.
HL
;

5453 
pTxD
->
LaSec0
 = 0;

5454 
pTxD
->
SDP1
 = 
AocPa
;

5455 
pTxD
->
SDL1
 = 
	`GET_OS_PKT_LEN
(
pPack
);

5456 
pTxD
->
LaSec1
 = 1;

5458 
pDe
 = (
PUCHAR
)
pTxWI
;

5459 
pDe
 +
TXWI_SIZE
;

5460 
pHd80211
 = (
PHEADER_802_11
)
pDe
;

5463 i(
pAd
->
e
.
TxDeCou
 == 0)

5465 
pAd
->
e
.
q
 = 
pHd80211
->
Sequ
;

5468 
pHd80211
->
Sequ
 = ++
pAd
->
e
.
q
;

5473 
	`NdisZoMemy
(
pTxD
, 
TXD_SIZE
);

5474 
	`RTMPWreTxDest
(
pAd
, 
pTxD
, 
FALSE
, 
FIFO_EDCA
);

5476 
pTxD
->
SDP0
 = 
	`RTMP_GPhysilAddssLow
 (
pTxRg
->
Cl
[
TxIdx
].
DmaBuf
.
AocPa
);

5477 
pTxD
->
SDL0
 = 
TXWI_SIZE
 + 
LENGTH_802_11
;

5478 
pTxD
->
LaSec0
 = 0;

5479 
pTxD
->
SDP1
 = 
AocPa
;

5480 
pTxD
->
SDL1
 = 
	`GET_OS_PKT_LEN
(
pPack
);

5481 
pTxD
->
LaSec1
 = 1;

5484 #ifde
RT_BIG_ENDIAN


5485 
	`RTMPWIEndnChge
((
PUCHAR
)
pTxWI
, 
TYPE_TXWI
);

5486 
	`RTMPFmeEndnChge
(
pAd
, (((
PUCHAR
)
pDMAHdBufVA
)+
TXWI_SIZE
), 
DIR_WRITE
, 
FALSE
);

5487 
	`RTMPDestEndnChge
((
PUCHAR
)
pTxD
, 
TYPE_TXD
);

5488 
	`WreBackToDest
((
PUCHAR
)
pDeTxD
, (PUCHAR)
pTxD
, 
FALSE
, 
TYPE_TXD
);

5492 
	}
}

5500 
VOID
 
	$__ad_l
(
PRTMP_ADAPTER
 
pAd
, 
USHORT
 *
Da
)

5502 
USHORT
 
i
;

5503 
USHORT
 
vue
;

5506 
i
 = 0 ; i < 
EEPROM_SIZE
/2 ; )

5509 
	`RT28xx_EEPROM_READ16
(
pAd
, 
i
*2, 
vue
);

5510 
Da
[
i
] = 
vue
;

5511 
i
++;

5513 
	}
}

5516 
VOID
 
	$__wre_l
(
PRTMP_ADAPTER
 
pAd
, 
USHORT
 *
Da
)

5518 
USHORT
 
i
;

5519 
USHORT
 
vue
;

5522 
i
 = 0 ; i < 
EEPROM_SIZE
/2 ; )

5525 
vue
 = 
Da
[
i
];

5526 
	`RT28xx_EEPROM_WRITE16
(
pAd
, 
i
*2, 
vue
);

5527 
i
++;

5529 
	}
}

5532 #ifde
RALINK_QA


5533 
VOID
 
	$ATE_QA_Stiics
(

5534 
IN
 
PRTMP_ADAPTER
 
pAd
,

5535 
IN
 
PRXWI_STRUC
 
pRxWI
,

5536 
IN
 
PRT28XX_RXD_STRUC
 
pRxD
,

5537 
IN
 
PHEADER_802_11
 
pHd
)

5541 i(
pHd
 !
NULL
)

5543 i(
pHd
->
FC
.
Ty
 =
BTYPE_DATA
)

5545 i(
pRxD
->
U2M
)

5547 
pAd
->
e
.
U2M
++;

5550 
pAd
->
e
.
OthDa
++;

5552 i(
pHd
->
FC
.
Ty
 =
BTYPE_MGMT
)

5554 i(
pHd
->
FC
.
SubTy
 =
SUBTYPE_BEACON
)

5555 
pAd
->
e
.
Bc
++;

5557 
pAd
->
e
.
OthCou
++;

5559 i(
pHd
->
FC
.
Ty
 =
BTYPE_CNTL
)

5561 
pAd
->
e
.
OthCou
++;

5564 
pAd
->
e
.
RSSI0
 = 
pRxWI
->RSSI0;

5565 
pAd
->
e
.
RSSI1
 = 
pRxWI
->RSSI1;

5566 
pAd
->
e
.
RSSI2
 = 
pRxWI
->RSSI2;

5567 
pAd
->
e
.
SNR0
 = 
pRxWI
->SNR0;

5568 
pAd
->
e
.
SNR1
 = 
pRxWI
->SNR1;

5569 
	}
}

5574 
INT
 
	$RtmpDoA
(

5575 
IN
 
PRTMP_ADAPTER
 
pAdr
,

5576 
IN
 
iwq
 *
wrq
)

5578 
USHORT
 
Commd_Id
;

5579 
INT32
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

5580 
e_cfghdr
 *
pRaCfg
;

5581 
UINT32
 
RgeLimIndex
 = 0;

5582 
UINT32
 
TabIndex
 = 0;

5585 i(
	`rcmp
(
wrq
->
i_me
, 
pAdr
->
t_dev
->
me
) != 0)

5588 
Stus
 = -
EINVAL
;

5589  
Stus
;

5592 
pRaCfg
 = 
	`kmloc
((
e_cfghdr
), 
GFP_KERNEL
);

5594 i(!
pRaCfg
)

5596 
Stus
 = -
ENOMEM
;

5597 
ERROR0
;

5600 
	`NdisZoMemy
(
pRaCfg
, (
e_cfghdr
));

5602 
Stus
 = 
	`cy_om_ur
((
PUCHAR
)
pRaCfg
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

5603 i(
Stus
)

5605 
Stus
 = -
EFAULT
;

5606 
ERROR1
;

5609 
Commd_Id
 = 
	`OS_NTOHS
(
pRaCfg
->
commd_id
);

5610 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("\n%s: Commd_Id = 0x%04x !\n", 
__FUNCTION__
, 
Commd_Id
));

5612 
TabIndex
 < ((
RACFG_CMD_TABLES
/ (
RACFG_CMD_TABLE
)))

5614 
cmd_dex
 = 0;

5615 
cmd_dex
 = 
Commd_Id
 - 
RACFG_CMD_TABLES
[
TabIndex
].
cmdOfft
;

5616 i((
cmd_dex
 >=0&& (cmd_dex < 
RACFG_CMD_TABLES
[
TabIndex
].
cmdSSize
))

5618 
RACFG_CMD_HANDLER
 *
pCmdS
;

5620 
pCmdS
 = 
RACFG_CMD_TABLES
[
TabIndex
].
cmdS
;

5621 i(
pCmdS
[
cmd_dex
] !
NULL
)

5622 
Stus
 = (*
pCmdS
[
cmd_dex
])(
pAdr
, 
wrq
, 
pRaCfg
);

5625 
RgeLimIndex
++;

5626 
TabIndex
++;

5630 i(
pAdr
->
e
.
PassiveMode
)

5632 
i
, 
lowCmd
 = 
FALSE
;

5633 
lowedCmds
[] = {

5634 
RACFG_CMD_E2PROM_READ16
, 
RACFG_CMD_E2PROM_READ_ALL
,

5635 
RACFG_CMD_IO_READ
, 
RACFG_CMD_IO_READ_BULK
,

5636 
RACFG_CMD_BBP_READ8
, 
RACFG_CMD_BBP_READ_ALL
,

5637 
RACFG_CMD_ATE_E2PROM_READ_BULK
,

5638 
RACFG_CMD_ATE_BBP_READ_BULK
,

5639 
RACFG_CMD_ATE_RF_READ_BULK
,

5642 
i
=0; i<(
lowedCmds
)/(allowedCmds[0]); i++)

5644 i(
Commd_Id
==
lowedCmds
[
i
])

5646 
lowCmd
 = 
TRUE
;

5652 i(
Commd_Id
==
RACFG_CMD_BBP_WRITE8
)

5654 
offt
 = 
	`ohs
(
pRaCfg
->
us
);

5655 i(
offt
==
BBP_R27
 || (offt>=
BBP_R174
 && offt<=
BBP_R182
))

5656 
lowCmd
 = 
TRUE
;

5660 i(!
lowCmd
)

5662 
	`ReڣToGUI
(
pRaCfg
, 
wrq
, RaCfg->
us
), 
NDIS_STATUS_SUCCESS
);

5663 i(
pRaCfg
 !
NULL
)

5665 
	`k
(
pRaCfg
);

5667  
NDIS_STATUS_FAILURE
;

5671 
ERROR1
:

5672 
	`k
(
pRaCfg
);

5673 
ERROR0
:

5674  
Stus
;

5675 
	}
}

5678 
VOID
 
	$BubbSt
(
INT32
 
n
, INT32 
a
[])

5680 
INT32
 
k
, 
j
, 
mp
;

5682 
k
 = 
n
-1; k>0; k--)

5684 
j
 = 0; j<
k
; j++)

5686 i(
a
[
j
] >[j+1])

5688 
mp
 = 
a
[
j
];

5689 
a
[
j
]=a[j+1];

5690 
a
[
j
+1]=
mp
;

5694 
	}
}

5697 
VOID
 
	$CNoiLev
(
PRTMP_ADAPTER
 
pAd
, 
UCHAR
 
chl
, 
INT32
 
RSSI
[3][10])

5699 
INT32
 
RSSI0
, 
RSSI1
, 
RSSI2
;

5700 
CHAR
 
Rssi0Offt
, 
Rssi1Offt
, 
Rssi2Offt
;

5701 
UCHAR
 
BbpR50Rssi0
 = 0, 
BbpR51Rssi1
 = 0, 
BbpR52Rssi2
 = 0;

5702 
UCHAR
 
Org_BBP66vue
 = 0, 
Org_BBP69vue
 = 0, 
Org_BBP70vue
 = 0, 
da
 = 0;

5703 
USHORT
 
LNA_Ga
 = 0;

5704 
INT32
 
j
 = 0;

5705 
UCHAR
 
Org_Chl
 = 
pAd
->
e
.
Chl
;

5706 
USHORT
 
GaVue
 = 0, 
OfftVue
 = 0;

5708 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R66
, &
Org_BBP66vue
);

5709 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R69
, &
Org_BBP69vue
);

5710 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R70
, &
Org_BBP70vue
);

5715 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_LNA_OFFSET
, 
GaVue
);

5718 i(
chl
 <= 14)

5720 
LNA_Ga
 = 
GaVue
 & 0x00FF;

5722 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_RSSI_BG_OFFSET
, 
OfftVue
);

5723 
Rssi0Offt
 = 
OfftVue
 & 0x00FF;

5724 
Rssi1Offt
 = (
OfftVue
 & 0xFF00) >> 8;

5726 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_RSSI_BG_OFFSET
 + 2, 
OfftVue
);

5727 
Rssi2Offt
 = 
OfftVue
 & 0x00FF;

5731 
LNA_Ga
 = (
GaVue
 & 0xFF00) >> 8;

5732 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_RSSI_A_OFFSET
, 
OfftVue
);

5733 
Rssi0Offt
 = 
OfftVue
 & 0x00FF;

5734 
Rssi1Offt
 = (
OfftVue
 & 0xFF00) >> 8;

5735 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_RSSI_A_OFFSET
 + 2, 
OfftVue
);

5736 
Rssi2Offt
 = 
OfftVue
 & 0x00FF;

5740 
pAd
->
e
.
Chl
 = 
chl
;

5741 
	`ATEAsicSwchChl
(
pAd
);

5742 
	`mday
(5);

5744 
da
 = 0x10;

5745 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
da
);

5747 
da
 = 0x40;

5748 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 
da
);

5749 
da
 = 0x40;

5750 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 
da
);

5751 
	`mday
(5);

5754 
pAd
->
e
.
bQARxS
 = 
TRUE
;

5755 
	`S_ATE_Proc
(
pAd
, "RXFRAME");

5757 
	`mday
(5);

5759 
j
 = 0; j < 10; j++)

5761 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R50
, &
BbpR50Rssi0
);

5762 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R51
, &
BbpR51Rssi1
);

5763 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R52
, &
BbpR52Rssi2
);

5765 
	`mday
(10);

5768 i(
BbpR50Rssi0
 == 0)

5770 
RSSI0
 = -100;

5774 
RSSI0
 = (
INT32
)(-12 - 
BbpR50Rssi0
 - 
LNA_Ga
 - 
Rssi0Offt
);

5776 
RSSI
[0][
j
] = 
RSSI0
;

5778 i
pAd
->
A
.
fld
.
RxPh
 >= 2 )

5781 i(
BbpR51Rssi1
 == 0)

5783 
RSSI1
 = -100;

5787 
RSSI1
 = (
INT32
)(-12 - 
BbpR51Rssi1
 - 
LNA_Ga
 - 
Rssi1Offt
);

5789 
RSSI
[1][
j
] = 
RSSI1
;

5792 i
pAd
->
A
.
fld
.
RxPh
 >= 3 )

5795 i(
BbpR52Rssi2
 == 0)

5796 
RSSI2
 = -100;

5798 
RSSI2
 = (
INT32
)(-12 - 
BbpR52Rssi2
 - 
LNA_Ga
 - 
Rssi2Offt
);

5800 
RSSI
[2][
j
] = 
RSSI2
;

5805 
	`S_ATE_Proc
(
pAd
, "RXSTOP");

5807 
	`mday
(5);

5809 
	`BubbSt
(10, 
RSSI
[0]);

5811 i
pAd
->
A
.
fld
.
RxPh
 >= 2 )

5813 
	`BubbSt
(10, 
RSSI
[1]);

5816 i
pAd
->
A
.
fld
.
RxPh
 >= 3 )

5818 
	`BubbSt
(10, 
RSSI
[2]);

5822 
pAd
->
e
.
Chl
 = 
Org_Chl
;

5823 
	`ATEAsicSwchChl
(
pAd
);

5826 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, 
Org_BBP66vue
);

5827 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 
Org_BBP69vue
);

5828 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 
Org_BBP70vue
);

5831 
	}
}

5834 
BOOLEAN
 
	$SyncTxRxCfig
(
PRTMP_ADAPTER
 
pAd
, 
USHORT
 
offt
, 
UCHAR
 
vue
)

5836 
UCHAR
 
tmp
 = 0, 
bbp_da
 = 0;

5838 i(
	`ATE_ON
(
pAd
))

5840 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
offt
, &
bbp_da
);

5844 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
offt
, &
bbp_da
);

5848 
	`ASSERT
(
bbp_da
 =
vue
);

5850 
offt
)

5852 
BBP_R1
:

5854 
tmp
 = (
bbp_da
 & ((1 << 4) | (1 << 3)) ) >> 3;

5855 
tmp
)

5860 
pAd
->
e
.
TxAS
 = 0;

5865 
pAd
->
e
.
TxAS
 = 1;

5870 
pAd
->
e
.
TxAS
 = 2;

5873 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%-- Sth. wrg! :u FALSE; \n", 
__FUNCTION__
));

5874  
FALSE
;

5878 
BBP_R3
:

5880 
tmp
 = (
bbp_da
 & ((1 << 1) | (1 << 0)) );

5881 
tmp
)

5886 
pAd
->
e
.
RxAS
 = 0;

5894 
pAd
->
e
.
RxAS
 = 1;

5895 
tmp
 = ((
bbp_da
 & ((1 << 4) | (1 << 3)) ) >> 3);

5896 i(
tmp
 == 2)

5899 
pAd
->
e
.
RxAS
 = 0;

5905 
pAd
->
e
.
RxAS
 = 2;

5910 
pAd
->
e
.
RxAS
 = 3;

5913 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%-- Impossib! :u FALSE; \n", 
__FUNCTION__
));

5914  
FALSE
;

5919 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%-- Sth. wrg! :u FALSE; \n", 
__FUNCTION__
));

5920  
FALSE
;

5923  
TRUE
;

5924 
	}
}

5927 
VOID
 
	$memy_exl
(
PRTMP_ADAPTER
 
pAd
, 
UCHAR
 *
d
, UCHAR *
c
, 
ULONG
 
n
)

5929 
ULONG
 
i
, 
Vue
 = 0;

5930 
ULONG
 *
pD
, *
pSrc
;

5931 
UCHAR
 *
p8
;

5933 
p8
 = 
c
;

5934 
pD
 = (
ULONG
 *
d
;

5935 
pSrc
 = (
ULONG
 *
c
;

5937 
i
 = 0 ; i < (
n
/4); i++)

5940 
	`memmove
(&
Vue
, 
pSrc
, 4);

5941 
Vue
 = 
	`OS_HTONL
(Value);

5942 
	`memmove
(
pD
, &
Vue
, 4);

5943 
pD
++;

5944 
pSrc
++;

5946 i((
n
 % 4) != 0)

5949 
	`memmove
(&
Vue
, 
pSrc
, (
n
 % 4));

5950 
Vue
 = 
	`OS_HTONL
(Value);

5951 
	`memmove
(
pD
, &
Vue
, (
n
 % 4));

5953 
	}
}

5956 
VOID
 
	$memy_exs
(
PRTMP_ADAPTER
 
pAd
, 
UCHAR
 *
d
, UCHAR *
c
, 
ULONG
 
n
)

5958 
ULONG
 
i
;

5960 
USHORT
 *
pD
, *
pSrc
;

5962 
pD
 = (
USHORT
 *
d
;

5963 
pSrc
 = (
USHORT
 *
c
;

5965 
i
 =0; i < (
n
/2); i++)

5967 *
pD
 = 
	`OS_NTOHS
(*
pSrc
);

5968 
pD
++;

5969 
pSrc
++;

5972 i((
n
 % 2) != 0)

5974 
	`memy
(
pD
, 
pSrc
, (
n
 % 2));

5975 *
pD
 = 
	`OS_NTOHS
(*pDst);

5979 
	}
}

5982 
VOID
 
	$RTMP_IO_READ_BULK
(
PRTMP_ADAPTER
 
pAd
, 
UCHAR
 *
d
, UCHAR *
c
, 
UINT32
 
n
)

5984 
UINT32
 
i
, 
Vue
;

5985 
UINT32
 *
pD
, *
pSrc
;

5987 
pD
 = (
UINT32
 *
d
;

5988 
pSrc
 = (
UINT32
 *
c
;

5990 
i
 = 0 ; i < (
n
/4); i++)

5992 
	`RTMP_IO_READ32
(
pAd
, (
ULONG
)
pSrc
, &
Vue
);

5993 
Vue
 = 
	`OS_HTONL
(Value);

5994 
	`memmove
(
pD
, &
Vue
, 4);

5995 
pD
++;

5996 
pSrc
++;

5999 
	}
}

6002 
INT
 
	$S_TxSt_Proc
(

6003 
IN
 
PRTMP_ADAPTER
 
pAd
,

6004 
IN
 
PSTRING
 
g
)

6006 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Set_TxStop_Proc\n"));

6008 i(
	`S_ATE_Proc
(
pAd
, "TXSTOP"))

6010  
TRUE
;

6014  
FALSE
;

6016 
	}
}

6019 
INT
 
	$S_RxSt_Proc
(

6020 
IN
 
PRTMP_ADAPTER
 
pAd
,

6021 
IN
 
PSTRING
 
g
)

6023 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Set_RxStop_Proc\n"));

6025 i(
	`S_ATE_Proc
(
pAd
, "RXSTOP"))

6027  
TRUE
;

6031  
FALSE
;

6033 
	}
}

6036 #ifde
DBG


6037 
INT
 
	$S_EERd_Proc
(

6038 
IN
 
PRTMP_ADAPTER
 
pAd
,

6039 
IN
 
PSTRING
 
g
)

6041 
USHORT
 
bufr
[
EEPROM_SIZE
/2];

6042 
USHORT
 *
p
;

6043 
INT
 
i
;

6045 
	`__ad_l
(
pAd
, (
USHORT
 *)
bufr
);

6046 
p
 = 
bufr
;

6048 
i
 = 0; i < (
EEPROM_SIZE
/2); i++)

6050 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%4.4x ", *
p
));

6051 i(((
i
+1) % 16) == 0)

6052 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n"));

6053 
p
++;

6056  
TRUE
;

6057 
	}
}

6060 
INT
 
	$S_EEWre_Proc
(

6061 
IN
 
PRTMP_ADAPTER
 
pAd
,

6062 
IN
 
PSTRING
 
g
)

6064 
USHORT
 
offt
 = 0, 
vue
;

6065 
PSTRING
 
p2
 = 
g
;

6067 (*
p2
 != ':') && (*p2 != '\0'))

6069 
p2
++;

6072 i(*
p2
 == ':')

6074 
	`A2Hex
(
offt
, 
g
);

6075 
	`A2Hex
(
vue
, 
p2
 + 1);

6079 
	`A2Hex
(
vue
, 
g
);

6082 i(
offt
 >
EEPROM_SIZE
)

6084 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Offnكxed EEPROM_SIZE=0x%04x)\n", 
EEPROM_SIZE
));

6085  
FALSE
;

6088 
	`RT28xx_EEPROM_WRITE16
(
pAd
, 
offt
, 
vue
);

6090  
TRUE
;

6091 
	}
}

6094 
INT
 
	$S_BBPRd_Proc
(

6095 
IN
 
PRTMP_ADAPTER
 
pAd
,

6096 
IN
 
PSTRING
 
g
)

6098 
UCHAR
 
vue
 = 0, 
offt
;

6100 
	`A2Hex
(
offt
, 
g
);

6102 i(
	`ATE_ON
(
pAd
))

6104 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
offt
, &
vue
);

6108 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
offt
, &
vue
);

6111 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%x\n", 
vue
));

6113  
TRUE
;

6114 
	}
}

6117 
INT
 
	$S_BBPWre_Proc
(

6118 
IN
 
PRTMP_ADAPTER
 
pAd
,

6119 
IN
 
PSTRING
 
g
)

6121 
USHORT
 
offt
 = 0;

6122 
PSTRING
 
p2
 = 
g
;

6123 
UCHAR
 
vue
;

6125 (*
p2
 != ':') && (*p2 != '\0'))

6127 
p2
++;

6130 i(*
p2
 == ':')

6132 
	`A2Hex
(
offt
, 
g
);

6133 
	`A2Hex
(
vue
, 
p2
 + 1);

6137 
	`A2Hex
(
vue
, 
g
);

6140 i(
	`ATE_ON
(
pAd
))

6142 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
offt
, 
vue
);

6146 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
offt
, 
vue
);

6149  
TRUE
;

6150 
	}
}

6153 
INT
 
	$S_RFWre_Proc
(

6154 
IN
 
PRTMP_ADAPTER
 
pAd
,

6155 
IN
 
PSTRING
 
g
)

6157 
PSTRING
 
p2
, 
p3
, 
p4
;

6158 
UINT32
 
R1
, 
R2
, 
R3
, 
R4
;

6160 
p2
 = 
g
;

6162 (*
p2
 != ':') && (*p2 != '\0'))

6164 
p2
++;

6167 i(*
p2
 != ':')

6168  
FALSE
;

6170 
p3
 = 
p2
 + 1;

6172 (*
p3
 != ':') && (*p3 != '\0'))

6174 
p3
++;

6177 i(*
p3
 != ':')

6178  
FALSE
;

6180 
p4
 = 
p3
 + 1;

6182 (*
p4
 != ':') && (*p4 != '\0'))

6184 
p4
++;

6187 i(*
p4
 != ':')

6188  
FALSE
;

6191 
	`A2Hex
(
R1
, 
g
);

6192 
	`A2Hex
(
R2
, 
p2
 + 1);

6193 
	`A2Hex
(
R3
, 
p3
 + 1);

6194 
	`A2Hex
(
R4
, 
p4
 + 1);

6196 
	`RTMP_RF_IO_WRITE32
(
pAd
, 
R1
);

6197 
	`RTMP_RF_IO_WRITE32
(
pAd
, 
R2
);

6198 
	`RTMP_RF_IO_WRITE32
(
pAd
, 
R3
);

6199 
	`RTMP_RF_IO_WRITE32
(
pAd
, 
R4
);

6201  
TRUE
;

6202 
	}
}

6208 #ifde
RTMP_INTERNAL_TX_ALC


6209 
INT
 
	$S_ATE_TSSI_CALIBRATION_Proc
(

6210 
IN
 
PRTMP_ADAPTER
 
pAd
,

6211 
IN
 
PSTRING
 
g
)

6213 
UCHAR
 
putDAC
;

6214 
putDAC
 = 
	`sime_
(
g
, 0, 10);

6216 if(!
	`IS_RT3390
(
pAd
|| !Ad->
TxPowCl
.
bIlTxALC
) )

6218 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Not support TSSI calibration sinceot 3390 chip or EEPROMot set!!!\n"));

6219 (
FALSE
);

6223 
UCHAR
 
BbpDa
, 
RFVue
, 
RF27Vue
, 
RF28Vue
, 
BBP49Vue
;

6224 
USHORT
 
EEPDa
;

6225 
UCHAR
 
BSSID_ADDR
[
MAC_ADDR_LEN
] = {0x11, 0x22, 0x33, 0x44, 0x55, 0x66};

6228 
	`RT30xxRdRFRegi
(
pAd
, 
RF_R27
, &
RFVue
);

6229 
RF27Vue
 = 
RFVue
;

6230 
RFVue
 |= 0x88;

6231 
	`RT30xxWreRFRegi
(
pAd
, 
RF_R27
, 
RFVue
);

6234 
	`RT30xxRdRFRegi
(
pAd
, 
RF_R28
, &
RFVue
);

6235 
RF28Vue
 = 
RFVue
;

6236 
RFVue
 &= 0x9f;

6237 
	`RT30xxWreRFRegi
(
pAd
, 
RF_R28
, 
RFVue
);

6240 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R49
, &
BbpDa
);

6242 
BBP49Vue
 = 
BbpDa
;

6243 
BbpDa
 |= 0x80;

6244 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R49
, 
BbpDa
);

6247 
	`NdisZoMemy
(&
pAd
->
e
, (
_ATE_INFO
));

6248 
pAd
->
e
.
TxCou
 = 1000;

6249 
pAd
->
e
.
TxLgth
 = 1024;

6250 
pAd
->
e
.
Chl
 = 1;

6251 
pAd
->
e
.
TxWI
.
PHYMODE
= 1;

6252 
pAd
->
e
.
TxWI
.
MCS
 = 7;

6253 
pAd
->
e
.
TxWI
.
BW
 = 0;

6254 
	`COPY_MAC_ADDR
(
pAd
->
e
.
Addr1
, 
BROADCAST_ADDR
);

6255 
	`COPY_MAC_ADDR
(
pAd
->
e
.
Addr2
,Ad->
PmtAddss
);

6256 
	`COPY_MAC_ADDR
(
pAd
->
e
.
Addr3
, 
BSSID_ADDR
);

6259 
pAd
->
e
.
TxPow0
 = 
putDAC
;

6262 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_FREQ_OFFSET
, 
EEPDa
);

6263 
pAd
->
e
.
RFFqOfft
 = (
UCHAR
(
EEPDa
 & 0xff);

6265 
	`S_ATE_Proc
(
pAd
, "TXFRAME");

6266 
	`RTMPucDay
(200000);

6269 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Read BBP_R49\n"));

6270 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R49
, &
BbpDa
);

6271 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BBP R49 = 0x%x\n", 
BbpDa
));

6272 
BbpDa
 &= 0x1f;

6273 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_TSSI_OVER_OFDM_54
, 
EEPDa
);

6274 
EEPDa
 &= 0xff00;

6275 
EEPDa
 |
BbpDa
;

6276 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Wr E2P 0x6e: 0x%x\n", 
EEPDa
));

6277 if(
pAd
->
bUEfu
)

6279 if(
pAd
->
bFroEEPROMBufr
)

6280 
	`NdisMoveMemy
(&(
pAd
->
EEPROMImage
[
EEPROM_TSSI_OVER_OFDM_54
]), (
PUCHAR
(&
EEPDa
) ,2);

6282 
	`eFuWre
(
pAd
, 
EEPROM_TSSI_OVER_OFDM_54
, (
PUCHAR
(&
EEPDa
), 2);

6286 
	`RT28xx_EEPROM_WRITE16
(
pAd
, 
EEPROM_TSSI_OVER_OFDM_54
, 
EEPDa
);

6287 
	`RTMPucDay
(10);

6291 
	`RT30xxWreRFRegi
(
pAd
, 
RF_R27
, 
RF27Vue
);

6292 
	`RT30xxWreRFRegi
(
pAd
, 
RF_R28
, 
RF28Vue
);

6293 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R49
, 
BBP49Vue
);

6296  
TRUE
;

6298 
	}
}

	@common/rt_channel.c

27 
	~"_cfig.h
"

30 
CH_FREQ_MAP
 
	gCH_HZ_ID_MAP
[]=

96 
INT
 
	gCH_HZ_ID_MAP_NUM
 = ((
CH_HZ_ID_MAP
)/(
CH_FREQ_MAP
));

98 #ifde
EXT_BUILD_CHANNEL_LIST


99 
CH_REGION
 
	gChRegi
[] =

103 
CE
,

105 { 1, 13, 20, 
BOTH
, 
FALSE
},

106 { 36, 4, 23, 
BOTH
, 
FALSE
},

107 { 52, 4, 23, 
BOTH
, 
FALSE
},

108 { 100, 11, 30, 
BOTH
, 
FALSE
},

115 
CE
,

117 { 1, 13, 20, 
BOTH
, 
FALSE
},

118 { 52, 4, 24, 
BOTH
, 
FALSE
},

119 { 149, 4, 30, 
BOTH
, 
FALSE
},

126 
CE
,

128 { 1, 13, 20, 
BOTH
, 
FALSE
},

129 { 36, 4, 23, 
BOTH
, 
FALSE
},

130 { 52, 4, 23, 
BOTH
, 
FALSE
},

131 { 100, 11, 30, 
BOTH
, 
FALSE
},

138 
CE
,

140 { 1, 13, 20, 
BOTH
, 
FALSE
},

141 { 36, 4, 23, 
BOTH
, 
FALSE
},

142 { 52, 4, 24, 
BOTH
, 
FALSE
},

143 { 149, 5, 30, 
BOTH
, 
FALSE
},

150 
CE
,

152 { 1, 13, 20, 
BOTH
, 
FALSE
},

153 { 36, 4, 23, 
IDOR
, 
TRUE
},

154 { 52, 4, 23, 
IDOR
, 
TRUE
},

155 { 100, 11, 30, 
BOTH
, 
TRUE
},

162 
CE
,

164 { 1, 13, 20, 
BOTH
, 
FALSE
},

165 { 36, 4, 23, 
BOTH
, 
FALSE
},

166 { 52, 4, 24, 
BOTH
, 
FALSE
},

167 { 149, 5, 30, 
BOTH
, 
FALSE
},

174 
CE
,

176 { 1, 13, 20, 
BOTH
, 
FALSE
},

177 { 36, 4, 23, 
BOTH
, 
FALSE
},

178 { 52, 4, 24, 
BOTH
, 
FALSE
},

179 { 100, 11, 30, 
BOTH
, 
FALSE
},

186 
CE
,

188 { 1, 13, 20, 
BOTH
, 
FALSE
},

189 { 36, 4, 23, 
BOTH
, 
FALSE
},

190 { 52, 4, 24, 
BOTH
, 
FALSE
},

191 { 100, 11, 30, 
BOTH
, 
FALSE
},

198 
CE
,

200 { 1, 13, 20, 
BOTH
, 
FALSE
},

201 { 36, 4, 23, 
BOTH
, 
FALSE
},

202 { 52, 4, 24, 
BOTH
, 
FALSE
},

203 { 100, 11, 24, 
BOTH
, 
FALSE
},

204 { 149, 5, 30, 
BOTH
, 
FALSE
},

211 
CE
,

213 { 1, 13, 20, 
BOTH
, 
FALSE
},

214 { 36, 4, 18, 
IDOR
, 
FALSE
},

215 { 52, 4, 18, 
IDOR
, 
FALSE
},

222 
CE
,

224 { 1, 13, 20, 
BOTH
, 
FALSE
},

225 { 36, 4, 23, 
IDOR
, 
FALSE
},

226 { 52, 4, 23, 
IDOR
, 
TRUE
},

227 { 100, 11, 30, 
ODOR
, 
TRUE
},

234 
CE
,

236 { 1, 13, 20, 
BOTH
, 
FALSE
},

237 { 36, 4, 23, 
BOTH
, 
FALSE
},

238 { 52, 4, 23, 
BOTH
, 
FALSE
},

239 { 149, 5, 30, 
BOTH
, 
FALSE
},

246 
CE
,

248 { 1, 13, 20, 
BOTH
, 
FALSE
},

249 { 36, 4, 23, 
BOTH
, 
FALSE
},

250 { 52, 4, 24, 
BOTH
, 
FALSE
},

251 { 100, 11, 30, 
BOTH
, 
FALSE
},

258 
CE
,

260 { 1, 13, 20, 
BOTH
, 
FALSE
},

261 { 36, 4, 20, 
BOTH
, 
FALSE
},

262 { 52, 4, 20, 
BOTH
, 
FALSE
},

263 { 149, 5, 20, 
BOTH
, 
FALSE
},

270 
CE
,

272 { 1, 13, 20, 
BOTH
, 
FALSE
},

273 { 149, 4, 27, 
BOTH
, 
FALSE
},

280 
CE
,

282 { 1, 13, 20, 
BOTH
, 
FALSE
},

283 { 36, 4, 17, 
BOTH
, 
FALSE
},

284 { 52, 4, 24, 
BOTH
, 
FALSE
},

285 { 100, 11, 30, 
BOTH
, 
FALSE
},

286 { 149, 5, 30, 
BOTH
, 
FALSE
},

293 
CE
,

295 { 1, 13, 20, 
BOTH
, 
FALSE
},

296 { 36, 4, 17, 
BOTH
, 
FALSE
},

297 { 52, 4, 24, 
BOTH
, 
FALSE
},

298 { 149, 4, 30, 
BOTH
, 
FALSE
},

305 
CE
,

307 { 1, 13, 20, 
BOTH
, 
FALSE
},

308 { 36, 4, 23, 
IDOR
, 
FALSE
},

309 { 52, 4, 24, 
IDOR
, 
TRUE
},

310 { 100, 11, 30, 
BOTH
, 
TRUE
},

317 
CE
,

319 { 1, 13, 20, 
BOTH
, 
FALSE
},

320 { 36, 4, 23, 
IDOR
, 
FALSE
},

321 { 52, 4, 23, 
IDOR
, 
TRUE
},

328 
CE
,

330 { 1, 13, 20, 
BOTH
, 
FALSE
},

331 { 36, 4, 23, 
IDOR
, 
FALSE
},

332 { 52, 4, 23, 
IDOR
, 
TRUE
},

333 { 100, 11, 30, 
BOTH
, 
TRUE
},

340 
CE
,

342 { 1, 0, 20, 
BOTH
, 
FALSE
},

343 { 149, 4, 20, 
BOTH
, 
FALSE
},

350 
CE
,

352 { 1, 13, 20, 
BOTH
, 
FALSE
},

353 { 100, 11, 27, 
BOTH
, 
FALSE
},

360 
CE
,

362 { 1, 13, 20, 
BOTH
, 
FALSE
},

363 { 36, 4, 23, 
IDOR
, 
FALSE
},

364 { 52, 4, 30, 
BOTH
, 
TRUE
},

365 { 149, 4, 36, 
BOTH
, 
TRUE
},

372 
CE
,

374 { 1, 13, 20, 
BOTH
, 
FALSE
},

375 { 36, 4, 23, 
IDOR
, 
FALSE
},

376 { 52, 4, 23, 
IDOR
, 
TRUE
},

377 { 100, 11, 30, 
BOTH
, 
TRUE
},

384 
CE
,

386 { 1, 13, 10, 
IDOR
, 
FALSE
},

387 { 1, 13, 20, 
ODOR
, 
FALSE
},

388 { 36, 4, 23, 
IDOR
, 
FALSE
},

389 { 52, 4, 23, 
IDOR
, 
TRUE
},

396 
CE
,

398 { 1, 13, 20, 
BOTH
, 
FALSE
},

399 { 36, 4, 23, 
IDOR
, 
FALSE
},

400 { 52, 4, 23, 
IDOR
, 
TRUE
},

401 { 100, 11, 30, 
BOTH
, 
TRUE
},

408 
CE
,

410 { 1, 13, 20, 
BOTH
, 
FALSE
},

411 { 36, 4, 23, 
IDOR
, 
FALSE
},

412 { 52, 4, 23, 
IDOR
, 
TRUE
},

413 { 100, 11, 30, 
ODOR
, 
TRUE
},

420 
CE
,

422 { 1, 11, 20, 
BOTH
, 
FALSE
},

423 { 36, 4, 17, 
BOTH
, 
FALSE
},

424 { 52, 4, 24, 
BOTH
, 
FALSE
},

425 { 100, 11, 30, 
BOTH
, 
FALSE
},

426 { 149, 5, 30, 
BOTH
, 
FALSE
},

433 
CE
,

435 { 1, 13, 20, 
BOTH
, 
FALSE
},

436 { 36, 4, 17, 
BOTH
, 
FALSE
},

437 { 52, 4, 24, 
BOTH
, 
FALSE
},

438 { 149, 4, 30, 
BOTH
, 
FALSE
},

445 
CE
,

447 { 1, 13, 20, 
BOTH
, 
FALSE
},

448 { 36, 4, 17, 
BOTH
, 
FALSE
},

449 { 52, 4, 24, 
BOTH
, 
FALSE
},

450 { 149, 4, 30, 
BOTH
, 
FALSE
},

457 
CE
,

459 { 1, 13, 20, 
BOTH
, 
FALSE
},

460 { 149, 4, 27, 
BOTH
, 
FALSE
},

467 
CE
,

469 { 1, 13, 20, 
BOTH
, 
FALSE
},

470 { 36, 4, 23, 
IDOR
, 
FALSE
},

471 { 52, 4, 23, 
IDOR
, 
FALSE
},

472 { 149, 4, 30, 
BOTH
, 
FALSE
},

479 
CE
,

481 { 1, 13, 20, 
BOTH
, 
FALSE
},

482 { 36, 4, 23, 
IDOR
, 
FALSE
},

483 { 52, 4, 23, 
IDOR
, 
TRUE
},

490 
CE
,

492 { 1, 13, 20, 
BOTH
, 
FALSE
},

493 { 36, 4, 23, 
IDOR
, 
FALSE
},

494 { 52, 4, 23, 
IDOR
, 
TRUE
},

495 { 100, 11, 30, 
BOTH
, 
TRUE
},

502 
CE
,

504 { 1, 13, 20, 
BOTH
, 
FALSE
},

505 { 149, 4, 24, 
IDOR
, 
FALSE
},

512 
CE
,

514 { 1, 13, 20, 
BOTH
, 
FALSE
},

515 { 149, 4, 27, 
BOTH
, 
FALSE
},

522 
CE
,

524 { 1, 13, 20, 
BOTH
, 
FALSE
},

525 { 36, 4, 23, 
IDOR
, 
FALSE
},

526 { 52, 4, 23, 
IDOR
, 
TRUE
},

527 { 100, 11, 30, 
ODOR
, 
TRUE
},

534 
CE
,

536 { 1, 3, 20, 
IDOR
, 
FALSE
},

537 { 4, 6, 20, 
BOTH
, 
FALSE
},

538 { 10, 4, 20, 
IDOR
, 
FALSE
},

545 
CE
,

547 { 1, 13, 20, 
BOTH
, 
FALSE
},

548 { 36, 4, 23, 
IDOR
, 
FALSE
},

549 { 52, 4, 23, 
IDOR
, 
TRUE
},

550 { 100, 11, 30, 
ODOR
, 
TRUE
},

557 
JAP
,

559 { 1, 14, 20, 
BOTH
, 
FALSE
},

560 { 36, 4, 23, 
IDOR
, 
FALSE
},

567 
CE
,

569 { 1, 13, 20, 
IDOR
, 
FALSE
},

570 { 36, 4, 23, 
IDOR
, 
FALSE
},

571 { 149, 4, 23, 
IDOR
, 
FALSE
},

578 
CE
,

580 { 1, 13, 20, 
BOTH
, 
FALSE
},

581 { 36, 4, 23, 
IDOR
, 
FALSE
},

582 { 52, 4, 23, 
IDOR
, 
TRUE
},

583 { 100, 11, 30, 
BOTH
, 
TRUE
},

590 
CE
,

592 { 1, 13, 20, 
BOTH
, 
FALSE
},

593 { 52, 4, 23, 
IDOR
, 
TRUE
},

594 { 100, 11, 30, 
BOTH
, 
TRUE
},

601 
CE
,

603 { 1, 13, 20, 
BOTH
, 
FALSE
},

604 { 36, 4, 23, 
IDOR
, 
FALSE
},

605 { 52, 4, 23, 
IDOR
, 
TRUE
},

606 { 100, 11, 30, 
BOTH
, 
TRUE
},

613 
CE
,

615 { 1, 13, 20, 
BOTH
, 
FALSE
},

616 { 36, 4, 23, 
IDOR
, 
FALSE
},

617 { 52, 4, 23, 
IDOR
, 
TRUE
},

618 { 100, 11, 30, 
BOTH
, 
TRUE
},

625 
CE
,

627 { 36, 4, 23, 
BOTH
, 
FALSE
},

628 { 52, 4, 23, 
BOTH
, 
FALSE
},

629 { 149, 5, 20, 
BOTH
, 
FALSE
},

636 
CE
,

638 { 1, 13, 20, 
BOTH
, 
FALSE
},

639 { 36, 4, 23, 
IDOR
, 
FALSE
},

640 { 52, 4, 23, 
IDOR
, 
TRUE
},

641 { 100, 11, 30, 
BOTH
, 
TRUE
},

648 
CE
,

650 { 1, 13, 20, 
BOTH
, 
FALSE
},

651 { 36, 4, 24, 
IDOR
, 
FALSE
},

658 
CE
,

660 { 1, 13, 20, 
BOTH
, 
FALSE
},

661 { 36, 4, 23, 
BOTH
, 
FALSE
},

662 { 52, 4, 24, 
BOTH
, 
FALSE
},

663 { 149, 5, 30, 
IDOR
, 
FALSE
},

670 
CE
,

672 { 1, 13, 20, 
BOTH
, 
FALSE
},

673 { 36, 4, 23, 
IDOR
, 
FALSE
},

674 { 52, 4, 24, 
IDOR
, 
TRUE
},

675 { 100, 11, 30, 
BOTH
, 
TRUE
},

682 
CE
,

684 { 1, 13, 20, 
BOTH
, 
FALSE
},

685 { 36, 4, 24, 
BOTH
, 
FALSE
},

686 { 52, 4, 24, 
BOTH
, 
FALSE
},

687 { 149, 4, 30, 
BOTH
, 
FALSE
},

694 
CE
,

696 { 1, 13, 20, 
BOTH
, 
FALSE
},

697 { 36, 4, 24, 
IDOR
, 
FALSE
},

698 { 52, 4, 24, 
IDOR
, 
TRUE
},

699 { 100, 11, 30, 
BOTH
, 
TRUE
},

706 
CE
,

708 { 1, 13, 20, 
BOTH
, 
FALSE
},

709 { 149, 4, 27, 
BOTH
, 
FALSE
},

716 
CE
,

718 { 1, 13, 20, 
BOTH
, 
FALSE
},

719 { 36, 4, 23, 
IDOR
, 
FALSE
},

720 { 52, 4, 23, 
IDOR
, 
TRUE
},

721 { 100, 11, 30, 
BOTH
, 
TRUE
},

728 
CE
,

730 { 1, 13, 20, 
BOTH
, 
FALSE
},

731 { 36, 4, 23, 
IDOR
, 
FALSE
},

732 { 52, 4, 23, 
IDOR
, 
TRUE
},

733 { 100, 11, 30, 
BOTH
, 
TRUE
},

740 
CE
,

742 { 1, 13, 20, 
BOTH
, 
FALSE
},

743 { 36, 4, 23, 
IDOR
, 
FALSE
},

744 { 52, 4, 23, 
IDOR
, 
TRUE
},

745 { 100, 11, 30, 
BOTH
, 
TRUE
},

752 
CE
,

754 { 1, 13, 20, 
BOTH
, 
FALSE
},

755 { 149, 4, 20, 
IDOR
, 
FALSE
},

762 
CE
,

764 { 1, 13, 20, 
BOTH
, 
FALSE
},

765 { 36, 4, 23, 
BOTH
, 
FALSE
},

766 { 52, 4, 23, 
BOTH
, 
FALSE
},

767 { 149, 4, 23, 
BOTH
, 
FALSE
},

774 
CE
,

776 { 1, 13, 20, 
BOTH
, 
FALSE
},

783 
CE
,

785 { 1, 13, 20, 
BOTH
, 
FALSE
},

786 { 36, 4, 23, 
BOTH
, 
FALSE
},

787 { 52, 4, 23, 
BOTH
, 
FALSE
},

788 { 149, 4, 20, 
BOTH
, 
FALSE
},

795 
CE
,

797 { 1, 13, 20, 
BOTH
, 
FALSE
},

798 { 36, 4, 23, 
IDOR
, 
FALSE
},

799 { 52, 4, 23, 
IDOR
, 
TRUE
},

800 { 100, 11, 30, 
BOTH
, 
TRUE
},

807 
CE
,

809 { 1, 13, 20, 
BOTH
, 
FALSE
},

810 { 36, 4, 23, 
IDOR
, 
FALSE
},

811 { 52, 4, 23, 
IDOR
, 
TRUE
},

818 
CE
,

820 { 1, 13, 20, 
BOTH
, 
FALSE
},

821 { 36, 4, 23, 
BOTH
, 
FALSE
},

822 { 52, 4, 23, 
IDOR
, 
FALSE
},

823 { 100, 11, 30, 
BOTH
, 
TRUE
},

824 { 149, 4, 30, 
BOTH
, 
FALSE
},

831 
CE
,

833 { 1, 13, 20, 
BOTH
, 
FALSE
},

834 { 36, 4, 20, 
BOTH
, 
FALSE
},

835 { 52, 4, 20, 
BOTH
, 
FALSE
},

836 { 100, 8, 20, 
BOTH
, 
FALSE
},

837 { 149, 4, 20, 
BOTH
, 
FALSE
},

844 
CE
,

846 { 1, 13, 20, 
BOTH
, 
FALSE
},

847 { 36, 4, 17, 
IDOR
, 
FALSE
},

848 { 52, 4, 23, 
IDOR
, 
TRUE
},

849 { 100, 11, 30, 
BOTH
, 
TRUE
},

856 
CE
,

858 { 1, 13, 20, 
BOTH
, 
FALSE
},

859 { 36, 4, 23, 
IDOR
, 
FALSE
},

860 { 52, 4, 23, 
IDOR
, 
TRUE
},

861 { 100, 11, 30, 
BOTH
, 
TRUE
},

868 
CE
,

870 { 1, 13, 20, 
BOTH
, 
FALSE
},

871 { 36, 4, 23, 
IDOR
, 
TRUE
},

872 { 52, 4, 23, 
IDOR
, 
TRUE
},

879 
CE
,

881 { 1, 11, 30, 
BOTH
, 
FALSE
},

882 { 52, 4, 23, 
IDOR
, 
FALSE
},

889 
CE
,

891 { 1, 13, 20, 
BOTH
, 
FALSE
},

892 { 36, 4, 23, 
BOTH
, 
FALSE
},

893 { 52, 4, 23, 
BOTH
, 
FALSE
},

900 
CE
,

902 { 1, 13, 20, 
BOTH
, 
FALSE
},

903 { 36, 4, 23, 
IDOR
, 
FALSE
},

904 { 52, 4, 23, 
IDOR
, 
TRUE
},

905 { 100, 11, 30, 
BOTH
, 
TRUE
},

912 
CE
,

914 { 1, 13, 20, 
BOTH
, 
FALSE
},

921 
CE
,

923 { 1, 13, 20, 
BOTH
, 
FALSE
},

930 
FCC
,

932 { 1, 11, 30, 
BOTH
, 
FALSE
},

933 { 36, 4, 17, 
IDOR
, 
FALSE
},

934 { 52, 4, 24, 
BOTH
, 
TRUE
},

935 { 100, 11, 30, 
BOTH
, 
TRUE
},

936 { 149, 5, 30, 
BOTH
, 
FALSE
},

943 
CE
,

945 { 1, 13, 20, 
BOTH
, 
FALSE
},

946 { 149, 4, 27, 
BOTH
, 
FALSE
},

953 
CE
,

955 { 1, 14, 255, 
BOTH
, 
FALSE
},

956 { 36, 4, 255, 
BOTH
, 
FALSE
},

957 { 52, 4, 255, 
BOTH
, 
FALSE
},

958 { 100, 11, 255, 
BOTH
, 
FALSE
},

959 { 149, 5, 255, 
BOTH
, 
FALSE
},

966 
PCH_REGION
 
	$GChRegi
(

967 
IN
 
PUCHAR
 
CryCode
)

969 
INT
 
lo
 = 0;

970 
PCH_REGION
 
pChRegi
 = 
NULL
;

972 
	`rcmp
((
PSTRING

ChRegi
[
lo
].
CouReg
, "") != 0)

974 i(
	`cmp
((
PSTRING

ChRegi
[
lo
].
CouReg
, (PSTRING
CryCode
, 2) == 0)

976 
pChRegi
 = &
ChRegi
[
lo
];

979 
lo
++;

982 i(
pChRegi
 =
NULL
)

983 
pChRegi
 = &
ChRegi
[
lo
];

984  
pChRegi
;

985 
	}
}

987 
VOID
 
	$ChBdCheck
(

988 
IN
 
UCHAR
 
PhyMode
,

989 
OUT
 
PUCHAR
 
pChTy
)

991 
PhyMode
)

993 
PHY_11A
:

994 #ifde
DOT11_N_SUPPORT


995 
PHY_11AN_MIXED
:

997 *
pChTy
 = 
BAND_5G
;

999 
PHY_11ABG_MIXED
:

1000 #ifde
DOT11_N_SUPPORT


1001 
PHY_11AGN_MIXED
:

1002 
PHY_11ABGN_MIXED
:

1004 *
pChTy
 = 
BAND_BOTH
;

1008 *
pChTy
 = 
BAND_24G
;

1011 
	}
}

1013 
UCHAR
 
	$FlChLi
(

1014 
IN
 
PRTMP_ADAPTER
 
pAd
,

1015 
IN
 
PCH_DESP
 
pChDe
,

1016 
IN
 
UCHAR
 
Offt
,

1017 
IN
 
UCHAR
 
emt
,

1018 
IN
 
UCHAR
 
gutyDoma
)

1020 
INT
 
i
, 
j
, 
l
;

1021 
UCHAR
 
chl
;

1023 
j
 = 
Offt
;

1024 
i
 = 0; i < 
pChDe
->
NumOfCh
; i++)

1026 
chl
 = 
pChDe
->
FChl
 + 
i
 * 
emt
;

1028 
l
=0;<
MAX_NUM_OF_CHANNELS
;++)

1030 i(
chl
 =
pAd
->
TxPow
[
l
].
Chl
)

1032 
pAd
->
ChlLi
[
j
].
Pow
 =Ad->
TxPow
[
l
].Power;

1033 
pAd
->
ChlLi
[
j
].
Pow2
 =Ad->
TxPow
[
l
].Power2;

1037 i(
l
 =
MAX_NUM_OF_CHANNELS
)

1040 
pAd
->
ChlLi
[
j
].
Chl
 = 
pChDe
->
FChl
 + 
i
 * 
emt
;

1041 
pAd
->
ChlLi
[
j
].
MaxTxPwr
 = 
pChDe
->MaxTxPwr;

1042 
pAd
->
ChlLi
[
j
].
DfsReq
 = 
pChDe
->DfsReq;

1043 
pAd
->
ChlLi
[
j
].
RegutyDoma
 = 
gutyDoma
;

1044 
j
++;

1046 
pAd
->
ChlLiNum
 = 
j
;

1048  
j
;

1049 
	}
}

1052 
le
 
VOID
 
	$CeChLi
(

1053 
IN
 
PRTMP_ADAPTER
 
pAd
,

1054 
IN
 
PCH_REGION
 
pChRegi
,

1055 
IN
 
UCHAR
 
Geogphy
)

1057 
INT
 
i
;

1058 
UCHAR
 
offt
 = 0;

1059 
PCH_DESP
 
pChDe
;

1060 
UCHAR
 
ChTy
;

1061 
UCHAR
 
emt
;

1062 
UCHAR
 
gutyDoma
;

1064 i(
pChRegi
 =
NULL
)

1067 
	`ChBdCheck
(
pAd
->
CommCfg
.
PhyMode
, &
ChTy
);

1069 
i
=0; i<10; i++)

1071 
pChDe
 = &
pChRegi
->
ChDe
[
i
];

1072 i(
pChDe
->
FChl
 == 0)

1075 i(
ChTy
 =
BAND_5G
)

1077 i(
pChDe
->
FChl
 <= 14)

1080 i(
ChTy
 =
BAND_24G
)

1082 i(
pChDe
->
FChl
 > 14)

1086 i((
pChDe
->
Geogphy
 =
BOTH
)

1087 || (
pChDe
->
Geogphy
 == Geography))

1089 i(
pChDe
->
FChl
 > 14)

1090 
emt
 = 4;

1092 
emt
 = 1;

1093 
gutyDoma
 = 
pChRegi
->
DfsTy
;

1094 
offt
 = 
	`FlChLi
(
pAd
, 
pChDe
, offt, 
emt
, 
gutyDoma
);

1097 
	}
}

1100 
VOID
 
	$BudChlLiEx
(

1101 
IN
 
PRTMP_ADAPTER
 
pAd
)

1103 
PCH_REGION
 
pChReg
;

1105 
pChReg
 = 
	`GChRegi
(
pAd
->
CommCfg
.
CouryCode
);

1106 
	`CeChLi
(
pAd
, 
pChReg
,Ad->
CommCfg
.
Geogphy
);

1107 
	}
}

1109 
VOID
 
	$BudBcChLi
(

1110 
IN
 
PRTMP_ADAPTER
 
pAd
,

1111 
OUT
 
PUCHAR
 
pBuf
,

1112 
OUT
 
PULONG
 
pBufL
)

1114 
INT
 
i
;

1115 
ULONG
 
TmpL
;

1116 
PCH_REGION
 
pChRegi
;

1117 
PCH_DESP
 
pChDe
;

1118 
UCHAR
 
ChTy
;

1120 
pChRegi
 = 
	`GChRegi
(
pAd
->
CommCfg
.
CouryCode
);

1122 i(
pChRegi
 =
NULL
)

1125 
	`ChBdCheck
(
pAd
->
CommCfg
.
PhyMode
, &
ChTy
);

1126 *
pBufL
 = 0;

1128 
i
=0; i<10; i++)

1130 
pChDe
 = &
pChRegi
->
ChDe
[
i
];

1131 i(
pChDe
->
FChl
 == 0)

1134 i(
ChTy
 =
BAND_5G
)

1136 i(
pChDe
->
FChl
 <= 14)

1139 i(
ChTy
 =
BAND_24G
)

1141 i(
pChDe
->
FChl
 > 14)

1145 i((
pChDe
->
Geogphy
 =
BOTH
)

1146 || (
pChDe
->
Geogphy
 =
pAd
->
CommCfg
.Geography))

1148 
	`MakeOutgogFme
(
pBuf
 + *
pBufL
, &
TmpL
,

1149 1, &
pChDe
->
FChl
,

1150 1, &
pChDe
->
NumOfCh
,

1151 1, &
pChDe
->
MaxTxPwr
,

1152 
END_OF_ARGS
);

1153 *
pBufL
 +
TmpL
;

1156 
	}
}

1159 #ifde
DOT11_N_SUPPORT


1160 
BOOLEAN
 
	$IsVidChl
(

1161 
IN
 
PRTMP_ADAPTER
 
pAd
,

1162 
IN
 
UCHAR
 
chl
)

1165 
INT
 
i
;

1167 
i
 = 0; i < 
pAd
->
ChlLiNum
; i++)

1169 i(
pAd
->
ChlLi
[
i
].
Chl
 =
chl
)

1173 i(
i
 =
pAd
->
ChlLiNum
)

1174  
FALSE
;

1176  
TRUE
;

1177 
	}
}

1180 
UCHAR
 
	$GExtCh
(

1181 
IN
 
UCHAR
 
Chl
,

1182 
IN
 
UCHAR
 
Dei
)

1184 
CHAR
 
ExtCh
;

1186 i(
Dei
 =
EXTCHA_ABOVE
)

1187 
ExtCh
 = 
Chl
 + 4;

1189 
ExtCh
 = (
Chl
 - 4) > 0 ? (Channel - 4) : 0;

1191  
ExtCh
;

1192 
	}
}

1195 
VOID
 
	$N_ChlCheck
(

1196 
IN
 
PRTMP_ADAPTER
 
pAd
)

1199 
UCHAR
 
Chl
 = 
pAd
->
CommCfg
.Channel;

1201 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
&& (pAd->CommCfg.
RegTnsmStg
.
fld
.
BW
 =
BW_40
))

1203 i(
Chl
 > 14)

1205 i((
Chl
 == 36) || (Channel == 44) || (Channel == 52) || (Channel == 60) || (Channel == 100) || (Channel == 108) ||

1206 (
Chl
 == 116) || (Channel == 124) || (Channel == 132) || (Channel == 149) || (Channel == 157))

1208 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 = 
EXTCHA_ABOVE
;

1210 i((
Chl
 == 40) || (Channel == 48) || (Channel == 56) || (Channel == 64) || (Channel == 104) || (Channel == 112) ||

1211 (
Chl
 == 120) || (Channel == 128) || (Channel == 136) || (Channel == 153) || (Channel == 161))

1213 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 = 
EXTCHA_BELOW
;

1217 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 = 
BW_20
;

1224 
UCHAR
 
ExtCh
;

1225 
UCHAR
 
D
 = 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
;

1226 
ExtCh
 = 
	`GExtCh
(
Chl
, 
D
);

1227 i(
	`IsVidChl
(
pAd
, 
ExtCh
))

1230 
D
 = (D =
EXTCHA_ABOVE
? 
EXTCHA_BELOW
 : EXTCHA_ABOVE;

1231 
ExtCh
 = 
	`GExtCh
(
Chl
, 
D
);

1232 i(
	`IsVidChl
(
pAd
, 
ExtCh
))

1234 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 = 
D
;

1237 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 = 
BW_20
;

1238 } 
FALSE
);

1240 i(
Chl
 == 14)

1242 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 = 
BW_20
;

1249 
	}
}

1252 
VOID
 
	$N_SCCh
(

1253 
IN
 
PRTMP_ADAPTER
 
pAd
)

1255 i(
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 =
BW_40
)

1257 i(
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 =
EXTCHA_ABOVE
)

1260 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
 + 2;

1264 i(
pAd
->
CommCfg
.
Chl
 == 14)

1265 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
 - 1;

1267 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
 - 2;

1272 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
;

1274 
	}
}

1278 
UINT8
 
	$GCuryMaxTxPwr
(

1279 
IN
 
PRTMP_ADAPTER
 
pAd
,

1280 
IN
 
UINT8
 
chl
)

1282 
i
;

1283 
i
 = 0; i < 
pAd
->
ChlLiNum
; i++)

1285 i(
pAd
->
ChlLi
[
i
].
Chl
 =
chl
)

1289 i(
i
 =
pAd
->
ChlLiNum
)

1291 #ifde
SINGLE_SKU


1292 i(
pAd
->
CommCfg
.
bSKUMode
 =
TRUE
)

1294 
UINT
 
dTxSmPwr
 = 0;

1296 #ifde
DOT11_N_SUPPORT


1297 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
&& (pAd->CommCfg.
TxSm
 == 2))

1298 
dTxSmPwr
 = 3;

1300 i(
pAd
->
ChlLi
[
i
].
RegutyDoma
 =
FCC
)

1303 #ifde
DOT11_N_SUPPORT


1304 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
) &&

1305 (
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 =
BW_40
))

1306  (
pAd
->
ChlLi
[
i
].
MaxTxPwr
 -Ad->
CommCfg
.
BdedgeD
 - 
dTxSmPwr
);

1309  (
pAd
->
ChlLi
[
i
].
MaxTxPwr
 - 
dTxSmPwr
);

1311 i(
pAd
->
ChlLi
[
i
].
RegutyDoma
 =
CE
)

1313  (
pAd
->
ChlLi
[
i
].
MaxTxPwr
 -Ad->
CommCfg
.
AGa
 - 
dTxSmPwr
);

1319  
pAd
->
ChlLi
[
i
].
MaxTxPwr
;

1320 
	}
}

1324 
VOID
 
	$RTMP_MChlID2KHZ
(

1325 
IN
 
UCHAR
 
Ch
,

1326 
OUT
 
UINT32
 *
pFq
)

1328 
chIdx
;

1329 
chIdx
 = 0; chIdx < 
CH_HZ_ID_MAP_NUM
; chIdx++)

1331 i((
Ch
=
CH_HZ_ID_MAP
[
chIdx
].
chl
)

1333 (*
pFq

CH_HZ_ID_MAP
[
chIdx
].
eqKHz
 * 1000;

1337 i(
chIdx
 =
CH_HZ_ID_MAP_NUM
)

1338 (*
pFq
) = 2412000;

1339 
	}
}

1342 
VOID
 
	$RTMP_MKHZ2ChlID
(

1343 
IN
 
ULONG
 
Fq
,

1344 
OUT
 
INT
 *
pCh
)

1346 
chIdx
;

1347 
chIdx
 = 0; chIdx < 
CH_HZ_ID_MAP_NUM
; chIdx++)

1349 i((
Fq
=
CH_HZ_ID_MAP
[
chIdx
].
eqKHz
)

1351 (*
pCh

CH_HZ_ID_MAP
[
chIdx
].
chl
;

1355 i(
chIdx
 =
CH_HZ_ID_MAP_NUM
)

1356 (*
pCh
) = 1;

1357 
	}
}

	@common/rtmp_init.c

37 
	~"_cfig.h
"

38 
	#RT3090A_DEFAULT_INTERNAL_LNA_GAIN
 0x0A

	)

39 
UCHAR
 
	gBIT8
[] = {0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80};

40 #ifde
DBG


41 * 
	gChName
[] = {"none","wep64","wep128","TKIP","AES","CKIP64","CKIP128","CKIP152","SMS4"};

47 
REG_PAIR
 
	gBBPRegTab
[] = {

48 {
BBP_R65
, 0x2C},

49 {
BBP_R66
, 0x38},

50 {
BBP_R69
, 0x12},

51 {
BBP_R70
, 0xa},

52 {
BBP_R73
, 0x10},

53 {
BBP_R81
, 0x37},

54 {
BBP_R82
, 0x62},

55 {
BBP_R83
, 0x6A},

56 {
BBP_R84
, 0x99},

57 {
BBP_R86
, 0x00},

58 {
BBP_R91
, 0x04},

59 {
BBP_R92
, 0x00},

60 {
BBP_R103
, 0x00},

61 {
BBP_R105
, 0x05},

62 #ifde
DOT11_N_SUPPORT


63 {
BBP_R106
, 0x35},

66 
	#NUM_BBP_REG_PARMS
 ((
BBPRegTab
/ (
REG_PAIR
))

	)

72 
RTMP_REG_PAIR
 
	gMACRegTab
[] = {

73 #ifde
SPECIFIC_BCN_BUF_SUPPORT


83 {
BCN_OFFSET0
, 0x18100800},

84 {
BCN_OFFSET1
, 0x38302820},

85 {
BCN_OFFSET2
, 0x58504840},

86 {
BCN_OFFSET3
, 0x78706860},

87 #i
defed
(
HW_BEACON_OFFSET
) && (HW_BEACON_OFFSET == 0x200)

88 {
BCN_OFFSET0
, 0xf8f0e8e0},

89 {
BCN_OFFSET1
, 0x6f77d0c8},

90 #i
defed
(
HW_BEACON_OFFSET
) && (HW_BEACON_OFFSET == 0x100)

91 {
BCN_OFFSET0
, 0xece8e4e0},

92 {
BCN_OFFSET1
, 0xfcf8f4f0},

94 #r 
You
 
mu
 

-
lcuϋ
 
w
 
vue
 
BCN_OFFSET0
 & 
BCN_OFFSET1
 

 
MACRegTab
[]!!!

97 {
LEGACY_BASIC_RATE
, 0x0000013f},

98 {
HT_BASIC_RATE
, 0x00008003},

99 {
MAC_SYS_CTRL
, 0x00},

100 {
RX_FILTR_CFG
, 0x17f97},

101 {
BKOFF_SLOT_CFG
, 0x209},

103 {
TX_SW_CFG0
, 0x0},

104 {
TX_SW_CFG1
, 0x80606},

105 {
TX_LINK_CFG
, 0x1020},

107 {
TX_TIMEOUT_CFG
, 0x000a2090},

108 {
MAX_LEN_CFG
, 
MAX_AGGREGATION_SIZE
 | 0x00001000},

109 {
LED_CFG
, 0x7f031e46},

124 #ifde
INF_AMAZON_SE


125 {
PBF_MAX_PCNT
, 0x1F3F6F6F},

129 {
PBF_MAX_PCNT
, 0x1F3FBF9F},

134 {
TX_RTY_CFG
, 0x47d01f0f},

136 {
AUTO_RSP_CFG
, 0x00000053},

137 {
CCK_PROT_CFG
, 0x05740003 },

138 {
OFDM_PROT_CFG
, 0x05740003 },

139 {
GF20_PROT_CFG
, 0x01744004},

140 {
GF40_PROT_CFG
, 0x03F44084},

141 {
MM20_PROT_CFG
, 0x01744004},

142 #ifde
RTMP_MAC_PCI


143 {
MM40_PROT_CFG
, 0x03F54084},

145 {
TXOP_CTRL_CFG
, 0x0000583f, },

146 {
TX_RTS_CFG
, 0x00092b20},

148 {
EXP_ACK_TIME
, 0x002400ca},

156 {
TXOP_HLDR_ET
, 0x00000002},

162 {
XIFS_TIME_CFG
, 0x33a41010},

163 {
PWR_PIN_CFG
, 0x00000003},

167 #ifde
CONFIG_STA_SUPPORT


168 
RTMP_REG_PAIR
 
	gSTAMACRegTab
[] = {

169 {
WMM_AIFSN_CFG
, 0x00002273},

170 {
WMM_CWMIN_CFG
, 0x00002344},

171 {
WMM_CWMAX_CFG
, 0x000034aa},

175 
	#NUM_MAC_REG_PARMS
 ((
MACRegTab
/ (
RTMP_REG_PAIR
))

	)

176 #ifde
CONFIG_STA_SUPPORT


177 
	#NUM_STA_MAC_REG_PARMS
 ((
STAMACRegTab
/ (
RTMP_REG_PAIR
))

	)

200 
NDIS_STATUS
 
	$RTMPAocAdrBlock
(

201 
IN
 
PVOID
 
hd
,

202 
OUT
 
PRTMP_ADAPTER
 *
Adr
)

204 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

205 
NDIS_STATUS
 
Stus
;

206 
INT
 
dex
;

207 
UCHAR
 *
pBcBuf
 = 
NULL
;

209 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> RTMPAllocAdapterBlock\n"));

211 *
Adr
 = 
NULL
;

216 
pBcBuf
 = 
	`kmloc
(
MAX_BEACON_SIZE
, 
MEM_ALLOC_FLAG
);

217 i(
pBcBuf
 =
NULL
)

219 
Stus
 = 
NDIS_STATUS_FAILURE
;

220 
	`DBGPRINT_ERR
(("Failedollocate memory - BeaconBuf!\n"));

223 
	`NdisZoMemy
(
pBcBuf
, 
MAX_BEACON_SIZE
);

225 
Stus
 = 
	`AdrBlockAoMemy
(
hd
, (
PVOID
 *)&
pAd
);

226 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

228 
	`DBGPRINT_ERR
(("Failedollocate memory - ADAPTER\n"));

231 
pAd
->
BcBuf
 = 
pBcBuf
;

232 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n\n==pAd = %p, siz%d ===\n\n", 
pAd
, (
UINT32
)(
RTMP_ADAPTER
)));

236 
	`NdisAoSpLock
(&
pAd
->
MgmtRgLock
);

237 #ifde
RTMP_MAC_PCI


238 
	`NdisAoSpLock
(&
pAd
->
RxRgLock
);

241 
dex
 =0 ; index < 
NUM_OF_TX_RING
; index++)

243 
	`NdisAoSpLock
(&
pAd
->
TxSwQueueLock
[
dex
]);

244 
	`NdisAoSpLock
(&
pAd
->
DeQueueLock
[
dex
]);

245 
pAd
->
DeQueueRug
[
dex
] = 
FALSE
;

248 #ifde
RESOURCE_PRE_ALLOC


253 
Stus
 = 
	`RTMPAocTxRxRgMemy
(
pAd
);

254 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

256 
	`DBGPRINT_ERR
(("Failedollocate memory - TxRxRing\n"));

261 
	`NdisAoSpLock
(&
pAd
->
q_lock
);

266 } 
FALSE
);

268 i((
Stus
 !
NDIS_STATUS_SUCCESS
&& (
pBcBuf
))

269 
	`k
(
pBcBuf
);

271 i(
pAd
 !
NULL
)

272 *
Adr
 = 
pAd
;

278 
dex
 = 0; index < 
MAX_LEN_OF_BSS_TABLE
; index++)

280 i(
	`os_loc_mem
(
pAd
,&pAd->
ProbeReIE
[
dex
].
pIe
, 
MAX_VIE_LEN
=
NDIS_STATUS_SUCCESS
)

281 
	`RTMPZoMemy
(
pAd
->
ProbeReIE
[
dex
].
pIe
, 
MAX_VIE_LEN
);

283 
pAd
->
ProbeReIE
[
dex
].
pIe
 = 
NULL
;

286 
	`DBGPRINT_S
(
Stus
, ("<-- RTMPAllocAdapterBlock, Status=%x\n", Status));

287  
Stus
;

288 
	}
}

311 
VOID
 
	$RTMPRdTxPwrPRe
(

312 
IN
 
PRTMP_ADAPTER
 
pAd
)

314 
ULONG
 
da
, 
Ada
, 
Gda
;

315 
USHORT
 
i
, 
vue
, 
vue2
;

316 
USHORT
 
vue_1
, 
vue_2
, 
vue_3
, 
vue_4
;

317 
INT
 
Apwrd
, 
Gpwrd
;

318 
UCHAR
 
t1
,
t2
,
t3
,
t4
;

319 
BOOLEAN
 
bApwrdMus
 = 
TRUE
, 
bGpwrdMus
 = TRUE;

325 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Txpowerer Rate\n"));

326 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_TXPOWER_DELTA
, 
vue2
);

327 
Apwrd
 = 0;

328 
Gpwrd
 = 0;

330 i((
vue2
 & 0xff) != 0xff)

332 i((
vue2
 & 0x80))

333 
Gpwrd
 = (
vue2
&0xf);

335 i((
vue2
 & 0x40))

336 
bGpwrdMus
 = 
FALSE
;

338 
bGpwrdMus
 = 
TRUE
;

340 i((
vue2
 & 0xff00) != 0xff00)

342 i((
vue2
 & 0x8000))

343 
Apwrd
 = ((
vue2
&0xf00)>>8);

345 i((
vue2
 & 0x4000))

346 
bApwrdMus
 = 
FALSE
;

348 
bApwrdMus
 = 
TRUE
;

350 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Gpwrd = %x, Apwrd = %x .\n", 
Gpwrd
, 
Apwrd
));

355 
i
=0; i<5; i++)

357 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_TXPOWER_BYRATE_20MHZ_2_4G
 + 
i
*4, 
vue
);

358 
da
 = 
vue
;

361 
vue_1
 = 
vue
&0xf;

362 
vue_2
 = (
vue
&0xf0)>>4;

363 
vue_3
 = (
vue
&0xf00)>>8;

364 
vue_4
 = (
vue
&0xf000)>>12;

366 i(
bApwrdMus
 =
FALSE
)

368 
t1
 = 
vue_1
+(
Apwrd
);

369 i(
t1
 > 0xf)

370 
t1
 = 0xf;

371 
t2
 = 
vue_2
+(
Apwrd
);

372 i(
t2
 > 0xf)

373 
t2
 = 0xf;

374 
t3
 = 
vue_3
+(
Apwrd
);

375 i(
t3
 > 0xf)

376 
t3
 = 0xf;

377 
t4
 = 
vue_4
+(
Apwrd
);

378 i(
t4
 > 0xf)

379 
t4
 = 0xf;

383 i(
vue_1
 > 
Apwrd
)

384 
t1
 = 
vue_1
-(
Apwrd
);

386 
t1
 = 0;

387 i(
vue_2
 > 
Apwrd
)

388 
t2
 = 
vue_2
-(
Apwrd
);

390 
t2
 = 0;

391 i(
vue_3
 > 
Apwrd
)

392 
t3
 = 
vue_3
-(
Apwrd
);

394 
t3
 = 0;

395 i(
vue_4
 > 
Apwrd
)

396 
t4
 = 
vue_4
-(
Apwrd
);

398 
t4
 = 0;

400 
Ada
 = 
t1
 + (
t2
<<4+ (
t3
<<8+ (
t4
<<12);

401 i(
bGpwrdMus
 =
FALSE
)

403 
t1
 = 
vue_1
+(
Gpwrd
);

404 i(
t1
 > 0xf)

405 
t1
 = 0xf;

406 
t2
 = 
vue_2
+(
Gpwrd
);

407 i(
t2
 > 0xf)

408 
t2
 = 0xf;

409 
t3
 = 
vue_3
+(
Gpwrd
);

410 i(
t3
 > 0xf)

411 
t3
 = 0xf;

412 
t4
 = 
vue_4
+(
Gpwrd
);

413 i(
t4
 > 0xf)

414 
t4
 = 0xf;

418 i(
vue_1
 > 
Gpwrd
)

419 
t1
 = 
vue_1
-(
Gpwrd
);

421 
t1
 = 0;

422 i(
vue_2
 > 
Gpwrd
)

423 
t2
 = 
vue_2
-(
Gpwrd
);

425 
t2
 = 0;

426 i(
vue_3
 > 
Gpwrd
)

427 
t3
 = 
vue_3
-(
Gpwrd
);

429 
t3
 = 0;

430 i(
vue_4
 > 
Gpwrd
)

431 
t4
 = 
vue_4
-(
Gpwrd
);

433 
t4
 = 0;

435 
Gda
 = 
t1
 + (
t2
<<4+ (
t3
<<8+ (
t4
<<12);

437 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_TXPOWER_BYRATE_20MHZ_2_4G
 + 
i
*4 + 2, 
vue
);

440 
vue_1
 = 
vue
&0xf;

441 
vue_2
 = (
vue
&0xf0)>>4;

442 
vue_3
 = (
vue
&0xf00)>>8;

443 
vue_4
 = (
vue
&0xf000)>>12;

445 i(
bApwrdMus
 =
FALSE
)

447 
t1
 = 
vue_1
+(
Apwrd
);

448 i(
t1
 > 0xf)

449 
t1
 = 0xf;

450 
t2
 = 
vue_2
+(
Apwrd
);

451 i(
t2
 > 0xf)

452 
t2
 = 0xf;

453 
t3
 = 
vue_3
+(
Apwrd
);

454 i(
t3
 > 0xf)

455 
t3
 = 0xf;

456 
t4
 = 
vue_4
+(
Apwrd
);

457 i(
t4
 > 0xf)

458 
t4
 = 0xf;

462 i(
vue_1
 > 
Apwrd
)

463 
t1
 = 
vue_1
-(
Apwrd
);

465 
t1
 = 0;

466 i(
vue_2
 > 
Apwrd
)

467 
t2
 = 
vue_2
-(
Apwrd
);

469 
t2
 = 0;

470 i(
vue_3
 > 
Apwrd
)

471 
t3
 = 
vue_3
-(
Apwrd
);

473 
t3
 = 0;

474 i(
vue_4
 > 
Apwrd
)

475 
t4
 = 
vue_4
-(
Apwrd
);

477 
t4
 = 0;

479 
Ada
 |((
t1
<<16+ (
t2
<<20+ (
t3
<<24+ (
t4
<<28));

480 i(
bGpwrdMus
 =
FALSE
)

482 
t1
 = 
vue_1
+(
Gpwrd
);

483 i(
t1
 > 0xf)

484 
t1
 = 0xf;

485 
t2
 = 
vue_2
+(
Gpwrd
);

486 i(
t2
 > 0xf)

487 
t2
 = 0xf;

488 
t3
 = 
vue_3
+(
Gpwrd
);

489 i(
t3
 > 0xf)

490 
t3
 = 0xf;

491 
t4
 = 
vue_4
+(
Gpwrd
);

492 i(
t4
 > 0xf)

493 
t4
 = 0xf;

497 i(
vue_1
 > 
Gpwrd
)

498 
t1
 = 
vue_1
-(
Gpwrd
);

500 
t1
 = 0;

501 i(
vue_2
 > 
Gpwrd
)

502 
t2
 = 
vue_2
-(
Gpwrd
);

504 
t2
 = 0;

505 i(
vue_3
 > 
Gpwrd
)

506 
t3
 = 
vue_3
-(
Gpwrd
);

508 
t3
 = 0;

509 i(
vue_4
 > 
Gpwrd
)

510 
t4
 = 
vue_4
-(
Gpwrd
);

512 
t4
 = 0;

514 
Gda
 |((
t1
<<16+ (
t2
<<20+ (
t3
<<24+ (
t4
<<28));

515 
da
 |(
vue
<<16);

518 
pAd
->
Tx20MPwrCfgABd
[
i
] = 
da
;

519 
pAd
->
Tx20MPwrCfgGBd
[
i
] = 
da
;

520 
pAd
->
Tx40MPwrCfgABd
[
i
] = 
Ada
;

521 
pAd
->
Tx40MPwrCfgGBd
[
i
] = 
Gda
;

523 i(
da
 != 0xffffffff)

524 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_PWR_CFG_0
 + 
i
*4, 
da
);

525 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, ("20MHz BW, 2.4G bd-%lx, Ad%lx, Gd%lx \n", 
da
, 
Ada
, 
Gda
));

528 
	}
}

549 
VOID
 
	$RTMPRdChlPwr
(

550 
IN
 
PRTMP_ADAPTER
 
pAd
)

552 
UINT32
 
i
, 
chofft
;

553 
EEPROM_TX_PWR_STRUC
 
Pow
;

554 
EEPROM_TX_PWR_STRUC
 
Pow2
;

562 
i
 = 0; i < 7; i++)

565 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_G_TX_PWR_OFFSET
 + 
i
 * 2, 
Pow
.
wd
);

566 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_G_TX2_PWR_OFFSET
 + 
i
 * 2, 
Pow2
.
wd
);

567 
pAd
->
TxPow
[
i
 * 2].
Chl
 = i * 2 + 1;

568 
pAd
->
TxPow
[
i
 * 2 + 1].
Chl
 = i * 2 + 2;

570 i((
Pow
.
fld
.
By0
 > 31) || (Power.field.Byte0 < 0))

571 
pAd
->
TxPow
[
i
 * 2].
Pow
 = 
DEFAULT_RF_TX_POWER
;

573 
pAd
->
TxPow
[
i
 * 2].
Pow
 = Pow.
fld
.
By0
;

575 i((
Pow
.
fld
.
By1
 > 31) || (Power.field.Byte1 < 0))

576 
pAd
->
TxPow
[
i
 * 2 + 1].
Pow
 = 
DEFAULT_RF_TX_POWER
;

578 
pAd
->
TxPow
[
i
 * 2 + 1].
Pow
 = Pow.
fld
.
By1
;

580 i((
Pow2
.
fld
.
By0
 > 31) || (Power2.field.Byte0 < 0))

581 
pAd
->
TxPow
[
i
 * 2].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

583 
pAd
->
TxPow
[
i
 * 2].
Pow2
 = Pow2.
fld
.
By0
;

585 i((
Pow2
.
fld
.
By1
 > 31) || (Power2.field.Byte1 < 0))

586 
pAd
->
TxPow
[
i
 * 2 + 1].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

588 
pAd
->
TxPow
[
i
 * 2 + 1].
Pow2
 = Pow2.
fld
.
By1
;

594 
chofft
 = 14;

595 
i
 = 0; i < 4; i++)

597 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 0].
Chl
 = 36 + i * 8 + 0;

598 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 0].
Pow
 = 
DEFAULT_RF_TX_POWER
;

599 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 0].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

601 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 1].
Chl
 = 36 + i * 8 + 2;

602 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 1].
Pow
 = 
DEFAULT_RF_TX_POWER
;

603 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 1].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

605 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 2].
Chl
 = 36 + i * 8 + 4;

606 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 2].
Pow
 = 
DEFAULT_RF_TX_POWER
;

607 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 2].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

611 
i
 = 0; i < 6; i++)

614 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TX_PWR_OFFSET
 + 
i
 * 2, 
Pow
.
wd
);

615 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TX2_PWR_OFFSET
 + 
i
 * 2, 
Pow2
.
wd
);

618 i((
Pow
.
fld
.
By0
 < 16) && (Power.field.Byte0 >= -7))

619 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 0].
Pow
 = Pow.
fld
.
By0
;

621 i((
Pow
.
fld
.
By1
 < 16) && (Power.field.Byte1 >= -7))

622 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 1].
Pow
 = Pow.
fld
.
By1
;

624 i((
Pow2
.
fld
.
By0
 < 16) && (Power2.field.Byte0 >= -7))

625 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 0].
Pow2
 = Pow2.
fld
.
By0
;

627 i((
Pow2
.
fld
.
By1
 < 16) && (Power2.field.Byte1 >= -7))

628 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 1].
Pow2
 = Pow2.
fld
.
By1
;

634 
chofft
 = 14 + 12;

635 
i
 = 0; i < 5; i++)

637 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 0].
Chl
 = 100 + i * 8 + 0;

638 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 0].
Pow
 = 
DEFAULT_RF_TX_POWER
;

639 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 0].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

641 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 1].
Chl
 = 100 + i * 8 + 2;

642 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 1].
Pow
 = 
DEFAULT_RF_TX_POWER
;

643 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 1].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

645 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 2].
Chl
 = 100 + i * 8 + 4;

646 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 2].
Pow
 = 
DEFAULT_RF_TX_POWER
;

647 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 2].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

649 
pAd
->
TxPow
[3 * 5 + 
chofft
 + 0].
Chl
 = 140;

650 
pAd
->
TxPow
[3 * 5 + 
chofft
 + 0].
Pow
 = 
DEFAULT_RF_TX_POWER
;

651 
pAd
->
TxPow
[3 * 5 + 
chofft
 + 0].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

654 
i
 = 0; i < 8; i++)

657 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TX_PWR_OFFSET
 + (
chofft
 - 14+ 
i
 * 2, 
Pow
.
wd
);

658 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TX2_PWR_OFFSET
 + (
chofft
 - 14+ 
i
 * 2, 
Pow2
.
wd
);

661 i((
Pow
.
fld
.
By0
 < 16) && (Power.field.Byte0 >= -7))

662 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 0].
Pow
 = Pow.
fld
.
By0
;

664 i((
Pow
.
fld
.
By1
 < 16) && (Power.field.Byte1 >= -7))

665 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 1].
Pow
 = Pow.
fld
.
By1
;

667 i((
Pow2
.
fld
.
By0
 < 16) && (Power2.field.Byte0 >= -7))

668 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 0].
Pow2
 = Pow2.
fld
.
By0
;

670 i((
Pow2
.
fld
.
By1
 < 16) && (Power2.field.Byte1 >= -7))

671 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 1].
Pow2
 = Pow2.
fld
.
By1
;

677 
chofft
 = 14 + 12 + 16;

679 
i
 = 0; i < 3; i++)

681 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 0].
Chl
 = 149 + i * 8 + 0;

682 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 0].
Pow
 = 
DEFAULT_RF_TX_POWER
;

683 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 0].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

685 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 1].
Chl
 = 149 + i * 8 + 2;

686 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 1].
Pow
 = 
DEFAULT_RF_TX_POWER
;

687 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 1].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

689 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 2].
Chl
 = 149 + i * 8 + 4;

690 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 2].
Pow
 = 
DEFAULT_RF_TX_POWER
;

691 
pAd
->
TxPow
[3 * 
i
 + 
chofft
 + 2].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

693 
pAd
->
TxPow
[3 * 3 + 
chofft
 + 0].
Chl
 = 171;

694 
pAd
->
TxPow
[3 * 3 + 
chofft
 + 0].
Pow
 = 
DEFAULT_RF_TX_POWER
;

695 
pAd
->
TxPow
[3 * 3 + 
chofft
 + 0].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

697 
pAd
->
TxPow
[3 * 3 + 
chofft
 + 1].
Chl
 = 173;

698 
pAd
->
TxPow
[3 * 3 + 
chofft
 + 1].
Pow
 = 
DEFAULT_RF_TX_POWER
;

699 
pAd
->
TxPow
[3 * 3 + 
chofft
 + 1].
Pow2
 = 
DEFAULT_RF_TX_POWER
;

703 
i
 = 0; i < 6; i++)

706 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TX_PWR_OFFSET
 + (
chofft
 - 14+ 
i
 * 2, 
Pow
.
wd
);

707 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TX2_PWR_OFFSET
 + (
chofft
 - 14+ 
i
 * 2, 
Pow2
.
wd
);

710 i((
Pow
.
fld
.
By0
 < 16) && (Power.field.Byte0 >= -7))

711 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 0].
Pow
 = Pow.
fld
.
By0
;

713 i((
Pow
.
fld
.
By1
 < 16) && (Power.field.Byte1 >= -7))

714 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 1].
Pow
 = Pow.
fld
.
By1
;

716 i((
Pow2
.
fld
.
By0
 < 16) && (Power2.field.Byte0 >= -7))

717 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 0].
Pow2
 = Pow2.
fld
.
By0
;

719 i((
Pow2
.
fld
.
By1
 < 16) && (Power2.field.Byte1 >= -7))

720 
pAd
->
TxPow
[
i
 * 2 + 
chofft
 + 1].
Pow2
 = Pow2.
fld
.
By1
;

726 
chofft
 = 14 + 12 + 16 + 11;

729 
	}
}

750 
VOID
 
	$NICRdEEPROMPams
(

751 
IN
 
PRTMP_ADAPTER
 
pAd
,

752 
IN
 
PSTRING
 
mac_addr
)

754 
UINT32
 
da
 = 0;

755 
USHORT
 
i
, 
vue
, 
vue2
;

756 
UCHAR
 
TmpPhy
;

757 
EEPROM_TX_PWR_STRUC
 
Pow
;

758 
EEPROM_VERSION_STRUC
 
Vsi
;

759 
EEPROM_ANTENNA_STRUC
 
A
;

760 
EEPROM_NIC_CONFIG2_STRUC
 
NicCfig2
;

761 
USHORT
 
Addr01
,
Addr23
,
Addr45
 ;

762 
MAC_DW0_STRUC
 
c2
;

763 
MAC_DW1_STRUC
 
c3
;

766 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> NICReadEEPROMParameters\n"));

768 i(
pAd
->
chOps
.

)

770 
pAd
->
chOps
.
	`
(pAd);

771 #ifde
RTMP_EFUSE_SUPPORT


776 
	`RTMP_IO_READ32
(
pAd
, 
E2PROM_CSR
, &
da
);

777 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> E2PROM_CSR = 0x%x\n", 
da
));

779 if((
da
 & 0x30) == 0)

780 
pAd
->
EEPROMAddssNum
 = 6;

781 if((
da
 & 0x30) == 0x10)

782 
pAd
->
EEPROMAddssNum
 = 8;

784 
pAd
->
EEPROMAddssNum
 = 8;

785 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> EEPROMAddssNum = %d\n", 
pAd
->
EEPROMAddssNum
 ));

788 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Initialize MAC Address from E2PROM \n"));

790 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x04, 
Addr01
);

791 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x06, 
Addr23
);

792 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x08, 
Addr45
);

794 
pAd
->
PmtAddss
[0] = (
UCHAR
)(
Addr01
 & 0xff);

795 
pAd
->
PmtAddss
[1] = (
UCHAR
)(
Addr01
 >> 8);

796 
pAd
->
PmtAddss
[2] = (
UCHAR
)(
Addr23
 & 0xff);

797 
pAd
->
PmtAddss
[3] = (
UCHAR
)(
Addr23
 >> 8);

798 
pAd
->
PmtAddss
[4] = (
UCHAR
)(
Addr45
 & 0xff);

799 
pAd
->
PmtAddss
[5] = (
UCHAR
)(
Addr45
 >> 8);

802 i(
pAd
->
PmtAddss
[0] == 0xff)

803 
pAd
->
PmtAddss
[0] = 
	`RdomBy
(pAd)&0xf8;

805 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("E2PROM MAC: =%02x:%02x:%02x:%02x:%02x:%02x\n",

806 
	`PRINT_MAC
(
pAd
->
PmtAddss
)));

809 i(
pAd
->
bLolAdmMAC
)

811 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Usehe MACddress what isssigned from Configuration file(.dat). \n"));

813 i(
mac_addr
 &&

814 
	`
((
PSTRING
)
mac_addr
) == 17 &&

815 (
	`rcmp
(
mac_addr
, "00:00:00:00:00:00") != 0))

817 
INT
 
j
;

818 
PSTRING
 
ma
;

820 
ma
 = (
PSTRING

mac_addr
;

822 
j
=0; j<
MAC_ADDR_LEN
; j++)

824 
	`AtoH
(
ma
, &
pAd
->
CutAddss
[
j
], 1);

825 
ma
=macptr+3;

828 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Usehe MACddress what isssigned from Moudle Parameter. \n"));

832 
	`COPY_MAC_ADDR
(
pAd
->
CutAddss
,Ad->
PmtAddss
);

833 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Usehe MACddress what isssigned from EEPROM. \n"));

837 
c2
.
fld
.
By0
 = 
pAd
->
CutAddss
[0];

838 
c2
.
fld
.
By1
 = 
pAd
->
CutAddss
[1];

839 
c2
.
fld
.
By2
 = 
pAd
->
CutAddss
[2];

840 
c2
.
fld
.
By3
 = 
pAd
->
CutAddss
[3];

841 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_ADDR_DW0
, 
c2
.
wd
);

842 
c3
.
wd
 = 0;

843 
c3
.
fld
.
By4
 = 
pAd
->
CutAddss
[4];

844 
c3
.
fld
.
By5
 = 
pAd
->
CutAddss
[5];

845 
c3
.
fld
.
U2MeMask
 = 0xff;

846 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_ADDR_DW1
, 
c3
.
wd
);

847 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
,("Current MAC: =%02x:%02x:%02x:%02x:%02x:%02x\n",

848 
	`PRINT_MAC
(
pAd
->
CutAddss
)));

852 
	`RTMPRdChlPwr
(
pAd
);

856 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_VERSION_OFFSET
, 
Vsi
.
wd
);

857 
pAd
->
EromVsi
 = 
Vsi
.
fld
.Vsi + Vsi.fld.
FRNumb
 * 256;

858 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("E2PROM: Vsi = %d, FAE #%d\n", 
Vsi
.
fld
.Vsi, Vsi.fld.
FRNumb
));

860 i(
Vsi
.
fld
.Vsi > 
VALID_EEPROM_VERSION
)

862 
	`DBGPRINT_ERR
(("E2PROM: WRONG VERSION 0x%x, should b%d\n",
Vsi
.
fld
.Vsi, 
VALID_EEPROM_VERSION
));

883 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_NIC1_OFFSET
, 
vue
);

884 
pAd
->
EEPROMDeuVue
[
EEPROM_NIC_CFG1_OFFSET
] = 
vue
;

886 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_NIC2_OFFSET
, 
vue
);

887 
pAd
->
EEPROMDeuVue
[
EEPROM_NIC_CFG2_OFFSET
] = 
vue
;

890 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_COUNTRY_REGION
, 
vue
);

891 
pAd
->
EEPROMDeuVue
[
EEPROM_COUNTRY_REG_OFFSET
] = 
vue
;

895 
i
 = 0; i < 8; i++)

897 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_BBP_BASE_OFFSET
 + 
i
*2, 
vue
);

898 
pAd
->
EEPROMDeuVue
[
i
+
EEPROM_BBP_ARRAY_OFFSET
] = 
vue
;

905 
A
.
wd
 = 
pAd
->
EEPROMDeuVue
[
EEPROM_NIC_CFG1_OFFSET
];

906 i(
A
.
wd
 == 0xFFFF)

910 
A
.
wd
 = 0;

911 
A
.
fld
.
RfIcTy
 = 
RFIC_2820
;

912 
A
.
fld
.
TxPh
 = 1;

913 
A
.
fld
.
RxPh
 = 2;

915 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("E2PROM, hd coda0x%04x\n", 
A
.
wd
));

919 i((
pAd
->
CommCfg
.
TxSm
 =0|| (pAd->CommCfg.TxSm > 
A
.
fld
.
TxPh
))

920 
pAd
->
CommCfg
.
TxSm
 = 
A
.
fld
.
TxPh
;

922 i((
pAd
->
CommCfg
.
RxSm
 =0|| (pAd->CommCfg.RxSm > 
A
.
fld
.
RxPh
))

924 
pAd
->
CommCfg
.
RxSm
 = 
A
.
fld
.
RxPh
;

926 i((
pAd
->
MACVsi
 !
RALINK_3883_VERSION
) &&

927 (
pAd
->
MACVsi
 !
RALINK_2883_VERSION
) &&

928 (
pAd
->
CommCfg
.
RxSm
 > 2))

931 
pAd
->
CommCfg
.
RxSm
 = 2;

937 
NicCfig2
.
wd
 = 
pAd
->
EEPROMDeuVue
[
EEPROM_NIC_CFG2_OFFSET
];

941 #ifde
CONFIG_STA_SUPPORT


942 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

944 i((
NicCfig2
.
wd
 & 0x00ff) == 0xff)

946 
NicCfig2
.
wd
 &= 0xff00;

949 i((
NicCfig2
.
wd
 >> 8) == 0xff)

951 
NicCfig2
.
wd
 &= 0x00ff;

956 i(
NicCfig2
.
fld
.
DymicTxAgcCڌ
 == 1)

957 
pAd
->
bAutoTxAgcA
 =Ad->
bAutoTxAgcG
 = 
TRUE
;

959 
pAd
->
bAutoTxAgcA
 =Ad->
bAutoTxAgcG
 = 
FALSE
;

962 
pAd
->
NicCfig2
.
wd
 = NicConfig2.word;

964 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, ("NICRdEEPROMPams: RxPh = %d, TxPh = %d\n", 
A
.
fld
.
RxPh
, A.fld.
TxPh
));

967 
pAd
->
A
.
wd
 = Antenna.word;

970 
pAd
->
Mlme
.
RlRxPh
 = (
UCHAR

A
.
fld
.
RxPh
;

972 
pAd
->
RfIcTy
 = (
UCHAR

A
.
fld
.RfIcType;

975 i(
	`PHY_MODE_IS_5G_BAND
(
pAd
->
CommCfg
.
PhyMode
))

977 i(!
	`RFIC_IS_5G_BAND
(
pAd
))

979 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,

981 
pAd
->
RfIcTy
));

982 #ifde
DOT11_N_SUPPORT


984 
	`S_WessMode_Proc
(
pAd
, "9");

987 
	`S_WessMode_Proc
(
pAd
, "0");

992 #ifde
CONFIG_STA_SUPPORT


993 #ifde
RTMP_MAC_PCI


994 
	`rtf
((
PSTRING

pAd
->
nickme
, "RT2860STA");

1003 i((
A
.
fld
.
RfIcTy
 !
RFIC_2850
)

1004 && (
A
.
fld
.
RfIcTy
 !
RFIC_2750
)

1005 && (
A
.
fld
.
RfIcTy
 !
RFIC_3052
)

1006 && (
A
.
fld
.
RfIcTy
 !
RFIC_2853
)

1009 i((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11ABG_MIXED
) ||

1010 (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11A
))

1011 
pAd
->
CommCfg
.
PhyMode
 = 
PHY_11BG_MIXED
;

1012 #ifde
DOT11_N_SUPPORT


1013 i((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11ABGN_MIXED
) ||

1014 (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11AN_MIXED
) ||

1015 (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11AGN_MIXED
) ||

1016 (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11N_5G
))

1017 
pAd
->
CommCfg
.
PhyMode
 = 
PHY_11BGN_MIXED
;

1020 
pAd
->
RFICTy
 = 
RFIC_24GHZ
;

1024 
pAd
->
RFICTy
 = 
RFIC_24GHZ
 | 
RFIC_5GHZ
;

1035 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_G_TSSI_BOUND1
, 
Pow
.
wd
);

1036 
pAd
->
TssiMusBoundyG
[4] = 
Pow
.
fld
.
By0
;

1037 
pAd
->
TssiMusBoundyG
[3] = 
Pow
.
fld
.
By1
;

1038 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_G_TSSI_BOUND2
, 
Pow
.
wd
);

1039 
pAd
->
TssiMusBoundyG
[2] = 
Pow
.
fld
.
By0
;

1040 
pAd
->
TssiMusBoundyG
[1] = 
Pow
.
fld
.
By1
;

1041 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_G_TSSI_BOUND3
, 
Pow
.
wd
);

1042 
pAd
->
TssiRefG
 = 
Pow
.
fld
.
By0
;

1043 
pAd
->
TssiPlusBoundyG
[1] = 
Pow
.
fld
.
By1
;

1044 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_G_TSSI_BOUND4
, 
Pow
.
wd
);

1045 
pAd
->
TssiPlusBoundyG
[2] = 
Pow
.
fld
.
By0
;

1046 
pAd
->
TssiPlusBoundyG
[3] = 
Pow
.
fld
.
By1
;

1047 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_G_TSSI_BOUND5
, 
Pow
.
wd
);

1048 
pAd
->
TssiPlusBoundyG
[4] = 
Pow
.
fld
.
By0
;

1049 
pAd
->
TxAgcSpG
 = 
Pow
.
fld
.
By1
;

1050 
pAd
->
TxAgcComnG
 = 0;

1051 
pAd
->
TssiMusBoundyG
[0] =Ad->
TssiRefG
;

1052 
pAd
->
TssiPlusBoundyG
[0] =Ad->
TssiRefG
;

1055 i(
pAd
->
TssiRefG
 == 0xff)

1056 
pAd
->
bAutoTxAgcG
 = 
FALSE
;

1059 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("E2PROM: G Tssi[-4 .. +4] = %d %d %d %d - %d -%d %d %d %d, step=%d,uning=%d\n",

1060 
pAd
->
TssiMusBoundyG
[4],Ad->TssiMinusBoundaryG[3],Ad->TssiMinusBoundaryG[2],Ad->TssiMinusBoundaryG[1],

1061 
pAd
->
TssiRefG
,

1062 
pAd
->
TssiPlusBoundyG
[1],Ad->TssiPlusBoundaryG[2],Ad->TssiPlusBoundaryG[3],Ad->TssiPlusBoundaryG[4],

1063 
pAd
->
TxAgcSpG
,Ad->
bAutoTxAgcG
));

1068 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TSSI_BOUND1
, 
Pow
.
wd
);

1069 
pAd
->
TssiMusBoundyA
[4] = 
Pow
.
fld
.
By0
;

1070 
pAd
->
TssiMusBoundyA
[3] = 
Pow
.
fld
.
By1
;

1071 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TSSI_BOUND2
, 
Pow
.
wd
);

1072 
pAd
->
TssiMusBoundyA
[2] = 
Pow
.
fld
.
By0
;

1073 
pAd
->
TssiMusBoundyA
[1] = 
Pow
.
fld
.
By1
;

1074 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TSSI_BOUND3
, 
Pow
.
wd
);

1075 
pAd
->
TssiRefA
 = 
Pow
.
fld
.
By0
;

1076 
pAd
->
TssiPlusBoundyA
[1] = 
Pow
.
fld
.
By1
;

1077 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TSSI_BOUND4
, 
Pow
.
wd
);

1078 
pAd
->
TssiPlusBoundyA
[2] = 
Pow
.
fld
.
By0
;

1079 
pAd
->
TssiPlusBoundyA
[3] = 
Pow
.
fld
.
By1
;

1080 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_A_TSSI_BOUND5
, 
Pow
.
wd
);

1081 
pAd
->
TssiPlusBoundyA
[4] = 
Pow
.
fld
.
By0
;

1082 
pAd
->
TxAgcSpA
 = 
Pow
.
fld
.
By1
;

1083 
pAd
->
TxAgcComnA
 = 0;

1084 
pAd
->
TssiMusBoundyA
[0] =Ad->
TssiRefA
;

1085 
pAd
->
TssiPlusBoundyA
[0] =Ad->
TssiRefA
;

1088 i(
pAd
->
TssiRefA
 == 0xff)

1089 
pAd
->
bAutoTxAgcA
 = 
FALSE
;

1092 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("E2PROM: A Tssi[-4 .. +4] = %d %d %d %d - %d -%d %d %d %d, step=%d,uning=%d\n",

1093 
pAd
->
TssiMusBoundyA
[4],Ad->TssiMinusBoundaryA[3],Ad->TssiMinusBoundaryA[2],Ad->TssiMinusBoundaryA[1],

1094 
pAd
->
TssiRefA
,

1095 
pAd
->
TssiPlusBoundyA
[1],Ad->TssiPlusBoundaryA[2],Ad->TssiPlusBoundaryA[3],Ad->TssiPlusBoundaryA[4],

1096 
pAd
->
TxAgcSpA
,Ad->
bAutoTxAgcA
));

1098 
pAd
->
BbpRssiToDbmD
 = 0x0;

1101 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_FREQ_OFFSET
, 
vue
);

1103 i((
vue
 & 0x00FF) != 0x00FF)

1104 
pAd
->
RfFqOfft
 = (
ULONG
(
vue
 & 0x00FF);

1106 
pAd
->
RfFqOfft
 = 0;

1108 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("E2PROM: RF FqOfft=0x%lx \n", 
pAd
->
RfFqOfft
));

1111 
vue
 = 
pAd
->
EEPROMDeuVue
[
EEPROM_COUNTRY_REG_OFFSET
] >> 8;

1112 
vue2
 = 
pAd
->
EEPROMDeuVue
[
EEPROM_COUNTRY_REG_OFFSET
] & 0x00FF;

1114 i((
vue
 <
REGION_MAXIMUM_BG_BAND
&& (
vue2
 <
REGION_MAXIMUM_A_BAND
))

1116 
pAd
->
CommCfg
.
CouryRegi
 = ((
UCHAR

vue
) | 0x80;

1117 
pAd
->
CommCfg
.
CouryRegiFABd
 = ((
UCHAR

vue2
) | 0x80;

1118 
TmpPhy
 = 
pAd
->
CommCfg
.
PhyMode
;

1119 
pAd
->
CommCfg
.
PhyMode
 = 0xff;

1120 
	`RTMPSPhyMode
(
pAd
, 
TmpPhy
);

1121 #ifde
DOT11_N_SUPPORT


1122 
	`SCommHT
(
pAd
);

1131 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_RSSI_BG_OFFSET
, 
vue
);

1132 
pAd
->
BGRssiOfft0
 = 
vue
 & 0x00ff;

1133 
pAd
->
BGRssiOfft1
 = (
vue
 >> 8);

1137 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_RSSI_BG_OFFSET
+2, 
vue
);

1139 
pAd
->
BGRssiOfft2
 = 
vue
 & 0x00ff;

1140 
pAd
->
ALNAGa1
 = (
vue
 >> 8);

1144 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_LNA_OFFSET
, 
vue
);

1145 
pAd
->
BLNAGa
 = 
vue
 & 0x00ff;

1146 
pAd
->
ALNAGa0
 = (
vue
 >> 8);

1150 i((
pAd
->
BGRssiOfft0
 < -10) || (pAd->BGRssiOffset0 > 10))

1151 
pAd
->
BGRssiOfft0
 = 0;

1154 i((
pAd
->
BGRssiOfft1
 < -10) || (pAd->BGRssiOffset1 > 10))

1155 
pAd
->
BGRssiOfft1
 = 0;

1158 i((
pAd
->
BGRssiOfft2
 < -10) || (pAd->BGRssiOffset2 > 10))

1159 
pAd
->
BGRssiOfft2
 = 0;

1162 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_RSSI_A_OFFSET
, 
vue
);

1163 
pAd
->
ARssiOfft0
 = 
vue
 & 0x00ff;

1164 
pAd
->
ARssiOfft1
 = (
vue
 >> 8);

1168 
	`RT28xx_EEPROM_READ16
(
pAd
, (
EEPROM_RSSI_A_OFFSET
+2), 
vue
);

1169 
pAd
->
ARssiOfft2
 = 
vue
 & 0x00ff;

1170 
pAd
->
ALNAGa2
 = (
vue
 >> 8);

1174 i(((
UCHAR
)
pAd
->
ALNAGa1
 == 0xFF) || (pAd->ALNAGain1 == 0x00))

1175 
pAd
->
ALNAGa1
 =Ad->
ALNAGa0
;

1176 i(((
UCHAR
)
pAd
->
ALNAGa2
 == 0xFF) || (pAd->ALNAGain2 == 0x00))

1177 
pAd
->
ALNAGa2
 =Ad->
ALNAGa0
;

1180 i((
pAd
->
ARssiOfft0
 < -10) || (pAd->ARssiOffset0 > 10))

1181 
pAd
->
ARssiOfft0
 = 0;

1184 i((
pAd
->
ARssiOfft1
 < -10) || (pAd->ARssiOffset1 > 10))

1185 
pAd
->
ARssiOfft1
 = 0;

1188 i((
pAd
->
ARssiOfft2
 < -10) || (pAd->ARssiOffset2 > 10))

1189 
pAd
->
ARssiOfft2
 = 0;

1196 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_FREQ_OFFSET
, 
vue
);

1197 
pAd
->
LedCl
.
wd
 = (
vue
>>8);

1198 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_LED1_OFFSET
, 
vue
);

1199 
pAd
->
Led1
 = 
vue
;

1200 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_LED2_OFFSET
, 
vue
);

1201 
pAd
->
Led2
 = 
vue
;

1202 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_LED3_OFFSET
, 
vue
);

1203 
pAd
->
Led3
 = 
vue
;

1206 
	`RTMPRdTxPwrPRe
(
pAd
);

1208 #ifde
SINGLE_SKU


1210 
	`RT28xx_EEPROM_READ16
(
pAd
, 
EEPROM_DEFINE_MAX_TXPWR
,Ad->
CommCfg
.
DefeMaxTxPwr
);

1213 i((
pAd
->
CommCfg
.
DefeMaxTxPwr
 & 0xFF<0x50 &&Ad->CommCfg.
AGa
 > 0 &&Ad->CommCfg.
BdedgeD
 >= 0)

1215 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Single SKU Mode isnabled\n"));

1216 
pAd
->
CommCfg
.
bSKUMode
 = 
TRUE
;

1220 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Single SKU Mode is disabled\n"));

1221 
pAd
->
CommCfg
.
bSKUMode
 = 
FALSE
;

1227 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- NICReadEEPROMParameters\n"));

1228 
	}
}

1249 
VOID
 
	$NICInAsicFromEEPROM
(

1250 
IN
 
PRTMP_ADAPTER
 
pAd
)

1252 #ifde
CONFIG_STA_SUPPORT


1253 
UINT32
 
da
 = 0;

1254 
UCHAR
 
BBPR1
 = 0;

1256 
USHORT
 
i
;

1257 
EEPROM_NIC_CONFIG2_STRUC
 
NicCfig2
;

1258 
UCHAR
 
BBPR3
 = 0;

1260 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> NICInitAsicFromEEPROM\n"));

1261 
i
 = 
EEPROM_BBP_ARRAY_OFFSET
; i < 
NUM_EEPROM_BBP_PARMS
; i++)

1263 
UCHAR
 
BbpRegIdx
, 
BbpVue
;

1265 i((
pAd
->
EEPROMDeuVue
[
i
] != 0xFFFF) && (pAd->EEPROMDefaultValue[i] != 0))

1267 
BbpRegIdx
 = (
UCHAR
)(
pAd
->
EEPROMDeuVue
[
i
] >> 8);

1268 
BbpVue
 = (
UCHAR
)(
pAd
->
EEPROMDeuVue
[
i
] & 0xff);

1269 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BbpRegIdx
, 
BbpVue
);

1273 
NicCfig2
.
wd
 = 
pAd
->NicConfig2.word;

1276 #ifde
LED_CONTROL_SUPPORT


1280 i(
pAd
->
LedCl
.
wd
 == 0xFF)

1282 
pAd
->
LedCl
.
wd
 = 0x01;

1283 
pAd
->
Led1
 = 0x5555;

1284 
pAd
->
Led2
 = 0x2221;

1286 #ifde
RTMP_MAC_PCI


1287 
pAd
->
Led3
 = 0xA9F8;

1291 
	`AsicSdCommdToMcu
(
pAd
, 0x52, 0xff, (
UCHAR
Ad->
Led1
, (UCHAR)(pAd->Led1 >> 8));

1292 
	`AsicSdCommdToMcu
(
pAd
, 0x53, 0xff, (
UCHAR
Ad->
Led2
, (UCHAR)(pAd->Led2 >> 8));

1293 
	`AsicSdCommdToMcu
(
pAd
, 0x54, 0xff, (
UCHAR
Ad->
Led3
, (UCHAR)(pAd->Led3 >> 8));

1294 
	`AsicSdCommdToMcu
(
pAd
, 0x51, 0xff, 0,Ad->
LedCl
.
fld
.
Pެy
);

1296 
pAd
->
LedInditSgth
 = 0xFF;

1297 
	`RTMPSSiglLED
(
pAd
, -100);

1301 #ifde
CONFIG_STA_SUPPORT


1302 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1305 i(
NicCfig2
.
fld
.
HdweRadioCڌ
 == 1)

1307 
pAd
->
SCfg
.
bHdweRadio
 = 
TRUE
;

1310 
	`RTMP_IO_READ32
(
pAd
, 
GPIO_CTRL_CFG
, &
da
);

1311 i((
da
 & 0x04) == 0)

1313 
pAd
->
SCfg
.
bHwRadio
 = 
FALSE
;

1314 
pAd
->
SCfg
.
bRadio
 = 
FALSE
;

1316 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
);

1320 
pAd
->
SCfg
.
bHdweRadio
 = 
FALSE
;

1322 #ifde
LED_CONTROL_SUPPORT


1323 i(
pAd
->
SCfg
.
bRadio
 =
FALSE
)

1325 
	`RTMPSLED
(
pAd
, 
LED_RADIO_OFF
);

1329 
	`RTMPSLED
(
pAd
, 
LED_RADIO_ON
);

1333 #ifde
RTMP_MAC_PCI


1334 i(
pAd
->
SCfg
.
bRadio
 =
TRUE
)

1336 
	`AsicSdCommdToMcu
(
pAd
, 0x30, 
PowRadioOffCID
, 0xff, 0x02);

1337 
	`AsicCheckCommOk
(
pAd
, 
PowRadioOffCID
);

1340 
	`AsicSdCommdToMcu
(
pAd
, 0x31, 
PowWakeCID
, 0x00, 0x00);

1342 
	`AsicCheckCommOk
(
pAd
, 
PowWakeCID
);

1346 #ifde
PCIE_PS_SUPPORT


1350 i(
NicCfig2
.
fld
.
CdbusAc˿ti
 == 1)

1355 i(
NicCfig2
.
fld
.
DymicTxAgcCڌ
 == 1)

1356 
pAd
->
bAutoTxAgcA
 =Ad->
bAutoTxAgcG
 = 
TRUE
;

1358 
pAd
->
bAutoTxAgcA
 =Ad->
bAutoTxAgcG
 = 
FALSE
;

1360 #ifde
RTMP_INTERNAL_TX_ALC


1366 i(((
NicCfig2
.
fld
.
DymicTxAgcCڌ
 == 1) &&

1367 (
NicCfig2
.
fld
.
bIlTxALC
 =1)|| (!
	`IS_RT3390
(
pAd
)))

1369 
pAd
->
TxPowCl
.
bIlTxALC
 = 
FALSE
;

1373 i(
NicCfig2
.
fld
.
bIlTxALC
 == 1)

1375 
pAd
->
TxPowCl
.
bIlTxALC
 = 
TRUE
;

1379 
pAd
->
TxPowCl
.
bIlTxALC
 = 
FALSE
;

1383 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s:Ad->TxPowerCtrl.bInternalTxALC = %d\n",

1384 
__FUNCTION__
,

1385 
pAd
->
TxPowCl
.
bIlTxALC
));

1392 
pAd
->
CommCfg
.
BdS
 = 
UNKNOWN_BAND
;

1394 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
BBPR3
);

1395 
BBPR3
 &= (~0x18);

1396 if(
pAd
->
A
.
fld
.
RxPh
 == 3)

1398 
BBPR3
 |= (0x10);

1400 if(
pAd
->
A
.
fld
.
RxPh
 == 2)

1402 
BBPR3
 |= (0x8);

1404 if(
pAd
->
A
.
fld
.
RxPh
 == 1)

1406 
BBPR3
 |= (0x0);

1408 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
BBPR3
);

1410 #ifde
CONFIG_STA_SUPPORT


1411 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1414 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R1
, &
BBPR1
);

1417 if(
pAd
->
A
.
fld
.
TxPh
 == 1)

1419 
BBPR1
 &= (~0x18);

1423 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
BBPR1
);

1425 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Use Hw Radio Control Pin=%d; if used Pin=%d;\n",

1426 
pAd
->
CommCfg
.
bHdweRadio
,Ad->CommonCfg.bHardwareRadio));

1433 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("TxPath = %d, RxPath = %d, RFIC=%d, Polar+LED mode=%x\n",

1434 
pAd
->
A
.
fld
.
TxPh
,Ad->A.fld.
RxPh
,

1435 
pAd
->
RfIcTy
,Ad->
LedCl
.
wd
));

1436 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- NICInitAsicFromEEPROM\n"));

1437 
	}
}

1457 
NDIS_STATUS
 
	$NICInlizeAdr
(

1458 
IN
 
PRTMP_ADAPTER
 
pAd
,

1459 
IN
 
BOOLEAN
 
bHdRet
)

1461 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

1462 
WPDMA_GLO_CFG_STRUC
 
GloCfg
;

1463 #ifde
RTMP_MAC_PCI


1464 
UINT32
 
Vue
;

1465 
DELAY_INT_CFG_STRUC
 
ICfg
;

1468 
ULONG
 
i
 =0;

1469 
ULONG
 
j
=0;

1472 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> NICInitializeAdapter\n"));

1475 
y
:

1476 
i
 = 0;

1479 
	`RTMP_IO_READ32
(
pAd
, 
WPDMA_GLO_CFG
, &
GloCfg
.
wd
);

1480 i((
GloCfg
.
fld
.
TxDMABusy
 =0&& (GloCfg.fld.
RxDMABusy
 == 0))

1483 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

1484  
NDIS_STATUS_FAILURE
;

1485 
	`RTMPucDay
(1000);

1486 
i
++;

1487 } 
i
<100);

1488 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=DMA off0x208 = 0x%x\n", 
GloCfg
.
wd
));

1489 
GloCfg
.
wd
 &= 0xff0;

1490 
GloCfg
.
fld
.
EnTXWreBackDDONE
 =1;

1491 
	`RTMP_IO_WRITE32
(
pAd
, 
WPDMA_GLO_CFG
, 
GloCfg
.
wd
);

1495 
pAd
->
BcOfft
[0] = 
HW_BEACON_BASE0
;

1496 
pAd
->
BcOfft
[1] = 
HW_BEACON_BASE1
;

1497 
pAd
->
BcOfft
[2] = 
HW_BEACON_BASE2
;

1498 
pAd
->
BcOfft
[3] = 
HW_BEACON_BASE3
;

1499 
pAd
->
BcOfft
[4] = 
HW_BEACON_BASE4
;

1500 
pAd
->
BcOfft
[5] = 
HW_BEACON_BASE5
;

1501 
pAd
->
BcOfft
[6] = 
HW_BEACON_BASE6
;

1502 
pAd
->
BcOfft
[7] = 
HW_BEACON_BASE7
;

1505 #ifde
SPECIFIC_BCN_BUF_SUPPORT


1506 
pAd
->
BcOfft
[8] = 
HW_BEACON_BASE8
;

1507 
pAd
->
BcOfft
[9] = 
HW_BEACON_BASE9
;

1508 
pAd
->
BcOfft
[10] = 
HW_BEACON_BASE10
;

1509 
pAd
->
BcOfft
[11] = 
HW_BEACON_BASE11
;

1510 
pAd
->
BcOfft
[12] = 
HW_BEACON_BASE12
;

1511 
pAd
->
BcOfft
[13] = 
HW_BEACON_BASE13
;

1512 
pAd
->
BcOfft
[14] = 
HW_BEACON_BASE14
;

1513 
pAd
->
BcOfft
[15] = 
HW_BEACON_BASE15
;

1522 #ifde
RTMP_MAC_PCI


1523 
	`RTMP_IO_WRITE32
(
pAd
, 
WPDMA_RST_IDX
, 0x1003f);

1524 
	`RTMP_IO_WRITE32
(
pAd
, 
PBF_SYS_CTRL
, 0xe1f);

1525 
	`RTMP_IO_WRITE32
(
pAd
, 
PBF_SYS_CTRL
, 0xe00);

1529 i(
	`NICInlizeAsic
(
pAd
 , 
bHdRet
!
NDIS_STATUS_SUCCESS
)

1531 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

1532  
NDIS_STATUS_FAILURE
;

1533 i(
j
++ == 0)

1535 
	`NICLdFmwe
(
pAd
);

1536 
y
;

1538  
NDIS_STATUS_FAILURE
;

1542 #ifde
RTMP_MAC_PCI


1544 
Vue
 = 
	`RTMP_GPhysilAddssLow
(
pAd
->
TxRg
[
QID_AC_BK
].
Cl
[0].
AocPa
);

1545 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BASE_PTR1
, 
Vue
);

1546 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> TX_BASE_PTR1 : 0x%x\n", 
Vue
));

1549 
Vue
 = 
	`RTMP_GPhysilAddssLow
(
pAd
->
TxRg
[
QID_AC_BE
].
Cl
[0].
AocPa
);

1550 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BASE_PTR0
, 
Vue
);

1551 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> TX_BASE_PTR0 : 0x%x\n", 
Vue
));

1554 
Vue
 = 
	`RTMP_GPhysilAddssLow
(
pAd
->
TxRg
[
QID_AC_VI
].
Cl
[0].
AocPa
);

1555 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BASE_PTR2
, 
Vue
);

1556 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> TX_BASE_PTR2 : 0x%x\n", 
Vue
));

1559 
Vue
 = 
	`RTMP_GPhysilAddssLow
(
pAd
->
TxRg
[
QID_AC_VO
].
Cl
[0].
AocPa
);

1560 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BASE_PTR3
, 
Vue
);

1561 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> TX_BASE_PTR3 : 0x%x\n", 
Vue
));

1564 
Vue
 = 
	`RTMP_GPhysilAddssLow
(
pAd
->
TxRg
[
QID_HCCA
].
Cl
[0].
AocPa
);

1565 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BASE_PTR4
, 
Vue
);

1566 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> TX_BASE_PTR4 : 0x%x\n", 
Vue
));

1569 
Vue
 = 
	`RTMP_GPhysilAddssLow
(
pAd
->
MgmtRg
.
Cl
[0].
AocPa
);

1570 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BASE_PTR5
, 
Vue
);

1571 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> TX_BASE_PTR5 : 0x%x\n", 
Vue
));

1574 
Vue
 = 
	`RTMP_GPhysilAddssLow
(
pAd
->
RxRg
.
Cl
[0].
AocPa
);

1575 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_BASE_PTR
, 
Vue
);

1576 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> RX_BASE_PTR : 0x%x\n", 
Vue
));

1579 
pAd
->
RxRg
.
RxSwRdIdx
 = 0;

1580 
pAd
->
RxRg
.
RxCpuIdx
 = 
RX_RING_SIZE
-1;

1581 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_CRX_IDX
,Ad->
RxRg
.
RxCpuIdx
);

1585 
i
=0; i<
NUM_OF_TX_RING
; i++)

1587 
pAd
->
TxRg
[
i
].
TxSwFeIdx
 = 0;

1588 
pAd
->
TxRg
[
i
].
TxCpuIdx
 = 0;

1589 
	`RTMP_IO_WRITE32
(
pAd
, (
TX_CTX_IDX0
 + 
i
 * 0x10,Ad->
TxRg
[i].
TxCpuIdx
);

1594 
pAd
->
MgmtRg
.
TxSwFeIdx
 = 0;

1595 
pAd
->
MgmtRg
.
TxCpuIdx
 = 0;

1596 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_MGMTCTX_IDX
,Ad->
MgmtRg
.
TxCpuIdx
);

1603 
Vue
 = 
TX_RING_SIZE
;

1604 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_MAX_CNT0
, 
Vue
);

1605 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_MAX_CNT1
, 
Vue
);

1606 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_MAX_CNT2
, 
Vue
);

1607 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_MAX_CNT3
, 
Vue
);

1608 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_MAX_CNT4
, 
Vue
);

1609 
Vue
 = 
MGMT_RING_SIZE
;

1610 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_MGMTMAX_CNT
, 
Vue
);

1613 
Vue
 = 
RX_RING_SIZE
;

1614 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_MAX_CNT
, 
Vue
);

1619 #ifde
RTMP_MAC_PCI


1621 
i
 = 0;

1624 
	`RTMP_IO_READ32
(
pAd
, 
WPDMA_GLO_CFG
, &
GloCfg
.
wd
);

1625 i((
GloCfg
.
fld
.
TxDMABusy
 =0&& (GloCfg.fld.
RxDMABusy
 == 0))

1628 
	`RTMPucDay
(1000);

1629 
i
++;

1630 } 
i
 < 100);

1632 
GloCfg
.
wd
 &= 0xff0;

1633 
GloCfg
.
fld
.
EnTXWreBackDDONE
 =1;

1634 
	`RTMP_IO_WRITE32
(
pAd
, 
WPDMA_GLO_CFG
, 
GloCfg
.
wd
);

1636 
ICfg
.
wd
 = 0;

1637 
	`RTMP_IO_WRITE32
(
pAd
, 
DELAY_INT_CFG
, 
ICfg
.
wd
);

1645 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- NICInitializeAdapter\n"));

1646  
Stus
;

1647 
	}
}

1667 
NDIS_STATUS
 
	$NICInlizeAsic
(

1668 
IN
 
PRTMP_ADAPTER
 
pAd
,

1669 
IN
 
BOOLEAN
 
bHdRet
)

1671 
ULONG
 
Index
 = 0;

1672 
UCHAR
 
R0
 = 0xff;

1673 
UINT32
 
MacC12
 = 0, 
Cou
 = 0;

1674 #ifde
RTMP_PCI_SUPPORT


1675 
UINT32
 
Vue
;

1677 
USHORT
 
KeyIdx
;

1678 
INT
 
i
,
idx
;

1680 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> NICInitializeAsic\n"));

1682 #ifde
RTMP_MAC_PCI


1683 
	`RTMP_IO_WRITE32
(
pAd
, 
PWR_PIN_CFG
, 0x3);

1684 i(
bHdRet
 =
TRUE
)

1686 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 0x3);

1689 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 0x1);

1691 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 0x0);

1693 
Index
 = 0; Index < 
NUM_MAC_REG_PARMS
; Index++)

1695 
	`RTMP_IO_WRITE32
(
pAd
, 
MACRegTab
[
Index
].
Regi
, MACRegTab[Index].
Vue
);

1699 #ifde
CONFIG_STA_SUPPORT


1700 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1702 
Index
 = 0; Index < 
NUM_STA_MAC_REG_PARMS
; Index++)

1704 
	`RTMP_IO_WRITE32
(
pAd
, 
STAMACRegTab
[
Index
].
Regi
, STAMACRegTab[Index].
Vue
);

1710 #ifde
RTMP_PCI_SUPPORT


1711 
pAd
->
CommCfg
.
bPCIeBus
 = 
FALSE
;

1714 
	`RTMP_IO_READ32
(
pAd
, 
PCI_CFG
, &
Vue
);

1715 i((
Vue
 & 0x10000) == 0)

1717 
US_CYC_CNT_STRUC
 
USCycC
;

1718 
UINT32
 
Vue
;

1720 
	`RTMP_IO_READ32
(
pAd
, 
US_CYC_CNT
, &
Vue
);

1721 
USCycC
.
wd
 = 
Vue
;

1722 
USCycC
.
fld
.
UsCycC
 = 0x7D;

1723 
	`RTMP_IO_WRITE32
(
pAd
, 
US_CYC_CNT
, 
USCycC
.
wd
);

1725 
pAd
->
CommCfg
.
bPCIeBus
 = 
TRUE
;

1727 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("NICInitializeAsic::acts PCIe driver \n"));

1731 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("NICInitializeAsic::acts PCI driver \n"));

1734 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s:Ad->CommonCfg.bPCIeBus = %d\n",

1735 
__FUNCTION__
,

1736 
pAd
->
CommCfg
.
bPCIeBus
));

1743 
Index
 = 0;

1746 
	`RTMP_IO_READ32
(
pAd
, 
MAC_STATUS_CFG
, &
MacC12
);

1748 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

1749  
NDIS_STATUS_FAILURE
;

1751 i((
MacC12
 & 0x03) == 0)

1754 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Check MAC_STATUS_CFG = Busy = %x\n", 
MacC12
));

1755 
	`RTMPucDay
(1000);

1756 } 
Index
++ < 100);

1758 #ifde
RTMP_MAC_PCI


1761 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_BBP_AGENT
, 0);

1762 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_MAILBOX_CSR
, 0);

1763 
	`AsicSdCommdToMcu
(
pAd
, 0x72, 0, 0, 0);

1767 
	`RTMPucDay
(1000);

1768 
pAd
->
LaMCUCmd
 = 0x72;

1771 
Index
 = 0;

1774 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R0
, &
R0
);

1775 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

1776  
NDIS_STATUS_FAILURE
;

1777 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BBP vsi = %x\n", 
R0
));

1778 } (++
Index
 < 20&& ((
R0
 == 0xff) || (R0 == 0x00)));

1781 i((
R0
 == 0xff) || (R0 == 0x00))

1782  
NDIS_STATUS_FAILURE
;

1785 
Index
 = 0; Index < 
NUM_BBP_REG_PARMS
; Index++)

1787 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBPRegTab
[
Index
].
Regi
, BBPRegTab[Index].
Vue
);

1789 i(
pAd
->
chOps
.
pBBPRegTab
)

1791 
REG_PAIR
 *
pbbpRegTb
 = 
pAd
->
chOps
.
pBBPRegTab
;

1793 
Index
 = 0; Index < 
pAd
->
chOps
.
bbpRegTbSize
; Index++)

1795 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
pbbpRegTb
[
Index
].
Regi
,bbpRegTb[Index].
Vue
);

1796 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BBP_R%d=%d\n", 
pbbpRegTb
[
Index
].
Regi
,bbpRegTb[Index].
Vue
));

1800 #ifde
DFS_SUPPORT


1803 #ifde
RTMP_MAC_PCI


1805 i(
pAd
->
MACVsi
 == 0x28720200)

1808 
UINT32
 
vue2
;

1815 
	`RTMP_IO_READ32
(
pAd
, 
MAX_LEN_CFG
, &
vue2
);

1816 
vue2
 &= ~(0x3<<12);

1817 
vue2
 |= (0x2<<12);

1818 
	`RTMP_IO_WRITE32
(
pAd
, 
MAX_LEN_CFG
, 
vue2
);

1825 i(((
pAd
->
MACVsi
 & 0xffff) != 0x0101) &&

1826 !(
	`IS_RT30xx
(
pAd
)|| 
	`IS_RT3572
Ad|| 
	`IS_RT3593
(pAd)))

1827 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R84
, 0x19);

1830 i(
pAd
->
MACVsi
 == 0x28600100)

1832 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x16);

1833 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x12);

1836 i((
pAd
->
MACVsi
 =
RALINK_3883_VERSION
) ||

1837 ((
pAd
->
MACVsi
 >
RALINK_2880E_VERSION
) &&

1838 (
pAd
->
MACVsi
 < 
RALINK_3070_VERSION
)))

1841 
UINT32
 
c
;

1842 
	`RTMP_IO_READ32
(
pAd
, 
MAX_LEN_CFG
, &
c
);

1844 
c
 &= 0xFFF;

1845 
c
 |= 0x2000;

1847 
	`RTMP_IO_WRITE32
(
pAd
, 
MAX_LEN_CFG
, 
c
);

1851 #ifde
CONFIG_STA_SUPPORT


1853 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1855 i(
pAd
->
SCfg
.
bRadio
 =
FALSE
)

1858 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
);

1859 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set Radio Off\n"));

1865 
	`RTMP_IO_READ32
(
pAd
, 
RX_STA_CNT0
, &
Cou
);

1866 
	`RTMP_IO_READ32
(
pAd
, 
RX_STA_CNT1
, &
Cou
);

1867 
	`RTMP_IO_READ32
(
pAd
, 
RX_STA_CNT2
, &
Cou
);

1868 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT0
, &
Cou
);

1869 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT1
, &
Cou
);

1870 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT2
, &
Cou
);

1875 i(
bHdRet
)

1877 
KeyIdx
 = 0; KeyIdx < 4; KeyIdx++)

1879 
	`RTMP_IO_WRITE32
(
pAd
, 
SHARED_KEY_MODE_BASE
 + 4*
KeyIdx
, 0);

1883 
KeyIdx
 = 0; KeyIdx < 256; KeyIdx++)

1885 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_WCID_ATTRIBUTE_BASE
 + (
KeyIdx
 * 
HW_WCID_ATTRI_SIZE
), 1);

1894 i(
bHdRet
 =
TRUE
)

1896 #ifde
SPECIFIC_BCN_BUF_SUPPORT


1897 
qFg
;

1901 #ifde
SPECIFIC_BCN_BUF_SUPPORT


1905 
	`RTMP_MAC_SHR_MSEL_LOCK
(
pAd
, 
HIGHER_SHRMEM
, 
qFg
);

1908 
idx
 = 0;pidx < 
HW_BEACON_MAX_COUNT
;pidx++)

1910 
i
 = 0; i < 
HW_BEACON_OFFSET
>>2; i+=4)

1911 
	`RTMP_IO_WRITE32
(
pAd
,Ad->
BcOfft
[
idx
] + 
i
, 0x00);

1914 #ifde
SPECIFIC_BCN_BUF_SUPPORT


1918 
	`RTMP_MAC_SHR_MSEL_UNLOCK
(
pAd
, 
LOWER_SHRMEM
, 
qFg
);

1923 #ifde
CONFIG_STA_SUPPORT


1924 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1927 i((
pAd
->
MACVsi
&0xffff) != 0x0101)

1928 
	`RTMP_IO_WRITE32
(
pAd
, 
TXOP_CTRL_CFG
, 0x583f);

1932 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- NICInitializeAsic\n"));

1933  
NDIS_STATUS_SUCCESS
;

1934 
	}
}

1940 
VOID
 
	$NICUpdeFifoSCous
(

1941 
IN
 
PRTMP_ADAPTER
 
pAd
)

1943 
TX_STA_FIFO_STRUC
 
SFifo
;

1944 
MAC_TABLE_ENTRY
 *
pEry
;

1945 
UINT32
 
i
 = 0;

1946 
UCHAR
 
pid
 = 0, 
wcid
 = 0;

1947 
INT32
 
Try
;

1948 
UCHAR
 
succMCS
;

1950 #ifde
RALINK_ATE


1952 i(
	`ATE_ON
(
pAd
))

1958 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_FIFO
, &
SFifo
.
wd
);

1960 i(
SFifo
.
fld
.
bVid
 == 0)

1963 
wcid
 = (
UCHAR
)
SFifo
.
fld
.wcid;

1967 i((
SFifo
.
fld
.
TxAckRequed
 =0|| (
wcid
 >
MAX_LEN_OF_MAC_TABLE
))

1969 
i
++;

1974 
pid
 = (
UCHAR
)
SFifo
.
fld
.
PidTy
;

1976 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
wcid
];

1978 
pEry
->
DebugFIFOCou
++;

1980 #ifde
DOT11_N_SUPPORT


1983 #ifde
UAPSD_AP_SUPPORT


1984 
	`UAPSD_SP_AUE_Hd
(
pAd
, 
pEry
, 
SFifo
.
fld
.
TxSucss
);

1987 #ifde
CONFIG_STA_SUPPORT


1988 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

1992 i(!
SFifo
.
fld
.
TxSucss
)

1994 
pEry
->
FIFOCou
++;

1995 
pEry
->
OSecTxFaCou
++;

1997 i(
pEry
->
FIFOCou
 >= 1)

1999 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("#"));

2000 #ifde
DOT11_N_SUPPORT


2001 
pEry
->
NoBADaCouDown
 = 64;

2015 
pEry
->
CtueTxFaC
++;

2017 if(
pEry
->
PsMode
 =
PWR_ACTIVE
)

2019 #ifde
DOT11_N_SUPPORT


2020 
tid
;

2021 
tid
=0;id<
NUM_OF_TID
;id++)

2023 
	`BAOriSessiTrDown
(
pAd
, 
pEry
->
Aid
, 
tid
, 
FALSE
, FALSE);

2028 #ifde
WDS_SUPPORT


2030 if(
	`IS_ENTRY_WDS
(
pEry
)

2031 && (
pEry
->
LockEryTx
 =
FALSE
)

2032 && (
pEry
->
CtueTxFaC
 >
pAd
->
ApCfg
.
EryLiCheck
))

2034 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Entry %02x:%02x:%02x:%02x:%02x:%02x Blocked!! (Fail Cnt = %d)\n",

2035 
pEry
->
Addr
[0],pEntry->Addr[1],pEntry->Addr[2],pEntry->Addr[3],

2036 
pEry
->
Addr
[4],pEry->Addr[5],pEry->
CtueTxFaC
 ));

2038 
pEry
->
LockEryTx
 = 
TRUE
;

2049 #ifde
DOT11_N_SUPPORT


2050 i((
pEry
->
PsMode
 !
PWR_SAVE
&& (pEry->
NoBADaCouDown
 > 0))

2052 
pEry
->
NoBADaCouDown
--;

2053 i(
pEry
->
NoBADaCouDown
==0)

2055 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("@\n"));

2059 
pEry
->
FIFOCou
 = 0;

2060 
pEry
->
OSecTxNoRryOkCou
++;

2062 
pEry
->
NoDaIdCou
 = 0;

2063 
pEry
->
CtueTxFaC
 = 0;

2064 #ifde
WDS_SUPPORT


2065 
pEry
->
LockEryTx
 = 
FALSE
;

2069 
succMCS
 = 
SFifo
.
fld
.
SucssRe
 & 0x7F;

2073 
Try
 = 
pid
 - 
succMCS
;

2075 i(
SFifo
.
fld
.
TxSucss
)

2077 
pEry
->
TXMCSExed
[
pid
]++;

2078 i(
pid
 =
succMCS
)

2080 
pEry
->
TXMCSSucssful
[
pid
]++;

2084 
pEry
->
TXMCSAutoFlBack
[
pid
][
succMCS
]++;

2089 
pEry
->
TXMCSFaed
[
pid
]++;

2092 i(
Try
 > 0)

2094 i((
pid
 >12&& 
succMCS
 <=7)

2096 
Try
 -= 4;

2098 
pEry
->
OSecTxRryOkCou
 +
Try
;

2101 
i
++;

2103 }  
i
 < (
TX_RING_SIZE
<<1) );

2105 
	}
}

2124 
VOID
 
	$NICUpdeRawCous
(

2125 
IN
 
PRTMP_ADAPTER
 
pAd
)

2127 
UINT32
 
OldVue
;

2130 
RX_STA_CNT0_STRUC
 
RxSC0
;

2131 
RX_STA_CNT1_STRUC
 
RxSC1
;

2132 
RX_STA_CNT2_STRUC
 
RxSC2
;

2133 
TX_STA_CNT0_STRUC
 
TxSC0
;

2134 
TX_STA_CNT1_STRUC
 
STx1
;

2135 
TX_STA_CNT2_STRUC
 
STx2
;

2136 #ifde
STATS_COUNT_SUPPORT


2137 
TX_AGG_CNT_STRUC
 
TxAggC
;

2138 
TX_AGG_CNT0_STRUC
 
TxAggC0
;

2139 
TX_AGG_CNT1_STRUC
 
TxAggC1
;

2140 
TX_AGG_CNT2_STRUC
 
TxAggC2
;

2141 
TX_AGG_CNT3_STRUC
 
TxAggC3
;

2142 
TX_AGG_CNT4_STRUC
 
TxAggC4
;

2143 
TX_AGG_CNT5_STRUC
 
TxAggC5
;

2144 
TX_AGG_CNT6_STRUC
 
TxAggC6
;

2145 
TX_AGG_CNT7_STRUC
 
TxAggC7
;

2147 
COUNTER_RALINK
 *
pRkCous
;

2150 
pRkCous
 = &
pAd
->
RkCous
;

2152 
	`RTMP_IO_READ32
(
pAd
, 
RX_STA_CNT0
, &
RxSC0
.
wd
);

2153 
	`RTMP_IO_READ32
(
pAd
, 
RX_STA_CNT2
, &
RxSC2
.
wd
);

2156 
	`RTMP_IO_READ32
(
pAd
, 
RX_STA_CNT1
, &
RxSC1
.
wd
);

2158 
pAd
->
PriveInfo
.
PhyRxEC
 +
RxSC1
.
fld
.
PlE
;

2160 
pAd
->
RkCous
.
OSecFCCAC
 +
RxSC1
.
fld
.
FC
;

2163 #ifde
STATS_COUNT_SUPPORT


2165 
OldVue

pAd
->
WnCous
.
FCSECou
.
u
.
LowPt
;

2166 
pAd
->
WnCous
.
FCSECou
.
u
.
LowPt
 +(
RxSC0
.
fld
.
CrcE
);

2167 i(
pAd
->
WnCous
.
FCSECou
.
u
.
LowPt
 < 
OldVue
)

2168 
pAd
->
WnCous
.
FCSECou
.
u
.
HighPt
++;

2172 
pRkCous
->
OSecRxFcsEC
 +
RxSC0
.
fld
.
CrcE
;

2173 
OldVue
 = 
pRkCous
->
RlFcsECou
.
u
.
LowPt
;

2174 
pRkCous
->
RlFcsECou
.
u
.
LowPt
 +
RxSC0
.
fld
.
CrcE
;

2175 i(
pRkCous
->
RlFcsECou
.
u
.
LowPt
 < 
OldVue
)

2176 
pRkCous
->
RlFcsECou
.
u
.
HighPt
++;

2179 
pRkCous
->
DuiRcv
 +
RxSC2
.
fld
.
RxDuiCou
;

2180 #ifde
STATS_COUNT_SUPPORT


2181 
pAd
->
WnCous
.
FmeDuiCou
.
u
.
LowPt
 +
RxSC2
.
fld
.
RxDuiCou
;

2184 
pAd
->
Cous8023
.
RxNoBufr
 +(
RxSC2
.
fld
.
RxFifoOvowCou
);

2191 i(!
pAd
->
bUpdeBCDe
)

2194 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT0
, &
TxSC0
.
wd
);

2195 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT1
, &
STx1
.
wd
);

2196 
	`RTMP_IO_READ32
(
pAd
, 
TX_STA_CNT2
, &
STx2
.
wd
);

2197 
pRkCous
->
OSecBcStC
 +
TxSC0
.
fld
.
TxBcCou
;

2198 
pRkCous
->
OSecTxRryOkCou
 +
STx1
.
fld
.
TxRnsm
;

2199 
pRkCous
->
OSecTxNoRryOkCou
 +
STx1
.
fld
.
TxSucss
;

2200 
pRkCous
->
OSecTxFaCou
 +
TxSC0
.
fld
.
TxFaCou
;

2202 #ifde
STATS_COUNT_SUPPORT


2203 
pAd
->
WnCous
.
TnsmdFgmtCou
.
u
.
LowPt
 +
STx1
.
fld
.
TxSucss
;

2204 
pAd
->
WnCous
.
RryCou
.
u
.
LowPt
 +
STx1
.
fld
.
TxRnsm
;

2205 
pAd
->
WnCous
.
FaedCou
.
u
.
LowPt
 +
TxSC0
.
fld
.
TxFaCou
;

2211 #ifde
STATS_COUNT_SUPPORT


2213 
	`RTMP_IO_READ32
(
pAd
, 
TX_AGG_CNT
, &
TxAggC
.
wd
);

2214 
	`RTMP_IO_READ32
(
pAd
, 
TX_AGG_CNT0
, &
TxAggC0
.
wd
);

2215 
	`RTMP_IO_READ32
(
pAd
, 
TX_AGG_CNT1
, &
TxAggC1
.
wd
);

2216 
	`RTMP_IO_READ32
(
pAd
, 
TX_AGG_CNT2
, &
TxAggC2
.
wd
);

2217 
	`RTMP_IO_READ32
(
pAd
, 
TX_AGG_CNT3
, &
TxAggC3
.
wd
);

2218 
	`RTMP_IO_READ32
(
pAd
, 
TX_AGG_CNT4
, &
TxAggC4
.
wd
);

2219 
	`RTMP_IO_READ32
(
pAd
, 
TX_AGG_CNT5
, &
TxAggC5
.
wd
);

2220 
	`RTMP_IO_READ32
(
pAd
, 
TX_AGG_CNT6
, &
TxAggC6
.
wd
);

2221 
	`RTMP_IO_READ32
(
pAd
, 
TX_AGG_CNT7
, &
TxAggC7
.
wd
);

2222 
pRkCous
->
TxAggCou
 +
TxAggC
.
fld
.
AggTxCou
;

2223 
pRkCous
->
TxNAggCou
 +
TxAggC
.
fld
.
NAggTxCou
;

2224 
pRkCous
->
TxAgg1MPDUCou
 +
TxAggC0
.
fld
.
AggSize1Cou
;

2225 
pRkCous
->
TxAgg2MPDUCou
 +
TxAggC0
.
fld
.
AggSize2Cou
;

2227 
pRkCous
->
TxAgg3MPDUCou
 +
TxAggC1
.
fld
.
AggSize3Cou
;

2228 
pRkCous
->
TxAgg4MPDUCou
 +
TxAggC1
.
fld
.
AggSize4Cou
;

2229 
pRkCous
->
TxAgg5MPDUCou
 +
TxAggC2
.
fld
.
AggSize5Cou
;

2230 
pRkCous
->
TxAgg6MPDUCou
 +
TxAggC2
.
fld
.
AggSize6Cou
;

2232 
pRkCous
->
TxAgg7MPDUCou
 +
TxAggC3
.
fld
.
AggSize7Cou
;

2233 
pRkCous
->
TxAgg8MPDUCou
 +
TxAggC3
.
fld
.
AggSize8Cou
;

2234 
pRkCous
->
TxAgg9MPDUCou
 +
TxAggC4
.
fld
.
AggSize9Cou
;

2235 
pRkCous
->
TxAgg10MPDUCou
 +
TxAggC4
.
fld
.
AggSize10Cou
;

2237 
pRkCous
->
TxAgg11MPDUCou
 +
TxAggC5
.
fld
.
AggSize11Cou
;

2238 
pRkCous
->
TxAgg12MPDUCou
 +
TxAggC5
.
fld
.
AggSize12Cou
;

2239 
pRkCous
->
TxAgg13MPDUCou
 +
TxAggC6
.
fld
.
AggSize13Cou
;

2240 
pRkCous
->
TxAgg14MPDUCou
 +
TxAggC6
.
fld
.
AggSize14Cou
;

2242 
pRkCous
->
TxAgg15MPDUCou
 +
TxAggC7
.
fld
.
AggSize15Cou
;

2243 
pRkCous
->
TxAgg16MPDUCou
 +
TxAggC7
.
fld
.
AggSize16Cou
;

2246 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +
TxAggC0
.
fld
.
AggSize1Cou
;

2247 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC0
.
fld
.
AggSize2Cou
 >> 1);

2249 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC1
.
fld
.
AggSize3Cou
 / 3);

2250 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC1
.
fld
.
AggSize4Cou
 >> 2);

2252 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC2
.
fld
.
AggSize5Cou
 / 5);

2253 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC2
.
fld
.
AggSize6Cou
 / 6);

2255 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC3
.
fld
.
AggSize7Cou
 / 7);

2256 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC3
.
fld
.
AggSize8Cou
 >> 3);

2258 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC4
.
fld
.
AggSize9Cou
 / 9);

2259 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC4
.
fld
.
AggSize10Cou
 / 10);

2261 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC5
.
fld
.
AggSize11Cou
 / 11);

2262 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC5
.
fld
.
AggSize12Cou
 / 12);

2264 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC6
.
fld
.
AggSize13Cou
 / 13);

2265 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC6
.
fld
.
AggSize14Cou
 / 14);

2267 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC7
.
fld
.
AggSize15Cou
 / 15);

2268 
pRkCous
->
TnsmdAMPDUCou
.
u
.
LowPt
 +(
TxAggC7
.
fld
.
AggSize16Cou
 >> 4);

2272 #ifde
DBG_DIAGNOSE


2274 
RtmpDgSu
 *
pDg
;

2275 
UCHAR
 
AayCurIdx
, 
i
;

2277 
pDg
 = &
pAd
->
DgSu
;

2278 
AayCurIdx
 = 
pDg
->ArrayCurIdx;

2280 i(
pDg
->
ed
 == 0)

2282 
	`NdisZoMemy
(
pDg
, (
_RtmpDgScut_
));

2283 
pDg
->
AaySIdx
 =Dg->
AayCurIdx
 = 0;

2284 
pDg
->
ed
 = 1;

2289 
pDg
->
TxFaC
[
AayCurIdx
] = 
TxSC0
.
fld
.
TxFaCou
;

2290 
pDg
->
TxAggC
[
AayCurIdx
] = TxAggC.
fld
.
AggTxCou
;

2291 
pDg
->
TxNAggC
[
AayCurIdx
] = 
TxAggC
.
fld
.
NAggTxCou
;

2293 
pDg
->
TxAMPDUC
[
AayCurIdx
][0] = 
TxAggC0
.
fld
.
AggSize1Cou
;

2294 
pDg
->
TxAMPDUC
[
AayCurIdx
][1] = 
TxAggC0
.
fld
.
AggSize2Cou
;

2295 
pDg
->
TxAMPDUC
[
AayCurIdx
][2] = 
TxAggC1
.
fld
.
AggSize3Cou
;

2296 
pDg
->
TxAMPDUC
[
AayCurIdx
][3] = 
TxAggC1
.
fld
.
AggSize4Cou
;

2297 
pDg
->
TxAMPDUC
[
AayCurIdx
][4] = 
TxAggC2
.
fld
.
AggSize5Cou
;

2298 
pDg
->
TxAMPDUC
[
AayCurIdx
][5] = 
TxAggC2
.
fld
.
AggSize6Cou
;

2299 
pDg
->
TxAMPDUC
[
AayCurIdx
][6] = 
TxAggC3
.
fld
.
AggSize7Cou
;

2300 
pDg
->
TxAMPDUC
[
AayCurIdx
][7] = 
TxAggC3
.
fld
.
AggSize8Cou
;

2301 
pDg
->
TxAMPDUC
[
AayCurIdx
][8] = 
TxAggC4
.
fld
.
AggSize9Cou
;

2302 
pDg
->
TxAMPDUC
[
AayCurIdx
][9] = 
TxAggC4
.
fld
.
AggSize10Cou
;

2303 
pDg
->
TxAMPDUC
[
AayCurIdx
][10] = 
TxAggC5
.
fld
.
AggSize11Cou
;

2304 
pDg
->
TxAMPDUC
[
AayCurIdx
][11] = 
TxAggC5
.
fld
.
AggSize12Cou
;

2305 
pDg
->
TxAMPDUC
[
AayCurIdx
][12] = 
TxAggC6
.
fld
.
AggSize13Cou
;

2306 
pDg
->
TxAMPDUC
[
AayCurIdx
][13] = 
TxAggC6
.
fld
.
AggSize14Cou
;

2307 
pDg
->
TxAMPDUC
[
AayCurIdx
][14] = 
TxAggC7
.
fld
.
AggSize15Cou
;

2308 
pDg
->
TxAMPDUC
[
AayCurIdx
][15] = 
TxAggC7
.
fld
.
AggSize16Cou
;

2310 
pDg
->
RxCrcEC
[
AayCurIdx
] = 
RxSC0
.
fld
.
CrcE
;

2312 
	`INC_RING_INDEX
(
pDg
->
AayCurIdx
, 
DIAGNOSE_TIME
);

2313 
AayCurIdx
 = 
pDg
->ArrayCurIdx;

2314 
i
 =0; i < 9; i++)

2316 
pDg
->
TxDescC
[
AayCurIdx
][
i
]= 0;

2317 
pDg
->
TxSWQueC
[
AayCurIdx
][
i
] =0;

2318 
pDg
->
TxMcsC
[
AayCurIdx
][
i
] = 0;

2319 
pDg
->
RxMcsC
[
AayCurIdx
][
i
] = 0;

2321 
pDg
->
TxDaC
[
AayCurIdx
] = 0;

2322 
pDg
->
TxFaC
[
AayCurIdx
] = 0;

2323 
pDg
->
RxDaC
[
AayCurIdx
] = 0;

2324 
pDg
->
RxCrcEC
[
AayCurIdx
] = 0;

2326 
i
 = 9; i < 24; i++)

2328 
pDg
->
TxDescC
[
AayCurIdx
][
i
] = 0;

2329 
pDg
->
TxMcsC
[
AayCurIdx
][
i
] = 0;

2330 
pDg
->
RxMcsC
[
AayCurIdx
][
i
] = 0;

2333 i(
pDg
->
AayCurIdx
 =pDg->
AaySIdx
)

2334 
	`INC_RING_INDEX
(
pDg
->
AaySIdx
, 
DIAGNOSE_TIME
);

2341 
	}
}

2343 
NDIS_STATUS
 
	$NICLdFmwe
(

2344 
IN
 
PRTMP_ADAPTER
 
pAd
)

2364 
NDIS_STATUS
 
us
 = 
NDIS_STATUS_SUCCESS
;

2365 i(
pAd
->
chOps
.
ldFmwe
)

2366 
us
 = 
pAd
->
chOps
.
	`ldFmwe
(pAd);

2368  
us
;

2369 
	}
}

2385 
VOID
 
	$NICEFmwe
(

2386 
IN
 
PRTMP_ADAPTER
 
pAd
)

2388 i(
pAd
->
chOps
.
aFmwe
)

2389 
pAd
->
chOps
.
	`aFmwe
(pAd);

2391 
	}
}

2415 
NDIS_STATUS
 
	$NICLdReSwchgPams
(

2416 
IN
 
PRTMP_ADAPTER
 
pAd
)

2418  
NDIS_STATUS_SUCCESS
;

2419 
	}
}

2443 
ULONG
 
	$RTMPComMemy
(

2444 
IN
 
PVOID
 
pSrc1
,

2445 
IN
 
PVOID
 
pSrc2
,

2446 
IN
 
ULONG
 
Lgth
)

2448 
PUCHAR
 
pMem1
;

2449 
PUCHAR
 
pMem2
;

2450 
ULONG
 
Index
 = 0;

2452 
pMem1
 = (
PUCHAR

pSrc1
;

2453 
pMem2
 = (
PUCHAR

pSrc2
;

2455 
Index
 = 0; Index < 
Lgth
; Index++)

2457 i(
pMem1
[
Index
] > 
pMem2
[Index])

2459 i(
pMem1
[
Index
] < 
pMem2
[Index])

2465 
	}
}

2488 
VOID
 
	$RTMPZoMemy
(

2489 
IN
 
PVOID
 
pSrc
,

2490 
IN
 
ULONG
 
Lgth
)

2492 
PUCHAR
 
pMem
;

2493 
ULONG
 
Index
 = 0;

2495 
pMem
 = (
PUCHAR

pSrc
;

2497 
Index
 = 0; Index < 
Lgth
; Index++)

2499 
pMem
[
Index
] = 0x00;

2501 
	}
}

2525 
VOID
 
	$RTMPMoveMemy
(

2526 
OUT
 
PVOID
 
pDe
,

2527 
IN
 
PVOID
 
pSrc
,

2528 
IN
 
ULONG
 
Lgth
)

2530 
PUCHAR
 
pMem1
;

2531 
PUCHAR
 
pMem2
;

2532 
UINT
 
Index
;

2534 
	`ASSERT
((
Lgth
==0|| (
pDe
 && 
pSrc
));

2536 
pMem1
 = (
PUCHAR

pDe
;

2537 
pMem2
 = (
PUCHAR

pSrc
;

2539 
Index
 = 0; Index < 
Lgth
; Index++)

2541 
pMem1
[
Index
] = 
pMem2
[Index];

2543 
	}
}

2545 
VOID
 
	$UrCfgEx
(

2546 
IN
 
RTMP_ADAPTER
 *
pAd
)

2548 #ifde
DOT11_N_SUPPORT


2549 
	`BATabEx
(
pAd
);

2552 
	`NdisFeSpLock
(&
pAd
->
MacTabLock
);

2553 
	}
}

2573 
VOID
 
	$UrCfgIn
(

2574 
IN
 
PRTMP_ADAPTER
 
pAd
)

2576 
UINT
 
i
;

2578 
UINT
 
key_dex
, 
bss_dex
;

2581 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> UserCfgInit\n"));

2583 
pAd
->
IndiMedS
 = 
NdisMedSDisced
;

2588 
key_dex
=0; key_dex<
SHARE_KEY_NUM
; key_index++)

2590 
bss_dex
 = 0; bss_dex < 
MAX_MBSSID_NUM
; bss_index++)

2592 
pAd
->
ShedKey
[
bss_dex
][
key_dex
].
KeyL
 = 0;

2593 
pAd
->
ShedKey
[
bss_dex
][
key_dex
].
ChAlg
 = 
CIPHER_NONE
;

2597 
pAd
->
bLolAdmMAC
 = 
FALSE
;

2598 
pAd
->
EromAcss
 = 
FALSE
;

2600 
pAd
->
A
.
wd
 = 0;

2601 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_20
;

2603 
pAd
->
LedCl
.
wd
 = 0;

2604 #ifde
RTMP_MAC_PCI


2605 
pAd
->
LedInditSgth
 = 0;

2606 #ifde
CONFIG_STA_SUPPORT


2607 
pAd
->
RLnkClOfft
 = 0;

2608 
pAd
->
HoLnkClOfft
 = 0;

2612 
pAd
->
bAutoTxAgcA
 = 
FALSE
;

2613 
pAd
->
bAutoTxAgcG
 = 
FALSE
;

2614 #ifde
RTMP_INTERNAL_TX_ALC


2615 
pAd
->
TxPowCl
.
bIlTxALC
 = 
FALSE
;

2617 
pAd
->
RfIcTy
 = 
RFIC_2820
;

2620 
pAd
->
CommCfg
.
CChl
 = 1;

2621 
pAd
->
bFPrtTX
 = 
FALSE
;

2622 
pAd
->
bFPrtRX
 = 
FALSE
;

2623 
pAd
->
bSFifoTe
 = 
FALSE
;

2624 
pAd
->
bPreiTe
 = 
FALSE
;

2625 
pAd
->
bHCCATe
 = 
FALSE
;

2626 
pAd
->
bGOHCCA
 = 
FALSE
;

2627 
pAd
->
CommCfg
.
Dsifs
 = 10;

2628 
pAd
->
CommCfg
.
TxPow
 = 100;

2629 
pAd
->
CommCfg
.
TxPowPage
 = 0xffffffff;

2630 
pAd
->
CommCfg
.
TxPowDeu
 = 0xffffffff;

2631 
pAd
->
CommCfg
.
TxPamb
 = 
Rt802_11PambAuto
;

2632 
pAd
->
CommCfg
.
bUZoToDibFgmt
 = 
FALSE
;

2633 
pAd
->
CommCfg
.
RtsThshd
 = 2347;

2634 
pAd
->
CommCfg
.
FgmtThshd
 = 2346;

2635 
pAd
->
CommCfg
.
UBGPrei
 = 0;

2636 
pAd
->
CommCfg
.
bEbTxBur
 = 
TRUE
;

2637 
pAd
->
CommCfg
.
PhyMode
 = 0xff;

2638 
pAd
->
CommCfg
.
BdS
 = 
UNKNOWN_BAND
;

2639 
pAd
->
CommCfg
.
RadDe
.
CSPiod
 = 10;

2640 
pAd
->
CommCfg
.
RadDe
.
CSCou
 = 0;

2641 
pAd
->
CommCfg
.
RadDe
.
RDMode
 = 
RD_NORMAL_MODE
;

2642 
pAd
->
CommCfg
.
bDFSIndo
 = 1;

2644 #ifde
RT3052


2648 #ifde
CARRIER_DETECTION_SUPPORT


2649 
pAd
->
CommCfg
.
r_func
 = 
DISABLE_TONE_RADAR
;

2651 #ifde
TONE_RADAR_DETECT_SUPPORT


2653 #ifde
TONE_RADAR_DETECT_V1


2654 
pAd
->
CommCfg
.
r_func
 = 
TONE_RADAR_V1
;

2657 #ifde
TONE_RADAR_DETECT_V2


2658 
pAd
->
CommCfg
.
r_func
 = 
TONE_RADAR_V2
;

2661 
pAd
->
CommCfg
.
CrrDe
.
d
 = 
CARRIER_DETECT_DELTA
;

2662 
pAd
->
CommCfg
.
CrrDe
.
div_ag
 = 
CARRIER_DETECT_DIV_FLAG
;

2663 
pAd
->
CommCfg
.
CrrDe
.

 = 
CARRIER_DETECT_CRITIRIA
;

2664 
pAd
->
CommCfg
.
CrrDe
.
thshd
 = 
CARRIER_DETECT_THRESHOLD
;

2668 
pAd
->
CommCfg
.
RadDe
.
ChMovgTime
 = 65;

2669 
pAd
->
CommCfg
.
RadDe
.
LgPulRadTh
 = 3;

2670 
pAd
->
CommCfg
.
bAPSDCab
 = 
FALSE
;

2671 
pAd
->
CommCfg
.
bNdSdTriggFme
 = 
FALSE
;

2672 
pAd
->
CommCfg
.
TriggTimCou
 = 0;

2673 
pAd
->
CommCfg
.
bAPSDFPowSave
 = 
FALSE
;

2674 
pAd
->
CommCfg
.
bCouryFg
 = 
FALSE
;

2675 
pAd
->
CommCfg
.
TxSm
 = 0;

2676 
pAd
->
CommCfg
.
RxSm
 = 0;

2678 
	`NdisZoMemy
(&
pAd
->
BcTxWI
, (pAd->BeaconTxWI));

2680 #ifde
DOT11_N_SUPPORT


2681 
	`NdisZoMemy
(&
pAd
->
CommCfg
.
HtCaby
, (pAd->CommonCfg.HtCapability));

2682 
pAd
->
HTCEb
 = 
FALSE
;

2683 
pAd
->
bBrdComHT
 = 
FALSE
;

2684 
pAd
->
CommCfg
.
bRdg
 = 
FALSE
;

2686 #ifde
DOT11N_DRAFT3


2687 
pAd
->
CommCfg
.
D11OBssSnPassiveDwl
 = 
d11OBSSSnPassiveDwl
;

2688 
pAd
->
CommCfg
.
D11OBssSnAiveDwl
 = 
d11OBSSSnAiveDwl
;

2689 
pAd
->
CommCfg
.
D11BssWidthTriggSnI
 = 
d11BSSWidthTriggSnIv
;

2690 
pAd
->
CommCfg
.
D11OBssSnPassiveTٮPChl
 = 
d11OBSSSnPassiveTٮPChl
;

2691 
pAd
->
CommCfg
.
D11OBssSnAiveTٮPChl
 = 
d11OBSSSnAiveTٮPChl
;

2692 
pAd
->
CommCfg
.
D11BssWidthChTnDayFa
 = 
d11BSSWidthChlTniDayFa
;

2693 
pAd
->
CommCfg
.
D11OBssSnAivyTh
 = 
d11BSSSnAivyThshd
;

2694 
pAd
->
CommCfg
.
D11BssWidthChTnDay
 = (pAd->CommCfg.
D11BssWidthTriggSnI
 *Ad->CommCfg.
D11BssWidthChTnDayFa
);

2696 
pAd
->
CommCfg
.
bBssCxEb
 = 
TRUE
;

2697 
pAd
->
CommCfg
.
BssCxApCThr
 = 0;

2700 
	`NdisZoMemy
(&
pAd
->
CommCfg
.
AddHTInfo
, (pAd->CommonCfg.AddHTInfo));

2701 
pAd
->
CommCfg
.
BACaby
.
fld
.
MMPSmode
 = 
MMPS_ENABLE
;

2702 
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
 = 0;

2703 
pAd
->
CommCfg
.
BACaby
.
fld
.
Picy
 = 
IMMED_BA
;

2704 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
 = 64;

2705 
pAd
->
CommCfg
.
BACaby
.
fld
.
TxBAWLim
 = 64;

2706 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("--> UrCfgIn. BACaby = 0x%x\n", 
pAd
->
CommCfg
.
BACaby
.
wd
));

2708 
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 = 
FALSE
;

2709 
	`BATabIn
(
pAd
, &pAd->
BATab
);

2711 
pAd
->
CommCfg
.
bExtChlSwchAounmt
 = 1;

2712 
pAd
->
CommCfg
.
bHTPre
 = 1;

2713 
pAd
->
CommCfg
.
bMIMOPSEb
 = 
TRUE
;

2714 
pAd
->
CommCfg
.
bBADee
 = 
FALSE
;

2715 
pAd
->
CommCfg
.
bDibRedg
 = 
FALSE
;

2717 i(
pAd
->
MACVsi
 == 0x28720200)

2719 
pAd
->
CommCfg
.
TxBASize
 = 13;

2721 
pAd
->
CommCfg
.
TxBASize
 = 7;

2724 
pAd
->
CommCfg
.
REGBACaby
.
wd
 =Ad->CommCfg.
BACaby
.word;

2731 
pAd
->
CommCfg
.
TxRe
 = 
RATE_6
;

2733 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
 = 
MCS_RATE_6
;

2734 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
BW
 = 
BW_20
;

2735 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 
MODE_OFDM
;

2737 
pAd
->
CommCfg
.
BcPiod
 = 100;

2742 #ifde
MCAST_RATE_SPECIFIC


2743 
pAd
->
CommCfg
.
MCaPhyMode
.
wd


2744 
pAd
->
MacTab
.
Cڋ
[
MCAST_WCID
].
HTPhyMode
.
wd
;

2748 
pAd
->
CommCfg
.
HT_DiowTKIP
 = 
TRUE
;

2753 #ifde
CONFIG_STA_SUPPORT


2754 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2756 
	`RX_FILTER_SET_FLAG
(
pAd
, 
fRX_FILTER_ACCEPT_DIRECT
);

2757 
	`RX_FILTER_CLEAR_FLAG
(
pAd
, 
fRX_FILTER_ACCEPT_MULTICAST
);

2758 
	`RX_FILTER_SET_FLAG
(
pAd
, 
fRX_FILTER_ACCEPT_BROADCAST
);

2759 
	`RX_FILTER_SET_FLAG
(
pAd
, 
fRX_FILTER_ACCEPT_ALL_MULTICAST
);

2761 
pAd
->
SCfg
.
Psm
 = 
PWR_ACTIVE
;

2763 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11EnyiDibd
;

2764 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11EnyiDibd
;

2765 
pAd
->
SCfg
.
bMixCh
 = 
FALSE
;

2766 
pAd
->
SCfg
.
DeuKeyId
 = 0;

2769 
pAd
->
SCfg
.
PrivacyFr
 = 
Ndis802_11PrivFr8021xWEP
;

2770 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_NOT_SECURED
;

2771 
pAd
->
SCfg
.
LaMicETime
 = 0;

2772 
pAd
->
SCfg
.
MicEC
 = 0;

2773 
pAd
->
SCfg
.
bBlockAssoc
 = 
FALSE
;

2774 
pAd
->
SCfg
.
WS
 = 
SS_NOTUSE
;

2776 
pAd
->
CommCfg
.
NdisRadioSOff
 = 
FALSE
;

2778 
pAd
->
SCfg
.
RssiTrigg
 = 0;

2779 
	`NdisZoMemy
(&
pAd
->
SCfg
.
RssiSame
, (
RSSI_SAMPLE
));

2780 
pAd
->
SCfg
.
RssiTriggMode
 = 
RSSI_TRIGGERED_UPON_BELOW_THRESHOLD
;

2781 
pAd
->
SCfg
.
AtimW
 = 0;

2782 
pAd
->
SCfg
.
DeuLiCou
 = 3;

2783 
pAd
->
SCfg
.
BssTy
 = 
BSS_INFRA
;

2784 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
FALSE
;

2785 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_DOZE
);

2786 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_WAKEUP_NOW
);

2788 
pAd
->
SCfg
.
bAutoTxReSwch
 = 
TRUE
;

2789 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_AUTO
;

2790 
pAd
->
SCfg
.
bAutoCIfNoSSID
 = 
FALSE
;

2793 #ifde
EXT_BUILD_CHANNEL_LIST


2794 
pAd
->
SCfg
.
IEEE80211dClMode
 = 
Rt802_11_D_Ne
;

2797 #ifde
RTMP_MAC_PCI


2799 
pAd
->
b30xxBMcuCmd
 = 
FALSE
;

2800 
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
=
FALSE
;

2802 #ifde
PCIE_PS_SUPPORT


2803 
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
=
TRUE
;

2804 
pAd
->
b3090ESclCh
 = 
FALSE
;

2806 
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxPowMode
=3;

2807 
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxFASPMTe
=0;

2808 
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxFlowHoASPM
=1;

2814 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_RECEIVE_DTIM
);

2815 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_ADHOC_ON
);

2816 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_INFRA_ON
);

2819 
pAd
->
CommCfg
.
PhyMode
 = 
PHY_11BG_MIXED
;

2820 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_SHORT_PREAMBLE_INUSED
);

2822 #ifde
CONFIG_STA_SUPPORT


2823 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

2826 
pAd
->
SCfg
.
WdowsPowMode
 = 
Ndis802_11PowModeCAM
;

2827 
pAd
->
SCfg
.
WdowsBryPowMode
 = 
Ndis802_11PowModeCAM
;

2828 
pAd
->
SCfg
.
bWdowsACCAMEb
 = 
FALSE
;

2830 
pAd
->
SCfg
.
bHwRadio
 = 
TRUE
;

2831 
pAd
->
SCfg
.
bSwRadio
 = 
TRUE
;

2832 
pAd
->
SCfg
.
bRadio
 = 
TRUE
;

2833 
pAd
->
SCfg
.
bHdweRadio
 = 
FALSE
;

2834 
pAd
->
SCfg
.
bShowHiddSSID
 = 
FALSE
;

2837 
pAd
->
SCfg
.
bAutoRec
 = 
TRUE
;

2841 
	`NdisGSyemUpTime
(&
pAd
->
SCfg
.
LaSnTime
);

2842 i(
pAd
->
SCfg
.
LaSnTime
 > 10 * 
OS_HZ
)

2843 
pAd
->
SCfg
.
LaSnTime
 -(10 * 
OS_HZ
);

2845 
	`NdisZoMemy
(
pAd
->
nickme
, 
IW_ESSID_MAX_SIZE
+1);

2846 #ifde
WPA_SUPPLICANT_SUPPORT


2847 
pAd
->
SCfg
.
IEEE8021X
 = 
FALSE
;

2848 
pAd
->
SCfg
.
IEEE8021x_qued_keys
 = 
FALSE
;

2849 
pAd
->
SCfg
.
WSuliUP
 = 
WPA_SUPPLICANT_DISABLE
;

2850 
pAd
->
SCfg
.
bRSN_IE_FromWSuli
 = 
FALSE
;

2851 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


2852 
pAd
->
SCfg
.
WSuliUP
 = 
WPA_SUPPLICANT_ENABLE
;

2854 
pAd
->
SCfg
.
bLoAp
 = 
FALSE
;

2855 
pAd
->
SCfg
.
pWpsProbeReqIe
 = 
NULL
;

2856 
pAd
->
SCfg
.
WpsProbeReqIeL
 = 0;

2857 
pAd
->
SCfg
.
pWAssocIe
 = 
NULL
;

2858 
pAd
->
SCfg
.
WAssocIeL
 = 0;

2859 
pAd
->
SCfg
.
WSuliSnCou
 = 0;

2862 
	`NdisZoMemy
(
pAd
->
SCfg
.
RyCou
, 8);

2865 
pAd
->
SCfg
.
bAutoCByBssid
 = 
FALSE
;

2866 
pAd
->
SCfg
.
BcLoTime
 = 
BEACON_LOST_TIME
;

2867 
	`NdisZoMemy
(
pAd
->
SCfg
.
WPassPh
, 64);

2868 
pAd
->
SCfg
.
WPassPhL
 = 0;

2869 
pAd
->
SCfg
.
bAutoRmg
 = 
FALSE
;

2870 
pAd
->
SCfg
.
bFTxBur
 = 
FALSE
;

2871 
pAd
->
SCfg
.
bNFSn
 = 
FALSE
;

2872 
pAd
->
SCfg
.
bImovedSn
 = 
FALSE
;

2873 #ifde
DOT11_N_SUPPORT


2874 
pAd
->
SCfg
.
bAdhocN
 = 
TRUE
;

2876 
pAd
->
SCfg
.
bFaC
 = 
FALSE
;

2877 
pAd
->
SCfg
.
bAdhocC
 = 
FALSE
;

2882 
pAd
->
ExaInfo
 = 
EXTRA_INFO_CLEAR
;

2885 
pAd
->
bCfigChged
 = 
FALSE
;

2896 
pAd
->
BbpTung
.
bEb
 = 
TRUE
;

2897 
pAd
->
BbpTung
.
FCLowThshd
 = 100;

2898 
pAd
->
BbpTung
.
FCUThshd
 = 512;

2899 
pAd
->
BbpTung
.
R66D
 = 4;

2900 
pAd
->
Mlme
.
bEbAutoACheck
 = 
TRUE
;

2906 
pAd
->
BbpTung
.
R66CutVue
 = 0x38;

2908 
pAd
->
Bbp94
 = 
BBPR94_DEFAULT
;

2909 
pAd
->
BbpFCCK
 = 
FALSE
;

2915 
	`NdisZoMemy
(&
pAd
->
MacTab
, (
MAC_TABLE
));

2916 
	`InlizeQueueHd
(&
pAd
->
MacTab
.
MPsQueue
);

2917 
	`NdisAoSpLock
(&
pAd
->
MacTabLock
);

2922 #ifde
RALINK_ATE


2923 
	`NdisZoMemy
(&
pAd
->
e
, (
ATE_INFO
));

2924 
pAd
->
e
.
Mode
 = 
ATE_STOP
;

2925 
pAd
->
e
.
TxCou
 = 200;

2926 
pAd
->
e
.
TxDeCou
 = 0;

2927 
pAd
->
e
.
RFFqOfft
 = 0;

2928 
pAd
->
e
.
Payld
 = 0xA5;

2929 
pAd
->
e
.
IPG
 = 200;

2930 
pAd
->
e
.
TxLgth
 = 1024;

2931 
pAd
->
e
.
TxWI
.
ShtGI
 = 0;

2932 
pAd
->
e
.
TxWI
.
PHYMODE
 = 
MODE_CCK
;

2933 
pAd
->
e
.
TxWI
.
MCS
 = 3;

2934 
pAd
->
e
.
TxWI
.
BW
 = 
BW_20
;

2936 
pAd
->
e
.
Chl
 = 1;

2938 #ifde
RTMP_MAC_PCI


2940 
pAd
->
e
.
QID
 = 
QID_AC_BE
;

2942 
pAd
->
e
.
Addr1
[0] = 0x00;

2943 
pAd
->
e
.
Addr1
[1] = 0x11;

2944 
pAd
->
e
.
Addr1
[2] = 0x22;

2945 
pAd
->
e
.
Addr1
[3] = 0xAA;

2946 
pAd
->
e
.
Addr1
[4] = 0xBB;

2947 
pAd
->
e
.
Addr1
[5] = 0xCC;

2949 
	`NdisMoveMemy
(
pAd
->
e
.
Addr2
,Ad->e.
Addr1
, 
ETH_LENGTH_OF_ADDRESS
);

2950 
	`NdisMoveMemy
(
pAd
->
e
.
Addr3
,Ad->e.
Addr1
, 
ETH_LENGTH_OF_ADDRESS
);

2952 
pAd
->
e
.
bRxFER
 = 0;

2953 
pAd
->
e
.
bQATxS
 = 
FALSE
;

2954 
pAd
->
e
.
bQARxS
 = 
FALSE
;

2955 
pAd
->
e
.
bAutoTxAlc
 = 
FALSE
;

2956 #ifde
RTMP_MAC_PCI


2957 
pAd
->
e
.
bFWLdg
 = 
FALSE
;

2961 #ifde
RALINK_QA


2962 
pAd
->
e
.
TxStus
 = 0;

2963 
pAd
->
e
.
APid
 = 
THREAD_PID_INIT_VALUE
;

2968 
pAd
->
CommCfg
.
bWiFiTe
 = 
FALSE
;

2969 #ifde
RTMP_MAC_PCI


2970 
pAd
->
bPCIkOff
 = 
FALSE
;

2974 #ifde
CONFIG_STA_SUPPORT


2975 #ifde
PCIE_PS_SUPPORT


2976 
	`RTMP_SET_PSFLAG
(
pAd
, 
fRTMP_PS_CAN_GO_SLEEP
);

2980 #ifde
CONFIG_STA_SUPPORT


2981 
	`RTMP_SET_PSFLAG
(
pAd
, 
fRTMP_PS_CAN_GO_SLEEP
);

2984 #i
	`defed
(
AP_SCAN_SUPPORT
|| defed(
CONFIG_STA_SUPPORT
)

2985 
i
 = 0; i < 
MAX_LEN_OF_BSS_TABLE
; i++)

2987 
PBSS_ENTRY
 
pBssEry
 = &
pAd
->
SnTab
.
BssEry
[
i
];

2989 i(
pAd
->
ProbeReIE
[
i
].
pIe
)

2990 
pBssEry
->
pVIeFromProbR
 = 
pAd
->
ProbeReIE
[
i
].
pIe
;

2992 
pBssEry
->
pVIeFromProbR
 = 
NULL
;

2999 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<-- UserCfgInit\n"));

3000 
	}
}

3003 
UCHAR
 
	$BtoH
(
STRING
 
ch
)

3005 i(
ch
 >= '0' && ch <= '9')  (ch - '0');

3006 i(
ch
 >= 'A' && ch <= 'F')  (ch - 'A' + 0xA);

3007 i(
ch
 >= 'a' && ch <= 'f')  (ch - 'a' + 0xA);

3009 
	}
}

3028 
	$AtoH
(
PSTRING
 
c
, 
PUCHAR
 
de
, 
den
)

3030 
PSTRING
 

;

3031 
PUCHAR
 
deTemp
;

3033 

 = 
c
;

3034 
deTemp
 = (
PUCHAR

de
;

3036 
den
--)

3038 *
deTemp
 = 
	`BtoH
(*

++) << 4;

3039 *
deTemp
 +
	`BtoH
(*

++);

3040 
deTemp
++;

3042 
	}
}

3068 
VOID
 
	$RTMPInTim
(

3069 
IN
 
PRTMP_ADAPTER
 
pAd
,

3070 
IN
 
PRALINK_TIMER_STRUCT
 
pTim
,

3071 
IN
 
PVOID
 
pTimFunc
,

3072 
IN
 
PVOID
 
pDa
,

3073 
IN
 
BOOLEAN
 
Rt
)

3080 
pTim
->
Vid
 = 
TRUE
;

3082 
pTim
->
PiodicTy
 = 
Rt
;

3083 
pTim
->
S
 = 
FALSE
;

3084 
pTim
->
cook
 = (
ULONG

pDa
;

3085 
pTim
->
pAd
 =Ad;

3087 
	`RTMP_OS_In_Tim
(
pAd
, &
pTim
->
TimObj
, 
pTimFunc
, (
PVOID
)Timer);

3088 
	}
}

3109 
VOID
 
	$RTMPSTim
(

3110 
IN
 
PRALINK_TIMER_STRUCT
 
pTim
,

3111 
IN
 
ULONG
 
Vue
)

3113 i(
pTim
->
Vid
)

3115 
RTMP_ADAPTER
 *
pAd
;

3117 
pAd
 = (
RTMP_ADAPTER
 *)
pTim
->pAd;

3118 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

3120 
	`DBGPRINT_ERR
(("RTMPSetTimer failed, Halt in Progress!\n"));

3124 
pTim
->
TimVue
 = 
Vue
;

3125 
pTim
->
S
 = 
FALSE
;

3126 i(
pTim
->
PiodicTy
 =
TRUE
)

3128 
pTim
->
Rt
 = 
TRUE
;

3129 
	`RTMP_SPiodicTim
(&
pTim
->
TimObj
, 
Vue
);

3133 
pTim
->
Rt
 = 
FALSE
;

3134 
	`RTMP_OS_Add_Tim
(&
pTim
->
TimObj
, 
Vue
);

3139 
	`DBGPRINT_ERR
(("RTMPSetTimer failed, Timer hasn't been initialize!\n"));

3141 
	}
}

3162 
VOID
 
	$RTMPModTim
(

3163 
IN
 
PRALINK_TIMER_STRUCT
 
pTim
,

3164 
IN
 
ULONG
 
Vue
)

3166 
BOOLEAN
 
Cl
;

3168 i(
pTim
->
Vid
)

3170 
pTim
->
TimVue
 = 
Vue
;

3171 
pTim
->
S
 = 
FALSE
;

3172 i(
pTim
->
PiodicTy
 =
TRUE
)

3174 
	`RTMPClTim
(
pTim
, &
Cl
);

3175 
	`RTMPSTim
(
pTim
, 
Vue
);

3179 
	`RTMP_OS_Mod_Tim
(&
pTim
->
TimObj
, 
Vue
);

3184 
	`DBGPRINT_ERR
(("RTMPModTimer failed, Timer hasn't been initialize!\n"));

3186 
	}
}

3210 
VOID
 
	$RTMPClTim
(

3211 
IN
 
PRALINK_TIMER_STRUCT
 
pTim
,

3212 
OUT
 
BOOLEAN
 *
pCed
)

3214 i(
pTim
->
Vid
)

3216 i(
pTim
->
S
 =
FALSE
)

3217 
pTim
->
Rt
 = 
FALSE
;

3219 
	`RTMP_OS_D_Tim
(&
pTim
->
TimObj
, 
pCed
);

3221 i(*
pCed
 =
TRUE
)

3222 
pTim
->
S
 = 
TRUE
;

3224 #ifde
RTMP_TIMER_TASK_SUPPORT


3227 
	`RtmpTimQRemove
(
pTim
->
pAd
,Timer);

3232 
	`DBGPRINT_ERR
(("RTMPCancelTimer failed, Timer hasn't been initialize!\n"));

3234 
	}
}

3236 #ifde
LED_CONTROL_SUPPORT


3257 
VOID
 
	$RTMPSLED
(

3258 
IN
 
PRTMP_ADAPTER
 
pAd
,

3259 
IN
 
UCHAR
 
Stus
)

3262 
UCHAR
 
HighBy
 = 0;

3263 
UCHAR
 
LowBy
;

3264 
BOOLEAN
 
bIgned
 = 
FALSE
;

3265 
BOOLEAN
 
FlgCmdSd
 = 
FALSE
;

3267 #ifde
RALINK_ATE


3272 i(!
	`IS_RT3572
(
pAd
))

3274 i(
	`ATE_ON
(
pAd
))

3280 
LowBy
 = 
pAd
->
LedCl
.
fld
.
LedMode
&0x7f;

3281 
Stus
)

3283 
LED_LINK_DOWN
:

3284 
HighBy
 = 0x20;

3285 
pAd
->
LedInditSgth
 = 0;

3286 
FlgCmdSd
 = 
TRUE
;

3288 
LED_LINK_UP
:

3289 i(
pAd
->
CommCfg
.
Chl
 > 14)

3290 
HighBy
 = 0xa0;

3292 
HighBy
 = 0x60;

3293 
FlgCmdSd
 = 
TRUE
;

3295 
LED_RADIO_ON
:

3296 
HighBy
 = 0x20;

3297 
FlgCmdSd
 = 
TRUE
;

3299 
LED_HALT
:

3300 
LowBy
 = 0;

3301 
LED_RADIO_OFF
:

3302 
HighBy
 = 0;

3303 
FlgCmdSd
 = 
TRUE
;

3305 
LED_WPS
:

3306 
HighBy
 = 0x10;

3307 
FlgCmdSd
 = 
TRUE
;

3309 
LED_ON_SITE_SURVEY
:

3310 
HighBy
 = 0x08;

3311 
FlgCmdSd
 = 
TRUE
;

3313 
LED_POWER_UP
:

3314 
HighBy
 = 0x04;

3315 
FlgCmdSd
 = 
TRUE
;

3317 #ifde
RALINK_ATE


3320 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("RTMPSLED::UnknowStu%d\n", 
Stus
));

3324 i(
FlgCmdSd
 =
TRUE
)

3327 
	`AsicSdCommdToMcu
(
pAd
, 0x50, 0xff, 
LowBy
, 
HighBy
);

3334 i((
Stus
 !
LED_ON_SITE_SURVEY
&& (Stu!
LED_POWER_UP
&& (
bIgned
 =
FALSE
))

3335 
pAd
->
LedStus
 = 
Stus
;

3337 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPSLED::Mode=%d,HighBy=0x%02x,LowBy=0x%02x\n", 
pAd
->
LedCl
.
fld
.
LedMode
, 
HighBy
, 
LowBy
));

3338 
	}
}

3367 
VOID
 
	$RTMPSSiglLED
(

3368 
IN
 
PRTMP_ADAPTER
 
pAd
,

3369 
IN
 
NDIS_802_11_RSSI
 
Dbm
)

3371 
UCHAR
 
nLed
 = 0;

3373 i(
pAd
->
LedCl
.
fld
.
LedMode
 =
LED_MODE_SIGNAL_STREGTH
)

3375 i(
Dbm
 <= -90)

3376 
nLed
 = 0;

3377 i(
Dbm
 <= -81)

3378 
nLed
 = 1;

3379 i(
Dbm
 <= -71)

3380 
nLed
 = 3;

3381 i(
Dbm
 <= -67)

3382 
nLed
 = 7;

3383 i(
Dbm
 <= -57)

3384 
nLed
 = 15;

3386 
nLed
 = 31;

3391 i(
pAd
->
LedInditSgth
 !
nLed
)

3393 
	`AsicSdCommdToMcu
(
pAd
, 0x51, 0xff, 
nLed
,Ad->
LedCl
.
fld
.
Pެy
);

3394 
pAd
->
LedInditSgth
 = 
nLed
;

3397 
	}
}

3419 
VOID
 
	$RTMPEbRxTx
(

3420 
IN
 
PRTMP_ADAPTER
 
pAd
)

3424 
UINT32
 
rx_fr_ag
;

3426 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==> RTMPEnableRxTx\n"));

3429 
	`RT28XXDMAEb
(
pAd
);

3432 i(
pAd
->
OpMode
 =
OPMODE_AP
)

3434 
rx_fr_ag
 = 
APNORMAL
;

3437 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 
rx_fr_ag
);

3439 #ifde
CONFIG_STA_SUPPORT


3442 #ifde
XLINK_SUPPORT


3443 i(
pAd
->
SCfg
.
PSPXlk
)

3444 
rx_fr_ag
 = 
PSPXLINK
;

3447 
rx_fr_ag
 = 
STANORMAL
;

3448 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 
rx_fr_ag
);

3453 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 0xc);

3455 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<== RTMPEnableRxTx\n"));

3456 
	}
}

3460 
	$CfgInHook
(
PRTMP_ADAPTER
 
pAd
)

3463 
	}
}

3468 
INT
 
	$RtmpChOpsRegi
(

3469 
IN
 
RTMP_ADAPTER
 *
pAd
,

3470 
IN
 
INT
 
fTy
)

3472 
RTMP_CHIP_OP
 *
pChOps
 = &
pAd
->
chOps
;

3473 
us
;

3475 
	`memt
(
pChOps
, 0, (
RTMP_CHIP_OP
));

3478 
us
 = 
	`RtmpChOpsEromHook
(
pAd
, 
fTy
);

3481 
fTy
)

3483 #ifde
RTMP_PCI_SUPPORT


3484 
RTMP_DEV_INF_PCI
:

3485 
RTMP_DEV_INF_PCIE
:

3486 
pChOps
->
ldFmwe
 = 
RtmpAsicLdFmwe
;

3487 
pChOps
->
aFmwe
 = 
RtmpAsicEFmwe
;

3488 
pChOps
->
ndCommdToMcu
 = 
RtmpAsicSdCommdToMcu
;

3497  
us
;

3498 
	}
}

3501 
INT
 
	$RtmpRaDevClIn
(

3502 
IN
 
RTMP_ADAPTER
 *
pAd
,

3503 
IN
 
RTMP_INF_TYPE
 
fTy
)

3508 
pAd
->
fTy
 = infType;

3511 #ifde
CONFIG_STA_SUPPORT


3512 
pAd
->
OpMode
 = 
OPMODE_STA
;

3513 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("STA Driv vsi-%s\n", 
STA_DRIVER_VERSION
));

3518 
	`RtmpChOpsRegi
(
pAd
, 
fTy
);

3520 #ifde
MULTIPLE_CARD_SUPPORT


3522 
BOOLEAN
 
	`RTMP_CdInfoRd
(
PRTMP_ADAPTER
 
pAd
);

3525 
pAd
->
MC_RowID
 = -1;

3526 
	`RTMP_CdInfoRd
(
pAd
);

3528 i(
pAd
->
MC_RowID
 == -1)

3529 #ifde
CONFIG_STA_SUPPORT


3530 
	`ry
(
pAd
->
MC_FeName
, 
STA_PROFILE_PATH
);

3533 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MC> ROW = %d, PATH = %s\n", 
pAd
->
MC_RowID
,Ad->
MC_FeName
));

3538 
	}
}

3541 
BOOLEAN
 
	$RtmpRaDevClEx
(
IN
 
RTMP_ADAPTER
 *
pAd
)

3543 
INT
 
dex
;

3545 #ifde
MULTIPLE_CARD_SUPPORT


3546 
UINT8
 
MC_CdUd
[
MAX_NUM_OF_MULTIPLE_CARD
];

3548 i((
pAd
->
MC_RowID
 >0&& (pAd->MC_RowID <
MAX_NUM_OF_MULTIPLE_CARD
))

3549 
MC_CdUd
[
pAd
->
MC_RowID
] = 0;

3556 
dex
 = 0; index < 
MAX_LEN_OF_BSS_TABLE
; index++)

3558 i(
pAd
->
ProbeReIE
[
dex
].
pIe
)

3559 
	`os__mem
(
pAd
,Ad->
ProbeReIE
[
dex
].
pIe
);

3562 #ifde
RESOURCE_PRE_ALLOC


3563 
	`RTMPFeTxRxRgMemy
(
pAd
);

3567 
	`RTMPFeAdr
(
pAd
);

3569  
TRUE
;

3570 
	}
}

3577 #ifde
VENDOR_FEATURE3_SUPPORT


3578 
VOID
 
	$RTMP_IO_WRITE32
(

3579 
PRTMP_ADAPTER
 
pAd
,

3580 
UINT32
 
Offt
,

3581 
UINT32
 
Vue
)

3583 
	`_RTMP_IO_WRITE32
(
pAd
, 
Offt
, 
Vue
);

3584 
	}
}

3586 
VOID
 
	$RTMP_BBP_IO_READ8_BY_REG_ID
(

3587 
PRTMP_ADAPTER
 
pAd
,

3588 
UINT32
 
Offt
,

3589 
UINT8
 *
pVue
)

3591 
	`_RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
Offt
, 
pVue
);

3592 
	}
}

3594 
VOID
 
	$RTMP_BBP_IO_READ8
(

3595 
PRTMP_ADAPTER
 
pAd
,

3596 
UCHAR
 
Offt
,

3597 
UINT8
 *
pVue
,

3598 
BOOLEAN
 
FlgVidMCR
)

3600 
	`_RTMP_BBP_IO_READ8
(
pAd
, 
Offt
, 
pVue
, 
FlgVidMCR
);

3601 
	}
}

3603 
VOID
 
	$RTMP_BBP_IO_WRITE8_BY_REG_ID
(

3604 
PRTMP_ADAPTER
 
pAd
,

3605 
UINT32
 
Offt
,

3606 
UINT8
 
Vue
)

3608 
	`_RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
Offt
, 
Vue
);

3609 
	}
}

3611 
VOID
 
	$RTMP_BBP_IO_WRITE8
(

3612 
PRTMP_ADAPTER
 
pAd
,

3613 
UCHAR
 
Offt
,

3614 
UINT8
 
Vue
,

3615 
BOOLEAN
 
FlgVidMCR
)

3617 
	`_RTMP_BBP_IO_WRITE8
(
pAd
, 
Offt
, 
Vue
, 
FlgVidMCR
);

3618 
	}
}

3622 #ifde
RTMP_MAC_PCI


3623 
VOID
 
	$CMDHdr
(

3624 
IN
 
PRTMP_ADAPTER
 
pAd
)

3626 
PCmdQElmt
 
cmdqmt
;

3627 
PUCHAR
 
pDa
;

3628 
NDIS_STATUS
 
NdisStus
 = 
NDIS_STATUS_SUCCESS
;

3633 
pAd
 &&Ad->
CmdQ
.
size
 > 0)

3635 
NdisStus
 = 
NDIS_STATUS_SUCCESS
;

3637 
	`NdisAcqueSpLock
(&
pAd
->
CmdQLock
);

3638 
	`RTThadDequeueCmd
(&
pAd
->
CmdQ
, &
cmdqmt
);

3639 
	`NdisRSpLock
(&
pAd
->
CmdQLock
);

3641 i(
cmdqmt
 =
NULL
)

3644 
pDa
 = 
cmdqmt
->
bufr
;

3646 if(!(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
|| RTMP_TEST_FLAGAd, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
)))

3648 
cmdqmt
->
commd
)

3651 
CMDTHREAD_REG_HINT
:

3652 #ifde
LINUX


3653 #ifde
RT_CFG80211_SUPPORT


3654 
	`RT_CFG80211_CRDA_REG_HINT
(
pAd
, 
pDa
, 
cmdqmt
->
buf㾒gth
);

3659 
CMDTHREAD_REG_HINT_11D
:

3660 #ifde
LINUX


3661 #ifde
RT_CFG80211_SUPPORT


3662 
	`RT_CFG80211_CRDA_REG_HINT11D
(
pAd
, 
pDa
, 
cmdqmt
->
buf㾒gth
);

3667 
CMDTHREAD_SCAN_END
:

3668 #ifde
LINUX


3669 #ifde
RT_CFG80211_SUPPORT


3670 
	`RT_CFG80211_SCAN_END
(
pAd
, 
FALSE
);

3675 
CMDTHREAD_CONNECT_RESULT_INFORM
:

3676 #ifde
LINUX


3677 #ifde
RT_CFG80211_SUPPORT


3678 
	`RT_CFG80211_CONN_RESULT_INFORM
(
pAd
,

3679 
pAd
->
MlmeAux
.
Bssid
,

3680 
pDa
, 
cmdqmt
->
buf㾒gth
,

3681 
pDa
, 
cmdqmt
->
buf㾒gth
,

3688 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("--> Cڌ Thad !! ERROR !! Unknown(cmdqmt->commd=0x%x!! \n", 
cmdqmt
->
commd
));

3693 i(
cmdqmt
->
CmdFromNdis
 =
TRUE
)

3695 i(
cmdqmt
->
bufr
 !
NULL
)

3696 
	`os__mem
(
pAd
, 
cmdqmt
->
bufr
);

3697 
	`os__mem
(
pAd
, 
cmdqmt
);

3701 i((
cmdqmt
->
bufr
 !
NULL
&& (cmdqmt->
buf㾒gth
 != 0))

3702 
	`os__mem
(
pAd
, 
cmdqmt
->
bufr
);

3703 
	`os__mem
(
pAd
, 
cmdqmt
);

3706 
	}
}

3712 #ifde
OS_ABL_SUPPORT


3714 
EXPORT_SYMBOL
(
NICInlizeAdr
);

3715 
EXPORT_SYMBOL
(
NICInAsicFromEEPROM
);

3716 
EXPORT_SYMBOL
(
NICRdEEPROMPams
);

3717 
EXPORT_SYMBOL
(
UrCfgEx
);

3718 
EXPORT_SYMBOL
(
UrCfgIn
);

3719 
EXPORT_SYMBOL
(
CfgInHook
);

3720 
EXPORT_SYMBOL
(
RTMPEbRxTx
);

3721 
EXPORT_SYMBOL
(
RTMPSPhyMode
);

3722 
EXPORT_SYMBOL
(
RTMPMaxRssi
);

3723 
EXPORT_SYMBOL
(
RTMPMS
);

3724 
EXPORT_SYMBOL
(
RTMPAocAdrBlock
);

3725 
EXPORT_SYMBOL
(
RTMPAocTxRxRgMemy
);

3726 
EXPORT_SYMBOL
(
RTMPFeTxRxRgMemy
);

3727 
EXPORT_SYMBOL
(
NICLdReSwchgPams
);

3728 
EXPORT_SYMBOL
(
RtmpRaDevClIn
);

3729 
EXPORT_SYMBOL
(
RtmpRaDevClEx
);

3730 
EXPORT_SYMBOL
(
NICLdFmwe
);

3731 
EXPORT_SYMBOL
(
RTMPSProfePams
);

3732 
EXPORT_SYMBOL
(
RT28XXDMADib
);

3734 #ifde
DOT11_N_SUPPORT


3735 
EXPORT_SYMBOL
(
SCommHT
);

3736 
EXPORT_SYMBOL
(
N_ChlCheck
);

3739 
EXPORT_SYMBOL
(
AsicSwchChl
);

3740 
EXPORT_SYMBOL
(
AsicLockChl
);

3742 
EXPORT_SYMBOL
(
ba_dg_sour_
);

3743 
EXPORT_SYMBOL
(
ba_dg_sour_a
);

3745 
EXPORT_SYMBOL
(
RTMPDeQueuePack
);

3747 
EXPORT_SYMBOL
(
CMDHdr
);

3748 
EXPORT_SYMBOL
(
RTEnqueueIlCmd
);

3749 
EXPORT_SYMBOL
(
RTThadDequeueCmd
);

3751 
EXPORT_SYMBOL
(
TpcReqTabIn
);

3752 
EXPORT_SYMBOL
(
TpcReqTabEx
);

3753 
EXPORT_SYMBOL
(
MsuReqTabIn
);

3754 
EXPORT_SYMBOL
(
MsuReqTabEx
);

3756 
EXPORT_SYMBOL
(
MlmeIn
);

3757 
EXPORT_SYMBOL
(
MlmeHdr
);

3758 
EXPORT_SYMBOL
(
MlmeHt
);

3759 
EXPORT_SYMBOL
(
MlmeEnqueue
);

3761 
EXPORT_SYMBOL
(
RTMPClTim
);

3762 
EXPORT_SYMBOL
(
AsicSdCommdToMcu
);

3763 
EXPORT_SYMBOL
(
MacTabLookup
);

3764 
EXPORT_SYMBOL
(
RTMPZoMemy
);

3765 
EXPORT_SYMBOL
(
RTMPSoEnyWEP
);

3766 
EXPORT_SYMBOL
(
gRe
);

3769 
EXPORT_SYMBOL
(
RTMPIolGSeSurvey
);

3774 #ifde
CONFIG_STA_SUPPORT


3775 
EXPORT_SYMBOL
(
STASdPacks
);

3777 
EXPORT_SYMBOL
(
LkUp
);

3778 
EXPORT_SYMBOL
(
LkDown
);

3779 
EXPORT_SYMBOL
(
MlmeRadioOn
);

3780 
EXPORT_SYMBOL
(
MlmeRadioOff
);

3782 #ifde
DOT11_N_SUPPORT


3783 
EXPORT_SYMBOL
(
BAOriSessiSUp
);

3784 
EXPORT_SYMBOL
(
BAOriSessiTrDown
);

3785 
EXPORT_SYMBOL
(
BARecSessiTrDown
);

3786 
EXPORT_SYMBOL
(
RTMPSHT
);

3788 
EXPORT_SYMBOL
(
MlmeDuthReqAi
);

3789 
EXPORT_SYMBOL
(
MlmeDissocReqAi
);

3791 
EXPORT_SYMBOL
(
GPhyMode
);

3792 
EXPORT_SYMBOL
(
ChlSy
);

3794 
EXPORT_SYMBOL
(
rchr
);

3795 
EXPORT_SYMBOL
(
S_SSID_Proc
);

3796 
EXPORT_SYMBOL
(
Show_DescInfo_Proc
);

3797 
EXPORT_SYMBOL
(
Show_Adhoc_MacTab_Proc
);

3798 
EXPORT_SYMBOL
(
RTMPShowCfgVue
);

3799 
EXPORT_SYMBOL
(
MlmeSTxPamb
);

3800 
EXPORT_SYMBOL
(
RTMPSDesedRes
);

3801 
EXPORT_SYMBOL
(
S_PSMode_Proc
);

3802 
EXPORT_SYMBOL
(
S_NwkTy_Proc
);

3803 
EXPORT_SYMBOL
(
S_Chl_Proc
);

3805 
EXPORT_SYMBOL
(
AsicAddShedKeyEry
);

3806 
EXPORT_SYMBOL
(
AsicRemoveShedKeyEry
);

3807 
EXPORT_SYMBOL
(
RTMPAddKey
);

3808 
EXPORT_SYMBOL
(
RTMPSWcidSecuryInfo
);

3809 
EXPORT_SYMBOL
(
AsicRemovePawiKeyEry
);

3810 
EXPORT_SYMBOL
(
RTMPWPARemoveKeyProc
);

3812 
EXPORT_SYMBOL
(
MlmeUpdeTxRes
);

3813 
EXPORT_SYMBOL
(
MlmeSPsmB
);

3815 
EXPORT_SYMBOL
(
MakeIbssBc
);

3816 
EXPORT_SYMBOL
(
AsicEbIbssSync
);

3817 
EXPORT_SYMBOL
(
AsicEbBssSync
);

3818 
EXPORT_SYMBOL
(
AsicDibSync
);

3820 
EXPORT_SYMBOL
(
RTMP_MChlID2KHZ
);

3821 
EXPORT_SYMBOL
(
RTMP_MKHZ2ChlID
);

3823 
EXPORT_SYMBOL
(
AtoH
);

3824 
EXPORT_SYMBOL
(
NwkTyInUSy
);

3825 
EXPORT_SYMBOL
(
NICUpdeRawCous
);

3826 
EXPORT_SYMBOL
(
RTMPSdNuFme
);

3827 
EXPORT_SYMBOL
(
AsicFWakeup
);

3828 
EXPORT_SYMBOL
(
ReIdTo500Kbps
);

3830 
EXPORT_SYMBOL
(
MacTabRet
);

3831 
EXPORT_SYMBOL
(
RTMPCheckSPrtAb
);

3832 
EXPORT_SYMBOL
(
BssTabDeEry
);

3833 
EXPORT_SYMBOL
(
DissocPmFl
);

3834 
EXPORT_SYMBOL
(
RTMPCڡruWEPIVHdr
);

3835 
EXPORT_SYMBOL
(
RTMPMoveMemy
);

3836 
EXPORT_SYMBOL
(
RTMPSTAPrivIolS
);

3837 
EXPORT_SYMBOL
(
SSeSurvey
);

3839 
EXPORT_SYMBOL
(
S_Key1_Proc
);

3840 
EXPORT_SYMBOL
(
S_Key2_Proc
);

3841 
EXPORT_SYMBOL
(
S_Key3_Proc
);

3842 
EXPORT_SYMBOL
(
S_Key4_Proc
);

3843 
EXPORT_SYMBOL
(
S_EnypTy_Proc
);

3844 
EXPORT_SYMBOL
(
S_WPAPSK_Proc
);

3845 
EXPORT_SYMBOL
(
S_AuthMode_Proc
);

3849 #ifde
RTMP_MAC_PCI


3850 
EXPORT_SYMBOL
(
STARxDeIruHd
);

3851 
EXPORT_SYMBOL
(
MlmeRetSMache
);

3852 
EXPORT_SYMBOL
(
RTMPHdTwakeupIru
);

3853 
EXPORT_SYMBOL
(
AsicRetBBPAgt
);

3858 #ifde
RTMP_MAC_PCI


3859 
EXPORT_SYMBOL
(
RT28xxPciAsicRadioOff
);

3860 
EXPORT_SYMBOL
(
RTMPHdTxRgDmaDeIru
);

3861 
EXPORT_SYMBOL
(
RTMPHdPTBTTIru
);

3862 
EXPORT_SYMBOL
(
RTMPHdTBTTIru
);

3863 
EXPORT_SYMBOL
(
NICUpdeFifoSCous
);

3864 
EXPORT_SYMBOL
(
RTMPHdMgmtRgDmaDeIru
);

3865 
EXPORT_SYMBOL
(
RTMPHdRxCohtIru
);

3875 #ifde
WDS_SUPPORT


3876 
EXPORT_SYMBOL
(
WdsDown
);

3877 
EXPORT_SYMBOL
(
RT28xx_WDS_Remove
);

3880 
EXPORT_SYMBOL
(
GeWpsPCode
);

3884 #ifde
DOT11_N_SUPPORT


3886 #ifde
CONFIG_STA_SUPPORT


3887 
EXPORT_SYMBOL
(
N_SCCh
);

3891 #ifde
BLOCK_NET_IF


3892 
EXPORT_SYMBOL
(
blockQueueTab
);

3896 #ifde
RALINK_ATE


3897 #ifde
RALINK_QA


3898 
EXPORT_SYMBOL
(
RtmpDoA
);

3900 #ifde
CONFIG_STA_SUPPORT


3906 #ifde
QOS_DLS_SUPPORT


3907 #ifde
CONFIG_STA_SUPPORT


3908 
EXPORT_SYMBOL
(
S_DlsEryInfo_Diy_Proc
);

3909 
EXPORT_SYMBOL
(
RTMPSdDLSTrDownFme
);

3913 #ifde
DFS_SUPPORT


3918 
EXPORT_SYMBOL
(
RTMPSLED
);

3920 #ifde
RTMP_INTERNAL_TX_ALC


3921 
EXPORT_SYMBOL
(
InDesedTSSITab
);

3924 #ifde
CONFIG_STA_SUPPORT


3925 
EXPORT_SYMBOL
(
MlmeAutoRecLaSSID
);

3928 #ifde
RESOURCE_PRE_ALLOC


3929 
EXPORT_SYMBOL
(
RTMPInTxRxRgMemy
);

3930 
EXPORT_SYMBOL
(
RTMPRetTxRxRgMemy
);

	@common/rtmp_init_inf.c

37 
	~"_cfig.h
"

39 #ifde
OS_ABL_SUPPORT


40 
UCHAR
 
	gBIT8
[] = {0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80};

44 
	$28xx_
(

45 
IN
 
PRTMP_ADAPTER
 
pAd
,

46 
IN
 
PSTRING
 
pDeuMac
,

47 
IN
 
PSTRING
 
pHoName
)

49 
UINT
 
dex
;

50 
UCHAR
 
TmpPhy
;

51 
NDIS_STATUS
 
Stus
;

52 
UINT32
 
MacC0
 = 0;

54 #ifde
CONFIG_STA_SUPPORT


55 #ifde
PCIE_PS_SUPPORT


56 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

60 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
) &&

61 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

63 
AUTO_WAKEUP_STRUC
 
AutoWakeupCfg
;

64 
	`AsicFWakeup
(
pAd
, 
TRUE
);

65 
AutoWakeupCfg
.
wd
 = 0;

66 
	`RTMP_IO_WRITE32
(
pAd
, 
AUTO_WAKEUP_CFG
, 
AutoWakeupCfg
.
wd
);

67 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_DOZE
);

75 
	`RTMP_CLEAR_FLAGS
(
pAd
);

79 #ifde
DOT11_N_SUPPORT


81 i(
	`ba_dg_sour_
(
pAd
, 
MAX_REORDERING_MPDU_NUM
!
TRUE
)

82 
r1
;

86 
dex
 = 0;

89 
	`RTMP_IO_READ32
(
pAd
, 
MAC_CSR0
, &
MacC0
);

90 
pAd
->
MACVsi
 = 
MacC0
;

92 i((
pAd
->
MACVsi
 != 0x00) && (pAd->MACVersion != 0xFFFFFFFF))

95 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

96 
r1
;

98 
	`RTMPucDay
(10);

99 } 
dex
++ < 100);

100 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MAC_CSR0 [ V:Rev=0x%08x]\n", 
pAd
->
MACVsi
));

102 #ifde
RTMP_MAC_PCI


105 
	`RTMP_IO_WRITE32
(
pAd
, 
PWR_PIN_CFG
, 0x2);

109 
	`RT28XXDMADib
(
pAd
);

113 
Stus
 = 
	`NICLdFmwe
(
pAd
);

114 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

116 
	`DBGPRINT_ERR
(("NICLdFmwed, Stus[=0x%08x]\n", 
Stus
));

117 
r1
;

120 
	`NICLdReSwchgPams
(
pAd
);

124 #ifde
RTMP_MAC_PCI


125 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_ACTIVE
))

127 
	`RTMP_ASIC_INTERRUPT_DISABLE
(
pAd
);

131 #ifde
RESOURCE_PRE_ALLOC


132 
Stus
 = 
	`RTMPInTxRxRgMemy
(
pAd
);

134 
Stus
 = 
	`RTMPAocTxRxRgMemy
(
pAd
);

137 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

139 
	`DBGPRINT_ERR
(("RTMPAocTxRxMemy faed, Stus[=0x%08x]\n", 
Stus
));

140 
r2
;

143 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
);

148 
Stus
 = 
	`RtmpMgmtTaskIn
(
pAd
);

149 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

150 
r3
;

152 
Stus
 = 
	`MlmeIn
(
pAd
);

153 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

155 
	`DBGPRINT_ERR
(("MlmeIn faed, Stus[=0x%08x]\n", 
Stus
));

156 
r4
;

159 #ifde
RMTP_RBUS_SUPPORT


160 #ifde
VIDEO_TURBINE_SUPPORT


161 
	`VideoCfigIn
(
pAd
);

167 
	`UrCfgIn
(
pAd
);

169 
Stus
 = 
	`RtmpNTaskIn
(
pAd
);

170 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

171 
r5
;

176 
	`CfgInHook
(
pAd
);

179 #ifde
BLOCK_NET_IF


180 
	`blockQueueTab
(
pAd
);

183 
Stus
 = 
	`MsuReqTabIn
(
pAd
);

184 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

186 
	`DBGPRINT_ERR
(("MsuReqTabIn faed, Stus[=0x%08x]\n",
Stus
));

187 
r6
;

189 
Stus
 = 
	`TpcReqTabIn
(
pAd
);

190 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

192 
	`DBGPRINT_ERR
(("TpcReqTabIn faed, Stus[=0x%08x]\n",
Stus
));

193 
r6
;

199 
Stus
 = 
	`NICInlizeAdr
(
pAd
, 
TRUE
);

200 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

202 
	`DBGPRINT_ERR
(("NICInlizeAded, Stus[=0x%08x]\n", 
Stus
));

203 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

204 
r6
;

210 
pAd
->
RfIcTy
 = 
RFIC_UNKNOWN
;

211 
Stus
 = 
	`RTMPRdPamsHook
(
pAd
);

213 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("1. Phy Mod%d\n", 
pAd
->
CommCfg
.
PhyMode
));

214 i(
Stus
 !
NDIS_STATUS_SUCCESS
)

216 
	`DBGPRINT_ERR
(("RTMPRdPamsHook faed, Stus[=0x%08x]\n",
Stus
));

217 
r6
;

222 #ifde
DOT11_N_SUPPORT


225 
pAd
->
CommCfg
.
DesedHtPhy
.
MpduDsy
 = (
UCHAR
Ad->CommCfg.
BACaby
.
fld
.MpduDensity;

226 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduEb
 = (
USHORT
Ad->CommCfg.
BACaby
.
fld
.AmsduEnable;

227 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduSize
 = (
USHORT
Ad->CommCfg.
BACaby
.
fld
.AmsduSize;

228 
pAd
->
CommCfg
.
DesedHtPhy
.
MimoPs
 = (
USHORT
Ad->CommCfg.
BACaby
.
fld
.
MMPSmode
;

230 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
MimoPs
 = (
USHORT
Ad->CommCfg.
BACaby
.
fld
.
MMPSmode
;

231 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
AMsduSize
 = (
USHORT
Ad->CommCfg.
BACaby
.
fld
.
AmsduSize
;

232 
pAd
->
CommCfg
.
HtCaby
.
HtCPm
.
MpduDsy
 = (
UCHAR
Ad->CommCfg.
BACaby
.
fld
.MpduDensity;

242 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("2. Phy Mod%d\n", 
pAd
->
CommCfg
.
PhyMode
));

245 
	`NICRdEEPROMPams
(
pAd
, (
PUCHAR
)
pDeuMac
);

246 #ifde
CONFIG_STA_SUPPORT


249 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("3. Phy Mod%d\n", 
pAd
->
CommCfg
.
PhyMode
));

251 
	`NICInAsicFromEEPROM
(
pAd
);

254 #ifde
RTMP_INTERNAL_TX_ALC


258 
	`InDesedTSSITab
(
pAd
);

262 
TmpPhy
 = 
pAd
->
CommCfg
.
PhyMode
;

263 
pAd
->
CommCfg
.
PhyMode
 = 0xff;

264 
	`RTMPSPhyMode
(
pAd
, 
TmpPhy
);

265 #ifde
DOT11_N_SUPPORT


266 
	`SCommHT
(
pAd
);

270 i(
pAd
->
ChlLiNum
 == 0)

272 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Wrong configuration. No valid channel found. Check \"ContryCode\"nd \"ChannelGeography\" setting.\n"));

273 
r6
;

276 #ifde
DOT11_N_SUPPORT


277 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("MCS S = %02x %02x %02x %02x %02x\n", 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[0],

278 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[1],Ad->CommonCfg.HtCapability.MCSSet[2],

279 
pAd
->
CommCfg
.
HtCaby
.
MCSS
[3],Ad->CommonCfg.HtCapability.MCSSet[4]));

286 #ifde
IKANOS_VX_1X0


287 
	`VR_IKANOS_FP_In
(
pAd
->
ApCfg
.
BssidNum
,Ad->
PmtAddss
);

299 i(
pAd
 && (
Stus
 !
NDIS_STATUS_SUCCESS
))

304 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

307 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
);

311 i(
pAd
)

314 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

315 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_MEDIA_STATE_CHANGE
);

317 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("NDIS_STATUS_MEDIA_DISCONNECT Event B!\n"));

324 
	`RtmpOSNDevAddrS
(
pAd
->
t_dev
, &pAd->
CutAddss
[0]);

331 #ifde
CONFIG_STA_SUPPORT


332 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

335 #ifde
WPA_SUPPLICANT_SUPPORT


336 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


338 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, 
RT_INTERFACE_UP
, 
NULL
, NULL, 0);

350 
	`DBGPRINT_S
(
Stus
, ("<====t28xx_init, Status=%x\n", Status));

352  
TRUE
;

354 
r6
:

355 
	`MsuReqTabEx
(
pAd
);

356 
	`TpcReqTabEx
(
pAd
);

357 
r5
:

358 
	`RtmpNTaskEx
(
pAd
);

359 
	`UrCfgEx
(
pAd
);

360 
r4
:

361 
	`MlmeHt
(
pAd
);

362 
r3
:

363 
	`RtmpMgmtTaskEx
(
pAd
);

364 
r2
:

365 #ifde
RESOURCE_PRE_ALLOC


366 
	`RTMPRetTxRxRgMemy
(
pAd
);

368 
	`RTMPFeTxRxRgMemy
(
pAd
);

371 
r1
:

373 #ifde
DOT11_N_SUPPORT


374 if(
pAd
->
mpdu_blk_po
.
mem
)

375 
	`os__mem
(
pAd
,Ad->
mpdu_blk_po
.
mem
);

380 #ifde
INF_AMAZON_SE


381 
r0
:

383 #ifde
ST


384 
r0
:

387 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!t28xx Initialized fail !!!\n"));

388  
FALSE
;

389 
	}
}

	@common/rtmp_mcu.c

39 
	~"_cfig.h
"

40 
	~"fmwe.h
"

46 
	#FIRMWAREIMAGE_MAX_LENGTH
 0x2000

	)

47 
	#FIRMWAREIMAGE_LENGTH
 ( (
FmweImage
/ (
UCHAR
))

	)

48 
	#FIRMWARE_MAJOR_VERSION
 0

	)

50 
	#FIRMWAREIMAGEV1_LENGTH
 0x1000

	)

51 
	#FIRMWAREIMAGEV2_LENGTH
 0x1000

	)

53 #ifde
RTMP_MAC_PCI


54 
	#FIRMWARE_MINOR_VERSION
 2

	)

57 cڡ 
	gcct_16Tab
[] = {

91 
	#ByCRC16
(
v
, 
c
) \

92 ()((
c
 << 8^ 
cct_16Tab
[((>> 8^ (
v
)& 255])

	)

94 
	$BRev
(
x
)

96 
i
;

97 
Temp
=0;

98 
i
=0; ; i++)

100 if(
x
 & 0x80
Temp
 |= 0x80;

101 if(
i
==7) ;

102 
x
 <<= 1;

103 
Temp
 >>= 1;

105  
Temp
;

106 
	}
}

122 
INT
 
	$RtmpAsicEFmwe
(

123 
IN
 
PRTMP_ADAPTER
 
pAd
)

125 
ULONG
 
i
;

127 
i
=0; i<
MAX_FIRMWARE_IMAGE_SIZE
; i+=4)

128 
	`RTMP_IO_WRITE32
(
pAd
, 
FIRMWARE_IMAGE_BASE
 + 
i
, 0);

131 
	}
}

150 
NDIS_STATUS
 
	$RtmpAsicLdFmwe
(

151 
IN
 
PRTMP_ADAPTER
 
pAd
)

153 #ifde
BIN_IN_FILE


154 
	#NICLF_DEFAULT_USE
() \

155 
g_deu_fm_u
 = 
TRUE
; \

156 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%- U deu fmwe!\n", 
__FUNCTION__
));

	)

158 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

159 
PUCHAR
 
c
;

160 
RTMP_OS_FD
 
cf
;

161 
INT
 
tv
, 
i
;

162 
PUCHAR
 
pFmweImage
;

163 
INT
 
FeLgth
 = 0;

164 
UINT32
 
MacReg
;

165 
ULONG
 
Index
;

166 
ULONG
 
fm
;

167 
BOOLEAN
 
g_deu_fm_u
 = 
FALSE
;

168 
RTMP_OS_FS_INFO
 
osFSInfo
;

170 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===> %s\n", 
__FUNCTION__
));

173 
pFmweImage
 = 
NULL
;

174 
c
 = 
RTMP_FIRMWARE_FILE_NAME
;

176 
	`RtmpOSFSInfoChge
(&
osFSInfo
, 
TRUE
);

178 
pAd
->
FmweVsi
 = (
FIRMWARE_MAJOR_VERSION
 << 8) + \

179 
FIRMWARE_MINOR_VERSION
;

183 
pFmweImage
 = 
	`kmloc
(
MAX_FIRMWARE_IMAGE_SIZE
, 
MEM_ALLOC_FLAG
);

184 i(
pFmweImage
 =
NULL
)

187 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%- Ao memy fa!\n", 
__FUNCTION__
));

188 
	`NICLF_DEFAULT_USE
();

193 
	`memt
(
pFmweImage
, 0x00, 
MAX_FIRMWARE_IMAGE_SIZE
);

198 i(
g_deu_fm_u
 =
FALSE
)

203 
cf
 = 
	`RtmpOSFeOn
(
c
, 
O_RDONLY
, 0);

205 i(
	`IS_FILE_OPEN_ERR
(
cf
))

207 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%- E ong f%s\n", 
__FUNCTION__
, 
c
));

208 
	`NICLF_DEFAULT_USE
();

214 
FeLgth
 = 
	`RtmpOSFeRd
(
cf
, 
pFmweImage
, 
MAX_FIRMWARE_IMAGE_SIZE
);

215 i(
FeLgth
 !
MAX_FIRMWARE_IMAGE_SIZE
)

217 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:rror fileength (=%d) in RT2860AP.BIN\n",

218 
__FUNCTION__
, 
FeLgth
));

219 
	`NICLF_DEFAULT_USE
();

224 
PUCHAR
 
r
 = 
pFmweImage
;

225 
USHORT
 
c
 = 0xffff;

229 
i
=0; i<(
MAX_FIRMWARE_IMAGE_SIZE
-2); i++, 
r
++)

230 
c
 = 
	`ByCRC16
(
	`BRev
(*
r
), crc);

233 i((
pFmweImage
[
MAX_FIRMWARE_IMAGE_SIZE
-2] != \

234 (
UCHAR
)
	`BRev
((UCHAR)(
c
>>8))) ||

235 (
pFmweImage
[
MAX_FIRMWARE_IMAGE_SIZE
-1] != \

236 (
UCHAR
)
	`BRev
((UCHAR)
c
)))

239 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: CRC = 0x%02x 0x%02x "

241 
__FUNCTION__
,

242 
pFmweImage
[
MAX_FIRMWARE_IMAGE_SIZE
-2],

243 
pFmweImage
[
MAX_FIRMWARE_IMAGE_SIZE
-1],

244 (
UCHAR
)(
c
>>8), (UCHAR)(crc)));

245 
	`NICLF_DEFAULT_USE
();

251 
pAd
->
FmweVsi
 = \

252 (
pFmweImage
[
MAX_FIRMWARE_IMAGE_SIZE
-4] << 8) +

253 
pFmweImage
[
MAX_FIRMWARE_IMAGE_SIZE
-3];

256 i((
pAd
->
FmweVsi
) < \

257 ((
FIRMWARE_MAJOR_VERSION
 << 8) +

258 
FIRMWARE_MINOR_VERSION
))

260 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: fmwvsiځod!\n", 
__FUNCTION__
));

261 
	`NICLF_DEFAULT_USE
();

266 
	`DBGPRINT
(
RT_DEBUG_TRACE
,

268 
pFmweImage
[
MAX_FIRMWARE_IMAGE_SIZE
-4],

269 
pFmweImage
[
MAX_FIRMWARE_IMAGE_SIZE
-3]));

272 } 
TRUE
);

275 i(
	`IS_FILE_OPEN_ERR
(
cf
))

279 
tv
 = 
	`RtmpOSFeClo
(
cf
);

280 i(
tv
)

282 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("--> E %d closg %s\n", -
tv
, 
c
));

289 i(
g_deu_fm_u
 =
TRUE
)

292 i(
pFmweImage
 !
NULL
)

293 
	`k
(
pFmweImage
);

297 
pFmweImage
 = 
FmweImage
;

298 
FeLgth
 = (
FmweImage
);

302 
	`RTMP_IO_WRITE32
(
pAd
, 
PBF_SYS_CTRL
, 0x10000);

304 
i
=0; i<
FeLgth
; i+=4)

306 
fm
 = 
pFmweImage
[
i
] +

307 (
pFmweImage
[
i
+3] << 24) +

308 (
pFmweImage
[
i
+2] << 16) +

309 (
pFmweImage
[
i
+1] << 8);

311 
	`RTMP_IO_WRITE32
(
pAd
, 
FIRMWARE_IMAGE_BASE
 + 
i
, 
fm
);

314 
	`RTMP_IO_WRITE32
(
pAd
, 
PBF_SYS_CTRL
, 0x00000);

315 
	`RTMP_IO_WRITE32
(
pAd
, 
PBF_SYS_CTRL
, 0x00001);

318 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_BBP_AGENT
, 0);

319 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_MAILBOX_CSR
, 0);

321 i(
g_deu_fm_u
 =
FALSE
)

324 i(
pFmweImage
 !
NULL
)

325 
	`k
(
pFmweImage
);

329 
	`RtmpOSFSInfoChge
(&
osFSInfo
, 
FALSE
);

332 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

333 
PUCHAR
 
pFmweImage
;

334 
ULONG
 
FeLgth
, 
Index
;

336 
UINT32
 
MacReg
 = 0;

337 
UINT32
 
Vsi
 = (
pAd
->
MACVsi
 >> 16);

339 
pFmweImage
 = 
FmweImage
;

340 
FeLgth
 = (
FmweImage
);

344 i(
FIRMWAREIMAGE_LENGTH
 =
FIRMWAREIMAGE_MAX_LENGTH
)

348 #ifde
RTMP_MAC_PCI


349 i((
Vsi
 =0x2860|| (Vsi =0x3572|| 
	`IS_RT3090
(
pAd
)||
	`IS_RT3390
Ad|| 
	`IS_RT3593
(pAd))

351 
pFmweImage
 = 
FmweImage
;

352 
FeLgth
 = 
FIRMWAREIMAGE_LENGTH
;

358 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("KH: bin file should be 8KB.\n"));

359 
Stus
 = 
NDIS_STATUS_FAILURE
;

363 
	`RTMP_WRITE_FIRMWARE
(
pAd
, 
pFmweImage
, 
FeLgth
);

368 
Index
 = 0;

371 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

372  
NDIS_STATUS_FAILURE
;

374 
	`RTMP_IO_READ32
(
pAd
, 
PBF_SYS_CTRL
, &
MacReg
);

376 i(
MacReg
 & 0x80)

379 
	`RTMPucDay
(1000);

380 } 
Index
++ < 1000);

382 i(
Index
 >= 1000)

384 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("NICLoadFirmware: MCU isoteady\n\n\n"));

385 
Stus
 = 
NDIS_STATUS_FAILURE
;

388 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<==%(us=%d)\n", 
__FUNCTION__
, 
Stus
));

390  
Stus
;

391 
	}
}

394 
INT
 
	$RtmpAsicSdCommdToMcu
(

395 
IN
 
PRTMP_ADAPTER
 
pAd
,

396 
IN
 
UCHAR
 
Commd
,

397 
IN
 
UCHAR
 
Tok
,

398 
IN
 
UCHAR
 
Arg0
,

399 
IN
 
UCHAR
 
Arg1
)

401 
HOST_CMD_CSR_STRUC
 
H2MCmd
;

402 
H2M_MAILBOX_STRUC
 
H2MMabox
;

403 
ULONG
 
i
 = 0;

404 #ifde
RTMP_MAC_PCI


405 #ifde
RALINK_ATE


406 
UINT32
 
j
 = 0;

409 #ifde
CONFIG_STA_SUPPORT


410 #ifde
PCIE_PS_SUPPORT


413 i((
	`IS_RT3090
(
pAd
|| 
	`IS_RT3572
(pAd) ||

414 
	`IS_RT3390
(
pAd
|| 
	`IS_RT3593
Ad)&& 
	`IS_VERSION_AFTER_F
(pAd)

415 && (
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxPowMode
 == 3)

416 && (
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
))

418 
	`RTMP_SEM_LOCK
(&
pAd
->
McuCmdLock
);

419 i((
pAd
->
b30xxBMcuCmd
 =
TRUE
)

420 && (
Commd
 !
WAKE_MCU_CMD
&& (Commd !
RFOFF_MCU_CMD
))

422 
	`RTMP_SEM_UNLOCK
(&
pAd
->
McuCmdLock
);

423 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" B Mcu Cmd %x imode\n", 
Commd
));

424  
FALSE
;

426 i((
Commd
 =
SLEEP_MCU_CMD
)

427 ||(
Commd
 =
RFOFF_MCU_CMD
))

429 
pAd
->
b30xxBMcuCmd
 = 
TRUE
;

431 i(
Commd
 !
WAKE_MCU_CMD
)

433 
pAd
->
b30xxBMcuCmd
 = 
FALSE
;

436 
	`RTMP_SEM_UNLOCK
(&
pAd
->
McuCmdLock
);

440 i(
Commd
 =
SLEEP_MCU_CMD
)

441 
pAd
->
LaMCUCmd
 = 
Commd
;

443 i((
	`IS_RT3090
(
pAd
|| 
	`IS_RT3572
(pAd) ||

444 
	`IS_RT3390
(
pAd
|| 
	`IS_RT3593
Ad)&& 
	`IS_VERSION_AFTER_F
(pAd)

445 && (
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxPowMode
 == 3)

446 && (
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)

447 && (
Commd
 =
WAKE_MCU_CMD
))

451 i((
Commd
 !0x84&& (Commd !
WAKE_MCU_CMD
))

455 
	`RTMP_IO_FORCE_READ32
(
pAd
, 
H2M_MAILBOX_CSR
, &
H2MMabox
.
wd
);

456 i(
H2MMabox
.
fld
.
Owr
 == 0)

459 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

460  
FALSE
;

462 
	`RTMPucDay
(2);

463 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("AsicSendCommanToMcu::Mail box is busy\n"));

464 } 
i
++ < 100);

466 i(
i
 >= 100)

468 
	`DBGPRINT_ERR
(("H2M_MAILBOX still hold by MCU. command fail\n"));

469  
FALSE
;

473 
H2MMabox
.
fld
.
Owr
 = 1;

474 
H2MMabox
.
fld
.
CmdTok
 = 
Tok
;

475 
H2MMabox
.
fld
.
HighBy
 = 
Arg1
;

476 
H2MMabox
.
fld
.
LowBy
 = 
Arg0
;

477 
	`RTMP_IO_FORCE_WRITE32
(
pAd
, 
H2M_MAILBOX_CSR
, 
H2MMabox
.
wd
);

479 
H2MCmd
.
wd
 = 0;

480 
H2MCmd
.
fld
.
HoCommd
 = 
Commd
;

481 
	`RTMP_IO_FORCE_WRITE32
(
pAd
, 
HOST_CMD_CSR
, 
H2MCmd
.
wd
);

491 
	`RTMP_IO_READ32
(
pAd
, 
H2M_MAILBOX_CSR
, &
H2MMabox
.
wd
);

492 i(
H2MMabox
.
fld
.
Owr
 == 0)

495 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

496  
FALSE
;

498 
	`RTMPucDay
(2);

499 } 
i
++ < 100);

501 i(
i
 >= 100)

503 #ifde
RTMP_MAC_PCI


504 #ifde
RALINK_ATE


505 i(
pAd
->
e
.
bFWLdg
 =
TRUE
)

508 i(
j
 > 0)

510 i(
j
 % 64 != 0)

512 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("#"));

516 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("\n"));

518 ++
j
;

520 i(
j
 == 0)

522 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Loading firmware. Please wait for moment...\n"));

523 ++
j
;

530 
	`DBGPRINT_ERR
(("H2M_MAILBOX still hold by MCU. command fail\n"));

532  
FALSE
;

535 #ifde
RTMP_MAC_PCI


536 #ifde
RALINK_ATE


537 i(
pAd
->
e
.
bFWLdg
 =
TRUE
)

540 
pAd
->
e
.
bFWLdg
 = 
FALSE
;

541 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("\n"));

542 
j
 = 0;

547 
H2MMabox
.
fld
.
Owr
 = 1;

548 
H2MMabox
.
fld
.
CmdTok
 = 
Tok
;

549 
H2MMabox
.
fld
.
HighBy
 = 
Arg1
;

550 
H2MMabox
.
fld
.
LowBy
 = 
Arg0
;

551 
	`RTMP_IO_WRITE32
(
pAd
, 
H2M_MAILBOX_CSR
, 
H2MMabox
.
wd
);

553 
H2MCmd
.
wd
 = 0;

554 
H2MCmd
.
fld
.
HoCommd
 = 
Commd
;

555 
	`RTMP_IO_WRITE32
(
pAd
, 
HOST_CMD_CSR
, 
H2MCmd
.
wd
);

557 i(
Commd
 != 0x80)

561 #ifde
CONFIG_STA_SUPPORT


562 #ifde
PCIE_PS_SUPPORT


565 i((
	`IS_RT3090
(
pAd
|| 
	`IS_RT3572
(pAd)

566 || 
	`IS_RT3390
(
pAd
|| 
	`IS_RT3593
Ad)&& 
	`IS_VERSION_AFTER_F
(pAd)

567 && (
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxPowMode
 == 3)

568 && (
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
)

569 && (
Commd
 =
WAKE_MCU_CMD
))

571 
	`RTMPucDay
(2000);

580 i(
Commd
 =
WAKE_MCU_CMD
)

581 
pAd
->
LaMCUCmd
 = 
Commd
;

583  
TRUE
;

584 
	}
}

	@common/rtmp_timer.c

41 
	~"_cfig.h
"

44 
BUILD_TIMER_FUNCTION
(
MlmePiodicExec
);

46 
BUILD_TIMER_FUNCTION
(
AsicRxAEvTimeout
);

47 
BUILD_TIMER_FUNCTION
(
APSDPiodicExec
);

48 
BUILD_TIMER_FUNCTION
(
EnqueueSFPSKExec
);

49 #ifde
CONFIG_STA_SUPPORT


53 #ifde
CONFIG_STA_SUPPORT


54 
BUILD_TIMER_FUNCTION
(
BcTimeout
);

55 
BUILD_TIMER_FUNCTION
(
SnTimeout
);

56 
BUILD_TIMER_FUNCTION
(
AuthTimeout
);

57 
BUILD_TIMER_FUNCTION
(
AssocTimeout
);

58 
BUILD_TIMER_FUNCTION
(
RssocTimeout
);

59 
BUILD_TIMER_FUNCTION
(
DissocTimeout
);

60 
BUILD_TIMER_FUNCTION
(
LkDownExec
);

61 
BUILD_TIMER_FUNCTION
(
SQuickReeFReUpExec
);

62 
BUILD_TIMER_FUNCTION
(
WDissocApAndBlockAssoc
);

63 #ifde
PCIE_PS_SUPPORT


64 
BUILD_TIMER_FUNCTION
(
PsPlWakeExec
);

65 
BUILD_TIMER_FUNCTION
(
RadioOnExec
);

67 #ifde
QOS_DLS_SUPPORT


68 
BUILD_TIMER_FUNCTION
(
DlsTimeoutAi
);

79 #ifde
WLAN_LED


80 
LedClMa
(

81 
IN
 
PVOID
 
SyemScific1
,

82 
IN
 
PVOID
 
FuniCڋxt
,

83 
IN
 
PVOID
 
SyemScific2
,

84 
IN
 
PVOID
 
SyemScific3
);

85 
BUILD_TIMER_FUNCTION
(
LedClMa
);

90 #ifde
RTMP_TIMER_TASK_SUPPORT


91 
	$RtmpTimQHd
(
RTMP_ADAPTER
 *
pAd
)

93 #ide
KTHREAD_SUPPORT


94 
us
;

96 
RALINK_TIMER_STRUCT
 *
pTim
;

97 
RTMP_TIMER_TASK_ENTRY
 *
pEry
;

98 
qFg
;

99 
RTMP_OS_TASK
 *
pTask
;

102 
pTask
 = &
pAd
->
timTask
;

103 !
pTask
->
sk_kd
)

105 
pTim
 = 
NULL
;

107 #ifde
KTHREAD_SUPPORT


108 
	`RTMP_WAIT_EVENT_INTERRUPTIBLE
(
pAd
, 
pTask
);

110 
	`RTMP_SEM_EVENT_WAIT
(&(
pTask
->
skSema
), 
us
);

113 i(
pAd
->
TimQ
.
us
 =
RTMP_TASK_STAT_STOPED
)

117 
pAd
->
TimQ
.
pQHd
)

119 
	`RTMP_INT_LOCK
(&
pAd
->
TimQLock
, 
qFg
);

120 
pEry
 = 
pAd
->
TimQ
.
pQHd
;

121 i(
pEry
)

123 
pTim
 = 
pEry
->
pRaTim
;

126 
pAd
->
TimQ
.
pQHd
 = 
pEry
->
pNext
;

127 i(
pEry
 =
pAd
->
TimQ
.
pQTa
)

128 
pAd
->
TimQ
.
pQTa
 = 
NULL
;

131 
pEry
->
pNext
 = 
pAd
->
TimQ
.
pQPlFeLi
;

132 
pAd
->
TimQ
.
pQPlFeLi
 = 
pEry
;

134 
	`RTMP_INT_UNLOCK
(&
pAd
->
TimQLock
, 
qFg
);

136 i(
pTim
)

138 i((
pTim
->
hd
 !
NULL
&& (!
pAd
->
PM_FlgSud
))

139 
pTim
->
	`hd
(
NULL
, (
PVOID
pTim->
cook
, NULL,Timer);

140 i((
pTim
->
Rt
&& (pTim->
S
 =
FALSE
))

141 
	`RTMP_OS_Add_Tim
(&
pTim
->
TimObj
,Tim->
TimVue
);

145 #ide
KTHREAD_SUPPORT


146 i(
us
 != 0)

148 
pAd
->
TimQ
.
us
 = 
RTMP_TASK_STAT_STOPED
;

149 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
);

154 
	}
}

157 
INT
 
	$RtmpTimQThad
(

158 
IN
 
ULONG
 
Cڋxt
)

160 
RTMP_OS_TASK
 *
pTask
;

161 
PRTMP_ADAPTER
 
pAd
;

164 
pTask
 = (
RTMP_OS_TASK
 *)
Cڋxt
;

165 
pAd
 = (
PRTMP_ADAPTER
)
pTask
->
iv
;

167 
	`RtmpOSTaskCuomize
(
pTask
);

169 
	`RtmpTimQHd
(
pAd
);

171 
	`DBGPRINT
(
RT_DEBUG_TRACE
,"<---%s\n",
__FUNCTION__
));

172 #ide
KTHREAD_SUPPORT


173 
pTask
->
skPID
 = 
THREAD_PID_INIT_VALUE
;

189 
	`RtmpOSTaskNifyToEx
(
pTask
);

193 
	}
}

196 
RTMP_TIMER_TASK_ENTRY
 *
	$RtmpTimQIn
(

197 
IN
 
RTMP_ADAPTER
 *
pAd
,

198 
IN
 
RALINK_TIMER_STRUCT
 *
pTim
)

200 
RTMP_TIMER_TASK_ENTRY
 *
pQNode
 = 
NULL
, *
pQTa
;

201 
qFgs
;

202 
RTMP_OS_TASK
 *
pTask
 = &
pAd
->
timTask
;

204 
	`RTMP_INT_LOCK
(&
pAd
->
TimQLock
, 
qFgs
);

205 i(
pAd
->
TimQ
.
us
 & 
RTMP_TASK_CAN_DO_INSERT
)

207 if(
pAd
->
TimQ
.
pQPlFeLi
)

209 
pQNode
 = 
pAd
->
TimQ
.
pQPlFeLi
;

210 
pAd
->
TimQ
.
pQPlFeLi
 = 
pQNode
->
pNext
;

212 
pQNode
->
pRaTim
 = 
pTim
;

213 
pQNode
->
pNext
 = 
NULL
;

215 
pQTa
 = 
pAd
->
TimQ
.pQTail;

216 i(
pAd
->
TimQ
.
pQTa
 !
NULL
)

217 
pQTa
->
pNext
 = 
pQNode
;

218 
pAd
->
TimQ
.
pQTa
 = 
pQNode
;

219 i(
pAd
->
TimQ
.
pQHd
 =
NULL
)

220 
pAd
->
TimQ
.
pQHd
 = 
pQNode
;

223 
	`RTMP_INT_UNLOCK
(&
pAd
->
TimQLock
, 
qFgs
);

225 i(
pQNode
)

227 #ifde
KTHREAD_SUPPORT


228 
	`WAKE_UP
(
pTask
);

230 
	`RTMP_SEM_EVENT_UP
(&
pTask
->
skSema
);

234  
pQNode
;

235 
	}
}

238 
BOOLEAN
 
	$RtmpTimQRemove
(

239 
IN
 
RTMP_ADAPTER
 *
pAd
,

240 
IN
 
RALINK_TIMER_STRUCT
 *
pTim
)

242 
RTMP_TIMER_TASK_ENTRY
 *
pNode
, *
pPv
 = 
NULL
;

243 
qFgs
;

245 
	`RTMP_INT_LOCK
(&
pAd
->
TimQLock
, 
qFgs
);

246 i(
pAd
->
TimQ
.
us
 >
RTMP_TASK_STAT_INITED
)

248 
pNode
 = 
pAd
->
TimQ
.
pQHd
;

249 
pNode
)

251 i(
pNode
->
pRaTim
 =
pTim
)

253 
pPv
 = 
pNode
;

254 
pNode
 =Node->
pNext
;

258 i(
pNode
)

260 i(
pNode
 =
pAd
->
TimQ
.
pQHd
)

261 
pAd
->
TimQ
.
pQHd
 = 
pNode
->
pNext
;

262 i(
pNode
 =
pAd
->
TimQ
.
pQTa
)

263 
pAd
->
TimQ
.
pQTa
 = 
pPv
;

264 i(
pPv
 !
NULL
)

265 
pPv
->
pNext
 = 
pNode
->pNext;

268 
pNode
->
pNext
 = 
pAd
->
TimQ
.
pQPlFeLi
;

269 
pAd
->
TimQ
.
pQPlFeLi
 = 
pNode
;

272 
	`RTMP_INT_UNLOCK
(&
pAd
->
TimQLock
, 
qFgs
);

274  
TRUE
;

275 
	}
}

278 
	$RtmpTimQEx
(
RTMP_ADAPTER
 *
pAd
)

280 
RTMP_TIMER_TASK_ENTRY
 *
pTimQ
;

281 
qFgs
;

283 
	`RTMP_INT_LOCK
(&
pAd
->
TimQLock
, 
qFgs
);

284 
pAd
->
TimQ
.
pQHd
)

286 
pTimQ
 = 
pAd
->
TimQ
.
pQHd
;

287 
pAd
->
TimQ
.
pQHd
 = 
pTimQ
->
pNext
;

290 
pAd
->
TimQ
.
pQPlFeLi
 = 
NULL
;

291 
	`os__mem
(
pAd
,Ad->
TimQ
.
pTimQPl
);

292 
pAd
->
TimQ
.
pQTa
 = 
NULL
;

293 
pAd
->
TimQ
.
pQHd
 = 
NULL
;

294 #ide
KTHREAD_SUPPORT


295 
pAd
->
TimQ
.
us
 = 
RTMP_TASK_STAT_STOPED
;

297 
	`RTMP_INT_UNLOCK
(&
pAd
->
TimQLock
, 
qFgs
);

299 
	}
}

302 
	$RtmpTimQIn
(
RTMP_ADAPTER
 *
pAd
)

304 
i
;

305 
RTMP_TIMER_TASK_ENTRY
 *
pQNode
, *
pEry
;

306 
qFgs
;

308 
	`NdisAoSpLock
(&
pAd
->
TimQLock
);

310 
	`NdisZoMemy
(&
pAd
->
TimQ
, (pAd->TimerQ));

312 
	`os_loc_mem
(
pAd
, &pAd->
TimQ
.
pTimQPl
, (
RTMP_TIMER_TASK_ENTRY
* 
TIMER_QUEUE_SIZE_MAX
);

313 i(
pAd
->
TimQ
.
pTimQPl
)

315 
pEry
 = 
NULL
;

316 
pQNode
 = (
RTMP_TIMER_TASK_ENTRY
 *)
pAd
->
TimQ
.
pTimQPl
;

317 
	`NdisZoMemy
(
pAd
->
TimQ
.
pTimQPl
, (
RTMP_TIMER_TASK_ENTRY
* 
TIMER_QUEUE_SIZE_MAX
);

319 
	`RTMP_INT_LOCK
(&
pAd
->
TimQLock
, 
qFgs
);

320 
i
 = 0 ;<
TIMER_QUEUE_SIZE_MAX
; i++)

322 
pQNode
->
pNext
 = 
pEry
;

323 
pEry
 = 
pQNode
;

324 
pQNode
++;

326 
pAd
->
TimQ
.
pQPlFeLi
 = 
pEry
;

327 
pAd
->
TimQ
.
pQHd
 = 
NULL
;

328 
pAd
->
TimQ
.
pQTa
 = 
NULL
;

329 
pAd
->
TimQ
.
us
 = 
RTMP_TASK_STAT_INITED
;

330 
	`RTMP_INT_UNLOCK
(&
pAd
->
TimQLock
, 
qFgs
);

332 
	}
}

	@common/spectrum.c

39 
	~"_cfig.h
"

40 
	~"ai.h
"

44 
DOT11_REGULATORY_INFORMATION
 
	gUSARegutyInfo
[] =

61 
	#USA_REGULATORY_INFO_SIZE
 ((
USARegutyInfo
/ (
DOT11_REGULATORY_INFORMATION
))

	)

65 
DOT11_REGULATORY_INFORMATION
 
	gEureRegutyInfo
[] =

74 
	#EU_REGULATORY_INFO_SIZE
 ((
EureRegutyInfo
/ (
DOT11_REGULATORY_INFORMATION
))

	)

78 
DOT11_REGULATORY_INFORMATION
 
	gJRegutyInfo
[] =

115 
	#JP_REGULATORY_INFO_SIZE
 ((
JRegutyInfo
/ (
DOT11_REGULATORY_INFORMATION
))

	)

118 
UINT8
 
	$GRegutyMaxTxPwr
(

119 
IN
 
PRTMP_ADAPTER
 
pAd
,

120 
IN
 
UINT8
 
chl
)

122 
ULONG
 
RegutyCssLo
, 
ChIdx
;

123 
UINT8
 
RegutyCss
;

124 
UINT8
 
MaxRegutyCssNum
;

125 
PDOT11_REGULATORY_INFORMATION
 
pRegutyCss
;

126 
PSTRING
 
pCoury
 = 
pAd
->
CommCfg
.
CouryCode
;

129 i(
	`cmp
(
pCoury
, "US", 2) == 0)

131 
MaxRegutyCssNum
 = 
USA_REGULATORY_INFO_SIZE
;

132 
pRegutyCss
 = &
USARegutyInfo
[0];

134 i(
	`cmp
(
pCoury
, "JP", 2) == 0)

136 
MaxRegutyCssNum
 = 
JP_REGULATORY_INFO_SIZE
;

137 
pRegutyCss
 = &
JRegutyInfo
[0];

141 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: Unknow Country (%s)\n",

142 
__FUNCTION__
, 
pCoury
));

146 
RegutyCssLo
 = 0;

147 
RegutyCssLo
<
MAX_NUM_OF_REGULATORY_CLASS
;

148 
RegutyCssLo
++)

150 
PDOT11_CHANNEL_SET
 
pChlS
;

152 
RegutyCss
 = 
pAd
->
CommCfg
.RegutyCss[
RegutyCssLo
];

153 i(
RegutyCss
 >
MaxRegutyCssNum
)

155 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: %c%c Unknow Requlatory class (%d)\n",

156 
__FUNCTION__
, 
pCoury
[0],Coury[1], 
RegutyCss
));

159 
pChlS
 = &
pRegutyCss
[
RegutyCss
].
ChlS
;

160 
ChIdx
=0; ChIdx<
pChlS
->
NumbOfChls
; ChIdx++)

162 i(
chl
 =
pChlS
->
ChlLi
[
ChIdx
])

163  
pChlS
->
MaxTxPwr
;

166 i(
ChIdx
 =
pChlS
->
NumbOfChls
)

171 
	}
}

173 
CHAR
 
	$RTMP_GTxPwr
(

174 
IN
 
PRTMP_ADAPTER
 
pAd
,

175 
IN
 
HTTRANSMIT_SETTING
 
HTTxMode
)

177 
	s__TX_PWR_CFG


179 
UINT8
 
Mode
;

180 
UINT8
 
MCS
;

181 
UINT16
 
q
;

182 
UINT8
 
shi
;

183 
UINT32
 
BMask
;

184 } 
	tTX_PWR_CFG
;

186 
UINT32
 
Vue
;

187 
INT
 
Idx
;

188 
UINT8
 
PhyMode
;

189 
CHAR
 
CurTxPwr
;

190 
UINT8
 
TxPwrRef
 = 0;

191 
CHAR
 
DPwr
;

192 
ULONG
 
TxPwr
[5];

195 
TX_PWR_CFG
 
TxPwrCfg
[] = {

196 {
MODE_CCK
, 0, 0, 4, 0x000000f0},

197 {
MODE_CCK
, 1, 0, 0, 0x0000000f},

198 {
MODE_CCK
, 2, 0, 12, 0x0000f000},

199 {
MODE_CCK
, 3, 0, 8, 0x00000f00},

201 {
MODE_OFDM
, 0, 0, 20, 0x00f00000},

202 {
MODE_OFDM
, 1, 0, 16, 0x000f0000},

203 {
MODE_OFDM
, 2, 0, 28, 0xf0000000},

204 {
MODE_OFDM
, 3, 0, 24, 0x0f000000},

205 {
MODE_OFDM
, 4, 1, 4, 0x000000f0},

206 {
MODE_OFDM
, 5, 1, 0, 0x0000000f},

207 {
MODE_OFDM
, 6, 1, 12, 0x0000f000},

208 {
MODE_OFDM
, 7, 1, 8, 0x00000f00}

209 #ifde
DOT11_N_SUPPORT


210 ,{
MODE_HTMIX
, 0, 1, 20, 0x00f00000},

211 {
MODE_HTMIX
, 1, 1, 16, 0x000f0000},

212 {
MODE_HTMIX
, 2, 1, 28, 0xf0000000},

213 {
MODE_HTMIX
, 3, 1, 24, 0x0f000000},

214 {
MODE_HTMIX
, 4, 2, 4, 0x000000f0},

215 {
MODE_HTMIX
, 5, 2, 0, 0x0000000f},

216 {
MODE_HTMIX
, 6, 2, 12, 0x0000f000},

217 {
MODE_HTMIX
, 7, 2, 8, 0x00000f00},

218 {
MODE_HTMIX
, 8, 2, 20, 0x00f00000},

219 {
MODE_HTMIX
, 9, 2, 16, 0x000f0000},

220 {
MODE_HTMIX
, 10, 2, 28, 0xf0000000},

221 {
MODE_HTMIX
, 11, 2, 24, 0x0f000000},

222 {
MODE_HTMIX
, 12, 3, 4, 0x000000f0},

223 {
MODE_HTMIX
, 13, 3, 0, 0x0000000f},

224 {
MODE_HTMIX
, 14, 3, 12, 0x0000f000},

225 {
MODE_HTMIX
, 15, 3, 8, 0x00000f00}

228 
	#MAX_TXPWR_TAB_SIZE
 ((
TxPwrCfg
/ (
TX_PWR_CFG
))

	)

230 #ifde
SINGLE_SKU


231 
CurTxPwr
 = 
pAd
->
CommCfg
.
DefeMaxTxPwr
;

233 
CurTxPwr
 = 19;

237 i(
pAd
->
CommCfg
.
TxPowPage
 > 90)

239 i(
pAd
->
CommCfg
.
TxPowPage
 > 60)

240 
CurTxPwr
 -= 1;

241 i(
pAd
->
CommCfg
.
TxPowPage
 > 30)

242 
CurTxPwr
 -= 3;

243 i(
pAd
->
CommCfg
.
TxPowPage
 > 15)

244 
CurTxPwr
 -= 6;

245 i(
pAd
->
CommCfg
.
TxPowPage
 > 9)

246 
CurTxPwr
 -= 9;

248 
CurTxPwr
 -= 12;

250 i(
pAd
->
CommCfg
.
BBPCutBW
 =
BW_40
)

252 i(
pAd
->
CommCfg
.
CChl
 > 14)

254 
TxPwr
[0] = 
pAd
->
Tx40MPwrCfgABd
[0];

255 
TxPwr
[1] = 
pAd
->
Tx40MPwrCfgABd
[1];

256 
TxPwr
[2] = 
pAd
->
Tx40MPwrCfgABd
[2];

257 
TxPwr
[3] = 
pAd
->
Tx40MPwrCfgABd
[3];

258 
TxPwr
[4] = 
pAd
->
Tx40MPwrCfgABd
[4];

262 
TxPwr
[0] = 
pAd
->
Tx40MPwrCfgGBd
[0];

263 
TxPwr
[1] = 
pAd
->
Tx40MPwrCfgGBd
[1];

264 
TxPwr
[2] = 
pAd
->
Tx40MPwrCfgGBd
[2];

265 
TxPwr
[3] = 
pAd
->
Tx40MPwrCfgGBd
[3];

266 
TxPwr
[4] = 
pAd
->
Tx40MPwrCfgGBd
[4];

271 i(
pAd
->
CommCfg
.
Chl
 > 14)

273 
TxPwr
[0] = 
pAd
->
Tx20MPwrCfgABd
[0];

274 
TxPwr
[1] = 
pAd
->
Tx20MPwrCfgABd
[1];

275 
TxPwr
[2] = 
pAd
->
Tx20MPwrCfgABd
[2];

276 
TxPwr
[3] = 
pAd
->
Tx20MPwrCfgABd
[3];

277 
TxPwr
[4] = 
pAd
->
Tx20MPwrCfgABd
[4];

281 
TxPwr
[0] = 
pAd
->
Tx20MPwrCfgGBd
[0];

282 
TxPwr
[1] = 
pAd
->
Tx20MPwrCfgGBd
[1];

283 
TxPwr
[2] = 
pAd
->
Tx20MPwrCfgGBd
[2];

284 
TxPwr
[3] = 
pAd
->
Tx20MPwrCfgGBd
[3];

285 
TxPwr
[4] = 
pAd
->
Tx20MPwrCfgGBd
[4];

290 
HTTxMode
.
fld
.
MODE
)

292 
MODE_CCK
:

293 
MODE_OFDM
:

294 
Vue
 = 
TxPwr
[1];

295 
TxPwrRef
 = (
Vue
 & 0x00000f00) >> 8;

299 #ifde
DOT11_N_SUPPORT


300 
MODE_HTMIX
:

301 
MODE_HTGREENFIELD
:

302 i(
pAd
->
CommCfg
.
TxSm
 == 1)

304 
Vue
 = 
TxPwr
[2];

305 
TxPwrRef
 = (
Vue
 & 0x00000f00) >> 8;

307 i(
pAd
->
CommCfg
.
TxSm
 == 2)

309 
Vue
 = 
TxPwr
[3];

310 
TxPwrRef
 = (
Vue
 & 0x00000f00) >> 8;

316 
PhyMode
 =

317 #ifde
DOT11_N_SUPPORT


318 (
HTTxMode
.
fld
.
MODE
 =
MODE_HTGREENFIELD
)

319 ? 
MODE_HTMIX
 :

321 
HTTxMode
.
fld
.
MODE
;

323 
Idx
 = 0; Idx < 
MAX_TXPWR_TAB_SIZE
; Idx++)

325 i((
TxPwrCfg
[
Idx
].
Mode
 =
PhyMode
)

326 && (
TxPwrCfg
[
Idx
].
MCS
 =
HTTxMode
.
fld
.MCS))

328 
Vue
 = 
TxPwr
[
TxPwrCfg
[
Idx
].
q
];

329 
DPwr
 = 
TxPwrRef
 - (
CHAR
)((
Vue
 & 
TxPwrCfg
[
Idx
].
BMask
)

330 >> 
TxPwrCfg
[
Idx
].
shi
);

331 
CurTxPwr
 -
DPwr
;

336  
CurTxPwr
;

337 
	}
}

340 
NDIS_STATUS
 
	$MsuReqTabIn
(

341 
IN
 
PRTMP_ADAPTER
 
pAd
)

343 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

345 
	`NdisAoSpLock
(&
pAd
->
CommCfg
.
MsuReqTabLock
);

347 
pAd
->
CommCfg
.
pMsuReqTab
 = 
	`kmloc
((
MEASURE_REQ_TAB
), 
GFP_ATOMIC
);

348 i(
pAd
->
CommCfg
.
pMsuReqTab
)

349 
	`NdisZoMemy
(
pAd
->
CommCfg
.
pMsuReqTab
, (
MEASURE_REQ_TAB
));

352 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%Faخlomemy f܅Ad->CommCfg.pMsuReqTab.\n", 
__FUNCTION__
));

353 
Stus
 = 
NDIS_STATUS_FAILURE
;

356  
Stus
;

357 
	}
}

359 
VOID
 
	$MsuReqTabEx
(

360 
IN
 
PRTMP_ADAPTER
 
pAd
)

362 
	`NdisFeSpLock
(&
pAd
->
CommCfg
.
MsuReqTabLock
);

364 i(
pAd
->
CommCfg
.
pMsuReqTab
)

365 
	`k
(
pAd
->
CommCfg
.
pMsuReqTab
);

366 
pAd
->
CommCfg
.
pMsuReqTab
 = 
NULL
;

369 
	}
}

371 
PMEASURE_REQ_ENTRY
 
	$MsuReqLookUp
(

372 
IN
 
PRTMP_ADAPTER
 
pAd
,

373 
IN
 
UINT8
 
DlogTok
)

375 
UINT
 
HashIdx
;

376 
PMEASURE_REQ_TAB
 
pTab
 = 
pAd
->
CommCfg
.
pMsuReqTab
;

377 
PMEASURE_REQ_ENTRY
 
pEry
 = 
NULL
;

378 
PMEASURE_REQ_ENTRY
 
pPvEry
 = 
NULL
;

380 i(
pTab
 =
NULL
)

382 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:MsuReqTab dۢ'exi.\n", 
__FUNCTION__
));

383  
NULL
;

386 
	`RTMP_SEM_LOCK
(&
pAd
->
CommCfg
.
MsuReqTabLock
);

388 
HashIdx
 = 
	`MQ_DIALOGTOKEN_HASH_INDEX
(
DlogTok
);

389 
pEry
 = 
pTab
->
Hash
[
HashIdx
];

391 
pEry
)

393 i(
pEry
->
DlogTok
 == DialogToken)

397 
pPvEry
 = 
pEry
;

398 
pEry
 =Ery->
pNext
;

402 
	`RTMP_SEM_UNLOCK
(&
pAd
->
CommCfg
.
MsuReqTabLock
);

404  
pEry
;

405 
	}
}

407 
PMEASURE_REQ_ENTRY
 
	$MsuReqIn
(

408 
IN
 
PRTMP_ADAPTER
 
pAd
,

409 
IN
 
UINT8
 
DlogTok
)

411 
INT
 
i
;

412 
ULONG
 
HashIdx
;

413 
PMEASURE_REQ_TAB
 
pTab
 = 
pAd
->
CommCfg
.
pMsuReqTab
;

414 
PMEASURE_REQ_ENTRY
 
pEry
 = 
NULL
, 
pCuEry
;

415 
ULONG
 
Now
;

417 if(
pTab
 =
NULL
)

419 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:MsuReqTab dۢ'exi.\n", 
__FUNCTION__
));

420  
NULL
;

423 
pEry
 = 
	`MsuReqLookUp
(
pAd
, 
DlogTok
);

424 i(
pEry
 =
NULL
)

426 
	`RTMP_SEM_LOCK
(&
pAd
->
CommCfg
.
MsuReqTabLock
);

427 
i
 = 0; i < 
MAX_MEASURE_REQ_TAB_SIZE
; i++)

429 
	`NdisGSyemUpTime
(&
Now
);

430 
pEry
 = &
pTab
->
Cڋ
[
i
];

432 i((
pEry
->
Vid
 =
TRUE
)

433 && 
	`RTMP_TIME_AFTER
(()
Now
, ()(
pEry
->
ϡTime
 + 
MQ_REQ_AGE_OUT
)))

435 
PMEASURE_REQ_ENTRY
 
pPvEry
 = 
NULL
;

436 
ULONG
 
HashIdx
 = 
	`MQ_DIALOGTOKEN_HASH_INDEX
(
pEry
->
DlogTok
);

437 
PMEASURE_REQ_ENTRY
 
pProbeEry
 = 
pTab
->
Hash
[
HashIdx
];

442 i(
pProbeEry
 =
pEry
)

444 i(
pPvEry
 =
NULL
)

446 
pTab
->
Hash
[
HashIdx
] = 
pEry
->
pNext
;

450 
pPvEry
->
pNext
 = 
pEry
->pNext;

455 
pPvEry
 = 
pProbeEry
;

456 
pProbeEry
 =ProbeEry->
pNext
;

457 } 
pProbeEry
);

459 
	`NdisZoMemy
(
pEry
, (
MEASURE_REQ_ENTRY
));

460 
pTab
->
Size
--;

465 i(
pEry
->
Vid
 =
FALSE
)

469 i(
i
 < 
MAX_MEASURE_REQ_TAB_SIZE
)

471 
	`NdisGSyemUpTime
(&
Now
);

472 
pEry
->
ϡTime
 = 
Now
;

473 
pEry
->
Vid
 = 
TRUE
;

474 
pEry
->
DlogTok
 = DialogToken;

475 
pTab
->
Size
++;

479 
pEry
 = 
NULL
;

480 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:MsuReqTabab fu.\n", 
__FUNCTION__
));

484 i(
pEry
)

486 
HashIdx
 = 
	`MQ_DIALOGTOKEN_HASH_INDEX
(
DlogTok
);

487 i(
pTab
->
Hash
[
HashIdx
] =
NULL
)

489 
pTab
->
Hash
[
HashIdx
] = 
pEry
;

493 
pCuEry
 = 
pTab
->
Hash
[
HashIdx
];

494 
pCuEry
->
pNext
 !
NULL
)

495 
pCuEry
 =CuEry->
pNext
;

496 
pCuEry
->
pNext
 = 
pEry
;

500 
	`RTMP_SEM_UNLOCK
(&
pAd
->
CommCfg
.
MsuReqTabLock
);

503  
pEry
;

504 
	}
}

506 
VOID
 
	$MsuReqDe
(

507 
IN
 
PRTMP_ADAPTER
 
pAd
,

508 
IN
 
UINT8
 
DlogTok
)

510 
PMEASURE_REQ_TAB
 
pTab
 = 
pAd
->
CommCfg
.
pMsuReqTab
;

511 
PMEASURE_REQ_ENTRY
 
pEry
 = 
NULL
;

513 if(
pTab
 =
NULL
)

515 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:MsuReqTab dۢ'exi.\n", 
__FUNCTION__
));

520 i(
pTab
->
Size
 == 0)

522 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("pMeasureReqTabmpty.\n"));

526 
pEry
 = 
	`MsuReqLookUp
(
pAd
, 
DlogTok
);

527 i(
pEry
 !
NULL
)

529 
PMEASURE_REQ_ENTRY
 
pPvEry
 = 
NULL
;

530 
ULONG
 
HashIdx
 = 
	`MQ_DIALOGTOKEN_HASH_INDEX
(
pEry
->
DlogTok
);

531 
PMEASURE_REQ_ENTRY
 
pProbeEry
 = 
pTab
->
Hash
[
HashIdx
];

533 
	`RTMP_SEM_LOCK
(&
pAd
->
CommCfg
.
MsuReqTabLock
);

537 i(
pProbeEry
 =
pEry
)

539 i(
pPvEry
 =
NULL
)

541 
pTab
->
Hash
[
HashIdx
] = 
pEry
->
pNext
;

545 
pPvEry
->
pNext
 = 
pEry
->pNext;

550 
pPvEry
 = 
pProbeEry
;

551 
pProbeEry
 =ProbeEry->
pNext
;

552 } 
pProbeEry
);

554 
	`NdisZoMemy
(
pEry
, (
MEASURE_REQ_ENTRY
));

555 
pTab
->
Size
--;

557 
	`RTMP_SEM_UNLOCK
(&
pAd
->
CommCfg
.
MsuReqTabLock
);

561 
	}
}

563 
NDIS_STATUS
 
	$TpcReqTabIn
(

564 
IN
 
PRTMP_ADAPTER
 
pAd
)

566 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

568 
	`NdisAoSpLock
(&
pAd
->
CommCfg
.
TpcReqTabLock
);

570 
pAd
->
CommCfg
.
pTpcReqTab
 = 
	`kmloc
((
TPC_REQ_TAB
), 
GFP_ATOMIC
);

571 i(
pAd
->
CommCfg
.
pTpcReqTab
)

572 
	`NdisZoMemy
(
pAd
->
CommCfg
.
pTpcReqTab
, (
TPC_REQ_TAB
));

575 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%Faخlomemy f܅Ad->CommCfg.pTpcReqTab.\n", 
__FUNCTION__
));

576 
Stus
 = 
NDIS_STATUS_FAILURE
;

579  
Stus
;

580 
	}
}

582 
VOID
 
	$TpcReqTabEx
(

583 
IN
 
PRTMP_ADAPTER
 
pAd
)

585 
	`NdisFeSpLock
(&
pAd
->
CommCfg
.
TpcReqTabLock
);

587 i(
pAd
->
CommCfg
.
pTpcReqTab
)

588 
	`k
(
pAd
->
CommCfg
.
pTpcReqTab
);

589 
pAd
->
CommCfg
.
pTpcReqTab
 = 
NULL
;

592 
	}
}

594 
PTPC_REQ_ENTRY
 
	$TpcReqLookUp
(

595 
IN
 
PRTMP_ADAPTER
 
pAd
,

596 
IN
 
UINT8
 
DlogTok
)

598 
UINT
 
HashIdx
;

599 
PTPC_REQ_TAB
 
pTab
 = 
pAd
->
CommCfg
.
pTpcReqTab
;

600 
PTPC_REQ_ENTRY
 
pEry
 = 
NULL
;

601 
PTPC_REQ_ENTRY
 
pPvEry
 = 
NULL
;

603 i(
pTab
 =
NULL
)

605 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:TpcReqTab dۢ'exi.\n", 
__FUNCTION__
));

606  
NULL
;

609 
	`RTMP_SEM_LOCK
(&
pAd
->
CommCfg
.
TpcReqTabLock
);

611 
HashIdx
 = 
	`TPC_DIALOGTOKEN_HASH_INDEX
(
DlogTok
);

612 
pEry
 = 
pTab
->
Hash
[
HashIdx
];

614 
pEry
)

616 i(
pEry
->
DlogTok
 == DialogToken)

620 
pPvEry
 = 
pEry
;

621 
pEry
 =Ery->
pNext
;

625 
	`RTMP_SEM_UNLOCK
(&
pAd
->
CommCfg
.
TpcReqTabLock
);

627  
pEry
;

628 
	}
}

631 
PTPC_REQ_ENTRY
 
	$TpcReqIn
(

632 
IN
 
PRTMP_ADAPTER
 
pAd
,

633 
IN
 
UINT8
 
DlogTok
)

635 
INT
 
i
;

636 
ULONG
 
HashIdx
;

637 
PTPC_REQ_TAB
 
pTab
 = 
pAd
->
CommCfg
.
pTpcReqTab
;

638 
PTPC_REQ_ENTRY
 
pEry
 = 
NULL
, 
pCuEry
;

639 
ULONG
 
Now
;

641 if(
pTab
 =
NULL
)

643 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:TpcReqTab dۢ'exi.\n", 
__FUNCTION__
));

644  
NULL
;

647 
pEry
 = 
	`TpcReqLookUp
(
pAd
, 
DlogTok
);

648 i(
pEry
 =
NULL
)

650 
	`RTMP_SEM_LOCK
(&
pAd
->
CommCfg
.
TpcReqTabLock
);

651 
i
 = 0; i < 
MAX_TPC_REQ_TAB_SIZE
; i++)

653 
	`NdisGSyemUpTime
(&
Now
);

654 
pEry
 = &
pTab
->
Cڋ
[
i
];

656 i((
pEry
->
Vid
 =
TRUE
)

657 && 
	`RTMP_TIME_AFTER
(()
Now
, ()(
pEry
->
ϡTime
 + 
TPC_REQ_AGE_OUT
)))

659 
PTPC_REQ_ENTRY
 
pPvEry
 = 
NULL
;

660 
ULONG
 
HashIdx
 = 
	`TPC_DIALOGTOKEN_HASH_INDEX
(
pEry
->
DlogTok
);

661 
PTPC_REQ_ENTRY
 
pProbeEry
 = 
pTab
->
Hash
[
HashIdx
];

666 i(
pProbeEry
 =
pEry
)

668 i(
pPvEry
 =
NULL
)

670 
pTab
->
Hash
[
HashIdx
] = 
pEry
->
pNext
;

674 
pPvEry
->
pNext
 = 
pEry
->pNext;

679 
pPvEry
 = 
pProbeEry
;

680 
pProbeEry
 =ProbeEry->
pNext
;

681 } 
pProbeEry
);

683 
	`NdisZoMemy
(
pEry
, (
TPC_REQ_ENTRY
));

684 
pTab
->
Size
--;

689 i(
pEry
->
Vid
 =
FALSE
)

693 i(
i
 < 
MAX_TPC_REQ_TAB_SIZE
)

695 
	`NdisGSyemUpTime
(&
Now
);

696 
pEry
->
ϡTime
 = 
Now
;

697 
pEry
->
Vid
 = 
TRUE
;

698 
pEry
->
DlogTok
 = DialogToken;

699 
pTab
->
Size
++;

703 
pEry
 = 
NULL
;

704 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:TpcReqTabab fu.\n", 
__FUNCTION__
));

708 i(
pEry
)

710 
HashIdx
 = 
	`TPC_DIALOGTOKEN_HASH_INDEX
(
DlogTok
);

711 i(
pTab
->
Hash
[
HashIdx
] =
NULL
)

713 
pTab
->
Hash
[
HashIdx
] = 
pEry
;

717 
pCuEry
 = 
pTab
->
Hash
[
HashIdx
];

718 
pCuEry
->
pNext
 !
NULL
)

719 
pCuEry
 =CuEry->
pNext
;

720 
pCuEry
->
pNext
 = 
pEry
;

724 
	`RTMP_SEM_UNLOCK
(&
pAd
->
CommCfg
.
TpcReqTabLock
);

727  
pEry
;

728 
	}
}

730 
VOID
 
	$TpcReqDe
(

731 
IN
 
PRTMP_ADAPTER
 
pAd
,

732 
IN
 
UINT8
 
DlogTok
)

734 
PTPC_REQ_TAB
 
pTab
 = 
pAd
->
CommCfg
.
pTpcReqTab
;

735 
PTPC_REQ_ENTRY
 
pEry
 = 
NULL
;

737 if(
pTab
 =
NULL
)

739 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:TpcReqTab dۢ'exi.\n", 
__FUNCTION__
));

744 i(
pTab
->
Size
 == 0)

746 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("pTpcReqTabmpty.\n"));

750 
pEry
 = 
	`TpcReqLookUp
(
pAd
, 
DlogTok
);

751 i(
pEry
 !
NULL
)

753 
PTPC_REQ_ENTRY
 
pPvEry
 = 
NULL
;

754 
ULONG
 
HashIdx
 = 
	`TPC_DIALOGTOKEN_HASH_INDEX
(
pEry
->
DlogTok
);

755 
PTPC_REQ_ENTRY
 
pProbeEry
 = 
pTab
->
Hash
[
HashIdx
];

757 
	`RTMP_SEM_LOCK
(&
pAd
->
CommCfg
.
TpcReqTabLock
);

761 i(
pProbeEry
 =
pEry
)

763 i(
pPvEry
 =
NULL
)

765 
pTab
->
Hash
[
HashIdx
] = 
pEry
->
pNext
;

769 
pPvEry
->
pNext
 = 
pEry
->pNext;

774 
pPvEry
 = 
pProbeEry
;

775 
pProbeEry
 =ProbeEry->
pNext
;

776 } 
pProbeEry
);

778 
	`NdisZoMemy
(
pEry
, (
TPC_REQ_ENTRY
));

779 
pTab
->
Size
--;

781 
	`RTMP_SEM_UNLOCK
(&
pAd
->
CommCfg
.
TpcReqTabLock
);

785 
	}
}

797 
UINT64
 
	$GCutTimeSmp
(

798 
IN
 
PRTMP_ADAPTER
 
pAd
)

802 
	}
}

814 
UINT8
 
	$GCurTxPwr
(

815 
IN
 
PRTMP_ADAPTER
 
pAd
,

816 
IN
 
UINT8
 
Wcid
)

819 
	}
}

831 
VOID
 
	$InChlRIE
(

832 
IN
 
PRTMP_ADAPTER
 
pAd
,

833 
OUT
 
PUCHAR
 
pFmeBuf
,

834 
OUT
 
PULONG
 
pFmeL
,

835 
IN
 
PSTRING
 
pCoury
,

836 
IN
 
UINT8
 
RegutyCss
)

838 
ULONG
 
TempL
;

839 
UINT8
 
L
;

840 
UINT8
 
IEId
 = 
IE_AP_CHANNEL_REPORT
;

841 
PUCHAR
 
pChLiP
 = 
NULL
;

842 
PDOT11_CHANNEL_SET
 
pChlS
 = 
NULL
;

844 
L
 = 1;

845 i(
	`cmp
(
pCoury
, "US", 2) == 0)

847 i(
RegutyCss
 >
USA_REGULATORY_INFO_SIZE
)

849 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: USA Unknow Requlatory class (%d)\n",

850 
__FUNCTION__
, 
RegutyCss
));

853 
pChlS
 = &
USARegutyInfo
[
RegutyCss
].
ChlS
;

855 i(
	`cmp
(
pCoury
, "JP", 2) == 0)

857 i(
RegutyCss
 >
JP_REGULATORY_INFO_SIZE
)

859 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: JP Unknow Requlatory class (%d)\n",

860 
__FUNCTION__
, 
RegutyCss
));

864 
pChlS
 = &
JRegutyInfo
[
RegutyCss
].
ChlS
;

868 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: Unknow Country (%s)\n",

869 
__FUNCTION__
, 
pCoury
));

874 i(
pChlS
 =
NULL
)

878 i(
pChlS
->
NumbOfChls
 == 0)

881 
L
 +
pChlS
->
NumbOfChls
;

882 
pChLiP
 = 
pChlS
->
ChlLi
;

884 i(
L
 > 1)

886 
	`MakeOutgogFme
(
pFmeBuf
, &
TempL
,

887 1, &
IEId
,

888 1, &
L
,

889 1, &
RegutyCss
,

890 
L
 -1, 
pChLiP
,

891 
END_OF_ARGS
);

893 *
pFmeL
 = *pFmeL + 
TempL
;

896 
	}
}

911 
VOID
 
	$InDlogTok
(

912 
IN
 
PRTMP_ADAPTER
 
pAd
,

913 
OUT
 
PUCHAR
 
pFmeBuf
,

914 
OUT
 
PULONG
 
pFmeL
,

915 
IN
 
UINT8
 
DlogTok
)

917 
ULONG
 
TempL
;

918 
	`MakeOutgogFme
(
pFmeBuf
, &
TempL
,

919 1, &
DlogTok
,

920 
END_OF_ARGS
);

922 *
pFmeL
 = *pFmeL + 
TempL
;

925 
	}
}

939 
VOID
 
	$InTpcReqIE
(

940 
IN
 
PRTMP_ADAPTER
 
pAd
,

941 
OUT
 
PUCHAR
 
pFmeBuf
,

942 
OUT
 
PULONG
 
pFmeL
)

944 
ULONG
 
TempL
;

945 
UINT8
 
L
 = 0;

946 
UINT8
 
EmtID
 = 
IE_TPC_REQUEST
;

948 
	`MakeOutgogFme
(
pFmeBuf
, &
TempL
,

949 1, &
EmtID
,

950 1, &
L
,

951 
END_OF_ARGS
);

953 *
pFmeL
 = *pFmeL + 
TempL
;

956 
	}
}

972 
VOID
 
	$InTpcRtIE
(

973 
IN
 
PRTMP_ADAPTER
 
pAd
,

974 
OUT
 
PUCHAR
 
pFmeBuf
,

975 
OUT
 
PULONG
 
pFmeL
,

976 
IN
 
UINT8
 
TxPwr
,

977 
IN
 
UINT8
 
LkMg
)

979 
ULONG
 
TempL
;

980 
UINT8
 
L
 = (
TPC_REPORT_INFO
);

981 
UINT8
 
EmtID
 = 
IE_TPC_REPORT
;

982 
TPC_REPORT_INFO
 
TpcRtIE
;

984 
TpcRtIE
.
TxPwr
 = TxPwr;

985 
TpcRtIE
.
LkMg
 = LinkMargin;

987 
	`MakeOutgogFme
(
pFmeBuf
, &
TempL
,

988 1, &
EmtID
,

989 1, &
L
,

990 
L
, &
TpcRtIE
,

991 
END_OF_ARGS
);

993 *
pFmeL
 = *pFmeL + 
TempL
;

997 
	}
}

1018 
VOID
 
	$InMsuReqIE
(

1019 
IN
 
PRTMP_ADAPTER
 
pAd
,

1020 
OUT
 
PUCHAR
 
pFmeBuf
,

1021 
OUT
 
PULONG
 
pFmeL
,

1022 
IN
 
UINT8
 
L
,

1023 
IN
 
PMEASURE_REQ_INFO
 
pMsuReqIE
)

1025 
ULONG
 
TempL
;

1026 
UINT8
 
EmtID
 = 
IE_MEASUREMENT_REQUEST
;

1028 
	`MakeOutgogFme
(
pFmeBuf
, &
TempL
,

1029 1, &
EmtID
,

1030 1, &
L
,

1031 (
MEASURE_REQ_INFO
), 
pMsuReqIE
,

1032 
END_OF_ARGS
);

1034 *
pFmeL
 = *pFmeL + 
TempL
;

1037 
	}
}

1056 
VOID
 
	$InMsuRtIE
(

1057 
IN
 
PRTMP_ADAPTER
 
pAd
,

1058 
OUT
 
PUCHAR
 
pFmeBuf
,

1059 
OUT
 
PULONG
 
pFmeL
,

1060 
IN
 
PMEASURE_REPORT_INFO
 
pMsuRtIE
,

1061 
IN
 
UINT8
 
RtLnfoL
,

1062 
IN
 
PUINT8
 
pRtInfo
)

1064 
ULONG
 
TempL
;

1065 
UINT8
 
L
;

1066 
UINT8
 
EmtID
 = 
IE_MEASUREMENT_REPORT
;

1068 
L
 = (
MEASURE_REPORT_INFO
+ 
RtLnfoL
;

1070 
	`MakeOutgogFme
(
pFmeBuf
, &
TempL
,

1071 1, &
EmtID
,

1072 1, &
L
,

1073 
L
, 
pMsuRtIE
,

1074 
END_OF_ARGS
);

1076 *
pFmeL
 = *pFmeL + 
TempL
;

1078 i((
RtLnfoL
 > 0&& (
pRtInfo
 !
NULL
))

1080 
	`MakeOutgogFme
(
pFmeBuf
 + *
pFmeL
, &
TempL
,

1081 
RtLnfoL
, 
pRtInfo
,

1082 
END_OF_ARGS
);

1084 *
pFmeL
 = *pFmeL + 
TempL
;

1087 
	}
}

1101 
VOID
 
	$MakeMsumtReqFme
(

1102 
IN
 
PRTMP_ADAPTER
 
pAd
,

1103 
OUT
 
PUCHAR
 
pOutBufr
,

1104 
OUT
 
PULONG
 
pFmeL
,

1105 
IN
 
UINT8
 
TٮL
,

1106 
IN
 
UINT8
 
Cegy
,

1107 
IN
 
UINT8
 
Ai
,

1108 
IN
 
UINT8
 
MsuTok
,

1109 
IN
 
UINT8
 
MsuReqMode
,

1110 
IN
 
UINT8
 
MsuReqTy
,

1111 
IN
 
UINT16
 
NumOfRis
)

1113 
ULONG
 
TempL
;

1114 
MEASURE_REQ_INFO
 
MsuReqIE
;

1116 
	`InAFld
(
pAd
, (
pOutBufr
 + *
pFmeL
),FmeL, 
Cegy
, 
Ai
);

1119 
	`InDlogTok
(
pAd
, (
pOutBufr
 + *
pFmeL
),FmeL, 
MsuTok
);

1122 i(
Cegy
 =
CATEGORY_RM
)

1124 
	`MakeOutgogFme
((
pOutBufr
+*
pFmeL
), &
TempL
,

1125 2, &
NumOfRis
,

1126 
END_OF_ARGS
);

1128 *
pFmeL
 +
TempL
;

1132 
	`NdisZoMemy
(&
MsuReqIE
, (
MEASURE_REQ_INFO
));

1133 
MsuReqIE
.
Tok
 = 
MsuTok
;

1134 
MsuReqIE
.
ReqMode
.
wd
 = 
MsuReqMode
;

1135 
MsuReqIE
.
ReqTy
 = 
MsuReqTy
;

1136 
	`InMsuReqIE
(
pAd
, (
pOutBufr
+*
pFmeL
),FrameLen,

1137 
TٮL
, &
MsuReqIE
);

1140 
	}
}

1154 
VOID
 
	$EnqueueMsumtR
(

1155 
IN
 
PRTMP_ADAPTER
 
pAd
,

1156 
IN
 
PUCHAR
 
pDA
,

1157 
IN
 
UINT8
 
DlogTok
,

1158 
IN
 
UINT8
 
MsuTok
,

1159 
IN
 
UINT8
 
MsuReqMode
,

1160 
IN
 
UINT8
 
MsuReqTy
,

1161 
IN
 
UINT8
 
RtInfoL
,

1162 
IN
 
PUINT8
 
pRtInfo
)

1164 
PUCHAR
 
pOutBufr
 = 
NULL
;

1165 
NDIS_STATUS
 
NStus
;

1166 
ULONG
 
FmeL
;

1167 
HEADER_802_11
 
AHdr
;

1168 
MEASURE_REPORT_INFO
 
MsuRIE
;

1171 
	`MgtMacHdIn
(
pAd
, &
AHdr
, 
SUBTYPE_ACTION
, 0, 
pDA
,

1172 
pAd
->
CutAddss
);

1174 
NStus
 = 
	`MlmeAoMemy
(
pAd
, (
PVOID
)&
pOutBufr
);

1175 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

1177 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s(lo memy faed \n", 
__FUNCTION__
));

1180 
	`NdisMoveMemy
(
pOutBufr
, (
PCHAR
)&
AHdr
, (
HEADER_802_11
));

1181 
FmeL
 = (
HEADER_802_11
);

1183 
	`InAFld
(
pAd
, (
pOutBufr
 + 
FmeL
), &FmeL, 
CATEGORY_SPECTRUM
, 
SPEC_MRP
);

1186 
	`InDlogTok
(
pAd
, (
pOutBufr
 + 
FmeL
), &FmeL, 
DlogTok
);

1189 
	`NdisZoMemy
(&
MsuRIE
, (
MEASURE_REPORT_INFO
));

1190 
MsuRIE
.
Tok
 = 
MsuTok
;

1191 
MsuRIE
.
RtMode
 = 
MsuReqMode
;

1192 
MsuRIE
.
RtTy
 = 
MsuReqTy
;

1193 
	`InMsuRtIE
(
pAd
, (
pOutBufr
 + 
FmeL
), &FmeL, &
MsuRIE
, 
RtInfoL
, 
pRtInfo
);

1195 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

1196 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1199 
	}
}

1213 
VOID
 
	$EnqueueTPCReq
(

1214 
IN
 
PRTMP_ADAPTER
 
pAd
,

1215 
IN
 
PUCHAR
 
pDA
,

1216 
IN
 
UCHAR
 
DlogTok
)

1218 
PUCHAR
 
pOutBufr
 = 
NULL
;

1219 
NDIS_STATUS
 
NStus
;

1220 
ULONG
 
FmeL
;

1222 
HEADER_802_11
 
AHdr
;

1225 
	`MgtMacHdIn
(
pAd
, &
AHdr
, 
SUBTYPE_ACTION
, 0, 
pDA
,

1226 
pAd
->
CutAddss
);

1228 
NStus
 = 
	`MlmeAoMemy
(
pAd
, (
PVOID
)&
pOutBufr
);

1229 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

1231 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s(lo memy faed \n", 
__FUNCTION__
));

1234 
	`NdisMoveMemy
(
pOutBufr
, (
PCHAR
)&
AHdr
, (
HEADER_802_11
));

1235 
FmeL
 = (
HEADER_802_11
);

1237 
	`InAFld
(
pAd
, (
pOutBufr
 + 
FmeL
), &FmeL, 
CATEGORY_SPECTRUM
, 
SPEC_TPCRQ
);

1240 
	`InDlogTok
(
pAd
, (
pOutBufr
 + 
FmeL
), &FmeL, 
DlogTok
);

1243 
	`InTpcReqIE
(
pAd
, (
pOutBufr
 + 
FmeL
), &FrameLen);

1245 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

1246 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1249 
	}
}

1263 
VOID
 
	$EnqueueTPCR
(

1264 
IN
 
PRTMP_ADAPTER
 
pAd
,

1265 
IN
 
PUCHAR
 
pDA
,

1266 
IN
 
UINT8
 
DlogTok
,

1267 
IN
 
UINT8
 
TxPwr
,

1268 
IN
 
UINT8
 
LkMg
)

1270 
PUCHAR
 
pOutBufr
 = 
NULL
;

1271 
NDIS_STATUS
 
NStus
;

1272 
ULONG
 
FmeL
;

1274 
HEADER_802_11
 
AHdr
;

1277 
	`MgtMacHdIn
(
pAd
, &
AHdr
, 
SUBTYPE_ACTION
, 0, 
pDA
,

1278 
pAd
->
CutAddss
);

1280 
NStus
 = 
	`MlmeAoMemy
(
pAd
, (
PVOID
)&
pOutBufr
);

1281 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

1283 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s(lo memy faed \n", 
__FUNCTION__
));

1286 
	`NdisMoveMemy
(
pOutBufr
, (
PCHAR
)&
AHdr
, (
HEADER_802_11
));

1287 
FmeL
 = (
HEADER_802_11
);

1289 
	`InAFld
(
pAd
, (
pOutBufr
 + 
FmeL
), &FmeL, 
CATEGORY_SPECTRUM
, 
SPEC_TPCRP
);

1292 
	`InDlogTok
(
pAd
, (
pOutBufr
 + 
FmeL
), &FmeL, 
DlogTok
);

1295 
	`InTpcRtIE
(
pAd
, (
pOutBufr
 + 
FmeL
), &FmeL, 
TxPwr
, 
LkMg
);

1297 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

1298 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1301 
	}
}

1303 #ifde
WDS_SUPPORT


1319 
VOID
 
	$InChSwAIE
(

1320 
IN
 
PRTMP_ADAPTER
 
pAd
,

1321 
OUT
 
PUCHAR
 
pFmeBuf
,

1322 
OUT
 
PULONG
 
pFmeL
,

1323 
IN
 
UINT8
 
ChSwMode
,

1324 
IN
 
UINT8
 
NewChl
,

1325 
IN
 
UINT8
 
ChSwC
)

1327 
ULONG
 
TempL
;

1328 
ULONG
 
L
 = (
CH_SW_ANN_INFO
);

1329 
UINT8
 
EmtID
 = 
IE_CHANNEL_SWITCH_ANNOUNCEMENT
;

1330 
CH_SW_ANN_INFO
 
ChSwAIE
;

1332 
ChSwAIE
.
ChSwMode
 = ChSwMode;

1333 
ChSwAIE
.
Chl
 = 
NewChl
;

1334 
ChSwAIE
.
ChSwC
 = ChSwCnt;

1336 
	`MakeOutgogFme
(
pFmeBuf
, &
TempL
,

1337 1, &
EmtID
,

1338 1, &
L
,

1339 
L
, &
ChSwAIE
,

1340 
END_OF_ARGS
);

1342 *
pFmeL
 = *pFmeL + 
TempL
;

1346 
	}
}

1362 
VOID
 
	$EnqueueChSwA
(

1363 
IN
 
PRTMP_ADAPTER
 
pAd
,

1364 
IN
 
PUCHAR
 
pDA
,

1365 
IN
 
UINT8
 
ChSwMode
,

1366 
IN
 
UINT8
 
NewCh
)

1368 
PUCHAR
 
pOutBufr
 = 
NULL
;

1369 
NDIS_STATUS
 
NStus
;

1370 
ULONG
 
FmeL
;

1372 
HEADER_802_11
 
AHdr
;

1375 
	`MgtMacHdIn
(
pAd
, &
AHdr
, 
SUBTYPE_ACTION
, 0, 
pDA
,

1376 
pAd
->
CutAddss
);

1378 
NStus
 = 
	`MlmeAoMemy
(
pAd
, (
PVOID
)&
pOutBufr
);

1379 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

1381 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s(lo memy faed \n", 
__FUNCTION__
));

1384 
	`NdisMoveMemy
(
pOutBufr
, (
PCHAR
)&
AHdr
, (
HEADER_802_11
));

1385 
FmeL
 = (
HEADER_802_11
);

1387 
	`InAFld
(
pAd
, (
pOutBufr
 + 
FmeL
), &FmeL, 
CATEGORY_SPECTRUM
, 
SPEC_CHANNEL_SWITCH
);

1389 
	`InChSwAIE
(
pAd
, (
pOutBufr
 + 
FmeL
), &FmeL, 
ChSwMode
, 
NewCh
, 0);

1391 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

1392 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1395 
	}
}

1398 
BOOLEAN
 
	$DfsRequemtCheck
(

1399 
IN
 
PRTMP_ADAPTER
 
pAd
,

1400 
IN
 
UINT8
 
Chl
)

1402 
BOOLEAN
 
Resu
 = 
FALSE
;

1403 
INT
 
i
;

1409 i(
pAd
->
CommCfg
.
RadDe
.
RDMode
 !
RD_NORMAL_MODE
)

1411 
Resu
 = 
FALSE
;

1416 
i
=0; i<
pAd
->
ChlLiNum
; i++)

1418 i((
Chl
 =
pAd
->
ChlLi
[
i
].Channel)

1419 &&(
pAd
->
ChlLi
[
i
].
RemagTimeFU
 == 0))

1422 
pAd
->
ChlLi
[
i
].
RemagTimeFU
 = 1800;

1423 
Resu
 = 
TRUE
;

1427 } 
FALSE
);

1429  
Resu
;

1430 
	}
}

1432 
VOID
 
	$NifyChSwAToPrAPs
(

1433 
IN
 
PRTMP_ADAPTER
 
pAd
,

1434 
IN
 
PUCHAR
 
pRA
,

1435 
IN
 
PUCHAR
 
pTA
,

1436 
IN
 
UINT8
 
ChSwMode
,

1437 
IN
 
UINT8
 
Chl
)

1439 #ifde
WDS_SUPPORT


1440 i(!((
pRA
[0] & 0xff) == 0xff))

1442 
INT
 
i
;

1444 
i
 = 0; i < 
MAX_WDS_ENTRY
; i++)

1446 i(
	`VidWdsEry
(
pAd
, 
i
))

1448 
PUCHAR
 
pDA
 = 
pAd
->
WdsTab
.
WdsEry
[
i
].
PrWdsAddr
;

1451 i(
	`MAC_ADDR_EQUAL
(
pTA
, 
pDA
))

1455 
	`EnqueueChSwA
(
pAd
, 
pDA
, 
ChSwMode
, 
Chl
);

1460 
	}
}

1462 
VOID
 
	$SDFSProdu
(

1463 
IN
 
PRTMP_ADAPTER
 
pAd
,

1464 
IN
 
UCHAR
 
Chl
,

1465 
IN
 
UINT8
 
ChSwMode
)

1468 
pAd
->
CommCfg
.
Chl
 = Channel;

1469 #ifde
DOT11_N_SUPPORT


1470 
	`N_ChlCheck
(
pAd
);

1472 
pAd
->
CommCfg
.
RadDe
.
RDMode
 = 
RD_SWITCHING_MODE
;

1473 
pAd
->
CommCfg
.
RadDe
.
CSCou
 = 0;

1474 
	}
}

1498 
BOOLEAN
 
	$PrChSwASy
(

1499 
IN
 
PRTMP_ADAPTER
 
pAd
,

1500 
IN
 
VOID
 *
pMsg
,

1501 
IN
 
ULONG
 
MsgL
,

1502 
OUT
 
PCH_SW_ANN_INFO
 
pChSwAInfo
)

1504 
PFRAME_802_11
 
Fr
 = (PFRAME_802_11)
pMsg
;

1505 
PUCHAR
 
pFmeP
 = 
Fr
->
O
;

1506 
BOOLEAN
 
su
 = 
FALSE
;

1507 
PEID_STRUCT
 
eid_r
;

1510 
MsgL
 -(
HEADER_802_11
);

1513 
pFmeP
 += 2;

1514 
MsgL
 -= 2;

1516 i(
pChSwAInfo
 =
NULL
)

1517  
su
;

1519 
eid_r
 = (
PEID_STRUCT
)
pFmeP
;

1520 ((
UCHAR
*)
eid_r
 +id_r->
L
 + 1< ((
PUCHAR
)
pFmeP
 + 
MsgL
))

1522 
eid_r
->
Eid
)

1524 
IE_CHANNEL_SWITCH_ANNOUNCEMENT
:

1525 
	`NdisMoveMemy
(&
pChSwAInfo
->
ChSwMode
, 
eid_r
->
O
, 1);

1526 
	`NdisMoveMemy
(&
pChSwAInfo
->
Chl
, 
eid_r
->
O
 + 1, 1);

1527 
	`NdisMoveMemy
(&
pChSwAInfo
->
ChSwC
, 
eid_r
->
O
 + 2, 1);

1529 
su
 = 
TRUE
;

1535 
eid_r
 = (
PEID_STRUCT
)((
UCHAR
*id_+ 2 +id_r->
L
);

1538  
su
;

1539 
	}
}

1554 
BOOLEAN
 
	$PrMsuReqSy
(

1555 
IN
 
PRTMP_ADAPTER
 
pAd
,

1556 
IN
 
VOID
 *
pMsg
,

1557 
IN
 
ULONG
 
MsgL
,

1558 
OUT
 
PUINT8
 
pDlogTok
,

1559 
OUT
 
PMEASURE_REQ_INFO
 
pMsuReqInfo
,

1560 
OUT
 
PMEASURE_REQ
 
pMsuReq
)

1562 
PFRAME_802_11
 
Fr
 = (PFRAME_802_11)
pMsg
;

1563 
PUCHAR
 
pFmeP
 = 
Fr
->
O
;

1564 
BOOLEAN
 
su
 = 
FALSE
;

1565 
PEID_STRUCT
 
eid_r
;

1566 
PUCHAR
 
r
;

1567 
UINT64
 
MsuSTime
;

1568 
UINT16
 
MsuDuti
;

1571 
MsgL
 -(
HEADER_802_11
);

1574 
pFmeP
 += 2;

1575 
MsgL
 -= 2;

1577 i(
pMsuReqInfo
 =
NULL
)

1578  
su
;

1580 
	`NdisMoveMemy
(
pDlogTok
, 
pFmeP
, 1);

1581 
pFmeP
 += 1;

1582 
MsgL
 -= 1;

1584 
eid_r
 = (
PEID_STRUCT
)
pFmeP
;

1585 ((
UCHAR
*)
eid_r
 +id_r->
L
 + 1< ((
PUCHAR
)
pFmeP
 + 
MsgL
))

1587 
eid_r
->
Eid
)

1589 
IE_MEASUREMENT_REQUEST
:

1590 
	`NdisMoveMemy
(&
pMsuReqInfo
->
Tok
, 
eid_r
->
O
, 1);

1591 
	`NdisMoveMemy
(&
pMsuReqInfo
->
ReqMode
.
wd
, 
eid_r
->
O
 + 1, 1);

1592 
	`NdisMoveMemy
(&
pMsuReqInfo
->
ReqTy
, 
eid_r
->
O
 + 2, 1);

1593 
r
 = (
PUCHAR
)(
eid_r
->
O
 + 3);

1594 
	`NdisMoveMemy
(&
pMsuReq
->
ChNum
, 
r
, 1);

1595 
	`NdisMoveMemy
(&
MsuSTime
, 
r
 + 1, 8);

1596 
pMsuReq
->
MsuSTime
 = 
	`SWAP64
(MeasureStartTime);

1597 
	`NdisMoveMemy
(&
MsuDuti
, 
r
 + 9, 2);

1598 
pMsuReq
->
MsuDuti
 = 
	`SWAP16
(MeasureDuration);

1600 
su
 = 
TRUE
;

1606 
eid_r
 = (
PEID_STRUCT
)((
UCHAR
*id_+ 2 +id_r->
L
);

1609  
su
;

1610 
	}
}

1646 
BOOLEAN
 
	$PrMsuRtSy
(

1647 
IN
 
PRTMP_ADAPTER
 
pAd
,

1648 
IN
 
VOID
 *
pMsg
,

1649 
IN
 
ULONG
 
MsgL
,

1650 
OUT
 
PUINT8
 
pDlogTok
,

1651 
OUT
 
PMEASURE_REPORT_INFO
 
pMsuRtInfo
,

1652 
OUT
 
PUINT8
 
pRtBuf
)

1654 
PFRAME_802_11
 
Fr
 = (PFRAME_802_11)
pMsg
;

1655 
PUCHAR
 
pFmeP
 = 
Fr
->
O
;

1656 
BOOLEAN
 
su
 = 
FALSE
;

1657 
PEID_STRUCT
 
eid_r
;

1658 
PUCHAR
 
r
;

1661 
MsgL
 -(
HEADER_802_11
);

1664 
pFmeP
 += 2;

1665 
MsgL
 -= 2;

1667 i(
pMsuRtInfo
 =
NULL
)

1668  
su
;

1670 
	`NdisMoveMemy
(
pDlogTok
, 
pFmeP
, 1);

1671 
pFmeP
 += 1;

1672 
MsgL
 -= 1;

1674 
eid_r
 = (
PEID_STRUCT
)
pFmeP
;

1675 ((
UCHAR
*)
eid_r
 +id_r->
L
 + 1< ((
PUCHAR
)
pFmeP
 + 
MsgL
))

1677 
eid_r
->
Eid
)

1679 
IE_MEASUREMENT_REPORT
:

1680 
	`NdisMoveMemy
(&
pMsuRtInfo
->
Tok
, 
eid_r
->
O
, 1);

1681 
	`NdisMoveMemy
(&
pMsuRtInfo
->
RtMode
, 
eid_r
->
O
 + 1, 1);

1682 
	`NdisMoveMemy
(&
pMsuRtInfo
->
RtTy
, 
eid_r
->
O
 + 2, 1);

1683 i(
pMsuRtInfo
->
RtTy
 =
RM_BASIC
)

1685 
PMEASURE_BASIC_REPORT
 
pRt
 = (PMEASURE_BASIC_REPORT)
pRtBuf
;

1686 
r
 = (
PUCHAR
)(
eid_r
->
O
 + 3);

1687 
	`NdisMoveMemy
(&
pRt
->
ChNum
, 
r
, 1);

1688 
	`NdisMoveMemy
(&
pRt
->
MsuSTime
, 
r
 + 1, 8);

1689 
	`NdisMoveMemy
(&
pRt
->
MsuDuti
, 
r
 + 9, 2);

1690 
	`NdisMoveMemy
(&
pRt
->
M
, 
r
 + 11, 1);

1693 i(
pMsuRtInfo
->
RtTy
 =
RM_CCA
)

1695 
PMEASURE_CCA_REPORT
 
pRt
 = (PMEASURE_CCA_REPORT)
pRtBuf
;

1696 
r
 = (
PUCHAR
)(
eid_r
->
O
 + 3);

1697 
	`NdisMoveMemy
(&
pRt
->
ChNum
, 
r
, 1);

1698 
	`NdisMoveMemy
(&
pRt
->
MsuSTime
, 
r
 + 1, 8);

1699 
	`NdisMoveMemy
(&
pRt
->
MsuDuti
, 
r
 + 9, 2);

1700 
	`NdisMoveMemy
(&
pRt
->
CCA_Busy_Fi
, 
r
 + 11, 1);

1703 i(
pMsuRtInfo
->
RtTy
 =
RM_RPI_HISTOGRAM
)

1705 
PMEASURE_RPI_REPORT
 
pRt
 = (PMEASURE_RPI_REPORT)
pRtBuf
;

1706 
r
 = (
PUCHAR
)(
eid_r
->
O
 + 3);

1707 
	`NdisMoveMemy
(&
pRt
->
ChNum
, 
r
, 1);

1708 
	`NdisMoveMemy
(&
pRt
->
MsuSTime
, 
r
 + 1, 8);

1709 
	`NdisMoveMemy
(&
pRt
->
MsuDuti
, 
r
 + 9, 2);

1710 
	`NdisMoveMemy
(&
pRt
->
RPI_Dsy
, 
r
 + 11, 8);

1712 
su
 = 
TRUE
;

1718 
eid_r
 = (
PEID_STRUCT
)((
UCHAR
*id_+ 2 +id_r->
L
);

1721  
su
;

1722 
	}
}

1737 
BOOLEAN
 
	$PrTpcReqSy
(

1738 
IN
 
PRTMP_ADAPTER
 
pAd
,

1739 
IN
 
VOID
 *
pMsg
,

1740 
IN
 
ULONG
 
MsgL
,

1741 
OUT
 
PUINT8
 
pDlogTok
)

1743 
PFRAME_802_11
 
Fr
 = (PFRAME_802_11)
pMsg
;

1744 
PUCHAR
 
pFmeP
 = 
Fr
->
O
;

1745 
BOOLEAN
 
su
 = 
FALSE
;

1746 
PEID_STRUCT
 
eid_r
;

1748 
MsgL
 -(
HEADER_802_11
);

1751 
pFmeP
 += 2;

1752 
MsgL
 -= 2;

1754 i(
pDlogTok
 =
NULL
)

1755  
su
;

1757 
	`NdisMoveMemy
(
pDlogTok
, 
pFmeP
, 1);

1758 
pFmeP
 += 1;

1759 
MsgL
 -= 1;

1761 
eid_r
 = (
PEID_STRUCT
)
pFmeP
;

1762 ((
UCHAR
*)
eid_r
 +id_r->
L
 + 1< ((
PUCHAR
)
pFmeP
 + 
MsgL
))

1764 
eid_r
->
Eid
)

1766 
IE_TPC_REQUEST
:

1767 
su
 = 
TRUE
;

1773 
eid_r
 = (
PEID_STRUCT
)((
UCHAR
*id_+ 2 +id_r->
L
);

1776  
su
;

1777 
	}
}

1793 
BOOLEAN
 
	$PrTpcRSy
(

1794 
IN
 
PRTMP_ADAPTER
 
pAd
,

1795 
IN
 
VOID
 *
pMsg
,

1796 
IN
 
ULONG
 
MsgL
,

1797 
OUT
 
PUINT8
 
pDlogTok
,

1798 
OUT
 
PTPC_REPORT_INFO
 
pTpcRInfo
)

1800 
PFRAME_802_11
 
Fr
 = (PFRAME_802_11)
pMsg
;

1801 
PUCHAR
 
pFmeP
 = 
Fr
->
O
;

1802 
BOOLEAN
 
su
 = 
FALSE
;

1803 
PEID_STRUCT
 
eid_r
;

1805 
MsgL
 -(
HEADER_802_11
);

1808 
pFmeP
 += 2;

1809 
MsgL
 -= 2;

1811 i(
pDlogTok
 =
NULL
)

1812  
su
;

1814 
	`NdisMoveMemy
(
pDlogTok
, 
pFmeP
, 1);

1815 
pFmeP
 += 1;

1816 
MsgL
 -= 1;

1818 
eid_r
 = (
PEID_STRUCT
)
pFmeP
;

1819 ((
UCHAR
*)
eid_r
 +id_r->
L
 + 1< ((
PUCHAR
)
pFmeP
 + 
MsgL
))

1821 
eid_r
->
Eid
)

1823 
IE_TPC_REPORT
:

1824 
	`NdisMoveMemy
(&
pTpcRInfo
->
TxPwr
, 
eid_r
->
O
, 1);

1825 
	`NdisMoveMemy
(&
pTpcRInfo
->
LkMg
, 
eid_r
->
O
 + 1, 1);

1826 
su
 = 
TRUE
;

1832 
eid_r
 = (
PEID_STRUCT
)((
UCHAR
*id_+ 2 +id_r->
L
);

1835  
su
;

1836 
	}
}

1849 
VOID
 
	$PrChSwAAi
(

1850 
IN
 
PRTMP_ADAPTER
 
pAd
,

1851 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1853 
CH_SW_ANN_INFO
 
ChSwAInfo
;

1854 
PFRAME_802_11
 
pFr
 = (PFRAME_802_11)
Em
->
Msg
;

1855 #ifde
CONFIG_STA_SUPPORT


1856 
UCHAR
 
dex
 = 0, 
Chl
 = 0, 
NewChl
 = 0;

1857 
ULONG
 
Bssidx
 = 0;

1860 
	`NdisZoMemy
(&
ChSwAInfo
, (
CH_SW_ANN_INFO
));

1861 i(! 
	`PrChSwASy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, &
ChSwAInfo
))

1863 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Invalid Channel Switch Action Frame.\n"));

1868 #ifde
CONFIG_STA_SUPPORT


1869 i(
pAd
->
OpMode
 =
OPMODE_STA
)

1871 
Bssidx
 = 
	`BssTabSrch
(&
pAd
->
SnTab
, 
pFr
->
Hdr
.
Addr3
,Ad->
CommCfg
.
Chl
);

1872 i(
Bssidx
 =
BSS_NOT_FOUND
)

1874 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerChSwAnnAction - Bssidx isot found\n"));

1878 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("\n****Bssidx i%d, Ch%d\n", 
dex
, 
pAd
->
SnTab
.
BssEry
[
Bssidx
].
Chl
));

1879 
	`hex_dump
("SSID",
pAd
->
SnTab
.
BssEry
[
Bssidx
].
Bssid
 ,6);

1881 
Chl
 = 
pAd
->
CommCfg
.Channel;

1882 
NewChl
 = 
ChSwAInfo
.
Chl
;

1884 i((
pAd
->
CommCfg
.
bIEEE80211H
 =1&& (
NewChl
 !0&& (
Chl
 != NewChannel))

1888 
	`AsicSwchChl
(
pAd
, 1, 
FALSE
);

1889 
	`AsicLockChl
(
pAd
, 1);

1890 
	`LkDown
(
pAd
, 
FALSE
);

1891 
	`MlmeQueueIn
(&
pAd
->
Mlme
.
Queue
);

1892 
	`BssTabIn
(&
pAd
->
SnTab
);

1893 
	`RTMPucDay
(1000000);

1896 
dex
 = 0 ; index < 
pAd
->
ChlLiNum
; index++)

1898 i(
pAd
->
ChlLi
[
dex
].
Chl
 =
NewChl
)

1900 
pAd
->
SnTab
.
BssEry
[
Bssidx
].
Chl
 = 
NewChl
;

1901 
pAd
->
CommCfg
.
Chl
 = 
NewChl
;

1902 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

1903 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

1904 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("&&&&&&&&&&&&&&&&PrChSwAAi - STAeivchswchounmIE (New Ch=%d)\n", 
NewChl
));

1909 i(
dex
 >
pAd
->
ChlLiNum
)

1911 
	`DBGPRINT_ERR
(("&&&&&&&&&&&&&&&&&&&&&&&&&&PrChSwAAi(n fd New Chl=%d iChlLi[%d]\n", 
pAd
->
CommCfg
.
Chl
,Ad->
ChlLiNum
));

1918 
	}
}

1932 
VOID
 
	$PrMsuReqAi
(

1933 
IN
 
PRTMP_ADAPTER
 
pAd
,

1934 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1936 
PFRAME_802_11
 
pFr
 = (PFRAME_802_11)
Em
->
Msg
;

1937 
UINT8
 
DlogTok
;

1938 
MEASURE_REQ_INFO
 
MsuReqInfo
;

1939 
MEASURE_REQ
 
MsuReq
;

1940 
MEASURE_REPORT_MODE
 
RtMode
;

1942 if(
	`PrMsuReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, &
DlogTok
, &
MsuReqInfo
, &
MsuReq
))

1944 
RtMode
.
wd
 = 0;

1945 
RtMode
.
fld
.
Inb
 = 1;

1946 
	`EnqueueMsumtR
(
pAd
, 
pFr
->
Hdr
.
Addr2
, 
DlogTok
, 
MsuReqInfo
.
Tok
, 
RtMode
.
wd
, MsuReqInfo.
ReqTy
, 0, 
NULL
);

1950 
	}
}

1963 
VOID
 
	$PrMsuRtAi
(

1964 
IN
 
PRTMP_ADAPTER
 
pAd
,

1965 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1967 
MEASURE_REPORT_INFO
 
MsuRtInfo
;

1968 
PFRAME_802_11
 
pFr
 = (PFRAME_802_11)
Em
->
Msg
;

1969 
UINT8
 
DlogTok
;

1970 
PUINT8
 
pMsuRtInfo
;

1975 i((
pMsuRtInfo
 = 
	`kmloc
((
MEASURE_RPI_REPORT
), 
GFP_ATOMIC
)=
NULL
)

1977 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%ubˁخlomemy f msu܈buf(size=%d).\n", 
__FUNCTION__
, (
MEASURE_RPI_REPORT
)));

1981 
	`NdisZoMemy
(&
MsuRtInfo
, (
MEASURE_REPORT_INFO
));

1982 
	`NdisZoMemy
(
pMsuRtInfo
, (
MEASURE_RPI_REPORT
));

1983 i(
	`PrMsuRtSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, &
DlogTok
, &
MsuRtInfo
, 
pMsuRtInfo
))

1986 
PMEASURE_REQ_ENTRY
 
pEry
 = 
NULL
;

1990 i((
DlogTok
 != 0)

1991 && ((
pEry
 = 
	`MsuReqLookUp
(
pAd
, 
DlogTok
)=
NULL
))

1994 i(
pEry
 !
NULL
)

1995 
	`MsuReqDe
(
pAd
, 
pEry
->
DlogTok
);

1997 i(
MsuRtInfo
.
RtTy
 =
RM_BASIC
)

1999 
PMEASURE_BASIC_REPORT
 
pBasicRt
 = (PMEASURE_BASIC_REPORT)
pMsuRtInfo
;

2000 i((
pBasicRt
->
M
.
fld
.
Rad
)

2001 && (
	`DfsRequemtCheck
(
pAd
, 
pBasicRt
->
ChNum
=
TRUE
))

2003 
	`NifyChSwAToPrAPs
(
pAd
, 
pFr
->
Hdr
.
Addr1
,Fr->Hdr.
Addr2
, 1, 
pBasicRt
->
ChNum
);

2004 
	`SDFSProdu
(
pAd
, 
pBasicRt
->
ChNum
, 1);

2007 } 
FALSE
);

2010 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Invalid Measurement Report Frame.\n"));

2012 
	`k
(
pMsuRtInfo
);

2015 
	}
}

2028 
VOID
 
	$PrTpcReqAi
(

2029 
IN
 
PRTMP_ADAPTER
 
pAd
,

2030 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

2032 
PFRAME_802_11
 
pFr
 = (PFRAME_802_11)
Em
->
Msg
;

2033 
PUCHAR
 
pFmeP
 = 
pFr
->
O
;

2034 
UINT8
 
DlogTok
;

2035 
UINT8
 
TxPwr
 = 
	`GCurTxPwr
(
pAd
, 
Em
->
Wcid
);

2036 
UINT8
 
LkMg
 = 0;

2037 
CHAR
 
RlRssi
;

2043 
RlRssi
 = 
	`RTMPMaxRssi
(
pAd
, 
	`CvtToRssi
Ad, 
Em
->
Rssi0
, 
RSSI_0
),

2044 
	`CvtToRssi
(
pAd
, 
Em
->
Rssi1
, 
RSSI_1
),

2045 
	`CvtToRssi
(
pAd
, 
Em
->
Rssi2
, 
RSSI_2
));

2048 
pFmeP
 += 2;

2051 
	`NdisMoveMemy
(&
DlogTok
, 
pFmeP
, 1);

2053 
LkMg
 = (
RlRssi
 / 
MIN_RCV_PWR
);

2054 i(
	`PrTpcReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, &
DlogTok
))

2055 
	`EnqueueTPCR
(
pAd
, 
pFr
->
Hdr
.
Addr2
, 
DlogTok
, 
TxPwr
, 
LkMg
);

2058 
	}
}

2071 
VOID
 
	$PrTpcRAi
(

2072 
IN
 
PRTMP_ADAPTER
 
pAd
,

2073 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

2075 
UINT8
 
DlogTok
;

2076 
TPC_REPORT_INFO
 
TpcRInfo
;

2077 
PTPC_REQ_ENTRY
 
pEry
 = 
NULL
;

2079 
	`NdisZoMemy
(&
TpcRInfo
, (
TPC_REPORT_INFO
));

2080 i(
	`PrTpcRSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, &
DlogTok
, &
TpcRInfo
))

2082 i((
pEry
 = 
	`TpcReqLookUp
(
pAd
, 
DlogTok
)!
NULL
)

2084 
	`TpcReqDe
(
pAd
, 
pEry
->
DlogTok
);

2085 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: DialogToken=%x, TxPwr=%d, LinkMargin=%d\n",

2086 
__FUNCTION__
, 
DlogTok
, 
TpcRInfo
.
TxPwr
, TpcRInfo.
LkMg
));

2091 
	}
}

2105 
VOID
 
	$PrSrumAi
(

2106 
IN
 
PRTMP_ADAPTER
 
pAd
,

2107 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

2110 
UCHAR
 
Ai
 = 
Em
->
Msg
[
LENGTH_802_11
+1];

2112 i(
pAd
->
CommCfg
.
bIEEE80211H
 !
TRUE
)

2115 
Ai
)

2117 
SPEC_MRQ
:

2120 
	`PrMsuReqAi
(
pAd
, 
Em
);

2123 
SPEC_MRP
:

2124 
	`PrMsuRtAi
(
pAd
, 
Em
);

2127 
SPEC_TPCRQ
:

2128 
	`PrTpcReqAi
(
pAd
, 
Em
);

2131 
SPEC_TPCRP
:

2132 
	`PrTpcRAi
(
pAd
, 
Em
);

2135 
SPEC_CHANNEL_SWITCH
:

2137 #ifde
DOT11N_DRAFT3


2139 
SEC_CHA_OFFSET_IE
 
Secdy
;

2140 
CHA_SWITCH_ANNOUNCE_IE
 
ChlSwch
;

2143 
	`RTMPMoveMemy
(&
ChlSwch
, &
Em
->
Msg
[
LENGTH_802_11
+4],  (
CHA_SWITCH_ANNOUNCE_IE
));

2146 i(
Em
->
MsgL
 =(
LENGTH_802_11
 + 2 +  (
CHA_SWITCH_ANNOUNCE_IE
+  (
SEC_CHA_OFFSET_IE
)))

2148 
	`RTMPMoveMemy
(&
Secdy
, &
Em
->
Msg
[
LENGTH_802_11
+9],  (
SEC_CHA_OFFSET_IE
));

2152 
Secdy
.
SecdyChlOfft
 = 0;

2155 i((
Em
->
Msg
[
LENGTH_802_11
+2] =
IE_CHANNEL_SWITCH_ANNOUNCEMENT
) && (Elem->Msg[LENGTH_802_11+3] == 3))

2157 
	`ChlSwchAi
(
pAd
, 
Em
->
Wcid
, 
ChlSwch
.
NewChl
, 
Secdy
.
SecdyChlOfft
);

2162 
	`PrChSwAAi
(
pAd
, 
Em
);

2167 
	}
}

2178 
INT
 
	$S_MsuReq_Proc
(

2179 
IN
 
PRTMP_ADAPTER
 
pAd
,

2180 
IN
 
PSTRING
 
g
)

2182 
UINT
 
Aid
 = 1;

2183 
UINT
 
ArgIdx
;

2184 
PSTRING
 
thisCh
;

2186 
MEASURE_REQ_MODE
 
MsuReqMode
;

2187 
UINT8
 
MsuReqTok
 = 
	`RdomBy
(
pAd
);

2188 
UINT8
 
MsuReqTy
 = 
RM_BASIC
;

2189 
UINT8
 
MsuCh
 = 1;

2190 
UINT64
 
MsuSTime
 = 
	`GCutTimeSmp
(
pAd
);

2191 
MEASURE_REQ
 
MsuReq
;

2192 
UINT8
 
TٮL
;

2194 
HEADER_802_11
 
AHdr
;

2195 
PUCHAR
 
pOutBufr
 = 
NULL
;

2196 
NDIS_STATUS
 
NStus
;

2197 
ULONG
 
FmeL
;

2199 
NStus
 = 
	`MlmeAoMemy
(
pAd
, (
PVOID
)&
pOutBufr
);

2200 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

2202 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s(lo memy faed \n", 
__FUNCTION__
));

2203 
END_OF_MEASURE_REQ
;

2206 
ArgIdx
 = 1;

2207 (
thisCh
 = 
	`rp
((**)&
g
, "-")!
NULL
)

2209 
ArgIdx
)

2212 
Aid
 = (
UINT8

	`sime_
(
thisCh
, 0, 16);

2216 
MsuReqTy
 = 
	`sime_
(
thisCh
, 0, 16);

2217 i(
MsuReqTy
 > 3)

2219 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: unknow MsuReqTy(%d)\n", 
__FUNCTION__
, 
MsuReqTy
));

2220 
END_OF_MEASURE_REQ
;

2225 
MsuCh
 = (
UINT8

	`sime_
(
thisCh
, 0, 16);

2228 
ArgIdx
++;

2231 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::Aid = %d, MsuReqTy=%d MsuCh=%d\n", 
__FUNCTION__
, 
Aid
, 
MsuReqTy
, 
MsuCh
));

2232 i(!
	`VALID_WCID
(
Aid
))

2234 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: unknow s oAid(%d)\n", 
__FUNCTION__
, 
Aid
));

2235 
END_OF_MEASURE_REQ
;

2238 
MsuReqMode
.
wd
 = 0;

2239 
MsuReqMode
.
fld
.
Eb
 = 1;

2241 
	`MsuReqIn
(
pAd
, 
MsuReqTok
);

2244 
	`MgtMacHdIn
(
pAd
, &
AHdr
, 
SUBTYPE_ACTION
, 0,Ad->
MacTab
.
Cڋ
[
Aid
].
Addr
,

2245 
pAd
->
CutAddss
);

2247 
	`NdisMoveMemy
(
pOutBufr
, (
PCHAR
)&
AHdr
, (
HEADER_802_11
));

2248 
FmeL
 = (
HEADER_802_11
);

2250 
TٮL
 = (
MEASURE_REQ_INFO
+ (
MEASURE_REQ
);

2252 
	`MakeMsumtReqFme
(
pAd
, 
pOutBufr
, &
FmeL
,

2253 (
MEASURE_REQ_INFO
), 
CATEGORY_RM
, 
RM_BASIC
,

2254 
MsuReqTok
, 
MsuReqMode
.
wd
,

2255 
MsuReqTy
, 1);

2257 
MsuReq
.
ChNum
 = 
MsuCh
;

2258 
MsuReq
.
MsuSTime
 = 
	`u264
(MeasureStartTime);

2259 
MsuReq
.
MsuDuti
 = 
	`u216
(2000);

2262 
ULONG
 
TempL
;

2263 
	`MakeOutgogFme

pOutBufr
+
FmeL
, &
TempL
,

2264 (
MEASURE_REQ
), &
MsuReq
,

2265 
END_OF_ARGS
);

2266 
FmeL
 +
TempL
;

2269 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, (
UINT
)
FmeL
);

2271 
END_OF_MEASURE_REQ
:

2272 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

2274  
TRUE
;

2275 
	}
}

2277 
INT
 
	$S_TpcReq_Proc
(

2278 
IN
 
PRTMP_ADAPTER
 
pAd
,

2279 
IN
 
PSTRING
 
g
)

2281 
UINT
 
Aid
;

2283 
UINT8
 
TpcReqTok
 = 
	`RdomBy
(
pAd
);

2285 
Aid
 = (
UINT

	`sime_
(
g
, 0, 16);

2287 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::Aid = %d\n", 
__FUNCTION__
, 
Aid
));

2288 i(!
	`VALID_WCID
(
Aid
))

2290 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: unknow s oAid(%d)\n", 
__FUNCTION__
, 
Aid
));

2291  
TRUE
;

2294 
	`TpcReqIn
(
pAd
, 
TpcReqTok
);

2296 
	`EnqueueTPCReq
(
pAd
,Ad->
MacTab
.
Cڋ
[
Aid
].
Addr
, 
TpcReqTok
);

2298  
TRUE
;

2299 
	}
}

	@include/action.h

39 #idef 
__ACTION_H__


40 
	#__ACTION_H__


	)

42 
GNU_PACKED
 
	t__HT_INFO_OCTET


44 #ifde
RT_BIG_ENDIAN


45 
UCHAR
 
	gRerved
:5;

46 
UCHAR
 
	gSTA_Chl_Width
:1;

47 
UCHAR
 
	gFty_MHz_Iޔt
:1;

48 
UCHAR
 
	gReque
:1;

50 
UCHAR
 
	gReque
:1;

51 
UCHAR
 
	gFty_MHz_Iޔt
:1;

52 
UCHAR
 
	gSTA_Chl_Width
:1;

53 
UCHAR
 
	gRerved
:5;

55 } 
	tHT_INFORMATION_OCTET
;

58 
GNU_PACKED
 
	t__FRAME_HT_INFO


60 
HEADER_802_11
 
	gHdr
;

61 
UCHAR
 
	gCegy
;

62 
UCHAR
 
	gAi
;

63 
HT_INFORMATION_OCTET
 
	gHT_Info
;

64 } 
	tFRAME_HT_INFO
, *
	tPFRAME_HT_INFO
;

	@include/ap.h

40 #ide
__AP_H__


41 
	#__AP_H__


	)

50 
BOOLEAN
 
APBridgeToWessS
(

51 
IN
 
PRTMP_ADAPTER
 
pAd
,

52 
IN
 
PUCHAR
 
pHd
,

53 
IN
 
UINT
 
HdrL
,

54 
IN
 
PUCHAR
 
pDa
,

55 
IN
 
UINT
 
DaL
,

56 
IN
 
ULONG
 
omwdsidx
);

58 
VOID
 
RTMP_BASup
(

59 
IN
 
PRTMP_ADAPTER
 
pAd
,

60 
IN
 
PMAC_TABLE_ENTRY
 
pMacEry
,

61 
IN
 
UINT8
 
UrPriܙy
);

63 
VOID
 
APSdPacks
(

64 
IN
 
NDIS_HANDLE
 
MtAdrCڋxt
,

65 
IN
 
PPNDIS_PACKET
 
PackAay
,

66 
IN
 
UINT
 
NumbOfPacks
);

68 
NDIS_STATUS
 
APSdPack
(

69 
IN
 
PRTMP_ADAPTER
 
pAd
,

70 
IN
 
PNDIS_PACKET
 
pPack
);

73 
NDIS_STATUS
 
APHdTnsm
(

74 
IN
 
PRTMP_ADAPTER
 
pAd
,

75 
IN
 
TX_BLK
 *
pTxBlk
,

76 
IN
 
UCHAR
 
QueIdx
);

78 
VOID
 
APRxEAPOLFmeIndi
(

79 
IN
 
PRTMP_ADAPTER
 
pAd
,

80 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

81 
IN
 
RX_BLK
 *
pRxBlk
,

82 
IN
 
UCHAR
 
FromWhichBSSID
);

84 
NDIS_STATUS
 
APCheckRxE
(

85 
IN
 
PRTMP_ADAPTER
 
pAd
,

86 
IN
 
PRT28XX_RXD_STRUC
 
pRxD
,

87 
IN
 
UCHAR
 
Wcid
);

89 
BOOLEAN
 
APCheckCss2Css3E
(

90 
IN
 
PRTMP_ADAPTER
 
pAd
,

91 
IN
 
ULONG
 
Wcid
,

92 
IN
 
PHEADER_802_11
 
pHd
);

94 
VOID
 
APHdRxPsPl
(

95 
IN
 
PRTMP_ADAPTER
 
pAd
,

96 
IN
 
PUCHAR
 
pAddr
,

97 
IN
 
USHORT
 
Aid
,

98 
IN
 
BOOLEAN
 
isAive
);

100 
VOID
 
RTMPDestEndnChge
(

101 
IN
 
PUCHAR
 
pDa
,

102 
IN
 
ULONG
 
DestTy
);

104 
VOID
 
RTMPFmeEndnChge
(

105 
IN
 
PRTMP_ADAPTER
 
pAd
,

106 
IN
 
PUCHAR
 
pDa
,

107 
IN
 
ULONG
 
D
,

108 
IN
 
BOOLEAN
 
FromRxDeI
);

112 
VOID
 
APAssocSMacheIn
(

113 
IN
 
PRTMP_ADAPTER
 
pAd
,

114 
IN
 
STATE_MACHINE
 *
S
,

115 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[]);

117 
VOID
 
APPrAssocReqAi
(

118 
IN
 
PRTMP_ADAPTER
 
pAd
,

119 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

121 
VOID
 
APPrRssocReqAi
(

122 
IN
 
PRTMP_ADAPTER
 
pAd
,

123 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

125 
VOID
 
APPrDissocReqAi
(

126 
IN
 
PRTMP_ADAPTER
 
pAd
,

127 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

129 
VOID
 
MbssKickOutSs
(

130 
IN
 
PRTMP_ADAPTER
 
pAd
,

131 
IN
 
INT
 
idx
,

132 
IN
 
USHORT
 
Rs
);

134 
VOID
 
APMlmeKickOutS
(

135 
IN
 
PRTMP_ADAPTER
 
pAd
,

136 
IN
 
PUCHAR
 
pSAddr
,

137 
IN
 
UCHAR
 
Wcid
,

138 
IN
 
USHORT
 
Rs
);

140 
VOID
 
APMlmeDissocReqAi
(

141 
IN
 
PRTMP_ADAPTER
 
pAd
,

142 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

144 
VOID
 
APCls3rAi
(

145 
IN
 
PRTMP_ADAPTER
 
pAd
,

146 
IN
 
ULONG
 
Wcid
,

147 
IN
 
PHEADER_802_11
 
pHd
);

150 
USHORT
 
APBudAssocti
(

151 
IN
 
PRTMP_ADAPTER
 
pAd
,

152 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

153 
IN
 
USHORT
 
CabyInfo
,

154 
IN
 
UCHAR
 
MaxSu܋dReIn500Kbps
,

155 
IN
 
UCHAR
 *
RSN
,

156 
IN
 
UCHAR
 *
pRSNL
,

157 
IN
 
BOOLEAN
 
bWmmCab
,

158 
IN
 
ULONG
 
RkIe
,

159 
IN
 
EXT_CAP_INFO_ELEMENT
 
ExtCInfo
,

160 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

161 
OUT
 
UCHAR
 *
pHtCabyL
,

162 
OUT
 
USHORT
 *
pAid
);

178 
APAuthSMacheIn
(

179 
IN
 
PRTMP_ADAPTER
 
pAd
,

180 
IN
 
STATE_MACHINE
 *
Sm
,

181 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[]);

183 
VOID
 
APCls2rAi
(

184 
IN
 
PRTMP_ADAPTER
 
pAd
,

185 
IN
 
ULONG
 
Wcid
,

186 
IN
 
PHEADER_802_11
 
pHd
);

191 
VOID
 
APMakeBssBc
(

192 
IN
 
PRTMP_ADAPTER
 
pAd
,

193 
IN
 
INT
 
idx
);

195 
VOID
 
APUpdeBcFme
(

196 
IN
 
PRTMP_ADAPTER
 
pAd
,

197 
IN
 
INT
 
idx
);

199 
VOID
 
APMakeABssBc
(

200 
IN
 
PRTMP_ADAPTER
 
pAd
);

202 
VOID
 
APUpdeABcFme
(

203 
IN
 
PRTMP_ADAPTER
 
pAd
);

208 
VOID
 
APSyncSMacheIn
(

209 
IN
 
PRTMP_ADAPTER
 
pAd
,

210 
IN
 
STATE_MACHINE
 *
Sm
,

211 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[]);

213 
VOID
 
APSnTimeout
(

214 
IN
 
PVOID
 
SyemScific1
,

215 
IN
 
PVOID
 
FuniCڋxt
,

216 
IN
 
PVOID
 
SyemScific2
,

217 
IN
 
PVOID
 
SyemScific3
);

219 
VOID
 
APInvidSWhSn
(

220 
IN
 
PRTMP_ADAPTER
 
pAd
,

221 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

223 
VOID
 
APSnTimeoutAi
(

224 
IN
 
PRTMP_ADAPTER
 
pAd
,

225 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

227 
VOID
 
APPrProbeReqAi
(

228 
IN
 
PRTMP_ADAPTER
 
pAd
,

229 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

231 
VOID
 
APPrBcAi
(

232 
IN
 
PRTMP_ADAPTER
 
pAd
,

233 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

235 
VOID
 
APMlmeSnReqAi
(

236 
IN
 
PRTMP_ADAPTER
 
pAd
,

237 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

239 
VOID
 
APPrBcAtSnAi
(

240 
IN
 
PRTMP_ADAPTER
 
pAd
,

241 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

243 
VOID
 
APSnCnAi
(

244 
IN
 
PRTMP_ADAPTER
 
pAd
,

245 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

247 
VOID
 
ApSeSurvey
(

248 
IN
 
PRTMP_ADAPTER
 
pAd
,

249 
IN
 
PNDIS_802_11_SSID
 
pSsid
,

250 
IN
 
UCHAR
 
SnTy
,

251 
IN
 
BOOLEAN
 
ChlS
);

253 
VOID
 
SutRe
(

254 
IN
 
PUCHAR
 
SupRe
,

255 
IN
 
UCHAR
 
SupReL
,

256 
IN
 
PUCHAR
 
ExtRe
,

257 
IN
 
UCHAR
 
ExtReL
,

258 
OUT
 
PUCHAR
 *
Res
,

259 
OUT
 
PUCHAR
 
ResL
,

260 
OUT
 
PUCHAR
 
pMaxSutRe
);

263 
BOOLEAN
 
ApSnRug
(

264 
IN
 
PRTMP_ADAPTER
 
pAd
);

266 #ifde
DOT11N_DRAFT3


267 
VOID
 
APOvϵgBSSSn
(

268 
IN
 
RTMP_ADAPTER
 *
pAd
);

270 
INT
 
GBssCxEfedChRge
(

271 
IN
 
RTMP_ADAPTER
 *
pAd
,

272 
IN
 
BSS_COEX_CH_RANGE
 *
pCxChRge
);

277 
VOID
 
WSMacheIn
(

278 
IN
 
PRTMP_ADAPTER
 
pAd
,

279 
IN
 
STATE_MACHINE
 *
Sm
,

280 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[]);

283 
VOID
 
APMlmePiodicExec
(

284 
IN
 
PRTMP_ADAPTER
 
pAd
);

286 
VOID
 
APMlmeSeTxReTab
(

287 
IN
 
PRTMP_ADAPTER
 
pAd
,

288 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

289 
IN
 
PUCHAR
 *
Tab
,

290 
IN
 
PUCHAR
 
pTabSize
,

291 
IN
 
PUCHAR
 
pInTxReIdx
);

293 
VOID
 
APMlmeSTxRe
(

294 
IN
 
PRTMP_ADAPTER
 
pAd
,

295 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

296 
IN
 
PRTMP_TX_RATE_SWITCH
 
pTxRe
);

298 
VOID
 
APMlmeSeReSwchTab11N3SRmt
(

299 
IN
 
PUCHAR
 *
Tab
);

302 
VOID
 
APMlmeDymicTxReSwchg
(

303 
IN
 
PRTMP_ADAPTER
 
pAd
);

305 
VOID
 
APQuickReeFReUpExec
(

306 
IN
 
PVOID
 
SyemScific1
,

307 
IN
 
PVOID
 
FuniCڋxt
,

308 
IN
 
PVOID
 
SyemScific2
,

309 
IN
 
PVOID
 
SyemScific3
);

311 
BOOLEAN
 
APMsgTySub
(

312 
IN
 
PRTMP_ADAPTER
 
pAd
,

313 
IN
 
PFRAME_802_11
 
pFme
,

314 
OUT
 
INT
 *
Mache
,

315 
OUT
 
INT
 *
MsgTy
);

317 
VOID
 
APQuickReeFReUpExec
(

318 
IN
 
PVOID
 
SyemScific1
,

319 
IN
 
PVOID
 
FuniCڋxt
,

320 
IN
 
PVOID
 
SyemScific2
,

321 
IN
 
PVOID
 
SyemScific3
);

323 #ifde
NEW_RATE_ADAPT_SUPPORT


324 
VOID
 
APMlmeDymicTxReSwchgAdt
(

325 
IN
 
PRTMP_ADAPTER
 
pAd
,

326 
IN
 
ULONG
 
idx
);

328 
VOID
 
APQuickReeFReUpExecAdt
(

329 
IN
 
PRTMP_ADAPTER
 
pAd
,

330 
IN
 
ULONG
 
idx
);

334 
VOID
 
RTMPSPiggyBack
(

335 
IN
 
PRTMP_ADAPTER
 
pAd
,

336 
IN
 
BOOLEAN
 
bPiggyBack
);

338 
VOID
 
APAsicEvueRxA
(

339 
IN
 
PRTMP_ADAPTER
 
pAd
);

341 
VOID
 
APAsicRxAEvTimeout
(

342 
IN
 
PRTMP_ADAPTER
 
pAd
);

345 
NDIS_STATUS
 
APInlize
(

346 
IN
 
PRTMP_ADAPTER
 
pAd
);

348 
VOID
 
APShutdown
(

349 
IN
 
PRTMP_ADAPTER
 
pAd
);

351 
VOID
 
APSUp
(

352 
IN
 
PRTMP_ADAPTER
 
pAd
);

354 
VOID
 
APSt
(

355 
IN
 
PRTMP_ADAPTER
 
pAd
);

357 
VOID
 
APC˪upPsQueue
(

358 
IN
 
PRTMP_ADAPTER
 
pAd
,

359 
IN
 
PQUEUE_HEADER
 
pQueue
);

361 
VOID
 
MacTabRet
(

362 
IN
 
PRTMP_ADAPTER
 
pAd
);

364 
MAC_TABLE_ENTRY
 *
MacTabInEry
(

365 
IN
 
PRTMP_ADAPTER
 
pAd
,

366 
IN
 
PUCHAR
 
pAddr
,

367 
IN
 
UCHAR
 
idx
,

368 
IN
 
BOOLEAN
 
C˪A
);

370 
BOOLEAN
 
MacTabDeEry
(

371 
IN
 
PRTMP_ADAPTER
 
pAd
,

372 
IN
 
USHORT
 
wcid
,

373 
IN
 
PUCHAR
 
pAddr
);

375 
MAC_TABLE_ENTRY
 *
MacTabLookup
(

376 
IN
 
PRTMP_ADAPTER
 
pAd
,

377 
IN
 
PUCHAR
 
pAddr
);

379 
VOID
 
MacTabMan
(

380 
IN
 
PRTMP_ADAPTER
 
pAd
);

382 
UINT32
 
MacTabAssocSNumG
(

383 
IN
 
PRTMP_ADAPTER
 
pAd
);

385 
MAC_TABLE_ENTRY
 *
APSsPsInquy
(

386 
IN
 
PRTMP_ADAPTER
 
pAd
,

387 
IN
 
PUCHAR
 
pAddr
,

388 
OUT
 
SST
 *
S
,

389 
OUT
 
USHORT
 *
Aid
,

390 
OUT
 
UCHAR
 *
PsMode
,

391 
OUT
 
UCHAR
 *
Re
);

393 
BOOLEAN
 
APPsIndi
(

394 
IN
 
PRTMP_ADAPTER
 
pAd
,

395 
IN
 
PUCHAR
 
pAddr
,

396 
IN
 
ULONG
 
Wcid
,

397 
IN
 
UCHAR
 
Psm
);

399 #ifde
SYSTEM_LOG_SUPPORT


400 
VOID
 
ApLogEvt
(

401 
IN
 
PRTMP_ADAPTER
 
pAd
,

402 
IN
 
PUCHAR
 
pAddr
,

403 
IN
 
USHORT
 
Evt
);

405 
	#ApLogEvt
(
_pAd
, 
_pAddr
, 
_Evt
)

	)

408 #ifde
DOT11_N_SUPPORT


409 
VOID
 
APUpdeOtiMode
(

410 
IN
 
PRTMP_ADAPTER
 
pAd
);

413 
VOID
 
APUpdeCabyAndEIe
(

414 
IN
 
PRTMP_ADAPTER
 
pAd
);

416 
BOOLEAN
 
ApCheckAcssCڌLi
(

417 
IN
 
PRTMP_ADAPTER
 
pAd
,

418 
IN
 
PUCHAR
 
pAddr
,

419 
IN
 
UCHAR
 
Apidx
);

421 
VOID
 
ApUpdeAcssCڌLi
(

422 
IN
 
PRTMP_ADAPTER
 
pAd
,

423 
IN
 
UCHAR
 
Apidx
);

425 
VOID
 
ApEnqueueNuFme
(

426 
IN
 
PRTMP_ADAPTER
 
pAd
,

427 
IN
 
PUCHAR
 
pAddr
,

428 
IN
 
UCHAR
 
TxRe
,

429 
IN
 
UCHAR
 
PID
,

430 
IN
 
UCHAR
 
idx
,

431 
IN
 
BOOLEAN
 
bQosNu
,

432 
IN
 
BOOLEAN
 
bEOSP
,

433 
IN
 
UCHAR
 
OldUP
);

438 
BOOLEAN
 
PrAssocReqCmmSy
(

439 
IN
 
PRTMP_ADAPTER
 
pAd
,

440 
IN
 
BOOLEAN
 
isRessoc
,

441 
IN
 
VOID
 *
Msg
,

442 
IN
 
ULONG
 
MsgL
,

443 
OUT
 
PUCHAR
 
pAddr2
,

444 
OUT
 
USHORT
 *
pCabyInfo
,

445 
OUT
 
USHORT
 *
pLiIv
,

446 
OUT
 
PUCHAR
 
pApAddr
,

447 
OUT
 
UCHAR
 *
pSsidL
,

448 
OUT
 *
Ssid
,

449 
OUT
 
UCHAR
 *
pResL
,

450 
OUT
 
UCHAR
 
Res
[],

451 
OUT
 
UCHAR
 *
RSN
,

452 
OUT
 
UCHAR
 *
pRSNL
,

453 
OUT
 
BOOLEAN
 *
pbWmmCab
,

454 
OUT
 
ULONG
 *
pRkIe
,

455 
OUT
 
EXT_CAP_INFO_ELEMENT
 *
pExtCInfo
,

456 
OUT
 
UCHAR
 *
pHtCabyL
,

457 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
);

460 
BOOLEAN
 
PrDissocReqSy
(

461 
IN
 
PRTMP_ADAPTER
 
pAd
,

462 
IN
 
VOID
 *
Msg
,

463 
IN
 
ULONG
 
MsgL
,

464 
OUT
 
PUCHAR
 
pAddr2
,

465 
OUT
 
UINT16
 *
SeqNum
,

466 
OUT
 
USHORT
 *
Rs
);

468 
BOOLEAN
 
PrDuthReqSy
(

469 
IN
 
PRTMP_ADAPTER
 
pAd
,

470 
IN
 
VOID
 *
Msg
,

471 
IN
 
ULONG
 
MsgL
,

472 
OUT
 
PUCHAR
 
pAddr2
,

473 
OUT
 
UINT16
 *
SeqNum
,

474 
OUT
 
USHORT
 *
Rs
);

476 
BOOLEAN
 
APPrAuthSy
(

477 
IN
 
PRTMP_ADAPTER
 
pAd
,

478 
IN
 
VOID
 *
Msg
,

479 
IN
 
ULONG
 
MsgL
,

480 
OUT
 
PUCHAR
 
pAddr1
,

481 
OUT
 
PUCHAR
 
pAddr2
,

482 
OUT
 
USHORT
 *
Alg
,

483 
OUT
 
USHORT
 *
Seq
,

484 
OUT
 
USHORT
 *
Stus
,

485 
OUT
 
CHAR
 *
ChlgText


489 #ifde
DOT1X_SUPPORT


491 
INT
 
S_OwnIPAddr_Proc
(

492 
IN
 
PRTMP_ADAPTER
 
pAd
,

493 
IN
 
PSTRING
 
g
);

495 
INT
 
S_EAPIfName_Proc
(

496 
IN
 
PRTMP_ADAPTER
 
pAd
,

497 
IN
 
PSTRING
 
g
);

499 
INT
 
S_PAuthIfName_Proc
(

500 
IN
 
PRTMP_ADAPTER
 
pAd
,

501 
IN
 
PSTRING
 
g
);

504 
BOOLEAN
 
DOT1X_IlCmdAi
(

505 
IN
 
PRTMP_ADAPTER
 
pAd
,

506 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

507 
IN
 
UINT8
 
cmd
);

509 
BOOLEAN
 
DOT1X_ETriggAi
(

510 
IN
 
PRTMP_ADAPTER
 
pAd
,

511 
IN
 
MAC_TABLE_ENTRY
 *
pEry
);

514 #ifde
DOT11_N_SUPPORT


	@include/br_ftph.h

35 #ide
__BR_FTPH_H__


36 
	#__BR_FTPH_H__


	)

54 
VOID
 
BG_FTPH_In
(VOID);

71 
VOID
 
BG_FTPH_Remove
(VOID);

87 
UINT32
 
BG_FTPH_PackFromApHd
(

88 
IN
 
PNDIS_PACKET
 
pPack
);

	@include/cfg80211.h

35 #ifde
RT_CFG80211_SUPPORT


37 
	~<lux/80211.h
>

60 
VOID
 
CFG80211_Regi
(

61 
IN
 
VOID
 *
pAdCB
,

62 
IN
 
devi
 *
pDev
,

63 
IN
 
t_devi
 *
pNDev
);

80 
VOID
 
CFG80211_UnRegi
(

81 
IN
 
PRTMP_ADAPTER
 
pAd
,

82 
IN
 
t_devi
 *
pNDev
);

100 
VOID
 
CFG80211_BcCouryRegiP
(

101 
IN
 
VOID
 *
pAdCB
,

102 
IN
 
NDIS_802_11_VARIABLE_IEs
 *
pVIE
,

103 
IN
 
UINT16
 
LVIE
);

122 
VOID
 
CFG80211_RegHt
(

123 
IN
 
VOID
 *
pAdCB
,

124 
IN
 
UCHAR
 *
pCouryIe
,

125 
IN
 
ULONG
 
CouryIeL
);

143 
VOID
 
CFG80211_RegHt11D
(

144 
IN
 
VOID
 *
pAdCB
,

145 
IN
 
UCHAR
 *
pCouryIe
,

146 
IN
 
ULONG
 
CouryIeL
);

165 
VOID
 
CFG80211_RegRuAly
(

166 
IN
 
VOID
 *
pAdCB
,

167 
IN
 
why
 *
pWhy
,

168 
IN
 
UCHAR
 *
pAha2
);

185 
VOID
 
CFG80211_Sng
(

186 
IN
 
VOID
 *
pAdCB
,

187 
IN
 
UINT32
 
BssIdx
,

188 
IN
 
UINT32
 
ChId
,

189 
IN
 
UCHAR
 *
pFme
,

190 
IN
 
UINT32
 
FmeL
,

191 
IN
 
INT32
 
RSSI
,

192 
IN
 
INT32
 
MemFg
);

209 
VOID
 
CFG80211_SnEnd
(

210 
IN
 
VOID
 *
pAdCB
,

211 
IN
 
BOOLEAN
 
FlgIsAb܋d
);

231 
BOOLEAN
 
CFG80211_SupBdReIn
(

232 
IN
 
VOID
 *
pAdCB
);

254 
VOID
 
CFG80211_CResuInfm
(

255 
IN
 
VOID
 *
pAdCB
,

256 
IN
 
UCHAR
 *
pBSSID
,

257 
IN
 
UCHAR
 *
pReqIe
,

258 
IN
 
UINT32
 
ReqIeL
,

259 
IN
 
UCHAR
 *
pRIe
,

260 
IN
 
UINT32
 
RIeL
,

261 
IN
 
UCHAR
 
FlgIsSucss
);

	@include/cfg80211extr.h

35 #ifde
RT_CFG80211_SUPPORT


38 
	#RT_CFG80211_API_INIT
(
__pAd
) \

39 
__pAd
->
CFG80211_BcCouryRegiP
 = CFG80211_BeaconCountryRegionParse;\

40 
__pAd
->
CFG80211_RegHt
 = CFG80211_RegHint; \

41 
__pAd
->
CFG80211_RegHt11D
 = CFG80211_RegHint11D; \

42 
__pAd
->
CFG80211_RegRuAly
 = CFG80211_RegRuleApply; \

43 
__pAd
->
CFG80211_Sng
 = CFG80211_Scaning; \

44 
__pAd
->
CFG80211_SnEnd
 = CFG80211_ScanEnd; \

45 
__pAd
->
CFG80211_SupBdReIn
 = CFG80211_SupBandReInit; \

46 
__pAd
->
CFG80211_CResuInfm
 = 
	)
CFG80211_ConnectResultInform

48 
	#RT_CFG80211_REGISTER
(
__pAd
, 
__pDev
, 
__pNDev
) \

50 i(
__pAd
->
CFG80211_Regi
 !
NULL
) \

51 
__pAd
->
	`CFG80211_Regi
((
VOID
 *)__pAd, 
__pDev
, 
__pNDev
); \

52 } 0);

	)

54 
	#RT_CFG80211_BEACON_CR_PARSE
(
__pAd
, 
__pVIE
, 
__LVIE
) \

56 i((
__pAd
->
pCfg80211_CB
 !
NULL
) && \

57 (
__pAd
->
CFG80211_BcCouryRegiP
 !
NULL
)) \

58 
__pAd
->
	`CFG80211_BcCouryRegiP
((
VOID
 *)__pAd, 
__pVIE
, 
__LVIE
);\

59 } 0);

	)

61 
	#RT_CFG80211_CRDA_REG_HINT
(
__pAd
, 
__pCouryIe
, 
__CouryIeL
) \

63 i((
__pAd
->
pCfg80211_CB
 !
NULL
) && \

64 (
__pAd
->
CFG80211_RegHt
 !
NULL
)) \

65 
__pAd
->
	`CFG80211_RegHt
((
VOID
 *)__pAd, 
__pCouryIe
, 
__CouryIeL
); \

66 } 0);

	)

68 
	#RT_CFG80211_CRDA_REG_HINT11D
(
__pAd
, 
__pCouryIe
, 
__CouryIeL
) \

70 i((
__pAd
->
pCfg80211_CB
 !
NULL
) && \

71 (
__pAd
->
CFG80211_RegHt11D
 !
NULL
)) \

72 
__pAd
->
	`CFG80211_RegHt11D
((
VOID
 *)__pAd, 
__pCouryIe
, 
__CouryIeL
);\

73 } 0);

	)

75 
	#RT_CFG80211_CRDA_REG_RULE_APPLY
(
__pAd
) \

77 i((
__pAd
->
pCfg80211_CB
 !
NULL
) && \

78 (
__pAd
->
CFG80211_RegRuAly
 !
NULL
)) \

79 
__pAd
->
	`CFG80211_RegRuAly
((
VOID
 *)__pAd, 
NULL
, __pAd->
Cfg80211_Aha2
);\

80 } 0);

	)

82 
	#RT_CFG80211_SCANNING_INFORM
(
__pAd
, 
__BssIdx
, 
__ChId
, 
__pFme
, \

83 
__FmeL
, 
__RSSI
, 
__MemFg
) \

85 i((
__pAd
->
pCfg80211_CB
 !
NULL
) && \

86 (
__pAd
->
CFG80211_Sng
 !
NULL
)) \

87 
__pAd
->
	`CFG80211_Sng
((
VOID
 *)__pAd, 
__BssIdx
, 
__ChId
, 
__pFme
, \

88 
__FmeL
, 
__RSSI
, 
__MemFg
); \

89 } 0);

	)

91 
	#RT_CFG80211_SCAN_END
(
__pAd
, 
__FlgIsAb܋d
) \

93 i((
__pAd
->
pCfg80211_CB
 !
NULL
) && \

94 (
__pAd
->
CFG80211_SnEnd
 !
NULL
)) \

95 
__pAd
->
	`CFG80211_SnEnd
((
VOID
 *)__pAd, 
__FlgIsAb܋d
); \

96 } 0);

	)

98 
	#RT_CFG80211_REINIT
(
__pAd
) \

100 i((
__pAd
->
pCfg80211_CB
 !
NULL
) && \

101 (
__pAd
->
CFG80211_SupBdReIn
 !
NULL
)) \

102 
__pAd
->
	`CFG80211_SupBdReIn
((
VOID
 *)__pAd); \

103 } 0);

	)

105 
	#RT_CFG80211_CONN_RESULT_INFORM
(
__pAd
, 
__pBSSID
, 
__pReqIe
, 
__ReqIeL
, \

106 
__pRIe
, 
__RIeL
, 
__FlgIsSucss
) \

108 i((
__pAd
->
pCfg80211_CB
 !
NULL
) && \

109 (
__pAd
->
CFG80211_CResuInfm
 !
NULL
)) \

110 
__pAd
->
	`CFG80211_CResuInfm
((
VOID
 *)__pAd, 
__pBSSID
, \

111 
__pReqIe
, 
__ReqIeL
, 
__pRIe
, 
__RIeL
, 
__FlgIsSucss
); \

112 } 0);

	)

115 
	#CFG80211_FUNC_OPS
 \

116 
	`VOID
 (*
CFG80211_BcCouryRegiP
)( \

117 
IN
 
VOID
 *
pAd
, \

118 
IN
 
NDIS_802_11_VARIABLE_IEs
 *
pVIE
, \

119 
IN
 
UINT16
 
LVIE
); \

120 
	`VOID
 (*
CFG80211_RegHt
)( \

121 
IN
 
VOID
 *
pAd
, \

122 
IN
 
UCHAR
 *
pCouryIe
, \

123 
IN
 
ULONG
 
CouryIeL
); \

124 
	`VOID
 (*
CFG80211_RegHt11D
)( \

125 
IN
 
VOID
 *
pAd
, \

126 
IN
 
UCHAR
 *
pCouryIe
, \

127 
IN
 
ULONG
 
CouryIeL
); \

128 
	`VOID
 (*
CFG80211_RegRuAly
)( \

129 
IN
 
VOID
 *
pAd
, \

130 
IN
 
why
 *
pWhy
, \

131 
IN
 
UCHAR
 *
pAha2
); \

132 
	`VOID
 (*
CFG80211_Sng
)( \

133 
IN
 
VOID
 *
pAd
, \

134 
IN
 
UINT32
 
BssIdx
, \

135 
IN
 
UINT32
 
ChId
, \

136 
IN
 
UCHAR
 *
pFme
, \

137 
IN
 
UINT32
 
FmeL
, \

138 
IN
 
INT32
 
RSSI
, \

139 
IN
 
INT32
 
MemFg
); \

140 
	`VOID
 (*
CFG80211_SnEnd
)( \

141 
IN
 
VOID
 *
pAd
, \

142 
IN
 
BOOLEAN
 
FlgIsAb܋d
); \

143 
	`BOOLEAN
 (*
CFG80211_SupBdReIn
)( \

144 
IN
 
VOID
 *
pAd
); \

145 
	`VOID
 (*
CFG80211_CResuInfm
)( \

146 
IN
 
VOID
 *
pAd
, \

147 
IN
 
UCHAR
 *
pBSSID
, \

148 
IN
 
UCHAR
 *
pReqIe
, \

149 
IN
 
UINT32
 
ReqIeL
, \

150 
IN
 
UCHAR
 *
pRIe
, \

151 
IN
 
UINT32
 
RIeL
, \

152 
IN
 
UCHAR
 
FlgIsSucss
)

	)

	@include/chip/mac_pci.h

37 #ide
__MAC_PCI_H__


38 
	#__MAC_PCI_H__


	)

40 
	~"mp_ty.h
"

41 
	~"ch/mp_mac.h
"

42 
	~"ch/mp_phy.h
"

43 
	~"mp_i.h
"

44 
	~"mp_d11.h
"

51 
	#NIC_PCI_VENDOR_ID
 0x1814

	)

52 
	#PCIBUS_INTEL_VENDOR
 0x8086

	)

54 #i!
defed
(
PCI_CAP_ID_EXP
)

55 
	#PCI_CAP_ID_EXP
 0x10

	)

57 #i!
defed
(
PCI_EXP_LNKCTL
)

58 
	#PCI_EXP_LNKCTL
 0x10

	)

60 #i!
defed
(
PCI_CLASS_BRIDGE_PCI
)

61 
	#PCI_CLASS_BRIDGE_PCI
 0x0604

	)

68 
	#TXINFO_SIZE
 0

	)

69 
	#RTMP_PKT_TAIL_PADDING
 0

	)

70 
	#fRTMP_ADAPTER_NEED_STOP_TX
 0

	)

72 
	#AUX_CTRL
 0x10c

	)

77 #ifde
RT_BIG_ENDIAN


78 
GNU_PACKED
 
	t_TXD_STRUC
 {

80 
UINT32
 
	gSDP0
;

82 
UINT32
 
	gDMADONE
:1;

83 
UINT32
 
	gLaSec0
:1;

84 
UINT32
 
	gSDL0
:14;

85 
UINT32
 
	gBur
:1;

86 
UINT32
 
	gLaSec1
:1;

87 
UINT32
 
	gSDL1
:14;

89 
UINT32
 
	gSDP1
;

91 
UINT32
 
	gICO
:1;

92 
UINT32
 
	gUCO
:1;

93 
UINT32
 
	gTCO
:1;

94 
UINT32
 
	grsv
:2;

95 
UINT32
 
	gQSEL
:2;

96 
UINT32
 
	gWIV
:1;

97 
UINT32
 
	grsv2
:24;

98 } 
	tTXD_STRUC
, *
	tPTXD_STRUC
;

100 
GNU_PACKED
 
	t_TXD_STRUC
 {

102 
UINT32
 
	gSDP0
;

104 
UINT32
 
	gSDL1
:14;

105 
UINT32
 
	gLaSec1
:1;

106 
UINT32
 
	gBur
:1;

107 
UINT32
 
	gSDL0
:14;

108 
UINT32
 
	gLaSec0
:1;

109 
UINT32
 
	gDMADONE
:1;

111 
UINT32
 
	gSDP1
;

113 
UINT32
 
	grsv2
:24;

114 
UINT32
 
	gWIV
:1;

115 
UINT32
 
	gQSEL
:2;

116 
UINT32
 
	grsv
:2;

117 
UINT32
 
	gTCO
:1;

118 
UINT32
 
	gUCO
:1;

119 
UINT32
 
	gICO
:1;

120 } 
	tTXD_STRUC
, *
	tPTXD_STRUC
;

127 #ifde
RT_BIG_ENDIAN


128 
GNU_PACKED
 
	t_RXD_STRUC
{

130 
UINT32
 
	gSDP0
;

132 
UINT32
 
	gDDONE
:1;

133 
UINT32
 
	gLS0
:1;

134 
UINT32
 
	gSDL0
:14;

135 
UINT32
 
	gRsv
:2;

136 
UINT32
 
	gSDL1
:14;

138 
UINT32
 
	gSDP1
;

140 
UINT32
 
	gRsv1
:13;

141 
UINT32
 
	gPlRss
:1;

142 
UINT32
 
	gPlSigl
:1;

143 
UINT32
 
	gDeyed
:1;

144 
UINT32
 
	gAMPDU
:1;

145 
UINT32
 
	gL2PAD
:1;

146 
UINT32
 
	gRSSI
:1;

147 
UINT32
 
	gHTC
:1;

148 
UINT32
 
	gAMSDU
:1;

149 
UINT32
 
	gChE
:2;

150 
UINT32
 
	gCrc
:1;

151 
UINT32
 
	gMyBss
:1;

152 
UINT32
 
	gB
:1;

153 
UINT32
 
	gM
:1;

154 
UINT32
 
	gU2M
:1;

155 
UINT32
 
	gFRAG
:1;

156 
UINT32
 
	gNULLDATA
:1;

157 
UINT32
 
	gDATA
:1;

158 
UINT32
 
	gBA
:1;

160 } 
	tRXD_STRUC
, *
	tPRXD_STRUC
, 
	tRT28XX_RXD_STRUC
, *
	tPRT28XX_RXD_STRUC
;

162 
GNU_PACKED
 
	t_RXD_STRUC
{

164 
UINT32
 
	gSDP0
;

166 
UINT32
 
	gSDL1
:14;

167 
UINT32
 
	gRsv
:2;

168 
UINT32
 
	gSDL0
:14;

169 
UINT32
 
	gLS0
:1;

170 
UINT32
 
	gDDONE
:1;

172 
UINT32
 
	gSDP1
;

174 
UINT32
 
	gBA
:1;

175 
UINT32
 
	gDATA
:1;

176 
UINT32
 
	gNULLDATA
:1;

177 
UINT32
 
	gFRAG
:1;

178 
UINT32
 
	gU2M
:1;

179 
UINT32
 
	gM
:1;

180 
UINT32
 
	gB
:1;

181 
UINT32
 
	gMyBss
:1;

182 
UINT32
 
	gCrc
:1;

183 
UINT32
 
	gChE
:2;

184 
UINT32
 
	gAMSDU
:1;

185 
UINT32
 
	gHTC
:1;

186 
UINT32
 
	gRSSI
:1;

187 
UINT32
 
	gL2PAD
:1;

188 
UINT32
 
	gAMPDU
:1;

189 
UINT32
 
	gDeyed
:1;

190 
UINT32
 
	gPlSigl
:1;

191 
UINT32
 
	gPlRss
:1;

192 
UINT32
 
	gRsv1
:13;

193 } 
	tRXD_STRUC
, *
	tPRXD_STRUC
, 
	tRT28XX_RXD_STRUC
, *
	tPRT28XX_RXD_STRUC
;

196 #ifde
RT_BIG_ENDIAN


197 
	u_TX_ATTENUATION_CTRL_STRUC


201 
ULONG
 
	mRerve1
:20;

202 
ULONG
 
	mPCIE_PHY_TX_ATTEN_EN
:1;

203 
ULONG
 
	mPCIE_PHY_TX_ATTEN_VALUE
:3;

204 
ULONG
 
	mRerve2
:7;

205 
ULONG
 
	mRF_ISOLATION_ENABLE
:1;

206 } 
	mfld
;

208 
ULONG
 
	mwd
;

209 } 
	tTX_ATTENUATION_CTRL_STRUC
, *
	tPTX_ATTENUATION_CTRL_STRUC
;

211 
	u_TX_ATTENUATION_CTRL_STRUC
 {

214 
ULONG
 
	mRF_ISOLATION_ENABLE
:1;

215 
ULONG
 
	mRerve2
:7;

216 
ULONG
 
	mPCIE_PHY_TX_ATTEN_VALUE
:3;

217 
ULONG
 
	mPCIE_PHY_TX_ATTEN_EN
:1;

218 
ULONG
 
	mRerve1
:20;

219 } 
	mfld
;

221 
ULONG
 
	mwd
;

222 } 
	tTX_ATTENUATION_CTRL_STRUC
, *
	tPTX_ATTENUATION_CTRL_STRUC
;

227 
	#FIRMWARE_IMAGE_BASE
 0x2000

	)

228 
	#MAX_FIRMWARE_IMAGE_SIZE
 0x2000

229 

	)

232 
	#RTMP_WRITE_FIRMWARE
(
_pAd
, 
_pFwImage
, 
_FwL
) \

234 
ULONG
 
_i
, 
_fm
; \

236 
	`RTMP_IO_WRITE32
(
_pAd
, 
PBF_SYS_CTRL
, 0x10000); \

238 
_i
=0; _i<
_FwL
; _i+=4) \

240 
_fm
 = 
_pFwImage
[
_i
] + \

241 (
_pFwImage
[
_i
+3] << 24) + \

242 (
_pFwImage
[
_i
+2] << 16) + \

243 (
_pFwImage
[
_i
+1] << 8); \

244 
	`RTMP_IO_WRITE32
(
_pAd
, 
FIRMWARE_IMAGE_BASE
 + 
_i
, 
_fm
); \

247 
	`RTMP_IO_WRITE32
(
_pAd
, 
PBF_SYS_CTRL
, 0x00000); \

248 
	`RTMP_IO_WRITE32
(
_pAd
, 
PBF_SYS_CTRL
, 0x00001); \

251 
	`RTMP_IO_WRITE32
(
_pAd
, 
H2M_BBP_AGENT
, 0); \

252 
	`RTMP_IO_WRITE32
(
_pAd
, 
H2M_MAILBOX_CSR
, 0); \

253 }0)

	)

257 
	#RTMP_START_DEQUEUE
(
pAd
, 
QueIdx
, 
qFgs
do{}0)

	)

258 
	#RTMP_STOP_DEQUEUE
(
pAd
, 
QueIdx
, 
qFgs
do{}0)

	)

261 
	#RTMP_HAS_ENOUGH_FREE_DESC
(
pAd
, 
pTxBlk
, 
Num
, 
pPack
) \

262 ((
Num
>(
ULONG
)(
pTxBlk
->
TٮFgNum
 + 
	`RTMP_GET_PACKET_FRAGMENTS
(
pPack
+ 3)

	)

263 
	#RTMP_RELEASE_DESC_RESOURCE
(
pAd
, 
QueIdx
) \

264 do{}0)

	)

266 
	#NEED_QUEUE_BACK_FOR_AGG
(
pAd
, 
QueIdx
, 
Num
, 
_TxFmeTy
) \

267 (((
Num
 !(
TX_RING_SIZE
-1)&& (
pAd
->
TxSwQueue
[
QueIdx
].
Numb
 =0)|| (Num<3))

	)

271 
	#HAL_KickOutMgmtTx
(
_pAd
, 
_QueIdx
, 
_pPack
, 
_pSrcBufVA
, 
_SrcBufL
) \

272 
	`RtmpPCIMgmtKickOut
(
_pAd
, 
_QueIdx
, 
_pPack
, 
_pSrcBufVA
, 
_SrcBufL
)

	)

274 
	#HAL_WreSubTxResour
(
pAd
, 
pTxBlk
, 
bIsLa
, 
pFeNumb
) \

275 

	)

277 
	#HAL_WreTxResour
(
pAd
, 
pTxBlk
,
bIsLa
, 
pFeNumb
) \

278 
	`RtmpPCI_WreSgTxResour
(
pAd
, 
pTxBlk
, 
bIsLa
, 
pFeNumb
)

	)

280 
	#HAL_WreFgTxResour
(
pAd
, 
pTxBlk
, 
agNum
, 
pFeNumb
) \

281 
	`RtmpPCI_WreFgTxResour
(
pAd
, 
pTxBlk
, 
agNum
, 
pFeNumb
)

	)

283 
	#HAL_WreMuiTxResour
(
pAd
, 
pTxBlk
,
ameNum
, 
pFeNumb
) \

284 
	`RtmpPCI_WreMuiTxResour
(
pAd
, 
pTxBlk
, 
ameNum
, 
pFeNumb
)

	)

286 
	#HAL_FWreTxResour
(
_pAd
, 
_pTxBlk
, 
_TٮMPDUSize
, 
_FTxIdx
) \

287 
	`RtmpPCI_FWreTxResour
(
_pAd
, 
_pTxBlk
, 
_TٮMPDUSize
, 
_FTxIdx
)

	)

289 
	#HAL_LaTxIdx
(
_pAd
, 
_QueIdx
,
_LaTxIdx
) \

290 

	)

292 
	#HAL_KickOutTx
(
_pAd
, 
_pTxBlk
, 
_QueIdx
) \

293 
	`RTMP_IO_WRITE32
((
_pAd
), 
TX_CTX_IDX0
+((
_QueIdx
)*0x10), (_pAd)->
TxRg
[(_QueIdx)].
TxCpuIdx
)

	)

296 
	#HAL_KickOutNuFmeTx
(
_pAd
, 
_QueIdx
, 
_pNuFme
, 
_ameL
) \

297 
	`MtMMReque
(
_pAd
, 
_QueIdx
, 
_pNuFme
, 
_ameL
)

	)

299 
	#GET_TXRING_FREENO
(
_pAd
, 
_QueIdx
) \

300 (
_pAd
->
TxRg
[
_QueIdx
].
TxSwFeIdx
 > _pAd->TxRg[_QueIdx].
TxCpuIdx
) ? \

301 (
_pAd
->
TxRg
[
_QueIdx
].
TxSwFeIdx
 - _pAd->TxRg[_QueIdx].
TxCpuIdx
 - 1) \

303 (
_pAd
->
TxRg
[
_QueIdx
].
TxSwFeIdx
 + 
TX_RING_SIZE
 - _pAd->TxRg[_QueIdx].
TxCpuIdx
 - 1);

	)

306 
	#GET_MGMTRING_FREENO
(
_pAd
) \

307 (
_pAd
->
MgmtRg
.
TxSwFeIdx
 > _pAd->MgmtRg.
TxCpuIdx
) ? \

308 (
_pAd
->
MgmtRg
.
TxSwFeIdx
 - _pAd->MgmtRg.
TxCpuIdx
 - 1) \

310 (
_pAd
->
MgmtRg
.
TxSwFeIdx
 + 
MGMT_RING_SIZE
 - _pAd->MgmtRg.
TxCpuIdx
 - 1);

	)

318 
	#RTMP_STA_ENTRY_MAC_RESET
(
pAd
, 
Wcid
) \

319 
	`AsicDWcidTab
(
pAd
, 
Wcid
);

	)

322 
	#RTMP_STA_ENTRY_ADD
(
pAd
, 
pEry
) \

323 
	`AsicUpdeRxWCIDTab
(
pAd
, 
pEry
->
Aid
,Ery->
Addr
);

	)

327 
	#RTMP_UPDATE_PROTECT
(
pAd
) \

328 
	`AsicUpdePre
(
pAd
, 0, (
ALLN_SETPROTECT
), 
TRUE
, 0);

	)

332 
	#RTMP_ADD_BA_SESSION_TO_ASIC
(
_pAd
, 
_Aid
, 
_TID
) \

334 
UINT32
 
_Vue
 = 0, 
_Offt
; \

335 
_Offt
 = 
MAC_WCID_BASE
 + (
_Aid
* 
HW_WCID_ENTRY_SIZE
 + 4; \

336 
	`RTMP_IO_READ32
((
_pAd
), 
_Offt
, &
_Vue
);\

337 
_Vue
 |(0x10000<<(
_TID
)); \

338 
	`RTMP_IO_WRITE32
((
_pAd
), 
_Offt
, 
_Vue
);\

339 }0)

	)

344 
	#RTMP_DEL_BA_SESSION_FROM_ASIC
(
_pAd
, 
_Wcid
, 
_TID
) \

346 
UINT32
 
_Vue
 = 0, 
_Offt
; \

347 
_Offt
 = 
MAC_WCID_BASE
 + (
_Wcid
* 
HW_WCID_ENTRY_SIZE
 + 4; \

348 
	`RTMP_IO_READ32
((
_pAd
), 
_Offt
, &
_Vue
); \

349 
_Vue
 &(~(0x10000 << (
_TID
))); \

350 
	`RTMP_IO_WRITE32
((
_pAd
), 
_Offt
, 
_Vue
); \

351 }0)

	)

360 
	#RTMP_ASIC_INTERRUPT_DISABLE
(
_pAd
) \

362 
	`RTMP_IO_WRITE32
((
_pAd
), 
INT_MASK_CSR
, 0x0); \

363 
	`RTMP_CLEAR_FLAG
((
_pAd
), 
fRTMP_ADAPTER_INTERRUPT_ACTIVE
); \

364 }0)

	)

366 
	#RTMP_ASIC_INTERRUPT_ENABLE
(
_pAd
)\

368 
	`RTMP_IO_WRITE32
((
_pAd
), 
INT_MASK_CSR
, (_pAd)->
t_ab_g
 ); \

369 
	`RTMP_SET_FLAG
((
_pAd
), 
fRTMP_ADAPTER_INTERRUPT_ACTIVE
); \

370 }0)

	)

373 
	#RTMP_IRQ_INIT
(
pAd
) \

374 { 
pAd
->
t_ab_g
 = ((
DELAYINTMASK
) | \

375 (
RxINT
|
TxDaI
|
TxMgmtI
)) & ~(0x03); \

376 
pAd
->
t_dib_mask
 = 0; \

377 
pAd
->
t_ndg
 = 0; }

	)

379 
	#RTMP_IRQ_ENABLE
(
pAd
) \

381 
	`RTMP_IO_WRITE32
(
pAd
, 
INT_SOURCE_CSR
, 0xffffffff);\

382 
	`RTMP_ASIC_INTERRUPT_ENABLE
(
pAd
); }

	)

386 
	#RTMP_MLME_HANDLER
(
pAd

	`MlmeHdr
Ad)

	)

388 
	#RTMP_MLME_PRE_SANITY_CHECK
(
pAd
)

	)

390 
	#RTMP_MLME_STA_QUICK_RSP_WAKE_UP
(
pAd
) \

391 
	`RTMPSTim
(&
pAd
->
SCfg
.
SQuickReeFReUpTim
, 100);

	)

393 
	#RTMP_MLME_RESET_STATE_MACHINE
(
pAd
) \

394 
	`MlmeRetSMache
(
pAd
)

	)

396 
	#RTMP_HANDLE_COUNTER_MEASURE
(
_pAd
, 
_pEry
)\

397 
	`HdCouMsu
(
_pAd
, 
_pEry
)

	)

400 
	#RTMP_PS_POLL_ENQUEUE
(
pAd

	`EnqueuePsPl
Ad)

	)

404 
	#RESTORE_HALT
 1

	)

405 
	#RESTORE_WAKEUP
 2

	)

406 
	#RESTORE_CLOSE
 3

	)

408 
	#PowSaCID
 1

	)

409 
	#PowRadioOffCID
 2

	)

410 
	#PowWakeCID
 3

	)

411 
	#CID0MASK
 0x000000ff

	)

412 
	#CID1MASK
 0x0000ff00

	)

413 
	#CID2MASK
 0x00ff0000

	)

414 
	#CID3MASK
 0xff000000

	)

417 #ifde
CONFIG_STA_SUPPORT


418 
	#RTMP_STA_FORCE_WAKEUP
(
pAd
, 
bFromTx
) \

419 
	`RT28xxPciSAsicFWakeup
(
pAd
, 
bFromTx
);

	)

421 
	#RTMP_STA_SLEEP_THEN_AUTO_WAKEUP
(
pAd
, 
TbNumToNextWakeUp
) \

422 
	`RT28xxPciSAsicS˕ThAutoWakeup
(
pAd
, 
TbNumToNextWakeUp
);

	)

424 
	#RTMP_SET_PSM_BIT
(
_pAd
, 
_v
) \

425 
	`MlmeSPsmB
(
_pAd
, 
_v
);

	)

428 
	#RTMP_MLME_RADIO_ON
(
pAd
) \

429 
	`RT28xxPciMlmeRadioOn
(
pAd
);

	)

431 
	#RTMP_MLME_RADIO_OFF
(
pAd
) \

432 
	`RT28xxPciMlmeRadioOFF
(
pAd
);

	)

437 
	#RTMP_SET_WCID_SEC_INFO
(
_pAd
, 
_BssIdx
, 
_KeyIdx
, 
_ChAlg
, 
_Wcid
, 
_KeyTabFg
) \

438 
	`RTMPSWcidSecuryInfo
(
_pAd
, 
_BssIdx
, 
_KeyIdx
, 
_ChAlg
, 
_Wcid
, 
_KeyTabFg
)

	)

441 
	#RTMP_ASIC_WCID_IVEIV_TABLE
(
_pAd
, 
_Wcid
, 
_uIV
, 
_uEIV
) \

442 
	`AsicUpdeWCIDIVEIV
(
_pAd
, 
_Wcid
, 
_uIV
, 
_uEIV
)

	)

445 
	#RTMP_ASIC_WCID_ATTR_TABLE
(
_pAd
, 
_BssIdx
, 
_KeyIdx
, 
_ChAlg
, 
_Wcid
, 
_KeyTabFg
)\

446 
	`AsicUpdeWcidAribuEry
(
_pAd
, 
_BssIdx
, 
_KeyIdx
, 
_ChAlg
, 
_Wcid
, 
_KeyTabFg
)

	)

449 
	#RTMP_ASIC_PAIRWISE_KEY_TABLE
(
_pAd
, 
_WCID
, 
_pChKey
) \

450 
	`AsicAddPawiKeyEry
(
_pAd
, 
_WCID
, 
_pChKey
)

	)

453 
	#RTMP_ASIC_SHARED_KEY_TABLE
(
_pAd
, 
_BssIndex
, 
_KeyIdx
, 
_pChKey
) \

454 
	`AsicAddShedKeyEry
(
_pAd
, 
_BssIndex
, 
_KeyIdx
, 
_pChKey
)

	)

456 #ifde
CONFIG_STA_SUPPORT


458 
	#RTMP_SET_PORT_SECURED
(
_pAd
) \

459 
	`STA_PORT_SECURED
(
_pAd
);

	)

463 
	#RTMP_REMOVE_PAIRWISE_KEY_ENTRY
(
_pAd
, 
_Wcid
)\

464 
	`AsicRemovePawiKeyEry
(
_pAd
, 
_Wcid
)

	)

	@include/chip/rt2860.h

37 #ide
__RT2860_H__


38 
	#__RT2860_H__


	)

40 #ifde
RT2860


41 
	~"ch/mac_pci.h
"

43 #ide
RTMP_PCI_SUPPORT


47 #ide
RTMP_MAC_PCI


54 
	#NIC2860_PCI_DEVICE_ID
 0x0601

	)

55 
	#NIC2860_PCIe_DEVICE_ID
 0x0681

	)

56 
	#NIC2760_PCI_DEVICE_ID
 0x0701

57 
	#NIC2790_PCIe_DEVICE_ID
 0x0781

58 

	)

60 
	#VEN_AWT_PCIe_DEVICE_ID
 0x1059

	)

61 
	#VEN_AWT_PCI_VENDOR_ID
 0x1A3B

	)

63 
	#EDIMAX_PCI_VENDOR_ID
 0x1432

	)

	@include/chip/rtmp_mac.h

38 #ide
__RTMP_MAC_H__


39 
	#__RTMP_MAC_H__


	)

49 
	#FIFO_MGMT
 0

	)

50 
	#FIFO_HCCA
 1

	)

51 
	#FIFO_EDCA
 2

	)

60 #ifde
RT_BIG_ENDIAN


61 
GNU_PACKED
 
	t_TXWI_STRUC
 {

63 
UINT32
 
	gPHYMODE
:2;

64 
UINT32
 
	grsv2
:2;

65 
UINT32
 
	gIfs
:1;

66 
UINT32
 
	gSTBC
:2;

67 
UINT32
 
	gShtGI
:1;

68 
UINT32
 
	gBW
:1;

69 
UINT32
 
	gMCS
:7;

71 
UINT32
 
	grsv
:6;

72 
UINT32
 
	gtx
:2;

73 
UINT32
 
	gMpduDsy
:3;

74 
UINT32
 
	gAMPDU
:1;

76 
UINT32
 
	gTS
:1;

77 
UINT32
 
	gCFACK
:1;

78 
UINT32
 
	gMIMOps
:1;

79 
UINT32
 
	gFRAG
:1;

81 
UINT32
 
	gPackId
:4;

82 
UINT32
 
	gMPDUtٮByCou
:12;

83 
UINT32
 
	gWessCliID
:8;

84 
UINT32
 
	gBAWSize
:6;

85 
UINT32
 
	gNSEQ
:1;

86 
UINT32
 
	gACK
:1;

88 
UINT32
 
	gIV
;

90 
UINT32
 
	gEIV
;

91 } 
	tTXWI_STRUC
, *
	tPTXWI_STRUC
;

93 
GNU_PACKED
 
	t_TXWI_STRUC
 {

96 
UINT32
 
	gFRAG
:1;

97 
UINT32
 
	gMIMOps
:1;

98 
UINT32
 
	gCFACK
:1;

99 
UINT32
 
	gTS
:1;

101 
UINT32
 
	gAMPDU
:1;

102 
UINT32
 
	gMpduDsy
:3;

103 
UINT32
 
	gtx
:2;

104 
UINT32
 
	grsv
:6;

106 
UINT32
 
	gMCS
:7;

107 
UINT32
 
	gBW
:1;

108 
UINT32
 
	gShtGI
:1;

109 
UINT32
 
	gSTBC
:2;

110 
UINT32
 
	gIfs
:1;

111 
UINT32
 
	grsv2
:2;

112 
UINT32
 
	gPHYMODE
:2;

115 
UINT32
 
	gACK
:1;

116 
UINT32
 
	gNSEQ
:1;

117 
UINT32
 
	gBAWSize
:6;

118 
UINT32
 
	gWessCliID
:8;

119 
UINT32
 
	gMPDUtٮByCou
:12;

120 
UINT32
 
	gPackId
:4;

122 
UINT32
 
	gIV
;

124 
UINT32
 
	gEIV
;

125 } 
	tTXWI_STRUC
, *
	tPTXWI_STRUC
;

132 #ifde
RT_BIG_ENDIAN


133 
GNU_PACKED
 
	t_RXWI_STRUC
 {

135 
UINT32
 
	gTID
:4;

136 
UINT32
 
	gMPDUtٮByCou
:12;

137 
UINT32
 
	gUDF
:3;

138 
UINT32
 
	gBSSID
:3;

139 
UINT32
 
	gKeyIndex
:2;

140 
UINT32
 
	gWessCliID
:8;

142 
UINT32
 
	gPHYMODE
:2;

143 
UINT32
 
	grsv
:3;

144 
UINT32
 
	gSTBC
:2;

145 
UINT32
 
	gShtGI
:1;

146 
UINT32
 
	gBW
:1;

147 
UINT32
 
	gMCS
:7;

148 
UINT32
 
	gSEQUENCE
:12;

149 
UINT32
 
	gFRAG
:4;

151 
UINT32
 
	grsv1
:8;

152 
UINT32
 
	gRSSI2
:8;

153 
UINT32
 
	gRSSI1
:8;

154 
UINT32
 
	gRSSI0
:8;

157 
UINT32
 
	grsv2
:8;

158 
UINT32
 
	gFOFFSET
:8;

159 
UINT32
 
	gSNR1
:8;

160 
UINT32
 
	gSNR0
:8;

161 } 
	tRXWI_STRUC
, *
	tPRXWI_STRUC
;

163 
GNU_PACKED
 
	t_RXWI_STRUC
 {

165 
UINT32
 
	gWessCliID
:8;

166 
UINT32
 
	gKeyIndex
:2;

167 
UINT32
 
	gBSSID
:3;

168 
UINT32
 
	gUDF
:3;

169 
UINT32
 
	gMPDUtٮByCou
:12;

170 
UINT32
 
	gTID
:4;

172 
UINT32
 
	gFRAG
:4;

173 
UINT32
 
	gSEQUENCE
:12;

174 
UINT32
 
	gMCS
:7;

175 
UINT32
 
	gBW
:1;

176 
UINT32
 
	gShtGI
:1;

177 
UINT32
 
	gSTBC
:2;

178 
UINT32
 
	grsv
:3;

179 
UINT32
 
	gPHYMODE
:2;

181 
UINT32
 
	gRSSI0
:8;

182 
UINT32
 
	gRSSI1
:8;

183 
UINT32
 
	gRSSI2
:8;

184 
UINT32
 
	grsv1
:8;

186 
UINT32
 
	gSNR0
:8;

187 
UINT32
 
	gSNR1
:8;

188 
UINT32
 
	gFOFFSET
:8;

189 
UINT32
 
	grsv2
:8;

191 } 
	tRXWI_STRUC
, *
	tPRXWI_STRUC
;

203 
	#PCI_CFG
 0x0000

	)

204 
	#PCI_EECTRL
 0x0004

	)

205 
	#PCI_MCUCTRL
 0x0008

	)

206 
	#AUX_CTRL
 0x10c

	)

208 
	#OPT_14
 0x114

	)

215 
	#DMA_CSR0
 0x200

	)

216 
	#INT_SOURCE_CSR
 0x200

	)

217 #ifde
RT_BIG_ENDIAN


218 
	u_INT_SOURCE_CSR_STRUC
 {

220 #ifde
TONE_RADAR_DETECT_SUPPORT


221 
	mUINT32
 :11;

222 
UINT32
 
	mRadINT
:1;

223 
UINT32
 
	mrsv
:2;

225 
	mUINT32
 :14;

227 
UINT32
 
	mTxCoht
:1;

228 
UINT32
 
	mRxCoht
:1;

229 
UINT32
 
	mGPTim
:1;

230 
UINT32
 
	mAutoWakeup
:1;

231 
UINT32
 
	mTXFifoStusI
:1;

232 
UINT32
 
	mPTBTT
:1;

233 
UINT32
 
	mTBTTI
:1;

234 
UINT32
 
	mRxTxCoht
:1;

235 
UINT32
 
	mMCUCommdINT
:1;

236 
UINT32
 
	mMgmtDmaDe
:1;

237 
UINT32
 
	mHcDmaDe
:1;

238 
UINT32
 
	mAc3DmaDe
:1;

239 
UINT32
 
	mAc2DmaDe
:1;

240 
UINT32
 
	mAc1DmaDe
:1;

241 
UINT32
 
	mAc0DmaDe
:1;

242 
UINT32
 
	mRxDe
:1;

243 
UINT32
 
	mTxDayINT
:1;

244 
UINT32
 
	mRxDayINT
:1;

245 } 
	mfld
;

246 
UINT32
 
	mwd
;

247 } 
	tINT_SOURCE_CSR_STRUC
, *
	tPINT_SOURCE_CSR_STRUC
;

249 
	u_INT_SOURCE_CSR_STRUC
 {

251 
UINT32
 
	mRxDayINT
:1;

252 
UINT32
 
	mTxDayINT
:1;

253 
UINT32
 
	mRxDe
:1;

254 
UINT32
 
	mAc0DmaDe
:1;

255 
UINT32
 
	mAc1DmaDe
:1;

256 
UINT32
 
	mAc2DmaDe
:1;

257 
UINT32
 
	mAc3DmaDe
:1;

258 
UINT32
 
	mHcDmaDe
:1;

259 
UINT32
 
	mMgmtDmaDe
:1;

260 
UINT32
 
	mMCUCommdINT
:1;

261 
UINT32
 
	mRxTxCoht
:1;

262 
UINT32
 
	mTBTTI
:1;

263 
UINT32
 
	mPTBTT
:1;

264 
UINT32
 
	mTXFifoStusI
:1;

265 
UINT32
 
	mAutoWakeup
:1;

266 
UINT32
 
	mGPTim
:1;

267 
UINT32
 
	mRxCoht
:1;

268 
UINT32
 
	mTxCoht
:1;

269 #ifde
TONE_RADAR_DETECT_SUPPORT


270 
UINT32
 
	mrsv
:2;

271 
UINT32
 
	mRadINT
:1;

272 
	mUINT32
 :11;

274 
	mUINT32
 :14;

276 } 
	mfld
;

277 
UINT32
 
	mwd
;

278 } 
	tINT_SOURCE_CSR_STRUC
, *
	tPINT_SOURCE_CSR_STRUC
;

284 
	#INT_MASK_CSR
 0x204

	)

285 #ifde
RT_BIG_ENDIAN


286 
	u_INT_MASK_CSR_STRUC
 {

288 
UINT32
 
	mTxCoht
:1;

289 
UINT32
 
	mRxCoht
:1;

290 #ifde
TONE_RADAR_DETECT_SUPPORT


291 
	mUINT32
 :9;

292 
UINT32
 
	mRadINT
:1;

293 
UINT32
 
	mrsv
:10;

295 
	mUINT32
 :20;

297 
UINT32
 
	mMCUCommdINT
:1;

298 
UINT32
 
	mMgmtDmaDe
:1;

299 
UINT32
 
	mHcDmaDe
:1;

300 
UINT32
 
	mAc3DmaDe
:1;

301 
UINT32
 
	mAc2DmaDe
:1;

302 
UINT32
 
	mAc1DmaDe
:1;

303 
UINT32
 
	mAc0DmaDe
:1;

304 
UINT32
 
	mRxDe
:1;

305 
UINT32
 
	mTxDay
:1;

306 
UINT32
 
	mRXDay_INT_MSK
:1;

307 } 
	mfld
;

308 
UINT32
 
	mwd
;

309 }
	tINT_MASK_CSR_STRUC
, *
	tPINT_MASK_CSR_STRUC
;

311 
	u_INT_MASK_CSR_STRUC
 {

313 
UINT32
 
	mRXDay_INT_MSK
:1;

314 
UINT32
 
	mTxDay
:1;

315 
UINT32
 
	mRxDe
:1;

316 
UINT32
 
	mAc0DmaDe
:1;

317 
UINT32
 
	mAc1DmaDe
:1;

318 
UINT32
 
	mAc2DmaDe
:1;

319 
UINT32
 
	mAc3DmaDe
:1;

320 
UINT32
 
	mHcDmaDe
:1;

321 
UINT32
 
	mMgmtDmaDe
:1;

322 
UINT32
 
	mMCUCommdINT
:1;

323 #ifde
TONE_RADAR_DETECT_SUPPORT


324 
UINT32
 
	mrsv
:10;

325 
UINT32
 
	mRadINT
:1;

326 
	mUINT32
 :9;

328 
	mUINT32
 :20;

330 
UINT32
 
	mRxCoht
:1;

331 
UINT32
 
	mTxCoht
:1;

332 } 
	mfld
;

333 
UINT32
 
	mwd
;

334 } 
	tINT_MASK_CSR_STRUC
, *
	tPINT_MASK_CSR_STRUC
;

337 
	#WPDMA_GLO_CFG
 0x208

	)

338 #ifde
RT_BIG_ENDIAN


339 
	u_WPDMA_GLO_CFG_STRUC
 {

341 
UINT32
 
	mHDR_SEG_LEN
:16;

342 
UINT32
 
	mRXHdrSr
:8;

343 
UINT32
 
	mBigEndn
:1;

344 
UINT32
 
	mEnTXWreBackDDONE
:1;

345 
UINT32
 
	mWPDMABurSIZE
:2;

346 
UINT32
 
	mRxDMABusy
:1;

347 
UINT32
 
	mEbRxDMA
:1;

348 
UINT32
 
	mTxDMABusy
:1;

349 
UINT32
 
	mEbTxDMA
:1;

350 } 
	mfld
;

351 
UINT32
 
	mwd
;

352 }
	tWPDMA_GLO_CFG_STRUC
, *
	tPWPDMA_GLO_CFG_STRUC
;

354 
	u_WPDMA_GLO_CFG_STRUC
 {

356 
UINT32
 
	mEbTxDMA
:1;

357 
UINT32
 
	mTxDMABusy
:1;

358 
UINT32
 
	mEbRxDMA
:1;

359 
UINT32
 
	mRxDMABusy
:1;

360 
UINT32
 
	mWPDMABurSIZE
:2;

361 
UINT32
 
	mEnTXWreBackDDONE
:1;

362 
UINT32
 
	mBigEndn
:1;

363 
UINT32
 
	mRXHdrSr
:8;

364 
UINT32
 
	mHDR_SEG_LEN
:16;

365 } 
	mfld
;

366 
UINT32
 
	mwd
;

367 } 
	tWPDMA_GLO_CFG_STRUC
, *
	tPWPDMA_GLO_CFG_STRUC
;

370 
	#WPDMA_RST_IDX
 0x20c

	)

371 #ifde
RT_BIG_ENDIAN


372 
	u_WPDMA_RST_IDX_STRUC
 {

374 
	mUINT32
 :15;

375 
UINT32
 
	mRST_DRX_IDX0
:1;

376 
UINT32
 
	mrsv
:10;

377 
UINT32
 
	mRST_DTX_IDX5
:1;

378 
UINT32
 
	mRST_DTX_IDX4
:1;

379 
UINT32
 
	mRST_DTX_IDX3
:1;

380 
UINT32
 
	mRST_DTX_IDX2
:1;

381 
UINT32
 
	mRST_DTX_IDX1
:1;

382 
UINT32
 
	mRST_DTX_IDX0
:1;

383 } 
	mfld
;

384 
UINT32
 
	mwd
;

385 }
	tWPDMA_RST_IDX_STRUC
, *
	tPWPDMA_RST_IDX_STRUC
;

387 
	u_WPDMA_RST_IDX_STRUC
 {

389 
UINT32
 
	mRST_DTX_IDX0
:1;

390 
UINT32
 
	mRST_DTX_IDX1
:1;

391 
UINT32
 
	mRST_DTX_IDX2
:1;

392 
UINT32
 
	mRST_DTX_IDX3
:1;

393 
UINT32
 
	mRST_DTX_IDX4
:1;

394 
UINT32
 
	mRST_DTX_IDX5
:1;

395 
UINT32
 
	mrsv
:10;

396 
UINT32
 
	mRST_DRX_IDX0
:1;

397 
	mUINT32
 :15;

398 } 
	mfld
;

399 
UINT32
 
	mwd
;

400 } 
	tWPDMA_RST_IDX_STRUC
, *
	tPWPDMA_RST_IDX_STRUC
;

402 
	#DELAY_INT_CFG
 0x0210

	)

403 #ifde
RT_BIG_ENDIAN


404 
	u_DELAY_INT_CFG_STRUC
 {

406 
UINT32
 
	mTXDLY_INT_EN
:1;

407 
UINT32
 
	mTXMAX_PINT
:7;

408 
UINT32
 
	mTXMAX_PTIME
:8;

409 
UINT32
 
	mRXDLY_INT_EN
:1;

410 
UINT32
 
	mRXMAX_PINT
:7;

411 
UINT32
 
	mRXMAX_PTIME
:8;

412 } 
	mfld
;

413 
UINT32
 
	mwd
;

414 }
	tDELAY_INT_CFG_STRUC
, *
	tPDELAY_INT_CFG_STRUC
;

416 
	u_DELAY_INT_CFG_STRUC
 {

418 
UINT32
 
	mRXMAX_PTIME
:8;

419 
UINT32
 
	mRXMAX_PINT
:7;

420 
UINT32
 
	mRXDLY_INT_EN
:1;

421 
UINT32
 
	mTXMAX_PTIME
:8;

422 
UINT32
 
	mTXMAX_PINT
:7;

423 
UINT32
 
	mTXDLY_INT_EN
:1;

424 } 
	mfld
;

425 
UINT32
 
	mwd
;

426 } 
	tDELAY_INT_CFG_STRUC
, *
	tPDELAY_INT_CFG_STRUC
;

428 
	#WMM_AIFSN_CFG
 0x0214

	)

429 #ifde
RT_BIG_ENDIAN


430 
	u_AIFSN_CSR_STRUC
 {

432 
UINT32
 
	mRsv
:16;

433 
UINT32
 
	mAif3
:4;

434 
UINT32
 
	mAif2
:4;

435 
UINT32
 
	mAif1
:4;

436 
UINT32
 
	mAif0
:4;

437 } 
	mfld
;

438 
UINT32
 
	mwd
;

439 } 
	tAIFSN_CSR_STRUC
, *
	tPAIFSN_CSR_STRUC
;

441 
	u_AIFSN_CSR_STRUC
 {

443 
UINT32
 
	mAif0
:4;

444 
UINT32
 
	mAif1
:4;

445 
UINT32
 
	mAif2
:4;

446 
UINT32
 
	mAif3
:4;

447 
UINT32
 
	mRsv
:16;

448 } 
	mfld
;

449 
UINT32
 
	mwd
;

450 } 
	tAIFSN_CSR_STRUC
, *
	tPAIFSN_CSR_STRUC
;

455 
	#WMM_CWMIN_CFG
 0x0218

	)

456 #ifde
RT_BIG_ENDIAN


457 
	u_CWMIN_CSR_STRUC
 {

459 
UINT32
 
	mRsv
:16;

460 
UINT32
 
	mCwm3
:4;

461 
UINT32
 
	mCwm2
:4;

462 
UINT32
 
	mCwm1
:4;

463 
UINT32
 
	mCwm0
:4;

464 } 
	mfld
;

465 
UINT32
 
	mwd
;

466 } 
	tCWMIN_CSR_STRUC
, *
	tPCWMIN_CSR_STRUC
;

468 
	u_CWMIN_CSR_STRUC
 {

470 
UINT32
 
	mCwm0
:4;

471 
UINT32
 
	mCwm1
:4;

472 
UINT32
 
	mCwm2
:4;

473 
UINT32
 
	mCwm3
:4;

474 
UINT32
 
	mRsv
:16;

475 } 
	mfld
;

476 
UINT32
 
	mwd
;

477 } 
	tCWMIN_CSR_STRUC
, *
	tPCWMIN_CSR_STRUC
;

483 
	#WMM_CWMAX_CFG
 0x021c

	)

484 #ifde
RT_BIG_ENDIAN


485 
	u_CWMAX_CSR_STRUC
 {

487 
UINT32
 
	mRsv
:16;

488 
UINT32
 
	mCwmax3
:4;

489 
UINT32
 
	mCwmax2
:4;

490 
UINT32
 
	mCwmax1
:4;

491 
UINT32
 
	mCwmax0
:4;

492 } 
	mfld
;

493 
UINT32
 
	mwd
;

494 } 
	tCWMAX_CSR_STRUC
, *
	tPCWMAX_CSR_STRUC
;

496 
	u_CWMAX_CSR_STRUC
 {

498 
UINT32
 
	mCwmax0
:4;

499 
UINT32
 
	mCwmax1
:4;

500 
UINT32
 
	mCwmax2
:4;

501 
UINT32
 
	mCwmax3
:4;

502 
UINT32
 
	mRsv
:16;

503 } 
	mfld
;

504 
UINT32
 
	mwd
;

505 } 
	tCWMAX_CSR_STRUC
, *
	tPCWMAX_CSR_STRUC
;

512 
	#WMM_TXOP0_CFG
 0x0220

	)

513 #ifde
RT_BIG_ENDIAN


514 
	u_AC_TXOP_CSR0_STRUC
 {

516 
USHORT
 
	mAc1Tx
;

517 
USHORT
 
	mAc0Tx
;

518 } 
	mfld
;

519 
UINT32
 
	mwd
;

520 } 
	tAC_TXOP_CSR0_STRUC
, *
	tPAC_TXOP_CSR0_STRUC
;

522 
	u_AC_TXOP_CSR0_STRUC
 {

524 
USHORT
 
	mAc0Tx
;

525 
USHORT
 
	mAc1Tx
;

526 } 
	mfld
;

527 
UINT32
 
	mwd
;

528 } 
	tAC_TXOP_CSR0_STRUC
, *
	tPAC_TXOP_CSR0_STRUC
;

534 
	#WMM_TXOP1_CFG
 0x0224

	)

535 #ifde
RT_BIG_ENDIAN


536 
	u_AC_TXOP_CSR1_STRUC
 {

538 
USHORT
 
	mAc3Tx
;

539 
USHORT
 
	mAc2Tx
;

540 } 
	mfld
;

541 
UINT32
 
	mwd
;

542 } 
	tAC_TXOP_CSR1_STRUC
, *
	tPAC_TXOP_CSR1_STRUC
;

544 
	u_AC_TXOP_CSR1_STRUC
 {

546 
USHORT
 
	mAc2Tx
;

547 
USHORT
 
	mAc3Tx
;

548 } 
	mfld
;

549 
UINT32
 
	mwd
;

550 } 
	tAC_TXOP_CSR1_STRUC
, *
	tPAC_TXOP_CSR1_STRUC
;

554 
	#RINGREG_DIFF
 0x10

	)

555 
	#GPIO_CTRL_CFG
 0x0228

556 
	#MCU_CMD_CFG
 0x022c

	)

557 
	#TX_BASE_PTR0
 0x0230

558 
	#TX_MAX_CNT0
 0x0234

	)

559 
	#TX_CTX_IDX0
 0x0238

	)

560 
	#TX_DTX_IDX0
 0x023c

	)

561 
	#TX_BASE_PTR1
 0x0240

562 
	#TX_MAX_CNT1
 0x0244

	)

563 
	#TX_CTX_IDX1
 0x0248

	)

564 
	#TX_DTX_IDX1
 0x024c

	)

565 
	#TX_BASE_PTR2
 0x0250

566 
	#TX_MAX_CNT2
 0x0254

	)

567 
	#TX_CTX_IDX2
 0x0258

	)

568 
	#TX_DTX_IDX2
 0x025c

	)

569 
	#TX_BASE_PTR3
 0x0260

570 
	#TX_MAX_CNT3
 0x0264

	)

571 
	#TX_CTX_IDX3
 0x0268

	)

572 
	#TX_DTX_IDX3
 0x026c

	)

573 
	#TX_BASE_PTR4
 0x0270

574 
	#TX_MAX_CNT4
 0x0274

	)

575 
	#TX_CTX_IDX4
 0x0278

	)

576 
	#TX_DTX_IDX4
 0x027c

	)

577 
	#TX_BASE_PTR5
 0x0280

578 
	#TX_MAX_CNT5
 0x0284

	)

579 
	#TX_CTX_IDX5
 0x0288

	)

580 
	#TX_DTX_IDX5
 0x028c

	)

581 
	#TX_MGMTMAX_CNT
 
TX_MAX_CNT5


	)

582 
	#TX_MGMTCTX_IDX
 
TX_CTX_IDX5


	)

583 
	#TX_MGMTDTX_IDX
 
TX_DTX_IDX5


	)

584 
	#RX_BASE_PTR
 0x0290

585 
	#RX_MAX_CNT
 0x0294

	)

586 
	#RX_CRX_IDX
 0x0298

	)

587 
	#RX_DRX_IDX
 0x029c

	)

590 
	#USB_DMA_CFG
 0x02a0

	)

591 #ifde
RT_BIG_ENDIAN


592 
	u_USB_DMA_CFG_STRUC
 {

594 
UINT32
 
	mTxBusy
:1;

595 
UINT32
 
	mRxBusy
:1;

596 
UINT32
 
	mEpoutVid
:6;

597 
UINT32
 
	mTxBulkEn
:1;

598 
UINT32
 
	mRxBulkEn
:1;

599 
UINT32
 
	mRxBulkAggEn
:1;

600 
UINT32
 
	mTxHt
:1;

601 
UINT32
 
	mTxCˬ
:1;

602 
UINT32
 
	mrsv
:2;

603 
UINT32
 
	mphyr
:1;

604 
UINT32
 
	mRxBulkAggLmt
:8;

605 
UINT32
 
	mRxBulkAggTOut
:8;

606 } 
	mfld
;

607 
UINT32
 
	mwd
;

608 } 
	tUSB_DMA_CFG_STRUC
, *
	tPUSB_DMA_CFG_STRUC
;

610 
	u_USB_DMA_CFG_STRUC
 {

612 
UINT32
 
	mRxBulkAggTOut
:8;

613 
UINT32
 
	mRxBulkAggLmt
:8;

614 
UINT32
 
	mphyr
:1;

615 
UINT32
 
	mrsv
:2;

616 
UINT32
 
	mTxCˬ
:1;

617 
UINT32
 
	mTxHt
:1;

618 
UINT32
 
	mRxBulkAggEn
:1;

619 
UINT32
 
	mRxBulkEn
:1;

620 
UINT32
 
	mTxBulkEn
:1;

621 
UINT32
 
	mEpoutVid
:6;

622 
UINT32
 
	mRxBusy
:1;

623 
UINT32
 
	mTxBusy
:1;

624 } 
	mfld
;

625 
UINT32
 
	mwd
;

626 } 
	tUSB_DMA_CFG_STRUC
, *
	tPUSB_DMA_CFG_STRUC
;

629 
	#US_CYC_CNT
 0x02a4

	)

630 #ifde
BIG_ENDIAN


631 
	u_US_CYC_CNT_STRUC
 {

633 
ULONG
 
	mrsv2
:7;

634 
ULONG
 
	mTeEn
:1;

635 
ULONG
 
	mTeS
:8;

636 
ULONG
 
	mrsv1
:7;

637 
ULONG
 
	mMiscModeEn
:1;

638 
ULONG
 
	mUsCycC
:8;

639 } 
	mfld
;

640 
ULONG
 
	mwd
;

641 } 
	tUS_CYC_CNT_STRUC
, *
	tPUS_CYC_CNT_STRUC
;

643 
	u_US_CYC_CNT_STRUC
 {

645 
ULONG
 
	mUsCycC
:8;

646 
ULONG
 
	mMiscModeEn
:1;

647 
ULONG
 
	mrsv1
:7;

648 
ULONG
 
	mTeS
:8;

649 
ULONG
 
	mTeEn
:1;

650 
ULONG
 
	mrsv2
:7;

651 } 
	mfld
;

652 
ULONG
 
	mwd
;

653 } 
	tUS_CYC_CNT_STRUC
, *
	tPUS_CYC_CNT_STRUC
;

661 
	#PBF_SYS_CTRL
 0x0400

	)

663 #ifde
RT_BIG_ENDIAN


664 
	u_PBF_SYS_CTRL_STRUC


668 
ULONG
 
	mRerved5
:12;

669 
ULONG
 
	mSHR_MSEL
:1;

670 
ULONG
 
	mPBF_MSEL
:2;

671 
ULONG
 
	mHST_PM_SEL
:1;

672 
ULONG
 
	mRerved4
:1;

673 
ULONG
 
	mCAP_MODE
:1;

674 
ULONG
 
	mRerved3
:1;

675 
ULONG
 
	mCLK_SEL
:1;

676 
ULONG
 
	mPBF_CLK_EN
:1;

677 
ULONG
 
	mMAC_CLK_EN
:1;

678 
ULONG
 
	mDMA_CLK_EN
:1;

679 
ULONG
 
	mRerved2
:1;

680 
ULONG
 
	mMCU_READY
:1;

681 
ULONG
 
	mRerved1
:2;

682 
ULONG
 
	mASY_RESET
:1;

683 
ULONG
 
	mPBF_RESET
:1;

684 
ULONG
 
	mMAC_RESET
:1;

685 
ULONG
 
	mDMA_RESET
:1;

686 
ULONG
 
	mMCU_RESET
:1;

687 } 
	mfld
;

689 
ULONG
 
	mwd
;

690 } 
	tPBF_SYS_CTRL_STRUC
, *
	tPPBF_SYS_CTRL_STRUC
;

692 
	u_PBF_SYS_CTRL_STRUC


696 
ULONG
 
	mMCU_RESET
:1;

697 
ULONG
 
	mDMA_RESET
:1;

698 
ULONG
 
	mMAC_RESET
:1;

699 
ULONG
 
	mPBF_RESET
:1;

700 
ULONG
 
	mASY_RESET
:1;

701 
ULONG
 
	mRerved1
:2;

702 
ULONG
 
	mMCU_READY
:1;

703 
ULONG
 
	mRerved2
:1;

704 
ULONG
 
	mDMA_CLK_EN
:1;

705 
ULONG
 
	mMAC_CLK_EN
:1;

706 
ULONG
 
	mPBF_CLK_EN
:1;

707 
ULONG
 
	mCLK_SEL
:1;

708 
ULONG
 
	mRerved3
:1;

709 
ULONG
 
	mCAP_MODE
:1;

710 
ULONG
 
	mRerved4
:1;

711 
ULONG
 
	mHST_PM_SEL
:1;

712 
ULONG
 
	mPBF_MSEL
:2;

713 
ULONG
 
	mSHR_MSEL
:1;

714 
ULONG
 
	mRerved5
:12;

715 } 
	mfld
;

717 
ULONG
 
	mwd
;

718 } 
	tPBF_SYS_CTRL_STRUC
, *
	tPPBF_SYS_CTRL_STRUC
;

721 
	#PBF_CFG
 0x0408

	)

722 
	#PBF_MAX_PCNT
 0x040C

	)

723 
	#PBF_CTRL
 0x0410

	)

724 
	#PBF_INT_STA
 0x0414

	)

725 
	#PBF_INT_ENA
 0x0418

	)

726 
	#TXRXQ_PCNT
 0x0438

	)

727 
	#PBF_DBG
 0x043c

	)

728 
	#PBF_CAP_CTRL
 0x0440

	)

731 
	#OSC_CTRL
 0x5a4

	)

732 
	#PCIE_PHY_TX_ATTENUATION_CTRL
 0x05C8

	)

733 
	#LDO_CFG0
 0x05d4

	)

734 
	#GPIO_SWITCH
 0x05dc

	)

743 
	#MAC_CSR0
 0x1000

	)

744 #ifde
RT_BIG_ENDIAN


745 
	u_ASIC_VER_ID_STRUC
 {

747 
USHORT
 
	mASICV
;

748 
USHORT
 
	mASICRev
;

749 } 
	mfld
;

750 
UINT32
 
	mwd
;

751 } 
	tASIC_VER_ID_STRUC
, *
	tPASIC_VER_ID_STRUC
;

753 
	u_ASIC_VER_ID_STRUC
 {

755 
USHORT
 
	mASICRev
;

756 
USHORT
 
	mASICV
;

757 } 
	mfld
;

758 
UINT32
 
	mwd
;

759 } 
	tASIC_VER_ID_STRUC
, *
	tPASIC_VER_ID_STRUC
;

761 
	#MAC_SYS_CTRL
 0x1004

762 
	#MAC_ADDR_DW0
 0x1008

763 
	#MAC_ADDR_DW1
 0x100c

767 #ifde
RT_BIG_ENDIAN


	)

768 
	u_MAC_DW0_STRUC
 {

770 
UCHAR
 
	mBy3
;

771 
UCHAR
 
	mBy2
;

772 
UCHAR
 
	mBy1
;

773 
UCHAR
 
	mBy0
;

774 } 
	mfld
;

775 
UINT32
 
	mwd
;

776 } 
	tMAC_DW0_STRUC
, *
	tPMAC_DW0_STRUC
;

778 
	u_MAC_DW0_STRUC
 {

780 
UCHAR
 
	mBy0
;

781 
UCHAR
 
	mBy1
;

782 
UCHAR
 
	mBy2
;

783 
UCHAR
 
	mBy3
;

784 } 
	mfld
;

785 
UINT32
 
	mwd
;

786 } 
	tMAC_DW0_STRUC
, *
	tPMAC_DW0_STRUC
;

792 #ifde
RT_BIG_ENDIAN


793 
	u_MAC_DW1_STRUC
 {

795 
UCHAR
 
	mRsvd1
;

796 
UCHAR
 
	mU2MeMask
;

797 
UCHAR
 
	mBy5
;

798 
UCHAR
 
	mBy4
;

799 } 
	mfld
;

800 
UINT32
 
	mwd
;

801 } 
	tMAC_DW1_STRUC
, *
	tPMAC_DW1_STRUC
;

803 
	u_MAC_DW1_STRUC
 {

805 
UCHAR
 
	mBy4
;

806 
UCHAR
 
	mBy5
;

807 
UCHAR
 
	mU2MeMask
;

808 
UCHAR
 
	mRsvd1
;

809 } 
	mfld
;

810 
UINT32
 
	mwd
;

811 } 
	tMAC_DW1_STRUC
, *
	tPMAC_DW1_STRUC
;

814 
	#MAC_BSSID_DW0
 0x1010

815 
	#MAC_BSSID_DW1
 0x1014

816 

	)

820 #ifde
RT_BIG_ENDIAN


821 
	u_MAC_CSR5_STRUC
 {

823 
USHORT
 
	mRsvd
:11;

824 
USHORT
 
	mMBssBNum
:3;

825 
USHORT
 
	mBssIdMode
:2;

826 
UCHAR
 
	mBy5
;

827 
UCHAR
 
	mBy4
;

828 } 
	mfld
;

829 
UINT32
 
	mwd
;

830 } 
	tMAC_CSR5_STRUC
, *
	tPMAC_CSR5_STRUC
;

832 
	u_MAC_CSR5_STRUC
 {

834 
UCHAR
 
	mBy4
;

835 
UCHAR
 
	mBy5
;

836 
USHORT
 
	mBssIdMask
:2;

837 
USHORT
 
	mMBssBNum
:3;

838 
USHORT
 
	mRsvd
:11;

839 } 
	mfld
;

840 
UINT32
 
	mwd
;

841 } 
	tMAC_CSR5_STRUC
, *
	tPMAC_CSR5_STRUC
;

844 
	#MAX_LEN_CFG
 0x1018

845 
	#BBP_CSR_CFG
 0x101c

849 #ifde
RT_BIG_ENDIAN


	)

850 
	u_BBP_CSR_CFG_STRUC
 {

852 
	mUINT32
 :12;

853 
UINT32
 
	mBBP_RW_MODE
:1;

854 
UINT32
 
	mBBP_PAR_DUR
:1;

855 
UINT32
 
	mBusy
:1;

856 
UINT32
 
	mfRd
:1;

857 
UINT32
 
	mRegNum
:8;

858 
UINT32
 
	mVue
:8;

859 } 
	mfld
;

860 
UINT32
 
	mwd
;

861 } 
	tBBP_CSR_CFG_STRUC
, *
	tPBBP_CSR_CFG_STRUC
;

863 
	u_BBP_CSR_CFG_STRUC
 {

865 
UINT32
 
	mVue
:8;

866 
UINT32
 
	mRegNum
:8;

867 
UINT32
 
	mfRd
:1;

868 
UINT32
 
	mBusy
:1;

869 
UINT32
 
	mBBP_PAR_DUR
:1;

870 
UINT32
 
	mBBP_RW_MODE
:1;

871 
	mUINT32
 :12;

872 } 
	mfld
;

873 
UINT32
 
	mwd
;

874 } 
	tBBP_CSR_CFG_STRUC
, *
	tPBBP_CSR_CFG_STRUC
;

876 
	#RF_CSR_CFG0
 0x1020

	)

880 #ifde
RT_BIG_ENDIAN


881 
	u_RF_CSR_CFG0_STRUC
 {

883 
UINT32
 
	mBusy
:1;

884 
UINT32
 
	mS
:1;

885 
UINT32
 
	mSndbyMode
:1;

886 
UINT32
 
	mbwidth
:5;

887 
UINT32
 
	mRegIdAndCڋ
:24;

888 } 
	mfld
;

889 
UINT32
 
	mwd
;

890 } 
	tRF_CSR_CFG0_STRUC
, *
	tPRF_CSR_CFG0_STRUC
;

892 
	u_RF_CSR_CFG0_STRUC
 {

894 
UINT32
 
	mRegIdAndCڋ
:24;

895 
UINT32
 
	mbwidth
:5;

896 
UINT32
 
	mSndbyMode
:1;

897 
UINT32
 
	mS
:1;

898 
UINT32
 
	mBusy
:1;

899 } 
	mfld
;

900 
UINT32
 
	mwd
;

901 } 
	tRF_CSR_CFG0_STRUC
, *
	tPRF_CSR_CFG0_STRUC
;

903 
	#RF_CSR_CFG1
 0x1024

	)

904 #ifde
RT_BIG_ENDIAN


905 
	u_RF_CSR_CFG1_STRUC
 {

907 
UINT32
 
	mrsv
:7;

908 
UINT32
 
	mRFG
:5;

909 
UINT32
 
	mRegIdAndCڋ
:24;

910 } 
	mfld
;

911 
UINT32
 
	mwd
;

912 } 
	tRF_CSR_CFG1_STRUC
, *
	tPRF_CSR_CFG1_STRUC
;

914 
	u_RF_CSR_CFG1_STRUC
 {

916 
UINT32
 
	mRegIdAndCڋ
:24;

917 
UINT32
 
	mRFG
:5;

918 
UINT32
 
	mrsv
:7;

919 } 
	mfld
;

920 
UINT32
 
	mwd
;

921 } 
	tRF_CSR_CFG1_STRUC
, *
	tPRF_CSR_CFG1_STRUC
;

923 
	#RF_CSR_CFG2
 0x1028

924 #ifde
RT_BIG_ENDIAN


	)

925 
	u_RF_CSR_CFG2_STRUC
 {

927 
UINT32
 
	mrsv
:8;

928 
UINT32
 
	mRegIdAndCڋ
:24;

929 } 
	mfld
;

930 
UINT32
 
	mwd
;

931 } 
	tRF_CSR_CFG2_STRUC
, *
	tPRF_CSR_CFG2_STRUC
;

933 
	u_RF_CSR_CFG2_STRUC
 {

935 
UINT32
 
	mRegIdAndCڋ
:24;

936 
UINT32
 
	mrsv
:8;

937 } 
	mfld
;

938 
UINT32
 
	mwd
;

939 } 
	tRF_CSR_CFG2_STRUC
, *
	tPRF_CSR_CFG2_STRUC
;

941 
	#LED_CFG
 0x102c

942 #ifde
RT_BIG_ENDIAN


	)

943 
	u_LED_CFG_STRUC
 {

945 
	mUINT32
 :1;

946 
UINT32
 
	mLedPެ
:1;

947 
UINT32
 
	mYLedMode
:2;

948 
UINT32
 
	mGLedMode
:2;

949 
UINT32
 
	mRLedMode
:2;

950 
UINT32
 
	mrsv
:2;

951 
UINT32
 
	mSlowBlkPiod
:6;

952 
UINT32
 
	mOffPiod
:8;

953 
UINT32
 
	mOnPiod
:8;

954 } 
	mfld
;

955 
UINT32
 
	mwd
;

956 } 
	tLED_CFG_STRUC
, *
	tPLED_CFG_STRUC
;

958 
	u_LED_CFG_STRUC
 {

960 
UINT32
 
	mOnPiod
:8;

961 
UINT32
 
	mOffPiod
:8;

962 
UINT32
 
	mSlowBlkPiod
:6;

963 
UINT32
 
	mrsv
:2;

964 
UINT32
 
	mRLedMode
:2;

965 
UINT32
 
	mGLedMode
:2;

966 
UINT32
 
	mYLedMode
:2;

967 
UINT32
 
	mLedPެ
:1;

968 
	mUINT32
 :1;

969 } 
	mfld
;

970 
UINT32
 
	mwd
;

971 } 
	tLED_CFG_STRUC
, *
	tPLED_CFG_STRUC
;

977 
	#NUM_OF_TX_CHAIN
 4

	)

979 
	#TX_CHAIN_ADDR0_L
 0x1044

980 
	#TX_CHAIN_ADDR0_H
 0x1048

	)

981 
	#TX_CHAIN_ADDR1_L
 0x104C

	)

982 
	#TX_CHAIN_ADDR1_H
 0x1050

	)

983 
	#TX_CHAIN_ADDR2_L
 0x1054

	)

984 
	#TX_CHAIN_ADDR2_H
 0x1058

	)

985 
	#TX_CHAIN_ADDR3_L
 0x105C

	)

986 
	#TX_CHAIN_ADDR3_H
 0x1060

	)

988 #ifde
RT_BIG_ENDIAN


989 
	u_TX_CHAIN_ADDR0_L_STRUC


993 
UCHAR
 
	mTxChaAddr0L_By3
;

994 
UCHAR
 
	mTxChaAddr0L_By2
;

995 
UCHAR
 
	mTxChaAddr0L_By1
;

996 
UCHAR
 
	mTxChaAddr0L_By0
;

997 } 
	mfld
;

999 
UINT32
 
	mwd
;

1000 } 
	tTX_CHAIN_ADDR0_L_STRUC
, *
	tPTX_CHAIN_ADDR0_L_STRUC
;

1002 
	u_TX_CHAIN_ADDR0_L_STRUC


1006 
UCHAR
 
	mTxChaAddr0L_By0
;

1007 
UCHAR
 
	mTxChaAddr0L_By1
;

1008 
UCHAR
 
	mTxChaAddr0L_By2
;

1009 
UCHAR
 
	mTxChaAddr0L_By3
;

1010 } 
	mfld
;

1012 
UINT32
 
	mwd
;

1013 } 
	tTX_CHAIN_ADDR0_L_STRUC
, *
	tPTX_CHAIN_ADDR0_L_STRUC
;

1016 
	#TX_CHAIN_ADDR0_H
 0x1048

	)

1018 #ifde
RT_BIG_ENDIAN


1019 
	u_TX_CHAIN_ADDR0_H_STRUC


1023 
USHORT
 
	mRerved
:12;

1024 
USHORT
 
	mTxChaS0
:4;

1025 
UCHAR
 
	mTxChaAddr0H_By5
;

1026 
UCHAR
 
	mTxChaAddr0H_By4
;

1027 } 
	mfld
;

1029 
UINT32
 
	mwd
;

1030 } 
	tTX_CHAIN_ADDR0_H_STRUC
, *
	tPTX_CHAIN_ADDR0_H_STRUC
;

1032 
	u_TX_CHAIN_ADDR0_H_STRUC


1036 
UCHAR
 
	mTxChaAddr0H_By4
;

1037 
UCHAR
 
	mTxChaAddr0H_By5
;

1038 
USHORT
 
	mTxChaS0
:4;

1039 
USHORT
 
	mRerved
:12;

1040 } 
	mfld
;

1042 
UINT32
 
	mwd
;

1043 } 
	tTX_CHAIN_ADDR0_H_STRUC
, *
	tPTX_CHAIN_ADDR0_HA_STRUC
;

1046 
	#TX_CHAIN_ADDR1_L
 0x104C

	)

1048 #ifde
BIG_ENDIAN


1049 
	u_TX_CHAIN_ADDR1_L_STRUC


1053 
UCHAR
 
	mTxChaAddr1L_By3
;

1054 
UCHAR
 
	mTxChaAddr1L_By2
;

1055 
UCHAR
 
	mTxChaAddr1L_By1
;

1056 
UCHAR
 
	mTxChaAddr1L_By0
;

1057 } 
	mfld
;

1059 
UINT32
 
	mwd
;

1060 } 
	tTX_CHAIN_ADDR1_L_STRUC
, *
	tPTX_CHAIN_ADDR1_L_STRUC
;

1062 
	u_TX_CHAIN_ADDR1_L_STRUC


1066 
UCHAR
 
	mTxChaAddr1L_By0
;

1067 
UCHAR
 
	mTxChaAddr1L_By1
;

1068 
UCHAR
 
	mTxChaAddr1L_By2
;

1069 
UCHAR
 
	mTxChaAddr1L_By3
;

1070 } 
	mfld
;

1072 
UINT32
 
	mwd
;

1073 } 
	tTX_CHAIN_ADDR1_L_STRUC
, *
	tPTX_CHAIN_ADDR1_L_STRUC
;

1076 
	#TX_CHAIN_ADDR1_H
 0x1050

	)

1078 #ifde
RT_BIG_ENDIAN


1079 
	u_TX_CHAIN_ADDR1_H_STRUC


1083 
USHORT
 
	mRerved
:12;

1084 
USHORT
 
	mTxChaS0
:4;

1085 
UCHAR
 
	mTxChaAddr1H_By5
;

1086 
UCHAR
 
	mTxChaAddr1H_By4
;

1087 } 
	mfld
;

1089 
UINT32
 
	mwd
;

1090 } 
	tTX_CHAIN_ADDR1_H_STRUC
, *
	tPTX_CHAIN_ADDR1_H_STRUC
;

1092 
	u_TX_CHAIN_ADDR1_H_STRUC


1096 
UCHAR
 
	mTxChaAddr1H_By4
;

1097 
UCHAR
 
	mTxChaAddr1H_By5
;

1098 
USHORT
 
	mTxChaS0
:4;

1099 
USHORT
 
	mRerved
:12;

1100 } 
	mfld
;

1102 
UINT32
 
	mwd
;

1103 } 
	tTX_CHAIN_ADDR1_H_STRUC
, *
	tPTX_CHAIN_ADDR1_HA_STRUC
;

1106 
	#TX_CHAIN_ADDR2_L
 0x1054

	)

1108 #ifde
RT_BIG_ENDIAN


1109 
	u_TX_CHAIN_ADDR2_L_STRUC


1113 
UCHAR
 
	mTxChaAddr2L_By3
;

1114 
UCHAR
 
	mTxChaAddr2L_By2
;

1115 
UCHAR
 
	mTxChaAddr2L_By1
;

1116 
UCHAR
 
	mTxChaAddr2L_By0
;

1117 } 
	mfld
;

1119 
UINT32
 
	mwd
;

1120 } 
	tTX_CHAIN_ADDR2_L_STRUC
, *
	tPTX_CHAIN_ADDR2_L_STRUC
;

1122 
	u_TX_CHAIN_ADDR2_L_STRUC


1126 
UCHAR
 
	mTxChaAddr2L_By0
;

1127 
UCHAR
 
	mTxChaAddr2L_By1
;

1128 
UCHAR
 
	mTxChaAddr2L_By2
;

1129 
UCHAR
 
	mTxChaAddr2L_By3
;

1130 } 
	mfld
;

1132 
UINT32
 
	mwd
;

1133 } 
	tTX_CHAIN_ADDR2_L_STRUC
, *
	tPTX_CHAIN_ADDR2_L_STRUC
;

1136 
	#TX_CHAIN_ADDR2_H
 0x1058

	)

1138 #ifde
RT_BIG_ENDIAN


1139 
	u_TX_CHAIN_ADDR2_H_STRUC


1143 
USHORT
 
	mRerved
:12;

1144 
USHORT
 
	mTxChaS0
:4;

1145 
UCHAR
 
	mTxChaAddr2H_By5
;

1146 
UCHAR
 
	mTxChaAddr2H_By4
;

1147 } 
	mfld
;

1149 
UINT32
 
	mwd
;

1150 } 
	tTX_CHAIN_ADDR2_H_STRUC
, *
	tPTX_CHAIN_ADDR2_H_STRUC
;

1152 
	u_TX_CHAIN_ADDR2_H_STRUC


1156 
UCHAR
 
	mTxChaAddr2H_By4
;

1157 
UCHAR
 
	mTxChaAddr2H_By5
;

1158 
USHORT
 
	mTxChaS0
:4;

1159 
USHORT
 
	mRerved
:12;

1160 } 
	mfld
;

1162 
UINT32
 
	mwd
;

1163 } 
	tTX_CHAIN_ADDR2_H_STRUC
, *
	tPTX_CHAIN_ADDR2_HA_STRUC
;

1166 
	#TX_CHAIN_ADDR3_L
 0x105C

	)

1168 #ifde
RT_BIG_ENDIAN


1169 
	u_TX_CHAIN_ADDR3_L_STRUC


1173 
UCHAR
 
	mTxChaAddr3L_By3
;

1174 
UCHAR
 
	mTxChaAddr3L_By2
;

1175 
UCHAR
 
	mTxChaAddr3L_By1
;

1176 
UCHAR
 
	mTxChaAddr3L_By0
;

1177 } 
	mfld
;

1179 
UINT32
 
	mwd
;

1180 } 
	tTX_CHAIN_ADDR3_L_STRUC
, *
	tPTX_CHAIN_ADDR3_L_STRUC
;

1182 
	u_TX_CHAIN_ADDR3_L_STRUC


1186 
UCHAR
 
	mTxChaAddr3L_By0
;

1187 
UCHAR
 
	mTxChaAddr3L_By1
;

1188 
UCHAR
 
	mTxChaAddr3L_By2
;

1189 
UCHAR
 
	mTxChaAddr3L_By3
;

1190 } 
	mfld
;

1192 
UINT32
 
	mwd
;

1193 } 
	tTX_CHAIN_ADDR3_L_STRUC
, *
	tPTX_CHAIN_ADDR3_L_STRUC
;

1196 
	#TX_CHAIN_ADDR3_H
 0x1060

	)

1198 #ifde
RT_BIG_ENDIAN


1199 
	u_TX_CHAIN_ADDR3_H_STRUC


1203 
USHORT
 
	mRerved
:12;

1204 
USHORT
 
	mTxChaS0
:4;

1205 
UCHAR
 
	mTxChaAddr3H_By5
;

1206 
UCHAR
 
	mTxChaAddr3H_By4
;

1207 } 
	mfld
;

1209 
UINT32
 
	mwd
;

1210 } 
	tTX_CHAIN_ADDR3_H_STRUC
, *
	tPTX_CHAIN_ADDR3_H_STRUC
;

1212 
	u_TX_CHAIN_ADDR3_H_STRUC


1216 
UCHAR
 
	mTxChaAddr3H_By4
;

1217 
UCHAR
 
	mTxChaAddr3H_By5
;

1218 
USHORT
 
	mTxChaS0
:4;

1219 
USHORT
 
	mRerved
:12;

1220 } 
	mfld
;

1222 
UINT32
 
	mwd
;

1223 } 
	tTX_CHAIN_ADDR3_H_STRUC
, *
	tPTX_CHAIN_ADDR3_HA_STRUC
;

1229 
	#XIFS_TIME_CFG
 0x1100

1230 #ifde
RT_BIG_ENDIAN


	)

1231 
	u_IFS_SLOT_CFG_STRUC
 {

1233 
UINT32
 
	mrsv
:2;

1234 
UINT32
 
	mBBRxdEb
:1;

1235 
UINT32
 
	mEIFS
:9;

1236 
UINT32
 
	mOfdmXifsTime
:4;

1237 
UINT32
 
	mOfdmSifsTime
:8;

1238 
UINT32
 
	mCckmSifsTime
:8;

1239 } 
	mfld
;

1240 
UINT32
 
	mwd
;

1241 } 
	tIFS_SLOT_CFG_STRUC
, *
	tPIFS_SLOT_CFG_STRUC
;

1243 
	u_IFS_SLOT_CFG_STRUC
 {

1245 
UINT32
 
	mCckmSifsTime
:8;

1246 
UINT32
 
	mOfdmSifsTime
:8;

1247 
UINT32
 
	mOfdmXifsTime
:4;

1248 
UINT32
 
	mEIFS
:9;

1249 
UINT32
 
	mBBRxdEb
:1;

1250 
UINT32
 
	mrsv
:2;

1251 } 
	mfld
;

1252 
UINT32
 
	mwd
;

1253 } 
	tIFS_SLOT_CFG_STRUC
, *
	tPIFS_SLOT_CFG_STRUC
;

1256 
	#BKOFF_SLOT_CFG
 0x1104

1257 
	#NAV_TIME_CFG
 0x1108

1258 
	#CH_TIME_CFG
 0x110C

1259 
	#PBF_LIFE_TIMER
 0x1110

1260 
	#BCN_TIME_CFG
 0x1114

1261 

	)

1262 
	#BCN_OFFSET0
 0x042C

	)

1263 
	#BCN_OFFSET1
 0x0430

	)

1264 #ifde
SPECIFIC_BCN_BUF_SUPPORT


1265 
	#BCN_OFFSET2
 0x0444

	)

1266 
	#BCN_OFFSET3
 0x0448

	)

1272 #ifde
RT_BIG_ENDIAN


1273 
	u_BCN_TIME_CFG_STRUC
 {

1275 
UINT32
 
	mTxTimeampComn
:8;

1276 
	mUINT32
 :3;

1277 
UINT32
 
	mbBcG
:1;

1278 
UINT32
 
	mbTBTTEb
:1;

1279 
UINT32
 
	mTsfSyncMode
:2;

1280 
UINT32
 
	mbTsfTickg
:1;

1281 
UINT32
 
	mBcIv
:16;

1282 } 
	mfld
;

1283 
UINT32
 
	mwd
;

1284 } 
	tBCN_TIME_CFG_STRUC
, *
	tPBCN_TIME_CFG_STRUC
;

1286 
	u_BCN_TIME_CFG_STRUC
 {

1288 
UINT32
 
	mBcIv
:16;

1289 
UINT32
 
	mbTsfTickg
:1;

1290 
UINT32
 
	mTsfSyncMode
:2;

1291 
UINT32
 
	mbTBTTEb
:1;

1292 
UINT32
 
	mbBcG
:1;

1293 
	mUINT32
 :3;

1294 
UINT32
 
	mTxTimeampComn
:8;

1295 } 
	mfld
;

1296 
UINT32
 
	mwd
;

1297 } 
	tBCN_TIME_CFG_STRUC
, *
	tPBCN_TIME_CFG_STRUC
;

1299 
	#TBTT_SYNC_CFG
 0x1118

1300 
	#TSF_TIMER_DW0
 0x111C

1301 
	#TSF_TIMER_DW1
 0x1120

1302 
	#TBTT_TIMER
 0x1124

1303 
	#INT_TIMER_CFG
 0x1128

1304 
	#INT_TIMER_EN
 0x112c

1305 
	#CH_IDLE_STA
 0x1130

1306 
	#CH_BUSY_STA
 0x1134

1307 
	#CH_BUSY_STA_SEC
 0x1138

1311 
	#MAC_STATUS_CFG
 0x1200

1312 
	#PWR_PIN_CFG
 0x1204

1313 
	#AUTO_WAKEUP_CFG
 0x1208

1317 #ifde
RT_BIG_ENDIAN


	)

1318 
	u_AUTO_WAKEUP_STRUC
 {

1320 
	mUINT32
 :16;

1321 
UINT32
 
	mEbAutoWakeup
:1;

1322 
UINT32
 
	mNumofS˕gTb
:7;

1323 
UINT32
 
	mAutoLdTime
:8;

1324 } 
	mfld
;

1325 
UINT32
 
	mwd
;

1326 } 
	tAUTO_WAKEUP_STRUC
, *
	tPAUTO_WAKEUP_STRUC
;

1328 
	u_AUTO_WAKEUP_STRUC
 {

1330 
UINT32
 
	mAutoLdTime
:8;

1331 
UINT32
 
	mNumofS˕gTb
:7;

1332 
UINT32
 
	mEbAutoWakeup
:1;

1333 
	mUINT32
 :16;

1334 } 
	mfld
;

1335 
UINT32
 
	mwd
;

1336 } 
	tAUTO_WAKEUP_STRUC
, *
	tPAUTO_WAKEUP_STRUC
;

1342 
	#EDCA_AC0_CFG
 0x1300

1343 
	#EDCA_AC1_CFG
 0x1304

	)

1344 
	#EDCA_AC2_CFG
 0x1308

	)

1345 
	#EDCA_AC3_CFG
 0x130c

	)

1346 #ifde
RT_BIG_ENDIAN


1347 
	u_EDCA_AC_CFG_STRUC
 {

1349 
	mUINT32
 :12;

1350 
UINT32
 
	mCwmax
:4;

1351 
UINT32
 
	mCwm
:4;

1352 
UINT32
 
	mAif
:4;

1353 
UINT32
 
	mAcTx
:8;

1354 } 
	mfld
;

1355 
UINT32
 
	mwd
;

1356 } 
	tEDCA_AC_CFG_STRUC
, *
	tPEDCA_AC_CFG_STRUC
;

1358 
	u_EDCA_AC_CFG_STRUC
 {

1360 
UINT32
 
	mAcTx
:8;

1361 
UINT32
 
	mAif
:4;

1362 
UINT32
 
	mCwm
:4;

1363 
UINT32
 
	mCwmax
:4;

1364 
	mUINT32
 :12;

1365 } 
	mfld
;

1366 
UINT32
 
	mwd
;

1367 } 
	tEDCA_AC_CFG_STRUC
, *
	tPEDCA_AC_CFG_STRUC
;

1373 
	#DEFAULT_TX_POWER
 0x6

	)

1375 
	#EDCA_TID_AC_MAP
 0x1310

	)

1376 
	#TX_PWR_CFG_0
 0x1314

	)

1377 
	#TX_PWR_CFG_0_EXT
 0x1390

	)

1378 
	#TX_PWR_CFG_1
 0x1318

	)

1379 
	#TX_PWR_CFG_1_EXT
 0x1394

	)

1380 
	#TX_PWR_CFG_2
 0x131C

	)

1381 
	#TX_PWR_CFG_2_EXT
 0x1398

	)

1382 
	#TX_PWR_CFG_3
 0x1320

	)

1383 
	#TX_PWR_CFG_3_EXT
 0x139C

	)

1384 
	#TX_PWR_CFG_4
 0x1324

	)

1385 
	#TX_PWR_CFG_4_EXT
 0x13A0

	)

1386 
	#TX_PWR_CFG_5
 0x1384

	)

1387 
	#TX_PWR_CFG_6
 0x1388

	)

1388 
	#TX_PWR_CFG_7
 0x13D4

	)

1389 
	#TX_PWR_CFG_8
 0x13D8

	)

1390 
	#TX_PWR_CFG_9
 0x13DC

	)

1392 
	#TX_PIN_CFG
 0x1328

	)

1393 
	#TX_BAND_CFG
 0x132c

1394 
	#TX_SW_CFG0
 0x1330

	)

1395 
	#TX_SW_CFG1
 0x1334

	)

1396 
	#TX_SW_CFG2
 0x1338

	)

1397 
	#TXOP_THRES_CFG
 0x133c

	)

1399 #ifde
RT_BIG_ENDIAN


1400 
	u_TXOP_THRESHOLD_CFG_STRUC


1404 
UINT32
 
	mTXOP_REM_THRES
:8;

1405 
UINT32
 
	mCF_END_THRES
:8;

1406 
UINT32
 
	mRDG_IN_THRES
:8;

1407 
UINT32
 
	mRDG_OUT_THRES
:8;

1408 } 
	mfld
;

1410 
UINT32
 
	mwd
;

1411 } 
	tTXOP_THRESHOLD_CFG_STRUC
, *
	tPTXOP_THRESHOLD_CFG_STRUC
;

1413 
	u_TXOP_THRESHOLD_CFG_STRUC


1417 
UINT32
 
	mRDG_OUT_THRES
:8;

1418 
UINT32
 
	mRDG_IN_THRES
:8;

1419 
UINT32
 
	mCF_END_THRES
:8;

1420 
UINT32
 
	mTXOP_REM_THRES
:8;

1421 } 
	mfld
;

1423 
UINT32
 
	mwd
;

1424 } 
	tTXOP_THRESHOLD_CFG_STRUC
, *
	tPTXOP_THRESHOLD_CFG_STRUC
;

1427 
	#TXOP_CTRL_CFG
 0x1340

	)

1428 
	#TX_RTS_CFG
 0x1344

	)

1430 
	#TX_TXBF_CFG_0
 0x138c

	)

1431 
	#TX_TXBF_CFG_1
 0x13A4

	)

1432 
	#TX_TXBF_CFG_2
 0x13A8

	)

1433 
	#TX_TXBF_CFG_3
 0x13AC

	)

1435 #ifde
RT_BIG_ENDIAN


1436 
	u_TX_RTS_CFG_STRUC
 {

1438 
UINT32
 
	mrsv
:7;

1439 
UINT32
 
	mRtsFbkEn
:1;

1440 
UINT32
 
	mRtsThs
:16;

1441 
UINT32
 
	mAutoRtsRryLim
:8;

1442 } 
	mfld
;

1443 
UINT32
 
	mwd
;

1444 } 
	tTX_RTS_CFG_STRUC
, *
	tPTX_RTS_CFG_STRUC
;

1446 
	u_TX_RTS_CFG_STRUC
 {

1448 
UINT32
 
	mAutoRtsRryLim
:8;

1449 
UINT32
 
	mRtsThs
:16;

1450 
UINT32
 
	mRtsFbkEn
:1;

1451 
UINT32
 
	mrsv
:7;

1452 } 
	mfld
;

1453 
UINT32
 
	mwd
;

1454 } 
	tTX_RTS_CFG_STRUC
, *
	tPTX_RTS_CFG_STRUC
;

1457 
	u_TX_TXBF_CFG_0_STRUC
 {

1459 #ifde
RT_BIG_ENDIAN


1460 
UINT32
 
	mEtxbfFbkRe
:16;

1461 
UINT32
 
	mEtxbfFbkEn
:1;

1462 
UINT32
 
	mEtxbfFbkSeqEn
:1;

1463 
UINT32
 
	mEtxbfFbkCf
:2;

1464 
UINT32
 
	mEtxbfFbkCode
:2;

1465 
UINT32
 
	mEtxbfFbkNg
:2;

1466 
UINT32
 
	mCsdByss
:1;

1467 
UINT32
 
	mEtxbfF
:1;

1468 
UINT32
 
	mEtxbfEb
:1;

1469 
UINT32
 
	mAutoTxbfEn
:3;

1470 
UINT32
 
	mItxbfF
:1;

1471 
UINT32
 
	mItxbfEn
:1;

1473 
UINT32
 
	mItxbfEn
:1;

1474 
UINT32
 
	mItxbfF
:1;

1475 
UINT32
 
	mAutoTxbfEn
:3;

1476 
UINT32
 
	mEtxbfEb
:1;

1477 
UINT32
 
	mEtxbfF
:1;

1478 
UINT32
 
	mCsdByss
:1;

1479 
UINT32
 
	mEtxbfFbkNg
:2;

1480 
UINT32
 
	mEtxbfFbkCode
:2;

1481 
UINT32
 
	mEtxbfFbkCf
:2;

1482 
UINT32
 
	mEtxbfFbkSeqEn
:1;

1483 
UINT32
 
	mEtxbfFbkEn
:1;

1484 
UINT32
 
	mEtxbfFbkRe
:16;

1486 } 
	mfld
;

1487 
UINT32
 
	mwd
;

1488 } 
	tTX_TXBF_CFG_0_STRUC
, *
	tPTX_TXBF_CFG_0_STRUC
;

1490 
	#TX_TIMEOUT_CFG
 0x1348

	)

1491 #ifde
RT_BIG_ENDIAN


1492 
	u_TX_TIMEOUT_CFG_STRUC
 {

1494 
UINT32
 
	mrsv2
:8;

1495 
UINT32
 
	mTxTimeout
:8;

1496 
UINT32
 
	mRxAckTimeout
:8;

1497 
UINT32
 
	mMpduLiTime
:4;

1498 
UINT32
 
	mrsv
:4;

1499 } 
	mfld
;

1500 
UINT32
 
	mwd
;

1501 } 
	tTX_TIMEOUT_CFG_STRUC
, *
	tPTX_TIMEOUT_CFG_STRUC
;

1503 
	u_TX_TIMEOUT_CFG_STRUC
 {

1505 
UINT32
 
	mrsv
:4;

1506 
UINT32
 
	mMpduLiTime
:4;

1507 
UINT32
 
	mRxAckTimeout
:8;

1508 
UINT32
 
	mTxTimeout
:8;

1509 
UINT32
 
	mrsv2
:8;

1510 } 
	mfld
;

1511 
UINT32
 
	mwd
;

1512 } 
	tTX_TIMEOUT_CFG_STRUC
, *
	tPTX_TIMEOUT_CFG_STRUC
;

1514 
	#TX_RTY_CFG
 0x134c

	)

1515 #ifde
RT_BIG_ENDIAN


1516 
GNU_PACKED
 
	t_TX_RTY_CFG_STRUC
 {

1518 
UINT32
 
	grsv
:1;

1519 
UINT32
 
	gTxautoFBEb
:1;

1520 
UINT32
 
	gAggRtyMode
:1;

1521 
UINT32
 
	gNAggRtyMode
:1;

1522 
UINT32
 
	gLgRtyTh
:12;

1523 
UINT32
 
	gLgRtyLim
:8;

1524 
UINT32
 
	gShtRtyLim
:8;

1526 } 
	gfld
;

1527 
UINT32
 
	gwd
;

1528 } 
	tTX_RTY_CFG_STRUC
, *
	tPTX_RTY_CFG_STRUC
;

1530 
GNU_PACKED
 
	t_TX_RTY_CFG_STRUC
 {

1532 
UINT32
 
	gShtRtyLim
:8;

1533 
UINT32
 
	gLgRtyLim
:8;

1534 
UINT32
 
	gLgRtyTh
:12;

1535 
UINT32
 
	gNAggRtyMode
:1;

1536 
UINT32
 
	gAggRtyMode
:1;

1537 
UINT32
 
	gTxautoFBEb
:1;

1538 
UINT32
 
	grsv
:1;

1539 } 
	gfld
;

1540 
UINT32
 
	gwd
;

1541 } 
	tTX_RTY_CFG_STRUC
, *
	tPTX_RTY_CFG_STRUC
;

1543 
	#TX_LINK_CFG
 0x1350

	)

1544 #ifde
RT_BIG_ENDIAN


1545 
GNU_PACKED
 
	t_TX_LINK_CFG_STRUC
 {

1546 
	sGNU_PACKED
 {

1547 
UINT32
 
	gRemMFS
:8;

1548 
UINT32
 
	gRemMFB
:8;

1549 
UINT32
 
	grsv
:3;

1550 
UINT32
 
	gTxCFAckEn
:1;

1551 
UINT32
 
	gTxRDGEn
:1;

1552 
UINT32
 
	gTxMRQEn
:1;

1553 
UINT32
 
	gRemeUMFSEb
:1;

1554 
UINT32
 
	gMFBEb
:1;

1555 
UINT32
 
	gRemeMFBLiTime
:8;

1556 } 
	gfld
;

1557 
UINT32
 
	gwd
;

1558 } 
	tTX_LINK_CFG_STRUC
, *
	tPTX_LINK_CFG_STRUC
;

1560 
GNU_PACKED
 
	t_TX_LINK_CFG_STRUC
 {

1561 
	sGNU_PACKED
 {

1562 
UINT32
 
	gRemeMFBLiTime
:8;

1563 
UINT32
 
	gMFBEb
:1;

1564 
UINT32
 
	gRemeUMFSEb
:1;

1565 
UINT32
 
	gTxMRQEn
:1;

1566 
UINT32
 
	gTxRDGEn
:1;

1567 
UINT32
 
	gTxCFAckEn
:1;

1568 
UINT32
 
	grsv
:3;

1569 
UINT32
 
	gRemMFB
:8;

1570 
UINT32
 
	gRemMFS
:8;

1571 } 
	gfld
;

1572 
UINT32
 
	gwd
;

1573 } 
	tTX_LINK_CFG_STRUC
, *
	tPTX_LINK_CFG_STRUC
;

1575 
	#HT_FBK_CFG0
 0x1354

	)

1576 #ifde
RT_BIG_ENDIAN


1577 
GNU_PACKED
 
	t_HT_FBK_CFG0_STRUC
 {

1579 
UINT32
 
	gHTMCS7FBK
:4;

1580 
UINT32
 
	gHTMCS6FBK
:4;

1581 
UINT32
 
	gHTMCS5FBK
:4;

1582 
UINT32
 
	gHTMCS4FBK
:4;

1583 
UINT32
 
	gHTMCS3FBK
:4;

1584 
UINT32
 
	gHTMCS2FBK
:4;

1585 
UINT32
 
	gHTMCS1FBK
:4;

1586 
UINT32
 
	gHTMCS0FBK
:4;

1587 } 
	gfld
;

1588 
UINT32
 
	gwd
;

1589 } 
	tHT_FBK_CFG0_STRUC
, *
	tPHT_FBK_CFG0_STRUC
;

1591 
GNU_PACKED
 
	t_HT_FBK_CFG0_STRUC
 {

1593 
UINT32
 
	gHTMCS0FBK
:4;

1594 
UINT32
 
	gHTMCS1FBK
:4;

1595 
UINT32
 
	gHTMCS2FBK
:4;

1596 
UINT32
 
	gHTMCS3FBK
:4;

1597 
UINT32
 
	gHTMCS4FBK
:4;

1598 
UINT32
 
	gHTMCS5FBK
:4;

1599 
UINT32
 
	gHTMCS6FBK
:4;

1600 
UINT32
 
	gHTMCS7FBK
:4;

1601 } 
	gfld
;

1602 
UINT32
 
	gwd
;

1603 } 
	tHT_FBK_CFG0_STRUC
, *
	tPHT_FBK_CFG0_STRUC
;

1605 
	#HT_FBK_CFG1
 0x1358

	)

1606 #ifde
RT_BIG_ENDIAN


1607 
	u_HT_FBK_CFG1_STRUC
 {

1609 
UINT32
 
	mHTMCS15FBK
:4;

1610 
UINT32
 
	mHTMCS14FBK
:4;

1611 
UINT32
 
	mHTMCS13FBK
:4;

1612 
UINT32
 
	mHTMCS12FBK
:4;

1613 
UINT32
 
	mHTMCS11FBK
:4;

1614 
UINT32
 
	mHTMCS10FBK
:4;

1615 
UINT32
 
	mHTMCS9FBK
:4;

1616 
UINT32
 
	mHTMCS8FBK
:4;

1617 } 
	mfld
;

1618 
UINT32
 
	mwd
;

1619 } 
	tHT_FBK_CFG1_STRUC
, *
	tPHT_FBK_CFG1_STRUC
;

1621 
	u_HT_FBK_CFG1_STRUC
 {

1623 
UINT32
 
	mHTMCS8FBK
:4;

1624 
UINT32
 
	mHTMCS9FBK
:4;

1625 
UINT32
 
	mHTMCS10FBK
:4;

1626 
UINT32
 
	mHTMCS11FBK
:4;

1627 
UINT32
 
	mHTMCS12FBK
:4;

1628 
UINT32
 
	mHTMCS13FBK
:4;

1629 
UINT32
 
	mHTMCS14FBK
:4;

1630 
UINT32
 
	mHTMCS15FBK
:4;

1631 } 
	mfld
;

1632 
UINT32
 
	mwd
;

1633 } 
	tHT_FBK_CFG1_STRUC
, *
	tPHT_FBK_CFG1_STRUC
;

1635 
	#LG_FBK_CFG0
 0x135c

	)

1636 #ifde
RT_BIG_ENDIAN


1637 
	u_LG_FBK_CFG0_STRUC
 {

1639 
UINT32
 
	mOFDMMCS7FBK
:4;

1640 
UINT32
 
	mOFDMMCS6FBK
:4;

1641 
UINT32
 
	mOFDMMCS5FBK
:4;

1642 
UINT32
 
	mOFDMMCS4FBK
:4;

1643 
UINT32
 
	mOFDMMCS3FBK
:4;

1644 
UINT32
 
	mOFDMMCS2FBK
:4;

1645 
UINT32
 
	mOFDMMCS1FBK
:4;

1646 
UINT32
 
	mOFDMMCS0FBK
:4;

1647 } 
	mfld
;

1648 
UINT32
 
	mwd
;

1649 } 
	tLG_FBK_CFG0_STRUC
, *
	tPLG_FBK_CFG0_STRUC
;

1651 
	u_LG_FBK_CFG0_STRUC
 {

1653 
UINT32
 
	mOFDMMCS0FBK
:4;

1654 
UINT32
 
	mOFDMMCS1FBK
:4;

1655 
UINT32
 
	mOFDMMCS2FBK
:4;

1656 
UINT32
 
	mOFDMMCS3FBK
:4;

1657 
UINT32
 
	mOFDMMCS4FBK
:4;

1658 
UINT32
 
	mOFDMMCS5FBK
:4;

1659 
UINT32
 
	mOFDMMCS6FBK
:4;

1660 
UINT32
 
	mOFDMMCS7FBK
:4;

1661 } 
	mfld
;

1662 
UINT32
 
	mwd
;

1663 } 
	tLG_FBK_CFG0_STRUC
, *
	tPLG_FBK_CFG0_STRUC
;

1665 
	#LG_FBK_CFG1
 0x1360

	)

1666 #ifde
RT_BIG_ENDIAN


1667 
	u_LG_FBK_CFG1_STRUC
 {

1669 
UINT32
 
	mrsv
:16;

1670 
UINT32
 
	mCCKMCS3FBK
:4;

1671 
UINT32
 
	mCCKMCS2FBK
:4;

1672 
UINT32
 
	mCCKMCS1FBK
:4;

1673 
UINT32
 
	mCCKMCS0FBK
:4;

1674 } 
	mfld
;

1675 
UINT32
 
	mwd
;

1676 } 
	tLG_FBK_CFG1_STRUC
, *
	tPLG_FBK_CFG1_STRUC
;

1678 
	u_LG_FBK_CFG1_STRUC
 {

1680 
UINT32
 
	mCCKMCS0FBK
:4;

1681 
UINT32
 
	mCCKMCS1FBK
:4;

1682 
UINT32
 
	mCCKMCS2FBK
:4;

1683 
UINT32
 
	mCCKMCS3FBK
:4;

1684 
UINT32
 
	mrsv
:16;

1685 } 
	mfld
;

1686 
UINT32
 
	mwd
;

1687 } 
	tLG_FBK_CFG1_STRUC
, *
	tPLG_FBK_CFG1_STRUC
;

1694 
	#CCK_PROT_CFG
 0x1364

1695 
	#ASIC_SHORTNAV
 1

	)

1696 
	#ASIC_LONGNAV
 2

	)

1697 
	#ASIC_RTS
 1

	)

1698 
	#ASIC_CTS
 2

	)

1699 #ifde
RT_BIG_ENDIAN


1700 
	u_PROT_CFG_STRUC
 {

1702 
UINT32
 
	mrsv
:5;

1703 
UINT32
 
	mRTSThEn
:1;

1704 
UINT32
 
	mTxAowGF40
:1;

1705 
UINT32
 
	mTxAowGF20
:1;

1706 
UINT32
 
	mTxAowMM40
:1;

1707 
UINT32
 
	mTxAowMM20
:1;

1708 
UINT32
 
	mTxAowOfdm
:1;

1709 
UINT32
 
	mTxAowCck
:1;

1710 
UINT32
 
	mPreNav
:2;

1711 
UINT32
 
	mPreCl
:2;

1712 
UINT32
 
	mPreRe
:16;

1713 } 
	mfld
;

1714 
UINT32
 
	mwd
;

1715 } 
	tPROT_CFG_STRUC
, *
	tPPROT_CFG_STRUC
;

1717 
	u_PROT_CFG_STRUC
 {

1719 
UINT32
 
	mPreRe
:16;

1720 
UINT32
 
	mPreCl
:2;

1721 
UINT32
 
	mPreNav
:2;

1722 
UINT32
 
	mTxAowCck
:1;

1723 
UINT32
 
	mTxAowOfdm
:1;

1724 
UINT32
 
	mTxAowMM20
:1;

1725 
UINT32
 
	mTxAowMM40
:1;

1726 
UINT32
 
	mTxAowGF20
:1;

1727 
UINT32
 
	mTxAowGF40
:1;

1728 
UINT32
 
	mRTSThEn
:1;

1729 
UINT32
 
	mrsv
:5;

1730 } 
	mfld
;

1731 
UINT32
 
	mwd
;

1732 } 
	tPROT_CFG_STRUC
, *
	tPPROT_CFG_STRUC
;

1735 
	#OFDM_PROT_CFG
 0x1368

1736 
	#MM20_PROT_CFG
 0x136C

1737 
	#MM40_PROT_CFG
 0x1370

1738 
	#GF20_PROT_CFG
 0x1374

1739 
	#GF40_PROT_CFG
 0x1378

1740 
	#EXP_CTS_TIME
 0x137C

1741 
	#EXP_ACK_TIME
 0x1380

1742 

	)

1743 
	#HT_FBK_3SS_CFG0
 0x13C4

	)

1744 #ifde
RT_BIG_ENDIAN


1745 
	u_HT_FBK_3SS_CFG0_STRUC
 {

1747 
UINT32
 
	mHTMCS19FBK
:5;

1748 
UINT32
 
	mrsv3
:3;

1749 
UINT32
 
	mHTMCS18FBK
:5;

1750 
UINT32
 
	mrsv2
:3;

1751 
UINT32
 
	mHTMCS17BK
:5;

1752 
UINT32
 
	mrsv1
:3;

1753 
UINT32
 
	mHTMCS16FBK
:5;

1754 
UINT32
 
	mrsv0
:3;

1755 } 
	mfld
;

1756 
UINT32
 
	mwd
;

1757 } 
	tHT_FBK_3SS_CFG0_STRUC
, *
	tPHT_FBK_3SS_CFG0_STRUC
;

1759 
	u_HT_FBK_3SS_CFG0_STRUC
 {

1761 
UINT32
 
	mHTMCS16FBK
:5;

1762 
UINT32
 
	mrsv0
:3;

1763 
UINT32
 
	mHTMCS17FBK
:5;

1764 
UINT32
 
	mrsv1
:3;

1765 
UINT32
 
	mHTMCS18FBK
:5;

1766 
UINT32
 
	mrsv2
:3;

1767 
UINT32
 
	mHTMCS19FBK
:5;

1768 
UINT32
 
	mrsv3
:3;

1769 } 
	mfld
;

1770 
UINT32
 
	mwd
;

1771 } 
	tHT_FBK_3SS_CFG0_STRUC
, *
	tPHT_FBK_3SS_CFG0_STRUC
;

1774 
	#HT_FBK_3SS_CFG1
 0x13C8

	)

1775 #ifde
RT_BIG_ENDIAN


1776 
	u_HT_FBK_3SS_CFG1_STRUC
 {

1778 
UINT32
 
	mHTMCS23FBK
:5;

1779 
UINT32
 
	mrsv3
:3;

1780 
UINT32
 
	mHTMCS22FBK
:5;

1781 
UINT32
 
	mrsv2
:3;

1782 
UINT32
 
	mHTMCS21BK
:5;

1783 
UINT32
 
	mrsv1
:3;

1784 
UINT32
 
	mHTMCS20FBK
:5;

1785 
UINT32
 
	mrsv0
:3;

1786 } 
	mfld
;

1787 
UINT32
 
	mwd
;

1788 } 
	tHT_FBK_3SS_CFG1_STRUC
, *
	tPHT_FBK_3SS_CFG1_STRUC
;

1790 
	u_HT_FBK_3SS_CFG1_STRUC
 {

1792 
UINT32
 
	mHTMCS20FBK
:5;

1793 
UINT32
 
	mrsv0
:3;

1794 
UINT32
 
	mHTMCS21FBK
:5;

1795 
UINT32
 
	mrsv1
:3;

1796 
UINT32
 
	mHTMCS22FBK
:5;

1797 
UINT32
 
	mrsv2
:3;

1798 
UINT32
 
	mHTMCS23FBK
:5;

1799 
UINT32
 
	mrsv3
:3;

1800 } 
	mfld
;

1801 
UINT32
 
	mwd
;

1802 } 
	tHT_FBK_3SS_CFG1_STRUC
, *
	tPHT_FBK_3SS_CFG1_STRUC
;

1808 
	#RX_FILTR_CFG
 0x1400

1809 
	#AUTO_RSP_CFG
 0x1404

1813 #ifde
RT_BIG_ENDIAN


	)

1814 
	u_AUTO_RSP_CFG_STRUC
 {

1816 
	mUINT32
 :24;

1817 
UINT32
 
	mAckCtsPsmB
:1;

1818 
UINT32
 
	mDuCTSEn
:1;

1819 
UINT32
 
	mrsv
:1;

1820 
UINT32
 
	mAutoRedPamb
:1;

1821 
UINT32
 
	mCTS40MRef
:1;

1822 
UINT32
 
	mCTS40MMode
:1;

1823 
UINT32
 
	mBACAckPicyEb
:1;

1824 
UINT32
 
	mAutoRedEb
:1;

1825 } 
	mfld
;

1826 
UINT32
 
	mwd
;

1827 } 
	tAUTO_RSP_CFG_STRUC
, *
	tPAUTO_RSP_CFG_STRUC
;

1829 
	u_AUTO_RSP_CFG_STRUC
 {

1831 
UINT32
 
	mAutoRedEb
:1;

1832 
UINT32
 
	mBACAckPicyEb
:1;

1833 
UINT32
 
	mCTS40MMode
:1;

1834 
UINT32
 
	mCTS40MRef
:1;

1835 
UINT32
 
	mAutoRedPamb
:1;

1836 
UINT32
 
	mrsv
:1;

1837 
UINT32
 
	mDuCTSEn
:1;

1838 
UINT32
 
	mAckCtsPsmB
:1;

1839 
	mUINT32
 :24;

1840 } 
	mfld
;

1841 
UINT32
 
	mwd
;

1842 } 
	tAUTO_RSP_CFG_STRUC
, *
	tPAUTO_RSP_CFG_STRUC
;

1845 
	#LEGACY_BASIC_RATE
 0x1408

1846 
	#HT_BASIC_RATE
 0x140c

	)

1847 
	#HT_CTRL_CFG
 0x1410

	)

1848 
	#SIFS_COST_CFG
 0x1414

	)

1849 
	#RX_PARSER_CFG
 0x1418

1850 

	)

1854 
	#TX_SEC_CNT0
 0x1500

1855 
	#RX_SEC_CNT0
 0x1504

1856 
	#CCMP_FC_MUTE
 0x1508

1860 
	#TXOP_HLDR_ADDR0
 0x1600

	)

1861 
	#TXOP_HLDR_ADDR1
 0x1604

	)

1862 
	#TXOP_HLDR_ET
 0x1608

	)

1863 
	#QOS_CFPOLL_RA_DW0
 0x160c

	)

1864 
	#QOS_CFPOLL_A1_DW1
 0x1610

	)

1865 
	#QOS_CFPOLL_QC
 0x1614

	)

1869 
	#RX_STA_CNT0
 0x1700

1870 
	#RX_STA_CNT1
 0x1704

1871 
	#RX_STA_CNT2
 0x1708

1872 

	)

1876 #ifde
RT_BIG_ENDIAN


1877 
	u_RX_STA_CNT0_STRUC
 {

1879 
USHORT
 
	mPhyE
;

1880 
USHORT
 
	mCrcE
;

1881 } 
	mfld
;

1882 
UINT32
 
	mwd
;

1883 } 
	tRX_STA_CNT0_STRUC
, *
	tPRX_STA_CNT0_STRUC
;

1885 
	u_RX_STA_CNT0_STRUC
 {

1887 
USHORT
 
	mCrcE
;

1888 
USHORT
 
	mPhyE
;

1889 } 
	mfld
;

1890 
UINT32
 
	mwd
;

1891 } 
	tRX_STA_CNT0_STRUC
, *
	tPRX_STA_CNT0_STRUC
;

1897 #ifde
RT_BIG_ENDIAN


1898 
	u_RX_STA_CNT1_STRUC
 {

1900 
USHORT
 
	mPlE
;

1901 
USHORT
 
	mFC
;

1902 } 
	mfld
;

1903 
UINT32
 
	mwd
;

1904 } 
	tRX_STA_CNT1_STRUC
, *
	tPRX_STA_CNT1_STRUC
;

1906 
	u_RX_STA_CNT1_STRUC
 {

1908 
USHORT
 
	mFC
;

1909 
USHORT
 
	mPlE
;

1910 } 
	mfld
;

1911 
UINT32
 
	mwd
;

1912 } 
	tRX_STA_CNT1_STRUC
, *
	tPRX_STA_CNT1_STRUC
;

1918 #ifde
RT_BIG_ENDIAN


1919 
	u_RX_STA_CNT2_STRUC
 {

1921 
USHORT
 
	mRxFifoOvowCou
;

1922 
USHORT
 
	mRxDuiCou
;

1923 } 
	mfld
;

1924 
UINT32
 
	mwd
;

1925 } 
	tRX_STA_CNT2_STRUC
, *
	tPRX_STA_CNT2_STRUC
;

1927 
	u_RX_STA_CNT2_STRUC
 {

1929 
USHORT
 
	mRxDuiCou
;

1930 
USHORT
 
	mRxFifoOvowCou
;

1931 } 
	mfld
;

1932 
UINT32
 
	mwd
;

1933 } 
	tRX_STA_CNT2_STRUC
, *
	tPRX_STA_CNT2_STRUC
;

1935 
	#TX_STA_CNT0
 0x170C

1939 #ifde
RT_BIG_ENDIAN


	)

1940 
	u_TX_STA_CNT0_STRUC
 {

1942 
USHORT
 
	mTxBcCou
;

1943 
USHORT
 
	mTxFaCou
;

1944 } 
	mfld
;

1945 
UINT32
 
	mwd
;

1946 } 
	tTX_STA_CNT0_STRUC
, *
	tPTX_STA_CNT0_STRUC
;

1948 
	u_TX_STA_CNT0_STRUC
 {

1950 
USHORT
 
	mTxFaCou
;

1951 
USHORT
 
	mTxBcCou
;

1952 } 
	mfld
;

1953 
UINT32
 
	mwd
;

1954 } 
	tTX_STA_CNT0_STRUC
, *
	tPTX_STA_CNT0_STRUC
;

1956 
	#TX_STA_CNT1
 0x1710

1960 #ifde
RT_BIG_ENDIAN


	)

1961 
	u_TX_STA_CNT1_STRUC
 {

1963 
USHORT
 
	mTxRnsm
;

1964 
USHORT
 
	mTxSucss
;

1965 } 
	mfld
;

1966 
UINT32
 
	mwd
;

1967 } 
	tTX_STA_CNT1_STRUC
, *
	tPTX_STA_CNT1_STRUC
;

1969 
	u_TX_STA_CNT1_STRUC
 {

1971 
USHORT
 
	mTxSucss
;

1972 
USHORT
 
	mTxRnsm
;

1973 } 
	mfld
;

1974 
UINT32
 
	mwd
;

1975 } 
	tTX_STA_CNT1_STRUC
, *
	tPTX_STA_CNT1_STRUC
;

1977 
	#TX_STA_CNT2
 0x1714

1981 #ifde
RT_BIG_ENDIAN


	)

1982 
	u_TX_STA_CNT2_STRUC
 {

1984 
USHORT
 
	mTxUndFlowCou
;

1985 
USHORT
 
	mTxZoLCou
;

1986 } 
	mfld
;

1987 
UINT32
 
	mwd
;

1988 } 
	tTX_STA_CNT2_STRUC
, *
	tPTX_STA_CNT2_STRUC
;

1990 
	u_TX_STA_CNT2_STRUC
 {

1992 
USHORT
 
	mTxZoLCou
;

1993 
USHORT
 
	mTxUndFlowCou
;

1994 } 
	mfld
;

1995 
UINT32
 
	mwd
;

1996 } 
	tTX_STA_CNT2_STRUC
, *
	tPTX_STA_CNT2_STRUC
;

1998 
	#TX_STA_FIFO
 0x1718

2002 #ifde
RT_BIG_ENDIAN


	)

2003 
GNU_PACKED
 
	t_TX_STA_FIFO_STRUC
 {

2005 
UINT32
 
	gRerve
:2;

2006 
UINT32
 
	gTxBF
:1;

2007 
UINT32
 
	gSucssRe
:13;

2009 
UINT32
 
	gwcid
:8;

2010 
UINT32
 
	gTxAckRequed
:1;

2011 
UINT32
 
	gTxAgg
:1;

2012 
UINT32
 
	gTxSucss
:1;

2013 
UINT32
 
	gPidTy
:4;

2014 
UINT32
 
	gbVid
:1;

2015 } 
	gfld
;

2016 
UINT32
 
	gwd
;

2017 } 
	tTX_STA_FIFO_STRUC
, *
	tPTX_STA_FIFO_STRUC
;

2019 
GNU_PACKED
 
	t_TX_STA_FIFO_STRUC
 {

2021 
UINT32
 
	gbVid
:1;

2022 
UINT32
 
	gPidTy
:4;

2023 
UINT32
 
	gTxSucss
:1;

2024 
UINT32
 
	gTxAgg
:1;

2025 
UINT32
 
	gTxAckRequed
:1;

2026 
UINT32
 
	gwcid
:8;

2028 
UINT32
 
	gSucssRe
:13;

2029 
UINT32
 
	gTxBF
:1;

2030 
UINT32
 
	gRerve
:2;

2031 } 
	gfld
;

2032 
UINT32
 
	gwd
;

2033 } 
	tTX_STA_FIFO_STRUC
, *
	tPTX_STA_FIFO_STRUC
;

2036 
	#TX_AGG_CNT
 0x171c

	)

2037 #ifde
RT_BIG_ENDIAN


2038 
	u_TX_AGG_CNT_STRUC
 {

2040 
USHORT
 
	mAggTxCou
;

2041 
USHORT
 
	mNAggTxCou
;

2042 } 
	mfld
;

2043 
UINT32
 
	mwd
;

2044 } 
	tTX_AGG_CNT_STRUC
, *
	tPTX_AGG_CNT_STRUC
;

2046 
	u_TX_AGG_CNT_STRUC
 {

2048 
USHORT
 
	mNAggTxCou
;

2049 
USHORT
 
	mAggTxCou
;

2050 } 
	mfld
;

2051 
UINT32
 
	mwd
;

2052 } 
	tTX_AGG_CNT_STRUC
, *
	tPTX_AGG_CNT_STRUC
;

2055 
	#TX_AGG_CNT0
 0x1720

	)

2056 #ifde
RT_BIG_ENDIAN


2057 
	u_TX_AGG_CNT0_STRUC
 {

2059 
USHORT
 
	mAggSize2Cou
;

2060 
USHORT
 
	mAggSize1Cou
;

2061 } 
	mfld
;

2062 
UINT32
 
	mwd
;

2063 } 
	tTX_AGG_CNT0_STRUC
, *
	tPTX_AGG_CNT0_STRUC
;

2065 
	u_TX_AGG_CNT0_STRUC
 {

2067 
USHORT
 
	mAggSize1Cou
;

2068 
USHORT
 
	mAggSize2Cou
;

2069 } 
	mfld
;

2070 
UINT32
 
	mwd
;

2071 } 
	tTX_AGG_CNT0_STRUC
, *
	tPTX_AGG_CNT0_STRUC
;

2074 
	#TX_AGG_CNT1
 0x1724

	)

2075 #ifde
RT_BIG_ENDIAN


2076 
	u_TX_AGG_CNT1_STRUC
 {

2078 
USHORT
 
	mAggSize4Cou
;

2079 
USHORT
 
	mAggSize3Cou
;

2080 } 
	mfld
;

2081 
UINT32
 
	mwd
;

2082 } 
	tTX_AGG_CNT1_STRUC
, *
	tPTX_AGG_CNT1_STRUC
;

2084 
	u_TX_AGG_CNT1_STRUC
 {

2086 
USHORT
 
	mAggSize3Cou
;

2087 
USHORT
 
	mAggSize4Cou
;

2088 } 
	mfld
;

2089 
UINT32
 
	mwd
;

2090 } 
	tTX_AGG_CNT1_STRUC
, *
	tPTX_AGG_CNT1_STRUC
;

2092 
	#TX_AGG_CNT2
 0x1728

	)

2093 #ifde
RT_BIG_ENDIAN


2094 
	u_TX_AGG_CNT2_STRUC
 {

2096 
USHORT
 
	mAggSize6Cou
;

2097 
USHORT
 
	mAggSize5Cou
;

2098 } 
	mfld
;

2099 
UINT32
 
	mwd
;

2100 } 
	tTX_AGG_CNT2_STRUC
, *
	tPTX_AGG_CNT2_STRUC
;

2102 
	u_TX_AGG_CNT2_STRUC
 {

2104 
USHORT
 
	mAggSize5Cou
;

2105 
USHORT
 
	mAggSize6Cou
;

2106 } 
	mfld
;

2107 
UINT32
 
	mwd
;

2108 } 
	tTX_AGG_CNT2_STRUC
, *
	tPTX_AGG_CNT2_STRUC
;

2111 
	#TX_AGG_CNT3
 0x172c

	)

2112 #ifde
RT_BIG_ENDIAN


2113 
	u_TX_AGG_CNT3_STRUC
 {

2115 
USHORT
 
	mAggSize8Cou
;

2116 
USHORT
 
	mAggSize7Cou
;

2117 } 
	mfld
;

2118 
UINT32
 
	mwd
;

2119 } 
	tTX_AGG_CNT3_STRUC
, *
	tPTX_AGG_CNT3_STRUC
;

2121 
	u_TX_AGG_CNT3_STRUC
 {

2123 
USHORT
 
	mAggSize7Cou
;

2124 
USHORT
 
	mAggSize8Cou
;

2125 } 
	mfld
;

2126 
UINT32
 
	mwd
;

2127 } 
	tTX_AGG_CNT3_STRUC
, *
	tPTX_AGG_CNT3_STRUC
;

2130 
	#TX_AGG_CNT4
 0x1730

	)

2131 #ifde
RT_BIG_ENDIAN


2132 
	u_TX_AGG_CNT4_STRUC
 {

2134 
USHORT
 
	mAggSize10Cou
;

2135 
USHORT
 
	mAggSize9Cou
;

2136 } 
	mfld
;

2137 
UINT32
 
	mwd
;

2138 } 
	tTX_AGG_CNT4_STRUC
, *
	tPTX_AGG_CNT4_STRUC
;

2140 
	u_TX_AGG_CNT4_STRUC
 {

2142 
USHORT
 
	mAggSize9Cou
;

2143 
USHORT
 
	mAggSize10Cou
;

2144 } 
	mfld
;

2145 
UINT32
 
	mwd
;

2146 } 
	tTX_AGG_CNT4_STRUC
, *
	tPTX_AGG_CNT4_STRUC
;

2148 
	#TX_AGG_CNT5
 0x1734

	)

2149 #ifde
RT_BIG_ENDIAN


2150 
	u_TX_AGG_CNT5_STRUC
 {

2152 
USHORT
 
	mAggSize12Cou
;

2153 
USHORT
 
	mAggSize11Cou
;

2154 } 
	mfld
;

2155 
UINT32
 
	mwd
;

2156 } 
	tTX_AGG_CNT5_STRUC
, *
	tPTX_AGG_CNT5_STRUC
;

2158 
	u_TX_AGG_CNT5_STRUC
 {

2160 
USHORT
 
	mAggSize11Cou
;

2161 
USHORT
 
	mAggSize12Cou
;

2162 } 
	mfld
;

2163 
UINT32
 
	mwd
;

2164 } 
	tTX_AGG_CNT5_STRUC
, *
	tPTX_AGG_CNT5_STRUC
;

2166 
	#TX_AGG_CNT6
 0x1738

	)

2167 #ifde
RT_BIG_ENDIAN


2168 
	u_TX_AGG_CNT6_STRUC
 {

2170 
USHORT
 
	mAggSize14Cou
;

2171 
USHORT
 
	mAggSize13Cou
;

2172 } 
	mfld
;

2173 
UINT32
 
	mwd
;

2174 } 
	tTX_AGG_CNT6_STRUC
, *
	tPTX_AGG_CNT6_STRUC
;

2176 
	u_TX_AGG_CNT6_STRUC
 {

2178 
USHORT
 
	mAggSize13Cou
;

2179 
USHORT
 
	mAggSize14Cou
;

2180 } 
	mfld
;

2181 
UINT32
 
	mwd
;

2182 } 
	tTX_AGG_CNT6_STRUC
, *
	tPTX_AGG_CNT6_STRUC
;

2184 
	#TX_AGG_CNT7
 0x173c

	)

2185 #ifde
RT_BIG_ENDIAN


2186 
	u_TX_AGG_CNT7_STRUC
 {

2188 
USHORT
 
	mAggSize16Cou
;

2189 
USHORT
 
	mAggSize15Cou
;

2190 } 
	mfld
;

2191 
UINT32
 
	mwd
;

2192 } 
	tTX_AGG_CNT7_STRUC
, *
	tPTX_AGG_CNT7_STRUC
;

2194 
	u_TX_AGG_CNT7_STRUC
 {

2196 
USHORT
 
	mAggSize15Cou
;

2197 
USHORT
 
	mAggSize16Cou
;

2198 } 
	mfld
;

2199 
UINT32
 
	mwd
;

2200 } 
	tTX_AGG_CNT7_STRUC
, *
	tPTX_AGG_CNT7_STRUC
;

2202 
	#MPDU_DENSITY_CNT
 0x1740

	)

2203 #ifde
RT_BIG_ENDIAN


2204 
	u_MPDU_DEN_CNT_STRUC
 {

2206 
USHORT
 
	mRXZoDCou
;

2207 
USHORT
 
	mTXZoDCou
;

2208 } 
	mfld
;

2209 
UINT32
 
	mwd
;

2210 } 
	tMPDU_DEN_CNT_STRUC
, *
	tPMPDU_DEN_CNT_STRUC
;

2212 
	u_MPDU_DEN_CNT_STRUC
 {

2214 
USHORT
 
	mTXZoDCou
;

2215 
USHORT
 
	mRXZoDCou
;

2216 } 
	mfld
;

2217 
UINT32
 
	mwd
;

2218 } 
	tMPDU_DEN_CNT_STRUC
, *
	tPMPDU_DEN_CNT_STRUC
;

2224 
	#TXRX_CSR1
 0x77d0

	)

2229 
	#MAC_WCID_BASE
 0x1800

2230 
	#HW_WCID_ENTRY_SIZE
 8

	)

2231 
	#PAIRWISE_KEY_TABLE_BASE
 0x4000

2232 
	#HW_KEY_ENTRY_SIZE
 0x20

	)

2233 
	#PAIRWISE_IVEIV_TABLE_BASE
 0x6000

2234 
	#MAC_IVEIV_TABLE_BASE
 0x6000

2235 
	#HW_IVEIV_ENTRY_SIZE
 8

	)

2236 
	#MAC_WCID_ATTRIBUTE_BASE
 0x6800

2237 
	#HW_WCID_ATTRI_SIZE
 4

	)

2238 
	#WCID_RESERVED
 0x6bfc

	)

2239 
	#SHARED_KEY_TABLE_BASE
 0x6c00

2240 
	#SHARED_KEY_MODE_BASE
 0x7000

2241 
	#HW_SHARED_KEY_MODE_SIZE
 4

	)

2242 
	#SHAREDKEYTABLE
 0

	)

2243 
	#PAIRWISEKEYTABLE
 1

	)

2247 
	#WAPI_PN_TABLE_BASE
 0x7800

	)

2248 
	#WAPI_PN_ENTRY_SIZE
 8

	)

2250 #ifde
RT_BIG_ENDIAN


2251 
	u_SHAREDKEY_MODE_STRUC
 {

2253 
UINT32
 
	mBss1Key3ChAlg
:4;

2254 
UINT32
 
	mBss1Key2ChAlg
:4;

2255 
UINT32
 
	mBss1Key1ChAlg
:4;

2256 
UINT32
 
	mBss1Key0ChAlg
:4;

2257 
UINT32
 
	mBss0Key3ChAlg
:4;

2258 
UINT32
 
	mBss0Key2ChAlg
:4;

2259 
UINT32
 
	mBss0Key1ChAlg
:4;

2260 
UINT32
 
	mBss0Key0ChAlg
:4;

2261 } 
	mfld
;

2262 
UINT32
 
	mwd
;

2263 } 
	tSHAREDKEY_MODE_STRUC
, *
	tPSHAREDKEY_MODE_STRUC
;

2265 
	u_SHAREDKEY_MODE_STRUC
 {

2267 
UINT32
 
	mBss0Key0ChAlg
:4;

2268 
UINT32
 
	mBss0Key1ChAlg
:4;

2269 
UINT32
 
	mBss0Key2ChAlg
:4;

2270 
UINT32
 
	mBss0Key3ChAlg
:4;

2271 
UINT32
 
	mBss1Key0ChAlg
:4;

2272 
UINT32
 
	mBss1Key1ChAlg
:4;

2273 
UINT32
 
	mBss1Key2ChAlg
:4;

2274 
UINT32
 
	mBss1Key3ChAlg
:4;

2275 } 
	mfld
;

2276 
UINT32
 
	mwd
;

2277 } 
	tSHAREDKEY_MODE_STRUC
, *
	tPSHAREDKEY_MODE_STRUC
;

2280 
	s_HW_WCID_ENTRY
 {

2281 
UCHAR
 
	mAddss
[6];

2282 
UCHAR
 
	mRsv
[2];

2283 } 
	tHW_WCID_ENTRY
, 
	tPHW_WCID_ENTRY
;

2290 
	s_WCID_ENTRY_STRUC
 {

2291 
UCHAR
 
	mRXBABm7
;

2292 
UCHAR
 
	mRXBABm0
;

2293 
UCHAR
 
	mMAC
[6];

2294 } 
	tWCID_ENTRY_STRUC
, *
	tPWCID_ENTRY_STRUC
;

2298 
	s_HW_KEY_ENTRY
 {

2299 
UCHAR
 
	mKey
[16];

2300 
UCHAR
 
	mTxMic
[8];

2301 
UCHAR
 
	mRxMic
[8];

2302 } 
	tHW_KEY_ENTRY
, *
	tPHW_KEY_ENTRY
;

2307 #ifde
RT_BIG_ENDIAN


2308 
	u_WCID_ATTRIBUTE_STRUC
 {

2310 
UINT32
 
	mWAPIKeyIdx
:8;

2311 
UINT32
 
	mWAPI_rsv
:8;

2312 
UINT32
 
	mWAPI_MCBC
:1;

2313 
UINT32
 
	mrsv
:3;

2314 
UINT32
 
	mBSSIdxExt
:1;

2315 
UINT32
 
	mPaKeyModeExt
:1;

2316 
UINT32
 
	mRXWIUDF
:3;

2317 
UINT32
 
	mBSSIdx
:3;

2318 
UINT32
 
	mPaKeyMode
:3;

2319 
UINT32
 
	mKeyTab
:1;

2320 } 
	mfld
;

2321 
UINT32
 
	mwd
;

2322 } 
	tWCID_ATTRIBUTE_STRUC
, *
	tPWCID_ATTRIBUTE_STRUC
;

2324 
	u_WCID_ATTRIBUTE_STRUC
 {

2326 
UINT32
 
	mKeyTab
:1;

2327 
UINT32
 
	mPaKeyMode
:3;

2328 
UINT32
 
	mBSSIdx
:3;

2329 
UINT32
 
	mRXWIUDF
:3;

2330 
UINT32
 
	mPaKeyModeExt
:1;

2331 
UINT32
 
	mBSSIdxExt
:1;

2332 
UINT32
 
	mrsv
:3;

2333 
UINT32
 
	mWAPI_MCBC
:1;

2334 
UINT32
 
	mWAPI_rsv
:8;

2335 
UINT32
 
	mWAPIKeyIdx
:8;

2336 } 
	mfld
;

2337 
UINT32
 
	mwd
;

2338 } 
	tWCID_ATTRIBUTE_STRUC
, *
	tPWCID_ATTRIBUTE_STRUC
;

2349 #ifde
RT_BIG_ENDIAN


2350 
	u_H2M_MAILBOX_STRUC
 {

2352 
UINT32
 
	mOwr
:8;

2353 
UINT32
 
	mCmdTok
:8;

2354 
UINT32
 
	mHighBy
:8;

2355 
UINT32
 
	mLowBy
:8;

2356 } 
	mfld
;

2357 
UINT32
 
	mwd
;

2358 } 
	tH2M_MAILBOX_STRUC
, *
	tPH2M_MAILBOX_STRUC
;

2360 
	u_H2M_MAILBOX_STRUC
 {

2362 
UINT32
 
	mLowBy
:8;

2363 
UINT32
 
	mHighBy
:8;

2364 
UINT32
 
	mCmdTok
:8;

2365 
UINT32
 
	mOwr
:8;

2366 } 
	mfld
;

2367 
UINT32
 
	mwd
;

2368 } 
	tH2M_MAILBOX_STRUC
, *
	tPH2M_MAILBOX_STRUC
;

2374 #ifde
RT_BIG_ENDIAN


2375 
	u_M2H_CMD_DONE_STRUC
 {

2377 
UINT32
 
	mCmdTok3
;

2378 
UINT32
 
	mCmdTok2
;

2379 
UINT32
 
	mCmdTok1
;

2380 
UINT32
 
	mCmdTok0
;

2381 } 
	mfld
;

2382 
UINT32
 
	mwd
;

2383 } 
	tM2H_CMD_DONE_STRUC
, *
	tPM2H_CMD_DONE_STRUC
;

2385 
	u_M2H_CMD_DONE_STRUC
 {

2387 
UINT32
 
	mCmdTok0
;

2388 
UINT32
 
	mCmdTok1
;

2389 
UINT32
 
	mCmdTok2
;

2390 
UINT32
 
	mCmdTok3
;

2391 } 
	mfld
;

2392 
UINT32
 
	mwd
;

2393 } 
	tM2H_CMD_DONE_STRUC
, *
	tPM2H_CMD_DONE_STRUC
;

2398 #ifde
RT_BIG_ENDIAN


2399 
	u_NAV_TIME_CFG_STRUC
 {

2401 
USHORT
 
	mrsv
:6;

2402 
USHORT
 
	mZoSifs
:1;

2403 
USHORT
 
	mEifs
:9;

2404 
UCHAR
 
	mSlTime
;

2405 
UCHAR
 
	mSifs
;

2406 } 
	mfld
;

2407 
UINT32
 
	mwd
;

2408 } 
	tNAV_TIME_CFG_STRUC
, *
	tPNAV_TIME_CFG_STRUC
;

2410 
	u_NAV_TIME_CFG_STRUC
 {

2412 
UCHAR
 
	mSifs
;

2413 
UCHAR
 
	mSlTime
;

2414 
USHORT
 
	mEifs
:9;

2415 
USHORT
 
	mZoSifs
:1;

2416 
USHORT
 
	mrsv
:6;

2417 } 
	mfld
;

2418 
UINT32
 
	mwd
;

2419 } 
	tNAV_TIME_CFG_STRUC
, *
	tPNAV_TIME_CFG_STRUC
;

2426 #ifde
RT_BIG_ENDIAN


2427 
	uRX_FILTR_CFG_STRUC
 {

2429 
	mUINT32
 :15;

2430 
UINT32
 
	mDrRsvClTy
:1;

2432 
UINT32
 
	mDrBAR
:1;

2433 
UINT32
 
	mDrBA
:1;

2434 
UINT32
 
	mDrPsPl
:1;

2435 
UINT32
 
	mDrRts
:1;

2437 
UINT32
 
	mDrCts
:1;

2438 
UINT32
 
	mDrAck
:1;

2439 
UINT32
 
	mDrCFEnd
:1;

2440 
UINT32
 
	mDrCFEndAck
:1;

2442 
UINT32
 
	mDrDui
:1;

2443 
UINT32
 
	mDrB
:1;

2444 
UINT32
 
	mDrM
:1;

2445 
UINT32
 
	mDrVE
:1;

2447 
UINT32
 
	mDrNMyBSSID
:1;

2448 
UINT32
 
	mDrNToMe
:1;

2449 
UINT32
 
	mDrPhyE
:1;

2450 
UINT32
 
	mDrCRCE
:1;

2451 } 
	mfld
;

2452 
UINT32
 
	mwd
;

2453 } 
	tRX_FILTR_CFG_STRUC
, *
	tPRX_FILTR_CFG_STRUC
;

2455 
	u_RX_FILTR_CFG_STRUC
 {

2457 
UINT32
 
	mDrCRCE
:1;

2458 
UINT32
 
	mDrPhyE
:1;

2459 
UINT32
 
	mDrNToMe
:1;

2460 
UINT32
 
	mDrNMyBSSID
:1;

2462 
UINT32
 
	mDrVE
:1;

2463 
UINT32
 
	mDrM
:1;

2464 
UINT32
 
	mDrB
:1;

2465 
UINT32
 
	mDrDui
:1;

2467 
UINT32
 
	mDrCFEndAck
:1;

2468 
UINT32
 
	mDrCFEnd
:1;

2469 
UINT32
 
	mDrAck
:1;

2470 
UINT32
 
	mDrCts
:1;

2472 
UINT32
 
	mDrRts
:1;

2473 
UINT32
 
	mDrPsPl
:1;

2474 
UINT32
 
	mDrBA
:1;

2475 
UINT32
 
	mDrBAR
:1;

2477 
UINT32
 
	mDrRsvClTy
:1;

2478 
	mUINT32
 :15;

2479 } 
	mfld
;

2480 
UINT32
 
	mwd
;

2481 } 
	tRX_FILTR_CFG_STRUC
, *
	tPRX_FILTR_CFG_STRUC
;

2490 #ifde
RT_BIG_ENDIAN


2491 
	u_PHY_CSR4_STRUC
 {

2493 
UINT32
 
	mBusy
:1;

2494 
UINT32
 
	mPLL_LD
:1;

2495 
UINT32
 
	mIFSe
:1;

2496 
UINT32
 
	mNumbOfBs
:5;

2497 
UINT32
 
	mRFRegVue
:24;

2498 } 
	mfld
;

2499 
UINT32
 
	mwd
;

2500 } 
	tPHY_CSR4_STRUC
, *
	tPPHY_CSR4_STRUC
;

2502 
	u_PHY_CSR4_STRUC
 {

2504 
UINT32
 
	mRFRegVue
:24;

2505 
UINT32
 
	mNumbOfBs
:5;

2506 
UINT32
 
	mIFSe
:1;

2507 
UINT32
 
	mPLL_LD
:1;

2508 
UINT32
 
	mBusy
:1;

2509 } 
	mfld
;

2510 
UINT32
 
	mwd
;

2511 } 
	tPHY_CSR4_STRUC
, *
	tPPHY_CSR4_STRUC
;

2518 #ifde
RT_BIG_ENDIAN


2519 
	u_SEC_CSR5_STRUC
 {

2521 
	mUINT32
 :1;

2522 
UINT32
 
	mBss3Key3ChAlg
:3;

2523 
	mUINT32
 :1;

2524 
UINT32
 
	mBss3Key2ChAlg
:3;

2525 
	mUINT32
 :1;

2526 
UINT32
 
	mBss3Key1ChAlg
:3;

2527 
	mUINT32
 :1;

2528 
UINT32
 
	mBss3Key0ChAlg
:3;

2529 
	mUINT32
 :1;

2530 
UINT32
 
	mBss2Key3ChAlg
:3;

2531 
	mUINT32
 :1;

2532 
UINT32
 
	mBss2Key2ChAlg
:3;

2533 
	mUINT32
 :1;

2534 
UINT32
 
	mBss2Key1ChAlg
:3;

2535 
	mUINT32
 :1;

2536 
UINT32
 
	mBss2Key0ChAlg
:3;

2537 } 
	mfld
;

2538 
UINT32
 
	mwd
;

2539 } 
	tSEC_CSR5_STRUC
, *
	tPSEC_CSR5_STRUC
;

2541 
	u_SEC_CSR5_STRUC
 {

2543 
UINT32
 
	mBss2Key0ChAlg
:3;

2544 
	mUINT32
 :1;

2545 
UINT32
 
	mBss2Key1ChAlg
:3;

2546 
	mUINT32
 :1;

2547 
UINT32
 
	mBss2Key2ChAlg
:3;

2548 
	mUINT32
 :1;

2549 
UINT32
 
	mBss2Key3ChAlg
:3;

2550 
	mUINT32
 :1;

2551 
UINT32
 
	mBss3Key0ChAlg
:3;

2552 
	mUINT32
 :1;

2553 
UINT32
 
	mBss3Key1ChAlg
:3;

2554 
	mUINT32
 :1;

2555 
UINT32
 
	mBss3Key2ChAlg
:3;

2556 
	mUINT32
 :1;

2557 
UINT32
 
	mBss3Key3ChAlg
:3;

2558 
	mUINT32
 :1;

2559 } 
	mfld
;

2560 
UINT32
 
	mwd
;

2561 } 
	tSEC_CSR5_STRUC
, *
	tPSEC_CSR5_STRUC
;

2568 #ifde
RT_BIG_ENDIAN


2569 
	u_HOST_CMD_CSR_STRUC
 {

2571 
UINT32
 
	mRsv
:24;

2572 
UINT32
 
	mHoCommd
:8;

2573 } 
	mfld
;

2574 
UINT32
 
	mwd
;

2575 } 
	tHOST_CMD_CSR_STRUC
, *
	tPHOST_CMD_CSR_STRUC
;

2577 
	u_HOST_CMD_CSR_STRUC
 {

2579 
UINT32
 
	mHoCommd
:8;

2580 
UINT32
 
	mRsv
:24;

2581 } 
	mfld
;

2582 
UINT32
 
	mwd
;

2583 } 
	tHOST_CMD_CSR_STRUC
, *
	tPHOST_CMD_CSR_STRUC
;

2596 #ifde
RT_BIG_ENDIAN


2597 
	u_E2PROM_CSR_STRUC
 {

2599 
UINT32
 
	mRsvd
:25;

2600 
UINT32
 
	mLdStus
:1;

2601 
UINT32
 
	mTy
:1;

2602 
UINT32
 
	mEromDO
:1;

2603 
UINT32
 
	mEromDI
:1;

2604 
UINT32
 
	mEromCS
:1;

2605 
UINT32
 
	mEromSK
:1;

2606 
UINT32
 
	mRd
:1;

2607 } 
	mfld
;

2608 
UINT32
 
	mwd
;

2609 } 
	tE2PROM_CSR_STRUC
, *
	tPE2PROM_CSR_STRUC
;

2611 
	u_E2PROM_CSR_STRUC
 {

2613 
UINT32
 
	mRd
:1;

2614 
UINT32
 
	mEromSK
:1;

2615 
UINT32
 
	mEromCS
:1;

2616 
UINT32
 
	mEromDI
:1;

2617 
UINT32
 
	mEromDO
:1;

2618 
UINT32
 
	mTy
:1;

2619 
UINT32
 
	mLdStus
:1;

2620 
UINT32
 
	mRsvd
:25;

2621 } 
	mfld
;

2622 
UINT32
 
	mwd
;

2623 } 
	tE2PROM_CSR_STRUC
, *
	tPE2PROM_CSR_STRUC
;

2629 #ifde
RT_BIG_ENDIAN


2630 
	u_QOS_CSR0_STRUC
 {

2632 
UCHAR
 
	mBy3
;

2633 
UCHAR
 
	mBy2
;

2634 
UCHAR
 
	mBy1
;

2635 
UCHAR
 
	mBy0
;

2636 } 
	mfld
;

2637 
UINT32
 
	mwd
;

2638 } 
	tQOS_CSR0_STRUC
, *
	tPQOS_CSR0_STRUC
;

2640 
	u_QOS_CSR0_STRUC
 {

2642 
UCHAR
 
	mBy0
;

2643 
UCHAR
 
	mBy1
;

2644 
UCHAR
 
	mBy2
;

2645 
UCHAR
 
	mBy3
;

2646 } 
	mfld
;

2647 
UINT32
 
	mwd
;

2648 } 
	tQOS_CSR0_STRUC
, *
	tPQOS_CSR0_STRUC
;

2654 #ifde
RT_BIG_ENDIAN


2655 
	u_QOS_CSR1_STRUC
 {

2657 
UCHAR
 
	mRsvd1
;

2658 
UCHAR
 
	mRsvd0
;

2659 
UCHAR
 
	mBy5
;

2660 
UCHAR
 
	mBy4
;

2661 } 
	mfld
;

2662 
UINT32
 
	mwd
;

2663 } 
	tQOS_CSR1_STRUC
, *
	tPQOS_CSR1_STRUC
;

2665 
	u_QOS_CSR1_STRUC
 {

2667 
UCHAR
 
	mBy4
;

2668 
UCHAR
 
	mBy5
;

2669 
UCHAR
 
	mRsvd0
;

2670 
UCHAR
 
	mRsvd1
;

2671 } 
	mfld
;

2672 
UINT32
 
	mwd
;

2673 } 
	tQOS_CSR1_STRUC
, *
	tPQOS_CSR1_STRUC
;

2676 
	#RF_CSR_CFG
 0x500

	)

2677 #ifde
RT_BIG_ENDIAN


2678 
	u_RF_CSR_CFG_STRUC
 {

2680 
UINT
 
	mRsvd1
:14;

2681 
UINT
 
	mRF_CSR_KICK
:1;

2682 
UINT
 
	mRF_CSR_WR
:1;

2683 
UINT
 
	mRsvd2
:3;

2684 
UINT
 
	mTESTCSR_RFACC_REGNUM
:5;

2685 
UINT
 
	mRF_CSR_DATA
:8;

2686 } 
	mfld
;

2687 
UINT
 
	mwd
;

2688 } 
	tRF_CSR_CFG_STRUC
, *
	tPRF_CSR_CFG_STRUC
;

2690 
	u_RF_CSR_CFG_STRUC
 {

2692 
UINT
 
	mRF_CSR_DATA
:8;

2693 
UINT
 
	mTESTCSR_RFACC_REGNUM
:5;

2694 
UINT
 
	mRsvd2
:3;

2695 
UINT
 
	mRF_CSR_WR
:1;

2696 
UINT
 
	mRF_CSR_KICK
:1;

2697 
UINT
 
	mRsvd1
:14;

2698 } 
	mfld
;

2699 
UINT
 
	mwd
;

2700 } 
	tRF_CSR_CFG_STRUC
, *
	tPRF_CSR_CFG_STRUC
;

2703 #ifde
RT_BIG_ENDIAN


2704 
	u_RF_CSR_CFG_EXT_STRUC


2708 
ULONG
 
	mRsvd1
:14;

2709 
ULONG
 
	mRF_CSR_KICK
:1;

2710 
ULONG
 
	mRF_CSR_WR
:1;

2711 
ULONG
 
	mRsvd2
:2;

2712 
ULONG
 
	mTESTCSR_RFACC_REGNUM
:6;

2713 
ULONG
 
	mRF_CSR_DATA
:8;

2714 } 
	mfld
;

2716 
ULONG
 
	mwd
;

2717 } 
	tRF_CSR_CFG_EXT_STRUC
, *
	tPRF_CSR_CFG_EXT_STRUC
;

2719 
	u_RF_CSR_CFG_EXT_STRUC


2723 
ULONG
 
	mRF_CSR_DATA
:8;

2724 
ULONG
 
	mTESTCSR_RFACC_REGNUM
:6;

2725 
ULONG
 
	mRsvd2
:2;

2726 
ULONG
 
	mRF_CSR_WR
:1;

2727 
ULONG
 
	mRF_CSR_KICK
:1;

2728 
ULONG
 
	mRsvd1
:14;

2729 } 
	mfld
;

2731 
ULONG
 
	mwd
;

2732 } 
	tRF_CSR_CFG_EXT_STRUC
, *
	tPRF_CSR_CFG_EXT_STRUC
;

2740 
	#HW_CIS_BASE
 0x2000

	)

2743 
	#HW_CS_CTS_BASE
 0x7700

	)

2745 
	#HW_DFS_CTS_BASE
 0x7780

	)

2746 
	#HW_CTS_FRAME_SIZE
 0x80

	)

2750 
	#HW_DEBUG_SETTING_BASE
 0x77f0

2751 
	#HW_DEBUG_SETTING_BASE2
 0x7770

2752 

	)

2758 
	#HW_BEACON_OFFSET
 0x0200

	)

2759 #ifde
SPECIFIC_BCN_BUF_SUPPORT


2762 
	#HW_BEACON_MAX_SIZE
 0x2000

	)

2763 
	#HW_BEACON_BASE0
 0x4000

	)

2764 
	#HW_BEACON_BASE1
 0x4200

	)

2765 
	#HW_BEACON_BASE2
 0x4400

	)

2766 
	#HW_BEACON_BASE3
 0x4600

	)

2767 
	#HW_BEACON_BASE4
 0x4800

	)

2768 
	#HW_BEACON_BASE5
 0x4A00

	)

2769 
	#HW_BEACON_BASE6
 0x4C00

	)

2770 
	#HW_BEACON_BASE7
 0x4E00

	)

2771 
	#HW_BEACON_BASE8
 0x5000

	)

2772 
	#HW_BEACON_BASE9
 0x5200

	)

2773 
	#HW_BEACON_BASE10
 0x5400

	)

2774 
	#HW_BEACON_BASE11
 0x5600

	)

2775 
	#HW_BEACON_BASE12
 0x5800

	)

2776 
	#HW_BEACON_BASE13
 0x5A00

	)

2777 
	#HW_BEACON_BASE14
 0x5C00

	)

2778 
	#HW_BEACON_BASE15
 0x5E00

	)

2788 
	#HW_BEACON_MAX_SIZE
 0x1000

	)

2789 
	#HW_BEACON_BASE0
 0x7800

	)

2790 
	#HW_BEACON_BASE1
 0x7A00

	)

2791 
	#HW_BEACON_BASE2
 0x7C00

	)

2792 
	#HW_BEACON_BASE3
 0x7E00

	)

2793 
	#HW_BEACON_BASE4
 0x7200

	)

2794 
	#HW_BEACON_BASE5
 0x7400

	)

2795 
	#HW_BEACON_BASE6
 0x5DC0

	)

2796 
	#HW_BEACON_BASE7
 0x5BC0

	)

2802 
	#HW_BEACON_BASE0_REDIRECTION
 0x4000

	)

2803 
	#HW_BEACON_BASE1_REDIRECTION
 0x4200

	)

2804 
	#HW_BEACON_BASE2_REDIRECTION
 0x4400

	)

2805 
	#HW_BEACON_BASE3_REDIRECTION
 0x4600

	)

2806 
	#HW_BEACON_BASE4_REDIRECTION
 0x4800

	)

2807 
	#HW_BEACON_BASE5_REDIRECTION
 0x4A00

	)

2808 
	#HW_BEACON_BASE6_REDIRECTION
 0x4C00

	)

2809 
	#HW_BEACON_BASE7_REDIRECTION
 0x4E00

	)

2813 
	#HOST_CMD_CSR
 0x404

	)

2814 
	#H2M_MAILBOX_CSR
 0x7010

	)

2815 
	#H2M_MAILBOX_CID
 0x7014

	)

2816 
	#H2M_MAILBOX_STATUS
 0x701c

	)

2817 
	#H2M_INT_SRC
 0x7024

	)

2818 
	#H2M_BBP_AGENT
 0x7028

	)

2819 
	#M2H_CMD_DONE_CSR
 0x000c

	)

2820 
	#MCU_TXOP_ARRAY_BASE
 0x000c

2821 
	#MCU_TXOP_ENTRY_SIZE
 32

2822 
	#MAX_NUM_OF_TXOP_ENTRY
 16

2823 
	#MCU_MBOX_VERSION
 0x01

2824 
	#MCU_MBOX_VERSION_OFFSET
 5

2825 

	)

2832 
	#E2PROM_CSR
 0x0004

	)

2833 
	#IO_CNTL_CSR
 0x77d0

	)

2844 
	#PID_MGMT
 0x05

	)

2845 
	#PID_BEACON
 0x0c

	)

2846 
	#PID_DATA_NORMALUCAST
 0x02

	)

2847 
	#PID_DATA_AMPDU
 0x04

	)

2848 
	#PID_DATA_NO_ACK
 0x08

	)

2849 
	#PID_DATA_NOT_NORM_ACK
 0x03

	)

2851 
	#QID_AC_BK
 1

2852 
	#QID_AC_BE
 0

2853 
	#QID_AC_VI
 2

	)

2854 
	#QID_AC_VO
 3

	)

2855 
	#QID_HCCA
 4

	)

2856 
	#NUM_OF_TX_RING
 5

	)

2857 
	#QID_MGMT
 13

	)

2858 
	#QID_RX
 14

	)

2859 
	#QID_OTHER
 15

	)

2862 #ifde
SPECIFIC_BCN_BUF_SUPPORT


2863 
	#LOWER_SHRMEM
 0

	)

2864 
	#HIGHER_SHRMEM
 1

	)

2870 
	#RTMP_HIGH_SHARED_MEM_SET
(
_pAd
) \

2872 
UINT32
 
gVue
; \

2874 i(
_pAd
->
ShrMS
 !
HIGHER_SHRMEM
) \

2876 
_pAd
->
ShrMS
 = 
HIGHER_SHRMEM
; \

2877 
	`RTMP_IO_READ32
(
_pAd
, 
PBF_SYS_CTRL
, &
gVue
); \

2878 
	`RTMP_IO_WRITE32
(
_pAd
, 
PBF_SYS_CTRL
, 
gVue
 | (1 << 19)); \

2880 } 0)

	)

2882 
	#RTMP_LOW_SHARED_MEM_SET
(
_pAd
) \

2884 
UINT32
 
gVue
; \

2886 i(
_pAd
->
ShrMS
 !
LOWER_SHRMEM
) \

2888 
_pAd
->
ShrMS
 = 
LOWER_SHRMEM
; \

2889 
	`RTMP_IO_READ32
(
_pAd
, 
PBF_SYS_CTRL
, &
gVue
); \

2890 
	`RTMP_IO_WRITE32
(
_pAd
, 
PBF_SYS_CTRL
, 
gVue
 & ~(1 << 19)); \

2892 } 0)

	)

2898 
	#RTMP_MAC_SHR_MSEL_LOCK
(
_pAd
, 
_shr_ml
, 
_qFg
) \

2900 
UINT32
 
__gVue
; \

2902 
	`RTMP_INT_LOCK
(&
_pAd
->
ShrMemLock
, 
_qFg
); \

2903 
_pAd
->
ShrMS
 = 
_shr_ml
; \

2904 
	`RTMP_IO_READ32
(
_pAd
, 
PBF_SYS_CTRL
, &
__gVue
); \

2905 i(
_shr_ml
 =
HIGHER_SHRMEM
) \

2907 
	`RTMP_IO_WRITE32
(
_pAd
, 
PBF_SYS_CTRL
, 
__gVue
 | (1 << 19)); \

2911 
	`RTMP_IO_WRITE32
(
_pAd
, 
PBF_SYS_CTRL
, 
__gVue
 & ~(1 << 19)); \

2913 } 0)

	)

2916 
	#RTMP_MAC_SHR_MSEL_UNLOCK
(
_pAd
, 
_shr_ml
, 
_qFg
) \

2918 
UINT32
 
__gVue
; \

2920 
_pAd
->
ShrMS
 = 
_shr_ml
; \

2921 
	`RTMP_IO_READ32
(
_pAd
, 
PBF_SYS_CTRL
, &
__gVue
); \

2922 i(
_shr_ml
 =
HIGHER_SHRMEM
) \

2924 
	`RTMP_IO_WRITE32
(
_pAd
, 
PBF_SYS_CTRL
, 
__gVue
 | (1 << 19)); \

2928 
	`RTMP_IO_WRITE32
(
_pAd
, 
PBF_SYS_CTRL
, 
__gVue
 & ~(1 << 19)); \

2930 
	`RTMP_INT_UNLOCK
(&
_pAd
->
ShrMemLock
, 
_qFg
); \

2931 } 0)

	)

	@include/chip/rtmp_phy.h

38 #ide
__RTMP_PHY_H__


39 
	#__RTMP_PHY_H__


	)

45 
	#RF_R00
 0

	)

46 
	#RF_R01
 1

	)

47 
	#RF_R02
 2

	)

48 
	#RF_R03
 3

	)

49 
	#RF_R04
 4

	)

50 
	#RF_R05
 5

	)

51 
	#RF_R06
 6

	)

52 
	#RF_R07
 7

	)

53 
	#RF_R08
 8

	)

54 
	#RF_R09
 9

	)

55 
	#RF_R10
 10

	)

56 
	#RF_R11
 11

	)

57 
	#RF_R12
 12

	)

58 
	#RF_R13
 13

	)

59 
	#RF_R14
 14

	)

60 
	#RF_R15
 15

	)

61 
	#RF_R16
 16

	)

62 
	#RF_R17
 17

	)

63 
	#RF_R18
 18

	)

64 
	#RF_R19
 19

	)

65 
	#RF_R20
 20

	)

66 
	#RF_R21
 21

	)

67 
	#RF_R22
 22

	)

68 
	#RF_R23
 23

	)

69 
	#RF_R24
 24

	)

70 
	#RF_R25
 25

	)

71 
	#RF_R26
 26

	)

72 
	#RF_R27
 27

	)

73 
	#RF_R28
 28

	)

74 
	#RF_R29
 29

	)

75 
	#RF_R30
 30

	)

76 
	#RF_R31
 31

	)

77 
	#RF_R32
 32

	)

78 
	#RF_R33
 33

	)

79 
	#RF_R34
 34

	)

80 
	#RF_R35
 35

	)

81 
	#RF_R36
 36

	)

82 
	#RF_R37
 37

	)

83 
	#RF_R38
 38

	)

84 
	#RF_R39
 39

	)

85 
	#RF_R40
 40

	)

86 
	#RF_R41
 41

	)

87 
	#RF_R42
 42

	)

88 
	#RF_R43
 43

	)

89 
	#RF_R44
 44

	)

90 
	#RF_R45
 45

	)

91 
	#RF_R46
 46

	)

92 
	#RF_R47
 47

	)

93 
	#RF_R48
 48

	)

94 
	#RF_R49
 49

	)

95 
	#RF_R50
 50

	)

96 
	#RF_R51
 51

	)

97 
	#RF_R52
 52

	)

98 
	#RF_R53
 53

	)

99 
	#RF_R54
 54

	)

100 
	#RF_R55
 55

	)

101 
	#RF_R56
 56

	)

102 
	#RF_R57
 57

	)

103 
	#RF_R58
 58

	)

104 
	#RF_R59
 59

	)

105 
	#RF_R60
 60

	)

106 
	#RF_R61
 61

	)

107 
	#RF_R62
 62

	)

108 
	#RF_R63
 63

	)

112 
	#RFIC_2820
 1

113 
	#RFIC_2850
 2

114 
	#RFIC_2720
 3

115 
	#RFIC_2750
 4

116 
	#RFIC_3020
 5

117 
	#RFIC_2020
 6

118 
	#RFIC_3021
 7

119 
	#RFIC_3022
 8

120 
	#RFIC_3052
 9

121 
	#RFIC_2853
 10

122 
	#RFIC_3320
 11

123 
	#RFIC_3322
 12

124 
	#RFIC_3053
 13

125 
	#RFIC_3853
 13

126 
	#RFIC_UNKNOWN
 0xff

	)

128 
	#RFIC_IS_5G_BAND
(
__pAd
) \

129 ((
__pAd
->
RfIcTy
 =
RFIC_2850
) || \

130 (
__pAd
->
RfIcTy
 =
RFIC_2750
) || \

131 (
__pAd
->
RfIcTy
 =
RFIC_3052
) || \

132 (
__pAd
->
RfIcTy
 =
RFIC_2853
) || \

133 (
__pAd
->
RfIcTy
 =
RFIC_3053
) || \

134 (
__pAd
->
RfIcTy
 =
RFIC_3853
) || \

135 (
__pAd
->
RfIcTy
 =
RFIC_UNKNOWN
))

	)

140 
	#BBP_R0
 0

141 
	#BBP_R1
 1

142 
	#BBP_R2
 2

143 
	#BBP_R3
 3

	)

144 
	#BBP_R4
 4

	)

145 
	#BBP_R5
 5

	)

146 
	#BBP_R6
 6

	)

147 
	#BBP_R14
 14

148 
	#BBP_R16
 16

	)

149 
	#BBP_R17
 17

150 
	#BBP_R18
 18

	)

151 
	#BBP_R21
 21

	)

152 
	#BBP_R22
 22

	)

153 
	#BBP_R24
 24

	)

154 
	#BBP_R25
 25

	)

155 
	#BBP_R26
 26

	)

156 
	#BBP_R27
 27

	)

157 
	#BBP_R31
 31

	)

158 
	#BBP_R47
 47

	)

159 
	#BBP_R49
 49

160 
	#BBP_R50
 50

	)

161 
	#BBP_R51
 51

	)

162 
	#BBP_R52
 52

	)

163 
	#BBP_R53
 53

	)

164 
	#BBP_R54
 54

	)

165 
	#BBP_R55
 55

	)

166 
	#BBP_R62
 62

167 
	#BBP_R63
 63

	)

168 
	#BBP_R64
 64

	)

169 
	#BBP_R65
 65

	)

170 
	#BBP_R66
 66

	)

171 
	#BBP_R67
 67

	)

172 
	#BBP_R68
 68

	)

173 
	#BBP_R69
 69

	)

174 
	#BBP_R70
 70

175 
	#BBP_R73
 73

	)

176 
	#BBP_R75
 75

	)

177 
	#BBP_R77
 77

	)

178 
	#BBP_R78
 78

	)

179 
	#BBP_R79
 79

	)

180 
	#BBP_R80
 80

	)

181 
	#BBP_R81
 81

	)

182 
	#BBP_R82
 82

	)

183 
	#BBP_R83
 83

	)

184 
	#BBP_R84
 84

	)

185 
	#BBP_R86
 86

	)

186 
	#BBP_R88
 88

	)

187 
	#BBP_R91
 91

	)

188 
	#BBP_R92
 92

	)

189 
	#BBP_R94
 94

190 
	#BBP_R103
 103

	)

191 
	#BBP_R104
 104

	)

192 
	#BBP_R105
 105

	)

193 
	#BBP_R106
 106

	)

194 
	#BBP_R109
 109

	)

195 
	#BBP_R110
 110

	)

196 
	#BBP_R113
 113

	)

197 
	#BBP_R114
 114

	)

198 
	#BBP_R115
 115

	)

199 
	#BBP_R116
 116

	)

200 
	#BBP_R117
 117

	)

201 
	#BBP_R118
 118

	)

202 
	#BBP_R119
 119

	)

203 
	#BBP_R120
 120

	)

204 
	#BBP_R121
 121

	)

205 
	#BBP_R122
 122

	)

206 
	#BBP_R123
 123

	)

207 
	#BBP_R126
 126

	)

208 
	#BBP_R127
 127

	)

209 
	#BBP_R137
 137

	)

210 
	#BBP_R138
 138

211 
	#BBP_R140
 140

	)

212 
	#BBP_R141
 141

	)

213 
	#BBP_R142
 142

	)

214 
	#BBP_R143
 143

	)

215 
	#BBP_R148
 148

	)

217 
	#BBP_R160
 160

218 
	#BBP_R161
 161

	)

219 
	#BBP_R162
 162

	)

220 
	#BBP_R163
 163

	)

221 
	#BBP_R164
 164

	)

223 
	#BBP_R173
 173

	)

224 
	#BBP_R174
 174

	)

225 
	#BBP_R175
 175

	)

226 
	#BBP_R176
 176

	)

227 
	#BBP_R177
 177

	)

228 
	#BBP_R179
 179

	)

229 
	#BBP_R180
 180

	)

230 
	#BBP_R181
 181

	)

231 
	#BBP_R182
 182

	)

232 
	#BBP_R184
 184

	)

233 
	#BBP_R185
 185

	)

234 
	#BBP_R186
 186

	)

235 
	#BBP_R187
 187

	)

236 
	#BBP_R188
 188

	)

237 
	#BBP_R189
 189

	)

238 
	#BBP_R190
 190

	)

239 
	#BBP_R191
 191

	)

242 
	#BBPR94_DEFAULT
 0x06

243 

	)

248 #ifde
RT_BIG_ENDIAN


249 
	u_BBP_R49_STRUC
 {

252 
UCHAR
 
	madc5__l
:1;

253 
UCHAR
 
	mbyssTSSIAvage
:1;

254 
UCHAR
 
	mRerved
:1;

255 
UCHAR
 
	mTSSI
:5;

256 } 
	mfld
;

258 
UCHAR
 
	mby
;

259 } 
	tBBP_R49_STRUC
, *
	tPBBP_R49_STRUC
;

261 
	u_BBP_R49_STRUC
 {

264 
UCHAR
 
	mTSSI
:5;

265 
UCHAR
 
	mRerved
:1;

266 
UCHAR
 
	mbyssTSSIAvage
:1;

267 
UCHAR
 
	madc5__l
:1;

268 } 
	mfld
;

270 
UCHAR
 
	mby
;

271 } 
	tBBP_R49_STRUC
, *
	tPBBP_R49_STRUC
;

277 #ifde
RT_BIG_ENDIAN


278 
	u_BBP_R105_STRUC
 {

281 
UCHAR
 
	mRerve1
:4;

282 
UCHAR
 
	mEbSIGRemoduti
:1;

283 
UCHAR
 
	mMLDF2Sm
:1;

284 
UCHAR
 
	mInddtFdFwdComnti
:1;

285 
UCHAR
 
	mDeSIGOnPrimyChlOy
:1;

286 } 
	mfld
;

288 
UCHAR
 
	mby
;

289 } 
	tBBP_R105_STRUC
, *
	tPBBP_R105_STRUC
;

291 
	u_BBP_R105_STRUC
 {

294 
UCHAR
 
	mDeSIGOnPrimyChlOy
:1;

295 
UCHAR
 
	mInddtFdFwdComnti
:1;

296 
UCHAR
 
	mMLDF2Sm
:1;

297 
UCHAR
 
	mEbSIGRemoduti
:1;

298 
UCHAR
 
	mRerve1
:4;

299 } 
	mfld
;

301 
UCHAR
 
	mby
;

302 } 
	tBBP_R105_STRUC
, *
	tPBBP_R105_STRUC
;

308 #ifde
RT_BIG_ENDIAN


309 
	u_BBP_R106_STRUC
 {

312 
UCHAR
 
	mEbLowPowFSD
:1;

313 
UCHAR
 
	mShtGI_Offt40
:4;

314 
UCHAR
 
	mShtGI_Offt20
:3;

315 } 
	mfld
;

317 
UCHAR
 
	mby
;

318 } 
	tBBP_R106_STRUC
, *
	tPBBP_R106_STRUC
;

320 
	u_BBP_R106_STRUC
 {

323 
UCHAR
 
	mShtGI_Offt20
:3;

324 
UCHAR
 
	mShtGI_Offt40
:4;

325 
UCHAR
 
	mEbLowPowFSD
:1;

326 } 
	mfld
;

328 
UCHAR
 
	mby
;

329 } 
	tBBP_R106_STRUC
, *
	tPBBP_R106_STRUC
;

335 #ifde
RT_BIG_ENDIAN


336 
	u_BBP_R109_STRUC
 {

339 
UCHAR
 
	mTx1PowCl
:4;

340 
UCHAR
 
	mTx0PowCl
:4;

341 } 
	mfld
;

343 
UCHAR
 
	mby
;

344 } 
	tBBP_R109_STRUC
, *
	tPBBP_R109_STRUC
;

346 
	u_BBP_R109_STRUC
 {

349 
UCHAR
 
	mTx0PowCl
:4;

350 
UCHAR
 
	mTx1PowCl
:4;

351 } 
	mfld
;

353 
UCHAR
 
	mby
;

354 } 
	tBBP_R109_STRUC
, *
	tPBBP_R109_STRUC
;

360 #ifde
RT_BIG_ENDIAN


361 
	u_BBP_R110_STRUC
 {

364 
UCHAR
 
	mTx2PowCl
:4;

365 
UCHAR
 
	mATxPowCl
:4;

366 } 
	mfld
;

368 
UCHAR
 
	mby
;

369 } 
	tBBP_R110_STRUC
, *
	tPBBP_R110_STRUC
;

371 
	u_BBP_R110_STRUC
 {

374 
UCHAR
 
	mATxPowCl
:4;

375 
UCHAR
 
	mTx2PowCl
:4;

376 } 
	mfld
;

378 
UCHAR
 
	mby
;

379 } 
	tBBP_R110_STRUC
, *
	tPBBP_R110_STRUC
;

383 
	#MAX_BBP_ID
 136

	)

384 
	#MAX_BBP_MSG_SIZE
 2048

	)

391 
	#MAX_BUSY_COUNT
 100

392 

	)

399 
	#RSSI_FOR_VERY_LOW_SENSIBILITY
 -35

	)

400 
	#RSSI_FOR_LOW_SENSIBILITY
 -58

	)

401 
	#RSSI_FOR_MID_LOW_SENSIBILITY
 -80

	)

402 
	#RSSI_FOR_MID_SENSIBILITY
 -90

	)

407 #ifde
RTMP_MAC_PCI


408 
	#RTMP_RF_IO_WRITE32
(
_A
, 
_V
) \

410 i((
_A
)->
bPCIkOff
 =
FALSE
) \

412 
PHY_CSR4_STRUC
 
_vue
; \

413 
ULONG
 
_busyC
 = 0; \

416 
	`RTMP_IO_READ32
((
_A
), 
RF_CSR_CFG0
, &
_vue
.
wd
); \

417 i(
_vue
.
fld
.
Busy
 =
IDLE
) \

419 
_busyC
++; \

420 }
_busyC
 < 
MAX_BUSY_COUNT
); \

421 if(
_busyC
 < 
MAX_BUSY_COUNT
) \

423 
	`RTMP_IO_WRITE32
((
_A
), 
RF_CSR_CFG0
, (
_V
)); \

426 i((
_A
)->
ShowRf
) \

428 
	`tk
("RF:%x\n", 
_V
); \

430 }

	)

442 #ifde
RTMP_MAC_PCI


450 #ifde
RELASE_INCLUDE


459 #ifde
CONFIG_STA_SUPPORT


460 
	#IS_SUPPORT_PCIE_PS_L3
(
_pAd
(((_pAd)->
OpMode
 =
OPMODE_STA
) &&\

461 (
	`IS_RT3090
((
_pAd
)|| 
	`IS_RT3572
((_pAd)|| 
	`IS_RT3390
((_pAd)|| 
	`IS_RT3593
((_pAd))) && \

462 ((
_pAd
)->
SCfg
.
PSCڌ
.
fld
.
30xxPowMode
 == 3)&& \

463 ((
_pAd
)->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
TRUE
))

	)

465 
	#RTMP_PCIE_PS_L3_BBP_IO_READ8
(
_pAd
, 
_bbpID
, 
_pV
, 
_bVMCU
) \

467 
BBP_CSR_CFG_STRUC
 
BbpC
; \

468 
_busyC
, 
_cC
, 
_gID
; \

469 
BOOLEAN
 
brc
; \

470 
_gID
 = ((
_bVMCU
=
TRUE
 ? 
H2M_BBP_AGENT
 : 
BBP_CSR_CFG
); \

471 
BbpC
.
fld
.
Busy
 = 
IDLE
; \

472 i(((
_pAd
)->
bPCIkOff
 =
FALSE
) \

473 && (((
_pAd
)->
LaMCUCmd
=
WAKE_MCU_CMD
) || ((_pAd)->LastMCUCmd==0x72))\

474 && ((
_pAd
)->
b30xxBMcuCmd
 =
FALSE
)) \

476 
_busyC
=0; _busyC<
MAX_BUSY_COUNT
; _busyCnt++) \

478 
	`RTMP_IO_READ32
(
_pAd
, 
_gID
, &
BbpC
.
wd
); \

479 i(
BbpC
.
fld
.
Busy
 =
BUSY
) \

481 
BbpC
.
wd
 = 0; \

482 
BbpC
.
fld
.
fRd
 = 1; \

483 
BbpC
.
fld
.
BBP_RW_MODE
 = 1; \

484 
BbpC
.
fld
.
Busy
 = 1; \

485 
BbpC
.
fld
.
RegNum
 = 
_bbpID
; \

486 
	`RTMP_IO_WRITE32
(
_pAd
, 
_gID
, 
BbpC
.
wd
); \

487 i((
_bVMCU
=
TRUE
) \

489 
brc
 =
	`AsicSdCommdToMcu
(
_pAd
, 0x80, 0xff, 0x0, 0x0); \

490 
	`RTMPucDay
(1000); \

492 i(
brc
 =
TRUE
) \

494 
_cC
=0; _cC<
MAX_BUSY_COUNT
; _secCnt++) \

496 
	`RTMP_IO_READ32
(
_pAd
, 
_gID
, &
BbpC
.
wd
); \

497 i(
BbpC
.
fld
.
Busy
 =
IDLE
) \

500 i((
BbpC
.
fld
.
Busy
 =
IDLE
) && \

501 (
BbpC
.
fld
.
RegNum
 =
_bbpID
)) \

503 *(
_pV
(
UCHAR
)
BbpC
.
fld
.
Vue
; \

509 
BbpC
.
fld
.
Busy
 = 0; \

510 
	`RTMP_IO_WRITE32
(
_pAd
, 
_gID
, 
BbpC
.
wd
); \

514 i((
BbpC
.
fld
.
Busy
 =
BUSY
|| ((
_pAd
)->
bPCIkOff
 =
TRUE
)) \

516 
	`DBGPRINT_ERR
(("RTMP_PCIE_PS_L3_BBP_IO_READ8(vMCU=%dad R%d faԗs:k=%d,busy=%x)\n", (
_bVMCU
), 
_bbpID
,(
_pAd
)->
bPCIkOff
 ,
BbpC
.
fld
.
Busy
)); \

517 *(
_pV
(
_pAd
)->
BbpWreLch
[
_bbpID
]; \

519 }0)

	)

521 
	#IS_SUPPORT_PCIE_PS_L3
(
_pAd

FALSE


	)

522 
	#RTMP_PCIE_PS_L3_BBP_IO_READ8
(
_pAd
, 
_bbpID
, 
_pV
, 
_bVMCU
)

	)

525 
	#_RTMP_BBP_IO_READ8
(
_pAd
, 
_bbpID
, 
_pV
, 
_bVMCU
) \

527 
BBP_CSR_CFG_STRUC
 
BbpC
; \

528 
_busyC
, 
_cC
, 
_gID
; \

530 
_gID
 = ((
_bVMCU
=
TRUE
 ? 
H2M_BBP_AGENT
 : 
BBP_CSR_CFG
); \

531 
_busyC
=0; _busyC<
MAX_BUSY_COUNT
; _busyCnt++) \

533 
	`RTMP_IO_READ32
(
_pAd
, 
_gID
, &
BbpC
.
wd
); \

534 i(
BbpC
.
fld
.
Busy
 =
BUSY
) \

536 
BbpC
.
wd
 = 0; \

537 
BbpC
.
fld
.
fRd
 = 1; \

538 
BbpC
.
fld
.
BBP_RW_MODE
 = 1; \

539 
BbpC
.
fld
.
Busy
 = 1; \

540 
BbpC
.
fld
.
RegNum
 = 
_bbpID
; \

541 
	`RTMP_IO_WRITE32
(
_pAd
, 
_gID
, 
BbpC
.
wd
); \

542 i((
_bVMCU
=
TRUE
) \

544 
	`AsicSdCommdToMcu
(
_pAd
, 0x80, 0xff, 0x0, 0x0); \

545 
	`RTMPucDay
(1000); \

547 
_cC
=0; _cC<
MAX_BUSY_COUNT
; _secCnt++) \

549 
	`RTMP_IO_READ32
(
_pAd
, 
_gID
, &
BbpC
.
wd
); \

550 i(
BbpC
.
fld
.
Busy
 =
IDLE
) \

553 i((
BbpC
.
fld
.
Busy
 =
IDLE
) && \

554 (
BbpC
.
fld
.
RegNum
 =
_bbpID
)) \

556 *(
_pV
(
UCHAR
)
BbpC
.
fld
.
Vue
; \

560 i(
BbpC
.
fld
.
Busy
 =
BUSY
) \

562 
	`DBGPRINT_ERR
(("BBP(vMCU=%dad R%d fa\n", (
_bVMCU
), 
_bbpID
)); \

563 *(
_pV
(
_pAd
)->
BbpWreLch
[
_bbpID
]; \

564 i((
_bVMCU
=
TRUE
) \

566 
	`RTMP_IO_READ32
(
_pAd
, 
_gID
, &
BbpC
.
wd
); \

567 
BbpC
.
fld
.
Busy
 = 0; \

568 
	`RTMP_IO_WRITE32
(
_pAd
, 
_gID
, 
BbpC
.
wd
); \

571 }0)

	)

576 
	#BBP_IO_READ8_BY_REG_ID
(
_A
, 
_I
, 
_pV
) \

577 
	`RTMP_BBP_IO_READ8
((
_A
), (
_I
), (
_pV
), 
FALSE
)

	)

584 
	#_RTMP_BBP_IO_READ8_BY_REG_ID
(
_A
, 
_I
, 
_pV
) \

586 i((
_A
)->
bPCIkOff
 =
FALSE
) \

588 i((
_A
)->
fTy
 =
RTMP_DEV_INF_RBUS
) \

589 
	`RTMP_BBP_IO_READ8
((
_A
), (
_I
), (
_pV
), 
FALSE
); \

591 if(
	`IS_SUPPORT_PCIE_PS_L3
((
_A
))) \

592 
	`RTMP_PCIE_PS_L3_BBP_IO_READ8
((
_A
), (
_I
), (
_pV
), 
TRUE
); \

594 
	`RTMP_BBP_IO_READ8
((
_A
), (
_I
), (
_pV
), 
TRUE
); \

596 }0)

	)

605 #ifde
CONFIG_STA_SUPPORT


606 
	#RTMP_PCIE_PS_L3_BBP_IO_WRITE8
(
_pAd
, 
_bbpID
, 
_pV
, 
_bVMCU
) \

608 
BBP_CSR_CFG_STRUC
 
BbpC
; \

609 
k
, 
_busyC
=0, 
_gID
; \

610 
BOOLEAN
 
brc
; \

611 
_gID
 = ((
_bVMCU
=
TRUE
 ? 
H2M_BBP_AGENT
 : 
BBP_CSR_CFG
); \

612 i(((
_pAd
)->
bPCIkOff
 =
FALSE
) \

613 && ((
_pAd
)->
b30xxBMcuCmd
 =
FALSE
)) \

615 i(
_pAd
->
AcssBBPFaCou
 > 20) \

617 
	`AsicRetBBPAgt
(
_pAd
); \

618 
_pAd
->
AcssBBPFaCou
 = 0; \

620 
_busyC
=0; _busyC<
MAX_BUSY_COUNT
; _busyCnt++) \

622 
	`RTMP_IO_READ32
((
_pAd
), 
_gID
, &
BbpC
.
wd
); \

623 i((
BbpC
.
fld
.
Busy
 =
BUSY
|| (
_busyC
 % 10 == 0)) \

625 
BbpC
.
fld
.
Busy
 = 
IDLE
; \

626 
	`RTMP_IO_WRITE32
(
_pAd
, 
H2M_BBP_AGENT
, 
BbpC
.
wd
); \

629 
BbpC
.
wd
 = 0; \

630 
BbpC
.
fld
.
fRd
 = 0; \

631 
BbpC
.
fld
.
BBP_RW_MODE
 = 1; \

632 
BbpC
.
fld
.
Busy
 = 1; \

633 
BbpC
.
fld
.
Vue
 = 
_pV
; \

634 
BbpC
.
fld
.
RegNum
 = 
_bbpID
; \

635 
	`RTMP_IO_WRITE32
((
_pAd
), 
_gID
, 
BbpC
.
wd
); \

636 i((
_bVMCU
=
TRUE
) \

638 
brc
 =
	`AsicSdCommdToMcu
(
_pAd
, 0x80, 0xff, 0x0, 0x0); \

639 i((
_pAd
)->
OpMode
 =
OPMODE_AP
) \

640 
	`RTMPucDay
(1000); \

642 i(
brc
 =
TRUE
) \

644 
k
=0; k<
MAX_BUSY_COUNT
; k++) \

646 
BbpC
.
fld
.
Busy
 = 
BUSY
; \

647 
	`RTMP_IO_READ32
(
_pAd
, 
H2M_BBP_AGENT
, &
BbpC
.
wd
); \

648 i(
BbpC
.
fld
.
Busy
 =
IDLE
) \

651 i((
BbpC
.
fld
.
Busy
 =
BUSY
)) \

653 
	`DBGPRINT_ERR
(("Check BBP wrR%d=0x%x fa\n", 
_bbpID
, 
BbpC
.
wd
)); \

655 (
_pAd
)->
BbpWreLch
[
_bbpID
] = 
_pV
; \

659 
BbpC
.
fld
.
Busy
 = 0; \

660 
	`RTMP_IO_WRITE32
(
_pAd
, 
_gID
, 
BbpC
.
wd
); \

667 
	`DBGPRINT_ERR
((" b30xxBMcuCmd = %d. WrBBP %d \n", (
_pAd
)->
b30xxBMcuCmd
, (
_gID
))); \

669 i((
_busyC
 =
MAX_BUSY_COUNT
|| ((
_pAd
)->
bPCIkOff
 =
TRUE
)) \

671 i(
_busyC
 =
MAX_BUSY_COUNT
) \

672 (
_pAd
)->
AcssBBPFaCou
++; \

673 
	`DBGPRINT_ERR
(("BBP wrR%d=0x%x fa. BusyC%d.bPCIkOf%d. \n", 
_gID
, 
BbpC
.
wd
, 
_busyC
, (
_pAd
)->
bPCIkOff
 )); \

675 }0)

	)

677 
	#RTMP_PCIE_PS_L3_BBP_IO_WRITE8
(
_pAd
, 
_bbpID
, 
_pV
, 
_bVMCU
)

	)

680 
	#_RTMP_BBP_IO_WRITE8
(
_pAd
, 
_bbpID
, 
_pV
, 
_bVMCU
) \

682 
BBP_CSR_CFG_STRUC
 
BbpC
; \

683 
_busyC
=0, 
_gID
; \

684 
BOOLEAN
 
brc
; \

686 
_gID
 = ((
_bVMCU
=
TRUE
 ? 
H2M_BBP_AGENT
 : 
BBP_CSR_CFG
); \

687 
_busyC
=0; _busyC<
MAX_BUSY_COUNT
; _busyCnt++) \

689 
	`RTMP_IO_READ32
((
_pAd
), 
_gID
, &
BbpC
.
wd
); \

690 i(
BbpC
.
fld
.
Busy
 =
BUSY
) \

692 i((
_bVMCU
=
TRUE
&& ((
_busyC
 % 20) == 0)) \

694 
BbpC
.
fld
.
Busy
 = 
IDLE
;\

695 
	`RTMP_IO_WRITE32
(
_pAd
, 
H2M_BBP_AGENT
, 
BbpC
.
wd
);\

699 
BbpC
.
wd
 = 0; \

700 
BbpC
.
fld
.
fRd
 = 0; \

701 
BbpC
.
fld
.
BBP_RW_MODE
 = 1; \

702 
BbpC
.
fld
.
Busy
 = 1; \

703 
BbpC
.
fld
.
Vue
 = 
_pV
; \

704 
BbpC
.
fld
.
RegNum
 = 
_bbpID
; \

705 
	`RTMP_IO_WRITE32
((
_pAd
), 
_gID
, 
BbpC
.
wd
); \

706 i((
_bVMCU
=
TRUE
) \

708 
brc
 = 
	`AsicSdCommdToMcu
(
_pAd
, 0x80, 0xff, 0x0, 0x0); \

709 i((
_pAd
)->
OpMode
 =
OPMODE_AP
) \

710 
	`RTMPucDay
(1000); \

711 i(
brc
 =
FALSE
) \

713 
BbpC
.
fld
.
Busy
 = 
IDLE
; \

714 
	`RTMP_IO_WRITE32
((
_pAd
), 
H2M_BBP_AGENT
, 
BbpC
.
wd
); \

717 (
_pAd
)->
BbpWreLch
[
_bbpID
] = 
_pV
; \

720 i(
_busyC
 =
MAX_BUSY_COUNT
) \

722 
	`DBGPRINT_ERR
(("BBP wrR%d fa\n", 
_bbpID
)); \

723 if((
_bVMCU
=
TRUE
) \

725 
	`RTMP_IO_READ32
(
_pAd
, 
H2M_BBP_AGENT
, &
BbpC
.
wd
); \

726 
BbpC
.
fld
.
Busy
 = 0; \

727 
	`RTMP_IO_WRITE32
(
_pAd
, 
H2M_BBP_AGENT
, 
BbpC
.
wd
); \

730 }0)

	)

736 
	#BBP_IO_WRITE8_BY_REG_ID
(
_A
, 
_I
, 
_pV
) \

737 
	`RTMP_BBP_IO_WRITE8
((
_A
), (
_I
), (
_pV
), 
FALSE
)

	)

744 
	#_RTMP_BBP_IO_WRITE8_BY_REG_ID
(
_A
, 
_I
, 
_pV
) \

746 i((
_A
)->
bPCIkOff
 =
FALSE
) \

748 i((
_A
)->
fTy
 =
RTMP_DEV_INF_RBUS
) \

749 
	`RTMP_BBP_IO_WRITE8
((
_A
), (
_I
), (
_pV
), 
FALSE
); \

751 if(
	`IS_SUPPORT_PCIE_PS_L3
((
_A
))) \

752 
	`RTMP_PCIE_PS_L3_BBP_IO_WRITE8
((
_A
), (
_I
), (
_pV
), 
TRUE
); \

754 
	`RTMP_BBP_IO_WRITE8
((
_A
), (
_I
), (
_pV
), 
TRUE
); \

756 }0)

	)

758 #ide
VENDOR_FEATURE3_SUPPORT


759 
	#RTMP_BBP_IO_READ8
 
_RTMP_BBP_IO_READ8


	)

760 
	#RTMP_BBP_IO_READ8_BY_REG_ID
 
_RTMP_BBP_IO_READ8_BY_REG_ID


	)

761 
	#RTMP_BBP_IO_WRITE8
 
_RTMP_BBP_IO_WRITE8


	)

762 
	#RTMP_BBP_IO_WRITE8_BY_REG_ID
 
_RTMP_BBP_IO_WRITE8_BY_REG_ID


	)

	@include/chlist.h

38 #ide
__CHLIST_H__


39 
	#__CHLIST_H__


	)

41 
	~"mp_ty.h
"

42 
	~"mp_def.h
"

44 
	#BAND_5G
 0

	)

45 
	#BAND_24G
 1

	)

46 
	#BAND_BOTH
 2

	)

48 #ifde
EXT_BUILD_CHANNEL_LIST


49 
	#ODOR
 0

	)

50 
	#IDOR
 1

	)

51 
	#BOTH
 2

	)

53 
	s_CH_DESP
 {

54 
UCHAR
 
	mFChl
;

55 
UCHAR
 
	mNumOfCh
;

56 
CHAR
 
	mMaxTxPwr
;

57 
UCHAR
 
	mGeogphy
;

58 
BOOLEAN
 
	mDfsReq
;

59 } 
	tCH_DESP
, *
	tPCH_DESP
;

61 
	s_CH_REGION
 {

62 
UCHAR
 
	mCouReg
[3];

63 
UCHAR
 
	mDfsTy
;

64 
CH_DESP
 
	mChDe
[10];

65 } 
	tCH_REGION
, *
	tPCH_REGION
;

67 
CH_REGION
 
ChRegi
[];

70 
	s_CH_FREQ_MAP_
{

71 
UINT16
 
	mchl
;

72 
UINT16
 
	meqKHz
;

73 }
	tCH_FREQ_MAP
;

75 
CH_FREQ_MAP
 
CH_HZ_ID_MAP
[];

76 
CH_HZ_ID_MAP_NUM
;

81 
	#MAP_CHANNEL_ID_TO_KHZ
(
_ch
, 
_khz
) \

82 
	`RTMP_MChlID2KHZ
(
_ch
, (
UINT32
 *)&(
_khz
))

	)

83 
	#MAP_KHZ_TO_CHANNEL_ID
(
_khz
, 
_ch
) \

84 
	`RTMP_MKHZ2ChlID
(
_khz
, (
INT
 *)&(
_ch
))

	)

87 #ifde
EXT_BUILD_CHANNEL_LIST


88 
VOID
 
BudChlLiEx
(

89 
IN
 
PRTMP_ADAPTER
 
pAd
);

91 
VOID
 
BudBcChLi
(

92 
IN
 
PRTMP_ADAPTER
 
pAd
,

93 
OUT
 
PUCHAR
 
pBuf
,

94 
OUT
 
PULONG
 
pBufL
);

97 #ifde
DOT11_N_SUPPORT


98 
VOID
 
N_ChlCheck
(

99 
IN
 
PRTMP_ADAPTER
 
pAd
);

101 
VOID
 
N_SCCh
(

102 
IN
 
PRTMP_ADAPTER
 
pAd
);

105 
UINT8
 
GCuryMaxTxPwr
(

106 
IN
 
PRTMP_ADAPTER
 
pAd
,

107 
IN
 
UINT8
 
chl
);

109 
VOID
 
RTMP_MChlID2KHZ
(

110 
IN
 
UCHAR
 
Ch
,

111 
OUT
 
UINT32
 *
pFq
);

113 
VOID
 
RTMP_MKHZ2ChlID
(

114 
IN
 
ULONG
 
Fq
,

115 
OUT
 
INT
 *
pCh
);

	@include/client_wds.h

33 #ide
__CLIENT_WDS_H__


34 
	#__CLIENT_WDS_H__


	)

36 
	~"_wds_cmm.h
"

38 
VOID
 
CliWds_ProxyTabIn
(

39 
IN
 
PRTMP_ADAPTER
 
pAd
);

41 
VOID
 
CliWds_ProxyTabDey
(

42 
IN
 
PRTMP_ADAPTER
 
pAd
);

44 
PCLIWDS_PROXY_ENTRY
 
CliWdsEyAoc
(

45 
IN
 
PRTMP_ADAPTER
 
pAd
);

48 
VOID
 
CliWdsEyFe
(

49 
IN
 
PRTMP_ADAPTER
 
pAd
,

50 
IN
 
PCLIWDS_PROXY_ENTRY
 
pCliWdsEry
);

53 
PUCHAR
 
CliWds_ProxyLookup
(

54 
IN
 
PRTMP_ADAPTER
 
pAd
,

55 
IN
 
PUCHAR
 
pMac
);

58 
VOID
 
CliWds_ProxyTabUpde
(

59 
IN
 
PRTMP_ADAPTER
 
pAd
,

60 
IN
 
SHORT
 
Aid
,

61 
IN
 
PUCHAR
 
pMac
);

64 
VOID
 
CliWds_ProxyTabMa
(

65 
IN
 
PRTMP_ADAPTER
 
pAd
);

	@include/client_wds_cmm.h

33 #ide
__CLIENT_WDS_CMM_H__


34 
	#__CLIENT_WDS_CMM_H__


	)

36 
	~"mp_def.h
"

38 #ifde
CLIENT_WDS


41 
	#CLI_WDS_ENTRY_AGEOUT
 5000

	)

43 
	#CLIWDS_POOL_SIZE
 128

	)

44 
	#CLIWDS_HASH_TAB_SIZE
 64

	)

45 
	s_CLIWDS_PROXY_ENTRY
 {

46 
_CLIWDS_PROXY_ENTRY
 * 
	mpNext
;

47 
ULONG
 
	mLaRefTime
;

48 
SHORT
 
	mAid
;

49 
UCHAR
 
	mAddr
[
MAC_ADDR_LEN
];

50 } 
	tCLIWDS_PROXY_ENTRY
, *
	tPCLIWDS_PROXY_ENTRY
;

	@include/crypt_aes.h

28 #ide
__CRYPT_AES_H__


29 
	#__CRYPT_AES_H__


	)

31 
	~"_cfig.h
"

43 
	#GETU32
(
p

	`u2be32
(
	`g_uligd
((
u32
 *)))

	)

44 
	#PUTU32
(

, 


	`put_uligd
(
	`u2be32
(), (
u32
*)(ct))

45 

	)

46 
	#AES_ENCRYPT
 1

	)

47 
	#AES_DECRYPT
 0

	)

51 
	#AES_MAXNR
 14

	)

52 
	#AES_BLOCK_SIZE
 16

	)

55 
	ss_key_
 {

56 #ifde
AES_LONG


57 
	mrd_key
[4 *(
AES_MAXNR
 + 1)];

59 
	mrd_key
[4 *(
AES_MAXNR
 + 1)];

61 
	mrounds
;

63 
s_key_
 
	tAES_KEY
;

65 
	s_EVP_CIPHER_CTX_
 {

66 
	mag
;

67 
	mty
;

68 
	my
;

69 
	mkey
[16];

70 
	miv
[8 + 16];

71 
	mbuf㾒
;

72 
	mbufr
[
AES_BLOCK_SIZE
];

73 
AES_KEY
 
	msKey
;

74 } 
	tEVP_CIPHER_CTX
, *
	tPEVP_CIPHER_CTX
;

76 
evp_s_y
(cڡ *

, *
out
, cڡ 
AES_KEY
 *
key
);

77 
evp_s_dey
(cڡ *

, *
out
, cڡ 
AES_KEY
 *
key
);

78 
AES_t_y_key
(cڡ *
urKey
, cڡ 
bs
, 
AES_KEY
 *
key
);

79 
AES_t_dey_key
(cڡ *
urKey
, cڡ 
bs
, 
AES_KEY
 *
key
);

80 
EVP_s_128_cbc
();

81 
EVP_EnyIn
(
EVP_CIPHER_CTX
 *
x
, 
ty
, *
key
, *
iv
);

82 
EVP_EnyUpde
(
EVP_CIPHER_CTX
 *
x
, *
outbuf
, *
ou
, *
buf
, 
n
);

83 
EVP_EnyF
(
EVP_CIPHER_CTX
 *
x
, *
outbuf
, *
ou
);

84 
EVP_DeyIn
(
EVP_CIPHER_CTX
 *
x
, 
ty
, *
key
, *
iv
);

85 
EVP_DeyUpde
(
EVP_CIPHER_CTX
 *
x
, *
outbuf
, *
ou
, *
buf
, 
n
);

86 
EVP_DeyF
(
EVP_CIPHER_CTX
 *
x
, *
outbuf
, *
ou
);

87 
evp_s_cbc_y
(cڡ *

, *
out
,

88 cڡ 
ngth
, cڡ 
AES_KEY
 *
key
,

89 *
ivec
, cڡ 
c
);

91 
WscEnyDa
(

92 *
aText
, 
x_n
,

93 *
key
, *
iv
,

94 *
chText
, *
x_n
);

96 
WscDeyDa
(

97 *
chText
, 
x_n
,

98 *
key
, *
iv
,

99 *
aText
, *
x_n
);

101 
	#AES_CBC_Eny
(
PϚ
, 
PϚL
, 
Key
, 
KeyL
, 
IV
, 
IVL
, 
Ch
, 
ChL
\

	)

102 
WscEnyDa
((
PϚ
), (
PϚL
), (
Key
), (
IV
), (
Ch
), (*(
ChL
));

104 
	#AES_CBC_Dey
(
Ch
, 
ChL
, 
Key
, 
KeyL
, 
IV
, 
IVL
, 
PϚ
, 
PϚL
\

	)

105 
WscDeyDa
((
Ch
), (
ChL
), (
Key
), (
IV
), (
PϚ
), (*(
PϚL
));

109 
ut32
 
	mk
[64];

110 
ut32
 
	mdrk
[64];

111 
	m
;

113 
	ts_cڋxt
;

115 
mp_s_t_key

s_cڋxt
 *
x
, 
ut8
 *
key
, 
nbs
 );

116 
mp_s_y

s_cڋxt
 *
x
, 
ut8
 
put
[16], ut8 
ouut
[16] );

117 
mp_s_dey

s_cڋxt
 *
x
, 
ut8
 
put
[16], ut8 
ouut
[16] );

119 
VOID
 
AES_GTK_KEY_WRAP
(

120 
IN
 
UCHAR
 *
key
,

121 
IN
 
UCHAR
 *
axt
,

122 
IN
 
UINT
 
p_n
,

123 
OUT
 
UCHAR
 *
chxt
,

124 
OUT
 
UINT
 *
c_n
);

126 
VOID
 
AES_GTK_KEY_UNWRAP
(

127 
IN
 
UCHAR
 *
key
,

128 
OUT
 
UCHAR
 *
axt
,

129 
OUT
 
UINT
 *
p_n
,

130 
IN
 
UCHAR
 *
chxt
,

131 
IN
 
UINT
 
c_n
);

133 
	#AES_Key_Wp
(
PϚ
, 
PϚL
, 
Key
, 
KeyL
, 
Ch
, 
ChL
\

	)

134 
AES_GTK_KEY_WRAP
((
Key
), (
PϚ
), (
PϚL
), (
Ch
), (
ChL
))

136 
	#AES_Key_Unwp
(
Ch
, 
ChL
, 
Key
, 
KeyL
, 
PϚ
, 
PϚL
\

	)

137 
AES_GTK_KEY_UNWRAP
((
Key
), (
PϚ
), (
PϚL
), (
Ch
), (
ChL
))

140 
	#AES_STATE_ROWS
 4

	)

141 
	#AES_STATE_COLUMNS
 4

	)

142 
	#AES_BLOCK_SIZES
 
AES_STATE_ROWS
*
AES_STATE_COLUMNS


	)

143 
	#AES_KEY_ROWS
 4

	)

144 
	#AES_KEY_COLUMNS
 8

	)

145 
	#AES_KEY128_LENGTH
 16

	)

146 
	#AES_KEY192_LENGTH
 24

	)

147 
	#AES_KEY256_LENGTH
 32

	)

148 
	#AES_CBC_IV_LENGTH
 16

	)

151 
UINT8
 
	mS
[
AES_STATE_ROWS
][
AES_STATE_COLUMNS
];

152 
UINT8
 
	mKeyWdExnsi
[
AES_KEY_ROWS
][AES_KEY_ROWS*((
AES_KEY256_LENGTH
 >> 2) + 6 + 1)];

153 } 
	tAES_CTX_STRUC
, *
	tPAES_CTX_STRUC
;

157 
VOID
 
RT_AES_KeyExnsi
 (

158 
IN
 
UINT8
 
Key
[],

159 
IN
 
UINT
 
KeyLgth
,

160 
INOUT
 
AES_CTX_STRUC
 *
es_x
);

162 
VOID
 
RT_AES_Eny
 (

163 
IN
 
UINT8
 
PϚBlock
[],

164 
IN
 
UINT
 
PϚBlockSize
,

165 
IN
 
UINT8
 
Key
[],

166 
IN
 
UINT
 
KeyLgth
,

167 
OUT
 
UINT8
 
ChBlock
[],

168 
INOUT
 
UINT
 *
ChBlockSize
);

170 
VOID
 
RT_AES_Dey
 (

171 
IN
 
UINT8
 
ChBlock
[],

172 
IN
 
UINT
 
ChBlockSize
,

173 
IN
 
UINT8
 
Key
[],

174 
IN
 
UINT
 
KeyLgth
,

175 
OUT
 
UINT8
 
PϚBlock
[],

176 
INOUT
 
UINT
 *
PϚBlockSize
);

179 
VOID
 
AES_CCM_MAC
 (

180 
IN
 
UINT8
 
Payld
[],

181 
IN
 
UINT
 
PayldLgth
,

182 
IN
 
UINT8
 
Key
[],

183 
IN
 
UINT
 
KeyLgth
,

184 
IN
 
UINT8
 
N
[],

185 
IN
 
UINT
 
NLgth
,

186 
IN
 
UINT8
 
AAD
[],

187 
IN
 
UINT
 
AADLgth
,

188 
IN
 
UINT
 
MACLgth
,

189 
OUT
 
UINT8
 
MACText
[]);

191 
INT
 
AES_CCM_Eny
 (

192 
IN
 
UINT8
 
PϚText
[],

193 
IN
 
UINT
 
PϚTextLgth
,

194 
IN
 
UINT8
 
Key
[],

195 
IN
 
UINT
 
KeyLgth
,

196 
IN
 
UINT8
 
N
[],

197 
IN
 
UINT
 
NLgth
,

198 
IN
 
UINT8
 
AAD
[],

199 
IN
 
UINT
 
AADLgth
,

200 
IN
 
UINT
 
MACLgth
,

201 
OUT
 
UINT8
 
ChText
[],

202 
INOUT
 
UINT
 *
ChTextLgth
);

204 
INT
 
AES_CCM_Dey
 (

205 
IN
 
UINT8
 
ChText
[],

206 
IN
 
UINT
 
ChTextLgth
,

207 
IN
 
UINT8
 
Key
[],

208 
IN
 
UINT
 
KeyLgth
,

209 
IN
 
UINT8
 
N
[],

210 
IN
 
UINT
 
NLgth
,

211 
IN
 
UINT8
 
AAD
[],

212 
IN
 
UINT
 
AADLgth
,

213 
IN
 
UINT
 
MACLgth
,

214 
OUT
 
UINT8
 
PϚText
[],

215 
INOUT
 
UINT
 *
PϚTextLgth
);

218 
VOID
 
AES_CMAC_GeSubKey
 (

219 
IN
 
UINT8
 
Key
[],

220 
IN
 
UINT
 
KeyLgth
,

221 
OUT
 
UINT8
 
SubKey1
[],

222 
OUT
 
UINT8
 
SubKey2
[]);

224 
VOID
 
AES_CMAC
 (

225 
IN
 
UINT8
 
PϚText
[],

226 
IN
 
UINT
 
PϚTextLgth
,

227 
IN
 
UINT8
 
Key
[],

228 
IN
 
UINT
 
KeyLgth
,

229 
OUT
 
UINT8
 
MACText
[],

230 
INOUT
 
UINT
 *
MACTextLgth
);

	@include/crypt_arc4.h

40 #ide
__CRYPT_ARC4_H__


41 
	#__CRYPT_ARC4_H__


	)

43 
	~"_cfig.h
"

46 
	#ARC4_KEY_BLOCK_SIZE
 256

	)

49 
UINT
 
	mBlockIndex1
;

50 
UINT
 
	mBlockIndex2
;

51 
UINT8
 
	mKeyBlock
[256];

52 } 
	tARC4_CTX_STRUC
, *
	tPARC4_CTX_STRUC
;

56 
VOID
 
ARC4_INIT
 (

57 
IN
 
ARC4_CTX_STRUC
 *
pARC4_CTX
,

58 
IN
 
PUCHAR
 
pKey
,

59 
IN
 
UINT
 
KeyLgth
);

61 
VOID
 
ARC4_Compu
 (

62 
IN
 
ARC4_CTX_STRUC
 *
pARC4_CTX
,

63 
IN
 
UINT8
 
IutBlock
[],

64 
IN
 
UINT
 
IutBlockSize
,

65 
OUT
 
UINT8
 
OuutBlock
[]);

67 
VOID
 
ARC4_Disrd_KeyLgth
 (

68 
IN
 
ARC4_CTX_STRUC
 *
pARC4_CTX
,

69 
IN
 
UINT
 
Lgth
);

	@include/crypt_hmac.h

16 #ide
__CRYPT_HMAC_H__


17 
	#__CRYPT_HMAC_H__


	)

19 
	~"_cfig.h
"

22 #i
defed
(
__lulus
)

27 
	#USE_SHA256


	)

29 #i!
defed
(
USE_SHA1
&& !defed(
USE_SHA256
)

30 #r 
defe
 
USE_SHA1
 

 
USE_SHA256
 
to
 
t
 
the
 
HMAC
 
hash
 
gܙhm


33 #ifde
USE_SHA1


34 
	#HASH_INPUT_SIZE
 
SHA1_BLOCK_SIZE


	)

35 
	#HASH_OUTPUT_SIZE
 
SHA1_DIGEST_SIZE


	)

36 
	#sha_x
 
sha1_x


	)

37 
	#sha_beg
 
sha1_beg


	)

38 
	#sha_hash
 
sha1_hash


	)

39 
	#sha_d
 
sha1_d


	)

42 #ifde
USE_SHA256


43 
	#HASH_INPUT_SIZE
 
SHA256_BLOCK_SIZE


	)

44 
	#HASH_OUTPUT_SIZE
 
SHA256_DIGEST_SIZE


	)

45 
	#sha_x
 
sha256_x


	)

46 
	#sha_beg
 
sha256_beg


	)

47 
	#sha_hash
 
sha256_hash


	)

48 
	#sha_d
 
sha256_d


	)

51 
	#HMAC_OK
 0

	)

52 
	#HMAC_BAD_MODE
 -1

	)

53 
	#HMAC_IN_DATA
 0xffffffff

	)

56 { 
key
[
HASH_INPUT_SIZE
];

57 
sha_x
 
x
[1];

58 
kn
;

59 } 
	thmac_x
;

61 
hmac_sha_beg
(
hmac_x
 
cx
[1]);

62 
hmac_sha_key
(cڡ 
key
[], 
key_n
, 
hmac_x
 
cx
[1]);

63 
hmac_sha_da
(cڡ 
da
[], 
da_n
, 
hmac_x
 
cx
[1]);

64 
hmac_sha_d
(
mac
[], 
mac_n
, 
hmac_x
 
cx
[1]);

65 
hmac_sha
(cڡ 
key
[], 
key_n
,

66 cڡ 
da
[], 
da_n
,

67 
mac
[], 
mac_n
);

69 
	#RT_HMAC_SHA256
(
Key
, 
KeyL
, 
Da
, 
DaL
, 
Mac
, 
MacL
) \

70 
	`hmac_sha
((
Key
), (
KeyL
), (
Da
), (
DaL
), (
Mac
), (
MacL
))

	)

72 #i
defed
(
__lulus
)

	@include/crypt_md5.h

29 #ide
__CRYPT_MD5_H__


30 
	#__CRYPT_MD5_H__


	)

33 #idef 
ut8


34 
	#ut8
 

	)

37 #idef 
ut32


38 
	#ut32
 

	)

41 
	#MD5_MAC_LEN
 16

	)

43 
	s_MD5_CTX
 {

44 
ULONG
 
	mBuf
[4];

45 
UCHAR
 
	mIut
[64];

46 
ULONG
 
	mLInBCou
[2];

47 } 
	tMD5_CTX
;

49 
VOID
 
MD5In
(
MD5_CTX
 *
pCtx
);

50 
VOID
 
MD5Upde
(
MD5_CTX
 *
pCtx
, 
UCHAR
 *
pDa
, 
ULONG
 
LInBys
);

51 
VOID
 
MD5F
(
UCHAR
 
Dige
[16], 
MD5_CTX
 *
pCtx
);

52 
VOID
 
MD5Tnsfm
(
ULONG
 
Buf
[4], ULONG 
Mes
[16]);

54 
md5_mac
(
u8
 *
key
, 
size_t
 
key_n
, u8 *
da
, size_
da_n
, u8 *
mac
);

55 
hmac_md5
(
u8
 *
key
, 
size_t
 
key_n
, u8 *
da
, size_
da_n
, u8 *
mac
);

60 
	s_SHA_CTX


62 
ULONG
 
	mBuf
[5];

63 
UCHAR
 
	mIut
[80];

64 
ULONG
 
	mLInBCou
[2];

66 } 
	tSHA_CTX
;

68 
VOID
 
SHAIn
(
SHA_CTX
 *
pCtx
);

69 
UCHAR
 
SHAUpde
(
SHA_CTX
 *
pCtx
, UCHAR *
pDa
, 
ULONG
 
LInBys
);

70 
VOID
 
SHAF
(
SHA_CTX
 *
pCtx
, 
UCHAR
 
Dige
[20]);

71 
VOID
 
SHATnsfm
(
ULONG
 
Buf
[5], ULONG 
Mes
[20]);

73 
	#SHA_DIGEST_LEN
 20

	)

75 
VOID
 
HMAC_SHA1
(

76 
IN
 
UCHAR
 *
xt
,

77 
IN
 
UINT
 
xt_n
,

78 
IN
 
UCHAR
 *
key
,

79 
IN
 
UINT
 
key_n
,

80 
IN
 
UCHAR
 *
dige
);

82 
	#RT_HMAC_MD5
(
Key
, 
KeyL
, 
Meg
, 
MegL
, 
MAC
, 
MACL
) \

83 
	`hmac_md5
((
Key
), (
KeyL
), (
Meg
), (
MegL
), (
MAC
))

	)

85 
	#RT_HMAC_SHA1
(
Key
, 
KeyL
, 
Meg
, 
MegL
, 
MAC
, 
MACL
) \

86 
	`HMAC_SHA1
((
Meg
), (
MegL
), (
Key
), (
KeyL
), (
MAC
))

	)

	@include/crypt_sha2.h

29 #ide
__CRYPT_SHA2_H__


30 
	#__CRYPT_SHA2_H__


	)

33 
	#EXIT_SUCCESS
 0

	)

34 
	#EXIT_FAILURE
 1

	)

36 
	tut_8t
;

37 
	tut_16t
;

38 
	tut_32t
;

39 
	tut_64t
;

41 
	#void_t
 

	)

42 
	#t_t
 

	)

46 
	#SHA_2


	)

47 
	#SHA_224


	)

48 
	#SHA_256


	)

51 #i
defed
(
__lulus
)

63 
	#SHA1_BLOCK_SIZE
 64

	)

64 
	#SHA1_DIGEST_SIZE
 20

	)

65 
	#SHA224_DIGEST_SIZE
 28

	)

66 
	#SHA224_BLOCK_SIZE
 64

	)

67 
	#SHA256_DIGEST_SIZE
 32

	)

68 
	#SHA256_BLOCK_SIZE
 64

	)

73 { 
ut_32t
 
cou
[2];

74 
ut_32t
 
hash
[8];

75 
ut_32t
 
wbuf
[16];

76 } 
	tsha256_x
;

78 
sha256_x
 
	tsha224_x
;

80 
void_t
 
sha256_compe
(
sha256_x
 
x
[1]);

82 
void_t
 
sha224_beg
(
sha224_x
 
x
[1]);

83 
	#sha224_hash
 
sha256_hash


	)

84 
void_t
 
sha224_d
(
hv
[], 
sha224_x
 
x
[1]);

85 
void_t
 
sha224
(
hv
[], cڡ 
da
[], 
n
);

87 
void_t
 
sha256_beg
(
sha256_x
 
x
[1]);

88 
void_t
 
sha256_hash
(cڡ 
da
[], 
n
, 
sha256_x
 
x
[1]);

89 
void_t
 
sha256_d
(
hv
[], 
sha256_x
 
x
[1]);

90 
void_t
 
sha256
(
hv
[], cڡ 
da
[], 
n
);

93 #ide
SHA_64BIT


97 { 
sha256_x
 
x256
[1];

98 } 
uu
[1];

99 
ut_32t
 
sha2_n
;

100 } 
	tsha2_x
;

102 
	#SHA2_MAX_DIGEST_SIZE
 
SHA256_DIGEST_SIZE


	)

106 
	#SHA384_DIGEST_SIZE
 48

	)

107 
	#SHA384_BLOCK_SIZE
 128

	)

108 
	#SHA512_DIGEST_SIZE
 64

	)

109 
	#SHA512_BLOCK_SIZE
 128

	)

110 
	#SHA2_MAX_DIGEST_SIZE
 
SHA512_DIGEST_SIZE


	)

115 { 
ut_64t
 
cou
[2];

116 
ut_64t
 
hash
[8];

117 
ut_64t
 
wbuf
[16];

118 } 
	tsha512_x
;

120 
sha512_x
 
	tsha384_x
;

124 { 
sha256_x
 
x256
[1];

125 
sha512_x
 
x512
[1];

126 } 
uu
[1];

127 
ut_32t
 
sha2_n
;

128 } 
	tsha2_x
;

130 
void_t
 
sha512_compe
(
sha512_x
 
x
[1]);

132 
void_t
 
sha384_beg
(
sha384_x
 
x
[1]);

133 
	#sha384_hash
 
sha512_hash


	)

134 
void_t
 
sha384_d
(
hv
[], 
sha384_x
 
x
[1]);

135 
void_t
 
sha384
(
hv
[], cڡ 
da
[], 
n
);

137 
void_t
 
sha512_beg
(
sha512_x
 
x
[1]);

138 
void_t
 
sha512_hash
(cڡ 
da
[], 
n
, 
sha512_x
 
x
[1]);

139 
void_t
 
sha512_d
(
hv
[], 
sha512_x
 
x
[1]);

140 
void_t
 
sha512
(
hv
[], cڡ 
da
[], 
n
);

142 
t_t
 
sha2_beg
(
size
, 
sha2_x
 
x
[1]);

143 
void_t
 
sha2_hash
(cڡ 
da
[], 
n
, 
sha2_x
 
x
[1]);

144 
void_t
 
sha2_d
(
hv
[], 
sha2_x
 
x
[1]);

145 
t_t
 
sha2
(
hv
[], 
size
, cڡ 
da
[], 
n
);

148 
	#RT_SHA256
(
Mesge
, 
MesgeL
, 
DMesge
) \

149 
	`sha256
((
DMesge
), (
Mesge
), (
MesgeL
));

	)

152 #i
defed
(
__lulus
)

	@include/dfs.h

39 
	#RADAR_PULSE
 1

	)

40 
	#RADAR_WIDTH
 2

	)

42 
	#WIDTH_RD_IDLE
 0

	)

43 
	#WIDTH_RD_CHECK
 1

	)

56 
	#FREE_FOR_TX
 0

	)

57 
	#WAIT_CTS_BEING_SENT
 1

	)

58 
	#DO_DETECTION
 2

	)

61 
	#RADAR_EVENT_CTS_SENT
 0x01

62 
	#RADAR_EVENT_CTS_CARRIER_SENT
 0x02

63 
	#RADAR_EVENT_RADAR_DETECTING
 0x04

64 
	#RADAR_EVENT_CARRIER_DETECTING
 0x08

65 
	#RADAR_EVENT_WIDTH_RADAR
 0x10

66 
	#RADAR_EVENT_CTS_KICKED
 0x20

67 

	)

69 
	#DETECTION_STOP
 0

	)

70 
	#RADAR_DETECTION
 1

	)

71 
	#CARRIER_DETECTION
 2

	)

73 #i
defed
(
RTMP_RBUS_SUPPORT
|| defed(
DFS_INTERRUPT_SUPPORT
)

74 
	#RADAR_GPIO_DEBUG
 0x01

75 
	#RADAR_SIMULATE
 0x02

76 
	#RADAR_SIMULATE2
 0x04

77 
	#RADAR_LOG
 0x08

78 

	)

80 
	#RADAR_DONT_SWITCH
 0x10

81 

	)

82 #ifde
DFS_HARDWARE_SUPPORT


84 
	#RADAR_DEBUG_EVENT
 0x01

85 
	#RADAR_DEBUG_FLAG_1
 0x02

	)

86 
	#RADAR_DEBUG_FLAG_2
 0x04

	)

87 
	#RADAR_DEBUG_FLAG_3
 0x08

	)

88 
	#RADAR_DEBUG_SILENCE
 0x4

	)

89 
	#RADAR_DEBUG_SW_SILENCE
 0x8

	)

92 #ifde
DFS_HARDWARE_SUPPORT


93 
VOID
 
NewRadDeiS
(

94 
IN
 
PRTMP_ADAPTER
 
pAd
);

96 
VOID
 
NewRadDeiSt
(

97 
IN
 
PRTMP_ADAPTER
 
pAd
);

99 
modify_b1
(

100 
IN
 
PRTMP_ADAPTER
 
pAd
,

101 
IN
 
ULONG
 
idx
,

102 
IN
 
ULONG
 
vue
);

104 
modify_b2
(

105 
IN
 
PRTMP_ADAPTER
 
pAd
,

106 
IN
 
ULONG
 
idx
,

107 
IN
 
ULONG
 
vue
);

110 
VOID
 
NewTimCB_Rad
(

111 
IN
 
PRTMP_ADAPTER
 
pAd
);

113 
schedu_dfs_sk
(

114 
IN
 
PRTMP_ADAPTER
 
pAd
);

122 
MCURadDe
(
PRTMP_ADAPTER
 
pAd
);

124 #ifde
TONE_RADAR_DETECT_SUPPORT


125 
RTMPHdRadIru
(
PRTMP_ADAPTER
 
pAd
);

128 #ifde
DFS_HARDWARE_SUPPORT


129 #i
defed
 (
RTMP_RBUS_SUPPORT
|| defed(
DFS_INTERRUPT_SUPPORT
)

130 
RTMPHdRadIru
(
PRTMP_ADAPTER
 
pAd
);

135 #ifde
TONE_RADAR_DETECT_SUPPORT


136 
INT
 
S_CrrCr_Proc
(
IN
 
PRTMP_ADAPTER
 
pAd
, IN 
PSTRING
 
g
);

137 
S_CrrReCheck_Proc
(
IN
 
PRTMP_ADAPTER
 
pAd
, IN 
PSTRING
 
g
);

138 
INT
 
S_CrrStCheck_Proc
(
IN
 
PRTMP_ADAPTER
 
pAd
, IN 
PSTRING
 
g
);

139 
NewCrrDeiS
(
PRTMP_ADAPTER
 
pAd
);

142 #ifde
DFS_SOFTWARE_SUPPORT


143 
VOID
 
BbpRadDeiS
(

144 
IN
 
PRTMP_ADAPTER
 
pAd
);

146 
VOID
 
BbpRadDeiSt
(

147 
IN
 
PRTMP_ADAPTER
 
pAd
);

149 
VOID
 
RadDeiS
(

150 
IN
 
PRTMP_ADAPTER
 
pAd
,

151 
IN
 
BOOLEAN
 
CTS_Pre
,

152 
IN
 
UINT8
 
CTSPiod
);

154 
VOID
 
RadDeiSt
(

155 
IN
 
PRTMP_ADAPTER
 
pAd
);

158 
VOID
 
RadDePiodic
(

159 
IN
 
PRTMP_ADAPTER
 
pAd
);

162 
BOOLEAN
 
RadChlCheck
(

163 
IN
 
PRTMP_ADAPTER
 
pAd
,

164 
IN
 
UCHAR
 
Ch
);

166 
ULONG
 
JRadTy
(

167 
IN
 
PRTMP_ADAPTER
 
pAd
);

169 
ULONG
 
RTMPBbpRdRadDuti
(

170 
IN
 
PRTMP_ADAPTER
 
pAd
);

172 
ULONG
 
RTMPRdRadDuti
(

173 
IN
 
PRTMP_ADAPTER
 
pAd
);

175 
VOID
 
RTMPC˪RadDuti
(

176 
IN
 
PRTMP_ADAPTER
 
pAd
);

178 
VOID
 
RTMPPRDCTSFme
(

179 
IN
 
PRTMP_ADAPTER
 
pAd
,

180 
IN
 
PUCHAR
 
pDA
,

181 
IN
 
ULONG
 
Duti
,

182 
IN
 
UCHAR
 
RTSRe
,

183 
IN
 
ULONG
 
CTSBaAddr
,

184 
IN
 
UCHAR
 
FmeG
);

185 #ifde
DFS_SOFTWARE_SUPPORT


186 
VOID
 
RTMPPRadDePams
(

187 
IN
 
PRTMP_ADAPTER
 
pAd
);

190 
INT
 
S_ChMovgTime_Proc
(

191 
IN
 
PRTMP_ADAPTER
 
pAd
,

192 
IN
 
PSTRING
 
g
);

194 
INT
 
S_LgPulRadTh_Proc
(

195 
IN
 
PRTMP_ADAPTER
 
pAd
,

196 
IN
 
PSTRING
 
g
);

	@include/dot11i_wpa.h

36 #idef 
__DOT11I_WPA_H__


37 
	#__DOT11I_WPA_H__


	)

39 
	~"mp_ty.h
"

43 
	#MIN_LEN_OF_EAPOL_KEY_MSG
 95

	)

46 
	#LEN_KEY_DESC_NONCE
 32

	)

47 
	#LEN_KEY_DESC_IV
 16

	)

48 
	#LEN_KEY_DESC_RSC
 8

	)

49 
	#LEN_KEY_DESC_ID
 8

	)

50 
	#LEN_KEY_DESC_REPLAY
 8

	)

51 
	#LEN_KEY_DESC_MIC
 16

	)

54 
	#EAP_CODE_REQUEST
 1

	)

55 
	#EAP_CODE_RESPONSE
 2

	)

56 
	#EAP_CODE_SUCCESS
 3

	)

57 
	#EAP_CODE_FAILURE
 4

	)

60 
	#EAPOL_VER
 1

	)

61 
	#EAPOL_VER2
 2

	)

64 
	#WPA1_KEY_DESC
 0x

	)

65 
	#WPA2_KEY_DESC
 0x02

	)

68 
	#KEY_DESC_TKIP
 1

	)

69 
	#KEY_DESC_AES
 2

	)

70 
	#KEY_DESC_EXT
 3

	)

72 
	#IE_WPA
 221

	)

73 
	#IE_RSN
 48

	)

75 
	#WPA_KDE_TYPE
 0xdd

	)

78 
	#EAPPack
 0

	)

79 
	#EAPOLS
 1

	)

80 
	#EAPOLLogoff
 2

	)

81 
	#EAPOLKey
 3

	)

82 
	#EAPOLASFA˹
 4

	)

83 
	#EAPTtyMax
 5

	)

85 
	#PAIRWISEKEY
 1

	)

86 
	#GROUPKEY
 0

	)

89 
	#MAX_LEN_OF_RSNIE
 255

	)

90 
	#MIN_LEN_OF_RSNIE
 18

	)

91 
	#MAX_LEN_GTK
 32

	)

92 
	#MIN_LEN_GTK
 5

	)

94 
	#LEN_PMK
 32

	)

95 
	#LEN_PMKID
 16

	)

96 
	#LEN_PMK_NAME
 16

	)

98 
	#LEN_GMK
 32

	)

100 
	#LEN_PTK_KCK
 16

	)

101 
	#LEN_PTK_KEK
 16

	)

102 
	#LEN_TK
 16

103 
	#LEN_TKIP_MIC
 8

104 
	#LEN_TK2
 (2 * 
LEN_TKIP_MIC
)

	)

105 
	#LEN_PTK
 (
LEN_PTK_KCK
 + 
LEN_PTK_KEK
 + 
LEN_TK
 + 
LEN_TK2
)

	)

107 
	#LEN_TKIP_PTK
 
LEN_PTK


	)

108 
	#LEN_AES_PTK
 (
LEN_PTK_KCK
 + 
LEN_PTK_KEK
 + 
LEN_TK
)

	)

109 
	#LEN_TKIP_GTK
 (
LEN_TK
 + 
LEN_TK2
)

	)

110 
	#LEN_AES_GTK
 
LEN_TK


	)

111 
	#LEN_TKIP_TK
 (
LEN_TK
 + 
LEN_TK2
)

	)

112 
	#LEN_AES_TK
 
LEN_TK


	)

114 
	#OFFSET_OF_PTK_TK
 (
LEN_PTK_KCK
 + 
LEN_PTK_KEK
)

115 
	#OFFSET_OF_AP_TKIP_TX_MIC
 (
OFFSET_OF_PTK_TK
 + 
LEN_TK
)

	)

116 
	#OFFSET_OF_AP_TKIP_RX_MIC
 (
OFFSET_OF_AP_TKIP_TX_MIC
 + 
LEN_TKIP_MIC
)

	)

117 
	#OFFSET_OF_STA_TKIP_RX_MIC
 (
OFFSET_OF_PTK_TK
 + 
LEN_TK
)

	)

118 
	#OFFSET_OF_STA_TKIP_TX_MIC
 (
OFFSET_OF_AP_TKIP_TX_MIC
 + 
LEN_TKIP_MIC
)

	)

120 
	#LEN_KDE_HDR
 6

	)

121 
	#LEN_NONCE
 32

	)

122 
	#LEN_PN
 6

	)

123 
	#LEN_TKIP_IV_HDR
 8

	)

124 
	#LEN_CCMP_HDR
 8

	)

125 
	#LEN_CCMP_MIC
 8

	)

126 
	#LEN_OUI_SUITE
 4

	)

127 
	#LEN_WEP_TSC
 3

	)

128 
	#LEN_WPA_TSC
 6

	)

129 
	#LEN_WEP_IV_HDR
 4

	)

130 
	#LEN_ICV
 4

	)

133 
	e_WPA_KDE_ID


135 
	mKDE_RESV0
,

136 
	mKDE_GTK
,

137 
	mKDE_RESV2
,

138 
	mKDE_MAC_ADDR
,

139 
	mKDE_PMKID
,

140 
	mKDE_SMK
,

141 
	mKDE_NONCE
,

142 
	mKDE_LIFETIME
,

143 
	mKDE_ERROR
,

144 
	mKDE_RESV_OTHER


145 } 
	tWPA_KDE_ID
;

148 
GNU_PACKED
 
	t_KEY_INFO


150 #ifde
RT_BIG_ENDIAN


151 
UCHAR
 
	gKeyAck
:1;

152 
UCHAR
 
	gInl
:1;

153 
UCHAR
 
	gKeyIndex
:2;

154 
UCHAR
 
	gKeyTy
:1;

155 
UCHAR
 
	gKeyDescV
:3;

156 
UCHAR
 
	gRsvd
:3;

157 
UCHAR
 
	gEKD_DL
:1;

158 
UCHAR
 
	gReque
:1;

159 
UCHAR
 
	gE
:1;

160 
UCHAR
 
	gSecu
:1;

161 
UCHAR
 
	gKeyMic
:1;

163 
UCHAR
 
	gKeyMic
:1;

164 
UCHAR
 
	gSecu
:1;

165 
UCHAR
 
	gE
:1;

166 
UCHAR
 
	gReque
:1;

167 
UCHAR
 
	gEKD_DL
:1;

168 
UCHAR
 
	gRsvd
:3;

169 
UCHAR
 
	gKeyDescV
:3;

170 
UCHAR
 
	gKeyTy
:1;

171 
UCHAR
 
	gKeyIndex
:2;

172 
UCHAR
 
	gInl
:1;

173 
UCHAR
 
	gKeyAck
:1;

175 } 
	tKEY_INFO
, *
	tPKEY_INFO
;

178 
GNU_PACKED
 
	t_KEY_DESCRIPTER


180 
UCHAR
 
	gTy
;

181 
KEY_INFO
 
	gKeyInfo
;

182 
UCHAR
 
	gKeyLgth
[2];

183 
UCHAR
 
	gRyCou
[
LEN_KEY_DESC_REPLAY
];

184 
UCHAR
 
	gKeyN
[
LEN_KEY_DESC_NONCE
];

185 
UCHAR
 
	gKeyIv
[
LEN_KEY_DESC_IV
];

186 
UCHAR
 
	gKeyRsc
[
LEN_KEY_DESC_RSC
];

187 
UCHAR
 
	gKeyId
[
LEN_KEY_DESC_ID
];

188 
UCHAR
 
	gKeyMic
[
LEN_KEY_DESC_MIC
];

189 
UCHAR
 
	gKeyDaL
[2];

190 
UCHAR
 
	gKeyDa
[0];

191 } 
	tKEY_DESCRIPTER
, *
	tPKEY_DESCRIPTER
;

193 
GNU_PACKED
 
	t_EAPOL_PACKET


195 
UCHAR
 
	gProV
;

196 
UCHAR
 
	gProTy
;

197 
UCHAR
 
	gBody_L
[2];

198 
KEY_DESCRIPTER
 
	gKeyDesc
;

199 } 
	tEAPOL_PACKET
, *
	tPEAPOL_PACKET
;

201 
GNU_PACKED
 
	t_KDE_HDR


203 
UCHAR
 
	gTy
;

204 
UCHAR
 
	gL
;

205 
UCHAR
 
	gOUI
[3];

206 
UCHAR
 
	gDaTy
;

207 
UCHAR
 
	go
[0];

208 } 
	tKDE_HDR
, *
	tPKDE_HDR
;

211 
GNU_PACKED
 
	t_GTK_KDE


213 #ide
RT_BIG_ENDIAN


214 
UCHAR
 
	gKid
:2;

215 
UCHAR
 
	gtx
:1;

216 
UCHAR
 
	grsv
:5;

217 
UCHAR
 
	grsv1
;

219 
UCHAR
 
	grsv
:5;

220 
UCHAR
 
	gtx
:1;

221 
UCHAR
 
	gKid
:2;

222 
UCHAR
 
	grsv1
;

224 
UCHAR
 
	gGTK
[0];

225 } 
	tGTK_KDE
, *
	tPGTK_KDE
;

228 
GNU_PACKED
 
	t_RSNIE
 {

229 
UCHAR
 
	goui
[4];

230 
USHORT
 
	gvsi
;

231 
UCHAR
 
	gm
[4];

232 
USHORT
 
	gucou
;

233 
	sGNU_PACKED
 {

234 
UCHAR
 
	goui
[4];

235 }
	gu
[1];

236 } 
	tRSNIE
, *
	tPRSNIE
;

239 
GNU_PACKED
 
	t_RSNIE2
 {

240 
USHORT
 
	gvsi
;

241 
UCHAR
 
	gm
[4];

242 
USHORT
 
	gucou
;

243 
	sGNU_PACKED
 {

244 
UCHAR
 
	goui
[4];

245 }
	gu
[1];

246 } 
	tRSNIE2
, *
	tPRSNIE2
;

249 
GNU_PACKED
 
	t_RSNIE_AUTH
 {

250 
USHORT
 
	gacou
;

251 
	sGNU_PACKED
 {

252 
UCHAR
 
	goui
[4];

253 }
	gauth
[1];

254 } 
	tRSNIE_AUTH
,*
	tPRSNIE_AUTH
;

257 
GNU_PACKED
 
	t_RSNIE_PMKID
 {

258 
USHORT
 
	gpcou
;

259 
	sGNU_PACKED
 {

260 
UCHAR
 
	gli
[16];

261 }
	gpmkid
[1];

262 } 
	tRSNIE_PMKID
,*
	tPRSNIE_PMKID
;

264 
GNU_PACKED
 
	t_RSN_CAPABILITIES
 {

265 
	sGNU_PACKED
 {

266 #ifde
RT_BIG_ENDIAN


267 
USHORT
 
	gRsvd
:8;

268 
USHORT
 
	gMFPC
:1;

269 
USHORT
 
	gMFPR
:1;

270 
USHORT
 
	gGTKSA_R_Cou
:2;

271 
USHORT
 
	gPTKSA_R_Cou
:2;

272 
USHORT
 
	gNo_Pawi
:1;

273 
USHORT
 
	gPAuth
:1;

275 
USHORT
 
	gPAuth
:1;

276 
USHORT
 
	gNo_Pawi
:1;

277 
USHORT
 
	gPTKSA_R_Cou
:2;

278 
USHORT
 
	gGTKSA_R_Cou
:2;

279 
USHORT
 
	gMFPR
:1;

280 
USHORT
 
	gMFPC
:1;

281 
USHORT
 
	gRsvd
:8;

283 } 
	gfld
;

284 
USHORT
 
	gwd
;

285 } 
	tRSN_CAPABILITIES
, *
	tPRSN_CAPABILITIES
;

287 
GNU_PACKED
 
	t_EAP_HDR
 {

288 
UCHAR
 
	gProV
;

289 
UCHAR
 
	gProTy
;

290 
UCHAR
 
	gBody_L
[2];

291 
UCHAR
 
	gcode
;

292 
UCHAR
 
	gidtifr
;

293 
UCHAR
 
	gngth
[2];

294 } 
	tEAP_HDR
, *
	tPEAP_HDR
;

	@include/eeprom.h

37 #ide
__EEPROM_H__


38 
	#__EEPROM_H__


	)

40 #ifde
RTMP_MAC_PCI


41 
	#EEPROM_SIZE
 0x200

	)

46 #ifde
RTMP_PCI_SUPPORT


50 
mp__om_ad16
(

51 
IN
 
PRTMP_ADAPTER
 
pAd
,

52 
IN
 
USHORT
 
Offt
,

53 
OUT
 
USHORT
 *
pVue
);

55 
mp__om_wre16
(

56 
IN
 
PRTMP_ADAPTER
 
pAd
,

57 
IN
 
USHORT
 
Offt
,

58 
IN
 
USHORT
 
vue
);

64 #i
defed
(
RTMP_RBUS_SUPPORT
|| defed(
RTMP_FLASH_SUPPORT
)

68 
NDIS_STATUS
 
mp_nv_
(

69 
IN
 
PRTMP_ADAPTER
 
pAd
);

71 
mp__ash_ad
(

72 
IN
 
PRTMP_ADAPTER
 
pAd
,

73 
IN
 
USHORT
 
Offt
,

74 
OUT
 
USHORT
 *
pVue
);

76 
mp__ash_wre
(

77 
IN
 
PRTMP_ADAPTER
 
pAd
,

78 
IN
 
USHORT
 
Offt
,

79 
IN
 
USHORT
 
Da
);

81 
VOID
 
mp__ash_ad_l
(

82 
IN
 
PRTMP_ADAPTER
 
pAd
,

83 
IN
 
USHORT
 *
Da
);

85 
VOID
 
mp__ash_wre_l
(

86 
IN
 
PRTMP_ADAPTER
 
pAd
,

87 
IN
 
USHORT
 *
Da
);

95 
INT
 
RtmpChOpsEromHook
(

96 
IN
 
RTMP_ADAPTER
 *
pAd
,

97 
IN
 
INT
 
fTy
);

	@include/firmware.h

46 
UCHAR
 
	gFmweImage
 [] = {

	@include/iface/rtmp_pci.h

37 #ide
__RTMP_PCI_H__


38 
	#__RTMP_PCI_H__


	)

40 
	#RT28XX_HANDLE_DEV_ASSIGN
(
hd
, 
dev_p
) \

41 ((
POS_COOKIE
)
hd
)->
pci_dev
 = 
dev_p
;

	)

44 #ifde
LINUX


46 
	#RT28XX_DRVDATA_SET
(
_a

	`pci_t_drvda
(_a, 
t_dev
);

	)

48 
	#RT28XX_PUT_DEVICE
(
dev_p
)

	)

50 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,24)

51 #ide
SA_SHIRQ


52 
	#SA_SHIRQ
 
IRQF_SHARED


	)

56 #ifde
PCI_MSI_SUPPORT


57 
	#RTMP_MSI_ENABLE
(
_pAd
) \

58 { 
POS_COOKIE
 
_pObj
 = (POS_COOKIE)(
_pAd
->
OS_Cook
); \

59 (
_pAd
)->
HaveMsi
 = 
	`pci_ab_msi
(
_pObj
->
pci_dev
=0 ? 
TRUE
 : 
FALSE
; \

60 }

	)

62 
	#RTMP_MSI_DISABLE
(
_pAd
) \

63 { 
POS_COOKIE
 
_pObj
 = (POS_COOKIE)(
_pAd
->
OS_Cook
); \

64 i(
_pAd
->
HaveMsi
 =
TRUE
) \

65 
	`pci_dib_msi
(
_pObj
->
pci_dev
); \

66 
_pAd
->
HaveMsi
 = 
FALSE
; \

67 }

	)

69 
	#RTMP_MSI_ENABLE
(
_pAd
do{}0)

	)

70 
	#RTMP_MSI_DISABLE
(
_pAd
do{}0)

	)

73 
	#RTMP_PCI_DEV_UNMAP
() \

74 { i(
t_dev
->
ba_addr
) { \

75 
	`iounm
((*)(
t_dev
->
ba_addr
)); \

76 
	`a_mem_gi
(
	`pci_sour_t
(
dev_p
, 0), \

77 
	`pci_sour_n
(
dev_p
, 0)); } \

78 i(
t_dev
->
q

	`pci_a_gis
(
dev_p
); }

	)

81 
	#PCI_REG_READ_WORD
(
pci_dev
, 
offt
, 
Cfiguti
) \

82 i(
	`pci_ad_cfig_wd
(
pci_dev
, 
offt
, &
g16
) == 0) \

83 
Cfiguti
 = 
	`2u16
(
g16
); \

85 
Cfiguti
 = 0;

	)

87 
	#PCI_REG_WIRTE_WORD
(
pci_dev
, 
offt
, 
Cfiguti
) \

88 
g16
 = 
	`u216
(
Cfiguti
); \

89 
	`pci_wre_cfig_wd
(
pci_dev
, 
offt
, 
g16
);

	)

93 
	#CMDTHREAD_CHAN_RESCAN
 0x0D730101

	)

94 
	#CMDTHREAD_REG_HINT
 0x0D730102

	)

95 
	#CMDTHREAD_REG_HINT_11D
 0x0D730103

	)

96 
	#CMDTHREAD_SCAN_END
 0x0D730104

	)

97 
	#CMDTHREAD_CONNECT_RESULT_INFORM
 0x0D730105

	)

	@include/link_list.h

28 #ide
__LINK_LIST_H__


29 
	#__LINK_LIST_H__


	)

31 
	s_LIST_ENTRY


33 
_LIST_ENTRY
 *
	mpNext
;

34 } 
	tLIST_ENTRY
, *
	tPLIST_ENTRY
;

36 
	s_LIST_HEADR


38 
PLIST_ENTRY
 
	mpHd
;

39 
PLIST_ENTRY
 
	mpTa
;

40 
UCHAR
 
	msize
;

41 } 
	tLIST_HEADER
, *
	tPLIST_HEADER
;

43 
le
 
VOID
 
	$Li
(

44 
IN
 
PLIST_HEADER
 
pLi
)

46 
pLi
->
pHd
 =Li->
pTa
 = 
NULL
;

47 
pLi
->
size
 = 0;

49 
	}
}

51 
le
 
VOID
 
	$TaLi
(

52 
IN
 
PLIST_HEADER
 
pLi
,

53 
IN
 
PLIST_ENTRY
 
pEry
)

55 
pEry
->
pNext
 = 
NULL
;

56 i(
pLi
->
pTa
)

57 
pLi
->
pTa
->
pNext
 = 
pEry
;

59 
pLi
->
pHd
 = 
pEry
;

60 
pLi
->
pTa
 = 
pEry
;

61 
pLi
->
size
++;

64 
	}
}

66 
le
 
PLIST_ENTRY
 
	$moveHdLi
(

67 
IN
 
PLIST_HEADER
 
pLi
)

69 
PLIST_ENTRY
 
pNext
;

70 
PLIST_ENTRY
 
pEry
;

72 
pEry
 = 
pLi
->
pHd
;

73 i(
pLi
->
pHd
 !
NULL
)

75 
pNext
 = 
pLi
->
pHd
->pNext;

76 
pLi
->
pHd
 = 
pNext
;

77 i(
pNext
 =
NULL
)

78 
pLi
->
pTa
 = 
NULL
;

79 
pLi
->
size
--;

81  
pEry
;

82 
	}
}

84 
le
 
	$gLiSize
(

85 
IN
 
PLIST_HEADER
 
pLi
)

87  
pLi
->
size
;

88 
	}
}

90 
le
 
PLIST_ENTRY
 
	$dEryLi
(

91 
IN
 
PLIST_HEADER
 
pLi
,

92 
IN
 
PLIST_ENTRY
 
pEry
)

94 
PLIST_ENTRY
 
pCurEry
;

95 
PLIST_ENTRY
 
pPrvEry
;

97 if(
pLi
->
pHd
 =
NULL
)

98  
NULL
;

100 if(
pEry
 =
pLi
->
pHd
)

102 
pCurEry
 = 
pLi
->
pHd
;

103 
pLi
->
pHd
 = 
pCurEry
->
pNext
;

105 if(
pLi
->
pHd
 =
NULL
)

106 
pLi
->
pTa
 = 
NULL
;

108 
pLi
->
size
--;

109  
pCurEry
;

112 
pPrvEry
 = 
pLi
->
pHd
;

113 
pCurEry
 = 
pPrvEry
->
pNext
;

114 
pCurEry
 !
NULL
)

116 i(
pEry
 =
pCurEry
)

118 
pPrvEry
->
pNext
 = 
pCurEry
->pNext;

120 if(
pEry
 =
pLi
->
pTa
)

121 
pLi
->
pTa
 = 
pPrvEry
;

123 
pLi
->
size
--;

126 
pPrvEry
 = 
pCurEry
;

127 
pCurEry
 = 
pPrvEry
->
pNext
;

130  
pCurEry
;

131 
	}
}

	@include/mlme.h

39 #ide
__MLME_H__


40 
	#__MLME_H__


	)

42 
	~"mp_d11.h
"

44 #ifde
CONFIG_STA_SUPPORT


49 
	#SUPPORTED_CAPABILITY_INFO
 0x0533

	)

51 
	#END_OF_ARGS
 -1

	)

52 
	#LFSR_MASK
 0x80000057

	)

53 
	#MLME_TASK_EXEC_INTV
 100

54 
	#LEAD_TIME
 5

	)

55 
	#MLME_TASK_EXEC_MULTIPLE
 10

56 
	#REORDER_EXEC_INTV
 100

58 

	)

60 
	#CE
 0

	)

61 
	#FCC
 1

	)

62 
	#JAP
 2

	)

63 
	#JAP_W53
 3

	)

64 
	#JAP_W56
 4

	)

65 
	#MAX_RD_REGION
 5

	)

67 
	#BEACON_LOST_TIME
 4 * 
OS_HZ


68 

	)

69 
	#DLS_TIMEOUT
 1200

70 
	#AUTH_TIMEOUT
 300

71 
	#ASSOC_TIMEOUT
 300

72 
	#JOIN_TIMEOUT
 2000

73 
	#SHORT_CHANNEL_TIME
 90

74 
	#MIN_CHANNEL_TIME
 110

75 
	#MAX_CHANNEL_TIME
 140

76 
	#FAST_ACTIVE_SCAN_TIME
 30

77 
	#CW_MIN_IN_BITS
 4

78 
	#AUTO_CHANNEL_SEL_TIMEOUT
 400

79 
	#LINK_DOWN_TIMEOUT
 20000

80 
	#AUTO_WAKEUP_TIMEOUT
 70

81 

	)

83 #ifde
CONFIG_STA_SUPPORT


84 
	#CW_MAX_IN_BITS
 10

86 

	)

87 #ifde
CONFIG_APSTA_MIXED_SUPPORT


88 
UINT32
 
CW_MAX_IN_BITS
;

94 
	#RSSI_FOR_MID_TX_POWER
 -55

95 
	#RSSI_FOR_LOW_TX_POWER
 -45

97 
	#RSSI_FOR_LOWEST_TX_POWER
 -30

	)

99 
	#LOW_TX_POWER_DELTA
 6

100 
	#LOWEST_TX_POWER_DELTA
 16

101 

	)

102 
	#RSSI_TRIGGERED_UPON_BELOW_THRESHOLD
 0

	)

103 
	#RSSI_TRIGGERED_UPON_EXCCEED_THRESHOLD
 1

	)

104 
	#RSSI_THRESHOLD_FOR_ROAMING
 25

	)

105 
	#RSSI_DELTA
 5

	)

108 
	#CQI_IS_GOOD
(
cqi
((cqi>50)

	)

110 
	#CQI_IS_POOR
(
cqi
) (cqi < 50)

111 
	#CQI_IS_BAD
(
cqi
(cq< 5)

	)

112 
	#CQI_IS_DEAD
(
cqi
(cq=0)

	)

115 
	#RSSI_WEIGHTING
 50

	)

116 
	#TX_WEIGHTING
 30

	)

117 
	#RX_WEIGHTING
 20

	)

126 
	#BSS_NOT_FOUND
 0xFFFFFFFF

	)

129 #ifde
CONFIG_STA_SUPPORT


130 
	#MAX_LEN_OF_MLME_QUEUE
 40

132 

	)

133 
	#SCAN_PASSIVE
 18

134 
	#SCAN_ACTIVE
 19

135 
	#SCAN_CISCO_PASSIVE
 20

136 
	#SCAN_CISCO_ACTIVE
 21

137 
	#SCAN_CISCO_NOISE
 22

138 
	#SCAN_CISCO_CHANNEL_LOAD
 23

139 
	#FAST_SCAN_ACTIVE
 24

140 

	)

141 #ifde
DOT11N_DRAFT3


142 
	#SCAN_2040_BSS_COEXIST
 26

	)

146 
	#MAC_ADDR_IS_GROUP
(
Addr
(((Addr[0]& 0x01))

	)

147 
	#MAC_ADDR_HASH
(
Addr
(Addr[0] ^ Addr[1] ^ Addr[2] ^ Addr[3] ^ Addr[4] ^ Addr[5])

	)

148 
	#MAC_ADDR_HASH_INDEX
(
Addr
(
	`MAC_ADDR_HASH
(Addr& (
HASH_TABLE_SIZE
 - 1))

	)

149 
	#TID_MAC_HASH
(
Addr
,
TID
(TID^Addr[0] ^ Addr[1] ^ Addr[2] ^ Addr[3] ^ Addr[4] ^ Addr[5])

	)

150 
	#TID_MAC_HASH_INDEX
(
Addr
,
TID
(
	`TID_MAC_HASH
(Addr,TID& (
HASH_TABLE_SIZE
 - 1))

	)

155 
	#ASIC_LED_ACT_ON
(
pAd

	`RTMP_IO_WRITE32
Ad, 
MAC_CSR14
, 0x00031e46)

	)

156 
	#ASIC_LED_ACT_OFF
(
pAd

	`RTMP_IO_WRITE32
Ad, 
MAC_CSR14
, 0x00001e46)

	)

159 
	#CAP_IS_ESS_ON
(
x
(((x& 0x0001!0)

	)

160 
	#CAP_IS_IBSS_ON
(
x
(((x& 0x0002!0)

	)

161 
	#CAP_IS_CF_POLLABLE_ON
(
x
(((x& 0x0004!0)

	)

162 
	#CAP_IS_CF_POLL_REQ_ON
(
x
(((x& 0x0008!0)

	)

163 
	#CAP_IS_PRIVACY_ON
(
x
(((x& 0x0010!0)

	)

164 
	#CAP_IS_SHORT_PREAMBLE_ON
(
x
(((x& 0x0020!0)

	)

165 
	#CAP_IS_PBCC_ON
(
x
(((x& 0x0040!0)

	)

166 
	#CAP_IS_AGILITY_ON
(
x
(((x& 0x0080!0)

	)

167 
	#CAP_IS_SPECTRUM_MGMT
(
x
) (((x) & 0x0100) != 0)

168 
	#CAP_IS_QOS
(
x
) (((x) & 0x0200) != 0)

169 
	#CAP_IS_SHORT_SLOT
(
x
(((x& 0x0400!0)

	)

170 
	#CAP_IS_APSD
(
x
) (((x) & 0x0800) != 0)

171 
	#CAP_IS_IMMED_BA
(
x
) (((x) & 0x1000) != 0)

172 
	#CAP_IS_DSSS_OFDM
(
x
(((x& 0x2000!0)

	)

173 
	#CAP_IS_DELAY_BA
(
x
) (((x) & 0x4000) != 0)

174 

	)

175 
	#CAP_GENERATE
(
ess
,
ibss
,
iv
,
s_e
,
s_
,
erum
((ss? 0x0001 : 0x0000| ((ibss? 0x0002 : 0x0000| (riv? 0x0010 : 0x0000| ((s_e? 0x0020 : 0x0000| ((s_? 0x0400 : 0x0000| ((erum? 0x0100 : 0x0000))

	)

179 
	#ERP_IS_NON_ERP_PRESENT
(
x
) (((x) & 0x01) != 0)

180 
	#ERP_IS_USE_PROTECTION
(
x
) (((x) & 0x02) != 0)

181 
	#ERP_IS_USE_BARKER_PREAMBLE
(
x
) (((x) & 0x04) != 0)

182 

	)

183 
	#DRS_TX_QUALITY_WORST_BOUND
 8

184 
	#DRS_PENALTY
 8

	)

186 
	#BA_NOTUSE
 2

	)

188 
	#IMMED_BA
 1

	)

189 
	#DELAY_BA
 0

	)

192 
	#ORIGINATOR
 1

	)

193 
	#RECIPIENT
 0

	)

196 
	#ADDBA_RESULTCODE_SUCCESS
 0

	)

197 
	#ADDBA_RESULTCODE_REFUSED
 37

	)

198 
	#ADDBA_RESULTCODE_INVALID_PARAMETERS
 38

	)

201 
	#DELBA_REASONCODE_QSTA_LEAVING
 36

	)

202 
	#DELBA_REASONCODE_END_BA
 37

	)

203 
	#DELBA_REASONCODE_UNKNOWN_BA
 38

	)

204 
	#DELBA_REASONCODE_TIMEOUT
 39

	)

207 
	#RESET_ONE_SEC_TX_CNT
(
__pEry
) \

208 i(((
__pEry
)!
NULL
) \

210 (
__pEry
)->
OSecTxRryOkCou
 = 0; \

211 (
__pEry
)->
OSecTxFaCou
 = 0; \

212 (
__pEry
)->
OSecTxNoRryOkCou
 = 0; \

213 }

	)

216 #ifde
NEW_RATE_ADAPT_SUPPORT


222 
	#USE_GREATER_UP_MCS


223 
	#PER_THRD_ADJ
 1

	)

224 
	#RA_PER_LOW_THRD
 8

	)

225 
	#FEW_PKTS_CNT_THRD
 1

	)

239 #ifde
TXBF_SUPPORT


241 
	#ETXBF_EN_COND
 0

247 

	)

248 
	#MSI_TOGGLE_BF
 6

	)

249 
	#TOGGLE_BF_PKTS
 5

250 
	#READY_FOR_SNDG0
 0

251 
	#WAIT_SNDG_FB0
 1

252 
	#WAIT_SNDG_FB1
 2

	)

253 
	#WAIT_MFB
 3

	)

254 
	#WAIT_USELESS_RSP
 4

	)

255 
	#WAIT_BEST_SNDG
 5

	)

256 
	#NO_SNDG_CNT_THRD
 0

259 

	)

265 
	sGNU_PACKED
 {

266 #ifde
RT_BIG_ENDIAN


267 
USHORT
 
	mLSIGTxProSup
:1;

268 
USHORT
 
	mFty_Mhz_Iޔt
:1;

269 
USHORT
 
	mPSMP
:1;

270 
USHORT
 
	mCCKmode40
:1;

271 
USHORT
 
	mAMsduSize
:1;

272 
USHORT
 
	mDayedBA
:1;

273 
USHORT
 
	mRxSTBC
:2;

274 
USHORT
 
	mTxSTBC
:1;

275 
USHORT
 
	mShtGIf40
:1;

276 
USHORT
 
	mShtGIf20
:1;

277 
USHORT
 
	mGF
:1;

278 
USHORT
 
	mMimoPs
:2;

279 
USHORT
 
	mChlWidth
:1;

280 
USHORT
 
	mAdvCodg
:1;

282 
USHORT
 
	mAdvCodg
:1;

283 
USHORT
 
	mChlWidth
:1;

284 
USHORT
 
	mMimoPs
:2;

285 
USHORT
 
	mGF
:1;

286 
USHORT
 
	mShtGIf20
:1;

287 
USHORT
 
	mShtGIf40
:1;

288 
USHORT
 
	mTxSTBC
:1;

289 
USHORT
 
	mRxSTBC
:2;

290 
USHORT
 
	mDayedBA
:1;

291 
USHORT
 
	mAMsduSize
:1;

292 
USHORT
 
	mCCKmode40
:1;

293 
USHORT
 
	mPSMP
:1;

294 
USHORT
 
	mFty_Mhz_Iޔt
:1;

295 
USHORT
 
	mLSIGTxProSup
:1;

297 } 
	tHT_CAP_INFO
, *
	tPHT_CAP_INFO
;

300 
	sGNU_PACKED
 {

301 #ifde
RT_BIG_ENDIAN


302 
UCHAR
 
	mrsv
:3;

303 
UCHAR
 
	mMpduDsy
:3;

304 
UCHAR
 
	mMaxRAmpduFa
:2;

306 
UCHAR
 
	mMaxRAmpduFa
:2;

307 
UCHAR
 
	mMpduDsy
:3;

308 
UCHAR
 
	mrsv
:3;

310 } 
	tHT_CAP_PARM
, *
	tPHT_CAP_PARM
;

313 
	sGNU_PACKED
 {

314 
UCHAR
 
	mMCSS
[10];

315 
UCHAR
 
	mSupRe
[2];

316 #ifde
RT_BIG_ENDIAN


317 
UCHAR
 
	mrsv
:3;

318 
UCHAR
 
	mMpduDsy
:1;

319 
UCHAR
 
	mTxSm
:2;

320 
UCHAR
 
	mTxRxNEqu
:1;

321 
UCHAR
 
	mTxMCSSDefed
:1;

323 
UCHAR
 
	mTxMCSSDefed
:1;

324 
UCHAR
 
	mTxRxNEqu
:1;

325 
UCHAR
 
	mTxSm
:2;

326 
UCHAR
 
	mMpduDsy
:1;

327 
UCHAR
 
	mrsv
:3;

329 
UCHAR
 
	mrsv3
[3];

330 } 
	tHT_MCS_SET
, *
	tPHT_MCS_SET
;

333 
	sGNU_PACKED
 {

334 #ifde
RT_BIG_ENDIAN


335 
USHORT
 
	mrsv2
:4;

336 
USHORT
 
	mRDGSut
:1;

337 
USHORT
 
	mPlusHTC
:1;

338 
USHORT
 
	mMCSFdback
:2;

339 
USHORT
 
	mrsv
:5;

340 
USHORT
 
	mTnTime
:2;

341 
USHORT
 
	mPco
:1;

343 
USHORT
 
	mPco
:1;

344 
USHORT
 
	mTnTime
:2;

345 
USHORT
 
	mrsv
:5;

346 
USHORT
 
	mMCSFdback
:2;

347 
USHORT
 
	mPlusHTC
:1;

348 
USHORT
 
	mRDGSut
:1;

349 
USHORT
 
	mrsv2
:4;

351 } 
	tEXT_HT_CAP_INFO
, *
	tPEXT_HT_CAP_INFO
;

354 
GNU_PACKED
 
	t_HT_BF_CAP
{

355 #ifde
RT_BIG_ENDIAN


356 
ULONG
 
	grsv
:3;

357 
ULONG
 
	gChEimi
:2;

358 
ULONG
 
	gCSIRowBFSup
:2;

359 
ULONG
 
	gComSBFASup
:2;

360 
ULONG
 
	gNoComSBFASup
:2;

361 
ULONG
 
	gCSIBFASup
:2;

362 
ULONG
 
	gMGroupg
:2;

363 
ULONG
 
	gExpComBF
:2;

364 
ULONG
 
	gExpNoComBF
:2;

365 
ULONG
 
	gExpCSIFbk
:2;

366 
ULONG
 
	gExpComSCab
:1;

367 
ULONG
 
	gExpNoComSCab
:1;

368 
ULONG
 
	gExpCSICab
:1;

369 
ULONG
 
	gCibti
:2;

370 
ULONG
 
	gImpTxBFCab
:1;

371 
ULONG
 
	gTxNDPCab
:1;

372 
ULONG
 
	gRxNDPCab
:1;

373 
ULONG
 
	gTxSoundCab
:1;

374 
ULONG
 
	gRxSoundCab
:1;

375 
ULONG
 
	gTxBFRecCab
:1;

377 
ULONG
 
	gTxBFRecCab
:1;

378 
ULONG
 
	gRxSoundCab
:1;

379 
ULONG
 
	gTxSoundCab
:1;

380 
ULONG
 
	gRxNDPCab
:1;

381 
ULONG
 
	gTxNDPCab
:1;

382 
ULONG
 
	gImpTxBFCab
:1;

383 
ULONG
 
	gCibti
:2;

384 
ULONG
 
	gExpCSICab
:1;

385 
ULONG
 
	gExpNoComSCab
:1;

386 
ULONG
 
	gExpComSCab
:1;

387 
ULONG
 
	gExpCSIFbk
:2;

388 
ULONG
 
	gExpNoComBF
:2;

389 
ULONG
 
	gExpComBF
:2;

390 
ULONG
 
	gMGroupg
:2;

391 
ULONG
 
	gCSIBFASup
:2;

392 
ULONG
 
	gNoComSBFASup
:2;

393 
ULONG
 
	gComSBFASup
:2;

394 
ULONG
 
	gCSIRowBFSup
:2;

395 
ULONG
 
	gChEimi
:2;

396 
ULONG
 
	grsv
:3;

398 } 
	tHT_BF_CAP
, *
	tPHT_BF_CAP
;

401 
GNU_PACKED
 
	t_HT_AS_CAP
{

402 #ifde
RT_BIG_ENDIAN


403 
UCHAR
 
	grsv
:1;

404 
UCHAR
 
	gTxSoundPPDU
:1;

405 
UCHAR
 
	gRxAS
:1;

406 
UCHAR
 
	gAIndFbk
:1;

407 
UCHAR
 
	gExpCSIFbk
:1;

408 
UCHAR
 
	gAIndFbkTxASEL
:1;

409 
UCHAR
 
	gExpCSIFbkTxASEL
:1;

410 
UCHAR
 
	gASe
:1;

412 
UCHAR
 
	gASe
:1;

413 
UCHAR
 
	gExpCSIFbkTxASEL
:1;

414 
UCHAR
 
	gAIndFbkTxASEL
:1;

415 
UCHAR
 
	gExpCSIFbk
:1;

416 
UCHAR
 
	gAIndFbk
:1;

417 
UCHAR
 
	gRxAS
:1;

418 
UCHAR
 
	gTxSoundPPDU
:1;

419 
UCHAR
 
	grsv
:1;

421 } 
	tHT_AS_CAP
, *
	tPHT_AS_CAP
;

424 
	#SIZE_HT_CAP_IE
 26

	)

426 
GNU_PACKED
 
	t_HT_CAPABILITY_IE
{

427 
HT_CAP_INFO
 
	gHtCInfo
;

428 
HT_CAP_PARM
 
	gHtCPm
;

430 
UCHAR
 
	gMCSS
[16];

431 
EXT_HT_CAP_INFO
 
	gExtHtCInfo
;

432 
HT_BF_CAP
 
	gTxBFC
;

433 
HT_AS_CAP
 
	gASC
;

434 } 
	tHT_CAPABILITY_IE
, *
	tPHT_CAPABILITY_IE
;

439 
	#d11OBSSSnPassiveDwl
 20

440 
	#d11OBSSSnAiveDwl
 10

441 
	#d11BSSWidthTriggSnIv
 300

442 
	#d11OBSSSnPassiveTٮPChl
 200

443 
	#d11OBSSSnAiveTٮPChl
 20

444 
	#d11BSSWidthChlTniDayFa
 5

446 
	#d11BSSSnAivyThshd
 25

449 

	)

450 
GNU_PACKED
 
	t_OVERLAP_BSS_SCAN_IE
{

451 
USHORT
 
	gSnPassiveDwl
;

452 
USHORT
 
	gSnAiveDwl
;

453 
USHORT
 
	gTriggSnI
;

454 
USHORT
 
	gPassiveTPChl
;

455 
USHORT
 
	gAiveTPChl
;

456 
USHORT
 
	gDayFa
;

457 
USHORT
 
	gSnATh
;

458 }
	tOVERLAP_BSS_SCAN_IE
, *
	tPOVERLAP_BSS_SCAN_IE
;

462 
GNU_PACKED
 
	t_BSS_2040_COEXIST_IE
{

463 
	sGNU_PACKED
 {

464 #ifde
RT_BIG_ENDIAN


465 
UCHAR
 
	grsv
:3;

466 
UCHAR
 
	gObssSnExempG
:1;

467 
UCHAR
 
	gObssSnExempReq
:1;

468 
UCHAR
 
	gBSS20WidthReq
:1;

469 
UCHAR
 
	gIޔt40
:1;

470 
UCHAR
 
	gInfoReq
:1;

472 
UCHAR
 
	gInfoReq
:1;

473 
UCHAR
 
	gIޔt40
:1;

474 
UCHAR
 
	gBSS20WidthReq
:1;

475 
UCHAR
 
	gObssSnExempReq
:1;

476 
UCHAR
 
	gObssSnExempG
:1;

477 
UCHAR
 
	grsv
:3;

479 } 
	gfld
;

480 
UCHAR
 
	gwd
;

481 } 
	tBSS_2040_COEXIST_IE
, *
	tPBSS_2040_COEXIST_IE
;

484 
	s_TRIGGER_EVENTA
{

485 
BOOLEAN
 
	mbVid
;

486 
UCHAR
 
	mBSSID
[6];

487 
UCHAR
 
	mRegCss
;

488 
USHORT
 
	mChl
;

489 } 
	tTRIGGER_EVENTA
, *
	tPTRIGGER_EVENTA
;

493 
	#MAX_TRIGGER_EVENT
 64

	)

494 
	s_TRIGGER_EVENT_TAB
{

495 
UCHAR
 
	mEvtANo
;

496 
TRIGGER_EVENTA
 
	mEvtA
[
MAX_TRIGGER_EVENT
];

497 
ULONG
 
	mEvtBCouDown
;

498 } 
	tTRIGGER_EVENT_TAB
, *
	tPTRIGGER_EVENT_TAB
;

502 
GNU_PACKED
 
	t_EXT_CAP_INFO_ELEMENT
{

503 #ifde
RT_BIG_ENDIAN


504 
UCHAR
 
	grsv2
:5;

505 
UCHAR
 
	gExndChlSwch
:1;

506 
UCHAR
 
	grsv
:1;

507 
UCHAR
 
	gBssCxiMgmtSut
:1;

509 
UCHAR
 
	gBssCxiMgmtSut
:1;

510 
UCHAR
 
	grsv
:1;

511 
UCHAR
 
	gExndChlSwch
:1;

512 
UCHAR
 
	grsv2
:5;

514 }
	tEXT_CAP_INFO_ELEMENT
, *
	tPEXT_CAP_INFO_ELEMENT
;

518 
GNU_PACKED
 
	t_BSS_2040_COEXIST_ELEMENT
{

519 
UCHAR
 
	gEmtID
;

520 
UCHAR
 
	gL
;

521 
BSS_2040_COEXIST_IE
 
	gBssCxiIe
;

522 }
	tBSS_2040_COEXIST_ELEMENT
, *
	tPBSS_2040_COEXIST_ELEMENT
;

526 
GNU_PACKED
 
	t_BSS_2040_INTOLERANT_CH_REPORT
{

527 
UCHAR
 
	gEmtID
;

528 
UCHAR
 
	gL
;

529 
UCHAR
 
	gRegutyCss
;

530 
UCHAR
 
	gChLi
[0];

531 }
	tBSS_2040_INTOLERANT_CH_REPORT
, *
	tPBSS_2040_INTOLERANT_CH_REPORT
;

535 
GNU_PACKED
 
	t_CHA_SWITCH_ANNOUNCE_IE
{

536 
UCHAR
 
	gSwchMode
;

537 
UCHAR
 
	gNewChl
;

538 
UCHAR
 
	gSwchCou
;

539 } 
	tCHA_SWITCH_ANNOUNCE_IE
, *
	tPCHA_SWITCH_ANNOUNCE_IE
;

543 
GNU_PACKED
 
	t_SEC_CHA_OFFSET_IE
{

544 
UCHAR
 
	gSecdyChlOfft
;

545 } 
	tSEC_CHA_OFFSET_IE
, *
	tPSEC_CHA_OFFSET_IE
;

550 
BOOLEAN
 
	mbHtEb
;

551 
BOOLEAN
 
	mbPNHt
;

553 
UCHAR
 
	mMCSS
[16];

554 } 
	tRT_HT_PHY_INFO
, *
	tPRT_HT_PHY_INFO
;

559 #ifde
RT_BIG_ENDIAN


560 
USHORT
 
	mrsv
:5;

561 
USHORT
 
	mAmsduSize
:1;

562 
USHORT
 
	mAmsduEb
:1;

563 
USHORT
 
	mRxSTBC
:2;

564 
USHORT
 
	mTxSTBC
:1;

565 
USHORT
 
	mShtGIf40
:1;

566 
USHORT
 
	mShtGIf20
:1;

567 
USHORT
 
	mGF
:1;

568 
USHORT
 
	mMimoPs
:2;

569 
USHORT
 
	mChlWidth
:1;

571 
USHORT
 
	mChlWidth
:1;

572 
USHORT
 
	mMimoPs
:2;

573 
USHORT
 
	mGF
:1;

574 
USHORT
 
	mShtGIf20
:1;

575 
USHORT
 
	mShtGIf40
:1;

576 
USHORT
 
	mTxSTBC
:1;

577 
USHORT
 
	mRxSTBC
:2;

578 
USHORT
 
	mAmsduEb
:1;

579 
USHORT
 
	mAmsduSize
:1;

580 
USHORT
 
	mrsv
:5;

584 #ifde
RT_BIG_ENDIAN


585 
UCHAR
 
	mRecomWidth
:1;

586 
UCHAR
 
	mExtChOfft
:2;

587 
UCHAR
 
	mMpduDsy
:3;

588 
UCHAR
 
	mMaxRAmpduFa
:2;

590 
UCHAR
 
	mMaxRAmpduFa
:2;

591 
UCHAR
 
	mMpduDsy
:3;

592 
UCHAR
 
	mExtChOfft
:2;

593 
UCHAR
 
	mRecomWidth
:1;

596 #ifde
RT_BIG_ENDIAN


597 
USHORT
 
	mrsv2
:11;

598 
USHORT
 
	mOBSS_NHTExi
:1;

599 
USHORT
 
	mrsv3
:1;

600 
USHORT
 
	mNGfP
:1;

601 
USHORT
 
	mOiMode
:2;

603 
USHORT
 
	mOiMode
:2;

604 
USHORT
 
	mNGfP
:1;

605 
USHORT
 
	mrsv3
:1;

606 
USHORT
 
	mOBSS_NHTExi
:1;

607 
USHORT
 
	mrsv2
:11;

611 
UCHAR
 
	mNewExtChlOfft
;

613 
UCHAR
 
	mBSSCxi2040
;

614 } 
	tRT_HT_CAPABILITY
, *
	tPRT_HT_CAPABILITY
;

617 
	sGNU_PACKED
 {

618 #ifde
RT_BIG_ENDIAN


619 
UCHAR
 
	mSIGnu
:3;

620 
UCHAR
 
	mS_PSMPSup
:1;

621 
UCHAR
 
	mRifsMode
:1;

622 
UCHAR
 
	mRecomWidth
:1;

623 
UCHAR
 
	mExtChOfft
:2;

625 
UCHAR
 
	mExtChOfft
:2;

626 
UCHAR
 
	mRecomWidth
:1;

627 
UCHAR
 
	mRifsMode
:1;

628 
UCHAR
 
	mS_PSMPSup
:1;

629 
UCHAR
 
	mSIGnu
:3;

631 } 
	tADD_HTINFO
, *
	tPADD_HTINFO
;

633 
	sGNU_PACKED
{

634 #ifde
RT_BIG_ENDIAN


635 
USHORT
 
	mrsv2
:11;

636 
USHORT
 
	mOBSS_NHTExi
:1;

637 
USHORT
 
	mrsv
:1;

638 
USHORT
 
	mNGfP
:1;

639 
USHORT
 
	mOiMode
:2;

641 
USHORT
 
	mOiMode
:2;

642 
USHORT
 
	mNGfP
:1;

643 
USHORT
 
	mrsv
:1;

644 
USHORT
 
	mOBSS_NHTExi
:1;

645 
USHORT
 
	mrsv2
:11;

647 } 
	tADD_HTINFO2
, *
	tPADD_HTINFO2
;

651 
	sGNU_PACKED
{

652 #ifde
RT_BIG_ENDIAN


653 
USHORT
 
	mrsv
:4;

654 
USHORT
 
	mPcoPha
:1;

655 
USHORT
 
	mPcoAive
:1;

656 
USHORT
 
	mLsigTxPr
:1;

657 
USHORT
 
	mSTBCBc
:1;

658 
USHORT
 
	mDuCTSPre
:1;

659 
USHORT
 
	mDuBc
:1;

660 
USHORT
 
	mStbcMcs
:6;

662 
USHORT
 
	mStbcMcs
:6;

663 
USHORT
 
	mDuBc
:1;

664 
USHORT
 
	mDuCTSPre
:1;

665 
USHORT
 
	mSTBCBc
:1;

666 
USHORT
 
	mLsigTxPr
:1;

667 
USHORT
 
	mPcoAive
:1;

668 
USHORT
 
	mPcoPha
:1;

669 
USHORT
 
	mrsv
:4;

671 } 
	tADD_HTINFO3
, *
	tPADD_HTINFO3
;

673 
	#SIZE_ADD_HT_INFO_IE
 22

	)

674 
	sGNU_PACKED
{

675 
UCHAR
 
	mCڌCh
;

676 
ADD_HTINFO
 
	mAddHtInfo
;

677 
ADD_HTINFO2
 
	mAddHtInfo2
;

678 
ADD_HTINFO3
 
	mAddHtInfo3
;

679 
UCHAR
 
	mMCSS
[16];

680 } 
	tADD_HT_INFO_IE
, *
	tPADD_HT_INFO_IE
;

682 
	sGNU_PACKED
{

683 
UCHAR
 
	mNewExtChOfft
;

684 } 
	tNEW_EXT_CHAN_IE
, *
	tPNEW_EXT_CHAN_IE
;

686 
GNU_PACKED
 
	t_FRAME_802_11
 {

687 
HEADER_802_11
 
	gHdr
;

688 
UCHAR
 
	gO
[1];

689 } 
	tFRAME_802_11
, *
	tPFRAME_802_11
;

692 
GNU_PACKED
 
	t_MA_BODY
 {

693 
UCHAR
 
	gCegy
;

694 
UCHAR
 
	gAi
;

695 
UCHAR
 
	gO
[1];

696 } 
	tMA_BODY
, *
	tPMA_BODY
;

698 
GNU_PACKED
 
	t_HEADER_802_3
 {

699 
UCHAR
 
	gDAAddr1
[
MAC_ADDR_LEN
];

700 
UCHAR
 
	gSAAddr2
[
MAC_ADDR_LEN
];

701 
UCHAR
 
	gO
[2];

702 } 
	tHEADER_802_3
, *
	tPHEADER_802_3
;

705 
	sGNU_PACKED
{

706 #ifde
RT_BIG_ENDIAN


707 
USHORT
 
	mTID
:4;

708 
USHORT
 
	mInt
:1;

709 
USHORT
 
	mRsv
:11;

711 
USHORT
 
	mRsv
:11;

712 
USHORT
 
	mInt
:1;

713 
USHORT
 
	mTID
:4;

715 } 
	tDELBA_PARM
, *
	tPDELBA_PARM
;

718 
	sGNU_PACKED
 {

719 #ifde
RT_BIG_ENDIAN


720 
USHORT
 
	mBufSize
:10;

721 
USHORT
 
	mTID
:4;

722 
USHORT
 
	mBAPicy
:1;

723 
USHORT
 
	mAMSDUSu܋d
:1;

725 
USHORT
 
	mAMSDUSu܋d
:1;

726 
USHORT
 
	mBAPicy
:1;

727 
USHORT
 
	mTID
:4;

728 
USHORT
 
	mBufSize
:10;

730 } 
	tBA_PARM
, *
	tPBA_PARM
;

733 
	uGNU_PACKED
 {

734 
	sGNU_PACKED
 {

735 #ifde
RT_BIG_ENDIAN


736 
USHORT
 
	mSSeq
:12;

737 
USHORT
 
	mFgNum
:4;

739 
USHORT
 
	mFgNum
:4;

740 
USHORT
 
	mSSeq
:12;

742 } 
	mfld
;

743 
USHORT
 
	mwd
;

744 } 
	tBASEQ_CONTROL
, *
	tPBASEQ_CONTROL
;

748 
	sGNU_PACKED
 {

749 #ifde
RT_BIG_ENDIAN


750 
USHORT
 
	mTID
:4;

751 
USHORT
 
	mRsv
:9;

752 
USHORT
 
	mComesd
:1;

753 
USHORT
 
	mMTID
:1;

754 
USHORT
 
	mACKPicy
:1;

756 
USHORT
 
	mACKPicy
:1;

757 
USHORT
 
	mMTID
:1;

758 
USHORT
 
	mComesd
:1;

759 
USHORT
 
	mRsv
:9;

760 
USHORT
 
	mTID
:4;

762 } 
	tBA_CONTROL
, *
	tPBA_CONTROL
;

765 
	sGNU_PACKED
 {

766 #ifde
RT_BIG_ENDIAN


767 
USHORT
 
	mTID
:4;

768 
USHORT
 
	mRsv1
:9;

769 
USHORT
 
	mComesd
:1;

770 
USHORT
 
	mMTID
:1;

771 
USHORT
 
	mACKPicy
:1;

773 
USHORT
 
	mACKPicy
:1;

774 
USHORT
 
	mMTID
:1;

775 
USHORT
 
	mComesd
:1;

776 
USHORT
 
	mRsv1
:9;

777 
USHORT
 
	mTID
:4;

779 } 
	tBAR_CONTROL
, *
	tPBAR_CONTROL
;

782 
	sGNU_PACKED
 {

783 #ifde
RT_BIG_ENDIAN


784 
USHORT
 
	mNumTID
:4;

785 
USHORT
 
	mRsv1
:9;

786 
USHORT
 
	mComesd
:1;

787 
USHORT
 
	mMTID
:1;

788 
USHORT
 
	mACKPicy
:1;

790 
USHORT
 
	mACKPicy
:1;

791 
USHORT
 
	mMTID
:1;

792 
USHORT
 
	mComesd
:1;

793 
USHORT
 
	mRsv1
:9;

794 
USHORT
 
	mNumTID
:4;

796 } 
	tMTBAR_CONTROL
, *
	tPMTBAR_CONTROL
;

798 
	sGNU_PACKED
 {

799 #ifde
RT_BIG_ENDIAN


800 
USHORT
 
	mTID
:4;

801 
USHORT
 
	mRsv1
:12;

803 
USHORT
 
	mRsv1
:12;

804 
USHORT
 
	mTID
:4;

806 } 
	tPER_TID_INFO
, *
	tPPER_TID_INFO
;

809 
PER_TID_INFO
 
	mPTID
;

810 
BASEQ_CONTROL
 
	mBASgSeq
;

811 } 
	tEACH_TID
, *
	tPEACH_TID
;

815 
GNU_PACKED
 
	t_FRAME_BA_REQ
 {

816 
FRAME_CONTROL
 
	gFC
;

817 
USHORT
 
	gDuti
;

818 
UCHAR
 
	gAddr1
[
MAC_ADDR_LEN
];

819 
UCHAR
 
	gAddr2
[
MAC_ADDR_LEN
];

820 
BAR_CONTROL
 
	gBARCڌ
;

821 
BASEQ_CONTROL
 
	gBASgSeq
;

822 } 
	tFRAME_BA_REQ
, *
	tPFRAME_BA_REQ
;

824 
GNU_PACKED
 
	t_FRAME_MTBA_REQ
 {

825 
FRAME_CONTROL
 
	gFC
;

826 
USHORT
 
	gDuti
;

827 
UCHAR
 
	gAddr1
[
MAC_ADDR_LEN
];

828 
UCHAR
 
	gAddr2
[
MAC_ADDR_LEN
];

829 
MTBAR_CONTROL
 
	gMTBARCڌ
;

830 
PER_TID_INFO
 
	gPTIDInfo
;

831 
BASEQ_CONTROL
 
	gBASgSeq
;

832 } 
	tFRAME_MTBA_REQ
, *
	tPFRAME_MTBA_REQ
;

835 
GNU_PACKED
 
	t_FRAME_MTBA
 {

836 
FRAME_CONTROL
 
	gFC
;

837 
USHORT
 
	gDuti
;

838 
UCHAR
 
	gAddr1
[
MAC_ADDR_LEN
];

839 
UCHAR
 
	gAddr2
[
MAC_ADDR_LEN
];

840 
BA_CONTROL
 
	gBACڌ
;

841 
BASEQ_CONTROL
 
	gBASgSeq
;

842 
UCHAR
 
	gBM
[8];

843 } 
	tFRAME_MTBA
, *
	tPFRAME_MTBA
;

845 
GNU_PACKED
 
	t_FRAME_PSMP_ACTION
 {

846 
HEADER_802_11
 
	gHdr
;

847 
UCHAR
 
	gCegy
;

848 
UCHAR
 
	gAi
;

849 
UCHAR
 
	gPsmp
;

850 } 
	tFRAME_PSMP_ACTION
, *
	tPFRAME_PSMP_ACTION
;

852 
GNU_PACKED
 
	t_FRAME_ACTION_HDR
 {

853 
HEADER_802_11
 
	gHdr
;

854 
UCHAR
 
	gCegy
;

855 
UCHAR
 
	gAi
;

856 } 
	tFRAME_ACTION_HDR
, *
	tPFRAME_ACTION_HDR
;

860 
GNU_PACKED
 
	t_CHAN_SWITCH_ANNOUNCE
 {

861 
UCHAR
 
	gEmtID
;

862 
UCHAR
 
	gL
;

863 
CHA_SWITCH_ANNOUNCE_IE
 
	gCSAounIe
;

864 } 
	tCHAN_SWITCH_ANNOUNCE
, *
	tPCHAN_SWITCH_ANNOUNCE
;

868 
GNU_PACKED
 
	t_SECOND_CHAN_OFFSET
 {

869 
UCHAR
 
	gEmtID
;

870 
UCHAR
 
	gL
;

871 
SEC_CHA_OFFSET_IE
 
	gSecChOfftIe
;

872 } 
	tSECOND_CHAN_OFFSET
, *
	tPSECOND_CHAN_OFFSET
;

875 
GNU_PACKED
 
	t_FRAME_SPETRUM_CS
 {

876 
HEADER_802_11
 
	gHdr
;

877 
UCHAR
 
	gCegy
;

878 
UCHAR
 
	gAi
;

879 
CHAN_SWITCH_ANNOUNCE
 
	gCSAoun
;

880 
SECOND_CHAN_OFFSET
 
	gSecdChl
;

881 } 
	tFRAME_SPETRUM_CS
, *
	tPFRAME_SPETRUM_CS
;

884 
GNU_PACKED
 
	t_FRAME_ADDBA_REQ
 {

885 
HEADER_802_11
 
	gHdr
;

886 
UCHAR
 
	gCegy
;

887 
UCHAR
 
	gAi
;

888 
UCHAR
 
	gTok
;

889 
BA_PARM
 
	gBaPm
;

890 
USHORT
 
	gTimeOutVue
;

891 
BASEQ_CONTROL
 
	gBaSSeq
;

892 } 
	tFRAME_ADDBA_REQ
, *
	tPFRAME_ADDBA_REQ
;

894 
GNU_PACKED
 
	t_FRAME_ADDBA_RSP
 {

895 
HEADER_802_11
 
	gHdr
;

896 
UCHAR
 
	gCegy
;

897 
UCHAR
 
	gAi
;

898 
UCHAR
 
	gTok
;

899 
USHORT
 
	gStusCode
;

900 
BA_PARM
 
	gBaPm
;

901 
USHORT
 
	gTimeOutVue
;

902 } 
	tFRAME_ADDBA_RSP
, *
	tPFRAME_ADDBA_RSP
;

904 
GNU_PACKED
 
	t_FRAME_DELBA_REQ
 {

905 
HEADER_802_11
 
	gHdr
;

906 
UCHAR
 
	gCegy
;

907 
UCHAR
 
	gAi
;

908 
DELBA_PARM
 
	gDbaPm
;

909 
USHORT
 
	gRsCode
;

910 } 
	tFRAME_DELBA_REQ
, *
	tPFRAME_DELBA_REQ
;

914 
GNU_PACKED
 
	t_FRAME_BAR
 {

915 
FRAME_CONTROL
 
	gFC
;

916 
USHORT
 
	gDuti
;

917 
UCHAR
 
	gAddr1
[
MAC_ADDR_LEN
];

918 
UCHAR
 
	gAddr2
[
MAC_ADDR_LEN
];

919 
BAR_CONTROL
 
	gBCڌ
;

920 
BASEQ_CONTROL
 
	gSgSeq
;

921 } 
	tFRAME_BAR
, *
	tPFRAME_BAR
;

924 
GNU_PACKED
 
	t_FRAME_BA
 {

925 
FRAME_CONTROL
 
	gFC
;

926 
USHORT
 
	gDuti
;

927 
UCHAR
 
	gAddr1
[
MAC_ADDR_LEN
];

928 
UCHAR
 
	gAddr2
[
MAC_ADDR_LEN
];

929 
BAR_CONTROL
 
	gBCڌ
;

930 
BASEQ_CONTROL
 
	gSgSeq
;

931 
UCHAR
 
	gbmask
[8];

932 } 
	tFRAME_BA
, *
	tPFRAME_BA
;

936 
GNU_PACKED
 
	t_FRAME_RM_REQ_ACTION
 {

937 
HEADER_802_11
 
	gHdr
;

938 
UCHAR
 
	gCegy
;

939 
UCHAR
 
	gAi
;

940 
UCHAR
 
	gTok
;

941 
USHORT
 
	gRi
;

942 
UCHAR
 
	gda
[0];

943 } 
	tFRAME_RM_REQ_ACTION
, *
	tPFRAME_RM_REQ_ACTION
;

945 
	sGNU_PACKED
 {

946 
UCHAR
 
	mID
;

947 
UCHAR
 
	mLgth
;

948 
UCHAR
 
	mChlSwchMode
;

949 
UCHAR
 
	mNewRegCss
;

950 
UCHAR
 
	mNewChlNum
;

951 
UCHAR
 
	mChlSwchCou
;

952 } 
	tHT_EXT_CHANNEL_SWITCH_ANNOUNCEMENT_IE
, *
	tPHT_EXT_CHANNEL_SWITCH_ANNOUNCEMENT_IE
;

959 
	#SEQ_STEPONE
(
_SEQ1
, 
_SEQ2
, 
_Lim
((_SEQ1 =((_SEQ2+1& _Lim)))

	)

960 
	#SEQ_SMALLER
(
_SEQ1
, 
_SEQ2
, 
_Lim
(((_SEQ1-_SEQ2& ((_Lim+1)>>1)))

	)

961 
	#SEQ_LARGER
(
_SEQ1
, 
_SEQ2
, 
_Lim
((_SEQ1 !_SEQ2&& !(((_SEQ1-_SEQ2& ((_Lim+1)>>1))))

	)

962 
	#SEQ_WITHIN_WIN
(
_SEQ1
, 
_SEQ2
, 
_WIN
, 
_Lim
(
	`SEQ_LARGER
(_SEQ1, _SEQ2, _Limit) && \

963 
	`SEQ_SMALLER
(
_SEQ1
, ((
_SEQ2
+
_WIN
+1)&
_Lim
), _Lim))

	)

968 
	sGNU_PACKED
 {

969 
BOOLEAN
 
	mbVid
;

970 
UCHAR
 
	mCCou
;

971 
UCHAR
 
	mCPiod
;

972 
USHORT
 
	mCMaxDuti
;

973 
USHORT
 
	mCDurRemag
;

974 } 
	tCF_PARM
, *
	tPCF_PARM
;

976 
	s_CIPHER_SUITE
 {

977 
NDIS_802_11_ENCRYPTION_STATUS
 
	mPaCh
;

978 
NDIS_802_11_ENCRYPTION_STATUS
 
	mPaChAux
;

979 
NDIS_802_11_ENCRYPTION_STATUS
 
	mGroupCh
;

980 
USHORT
 
	mRCaby
;

981 
BOOLEAN
 
	mbMixMode
;

982 } 
	tCIPHER_SUITE
, *
	tPCIPHER_SUITE
;

986 
BOOLEAN
 
	mbVid
;

987 
BOOLEAN
 
	mbAdd
;

988 
BOOLEAN
 
	mbQAck
;

989 
BOOLEAN
 
	mbQueueReque
;

990 
BOOLEAN
 
	mbTxReque
;

991 
BOOLEAN
 
	mbAPSDCab
;

993 
UCHAR
 
	mEdUpdeCou
;

994 
UCHAR
 
	mAif
[4];

995 
UCHAR
 
	mCwm
[4];

996 
UCHAR
 
	mCwmax
[4];

997 
USHORT
 
	mTx
[4];

998 
BOOLEAN
 
	mbACM
[4];

999 } 
	tEDCA_PARM
, *
	tPEDCA_PARM
;

1003 
BOOLEAN
 
	mbVid
;

1004 
USHORT
 
	mSNum
;

1005 
UCHAR
 
	mChlUtizi
;

1006 
USHORT
 
	mRemagAdmissiCڌ
;

1007 } 
	tQBSS_LOAD_PARM
, *
	tPQBSS_LOAD_PARM
;

1010 
	sGNU_PACKED
 {

1011 #ifde
RT_BIG_ENDIAN


1012 
UCHAR
 
	mRsv2
:1;

1013 
UCHAR
 
	mMaxSPLgth
:2;

1014 
UCHAR
 
	mRsv1
:1;

1015 
UCHAR
 
	mUAPSD_AC_BE
:1;

1016 
UCHAR
 
	mUAPSD_AC_BK
:1;

1017 
UCHAR
 
	mUAPSD_AC_VI
:1;

1018 
UCHAR
 
	mUAPSD_AC_VO
:1;

1020 
UCHAR
 
	mUAPSD_AC_VO
:1;

1021 
UCHAR
 
	mUAPSD_AC_VI
:1;

1022 
UCHAR
 
	mUAPSD_AC_BK
:1;

1023 
UCHAR
 
	mUAPSD_AC_BE
:1;

1024 
UCHAR
 
	mRsv1
:1;

1025 
UCHAR
 
	mMaxSPLgth
:2;

1026 
UCHAR
 
	mRsv2
:1;

1028 } 
	tQBSS_STA_INFO_PARM
, *
	tPQBSS_STA_INFO_PARM
;

1031 
QBSS_STA_INFO_PARM
 
	mQosInfo
;

1032 
UCHAR
 
	mRsv
;

1033 
UCHAR
 
	mQ_AC_BE
[4];

1034 
UCHAR
 
	mQ_AC_BK
[4];

1035 
UCHAR
 
	mQ_AC_VI
[4];

1036 
UCHAR
 
	mQ_AC_VO
[4];

1037 } 
	tQBSS_STA_EDCA_PARM
, *
	tPQBSS_STA_EDCA_PARM
;

1040 
	sGNU_PACKED
 {

1041 #ifde
RT_BIG_ENDIAN


1042 
UCHAR
 
	mUAPSD
:1;

1043 
UCHAR
 
	mRsv
:3;

1044 
UCHAR
 
	mPamSCou
:4;

1046 
UCHAR
 
	mPamSCou
:4;

1047 
UCHAR
 
	mRsv
:3;

1048 
UCHAR
 
	mUAPSD
:1;

1050 } 
	tQBSS_AP_INFO_PARM
, *
	tPQBSS_AP_INFO_PARM
;

1055 
BOOLEAN
 
	mbVid
;

1056 
BOOLEAN
 
	mbQAck
;

1057 
BOOLEAN
 
	mbQueueReque
;

1058 
BOOLEAN
 
	mbTxReque
;

1060 
UCHAR
 
	mEdUpdeCou
;

1061 } 
	tQOS_CAPABILITY_PARM
, *
	tPQOS_CAPABILITY_PARM
;

1063 #ifde
CONFIG_STA_SUPPORT


1065 
UCHAR
 
	mIEL
;

1066 
UCHAR
 
	mIE
[
MAX_CUSTOM_LEN
];

1067 } 
	tWPA_IE_
;

1072 
UCHAR
 
	mBssid
[
MAC_ADDR_LEN
];

1073 
UCHAR
 
	mChl
;

1074 
UCHAR
 
	mCChl
;

1075 
UCHAR
 
	mBssTy
;

1076 
USHORT
 
	mAtimW
;

1077 
USHORT
 
	mBcPiod
;

1079 
UCHAR
 
	mSupRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

1080 
UCHAR
 
	mSupReL
;

1081 
UCHAR
 
	mExtRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

1082 
UCHAR
 
	mExtReL
;

1083 
HT_CAPABILITY_IE
 
	mHtCaby
;

1084 
UCHAR
 
	mHtCabyL
;

1085 
ADD_HT_INFO_IE
 
	mAddHtInfo
;

1086 
UCHAR
 
	mAddHtInfoL
;

1087 
EXT_CAP_INFO_ELEMENT
 
	mExtCInfo
;

1088 
UCHAR
 
	mNewExtChOfft
;

1089 
CHAR
 
	mRssi
;

1090 
CHAR
 
	mMSNR
;

1091 
UCHAR
 
	mPrivacy
;

1092 
UCHAR
 
	mHidd
;

1094 
USHORT
 
	mDtimPiod
;

1095 
USHORT
 
	mCabyInfo
;

1097 
USHORT
 
	mCCou
;

1098 
USHORT
 
	mCPiod
;

1099 
USHORT
 
	mCMaxDuti
;

1100 
USHORT
 
	mCDurRemag
;

1101 
UCHAR
 
	mSsidL
;

1102 
CHAR
 
	mSsid
[
MAX_LEN_OF_SSID
];

1104 
ULONG
 
	mLaBcRxTime
;

1106 
BOOLEAN
 
	mbSES
;

1109 
CIPHER_SUITE
 
	mWPA
;

1110 
CIPHER_SUITE
 
	mWPA2
;

1113 
NDIS_802_11_FIXED_IEs
 
	mFixIEs
;

1114 
NDIS_802_11_AUTHENTICATION_MODE
 
	mAuthModeAux
;

1115 
NDIS_802_11_AUTHENTICATION_MODE
 
	mAuthMode
;

1116 
NDIS_802_11_WEP_STATUS
 
	mWStus
;

1117 
USHORT
 
	mVIEL
;

1118 
UCHAR
 
	mVIEs
[
MAX_VIE_LEN
];

1119 
USHORT
 
	mVIeFromProbeRL
;

1120 
UCHAR
 *
	mpVIeFromProbR
;

1123 
UCHAR
 
	mCkFg
;

1126 
UCHAR
 
	mPTSF
[4];

1127 
UCHAR
 
	mTTSF
[8];

1130 
EDCA_PARM
 
	mEdPm
;

1131 
QOS_CAPABILITY_PARM
 
	mQosCaby
;

1132 
QBSS_LOAD_PARM
 
	mQbssLd
;

1135 #ifde
CONFIG_STA_SUPPORT


1136 
WPA_IE_
 
	mWIE
;

1137 
WPA_IE_
 
	mRIE
;

1138 
WPA_IE_
 
	mWpsIE
;

1140 #ifde
EXT_BUILD_CHANNEL_LIST


1141 
UCHAR
 
	mCourySg
[3];

1142 
BOOLEAN
 
	mbHasCouryIE
;

1146 
UCHAR
 
	mMacAddr
[
MAC_ADDR_LEN
];

1148 #ifde
LINUX


1149 #ifde
CONFIG_STA_SUPPORT


1150 #ifde
RT_CFG80211_SUPPORT


1151 
VOID
 *
	mpCfg80211_Ch
;

1155 } 
	tBSS_ENTRY
, *
	tPBSS_ENTRY
;

1158 
UCHAR
 
	mBssNr
;

1159 
UCHAR
 
	mBssOvpNr
;

1160 
BSS_ENTRY
 
	mBssEry
[
MAX_LEN_OF_BSS_TABLE
];

1161 } 
	tBSS_TABLE
, *
	tPBSS_TABLE
;

1164 
	s_MLME_QUEUE_ELEM
 {

1165 
UCHAR
 
	mMsg
[
MGMT_DMA_BUFFER_SIZE
];

1166 
ULONG
 
	mMache
;

1167 
ULONG
 
	mMsgTy
;

1168 
ULONG
 
	mMsgL
;

1169 
LARGE_INTEGER
 
	mTimeSmp
;

1170 
UCHAR
 
	mRssi0
;

1171 
UCHAR
 
	mRssi1
;

1172 
UCHAR
 
	mRssi2
;

1173 
UCHAR
 
	mSigl
;

1174 
UCHAR
 
	mChl
;

1175 
UCHAR
 
	mWcid
;

1176 
BOOLEAN
 
	mOccupd
;

1177 
ULONG
 
	mPriv
;

1178 } 
	tMLME_QUEUE_ELEM
, *
	tPMLME_QUEUE_ELEM
;

1180 
	s_MLME_QUEUE
 {

1181 
ULONG
 
	mNum
;

1182 
ULONG
 
	mHd
;

1183 
ULONG
 
	mTa
;

1184 
NDIS_SPIN_LOCK
 
	mLock
;

1185 
MLME_QUEUE_ELEM
 
	mEry
[
MAX_LEN_OF_MLME_QUEUE
];

1186 } 
	tMLME_QUEUE
, *
	tPMLME_QUEUE
;

1188 
	$VOID
 (*
	tSTATE_MACHINE_FUNC
)(
	tVOID
 *
	tAdt
, 
	tMLME_QUEUE_ELEM
 *
	tEm
);

1190 
	s_STATE_MACHINE
 {

1191 
ULONG
 
Ba
;

1192 
ULONG
 
NrS
;

1193 
ULONG
 
NrMsg
;

1194 
ULONG
 
CuS
;

1195 
STATE_MACHINE_FUNC
 *
TnsFunc
;

1196 } 
	tSTATE_MACHINE
, *
	tPSTATE_MACHINE
;

1205 
	s_MLME_AUX
 {

1206 
UCHAR
 
BssTy
;

1207 
UCHAR
 
Ssid
[
MAX_LEN_OF_SSID
];

1208 
UCHAR
 
SsidL
;

1209 
UCHAR
 
Bssid
[
MAC_ADDR_LEN
];

1210 
UCHAR
 
AutoRecSsid
[
MAX_LEN_OF_SSID
];

1211 
UCHAR
 
AutoRecSsidL
;

1212 
USHORT
 
Alg
;

1213 
UCHAR
 
SnTy
;

1214 
UCHAR
 
Chl
;

1215 
UCHAR
 
CChl
;

1216 
USHORT
 
Aid
;

1217 
USHORT
 
CabyInfo
;

1218 
USHORT
 
BcPiod
;

1219 
USHORT
 
CMaxDuti
;

1220 
USHORT
 
CPiod
;

1221 
USHORT
 
AtimW
;

1225 
UCHAR
 
SupRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

1226 
UCHAR
 
ExtRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

1227 
UCHAR
 
SupReL
;

1228 
UCHAR
 
ExtReL
;

1229 
HT_CAPABILITY_IE
 
HtCaby
;

1230 
UCHAR
 
HtCabyL
;

1231 
ADD_HT_INFO_IE
 
AddHtInfo
;

1232 
EXT_CAP_INFO_ELEMENT
 
ExtCInfo
;

1233 
UCHAR
 
NewExtChlOfft
;

1237 
QOS_CAPABILITY_PARM
 
APQosCaby
;

1238 
EDCA_PARM
 
APEdPm
;

1239 
QBSS_LOAD_PARM
 
APQbssLd
;

1242 
ULONG
 
APRkIe
;

1244 
BSS_TABLE
 
SsidBssTab
;

1245 
BSS_TABLE
 
RmTab
;

1246 
ULONG
 
BssIdx
;

1247 
ULONG
 
RmIdx
;

1249 
BOOLEAN
 
CuReqIsFromNdis
;

1251 
RALINK_TIMER_STRUCT
 
BcTim
, 
SnTim
;

1252 
RALINK_TIMER_STRUCT
 
AuthTim
;

1253 
RALINK_TIMER_STRUCT
 
AssocTim
, 
RssocTim
, 
DissocTim
;

1255 #ifde
CONFIG_STA_SUPPORT


1257 } 
	tMLME_AUX
, *
	tPMLME_AUX
;

1259 
	s_MLME_ADDBA_REQ_STRUCT
{

1260 
UCHAR
 
Wcid
;

1261 
UCHAR
 
pAddr
[
MAC_ADDR_LEN
];

1262 
UCHAR
 
BaBufSize
;

1263 
USHORT
 
TimeOutVue
;

1264 
UCHAR
 
TID
;

1265 
UCHAR
 
Tok
;

1266 
USHORT
 
BaSSeq
;

1267 } 
	tMLME_ADDBA_REQ_STRUCT
, *
	tPMLME_ADDBA_REQ_STRUCT
;

1270 
	s_MLME_DELBA_REQ_STRUCT
{

1271 
UCHAR
 
Wcid
;

1272 
UCHAR
 
Addr
[
MAC_ADDR_LEN
];

1273 
UCHAR
 
TID
;

1274 
UCHAR
 
Int
;

1275 } 
	tMLME_DELBA_REQ_STRUCT
, *
	tPMLME_DELBA_REQ_STRUCT
;

1278 
	s_MLME_ASSOC_REQ_STRUCT
{

1279 
UCHAR
 
Addr
[
MAC_ADDR_LEN
];

1280 
USHORT
 
CabyInfo
;

1281 
USHORT
 
LiIv
;

1282 
ULONG
 
Timeout
;

1283 } 
	tMLME_ASSOC_REQ_STRUCT
, *
	tPMLME_ASSOC_REQ_STRUCT
, 
	tMLME_REASSOC_REQ_STRUCT
, *
	tPMLME_REASSOC_REQ_STRUCT
;

1285 
	s_MLME_DISASSOC_REQ_STRUCT
{

1286 
UCHAR
 
Addr
[
MAC_ADDR_LEN
];

1287 
USHORT
 
Rs
;

1288 } 
	tMLME_DISASSOC_REQ_STRUCT
, *
	tPMLME_DISASSOC_REQ_STRUCT
;

1290 
	s_MLME_AUTH_REQ_STRUCT
 {

1291 
UCHAR
 
Addr
[
MAC_ADDR_LEN
];

1292 
USHORT
 
Alg
;

1293 
ULONG
 
Timeout
;

1294 } 
	tMLME_AUTH_REQ_STRUCT
, *
	tPMLME_AUTH_REQ_STRUCT
;

1296 
	s_MLME_DEAUTH_REQ_STRUCT
 {

1297 
UCHAR
 
Addr
[
MAC_ADDR_LEN
];

1298 
USHORT
 
Rs
;

1299 } 
	tMLME_DEAUTH_REQ_STRUCT
, *
	tPMLME_DEAUTH_REQ_STRUCT
;

1302 
ULONG
 
BssIdx
;

1303 } 
	tMLME_JOIN_REQ_STRUCT
;

1305 
	s_MLME_SCAN_REQ_STRUCT
 {

1306 
UCHAR
 
Bssid
[
MAC_ADDR_LEN
];

1307 
UCHAR
 
BssTy
;

1308 
UCHAR
 
SnTy
;

1309 
UCHAR
 
SsidL
;

1310 
CHAR
 
Ssid
[
MAX_LEN_OF_SSID
];

1311 } 
	tMLME_SCAN_REQ_STRUCT
, *
	tPMLME_SCAN_REQ_STRUCT
;

1313 
	s_MLME_START_REQ_STRUCT
 {

1314 
CHAR
 
Ssid
[
MAX_LEN_OF_SSID
];

1315 
UCHAR
 
SsidL
;

1316 } 
	tMLME_START_REQ_STRUCT
, *
	tPMLME_START_REQ_STRUCT
;

1318 #ifde
CONFIG_STA_SUPPORT


1319 #ifde
QOS_DLS_SUPPORT


1321 
	s_RT_802_11_DLS
 {

1322 
USHORT
 
TimeOut
;

1323 
USHORT
 
CouDownTim
;

1324 
NDIS_802_11_MAC_ADDRESS
 
MacAddr
;

1325 
UCHAR
 
Stus
;

1326 
BOOLEAN
 
Vid
;

1327 
RALINK_TIMER_STRUCT
 
Tim
;

1328 
USHORT
 
Sequ
;

1329 
USHORT
 
MacTabMchWCID
;

1330 
BOOLEAN
 
bHTC
;

1331 
PVOID
 
pAd
;

1332 } 
	tRT_802_11_DLS
, *
	tPRT_802_11_DLS
;

1334 
	s_MLME_DLS_REQ_STRUCT
 {

1335 
PRT_802_11_DLS
 
pDLS
;

1336 
USHORT
 
Rs
;

1337 } 
	tMLME_DLS_REQ_STRUCT
, *
	tPMLME_DLS_REQ_STRUCT
;

1341 
	sGNU_PACKED
 {

1342 
UCHAR
 
Eid
;

1343 
UCHAR
 
L
;

1344 
UCHAR
 
O
[1];

1345 } 
	tEID_STRUCT
,*
	tPEID_STRUCT
, 
	tBEACON_EID_STRUCT
, *
	tPBEACON_EID_STRUCT
;

1347 
GNU_PACKED
 
	t_RTMP_TX_RATE_SWITCH


1349 
UCHAR
 
ImNo
;

1350 #ifde
RT_BIG_ENDIAN


1351 
UCHAR
 
Rsv2
:2;

1352 
UCHAR
 
Mode
:2;

1353 
UCHAR
 
Rsv1
:1;

1354 
UCHAR
 
BW
:1;

1355 
UCHAR
 
ShtGI
:1;

1356 
UCHAR
 
STBC
:1;

1358 
UCHAR
 
STBC
:1;

1359 
UCHAR
 
ShtGI
:1;

1360 
UCHAR
 
BW
:1;

1361 
UCHAR
 
Rsv1
:1;

1362 
UCHAR
 
Mode
:2;

1363 
UCHAR
 
Rsv2
:2;

1365 
UCHAR
 
CuMCS
;

1366 
UCHAR
 
TUp
;

1367 
UCHAR
 
TDown
;

1368 
	}
} 
	tRRTMP_TX_RATE_SWITCH
, *
	tPRTMP_TX_RATE_SWITCH
;

1371 
	s_RTMP_TX_RATE_SWITCH_3S


1373 
UCHAR
 
	mImNo
;

1374 #ifde
RT_BIG_ENDIAN


1375 
UCHAR
 
	mRsv2
:2;

1376 
UCHAR
 
	mMode
:2;

1377 
UCHAR
 
	mRsv1
:1;

1378 
UCHAR
 
	mBW
:1;

1379 
UCHAR
 
	mShtGI
:1;

1380 
UCHAR
 
	mSTBC
:1;

1382 
UCHAR
 
	mSTBC
:1;

1383 
UCHAR
 
	mShtGI
:1;

1384 
UCHAR
 
	mBW
:1;

1385 
UCHAR
 
	mRsv1
:1;

1386 
UCHAR
 
	mMode
:2;

1387 
UCHAR
 
	mRsv2
:2;

1389 
UCHAR
 
	mCuMCS
;

1390 
UCHAR
 
	mTUp
;

1391 
UCHAR
 
	mTDown
;

1392 
UCHAR
 
	mdownMcs
;

1393 
UCHAR
 
	mupMcs3
;

1394 
UCHAR
 
	mupMcs2
;

1395 
UCHAR
 
	mupMcs1
;

1396 
UCHAR
 
	mdaRe
;

1397 } 
	tRRTMP_TX_RATE_SWITCH_3S
, *
	tPRTMP_TX_RATE_SWITCH_3S
;

1401 
	#TBTT_PRELOAD_TIME
 384

1402 
	#DEFAULT_DTIM_PERIOD
 1

	)

1409 
	#MAC_TABLE_AGEOUT_TIME
 300

1410 
	#MAC_TABLE_MIN_AGEOUT_TIME
 60

1411 
	#MAC_TABLE_ASSOC_TIMEOUT
 5

1412 
	#MAC_TABLE_FULL
(
Tab
((Tab).
size
 =
MAX_LEN_OF_MAC_TABLE
)

	)

1415 
	#MAC_ENTRY_LIFE_CHECK_CNT
 1024

1416 

	)

1418 
	e_S
 {

1419 
	mSST_NOT_AUTH
,

1420 
	mSST_AUTH
,

1421 
	mSST_ASSOC


1422 } 
	tSST
;

1425 
	e_AuthS
 {

1426 
	mAS_NOT_AUTH
,

1427 
	mAS_AUTH_OPEN
,

1428 
	mAS_AUTH_KEY
,

1429 
	mAS_AUTHENTICATING


1430 } 
	tAUTH_STATE
;

	@include/netif_block.h

28 #ide
__NET_IF_BLOCK_H__


29 
	#__NET_IF_BLOCK_H__


	)

31 
	~"lk_li.h
"

32 
	~"mp.h
"

34 
	#FREE_NETIF_POOL_SIZE
 32

	)

36 
	s_NETIF_ENTRY


38 
_NETIF_ENTRY
 *
	mpNext
;

39 
PNET_DEV
 
	mpNDev
;

40 } 
	tNETIF_ENTRY
, *
	tPNETIF_ENTRY
;

42 
blockQueueTab
(

43 
IN
 
PRTMP_ADAPTER
 
pAd
);

45 
BOOLEAN
 
blockNIf
(

46 
IN
 
PBLOCK_QUEUE_ENTRY
 
pBlockQueueEry
,

47 
IN
 
PNET_DEV
 
pNDev
);

49 
VOID
 
aNIf
(

50 
IN
 
PBLOCK_QUEUE_ENTRY
 
pBlockQueueEry
);

52 
VOID
 
StNIfQueue
(

53 
IN
 
PRTMP_ADAPTER
 
pAd
,

54 
IN
 
UCHAR
 
QueIdx
,

55 
IN
 
PNDIS_PACKET
 
pPack
);

	@include/oid.h

37 #ide
_OID_H_


38 
	#_OID_H_


	)

42 #ide
TRUE


43 
	#TRUE
 1

	)

45 #ide
FALSE


46 
	#FALSE
 0

	)

51 
	#MAX_TX_POWER_LEVEL
 100

	)

52 
	#MAX_RSSI_TRIGGER
 -10

	)

53 
	#MIN_RSSI_TRIGGER
 -200

	)

54 
	#MAX_FRAG_THRESHOLD
 2346

	)

55 
	#MIN_FRAG_THRESHOLD
 256

	)

56 
	#MAX_RTS_THRESHOLD
 2347

	)

60 
	#EXTCHA_NONE
 0

	)

61 
	#EXTCHA_ABOVE
 0x1

	)

62 
	#EXTCHA_BELOW
 0x3

	)

65 
	#BAND_WIDTH_20
 0

	)

66 
	#BAND_WIDTH_40
 1

	)

67 
	#BAND_WIDTH_BOTH
 2

	)

68 
	#BAND_WIDTH_10
 3

70 
	#GAP_INTERVAL_400
 1

71 
	#GAP_INTERVAL_800
 0

	)

72 
	#GAP_INTERVAL_BOTH
 2

	)

74 
	#NdisMedSCed
 1

	)

75 
	#NdisMedSDisced
 0

	)

77 
	#NDIS_802_11_LENGTH_SSID
 32

	)

79 
	#IEEE80211_ADDR_LEN
 6

	)

80 
	#IEEE80211_NWID_LEN
 32

	)

82 
	#NDIS_802_11_LENGTH_RATES
 8

	)

83 
	#NDIS_802_11_LENGTH_RATES_EX
 16

	)

84 
	#MAC_ADDR_LENGTH
 6

	)

86 
	#MAX_NUM_OF_CHS
 54

87 
	#MAX_NUMBER_OF_EVENT
 10

88 
	#MAX_NUMBER_OF_MAC
 32

89 
	#MAX_NUMBER_OF_ACL
 64

	)

90 
	#MAX_LENGTH_OF_SUPPORT_RATES
 12

91 
	#MAX_NUMBER_OF_DLS_ENTRY
 4

	)

94 
	#RT_QUERY_SIGNAL_CONTEXT
 0x0402

	)

95 
	#RT_SET_IAPP_PID
 0x0404

	)

96 
	#RT_SET_APD_PID
 0x0405

	)

97 
	#RT_SET_DEL_MAC_ENTRY
 0x0406

	)

98 
	#RT_QUERY_EVENT_TABLE
 0x0407

	)

102 
	#OID_GET_SET_TOGGLE
 0x8000

	)

103 
	#OID_GET_SET_FROM_UI
 0x4000

	)

105 
	#OID_802_11_NETWORK_TYPES_SUPPORTED
 0x0103

	)

106 
	#OID_802_11_NETWORK_TYPE_IN_USE
 0x0104

	)

107 
	#OID_802_11_RSSI_TRIGGER
 0x0107

	)

108 
	#RT_OID_802_11_RSSI
 0x0108

109 
	#RT_OID_802_11_RSSI_1
 0x0109

110 
	#RT_OID_802_11_RSSI_2
 0x010A

111 
	#OID_802_11_NUMBER_OF_ANTENNAS
 0x010B

	)

112 
	#OID_802_11_RX_ANTENNA_SELECTED
 0x010C

	)

113 
	#OID_802_11_TX_ANTENNA_SELECTED
 0x010D

	)

114 
	#OID_802_11_SUPPORTED_RATES
 0x010E

	)

115 
	#OID_802_11_ADD_WEP
 0x0112

	)

116 
	#OID_802_11_REMOVE_WEP
 0x0113

	)

117 
	#OID_802_11_DISASSOCIATE
 0x0114

	)

118 
	#OID_802_11_PRIVACY_FILTER
 0x0118

	)

119 
	#OID_802_11_ASSOCIATION_INFORMATION
 0x011E

	)

120 
	#OID_802_11_TEST
 0x011F

	)

123 
	#RT_OID_802_11_COUNTRY_REGION
 0x0507

	)

124 
	#OID_802_11_BSSID_LIST_SCAN
 0x0508

	)

125 
	#OID_802_11_SSID
 0x0509

	)

126 
	#OID_802_11_BSSID
 0x050A

	)

127 
	#RT_OID_802_11_RADIO
 0x050B

	)

128 
	#RT_OID_802_11_PHY_MODE
 0x050C

	)

129 
	#RT_OID_802_11_STA_CONFIG
 0x050D

	)

130 
	#OID_802_11_DESIRED_RATES
 0x050E

	)

131 
	#RT_OID_802_11_PREAMBLE
 0x050F

	)

132 
	#OID_802_11_WEP_STATUS
 0x0510

	)

133 
	#OID_802_11_AUTHENTICATION_MODE
 0x0511

	)

134 
	#OID_802_11_INFRASTRUCTURE_MODE
 0x0512

	)

135 
	#RT_OID_802_11_RESET_COUNTERS
 0x0513

	)

136 
	#OID_802_11_RTS_THRESHOLD
 0x0514

	)

137 
	#OID_802_11_FRAGMENTATION_THRESHOLD
 0x0515

	)

138 
	#OID_802_11_POWER_MODE
 0x0516

	)

139 
	#OID_802_11_TX_POWER_LEVEL
 0x0517

	)

140 
	#RT_OID_802_11_ADD_WPA
 0x0518

	)

141 
	#OID_802_11_REMOVE_KEY
 0x0519

	)

142 
	#OID_802_11_ADD_KEY
 0x0520

	)

143 
	#OID_802_11_CONFIGURATION
 0x0521

	)

144 
	#OID_802_11_TX_PACKET_BURST
 0x0522

	)

145 
	#RT_OID_802_11_QUERY_NOISE_LEVEL
 0x0523

	)

146 
	#RT_OID_802_11_EXTRA_INFO
 0x0524

	)

147 
	#RT_OID_802_11_HARDWARE_REGISTER
 0x0525

	)

148 
	#OID_802_11_ENCRYPTION_STATUS
 
OID_802_11_WEP_STATUS


	)

149 
	#OID_802_11_DEAUTHENTICATION
 0x0526

	)

150 
	#OID_802_11_DROP_UNENCRYPTED
 0x0527

	)

151 
	#OID_802_11_MIC_FAILURE_REPORT_FRAME
 0x0528

	)

152 
	#OID_802_11_EAP_METHOD
 0x0529

	)

155 #ifde
DOT1X_SUPPORT


156 
	#OID_802_DOT1X_CONFIGURATION
 0x0540

	)

157 
	#OID_802_DOT1X_PMKID_CACHE
 0x0541

	)

158 
	#OID_802_DOT1X_RADIUS_DATA
 0x0542

	)

159 
	#OID_802_DOT1X_WPA_KEY
 0x0543

	)

160 
	#OID_802_DOT1X_STATIC_WEP_COPY
 0x0544

	)

161 
	#OID_802_DOT1X_IDLE_TIMEOUT
 0x0545

	)

164 
	#RT_OID_DEVICE_NAME
 0x0607

	)

165 
	#RT_OID_VERSION_INFO
 0x0608

	)

166 
	#OID_802_11_BSSID_LIST
 0x0609

	)

167 
	#OID_802_3_CURRENT_ADDRESS
 0x060A

	)

168 
	#OID_GEN_MEDIA_CONNECT_STATUS
 0x060B

	)

169 
	#RT_OID_802_11_QUERY_LINK_STATUS
 0x060C

	)

170 
	#OID_802_11_RSSI
 0x060D

	)

171 
	#OID_802_11_STATISTICS
 0x060E

	)

172 
	#OID_GEN_RCV_OK
 0x060F

	)

173 
	#OID_GEN_RCV_NO_BUFFER
 0x0610

	)

174 
	#RT_OID_802_11_QUERY_EEPROM_VERSION
 0x0611

	)

175 
	#RT_OID_802_11_QUERY_FIRMWARE_VERSION
 0x0612

	)

176 
	#RT_OID_802_11_QUERY_LAST_RX_RATE
 0x0613

	)

177 
	#RT_OID_802_11_TX_POWER_LEVEL_1
 0x0614

	)

178 
	#RT_OID_802_11_QUERY_PIDVID
 0x0615

	)

180 
	#OID_SET_COUNTERMEASURES
 0x0616

	)

181 
	#OID_802_11_SET_IEEE8021X
 0x0617

	)

182 
	#OID_802_11_SET_IEEE8021X_REQUIRE_KEY
 0x0618

	)

183 
	#OID_802_11_PMKID
 0x0620

	)

184 
	#RT_OID_WPA_SUPPLICANT_SUPPORT
 0x0621

	)

185 
	#RT_OID_WE_VERSION_COMPILED
 0x0622

	)

186 
	#RT_OID_NEW_DRIVER
 0x0623

	)

187 
	#OID_AUTO_PROVISION_BSSID_LIST
 0x0624

	)

188 
	#RT_OID_WPS_PROBE_REQ_IE
 0x0625

	)

190 
	#RT_OID_802_11_SNR_0
 0x0630

	)

191 
	#RT_OID_802_11_SNR_1
 0x0631

	)

192 
	#RT_OID_802_11_QUERY_LAST_TX_RATE
 0x0632

	)

193 
	#RT_OID_802_11_QUERY_HT_PHYMODE
 0x0633

	)

194 
	#RT_OID_802_11_SET_HT_PHYMODE
 0x0634

	)

195 
	#OID_802_11_RELOAD_DEFAULTS
 0x0635

	)

196 
	#RT_OID_802_11_QUERY_APSD_SETTING
 0x0636

	)

197 
	#RT_OID_802_11_SET_APSD_SETTING
 0x0637

	)

198 
	#RT_OID_802_11_QUERY_APSD_PSM
 0x0638

	)

199 
	#RT_OID_802_11_SET_APSD_PSM
 0x0639

	)

200 
	#RT_OID_802_11_QUERY_DLS
 0x063A

	)

201 
	#RT_OID_802_11_SET_DLS
 0x063B

	)

202 
	#RT_OID_802_11_QUERY_DLS_PARAM
 0x063C

	)

203 
	#RT_OID_802_11_SET_DLS_PARAM
 0x063D

	)

204 
	#RT_OID_802_11_QUERY_WMM
 0x063E

	)

205 
	#RT_OID_802_11_SET_WMM
 0x063F

	)

206 
	#RT_OID_802_11_QUERY_IMME_BA_CAP
 0x0640

	)

207 
	#RT_OID_802_11_SET_IMME_BA_CAP
 0x0641

	)

208 
	#RT_OID_802_11_QUERY_BATABLE
 0x0642

	)

209 
	#RT_OID_802_11_ADD_IMME_BA
 0x0643

	)

210 
	#RT_OID_802_11_TEAR_IMME_BA
 0x0644

	)

211 
	#RT_OID_DRIVER_DEVICE_NAME
 0x0645

	)

212 
	#RT_OID_802_11_QUERY_DAT_HT_PHYMODE
 0x0646

	)

213 
	#RT_OID_QUERY_MULTIPLE_CARD_SUPPORT
 0x0647

	)

214 
	#OID_802_11_SET_PSPXLINK_MODE
 0x0648

	)

216 
	#OID_802_11_SET_PASSPHRASE
 0x0649

	)

217 
	#RT_OID_802_11_QUERY_TX_PHYMODE
 0x0650

	)

218 
	#RT_OID_802_11_QUERY_MAP_REAL_TX_RATE
 0x0678

	)

219 
	#RT_OID_802_11_QUERY_MAP_REAL_RX_RATE
 0x0679

	)

220 
	#RT_OID_802_11_SNR_2
 0x067A

	)

225 #ifde
HOSTAPD_SUPPORT


226 
	#SIOCSIWGENIE
 0x8B30

	)

227 
	#OID_HOSTAPD_SUPPORT
 0x0661

	)

229 
	#HOSTAPD_OID_STATIC_WEP_COPY
 0x0662

	)

230 
	#HOSTAPD_OID_GET_1X_GROUP_KEY
 0x0663

	)

232 
	#HOSTAPD_OID_SET_STA_AUTHORIZED
 0x0664

	)

233 
	#HOSTAPD_OID_SET_STA_DISASSOC
 0x0665

	)

234 
	#HOSTAPD_OID_SET_STA_DEAUTH
 0x0666

	)

235 
	#HOSTAPD_OID_DEL_KEY
 0x0667

	)

236 
	#HOSTAPD_OID_SET_KEY
 0x0668

	)

237 
	#HOSTAPD_OID_SET_802_1X
 0x0669

	)

238 
	#HOSTAPD_OID_GET_SEQ
 0x0670

	)

239 
	#HOSTAPD_OID_GETWPAIE
 0x0671

	)

240 
	#HOSTAPD_OID_COUNTERMEASURES
 0x0672

	)

241 
	#HOSTAPD_OID_SET_WPAPSK
 0x0673

	)

242 
	#HOSTAPD_OID_SET_WPS_BEACON_IE
 0x0674

	)

243 
	#HOSTAPD_OID_SET_WPS_PROBE_RESP_IE
 0x0675

	)

245 
	#RT_HOSTAPD_OID_HOSTAPD_SUPPORT
 (
OID_GET_SET_TOGGLE
 | 
OID_HOSTAPD_SUPPORT
)

	)

246 
	#RT_HOSTAPD_OID_STATIC_WEP_COPY
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_STATIC_WEP_COPY
)

	)

247 
	#RT_HOSTAPD_OID_GET_1X_GROUP_KEY
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_GET_1X_GROUP_KEY
)

	)

248 
	#RT_HOSTAPD_OID_SET_STA_AUTHORIZED
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_SET_STA_AUTHORIZED
)

	)

249 
	#RT_HOSTAPD_OID_SET_STA_DISASSOC
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_SET_STA_DISASSOC
)

	)

250 
	#RT_HOSTAPD_OID_SET_STA_DEAUTH
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_SET_STA_DEAUTH
)

	)

251 
	#RT_HOSTAPD_OID_DEL_KEY
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_DEL_KEY
)

	)

252 
	#RT_HOSTAPD_OID_SET_KEY
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_SET_KEY
)

	)

253 
	#RT_HOSTAPD_OID_SET_802_1X
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_SET_802_1X
)

	)

254 
	#RT_HOSTAPD_OID_COUNTERMEASURES
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_COUNTERMEASURES
)

	)

255 
	#RT_HOSTAPD_OID_SET_WPAPSK
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_SET_WPAPSK
)

	)

256 
	#RT_HOSTAPD_OID_SET_WPS_BEACON_IE
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_SET_WPS_BEACON_IE
)

	)

257 
	#RT_HOSTAPD_OID_SET_WPS_PROBE_RESP_IE
 (
OID_GET_SET_TOGGLE
 | 
HOSTAPD_OID_SET_WPS_PROBE_RESP_IE
)

	)

260 
	#IEEE80211_IS_MULTICAST
(
_a
(*(_a& 0x01)

	)

261 
	#IEEE80211_KEYBUF_SIZE
 16

	)

262 
	#IEEE80211_MICBUF_SIZE
 (8 + 8

	)

263 
	#IEEE80211_TID_SIZE
 17

	)

265 
	#IEEE80211_MLME_ASSOC
 1

	)

266 
	#IEEE80211_MLME_DISASSOC
 2

	)

267 
	#IEEE80211_MLME_DEAUTH
 3

	)

268 
	#IEEE80211_MLME_AUTHORIZE
 4

	)

269 
	#IEEE80211_MLME_UNAUTHORIZE
 5

	)

270 
	#IEEE80211_MLME_CLEAR_STATS
 6

	)

271 
	#IEEE80211_1X_COPY_KEY
 7

	)

273 
	#IEEE80211_MAX_OPT_IE
 256

	)

274 
	#IWEVEXPIRED
 0x8C04

	)

276 
	s80211q_mlme
 {

277 
UINT8
 
	mim_
;

278 
UINT8
 
	mim_ssid_n
;

279 
UINT16
 
	mim_as
;

280 
UINT8
 
	mim_maddr
[
IEEE80211_ADDR_LEN
];

281 
UINT8
 
	mim_ssid
[
IEEE80211_NWID_LEN
];

284 
	s80211q_key
 {

285 
UINT8
 
	mik_ty
;

286 
UINT8
 
	mik_d
;

287 
UINT16
 
	mik_keyix
;

288 
UINT8
 
	mik_keyn
;

289 
UINT8
 
	mik_ags
;

290 
UINT8
 
	mik_maddr
[
IEEE80211_ADDR_LEN
];

291 
UINT64
 
	mik_keyrsc
;

292 
UINT64
 
	mik_keytsc
;

293 
UINT8
 
	mik_keyda
[
IEEE80211_KEYBUF_SIZE
+
IEEE80211_MICBUF_SIZE
];

294 
	mtxkey
;

297 
	s80211q_d_key
 {

298 
UINT8
 
	midk_keyix
;

299 
UINT8
 
	midk_maddr
[
IEEE80211_ADDR_LEN
];

302 
	sdeu_group_key
 {

303 
UINT16
 
	mik_keyix
;

304 
UINT8
 
	mik_keyn
;

305 
UINT8
 
	mik_keyda
[
IEEE80211_KEYBUF_SIZE
+
IEEE80211_MICBUF_SIZE
];

308 
	s80211q_w
 {

309 
UINT8
 
	mw_maddr
[
IEEE80211_ADDR_LEN
];

310 
UINT8
 
	mw_
[
IEEE80211_MAX_OPT_IE
];

311 
UINT8
 
	mr_
[
IEEE80211_MAX_OPT_IE
];

314 
	shod_w_psk
 {

315 
hod_w_psk
 *
	mxt
;

316 
	mgroup
;

317 
UCHAR
 
	mpsk
[32];

318 
UCHAR
 
	maddr
[6];

323 
	#RT_OID_802_11_QUERY_TDLS_PARAM
 0x0676

	)

324 
	#RT_OID_802_11_QUERY_TDLS
 0x0677

	)

329 
	#RT_OID_802_11_BSSID
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_BSSID
)

	)

330 
	#RT_OID_802_11_SSID
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_SSID
)

	)

331 
	#RT_OID_802_11_INFRASTRUCTURE_MODE
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_INFRASTRUCTURE_MODE
)

	)

332 
	#RT_OID_802_11_ADD_WEP
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_ADD_WEP
)

	)

333 
	#RT_OID_802_11_ADD_KEY
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_ADD_KEY
)

	)

334 
	#RT_OID_802_11_REMOVE_WEP
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_REMOVE_WEP
)

	)

335 
	#RT_OID_802_11_REMOVE_KEY
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_REMOVE_KEY
)

	)

336 
	#RT_OID_802_11_DISASSOCIATE
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_DISASSOCIATE
)

	)

337 
	#RT_OID_802_11_AUTHENTICATION_MODE
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_AUTHENTICATION_MODE
)

	)

338 
	#RT_OID_802_11_PRIVACY_FILTER
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_PRIVACY_FILTER
)

	)

339 
	#RT_OID_802_11_BSSID_LIST_SCAN
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_BSSID_LIST_SCAN
)

	)

340 
	#RT_OID_802_11_WEP_STATUS
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_WEP_STATUS
)

	)

341 
	#RT_OID_802_11_RELOAD_DEFAULTS
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_RELOAD_DEFAULTS
)

	)

342 
	#RT_OID_802_11_NETWORK_TYPE_IN_USE
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_NETWORK_TYPE_IN_USE
)

	)

343 
	#RT_OID_802_11_TX_POWER_LEVEL
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_TX_POWER_LEVEL
)

	)

344 
	#RT_OID_802_11_RSSI_TRIGGER
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_RSSI_TRIGGER
)

	)

345 
	#RT_OID_802_11_FRAGMENTATION_THRESHOLD
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_FRAGMENTATION_THRESHOLD
)

	)

346 
	#RT_OID_802_11_RTS_THRESHOLD
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_RTS_THRESHOLD
)

	)

347 
	#RT_OID_802_11_RX_ANTENNA_SELECTED
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_RX_ANTENNA_SELECTED
)

	)

348 
	#RT_OID_802_11_TX_ANTENNA_SELECTED
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_TX_ANTENNA_SELECTED
)

	)

349 
	#RT_OID_802_11_SUPPORTED_RATES
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_SUPPORTED_RATES
)

	)

350 
	#RT_OID_802_11_DESIRED_RATES
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_DESIRED_RATES
)

	)

351 
	#RT_OID_802_11_CONFIGURATION
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_CONFIGURATION
)

	)

352 
	#RT_OID_802_11_POWER_MODE
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_POWER_MODE
)

	)

353 
	#RT_OID_802_11_SET_PSPXLINK_MODE
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_SET_PSPXLINK_MODE
)

	)

354 
	#RT_OID_802_11_EAP_METHOD
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_EAP_METHOD
)

	)

355 
	#RT_OID_802_11_SET_PASSPHRASE
 (
OID_GET_SET_TOGGLE
 | 
OID_802_11_SET_PASSPHRASE
)

	)

357 #ifde
DOT1X_SUPPORT


358 
	#RT_OID_802_DOT1X_PMKID_CACHE
 (
OID_GET_SET_TOGGLE
 | 
OID_802_DOT1X_PMKID_CACHE
)

	)

359 
	#RT_OID_802_DOT1X_RADIUS_DATA
 (
OID_GET_SET_TOGGLE
 | 
OID_802_DOT1X_RADIUS_DATA
)

	)

360 
	#RT_OID_802_DOT1X_WPA_KEY
 (
OID_GET_SET_TOGGLE
 | 
OID_802_DOT1X_WPA_KEY
)

	)

361 
	#RT_OID_802_DOT1X_STATIC_WEP_COPY
 (
OID_GET_SET_TOGGLE
 | 
OID_802_DOT1X_STATIC_WEP_COPY
)

	)

362 
	#RT_OID_802_DOT1X_IDLE_TIMEOUT
 (
OID_GET_SET_TOGGLE
 | 
OID_802_DOT1X_IDLE_TIMEOUT
)

	)

365 
	#RT_OID_802_11_SET_TDLS_PARAM
 (
OID_GET_SET_TOGGLE
 | 
RT_OID_802_11_QUERY_TDLS_PARAM
)

	)

366 
	#RT_OID_802_11_SET_TDLS
 (
OID_GET_SET_TOGGLE
 | 
RT_OID_802_11_QUERY_TDLS
)

	)

369 
	e_NDIS_802_11_STATUS_TYPE


371 
	mNdis802_11StusTy_Authtiti
,

372 
	mNdis802_11StusTy_MedSmMode
,

373 
	mNdis802_11StusTy_PMKID_CdideLi
,

374 
	mNdis802_11StusTyMax


375 } 
	tNDIS_802_11_STATUS_TYPE
, *
	tPNDIS_802_11_STATUS_TYPE
;

377 
UCHAR
 
	tNDIS_802_11_MAC_ADDRESS
[6];

379 
	s_NDIS_802_11_STATUS_INDICATION


381 
NDIS_802_11_STATUS_TYPE
 
	mStusTy
;

382 } 
	tNDIS_802_11_STATUS_INDICATION
, *
	tPNDIS_802_11_STATUS_INDICATION
;

385 
	#NDIS_802_11_AUTH_REQUEST_AUTH_FIELDS
 0x0f

	)

387 
	#NDIS_802_11_AUTH_REQUEST_REAUTH
 0x01

	)

388 
	#NDIS_802_11_AUTH_REQUEST_KEYUPDATE
 0x02

	)

389 
	#NDIS_802_11_AUTH_REQUEST_PAIRWISE_ERROR
 0x06

	)

390 
	#NDIS_802_11_AUTH_REQUEST_GROUP_ERROR
 0x0E

	)

392 
	s_NDIS_802_11_AUTHENTICATION_REQUEST


394 
ULONG
 
	mLgth
;

395 
NDIS_802_11_MAC_ADDRESS
 
	mBssid
;

396 
ULONG
 
	mFgs
;

397 } 
	tNDIS_802_11_AUTHENTICATION_REQUEST
, *
	tPNDIS_802_11_AUTHENTICATION_REQUEST
;

400 
	s_PMKID_CANDIDATE
 {

401 
NDIS_802_11_MAC_ADDRESS
 
	mBSSID
;

402 
ULONG
 
	mFgs
;

403 } 
	tPMKID_CANDIDATE
, *
	tPPMKID_CANDIDATE
;

405 
	s_NDIS_802_11_PMKID_CANDIDATE_LIST


407 
ULONG
 
	mVsi
;

408 
ULONG
 
	mNumCdides
;

409 
PMKID_CANDIDATE
 
	mCdideLi
[1];

410 } 
	tNDIS_802_11_PMKID_CANDIDATE_LIST
, *
	tPNDIS_802_11_PMKID_CANDIDATE_LIST
;

413 
	#NDIS_802_11_PMKID_CANDIDATE_PREAUTH_ENABLED
 0x01

	)

416 
	e_NDIS_802_11_NETWORK_TYPE


418 
	mNdis802_11FH
,

419 
	mNdis802_11DS
,

420 
	mNdis802_11OFDM5
,

421 
	mNdis802_11OFDM24
,

422 
	mNdis802_11Automode
,

423 
	mNdis802_11OFDM5_N
,

424 
	mNdis802_11OFDM24_N
,

425 
	mNdis802_11NwkTyMax


426 } 
	tNDIS_802_11_NETWORK_TYPE
, *
	tPNDIS_802_11_NETWORK_TYPE
;

428 
	s_NDIS_802_11_NETWORK_TYPE_LIST


430 
UINT
 
	mNumbOfIms
;

431 
NDIS_802_11_NETWORK_TYPE
 
	mNwkTy
 [1];

432 } 
	tNDIS_802_11_NETWORK_TYPE_LIST
, *
	tPNDIS_802_11_NETWORK_TYPE_LIST
;

434 
	e_NDIS_802_11_POWER_MODE


436 
	mNdis802_11PowModeCAM
,

437 
	mNdis802_11PowModeMAX_PSP
,

438 
	mNdis802_11PowModeFa_PSP
,

439 
	mNdis802_11PowModeLegacy_PSP
,

440 
	mNdis802_11PowModeMax


441 } 
	tNDIS_802_11_POWER_MODE
, *
	tPNDIS_802_11_POWER_MODE
;

443 
ULONG
 
	tNDIS_802_11_TX_POWER_LEVEL
;

448 
LONG
 
	tNDIS_802_11_RSSI
;

450 
	s_NDIS_802_11_CONFIGURATION_FH


452 
ULONG
 
	mLgth
;

453 
ULONG
 
	mHP
;

454 
ULONG
 
	mHS
;

455 
ULONG
 
	mDwlTime
;

456 } 
	tNDIS_802_11_CONFIGURATION_FH
, *
	tPNDIS_802_11_CONFIGURATION_FH
;

458 
	s_NDIS_802_11_CONFIGURATION


460 
ULONG
 
	mLgth
;

461 
ULONG
 
	mBcPiod
;

462 
ULONG
 
	mATIMWdow
;

463 
ULONG
 
	mDSCfig
;

464 
NDIS_802_11_CONFIGURATION_FH
 
	mFHCfig
;

465 } 
	tNDIS_802_11_CONFIGURATION
, *
	tPNDIS_802_11_CONFIGURATION
;

467 
	s_NDIS_802_11_STATISTICS


469 
ULONG
 
	mLgth
;

470 
LARGE_INTEGER
 
	mTnsmdFgmtCou
;

471 
LARGE_INTEGER
 
	mMuiTnsmdFmeCou
;

472 
LARGE_INTEGER
 
	mFaedCou
;

473 
LARGE_INTEGER
 
	mRryCou
;

474 
LARGE_INTEGER
 
	mMuɝRryCou
;

475 
LARGE_INTEGER
 
	mRTSSucssCou
;

476 
LARGE_INTEGER
 
	mRTSFauCou
;

477 
LARGE_INTEGER
 
	mACKFauCou
;

478 
LARGE_INTEGER
 
	mFmeDuiCou
;

479 
LARGE_INTEGER
 
	mReivedFgmtCou
;

480 
LARGE_INTEGER
 
	mMuiReivedFmeCou
;

481 
LARGE_INTEGER
 
	mFCSECou
;

482 
LARGE_INTEGER
 
	mTKIPLolMICFaus
;

483 
LARGE_INTEGER
 
	mTKIPRemeMICEs
;

484 
LARGE_INTEGER
 
	mTKIPICVEs
;

485 
LARGE_INTEGER
 
	mTKIPCouMsusInvoked
;

486 
LARGE_INTEGER
 
	mTKIPRys
;

487 
LARGE_INTEGER
 
	mCCMPFmEs
;

488 
LARGE_INTEGER
 
	mCCMPRys
;

489 
LARGE_INTEGER
 
	mCCMPDeyEs
;

490 
LARGE_INTEGER
 
	mFourWayHdshakeFaus
;

491 } 
	tNDIS_802_11_STATISTICS
, *
	tPNDIS_802_11_STATISTICS
;

493 
ULONG
 
	tNDIS_802_11_KEY_INDEX
;

494 
ULONGLONG
 
	tNDIS_802_11_KEY_RSC
;

496 #ifde
DOT1X_SUPPORT


497 
	#MAX_RADIUS_SRV_NUM
 2

498 

	)

501 
GNU_PACKED
 
	t_RADIUS_SRV_INFO
 {

502 
UINT32
 
	gdius_
;

503 
UINT32
 
	gdius_pt
;

504 
UCHAR
 
	gdius_key
[64];

505 
UCHAR
 
	gdius_key_n
;

506 } 
	tRADIUS_SRV_INFO
, *
	tPRADIUS_SRV_INFO
;

508 
GNU_PACKED
 
	t_DOT1X_BSS_INFO


510 
UCHAR
 
	gdius_v_num
;

511 
RADIUS_SRV_INFO
 
	gdius_v_fo
[
MAX_RADIUS_SRV_NUM
];

512 
UCHAR
 
	g8021xWEP
;

513 
UCHAR
 
	gkey_dex
;

514 
UCHAR
 
	gkey_ngth
;

515 
UCHAR
 
	gkey_ml
[13];

516 
UCHAR
 
	gsId
[
IFNAMSIZ
];

517 
UCHAR
 
	gsId_n
;

518 } 
	tDOT1X_BSS_INFO
, *
	tPDOT1X_BSS_INFO
;

520 
GNU_PACKED
 
	t_DOT1X_CMM_CONF


522 
UINT32
 
	gLgth
;

523 
UCHAR
 
	gmbss_num
;

524 
UINT32
 
	gown__addr
;

525 
UINT32
 
	gy_rv
;

526 
UINT32
 
	gssi_timeout_rv
;

527 
UINT32
 
	gqut_rv
;

528 
UCHAR
 
	gEAPiame
[8][
IFNAMSIZ
];

529 
UCHAR
 
	gEAPiame_n
[8];

530 
UCHAR
 
	gPAuthiame
[8][
IFNAMSIZ
];

531 
UCHAR
 
	gPAuthiame_n
[8];

532 
DOT1X_BSS_INFO
 
	gD1xBssInfo
[8];

533 } 
	tDOT1X_CMM_CONF
, *
	tPDOT1X_CMM_CONF
;

535 
GNU_PACKED
 
	t_DOT1X_IDLE_TIMEOUT


537 
UCHAR
 
	gSAddr
[6];

538 
UINT32
 
	gid_timeout
;

539 } 
	tDOT1X_IDLE_TIMEOUT
, *
	tPDOT1X_IDLE_TIMEOUT
;

544 #ifde
CONFIG_STA_SUPPORT


546 
	s_NDIS_802_11_KEY


548 
UINT
 
	mLgth
;

549 
UINT
 
	mKeyIndex
;

550 
UINT
 
	mKeyLgth
;

551 
NDIS_802_11_MAC_ADDRESS
 
	mBSSID
;

552 
NDIS_802_11_KEY_RSC
 
	mKeyRSC
;

553 
UCHAR
 
	mKeyMl
[1];

554 } 
	tNDIS_802_11_KEY
, *
	tPNDIS_802_11_KEY
;

556 
	s_NDIS_802_11_PASSPHRASE


558 
UINT
 
	mKeyLgth
;

559 
NDIS_802_11_MAC_ADDRESS
 
	mBSSID
;

560 
UCHAR
 
	mKeyMl
[1];

561 } 
	tNDIS_802_11_PASSPHRASE
, *
	tPNDIS_802_11_PASSPHRASE
;

564 
	s_NDIS_802_11_REMOVE_KEY


566 
UINT
 
	mLgth
;

567 
UINT
 
	mKeyIndex
;

568 
NDIS_802_11_MAC_ADDRESS
 
	mBSSID
;

569 } 
	tNDIS_802_11_REMOVE_KEY
, *
	tPNDIS_802_11_REMOVE_KEY
;

571 
	s_NDIS_802_11_WEP


573 
UINT
 
	mLgth
;

574 
UINT
 
	mKeyIndex
;

576 
UINT
 
	mKeyLgth
;

577 
UCHAR
 
	mKeyMl
[1];

578 } 
	tNDIS_802_11_WEP
, *
	tPNDIS_802_11_WEP
;

581 
	e_NDIS_802_11_NETWORK_INFRASTRUCTURE


583 
	mNdis802_11IBSS
,

584 
	mNdis802_11Inaruu
,

585 
	mNdis802_11AutoUnknown
,

586 
	mNdis802_11Mڙ
,

587 
	mNdis802_11InaruuMax


588 } 
	tNDIS_802_11_NETWORK_INFRASTRUCTURE
, *
	tPNDIS_802_11_NETWORK_INFRASTRUCTURE
;

591 
	e_NDIS_802_11_AUTHENTICATION_MODE


593 
	mNdis802_11AuthModeOn
,

594 
	mNdis802_11AuthModeShed
,

595 
	mNdis802_11AuthModeAutoSwch
,

596 
	mNdis802_11AuthModeWPA
,

597 
	mNdis802_11AuthModeWPAPSK
,

598 
	mNdis802_11AuthModeWPANe
,

599 
	mNdis802_11AuthModeWPA2
,

600 
	mNdis802_11AuthModeWPA2PSK
,

601 
	mNdis802_11AuthModeWPA1WPA2
,

602 
	mNdis802_11AuthModeWPA1PSKWPA2PSK
,

603 
	mNdis802_11AuthModeMax


604 } 
	tNDIS_802_11_AUTHENTICATION_MODE
, *
	tPNDIS_802_11_AUTHENTICATION_MODE
;

606 
UCHAR
 
	tNDIS_802_11_RATES
[
NDIS_802_11_LENGTH_RATES
];

607 
UCHAR
 
	tNDIS_802_11_RATES_EX
[
NDIS_802_11_LENGTH_RATES_EX
];

609 
GNU_PACKED
 
	t_NDIS_802_11_SSID


611 
UINT
 
	gSsidLgth
;

613 
UCHAR
 
	gSsid
[
NDIS_802_11_LENGTH_SSID
];

614 } 
	tNDIS_802_11_SSID
, *
	tPNDIS_802_11_SSID
;

617 
GNU_PACKED
 
	t_NDIS_WLAN_BSSID


619 
ULONG
 
	gLgth
;

620 
NDIS_802_11_MAC_ADDRESS
 
	gMacAddss
;

621 
UCHAR
 
	gRerved
[2];

622 
NDIS_802_11_SSID
 
	gSsid
;

623 
ULONG
 
	gPrivacy
;

624 
NDIS_802_11_RSSI
 
	gRssi
;

625 
NDIS_802_11_NETWORK_TYPE
 
	gNwkTyInU
;

626 
NDIS_802_11_CONFIGURATION
 
	gCfiguti
;

627 
NDIS_802_11_NETWORK_INFRASTRUCTURE
 
	gInaruuMode
;

628 
NDIS_802_11_RATES
 
	gSu܋dRes
;

629 } 
	tNDIS_WLAN_BSSID
, *
	tPNDIS_WLAN_BSSID
;

631 
GNU_PACKED
 
	t_NDIS_802_11_BSSID_LIST


633 
UINT
 
	gNumbOfIms
;

634 
NDIS_WLAN_BSSID
 
	gBssid
[1];

635 } 
	tNDIS_802_11_BSSID_LIST
, *
	tPNDIS_802_11_BSSID_LIST
;

638 
BOOLEAN
 
	mbVid
;

639 
USHORT
 
	mSNum
;

640 
UCHAR
 
	mChlUtizi
;

641 
USHORT
 
	mRemagAdmissiCڌ
;

642 } 
	tQBSS_LOAD_UI
, *
	tPQBSS_LOAD_UI
;

645 
GNU_PACKED
 
	t_NDIS_WLAN_BSSID_EX


647 
ULONG
 
	gLgth
;

648 
NDIS_802_11_MAC_ADDRESS
 
	gMacAddss
;

649 
UCHAR
 
	gRerved
[2];

650 
NDIS_802_11_SSID
 
	gSsid
;

651 
UINT
 
	gPrivacy
;

652 
NDIS_802_11_RSSI
 
	gRssi
;

654 
NDIS_802_11_NETWORK_TYPE
 
	gNwkTyInU
;

655 
NDIS_802_11_CONFIGURATION
 
	gCfiguti
;

656 
NDIS_802_11_NETWORK_INFRASTRUCTURE
 
	gInaruuMode
;

657 
NDIS_802_11_RATES_EX
 
	gSu܋dRes
;

658 
ULONG
 
	gIELgth
;

659 
UCHAR
 
	gIEs
[1];

660 } 
	tNDIS_WLAN_BSSID_EX
, *
	tPNDIS_WLAN_BSSID_EX
;

662 
GNU_PACKED
 
	t_NDIS_802_11_BSSID_LIST_EX


664 
UINT
 
	gNumbOfIms
;

665 
NDIS_WLAN_BSSID_EX
 
	gBssid
[1];

666 } 
	tNDIS_802_11_BSSID_LIST_EX
, *
	tPNDIS_802_11_BSSID_LIST_EX
;

668 
GNU_PACKED
 
	t_NDIS_802_11_FIXED_IEs


670 
UCHAR
 
	gTimeamp
[8];

671 
USHORT
 
	gBcIv
;

672 
USHORT
 
	gCabs
;

673 } 
	tNDIS_802_11_FIXED_IEs
, *
	tPNDIS_802_11_FIXED_IEs
;

675 
	s_NDIS_802_11_VARIABLE_IEs


677 
UCHAR
 
	mEmtID
;

678 
UCHAR
 
	mLgth
;

679 
UCHAR
 
	mda
[1];

680 } 
	tNDIS_802_11_VARIABLE_IEs
, *
	tPNDIS_802_11_VARIABLE_IEs
;

682 
ULONG
 
	tNDIS_802_11_FRAGMENTATION_THRESHOLD
;

684 
ULONG
 
	tNDIS_802_11_RTS_THRESHOLD
;

686 
ULONG
 
	tNDIS_802_11_ANTENNA
;

688 
	e_NDIS_802_11_PRIVACY_FILTER


690 
	mNdis802_11PrivFrAcA
,

691 
	mNdis802_11PrivFr8021xWEP


692 } 
	tNDIS_802_11_PRIVACY_FILTER
, *
	tPNDIS_802_11_PRIVACY_FILTER
;

696 
	e_NDIS_802_11_WEP_STATUS


698 
	mNdis802_11WEPEbd
,

699 
	mNdis802_11Enyi1Ebd
 = 
Ndis802_11WEPEbd
,

700 
	mNdis802_11WEPDibd
,

701 
	mNdis802_11EnyiDibd
 = 
Ndis802_11WEPDibd
,

702 
	mNdis802_11WEPKeyAb
,

703 
	mNdis802_11Enyi1KeyAb
 = 
Ndis802_11WEPKeyAb
,

704 
	mNdis802_11WEPNSu܋d
,

705 
	mNdis802_11EnyiNSu܋d
 = 
Ndis802_11WEPNSu܋d
,

706 
	mNdis802_11Enyi2Ebd
,

707 
	mNdis802_11Enyi2KeyAb
,

708 
	mNdis802_11Enyi3Ebd
,

709 
	mNdis802_11Enyi3KeyAb
,

710 
	mNdis802_11Enyi4Ebd
,

711 
	mNdis802_11Enyi4KeyAb
,

712 
	mNdis802_11GroupWEP40Ebd
,

713 
	mNdis802_11GroupWEP104Ebd
,

714 } 
	tNDIS_802_11_WEP_STATUS
, *
	tPNDIS_802_11_WEP_STATUS
,

715 
	tNDIS_802_11_ENCRYPTION_STATUS
, *
	tPNDIS_802_11_ENCRYPTION_STATUS
;

717 
	e_NDIS_802_11_RELOAD_DEFAULTS


719 
	mNdis802_11RdWEPKeys


720 } 
	tNDIS_802_11_RELOAD_DEFAULTS
, *
	tPNDIS_802_11_RELOAD_DEFAULTS
;

722 
	#NDIS_802_11_AI_REQFI_CAPABILITIES
 1

	)

723 
	#NDIS_802_11_AI_REQFI_LISTENINTERVAL
 2

	)

724 
	#NDIS_802_11_AI_REQFI_CURRENTAPADDRESS
 4

	)

726 
	#NDIS_802_11_AI_RESFI_CAPABILITIES
 1

	)

727 
	#NDIS_802_11_AI_RESFI_STATUSCODE
 2

	)

728 
	#NDIS_802_11_AI_RESFI_ASSOCIATIONID
 4

	)

730 
	s_NDIS_802_11_AI_REQFI


732 
USHORT
 
	mCabs
;

733 
USHORT
 
	mLiIv
;

734 
NDIS_802_11_MAC_ADDRESS
 
	mCutAPAddss
;

735 } 
	tNDIS_802_11_AI_REQFI
, *
	tPNDIS_802_11_AI_REQFI
;

737 
	s_NDIS_802_11_AI_RESFI


739 
USHORT
 
	mCabs
;

740 
USHORT
 
	mStusCode
;

741 
USHORT
 
	mAssoctiId
;

742 } 
	tNDIS_802_11_AI_RESFI
, *
	tPNDIS_802_11_AI_RESFI
;

744 
	s_NDIS_802_11_ASSOCIATION_INFORMATION


746 
ULONG
 
	mLgth
;

747 
USHORT
 
	mAvaabRequeFixedIEs
;

748 
NDIS_802_11_AI_REQFI
 
	mRequeFixedIEs
;

749 
ULONG
 
	mRequeIELgth
;

750 
ULONG
 
	mOfftRequeIEs
;

751 
USHORT
 
	mAvaabReڣFixedIEs
;

752 
NDIS_802_11_AI_RESFI
 
	mReڣFixedIEs
;

753 
ULONG
 
	mReڣIELgth
;

754 
ULONG
 
	mOfftReڣIEs
;

755 } 
	tNDIS_802_11_ASSOCIATION_INFORMATION
, *
	tPNDIS_802_11_ASSOCIATION_INFORMATION
;

757 
	s_NDIS_802_11_AUTHENTICATION_EVENT


759 
NDIS_802_11_STATUS_INDICATION
 
	mStus
;

760 
NDIS_802_11_AUTHENTICATION_REQUEST
 
	mReque
[1];

761 } 
	tNDIS_802_11_AUTHENTICATION_EVENT
, *
	tPNDIS_802_11_AUTHENTICATION_EVENT
;

777 
	e_NDIS_802_11_MEDIA_STREAM_MODE


779 
	mNdis802_11MedSmOff
,

780 
	mNdis802_11MedSmOn
,

781 } 
	tNDIS_802_11_MEDIA_STREAM_MODE
, *
	tPNDIS_802_11_MEDIA_STREAM_MODE
;

784 
UCHAR
 
	tNDIS_802_11_PMKID_VALUE
[16];

786 #ifde
CONFIG_STA_SUPPORT


787 
	s_BSSID_INFO


789 
NDIS_802_11_MAC_ADDRESS
 
	mBSSID
;

790 
NDIS_802_11_PMKID_VALUE
 
	mPMKID
;

791 } 
	tBSSID_INFO
, *
	tPBSSID_INFO
;

793 
	s_NDIS_802_11_PMKID


795 
UINT
 
	mLgth
;

796 
UINT
 
	mBSSIDInfoCou
;

797 
BSSID_INFO
 
	mBSSIDInfo
[1];

798 } 
	tNDIS_802_11_PMKID
, *
	tPNDIS_802_11_PMKID
;

802 
	s_NDIS_802_11_AUTHENTICATION_ENCRYPTION


804 
NDIS_802_11_AUTHENTICATION_MODE
 
	mAuthModeSu܋d
;

805 
NDIS_802_11_ENCRYPTION_STATUS
 
	mEnyStusSu܋d
;

806 } 
	tNDIS_802_11_AUTHENTICATION_ENCRYPTION
, *
	tPNDIS_802_11_AUTHENTICATION_ENCRYPTION
;

808 
	s_NDIS_802_11_CAPABILITY


810 
ULONG
 
	mLgth
;

811 
ULONG
 
	mVsi
;

812 
ULONG
 
	mNoOfPMKIDs
;

813 
ULONG
 
	mNoOfAuthEnyPasSu܋d
;

814 
NDIS_802_11_AUTHENTICATION_ENCRYPTION
 
	mAuthtitiEnyiSu܋d
[1];

815 } 
	tNDIS_802_11_CAPABILITY
, *
	tPNDIS_802_11_CAPABILITY
;

817 #ifde
LINUX


818 #i
WIRELESS_EXT
 <= 11

819 #ide
SIOCDEVPRIVATE


820 
	#SIOCDEVPRIVATE
 0x8BE0

	)

822 
	#SIOCIWFIRSTPRIV
 
SIOCDEVPRIVATE


	)

827 #ifde
CONFIG_STA_SUPPORT


828 
	#RT_PRIV_IOCTL
 (
SIOCIWFIRSTPRIV
 + 0x01)

	)

829 
	#RTPRIV_IOCTL_SET
 (
SIOCIWFIRSTPRIV
 + 0x02)

	)

831 #ifde
DBG


832 
	#RTPRIV_IOCTL_BBP
 (
SIOCIWFIRSTPRIV
 + 0x03)

	)

833 
	#RTPRIV_IOCTL_MAC
 (
SIOCIWFIRSTPRIV
 + 0x05)

	)

835 
	#RTPRIV_IOCTL_E2P
 (
SIOCIWFIRSTPRIV
 + 0x07)

	)

838 #ifde
RALINK_ATE


839 #ifde
RALINK_QA


840 
	#RTPRIV_IOCTL_ATE
 (
SIOCIWFIRSTPRIV
 + 0x08)

	)

844 
	#RTPRIV_IOCTL_STATISTICS
 (
SIOCIWFIRSTPRIV
 + 0x09)

	)

845 
	#RTPRIV_IOCTL_ADD_PMKID_CACHE
 (
SIOCIWFIRSTPRIV
 + 0x0A)

	)

846 
	#RTPRIV_IOCTL_RADIUS_DATA
 (
SIOCIWFIRSTPRIV
 + 0x0C)

	)

847 
	#RTPRIV_IOCTL_GSITESURVEY
 (
SIOCIWFIRSTPRIV
 + 0x0D)

	)

848 
	#RT_PRIV_IOCTL_EXT
 (
SIOCIWFIRSTPRIV
 + 0x0E)

849 
	#RTPRIV_IOCTL_GET_MAC_TABLE
 (
SIOCIWFIRSTPRIV
 + 0x0F)

	)

850 
	#RTPRIV_IOCTL_GET_MAC_TABLE_STRUCT
 (
SIOCIWFIRSTPRIV
 + 0x1F)

851 

	)

852 
	#RTPRIV_IOCTL_SHOW
 (
SIOCIWFIRSTPRIV
 + 0x11)

	)

854 
	mSHOW_CONN_STATUS
 = 4,

855 
	mSHOW_DRVIER_VERION
 = 5,

856 
	mSHOW_BA_INFO
 = 6,

857 
	mSHOW_DESC_INFO
 = 7,

858 
	mRAIO_OFF
 = 10,

859 
	mRAIO_ON
 = 11,

860 #ifde
QOS_DLS_SUPPORT


861 
	mSHOW_DLS_ENTRY_INFO
 = 20,

863 
	mSHOW_CFG_VALUE
 = 21,

864 
	mSHOW_ADHOC_ENTRY_INFO
 = 22,

872 #ifde
SNMP_SUPPORT


875 
	#RT_OID_802_11_MANUFACTUREROUI
 0x0700

	)

876 
	#RT_OID_802_11_MANUFACTURERNAME
 0x0701

	)

877 
	#RT_OID_802_11_RESOURCETYPEIDNAME
 0x0702

	)

880 
	#RT_OID_802_11_PRIVACYOPTIONIMPLEMENTED
 0x0703

	)

881 
	#RT_OID_802_11_POWERMANAGEMENTMODE
 0x0704

	)

882 
	#OID_802_11_WEPDEFAULTKEYVALUE
 0x0705

883 
	#OID_802_11_WEPDEFAULTKEYID
 0x0706

	)

884 
	#RT_OID_802_11_WEPKEYMAPPINGLENGTH
 0x0707

	)

885 
	#OID_802_11_SHORTRETRYLIMIT
 0x0708

	)

886 
	#OID_802_11_LONGRETRYLIMIT
 0x0709

	)

887 
	#RT_OID_802_11_PRODUCTID
 0x0710

	)

888 
	#RT_OID_802_11_MANUFACTUREID
 0x0711

	)

891 
	#OID_802_11_CURRENTCHANNEL
 0x0712

	)

894 
	#RT_OID_802_11_MAC_ADDRESS
 0x0713

	)

897 
	#OID_802_11_BUILD_CHANNEL_EX
 0x0714

	)

898 
	#OID_802_11_GET_CH_LIST
 0x0715

	)

899 
	#OID_802_11_GET_COUNTRY_CODE
 0x0716

	)

900 
	#OID_802_11_GET_CHANNEL_GEOGRAPHY
 0x0717

	)

904 #ifde
CONFIG_STA_SUPPORT


905 
	#RT_OID_WSC_SET_PASSPHRASE
 0x0740

906 
	#RT_OID_WSC_DRIVER_AUTO_CONNECT
 0x0741

	)

907 
	#RT_OID_WSC_QUERY_DEFAULT_PROFILE
 0x0742

	)

908 
	#RT_OID_WSC_SET_CONN_BY_PROFILE_INDEX
 0x0743

	)

909 
	#RT_OID_WSC_SET_ACTION
 0x0744

	)

910 
	#RT_OID_WSC_SET_SSID
 0x0745

	)

911 
	#RT_OID_WSC_SET_PIN_CODE
 0x0746

	)

912 
	#RT_OID_WSC_SET_MODE
 0x0747

913 
	#RT_OID_WSC_SET_CONF_MODE
 0x0748

914 
	#RT_OID_WSC_SET_PROFILE
 0x0749

	)

916 
	#RT_OID_WSC_CONFIG_STATUS
 0x074F

	)

917 
	#RT_OID_802_11_WSC_QUERY_PROFILE
 0x0750

	)

919 
	#RT_OID_WSC_QUERY_STATUS
 0x0751

	)

920 
	#RT_OID_WSC_PIN_CODE
 0x0752

	)

921 
	#RT_OID_WSC_UUID
 0x0753

	)

922 
	#RT_OID_WSC_SET_SELECTED_REGISTRAR
 0x0754

	)

923 
	#RT_OID_WSC_EAPMSG
 0x0755

	)

924 
	#RT_OID_WSC_MANUFACTURER
 0x0756

	)

925 
	#RT_OID_WSC_MODEL_NAME
 0x0757

	)

926 
	#RT_OID_WSC_MODEL_NO
 0x0758

	)

927 
	#RT_OID_WSC_SERIAL_NO
 0x0759

	)

928 
	#RT_OID_WSC_READ_UFD_FILE
 0x075A

	)

929 
	#RT_OID_WSC_WRITE_UFD_FILE
 0x075B

	)

930 
	#RT_OID_WSC_QUERY_PEER_INFO_ON_RUNNING
 0x075C

	)

931 
	#RT_OID_WSC_MAC_ADDRESS
 0x0760

	)

933 #ifde
LLTD_SUPPORT


935 
	#RT_OID_GET_PHY_MODE
 0x761

	)

938 #ifde
NINTENDO_AP


940 
	#RT_OID_802_11_NINTENDO_GET_TABLE
 0x0771

941 
	#RT_OID_802_11_NINTENDO_SET_TABLE
 0x0772

942 
	#RT_OID_802_11_NINTENDO_CAPABLE
 0x0773

944 

	)

948 
	#OID_MH_802_1X_SUPPORTED
 0xFFEDC100

	)

951 
	u_HTTRANSMIT_SETTING
 {

952 #ifde
RT_BIG_ENDIAN


954 
USHORT
 
	mMODE
:2;

955 
USHORT
 
	miTxBF
:1;

956 
USHORT
 
	mrsv
:1;

957 
USHORT
 
	meTxBF
:1;

958 
USHORT
 
	mSTBC
:2;

959 
USHORT
 
	mShtGI
:1;

960 
USHORT
 
	mBW
:1;

961 
USHORT
 
	mMCS
:7;

962 } 
	mfld
;

965 
USHORT
 
	mMCS
:7;

966 
USHORT
 
	mBW
:1;

967 
USHORT
 
	mShtGI
:1;

968 
USHORT
 
	mSTBC
:2;

969 
USHORT
 
	meTxBF
:1;

970 
USHORT
 
	mrsv
:1;

971 
USHORT
 
	miTxBF
:1;

972 
USHORT
 
	mMODE
:2;

973 } 
	mfld
;

975 
USHORT
 
	mwd
;

976 } 
	tHTTRANSMIT_SETTING
, *
	tPHTTRANSMIT_SETTING
;

978 
	e_RT_802_11_PREAMBLE
 {

979 
	mRt802_11PambLg
,

980 
	mRt802_11PambSht
,

981 
	mRt802_11PambAuto


982 } 
	tRT_802_11_PREAMBLE
, *
	tPRT_802_11_PREAMBLE
;

984 
	e_RT_802_11_PHY_MODE
 {

985 
	mPHY_11BG_MIXED
 = 0,

986 
	mPHY_11B
,

987 
	mPHY_11A
,

988 
	mPHY_11ABG_MIXED
,

989 
	mPHY_11G
,

990 #ifde
DOT11_N_SUPPORT


991 
	mPHY_11ABGN_MIXED
,

992 
	mPHY_11N_2_4G
,

993 
	mPHY_11GN_MIXED
,

994 
	mPHY_11AN_MIXED
,

995 
	mPHY_11BGN_MIXED
,

996 
	mPHY_11AGN_MIXED
,

997 
	mPHY_11N_5G
,

999 } 
	tRT_802_11_PHY_MODE
;

1001 #ifde
DOT11_N_SUPPORT


1002 
	#PHY_MODE_IS_5G_BAND
(
__Mode
) \

1003 ((
__Mode
 =
PHY_11A
) || \

1004 (
__Mode
 =
PHY_11ABG_MIXED
) || \

1005 (
__Mode
 =
PHY_11ABGN_MIXED
) || \

1006 (
__Mode
 =
PHY_11AN_MIXED
) || \

1007 (
__Mode
 =
PHY_11AGN_MIXED
) || \

1008 (
__Mode
 =
PHY_11N_5G
))

	)

1011 
	#PHY_MODE_IS_5G_BAND
(
__Mode
) \

1012 ((
__Mode
 =
PHY_11A
) || \

1013 (
__Mode
 =
PHY_11ABG_MIXED
))

	)

1018 
	s_RT_802_11_LINK_STATUS
 {

1019 
ULONG
 
	mCuTxRe
;

1020 
ULONG
 
	mChlQuy
;

1021 
ULONG
 
	mTxByCou
;

1022 
ULONG
 
	mRxByCou
;

1023 
ULONG
 
	mCChl
;

1024 } 
	tRT_802_11_LINK_STATUS
, *
	tPRT_802_11_LINK_STATUS
;

1026 #ifde
SYSTEM_LOG_SUPPORT


1027 
	s_RT_802_11_EVENT_LOG
 {

1028 
LARGE_INTEGER
 
	mSyemTime
;

1029 
UCHAR
 
	mAddr
[
MAC_ADDR_LENGTH
];

1030 
USHORT
 
	mEvt
;

1031 } 
	tRT_802_11_EVENT_LOG
, *
	tPRT_802_11_EVENT_LOG
;

1033 
	s_RT_802_11_EVENT_TABLE
 {

1034 
ULONG
 
	mNum
;

1035 
ULONG
 
	mRsv
;

1036 
RT_802_11_EVENT_LOG
 
	mLog
[
MAX_NUMBER_OF_EVENT
];

1037 } 
	tRT_802_11_EVENT_TABLE
, 
	tPRT_802_11_EVENT_TABLE
;

1041 
	u_MACHTTRANSMIT_SETTING
 {

1043 
USHORT
 
	mMCS
:7;

1044 
USHORT
 
	mBW
:1;

1045 
USHORT
 
	mShtGI
:1;

1046 
USHORT
 
	mSTBC
:2;

1047 
USHORT
 
	mrsv
:3;

1048 
USHORT
 
	mMODE
:2;

1049 } 
	mfld
;

1050 
USHORT
 
	mwd
;

1051 } 
	tMACHTTRANSMIT_SETTING
, *
	tPMACHTTRANSMIT_SETTING
;

1053 
	s_RT_802_11_MAC_ENTRY
 {

1054 
UCHAR
 
	mApIdx
;

1055 
UCHAR
 
	mAddr
[
MAC_ADDR_LENGTH
];

1056 
UCHAR
 
	mAid
;

1057 
UCHAR
 
	mPsm
;

1058 
UCHAR
 
	mMimoPs
;

1059 
CHAR
 
	mAvgRssi0
;

1060 
CHAR
 
	mAvgRssi1
;

1061 
CHAR
 
	mAvgRssi2
;

1062 
UINT32
 
	mCedTime
;

1063 
MACHTTRANSMIT_SETTING
 
	mTxRe
;

1064 } 
	tRT_802_11_MAC_ENTRY
, *
	tPRT_802_11_MAC_ENTRY
;

1066 
	s_RT_802_11_MAC_TABLE
 {

1067 
ULONG
 
	mNum
;

1068 
RT_802_11_MAC_ENTRY
 
	mEry
[
MAX_NUMBER_OF_MAC
];

1069 } 
	tRT_802_11_MAC_TABLE
, *
	tPRT_802_11_MAC_TABLE
;

1072 #ifde
DOT11_N_SUPPORT


1073 #ifde
TXBF_SUPPORT


1076 
ULONG
 
	mTxSucssCou
;

1077 
ULONG
 
	mTxRryCou
;

1078 
ULONG
 
	mTxFaCou
;

1079 
ULONG
 
	mETxSucssCou
;

1080 
ULONG
 
	mETxRryCou
;

1081 
ULONG
 
	mETxFaCou
;

1082 
ULONG
 
	mITxSucssCou
;

1083 
ULONG
 
	mITxRryCou
;

1084 
ULONG
 
	mITxFaCou
;

1085 } 
	tRT_COUNTER_TXBF
;

1089 
ULONG
 
	mNum
;

1090 
RT_COUNTER_TXBF
 
	mEry
[
MAX_NUMBER_OF_MAC
];

1091 } 
	tRT_802_11_TXBF_TABLE
;

1097 
	s_RT_802_11_HARDWARE_REGISTER
 {

1098 
ULONG
 
	mHdweTy
;

1099 
ULONG
 
	mOfft
;

1100 
ULONG
 
	mDa
;

1101 } 
	tRT_802_11_HARDWARE_REGISTER
, *
	tPRT_802_11_HARDWARE_REGISTER
;

1103 
	s_RT_802_11_AP_CONFIG
 {

1104 
ULONG
 
	mEbTxBur
;

1105 
ULONG
 
	mEbTurboRe
;

1106 
ULONG
 
	mIsީeISTffic
;

1107 
ULONG
 
	mHideSsid
;

1108 
ULONG
 
	mUBGPrei
;

1109 
ULONG
 
	mUShtSlTime
;

1110 
ULONG
 
	mRsv1
;

1111 
ULONG
 
	mSyemEBm
;

1112 } 
	tRT_802_11_AP_CONFIG
, *
	tPRT_802_11_AP_CONFIG
;

1115 
	s_RT_802_11_STA_CONFIG
 {

1116 
ULONG
 
	mEbTxBur
;

1117 
ULONG
 
	mEbTurboRe
;

1118 
ULONG
 
	mUBGPrei
;

1119 
ULONG
 
	mUShtSlTime
;

1120 
ULONG
 
	mAdhocMode
;

1121 
ULONG
 
	mHwRadioStus
;

1122 
ULONG
 
	mRsv1
;

1123 
ULONG
 
	mSyemEBm
;

1124 } 
	tRT_802_11_STA_CONFIG
, *
	tPRT_802_11_STA_CONFIG
;

1129 
	s_OID_BACAP_STRUC
 {

1130 
UCHAR
 
	mRxBAWLim
;

1131 
UCHAR
 
	mTxBAWLim
;

1132 
UCHAR
 
	mPicy
;

1133 
UCHAR
 
	mMpduDsy
;

1134 
UCHAR
 
	mAmsduEb
;

1135 
UCHAR
 
	mAmsduSize
;

1136 
UCHAR
 
	mMMPSmode
;

1137 
BOOLEAN
 
	mAutoBA
;

1138 } 
	tOID_BACAP_STRUC
, *
	tPOID_BACAP_STRUC
;

1140 
	s_RT_802_11_ACL_ENTRY
 {

1141 
UCHAR
 
	mAddr
[
MAC_ADDR_LENGTH
];

1142 
USHORT
 
	mRsv
;

1143 } 
	tRT_802_11_ACL_ENTRY
, *
	tPRT_802_11_ACL_ENTRY
;

1145 
GNU_PACKED
 
	t_RT_802_11_ACL
 {

1146 
ULONG
 
	gPicy
;

1147 
ULONG
 
	gNum
;

1148 
RT_802_11_ACL_ENTRY
 
	gEry
[
MAX_NUMBER_OF_ACL
];

1149 } 
	tRT_802_11_ACL
, *
	tPRT_802_11_ACL
;

1151 
	s_RT_802_11_WDS
 {

1152 
ULONG
 
	mNum
;

1153 
NDIS_802_11_MAC_ADDRESS
 
	mEry
[24 ];

1154 
ULONG
 
	mKeyLgth
;

1155 
UCHAR
 
	mKeyMl
[32];

1156 } 
	tRT_802_11_WDS
, *
	tPRT_802_11_WDS
;

1158 
	s_RT_802_11_TX_RATES_
 {

1159 
UCHAR
 
	mSupReL
;

1160 
UCHAR
 
	mSupRe
[
MAX_LENGTH_OF_SUPPORT_RATES
];

1161 
UCHAR
 
	mExtReL
;

1162 
UCHAR
 
	mExtRe
[
MAX_LENGTH_OF_SUPPORT_RATES
];

1163 } 
	tRT_802_11_TX_RATES
, *
	tPRT_802_11_TX_RATES
;

1167 
	#GENERAL_LINK_UP
 0x0

1168 
	#GENERAL_LINK_DOWN
 0x1

1169 
	#HW_RADIO_OFF
 0x2

1170 
	#SW_RADIO_OFF
 0x3

1171 
	#AUTH_FAIL
 0x4

1172 
	#AUTH_FAIL_KEYS
 0x5

1173 
	#ASSOC_FAIL
 0x6

1174 
	#EAP_MIC_FAILURE
 0x7

1175 
	#EAP_4WAY_TIMEOUT
 0x8

1176 
	#EAP_GROUP_KEY_TIMEOUT
 0x9

1177 
	#EAP_SUCCESS
 0xa

1178 
	#DETECT_RADAR_SIGNAL
 0xb

1179 
	#EXTRA_INFO_MAX
 0xb

1180 

	)

1181 
	#EXTRA_INFO_CLEAR
 0xffffffff

	)

1185 
RT_802_11_PHY_MODE
 
	mPhyMode
;

1186 
UCHAR
 
	mTnsmNo
;

1187 
UCHAR
 
	mHtMode
;

1188 
UCHAR
 
	mExtOfft
;

1189 
UCHAR
 
	mMCS
;

1190 
UCHAR
 
	mBW
;

1191 
UCHAR
 
	mSTBC
;

1192 
UCHAR
 
	mSHORTGI
;

1193 
UCHAR
 
	mrsv
;

1194 } 
	tOID_SET_HT_PHYMODE
, *
	tPOID_SET_HT_PHYMODE
;

1196 #ifde
NINTENDO_AP


1197 
	#NINTENDO_MAX_ENTRY
 16

	)

1198 
	#NINTENDO_SSID_NAME_LN
 8

	)

1199 
	#NINTENDO_SSID_NAME
 "NWCUSBAP"

	)

1200 
	#NINTENDO_PROBE_REQ_FLAG_MASK
 0x03

	)

1201 
	#NINTENDO_PROBE_REQ_ON
 0x01

	)

1202 
	#NINTENDO_PROBE_REQ_SIGNAL
 0x02

	)

1203 
	#NINTENDO_PROBE_RSP_ON
 0x01

	)

1204 
	#NINTENDO_SSID_NICKNAME_LN
 20

	)

1206 
	#NINTENDO_WEPKEY_LN
 13

	)

1208 
	s_NINTENDO_SSID


1210 
UCHAR
 
	mNINTENDOFixCh
[
NINTENDO_SSID_NAME_LN
];

1211 
UCHAR
 
	mzo1
;

1212 
UCHAR
 
	mgie
;

1213 
UCHAR
 
	mID
;

1214 
UCHAR
 
	mzo2
;

1215 
UCHAR
 
	mNICKme
[
NINTENDO_SSID_NICKNAME_LN
];

1216 } 
	tRT_NINTENDO_SSID
, *
	tPRT_NINTENDO_SSID
;

1218 
	s_NINTENDO_ENTRY


1220 
UCHAR
 
	mNICKme
[
NINTENDO_SSID_NICKNAME_LN
];

1221 
UCHAR
 
	mDS_Addr
[
ETH_LENGTH_OF_ADDRESS
];

1222 
UCHAR
 
	mgie
;

1223 
UCHAR
 
	mUrSAck
;

1224 } 
	tRT_NINTENDO_ENTRY
, *
	tPRT_NINTENDO_ENTRY
;

1228 
	s_NINTENDO_TABLE


1230 
UINT
 
	mnumb
;

1231 
RT_NINTENDO_ENTRY
 
	my
[
NINTENDO_MAX_ENTRY
];

1232 } 
	tRT_NINTENDO_TABLE
, *
	tPRT_NINTENDO_TABLE
;

1235 
	s_NINTENDO_SEED_WEPKEY


1237 
UCHAR
 
	med
[
NINTENDO_SSID_NICKNAME_LN
];

1238 
UCHAR
 
	mwkey
[16];

1239 } 
	tRT_NINTENDO_SEED_WEPKEY
, *
	tPRT_NINTENDO_SEED_WEPKEY
;

1242 #ifde
LLTD_SUPPORT


1243 
	s_RT_LLTD_ASSOICATION_ENTRY
 {

1244 
UCHAR
 
	mAddr
[
ETH_LENGTH_OF_ADDRESS
];

1245 
	mMOR
;

1246 
UCHAR
 
	mphyMode
;

1247 } 
	tRT_LLTD_ASSOICATION_ENTRY
, *
	tPRT_LLTD_ASSOICATION_ENTRY
;

1249 
	s_RT_LLTD_ASSOICATION_TABLE
 {

1250 
	mNum
;

1251 
RT_LLTD_ASSOICATION_ENTRY
 
	mEry
[
MAX_NUMBER_OF_MAC
];

1252 } 
	tRT_LLTD_ASSOICATION_TABLE
, *
	tPRT_LLTD_ASSOICATION_TABLE
;

1255 #ifde
CONFIG_STA_SUPPORT


1256 #ifde
QOS_DLS_SUPPORT


1259 
	s_RT_802_11_DLS_UI
 {

1260 
USHORT
 
	mTimeOut
;

1261 
USHORT
 
	mCouDownTim
;

1262 
NDIS_802_11_MAC_ADDRESS
 
	mMacAddr
;

1263 
UCHAR
 
	mStus
;

1264 
BOOLEAN
 
	mVid
;

1265 } 
	tRT_802_11_DLS_UI
, *
	tPRT_802_11_DLS_UI
;

1267 
	s_RT_802_11_DLS_INFO
 {

1268 
RT_802_11_DLS_UI
 
	mEry
[
MAX_NUMBER_OF_DLS_ENTRY
];

1269 
UCHAR
 
	mnum
;

1270 } 
	tRT_802_11_DLS_INFO
, *
	tPRT_802_11_DLS_INFO
;

1272 
	e_RT_802_11_DLS_MODE
 {

1273 
	mDLS_NONE
,

1274 
	mDLS_WAIT_KEY
,

1275 
	mDLS_FINISH


1276 } 
	tRT_802_11_DLS_MODE
;

1280 #ifde
WPA_SUPPLICANT_SUPPORT


1281 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


1282 
	#RT_ASSOC_EVENT_FLAG
 0x0101

	)

1283 
	#RT_DISASSOC_EVENT_FLAG
 0x0102

	)

1284 
	#RT_REQIE_EVENT_FLAG
 0x0103

	)

1285 
	#RT_RESPIE_EVENT_FLAG
 0x0104

	)

1286 
	#RT_ASSOCINFO_EVENT_FLAG
 0x0105

	)

1287 
	#RT_PMKIDCAND_FLAG
 0x0106

	)

1288 
	#RT_INTERFACE_DOWN
 0x0107

	)

1289 
	#RT_INTERFACE_UP
 0x0108

	)

1297 
	#MAX_CUSTOM_LEN
 128

	)

1299 #ifde
CONFIG_STA_SUPPORT


1300 
	e_RT_802_11_D_CLIENT_MODE


1302 
	mRt802_11_D_Ne
,

1303 
	mRt802_11_D_Fxib
,

1304 
	mRt802_11_D_Si
,

1305 } 
	tRT_802_11_D_CLIENT_MODE
, *
	tPRT_802_11_D_CLIENT_MODE
;

1308 
	s_RT_CHANNEL_LIST_INFO


1310 
UCHAR
 
	mChlLi
[
MAX_NUM_OF_CHS
];

1311 
UCHAR
 
	mChlLiNum
;

1312 } 
	tRT_CHANNEL_LIST_INFO
, *
	tPRT_CHANNEL_LIST_INFO
;

1315 
	s_WSC_CREDENTIAL


1317 
NDIS_802_11_SSID
 
	mSSID
;

1318 
USHORT
 
	mAuthTy
;

1319 
USHORT
 
	mEnTy
;

1320 
UCHAR
 
	mKey
[64];

1321 
USHORT
 
	mKeyLgth
;

1322 
UCHAR
 
	mMacAddr
[
MAC_ADDR_LENGTH
];

1323 
UCHAR
 
	mKeyIndex
;

1324 
UCHAR
 
	mbFromUPnP
;

1325 
UCHAR
 
	mRsvd
[2];

1326 } 
	tWSC_CREDENTIAL
, *
	tPWSC_CREDENTIAL
;

1329 
	s_WSC_PROFILE


1331 
UINT
 
	mProfeC
;

1332 
UINT
 
	mAlyProfeIdx
;

1333 
WSC_CREDENTIAL
 
	mProfe
[8];

1334 } 
	tWSC_PROFILE
, *
	tPWSC_PROFILE
;

	@include/os/rt_linux.h

37 #ide
__RT_LINUX_H__


38 
	#__RT_LINUX_H__


	)

40 
	~<lux/modu.h
>

41 
	~<lux/vsi.h
>

42 
	~<lux/kl.h
>

43 
	~<lux/lock.h
>

44 
	~<lux/.h
>

45 
	~<lux/rg.h
>

46 
	~<lux/tim.h
>

47 
	~<lux/o.h
>

48 
	~<lux/ab.h
>

49 
	~<lux/u.h
>

50 
	~<lux/pci.h
>

51 
	~<lux/tdevi.h
>

52 
	~<lux/hdevi.h
>

53 
	~<lux/skbuff.h
>

54 
	~<lux/hto.h
>

55 
	~<lux/wess.h
>

56 
	~<lux/oc_fs.h
>

57 
	~<lux/day.h
>

58 
	~<lux/if_p.h
>

59 
	~<lux/y.h
>

60 
	~<lux/vmloc.h
>

61 
	~<lux/wess.h
>

62 
	~<t/iw_hdr.h
>

64 #ifde
INF_PPA_SUPPORT


65 
	~<t/ifx_a_i.h
>

66 
	~<t/ifx_a_hook.h
>

70 
	#__KERNEL_SYSCALLS__


	)

71 
	~<lux/unid.h
>

72 
	~<asm/uacss.h
>

73 
	~<asm/tys.h
>

74 
	~<asm/uligd.h
>

76 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,29)

77 
	#KTHREAD_SUPPORT
 1

	)

80 #ifde
KTHREAD_SUPPORT


81 
	~<lux/r.h
>

82 
	~<lux/kthad.h
>

85 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,27)

86 
	~<lux/pid.h
>

89 #ifde
RT_CFG80211_SUPPORT


90 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,28))

91 
	~<t/mac80211.h
>

92 #ide
EXT_BUILD_CHANNEL_LIST


93 
	#EXT_BUILD_CHANNEL_LIST


	)

96 #unde
RT_CFG80211_SUPPORT


100 #unde
AP_WSC_INCLUDED


101 #unde
STA_WSC_INCLUDED


102 #unde
WSC_INCLUDED


105 #ifde
CONFIG_STA_SUPPORT


109 #ifde
KTHREAD_SUPPORT


110 #i
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,4)

121 #ifde
CONFIG_STA_SUPPORT


122 #ifde
RTMP_MAC_PCI


123 
	#STA_PROFILE_PATH
 "/c/Wess/RT2860STA/RT2860STA.d"

	)

124 
	#STA_DRIVER_VERSION
 "2.4.0.0"

	)

125 #ifde
MULTIPLE_CARD_SUPPORT


126 
	#CARD_INFO_PATH
 "/c/Wess/RT2860STA/RT2860STACd.d"

	)

132 cڡ 
iw_hdr_def
 
28xx_iw_hdr_def
;

135 #ifde
CONFIG_APSTA_MIXED_SUPPORT


136 cڡ 
iw_hdr_def
 
28xx__iw_hdr_def
;

142 #unde
__le


143 
	#__le
 
le


	)

144 
	#IN


	)

145 
	#OUT


	)

146 
	#INOUT


	)

147 
	#NDIS_STATUS
 
INT


	)

153 
pci_dev
 * 
	tPPCI_DEV
;

154 
t_devi
 * 
	tPNET_DEV
;

155 * 
	tPNDIS_PACKET
;

156 
	tNDIS_PACKET
;

157 
PNDIS_PACKET
 * 
	tPPNDIS_PACKET
;

158 
dma_addr_t
 
	tNDIS_PHYSICAL_ADDRESS
;

159 
dma_addr_t
 * 
	tPNDIS_PHYSICAL_ADDRESS
;

160 * 
	tNDIS_HANDLE
;

161 * 
	tPNDIS_BUFFER
;

163 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,27)

164 
pid
 * 
	tRTMP_OS_PID
;

166 
pid_t
 
	tRTMP_OS_PID
;

169 
mhe
 
	tRTMP_OS_SEM
;

171 (*
	tHARD_START_XMIT_FUNC
)(
	tsk_buff
 *
	tskb
, 
	tt_devi
 *
	tt_dev
);

173 #ifde
RTMP_MAC_PCI


174 #ide
PCI_DEVICE


175 
	#PCI_DEVICE
(
vd
,
dev
) \

176 .
vd
 = (
vd
), .
devi
 = (
dev
), \

177 .
subvd
 = 
PCI_ANY_ID
, .
subdevi
 = 
	)
PCI_ANY_ID

181 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

182 
	#RT_MOD_INC_USE_COUNT
() \

183 i(!
	`y_modu_g
(
THIS_MODULE
)) \

185 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: cnلervmodu\n", 
__FUNCTION__
)); \

187 
	}

	)
}

189 
	#RT_MOD_DEC_USE_COUNT
(
	`modu_put
(
THIS_MODULE
);

	)

191 
	#RT_MOD_INC_USE_COUNT
(
MOD_INC_USE_COUNT
;

	)

192 
	#RT_MOD_DEC_USE_COUNT
(
MOD_DEC_USE_COUNT
;

	)

195 
	#RTMP_INC_REF
(
_A
0

	)

196 
	#RTMP_DEC_REF
(
_A
0

	)

197 
	#RTMP_GET_REF
(
_A
0

	)

200 #i
WIRELESS_EXT
 >= 12

202 
iw_iics
 *
28xx_g_wess_s
(

203 
IN
 
t_devi
 *
t_dev
);

210 #ide
IFNAMSIZ


211 
	#IFNAMSIZ
 16

	)

214 
	#ETH_LENGTH_OF_ADDRESS
 6

	)

216 
	#NDIS_STATUS_SUCCESS
 0x00

	)

217 
	#NDIS_STATUS_FAILURE
 0x01

	)

218 
	#NDIS_STATUS_INVALID_DATA
 0x02

	)

219 
	#NDIS_STATUS_RESOURCES
 0x03

	)

221 
	#NDIS_SET_PACKET_STATUS
(
_p
, 
_us
do{} 0)

	)

222 
	#NdisWreELogEry
(
_a
, 
_b
, 
_c
, 
_d
do{} 0)

	)

225 
	#STATS_INC_RX_PACKETS
(
_pAd
, 
_dev
)

	)

226 
	#STATS_INC_TX_PACKETS
(
_pAd
, 
_dev
)

	)

228 
	#STATS_INC_RX_BYTESS
(
_pAd
, 
_dev
, 
n
)

	)

229 
	#STATS_INC_TX_BYTESS
(
_pAd
, 
_dev
, 
n
)

	)

231 
	#STATS_INC_RX_ERRORS
(
_pAd
, 
_dev
)

	)

232 
	#STATS_INC_TX_ERRORS
(
_pAd
, 
_dev
)

	)

234 
	#STATS_INC_RX_DROPPED
(
_pAd
, 
_dev
)

	)

235 
	#STATS_INC_TX_DROPPED
(
_pAd
, 
_dev
)

	)

241 
	#MIN_NET_DEVICE_FOR_AID
 0x00

242 
	#MIN_NET_DEVICE_FOR_MBSSID
 0x00

243 
	#MIN_NET_DEVICE_FOR_WDS
 0x10

244 
	#MIN_NET_DEVICE_FOR_APCLI
 0x20

	)

245 
	#MIN_NET_DEVICE_FOR_MESH
 0x30

	)

246 #ifde
CONFIG_STA_SUPPORT


247 
	#MIN_NET_DEVICE_FOR_DLS
 0x40

	)

248 
	#MIN_NET_DEVICE_FOR_TDLS
 0x80

	)

250 
	#NET_DEVICE_REAL_IDX_MASK
 0x0f

251 

	)

253 #ifde
CONFIG_STA_SUPPORT


254 
	#NDIS_PACKET_TYPE_DIRECTED
 0

	)

255 
	#NDIS_PACKET_TYPE_MULTICAST
 1

	)

256 
	#NDIS_PACKET_TYPE_BROADCAST
 2

	)

257 
	#NDIS_PACKET_TYPE_ALL_MULTICAST
 3

	)

258 
	#NDIS_PACKET_TYPE_PROMISCUOUS
 4

	)

270 
fe
* 
	tRTMP_OS_FD
;

272 
	s_RTMP_OS_FS_INFO_


274 
	mfsuid
;

275 
	mfsgid
;

276 
mm_gmt_t
 
	mfs
;

277 }
	tRTMP_OS_FS_INFO
;

279 
	#IS_FILE_OPEN_ERR
(
_fd
((_fd =
NULL
|| 
	`IS_ERR
((_fd)))

	)

285 
	sos_lock
 {

286 
lock_t
 
	mlock
;

287 
	mags
;

290 
lock_t
 
	tNDIS_SPIN_LOCK
;

295 
	#NdisAoSpLock
(
__lock
) \

297 
	`_lock_
((
lock_t
 *)(
__lock
)); \

298 }

	)

300 
	#NdisFeSpLock
(
lock
) \

301 do{}0)

	)

304 
	#RTMP_SEM_LOCK
(
__lock
) \

306 
	`_lock_bh
((
lock_t
 *)(
__lock
)); \

307 }

	)

309 
	#RTMP_SEM_UNLOCK
(
__lock
) \

311 
	`_uock_bh
((
lock_t
 *)(
__lock
)); \

312 }

	)

316 
	#RTMP_IRQ_LOCK
(
__lock
, 
__qags
) \

318 
__qags
 = 0; \

319 
	`_lock_bh
((
lock_t
 *)(
__lock
)); \

320 
pAd
->
q_dibd
 |= 1; \

321 }

	)

323 
	#RTMP_IRQ_UNLOCK
(
__lock
, 
__qag
) \

325 
pAd
->
q_dibd
 &= 0; \

326 
	`_uock_bh
((
lock_t
 *)(
__lock
)); \

327 }

	)

329 
	#RTMP_INT_LOCK
(
__lock
, 
__qags
) \

331 
	`_lock_qve
((
lock_t
 *)
__lock
, 
__qags
); \

332 }

	)

334 
	#RTMP_INT_UNLOCK
(
__lock
, 
__qag
) \

336 
	`_uock_qe
((
lock_t
 *)(
__lock
), (()
__qag
)); \

337 }

	)

339 
	#NdisAcqueSpLock
 
RTMP_SEM_LOCK


	)

340 
	#NdisRSpLock
 
RTMP_SEM_UNLOCK


	)

356 
	#RTMP_MCU_RW_LOCK
(
_pAd
, 
_qags
) \

358 i(
_pAd
->
fTy
 =
RTMP_DEV_INF_USB
) \

360 
	`RTMP_SEM_EVENT_WAIT
(&
_pAd
->
McuCmdSem
, 
_qags
);\

364 
	`RTMP_SEM_LOCK
(&
_pAd
->
McuCmdLock
, 
_qags
);\

366 }0)

	)

368 
	#RTMP_MCU_RW_UNLOCK
(
_pAd
, 
_qags
) \

370 if(
_pAd
->
fTy
 =
RTMP_DEV_INF_USB
)\

372 
	`RTMP_SEM_EVENT_UP
(&
_pAd
->
McuCmdSem
);\

376 
	`RTMP_SEM_UNLOCK
(&
_pAd
->
McuCmdLock
, 
_qags
);\

378 }0)

	)

381 #ide
wa_evt_uib_timeout


382 
	#__wa_evt_uib_timeout
(
wq
, 
cdi
, 
t
) \

384 
wa_queue_t
 
__wa
; \

385 
	`_waqueue_y
(&
__wa
, 
cut
); \

386 
	`add_wa_queue
(&
wq
, &
__wa
); \

388 
	`t_cut_e
(
TASK_INTERRUPTIBLE
); \

389 i(
cdi
) \

391 i(!
	`sigl_ndg
(
cut
)) { \

392 
t
 = 
	`schedu_timeout
(ret); \

393 i(!
t
) \

397 
t
 = -
ERESTARTSYS
; \

400 
cut
->
e
 = 
TASK_RUNNING
; \

401 
	`move_wa_queue
(&
wq
, &
__wa
); \

402 } 0)

	)

404 
	#wa_evt_uib_timeout
(
wq
, 
cdi
, 
timeout
) \

406 
__t
 = 
timeout
; \

407 i(!(
cdi
)) \

408 
	`__wa_evt_uib_timeout
(
wq
, 
cdi
, 
__t
); \

409 
__t
; \

410 })

	)

413 
	#RTMP_SEM_EVENT_INIT_LOCKED
(
_pSema

	`ma_
((_pSema), 0)

	)

414 
	#RTMP_SEM_EVENT_INIT
(
_pSema

	`ma_
((_pSema), 1)

	)

415 
	#RTMP_SEM_EVENT_DESTORY
(
_pSema
do{}0)

	)

416 
	#RTMP_SEM_EVENT_WAIT
(
_pSema
, 
_us
((_us
	`down_uib
((_pSema)))

	)

417 
	#RTMP_SEM_EVENT_UP
(
_pSema

	`up
(_pSema)

	)

419 #ifde
KTHREAD_SUPPORT


420 
	#RTMP_WAIT_EVENT_INTERRUPTIBLE
(
_pAd
, 
_pTask
) \

422 
	`wa_evt_uib
(
_pTask
->
kthad_q
, \

423 
_pTask
->
kthad_rug
 || 
	`kthad_should_
()); \

424 
_pTask
->
kthad_rug
 = 
FALSE
; \

425 i(
	`kthad_should_
()) \

427 
	`RTMP_SET_FLAG
(
_pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
); \

430 }

	)

433 #ifde
KTHREAD_SUPPORT


434 
	#WAKE_UP
(
_pTask
) \

436 i((
_pTask
)->
kthad_sk
) \

438 (
_pTask
)->
kthad_rug
 = 
TRUE
; \

439 
	`wake_up
(&(
_pTask
)->
kthad_q
); \

441 }0)

	)

447 
	#MEM_ALLOC_FLAG
 (
GFP_ATOMIC
)

448 

	)

449 
	#NdisMoveMemy
(
Dei
, 
Sour
, 
Lgth

	`memmove
(Dei, Sour, Lgth)

	)

450 
	#NdisCyMemy
(
Dei
, 
Sour
, 
Lgth

	`memy
(Dei, Sour, Lgth)

	)

451 
	#NdisZoMemy
(
Dei
, 
Lgth

	`memt
(Dei, 0, Lgth)

	)

452 
	#NdisFlMemy
(
Dei
, 
Lgth
, 
Fl

	`memt
(Dei, Fl, Lgth)

	)

453 
	#NdisCmpMemy
(
Dei
, 
Sour
, 
Lgth

	`memcmp
(Dei, Sour, Lgth)

	)

454 
	#NdisEquMemy
(
Sour1
, 
Sour2
, 
Lgth
(!
	`memcmp
(Sour1, Sour2, Lgth))

	)

455 
	#RTMPEquMemy
(
Sour1
, 
Sour2
, 
Lgth
(!
	`memcmp
(Sour1, Sour2, Lgth))

	)

457 
	#MlmeAoMemy
(
_pAd
, 
_VA

	`os_loc_mem
(_pAd, _VA, 
MGMT_DMA_BUFFER_SIZE
)

	)

458 
	#MlmeFeMemy
(
_pAd
, 
_pVA

	`os__mem
(_pAd, _pVA)

	)

460 
	#COPY_MAC_ADDR
(
Addr1
, 
Addr2

	`memy
((Addr1), (Addr2), 
MAC_ADDR_LEN
)

	)

466 
	#RTMP_OS_MGMT_TASK_FLAGS
 
CLONE_VM


	)

468 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,27)

469 
pid
 * 
	tTHREAD_PID
;

470 
	#THREAD_PID_INIT_VALUE
 
NULL


	)

473 
	#RTMP_GET_OS_PID
(
_x
, 
_y
do{
	`rcu_ad_lock
(); _x=
cut
->
pids
[
PIDTYPE_PID
].
pid
; 
	`rcu_ad_uock
();}0)

	)

474 
	#GET_PID_NUMBER
(
_v

	`pid_
((_v))

	)

475 
	#CHECK_PID_LEGALITY
(
_pid
i(
	`pid_
((_pid)> 0)

	)

476 
	#KILL_THREAD_PID
(
_A
, 
_B
, 
_C

	`kl_pid
((_A), (_B), (_C))

	)

478 
pid_t
 
	tTHREAD_PID
;

479 
	#THREAD_PID_INIT_VALUE
 -1

	)

480 
	#RTMP_GET_OS_PID
(
_x
, 
_pid
_x = 
	)
_pid

481 
	#GET_PID_NUMBER
(
_v
(_v)

	)

482 
	#CHECK_PID_LEGALITY
(
_pid
i((_pid>0)

	)

483 
	#KILL_THREAD_PID
(
_A
, 
_B
, 
_C

	`kl_oc
((_A), (_B), (_C))

	)

486 (*
	t_
)(*);

487 
	$INT
 (*
	tRTMP_OS_TASK_CALLBACK
)(
	tULONG
);

488 
skt_ru
 
	tRTMP_NET_TASK_STRUCT
;

489 
skt_ru
 *
	tPRTMP_NET_TASK_STRUCT
;

495 
	#OS_HZ
 
HZ


	)

497 
tim_li
 
	tNDIS_MINIPORT_TIMER
;

498 
tim_li
 
	tRTMP_OS_TIMER
;

499 (*
	tTIMER_FUNCTION
)();

502 
	#OS_WAIT
(
_time
) \

504 i(
	`_u
()) \

506 
	`RTMPucDay
(
_time
 * 1000);\

509 
_i
; \

510 
_lo
 = ((
_time
)/(1000/
OS_HZ
)) > 0 ? ((_time)/(1000/OS_HZ)) : 1;\

511 
wa_queue_hd_t
 
_wa
; \

512 
	`_waqueue_hd
(&
_wa
); \

513 
_i
=0; _i<(
_lo
); _i++) \

514 
	`wa_evt_uib_timeout
(
_wa
, 0, 
ONE_TICK
); \

516 
	}

	)
}

518 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,5,0)

519 
	#RTMP_TIME_AFTER
(
a
,
b
) \

520 (
	`tycheck
(, ()
a
) && \

521 
	`tycheck
(, ()
b
) && \

522 (()(
b
- ()(
a
< 0))

	)

524 
	#RTMP_TIME_AFTER_EQ
(
a
,
b
) \

525 (
	`tycheck
(, ()
a
) && \

526 
	`tycheck
(, ()
b
) && \

527 (()(
a
- ()(
b
>0))

	)

528 
	#RTMP_TIME_BEFORE
(
a
,
b

	`RTMP_TIME_AFTER_EQ
(b,a)

	)

530 
	#tycheck
(
ty
,
x
) \

531 ({ 
ty
 
__dummy
; \

532 
	`tyof
(
x

__dummy2
; \

533 ()(&
__dummy
 =&
__dummy2
); \

535 })

	)

536 
	#RTMP_TIME_AFTER_EQ
(
a
,
b
) \

537 (
	`tycheck
(, ()
a
) && \

538 
	`tycheck
(, ()
b
) && \

539 (()(
a
- ()(
b
>0))

	)

540 
	#RTMP_TIME_BEFORE
(
a
,
b

	`RTMP_TIME_AFTER_EQ
(b,a)

	)

541 
	#RTMP_TIME_AFTER
(
a
,
b

	`time_a
, b)

	)

544 
	#ONE_TICK
 1

	)

546 
le
 
	$NdisGSyemUpTime
(
ULONG
 *
time
)

548 *
time
 = 
jiffs
;

549 
	}
}

556 
	sos_cook
 {

557 #ifde
RTMP_MAC_PCI


558 
pci_dev
 *
	mpci_dev
;

559 
pci_dev
 *
	m_pci_dev
;

560 
USHORT
 
	mDeviID
;

561 
dma_addr_t
 
	mpAd_
;

565 #ifde
WORKQUEUE_BH


566 
UINT32
 
	mpAd_va
;

568 
wk_ru
 
	mrx_de_wk
;

569 
wk_ru
 
	mmgmt_dma_de_wk
;

570 
wk_ru
 
	mac0_dma_de_wk
;

571 
wk_ru
 
	mac1_dma_de_wk
;

572 
wk_ru
 
	mac2_dma_de_wk
;

573 
wk_ru
 
	mac3_dma_de_wk
;

574 
wk_ru
 
	mhc_dma_de_wk
;

576 
wk_ru
 
	mtb_wk
;

579 
RTMP_NET_TASK_STRUCT
 
	mrx_de_sk
;

580 
RTMP_NET_TASK_STRUCT
 
	mmgmt_dma_de_sk
;

581 
RTMP_NET_TASK_STRUCT
 
	mac0_dma_de_sk
;

582 #ifde
RALINK_ATE


583 
RTMP_NET_TASK_STRUCT
 
	me_ac0_dma_de_sk
;

585 
RTMP_NET_TASK_STRUCT
 
	mac1_dma_de_sk
;

586 
RTMP_NET_TASK_STRUCT
 
	mac2_dma_de_sk
;

587 
RTMP_NET_TASK_STRUCT
 
	mac3_dma_de_sk
;

588 
RTMP_NET_TASK_STRUCT
 
	mhc_dma_de_sk
;

589 
RTMP_NET_TASK_STRUCT
 
	mtb_sk
;

592 #ifde
RTMP_MAC_PCI


593 #ifde
WORKQUEUE_BH


594 
wk_ru
 
	mfifo_iic_fu_wk
;

596 
RTMP_NET_TASK_STRUCT
 
	mfifo_iic_fu_sk
;

602 
RTMP_OS_PID
 
	md_pid
;

603 
	md_pid_
;

604 
INT
 
	miol_if_ty
;

605 
INT
 
	miol_if
;

608 
os_cook
 * 
	tPOS_COOKIE
;

615 
	#PRINT_MAC
(
addr
) \

616 
addr
[0],ddr[1],ddr[2],ddr[3],ddr[4],ddr[5]

	)

618 #ifde
DBG


619 
ULONG
 
RTDebugLev
;

621 
	#DBGPRINT_RAW
(
Lev
, 
Fmt
) \

623 i(
Lev
 <
RTDebugLev
) \

625 
tk
 
Fmt
; \

627 }0)

	)

629 
	#DBGPRINT
(
Lev
, 
Fmt

	`DBGPRINT_RAW
(Lev, Fmt)

	)

632 
	#DBGPRINT_ERR
(
Fmt
) \

634 
	`tk
("ERROR!!! "); \

635 
tk
 
Fmt
; \

636 }

	)

638 
	#DBGPRINT_S
(
Stus
, 
Fmt
) \

640 
tk
 
Fmt
; \

641 }

	)

643 
	#DBGPRINT
(
Lev
, 
Fmt
)

	)

644 
	#DBGPRINT_RAW
(
Lev
, 
Fmt
)

	)

645 
	#DBGPRINT_S
(
Stus
, 
Fmt
)

	)

646 
	#DBGPRINT_ERR
(
Fmt
)

	)

649 #unde
ASSERT


650 #ifde
DBG


651 
	#ASSERT
(
x
) \

653 i(!(
x
)) \

655 
	`tk
(
KERN_WARNING
 
__FILE__
 ":%ds " #x "ed\n", 
__LINE__
); \

657 }

	)

659 
	#ASSERT
(
x
)

	)

662 
hex_dump
(*
r
, *
pSrcBufVA
, 
SrcBufL
);

673 #ifde
RTMP_MAC_PCI


674 
dma_addr_t
 
lux_pci_m_sg
(*
hd
, *
r
, 
size_t
 
size
, 
sd_idx
, 
dei
);

675 
lux_pci_unm_sg
(*
hd
, 
dma_addr_t
 
dma_addr
, 
size_t
 
size
, 
dei
);

677 
	#PCI_MAP_SINGLE
(
_hd
, 
_r
, 
_size
, 
_sd_idx
, 
_d
) \

678 
	`lux_pci_m_sg
(
_hd
, 
_r
, 
_size
, 
_sd_idx
, 
_d
)

	)

680 
	#PCI_UNMAP_SINGLE
(
_hd
, 
_r
, 
_size
, 
_d
) \

681 
	`lux_pci_unm_sg
(
_hd
, 
_r
, 
_size
, 
_d
)

	)

683 
	#PCI_ALLOC_CONSISTENT
(
_pci_dev
, 
_size
, 
_r
) \

684 
	`pci_loc_csit
(
_pci_dev
, 
_size
, 
_r
)

	)

686 
	#PCI_FREE_CONSISTENT
(
_pci_dev
, 
_size
, 
_vtu_addr
, 
_physil_addr
) \

687 
	`pci__csit
(
_pci_dev
, 
_size
, 
_vtu_addr
, 
_physil_addr
)

	)

690 #ifde
VENDOR_FEATURE2_SUPPORT


691 
	#DEV_ALLOC_SKB
(
_pAd
, 
_Pkt
, 
_ngth
) \

692 
_Pkt
 = 
	`dev_loc_skb
(
_ngth
); \

693 i(
_Pkt
 !
NULL

_pAd
->
NumOfPktAoc
 ++;

	)

696 
	#DEV_ALLOC_SKB
(
_pAd
, 
_Pkt
, 
_ngth
) \

697 
_Pkt
 = 
	`dev_loc_skb
(
_ngth
);

	)

707 
	#RTMP_GPhysilAddssLow
(
PhysilAddss
(PhysilAddss)

	)

714 
	#RTMP_GPhysilAddssHigh
(
PhysilAddss
(0)

	)

722 
	#RTMP_SPhysilAddssLow
(
PhysilAddss
, 
Vue
) \

723 
PhysilAddss
 = 
Vue
;

	)

731 
	#RTMP_SPhysilAddssHigh
(
PhysilAddss
, 
Vue
)

	)

733 
	#NdisMIndiStus
(
_w
, 
_x
, 
_y
, 
_z
)

	)

740 #ifde
RTMP_MAC_PCI


741 #i
defed
(
INF_TWINPASS
|| defed(
INF_DANUBE
|| defed(
INF_AR9
|| defed(
IKANOS_VX_1X0
)

742 
	#RTMP_IO_FORCE_READ32
(
_A
, 
_R
, 
_pV
) \

744 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
))); \

745 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + (
_R
)))); \

746 (*
_pV
 = 
	`SWAP32
(*((
UINT32
 *)(_pV)))); \

747 }

	)

749 
	#RTMP_IO_READ32
(
_A
, 
_R
, 
_pV
) \

751 i((
_A
)->
bPCIkOff
 =
FALSE
) \

753 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
))); \

754 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + (
_R
)))); \

755 (*
_pV
 = 
	`SWAP32
(*((
UINT32
 *)(_pV)))); \

757 }

	)

759 
	#RTMP_IO_READ8
(
_A
, 
_R
, 
_pV
) \

761 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
))); \

762 (*
_pV
 = 
	`adb
((*)((
_A
)->
CSRBaAddss
 + (
_R
)))); \

763 }

	)

765 
	#_RTMP_IO_WRITE32
(
_A
, 
_R
, 
_V
) \

767 i((
_A
)->
bPCIkOff
 =
FALSE
) \

769 
UINT32
 
_V
; \

770 
_V
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
)); \

771 
_V
 = 
	`SWAP32
(
_V
); \

772 
	`wr
(
_V
, (*)((
_A
)->
CSRBaAddss
 + (
_R
))); \

774 }

	)

776 #ifde
INF_VR9


777 
	#RTMP_IO_WRITE8
(
_A
, 
_R
, 
_V
) \

779 
ULONG
 
V
; \

780 
UCHAR
 
_i
; \

781 
UINT32
 
_V
; \

782 
_i
 = ((
_R
) & 0x3); \

783 
V
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + ((
_R
- 
_i
))); \

784 
V
 = 
	`SWAP32
(Val); \

785 
V
 = V & (~(0x000000f<< ((
_i
)*8))); \

786 
V
 = V | ((
ULONG
)(
_V
<< ((
_i
)*8)); \

787 
V
 = 
	`SWAP32
(Val); \

788 
	`wr
((
V
), (*)((
_A
)->
CSRBaAddss
 + ((
_R
- 
_i
))); \

789 }

	)

791 
	#RTMP_IO_WRITE8
(
_A
, 
_R
, 
_V
) \

793 
UINT
 
V
; \

794 
V
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
)); \

795 
	`wreb
((
_V
), (
PUCHAR
)((
_A
)->
CSRBaAddss
 + (
_R
))); \

796 }

	)

799 
	#RTMP_IO_WRITE16
(
_A
, 
_R
, 
_V
) \

801 
UINT
 
V
; \

802 
V
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
)); \

803 
	`wrew
(
	`SWAP16
((
_V
)), (
PUSHORT
)((
_A
)->
CSRBaAddss
 + (
_R
))); \

804 }

	)

806 
	#RTMP_IO_FORCE_READ32
(
_A
, 
_R
, 
_pV
) \

808 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
))); \

809 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + (
_R
)))); \

810 }

	)

812 
	#RTMP_IO_READ32
(
_A
, 
_R
, 
_pV
) \

814 i((
_A
)->
bPCIkOff
 =
FALSE
) \

816 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
))); \

817 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + (
_R
)))); \

820 *
_pV
 = 0; \

821 }

	)

823 
	#RTMP_IO_FORCE_READ32
(
_A
, 
_R
, 
_pV
) \

825 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
))); \

826 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + (
_R
)))); \

827 }

	)

829 
	#RTMP_IO_READ8
(
_A
, 
_R
, 
_pV
) \

831 (*
_pV
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
))); \

832 (*
_pV
 = 
	`adb
((*)((
_A
)->
CSRBaAddss
 + (
_R
)))); \

833 }

	)

835 
	#_RTMP_IO_WRITE32
(
_A
, 
_R
, 
_V
) \

837 i((
_A
)->
bPCIkOff
 =
FALSE
) \

839 
UINT
 
V
; \

840 
V
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
)); \

841 
	`wr
((
_V
), (*)((
_A
)->
CSRBaAddss
 + (
_R
))); \

843 }

	)

845 
	#RTMP_IO_FORCE_WRITE32
(
_A
, 
_R
, 
_V
) \

847 
UINT
 
V
; \

848 
V
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
)); \

849 
	`wr
(
_V
, (*)((
_A
)->
CSRBaAddss
 + (
_R
))); \

850 }

	)

854 #i
defed
(
BRCM_6358
|| defed(
RALINK_2880
|| defed(
RALINK_3052
|| defed(
RALINK_2883
|| defed(
RTMP_RBUS_SUPPORT
)

855 
	#RTMP_IO_WRITE8
(
_A
, 
_R
, 
_V
) \

857 
ULONG
 
V
; \

858 
UCHAR
 
_i
; \

859 
_i
 = ((
_R
) & 0x3); \

860 
V
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + ((
_R
- 
_i
))); \

861 
V
 = V & (~(0x000000f<< ((
_i
)*8))); \

862 
V
 = V | ((
ULONG
)(
_V
<< ((
_i
)*8)); \

863 
	`wr
((
V
), (*)((
_A
)->
CSRBaAddss
 + ((
_R
- 
_i
))); \

864 }

	)

866 
	#RTMP_IO_WRITE8
(
_A
, 
_R
, 
_V
) \

868 
UINT
 
V
; \

869 
V
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
)); \

870 
	`wreb
((
_V
), (
PUCHAR
)((
_A
)->
CSRBaAddss
 + (
_R
))); \

871 }

	)

874 
	#RTMP_IO_WRITE16
(
_A
, 
_R
, 
_V
) \

876 
UINT
 
V
; \

877 
V
 = 
	`adl
((*)((
_A
)->
CSRBaAddss
 + 
MAC_CSR0
)); \

878 
	`wrew
((
_V
), (
PUSHORT
)((
_A
)->
CSRBaAddss
 + (
_R
))); \

879 }

	)

883 #ide
VENDOR_FEATURE3_SUPPORT


884 
	#RTMP_IO_WRITE32
 
_RTMP_IO_WRITE32


	)

894 
	#PKTSRC_NDIS
 0x7f

	)

895 
	#PKTSRC_DRIVER
 0x0f

	)

897 
	#RTMP_OS_NETDEV_STATE_RUNNING
(
_pNDev
((_pNDev)->
ags
 & 
IFF_UP
)

	)

899 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,29)

900 
	#RTMP_OS_NETDEV_GET_PRIV
(
_pNDev
((_pNDev)->
ml_iv
)

	)

901 
	#RTMP_OS_NETDEV_SET_PRIV
(
_pNDev
, 
_pPriv
((_pNDev)->
ml_iv
 = (_pPriv))

	)

903 
	#RTMP_OS_NETDEV_GET_PRIV
(
_pNDev
((_pNDev)->
iv
)

	)

904 
	#RTMP_OS_NETDEV_SET_PRIV
(
_pNDev
, 
_pPriv
((_pNDev)->
iv
 = (_pPriv))

	)

906 
	#RTMP_OS_NETDEV_GET_DEVNAME
(
_pNDev
((_pNDev)->
me
)

	)

907 
	#RTMP_OS_NETDEV_GET_PHYADDR
(
_pNDev
((_pNDev)->
dev_addr
)

	)

910 
	#RTMP_OS_NETDEV_GET_TYPE
(
_pNDev
((_pNDev)->
ty
)

	)

911 
	#RTMP_OS_NETDEV_SET_TYPE
(
_pNDev
, 
_ty
((_pNDev)->
ty
 = (_ty))

	)

913 
	#RTMP_OS_NETDEV_START_QUEUE
(
_pNDev

	`tif_t_queue
((_pNDev))

	)

914 
	#RTMP_OS_NETDEV_STOP_QUEUE
(
_pNDev

	`tif__queue
((_pNDev))

	)

915 
	#RTMP_OS_NETDEV_WAKE_QUEUE
(
_pNDev

	`tif_wake_queue
((_pNDev))

	)

916 
	#RTMP_OS_NETDEV_CARRIER_OFF
(
_pNDev

	`tif_r_off
((_pNDev))

	)

918 
	#QUEUE_ENTRY_TO_PACKET
(
pEry
) \

919 (
PNDIS_PACKET
)(
pEry
)

	)

921 
	#PACKET_TO_QUEUE_ENTRY
(
pPack
) \

922 (
PQUEUE_ENTRY
)(
pPack
)

	)

924 #ifde
CONFIG_5VT_ENHANCE


925 
	#BRIDGE_TAG
 0x35564252

927 

	)

928 
	#GET_SG_LIST_FROM_PACKET
(
_p
, 
_sc
) \

929 
	`_g_sg_li_om_ck
(
_p
, 
_sc
)

	)

931 
	#RELEASE_NDIS_PACKET
(
_pAd
, 
_pPack
, 
_Stus
) \

933 
	`RTMPFeNdisPack
(
_pAd
, 
_pPack
); \

934 }

	)

941 
	#RTPKT_TO_OSPKT
(
_p
((
sk_buff
 *)(_p))

	)

942 
	#OSPKT_TO_RTPKT
(
_p
((
PNDIS_PACKET
)(_p))

	)

944 
	#GET_OS_PKT_DATAPTR
(
_pkt
) \

945 (
	`RTPKT_TO_OSPKT
(
_pkt
)->
da
)

	)

946 
	#SET_OS_PKT_DATAPTR
(
_pkt
, 
_daP
) \

947 (
	`RTPKT_TO_OSPKT
(
_pkt
)->
da
(
_daP
)

	)

949 
	#GET_OS_PKT_LEN
(
_pkt
) \

950 (
	`RTPKT_TO_OSPKT
(
_pkt
)->
n
)

	)

951 
	#SET_OS_PKT_LEN
(
_pkt
, 
_n
) \

952 (
	`RTPKT_TO_OSPKT
(
_pkt
)->
n
(
_n
)

	)

954 
	#GET_OS_PKT_DATATAIL
(
_pkt
) \

955 (
	`RTPKT_TO_OSPKT
(
_pkt
)->

)

	)

956 
	#SET_OS_PKT_DATATAIL
(
_pkt
, 
_t
, 
_n
) \

957 ((
	`RTPKT_TO_OSPKT
(
_pkt
))->

(
PUCHAR
)((
_t
+ (
_n
))

	)

959 
	#GET_OS_PKT_HEAD
(
_pkt
) \

960 (
	`RTPKT_TO_OSPKT
(
_pkt
)->
hd
)

	)

962 
	#GET_OS_PKT_END
(
_pkt
) \

963 (
	`RTPKT_TO_OSPKT
(
_pkt
)->
d
)

	)

965 
	#GET_OS_PKT_NETDEV
(
_pkt
) \

966 (
	`RTPKT_TO_OSPKT
(
_pkt
)->
dev
)

	)

967 
	#SET_OS_PKT_NETDEV
(
_pkt
, 
_pNDev
) \

968 (
	`RTPKT_TO_OSPKT
(
_pkt
)->
dev
(
_pNDev
)

	)

970 
	#GET_OS_PKT_TYPE
(
_pkt
) \

971 (
	`RTPKT_TO_OSPKT
(
_pkt
))

	)

973 
	#GET_OS_PKT_NEXT
(
_pkt
) \

974 (
	`RTPKT_TO_OSPKT
(
_pkt
)->
xt
)

	)

977 
	#OS_PKT_CLONED
(
_pkt

	`skb_ed
(
	`RTPKT_TO_OSPKT
(_pkt))

	)

979 #ifde
VENDOR_FEATURE2_SUPPORT


980 
	#OS_PKT_CLONE
(
_pAd
, 
_pkt
, 
_c
, 
_ag
) \

981 
_c
 = 
	`skb_e
(
	`RTPKT_TO_OSPKT
(
_pkt
), 
_ag
); \

982 i(
_c
 !
NULL

_pAd
->
NumOfPktAoc
 ++;

	)

985 
	#OS_PKT_CLONE
(
_pAd
, 
_pkt
, 
_c
, 
_ag
) \

986 
_c
 = 
	`skb_e
(
	`RTPKT_TO_OSPKT
(
_pkt
), 
_ag
);

	)

989 
	#OS_NTOHS
(
_V
) \

990 (
	`ohs
(
_V
))

	)

991 
	#OS_HTONS
(
_V
) \

992 (
	`hts
(
_V
))

	)

993 
	#OS_NTOHL
(
_V
) \

994 (
	`ohl
(
_V
))

	)

995 
	#OS_HTONL
(
_V
) \

996 (
	`htl
(
_V
))

	)

998 
	#CB_OFF
 10

	)

1001 
	#RTMP_SET_PACKET_UP
(
_p
, 
_io
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+0] = _io)

	)

1002 
	#RTMP_GET_PACKET_UP
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+0])

	)

1005 
	#RTMP_SET_PACKET_FRAGMENTS
(
_p
, 
_num
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+1] = _num)

	)

1006 
	#RTMP_GET_PACKET_FRAGMENTS
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+1])

	)

1011 
	#RTMP_SET_PACKET_WCID
(
_p
, 
_wdsidx
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+2] = _wdsidx)

	)

1012 
	#RTMP_GET_PACKET_WCID
(
_p
((
UCHAR
)(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+2]))

	)

1015 
	#RTMP_SET_PACKET_SOURCE
(
_p
, 
_pktc
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+3] = _pktc)

	)

1016 
	#RTMP_GET_PACKET_SOURCE
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+3])

	)

1019 
	#RTMP_SET_PACKET_RTS
(
_p
, 
_num
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+4] = _num)

	)

1020 
	#RTMP_GET_PACKET_RTS
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+4])

	)

1024 
	#RTMP_SET_PACKET_TXRATE
(
_p
, 
_
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+5] = _)

	)

1025 
	#RTMP_GET_PACKET_TXRATE
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+5])

	)

1028 
	#RTMP_SET_PACKET_IF
(
_p
, 
_ifdx
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+6] = _ifdx)

	)

1029 
	#RTMP_GET_PACKET_IF
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+6])

	)

1030 
	#RTMP_SET_PACKET_NET_DEVICE_MBSSID
(
_p
, 
_bss

	`RTMP_SET_PACKET_IF
((_p), (_bss))

	)

1031 
	#RTMP_SET_PACKET_NET_DEVICE_WDS
(
_p
, 
_bss

	`RTMP_SET_PACKET_IF
((_p), ((_bss+ 
MIN_NET_DEVICE_FOR_WDS
))

	)

1032 
	#RTMP_SET_PACKET_NET_DEVICE_APCLI
(
_p
, 
_idx

	`RTMP_SET_PACKET_IF
((_p), ((_idx+ 
MIN_NET_DEVICE_FOR_APCLI
))

	)

1033 
	#RTMP_SET_PACKET_NET_DEVICE_MESH
(
_p
, 
_idx

	`RTMP_SET_PACKET_IF
((_p), ((_idx+ 
MIN_NET_DEVICE_FOR_MESH
))

	)

1034 
	#RTMP_GET_PACKET_NET_DEVICE_MBSSID
(
_p

	`RTMP_GET_PACKET_IF
((_p))

	)

1035 
	#RTMP_GET_PACKET_NET_DEVICE
(
_p

	`RTMP_GET_PACKET_IF
((_p))

	)

1037 
	#RTMP_SET_PACKET_MOREDATA
(
_p
, 
_meb
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+7] = _meb)

	)

1038 
	#RTMP_GET_PACKET_MOREDATA
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+7])

	)

1047 
	#RTMP_PACKET_SPECIFIC_CB_OFFSET
 11

	)

1049 
	#RTMP_PACKET_SPECIFIC_DHCP
 0x01

	)

1050 
	#RTMP_PACKET_SPECIFIC_EAPOL
 0x02

	)

1051 
	#RTMP_PACKET_SPECIFIC_IPV4
 0x04

	)

1052 
	#RTMP_PACKET_SPECIFIC_WAI
 0x08

	)

1053 
	#RTMP_PACKET_SPECIFIC_VLAN
 0x10

	)

1054 
	#RTMP_PACKET_SPECIFIC_LLCSNAP
 0x20

	)

1057 
	#RTMP_SET_PACKET_SPECIFIC
(
_p
, 
_g
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+11] = _g)

	)

1060 
	#RTMP_SET_PACKET_DHCP
(
_p
, 
_g
) \

1062 i(
_g
) \

1063 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]|(
RTMP_PACKET_SPECIFIC_DHCP
); \

1065 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]&(~
RTMP_PACKET_SPECIFIC_DHCP
); \

1066 }0)

	)

1067 
	#RTMP_GET_PACKET_DHCP
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+11] & 
RTMP_PACKET_SPECIFIC_DHCP
)

	)

1070 
	#RTMP_SET_PACKET_EAPOL
(
_p
, 
_g
) \

1072 i(
_g
) \

1073 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]|(
RTMP_PACKET_SPECIFIC_EAPOL
); \

1075 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]&(~
RTMP_PACKET_SPECIFIC_EAPOL
); \

1076 }0)

	)

1077 
	#RTMP_GET_PACKET_EAPOL
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+11] & 
RTMP_PACKET_SPECIFIC_EAPOL
)

	)

1080 
	#RTMP_SET_PACKET_WAI
(
_p
, 
_g
) \

1082 i(
_g
) \

1083 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]|(
RTMP_PACKET_SPECIFIC_WAI
); \

1085 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]&(~
RTMP_PACKET_SPECIFIC_WAI
); \

1086 }0)

	)

1087 
	#RTMP_GET_PACKET_WAI
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+11] & 
RTMP_PACKET_SPECIFIC_WAI
)

	)

1089 
	#RTMP_GET_PACKET_LOWRATE
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+11] & (
RTMP_PACKET_SPECIFIC_EAPOL
 | 
RTMP_PACKET_SPECIFIC_DHCP
 | 
RTMP_PACKET_SPECIFIC_WAI
))

	)

1092 
	#RTMP_SET_PACKET_VLAN
(
_p
, 
_g
) \

1094 i(
_g
) \

1095 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]|(
RTMP_PACKET_SPECIFIC_VLAN
); \

1097 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]&(~
RTMP_PACKET_SPECIFIC_VLAN
); \

1098 }0)

	)

1099 
	#RTMP_GET_PACKET_VLAN
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+11] & 
RTMP_PACKET_SPECIFIC_VLAN
)

	)

1102 
	#RTMP_SET_PACKET_LLCSNAP
(
_p
, 
_g
) \

1104 i(
_g
) \

1105 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]|(
RTMP_PACKET_SPECIFIC_LLCSNAP
); \

1107 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]&(~
RTMP_PACKET_SPECIFIC_LLCSNAP
); \

1108 }0)

	)

1110 
	#RTMP_GET_PACKET_LLCSNAP
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+11] & 
RTMP_PACKET_SPECIFIC_LLCSNAP
)

	)

1113 
	#RTMP_SET_PACKET_IPV4
(
_p
, 
_g
) \

1115 i(
_g
) \

1116 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]|(
RTMP_PACKET_SPECIFIC_IPV4
); \

1118 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+11]&(~
RTMP_PACKET_SPECIFIC_IPV4
); \

1119 }0)

	)

1121 
	#RTMP_GET_PACKET_IPV4
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+11] & 
RTMP_PACKET_SPECIFIC_IPV4
)

	)

1125 
	#RTMP_SET_PACKET_CLEAR_EAP_FRAME
(
_p
, 
_g
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+12] = _g)

	)

1126 
	#RTMP_GET_PACKET_CLEAR_EAP_FRAME
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+12])

	)

1129 
	#MAX_PACKETS_IN_QUEUE
 (512)

	)

1134 
	#RTMP_SET_PACKET_5VT
(
_p
, 
_g
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+22] = _g)

	)

1135 
	#RTMP_GET_PACKET_5VT
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+22])

	)

1137 
	#RTMP_SET_PACKET_PROTOCOL
(
_p
, 
_oc
) {\

1138 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+23] = (
UINT8
)((
_oc
) & 0x00ff)); \

1139 (
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+24] = (
UINT8
)(((
_oc
) & 0xff00) >> 8)); \

1140 }

	)

1142 
	#RTMP_GET_PACKET_PROTOCOL
(
_p
) \

1143 ((((
UINT16
)(
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+24]) & 0x00ff) << 8) \

1144 | ((
UINT16
)(
	`RTPKT_TO_OSPKT
(
_p
)->
cb
[
CB_OFF
+23]& 0x00ff))

	)

1146 #ifde
INF_AMAZON_SE


1148 
	#RTMP_SET_PACKET_NOBULKOUT
(
_p
, 
_meb
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+28] = _meb)

	)

1149 
	#RTMP_GET_PACKET_NOBULKOUT
(
_p
(
	`RTPKT_TO_OSPKT
(_p)->
cb
[
CB_OFF
+28])

	)

1161 
RTMP_GCutSyemTime
(
LARGE_INTEGER
 *
time
);

1162 
28xx_ck_xm
(
sk_buff
 *
skb
);

1165 #i
LINUX_VERSION_CODE
 <= 0x20402

1166 
t_devi
 *
loc_tdev
(
sizeof_iv
, cڡ *
mask
, (*
tup
)(net_device *));

1170 #ifde
RTMP_MAC_PCI


1172 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

1173 
	#IRQ_HANDLE_TYPE
 
qtu_t


	)

1175 
	#IRQ_HANDLE_TYPE
 

	)

1178 
IRQ_HANDLE_TYPE


1179 #i(
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,19))

1180 
	`2860_u
(
q
, *
dev_
);

1182 
	`2860_u
(
q
, *
dev_
, 
_gs
 *
gs
);

1187 
INT
 
	`28xx_iol
(

1188 
IN
 
PNET_DEV
 
t_dev
,

1189 
IN
 
OUT
 
ieq
 *
rq
,

1190 
IN
 
INT
 
cmd
);

1193 #ifde
CONFIG_STA_SUPPORT


1194 
INT
 
	`28xx_a_iol
(

1195 
IN
 
PNET_DEV
 
t_dev
,

1196 
IN
 
OUT
 
ieq
 *
rq
,

1197 
IN
 
INT
 
cmd
);

1200 
	`_mtd_wre
(
num
, 
loff_t
 
to
, 
size_t
 
n
, cڡ 
u_ch
 *
buf
);

1201 
	`_mtd_ad
(
num
, 
loff_t
 
om
, 
size_t
 
n
, 
u_ch
 *
buf
);

1203 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,29)

1204 
	#GET_PAD_FROM_NET_DEV
(
_pAd
, 
_t_dev
(_pAd(
PRTMP_ADAPTER
)(_t_dev)->
ml_iv
;

	)

1206 
	#GET_PAD_FROM_NET_DEV
(
_pAd
, 
_t_dev
(_pAd(
PRTMP_ADAPTER
)(_t_dev)->
iv
;

	)

1210 #ifde
RALINK_ATE


1216 
	#e_t
 
tk


	)

1217 
	#ATEDBGPRINT
 
DBGPRINT


	)

1218 #ifde
RTMP_MAC_PCI


1219 #ifde
CONFIG_STA_SUPPORT


1220 
	#EEPROM_BIN_FILE_NAME
 "/c/Wess/RT2860STA/e2p.b"

	)

	@include/rt_ate.h

28 #ide
__ATE_H__


29 
	#__ATE_H__


	)

31 #ifde
RALINK_QA


33 
	#RACFG_CMD_RF_WRITE_ALL
 0x0000

	)

34 
	#RACFG_CMD_E2PROM_READ16
 0x0001

	)

35 
	#RACFG_CMD_E2PROM_WRITE16
 0x0002

	)

36 
	#RACFG_CMD_E2PROM_READ_ALL
 0x0003

	)

37 
	#RACFG_CMD_E2PROM_WRITE_ALL
 0x0004

	)

38 
	#RACFG_CMD_IO_READ
 0x0005

	)

39 
	#RACFG_CMD_IO_WRITE
 0x0006

	)

40 
	#RACFG_CMD_IO_READ_BULK
 0x0007

	)

41 
	#RACFG_CMD_BBP_READ8
 0x0008

	)

42 
	#RACFG_CMD_BBP_WRITE8
 0x0009

	)

43 
	#RACFG_CMD_BBP_READ_ALL
 0x000a

	)

44 
	#RACFG_CMD_GET_COUNTER
 0x000b

	)

45 
	#RACFG_CMD_CLEAR_COUNTER
 0x000c

	)

47 
	#RACFG_CMD_RSV1
 0x000d

	)

48 
	#RACFG_CMD_RSV2
 0x000e

	)

49 
	#RACFG_CMD_RSV3
 0x000f

	)

51 
	#RACFG_CMD_TX_START
 0x0010

	)

52 
	#RACFG_CMD_GET_TX_STATUS
 0x0011

	)

53 
	#RACFG_CMD_TX_STOP
 0x0012

	)

54 
	#RACFG_CMD_RX_START
 0x0013

	)

55 
	#RACFG_CMD_RX_STOP
 0x0014

	)

56 
	#RACFG_CMD_GET_NOISE_LEVEL
 0x0015

	)

58 
	#RACFG_CMD_ATE_START
 0x0080

	)

59 
	#RACFG_CMD_ATE_STOP
 0x0081

	)

61 
	#RACFG_CMD_ATE_START_TX_CARRIER
 0x0100

	)

62 
	#RACFG_CMD_ATE_START_TX_CONT
 0x0101

	)

63 
	#RACFG_CMD_ATE_START_TX_FRAME
 0x0102

	)

64 
	#RACFG_CMD_ATE_SET_BW
 0x0103

	)

65 
	#RACFG_CMD_ATE_SET_TX_POWER0
 0x0104

	)

66 
	#RACFG_CMD_ATE_SET_TX_POWER1
 0x0105

	)

67 
	#RACFG_CMD_ATE_SET_FREQ_OFFSET
 0x0106

	)

68 
	#RACFG_CMD_ATE_GET_STATISTICS
 0x0107

	)

69 
	#RACFG_CMD_ATE_RESET_COUNTER
 0x0108

	)

70 
	#RACFG_CMD_ATE_SEL_TX_ANTENNA
 0x0109

	)

71 
	#RACFG_CMD_ATE_SEL_RX_ANTENNA
 0x010a

	)

72 
	#RACFG_CMD_ATE_SET_PREAMBLE
 0x010b

	)

73 
	#RACFG_CMD_ATE_SET_CHANNEL
 0x010c

	)

74 
	#RACFG_CMD_ATE_SET_ADDR1
 0x010d

	)

75 
	#RACFG_CMD_ATE_SET_ADDR2
 0x010e

	)

76 
	#RACFG_CMD_ATE_SET_ADDR3
 0x010f

	)

77 
	#RACFG_CMD_ATE_SET_RATE
 0x0110

	)

78 
	#RACFG_CMD_ATE_SET_TX_FRAME_LEN
 0x0111

	)

79 
	#RACFG_CMD_ATE_SET_TX_FRAME_COUNT
 0x0112

	)

80 
	#RACFG_CMD_ATE_START_RX_FRAME
 0x0113

	)

81 
	#RACFG_CMD_ATE_E2PROM_READ_BULK
 0x0114

	)

82 
	#RACFG_CMD_ATE_E2PROM_WRITE_BULK
 0x0115

	)

83 
	#RACFG_CMD_ATE_IO_WRITE_BULK
 0x0116

	)

84 
	#RACFG_CMD_ATE_BBP_READ_BULK
 0x0117

	)

85 
	#RACFG_CMD_ATE_BBP_WRITE_BULK
 0x0118

	)

86 
	#RACFG_CMD_ATE_RF_READ_BULK
 0x0119

	)

87 
	#RACFG_CMD_ATE_RF_WRITE_BULK
 0x011a

	)

88 
	#RACFG_CMD_ATE_SET_TX_POWER2
 0x011b

	)

93 
	#ATE_ON
(
_p
(((_p)->
e
.
Mode
!
ATE_STOP
)

	)

95 #ifde
RTMP_MAC_PCI


96 
NTSTATUS
 
ATE_RT3562WreBBPR66
(

97 
IN
 
PRTMP_ADAPTER
 
pAd
,

98 
IN
 
UCHAR
 
Vue
);

100 
	#ATEPCIRdBBPRegi
(
_A
, 
_I
, 
_pV
) \

102 
BBP_CSR_CFG_STRUC
 
BbpC
; \

103 
j
, 
k
; \

104 
j
=0; j<
MAX_BUSY_COUNT
; j++) \

106 
	`RTMP_IO_READ32
(
_A
, 
BBP_CSR_CFG
, &
BbpC
.
wd
); \

107 i(
BbpC
.
fld
.
Busy
 =
BUSY
) \

111 
BbpC
.
wd
 = 0; \

112 
BbpC
.
fld
.
fRd
 = 1; \

113 
BbpC
.
fld
.
BBP_RW_MODE
 = 1; \

114 
BbpC
.
fld
.
Busy
 = 1; \

115 
BbpC
.
fld
.
RegNum
 = 
_I
; \

116 
	`RTMP_IO_WRITE32
(
_A
, 
BBP_CSR_CFG
, 
BbpC
.
wd
); \

117 
k
=0; k<
MAX_BUSY_COUNT
; k++) \

119 
	`RTMP_IO_READ32
(
_A
, 
BBP_CSR_CFG
, &
BbpC
.
wd
); \

120 i(
BbpC
.
fld
.
Busy
 =
IDLE
) \

123 i((
BbpC
.
fld
.
Busy
 =
IDLE
) && \

124 (
BbpC
.
fld
.
RegNum
 =
_I
)) \

126 *(
_pV
(
UCHAR
)
BbpC
.
fld
.
Vue
; \

130 i(
BbpC
.
fld
.
Busy
 =
BUSY
) \

132 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("BBPd R%d fa\n", 
_I
)); \

133 *(
_pV
(
_A
)->
BbpWreLch
[
_I
]; \

135 }

	)

137 
	#ATEPCIWreBBPRegi
(
_A
, 
_I
, 
_V
) \

139 
BBP_CSR_CFG_STRUC
 
BbpC
; \

140 
BusyC
; \

141 
BusyC
=0; BusyC<
MAX_BUSY_COUNT
; BusyCnt++) \

143 
	`RTMP_IO_READ32
(
_A
, 
BBP_CSR_CFG
, &
BbpC
.
wd
); \

144 i(
BbpC
.
fld
.
Busy
 =
BUSY
) \

146 
BbpC
.
wd
 = 0; \

147 
BbpC
.
fld
.
fRd
 = 0; \

148 
BbpC
.
fld
.
BBP_RW_MODE
 = 1; \

149 
BbpC
.
fld
.
Busy
 = 1; \

150 
BbpC
.
fld
.
Vue
 = 
_V
; \

151 
BbpC
.
fld
.
RegNum
 = 
_I
; \

152 
	`RTMP_IO_WRITE32
(
_A
, 
BBP_CSR_CFG
, 
BbpC
.
wd
); \

153 (
_A
)->
BbpWreLch
[
_I
] = 
_V
; \

156 i(
BusyC
 =
MAX_BUSY_COUNT
) \

158 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("BBP wrR%d fa\n", 
_I
)); \

160 }

	)

162 
	#ATE_BBP_IO_READ8_BY_REG_ID
(
_A
, 
_I
, 
_pV

	`ATEPCIRdBBPRegi
(_A, _I, _pV)

	)

164 
	#ATE_BBP_IO_WRITE8_BY_REG_ID
(
_A
, 
_I
, 
_V

	`ATEPCIWreBBPRegi
(_A, _I, _V)

	)

170 
VOID
 
__ad_l
(

171 
IN
 
PRTMP_ADAPTER
 
pAd
,

172 
OUT
 
USHORT
 *
Da
);

174 
VOID
 
__wre_l
(

175 
IN
 
PRTMP_ADAPTER
 
pAd
,

176 
IN
 
USHORT
 *
Da
);

178 
INT
 
S_ATE_Proc
(

179 
IN
 
PRTMP_ADAPTER
 
pAd
,

180 
IN
 
PSTRING
 
g
);

182 
INT
 
S_ATE_DA_Proc
(

183 
IN
 
PRTMP_ADAPTER
 
pAd
,

184 
IN
 
PSTRING
 
g
);

186 
INT
 
S_ATE_SA_Proc
(

187 
IN
 
PRTMP_ADAPTER
 
pAd
,

188 
IN
 
PSTRING
 
g
);

190 
INT
 
S_ATE_BSSID_Proc
(

191 
IN
 
PRTMP_ADAPTER
 
pAd
,

192 
IN
 
PSTRING
 
g
);

194 
INT
 
S_ATE_CHANNEL_Proc
(

195 
IN
 
PRTMP_ADAPTER
 
pAd
,

196 
IN
 
PSTRING
 
g
);

198 #ifde
RTMP_INTERNAL_TX_ALC


199 
INT
 
S_ATE_TSSI_CALIBRATION_Proc
(

200 
IN
 
PRTMP_ADAPTER
 
pAd
,

201 
IN
 
PSTRING
 
g
);

204 
INT
 
S_ATE_TX_POWER0_Proc
(

205 
IN
 
PRTMP_ADAPTER
 
pAd
,

206 
IN
 
PSTRING
 
g
);

208 
INT
 
S_ATE_TX_POWER1_Proc
(

209 
IN
 
PRTMP_ADAPTER
 
pAd
,

210 
IN
 
PSTRING
 
g
);

213 
INT
 
S_ATE_TX_A_Proc
(

214 
IN
 
PRTMP_ADAPTER
 
pAd
,

215 
IN
 
PSTRING
 
g
);

217 
INT
 
S_ATE_RX_A_Proc
(

218 
IN
 
PRTMP_ADAPTER
 
pAd
,

219 
IN
 
PSTRING
 
g
);

222 
INT
 
S_ATE_TX_FREQOFFSET_Proc
(

223 
IN
 
PRTMP_ADAPTER
 
pAd
,

224 
IN
 
PSTRING
 
g
);

226 
INT
 
S_ATE_TX_BW_Proc
(

227 
IN
 
PRTMP_ADAPTER
 
pAd
,

228 
IN
 
PSTRING
 
g
);

230 
INT
 
S_ATE_TX_LENGTH_Proc
(

231 
IN
 
PRTMP_ADAPTER
 
pAd
,

232 
IN
 
PSTRING
 
g
);

234 
INT
 
S_ATE_TX_COUNT_Proc
(

235 
IN
 
PRTMP_ADAPTER
 
pAd
,

236 
IN
 
PSTRING
 
g
);

238 
INT
 
S_ATE_TX_MCS_Proc
(

239 
IN
 
PRTMP_ADAPTER
 
pAd
,

240 
IN
 
PSTRING
 
g
);

242 
INT
 
S_ATE_TX_MODE_Proc
(

243 
IN
 
PRTMP_ADAPTER
 
pAd
,

244 
IN
 
PSTRING
 
g
);

246 
INT
 
S_ATE_TX_GI_Proc
(

247 
IN
 
PRTMP_ADAPTER
 
pAd
,

248 
IN
 
PSTRING
 
g
);

251 
INT
 
S_ATE_RX_FER_Proc
(

252 
IN
 
PRTMP_ADAPTER
 
pAd
,

253 
IN
 
PSTRING
 
g
);

255 
INT
 
S_ATE_Rd_RF_Proc
(

256 
IN
 
PRTMP_ADAPTER
 
pAd
,

257 
IN
 
PSTRING
 
g
);

259 
INT
 
S_ATE_Wre_RF1_Proc
(

260 
IN
 
PRTMP_ADAPTER
 
pAd
,

261 
IN
 
PSTRING
 
g
);

263 
INT
 
S_ATE_Wre_RF2_Proc
(

264 
IN
 
PRTMP_ADAPTER
 
pAd
,

265 
IN
 
PSTRING
 
g
);

267 
INT
 
S_ATE_Wre_RF3_Proc
(

268 
IN
 
PRTMP_ADAPTER
 
pAd
,

269 
IN
 
PSTRING
 
g
);

271 
INT
 
S_ATE_Wre_RF4_Proc
(

272 
IN
 
PRTMP_ADAPTER
 
pAd
,

273 
IN
 
PSTRING
 
g
);

275 
INT
 
S_ATE_Ld_E2P_Proc
(

276 
IN
 
PRTMP_ADAPTER
 
pAd
,

277 
IN
 
PSTRING
 
g
);

279 
INT
 
S_ATE_Rd_E2P_Proc
(

280 
IN
 
PRTMP_ADAPTER
 
pAd
,

281 
IN
 
PSTRING
 
g
);

284 
INT
 
S_ATE_AUTO_ALC_Proc
(

285 
IN
 
PRTMP_ADAPTER
 
pAd
,

286 
IN
 
PSTRING
 
g
);

288 
INT
 
S_ATE_IPG_Proc
(

289 
IN
 
PRTMP_ADAPTER
 
pAd
,

290 
IN
 
PSTRING
 
g
);

292 
INT
 
S_ATE_Payld_Proc
(

293 
IN
 
PRTMP_ADAPTER
 
pAd
,

294 
IN
 
PSTRING
 
g
);

296 
INT
 
S_ATE_Show_Proc
(

297 
IN
 
PRTMP_ADAPTER
 
pAd
,

298 
IN
 
PSTRING
 
g
);

300 
INT
 
S_ATE_Hp_Proc
(

301 
IN
 
PRTMP_ADAPTER
 
pAd
,

302 
IN
 
PSTRING
 
g
);

304 #ifde
RALINK_QA


305 
VOID
 
ATE_QA_Stiics
(

306 
IN
 
PRTMP_ADAPTER
 
pAd
,

307 
IN
 
PRXWI_STRUC
 
pRxWI
,

308 
IN
 
PRT28XX_RXD_STRUC
 
p28xxRxD
,

309 
IN
 
PHEADER_802_11
 
pHd
);

311 
INT
 
RtmpDoA
(

312 
IN
 
PRTMP_ADAPTER
 
pAdr
,

313 
IN
 
iwq
 *
wrq
);

315 
VOID
 
BubbSt
(

316 
IN
 
INT32
 
n
,

317 
IN
 
INT32
 
a
[]);

319 
VOID
 
CNoiLev
(

320 
IN
 
PRTMP_ADAPTER
 
pAdr
,

321 
IN
 
UCHAR
 
chl
,

322 
OUT
 
INT32
 
bufr
[3][10]);

324 
BOOLEAN
 
SyncTxRxCfig
(

325 
IN
 
PRTMP_ADAPTER
 
pAdr
,

326 
IN
 
USHORT
 
offt
,

327 
IN
 
UCHAR
 
vue
);

329 
INT
 
S_TxSt_Proc
(

330 
IN
 
PRTMP_ADAPTER
 
pAd
,

331 
IN
 
PSTRING
 
g
);

333 
INT
 
S_RxSt_Proc
(

334 
IN
 
PRTMP_ADAPTER
 
pAd
,

335 
IN
 
PSTRING
 
g
);

337 #ifde
DBG


338 
INT
 
S_EERd_Proc
(

339 
IN
 
PRTMP_ADAPTER
 
pAd
,

340 
IN
 
PSTRING
 
g
);

342 
INT
 
S_EEWre_Proc
(

343 
IN
 
PRTMP_ADAPTER
 
pAd
,

344 
IN
 
PSTRING
 
g
);

346 
INT
 
S_BBPRd_Proc
(

347 
IN
 
PRTMP_ADAPTER
 
pAd
,

348 
IN
 
PSTRING
 
g
);

350 
INT
 
S_BBPWre_Proc
(

351 
IN
 
PRTMP_ADAPTER
 
pAd
,

352 
IN
 
PSTRING
 
g
);

354 
INT
 
S_RFWre_Proc
(

355 
IN
 
PRTMP_ADAPTER
 
pAd
,

356 
IN
 
PSTRING
 
g
);

361 
VOID
 
ATEAsicSwchChl
(

362 
IN
 
PRTMP_ADAPTER
 
pAd
);

364 
VOID
 
ATEAsicAdjuTxPow
(

365 
IN
 
PRTMP_ADAPTER
 
pAd
);

367 
VOID
 
ATEDibAsicPre
(

368 
IN
 
PRTMP_ADAPTER
 
pAd
);

370 
CHAR
 
ATECvtToRssi
(

371 
IN
 
PRTMP_ADAPTER
 
pAd
,

372 
IN
 
CHAR
 
Rssi
,

373 
IN
 
UCHAR
 
RssiNumb
);

375 
VOID
 
ATESameRssi
(

376 
IN
 
PRTMP_ADAPTER
 
pAd
,

377 
IN
 
PRXWI_STRUC
 
pRxWI
);

380 #ifde
CONFIG_STA_SUPPORT


381 
VOID
 
RTMPStiSt
(

382 
IN
 
PRTMP_ADAPTER
 
pAd
);

384 
VOID
 
RTMPStiS
(

385 
IN
 
PRTMP_ADAPTER
 
pAd
);

	@include/rt_config.h

40 #idef 
__RT_CONFIG_H__


41 
	#__RT_CONFIG_H__


	)

43 
	#VENDOR_FEATURE1_SUPPORT


	)

50 #ifde
CONFIG_STA_SUPPORT


54 #ifde
VENDOR_FEATURE3_SUPPORT


55 #ifde
DOT1X_SUPPORT


56 #unde
DOT1X_SUPPORT


58 #ifde
SYSTEM_LOG_SUPPORT


59 #unde
SYSTEM_LOG_SUPPORT


61 #ifde
LED_CONTROL_SUPPORT


62 #unde
LED_CONTROL_SUPPORT


64 #ifde
WSC_LED_SUPPORT


65 #unde
WSC_LED_SUPPORT


71 
	~"mp_ty.h
"

72 
	~"mp_os.h
"

74 
	~"mp_def.h
"

75 
	~"mp_ch.h
"

76 
	~"mp_tim.h
"

79 #ifde
LINUX


80 #ifde
RT_CFG80211_SUPPORT


81 
	~"cfg80211ex.h
"

85 #ifde
CONFIG_STA_SUPPORT


88 
	~"oid.h
"

89 
	~"mlme.h
"

90 
	~"y_md5.h
"

91 
	~"y_sha2.h
"

92 
	~"y_hmac.h
"

93 
	~"y_s.h
"

94 
	~"y_c4.h
"

95 
	~"mp_cmd.h
"

96 
	~"mp.h
"

97 
	~".h
"

98 
	~"w.h
"

99 
	~"dfs.h
"

100 
	~"chli.h
"

101 
	~"erum.h
"

103 
	~"om.h
"

104 #i
defed
(
RTMP_PCI_SUPPORT
|| defed(
RTMP_USB_SUPPORT
)

105 
	~"mp_mcu.h
"

110 #unde
AP_WSC_INCLUDED


111 #unde
STA_WSC_INCLUDED


112 #unde
WSC_INCLUDED


116 #ifde
CONFIG_STA_SUPPORT


119 #ifde
BLOCK_NET_IF


120 
	~"tif_block.h
"

123 #ifde
IGMP_SNOOP_SUPPORT


124 
	~"igmp_o.h
"

127 #ifde
RALINK_ATE


128 
	~"_e.h
"

129 #ifde
LINUX


130 
	~<lux/time.h
>

134 #ifde
RALINK_QA


135 #ide
RALINK_ATE


145 #i
defed
(
AP_WSC_INCLUDED
|| defed(
STA_WSC_INCLUDED
)

146 
	#WSC_INCLUDED


	)

150 #ifde
CONFIG_STA_SUPPORT


151 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


152 #ide
WPA_SUPPLICANT_SUPPORT


161 #ifde
IKANOS_VX_1X0


162 
	~"vr_iks.h
"

170 #ifde
CONFIG_STA_SUPPORT


171 
	~"a_cfg.h
"

174 #ifde
LINUX


175 #ifde
RT_CFG80211_SUPPORT


176 
	~"cfg80211.h
"

179 #ifde
BG_FT_SUPPORT


180 
	~"br_ph.h
"

186 #ifde
WLAN_LED


187 
	~"d.h
"

	@include/rtmp.h

40 #ide
__RTMP_H__


41 
	#__RTMP_H__


	)

43 
	~"lk_li.h
"

44 
	~"erum_def.h
"

46 
	~"mp_d11.h
"

47 
	~"w_cmm.h
"

49 #ifde
CONFIG_STA_SUPPORT


52 
	~"wsc.h
"

57 
	~"mp_ch.h
"

63 #ifde
CLIENT_WDS


64 
	~"_wds_cmm.h
"

70 
_RTMP_ADAPTER
 
	tRTMP_ADAPTER
;

71 
_RTMP_ADAPTER
 *
	tPRTMP_ADAPTER
;

73 
_RTMP_CHIP_OP_
 
	tRTMP_CHIP_OP
;

82 
	#MAX_DATAMM_RETRY
 3

	)

83 
	#MGMT_USE_QUEUE_FLAG
 0x80

	)

86 
	#MAXSEQ
 (0xFFF)

	)

88 
	#MAX_MCS_SET
 16

	)

90 #i
defed
(
CONFIG_AP_SUPPORT
&& defed(
CONFIG_STA_SUPPORT
)

91 
	#IF_DEV_CONFIG_OPMODE_ON_AP
(
_pAd
if(_pAd->
OpMode
 =
OPMODE_AP
)

	)

92 
	#IF_DEV_CONFIG_OPMODE_ON_STA
(
_pAd
if(_pAd->
OpMode
 =
OPMODE_STA
)

	)

94 
	#IF_DEV_CONFIG_OPMODE_ON_AP
(
_pAd
)

	)

95 
	#IF_DEV_CONFIG_OPMODE_ON_STA
(
_pAd
)

	)

98 
	#MAX_TXPOWER_ARRAY_SIZE
 5

	)

100 
CISCO_OUI
[];

101 
UCHAR
 
BaSizeAay
[4];

103 
UCHAR
 
BROADCAST_ADDR
[
MAC_ADDR_LEN
];

104 
UCHAR
 
ZERO_MAC_ADDR
[
MAC_ADDR_LEN
];

105 
ULONG
 
BIT32
[32];

106 
UCHAR
 
BIT8
[8];

107 * 
ChName
[];

108 
UCHAR
 
RxwiMCSToOfdmRe
[12];

109 
UCHAR
 
SNAP_802_1H
[6];

110 
UCHAR
 
SNAP_BRIDGE_TUNNEL
[6];

111 
UCHAR
 
EAPOL
[2];

112 
UCHAR
 
IPX
[2];

113 
UCHAR
 
TPID
[];

114 
UCHAR
 
APPLE_TALK
[2];

115 
UCHAR
 
OfdmReToRxwiMCS
[];

116 
UCHAR
 
MUrPriܙyToAcssCegy
[8];

118 
USHORT
 
ReUpPER
[];

119 
USHORT
 
ReDownPER
[];

120 
UCHAR
 
Phy11BNextReDownwd
[];

121 
UCHAR
 
Phy11BNextReUpwd
[];

122 
UCHAR
 
Phy11BGNextReDownwd
[];

123 
UCHAR
 
Phy11BGNextReUpwd
[];

124 
UCHAR
 
Phy11ANextReDownwd
[];

125 
UCHAR
 
Phy11ANextReUpwd
[];

126 
ReIdToMbps
[];

127 
USHORT
 
ReIdTo500Kbps
[];

129 
UCHAR
 
ChSueWNeTk
[];

130 
UCHAR
 
ChSueWNeTkL
;

132 
UCHAR
 
ChSueWNeAes
[];

133 
UCHAR
 
ChSueWNeAesL
;

135 
UCHAR
 
SsidIe
;

136 
UCHAR
 
SupReIe
;

137 
UCHAR
 
ExtReIe
;

139 #ifde
DOT11_N_SUPPORT


140 
UCHAR
 
HtCIe
;

141 
UCHAR
 
AddHtInfoIe
;

142 
UCHAR
 
NewExtChIe
;

143 
UCHAR
 
BssCxiIe
;

144 
UCHAR
 
ExtHtCIe
;

146 
UCHAR
 
ExtCIe
;

148 
UCHAR
 
EIe
;

149 
UCHAR
 
DsIe
;

150 
UCHAR
 
TimIe
;

151 
UCHAR
 
WIe
;

152 
UCHAR
 
W2Ie
;

153 
UCHAR
 
IbssIe
;

154 
UCHAR
 
WiIe
;

156 
UCHAR
 
WPA_OUI
[];

157 
UCHAR
 
RSN_OUI
[];

158 
UCHAR
 
WAPI_OUI
[];

159 
UCHAR
 
WME_INFO_ELEM
[];

160 
UCHAR
 
WME_PARM_ELEM
[];

161 
UCHAR
 
RALINK_OUI
[];

162 
UCHAR
 
PowCڡtIE
[];

165 
UCHAR
 
ReSwchTab
[];

166 
UCHAR
 
ReSwchTab11B
[];

167 
UCHAR
 
ReSwchTab11G
[];

168 
UCHAR
 
ReSwchTab11BG
[];

170 #ifde
DOT11_N_SUPPORT


171 
UCHAR
 
ReSwchTab11BGN1S
[];

172 
UCHAR
 
ReSwchTab11BGN2S
[];

173 
UCHAR
 
ReSwchTab11BGN2SFABd
[];

174 
UCHAR
 
ReSwchTab11N1S
[];

175 
UCHAR
 
ReSwchTab11N2S
[];

176 
UCHAR
 
ReSwchTab11N3S
[];

177 
UCHAR
 
ReSwchTab11N3SRmt
[];

178 
UCHAR
 
ReSwchTab11N2SFABd
[];

179 
UCHAR
 
ReSwchTab11BGN3S
[];

180 
UCHAR
 
ReSwchTab11BGN3SFABd
[];

182 #ifde
CONFIG_STA_SUPPORT


183 
UCHAR
 
PRE_N_HT_OUI
[];

188 #ifde
RALINK_ATE


189 
	s_ATE_INFO
 {

190 
UCHAR
 
	mMode
;

191 
BOOLEAN
 
	mPassiveMode
;

192 
CHAR
 
	mTxPow0
;

193 
CHAR
 
	mTxPow1
;

194 
CHAR
 
	mTxAS
;

195 
CHAR
 
	mRxAS
;

196 
TXWI_STRUC
 
	mTxWI
;

197 
USHORT
 
	mQID
;

198 
UCHAR
 
	mAddr1
[
MAC_ADDR_LEN
];

199 
UCHAR
 
	mAddr2
[
MAC_ADDR_LEN
];

200 
UCHAR
 
	mAddr3
[
MAC_ADDR_LEN
];

201 
UCHAR
 
	mChl
;

202 
UCHAR
 
	mPayld
;

203 
UINT32
 
	mTxLgth
;

204 
UINT32
 
	mTxCou
;

205 
UINT32
 
	mTxDeCou
;

206 
UINT32
 
	mRFFqOfft
;

207 
UINT32
 
	mIPG
;

208 
BOOLEAN
 
	mbRxFER
;

209 
BOOLEAN
 
	mbQATxS
;

210 
BOOLEAN
 
	mbQARxS
;

211 
BOOLEAN
 
	mbAutoTxAlc
;

212 #ifde
RTMP_MAC_PCI


213 
BOOLEAN
 
	mbFWLdg
;

215 
UINT32
 
	mRxTٮC
;

216 
UINT32
 
	mRxCPSec
;

218 
CHAR
 
	mLaSNR0
;

219 
CHAR
 
	mLaSNR1
;

220 
CHAR
 
	mLaRssi0
;

221 
CHAR
 
	mLaRssi1
;

222 
CHAR
 
	mLaRssi2
;

223 
CHAR
 
	mAvgRssi0
;

224 
CHAR
 
	mAvgRssi1
;

225 
CHAR
 
	mAvgRssi2
;

226 
SHORT
 
	mAvgRssi0X8
;

227 
SHORT
 
	mAvgRssi1X8
;

228 
SHORT
 
	mAvgRssi2X8
;

230 
UINT32
 
	mNumOfAvgRssiSame
;

233 #ifde
RALINK_QA


235 
USHORT
 
	mHL
;

236 
USHORT
 
	mPL
;

237 
UCHAR
 
	mHd
[32];

238 
UCHAR
 
	mP
[32];

239 
USHORT
 
	mDL
;

240 
USHORT
 
	mq
;

241 
UINT32
 
	mCID
;

242 
RTMP_OS_PID
 
	mAPid
;

244 
UINT32
 
	mU2M
;

245 
UINT32
 
	mOthDa
;

246 
UINT32
 
	mBc
;

247 
UINT32
 
	mOthCou
;

248 
UINT32
 
	mTxAc0
;

249 
UINT32
 
	mTxAc1
;

250 
UINT32
 
	mTxAc2
;

251 
UINT32
 
	mTxAc3
;

252 
UINT32
 
	mTxHCCA
;

253 
UINT32
 
	mTxMgmt
;

254 
UINT32
 
	mRSSI0
;

255 
UINT32
 
	mRSSI1
;

256 
UINT32
 
	mRSSI2
;

257 
UINT32
 
	mSNR0
;

258 
UINT32
 
	mSNR1
;

260 
UCHAR
 
	mTxStus
;

262 } 
	tATE_INFO
, *
	tPATE_INFO
;

264 #ifde
RALINK_QA


265 
	se_cfghdr
 {

266 
UINT32
 
	mmagic_no
;

267 
USHORT
 
	mcommd_ty
;

268 
USHORT
 
	mcommd_id
;

269 
USHORT
 
	mngth
;

270 
USHORT
 
	mqu
;

271 
USHORT
 
	mus
;

272 
UCHAR
 
	mda
[2046];

273 } 
__ibu__
((
cked
));

278 
	s_RSSI_SAMPLE
 {

279 
CHAR
 
	mLaRssi0
;

280 
CHAR
 
	mLaRssi1
;

281 
CHAR
 
	mLaRssi2
;

282 
CHAR
 
	mAvgRssi0
;

283 
CHAR
 
	mAvgRssi1
;

284 
CHAR
 
	mAvgRssi2
;

285 
SHORT
 
	mAvgRssi0X8
;

286 
SHORT
 
	mAvgRssi1X8
;

287 
SHORT
 
	mAvgRssi2X8
;

288 
CHAR
 
	mLaS0
;

289 
CHAR
 
	mLaS1
;

290 
CHAR
 
	mLaS2
;

291 
CHAR
 
	mAvgS0
;

292 
CHAR
 
	mAvgS1
;

293 
CHAR
 
	mAvgS2
;

294 
SHORT
 
	mAvgS0X8
;

295 
SHORT
 
	mAvgS1X8
;

296 
SHORT
 
	mAvgS2X8
;

297 
CHAR
 
	mLaNoiLev0
;

298 
CHAR
 
	mLaNoiLev1
;

299 
CHAR
 
	mLaNoiLev2
;

300 } 
	tRSSI_SAMPLE
;

305 
	#InlizeQueueHd
(
QueueHd
) \

307 (
QueueHd
)->
Hd
 = (QueueHd)->
Ta
 = 
NULL
; \

308 (
QueueHd
)->
Numb
 = 0; \

309 }

	)

311 
	#RemoveHdQueue
(
QueueHd
) \

312 (
QueueHd
)->
Hd
; \

314 
PQUEUE_ENTRY
 
pNext
; \

315 i((
QueueHd
)->
Hd
 !
NULL
) \

317 
pNext
 = (
QueueHd
)->
Hd
->
Next
; \

318 (
QueueHd
)->
Hd
->
Next
 = 
NULL
; \

319 (
QueueHd
)->
Hd
 = 
pNext
; \

320 i(
pNext
 =
NULL
) \

321 (
QueueHd
)->
Ta
 = 
NULL
; \

322 (
QueueHd
)->
Numb
--; \

324 }

	)

326 
	#InHdQueue
(
QueueHd
, 
QueueEry
) \

328 ((
PQUEUE_ENTRY
)
QueueEry
)->
Next
 = (
QueueHd
)->
Hd
; \

329 (
QueueHd
)->
Hd
 = (
PQUEUE_ENTRY
)(
QueueEry
); \

330 i((
QueueHd
)->
Ta
 =
NULL
) \

331 (
QueueHd
)->
Ta
 = (
PQUEUE_ENTRY
)(
QueueEry
); \

332 (
QueueHd
)->
Numb
++; \

333 }

	)

335 
	#InTaQueue
(
QueueHd
, 
QueueEry
) \

337 ((
PQUEUE_ENTRY
)
QueueEry
)->
Next
 = 
NULL
; \

338 i((
QueueHd
)->
Ta
) \

339 (
QueueHd
)->
Ta
->
Next
 = (
PQUEUE_ENTRY
)(
QueueEry
); \

341 (
QueueHd
)->
Hd
 = (
PQUEUE_ENTRY
)(
QueueEry
); \

342 (
QueueHd
)->
Ta
 = (
PQUEUE_ENTRY
)(
QueueEry
); \

343 (
QueueHd
)->
Numb
++; \

344 }

	)

346 
	#InTaQueueAc
(
pAd
, 
pEry
, 
QueueHd
, 
QueueEry
) \

348 ((
PQUEUE_ENTRY
)
QueueEry
)->
Next
 = 
NULL
; \

349 i((
QueueHd
)->
Ta
) \

350 (
QueueHd
)->
Ta
->
Next
 = (
PQUEUE_ENTRY
)(
QueueEry
); \

352 (
QueueHd
)->
Hd
 = (
PQUEUE_ENTRY
)(
QueueEry
); \

353 (
QueueHd
)->
Ta
 = (
PQUEUE_ENTRY
)(
QueueEry
); \

354 (
QueueHd
)->
Numb
++; \

355 }

	)

362 
	#RTMP_SET_FLAG
(
_M
, 
_F
((_M)->
Fgs
 |(_F))

	)

363 
	#RTMP_CLEAR_FLAG
(
_M
, 
_F
((_M)->
Fgs
 &~(_F))

	)

364 
	#RTMP_CLEAR_FLAGS
(
_M
((_M)->
Fgs
 = 0)

	)

365 
	#RTMP_TEST_FLAG
(
_M
, 
_F
(((_M)->
Fgs
 & (_F)!0)

	)

366 
	#RTMP_TEST_FLAGS
(
_M
, 
_F
(((_M)->
Fgs
 & (_F)=(_F))

	)

368 
	#RTMP_SET_PSFLAG
(
_M
, 
_F
((_M)->
PSFgs
 |(_F))

	)

369 
	#RTMP_CLEAR_PSFLAG
(
_M
, 
_F
((_M)->
PSFgs
 &~(_F))

	)

370 
	#RTMP_CLEAR_PSFLAGS
(
_M
((_M)->
PSFgs
 = 0)

	)

371 
	#RTMP_TEST_PSFLAG
(
_M
, 
_F
(((_M)->
PSFgs
 & (_F)!0)

	)

372 
	#RTMP_TEST_PSFLAGS
(
_M
, 
_F
(((_M)->
PSFgs
 & (_F)=(_F))

	)

374 
	#OPSTATUS_SET_FLAG
(
_pAd
, 
_F
((_pAd)->
CommCfg
.
OpStusFgs
 |(_F))

	)

375 
	#OPSTATUS_CLEAR_FLAG
(
_pAd
, 
_F
((_pAd)->
CommCfg
.
OpStusFgs
 &~(_F))

	)

376 
	#OPSTATUS_TEST_FLAG
(
_pAd
, 
_F
(((_pAd)->
CommCfg
.
OpStusFgs
 & (_F)!0)

	)

378 
	#CLIENT_STATUS_SET_FLAG
(
_pEry
,
_F
((_pEry)->
ClStusFgs
 |(_F))

	)

379 
	#CLIENT_STATUS_CLEAR_FLAG
(
_pEry
,
_F
((_pEry)->
ClStusFgs
 &~(_F))

	)

380 
	#CLIENT_STATUS_TEST_FLAG
(
_pEry
,
_F
(((_pEry)->
ClStusFgs
 & (_F)!0)

	)

382 
	#RX_FILTER_SET_FLAG
(
_pAd
, 
_F
((_pAd)->
CommCfg
.
PackFr
 |(_F))

	)

383 
	#RX_FILTER_CLEAR_FLAG
(
_pAd
, 
_F
((_pAd)->
CommCfg
.
PackFr
 &~(_F))

	)

384 
	#RX_FILTER_TEST_FLAG
(
_pAd
, 
_F
(((_pAd)->
CommCfg
.
PackFr
 & (_F)!0)

	)

386 
	#RTMP_SET_MORE_FLAG
(
_M
, 
_F
((_M)->
MeFgs
 |(_F))

	)

387 
	#RTMP_TEST_MORE_FLAG
(
_M
, 
_F
(((_M)->
MeFgs
 & (_F)!0)

	)

388 
	#RTMP_CLEAR_MORE_FLAG
(
_M
, 
_F
((_M)->
MeFgs
 &~(_F))

	)

390 #ifde
CONFIG_STA_SUPPORT


391 
	#STA_NO_SECURITY_ON
(
_p
(_p->
SCfg
.
WStus
 =
Ndis802_11EnyiDibd
)

	)

392 
	#STA_WEP_ON
(
_p
(_p->
SCfg
.
WStus
 =
Ndis802_11Enyi1Ebd
)

	)

393 
	#STA_TKIP_ON
(
_p
(_p->
SCfg
.
WStus
 =
Ndis802_11Enyi2Ebd
)

	)

394 
	#STA_AES_ON
(
_p
(_p->
SCfg
.
WStus
 =
Ndis802_11Enyi3Ebd
)

	)

396 
	#STA_TGN_WIFI_ON
(
_p
(_p->
SCfg
.
bTGnWifiTe
 =
TRUE
)

	)

399 
	#CKIP_KP_ON
(
_p
((((_p)->
SCfg
.
CkFg
& 0x10&& ((_p)->SCfg.
bCkCmicOn
 =
TRUE
))

	)

400 
	#CKIP_CMIC_ON
(
_p
((((_p)->
SCfg
.
CkFg
& 0x08&& ((_p)->SCfg.
bCkCmicOn
 =
TRUE
))

	)

403 
	#INC_RING_INDEX
(
_idx
, 
_RgSize
) \

405 (
_idx
(_idx+1% (
_RgSize
); \

406 }

	)

409 #ifde
DOT11_N_SUPPORT


411 
	#COPY_HTSETTINGS_FROM_MLME_AUX_TO_ACTIVE_CFG
(
_pAd
) \

413 
_pAd
->
SAive
.
Su܋dHtPhy
.
ChlWidth
 = _pAd->
MlmeAux
.
HtCaby
.
HtCInfo
.ChannelWidth; \

414 
_pAd
->
SAive
.
Su܋dHtPhy
.
MimoPs
 = _pAd->
MlmeAux
.
HtCaby
.
HtCInfo
.MimoPs; \

415 
_pAd
->
SAive
.
Su܋dHtPhy
.
GF
 = _pAd->
MlmeAux
.
HtCaby
.
HtCInfo
.GF; \

416 
_pAd
->
SAive
.
Su܋dHtPhy
.
ShtGIf20
 = _pAd->
MlmeAux
.
HtCaby
.
HtCInfo
.ShortGIfor20; \

417 
_pAd
->
SAive
.
Su܋dHtPhy
.
ShtGIf40
 = _pAd->
MlmeAux
.
HtCaby
.
HtCInfo
.ShortGIfor40; \

418 
_pAd
->
SAive
.
Su܋dHtPhy
.
TxSTBC
 = _pAd->
MlmeAux
.
HtCaby
.
HtCInfo
.TxSTBC; \

419 
_pAd
->
SAive
.
Su܋dHtPhy
.
RxSTBC
 = _pAd->
MlmeAux
.
HtCaby
.
HtCInfo
.RxSTBC; \

420 
_pAd
->
SAive
.
Su܋dHtPhy
.
ExtChOfft
 = _pAd->
MlmeAux
.
AddHtInfo
.AddHtInfo.ExtChanOffset; \

421 
_pAd
->
SAive
.
Su܋dHtPhy
.
RecomWidth
 = _pAd->
MlmeAux
.
AddHtInfo
.AddHtInfo.RecomWidth; \

422 
_pAd
->
SAive
.
Su܋dHtPhy
.
OiMode
 = _pAd->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.OperaionMode; \

423 
_pAd
->
SAive
.
Su܋dHtPhy
.
NGfP
 = _pAd->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.NonGfPresent; \

424 
	`NdisMoveMemy
((
_pAd
)->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTCaby
.
MCSS
, (_pAd)->
SAive
.
Su܋dPhyInfo
.MCSS, (
UCHAR
) * 16);\

425 }

	)

427 
	#COPY_AP_HTSETTINGS_FROM_BEACON
(
_pAd
, 
_pHtCaby
) \

429 
_pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
AMsduSize
 = (
UCHAR
)(
_pHtCaby
->
HtCInfo
.AMsduSize); \

430 
_pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
MmpsMode
(
UCHAR
)(
_pHtCaby
->
HtCInfo
.
MimoPs
); \

431 
_pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
MaxRAmpduFa
 = (
UCHAR
)(
_pHtCaby
->
HtCPm
.MaxRAmpduFactor); \

432 }

	)

455 
	#NIC_MAX_PHYS_BUF_COUNT
 8

	)

457 
	s_RTMP_SCATTER_GATHER_ELEMENT
 {

458 
PVOID
 
	mAddss
;

459 
ULONG
 
	mLgth
;

460 
PULONG
 
	mRerved
;

461 } 
	tRTMP_SCATTER_GATHER_ELEMENT
, *
	tPRTMP_SCATTER_GATHER_ELEMENT
;

464 
	s_RTMP_SCATTER_GATHER_LIST
 {

465 
ULONG
 
	mNumbOfEmts
;

466 
PULONG
 
	mRerved
;

467 
RTMP_SCATTER_GATHER_ELEMENT
 
	mEmts
[
NIC_MAX_PHYS_BUF_COUNT
];

468 } 
	tRTMP_SCATTER_GATHER_LIST
, *
	tPRTMP_SCATTER_GATHER_LIST
;

474 #ide
m


475 
	#m
(
_a
, 
_b
(((_a< (_b)? (_a: (_b))

	)

478 #ide
max


479 
	#max
(
_a
, 
_b
(((_a> (_b)? (_a: (_b))

	)

482 
	#GET_LNA_GAIN
(
_pAd
((_pAd->
LchRfRegs
.
Chl
 <14? (_pAd->
BLNAGa
: ((_pAd->LchRfRegs.Ch<64? (_pAd->
ALNAGa0
: ((_pAd->LchRfRegs.Ch<128? (_pAd->
ALNAGa1
: (_pAd->
ALNAGa2
))))

	)

484 
	#INC_COUNTER64
(
V
(V.
QuadPt
++)

	)

486 
	#INFRA_ON
(
_p
(
	`OPSTATUS_TEST_FLAG
(_p, 
fOP_STATUS_INFRA_ON
))

	)

487 
	#ADHOC_ON
(
_p
(
	`OPSTATUS_TEST_FLAG
(_p, 
fOP_STATUS_ADHOC_ON
))

	)

488 
	#MONITOR_ON
(
_p
(((_p)->
SCfg
.
BssTy
=
BSS_MONITOR
)

	)

489 
	#IDLE_ON
(
_p
(!
	`INFRA_ON
(_p&& !
	`ADHOC_ON
(_p))

	)

492 
	#LEAP_ON
(
_p
(((_p)->
SCfg
.
LpAuthMode
=
CISCO_AuthModeLEAP
)

	)

493 
	#LEAP_CCKM_ON
(
_p
((((_p)->
SCfg
.
LpAuthMode
=
CISCO_AuthModeLEAP
&& ((_p)->SCfg.
LpAuthInfo
.
CCKM
 =
TRUE
))

	)

496 
	#EXTRA_LLCSNAP_ENCAP_FROM_PKT_START
(
_pBufVA
, 
_pExaLlcSpEnp
) \

498 i(((*(
_pBufVA
 + 12) << 8) + *(_pBufVA + 13)) > 1500) \

500 
_pExaLlcSpEnp
 = 
SNAP_802_1H
; \

501 i(
	`NdisEquMemy
(
IPX
, 
_pBufVA
 + 12, 2) || \

502 
	`NdisEquMemy
(
APPLE_TALK
, 
_pBufVA
 + 12, 2)) \

504 
_pExaLlcSpEnp
 = 
SNAP_BRIDGE_TUNNEL
; \

509 
_pExaLlcSpEnp
 = 
NULL
; \

511 }

	)

514 
	#EXTRA_LLCSNAP_ENCAP_FROM_PKT_OFFSET
(
_pBufVA
, 
_pExaLlcSpEnp
) \

516 i(((*(
_pBufVA
) << 8) + *(_pBufVA + 1)) > 1500) \

518 
_pExaLlcSpEnp
 = 
SNAP_802_1H
; \

519 i(
	`NdisEquMemy
(
IPX
, 
_pBufVA
, 2) || \

520 
	`NdisEquMemy
(
APPLE_TALK
, 
_pBufVA
, 2)) \

522 
_pExaLlcSpEnp
 = 
SNAP_BRIDGE_TUNNEL
; \

527 
_pExaLlcSpEnp
 = 
NULL
; \

529 }

	)

532 
	#MAKE_802_3_HEADER
(
_p
, 
_pMac1
, 
_pMac2
, 
_pTy
) \

534 
	`NdisMoveMemy
(
_p
, 
_pMac1
, 
MAC_ADDR_LEN
); \

535 
	`NdisMoveMemy
((
_p
 + 
MAC_ADDR_LEN
), 
_pMac2
, MAC_ADDR_LEN); \

536 
	`NdisMoveMemy
((
_p
 + 
MAC_ADDR_LEN
 * 2), 
_pTy
, 
LENGTH_802_3_TYPE
); \

537 }

	)

546 
	#CONVERT_TO_802_3
(
_p8023hdr
, 
_pDA
, 
_pSA
, 
_pDa
, 
_DaSize
, 
_pRemovedLLCSNAP
) \

548 
LLC_L
[2]; \

550 
_pRemovedLLCSNAP
 = 
NULL
; \

551 i(
	`NdisEquMemy
(
SNAP_802_1H
, 
_pDa
, 6) || \

552 
	`NdisEquMemy
(
SNAP_BRIDGE_TUNNEL
, 
_pDa
, 6)) \

554 
PUCHAR
 
pPro
 = 
_pDa
 + 6; \

556 i((
	`NdisEquMemy
(
IPX
, 
pPro
, 2|| NdisEquMemy(
APPLE_TALK
,Proto, 2)) && \

557 
	`NdisEquMemy
(
SNAP_802_1H
, 
_pDa
, 6)) \

559 
LLC_L
[0] = (
UCHAR
)(
_DaSize
 >> 8); \

560 
LLC_L
[1] = (
UCHAR
)(
_DaSize
 & (256 - 1)); \

561 
	`MAKE_802_3_HEADER
(
_p8023hdr
, 
_pDA
, 
_pSA
, 
LLC_L
); \

565 
	`MAKE_802_3_HEADER
(
_p8023hdr
, 
_pDA
, 
_pSA
, 
pPro
); \

566 
_pRemovedLLCSNAP
 = 
_pDa
; \

567 
_DaSize
 -
LENGTH_802_1_H
; \

568 
_pDa
 +
LENGTH_802_1_H
; \

573 
LLC_L
[0] = (
UCHAR
)(
_DaSize
 >> 8); \

574 
LLC_L
[1] = (
UCHAR
)(
_DaSize
 & (256 - 1)); \

575 
	`MAKE_802_3_HEADER
(
_p8023hdr
, 
_pDA
, 
_pSA
, 
LLC_L
); \

577 }

	)

583 #ifde
RTMP_MAC_PCI


584 
	#REPORT_MGMT_FRAME_TO_MLME
(
_pAd
, 
Wcid
, 
_pFme
, 
_FmeSize
, 
_Rssi0
, 
_Rssi1
, 
_Rssi2
, 
_MSNR
) \

586 
UINT32
 
High32TSF
, 
Low32TSF
; \

587 
	`RTMP_IO_READ32
(
_pAd
, 
TSF_TIMER_DW1
, &
High32TSF
); \

588 
	`RTMP_IO_READ32
(
_pAd
, 
TSF_TIMER_DW0
, &
Low32TSF
); \

589 
	`MlmeEnqueueFRecv
(
_pAd
, 
Wcid
, 
High32TSF
, 
Low32TSF
, (
UCHAR
)
_Rssi0
, (UCHAR)
_Rssi1
,(UCHAR)
_Rssi2
,
_FmeSize
, 
_pFme
, (UCHAR)
_MSNR
); \

590 }

	)

593 
	#MAC_ADDR_EQUAL
(
pAddr1
,
pAddr2

	`RTMPEquMemy
((
PVOID
)Addr1), (PVOID)Addr2), 
MAC_ADDR_LEN
)

	)

594 
	#SSID_EQUAL
(
ssid1
, 
n1
, 
ssid2
, 
n2
(֒1=2&& (
	`RTMPEquMemy
(ssid1, ssid2,1)))

	)

599 
	#JChlCheck
(
chl
((ch=52|| (ch=56|| (ch=60|| (ch=64))

	)

601 #ifde
CONFIG_STA_SUPPORT


602 
	#STA_EXTRA_SETTING
(
_pAd
)

	)

604 
	#STA_PORT_SECURED
(
_pAd
) \

606 
BOOLEAN
 
Ced
; \

607 (
_pAd
)->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_SECURED
; \

608 
	`RTMP_IndiMedS
(
_pAd
, 
NdisMedSCed
); \

609 
	`NdisAcqueSpLock
(&((
_pAd
)->
MacTabLock
)); \

610 (
_pAd
)->
MacTab
.
Cڋ
[
BSSID_WCID
].
PtSecud
 = (_pAd)->
SCfg
.PortSecured; \

611 (
_pAd
)->
MacTab
.
Cڋ
[
BSSID_WCID
].
PrivacyFr
 = 
Ndis802_11PrivFrAcA
;\

612 
	`NdisRSpLock
(&(
_pAd
)->
MacTabLock
); \

613 
	`RTMPClTim
(&((
_pAd
)->
Mlme
.
LkDownTim
), &
Ced
);\

614 
	`STA_EXTRA_SETTING
(
_pAd
); \

615 }

	)

624 
	s_RTMP_DMABUF


626 
ULONG
 
	mAocSize
;

627 
PVOID
 
	mAocVa
;

628 
NDIS_PHYSICAL_ADDRESS
 
	mAocPa
;

629 } 
	tRTMP_DMABUF
, *
	tPRTMP_DMABUF
;

640 
	s_RTMP_DMACB


642 
ULONG
 
	mAocSize
;

643 
PVOID
 
	mAocVa
;

644 
NDIS_PHYSICAL_ADDRESS
 
	mAocPa
;

645 
PNDIS_PACKET
 
	mpNdisPack
;

646 
PNDIS_PACKET
 
	mpNextNdisPack
;

648 
RTMP_DMABUF
 
	mDmaBuf
;

649 } 
	tRTMP_DMACB
, *
	tPRTMP_DMACB
;

652 
	s_RTMP_TX_RING


654 
RTMP_DMACB
 
	mCl
[
TX_RING_SIZE
];

655 
UINT32
 
	mTxCpuIdx
;

656 
UINT32
 
	mTxDmaIdx
;

657 
UINT32
 
	mTxSwFeIdx
;

658 } 
	tRTMP_TX_RING
, *
	tPRTMP_TX_RING
;

660 
	s_RTMP_RX_RING


662 
RTMP_DMACB
 
	mCl
[
RX_RING_SIZE
];

663 
UINT32
 
	mRxCpuIdx
;

664 
UINT32
 
	mRxDmaIdx
;

665 
INT32
 
	mRxSwRdIdx
;

666 } 
	tRTMP_RX_RING
, *
	tPRTMP_RX_RING
;

668 
	s_RTMP_MGMT_RING


670 
RTMP_DMACB
 
	mCl
[
MGMT_RING_SIZE
];

671 
UINT32
 
	mTxCpuIdx
;

672 
UINT32
 
	mTxDmaIdx
;

673 
UINT32
 
	mTxSwFeIdx
;

674 } 
	tRTMP_MGMT_RING
, *
	tPRTMP_MGMT_RING
;

680 
	s_COUNTER_802_3


683 
ULONG
 
	mGoodTnsms
;

684 
ULONG
 
	mGoodReives
;

685 
ULONG
 
	mTxEs
;

686 
ULONG
 
	mRxEs
;

687 
ULONG
 
	mRxNoBufr
;

690 
ULONG
 
	mRcvAlignmtEs
;

691 
ULONG
 
	mOClisi
;

692 
ULONG
 
	mMeClisis
;

694 } 
	tCOUNTER_802_3
, *
	tPCOUNTER_802_3
;

696 
	s_COUNTER_802_11
 {

697 
ULONG
 
	mLgth
;

699 
LARGE_INTEGER
 
	mTnsmdFgmtCou
;

700 
LARGE_INTEGER
 
	mMuiTnsmdFmeCou
;

701 
LARGE_INTEGER
 
	mFaedCou
;

702 
LARGE_INTEGER
 
	mRryCou
;

703 
LARGE_INTEGER
 
	mMuɝRryCou
;

704 
LARGE_INTEGER
 
	mRTSSucssCou
;

705 
LARGE_INTEGER
 
	mRTSFauCou
;

706 
LARGE_INTEGER
 
	mACKFauCou
;

707 
LARGE_INTEGER
 
	mFmeDuiCou
;

708 
LARGE_INTEGER
 
	mReivedFgmtCou
;

709 
LARGE_INTEGER
 
	mMuiReivedFmeCou
;

710 
LARGE_INTEGER
 
	mFCSECou
;

711 } 
	tCOUNTER_802_11
, *
	tPCOUNTER_802_11
;

713 
	s_COUNTER_RALINK
 {

715 
UINT32
 
	mOSecS
;

716 
UINT32
 
	mOSecBcStC
;

717 
UINT32
 
	mOSecFCCAC
;

718 
UINT32
 
	mOSecRxFcsEC
;

719 
UINT32
 
	mOSecRxOkC
;

720 
UINT32
 
	mOSecTxFaCou
;

721 
UINT32
 
	mOSecTxNoRryOkCou
;

722 
UINT32
 
	mOSecTxRryOkCou
;

723 
UINT32
 
	mOSecRxOkDaC
;

724 
UINT32
 
	mOSecTnsmdByCou
;

726 
ULONG
 
	mOSecOsTxCou
[
NUM_OF_TX_RING
];

727 
ULONG
 
	mOSecDmaDeCou
[
NUM_OF_TX_RING
];

728 
UINT32
 
	mOSecTxDeCou
;

729 
ULONG
 
	mOSecRxCou
;

730 
UINT32
 
	mOSecReivedByCou
;

731 
UINT32
 
	mOSecTxAgggiCou
;

732 
UINT32
 
	mOSecRxAgggiCou
;

733 
UINT32
 
	mOSecEnd
;

735 
ULONG
 
	mTnsmdByCou
;

736 
ULONG
 
	mReivedByCou
;

737 
ULONG
 
	mBadCQIAutoRecovyCou
;

738 
ULONG
 
	mPoCQIRmgCou
;

739 
ULONG
 
	mMgmtRgFuCou
;

740 
ULONG
 
	mRxCouSLaNULL
;

741 
ULONG
 
	mRxCou
;

742 
ULONG
 
	mKickTxCou
;

743 
LARGE_INTEGER
 
	mRlFcsECou
;

744 
ULONG
 
	mPdgNdisPackCou
;

765 
UINT32
 
	mLaOSecTٮTxCou
;

766 
UINT32
 
	mLaOSecRxOkDaC
;

767 
ULONG
 
	mDuiRcv
;

768 
ULONG
 
	mTxAggCou
;

769 
ULONG
 
	mTxNAggCou
;

770 
ULONG
 
	mTxAgg1MPDUCou
;

771 
ULONG
 
	mTxAgg2MPDUCou
;

772 
ULONG
 
	mTxAgg3MPDUCou
;

773 
ULONG
 
	mTxAgg4MPDUCou
;

774 
ULONG
 
	mTxAgg5MPDUCou
;

775 
ULONG
 
	mTxAgg6MPDUCou
;

776 
ULONG
 
	mTxAgg7MPDUCou
;

777 
ULONG
 
	mTxAgg8MPDUCou
;

778 
ULONG
 
	mTxAgg9MPDUCou
;

779 
ULONG
 
	mTxAgg10MPDUCou
;

780 
ULONG
 
	mTxAgg11MPDUCou
;

781 
ULONG
 
	mTxAgg12MPDUCou
;

782 
ULONG
 
	mTxAgg13MPDUCou
;

783 
ULONG
 
	mTxAgg14MPDUCou
;

784 
ULONG
 
	mTxAgg15MPDUCou
;

785 
ULONG
 
	mTxAgg16MPDUCou
;

787 
LARGE_INTEGER
 
	mTnsmdOsInAMSDU
;

788 
LARGE_INTEGER
 
	mTnsmdAMSDUCou
;

789 
LARGE_INTEGER
 
	mReivedOesInAMSDUCou
;

790 
LARGE_INTEGER
 
	mReivedAMSDUCou
;

791 
LARGE_INTEGER
 
	mTnsmdAMPDUCou
;

792 
LARGE_INTEGER
 
	mTnsmdMPDUsInAMPDUCou
;

793 
LARGE_INTEGER
 
	mTnsmdOsInAMPDUCou
;

794 
LARGE_INTEGER
 
	mMPDUInReivedAMPDUCou
;

795 } 
	tCOUNTER_RALINK
, *
	tPCOUNTER_RALINK
;

798 
	s_COUNTER_DRS
 {

800 
USHORT
 
	mTxQuy
[
MAX_STEP_OF_TX_RATE_SWITCH
];

801 
UCHAR
 
	mPER
[
MAX_STEP_OF_TX_RATE_SWITCH
];

802 
UCHAR
 
	mTxReUpPty
;

803 
ULONG
 
	mCuTxReSbTime
;

805 
BOOLEAN
 
	mfLaSecAccdgRSSI
;

806 
UCHAR
 
	mLaSecTxReChgeAi
;

807 
UCHAR
 
	mLaTimeTxReChgeAi
;

808 
ULONG
 
	mLaTxOkCou
;

809 } 
	tCOUNTER_DRS
, *
	tPCOUNTER_DRS
;

812 #ifde
DOT11_N_SUPPORT


813 #ifde
TXBF_SUPPORT


816 
ULONG
 
	mTxSucssCou
;

817 
ULONG
 
	mTxRryCou
;

818 
ULONG
 
	mTxFaCou
;

819 
ULONG
 
	mETxSucssCou
;

820 
ULONG
 
	mETxRryCou
;

821 
ULONG
 
	mETxFaCou
;

822 
ULONG
 
	mITxSucssCou
;

823 
ULONG
 
	mITxRryCou
;

824 
ULONG
 
	mITxFaCou
;

825 } 
	tCOUNTER_TXBF
;

836 
GNU_PACKED
 
	t_RT_802_11_WPA_REKEY
 {

837 
ULONG
 
	gReKeyMhod
;

838 
ULONG
 
	gReKeyIv
;

839 } 
	tRT_WPA_REKEY
,*
	tPRT_WPA_REKEY
, 
	tRT_802_11_WPA_REKEY
, *
	tPRT_802_11_WPA_REKEY
;

844 
UCHAR
 
	mAddr
[
MAC_ADDR_LEN
];

845 
UCHAR
 
	mECode
[2];

849 
BOOLEAN
 
	mR܋d
;

850 } 
	tROGUEAP_ENTRY
, *
	tPROGUEAP_ENTRY
;

853 
UCHAR
 
	mRogueApNr
;

854 
ROGUEAP_ENTRY
 
	mRogueApEry
[
MAX_LEN_OF_BSS_TABLE
];

855 } 
	tROGUEAP_TABLE
, *
	tPROGUEAP_TABLE
;

860 
	s_FRAGMENT_FRAME
 {

861 
PNDIS_PACKET
 
	mpFgPack
;

862 
ULONG
 
	mRxSize
;

863 
USHORT
 
	mSequ
;

864 
USHORT
 
	mLaFg
;

865 
ULONG
 
	mFgs
;

866 } 
	tFRAGMENT_FRAME
, *
	tPFRAGMENT_FRAME
;

872 
	s_PACKET_INFO
 {

873 
UINT
 
	mPhysilBufrCou
;

874 
UINT
 
	mBufrCou
 ;

875 
UINT
 
	mTٮPackLgth
 ;

876 
PNDIS_BUFFER
 
	mpFBufr
;

877 } 
	tPACKET_INFO
, *
	tPPACKET_INFO
;

882 
	s_TKIP_KEY_INFO
 {

883 
UINT
 
	mnBysInM
;

884 
ULONG
 
	mIV16
;

885 
ULONG
 
	mIV32
;

886 
ULONG
 
	mK0
;

887 
ULONG
 
	mK1
;

888 
ULONG
 
	mL
;

889 
ULONG
 
	mR
;

890 
ULONG
 
	mM
;

891 
UCHAR
 
	mRC4KEY
[16];

892 
UCHAR
 
	mMIC
[8];

893 } 
	tTKIP_KEY_INFO
, *
	tPTKIP_KEY_INFO
;

899 
	s__PRIVATE_STRUC
 {

900 
UINT
 
	mSyemRetC
;

901 
UINT
 
	mTxRgFuC
;

902 
UINT
 
	mPhyRxEC
;

905 
TKIP_KEY_INFO
 
	mTx
;

906 
TKIP_KEY_INFO
 
	mRx
;

907 } 
	tPRIVATE_STRUC
, *
	tPPRIVATE_STRUC
;

914 
	s_BBP_R66_TUNING
 {

915 
BOOLEAN
 
	mbEb
;

916 
USHORT
 
	mFCLowThshd
;

917 
USHORT
 
	mFCUThshd
;

918 
UCHAR
 
	mR66D
;

919 
UCHAR
 
	mR66CutVue
;

920 
BOOLEAN
 
	mR66LowUSe
;

921 } 
	tBBP_R66_TUNING
, *
	tPBBP_R66_TUNING
;

924 #ifde
DOT11_N_SUPPORT


925 #ifde
DOT11N_DRAFT3


926 
	#EFFECTED_CH_SECONDARY
 0x1

	)

927 
	#EFFECTED_CH_PRIMARY
 0x2

	)

928 
	#EFFECTED_CH_LEGACY
 0x4

	)

934 
	s_CHANNEL_TX_POWER
 {

935 
USHORT
 
	mRemagTimeFU
;

936 
UCHAR
 
	mChl
;

937 #ifde
DOT11N_DRAFT3


938 
BOOLEAN
 
	mbEfedChl
;

940 
CHAR
 
	mPow
;

941 
CHAR
 
	mPow2
;

942 
UCHAR
 
	mMaxTxPwr
;

943 
UCHAR
 
	mDfsReq
;

944 
UCHAR
 
	mRegutyDoma
;

956 
	#CHANNEL_DISABLED
 0x01

	)

957 
	#CHANNEL_PASSIVE_SCAN
 0x02

	)

958 
	#CHANNEL_NO_IBSS
 0x04

	)

959 
	#CHANNEL_RADAR
 0x08

	)

960 
	#CHANNEL_NO_FAT_ABOVE
 0x10

	)

961 
	#CHANNEL_NO_FAT_BELOW
 0x20

	)

963 
UCHAR
 
	mFgs
;

965 } 
	tCHANNEL_TX_POWER
, *
	tPCHANNEL_TX_POWER
;

968 
	s_SOFT_RX_ANT_DIVERSITY_STRUCT
 {

969 
UCHAR
 
	mEvuePiod
;

970 
UCHAR
 
	mEvueSbC
;

971 
UCHAR
 
	mPa1PrimyRxA
;

972 
UCHAR
 
	mPa1SecdyRxA
;

973 #ifde
CONFIG_STA_SUPPORT


974 
SHORT
 
	mPa1AvgRssi
[2];

975 
SHORT
 
	mPa2AvgRssi
[2];

977 
SHORT
 
	mPa1LaAvgRssi
;

978 
SHORT
 
	mPa2LaAvgRssi
;

979 
ULONG
 
	mRcvPktNumWhEvue
;

980 
BOOLEAN
 
	mFPktAivedWhEvue
;

981 } 
	tSOFT_RX_ANT_DIVERSITY
, *
	tPSOFT_RX_ANT_DIVERSITY
;

987 
	s_RADAR_DETECT_STRUCT
 {

989 
UCHAR
 
	mCSCou
;

990 
UCHAR
 
	mCSPiod
;

991 
UCHAR
 
	mRDCou
;

992 
UCHAR
 
	mRDMode
;

993 
UCHAR
 
	mRDDurRegi
;

994 
UCHAR
 
	mBBPR16
;

995 
UCHAR
 
	mBBPR17
;

996 
UCHAR
 
	mBBPR18
;

997 
UCHAR
 
	mBBPR21
;

998 
UCHAR
 
	mBBPR22
;

999 
UCHAR
 
	mBBPR64
;

1000 
ULONG
 
	mInSviMڙCou
;

1001 
UINT8
 
	mDfsSessiTime
;

1002 
BOOLEAN
 
	mbFaDfs
;

1003 
USHORT
 
	mChMovgTime
;

1004 
UINT8
 
	mLgPulRadTh
;

1005 #i
defed
(
RTMP_RBUS_SUPPORT
)||defed(
DFS_INTERRUPT_SUPPORT
)

1006 
CHAR
 
	mAvgRssiReq
;

1007 
ULONG
 
	mDfsLowLim
;

1008 
ULONG
 
	mDfsULim
;

1009 
UINT8
 
	mFixDfsLim
;

1010 
ULONG
 
	mulim
;

1011 
ULONG
 
	mlowlim
;

1013 } 
	tRADAR_DETECT_STRUCT
, *
	tPRADAR_DETECT_STRUCT
;

1016 #ifde
DFS_SUPPORT


1017 
	e_DFS_VERSION


1019 
	mSOFTWARE_DFS
=0,

1020 
	mHARDWARE_DFS_V1
,

1021 
	mHARDWARE_DFS_V2


1022 } 
	tDFS_VERSION
;

1026 #ifde
CARRIER_DETECTION_SUPPORT


1027 
	eCD_STATE_n


1029 
	mCD_NORMAL
,

1030 
	mCD_SILENCE
,

1031 
	mCD_MAX_STATE


1032 } 
	tCD_STATE
;

1035 
	e_TONE_RADAR_VERSION


1037 
	mDISABLE_TONE_RADAR
=0,

1038 
	mTONE_RADAR_V1
,

1039 
	mTONE_RADAR_V2


1040 } 
	tTONE_RADAR_VERSION
;

1042 #ifde
TONE_RADAR_DETECT_SUPPORT


1043 
	#CARRIER_DETECT_RECHECK_TIME
 3

	)

1044 
	#CARRIER_DETECT_CRITIRIA
 7000

	)

1045 
	#CARRIER_DETECT_STOP_RATIO
 2

	)

1046 
	#CARRIER_DETECT_STOP_RECHECK_TIME
 4

	)

1047 
	#CARRIER_DETECT_CRITIRIA_A
 230

	)

1048 
	#CARRIER_DETECT_DELTA
 7

	)

1049 
	#CARRIER_DETECT_DIV_FLAG
 0

	)

1050 
	#CARRIER_DETECT_THRESHOLD
 0x0fffffff

	)

1053 
	sCARRIER_DETECTION_s


1055 
BOOLEAN
 
	mEb
;

1056 
UINT8
 
	mCDSessiTime
;

1057 
UINT8
 
	mCDPiod
;

1058 
CD_STATE
 
	mCD_S
;

1059 #ifde
TONE_RADAR_DETECT_SUPPORT


1060 
UINT8
 
	md
;

1061 
UINT8
 
	mdiv_ag
;

1062 
UINT32
 
	mthshd
;

1063 
UINT8
 
	mcheck
;

1064 
UINT8
 
	mcheck1
;

1065 
UINT32
 
	mTimeSmp
;

1066 
UINT32
 
	m
;

1067 
UINT32
 
	mCrrDebug
;

1068 
ULONG
 
	mid_time
;

1069 
ULONG
 
	mbusy_time
;

1070 
ULONG
 
	mDebug
;

1071 
ULONG
 
	mOSecICou
;

1072 #ifde 
TONE_RADAR_DETECT_V2


1073 
UCHAR
 
	mSymmric_Round
;

1074 
UCHAR
 
	mVGA_Mask
;

1075 
UCHAR
 
	mPack_End_Mask
;

1076 
UCHAR
 
	mRx_PE_Mask
;

1079 }
	tCARRIER_DETECTION_STRUCT
, *
	tPCARRIER_DETECTION_STRUCT
;

1083 #ifde
DFS_HARDWARE_SUPPORT


1084 
	s_NewDFSDebug


1086 
UCHAR
 
	mchl
;

1087 
ULONG
 
	mwa_time
;

1088 
UCHAR
 
	md_day_nge
;

1089 
UCHAR
 
	md_day_
;

1090 
UCHAR
 
	mEL_nge
;

1091 
UCHAR
 
	mEL_
;

1092 
UCHAR
 
	mEH_nge
;

1093 
UCHAR
 
	mEH_
;

1094 
UCHAR
 
	mWL_nge
;

1095 
UCHAR
 
	mWL_
;

1096 
UCHAR
 
	mWH_nge
;

1097 
UCHAR
 
	mWH_
;

1098 
ULONG
 
	mT_exed
;

1099 
ULONG
 
	mT_mg
;

1100 
UCHAR
 
	mt
;

1101 
ULONG
 
	mcou
;

1102 
ULONG
 
	midx
;

1104 }
	tNewDFSDebug
, *
	tpNewDFSDebug
;

1106 
	#NEW_DFS_FCC_5_ENT_NUM
 5

	)

1107 
	#NEW_DFS_DBG_PORT_ENT_NUM_POWER
 8

	)

1108 
	#NEW_DFS_DBG_PORT_ENT_NUM
 (1 << 
NEW_DFS_DBG_PORT_ENT_NUM_POWER
)

1109 
	#NEW_DFS_DBG_PORT_MASK
 (
NEW_DFS_DBG_PORT_ENT_NUM
 - 1)

1110 

	)

1112 
	#NEW_DFS_MPERIOD_ENT_NUM_POWER
 8

	)

1113 
	#NEW_DFS_MPERIOD_ENT_NUM
 (1 << 
NEW_DFS_MPERIOD_ENT_NUM_POWER
)

1114 
	#NEW_DFS_MAX_CHANNEL
 4

	)

1116 
	s_NewDFSDebugPt
{

1117 
ULONG
 
	mcou
;

1118 
ULONG
 
	mtimeamp
;

1119 
USHORT
 
	mwidth
;

1120 
USHORT
 
	mt_idx
;

1121 
USHORT
 
	md_idx
;

1122 }
	tNewDFSDebugPt
, *
	tpNewDFSDebugPt
;

1125 
	s_NewDFSMPiod
{

1126 
USHORT
 
	midx
;

1127 
USHORT
 
	mwidth
;

1128 
USHORT
 
	midx2
;

1129 
USHORT
 
	mwidth2
;

1130 
ULONG
 
	mriod
;

1131 }
	tNewDFSMPiod
, *
	tpNewDFSMPiod
;

1133 
	s_NewDFSPam
{

1134 
BOOLEAN
 
	mvid
;

1135 
UCHAR
 
	mmode
;

1136 
USHORT
 
	mavgL
;

1137 
USHORT
 
	mELow
;

1138 
USHORT
 
	mEHigh
;

1139 
USHORT
 
	mWLow
;

1140 
USHORT
 
	mWHigh
;

1141 
UCHAR
 
	mEpsW
;

1142 
ULONG
 
	mTLow
;

1143 
ULONG
 
	mTHigh
;

1144 
UCHAR
 
	mEpsT
;

1145 #ifde
DFS_2_SUPPORT


1146 
ULONG
 
	mBLow
;

1147 
ULONG
 
	mBHigh
;

1149 }
	tNewDFSPam
, *
	tpNewDFSPam
;

1153 
	e_ABGBAND_STATE_
 {

1154 
	mUNKNOWN_BAND
,

1155 
	mBG_BAND
,

1156 
	mA_BAND
,

1157 } 
	tABGBAND_STATE
;

1159 #ifde
CONFIG_STA_SUPPORT


1160 #ifde
RTMP_MAC_PCI


1162 
	u_PS_CONTROL
 {

1164 
ULONG
 
	mEbPSId
:1;

1165 
ULONG
 
	mEbNewPS
:1;

1166 
ULONG
 
	m30xxPowMode
:2;

1167 
ULONG
 
	m30xxFlowHoASPM
:1;

1168 
ULONG
 
	m30xxFASPMTe
:1;

1170 
ULONG
 
	mAMDNewPSOn
:1;

1171 
ULONG
 
	mLedMode
:2;

1172 
ULONG
 
	m30xxFL0
:1;

1174 
ULONG
 
	mrsv
:22;

1175 } 
	mfld
;

1176 
ULONG
 
	mwd
;

1177 } 
	tPS_CONTROL
, *
	tPPS_CONTROL
;

1183 
	s_MLME_STRUCT
 {

1184 #ifde
CONFIG_STA_SUPPORT


1186 
STATE_MACHINE
 
	mClMache
;

1187 
STATE_MACHINE
 
	mAssocMache
;

1188 
STATE_MACHINE
 
	mAuthMache
;

1189 
STATE_MACHINE
 
	mAuthRMache
;

1190 
STATE_MACHINE
 
	mSyncMache
;

1191 
STATE_MACHINE
 
	mWPskMache
;

1192 
STATE_MACHINE
 
	mLpMache
;

1193 
STATE_MACHINE_FUNC
 
	mAssocFunc
[
ASSOC_FUNC_SIZE
];

1194 
STATE_MACHINE_FUNC
 
	mAuthFunc
[
AUTH_FUNC_SIZE
];

1195 
STATE_MACHINE_FUNC
 
	mAuthRFunc
[
AUTH_RSP_FUNC_SIZE
];

1196 
STATE_MACHINE_FUNC
 
	mSyncFunc
[
SYNC_FUNC_SIZE
];

1199 
STATE_MACHINE_FUNC
 
	mAFunc
[
ACT_FUNC_SIZE
];

1201 
STATE_MACHINE
 
	mAMache
;

1204 #ifde
QOS_DLS_SUPPORT


1205 
STATE_MACHINE
 
	mDlsMache
;

1206 
STATE_MACHINE_FUNC
 
	mDlsFunc
[
DLS_FUNC_SIZE
];

1212 
STATE_MACHINE
 
	mWMache
;

1213 
STATE_MACHINE_FUNC
 
	mWFunc
[
WPA_FUNC_SIZE
];

1217 
ULONG
 
	mChlQuy
;

1218 
ULONG
 
	mNow32
;

1219 
ULONG
 
	mLaSdNULLpsmTime
;

1221 
BOOLEAN
 
	mbRug
;

1222 
NDIS_SPIN_LOCK
 
	mTaskLock
;

1223 
MLME_QUEUE
 
	mQueue
;

1225 
UINT
 
	mShiReg
;

1227 
RALINK_TIMER_STRUCT
 
	mPiodicTim
;

1228 
RALINK_TIMER_STRUCT
 
	mAPSDPiodicTim
;

1229 
RALINK_TIMER_STRUCT
 
	mLkDownTim
;

1230 
RALINK_TIMER_STRUCT
 
	mLkUpTim
;

1231 #ifde
RTMP_MAC_PCI


1232 
UCHAR
 
	mbPsPlTimRug
;

1233 
RALINK_TIMER_STRUCT
 
	mPsPlTim
;

1234 
RALINK_TIMER_STRUCT
 
	mRadioOnOffTim
;

1236 
ULONG
 
	mPiodicRound
;

1237 
ULONG
 
	mGPIORound
;

1238 
ULONG
 
	mOSecPiodicRound
;

1240 
UCHAR
 
	mRlRxPh
;

1241 
BOOLEAN
 
	mbLowThroughput
;

1242 
BOOLEAN
 
	mbEbAutoACheck
;

1243 
RALINK_TIMER_STRUCT
 
	mRxAEvTim
;

1246 } 
	tMLME_STRUCT
, *
	tPMLME_STRUCT
;

1249 #ifde
DOT11_N_SUPPORT


1253 
	sdg_mpdu


1255 
dg_mpdu
 *
	mxt
;

1256 
PNDIS_PACKET
 
	mpPack
;

1257 
	mSequ
;

1258 
BOOLEAN
 
	mbAMSDU
;

1261 
	sdg_li


1263 
dg_mpdu
 *
	mxt
;

1264 
	mqn
;

1267 
	sdg_mpdu_po


1269 
PVOID
 
	mmem
;

1270 
NDIS_SPIN_LOCK
 
	mlock
;

1271 
dg_li
 
	mli
;

1274 
	e_REC_BLOCKACK_STATUS


1276 
	mRec_NONE
=0,

1277 
	mRec_USED
,

1278 
	mRec_HdRes
,

1279 
	mRec_Ac


1280 } 
	tREC_BLOCKACK_STATUS
, *
	tPREC_BLOCKACK_STATUS
;

1282 
	e_ORI_BLOCKACK_STATUS


1284 
	mOrig_NONE
=0,

1285 
	mOrig_USED
,

1286 
	mOrig_WaRes
,

1287 
	mOrig_De


1288 } 
	tORI_BLOCKACK_STATUS
, *
	tPORI_BLOCKACK_STATUS
;

1290 
	s_BA_ORI_ENTRY
{

1291 
UCHAR
 
	mWcid
;

1292 
UCHAR
 
	mTID
;

1293 
UCHAR
 
	mBAWSize
;

1294 
UCHAR
 
	mTok
;

1296 
USHORT
 
	mSequ
;

1297 
USHORT
 
	mTimeOutVue
;

1298 
ORI_BLOCKACK_STATUS
 
	mORI_BA_Stus
;

1299 
RALINK_TIMER_STRUCT
 
	mORIBATim
;

1300 
PVOID
 
	mpAdr
;

1301 } 
	tBA_ORI_ENTRY
, *
	tPBA_ORI_ENTRY
;

1303 
	s_BA_REC_ENTRY
 {

1304 
UCHAR
 
	mWcid
;

1305 
UCHAR
 
	mTID
;

1306 
UCHAR
 
	mBAWSize
;

1309 
USHORT
 
	mLaIndSeq
;

1311 
USHORT
 
	mTimeOutVue
;

1312 
RALINK_TIMER_STRUCT
 
	mRECBATim
;

1313 
ULONG
 
	mLaIndSeqAtTim
;

1314 
ULONG
 
	mnDrPack
;

1315 
ULONG
 
	mrcvSeq
;

1316 
REC_BLOCKACK_STATUS
 
	mREC_BA_Stus
;

1320 
NDIS_SPIN_LOCK
 
	mRxReRgLock
;

1322 
PVOID
 
	mpAdr
;

1323 
dg_li
 
	mli
;

1324 } 
	tBA_REC_ENTRY
, *
	tPBA_REC_ENTRY
;

1328 
ULONG
 
	mnumAsRec
;

1329 
ULONG
 
	mnumAsOrig
;

1330 
ULONG
 
	mnumDeOrig
;

1331 
BA_ORI_ENTRY
 
	mBAOriEry
[
MAX_LEN_OF_BA_ORI_TABLE
];

1332 
BA_REC_ENTRY
 
	mBARecEry
[
MAX_LEN_OF_BA_REC_TABLE
];

1333 } 
	tBA_TABLE
, *
	tPBA_TABLE
;

1336 
GNU_PACKED
 
	t_OID_BA_REC_ENTRY
{

1337 
UCHAR
 
	gMACAddr
[
MAC_ADDR_LEN
];

1338 
UCHAR
 
	gBaBm
;

1339 
UCHAR
 
	grsv
;

1340 
UCHAR
 
	gBufSize
[8];

1341 
REC_BLOCKACK_STATUS
 
	gREC_BA_Stus
[8];

1342 } 
	tOID_BA_REC_ENTRY
, *
	tPOID_BA_REC_ENTRY
;

1345 
GNU_PACKED
 
	t_OID_BA_ORI_ENTRY
{

1346 
UCHAR
 
	gMACAddr
[
MAC_ADDR_LEN
];

1347 
UCHAR
 
	gBaBm
;

1348 
UCHAR
 
	grsv
;

1349 
UCHAR
 
	gBufSize
[8];

1350 
ORI_BLOCKACK_STATUS
 
	gORI_BA_Stus
[8];

1351 } 
	tOID_BA_ORI_ENTRY
, *
	tPOID_BA_ORI_ENTRY
;

1353 
	s_QUERYBA_TABLE
{

1354 
OID_BA_ORI_ENTRY
 
	mBAOriEry
[32];

1355 
OID_BA_REC_ENTRY
 
	mBARecEry
[32];

1356 
UCHAR
 
	mOriNum
;

1357 
UCHAR
 
	mRecNum
;

1358 } 
	tQUERYBA_TABLE
, *
	tPQUERYBA_TABLE
;

1360 
	u_BACAP_STRUC
 {

1361 #ifde
RT_BIG_ENDIAN


1363 
	mUINT32
 :4;

1364 
UINT32
 
	mb2040CxiSnSup
:1;

1365 
UINT32
 
	mbHtAdhoc
:1;

1366 
UINT32
 
	mMMPSmode
:2;

1367 
UINT32
 
	mAmsduSize
:1;

1368 
UINT32
 
	mAmsduEb
:1;

1369 
UINT32
 
	mMpduDsy
:3;

1370 
UINT32
 
	mPicy
:2;

1371 
UINT32
 
	mAutoBA
:1;

1372 
UINT32
 
	mTxBAWLim
:8;

1373 
UINT32
 
	mRxBAWLim
:8;

1374 } 
	mfld
;

1377 
UINT32
 
	mRxBAWLim
:8;

1378 
UINT32
 
	mTxBAWLim
:8;

1379 
UINT32
 
	mAutoBA
:1;

1380 
UINT32
 
	mPicy
:2;

1381 
UINT32
 
	mMpduDsy
:3;

1382 
UINT32
 
	mAmsduEb
:1;

1383 
UINT32
 
	mAmsduSize
:1;

1384 
UINT32
 
	mMMPSmode
:2;

1385 
UINT32
 
	mbHtAdhoc
:1;

1386 
UINT32
 
	mb2040CxiSnSup
:1;

1387 
	mUINT32
 :4;

1388 } 
	mfld
;

1390 
UINT32
 
	mwd
;

1391 } 
	tBACAP_STRUC
, *
	tPBACAP_STRUC
;

1395 
BOOLEAN
 
	mIsRec
;

1396 
UCHAR
 
	mMACAddr
[
MAC_ADDR_LEN
];

1397 
UCHAR
 
	mTID
;

1398 
UCHAR
 
	mnMSDU
;

1399 
USHORT
 
	mTimeOut
;

1400 
BOOLEAN
 
	mbATid
;

1401 } 
	tOID_ADD_BA_ENTRY
, *
	tPOID_ADD_BA_ENTRY
;

1404 #ifde
DOT11N_DRAFT3


1405 
	e_BSS2040COEXIST_FLAG
{

1406 
	mBSS_2040_COEXIST_DISABLE
 = 0,

1407 
	mBSS_2040_COEXIST_TIMER_FIRED
 = 1,

1408 
	mBSS_2040_COEXIST_INFO_SYNC
 = 2,

1409 
	mBSS_2040_COEXIST_INFO_NOTIFY
 = 4,

1410 }
	tBSS2040COEXIST_FLAG
;

1412 
	s_BssCxChRge_
{

1413 
UCHAR
 
	mimyCh
;

1414 
UCHAR
 
	mcdyCh
;

1415 
UCHAR
 
	mefChS
;

1416 
UCHAR
 
	mefChEnd
;

1417 }
	tBSS_COEX_CH_RANGE
;

1420 
	#IS_HT_STA
(
_pMacEry
) \

1421 (
_pMacEry
->
MaxHTPhyMode
.
fld
.
MODE
 >
MODE_HTMIX
)

	)

1423 
	#IS_HT_RATE
(
_pMacEry
) \

1424 (
_pMacEry
->
HTPhyMode
.
fld
.
MODE
 >
MODE_HTMIX
)

	)

1426 
	#PEER_IS_HT_RATE
(
_pMacEry
) \

1427 (
_pMacEry
->
HTPhyMode
.
fld
.
MODE
 >
MODE_HTMIX
)

	)

1433 
	s_IOT_STRUC
 {

1434 
BOOLEAN
 
	mbRTSLgPrOn
;

1435 #ifde
CONFIG_STA_SUPPORT


1436 
BOOLEAN
 
	mbLaAthos
;

1437 
BOOLEAN
 
	mbCutAthos
;

1438 
BOOLEAN
 
	mbNowAthosBurOn
;

1439 
BOOLEAN
 
	mbNextDibRxBA
;

1440 
BOOLEAN
 
	mbTogg
;

1442 } 
	tIOT_STRUC
, *
	tPIOT_STRUC
;

1446 
	u_REG_TRANSMIT_SETTING
 {

1447 #ifde
RT_BIG_ENDIAN


1449 
UINT32
 
	mrsv
:13;

1450 
UINT32
 
	mEXTCHA
:2;

1451 
UINT32
 
	mHTMODE
:1;

1452 
UINT32
 
	mTRANSNO
:2;

1453 
UINT32
 
	mSTBC
:1;

1454 
UINT32
 
	mShtGI
:1;

1455 
UINT32
 
	mBW
:1;

1456 
UINT32
 
	mTxBF
:1;

1457 
UINT32
 
	mITxBfEn
:1;

1458 
UINT32
 
	mrsv0
:9;

1461 } 
	mfld
;

1466 
UINT32
 
	mrsv0
:9;

1467 
UINT32
 
	mITxBfEn
:1;

1468 
UINT32
 
	mTxBF
:1;

1469 
UINT32
 
	mBW
:1;

1470 
UINT32
 
	mShtGI
:1;

1471 
UINT32
 
	mSTBC
:1;

1472 
UINT32
 
	mTRANSNO
:2;

1473 
UINT32
 
	mHTMODE
:1;

1474 
UINT32
 
	mEXTCHA
:2;

1475 
UINT32
 
	mrsv
:13;

1476 } 
	mfld
;

1478 
UINT32
 
	mwd
;

1479 } 
	tREG_TRANSMIT_SETTING
, *
	tPREG_TRANSMIT_SETTING
;

1482 
	u_DESIRED_TRANSMIT_SETTING
 {

1483 #ifde
RT_BIG_ENDIAN


1485 
USHORT
 
	mrsv
:3;

1486 
USHORT
 
	mFixedTxMode
:2;

1487 
USHORT
 
	mPhyMode
:4;

1488 
USHORT
 
	mMCS
:7;

1489 } 
	mfld
;

1492 
USHORT
 
	mMCS
:7;

1493 
USHORT
 
	mPhyMode
:4;

1494 
USHORT
 
	mFixedTxMode
:2;

1495 
USHORT
 
	mrsv
:3;

1496 } 
	mfld
;

1498 
USHORT
 
	mwd
;

1499 } 
	tDESIRED_TRANSMIT_SETTING
, *
	tPDESIRED_TRANSMIT_SETTING
;

1507 
	#WLAN_MAX_NUM_OF_TIM
 ((
MAX_LEN_OF_MAC_TABLE
 >> 3+ 1

	)

1508 
	#WLAN_CT_TIM_BCMC_OFFSET
 0

	)

1511 
	#WLAN_MR_TIM_BCMC_CLEAR
(
idx
) \

1512 
pAd
->
ApCfg
.
MBSSID
[
idx
].
TimBms
[
WLAN_CT_TIM_BCMC_OFFSET
] &~
BIT8
[0];

	)

1515 
	#WLAN_MR_TIM_BCMC_SET
(
idx
) \

1516 
pAd
->
ApCfg
.
MBSSID
[
idx
].
TimBms
[
WLAN_CT_TIM_BCMC_OFFSET
] |
BIT8
[0];

	)

1519 
	#WLAN_MR_TIM_BIT_CLEAR
(
ad_p
, 
idx
, 
wcid
) \

1520 { 
UCHAR
 
tim_offt
 = 
wcid
 >> 3; \

1521 
UCHAR
 
b_offt
 = 
wcid
 & 0x7; \

1522 
ad_p
->
ApCfg
.
MBSSID
[
idx
].
TimBms
[
tim_offt
] &(~
BIT8
[
b_offt
]); }

	)

1525 
	#WLAN_MR_TIM_BIT_SET
(
ad_p
, 
idx
, 
wcid
) \

1526 { 
UCHAR
 
tim_offt
 = 
wcid
 >> 3; \

1527 
UCHAR
 
b_offt
 = 
wcid
 & 0x7; \

1528 
ad_p
->
ApCfg
.
MBSSID
[
idx
].
TimBms
[
tim_offt
] |
BIT8
[
b_offt
]; }

	)

1533 
	s_COMMON_CONFIG
 {

1535 
BOOLEAN
 
	mbCouryFg
;

1536 
UCHAR
 
	mCouryCode
[3];

1537 #ifde
EXT_BUILD_CHANNEL_LIST


1538 
UCHAR
 
	mGeogphy
;

1540 
UCHAR
 
	mCouryRegi
;

1541 
UCHAR
 
	mCouryRegiFABd
;

1542 
UCHAR
 
	mPhyMode
;

1543 
UCHAR
 
	mDesedPhyMode
;

1544 
USHORT
 
	mDsifs
;

1545 
ULONG
 
	mPackFr
;

1546 
UINT8
 
	mRegutyCss
[
MAX_NUM_OF_REGULATORY_CLASS
];

1548 
CHAR
 
	mSsid
[
MAX_LEN_OF_SSID
];

1549 
UCHAR
 
	mSsidL
;

1550 
UCHAR
 
	mLaSsidL
;

1551 
CHAR
 
	mLaSsid
[
MAX_LEN_OF_SSID
];

1552 
UCHAR
 
	mLaBssid
[
MAC_ADDR_LEN
];

1554 
UCHAR
 
	mBssid
[
MAC_ADDR_LEN
];

1555 
USHORT
 
	mBcPiod
;

1556 
UCHAR
 
	mChl
;

1557 
UCHAR
 
	mCChl
;

1559 
UCHAR
 
	mSupRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

1560 
UCHAR
 
	mSupReL
;

1561 
UCHAR
 
	mExtRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

1562 
UCHAR
 
	mExtReL
;

1563 
UCHAR
 
	mDeseRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

1564 
UCHAR
 
	mMaxDesedRe
;

1565 
UCHAR
 
	mExedACKRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

1567 
ULONG
 
	mBasicReBm
;

1568 
ULONG
 
	mBasicReBmOld
;

1570 
BOOLEAN
 
	mbAPSDCab
;

1571 
BOOLEAN
 
	mbInSviPiod
;

1572 
BOOLEAN
 
	mbAPSDAC_BE
;

1573 
BOOLEAN
 
	mbAPSDAC_BK
;

1574 
BOOLEAN
 
	mbAPSDAC_VI
;

1575 
BOOLEAN
 
	mbAPSDAC_VO
;

1580 
BOOLEAN
 
	mbACMAPSDBackup
[4];

1581 
BOOLEAN
 
	mbACMAPSDTr
[4];

1583 
BOOLEAN
 
	mbNdSdTriggFme
;

1584 
BOOLEAN
 
	mbAPSDFPowSave
;

1585 
ULONG
 
	mTriggTimCou
;

1586 
UCHAR
 
	mMaxSPLgth
;

1587 
UCHAR
 
	mBBPCutBW
;

1590 
REG_TRANSMIT_SETTING
 
	mRegTnsmStg
;

1592 
UCHAR
 
	mTxRe
;

1593 
UCHAR
 
	mMaxTxRe
;

1594 
UCHAR
 
	mTxReIndex
;

1595 
UCHAR
 
	mTxReTabSize
;

1597 
UCHAR
 
	mMTxRe
;

1598 
UCHAR
 
	mRtsRe
;

1599 
HTTRANSMIT_SETTING
 
	mMlmeTnsm
;

1600 
UCHAR
 
	mMlmeRe
;

1601 
UCHAR
 
	mBasicMlmeRe
;

1603 
USHORT
 
	mRtsThshd
;

1604 
USHORT
 
	mFgmtThshd
;

1606 
UCHAR
 
	mTxPow
;

1607 
ULONG
 
	mTxPowPage
;

1608 
ULONG
 
	mTxPowDeu
;

1609 
UINT8
 
	mPwrCڡt
;

1611 #ifde
DOT11_N_SUPPORT


1612 
BACAP_STRUC
 
	mBACaby
;

1613 
BACAP_STRUC
 
	mREGBACaby
;

1615 
IOT_STRUC
 
	mIOTePm
;

1616 
ULONG
 
	mTxPamb
;

1617 
BOOLEAN
 
	mbUZoToDibFgmt
;

1618 
ULONG
 
	mUBGPrei
;

1619 
BOOLEAN
 
	mbUShtSlTime
;

1620 
BOOLEAN
 
	mbEbTxBur
;

1621 
BOOLEAN
 
	mbAgggiCab
;

1622 
BOOLEAN
 
	mbPiggyBackCab
;

1623 
BOOLEAN
 
	mbIEEE80211H
;

1624 
ULONG
 
	mDibOLBCDe
;

1626 #ifde
DOT11_N_SUPPORT


1627 
BOOLEAN
 
	mbRdg
;

1629 
BOOLEAN
 
	mbWmmCab
;

1630 
QOS_CAPABILITY_PARM
 
	mAPQosCaby
;

1631 
EDCA_PARM
 
	mAPEdPm
;

1632 
QBSS_LOAD_PARM
 
	mAPQbssLd
;

1633 
UCHAR
 
	mAckPicy
[4];

1634 #ifde
CONFIG_STA_SUPPORT


1635 
BOOLEAN
 
	mbDLSCab
;

1641 
ULONG
 
	mOpStusFgs
;

1643 
BOOLEAN
 
	mNdisRadioSOff
;

1644 
ABGBAND_STATE
 
	mBdS
;

1647 
RADAR_DETECT_STRUCT
 
	mRadDe
;

1648 
BOOLEAN
 
	mbDFSIndo
;

1649 #ifde
CARRIER_DETECTION_SUPPORT


1650 
CARRIER_DETECTION_STRUCT
 
	mCrrDe
;

1651 
UCHAR
 
	mr_func
;

1654 #ifde
DOT11_N_SUPPORT


1658 
RT_HT_CAPABILITY
 
	mDesedHtPhy
;

1659 
HT_CAPABILITY_IE
 
	mHtCaby
;

1660 
ADD_HT_INFO_IE
 
	mAddHTInfo
;

1663 
NEW_EXT_CHAN_IE
 
	mNewExtChOfft
;

1665 
EXT_CAP_INFO_ELEMENT
 
	mExtCIE
;

1667 #ifde
DOT11N_DRAFT3


1668 
BOOLEAN
 
	mbBssCxEb
;

1674 
UCHAR
 
	mBssCxApCThr
;

1675 
UCHAR
 
	mBssCxApC
;

1677 
UCHAR
 
	mBss2040CxiFg
;

1678 
RALINK_TIMER_STRUCT
 
	mBss2040CxiTim
;

1681 
BSS_2040_COEXIST_IE
 
	mBSS2040CxiInfo
;

1683 
USHORT
 
	mD11OBssSnPassiveDwl
;

1684 
USHORT
 
	mD11OBssSnAiveDwl
;

1685 
USHORT
 
	mD11BssWidthTriggSnI
;

1686 
USHORT
 
	mD11OBssSnPassiveTٮPChl
;

1687 
USHORT
 
	mD11OBssSnAiveTٮPChl
;

1688 
USHORT
 
	mD11BssWidthChTnDayFa
;

1689 
USHORT
 
	mD11OBssSnAivyTh
;

1691 
ULONG
 
	mD11BssWidthChTnDay
;

1692 
ULONG
 
	mCouDownC
;

1694 
BSS_2040_COEXIST_IE
 
	mLaBSSCxi2040
;

1695 
BSS_2040_COEXIST_IE
 
	mBSSCxi2040
;

1696 
TRIGGER_EVENT_TAB
 
	mTriggEvtTab
;

1697 
UCHAR
 
	mChlLiIdx
;

1699 
BOOLEAN
 
	mbOvpSg
;

1700 
BOOLEAN
 
	mbBssCxNify
;

1703 
BOOLEAN
 
	mbHTPre
;

1704 
BOOLEAN
 
	mbMIMOPSEb
;

1705 
BOOLEAN
 
	mbBADee
;

1706 
BOOLEAN
 
	mbDibRedg
;

1707 
BOOLEAN
 
	mbFty_Mhz_Iޔt
;

1708 
BOOLEAN
 
	mbExtChlSwchAounmt
;

1709 
BOOLEAN
 
	mbRcvBSSWidthTriggEvts
;

1710 
ULONG
 
	mLaRcvBSSWidthTriggEvtsTime
;

1712 
UCHAR
 
	mTxBASize
;

1715 #ifde
SYSTEM_LOG_SUPPORT


1717 
BOOLEAN
 
	mbWessEvt
;

1720 
BOOLEAN
 
	mbWiFiTe
;

1723 
UCHAR
 
	mTxSm
;

1724 
UCHAR
 
	mRxSm
;

1727 #ifde
MCAST_RATE_SPECIFIC


1728 
UCHAR
 
	mMTnsmMcs
;

1729 
UCHAR
 
	mMTnsmPhyMode
;

1732 
BOOLEAN
 
	mbHdweRadio
;

1736 
NDIS_SPIN_LOCK
 
	mMsuReqTabLock
;

1737 
PMEASURE_REQ_TAB
 
	mpMsuReqTab
;

1739 
NDIS_SPIN_LOCK
 
	mTpcReqTabLock
;

1740 
PTPC_REQ_TAB
 
	mpTpcReqTab
;

1743 #ifde
MCAST_RATE_SPECIFIC


1744 
HTTRANSMIT_SETTING
 
	mMCaPhyMode
;

1747 #ifde
SINGLE_SKU


1748 
UINT16
 
	mDefeMaxTxPwr
;

1749 
BOOLEAN
 
	mbSKUMode
;

1750 
UINT16
 
	mAGa
;

1751 
UINT16
 
	mBdedgeD
;

1755 #ifde
DFS_SUPPORT


1756 #i
defed
(
RTMP_RBUS_SUPPORT
|| defed(
DFS_INTERRUPT_SUPPORT
)

1758 
ULONG
 
	mCID
;

1759 
ULONG
 
	mCN
;

1762 
UCHAR
 
	mMcuRadCmd
;

1763 
UCHAR
 
	mMcuRadEvt
;

1764 
UCHAR
 
	mMcuRadPrei
;

1765 
UCHAR
 
	mMcuRadS
;

1766 
UCHAR
 
	mMcuCrrS
;

1769 
ULONG
 
	mOldRtsRryLim
;

1770 
UCHAR
 
	m_R65
;

1771 
UCHAR
 
	m_R66
;

1772 
UCHAR
 
	m_R69
;

1773 
UCHAR
 
	m_R70
;

1774 
UCHAR
 
	m_R73
;

1775 
UCHAR
 
	mR65
;

1776 
UCHAR
 
	mR66
;

1777 
UCHAR
 
	mDFS_R66
;

1780 #ifde
DFS_HARDWARE_SUPPORT


1781 
ULONG
 
	mMCURadRegi
;

1782 
UCHAR
 
	mDDay
;

1783 
UCHAR
 
	mRadReEb
;

1784 
USHORT
 
	mPlTime
;

1785 
USHORT
 
	mChEb
;

1786 
INT
 
	mDfsRssiHigh
;

1787 
INT
 
	mDfsRssiLow
;

1788 
INT
 
	mDfsRssiHighFromCfg
;

1789 
INT
 
	mDfsRssiLowFromCfg
;

1790 
BOOLEAN
 
	mDfsRssiHighCfgVid
;

1791 
BOOLEAN
 
	mDfsRssiLowCfgVid
;

1792 
NewDFSDebug
 
	mDfsDebug
;

1793 
NewDFSDebugPt
 
	mFCC_5
[
NEW_DFS_FCC_5_ENT_NUM
];

1794 
UCHAR
 
	mfcc_5_idx
;

1795 
UCHAR
 
	mfcc_5_ϡ_idx
;

1796 
USHORT
 
	mfcc_5_thshd
;

1797 
ULONG
 
	mfcc_5_cou
;

1798 
UCHAR
 
	mu_skt
;

1799 
UCHAR
 
	mDFSPamFromCfig
;

1800 
NewDFSPam
 
	mNewDFSTabEry
[16];

1801 #ifde
DFS_DEBUG


1803 
UCHAR
 
	mDebugPt
[384];

1804 
UCHAR
 
	mDebugPtPrt
;

1805 
ULONG
 
	mTٮErs
[4];

1807 
ULONG
 
	mT_Mched_2
;

1808 
ULONG
 
	mT_Mched_3
;

1809 
ULONG
 
	mT_Mched_4
;

1810 
ULONG
 
	mT_Mched_5
;

1811 
UCHAR
 
	mBBP127Rt
;

1813 
ULONG
 
	mCouSted
[5];

1814 
ULONG
 
	mCouSted2
[5];

1815 
ULONG
 
	mCouSted3
;

1816 
NewDFSDebugPt
 
	mCE_DebugCh0
[
NEW_DFS_DBG_PORT_ENT_NUM
];

1817 
NewDFSMPiod
 
	mCE_TCh0
[
NEW_DFS_MPERIOD_ENT_NUM
];

1821 
NewDFSDebugPt
 
	mDFS_W
[
NEW_DFS_MAX_CHANNEL
][
NEW_DFS_DBG_PORT_ENT_NUM
];

1822 
USHORT
 
	mdfs_w_idx
[
NEW_DFS_MAX_CHANNEL
];

1823 
USHORT
 
	mdfs_w_ϡ_idx
[
NEW_DFS_MAX_CHANNEL
];

1824 
ULONG
 
	mdfs_w_cou
;

1826 
NewDFSMPiod
 
	mDFS_T
[
NEW_DFS_MAX_CHANNEL
][
NEW_DFS_MPERIOD_ENT_NUM
];

1827 
USHORT
 
	mdfs_t_idx
[
NEW_DFS_MAX_CHANNEL
];

1829 
USHORT
 
	mdfs_width_diff_ch1_Shi
;

1830 
USHORT
 
	mdfs_width_diff_ch2_Shi
;

1831 
USHORT
 
	mdfs_width_diff_Shi
;

1832 
USHORT
 
	mdfs_riod_r
;

1833 
ULONG
 
	mdfs_max_riod
;

1834 
USHORT
 
	mdfs_width_diff
;

1835 
USHORT
 
	mdfs_width_ch0_r_L
;

1836 
USHORT
 
	mdfs_width_ch0_r_H
;

1837 
UCHAR
 
	mdfs_check_lo
;

1838 
UCHAR
 
	mdfs_dee_ths
;

1839 
UCHAR
 
	mdDeed
;

1840 
UCHAR
 
	mCh0Ovow
;

1841 
UCHAR
 
	m_agged_check
;

1842 
UCHAR
 
	mhw_dfs_dibd
;

1844 
UINT
 
	msw_idx
[
NEW_DFS_MAX_CHANNEL
];

1845 
UINT
 
	mhw_idx
[
NEW_DFS_MAX_CHANNEL
];

1846 
UINT
 
	m_idx
[
NEW_DFS_MAX_CHANNEL
];

1849 
ULONG
 
	m_check_jiffs
[
NEW_DFS_MAX_CHANNEL
];

1850 
ULONG
 
	m_check_Width
[
NEW_DFS_MAX_CHANNEL
];

1851 
ULONG
 
	m_check_Piod
[
NEW_DFS_MAX_CHANNEL
];

1854 
UCHAR
 
	mBUM_time
;

1855 
ULONG
 
	mid_time
;

1856 
ULONG
 
	mbusy_time
;

1857 
	mrssi
;

1858 
UCHAR
 
	mch_busy
;

1859 
UCHAR
 
	mch_busy_id_tio
;

1860 
UCHAR
 
	mBusyIdFromCfg
;

1861 
BOOLEAN
 
	mBusyIdCfgVid
;

1864 
ULONG
 
	mRadEvtExpe
[4];

1866 
	#CH_BUSY_NEGATIVE_MASK
 0xe0000000

1867 
	#CH_BUSY_SAMPLE_POWER
 3

	)

1868 
	#CH_BUSY_SAMPLE
 (1 << 
CH_BUSY_SAMPLE_POWER
)

	)

1869 
	#CH_BUSY_MASK
 (
CH_BUSY_SAMPLE
 - 1)

	)

1870 
UCHAR
 
	mt_ch_busy_a
;

1871 
ULONG
 
	mch_busy_a
[
CH_BUSY_SAMPLE
];

1872 
ULONG
 
	mch_id_a
[
CH_BUSY_SAMPLE
];

1873 
UCHAR
 
	mch_busy_a_dex
;

1874 
	mch_busy_sum
;

1875 
	mch_id_sum
;

1877 
	#MAX_FDF_NUMBER
 5

1878 
UCHAR
 
fdf_num
;

	)

1879 
USHORT
 
	mch_busy_thshd
[
MAX_FDF_NUMBER
];

1880 
	mrssi_thshd
[
MAX_FDF_NUMBER
];

1883 
UCHAR
 
	mSymmric_Round
;

1884 
UCHAR
 
	mVGA_Mask
;

1885 
UCHAR
 
	mPack_End_Mask
;

1886 
UCHAR
 
	mRx_PE_Mask
;

1887 
UCHAR
 
	mSymRoundFromCfg
;

1888 
UCHAR
 
	mSymRoundCfgVid
;

1893 
UCHAR
 
	mW56_debug
;

1894 
ULONG
 
	mW56_idx
;

1895 
ULONG
 
	mW56_1s
;

1896 
ULONG
 
	mW56_4s
[4];

1897 
ULONG
 
	mW56_tٮ
;

1898 
ULONG
 
	mW56_hw_1
;

1899 
ULONG
 
	mW56_hw_2
;

1900 
ULONG
 
	mW56_hw_sum
;

1901 
UCHAR
 
	mRadENum
;

1907 
UCHAR
 
	mMcuRadDebug
;

1910 
UCHAR
 
	mMcuRadTick
;

1911 
UCHAR
 
	mMcuRadPiod
;

1912 
UCHAR
 
	mMcuRadDePiod
;

1913 
UCHAR
 
	mMcuRadCtsPre
;

1914 
UCHAR
 
	mMcuRadDeCou
;

1915 
ULONG
 
	mRadTimeSmpHigh
;

1916 
ULONG
 
	mRadTimeSmpLow
;

1921 #ifde
CARRIER_DETECTION_SUPPORT


1923 
USHORT
 
	mMcuCrrTick
;

1924 
USHORT
 
	mMcuCrrDeCou
;

1925 
USHORT
 
	mMcuCrrPiod
;

1926 
UCHAR
 
	mMcuCrrDePiod
;

1927 
UCHAR
 
	mMcuCrrCtsPre
;

1931 #ifde
DFS_SUPPORT


1932 
DFS_VERSION
 
	mdfs_func
;

1933 #ifde
DFS_HARDWARE_SUPPORT


1934 
UCHAR
 
	mDFSAPRet
;

1935 
RALINK_TIMER_STRUCT
 
	mDFSWchDogTim
;

1936 
BOOLEAN
 
	mDFSWchDogIsRug
;

1937 
RALINK_TIMER_STRUCT
 
	mCSWchDogTim
;

1942 
BOOLEAN
 
	mHT_DiowTKIP
;

1944 
BOOLEAN
 
	mHT_Dib
;

1948 #ifde
DOT11_N_SUPPORT


1949 #ifde
TXBF_SUPPORT


1950 
ULONG
 
	mITxBfTimeout
;

1951 
ULONG
 
	mETxBfTimeout
;

1952 
ULONG
 
	mETxBfEnCd
;

1953 
BOOLEAN
 
	mETxBfNcomess
;

1957 
ULONG
 
	mDebugFgs
;

1960 #ifde
RTMP_MAC_PCI


1961 
BOOLEAN
 
	mbPCIeBus
;

1966 } 
	tCOMMON_CONFIG
, *
	tPCOMMON_CONFIG
;

1970 
	#DBF_LESS_AGG_UP
 0x0001

1971 
	#DBF_CHECK_UP_PER
 0x0002

1972 
	#DBF_NO_TXBF_3SS
 0x0004

1973 
	#DBF_LOW_RA_THRESHOLDS
 0x0008

1974 
	#DBF_UNUSED0
 0x0010

1975 
	#DBF_INIT_MCS_MARGIN
 0x0020

1976 
	#DBF_INIT_MCS_DIS1
 0x0040

1977 
	#DBF_INIT_MCS_DIS2
 0x0080

1978 
	#DBF_FORCE_SGI
 0x0100

1979 
	#DBF_UNUSED0200
 0x0200

1980 
	#DBF_UNUSED0400
 0x0400

1981 
	#DBF_UNUSED0800
 0x0800

1982 
	#DBF_FORCE_AC_VI
 0x1000

1983 
	#DBF_UNUSED2000
 0x2000

1984 
	#DBF_UNUSED4000
 0x4000

1985 
	#DBF_UNUSED8000
 0x8000

1987 

	)

1988 #ifde
CONFIG_STA_SUPPORT


1991 
	s_STA_ADMIN_CONFIG
 {

1998 
UCHAR
 
	mBssTy
;

2000 #ifde
MONITOR_FLAG_11N_SNIFFER_SUPPORT


2001 
	#MONITOR_FLAG_11N_SNIFFER
 0x01

	)

2002 
UCHAR
 
	mBssMڙFg
;

2005 
USHORT
 
	mAtimW
;

2012 
UCHAR
 
	mRssiTrigg
;

2013 
UCHAR
 
	mRssiTriggMode
;

2014 
USHORT
 
	mDeuLiCou
;

2015 
ULONG
 
	mWdowsPowMode
;

2016 
ULONG
 
	mWdowsBryPowMode
;

2017 
BOOLEAN
 
	mbWdowsACCAMEb
;

2018 
BOOLEAN
 
	mbAutoRec
;

2019 
ULONG
 
	mWdowsPowProfe
;

2022 
USHORT
 
	mPsm
;

2023 
USHORT
 
	mDissocRs
;

2024 
UCHAR
 
	mDissocS
[
MAC_ADDR_LEN
];

2025 
USHORT
 
	mDuthRs
;

2026 
UCHAR
 
	mDuthS
[
MAC_ADDR_LEN
];

2027 
USHORT
 
	mAuthFaRs
;

2028 
UCHAR
 
	mAuthFaS
[
MAC_ADDR_LEN
];

2030 
NDIS_802_11_PRIVACY_FILTER
 
	mPrivacyFr
;

2031 
NDIS_802_11_AUTHENTICATION_MODE
 
	mAuthMode
;

2032 
NDIS_802_11_WEP_STATUS
 
	mWStus
;

2035 
NDIS_802_11_ENCRYPTION_STATUS
 
	mGroupCh
;

2036 
NDIS_802_11_ENCRYPTION_STATUS
 
	mPaCh
;

2037 
BOOLEAN
 
	mbMixCh
;

2038 
USHORT
 
	mRCaby
;

2040 
NDIS_802_11_WEP_STATUS
 
	mGroupKeyWStus
;

2042 
UCHAR
 
	mWPassPh
[64];

2043 
UINT
 
	mWPassPhL
;

2044 
UCHAR
 
	mPMK
[
LEN_PMK
];

2045 
UCHAR
 
	mPTK
[
LEN_PTK
];

2046 
UCHAR
 
	mGMK
[
LEN_GMK
];

2047 
UCHAR
 
	mGTK
[
MAX_LEN_GTK
];

2048 
UCHAR
 
	mGN
[32];

2049 
CIPHER_KEY
 
	mTxGTK
;

2050 
BSSID_INFO
 
	mSavedPMK
[
PMKID_NO
];

2051 
UINT
 
	mSavedPMKNum
;

2053 
UCHAR
 
	mDeuKeyId
;

2057 
UCHAR
 
	mPtSecud
;

2060 
ULONG
 
	mLaMicETime
;

2061 
ULONG
 
	mMicEC
;

2062 
BOOLEAN
 
	mbBlockAssoc
;

2064 
UINT8
 
	mWS
;

2065 
UCHAR
 
	mRyCou
[8];

2066 
UCHAR
 
	mAN
[32];

2067 
UCHAR
 
	mSN
[32];

2069 
UCHAR
 
	mLaSNR0
;

2070 
UCHAR
 
	mLaSNR1
;

2071 
RSSI_SAMPLE
 
	mRssiSame
;

2072 
ULONG
 
	mNumOfAvgRssiSame
;

2074 
ULONG
 
	mLaBcRxTime
;

2075 
ULONG
 
	mLa11bBcRxTime
;

2076 
ULONG
 
	mLa11gBcRxTime
;

2077 
ULONG
 
	mLa20NBcRxTime
;

2079 
ULONG
 
	mLaSnTime
;

2080 
BOOLEAN
 
	mbNFSn
;

2081 
BOOLEAN
 
	mbSwRadio
;

2082 
BOOLEAN
 
	mbHwRadio
;

2083 
BOOLEAN
 
	mbRadio
;

2084 
BOOLEAN
 
	mbHdweRadio
;

2085 
BOOLEAN
 
	mbShowHiddSSID
;

2089 
NDIS_802_11_ASSOCIATION_INFORMATION
 
	mAssocInfo
;

2090 
USHORT
 
	mReqVIEL
;

2091 
UCHAR
 
	mReqVIEs
[
MAX_VIE_LEN
];

2092 
USHORT
 
	mResVIEL
;

2093 
UCHAR
 
	mResVIEs
[
MAX_VIE_LEN
];

2095 
UCHAR
 
	mRSNIE_L
;

2096 
UCHAR
 
	mRSN_IE
[
MAX_LEN_OF_RSNIE
];

2098 
ULONG
 
	mCLBusyBys
;

2099 
USHORT
 
	mRPIDsy
[8];

2101 
UCHAR
 
	mRMReqC
;

2102 
UCHAR
 
	mCutRMReqIdx
;

2103 
BOOLEAN
 
	mPlReq
;

2105 
USHORT
 
	mPlDuti
;

2106 
UCHAR
 
	mPlChl
;

2107 
USHORT
 
	mIAPPTok
;

2109 
UCHAR
 
	mNHFa
;

2110 
UCHAR
 
	mCLFa
;

2112 
RALINK_TIMER_STRUCT
 
	mSQuickReeFReUpTim
;

2113 
BOOLEAN
 
	mSQuickReeFReUpTimRug
;

2115 
UCHAR
 
	mDtimCou
;

2116 
UCHAR
 
	mDtimPiod
;

2118 #ifde
QOS_DLS_SUPPORT


2119 
RT_802_11_DLS
 
	mDLSEry
[
MAX_NUM_OF_DLS_ENTRY
];

2120 
UCHAR
 
	mDlsRyCou
[8];

2123 
BOOLEAN
 
	mbTDLSCab
;

2126 
BOOLEAN
 
	mWhqlTe
;

2129 
RALINK_TIMER_STRUCT
 
	mWDissocAndBlockAssocTim
;

2131 
BOOLEAN
 
	mbAutoRmg
;

2132 
CHAR
 
	mdBmToRm
;

2134 #ifde
WPA_SUPPLICANT_SUPPORT


2135 
BOOLEAN
 
	mIEEE8021X
;

2136 
BOOLEAN
 
	mIEEE8021x_qued_keys
;

2137 
CIPHER_KEY
 
	mDeseShedKey
[4];

2138 
UCHAR
 
	mDeseShedKeyId
;

2144 
UCHAR
 
	mWSuliUP
;

2145 
UCHAR
 
	mWSuliSnCou
;

2146 
BOOLEAN
 
	mbRSN_IE_FromWSuli
;

2147 
BOOLEAN
 
	mbLoAp
;

2148 
UCHAR
 *
	mpWpsProbeReqIe
;

2149 
UINT
 
	mWpsProbeReqIeL
;

2150 
UCHAR
 *
	mpWAssocIe
;

2151 
UINT
 
	mWAssocIeL
;

2154 
CHAR
 
	mdev_me
[16];

2155 
USHORT
 
	mOriDevTy
;

2157 
BOOLEAN
 
	mbTGnWifiTe
;

2158 
BOOLEAN
 
	mbSnReqIsFromWebUI
;

2160 
HTTRANSMIT_SETTING
 
	mHTPhyMode
, 
	mMaxHTPhyMode
, 
	mMHTPhyMode
;

2161 
DESIRED_TRANSMIT_SETTING
 
	mDesedTnsmStg
;

2162 
RT_HT_PHY_INFO
 
	mDesedHtPhyInfo
;

2163 
BOOLEAN
 
	mbAutoTxReSwch
;

2165 #ifde
RTMP_MAC_PCI


2166 
UCHAR
 
	mBBPR3
;

2171 
PS_CONTROL
 
	mPSCڌ
;

2174 #ifde
EXT_BUILD_CHANNEL_LIST


2175 
UCHAR
 
	mIEEE80211dClMode
;

2176 
UCHAR
 
	mSOriCouryCode
[3];

2177 
UCHAR
 
	mSOriGeogphy
;

2184 
BOOLEAN
 
	mbAutoCByBssid
;

2185 
ULONG
 
	mBcLoTime
;

2186 
BOOLEAN
 
	mbFTxBur
;

2187 #ifde
XLINK_SUPPORT


2188 
BOOLEAN
 
	mPSPXlk
;

2190 
BOOLEAN
 
	mbAutoCIfNoSSID
;

2191 #ifde
DOT11_N_SUPPORT


2192 #ifde
DOT11N_DRAFT3


2193 
UCHAR
 
	mRegCss
;

2195 
BOOLEAN
 
	mbAdhocN
;

2197 
BOOLEAN
 
	mbAdhocC
;

2204 
BOOLEAN
 
	mbImovedSn
;

2205 
BOOLEAN
 
	mBssNr
;

2206 
UCHAR
 
	mSnChlC
;

2207 
UCHAR
 
	mLaSnChl
;

2210 
BOOLEAN
 
	mbFaC
;

2212 } 
	tSTA_ADMIN_CONFIG
, *
	tPSTA_ADMIN_CONFIG
;

2220 
	s_STA_ACTIVE_CONFIG
 {

2221 
USHORT
 
	mAid
;

2222 
USHORT
 
	mAtimW
;

2223 
USHORT
 
	mCabyInfo
;

2224 
USHORT
 
	mCMaxDuti
;

2225 
USHORT
 
	mCPiod
;

2229 
UCHAR
 
	mSupRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

2230 
UCHAR
 
	mExtRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

2231 
UCHAR
 
	mSupReL
;

2232 
UCHAR
 
	mExtReL
;

2234 
RT_HT_PHY_INFO
 
	mSu܋dPhyInfo
;

2235 
RT_HT_CAPABILITY
 
	mSu܋dHtPhy
;

2236 } 
	tSTA_ACTIVE_CONFIG
, *
	tPSTA_ACTIVE_CONFIG
;

2245 
	s_MAC_TABLE_ENTRY
 {

2251 
UINT32
 
	mEryTy
;

2252 
BOOLEAN
 
	misCached
;

2253 
BOOLEAN
 
	mbIAmBadAthos
;

2256 
UCHAR
 
	mEnqueueESTimRug
;

2257 
RALINK_TIMER_STRUCT
 
	mEnqueueSFPSKTim
;

2261 
UCHAR
 
	mCMTimRug
;

2262 
UCHAR
 
	midx
;

2263 
UCHAR
 
	mRSNIE_L
;

2264 
UCHAR
 
	mRSN_IE
[
MAX_LEN_OF_RSNIE
];

2265 
UCHAR
 
	mAN
[
LEN_KEY_DESC_NONCE
];

2266 
UCHAR
 
	mSN
[
LEN_KEY_DESC_NONCE
];

2267 
UCHAR
 
	mR_Cou
[
LEN_KEY_DESC_REPLAY
];

2268 
UCHAR
 
	mPTK
[64];

2269 
UCHAR
 
	mReTryCou
;

2270 
RALINK_TIMER_STRUCT
 
	mRryTim
;

2271 
NDIS_802_11_AUTHENTICATION_MODE
 
	mAuthMode
;

2272 
NDIS_802_11_WEP_STATUS
 
	mWStus
;

2273 
NDIS_802_11_WEP_STATUS
 
	mGroupKeyWStus
;

2274 
UINT8
 
	mWS
;

2275 
UINT8
 
	mGTKS
;

2276 
USHORT
 
	mPtSecud
;

2277 
NDIS_802_11_PRIVACY_FILTER
 
	mPrivacyFr
;

2278 
CIPHER_KEY
 
	mPawiKey
;

2279 
PVOID
 
	mpAd
;

2280 
INT
 
	mPMKID_CacheIdx
;

2281 
UCHAR
 
	mPMKID
[
LEN_PMKID
];

2282 
UCHAR
 
	mNegٟdAKM
[
LEN_OUI_SUITE
];

2285 
UCHAR
 
	mAddr
[
MAC_ADDR_LEN
];

2286 
UCHAR
 
	mPsMode
;

2287 
SST
 
	mS
;

2288 
AUTH_STATE
 
	mAuthS
;

2289 
BOOLEAN
 
	mIsRssocS
;

2290 
USHORT
 
	mAid
;

2291 
USHORT
 
	mCabyInfo
;

2292 
UCHAR
 
	mLaRssi
;

2293 
ULONG
 
	mNoDaIdCou
;

2294 
UINT16
 
	mStiKpAliveCou
;

2295 
ULONG
 
	mPsQIdCou
;

2296 
QUEUE_HEADER
 
	mPsQueue
;

2298 
UINT32
 
	mSCTime
;

2299 
UINT32
 
	mSIdTimeout
;

2302 #ifde
DOT11_N_SUPPORT


2303 
BOOLEAN
 
	mbSdBAR
;

2304 
USHORT
 
	mNoBADaCouDown
;

2306 
UINT32
 
	mCachedBuf
[16];

2308 #ifde
TXBF_SUPPORT


2309 
UINT
 
	mTxBFCou
;

2310 
COUNTER_TXBF
 
	mTxBFCous
;

2314 
UINT
 
	mFIFOCou
;

2315 
UINT
 
	mDebugFIFOCou
;

2316 
UINT
 
	mDebugTxCou
;

2317 
BOOLEAN
 
	mbDlsIn
;

2322 
UINT
 
	mMchWDSTabIdx
;

2323 
UCHAR
 
	mMaxSu܋dRe
;

2324 
UCHAR
 
	mCuTxRe
;

2325 
UCHAR
 
	mCuTxReIndex
;

2328 #ifde
NEW_RATE_ADAPT_SUPPORT


2329 
UCHAR
 
	mϡReIdx
;

2330 
UCHAR
 
	mwPktsC
;

2331 
BOOLEAN
 
	mrThrdAdj
;

2333 
UCHAR
 
	mmcsGroup
;

2334 
UCHAR
 
	mϡLegMfb
;

2335 
BOOLEAN
 
	misMfbChged
;

2336 
PRTMP_TX_RATE_SWITCH
 
	mLegMfbRS
;

2337 
BOOLEAN
 
	mfLaChgeAccdgMfb
;

2338 
NDIS_SPIN_LOCK
 
	mfLaChgeAccdgMfbLock
;

2340 
BOOLEAN
 
	mtoTxMrq
;

2341 
UCHAR
 
	mmsiToTx
, 
	mmrqC
;

2343 
UCHAR
 
	mndgMfsi
;

2345 
BOOLEAN
 
	mtoTxMfb
;

2346 
UCHAR
 
	mmfbToTx
;

2347 #ifde
TXBF_SUPPORT


2348 
UCHAR
 
	mTxSndgTy
;

2349 
UCHAR
 
	mTxSndgBW
;

2350 
UCHAR
 
	mTxSndgMcs
;

2351 
NDIS_SPIN_LOCK
 
	mTxSndgLock
;

2355 
UCHAR
 
	mbfS
;

2356 
UCHAR
 
	mbeMhod
;

2357 
UCHAR
 
	mmfb0
, 
	mmfb1
;

2359 
BOOLEAN
 
	mtoTxSndg
;

2360 
UCHAR
 
	mdgMcs
;

2361 
UCHAR
 
	mdgBW
;

2362 
UCHAR
 
	mdgReIdx
;

2363 
BOOLEAN
 
	mndpSndg
;

2364 
UCHAR
 
	mdg0Mcs
, 
	mbf0Mcs
, 
	mdg0ReIdx
, 
	mbf0ReIdx
;

2365 
INT
 
	mdg0S0
, 
	mdg0S1
, 
	mdg0S2
;

2366 
UCHAR
 
	mdg1Mcs
, 
	mbf1Mcs
, 
	mdg1ReIdx
, 
	mbf1ReIdx
;

2367 
INT
 
	mdg1S0
, 
	mdg1S1
, 
	mdg1S2
;

2368 
UCHAR
 
	mnoSndgC
;

2369 
UCHAR
 
	meTxBfEnCd
, 
	mnoSndgCThrd
, 
	mndpSndgSms
;

2370 
BOOLEAN
 
	muNewReAdt
;

2374 
USHORT
 
	mTxQuy
[
MAX_STEP_OF_TX_RATE_SWITCH
];

2376 
UINT32
 
	mOSecTxNoRryOkCou
;

2377 
UINT32
 
	mOSecTxRryOkCou
;

2378 
UINT32
 
	mOSecTxFaCou
;

2379 
UINT32
 
	mCtueTxFaC
;

2380 
UINT32
 
	mCuTxReSbTime
;

2381 
UCHAR
 
	mTxReUpPty
;

2382 #ifde
WDS_SUPPORT


2383 
BOOLEAN
 
	mLockEryTx
;

2385 
ULONG
 
	mTimeSmp_toTxRg
;

2391 #ifde
CONFIG_STA_SUPPORT


2392 #ifde
QOS_DLS_SUPPORT


2393 
UINT
 
	mMchDlsEryIdx
;

2397 
BOOLEAN
 
	mfLaSecAccdgRSSI
;

2398 
UCHAR
 
	mLaSecTxReChgeAi
;

2399 
CHAR
 
	mLaTimeTxReChgeAi
;

2400 
ULONG
 
	mLaTxOkCou
;

2401 
UCHAR
 
	mPER
[
MAX_STEP_OF_TX_RATE_SWITCH
];

2407 
ULONG
 
	mClStusFgs
;

2409 
HTTRANSMIT_SETTING
 
	mHTPhyMode
, 
	mMaxHTPhyMode
, 
	mMHTPhyMode
;

2411 #ifde
DOT11_N_SUPPORT


2413 
USHORT
 
	mRXBAbm
;

2414 
USHORT
 
	mTXBAbm
;

2415 
USHORT
 
	mTXAutoBAbm
;

2416 
USHORT
 
	mBADeeBm
;

2417 
USHORT
 
	mBARecWcidAay
[
NUM_OF_TID
];

2418 
USHORT
 
	mBAOriWcidAay
[
NUM_OF_TID
];

2419 
USHORT
 
	mBAOriSequ
[
NUM_OF_TID
];

2422 
UCHAR
 
	mMpduDsy
;

2423 
UCHAR
 
	mMaxRAmpduFa
;

2424 
UCHAR
 
	mAMsduSize
;

2425 
UCHAR
 
	mMmpsMode
;

2427 
HT_CAPABILITY_IE
 
	mHTCaby
;

2429 #ifde
DOT11N_DRAFT3


2430 
UCHAR
 
	mBSS2040CxiMgmtSut
;

2431 
BOOLEAN
 
	mbFty_Mhz_Iޔt
;

2436 
BOOLEAN
 
	mbAutoTxReSwch
;

2438 
UCHAR
 
	mReL
;

2439 
_MAC_TABLE_ENTRY
 *
	mpNext
;

2440 
USHORT
 
	mTxSeq
[
NUM_OF_TID
];

2441 
USHORT
 
	mNQosDaSeq
;

2443 
RSSI_SAMPLE
 
	mRssiSame
;

2444 
UINT32
 
	mLaRxRe
;

2447 
BOOLEAN
 
	mbWscCab
;

2448 
UCHAR
 
	mReive_ES_ERId
;

2450 
UINT32
 
	mTXMCSExed
[
MAX_MCS_SET
];

2451 
UINT32
 
	mTXMCSSucssful
[
MAX_MCS_SET
];

2452 
UINT32
 
	mTXMCSFaed
[
MAX_MCS_SET
];

2453 
UINT32
 
	mTXMCSAutoFlBack
[
MAX_MCS_SET
][MAX_MCS_SET];

2455 #ifde
CONFIG_STA_SUPPORT


2456 
ULONG
 
	mLaBcRxTime
;

2461 
ULONG
 
	mAssocDdLe
;

2466 
ULONG
 
	mChlQuy
;

2471 #ifde
VENDOR_FEATURE1_SUPPORT


2473 
UINT32
 
	mHdBuf
[32];

2475 
UCHAR
 
	mHdrPadL
;

2476 
UCHAR
 
	mMpduHdL
;

2477 
UINT16
 
	mProc
;

2483 } 
	tMAC_TABLE_ENTRY
, *
	tPMAC_TABLE_ENTRY
;

2485 
	s_MAC_TABLE
 {

2486 
USHORT
 
	mSize
;

2487 
MAC_TABLE_ENTRY
 *
	mHash
[
HASH_TABLE_SIZE
];

2488 
MAC_TABLE_ENTRY
 
	mCڋ
[
MAX_LEN_OF_MAC_TABLE
];

2489 
QUEUE_HEADER
 
	mMPsQueue
;

2490 
ULONG
 
	mPsQIdCou
;

2491 
BOOLEAN
 
	mfAnyStiInPsm
;

2492 
BOOLEAN
 
	mfAnyStiBadAthos
;

2493 
BOOLEAN
 
	mfAnyTxOPFDib
;

2494 
BOOLEAN
 
	mfAStiAsRk
;

2495 #ifde
DOT11_N_SUPPORT


2496 
BOOLEAN
 
	mfAnyStiIsLegacy
;

2497 
BOOLEAN
 
	mfAnyStiNGF
;

2498 
BOOLEAN
 
	mfAnySti20Oy
;

2499 
BOOLEAN
 
	mfAnyStiMIMOPSDymic
;

2500 
BOOLEAN
 
	mfAnyBASessi
;

2501 
BOOLEAN
 
	mfAnySFtyIޔt
;

2506 } 
	tMAC_TABLE
, *
	tPMAC_TABLE
;

2511 #ifde
BLOCK_NET_IF


2512 
	s_BLOCK_QUEUE_ENTRY


2514 
BOOLEAN
 
	mSwTxQueueBlockFg
;

2515 
LIST_HEADER
 
	mNIfLi
;

2516 } 
	tBLOCK_QUEUE_ENTRY
, *
	tPBLOCK_QUEUE_ENTRY
;

2520 
	swificf


2522 
BOOLEAN
 
	mbShtGI
;

2523 
BOOLEAN
 
	mbGFld
;

2527 
	s_RTMP_DEV_INFO_


2529 
UCHAR
 
	mchName
[16];

2530 
RTMP_INF_TYPE
 
	mfTy
;

2531 }
	tRTMP_DEV_INFO
;

2534 #ifde
DBG_DIAGNOSE


2535 
	#DIAGNOSE_TIME
 10

2536 
	s_RtmpDgScut_


	)

2538 
	med
;

2539 
	mqIdx
;

2540 
	mAaySIdx
;

2541 
	mAayCurIdx
;

2543 
USHORT
 
	mTxDaC
[
DIAGNOSE_TIME
];

2544 
USHORT
 
	mTxFaC
[
DIAGNOSE_TIME
];

2546 
USHORT
 
	mTxDescC
[
DIAGNOSE_TIME
][24];

2548 
USHORT
 
	mTxMcsC
[
DIAGNOSE_TIME
][
MAX_MCS_SET
];

2549 
USHORT
 
	mTxSWQueC
[
DIAGNOSE_TIME
][9];

2551 
USHORT
 
	mTxAggC
[
DIAGNOSE_TIME
];

2552 
USHORT
 
	mTxNAggC
[
DIAGNOSE_TIME
];

2554 
USHORT
 
	mTxAMPDUC
[
DIAGNOSE_TIME
][
MAX_MCS_SET
];

2555 
USHORT
 
	mTxRkC
[
DIAGNOSE_TIME
];

2556 
USHORT
 
	mTxAMSDUC
[
DIAGNOSE_TIME
];

2559 
USHORT
 
	mRxDaC
[
DIAGNOSE_TIME
];

2560 
USHORT
 
	mRxCrcEC
[
DIAGNOSE_TIME
];

2562 
USHORT
 
	mRxMcsC
[
DIAGNOSE_TIME
][
MAX_MCS_SET
];

2563 }
	tRtmpDgSu
;

2567 
	s_RTMP_CHIP_OP_


2570 (*
	m
)(
RTMP_ADAPTER
 *
	mpAd
);

2571 (*
	mad
)(
RTMP_ADAPTER
 *
	mpAd
, 
USHORT
 
	mofft
, 
PUSHORT
 
	mpVue
);

2572 (*
	mwre
)(
RTMP_ADAPTER
 *
	mpAd
, 
USHORT
 
	mofft
, USHORT 
	mvue
);

2575 (*
	mldFmwe
)(
RTMP_ADAPTER
 *
	mpAd
);

2576 (*
	maFmwe
)(
RTMP_ADAPTER
 *
	mpAd
);

2577 (*
	mndCommdToMcu
)(
RTMP_ADAPTER
 *
	mpAd
, 
UCHAR
 
	mcmd
, UCHAR 
	mtok
, UCHAR 
	mg0
, UCHAR 
	mg1
);

2580 
REG_PAIR
 *
	mpRFRegTab
;

2581 
REG_PAIR
 *
	mpBBPRegTab
;

2582 
UCHAR
 
	mbbpRegTbSize
;

2583 (*
	mAsicRfIn
)(
RTMP_ADAPTER
 *
	mpAd
);

2584 (*
	mAsicRfTuOn
)(
RTMP_ADAPTER
 *
	mpAd
);

2585 (*
	mAsicRfTuOff
)(
RTMP_ADAPTER
 *
	mpAd
);

2586 (*
	mAsicRevRfFromS˕Mode
)(
RTMP_ADAPTER
 *
	mpAd
);

2587 (*
	mAsicHtAi
)(
RTMP_ADAPTER
 *
	mpAd
);

2590 #ifde
RTMP_INTERNAL_TX_ALC


2594 
	s_TX_POWER_CONTROL


2596 
BOOLEAN
 
	mbIlTxALC
;

2598 
CHAR
 
	midxTxPowTab
;

2600 
CHAR
 
	mRF_R12_Vue
;

2601 
CHAR
 
	mMAC_PowD
;

2602 } 
	tTX_POWER_CONTROL
, *
	tPTX_POWER_CONTROL
;

2608 
	s_TX_POWER_CONTROL_OVER_MAC_ENTRY


2610 
USHORT
 
	mMACRegiOfft
;

2611 
ULONG
 
	mRegiVue
;

2612 } 
	tTX_POWER_CONTROL_OVER_MAC_ENTRY
, *
	tPTX_POWER_CONTROL_OVER_MAC_ENTRY
;

2617 
	#MAX_TX_PWR_CONTROL_OVER_MAC_REGISTERS
 5

	)

2624 
	s_CONFIGURATION_OF_TX_POWER_CONTROL_OVER_MAC


2626 
UCHAR
 
	mNumOfErs
;

2627 
TX_POWER_CONTROL_OVER_MAC_ENTRY
 
	mTxPwrClOvMAC
[
MAX_TX_PWR_CONTROL_OVER_MAC_REGISTERS
];

2628 } 
	tCONFIGURATION_OF_TX_POWER_CONTROL_OVER_MAC
, *
	tPCONFIGURATION_OF_TX_POWER_CONTROL_OVER_MAC
;

2633 
	s_TX_POWER_CONTROL_EXT_OVER_MAC


2637 
ULONG
 
	mTxPwrCfg0
;

2638 
ULONG
 
	mTxPwrCfg0Ext
;

2639 
ULONG
 
	mTxPwrCfg1
;

2640 
ULONG
 
	mTxPwrCfg1Ext
;

2641 
ULONG
 
	mTxPwrCfg2
;

2642 
ULONG
 
	mTxPwrCfg2Ext
;

2643 
ULONG
 
	mTxPwrCfg3
;

2644 
ULONG
 
	mTxPwrCfg3Ext
;

2645 
ULONG
 
	mTxPwrCfg4
;

2646 
ULONG
 
	mTxPwrCfg4Ext
;

2647 
ULONG
 
	mTxPwrCfg5
;

2648 
ULONG
 
	mTxPwrCfg6
;

2649 
ULONG
 
	mTxPwrCfg7
;

2650 
ULONG
 
	mTxPwrCfg8
;

2651 
ULONG
 
	mTxPwrCfg9
;

2652 } 
	mBW20Ov2D4G
;

2656 
ULONG
 
	mTxPwrCfg0
;

2657 
ULONG
 
	mTxPwrCfg0Ext
;

2658 
ULONG
 
	mTxPwrCfg1
;

2659 
ULONG
 
	mTxPwrCfg1Ext
;

2660 
ULONG
 
	mTxPwrCfg2
;

2661 
ULONG
 
	mTxPwrCfg2Ext
;

2662 
ULONG
 
	mTxPwrCfg3
;

2663 
ULONG
 
	mTxPwrCfg3Ext
;

2664 
ULONG
 
	mTxPwrCfg4
;

2665 
ULONG
 
	mTxPwrCfg4Ext
;

2666 
ULONG
 
	mTxPwrCfg5
;

2667 
ULONG
 
	mTxPwrCfg6
;

2668 
ULONG
 
	mTxPwrCfg7
;

2669 
ULONG
 
	mTxPwrCfg8
;

2670 
ULONG
 
	mTxPwrCfg9
;

2671 } 
	mBW40Ov2D4G
;

2675 
ULONG
 
	mTxPwrCfg0
;

2676 
ULONG
 
	mTxPwrCfg0Ext
;

2677 
ULONG
 
	mTxPwrCfg1
;

2678 
ULONG
 
	mTxPwrCfg1Ext
;

2679 
ULONG
 
	mTxPwrCfg2
;

2680 
ULONG
 
	mTxPwrCfg2Ext
;

2681 
ULONG
 
	mTxPwrCfg3
;

2682 
ULONG
 
	mTxPwrCfg3Ext
;

2683 
ULONG
 
	mTxPwrCfg4
;

2684 
ULONG
 
	mTxPwrCfg4Ext
;

2685 
ULONG
 
	mTxPwrCfg5
;

2686 
ULONG
 
	mTxPwrCfg6
;

2687 
ULONG
 
	mTxPwrCfg7
;

2688 
ULONG
 
	mTxPwrCfg8
;

2689 
ULONG
 
	mTxPwrCfg9
;

2690 } 
	mBW20Ov5G
;

2694 
ULONG
 
	mTxPwrCfg0
;

2695 
ULONG
 
	mTxPwrCfg0Ext
;

2696 
ULONG
 
	mTxPwrCfg1
;

2697 
ULONG
 
	mTxPwrCfg1Ext
;

2698 
ULONG
 
	mTxPwrCfg2
;

2699 
ULONG
 
	mTxPwrCfg2Ext
;

2700 
ULONG
 
	mTxPwrCfg3
;

2701 
ULONG
 
	mTxPwrCfg3Ext
;

2702 
ULONG
 
	mTxPwrCfg4
;

2703 
ULONG
 
	mTxPwrCfg4Ext
;

2704 
ULONG
 
	mTxPwrCfg5
;

2705 
ULONG
 
	mTxPwrCfg6
;

2706 
ULONG
 
	mTxPwrCfg7
;

2707 
ULONG
 
	mTxPwrCfg8
;

2708 
ULONG
 
	mTxPwrCfg9
;

2709 } 
	mBW40Ov5G
;

2710 } 
	tTX_POWER_CONTROL_EXT_OVER_MAC
, *
	tPTX_POWER_CONTROL_EXT_OVER_MAC
;

2715 
	s_RTMP_ADAPTER


2717 
PVOID
 
	mOS_Cook
;

2718 
PNET_DEV
 
	mt_dev
;

2719 
ULONG
 
	mVtuIfC
;

2721 
RTMP_CHIP_OP
 
	mchOps
;

2723 #ifde
CONFIG_STA_SUPPORT


2724 
USHORT
 
	mThisTbNumToNextWakeUp
;

2727 #ifde
HOSTAPD_SUPPORT


2728 
UINT32
 
	mIolIF
;

2730 #ifde
INF_PPA_SUPPORT


2731 
UINT32
 
	mg_if_id
;

2732 
BOOLEAN
 
	mPPAEb
;

2733 
PPA_DIRECTPATH_CB
 *
	mpDethCb
;

2736 #ifde
RTMP_MAC_PCI


2740 
PUCHAR
 
	mCSRBaAddss
;

2741 
	mq_num
;

2742 #ifde
CONFIG_STA_SUPPORT


2743 
USHORT
 
	mLnkClBMask
;

2744 
USHORT
 
	mRLnkClCfiguti
;

2745 
USHORT
 
	mRLnkClOfft
;

2746 
USHORT
 
	mHoLnkClCfiguti
;

2747 
USHORT
 
	mHoLnkClOfft
;

2748 
USHORT
 
	mPCIePowSaveLev
;

2749 
ULONG
 
	mRt3xxHoLkCl
;

2750 
ULONG
 
	mRt3xxRkLkCl
;

2752 
USHORT
 
	mDeviID
;

2753 
ULONG
 
	mAcssBBPFaCou
;

2754 
BOOLEAN
 
	mbPCIkOff
;

2755 
BOOLEAN
 
	mbPCIkOffDibTx
;

2757 
BOOLEAN
 
	mb30xxBMcuCmd
;

2758 
BOOLEAN
 
	mb3090ESclCh
;

2761 
UINT
 
	mt_ab_g
;

2762 
UINT
 
	mt_dib_mask
;

2763 
UINT
 
	mt_ndg
;

2765 
RTMP_DMABUF
 
	mTxBufS
[
NUM_OF_TX_RING
];

2766 
RTMP_DMABUF
 
	mRxDescRg
;

2767 
RTMP_DMABUF
 
	mTxDescRg
[
NUM_OF_TX_RING
];

2768 
RTMP_TX_RING
 
	mTxRg
[
NUM_OF_TX_RING
];

2772 
NDIS_SPIN_LOCK
 
	mq_lock
;

2773 
UCHAR
 
	mq_dibd
;

2776 
CmdQ
 
	mCmdQ
;

2777 
NDIS_SPIN_LOCK
 
	mCmdQLock
;

2778 
RTMP_OS_TASK
 
	mcmdQTask
;

2790 
RTMP_INF_TYPE
 
	mfTy
;

2795 
RTMP_OS_TASK
 
	mmlmeTask
;

2796 #ifde
RTMP_TIMER_TASK_SUPPORT


2798 
RTMP_TIMER_TASK_QUEUE
 
	mTimQ
;

2799 
NDIS_SPIN_LOCK
 
	mTimQLock
;

2800 
RTMP_OS_TASK
 
	mtimTask
;

2807 
BOOLEAN
 
	mDeQueueRug
[
NUM_OF_TX_RING
];

2808 
NDIS_SPIN_LOCK
 
	mDeQueueLock
[
NUM_OF_TX_RING
];

2812 
QUEUE_HEADER
 
	mTxSwQueue
[
NUM_OF_TX_RING
];

2813 
NDIS_SPIN_LOCK
 
	mTxSwQueueLock
[
NUM_OF_TX_RING
];

2815 
RTMP_DMABUF
 
	mMgmtDescRg
;

2816 
RTMP_MGMT_RING
 
	mMgmtRg
;

2817 
NDIS_SPIN_LOCK
 
	mMgmtRgLock
;

2819 
UCHAR
 
	mLaMCUCmd
;

2825 #ifde
RTMP_MAC_PCI


2826 
RTMP_RX_RING
 
	mRxRg
;

2827 
NDIS_SPIN_LOCK
 
	mRxRgLock
;

2835 
UINT32
 
	mMACVsi
;

2840 
ULONG
 
	mEromVsi
;

2841 
ULONG
 
	mFmweVsi
;

2842 
USHORT
 
	mEEPROMDeuVue
[
NUM_EEPROM_BBP_PARMS
];

2843 
UCHAR
 
	mEEPROMAddssNum
;

2844 
BOOLEAN
 
	mEromAcss
;

2845 
UCHAR
 
	mEFuTag
;

2851 
UCHAR
 
	mBbpWreLch
[140];

2852 
CHAR
 
	mBbpRssiToDbmD
;

2853 
BBP_R66_TUNING
 
	mBbpTung
;

2858 
UCHAR
 
	mRfIcTy
;

2859 
ULONG
 
	mRfFqOfft
;

2861 #ifde
RTMP_MAC_PCI


2862 
UCHAR
 
	mShowRf
;

2865 
RTMP_RF_REGS
 
	mLchRfRegs
;

2867 
EEPROM_ANTENNA_STRUC
 
	mA
;

2868 
EEPROM_NIC_CONFIG2_STRUC
 
	mNicCfig2
;

2872 
SOFT_RX_ANT_DIVERSITY
 
	mRxA
;

2874 
CHANNEL_TX_POWER
 
	mTxPow
[
MAX_NUM_OF_CHANNELS
];

2875 
CHANNEL_TX_POWER
 
	mChlLi
[
MAX_NUM_OF_CHANNELS
];

2878 
UCHAR
 
	mChlLiNum
;

2879 
UCHAR
 
	mBbp94
;

2880 
BOOLEAN
 
	mBbpFCCK
;

2881 
ULONG
 
	mTx20MPwrCfgABd
[
MAX_TXPOWER_ARRAY_SIZE
];

2882 
ULONG
 
	mTx20MPwrCfgGBd
[
MAX_TXPOWER_ARRAY_SIZE
];

2883 
ULONG
 
	mTx40MPwrCfgABd
[
MAX_TXPOWER_ARRAY_SIZE
];

2884 
ULONG
 
	mTx40MPwrCfgGBd
[
MAX_TXPOWER_ARRAY_SIZE
];

2888 
BOOLEAN
 
	mbAutoTxAgcA
;

2889 
UCHAR
 
	mTssiRefA
;

2890 
UCHAR
 
	mTssiPlusBoundyA
[5];

2891 
UCHAR
 
	mTssiMusBoundyA
[5];

2892 
UCHAR
 
	mTxAgcSpA
;

2893 
CHAR
 
	mTxAgcComnA
;

2895 
BOOLEAN
 
	mbAutoTxAgcG
;

2896 
UCHAR
 
	mTssiRefG
;

2897 
UCHAR
 
	mTssiPlusBoundyG
[5];

2898 
UCHAR
 
	mTssiMusBoundyG
[5];

2899 
UCHAR
 
	mTxAgcSpG
;

2900 
CHAR
 
	mTxAgcComnG
;

2901 #ifde
RTMP_INTERNAL_TX_ALC


2902 
TX_POWER_CONTROL
 
	mTxPowCl
;

2906 sigd 
	mBGRssiOfft0
;

2907 sigd 
	mBGRssiOfft1
;

2908 sigd 
	mBGRssiOfft2
;

2910 sigd 
	mARssiOfft0
;

2911 sigd 
	mARssiOfft1
;

2912 sigd 
	mARssiOfft2
;

2914 
CHAR
 
	mBLNAGa
;

2915 
CHAR
 
	mALNAGa0
;

2916 
CHAR
 
	mALNAGa1
;

2917 
CHAR
 
	mALNAGa2
;

2921 
MCU_LEDCS_STRUC
 
	mLedCl
;

2922 
USHORT
 
	mLed1
;

2923 
USHORT
 
	mLed2
;

2924 
USHORT
 
	mLed3
;

2925 
UCHAR
 
	mLedInditSgth
;

2926 
UCHAR
 
	mRssiSgngthOft
;

2927 
BOOLEAN
 
	mbLedOnSg
;

2928 
UCHAR
 
	mLedStus
;

2933 #ifde
SPECIFIC_BCN_BUF_SUPPORT


2934 
UCHAR
 
	mShrMS
;

2935 
NDIS_SPIN_LOCK
 
	mShrMemLock
;

2942 
TXWI_STRUC
 
	mBcTxWI
;

2943 
PUCHAR
 
	mBcBuf
;

2944 
USHORT
 
	mBcOfft
[
HW_BEACON_MAX_COUNT
];

2947 #ifde
CONFIG_STA_SUPPORT


2948 
PSPOLL_FRAME
 
	mPsPlFme
;

2950 
HEADER_802_11
 
	mNuFme
;

2959 #ifde
CONFIG_STA_SUPPORT


2964 
STA_ADMIN_CONFIG
 
	mSCfg
;

2965 
STA_ACTIVE_CONFIG
 
	mSAive
;

2966 
CHAR
 
	mnickme
[
IW_ESSID_MAX_SIZE
+1];

2967 
NDIS_MEDIA_STATE
 
	mPMedS
;

2972 
UCHAR
 
	mOpMode
;

2974 
NDIS_MEDIA_STATE
 
	mIndiMedS
;

2982 
BOOLEAN
 
	mbLolAdmMAC
;

2983 
UCHAR
 
	mPmtAddss
[
MAC_ADDR_LEN
];

2984 
UCHAR
 
	mCutAddss
[
MAC_ADDR_LEN
];

2989 
COMMON_CONFIG
 
	mCommCfg
;

2990 
MLME_STRUCT
 
	mMlme
;

2993 
MLME_AUX
 
	mMlmeAux
;

2994 #i
defed
(
AP_SCAN_SUPPORT
|| defed(
CONFIG_STA_SUPPORT
)

2995 
BSS_TABLE
 
	mSnTab
;

2999 
MAC_TABLE
 
	mMacTab
;

3000 
NDIS_SPIN_LOCK
 
	mMacTabLock
;

3002 #ifde
DOT11_N_SUPPORT


3003 
BA_TABLE
 
	mBATab
;

3004 
NDIS_SPIN_LOCK
 
	mBATabLock
;

3005 
RALINK_TIMER_STRUCT
 
	mRECBATim
;

3009 
CIPHER_KEY
 
	mShedKey
[
MAX_MBSSID_NUM
][4];

3012 
FRAGMENT_FRAME
 
	mFgFme
;

3015 
COUNTER_802_3
 
	mCous8023
;

3016 
COUNTER_802_11
 
	mWnCous
;

3017 
COUNTER_RALINK
 
	mRkCous
;

3018 
COUNTER_DRS
 
	mDrsCous
;

3019 
PRIVATE_STRUC
 
	mPriveInfo
;

3022 
ULONG
 
	mFgs
;

3023 
ULONG
 
	mPSFgs
;

3024 
ULONG
 
	mMeFgs
;

3027 
USHORT
 
	mSequ
;

3031 
ULONG
 
	mLkDownTime
;

3033 
ULONG
 
	mLaRxRe
;

3034 
ULONG
 
	mLaTxRe
;

3036 
BOOLEAN
 
	mbCfigChged
;

3039 
ULONG
 
	mExaInfo
;

3040 
ULONG
 
	mSyemEBm
;

3043 
ULONG
 
	mMacIcVsi
;

3046 #ifde
SYSTEM_LOG_SUPPORT


3050 
RT_802_11_EVENT_TABLE
 
	mEvtTab
;

3054 
BOOLEAN
 
	mHTCEb
;

3060 
BOOLEAN
 
	mbUpdeBCDe
;

3062 
ULONG
 
	mmacwd
;

3067 
BOOLEAN
 
	mbPromiscuous
;

3078 
BOOLEAN
 
	mbLkAdt
;

3079 
BOOLEAN
 
	mbFPrtTX
;

3080 
BOOLEAN
 
	mbFPrtRX
;

3082 
BOOLEAN
 
	mbSFifoTe
;

3083 
BOOLEAN
 
	mbPreiTe
;

3084 
BOOLEAN
 
	mbHCCATe
;

3085 
BOOLEAN
 
	mbGOHCCA
;

3086 
BOOLEAN
 
	mbBrdComHT
;

3088 
ULONG
 
	mBulkOutReq
;

3089 
ULONG
 
	mBulkOutCome
;

3090 
ULONG
 
	mBulkOutComeOth
;

3091 
ULONG
 
	mBulkOutComeCl
;

3092 
ULONG
 
	mBulkInReq
;

3093 
ULONG
 
	mBulkInCome
;

3094 
ULONG
 
	mBulkInComeFa
;

3097 
wificf
 
	mWIFIbed
;

3099 #ifde
RALINK_ATE


3100 
ATE_INFO
 
	me
;

3103 #ifde
DOT11_N_SUPPORT


3104 
dg_mpdu_po
 
	mmpdu_blk_po
;

3108 #ifde
LINUX


3109 #i
WIRELESS_EXT
 >= 12

3110 
iw_iics
 
	miw_s
;

3113 
t_devi_s
 
	ms
;

3116 #ifde
BLOCK_NET_IF


3117 
BLOCK_QUEUE_ENTRY
 
	mblockQueueTab
[
NUM_OF_TX_RING
];

3122 #ifde
MULTIPLE_CARD_SUPPORT


3123 
INT32
 
	mMC_RowID
;

3124 
STRING
 
	mMC_FeName
[256];

3127 
ULONG
 
	mTbTickCou
;

3128 #ifde
PCI_MSI_SUPPORT


3129 
BOOLEAN
 
	mHaveMsi
;

3134 
ULONG
 
	mOSecdnBEcks
;

3135 
UCHAR
 
	mis_
;

3138 
	#TIME_BASE
 (1000000/
OS_HZ
)

	)

3139 
	#TIME_ONE_SECOND
 (1000000/
TIME_BASE
)

	)

3140 
UCHAR
 
	mg_be_adju
;

3141 
ULONG
 
	mbe_adju_ϡ_time
;

3143 #ifde
NINTENDO_AP


3144 
NINDO_CTRL_BLOCK
 
	mndo__block
;

3148 #ifde
IKANOS_VX_1X0


3149 
IKANOS_TX_INFO
 
	mIkosTxInfo
;

3150 
IKANOS_TX_INFO
 
	mIkosRxInfo
[
MAX_MBSSID_NUM
 + 
MAX_WDS_ENTRY
 + 
MAX_APCLI_NUM
 + 
MAX_MESH_NUM
];

3154 #ifde
DBG_DIAGNOSE


3155 
RtmpDgSu
 
	mDgSu
;

3159 
UINT8
 
	mFlgCtsEbd
;

3160 
UINT8
 
	mPM_FlgSud
;

3164 #ifde
CONFIG_STA_SUPPORT


3167 
EXT_CAP_INFO_ELEMENT
 
	mExtCInfo
;

3170 #ifde
VENDOR_FEATURE1_SUPPORT


3171 
UCHAR
 
	mFifoUpdeDe
, 
	mFifoUpdeRx
;

3174 #ifde
VENDOR_FEATURE2_SUPPORT


3176 
	#MEM_DBG_PKT_ALLOC_INC
(
_pAd
_pAd->
NumOfPktAoc
 ++

	)

3177 
	#MEM_DBG_PKT_FREE_INC
(
_pAd
_pAd->
NumOfPktFe
 ++

	)

3178 
UINT32
 
	mNumOfPktAoc
, 
	mNumOfPktFe
;

3181 
	#MEM_DBG_PKT_ALLOC_INC
(
_pAd
)

	)

3182 
	#MEM_DBG_PKT_FREE_INC
(
_pAd
)

	)

3185 
	#RFIC_24GHZ
 0x01

	)

3186 
	#RFIC_5GHZ
 0x02

	)

3187 
UINT8
 
	mRFICTy
;

3189 #ifde
LINUX


3190 #ifde
RT_CFG80211_SUPPORT


3191 
VOID
 *
	mpCfgDev
;

3192 
VOID
 *
	mpCfg80211_CB
;

3194 
BOOLEAN
 
	mFlgCfg80211Sg
;

3195 
BOOLEAN
 
	mFlgCfg80211Cg
;

3196 
UCHAR
 
	mCfg80211_Aha2
[2];

3199 
VOID
 (*
CFG80211_Regi
)(

3200 
IN
 
VOID
 *
	mpAd
,

3201 
IN
 
devi
 *
	mpDev
,

3202 
IN
 
t_devi
 *
	mpNDev
);

3204 
	mCFG80211_FUNC_OPS
;

3209 #ifde
OS_ABL_SUPPORT


3212 
INT
 
	mIeL
;

3213 
UCHAR
 *
	mpIe
;

3214 } 
	mProbeReIE
[
MAX_LEN_OF_BSS_TABLE
];

3217 #ifde
RTMP_INTERNAL_TX_ALC


3219 
	s_TX_POWER_TUNING_ENTRY_STRUCT


3221 
CHAR
 
	mRF_R12_Vue
;

3222 
CHAR
 
	mMAC_PowD
;

3223 } 
	tTX_POWER_TUNING_ENTRY_STRUCT
, *
	tPTX_POWER_TUNING_ENTRY_STRUCT
;

3226 
	#TX_POWER_TUNING_ENTRY_OFFSET
 30

	)

3229 
	#LOWERBOUND_TX_POWER_TUNING_ENTRY
 -30

	)

3232 
	#UPPERBOUND_TX_POWER_TUNING_ENTRY
 45

3234 

	)

3235 #ifde
TONE_RADAR_DETECT_SUPPORT


3236 
	#DELAYINTMASK
 0x0013fffb

	)

3237 
	#INTMASK
 0x0013fffb

	)

3238 
	#IndMask
 0x0013fffc

	)

3239 
	#RadI
 0x00100000

	)

3241 
	#DELAYINTMASK
 0x0003fffb

	)

3242 
	#INTMASK
 0x0003fffb

	)

3243 
	#IndMask
 0x0003fffc

	)

3246 
	#RxINT
 0x00000005

3247 
	#TxDaI
 0x000000fa

3248 
	#TxMgmtI
 0x00000102

3249 
	#TxCoht
 0x00020000

3250 
	#RxCoht
 0x00010000

3251 
	#McuCommd
 0x00000200

3252 
	#PTBTTI
 0x00001000

3253 
	#TBTTI
 0x00000800

3254 
	#GPTimeOutI
 0x00008000

3255 
	#AutoWakeupI
 0x00004000

3256 
	#FifoSFuI
 0x00002000

3257 

	)

3262 
	s_RX_BLK_


3265 
RT28XX_RXD_STRUC
 
	mRxD
;

3266 
PRXWI_STRUC
 
	mpRxWI
;

3267 
PHEADER_802_11
 
	mpHd
;

3268 
PNDIS_PACKET
 
	mpRxPack
;

3269 
UCHAR
 *
	mpDa
;

3270 
USHORT
 
	mDaSize
;

3271 
USHORT
 
	mFgs
;

3272 
UCHAR
 
	mUrPriܙy
;

3273 } 
	tRX_BLK
;

3276 
	#RX_BLK_SET_FLAG
(
_pRxBlk
, 
_ag
(_pRxBlk->
Fgs
 |_ag)

	)

3277 
	#RX_BLK_TEST_FLAG
(
_pRxBlk
, 
_ag
(_pRxBlk->
Fgs
 & _ag)

	)

3278 
	#RX_BLK_CLEAR_FLAG
(
_pRxBlk
, 
_ag
(_pRxBlk->
Fgs
 &~(_ag))

	)

3281 
	#fRX_WDS
 0x0001

	)

3282 
	#fRX_AMSDU
 0x0002

	)

3283 
	#fRX_ARALINK
 0x0004

	)

3284 
	#fRX_HTC
 0x0008

	)

3285 
	#fRX_PAD
 0x0010

	)

3286 
	#fRX_AMPDU
 0x0020

	)

3287 
	#fRX_QOS
 0x0040

	)

3288 
	#fRX_INFRA
 0x0080

	)

3289 
	#fRX_EAP
 0x0100

	)

3290 
	#fRX_MESH
 0x0200

	)

3291 
	#fRX_APCLI
 0x0400

	)

3292 
	#fRX_DLS
 0x0800

	)

3293 
	#fRX_WPI
 0x1000

	)

3295 
	#LENGTH_AMSDU_SUBFRAMEHEAD
 14

	)

3296 
	#LENGTH_ARALINK_SUBFRAMEHEAD
 14

	)

3297 
	#LENGTH_ARALINK_HEADER_FIELD
 2

	)

3303 
	#TX_UNKOWN_FRAME
 0x00

	)

3304 
	#TX_MCAST_FRAME
 0x01

	)

3305 
	#TX_LEGACY_FRAME
 0x02

	)

3306 
	#TX_AMPDU_FRAME
 0x04

	)

3307 
	#TX_AMSDU_FRAME
 0x08

	)

3308 
	#TX_RALINK_FRAME
 0x10

	)

3309 
	#TX_FRAG_FRAME
 0x20

	)

3313 
	s_TX_BLK_


3315 
UCHAR
 
	mQueIdx
;

3316 
UCHAR
 
	mTxFmeTy
;

3317 
UCHAR
 
	mTٮFmeNum
;

3318 
USHORT
 
	mTٮFgNum
;

3319 
USHORT
 
	mTٮFmeL
;

3321 
QUEUE_HEADER
 
	mTxPackLi
;

3322 
MAC_TABLE_ENTRY
 *
	mpMacEry
;

3323 
HTTRANSMIT_SETTING
 *
	mpTnsm
;

3326 
PNDIS_PACKET
 
	mpPack
;

3327 
PUCHAR
 
	mpSrcBufHd
;

3328 
PUCHAR
 
	mpSrcBufDa
;

3329 
UINT
 
	mSrcBufL
;

3331 
PUCHAR
 
	mpExaLlcSpEnp
;

3332 #ide
VENDOR_FEATURE1_SUPPORT


3341 
UCHAR
 
	mHdBuf
[128];

3343 
UINT32
 
	mHdBufr
[32];

3344 
UCHAR
 *
	mHdBuf
;

3346 
UCHAR
 
	mMpduHdL
;

3347 
UCHAR
 
	mHdrPadL
;

3348 
UCHAR
 
	midx
;

3349 
UCHAR
 
	mWcid
;

3350 
UCHAR
 
	mUrPriܙy
;

3351 
UCHAR
 
	mFmeG
;

3352 
UCHAR
 
	mMpduReqNum
;

3353 
UCHAR
 
	mTxRe
;

3354 
UCHAR
 
	mChAlg
;

3355 
PCIPHER_KEY
 
	mpKey
;

3356 
UCHAR
 
	mKeyIdx
;

3359 
UINT32
 
	mFgs
;

3362 
ULONG
 
	mPriv
;

3365 } 
	tTX_BLK
, *
	tPTX_BLK
;

3368 
	#fTX_bRtsRequed
 0x0001

3369 
	#fTX_bAckRequed
 0x0002

3370 
	#fTX_bPiggyBack
 0x0004

3371 
	#fTX_bHTRe
 0x0008

3372 
	#fTX_bFNQoS
 0x0010

3373 
	#fTX_bAowFg
 0x0020

3374 
	#fTX_bMeDa
 0x0040

3375 
	#fTX_bWMM
 0x0080

3376 
	#fTX_bCˬEAPFme
 0x0100

	)

3378 
	#fTX_bSwEny
 0x0400

3379 

	)

3380 #ifde
CONFIG_STA_SUPPORT


3385 #ifde
CLIENT_WDS


3386 
	#fTX_bClWDSFme
 0x10000

	)

3390 
	#TX_BLK_SET_FLAG
(
_pTxBlk
, 
_ag
(_pTxBlk->
Fgs
 |_ag)

	)

3391 
	#TX_BLK_TEST_FLAG
(
_pTxBlk
, 
_ag
(((_pTxBlk->
Fgs
 & _ag=_ag? 1 : 0)

	)

3392 
	#TX_BLK_CLEAR_FLAG
(
_pTxBlk
, 
_ag
(_pTxBlk->
Fgs
 &~(_ag))

	)

3397 #ifde
RT_BIG_ENDIAN


3419 
le
 
VOID
 
	$RTMPWIEndnChge
(

3420 
IN
 
PUCHAR
 
pDa
,

3421 
IN
 
ULONG
 
DestTy
)

3423 
size
;

3424 
i
;

3426 
size
 = ((
DestTy
 =
TYPE_TXWI
? 
TXWI_SIZE
 : 
RXWI_SIZE
);

3428 if(
DestTy
 =
TYPE_TXWI
)

3430 *((
UINT32
 *)(
pDa
)
	`SWAP32
(*((UINT32 *)(pData)));

3431 *((
UINT32
 *)(
pDa
 + 4)
	`SWAP32
(*((UINT32 *)(pData+4)));

3435 
i
=0; i < 
size
/4 ; i++)

3436 *(((
UINT32
 *)
pDa
+
i

	`SWAP32
(*(((UINT32 *)pData)+i));

3438 
	}
}

3441 #ifde
RTMP_MAC_PCI


3442 
le
 
VOID
 
	$WreBackToDest
(

3443 
IN
 
PUCHAR
 
De
,

3444 
IN
 
PUCHAR
 
Src
,

3445 
IN
 
BOOLEAN
 
DoEny
,

3446 
IN
 
ULONG
 
DestTy
)

3448 
UINT32
 *
p1
, *
p2
;

3450 
p1
 = ((
UINT32
 *)
De
);

3451 
p2
 = ((
UINT32
 *)
Src
);

3453 *
p1
 = *
p2
;

3454 *(
p1
+2*(
p2
+2);

3455 *(
p1
+3*(
p2
+3);

3456 *(
p1
+1*(
p2
+1);

3457 
	}
}

3479 #ifde
RTMP_MAC_PCI


3480 
le
 
VOID
 
	$RTMPDestEndnChge
(

3481 
IN
 
PUCHAR
 
pDa
,

3482 
IN
 
ULONG
 
DestTy
)

3484 *((
UINT32
 *)(
pDa
)
	`SWAP32
(*((UINT32 *)(pData)));

3485 *((
UINT32
 *)(
pDa
 + 8)
	`SWAP32
(*((UINT32 *)(pData+8)));

3486 *((
UINT32
 *)(
pDa
 +12)
	`SWAP32
(*((UINT32 *)(pData + 12)));

3487 *((
UINT32
 *)(
pDa
 + 4)
	`SWAP32
(*((UINT32 *)(pData + 4)));

3488 
	}
}

3510 
le
 
VOID
 
	$RTMPFmeEndnChge
(

3511 
IN
 
PRTMP_ADAPTER
 
pAd
,

3512 
IN
 
PUCHAR
 
pDa
,

3513 
IN
 
ULONG
 
D
,

3514 
IN
 
BOOLEAN
 
FromRxDeI
)

3516 
PHEADER_802_11
 
pFme
;

3517 
PUCHAR
 
pMacHdr
;

3520 if(
D
 =
DIR_READ
)

3522 *(
USHORT
 *)
pDa
 = 
	`SWAP16
(*(USHORT *)pData);

3525 
pFme
 = (
PHEADER_802_11

pDa
;

3526 
pMacHdr
 = (
PUCHAR

pFme
;

3529 *(
USHORT
 *)(
pMacHdr
 + 2
	`SWAP16
(*(USHORT *)(pMacHdr + 2));

3531 i(
pFme
->
FC
.
Ty
 !
BTYPE_CNTL
)

3534 *(
USHORT
 *)(
pMacHdr
 + 22
	`SWAP16
(*(USHORT *)(pMacHdr + 22));

3537 if(
pFme
->
FC
.
Ty
 =
BTYPE_MGMT
)

3539 
pFme
->
FC
.
SubTy
)

3541 
SUBTYPE_ASSOC_REQ
:

3542 
SUBTYPE_REASSOC_REQ
:

3544 
pMacHdr
 +(
HEADER_802_11
);

3545 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3548 
pMacHdr
 += 2;

3549 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3552 
SUBTYPE_ASSOC_RSP
:

3553 
SUBTYPE_REASSOC_RSP
:

3555 
pMacHdr
 +(
HEADER_802_11
);

3556 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3559 
pMacHdr
 += 2;

3560 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3563 
pMacHdr
 += 2;

3564 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3567 
SUBTYPE_AUTH
:

3572 i(
pFme
->
FC
.
W
 == 1)

3577 
pMacHdr
 +(
HEADER_802_11
);

3578 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3581 
pMacHdr
 += 2;

3582 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3585 
pMacHdr
 += 2;

3586 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3590 
SUBTYPE_BEACON
:

3591 
SUBTYPE_PROBE_RSP
:

3593 
pMacHdr
 +((
HEADER_802_11
+ 
TIMESTAMP_LEN
);

3594 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3597 
pMacHdr
 +(
USHORT
);

3598 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3601 
SUBTYPE_DEAUTH
:

3602 
SUBTYPE_DISASSOC
:

3604 if(!
FromRxDeI
 && 
pFme
->
FC
.
W
 == 1)

3609 
pMacHdr
 +(
HEADER_802_11
);

3610 *(
USHORT
 *)
pMacHdr
 = 
	`SWAP16
(*(USHORT *)pMacHdr);

3615 if
pFme
->
FC
.
Ty
 =
BTYPE_DATA
 )

3618 if(
pFme
->
FC
.
Ty
 =
BTYPE_CNTL
)

3620 
pFme
->
FC
.
SubTy
)

3622 
SUBTYPE_BLOCK_ACK_REQ
:

3624 
PFRAME_BA_REQ
 
pBAReq
 = (PFRAME_BA_REQ)
pFme
;

3625 *(
USHORT
 *)(&
pBAReq
->
BARCڌ

	`SWAP16
(*(USHORT *)(&pBAReq->BARControl));

3626 
pBAReq
->
BASgSeq
.
wd
 = 
	`SWAP16
(pBAReq->BAStartingSeq.word);

3629 
SUBTYPE_BLOCK_ACK
:

3631 *(
UINT32
 *)(&
pFme
->
Addr3
[0]
	`SWAP32
(*(UINT32 *)(&pFrame->Addr3[0]));

3634 
SUBTYPE_ACK
:

3636 *(
UINT32
 *)(&
pFme
->
Addr2
[0])
	`SWAP32
(*(UINT32 *)(&pFrame->Addr2[0]));

3642 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("Invalid Frame Type!!!\n"));

3646 if(
D
 =
DIR_WRITE
)

3648 *(
USHORT
 *)
pDa
 = 
	`SWAP16
(*(USHORT *)pData);

3650 
	}
}

3657 
le
 
VOID
 
	$CvtMuiIP2MAC
(

3658 
IN
 
PUCHAR
 
pIpAddr
,

3659 
IN
 
PUCHAR
 *
MacAddr
,

3660 
IN
 
UINT16
 
ProTy
)

3662 i(
pIpAddr
 =
NULL
)

3665 i(
MacAddr
 =
NULL
 || *ppMacAddr == NULL)

3668 
ProTy
)

3670 
ETH_P_IPV6
:

3672 *(*
MacAddr
) = 0x33;

3673 *(*
MacAddr
 + 1) = 0x33;

3674 *(*
MacAddr
 + 2
pIpAddr
[12];

3675 *(*
MacAddr
 + 3
pIpAddr
[13];

3676 *(*
MacAddr
 + 4
pIpAddr
[14];

3677 *(*
MacAddr
 + 5
pIpAddr
[15];

3680 
ETH_P_IP
:

3683 *(*
MacAddr
) = 0x01;

3684 *(*
MacAddr
 + 1) = 0x00;

3685 *(*
MacAddr
 + 2) = 0x5e;

3686 *(*
MacAddr
 + 3
pIpAddr
[1] & 0x7f;

3687 *(*
MacAddr
 + 4
pIpAddr
[2];

3688 *(*
MacAddr
 + 5
pIpAddr
[3];

3693 
	}
}

3696 *
GPhyMode
(
Mode
);

3697 * 
GBW
(
BW
);

3701 
BOOLEAN
 
RTMPCheckFHg
(

3702 
IN
 
NDIS_HANDLE
 
MtAdrCڋxt
);

3707 
NDIS_STATUS
 
RTMPAocAdrBlock
(

3708 
IN
 
PVOID
 
hd
,

3709 
OUT
 
PRTMP_ADAPTER
 *
Adr
);

3711 
NDIS_STATUS
 
RTMPAocTxRxRgMemy
(

3712 
IN
 
PRTMP_ADAPTER
 
pAd
);

3714 #ifde
RESOURCE_PRE_ALLOC


3715 
NDIS_STATUS
 
RTMPInTxRxRgMemy
(

3716 
IN
 
RTMP_ADAPTER
 *
pAd
);

3719 
NDIS_STATUS
 
RTMPRdPamsHook
(

3720 
IN
 
PRTMP_ADAPTER
 
pAd
);

3722 
NDIS_STATUS
 
RTMPSProfePams
(

3723 
IN
 
RTMP_ADAPTER
 *
pAd
,

3724 
IN
 
PSTRING
 
pBufr
);

3726 
INT
 
RTMPGKeyPam
(

3727 
IN
 
PSTRING
 
key
,

3728 
OUT
 
PSTRING
 
de
,

3729 
IN
 
INT
 
desize
,

3730 
IN
 
PSTRING
 
bufr
,

3731 
IN
 
BOOLEAN
 
bTrimS
);

3734 
VOID
 
RTMPFeAdr
(

3735 
IN
 
PRTMP_ADAPTER
 
pAd
);

3738 
VOID
 
NICRdEEPROMPams
(

3739 
IN
 
PRTMP_ADAPTER
 
pAd
,

3740 
IN
 
PSTRING
 
mac_addr
);

3742 
VOID
 
NICInAsicFromEEPROM
(

3743 
IN
 
PRTMP_ADAPTER
 
pAd
);

3746 
NDIS_STATUS
 
NICInlizeAdr
(

3747 
IN
 
PRTMP_ADAPTER
 
pAd
,

3748 
IN
 
BOOLEAN
 
bHdRet
);

3750 
NDIS_STATUS
 
NICInlizeAsic
(

3751 
IN
 
PRTMP_ADAPTER
 
pAd
,

3752 
IN
 
BOOLEAN
 
bHdRet
);

3755 
VOID
 
RTMPRgC˪Up
(

3756 
IN
 
PRTMP_ADAPTER
 
pAd
,

3757 
IN
 
UCHAR
 
RgTy
);

3759 
VOID
 
UrCfgEx
(

3760 
IN
 
RTMP_ADAPTER
 *
pAd
);

3762 
VOID
 
UrCfgIn
(

3763 
IN
 
PRTMP_ADAPTER
 
pAd
);

3765 
NDIS_STATUS
 
NICLdFmwe
(

3766 
IN
 
PRTMP_ADAPTER
 
pAd
);

3768 
VOID
 
NICEFmwe
(

3769 
IN
 
PRTMP_ADAPTER
 
pAd
);

3771 
NDIS_STATUS
 
NICLdReSwchgPams
(

3772 
IN
 
PRTMP_ADAPTER
 
pAd
);

3774 
VOID
 
NICUpdeFifoSCous
(

3775 
IN
 
PRTMP_ADAPTER
 
pAd
);

3777 
VOID
 
NICUpdeRawCous
(

3778 
IN
 
PRTMP_ADAPTER
 
pAd
);

3780 
VOID
 
RTMPZoMemy
(

3781 
IN
 
PVOID
 
pSrc
,

3782 
IN
 
ULONG
 
Lgth
);

3784 
ULONG
 
RTMPComMemy
(

3785 
IN
 
PVOID
 
pSrc1
,

3786 
IN
 
PVOID
 
pSrc2
,

3787 
IN
 
ULONG
 
Lgth
);

3789 
VOID
 
RTMPMoveMemy
(

3790 
OUT
 
PVOID
 
pDe
,

3791 
IN
 
PVOID
 
pSrc
,

3792 
IN
 
ULONG
 
Lgth
);

3794 
VOID
 
AtoH
(

3795 
PSTRING
 
c
,

3796 
PUCHAR
 
de
,

3797 
den
);

3799 
UCHAR
 
BtoH
(

3800 
ch
);

3802 
VOID
 
RTMPInTim
(

3803 
IN
 
PRTMP_ADAPTER
 
pAd
,

3804 
IN
 
PRALINK_TIMER_STRUCT
 
pTim
,

3805 
IN
 
PVOID
 
pTimFunc
,

3806 
IN
 
PVOID
 
pDa
,

3807 
IN
 
BOOLEAN
 
Rt
);

3809 
VOID
 
RTMPSTim
(

3810 
IN
 
PRALINK_TIMER_STRUCT
 
pTim
,

3811 
IN
 
ULONG
 
Vue
);

3814 
VOID
 
RTMPModTim
(

3815 
IN
 
PRALINK_TIMER_STRUCT
 
pTim
,

3816 
IN
 
ULONG
 
Vue
);

3818 
VOID
 
RTMPClTim
(

3819 
IN
 
PRALINK_TIMER_STRUCT
 
pTim
,

3820 
OUT
 
BOOLEAN
 *
pCed
);

3822 #ifde
LED_CONTROL_SUPPORT


3823 
VOID
 
RTMPSLED
(

3824 
IN
 
PRTMP_ADAPTER
 
pAd
,

3825 
IN
 
UCHAR
 
Stus
);

3827 
VOID
 
RTMPSSiglLED
(

3828 
IN
 
PRTMP_ADAPTER
 
pAd
,

3829 
IN
 
NDIS_802_11_RSSI
 
Dbm
);

3833 
VOID
 
RTMPEbRxTx
(

3834 
IN
 
PRTMP_ADAPTER
 
pAd
);

3839 
VOID
 
AiSMacheIn
(

3840 
IN
 
PRTMP_ADAPTER
 
pAd
,

3841 
IN
 
STATE_MACHINE
 *
S
,

3842 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[]);

3844 
VOID
 
MlmeADDBAAi
(

3845 
IN
 
PRTMP_ADAPTER
 
pAd
,

3846 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3848 
VOID
 
MlmeDELBAAi
(

3849 
IN
 
PRTMP_ADAPTER
 
pAd
,

3850 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3852 
VOID
 
MlmeDLSAi
(

3853 
IN
 
PRTMP_ADAPTER
 
pAd
,

3854 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3856 
VOID
 
MlmeInvidAi
(

3857 
IN
 
PRTMP_ADAPTER
 
pAd
,

3858 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3860 
VOID
 
MlmeQOSAi
(

3861 
IN
 
PRTMP_ADAPTER
 
pAd
,

3862 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3864 #ifde
DOT11_N_SUPPORT


3865 
VOID
 
PrAddBAReqAi
(

3866 
IN
 
PRTMP_ADAPTER
 
pAd
,

3867 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3869 
VOID
 
PrAddBARAi
(

3870 
IN
 
PRTMP_ADAPTER
 
pAd
,

3871 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3873 
VOID
 
PrDBAAi
(

3874 
IN
 
PRTMP_ADAPTER
 
pAd
,

3875 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3877 
VOID
 
PrBAAi
(

3878 
IN
 
PRTMP_ADAPTER
 
pAd
,

3879 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3882 
VOID
 
SdPSMPAi
(

3883 
IN
 
PRTMP_ADAPTER
 
pAd
,

3884 
IN
 
UCHAR
 
Wcid
,

3885 
IN
 
UCHAR
 
Psmp
);

3888 
VOID
 
PrRMAi
(

3889 
IN
 
PRTMP_ADAPTER
 
pAd
,

3890 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3892 
VOID
 
PrPublicAi
(

3893 
IN
 
PRTMP_ADAPTER
 
pAd
,

3894 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3896 #ifde
CONFIG_STA_SUPPORT


3897 
VOID
 
SPublicAi
(

3898 
IN
 
PRTMP_ADAPTER
 
pAd
,

3899 
IN
 
BSS_2040_COEXIST_IE
 *
pBss2040CxIE
);

3903 
VOID
 
PrBSSTnAi
(

3904 
IN
 
PRTMP_ADAPTER
 
pAd
,

3905 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3907 #ifde
DOT11_N_SUPPORT


3908 
VOID
 
PrHTAi
(

3909 
IN
 
PRTMP_ADAPTER
 
pAd
,

3910 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3913 
VOID
 
PrQOSAi
(

3914 
IN
 
PRTMP_ADAPTER
 
pAd
,

3915 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3917 #ifde
QOS_DLS_SUPPORT


3918 
VOID
 
PrDLSAi
(

3919 
IN
 
PRTMP_ADAPTER
 
pAd
,

3920 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

3923 #ifde
CONFIG_STA_SUPPORT


3924 #ifde
QOS_DLS_SUPPORT


3925 
VOID
 
DlsPmFl
(

3926 
IN
 
PRTMP_ADAPTER
 
pAd
,

3927 
IN
 
OUT
 
MLME_DLS_REQ_STRUCT
 *
pDlsReq
,

3928 
IN
 
PRT_802_11_DLS
 
pDls
,

3929 
IN
 
USHORT
 
as
);

3933 #ifde
DOT11_N_SUPPORT


3934 
VOID
 
RECBATimTimeout
(

3935 
IN
 
PVOID
 
SyemScific1
,

3936 
IN
 
PVOID
 
FuniCڋxt
,

3937 
IN
 
PVOID
 
SyemScific2
,

3938 
IN
 
PVOID
 
SyemScific3
);

3940 
VOID
 
ORIBATimTimeout
(

3941 
IN
 
PRTMP_ADAPTER
 
pAd
);

3943 
VOID
 
SdReeshBAR
(

3944 
IN
 
PRTMP_ADAPTER
 
pAd
,

3945 
IN
 
MAC_TABLE_ENTRY
 *
pEry
);

3947 #ifde
DOT11N_DRAFT3


3948 
VOID
 
RTMP_11N_D3_TimIn
(

3949 
IN
 
PRTMP_ADAPTER
 
pAd
);

3951 
VOID
 
SdBSS2040CxiMgmtAi
(

3952 
IN
 
PRTMP_ADAPTER
 
pAd
,

3953 
IN
 
UCHAR
 
Wcid
,

3954 
IN
 
UCHAR
 
idx
,

3955 
IN
 
UCHAR
 
InfoReq
);

3957 
VOID
 
SdNifyBWAiFme
(

3958 
IN
 
PRTMP_ADAPTER
 
pAd
,

3959 
IN
 
UCHAR
 
Wcid
,

3960 
IN
 
UCHAR
 
idx
);

3962 
BOOLEAN
 
ChlSwchSyCheck
(

3963 
IN
 
PRTMP_ADAPTER
 
pAd
,

3964 
IN
 
UCHAR
 
Wcid
,

3965 
IN
 
UCHAR
 
NewChl
,

3966 
IN
 
UCHAR
 
Secdy
);

3968 
VOID
 
ChlSwchAi
(

3969 
IN
 
PRTMP_ADAPTER
 
pAd
,

3970 
IN
 
UCHAR
 
Wcid
,

3971 
IN
 
UCHAR
 
Chl
,

3972 
IN
 
UCHAR
 
Secdy
);

3974 
ULONG
 
BudIޔtChlR
(

3975 
IN
 
PRTMP_ADAPTER
 
pAd
,

3976 
IN
 
PUCHAR
 
pDe
);

3978 
VOID
 
Upde2040CxiFmeAndNify
(

3979 
IN
 
PRTMP_ADAPTER
 
pAd
,

3980 
IN
 
UCHAR
 
Wcid
,

3981 
IN
 
BOOLEAN
 
bAddIޔtCha
);

3983 
VOID
 
Sd2040CxiAi
(

3984 
IN
 
PRTMP_ADAPTER
 
pAd
,

3985 
IN
 
UCHAR
 
Wcid
,

3986 
IN
 
BOOLEAN
 
bAddIޔtCha
);

3988 
VOID
 
UpdeBssSnPm
(

3989 
IN
 
PRTMP_ADAPTER
 
pAd
,

3990 
IN
 
OVERLAP_BSS_SCAN_IE
 
APBssSn
);

3994 
VOID
 
AHdIn
(

3995 
IN
 
PRTMP_ADAPTER
 
pAd
,

3996 
IN
 
OUT
 
PHEADER_802_11
 
pHdr80211
,

3997 
IN
 
PUCHAR
 
Addr1
,

3998 
IN
 
PUCHAR
 
Addr2
,

3999 
IN
 
PUCHAR
 
Addr3
);

4001 
VOID
 
BHdIn
(

4002 
IN
 
PRTMP_ADAPTER
 
pAd
,

4003 
IN
 
OUT
 
PFRAME_BAR
 
pClB
,

4004 
IN
 
PUCHAR
 
pDA
,

4005 
IN
 
PUCHAR
 
pSA
);

4007 
VOID
 
InAFld
(

4008 
IN
 
PRTMP_ADAPTER
 
pAd
,

4009 
OUT
 
PUCHAR
 
pFmeBuf
,

4010 
OUT
 
PULONG
 
pFmeL
,

4011 
IN
 
UINT8
 
Cegy
,

4012 
IN
 
UINT8
 
ACode
);

4014 
BOOLEAN
 
QosBADaP
(

4015 
IN
 
PRTMP_ADAPTER
 
pAd
,

4016 
IN
 
BOOLEAN
 
bAMSDU
,

4017 
IN
 
PUCHAR
 
p8023Hd
,

4018 
IN
 
UCHAR
 
WCID
,

4019 
IN
 
UCHAR
 
TID
,

4020 
IN
 
USHORT
 
Sequ
,

4021 
IN
 
UCHAR
 
DaOfft
,

4022 
IN
 
USHORT
 
Dasize
,

4023 
IN
 
UINT
 
CurRxIndex
);

4025 #ifde
DOT11_N_SUPPORT


4026 
BOOLEAN
 
ClEnqueueFRecv
(

4027 
IN
 
PRTMP_ADAPTER
 
pAd
,

4028 
IN
 
ULONG
 
Wcid
,

4029 
IN
 
ULONG
 
MsgL
,

4030 
IN
 
PFRAME_BA_REQ
 
pMsg
);

4032 
VOID
 
BaAutoMSwch
(

4033 
IN
 
PRTMP_ADAPTER
 
pAd
);

4036 
VOID
 
HTIOTCheck
(

4037 
IN
 
PRTMP_ADAPTER
 
pAd
,

4038 
IN
 
UCHAR
 
BRecIdx
);

4043 
BOOLEAN
 
RTMPHdTxRgDmaDeIru
(

4044 
IN
 
PRTMP_ADAPTER
 
pAd
,

4045 
IN
 
INT_SOURCE_CSR_STRUC
 
TxRgBm
);

4047 
VOID
 
RTMPHdMgmtRgDmaDeIru
(

4048 
IN
 
PRTMP_ADAPTER
 
pAd
);

4050 
VOID
 
RTMPHdTBTTIru
(

4051 
IN
 
PRTMP_ADAPTER
 
pAd
);

4053 
VOID
 
RTMPHdPTBTTIru
(

4054 
IN
 
PRTMP_ADAPTER
 
pAd
);

4056 
RTMPHdTwakeupIru
(

4057 
IN
 
PRTMP_ADAPTER
 
pAd
);

4059 
VOID
 
RTMPHdRxCohtIru
(

4060 
IN
 
PRTMP_ADAPTER
 
pAd
);

4063 
NDIS_STATUS
 
Sniff2BysFromNdisBufr
(

4064 
IN
 
PNDIS_BUFFER
 
pFBufr
,

4065 
IN
 
UCHAR
 
DesedOfft
,

4066 
OUT
 
PUCHAR
 
pBy0
,

4067 
OUT
 
PUCHAR
 
pBy1
);

4069 
NDIS_STATUS
 
STASdPack
(

4070 
IN
 
PRTMP_ADAPTER
 
pAd
,

4071 
IN
 
PNDIS_PACKET
 
pPack
);

4073 
VOID
 
STASdPacks
(

4074 
IN
 
NDIS_HANDLE
 
MtAdrCڋxt
,

4075 
IN
 
PPNDIS_PACKET
 
PackAay
,

4076 
IN
 
UINT
 
NumbOfPacks
);

4078 
VOID
 
RTMPDeQueuePack
(

4079 
IN
 
PRTMP_ADAPTER
 
pAd
,

4080 
IN
 
BOOLEAN
 
bICڋxt
,

4081 
IN
 
UCHAR
 
QueIdx
,

4082 
IN
 
UCHAR
 
Max_Tx_Packs
);

4084 
NDIS_STATUS
 
RTMPHdTnsm
(

4085 
IN
 
PRTMP_ADAPTER
 
pAd
,

4086 
IN
 
PNDIS_PACKET
 
pPack
,

4087 
IN
 
UCHAR
 
QueIdx
,

4088 
OUT
 
PULONG
 
pFeTXDLe
);

4090 
NDIS_STATUS
 
STAHdTnsm
(

4091 
IN
 
PRTMP_ADAPTER
 
pAd
,

4092 
IN
 
TX_BLK
 *
pTxBlk
,

4093 
IN
 
UCHAR
 
QueIdx
);

4095 
VOID
 
STARxEAPOLFmeIndi
(

4096 
IN
 
PRTMP_ADAPTER
 
pAd
,

4097 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

4098 
IN
 
RX_BLK
 *
pRxBlk
,

4099 
IN
 
UCHAR
 
FromWhichBSSID
);

4101 
NDIS_STATUS
 
RTMPFeTXDReque
(

4102 
IN
 
PRTMP_ADAPTER
 
pAd
,

4103 
IN
 
UCHAR
 
RgTy
,

4104 
IN
 
UCHAR
 
NumbRequed
,

4105 
IN
 
PUCHAR
 
FeNumbIs
);

4107 
NDIS_STATUS
 
MlmeHdTnsm
(

4108 
IN
 
PRTMP_ADAPTER
 
pAd
,

4109 
IN
 
UCHAR
 
QueIdx
,

4110 
IN
 
PNDIS_PACKET
 
pPack
);

4112 
NDIS_STATUS
 
MlmeHdTnsmMgmtRg
(

4113 
IN
 
PRTMP_ADAPTER
 
pAd
,

4114 
IN
 
UCHAR
 
QueIdx
,

4115 
IN
 
PNDIS_PACKET
 
pPack
);

4117 #ifde
RTMP_MAC_PCI


4118 
NDIS_STATUS
 
MlmeHdTnsmTxRg
(

4119 
IN
 
PRTMP_ADAPTER
 
pAd
,

4120 
IN
 
UCHAR
 
QueIdx
,

4121 
IN
 
PNDIS_PACKET
 
pPack
);

4123 
NDIS_STATUS
 
MlmeDaHdTnsm
(

4124 
IN
 
PRTMP_ADAPTER
 
pAd
,

4125 
IN
 
UCHAR
 
QueIdx
,

4126 
IN
 
PNDIS_PACKET
 
pPack
);

4128 
VOID
 
RTMPWreTxDest
(

4129 
IN
 
PRTMP_ADAPTER
 
pAd
,

4130 
IN
 
PTXD_STRUC
 
pTxD
,

4131 
IN
 
BOOLEAN
 
bWIV
,

4132 
IN
 
UCHAR
 
QSEL
);

4135 
USHORT
 
RTMPCcDuti
(

4136 
IN
 
PRTMP_ADAPTER
 
pAd
,

4137 
IN
 
UCHAR
 
Re
,

4138 
IN
 
ULONG
 
Size
);

4140 
VOID
 
RTMPWreTxWI
(

4141 
IN
 
PRTMP_ADAPTER
 
pAd
,

4142 
IN
 
PTXWI_STRUC
 
pTxWI
,

4143 
IN
 
BOOLEAN
 
FRAG
,

4144 
IN
 
BOOLEAN
 
CFACK
,

4145 
IN
 
BOOLEAN
 
InsTimeamp
,

4146 
IN
 
BOOLEAN
 
AMPDU
,

4147 
IN
 
BOOLEAN
 
Ack
,

4148 
IN
 
BOOLEAN
 
NSeq
,

4149 
IN
 
UCHAR
 
BASize
,

4150 
IN
 
UCHAR
 
WCID
,

4151 
IN
 
ULONG
 
Lgth
,

4152 
IN
 
UCHAR
 
PID
,

4153 
IN
 
UCHAR
 
TID
,

4154 
IN
 
UCHAR
 
TxRe
,

4155 
IN
 
UCHAR
 
Txmode
,

4156 
IN
 
BOOLEAN
 
CfAck
,

4157 
IN
 
HTTRANSMIT_SETTING
 *
pTnsm
);

4160 
VOID
 
RTMPWreTxWI_Da
(

4161 
IN
 
PRTMP_ADAPTER
 
pAd
,

4162 
IN
 
OUT
 
PTXWI_STRUC
 
pTxWI
,

4163 
IN
 
TX_BLK
 *
pTxBlk
);

4166 
VOID
 
RTMPWreTxWI_Cache
(

4167 
IN
 
PRTMP_ADAPTER
 
pAd
,

4168 
IN
 
OUT
 
PTXWI_STRUC
 
pTxWI
,

4169 
IN
 
TX_BLK
 *
pTxBlk
);

4171 
VOID
 
RTMPSudMsduTnsmissi
(

4172 
IN
 
PRTMP_ADAPTER
 
pAd
);

4174 
VOID
 
RTMPResumeMsduTnsmissi
(

4175 
IN
 
PRTMP_ADAPTER
 
pAd
);

4177 
NDIS_STATUS
 
MtMMReque
(

4178 
IN
 
PRTMP_ADAPTER
 
pAd
,

4179 
IN
 
UCHAR
 
QueIdx
,

4180 
IN
 
PUCHAR
 
pDa
,

4181 
IN
 
UINT
 
Lgth
);

4183 
VOID
 
RTMPSdNuFme
(

4184 
IN
 
PRTMP_ADAPTER
 
pAd
,

4185 
IN
 
UCHAR
 
TxRe
,

4186 
IN
 
BOOLEAN
 
bQosNu
);

4188 #ifde
CONFIG_STA_SUPPORT


4189 
VOID
 
RTMPRtMicE
(

4190 
IN
 
PRTMP_ADAPTER
 
pAd
,

4191 
IN
 
PCIPHER_KEY
 
pWKey
);

4193 
VOID
 
WMicFauRtFme
(

4194 
IN
 
PRTMP_ADAPTER
 
pAd
,

4195 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4197 
VOID
 
WDissocApAndBlockAssoc
(

4198 
IN
 
PVOID
 
SyemScific1
,

4199 
IN
 
PVOID
 
FuniCڋxt
,

4200 
IN
 
PVOID
 
SyemScific2
,

4201 
IN
 
PVOID
 
SyemScific3
);

4203 
VOID
 
WSPawiKeyStg
(

4204 
IN
 
PRTMP_ADAPTER
 
pAd
);

4206 
VOID
 
WSGroupKeyStg
(

4207 
IN
 
PRTMP_ADAPTER
 
pAd
);

4209 
VOID
 
WSdES
(

4210 
IN
 
PRTMP_ADAPTER
 
pAdr
,

4211 
IN
 
PUCHAR
 
pBssid
);

4215 
NDIS_STATUS
 
RTMPAoNdisPack
(

4216 
IN
 
PRTMP_ADAPTER
 
pAd
,

4217 
IN
 
PNDIS_PACKET
 *
pPack
,

4218 
IN
 
PUCHAR
 
pHd
,

4219 
IN
 
UINT
 
HdL
,

4220 
IN
 
PUCHAR
 
pDa
,

4221 
IN
 
UINT
 
DaL
);

4223 
VOID
 
RTMPFeNdisPack
(

4224 
IN
 
PRTMP_ADAPTER
 
pAd
,

4225 
IN
 
PNDIS_PACKET
 
pPack
);

4227 
BOOLEAN
 
RTMPFeTXDUpTxDmaDe
(

4228 
IN
 
PRTMP_ADAPTER
 
pAd
,

4229 
IN
 
UCHAR
 
QueIdx
);

4231 
BOOLEAN
 
RTMPCheckEthTy
(

4232 
IN
 
PRTMP_ADAPTER
 
pAd
,

4233 
IN
 
PNDIS_PACKET
 
pPack
,

4234 
IN
 
PMAC_TABLE_ENTRY
 
pMacEry
,

4235 
OUT
 
PUCHAR
 
pUrPriܙy
,

4236 
OUT
 
PUCHAR
 
pQueIdx
);

4239 
VOID
 
RTMPCckBbpTung
(

4240 
IN
 
PRTMP_ADAPTER
 
pAd
,

4241 
IN
 
UINT
 
TxRe
);

4248 
VOID
 
AsicAdjuTxPow
(

4249 
IN
 
PRTMP_ADAPTER
 
pAd
);

4251 
VOID
 
AsicUpdePre
(

4252 
IN
 
PRTMP_ADAPTER
 
pAd
,

4253 
IN
 
USHORT
 
OiMode
,

4254 
IN
 
UCHAR
 
SMask
,

4255 
IN
 
BOOLEAN
 
bDibBGPre
,

4256 
IN
 
BOOLEAN
 
bNGFExi
);

4258 
VOID
 
AsicBBPAdju
(

4259 
IN
 
RTMP_ADAPTER
 *
pAd
);

4261 
VOID
 
AsicSwchChl
(

4262 
IN
 
PRTMP_ADAPTER
 
pAd
,

4263 
IN
 
UCHAR
 
Chl
,

4264 
IN
 
BOOLEAN
 
bSn
);

4266 
VOID
 
AsicLockChl
(

4267 
IN
 
PRTMP_ADAPTER
 
pAd
,

4268 
IN
 
UCHAR
 
Chl
) ;

4270 
VOID
 
AsicASe
(

4271 
IN
 
PRTMP_ADAPTER
 
pAd
,

4272 
IN
 
UCHAR
 
Chl
);

4274 #ifde
CONFIG_STA_SUPPORT


4276 
VOID
 
AsicRetBBPAgt
(

4277 
IN
 
PRTMP_ADAPTER
 
pAd
);

4279 
VOID
 
AsicS˕ThAutoWakeup
(

4280 
IN
 
PRTMP_ADAPTER
 
pAd
,

4281 
IN
 
USHORT
 
TbNumToNextWakeUp
);

4283 
VOID
 
AsicFS˕
(

4284 
IN
 
PRTMP_ADAPTER
 
pAd
);

4286 
VOID
 
AsicFWakeup
(

4287 
IN
 
PRTMP_ADAPTER
 
pAd
,

4288 
IN
 
BOOLEAN
 
bFromTx
);

4291 
VOID
 
AsicSBssid
(

4292 
IN
 
PRTMP_ADAPTER
 
pAd
,

4293 
IN
 
PUCHAR
 
pBssid
);

4295 
VOID
 
AsicSMWC
(

4296 
IN
 
PRTMP_ADAPTER
 
pAd
);

4299 
VOID
 
AsicDWcidTab
(

4300 
IN
 
PRTMP_ADAPTER
 
pAd
,

4301 
IN
 
UCHAR
 
Wcid
);

4303 #ifde
DOT11_N_SUPPORT


4304 
VOID
 
AsicEbRDG
(

4305 
IN
 
PRTMP_ADAPTER
 
pAd
);

4307 
VOID
 
AsicDibRDG
(

4308 
IN
 
PRTMP_ADAPTER
 
pAd
);

4311 
VOID
 
AsicDibSync
(

4312 
IN
 
PRTMP_ADAPTER
 
pAd
);

4314 
VOID
 
AsicEbBssSync
(

4315 
IN
 
PRTMP_ADAPTER
 
pAd
);

4317 
VOID
 
AsicEbIbssSync
(

4318 
IN
 
PRTMP_ADAPTER
 
pAd
);

4320 
VOID
 
AsicSEdPm
(

4321 
IN
 
PRTMP_ADAPTER
 
pAd
,

4322 
IN
 
PEDCA_PARM
 
pEdPm
);

4324 
VOID
 
AsicSSlTime
(

4325 
IN
 
PRTMP_ADAPTER
 
pAd
,

4326 
IN
 
BOOLEAN
 
bUShtSlTime
);

4338 
VOID
 
AiscUpdeTxChaAddss
(

4339 
IN
 
PRTMP_ADAPTER
 
pAd
,

4340 
IN
 
PUCHAR
 
pMacAddss
);

4342 
VOID
 
AsicAddShedKeyEry
(

4343 
IN
 
PRTMP_ADAPTER
 
pAd
,

4344 
IN
 
UCHAR
 
BssIndex
,

4345 
IN
 
UCHAR
 
KeyIdx
,

4346 
IN
 
PCIPHER_KEY
 
pChKey
);

4348 
VOID
 
AsicRemoveShedKeyEry
(

4349 
IN
 
PRTMP_ADAPTER
 
pAd
,

4350 
IN
 
UCHAR
 
BssIndex
,

4351 
IN
 
UCHAR
 
KeyIdx
);

4353 
VOID
 
AsicUpdeWCIDIVEIV
(

4354 
IN
 
PRTMP_ADAPTER
 
pAd
,

4355 
IN
 
USHORT
 
WCID
,

4356 
IN
 
ULONG
 
uIV
,

4357 
IN
 
ULONG
 
uEIV
);

4359 
VOID
 
AsicUpdeRxWCIDTab
(

4360 
IN
 
PRTMP_ADAPTER
 
pAd
,

4361 
IN
 
USHORT
 
WCID
,

4362 
IN
 
PUCHAR
 
pAddr
);

4364 
VOID
 
AsicUpdeWcidAribuEry
(

4365 
IN
 
PRTMP_ADAPTER
 
pAd
,

4366 
IN
 
UCHAR
 
BssIdx
,

4367 
IN
 
UCHAR
 
KeyIdx
,

4368 
IN
 
UCHAR
 
ChAlg
,

4369 
IN
 
UINT8
 
Wcid
,

4370 
IN
 
UINT8
 
KeyTabFg
);

4372 
VOID
 
AsicAddPawiKeyEry
(

4373 
IN
 
PRTMP_ADAPTER
 
pAd
,

4374 
IN
 
UCHAR
 
WCID
,

4375 
IN
 
PCIPHER_KEY
 
pChKey
);

4377 
VOID
 
AsicRemovePawiKeyEry
(

4378 
IN
 
PRTMP_ADAPTER
 
pAd
,

4379 
IN
 
UCHAR
 
Wcid
);

4381 
BOOLEAN
 
AsicSdCommdToMcu
(

4382 
IN
 
PRTMP_ADAPTER
 
pAd
,

4383 
IN
 
UCHAR
 
Commd
,

4384 
IN
 
UCHAR
 
Tok
,

4385 
IN
 
UCHAR
 
Arg0
,

4386 
IN
 
UCHAR
 
Arg1
);

4389 #ifde
RTMP_MAC_PCI


4390 
BOOLEAN
 
AsicCheckCommOk
(

4391 
IN
 
PRTMP_ADAPTER
 
pAd
,

4392 
IN
 
UCHAR
 
Commd
);

4397 
VOID
 
MacAddrRdomBssid
(

4398 
IN
 
PRTMP_ADAPTER
 
pAd
,

4399 
OUT
 
PUCHAR
 
pAddr
);

4401 
VOID
 
MgtMacHdIn
(

4402 
IN
 
PRTMP_ADAPTER
 
pAd
,

4403 
IN
 
OUT
 
PHEADER_802_11
 
pHdr80211
,

4404 
IN
 
UCHAR
 
SubTy
,

4405 
IN
 
UCHAR
 
ToDs
,

4406 
IN
 
PUCHAR
 
pDA
,

4407 
IN
 
PUCHAR
 
pBssid
);

4409 
VOID
 
MlmeRadioOff
(

4410 
IN
 
PRTMP_ADAPTER
 
pAd
);

4412 
VOID
 
MlmeRadioOn
(

4413 
IN
 
PRTMP_ADAPTER
 
pAd
);

4416 
VOID
 
BssTabIn
(

4417 
IN
 
BSS_TABLE
 *
Tab
);

4419 #ifde
DOT11_N_SUPPORT


4420 
VOID
 
BATabIn
(

4421 
IN
 
PRTMP_ADAPTER
 
pAd
,

4422 
IN
 
BA_TABLE
 *
Tab
);

4424 
VOID
 
BATabEx
(

4425 
IN
 
RTMP_ADAPTER
 *
pAd
);

4428 
ULONG
 
BssTabSrch
(

4429 
IN
 
BSS_TABLE
 *
Tab
,

4430 
IN
 
PUCHAR
 
pBssid
,

4431 
IN
 
UCHAR
 
Chl
);

4433 
ULONG
 
BssSsidTabSrch
(

4434 
IN
 
BSS_TABLE
 *
Tab
,

4435 
IN
 
PUCHAR
 
pBssid
,

4436 
IN
 
PUCHAR
 
pSsid
,

4437 
IN
 
UCHAR
 
SsidL
,

4438 
IN
 
UCHAR
 
Chl
);

4440 
ULONG
 
BssTabSrchWhSSID
(

4441 
IN
 
BSS_TABLE
 *
Tab
,

4442 
IN
 
PUCHAR
 
Bssid
,

4443 
IN
 
PUCHAR
 
pSsid
,

4444 
IN
 
UCHAR
 
SsidL
,

4445 
IN
 
UCHAR
 
Chl
);

4447 
ULONG
 
BssSsidTabSrchBySSID
(

4448 
IN
 
BSS_TABLE
 *
Tab
,

4449 
IN
 
PUCHAR
 
pSsid
,

4450 
IN
 
UCHAR
 
SsidL
);

4452 
VOID
 
BssTabDeEry
(

4453 
IN
 
OUT
 
PBSS_TABLE
 
pTab
,

4454 
IN
 
PUCHAR
 
pBssid
,

4455 
IN
 
UCHAR
 
Chl
);

4457 
VOID
 
BssEryS
(

4458 
IN
 
PRTMP_ADAPTER
 
pAd
,

4459 
OUT
 
PBSS_ENTRY
 
pBss
,

4460 
IN
 
PUCHAR
 
pBssid
,

4461 
IN
 
CHAR
 
Ssid
[],

4462 
IN
 
UCHAR
 
SsidL
,

4463 
IN
 
UCHAR
 
BssTy
,

4464 
IN
 
USHORT
 
BcPiod
,

4465 
IN
 
PCF_PARM
 
CfPm
,

4466 
IN
 
USHORT
 
AtimW
,

4467 
IN
 
USHORT
 
CabyInfo
,

4468 
IN
 
UCHAR
 
SupRe
[],

4469 
IN
 
UCHAR
 
SupReL
,

4470 
IN
 
UCHAR
 
ExtRe
[],

4471 
IN
 
UCHAR
 
ExtReL
,

4472 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

4473 
IN
 
ADD_HT_INFO_IE
 *
pAddHtInfo
,

4474 
IN
 
UCHAR
 
HtCabyL
,

4475 
IN
 
UCHAR
 
AddHtInfoL
,

4476 
IN
 
UCHAR
 
NewExtChOfft
,

4477 
IN
 
UCHAR
 
Chl
,

4478 
IN
 
CHAR
 
Rssi
,

4479 
IN
 
LARGE_INTEGER
 
TimeSmp
,

4480 
IN
 
UCHAR
 
CkFg
,

4481 
IN
 
PEDCA_PARM
 
pEdPm
,

4482 
IN
 
PQOS_CAPABILITY_PARM
 
pQosCaby
,

4483 
IN
 
PQBSS_LOAD_PARM
 
pQbssLd
,

4484 
IN
 
USHORT
 
LgthVIE
,

4485 
IN
 
PNDIS_802_11_VARIABLE_IEs
 
pVIE
);

4487 
ULONG
 
BssTabSEry
(

4488 
IN
 
PRTMP_ADAPTER
 
pAd
,

4489 
OUT
 
PBSS_TABLE
 
pTab
,

4490 
IN
 
PUCHAR
 
pBssid
,

4491 
IN
 
CHAR
 
Ssid
[],

4492 
IN
 
UCHAR
 
SsidL
,

4493 
IN
 
UCHAR
 
BssTy
,

4494 
IN
 
USHORT
 
BcPiod
,

4495 
IN
 
CF_PARM
 *
CfPm
,

4496 
IN
 
USHORT
 
AtimW
,

4497 
IN
 
USHORT
 
CabyInfo
,

4498 
IN
 
UCHAR
 
SupRe
[],

4499 
IN
 
UCHAR
 
SupReL
,

4500 
IN
 
UCHAR
 
ExtRe
[],

4501 
IN
 
UCHAR
 
ExtReL
,

4502 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

4503 
IN
 
ADD_HT_INFO_IE
 *
pAddHtInfo
,

4504 
IN
 
UCHAR
 
HtCabyL
,

4505 
IN
 
UCHAR
 
AddHtInfoL
,

4506 
IN
 
UCHAR
 
NewExtChOfft
,

4507 
IN
 
UCHAR
 
Chl
,

4508 
IN
 
CHAR
 
Rssi
,

4509 
IN
 
LARGE_INTEGER
 
TimeSmp
,

4510 
IN
 
UCHAR
 
CkFg
,

4511 
IN
 
PEDCA_PARM
 
pEdPm
,

4512 
IN
 
PQOS_CAPABILITY_PARM
 
pQosCaby
,

4513 
IN
 
PQBSS_LOAD_PARM
 
pQbssLd
,

4514 
IN
 
USHORT
 
LgthVIE
,

4515 
IN
 
PNDIS_802_11_VARIABLE_IEs
 
pVIE
);

4517 #ifde
DOT11_N_SUPPORT


4518 
VOID
 
BATabInEry
(

4519 
IN
 
PRTMP_ADAPTER
 
pAd
,

4520 
IN
 
USHORT
 
Aid
,

4521 
IN
 
USHORT
 
TimeOutVue
,

4522 
IN
 
USHORT
 
SgSeq
,

4523 
IN
 
UCHAR
 
TID
,

4524 
IN
 
UCHAR
 
BAWSize
,

4525 
IN
 
UCHAR
 
OrigStus
,

4526 
IN
 
BOOLEAN
 
IsRec
);

4528 #ifde
DOT11N_DRAFT3


4529 
VOID
 
Bss2040CxiTimeOut
(

4530 
IN
 
PVOID
 
SyemScific1
,

4531 
IN
 
PVOID
 
FuniCڋxt
,

4532 
IN
 
PVOID
 
SyemScific2
,

4533 
IN
 
PVOID
 
SyemScific3
);

4536 
VOID
 
TriEvtIn
(

4537 
IN
 
PRTMP_ADAPTER
 
pAd
);

4539 
INT
 
TriEvtTabSEry
(

4540 
IN
 
PRTMP_ADAPTER
 
pAd
,

4541 
OUT
 
TRIGGER_EVENT_TAB
 *
Tab
,

4542 
IN
 
PUCHAR
 
pBssid
,

4543 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

4544 
IN
 
UCHAR
 
HtCabyL
,

4545 
IN
 
UCHAR
 
RegCss
,

4546 
IN
 
UCHAR
 
ChlNo
);

4551 
VOID
 
BssTabSsidSt
(

4552 
IN
 
PRTMP_ADAPTER
 
pAd
,

4553 
OUT
 
BSS_TABLE
 *
OutTab
,

4554 
IN
 
CHAR
 
Ssid
[],

4555 
IN
 
UCHAR
 
SsidL
);

4557 
VOID
 
BssTabStByRssi
(

4558 
IN
 
OUT
 
BSS_TABLE
 *
OutTab
);

4560 
VOID
 
BssChP
(

4561 
IN
 
OUT
 
PBSS_ENTRY
 
pBss
);

4563 
NDIS_STATUS
 
MlmeQueueIn
(

4564 
IN
 
MLME_QUEUE
 *
Queue
);

4566 
VOID
 
MlmeQueueDeroy
(

4567 
IN
 
MLME_QUEUE
 *
Queue
);

4569 
BOOLEAN
 
MlmeEnqueue
(

4570 
IN
 
PRTMP_ADAPTER
 
pAd
,

4571 
IN
 
ULONG
 
Mache
,

4572 
IN
 
ULONG
 
MsgTy
,

4573 
IN
 
ULONG
 
MsgL
,

4574 
IN
 
VOID
 *
Msg
,

4575 
IN
 
ULONG
 
Priv
);

4577 
BOOLEAN
 
MlmeEnqueueFRecv
(

4578 
IN
 
PRTMP_ADAPTER
 
pAd
,

4579 
IN
 
ULONG
 
Wcid
,

4580 
IN
 
ULONG
 
TimeSmpHigh
,

4581 
IN
 
ULONG
 
TimeSmpLow
,

4582 
IN
 
UCHAR
 
Rssi0
,

4583 
IN
 
UCHAR
 
Rssi1
,

4584 
IN
 
UCHAR
 
Rssi2
,

4585 
IN
 
ULONG
 
MsgL
,

4586 
IN
 
PVOID
 
Msg
,

4587 
IN
 
UCHAR
 
Sigl
);

4590 
BOOLEAN
 
MlmeDequeue
(

4591 
IN
 
MLME_QUEUE
 *
Queue
,

4592 
OUT
 
MLME_QUEUE_ELEM
 **
Em
);

4594 
VOID
 
MlmeRetSMache
(

4595 
IN
 
PRTMP_ADAPTER
 
pAd
);

4597 
BOOLEAN
 
MlmeQueueEmy
(

4598 
IN
 
MLME_QUEUE
 *
Queue
);

4600 
BOOLEAN
 
MlmeQueueFu
(

4601 
IN
 
MLME_QUEUE
 *
Queue
);

4603 
BOOLEAN
 
MsgTySub
(

4604 
IN
 
PRTMP_ADAPTER
 
pAd
,

4605 
IN
 
PFRAME_802_11
 
pFme
,

4606 
OUT
 
INT
 *
Mache
,

4607 
OUT
 
INT
 *
MsgTy
);

4609 
VOID
 
SMacheIn
(

4610 
IN
 
STATE_MACHINE
 *
Sm
,

4611 
IN
 
STATE_MACHINE_FUNC
 
Tns
[],

4612 
IN
 
ULONG
 
StNr
,

4613 
IN
 
ULONG
 
MsgNr
,

4614 
IN
 
STATE_MACHINE_FUNC
 
DefFunc
,

4615 
IN
 
ULONG
 
InS
,

4616 
IN
 
ULONG
 
Ba
);

4618 
VOID
 
SMacheSAi
(

4619 
IN
 
STATE_MACHINE
 *
S
,

4620 
IN
 
ULONG
 
St
,

4621 
ULONG
 
Msg
,

4622 
IN
 
STATE_MACHINE_FUNC
 
F
);

4624 
VOID
 
SMachePfmAi
(

4625 
IN
 
PRTMP_ADAPTER
 
pAd
,

4626 
IN
 
STATE_MACHINE
 *
S
,

4627 
IN
 
MLME_QUEUE_ELEM
 *
Em
,

4628 
IN
 
ULONG
 
CuS
);

4630 
VOID
 
Dr
(

4631 
IN
 
PRTMP_ADAPTER
 
pAd
,

4632 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4634 
VOID
 
AssocSMacheIn
(

4635 
IN
 
PRTMP_ADAPTER
 
pAd
,

4636 
IN
 
STATE_MACHINE
 *
Sm
,

4637 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[]);

4639 
VOID
 
RssocTimeout
(

4640 
IN
 
PVOID
 
SyemScific1
,

4641 
IN
 
PVOID
 
FuniCڋxt
,

4642 
IN
 
PVOID
 
SyemScific2
,

4643 
IN
 
PVOID
 
SyemScific3
);

4645 
VOID
 
AssocTimeout
(

4646 
IN
 
PVOID
 
SyemScific1
,

4647 
IN
 
PVOID
 
FuniCڋxt
,

4648 
IN
 
PVOID
 
SyemScific2
,

4649 
IN
 
PVOID
 
SyemScific3
);

4651 
VOID
 
DissocTimeout
(

4652 
IN
 
PVOID
 
SyemScific1
,

4653 
IN
 
PVOID
 
FuniCڋxt
,

4654 
IN
 
PVOID
 
SyemScific2
,

4655 
IN
 
PVOID
 
SyemScific3
);

4658 
VOID
 
MlmeDissocReqAi
(

4659 
IN
 
PRTMP_ADAPTER
 
pAd
,

4660 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4662 
VOID
 
MlmeAssocReqAi
(

4663 
IN
 
PRTMP_ADAPTER
 
pAd
,

4664 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4666 
VOID
 
MlmeRssocReqAi
(

4667 
IN
 
PRTMP_ADAPTER
 
pAd
,

4668 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4670 
VOID
 
MlmeDissocReqAi
(

4671 
IN
 
PRTMP_ADAPTER
 
pAd
,

4672 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4674 
VOID
 
PrAssocRAi
(

4675 
IN
 
PRTMP_ADAPTER
 
pAd
,

4676 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4678 
VOID
 
PrRssocRAi
(

4679 
IN
 
PRTMP_ADAPTER
 
pAd
,

4680 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4682 
VOID
 
PrDissocAi
(

4683 
IN
 
PRTMP_ADAPTER
 
pAd
,

4684 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4686 
VOID
 
DissocTimeoutAi
(

4687 
IN
 
PRTMP_ADAPTER
 
pAd
,

4688 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4690 
VOID
 
AssocTimeoutAi
(

4691 
IN
 
PRTMP_ADAPTER
 
pAd
,

4692 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4694 
VOID
 
RssocTimeoutAi
(

4695 
IN
 
PRTMP_ADAPTER
 
pAd
,

4696 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4698 
VOID
 
Cls3rAi
(

4699 
IN
 
PRTMP_ADAPTER
 
pAd
,

4700 
IN
 
PUCHAR
 
pAddr
);

4702 
VOID
 
InvidSWhAssoc
(

4703 
IN
 
PRTMP_ADAPTER
 
pAd
,

4704 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4706 
VOID
 
InvidSWhRssoc
(

4707 
IN
 
PRTMP_ADAPTER
 
pAd
,

4708 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4710 
VOID
 
InvidSWhDissoc
(

4711 
IN
 
PRTMP_ADAPTER
 
pAd
,

4712 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4715 
VOID
 
CompoPsPl
(

4716 
IN
 
PRTMP_ADAPTER
 
pAd
);

4718 
VOID
 
CompoNuFme
(

4719 
IN
 
PRTMP_ADAPTER
 
pAd
);

4721 
VOID
 
AssocPoProc
(

4722 
IN
 
PRTMP_ADAPTER
 
pAd
,

4723 
IN
 
PUCHAR
 
pAddr2
,

4724 
IN
 
USHORT
 
CabyInfo
,

4725 
IN
 
USHORT
 
Aid
,

4726 
IN
 
UCHAR
 
SupRe
[],

4727 
IN
 
UCHAR
 
SupReL
,

4728 
IN
 
UCHAR
 
ExtRe
[],

4729 
IN
 
UCHAR
 
ExtReL
,

4730 
IN
 
PEDCA_PARM
 
pEdPm
,

4731 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

4732 
IN
 
UCHAR
 
HtCabyL
,

4733 
IN
 
ADD_HT_INFO_IE
 *
pAddHtInfo
);

4735 
VOID
 
AuthSMacheIn
(

4736 
IN
 
PRTMP_ADAPTER
 
pAd
,

4737 
IN
 
PSTATE_MACHINE
 
sm
,

4738 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[]);

4740 
VOID
 
AuthTimeout
(

4741 
IN
 
PVOID
 
SyemScific1
,

4742 
IN
 
PVOID
 
FuniCڋxt
,

4743 
IN
 
PVOID
 
SyemScific2
,

4744 
IN
 
PVOID
 
SyemScific3
);

4746 
VOID
 
MlmeAuthReqAi
(

4747 
IN
 
PRTMP_ADAPTER
 
pAd
,

4748 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4750 
VOID
 
PrAuthRAtSeq2Ai
(

4751 
IN
 
PRTMP_ADAPTER
 
pAd
,

4752 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4754 
VOID
 
PrAuthRAtSeq4Ai
(

4755 
IN
 
PRTMP_ADAPTER
 
pAd
,

4756 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4758 
VOID
 
AuthTimeoutAi
(

4759 
IN
 
PRTMP_ADAPTER
 
pAd
,

4760 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4762 
VOID
 
Cls2rAi
(

4763 
IN
 
PRTMP_ADAPTER
 
pAd
,

4764 
IN
 
PUCHAR
 
pAddr
);

4766 
VOID
 
MlmeDuthReqAi
(

4767 
IN
 
PRTMP_ADAPTER
 
pAd
,

4768 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4770 
VOID
 
InvidSWhAuth
(

4771 
IN
 
PRTMP_ADAPTER
 
pAd
,

4772 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4776 
VOID
 
AuthRSMacheIn
(

4777 
IN
 
PRTMP_ADAPTER
 
pAd
,

4778 
IN
 
PSTATE_MACHINE
 
Sm
,

4779 
IN
 
STATE_MACHINE_FUNC
 
Tns
[]);

4781 
VOID
 
PrDuthAi
(

4782 
IN
 
PRTMP_ADAPTER
 
pAd
,

4783 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4785 
VOID
 
PrAuthSimeRGAndSd
(

4786 
IN
 
PRTMP_ADAPTER
 
pAd
,

4787 
IN
 
PHEADER_802_11
 
pHdr80211
,

4788 
IN
 
USHORT
 
Alg
,

4789 
IN
 
USHORT
 
Seq
,

4790 
IN
 
USHORT
 
Rs
,

4791 
IN
 
USHORT
 
Stus
);

4797 #ifde
CONFIG_STA_SUPPORT


4798 #ifde
QOS_DLS_SUPPORT


4799 
DlsSMacheIn
(

4800 
IN
 
PRTMP_ADAPTER
 
pAd
,

4801 
IN
 
STATE_MACHINE
 *
Sm
,

4802 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[]);

4804 
VOID
 
MlmeDlsReqAi
(

4805 
IN
 
PRTMP_ADAPTER
 
pAd
,

4806 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4808 
VOID
 
PrDlsReqAi
(

4809 
IN
 
PRTMP_ADAPTER
 
pAd
,

4810 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4812 
VOID
 
PrDlsRAi
(

4813 
IN
 
PRTMP_ADAPTER
 
pAd
,

4814 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4816 
VOID
 
MlmeDlsTrDownAi
(

4817 
IN
 
PRTMP_ADAPTER
 
pAd
,

4818 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4820 
VOID
 
PrDlsTrDownAi
(

4821 
IN
 
PRTMP_ADAPTER
 
pAd
,

4822 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4824 
VOID
 
RTMPCheckDLSTimeOut
(

4825 
IN
 
PRTMP_ADAPTER
 
pAd
);

4827 
BOOLEAN
 
RTMPRcvFmeDLSCheck
(

4828 
IN
 
PRTMP_ADAPTER
 
pAd
,

4829 
IN
 
PHEADER_802_11
 
pHd
,

4830 
IN
 
ULONG
 
L
,

4831 
IN
 
PRT28XX_RXD_STRUC
 
pRxD
);

4833 
INT
 
RTMPCheckDLSFme
(

4834 
IN
 
PRTMP_ADAPTER
 
pAd
,

4835 
IN
 
PUCHAR
 
pDA
);

4837 
VOID
 
RTMPSdDLSTrDownFme
(

4838 
IN
 
PRTMP_ADAPTER
 
pAd
,

4839 
IN
 
PUCHAR
 
pDA
);

4841 
NDIS_STATUS
 
RTMPSdSTAKeyReque
(

4842 
IN
 
PRTMP_ADAPTER
 
pAd
,

4843 
IN
 
PUCHAR
 
pDA
);

4845 
NDIS_STATUS
 
RTMPSdSTAKeyHdShake
(

4846 
IN
 
PRTMP_ADAPTER
 
pAd
,

4847 
IN
 
PUCHAR
 
pDA
);

4849 
VOID
 
DlsTimeoutAi
(

4850 
IN
 
PVOID
 
SyemScific1
,

4851 
IN
 
PVOID
 
FuniCڋxt
,

4852 
IN
 
PVOID
 
SyemScific2
,

4853 
IN
 
PVOID
 
SyemScific3
);

4855 
BOOLEAN
 
MlmeDlsReqSy
(

4856 
IN
 
PRTMP_ADAPTER
 
pAd
,

4857 
IN
 
VOID
 *
Msg
,

4858 
IN
 
ULONG
 
MsgL
,

4859 
OUT
 
PRT_802_11_DLS
 *
pDLS
,

4860 
OUT
 
PUSHORT
 
pRs
);

4862 
INT
 
S_DlsEryInfo_Diy_Proc
(

4863 
IN
 
PRTMP_ADAPTER
 
pAd
,

4864 
IN
 
PUCHAR
 
g
);

4866 
MAC_TABLE_ENTRY
 *
MacTabInDlsEry
(

4867 
IN
 
PRTMP_ADAPTER
 
pAd
,

4868 
IN
 
PUCHAR
 
pAddr
,

4869 
IN
 
UINT
 
DlsEryIdx
);

4871 
BOOLEAN
 
MacTabDeDlsEry
(

4872 
IN
 
PRTMP_ADAPTER
 
pAd
,

4873 
IN
 
USHORT
 
wcid
,

4874 
IN
 
PUCHAR
 
pAddr
);

4876 
MAC_TABLE_ENTRY
 *
DlsEryTabLookup
(

4877 
IN
 
PRTMP_ADAPTER
 
pAd
,

4878 
IN
 
PUCHAR
 
pAddr
,

4879 
IN
 
BOOLEAN
 
bRetIdCou
);

4881 
MAC_TABLE_ENTRY
 *
DlsEryTabLookupByWcid
(

4882 
IN
 
PRTMP_ADAPTER
 
pAd
,

4883 
IN
 
UCHAR
 
wcid
,

4884 
IN
 
PUCHAR
 
pAddr
,

4885 
IN
 
BOOLEAN
 
bRetIdCou
);

4887 
INT
 
S_DlsAddEry_Proc
(

4888 
IN
 
PRTMP_ADAPTER
 
pAd
,

4889 
IN
 
PSTRING
 
g
);

4891 
INT
 
S_DlsTrDownEry_Proc
(

4892 
IN
 
PRTMP_ADAPTER
 
pAd
,

4893 
IN
 
PSTRING
 
g
);

4897 #ifde
QOS_DLS_SUPPORT


4898 
BOOLEAN
 
PrDlsReqSy
(

4899 
IN
 
PRTMP_ADAPTER
 
pAd
,

4900 
IN
 
VOID
 *
Msg
,

4901 
IN
 
ULONG
 
MsgL
,

4902 
OUT
 
PUCHAR
 
pDA
,

4903 
OUT
 
PUCHAR
 
pSA
,

4904 
OUT
 
USHORT
 *
pCabyInfo
,

4905 
OUT
 
USHORT
 *
pDlsTimeout
,

4906 
OUT
 
UCHAR
 *
pResL
,

4907 
OUT
 
UCHAR
 
Res
[],

4908 
OUT
 
UCHAR
 *
pHtCabyL
,

4909 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
);

4911 
BOOLEAN
 
PrDlsRSy
(

4912 
IN
 
PRTMP_ADAPTER
 
pAd
,

4913 
IN
 
VOID
 *
Msg
,

4914 
IN
 
ULONG
 
MsgL
,

4915 
OUT
 
PUCHAR
 
pDA
,

4916 
OUT
 
PUCHAR
 
pSA
,

4917 
OUT
 
USHORT
 *
pCabyInfo
,

4918 
OUT
 
USHORT
 *
pStus
,

4919 
OUT
 
UCHAR
 *
pResL
,

4920 
OUT
 
UCHAR
 
Res
[],

4921 
OUT
 
UCHAR
 *
pHtCabyL
,

4922 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
);

4924 
BOOLEAN
 
PrDlsTrDownSy
(

4925 
IN
 
PRTMP_ADAPTER
 
pAd
,

4926 
IN
 
VOID
 *
Msg
,

4927 
IN
 
ULONG
 
MsgL
,

4928 
OUT
 
PUCHAR
 
pDA
,

4929 
OUT
 
PUCHAR
 
pSA
,

4930 
OUT
 
USHORT
 *
pRs
);

4933 
BOOLEAN
 
PrProbeReqSy
(

4934 
IN
 
PRTMP_ADAPTER
 
pAd
,

4935 
IN
 
VOID
 *
Msg
,

4936 
IN
 
ULONG
 
MsgL
,

4937 
OUT
 
PUCHAR
 
pAddr2
,

4938 
OUT
 
CHAR
 
Ssid
[],

4939 
OUT
 
UCHAR
 *
SsidL
,

4940 
OUT
 
BOOLEAN
 *
bRequeRssi
);

4944 
VOID
 
SyncSMacheIn
(

4945 
IN
 
PRTMP_ADAPTER
 
pAd
,

4946 
IN
 
STATE_MACHINE
 *
Sm
,

4947 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[]);

4949 
VOID
 
BcTimeout
(

4950 
IN
 
PVOID
 
SyemScific1
,

4951 
IN
 
PVOID
 
FuniCڋxt
,

4952 
IN
 
PVOID
 
SyemScific2
,

4953 
IN
 
PVOID
 
SyemScific3
);

4955 
VOID
 
SnTimeout
(

4956 
IN
 
PVOID
 
SyemScific1
,

4957 
IN
 
PVOID
 
FuniCڋxt
,

4958 
IN
 
PVOID
 
SyemScific2
,

4959 
IN
 
PVOID
 
SyemScific3
);

4961 
VOID
 
MlmeSnReqAi
(

4962 
IN
 
PRTMP_ADAPTER
 
pAd
,

4963 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4965 
VOID
 
InvidSWhSn
(

4966 
IN
 
PRTMP_ADAPTER
 
pAd
,

4967 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4969 
VOID
 
InvidSWhJo
(

4970 
IN
 
PRTMP_ADAPTER
 
pAd
,

4971 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4973 
VOID
 
InvidSWhS
(

4974 
IN
 
PRTMP_ADAPTER
 
pAd
,

4975 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4977 
VOID
 
PrBc
(

4978 
IN
 
PRTMP_ADAPTER
 
pAd
,

4979 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4981 
VOID
 
EnqueueProbeReque
(

4982 
IN
 
PRTMP_ADAPTER
 
pAd
);

4984 
BOOLEAN
 
SnRug
(

4985 
IN
 
PRTMP_ADAPTER
 
pAd
);

4988 
VOID
 
MlmeClIn
(

4989 
IN
 
PRTMP_ADAPTER
 
pAd
,

4990 
IN
 
STATE_MACHINE
 *
S
,

4991 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[]);

4993 
VOID
 
MlmeClMachePfmAi
(

4994 
IN
 
PRTMP_ADAPTER
 
pAd
,

4995 
IN
 
STATE_MACHINE
 *
S
,

4996 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

4998 
VOID
 
ClIdProc
(

4999 
IN
 
PRTMP_ADAPTER
 
pAd
,

5000 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5002 
VOID
 
ClOidSnProc
(

5003 
IN
 
PRTMP_ADAPTER
 
pAd
,

5004 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5006 
VOID
 
ClOidSsidProc
(

5007 
IN
 
PRTMP_ADAPTER
 
pAd
,

5008 
IN
 
MLME_QUEUE_ELEM
 * 
Em
);

5010 
VOID
 
ClOidRTBssidProc
(

5011 
IN
 
PRTMP_ADAPTER
 
pAd
,

5012 
IN
 
MLME_QUEUE_ELEM
 * 
Em
);

5014 
VOID
 
ClMlmeRmgProc
(

5015 
IN
 
PRTMP_ADAPTER
 
pAd
,

5016 
IN
 
MLME_QUEUE_ELEM
 * 
Em
);

5018 
VOID
 
ClWaDissocProc
(

5019 
IN
 
PRTMP_ADAPTER
 
pAd
,

5020 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5022 
VOID
 
ClWaJoProc
(

5023 
IN
 
PRTMP_ADAPTER
 
pAd
,

5024 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5026 
VOID
 
ClWaRssocProc
(

5027 
IN
 
PRTMP_ADAPTER
 
pAd
,

5028 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5030 
VOID
 
ClWaSProc
(

5031 
IN
 
PRTMP_ADAPTER
 
pAd
,

5032 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5034 
VOID
 
ClWaAuthProc
(

5035 
IN
 
PRTMP_ADAPTER
 
pAd
,

5036 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5038 
VOID
 
ClWaAuthProc2
(

5039 
IN
 
PRTMP_ADAPTER
 
pAd
,

5040 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5042 
VOID
 
ClWaAssocProc
(

5043 
IN
 
PRTMP_ADAPTER
 
pAd
,

5044 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5046 #ifde
QOS_DLS_SUPPORT


5047 
VOID
 
ClOidDLSSupProc
(

5048 
IN
 
PRTMP_ADAPTER
 
pAd
,

5049 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5053 
VOID
 
LkUp
(

5054 
IN
 
PRTMP_ADAPTER
 
pAd
,

5055 
IN
 
UCHAR
 
BssTy
);

5057 
VOID
 
LkDown
(

5058 
IN
 
PRTMP_ADAPTER
 
pAd
,

5059 
IN
 
BOOLEAN
 
IsReqFromAP
);

5061 
VOID
 
IOnBssTab
(

5062 
IN
 
PRTMP_ADAPTER
 
pAd
);

5064 
VOID
 
IOnBssTab2
(

5065 
IN
 
PRTMP_ADAPTER
 
pAd
);;

5067 
VOID
 
JoPmFl
(

5068 
IN
 
PRTMP_ADAPTER
 
pAd
,

5069 
IN
 
OUT
 
MLME_JOIN_REQ_STRUCT
 *
JoReq
,

5070 
IN
 
ULONG
 
BssIdx
);

5072 
VOID
 
AssocPmFl
(

5073 
IN
 
PRTMP_ADAPTER
 
pAd
,

5074 
IN
 
OUT
 
MLME_ASSOC_REQ_STRUCT
 *
AssocReq
,

5075 
IN
 
PUCHAR
 
pAddr
,

5076 
IN
 
USHORT
 
CabyInfo
,

5077 
IN
 
ULONG
 
Timeout
,

5078 
IN
 
USHORT
 
LiIv
);

5080 
VOID
 
SnPmFl
(

5081 
IN
 
PRTMP_ADAPTER
 
pAd
,

5082 
IN
 
OUT
 
MLME_SCAN_REQ_STRUCT
 *
SnReq
,

5083 
IN
 
STRING
 
Ssid
[],

5084 
IN
 
UCHAR
 
SsidL
,

5085 
IN
 
UCHAR
 
BssTy
,

5086 
IN
 
UCHAR
 
SnTy
);

5088 
VOID
 
DissocPmFl
(

5089 
IN
 
PRTMP_ADAPTER
 
pAd
,

5090 
IN
 
OUT
 
MLME_DISASSOC_REQ_STRUCT
 *
DissocReq
,

5091 
IN
 
PUCHAR
 
pAddr
,

5092 
IN
 
USHORT
 
Rs
);

5094 
VOID
 
SPmFl
(

5095 
IN
 
PRTMP_ADAPTER
 
pAd
,

5096 
IN
 
OUT
 
MLME_START_REQ_STRUCT
 *
SReq
,

5097 
IN
 
CHAR
 
Ssid
[],

5098 
IN
 
UCHAR
 
SsidL
);

5100 
VOID
 
AuthPmFl
(

5101 
IN
 
PRTMP_ADAPTER
 
pAd
,

5102 
IN
 
OUT
 
MLME_AUTH_REQ_STRUCT
 *
AuthReq
,

5103 
IN
 
PUCHAR
 
pAddr
,

5104 
IN
 
USHORT
 
Alg
);

5106 
VOID
 
EnqueuePsPl
(

5107 
IN
 
PRTMP_ADAPTER
 
pAd
);

5109 
VOID
 
EnqueueBcFme
(

5110 
IN
 
PRTMP_ADAPTER
 
pAd
);

5112 
VOID
 
MlmeJoReqAi
(

5113 
IN
 
PRTMP_ADAPTER
 
pAd
,

5114 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5116 
VOID
 
MlmeSnReqAi
(

5117 
IN
 
PRTMP_ADAPTER
 
pAd
,

5118 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5120 
VOID
 
MlmeSReqAi
(

5121 
IN
 
PRTMP_ADAPTER
 
pAd
,

5122 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5124 
VOID
 
SnTimeoutAi
(

5125 
IN
 
PRTMP_ADAPTER
 
pAd
,

5126 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5128 
VOID
 
BcTimeoutAtJoAi
(

5129 
IN
 
PRTMP_ADAPTER
 
pAd
,

5130 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5132 
VOID
 
PrBcAtSnAi
(

5133 
IN
 
PRTMP_ADAPTER
 
pAd
,

5134 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5136 
VOID
 
PrBcAtJoAi
(

5137 
IN
 
PRTMP_ADAPTER
 
pAd
,

5138 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5140 
VOID
 
PrBc
(

5141 
IN
 
PRTMP_ADAPTER
 
pAd
,

5142 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5144 
VOID
 
PrProbeReqAi
(

5145 
IN
 
PRTMP_ADAPTER
 
pAd
,

5146 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5148 
VOID
 
SnNextChl
(

5149 
IN
 
PRTMP_ADAPTER
 
pAd
);

5151 
ULONG
 
MakeIbssBc
(

5152 
IN
 
PRTMP_ADAPTER
 
pAd
);

5154 #ifde
CONFIG_STA_SUPPORT


5155 
VOID
 
InChlRedVue
(

5156 
IN
 
PRTMP_ADAPTER
 
pAd
);

5159 
BOOLEAN
 
MlmeSnReqSy
(

5160 
IN
 
PRTMP_ADAPTER
 
pAd
,

5161 
IN
 
VOID
 *
Msg
,

5162 
IN
 
ULONG
 
MsgL
,

5163 
OUT
 
UCHAR
 *
BssTy
,

5164 
OUT
 
CHAR
 
ssid
[],

5165 
OUT
 
UCHAR
 *
SsidL
,

5166 
OUT
 
UCHAR
 *
SnTy
);

5168 
BOOLEAN
 
PrBcAndProbeRSy
(

5169 
IN
 
PRTMP_ADAPTER
 
pAd
,

5170 
IN
 
VOID
 *
Msg
,

5171 
IN
 
ULONG
 
MsgL
,

5172 
IN
 
UCHAR
 
MsgChl
,

5173 
OUT
 
PUCHAR
 
pAddr2
,

5174 
OUT
 
PUCHAR
 
pBssid
,

5175 
OUT
 
CHAR
 
Ssid
[],

5176 
OUT
 
UCHAR
 *
pSsidL
,

5177 
OUT
 
UCHAR
 *
pBssTy
,

5178 
OUT
 
USHORT
 *
pBcPiod
,

5179 
OUT
 
UCHAR
 *
pChl
,

5180 
OUT
 
UCHAR
 *
pNewChl
,

5181 
OUT
 
LARGE_INTEGER
 *
pTimeamp
,

5182 
OUT
 
CF_PARM
 *
pCfPm
,

5183 
OUT
 
USHORT
 *
pAtimW
,

5184 
OUT
 
USHORT
 *
pCabyInfo
,

5185 
OUT
 
UCHAR
 *
pE
,

5186 
OUT
 
UCHAR
 *
pDtimCou
,

5187 
OUT
 
UCHAR
 *
pDtimPiod
,

5188 
OUT
 
UCHAR
 *
pBFg
,

5189 
OUT
 
UCHAR
 *
pMesgeToMe
,

5190 
OUT
 
UCHAR
 
SupRe
[],

5191 
OUT
 
UCHAR
 *
pSupReL
,

5192 
OUT
 
UCHAR
 
ExtRe
[],

5193 
OUT
 
UCHAR
 *
pExtReL
,

5194 
OUT
 
UCHAR
 *
pCkFg
,

5195 
OUT
 
UCHAR
 *
pAڑClPowLim
,

5196 
OUT
 
PEDCA_PARM
 
pEdPm
,

5197 
OUT
 
PQBSS_LOAD_PARM
 
pQbssLd
,

5198 
OUT
 
PQOS_CAPABILITY_PARM
 
pQosCaby
,

5199 
OUT
 
ULONG
 *
pRkIe
,

5200 
OUT
 
UCHAR
 *
pHtCabyL
,

5201 #ifde
CONFIG_STA_SUPPORT


5202 
OUT
 
UCHAR
 *
pPNHtCabyL
,

5204 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
,

5205 
OUT
 
EXT_CAP_INFO_ELEMENT
 *
pExtCInfo
,

5206 
OUT
 
UCHAR
 *
AddHtInfoL
,

5207 
OUT
 
ADD_HT_INFO_IE
 *
AddHtInfo
,

5208 
OUT
 
UCHAR
 *
NewExtChl
,

5209 
OUT
 
USHORT
 *
LgthVIE
,

5210 
OUT
 
PNDIS_802_11_VARIABLE_IEs
 
pVIE
);

5213 #ifde
DOT11_N_SUPPORT


5214 #ifde
DOT11N_DRAFT3


5215 
BOOLEAN
 
PrBcAndProbeRSy2
(

5216 
IN
 
PRTMP_ADAPTER
 
pAd
,

5217 
IN
 
VOID
 *
Msg
,

5218 
IN
 
ULONG
 
MsgL
,

5219 
IN
 
OVERLAP_BSS_SCAN_IE
 *
BssSn
,

5220 
OUT
 
UCHAR
 *
RegCss
);

5224 
BOOLEAN
 
PrAddBAReqAiSy
(

5225 
IN
 
PRTMP_ADAPTER
 
pAd
,

5226 
IN
 
VOID
 *
pMsg
,

5227 
IN
 
ULONG
 
MsgL
,

5228 
OUT
 
PUCHAR
 
pAddr2
);

5230 
BOOLEAN
 
PrAddBARAiSy
(

5231 
IN
 
PRTMP_ADAPTER
 
pAd
,

5232 
IN
 
VOID
 *
pMsg
,

5233 
IN
 
ULONG
 
MsgL
);

5235 
BOOLEAN
 
PrDBAAiSy
(

5236 
IN
 
PRTMP_ADAPTER
 
pAd
,

5237 
IN
 
UCHAR
 
Wcid
,

5238 
IN
 
VOID
 *
pMsg
,

5239 
IN
 
ULONG
 
MsgL
);

5241 
BOOLEAN
 
MlmeAssocReqSy
(

5242 
IN
 
PRTMP_ADAPTER
 
pAd
,

5243 
IN
 
VOID
 *
Msg
,

5244 
IN
 
ULONG
 
MsgL
,

5245 
OUT
 
PUCHAR
 
pApAddr
,

5246 
OUT
 
USHORT
 *
CabyInfo
,

5247 
OUT
 
ULONG
 *
Timeout
,

5248 
OUT
 
USHORT
 *
LiIv
);

5250 
BOOLEAN
 
MlmeAuthReqSy
(

5251 
IN
 
PRTMP_ADAPTER
 
pAd
,

5252 
IN
 
VOID
 *
Msg
,

5253 
IN
 
ULONG
 
MsgL
,

5254 
OUT
 
PUCHAR
 
pAddr
,

5255 
OUT
 
ULONG
 *
Timeout
,

5256 
OUT
 
USHORT
 *
Alg
);

5258 
BOOLEAN
 
MlmeSReqSy
(

5259 
IN
 
PRTMP_ADAPTER
 
pAd
,

5260 
IN
 
VOID
 *
Msg
,

5261 
IN
 
ULONG
 
MsgL
,

5262 
OUT
 
CHAR
 
Ssid
[],

5263 
OUT
 
UCHAR
 *
Ssidn
);

5265 
BOOLEAN
 
PrAuthSy
(

5266 
IN
 
PRTMP_ADAPTER
 
pAd
,

5267 
IN
 
VOID
 *
Msg
,

5268 
IN
 
ULONG
 
MsgL
,

5269 
OUT
 
PUCHAR
 
pAddr
,

5270 
OUT
 
USHORT
 *
Alg
,

5271 
OUT
 
USHORT
 *
Seq
,

5272 
OUT
 
USHORT
 *
Stus
,

5273 
OUT
 
CHAR
 
ChlgText
[]);

5275 
BOOLEAN
 
PrAssocRSy
(

5276 
IN
 
PRTMP_ADAPTER
 
pAd
,

5277 
IN
 
VOID
 *
pMsg
,

5278 
IN
 
ULONG
 
MsgL
,

5279 
OUT
 
PUCHAR
 
pAddr2
,

5280 
OUT
 
USHORT
 *
pCabyInfo
,

5281 
OUT
 
USHORT
 *
pStus
,

5282 
OUT
 
USHORT
 *
pAid
,

5283 
OUT
 
UCHAR
 
SupRe
[],

5284 
OUT
 
UCHAR
 *
pSupReL
,

5285 
OUT
 
UCHAR
 
ExtRe
[],

5286 
OUT
 
UCHAR
 *
pExtReL
,

5287 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
,

5288 
OUT
 
ADD_HT_INFO_IE
 *
pAddHtInfo
,

5289 
OUT
 
UCHAR
 *
pHtCabyL
,

5290 
OUT
 
UCHAR
 *
pAddHtInfoL
,

5291 
OUT
 
UCHAR
 *
pNewExtChlOfft
,

5292 
OUT
 
PEDCA_PARM
 
pEdPm
,

5293 
OUT
 
EXT_CAP_INFO_ELEMENT
 *
pExtCInfo
,

5294 
OUT
 
UCHAR
 *
pCkFg
);

5296 
BOOLEAN
 
PrDissocSy
(

5297 
IN
 
PRTMP_ADAPTER
 
pAd
,

5298 
IN
 
VOID
 *
Msg
,

5299 
IN
 
ULONG
 
MsgL
,

5300 
OUT
 
PUCHAR
 
pAddr2
,

5301 
OUT
 
USHORT
 *
Rs
);

5303 
BOOLEAN
 
PrDuthSy
(

5304 
IN
 
PRTMP_ADAPTER
 
pAd
,

5305 
IN
 
VOID
 *
Msg
,

5306 
IN
 
ULONG
 
MsgL
,

5307 
OUT
 
PUCHAR
 
pAddr1
,

5308 
OUT
 
PUCHAR
 
pAddr2
,

5309 
OUT
 
PUCHAR
 
pAddr3
,

5310 
OUT
 
USHORT
 *
Rs
);

5312 
BOOLEAN
 
GTimB
(

5313 
IN
 
CHAR
 *
P
,

5314 
IN
 
USHORT
 
Aid
,

5315 
OUT
 
UCHAR
 *
TimL
,

5316 
OUT
 
UCHAR
 *
BFg
,

5317 
OUT
 
UCHAR
 *
DtimCou
,

5318 
OUT
 
UCHAR
 *
DtimPiod
,

5319 
OUT
 
UCHAR
 *
MesgeToMe
);

5321 
UCHAR
 
ChlSy
(

5322 
IN
 
PRTMP_ADAPTER
 
pAd
,

5323 
IN
 
UCHAR
 
chl
);

5325 
NDIS_802_11_NETWORK_TYPE
 
NwkTyInUSy
(

5326 
IN
 
PBSS_ENTRY
 
pBss
);

5328 
BOOLEAN
 
MlmeDBAReqSy
(

5329 
IN
 
PRTMP_ADAPTER
 
pAd
,

5330 
IN
 
VOID
 *
Msg
,

5331 
IN
 
ULONG
 
MsgL
);

5333 
BOOLEAN
 
MlmeAddBAReqSy
(

5334 
IN
 
PRTMP_ADAPTER
 
pAd
,

5335 
IN
 
VOID
 *
Msg
,

5336 
IN
 
ULONG
 
MsgL
,

5337 
OUT
 
PUCHAR
 
pAddr2
);

5339 
ULONG
 
MakeOutgogFme
(

5340 
OUT
 
UCHAR
 *
Bufr
,

5341 
OUT
 
ULONG
 *
Lgth
, ...);

5343 
UCHAR
 
RdomBy
(

5344 
IN
 
PRTMP_ADAPTER
 
pAd
);

5346 
UCHAR
 
RdomBy2
(

5347 
IN
 
PRTMP_ADAPTER
 
pAd
);

5349 
VOID
 
AsicUpdeAutoFlBackTab
(

5350 
IN
 
PRTMP_ADAPTER
 
pAd
,

5351 
IN
 
PUCHAR
 
pTxRe
);

5353 
VOID
 
MlmePiodicExec
(

5354 
IN
 
PVOID
 
SyemScific1
,

5355 
IN
 
PVOID
 
FuniCڋxt
,

5356 
IN
 
PVOID
 
SyemScific2
,

5357 
IN
 
PVOID
 
SyemScific3
);

5359 
VOID
 
LkDownExec
(

5360 
IN
 
PVOID
 
SyemScific1
,

5361 
IN
 
PVOID
 
FuniCڋxt
,

5362 
IN
 
PVOID
 
SyemScific2
,

5363 
IN
 
PVOID
 
SyemScific3
);

5365 
VOID
 
LkUpExec
(

5366 
IN
 
PVOID
 
SyemScific1
,

5367 
IN
 
PVOID
 
FuniCڋxt
,

5368 
IN
 
PVOID
 
SyemScific2
,

5369 
IN
 
PVOID
 
SyemScific3
);

5371 
VOID
 
STAMlmePiodicExec
(

5372 
PRTMP_ADAPTER
 
pAd
);

5374 
VOID
 
MlmeAutoSn
(

5375 
IN
 
PRTMP_ADAPTER
 
pAd
);

5377 
VOID
 
MlmeAutoRecLaSSID
(

5378 
IN
 
PRTMP_ADAPTER
 
pAd
);

5380 
BOOLEAN
 
MlmeVideSSID
(

5381 
IN
 
PUCHAR
 
pSsid
,

5382 
IN
 
UCHAR
 
SsidL
);

5384 
VOID
 
MlmeCheckFRmg
(

5385 
IN
 
PRTMP_ADAPTER
 
pAd
,

5386 
IN
 
ULONG
 
Now32
);

5388 
BOOLEAN
 
MlmeCheckFFaRmg
(

5389 
IN
 
PRTMP_ADAPTER
 
pAd
);

5391 
VOID
 
MlmeDymicTxReSwchg
(

5392 
IN
 
PRTMP_ADAPTER
 
pAd
);

5394 #ifde
NEW_RATE_ADAPT_SUPPORT


5395 
VOID
 
MlmeDymicTxReSwchgAdt
(

5396 
IN
 
PRTMP_ADAPTER
 
pAd
,

5397 
IN
 
ULONG
 
i
);

5400 
VOID
 
MlmeSeReSwchTab11N3SRmt
(

5401 
IN
 
PUCHAR
 *
Tab
);

5404 
VOID
 
MlmeSTxRe
(

5405 
IN
 
PRTMP_ADAPTER
 
pAd
,

5406 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

5407 
IN
 
PRTMP_TX_RATE_SWITCH
 
pTxRe
);

5409 
VOID
 
MlmeSeTxReTab
(

5410 
IN
 
PRTMP_ADAPTER
 
pAd
,

5411 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

5412 
IN
 
PUCHAR
 *
Tab
,

5413 
IN
 
PUCHAR
 
pTabSize
,

5414 
IN
 
PUCHAR
 
pInTxReIdx
);

5416 
VOID
 
MlmeCcuϋChlQuy
(

5417 
IN
 
PRTMP_ADAPTER
 
pAd
,

5418 
IN
 
PMAC_TABLE_ENTRY
 
pMacEry
,

5419 
IN
 
ULONG
 
Now
);

5421 
VOID
 
MlmeCheckPsmChge
(

5422 
IN
 
PRTMP_ADAPTER
 
pAd
,

5423 
IN
 
ULONG
 
Now32
);

5425 
VOID
 
MlmeSPsmB
(

5426 
IN
 
PRTMP_ADAPTER
 
pAd
,

5427 
IN
 
USHORT
 
psm
);

5429 
VOID
 
MlmeSTxPamb
(

5430 
IN
 
PRTMP_ADAPTER
 
pAd
,

5431 
IN
 
USHORT
 
TxPamb
);

5433 
VOID
 
UpdeBasicReBm
(

5434 
IN
 
PRTMP_ADAPTER
 
pAd
);

5436 
VOID
 
MlmeUpdeTxRes
(

5437 
IN
 
PRTMP_ADAPTER
 
pAd
,

5438 
IN
 
BOOLEAN
 
bLkUp
,

5439 
IN
 
UCHAR
 
idx
);

5441 #ifde
DOT11_N_SUPPORT


5442 
VOID
 
MlmeUpdeHtTxRes
(

5443 
IN
 
PRTMP_ADAPTER
 
pAd
,

5444 
IN
 
UCHAR
 
idx
);

5447 
VOID
 
RTMPCheckRes
(

5448 
IN
 
PRTMP_ADAPTER
 
pAd
,

5449 
IN
 
OUT
 
UCHAR
 
SupRe
[],

5450 
IN
 
OUT
 
UCHAR
 *
SupReL
);

5452 #ifde
CONFIG_STA_SUPPORT


5453 
BOOLEAN
 
RTMPCheckChl
(

5454 
IN
 
PRTMP_ADAPTER
 
pAd
,

5455 
IN
 
UCHAR
 
CChl
,

5456 
IN
 
UCHAR
 
Chl
);

5459 
BOOLEAN
 
RTMPCheckHt
(

5460 
IN
 
PRTMP_ADAPTER
 
pAd
,

5461 
IN
 
UCHAR
 
Wcid
,

5462 
IN
 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
,

5463 
IN
 
OUT
 
ADD_HT_INFO_IE
 *
pAddHtInfo
);

5465 
VOID
 
SQuickReeFReUpExec
(

5466 
IN
 
PVOID
 
SyemScific1
,

5467 
IN
 
PVOID
 
FuniCڋxt
,

5468 
IN
 
PVOID
 
SyemScific2
,

5469 
IN
 
PVOID
 
SyemScific3
);

5471 #ifde
NEW_RATE_ADAPT_SUPPORT


5472 
VOID
 
SQuickReeFReUpExecAdt
(

5473 
IN
 
PRTMP_ADAPTER
 
pAd
,

5474 
IN
 
ULONG
 
i
);

5477 
VOID
 
RTMPUpdeMlmeRe
(

5478 
IN
 
PRTMP_ADAPTER
 
pAd
);

5480 
CHAR
 
RTMPMaxRssi
(

5481 
IN
 
PRTMP_ADAPTER
 
pAd
,

5482 
IN
 
CHAR
 
Rssi0
,

5483 
IN
 
CHAR
 
Rssi1
,

5484 
IN
 
CHAR
 
Rssi2
);

5486 
CHAR
 
RTMPMS
(

5487 
IN
 
PRTMP_ADAPTER
 
pAd
,

5488 
IN
 
CHAR
 
S0
,

5489 
IN
 
CHAR
 
S1
);

5491 
CHAR
 
RTMPMNoiLev
(

5492 
IN
 
PRTMP_ADAPTER
 
pAd
,

5493 
IN
 
CHAR
 
NoiLev0
,

5494 
IN
 
CHAR
 
NoiLev1
,

5495 
IN
 
CHAR
 
NoiLev2
);

5497 
VOID
 
AsicSRxA
(

5498 
IN
 
PRTMP_ADAPTER
 
pAd
,

5499 
IN
 
UCHAR
 
A
);

5505 
VOID
 
AsicEvueRxA
(

5506 
IN
 
PRTMP_ADAPTER
 
pAd
);

5508 
VOID
 
AsicRxAEvTimeout
(

5509 
IN
 
PVOID
 
SyemScific1
,

5510 
IN
 
PVOID
 
FuniCڋxt
,

5511 
IN
 
PVOID
 
SyemScific2
,

5512 
IN
 
PVOID
 
SyemScific3
);

5514 
VOID
 
APSDPiodicExec
(

5515 
IN
 
PVOID
 
SyemScific1
,

5516 
IN
 
PVOID
 
FuniCڋxt
,

5517 
IN
 
PVOID
 
SyemScific2
,

5518 
IN
 
PVOID
 
SyemScific3
);

5520 
BOOLEAN
 
RTMPCheckEryEbAutoReSwch
(

5521 
IN
 
PRTMP_ADAPTER
 
pAd
,

5522 
IN
 
PMAC_TABLE_ENTRY
 
pEry
);

5524 
UCHAR
 
RTMPSFixedTxMode
(

5525 
IN
 
PRTMP_ADAPTER
 
pAd
,

5526 
IN
 
PMAC_TABLE_ENTRY
 
pEry
);

5528 
VOID
 
RTMPUpdeLegacyTxStg
(

5529 
UCHAR
 
fixed_tx_mode
,

5530 
PMAC_TABLE_ENTRY
 
pEry
);

5532 
BOOLEAN
 
RTMPAutoReSwchCheck
(

5533 
IN
 
PRTMP_ADAPTER
 
pAd
);

5535 
NDIS_STATUS
 
MlmeIn
(

5536 
IN
 
PRTMP_ADAPTER
 
pAd
);

5539 #ifde
RTMP_INTERNAL_TX_ALC


5549 
VOID
 
InDesedTSSITab
(

5550 
IN
 
PRTMP_ADAPTER
 
pAd
);

5561 
UCHAR
 
GDesedTSSI
(

5562 
IN
 
PRTMP_ADAPTER
 
pAd
);

5565 
VOID
 
MlmeHdr
(

5566 
IN
 
PRTMP_ADAPTER
 
pAd
);

5568 
VOID
 
MlmeHt
(

5569 
IN
 
PRTMP_ADAPTER
 
pAd
);

5571 
VOID
 
MlmeRetRkCous
(

5572 
IN
 
PRTMP_ADAPTER
 
pAd
);

5574 
VOID
 
BudChlLi
(

5575 
IN
 
PRTMP_ADAPTER
 
pAd
);

5577 
UCHAR
 
FChl
(

5578 
IN
 
PRTMP_ADAPTER
 
pAd
);

5580 
UCHAR
 
NextChl
(

5581 
IN
 
PRTMP_ADAPTER
 
pAd
,

5582 
IN
 
UCHAR
 
chl
);

5584 
VOID
 
ChgeToClPowLim
(

5585 
IN
 
PRTMP_ADAPTER
 
pAd
,

5586 
IN
 
UCHAR
 
AڑClPowLim
);

5591 
VOID
 
RTMPInMICEnge
(

5592 
IN
 
PRTMP_ADAPTER
 
pAd
,

5593 
IN
 
PUCHAR
 
pKey
,

5594 
IN
 
PUCHAR
 
pDA
,

5595 
IN
 
PUCHAR
 
pSA
,

5596 
IN
 
UCHAR
 
UrPriܙy
,

5597 
IN
 
PUCHAR
 
pMICKey
);

5599 
BOOLEAN
 
RTMPTkComMICVue
(

5600 
IN
 
PRTMP_ADAPTER
 
pAd
,

5601 
IN
 
PUCHAR
 
pSrc
,

5602 
IN
 
PUCHAR
 
pDA
,

5603 
IN
 
PUCHAR
 
pSA
,

5604 
IN
 
PUCHAR
 
pMICKey
,

5605 
IN
 
UCHAR
 
UrPriܙy
,

5606 
IN
 
UINT
 
L
);

5608 
VOID
 
RTMPCcuϋMICVue
(

5609 
IN
 
PRTMP_ADAPTER
 
pAd
,

5610 
IN
 
PNDIS_PACKET
 
pPack
,

5611 
IN
 
PUCHAR
 
pEnp
,

5612 
IN
 
PCIPHER_KEY
 
pKey
,

5613 
IN
 
UCHAR
 
idx
);

5615 
VOID
 
RTMPTkAdBy
(

5616 
IN
 
PTKIP_KEY_INFO
 
pTk
,

5617 
IN
 
UCHAR
 
uCh
);

5619 
VOID
 
RTMPTkAd
(

5620 
IN
 
PTKIP_KEY_INFO
 
pTk
,

5621 
IN
 
PUCHAR
 
pSrc
,

5622 
IN
 
UINT
 
nBys
);

5624 
VOID
 
RTMPTkGMIC
(

5625 
IN
 
PTKIP_KEY_INFO
 
pTk
);

5630 
INT
 
RT_CfgSCouryRegi
(

5631 
IN
 
PRTMP_ADAPTER
 
pAd
,

5632 
IN
 
PSTRING
 
g
,

5633 
IN
 
INT
 
bd
);

5635 
INT
 
RT_CfgSWessMode
(

5636 
IN
 
PRTMP_ADAPTER
 
pAd
,

5637 
IN
 
PSTRING
 
g
);

5640 
INT
 
RT_CfgSShtSl
(

5641 
IN
 
PRTMP_ADAPTER
 
pAd
,

5642 
IN
 
PSTRING
 
g
);

5644 
INT
 
RT_CfgSWKey
(

5645 
IN
 
PRTMP_ADAPTER
 
pAd
,

5646 
IN
 
PSTRING
 
keySg
,

5647 
IN
 
CIPHER_KEY
 *
pShedKey
,

5648 
IN
 
INT
 
keyIdx
);

5650 
INT
 
RT_CfgSWPAPSKKey
(

5651 
IN
 
RTMP_ADAPTER
 *
pAd
,

5652 
IN
 
PSTRING
 
keySg
,

5653 
IN
 
UCHAR
 *
pHashS
,

5654 
IN
 
INT
 
hashSL
,

5655 
OUT
 
PUCHAR
 
pPMKBuf
);

5657 
INT
 
RT_CfgSFixedTxPhyMode
(

5658 
IN
 
PSTRING
 
g
);

5660 
INT
 
RT_CfgSMacAddss
(

5661 
IN
 
PRTMP_ADAPTER
 
pAd
,

5662 
IN
 
PSTRING
 
g
);

5664 
INT
 
RT_CfgSTxMCSProc
(

5665 
IN
 
PSTRING
 
g
,

5666 
OUT
 
BOOLEAN
 *
pAutoRe
);

5668 
INT
 
RT_CfgSAutoFlBack
(

5669 
IN
 
PRTMP_ADAPTER
 
pAd
,

5670 
IN
 
PSTRING
 
g
);

5677 
NDIS_STATUS
 
RTMPWPARemoveKeyProc
(

5678 
IN
 
PRTMP_ADAPTER
 
pAd
,

5679 
IN
 
PVOID
 
pBuf
);

5681 
VOID
 
RTMPWPARemoveAKeys
(

5682 
IN
 
PRTMP_ADAPTER
 
pAd
);

5684 
BOOLEAN
 
RTMPCheckSPrtAb
(

5685 
IN
 
CHAR
 *
pInPutS
,

5686 
IN
 
UCHAR
 
rL
);

5688 
VOID
 
RTMPSPhyMode
(

5689 
IN
 
PRTMP_ADAPTER
 
pAd
,

5690 
IN
 
ULONG
 
phymode
);

5692 
VOID
 
RTMPUpdeHTIE
(

5693 
IN
 
RT_HT_CAPABILITY
 *
pRtHt
,

5694 
IN
 
UCHAR
 *
pMcsS
,

5695 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
,

5696 
OUT
 
ADD_HT_INFO_IE
 *
pAddHtInfo
);

5698 
VOID
 
RTMPAddWcidAribuEry
(

5699 
IN
 
PRTMP_ADAPTER
 
pAd
,

5700 
IN
 
UCHAR
 
BssIdx
,

5701 
IN
 
UCHAR
 
KeyIdx
,

5702 
IN
 
UCHAR
 
ChAlg
,

5703 
IN
 
MAC_TABLE_ENTRY
 *
pEry
);

5705 
PSTRING
 
GEnyTy
(

5706 
CHAR
 
c
);

5708 
PSTRING
 
GAuthMode
(

5709 
CHAR
 
auth
);

5711 #ifde
DOT11_N_SUPPORT


5712 
VOID
 
RTMPSHT
(

5713 
IN
 
PRTMP_ADAPTER
 
pAd
,

5714 
IN
 
OID_SET_HT_PHYMODE
 *
pHTPhyMode
);

5716 
VOID
 
RTMPSIndividuHT
(

5717 
IN
 
PRTMP_ADAPTER
 
pAd
,

5718 
IN
 
UCHAR
 
idx
);

5721 #ifde
SYSTEM_LOG_SUPPORT


5722 
VOID
 
RTMPSdWessEvt
(

5723 
IN
 
PRTMP_ADAPTER
 
pAd
,

5724 
IN
 
USHORT
 
Evt_ag
,

5725 
IN
 
PUCHAR
 
pAddr
,

5726 
IN
 
UCHAR
 
BssIdx
,

5727 
IN
 
CHAR
 
Rssi
);

5729 
	#RTMPSdWessEvt
(
_pAd
, 
_Evt_ag
, 
_pAddr
, 
_BssIdx
, 
_Rssi
)

	)

5732 
CHAR
 
CvtToRssi
(

5733 
IN
 
PRTMP_ADAPTER
 
pAd
,

5734 
IN
 
CHAR
 
Rssi
,

5735 
IN
 
UCHAR
 
RssiNumb
);

5737 
CHAR
 
CvtToS
(

5738 
IN
 
PRTMP_ADAPTER
 
pAd
,

5739 
IN
 
UCHAR
 
S
);

5741 #ifde
DOT11N_DRAFT3


5742 
VOID
 
BudEfedChlLi
(

5743 
IN
 
PRTMP_ADAPTER
 
pAd
);

5746 
VOID
 
DeEfedChlLi
(

5747 
IN
 
PRTMP_ADAPTER
 
pAd
);

5749 
VOID
 
ClChlWidth
(

5750 
IN
 
PRTMP_ADAPTER
 
pAd
,

5751 
IN
 
UCHAR
 
PrimyChl
,

5752 
IN
 
UCHAR
 
CChl
,

5753 
IN
 
UCHAR
 
ChlWidth
,

5754 
IN
 
UCHAR
 
SecdyChlOfft
);

5759 
VOID
 
APAsicEvueRxA
(

5760 
IN
 
PRTMP_ADAPTER
 
pAd
);

5763 
VOID
 
APAsicRxAEvTimeout
(

5764 
IN
 
PRTMP_ADAPTER
 
pAd
);

5770 
VOID
 
RTMPGTxTscFromAsic
(

5771 
IN
 
PRTMP_ADAPTER
 
pAd
,

5772 
IN
 
UCHAR
 
idx
,

5773 
OUT
 
PUCHAR
 
pTxTsc
);

5775 
MAC_TABLE_ENTRY
 *
PACInquy
(

5776 
IN
 
PRTMP_ADAPTER
 
pAd
,

5777 
IN
 
ULONG
 
Wcid
);

5779 
UINT
 
APVideRSNIE
(

5780 
IN
 
PRTMP_ADAPTER
 
pAd
,

5781 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

5782 
IN
 
PUCHAR
 
pRIe
,

5783 
IN
 
UCHAR
 
r_n
);

5785 
VOID
 
HdCouMsu
(

5786 
IN
 
PRTMP_ADAPTER
 
pAd
,

5787 
IN
 
MAC_TABLE_ENTRY
 *
pEry
);

5789 
VOID
 
WPAS4WayHS
(

5790 
IN
 
PRTMP_ADAPTER
 
pAd
,

5791 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

5792 
IN
 
ULONG
 
TimeIv
);

5794 
VOID
 
WPAS2WayGroupHS
(

5795 
IN
 
PRTMP_ADAPTER
 
pAd
,

5796 
IN
 
MAC_TABLE_ENTRY
 *
pEry
);

5798 
VOID
 
PrPaMsg1Ai
(

5799 
IN
 
PRTMP_ADAPTER
 
pAd
,

5800 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

5801 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5803 
VOID
 
PrPaMsg2Ai
(

5804 
IN
 
PRTMP_ADAPTER
 
pAd
,

5805 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

5806 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5808 
VOID
 
PrPaMsg3Ai
(

5809 
IN
 
PRTMP_ADAPTER
 
pAd
,

5810 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

5811 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5813 
VOID
 
PrPaMsg4Ai
(

5814 
IN
 
PRTMP_ADAPTER
 
pAd
,

5815 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

5816 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5818 
VOID
 
PrGroupMsg1Ai
(

5819 
IN
 
PRTMP_ADAPTER
 
pAd
,

5820 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

5821 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5823 
VOID
 
PrGroupMsg2Ai
(

5824 
IN
 
PRTMP_ADAPTER
 
pAd
,

5825 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

5826 
IN
 
VOID
 *
Msg
,

5827 
IN
 
UINT
 
MsgL
);

5829 
VOID
 
CMTimExec
(

5830 
IN
 
PVOID
 
SyemScific1
,

5831 
IN
 
PVOID
 
FuniCڋxt
,

5832 
IN
 
PVOID
 
SyemScific2
,

5833 
IN
 
PVOID
 
SyemScific3
);

5835 
VOID
 
WPARryExec
(

5836 
IN
 
PVOID
 
SyemScific1
,

5837 
IN
 
PVOID
 
FuniCڋxt
,

5838 
IN
 
PVOID
 
SyemScific2
,

5839 
IN
 
PVOID
 
SyemScific3
);

5842 
VOID
 
EnqueueSFPSKExec
(

5843 
IN
 
PVOID
 
SyemScific1
,

5844 
IN
 
PVOID
 
FuniCڋxt
,

5845 
IN
 
PVOID
 
SyemScific2
,

5846 
IN
 
PVOID
 
SyemScific3
);

5848 
VOID
 
RTMPHdSTAKey
(

5849 
IN
 
PRTMP_ADAPTER
 
pAdr
,

5850 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

5851 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

5853 
VOID
 
MlmeDeAuthAi
(

5854 
IN
 
PRTMP_ADAPTER
 
pAd
,

5855 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

5856 
IN
 
USHORT
 
Rs
,

5857 
IN
 
BOOLEAN
 
bDaFmeF
);

5859 
VOID
 
GREKEYPiodicExec
(

5860 
IN
 
PVOID
 
SyemScific1
,

5861 
IN
 
PVOID
 
FuniCڋxt
,

5862 
IN
 
PVOID
 
SyemScific2
,

5863 
IN
 
PVOID
 
SyemScific3
);

5865 
VOID
 
AES_128_CMAC
(

5866 
IN
 
PUCHAR
 
key
,

5867 
IN
 
PUCHAR
 
put
,

5868 
IN
 
INT
 
n
,

5869 
OUT
 
PUCHAR
 
mac
);

5871 #ifde
DOT1X_SUPPORT


5872 
VOID
 
WSd
(

5873 
IN
 
PRTMP_ADAPTER
 
pAdr
,

5874 
IN
 
PUCHAR
 
pPack
,

5875 
IN
 
ULONG
 
L
);

5877 
VOID
 
RTMPAddPMKIDCache
(

5878 
IN
 
PRTMP_ADAPTER
 
pAd
,

5879 
IN
 
INT
 
idx
,

5880 
IN
 
PUCHAR
 
pAddr
,

5881 
IN
 
UCHAR
 *
PMKID
,

5882 
IN
 
UCHAR
 *
PMK
);

5884 
INT
 
RTMPSrchPMKIDCache
(

5885 
IN
 
PRTMP_ADAPTER
 
pAd
,

5886 
IN
 
INT
 
idx
,

5887 
IN
 
PUCHAR
 
pAddr
);

5889 
VOID
 
RTMPDePMKIDCache
(

5890 
IN
 
PRTMP_ADAPTER
 
pAd
,

5891 
IN
 
INT
 
idx
,

5892 
IN
 
INT
 
idx
);

5894 
VOID
 
RTMPMaPMKIDCache
(

5895 
IN
 
PRTMP_ADAPTER
 
pAd
);

5897 
	#RTMPMaPMKIDCache
(
_pAd
)

	)

5901 
VOID
 
RTMP_SPiodicTim
(

5902 
IN
 
NDIS_MINIPORT_TIMER
 *
pTim
,

5903 
IN
 
timeout
);

5905 
VOID
 
RTMP_OS_In_Tim
(

5906 
IN
 
PRTMP_ADAPTER
 
pAd
,

5907 
IN
 
NDIS_MINIPORT_TIMER
 *
pTim
,

5908 
IN
 
TIMER_FUNCTION
 
funi
,

5909 
IN
 
PVOID
 
da
);

5911 
VOID
 
RTMP_OS_Add_Tim
(

5912 
IN
 
NDIS_MINIPORT_TIMER
 *
pTim
,

5913 
IN
 
timeout
);

5915 
VOID
 
RTMP_OS_Mod_Tim
(

5916 
IN
 
NDIS_MINIPORT_TIMER
 *
pTim
,

5917 
IN
 
timeout
);

5920 
VOID
 
RTMP_OS_D_Tim
(

5921 
IN
 
NDIS_MINIPORT_TIMER
 *
pTim
,

5922 
OUT
 
BOOLEAN
 *
pCed
);

5924 
VOID
 
RTMPucDay
(

5925 
IN
 
ULONG
 
uc
);

5927 
NDIS_STATUS
 
os_loc_mem
(

5928 
IN
 
RTMP_ADAPTER
 *
pAd
,

5929 
OUT
 
UCHAR
 **
mem
,

5930 
IN
 
ULONG
 
size
);

5932 
NDIS_STATUS
 
os__mem
(

5933 
IN
 
PRTMP_ADAPTER
 
pAd
,

5934 
IN
 
PVOID
 
mem
);

5937 #ifde
RESOURCE_PRE_ALLOC


5938 
VOID
 
RTMPRetTxRxRgMemy
(

5939 
IN
 
RTMP_ADAPTER
 *
pAd
);

5943 
VOID
 
RTMPFeTxRxRgMemy
(

5944 
IN
 
PRTMP_ADAPTER
 
pAd
);

5946 
NDIS_STATUS
 
AdrBlockAoMemy
(

5947 
IN
 
PVOID
 
hd
,

5948 
OUT
 
PVOID
 *
Ad
);

5950 
RTMP_AoTxDescMemy
(

5951 
IN
 
PRTMP_ADAPTER
 
pAd
,

5952 
IN
 
UINT
 
Index
,

5953 
IN
 
ULONG
 
Lgth
,

5954 
IN
 
BOOLEAN
 
Cached
,

5955 
OUT
 
PVOID
 *
VtuAddss
,

5956 
OUT
 
PNDIS_PHYSICAL_ADDRESS
 
PhysilAddss
);

5958 
RTMP_AoFTxBufr
(

5959 
IN
 
PRTMP_ADAPTER
 
pAd
,

5960 
IN
 
UINT
 
Index
,

5961 
IN
 
ULONG
 
Lgth
,

5962 
IN
 
BOOLEAN
 
Cached
,

5963 
OUT
 
PVOID
 *
VtuAddss
,

5964 
OUT
 
PNDIS_PHYSICAL_ADDRESS
 
PhysilAddss
);

5966 
RTMP_FeFTxBufr
(

5967 
IN
 
PRTMP_ADAPTER
 
pAd
,

5968 
IN
 
ULONG
 
Lgth
,

5969 
IN
 
BOOLEAN
 
Cached
,

5970 
IN
 
PVOID
 
VtuAddss
,

5971 
IN
 
NDIS_PHYSICAL_ADDRESS
 
PhysilAddss
);

5973 
RTMP_AoMgmtDescMemy
(

5974 
IN
 
PRTMP_ADAPTER
 
pAd
,

5975 
IN
 
ULONG
 
Lgth
,

5976 
IN
 
BOOLEAN
 
Cached
,

5977 
OUT
 
PVOID
 *
VtuAddss
,

5978 
OUT
 
PNDIS_PHYSICAL_ADDRESS
 
PhysilAddss
);

5980 
RTMP_AoRxDescMemy
(

5981 
IN
 
PRTMP_ADAPTER
 
pAd
,

5982 
IN
 
ULONG
 
Lgth
,

5983 
IN
 
BOOLEAN
 
Cached
,

5984 
OUT
 
PVOID
 *
VtuAddss
,

5985 
OUT
 
PNDIS_PHYSICAL_ADDRESS
 
PhysilAddss
);

5987 
RTMP_FeDescMemy
(

5988 
IN
 
PRTMP_ADAPTER
 
pAd
,

5989 
IN
 
ULONG
 
Lgth
,

5990 
IN
 
PVOID
 
VtuAddss
,

5991 
IN
 
NDIS_PHYSICAL_ADDRESS
 
PhysilAddss
);

5993 
PNDIS_PACKET
 
RtmpOSNPktAoc
(

5994 
IN
 
RTMP_ADAPTER
 *
pAd
,

5995 
IN
 
size
);

5997 
PNDIS_PACKET
 
RTMP_AoRxPackBufr
(

5998 
IN
 
PRTMP_ADAPTER
 
pAd
,

5999 
IN
 
ULONG
 
Lgth
,

6000 
IN
 
BOOLEAN
 
Cached
,

6001 
OUT
 
PVOID
 *
VtuAddss
,

6002 
OUT
 
PNDIS_PHYSICAL_ADDRESS
 
PhysilAddss
);

6004 
PNDIS_PACKET
 
RTMP_AoFgPackBufr
(

6005 
IN
 
PRTMP_ADAPTER
 
pAd
,

6006 
IN
 
ULONG
 
Lgth
);

6008 
RTMP_QuyPackInfo
(

6009 
IN
 
PNDIS_PACKET
 
pPack
,

6010 
OUT
 
PACKET_INFO
 *
pPackInfo
,

6011 
OUT
 
PUCHAR
 *
pSrcBufVA
,

6012 
OUT
 
UINT
 *
pSrcBufL
);

6014 
BOOLEAN
 
RTMP_FlTxBlkInfo
(

6015 
IN
 
RTMP_ADAPTER
 *
pAd
,

6016 
IN
 
TX_BLK
 *
pTxBlk
);

6019 
PRTMP_SCATTER_GATHER_LIST


6020 
_g_sg_li_om_ck
(
PNDIS_PACKET
 
pPack
, 
RTMP_SCATTER_GATHER_LIST
 *
sg
);

6023 
noun_802_3_ck
(

6024 
IN
 
PRTMP_ADAPTER
 
pAd
,

6025 
IN
 
PNDIS_PACKET
 
pPack
);

6027 #ifde
DOT11_N_SUPPORT


6028 
UINT
 
BA_Red_AMSDU_Anoun
(

6029 
IN
 
PRTMP_ADAPTER
 
pAd
,

6030 
IN
 
PNDIS_PACKET
 
pPack
);

6033 
PNET_DEV
 
g_tdev_om_bssid
(

6034 
IN
 
PRTMP_ADAPTER
 
pAd
,

6035 
IN
 
UCHAR
 
FromWhichBSSID
);

6038 
PNDIS_PACKET
 
dui_pkt
(

6039 
IN
 
PRTMP_ADAPTER
 
pAd
,

6040 
IN
 
PUCHAR
 
pHd802_3
,

6041 
IN
 
UINT
 
HdrL
,

6042 
IN
 
PUCHAR
 
pDa
,

6043 
IN
 
ULONG
 
DaSize
,

6044 
IN
 
UCHAR
 
FromWhichBSSID
);

6047 
PNDIS_PACKET
 
dui_pkt_wh_TKIP_MIC
(

6048 
IN
 
PRTMP_ADAPTER
 
pAd
,

6049 
IN
 
PNDIS_PACKET
 
pOldPkt
);

6051 
PNDIS_PACKET
 
dui_pkt_wh_VLAN
(

6052 
IN
 
PRTMP_ADAPTER
 
pAd
,

6053 
IN
 
PUCHAR
 
pHd802_3
,

6054 
IN
 
UINT
 
HdrL
,

6055 
IN
 
PUCHAR
 
pDa
,

6056 
IN
 
ULONG
 
DaSize
,

6057 
IN
 
UCHAR
 
FromWhichBSSID
,

6058 
IN
 
UCHAR
 *
TPID
);

6060 
BOOLEAN
 
RTMPL2FmeTxAi
(

6061 
IN
 
PRTMP_ADAPTER
 
pAd
,

6062 
IN
 
UCHAR
 
idx
,

6063 
IN
 
PUCHAR
 
pDa
,

6064 
IN
 
UINT32
 
da_n
);

6066 
PNDIS_PACKET
 
ExndPack
(

6067 
IN
 
PRTMP_ADAPTER
 
pAd
,

6068 
IN
 
PNDIS_PACKET
 
pPack
,

6069 
IN
 
UINT32
 
ext_hd_n
,

6070 
IN
 
UINT32
 
ext__n
);

6072 
UCHAR
 
VLAN_8023_Hd_Cy
(

6073 
IN
 
PRTMP_ADAPTER
 
pAd
,

6074 
IN
 
PUCHAR
 
pHd802_3
,

6075 
IN
 
UINT
 
HdrL
,

6076 
OUT
 
PUCHAR
 
pDa
,

6077 
IN
 
UCHAR
 
FromWhichBSSID
,

6078 
IN
 
UCHAR
 *
TPID
);

6080 #ifde
DOT11_N_SUPPORT


6081 
ba_ush_dg_timeout_mpdus
(

6082 
IN
 
PRTMP_ADAPTER
 
pAd
,

6083 
IN
 
PBA_REC_ENTRY
 
pBAEry
,

6084 
IN
 
ULONG
 
Now32
);

6087 
VOID
 
BAOriSessiSUp
(

6088 
IN
 
PRTMP_ADAPTER
 
pAd
,

6089 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

6090 
IN
 
UCHAR
 
TID
,

6091 
IN
 
USHORT
 
TimeOut
,

6092 
IN
 
ULONG
 
DayTime
,

6093 
IN
 
BOOLEAN
 
isFd
);

6095 
VOID
 
BASessiTrDownALL
(

6096 
IN
 
OUT
 
PRTMP_ADAPTER
 
pAd
,

6097 
IN
 
UCHAR
 
Wcid
);

6099 
VOID
 
BAOriSessiTrDown
(

6100 
IN
 
OUT
 
PRTMP_ADAPTER
 
pAd
,

6101 
IN
 
UCHAR
 
Wcid
,

6102 
IN
 
UCHAR
 
TID
,

6103 
IN
 
BOOLEAN
 
bPassive
,

6104 
IN
 
BOOLEAN
 
bFSd
);

6106 
VOID
 
BARecSessiTrDown
(

6107 
IN
 
OUT
 
PRTMP_ADAPTER
 
pAd
,

6108 
IN
 
UCHAR
 
Wcid
,

6109 
IN
 
UCHAR
 
TID
,

6110 
IN
 
BOOLEAN
 
bPassive
);

6113 
BOOLEAN
 
ba_dg_sour_
(
PRTMP_ADAPTER
 
pAd
, 
num
);

6114 
ba_dg_sour_a
(
PRTMP_ADAPTER
 
pAd
);

6116 
INT
 
CompuChecksum
(

6117 
IN
 
UINT
 
PIN
);

6119 
UINT
 
GeWpsPCode
(

6120 
IN
 
PRTMP_ADAPTER
 
pAd
,

6121 
IN
 
BOOLEAN
 
bFromApi
,

6122 
IN
 
UCHAR
 
idx
);

6126 #ifde
NINTENDO_AP


6127 
VOID
 
InNINTENDO_TABLE
(

6128 
IN
 
PRTMP_ADAPTER
 
pAd
);

6130 
UCHAR
 
CheckNINTENDO_TABLE
(

6131 
IN
 
PRTMP_ADAPTER
 
pAd
,

6132 
PCHAR
 
pDS_Ssid
,

6133 
UCHAR
 
DS_SsidL
,

6134 
PUCHAR
 
pDS_Addr
);

6136 
UCHAR
 
DNINTENDO_ENTRY
(

6137 
IN
 
PRTMP_ADAPTER
 
pAd
,

6138 
UCHAR
 * 
pDS_Addr
);

6140 
VOID
 
RTMPIolNndoCab
(

6141 
IN
 
PRTMP_ADAPTER
 
pAd
,

6142 
IN
 
iwq
 *
wrq
);

6144 
VOID
 
RTMPIolNndoGTab
(

6145 
IN
 
PRTMP_ADAPTER
 
pAd
,

6146 
IN
 
iwq
 *
wrq
);

6148 
VOID
 
RTMPIolNndoSTab
(

6149 
IN
 
PRTMP_ADAPTER
 
pAd
,

6150 
IN
 
iwq
 *
wrq
);

6154 
BOOLEAN
 
rmaohex
(

6155 
IN
 
PSTRING
 
s1
,

6156 
IN
 
PSTRING
 
s2
);

6158 
BOOLEAN
 
rcmp
(

6159 
IN
 
PSTRING
 
s1
,

6160 
IN
 
PSTRING
 
s2
);

6162 
PSTRING
 
rruncmp
(

6163 
IN
 
PSTRING
 
s1
,

6164 
IN
 
PSTRING
 
s2
);

6166 
PSTRING
 
rr
(

6167 
IN
 cڡ 
PSTRING
 
s1
,

6168 
IN
 cڡ 
PSTRING
 
s2
);

6170 
PSTRING
 
rok
(

6171 
IN
 
PSTRING
 
s
,

6172 
IN
 cڡ 
PSTRING
 

);

6174 
_
(

6175 cڡ 
PSTRING
 

,

6176 *
addr
);

6179 
INT
 
S_DrivVsi_Proc
(

6180 
IN
 
PRTMP_ADAPTER
 
pAd
,

6181 
IN
 
PSTRING
 
g
);

6183 
INT
 
S_CouryRegi_Proc
(

6184 
IN
 
PRTMP_ADAPTER
 
pAd
,

6185 
IN
 
PSTRING
 
g
);

6187 
INT
 
S_CouryRegiABd_Proc
(

6188 
IN
 
PRTMP_ADAPTER
 
pAd
,

6189 
IN
 
PSTRING
 
g
);

6191 
INT
 
S_WessMode_Proc
(

6192 
IN
 
PRTMP_ADAPTER
 
pAd
,

6193 
IN
 
PSTRING
 
g
);

6195 
INT
 
S_MBSS_WessMode_Proc
(

6196 
IN
 
PRTMP_ADAPTER
 
pAd
,

6197 
IN
 
PSTRING
 
g
);

6199 
INT
 
S_Chl_Proc
(

6200 
IN
 
PRTMP_ADAPTER
 
pAd
,

6201 
IN
 
PSTRING
 
g
);

6203 
INT
 
S_ShtSl_Proc
(

6204 
IN
 
PRTMP_ADAPTER
 
pAd
,

6205 
IN
 
PSTRING
 
g
);

6207 
INT
 
S_TxPow_Proc
(

6208 
IN
 
PRTMP_ADAPTER
 
pAd
,

6209 
IN
 
PSTRING
 
g
);

6211 
INT
 
S_BGPrei_Proc
(

6212 
IN
 
PRTMP_ADAPTER
 
pAd
,

6213 
IN
 
PSTRING
 
g
);

6215 
INT
 
S_TxPamb_Proc
(

6216 
IN
 
PRTMP_ADAPTER
 
pAd
,

6217 
IN
 
PSTRING
 
g
);

6219 
INT
 
S_RTSThshd_Proc
(

6220 
IN
 
PRTMP_ADAPTER
 
pAd
,

6221 
IN
 
PSTRING
 
g
);

6223 
INT
 
S_FgThshd_Proc
(

6224 
IN
 
PRTMP_ADAPTER
 
pAd
,

6225 
IN
 
PSTRING
 
g
);

6227 
INT
 
S_TxBur_Proc
(

6228 
IN
 
PRTMP_ADAPTER
 
pAd
,

6229 
IN
 
PSTRING
 
g
);

6231 #ifde
RTMP_MAC_PCI


6232 
INT
 
S_ShowRF_Proc
(

6233 
IN
 
PRTMP_ADAPTER
 
pAd
,

6234 
IN
 
PSTRING
 
g
);

6237 #ifde
AGGREGATION_SUPPORT


6238 
INT
 
S_PktAggge_Proc
(

6239 
IN
 
PRTMP_ADAPTER
 
pAd
,

6240 
IN
 
PSTRING
 
g
);

6243 #ifde
INF_PPA_SUPPORT


6244 
INT
 
S_INF_AMAZON_SE_PPA_Proc
(

6245 
IN
 
PRTMP_ADAPTER
 
pAd
,

6246 
IN
 
PUCHAR
 
g
);

6250 
INT
 
S_IEEE80211H_Proc
(

6251 
IN
 
PRTMP_ADAPTER
 
pAd
,

6252 
IN
 
PSTRING
 
g
);

6254 #ifde
DBG


6255 
INT
 
S_Debug_Proc
(

6256 
IN
 
PRTMP_ADAPTER
 
pAd
,

6257 
IN
 
PSTRING
 
g
);

6261 
INT
 
Show_DescInfo_Proc
(

6262 
IN
 
PRTMP_ADAPTER
 
pAd
,

6263 
IN
 
PSTRING
 
g
);

6265 
INT
 
S_RetStCou_Proc
(

6266 
IN
 
PRTMP_ADAPTER
 
pAd
,

6267 
IN
 
PSTRING
 
g
);

6269 #ifde
DOT11_N_SUPPORT


6270 
INT
 
S_BASup_Proc
(

6271 
IN
 
PRTMP_ADAPTER
 
pAd
,

6272 
IN
 
PSTRING
 
g
);

6274 
INT
 
S_BADee_Proc
(

6275 
IN
 
PRTMP_ADAPTER
 
pAd
,

6276 
IN
 
PSTRING
 
g
);

6278 
INT
 
S_BAOriTrDown_Proc
(

6279 
IN
 
PRTMP_ADAPTER
 
pAd
,

6280 
IN
 
PSTRING
 
g
);

6282 
INT
 
S_BARecTrDown_Proc
(

6283 
IN
 
PRTMP_ADAPTER
 
pAd
,

6284 
IN
 
PSTRING
 
g
);

6286 
INT
 
S_HtBw_Proc
(

6287 
IN
 
PRTMP_ADAPTER
 
pAd
,

6288 
IN
 
PSTRING
 
g
);

6290 
INT
 
S_HtMcs_Proc
(

6291 
IN
 
PRTMP_ADAPTER
 
pAd
,

6292 
IN
 
PSTRING
 
g
);

6294 
INT
 
S_HtGi_Proc
(

6295 
IN
 
PRTMP_ADAPTER
 
pAd
,

6296 
IN
 
PSTRING
 
g
);

6298 
INT
 
S_HtOpMode_Proc
(

6299 
IN
 
PRTMP_ADAPTER
 
pAd
,

6300 
IN
 
PSTRING
 
g
);

6302 
INT
 
S_HtStbc_Proc
(

6303 
IN
 
PRTMP_ADAPTER
 
pAd
,

6304 
IN
 
PSTRING
 
g
);

6306 
INT
 
S_HtHtc_Proc
(

6307 
IN
 
PRTMP_ADAPTER
 
pAd
,

6308 
IN
 
PSTRING
 
g
);

6310 
INT
 
S_HtExtcha_Proc
(

6311 
IN
 
PRTMP_ADAPTER
 
pAd
,

6312 
IN
 
PSTRING
 
g
);

6314 
INT
 
S_HtMpduDsy_Proc
(

6315 
IN
 
PRTMP_ADAPTER
 
pAd
,

6316 
IN
 
PSTRING
 
g
);

6318 
INT
 
S_HtBaWSize_Proc
(

6319 
IN
 
PRTMP_ADAPTER
 
pAd
,

6320 
IN
 
PSTRING
 
g
);

6322 
INT
 
S_HtRdg_Proc
(

6323 
IN
 
PRTMP_ADAPTER
 
pAd
,

6324 
IN
 
PSTRING
 
g
);

6326 
INT
 
S_HtLkAdt_Proc
(

6327 
IN
 
PRTMP_ADAPTER
 
pAd
,

6328 
IN
 
PSTRING
 
g
);

6330 
INT
 
S_HtAmsdu_Proc
(

6331 
IN
 
PRTMP_ADAPTER
 
pAd
,

6332 
IN
 
PSTRING
 
g
);

6334 
INT
 
S_HtAutoBa_Proc
(

6335 
IN
 
PRTMP_ADAPTER
 
pAd
,

6336 
IN
 
PSTRING
 
g
);

6338 
INT
 
S_HtPre_Proc
(

6339 
IN
 
PRTMP_ADAPTER
 
pAd
,

6340 
IN
 
PSTRING
 
g
);

6342 
INT
 
S_HtMimoPs_Proc
(

6343 
IN
 
PRTMP_ADAPTER
 
pAd
,

6344 
IN
 
PSTRING
 
g
);

6346 #ifde
DOT11N_DRAFT3


6347 
INT
 
S_HT_BssCx_Proc
(

6348 
IN
 
PRTMP_ADAPTER
 
pAd
,

6349 
IN
 
PSTRING
 
pPam
);

6351 
INT
 
S_HT_BssCxApCThr_Proc
(

6352 
IN
 
PRTMP_ADAPTER
 
pAd
,

6353 
IN
 
PSTRING
 
pPam
);

6358 
INT
 
S_FShtGI_Proc
(

6359 
IN
 
PRTMP_ADAPTER
 
pAd
,

6360 
IN
 
PSTRING
 
g
);

6362 
INT
 
S_FGF_Proc
(

6363 
IN
 
PRTMP_ADAPTER
 
pAd
,

6364 
IN
 
PSTRING
 
g
);

6366 
INT
 
SCommHT
(

6367 
IN
 
PRTMP_ADAPTER
 
pAd
);

6369 
INT
 
S_SdPSMPAi_Proc
(

6370 
IN
 
PRTMP_ADAPTER
 
pAd
,

6371 
IN
 
PSTRING
 
g
);

6373 
INT
 
S_HtMIMOPSmode_Proc
(

6374 
IN
 
PRTMP_ADAPTER
 
pAd
,

6375 
IN
 
PSTRING
 
g
);

6378 
INT
 
S_HtTxBASize_Proc
(

6379 
IN
 
PRTMP_ADAPTER
 
pAd
,

6380 
IN
 
PSTRING
 
g
);

6382 
INT
 
S_HtDiowTKIP_Proc
(

6383 
IN
 
PRTMP_ADAPTER
 
pAd
,

6384 
IN
 
PSTRING
 
g
);

6392 #ifde
CONFIG_STA_SUPPORT


6394 
VOID
 
RTMPSdDLSTrDownFme
(

6395 
IN
 
PRTMP_ADAPTER
 
pAd
,

6396 
IN
 
PUCHAR
 
pDA
);

6398 #ifde
DOT11_N_SUPPORT


6400 
VOID
 
QuyBATABLE
(

6401 
IN
 
PRTMP_ADAPTER
 
pAd
,

6402 
OUT
 
PQUERYBA_TABLE
 
pBAT
);

6405 #ifde
WPA_SUPPLICANT_SUPPORT


6406 
INT
 
WCheckECode
(

6407 
IN
 
PRTMP_ADAPTER
 
pAd
,

6408 
IN
 
PUCHAR
 
pFme
,

6409 
IN
 
USHORT
 
FmeL
,

6410 
IN
 
USHORT
 
OffS
);

6412 
VOID
 
WSdMicFauToWSuli
(

6413 
IN
 
PRTMP_ADAPTER
 
pAd
,

6414 
IN
 
BOOLEAN
 
bUni
);

6416 
VOID
 
SdAssocIEsToWSuli
(

6417 
IN
 
PRTMP_ADAPTER
 
pAd
);

6420 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


6421 
wext_nify_evt_assoc
(

6422 
IN
 
RTMP_ADAPTER
 *
pAd
);

6429 #ifde
DOT11_N_SUPPORT


6430 
VOID
 
Hd_BSS_Width_Trigg_Evts
(

6431 
IN
 
PRTMP_ADAPTER
 
pAd
);

6433 
bud_ext_chl_swch_
(

6434 
IN
 
PRTMP_ADAPTER
 
pAd
,

6435 
IN
 
HT_EXT_CHANNEL_SWITCH_ANNOUNCEMENT_IE
 *
pIE
);

6439 
BOOLEAN
 
APRxDeIruHd
(

6440 
IN
 
PRTMP_ADAPTER
 
pAd
);

6442 
BOOLEAN
 
STARxDeIruHd
(

6443 
IN
 
PRTMP_ADAPTER
 
pAd
,

6444 
IN
 
BOOLEAN
 
gc
);

6446 #ifde
DOT11_N_SUPPORT


6448 
VOID
 
Indi_AMPDU_Pack
(

6449 
IN
 
PRTMP_ADAPTER
 
pAd
,

6450 
IN
 
RX_BLK
 *
pRxBlk
,

6451 
IN
 
UCHAR
 
FromWhichBSSID
);

6454 
VOID
 
Indi_AMSDU_Pack
(

6455 
IN
 
PRTMP_ADAPTER
 
pAd
,

6456 
IN
 
RX_BLK
 *
pRxBlk
,

6457 
IN
 
UCHAR
 
FromWhichBSSID
);

6461 
VOID
 
Indi_Legacy_Pack
(

6462 
IN
 
PRTMP_ADAPTER
 
pAd
,

6463 
IN
 
RX_BLK
 *
pRxBlk
,

6464 
IN
 
UCHAR
 
FromWhichBSSID
);

6466 
VOID
 
Indi_EAPOL_Pack
(

6467 
IN
 
PRTMP_ADAPTER
 
pAd
,

6468 
IN
 
RX_BLK
 *
pRxBlk
,

6469 
IN
 
UCHAR
 
FromWhichBSSID
);

6471 
upde_os_ck_fo
(

6472 
IN
 
PRTMP_ADAPTER
 
pAd
,

6473 
IN
 
RX_BLK
 *
pRxBlk
,

6474 
IN
 
UCHAR
 
FromWhichBSSID
);

6476 
wn_802_11_to_802_3_ck
(

6477 
IN
 
PRTMP_ADAPTER
 
pAd
,

6478 
IN
 
RX_BLK
 *
pRxBlk
,

6479 
IN
 
PUCHAR
 
pHd802_3
,

6480 
IN
 
UCHAR
 
FromWhichBSSID
,

6481 
IN
 
UCHAR
 *
TPID
);

6483 
UINT
 
dggge_AMSDU_noun
(

6484 
IN
 
PRTMP_ADAPTER
 
pAd
,

6485 
PNDIS_PACKET
 
pPack
,

6486 
IN
 
PUCHAR
 
pDa
,

6487 
IN
 
ULONG
 
DaSize
);

6491 #ifde
CONFIG_STA_SUPPORT


6493 
	#RTMP_802_11_REMOVE_LLC_AND_CONVERT_TO_802_3
(
_pRxBlk
, 
_pHd802_3
) \

6495 
PUCHAR
 
_pRemovedLLCSNAP
 = 
NULL
, 
_pDA
, 
_pSA
; \

6497 i(
	`RX_BLK_TEST_FLAG
(
_pRxBlk
, 
fRX_WDS
|| RX_BLK_TEST_FLAG(_pRxBlk, 
fRX_MESH
)) \

6499 
_pDA
 = 
_pRxBlk
->
pHd
->
Addr3
; \

6500 
_pSA
 = (
PUCHAR
)
_pRxBlk
->
pHd
 + (
HEADER_802_11
); \

6504 i(
	`RX_BLK_TEST_FLAG
(
_pRxBlk
, 
fRX_INFRA
)) \

6506 
_pDA
 = 
_pRxBlk
->
pHd
->
Addr1
; \

6507 i(
	`RX_BLK_TEST_FLAG
(
_pRxBlk
, 
fRX_DLS
)) \

6508 
_pSA
 = 
_pRxBlk
->
pHd
->
Addr2
; \

6510 
_pSA
 = 
_pRxBlk
->
pHd
->
Addr3
; \

6514 
_pDA
 = 
_pRxBlk
->
pHd
->
Addr1
; \

6515 
_pSA
 = 
_pRxBlk
->
pHd
->
Addr2
; \

6519 
	`CONVERT_TO_802_3
(
_pHd802_3
, 
_pDA
, 
_pSA
, 
_pRxBlk
->
pDa
, \

6520 
_pRxBlk
->
DaSize
, 
_pRemovedLLCSNAP
); \

6521 }

	)

6525 
BOOLEAN
 
APFowdWessSToWessS
(

6526 
IN
 
PRTMP_ADAPTER
 
pAd
,

6527 
IN
 
PNDIS_PACKET
 
pPack
,

6528 
IN
 
ULONG
 
FromWhichBSSID
);

6530 
VOID
 
Aoun__Fwd_802_3_Pack
(

6531 
IN
 
PRTMP_ADAPTER
 
pAd
,

6532 
IN
 
PNDIS_PACKET
 
pPack
,

6533 
IN
 
UCHAR
 
FromWhichBSSID
);

6535 
VOID
 
S_Aoun__Fwd_802_3_Pack
(

6536 
IN
 
PRTMP_ADAPTER
 
pAd
,

6537 
IN
 
PNDIS_PACKET
 
pPack
,

6538 
IN
 
UCHAR
 
FromWhichBSSID
);

6541 #ifde
CONFIG_STA_SUPPORT


6542 
	#ANNOUNCE_OR_FORWARD_802_3_PACKET
(
_pAd
, 
_pPack
, 
_FromWhichBSS
)\

6543 
	`S_Aoun__Fwd_802_3_Pack
(
_pAd
, 
_pPack
, 
_FromWhichBSS
);

	)

6548 
PNDIS_PACKET
 
DuiPack
(

6549 
IN
 
PRTMP_ADAPTER
 
pAd
,

6550 
IN
 
PNDIS_PACKET
 
pPack
,

6551 
IN
 
UCHAR
 
FromWhichBSSID
);

6554 
PNDIS_PACKET
 
ClePack
(

6555 
IN
 
PRTMP_ADAPTER
 
pAd
,

6556 
IN
 
PNDIS_PACKET
 
pPack
,

6557 
IN
 
PUCHAR
 
pDa
,

6558 
IN
 
ULONG
 
DaSize
);

6562 
VOID
 
CmmRxnRkFmeIndi
(

6563 
IN
 
PRTMP_ADAPTER
 
pAd
,

6564 
IN
 
RX_BLK
 *
pRxBlk
,

6565 
IN
 
UCHAR
 
FromWhichBSSID
);

6567 
VOID
 
CmmRxRkFmeIndi
(

6568 
IN
 
PRTMP_ADAPTER
 
pAd
,

6569 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

6570 
IN
 
RX_BLK
 *
pRxBlk
,

6571 
IN
 
UCHAR
 
FromWhichBSSID
);

6573 
VOID
 
Upde_Rssi_Same
(

6574 
IN
 
PRTMP_ADAPTER
 
pAd
,

6575 
IN
 
RSSI_SAMPLE
 *
pRssi
,

6576 
IN
 
PRXWI_STRUC
 
pRxWI
);

6578 
PNDIS_PACKET
 
GPackFromRxRg
(

6579 
IN
 
PRTMP_ADAPTER
 
pAd
,

6580 
OUT
 
PRT28XX_RXD_STRUC
 
pSaveRxD
,

6581 
OUT
 
BOOLEAN
 *
pbReschedu
,

6582 
IN
 
OUT
 
UINT32
 *
pRxPdg
);

6584 
PNDIS_PACKET
 
RTMPDeFgmtDaFme
(

6585 
IN
 
PRTMP_ADAPTER
 
pAd
,

6586 
IN
 
RX_BLK
 *
pRxBlk
);

6590 #i
defed
 (
AP_SCAN_SUPPORT
|| defed (
CONFIG_STA_SUPPORT
)

6591 
VOID
 
RTMPIolGSeSurvey
(

6592 
IN
 
PRTMP_ADAPTER
 
pAdr
,

6593 
IN
 
iwq
 *
wrq
);

6600 #ifde
SNMP_SUPPORT


6602 
	s_DeuKeyIdxVue


6604 
UCHAR
 
	mKeyIdx
;

6605 
UCHAR
 
	mVue
[16];

6606 } 
	tDeuKeyIdxVue
, *
	tPDeuKeyIdxVue
;

6610 #ifde
CONFIG_STA_SUPPORT


6612 
	mDIDmsg_xd_wnifm
 = 0x00000044,

6613 
	mDIDmsg_xd_wnifm_hotime
 = 0x00010044,

6614 
	mDIDmsg_xd_wnifm_maime
 = 0x00020044,

6615 
	mDIDmsg_xd_wnifm_chl
 = 0x00030044,

6616 
	mDIDmsg_xd_wnifm_rssi
 = 0x00040044,

6617 
	mDIDmsg_xd_wnifm_sq
 = 0x00050044,

6618 
	mDIDmsg_xd_wnifm_sigl
 = 0x00060044,

6619 
	mDIDmsg_xd_wnifm_noi
 = 0x00070044,

6620 
	mDIDmsg_xd_wnifm_
 = 0x00080044,

6621 
	mDIDmsg_xd_wnifm_ix
 = 0x00090044,

6622 
	mDIDmsg_xd_wnifm_mn
 = 0x000A0044

6625 
	mP80211ENUM_msgem_us_no_vue
 = 0x00

6628 
	mP80211ENUM_uth_l
 = 0x00,

6629 
	mP80211ENUM_uth_ue
 = 0x01

6634 
UINT32
 
	mdid
;

6635 
UINT16
 
	mus
;

6636 
UINT16
 
	mn
;

6637 
UINT32
 
	mda
;

6638 } 
	tp80211em_ut32_t
;

6641 
UINT32
 
	mmsgcode
;

6642 
UINT32
 
	mmsgn
;

6643 
	#WLAN_DEVNAMELEN_MAX
 16

	)

6644 
UINT8
 
	mdevme
[
WLAN_DEVNAMELEN_MAX
];

6645 
p80211em_ut32_t
 
	mhotime
;

6646 
p80211em_ut32_t
 
	mmaime
;

6647 
p80211em_ut32_t
 
	mchl
;

6648 
p80211em_ut32_t
 
	mrssi
;

6649 
p80211em_ut32_t
 
	msq
;

6650 
p80211em_ut32_t
 
	msigl
;

6651 
p80211em_ut32_t
 
	mnoi
;

6652 
p80211em_ut32_t
 
	m
;

6653 
p80211em_ut32_t
 
	mix
;

6654 
p80211em_ut32_t
 
	mmn
;

6655 } 
	twn_ng_ism2_hd
;

6657 #ifde
MONITOR_FLAG_11N_SNIFFER_SUPPORT


6677 #ifde
RT_BIG_ENDIAN


6678 
	s_ETHEREAL_RADIO
 {

6679 
UCHAR
 
	mFg_80211n
;

6680 
UCHAR
 
	msigl_v
;

6681 
UCHAR
 
	mda_
;

6682 
UCHAR
 
	mchl
;

6683 } 
	tETHEREAL_RADIO
, *
	tPETHEREAL_RADIO
;

6685 
	s_ETHEREAL_RADIO
 {

6686 
UCHAR
 
	mchl
;

6687 
UCHAR
 
	mda_
;

6688 
UCHAR
 
	msigl_v
;

6689 
UCHAR
 
	mFg_80211n
;

6690 } 
	tETHEREAL_RADIO
, *
	tPETHEREAL_RADIO
;

6693 
	#WIRESHARK_11N_FLAG_3x3
 0x01

	)

6694 
	#WIRESHARK_11N_FLAG_GF
 0x02

	)

6695 
	#WIRESHARK_11N_FLAG_AMPDU
 0x04

	)

6696 
	#WIRESHARK_11N_FLAG_STBC
 0x08

	)

6697 
	#WIRESHARK_11N_FLAG_SGI
 0x10

	)

6698 
	#WIRESHARK_11N_FLAG_BW20U
 0x20

	)

6699 
	#WIRESHARK_11N_FLAG_BW20D
 0x40

	)

6700 
	#WIRESHARK_11N_FLAG_BW40
 0x80

	)

6704 
GNU_PACKED
 
	t_80211_di٭_hd
 {

6705 
UINT8
 
	g_vsi
;

6710 
UINT8
 
	g_d
;

6711 
UINT16
 
	g_n
;

6716 
UINT32
 
	g_e
;

6723 }
	t80211_di٭_hd
 ;

6725 
	e80211_di٭_ty
 {

6726 
	mIEEE80211_RADIOTAP_TSFT
 = 0,

6727 
	mIEEE80211_RADIOTAP_FLAGS
 = 1,

6728 
	mIEEE80211_RADIOTAP_RATE
 = 2,

6729 
	mIEEE80211_RADIOTAP_CHANNEL
 = 3,

6730 
	mIEEE80211_RADIOTAP_FHSS
 = 4,

6731 
	mIEEE80211_RADIOTAP_DBM_ANTSIGNAL
 = 5,

6732 
	mIEEE80211_RADIOTAP_DBM_ANTNOISE
 = 6,

6733 
	mIEEE80211_RADIOTAP_LOCK_QUALITY
 = 7,

6734 
	mIEEE80211_RADIOTAP_TX_ATTENUATION
 = 8,

6735 
	mIEEE80211_RADIOTAP_DB_TX_ATTENUATION
 = 9,

6736 
	mIEEE80211_RADIOTAP_DBM_TX_POWER
 = 10,

6737 
	mIEEE80211_RADIOTAP_ANTENNA
 = 11,

6738 
	mIEEE80211_RADIOTAP_DB_ANTSIGNAL
 = 12,

6739 
	mIEEE80211_RADIOTAP_DB_ANTNOISE
 = 13

6742 
	#WLAN_RADIOTAP_PRESENT
 ( \

6743 (1 << 
IEEE80211_RADIOTAP_TSFT
) | \

6744 (1 << 
IEEE80211_RADIOTAP_FLAGS
) | \

6745 (1 << 
IEEE80211_RADIOTAP_RATE
) | \

6746 0)

	)

6748 
	s_wn_di٭_hd
 {

6749 
80211_di٭_hd
 
	mwt_ihdr
;

6750 
INT64
 
	mwt_ts
;

6751 
UINT8
 
	mwt_ags
;

6752 
UINT8
 
	mwt_
;

6753 } 
	twn_di٭_hd
;

6757 
nd_mڙ_cks
(

6758 
IN
 
PRTMP_ADAPTER
 
pAd
,

6759 
IN
 
RX_BLK
 *
pRxBlk
,

6760 
IN
 
	$CHAR
 (*
RTMPMaxRssi
)(

6761 
IN
 
PRTMP_ADAPTER
 
pAd
,

6762 
IN
 
CHAR
 
Rssi0
,

6763 
IN
 
CHAR
 
Rssi1
,

6764 
IN
 
CHAR
 
Rssi2
),

6765 
IN
 
	$CHAR
 (*
CvtToRssi
)(

6766 
IN
 
PRTMP_ADAPTER
 
pAd
,

6767 
IN
 
CHAR
 
Rssi
,

6768 
IN
 
UCHAR
 
RssiNumb
));

6771 
VOID
 
	`RTMPSDesedRes
(

6772 
IN
 
PRTMP_ADAPTER
 
pAdr
,

6773 
IN
 
LONG
 
Res
);

6775 #ifde
XLINK_SUPPORT


6776 
INT
 
	`S_XlkMode_Proc
(

6777 
IN
 
PRTMP_ADAPTER
 
pAdr
,

6778 
IN
 
PSTRING
 
g
);

6782 
INT
 
	`S_FixedTxMode_Proc
(

6783 
IN
 
PRTMP_ADAPTER
 
pAd
,

6784 
IN
 
PSTRING
 
g
);

6786 #ifde
CONFIG_APSTA_MIXED_SUPPORT


6787 
INT
 
	`S_OpMode_Proc
(

6788 
IN
 
PRTMP_ADAPTER
 
pAd
,

6789 
IN
 
PSTRING
 
g
);

6792 
INT
 
	`S_LgRryLim_Proc
(

6793 
IN
 
PRTMP_ADAPTER
 
pAdr
,

6794 
IN
 
PSTRING
 
g
);

6796 
INT
 
	`S_ShtRryLim_Proc
(

6797 
IN
 
PRTMP_ADAPTER
 
pAdr
,

6798 
IN
 
PSTRING
 
g
);

6800 
INT
 
	`S_AutoFlBack_Proc
(

6801 
IN
 
PRTMP_ADAPTER
 
pAdr
,

6802 
IN
 
PSTRING
 
g
);

6806 
VOID
 
	`RT28XXDMADib
(

6807 
IN
 
RTMP_ADAPTER
 *
pAd
);

6809 
VOID
 
	`RT28XXDMAEb
(

6810 
IN
 
RTMP_ADAPTER
 *
pAd
);

6812 
VOID
 
	`RT28xx_UpdeBcToAsic
(

6813 
IN
 
RTMP_ADAPTER
 * 
pAd
,

6814 
IN
 
INT
 
idx
,

6815 
IN
 
ULONG
 
BcL
,

6816 
IN
 
ULONG
 
UpdePos
);

6818 
	`CfgInHook
(
PRTMP_ADAPTER
 
pAd
);

6820 
	`28xx_
(

6821 
IN
 
PRTMP_ADAPTER
 
pAd
,

6822 
IN
 
PSTRING
 
pDeuMac
,

6823 
IN
 
PSTRING
 
pHoName
);

6825 
NDIS_STATUS
 
	`RtmpNTaskIn
(

6826 
IN
 
RTMP_ADAPTER
 *
pAd
);

6828 
VOID
 
	`RtmpNTaskEx
(

6829 
IN
 
PRTMP_ADAPTER
 
pAd
);

6831 
NDIS_STATUS
 
	`RtmpMgmtTaskIn
(

6832 
IN
 
RTMP_ADAPTER
 *
pAd
);

6834 
VOID
 
	`RtmpMgmtTaskEx
(

6835 
IN
 
RTMP_ADAPTER
 *
pAd
);

6837 #ifde
WORKQUEUE_BH


6838 
	`tb_wkq
(
wk_ru
 *
wk
);

6840 
	`tb_skt
(
da
);

6844 
PNET_DEV
 
	`RtmpPhyNDevIn
(

6845 
IN
 
RTMP_ADAPTER
 *
pAd
,

6846 
IN
 
RTMP_OS_NETDEV_OP_HOOK
 *
pNHook
);

6848 
BOOLEAN
 
	`RtmpPhyNDevEx
(

6849 
IN
 
RTMP_ADAPTER
 *
pAd
,

6850 
IN
 
PNET_DEV
 
t_dev
);

6852 
INT
 
	`RtmpRaDevClIn
(

6853 
IN
 
RTMP_ADAPTER
 *
pAd
,

6854 
IN
 
RTMP_INF_TYPE
 
fTy
);

6856 
BOOLEAN
 
	`RtmpRaDevClEx
(

6857 
IN
 
RTMP_ADAPTER
 *
pAd
);

6860 #ifde
RTMP_MAC_PCI


6864 
USHORT
 
	`RtmpPCI_WreSgTxResour
(

6865 
IN
 
PRTMP_ADAPTER
 
pAd
,

6866 
IN
 
TX_BLK
 *
pTxBlk
,

6867 
IN
 
BOOLEAN
 
bIsLa
,

6868 
OUT
 
USHORT
 *
FeNumb
);

6870 
USHORT
 
	`RtmpPCI_WreMuiTxResour
(

6871 
IN
 
PRTMP_ADAPTER
 
pAd
,

6872 
IN
 
TX_BLK
 *
pTxBlk
,

6873 
IN
 
UCHAR
 
ameNum
,

6874 
OUT
 
USHORT
 *
FeNumb
);

6876 
USHORT
 
	`RtmpPCI_WreFgTxResour
(

6877 
IN
 
PRTMP_ADAPTER
 
pAd
,

6878 
IN
 
TX_BLK
 *
pTxBlk
,

6879 
IN
 
UCHAR
 
agNum
,

6880 
OUT
 
USHORT
 *
FeNumb
);

6882 
VOID
 
	`RtmpPCI_FWreTxResour
(

6883 
IN
 
PRTMP_ADAPTER
 
pAd
,

6884 
IN
 
TX_BLK
 *
pTxBlk
,

6885 
IN
 
USHORT
 
tٮMPDUSize
,

6886 
IN
 
USHORT
 
FTxIdx
);

6888 
	`RtmpPCIMgmtKickOut
(

6889 
IN
 
RTMP_ADAPTER
 *
pAd
,

6890 
IN
 
UCHAR
 
QueIdx
,

6891 
IN
 
PNDIS_PACKET
 
pPack
,

6892 
IN
 
PUCHAR
 
pSrcBufVA
,

6893 
IN
 
UINT
 
SrcBufL
);

6896 
NDIS_STATUS
 
	`RTMPCheckRxE
(

6897 
IN
 
PRTMP_ADAPTER
 
pAd
,

6898 
IN
 
PHEADER_802_11
 
pHd
,

6899 
IN
 
PRXWI_STRUC
 
pRxWI
,

6900 
IN
 
PRT28XX_RXD_STRUC
 
pRxD
);

6902 
BOOLEAN
 
	`RT28xxPciAsicRadioOff
(

6903 
IN
 
PRTMP_ADAPTER
 
pAd
,

6904 
IN
 
UCHAR
 
Lev
,

6905 
IN
 
USHORT
 
TbNumToNextWakeUp
);

6907 
BOOLEAN
 
	`RT28xxPciAsicRadioOn
(

6908 
IN
 
PRTMP_ADAPTER
 
pAd
,

6909 
IN
 
UCHAR
 
Lev
);

6911 #ifde
CONFIG_STA_SUPPORT


6912 #ifde
PCIE_PS_SUPPORT


6913 
VOID
 
	`RTMPInPCIeLkClVue
(

6914 
IN
 
PRTMP_ADAPTER
 
pAd
);

6916 
VOID
 
	`RTMPFdHoPCIDev
(

6917 
IN
 
PRTMP_ADAPTER
 
pAd
);

6919 
VOID
 
	`RTMPPCIeLkClVueRee
(

6920 
IN
 
PRTMP_ADAPTER
 
pAd
,

6921 
IN
 
UCHAR
 
Lev
);

6923 
VOID
 
	`RTMPPCIeLkClStg
(

6924 
IN
 
PRTMP_ADAPTER
 
pAd
,

6925 
IN
 
USHORT
 
Max
);

6927 
VOID
 
	`RTMP3xSPCIePowLkCl
(

6928 
IN
 
PRTMP_ADAPTER
 
pAd
);

6930 
VOID
 
	`PsPlWakeExec
(

6931 
IN
 
PVOID
 
SyemScific1
,

6932 
IN
 
PVOID
 
FuniCڋxt
,

6933 
IN
 
PVOID
 
SyemScific2
,

6934 
IN
 
PVOID
 
SyemScific3
);

6936 
VOID
 
	`RadioOnExec
(

6937 
IN
 
PVOID
 
SyemScific1
,

6938 
IN
 
PVOID
 
FuniCڋxt
,

6939 
IN
 
PVOID
 
SyemScific2
,

6940 
IN
 
PVOID
 
SyemScific3
);

6943 
VOID
 
	`RT28xxPciSAsicFWakeup
(

6944 
IN
 
PRTMP_ADAPTER
 
pAd
,

6945 
IN
 
BOOLEAN
 
bFromTx
);

6947 
VOID
 
	`RT28xxPciSAsicS˕ThAutoWakeup
(

6948 
IN
 
PRTMP_ADAPTER
 
pAd
,

6949 
IN
 
USHORT
 
TbNumToNextWakeUp
);

6953 
VOID
 
	`RT28xxPciMlmeRadioOn
(

6954 
IN
 
PRTMP_ADAPTER
 
pAd
);

6956 
VOID
 
	`RT28xxPciMlmeRadioOFF
(

6957 
IN
 
PRTMP_ADAPTER
 
pAd
);

6960 
VOID
 
	`AsicTuOffRFClk
(

6961 
IN
 
PRTMP_ADAPTER
 
pAd
,

6962 
IN
 
UCHAR
 
Chl
);

6966 #ifde
RTMP_TIMER_TASK_SUPPORT


6967 
INT
 
	`RtmpTimQThad
(

6968 
IN
 
ULONG
 
Cڋxt
);

6970 
RTMP_TIMER_TASK_ENTRY
 *
	`RtmpTimQIn
(

6971 
IN
 
RTMP_ADAPTER
 *
pAd
,

6972 
IN
 
RALINK_TIMER_STRUCT
 *
pTim
);

6974 
BOOLEAN
 
	`RtmpTimQRemove
(

6975 
IN
 
RTMP_ADAPTER
 *
pAd
,

6976 
IN
 
RALINK_TIMER_STRUCT
 *
pTim
);

6978 
	`RtmpTimQEx
(

6979 
IN
 
RTMP_ADAPTER
 *
pAd
);

6981 
	`RtmpTimQIn
(

6982 
IN
 
RTMP_ADAPTER
 *
pAd
);

6989 #ifde
AP_QLOAD_SUPPORT


6990 
VOID
 
	`QBSS_LdIn
(

6991 
IN
 
RTMP_ADAPTER
 *
pAd
);

6993 
VOID
 
	`QBSS_LdArmRet
(

6994 
IN
 
RTMP_ADAPTER
 *
pAd
);

6996 
VOID
 
	`QBSS_LdArmResume
(

6997 
IN
 
RTMP_ADAPTER
 *
pAd
);

6999 
UINT32
 
	`QBSS_LdBusyTimeG
(

7000 
IN
 
RTMP_ADAPTER
 *
pAd
);

7002 
BOOLEAN
 
	`QBSS_LdIsArmIssued
(

7003 
IN
 
RTMP_ADAPTER
 *
pAd
);

7005 
BOOLEAN
 
	`QBSS_LdIsBusyTimeAced
(

7006 
IN
 
RTMP_ADAPTER
 *
pAd
,

7007 
IN
 
UINT32
 
BusyTime
);

7009 
UINT32
 
	`QBSS_LdEmtAd
(

7010 
IN
 
RTMP_ADAPTER
 *
pAd
,

7011 
OUT
 
UINT8
 *
buf_p
);

7013 
UINT32
 
	`QBSS_LdEmtP
(

7014 
IN
 
RTMP_ADAPTER
 *
pAd
,

7015 
IN
 
UINT8
 *
pEmt
,

7016 
OUT
 
UINT16
 *
pStiCou
,

7017 
OUT
 
UINT8
 *
pChUt
,

7018 
OUT
 
UINT16
 *
pAvAdmC
);

7020 
VOID
 
	`QBSS_LdUpde
(

7021 
IN
 
RTMP_ADAPTER
 *
pAd
,

7022 
IN
 
ULONG
 
UpTime
);

7024 
VOID
 
	`QBSS_LdStusCˬ
(

7025 
IN
 
RTMP_ADAPTER
 *
pAd
);

7027 
INT
 
	`Show_QoSLd_Proc
(

7028 
IN
 
PRTMP_ADAPTER
 
pAd
,

7029 
IN
 
PSTRING
 
g
);

7033 
INT
 
	`RTMPShowCfgVue
(

7034 
IN
 
PRTMP_ADAPTER
 
pAd
,

7035 
IN
 
PSTRING
 
pName
,

7036 
IN
 
PSTRING
 
pBuf
);

7038 
PSTRING
 
	`RTMPGRkAuthModeS
(

7039 
IN
 
NDIS_802_11_AUTHENTICATION_MODE
 
authMode
);

7041 
PSTRING
 
	`RTMPGRkEnyModeS
(

7042 
IN
 
USHORT
 
yMode
);

7045 #ifde
CONFIG_STA_SUPPORT


7046 
VOID
 
	`AsicSBbpTung
(

7047 
IN
 
PRTMP_ADAPTER
 
pAd
);

7049 
BOOLEAN
 
	`SAddMacTabEry
(

7050 
IN
 
PRTMP_ADAPTER
 
pAd
,

7051 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

7052 
IN
 
UCHAR
 
MaxSu܋dReIn500Kbps
,

7053 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

7054 
IN
 
UCHAR
 
HtCabyL
,

7055 
IN
 
ADD_HT_INFO_IE
 *
pAddHtInfo
,

7056 
IN
 
UCHAR
 
AddHtInfoL
,

7057 
IN
 
USHORT
 
CabyInfo
);

7060 
BOOLEAN
 
	`AUTH_ReqSd
(

7061 
IN
 
PRTMP_ADAPTER
 
pAd
,

7062 
IN
 
PMLME_QUEUE_ELEM
 
pEm
,

7063 
IN
 
PRALINK_TIMER_STRUCT
 
pAuthTim
,

7064 
IN
 
PSTRING
 
pSMName
,

7065 
IN
 
USHORT
 
SeqNo
,

7066 
IN
 
PUCHAR
 
pNewEmt
,

7067 
IN
 
ULONG
 
EmtL
);

7070 
	`RTMP_IndiMedS
(

7071 
IN
 
PRTMP_ADAPTER
 
pAd
,

7072 
IN
 
NDIS_MEDIA_STATE
 
med_e
);

7074 
VOID
 
	`ReSyncBcTime
(

7075 
IN
 
PRTMP_ADAPTER
 
pAd
);

7077 
VOID
 
	`RTMPSAGCInVue
(

7078 
IN
 
PRTMP_ADAPTER
 
pAd
,

7079 
IN
 
UCHAR
 
BdWidth
);

7082 
	`28xx_o
(
IN
 
PNET_DEV
 
dev
);

7083 
	`28xx_ݒ
(
IN
 
PNET_DEV
 
dev
);

7086 
	#VIRTUAL_IF_INC
(
__pAd
((__pAd)->
VtuIfC
++)

	)

7087 
	#VIRTUAL_IF_DEC
(
__pAd
((__pAd)->
VtuIfC
--)

	)

7088 
	#VIRTUAL_IF_NUM
(
__pAd
((__pAd)->
VtuIfC
)

	)

7092 #ifde
LINUX


7093 
__le
 
INT
 
	$VIRTUAL_IF_UP
(
PRTMP_ADAPTER
 
pAd
)

7095 i(
	`VIRTUAL_IF_NUM
(
pAd
) == 0)

7097 i(
	`28xx_ݒ
(
pAd
->
t_dev
) != 0)

7099 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("rt28xx_openeturn fail!\n"));

7106 
	`VIRTUAL_IF_INC
(
pAd
);

7108 
	}
}

7110 
__le
 
VOID
 
	$VIRTUAL_IF_DOWN
(
PRTMP_ADAPTER
 
pAd
)

7112 
	`VIRTUAL_IF_DEC
(
pAd
);

7113 i(
	`VIRTUAL_IF_NUM
(
pAd
) == 0)

7114 
	`28xx_o
(
pAd
->
t_dev
);

7116 
	}
}

7122 #ifde
SOFT_ENCRYPT


7123 
BOOLEAN
 
RTMPExndPackFSwEny
(

7124 
IN
 
PRTMP_ADAPTER
 
pAd
,

7125 
IN
 
PTX_BLK
 
pTxBlk
);

7127 
VOID
 
RTMPUpdeSwCacheChInfo
(

7128 
IN
 
PRTMP_ADAPTER
 
pAd
,

7129 
IN
 
PTX_BLK
 
pTxBlk
,

7130 
IN
 
PUCHAR
 
pHdr
);

7138 
RtmpOSWrssEvtSd
(

7139 
IN
 
RTMP_ADAPTER
 *
pAd
,

7140 
IN
 
UINT32
 
evtTy
,

7141 
IN
 
INT
 
ags
,

7142 
IN
 
PUCHAR
 
pSrcMac
,

7143 
IN
 
PUCHAR
 
pDa
,

7144 
IN
 
UINT32
 
daL
);

7146 
RtmpOSNDevAddrS
(

7147 
IN
 
PNET_DEV
 
pNDev
,

7148 
IN
 
PUCHAR
 
pMacAddr
);

7150 
RtmpOSNDevAach
(

7151 
IN
 
PNET_DEV
 
pNDev
,

7152 
IN
 
RTMP_OS_NETDEV_OP_HOOK
 *
pDevOpHook
);

7154 
RtmpOSNDevClo
(

7155 
IN
 
PNET_DEV
 
pNDev
);

7157 
RtmpOSNDevDach
(

7158 
IN
 
PNET_DEV
 
pNDev
);

7160 
INT
 
RtmpOSNDevAoc
(

7161 
IN
 
PNET_DEV
 *
pNewNDev
,

7162 
IN
 
UINT32
 
ivDaSize
);

7164 #ifde
LINUX


7165 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,31)

7166 
INT
 
RtmpOSNDevOpsAoc
(

7167 
IN
 
PVOID
 *
pNDevOps
);

7171 
RtmpOSNDevFe
(

7172 
IN
 
PNET_DEV
 
pNDev
);

7174 
PNET_DEV
 
RtmpOSNDevGByName
(

7175 
IN
 
PNET_DEV
 
pNDev
,

7176 
IN
 
PSTRING
 
pDevName
);

7178 
RtmpOSNDeviRefPut
(

7179 
IN
 
PNET_DEV
 
pNDev
);

7181 
PNET_DEV
 
RtmpOSNDevCe
(

7182 
IN
 
RTMP_ADAPTER
 *
pAd
,

7183 
IN
 
INT
 
devTy
,

7184 
IN
 
INT
 
devNum
,

7185 
IN
 
INT
 
ivMemSize
,

7186 
IN
 
PSTRING
 
pNamePfix
);

7191 
RtmpOSTaskCuomize
(

7192 
IN
 
RTMP_OS_TASK
 *
pTask
);

7194 
INT
 
RtmpOSTaskNifyToEx
(

7195 
IN
 
RTMP_OS_TASK
 *
pTask
);

7197 
NDIS_STATUS
 
RtmpOSTaskKl
(

7198 
IN
 
RTMP_OS_TASK
 *
pTask
);

7200 
NDIS_STATUS
 
RtmpOSTaskIn
(

7201 
IN
 
RTMP_OS_TASK
 *
pTask
,

7202 
PSTRING
 
pTaskName
,

7203 
VOID
 *
pPriv
);

7205 
NDIS_STATUS
 
RtmpOSTaskAach
(

7206 
IN
 
RTMP_OS_TASK
 *
pTask
,

7207 
IN
 
RTMP_OS_TASK_CALLBACK
 
skEryPot
,

7208 
IN
 
ULONG
 
g
);

7214 
RTMP_OS_FD
 
RtmpOSFeOn
(

7215 
IN
 *
pPh
,

7216 
IN
 
ag
,

7217 
IN
 
mode
);

7219 
RtmpOSFeClo
(

7220 
IN
 
RTMP_OS_FD
 
osfd
);

7222 
RtmpOSFeSk
(

7223 
IN
 
RTMP_OS_FD
 
osfd
,

7224 
IN
 
offt
);

7226 
RtmpOSFeRd
(

7227 
IN
 
RTMP_OS_FD
 
osfd
,

7228 
IN
 *
pDaP
,

7229 
IN
 
adL
);

7231 
RtmpOSFeWre
(

7232 
IN
 
RTMP_OS_FD
 
osfd
,

7233 
IN
 *
pDaP
,

7234 
IN
 
wreL
);

7236 
RtmpOSFSInfoChge
(

7237 
IN
 
RTMP_OS_FS_INFO
 *
pOSFSInfo
,

7238 
IN
 
BOOLEAN
 
bS
);

7241 
VOID
 
RTInlizeCmdQ
(

7242 
IN
 
PCmdQ
 
cmdq
);

7244 
INT
 
RTPCICmdThad
(

7245 
IN
 
ULONG
 
Cڋxt
);

7247 
VOID
 
CMDHdr
(

7248 
IN
 
PRTMP_ADAPTER
 
pAd
);

7250 
VOID
 
RTThadDequeueCmd
(

7251 
IN
 
PCmdQ
 
cmdq
,

7252 
OUT
 
PCmdQElmt
 *
pcmdqmt
);

7254 
NDIS_STATUS
 
RTEnqueueIlCmd
(

7255 
IN
 
PRTMP_ADAPTER
 
pAd
,

7256 
IN
 
NDIS_OID
 
Oid
,

7257 
IN
 
PVOID
 
pInfmiBufr
,

7258 
IN
 
UINT32
 
InfmiBufrLgth
);

7260 #ifde
HOSTAPD_SUPPORT


7261 
VOID
 
80211_nify_michl_u
(

7262 
IN
 
PRTMP_ADAPTER
 
pAd
,

7263 
IN
 
PHEADER_802_11
 
pHd
,

7264 
IN
 
UINT
 
keyix
,

7265 
IN
 
INT
 
pt
);

7267 cڡ 
CHAR
* 
h_rtf
(cڡ 
UINT8
 *
mac
);

7270 #ifde
VENDOR_FEATURE3_SUPPORT


7271 
VOID
 
RTMP_IO_WRITE32
(

7272 
PRTMP_ADAPTER
 
pAd
,

7273 
UINT32
 
Offt
,

7274 
UINT32
 
Vue
);

7276 
VOID
 
RTMP_BBP_IO_READ8_BY_REG_ID
(

7277 
PRTMP_ADAPTER
 
pAd
,

7278 
UINT32
 
Offt
,

7279 
UINT8
 *
pVue
);

7281 
VOID
 
RTMP_BBP_IO_READ8
(

7282 
PRTMP_ADAPTER
 
pAd
,

7283 
UCHAR
 
Offt
,

7284 
UINT8
 *
pVue
,

7285 
BOOLEAN
 
FlgVidMCR
);

7287 
VOID
 
RTMP_BBP_IO_WRITE8_BY_REG_ID
(

7288 
PRTMP_ADAPTER
 
pAd
,

7289 
UINT32
 
Offt
,

7290 
UINT8
 
Vue
);

7292 
VOID
 
RTMP_BBP_IO_WRITE8
(

7293 
PRTMP_ADAPTER
 
pAd
,

7294 
UCHAR
 
Offt
,

7295 
UINT8
 
Vue
,

7296 
BOOLEAN
 
FlgVidMCR
);

7299 
BOOLEAN
 
CHAN_PrݔtyCheck
(

7300 
IN
 
PRTMP_ADAPTER
 
pAd
,

7301 
IN
 
UINT32
 
ChNum
,

7302 
IN
 
UCHAR
 
Prݔty
);

7304 #ifde
CONFIG_STA_SUPPORT


7307 
INT
 
S_SSID_Proc
(

7308 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7309 
IN
 
PSTRING
 
g
);

7311 #ifde
WMM_SUPPORT


7312 
INT
 
S_WmmCab_Proc
(

7313 
IN
 
PRTMP_ADAPTER
 
pAd
,

7314 
IN
 
PSTRING
 
g
);

7317 
INT
 
S_NwkTy_Proc
(

7318 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7319 
IN
 
PSTRING
 
g
);

7321 
INT
 
S_AuthMode_Proc
(

7322 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7323 
IN
 
PSTRING
 
g
);

7325 
INT
 
S_EnypTy_Proc
(

7326 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7327 
IN
 
PSTRING
 
g
);

7329 
INT
 
S_DeuKeyID_Proc
(

7330 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7331 
IN
 
PSTRING
 
g
);

7333 
INT
 
S_Key1_Proc
(

7334 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7335 
IN
 
PSTRING
 
g
);

7337 
INT
 
S_Key2_Proc
(

7338 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7339 
IN
 
PSTRING
 
g
);

7341 
INT
 
S_Key3_Proc
(

7342 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7343 
IN
 
PSTRING
 
g
);

7345 
INT
 
S_Key4_Proc
(

7346 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7347 
IN
 
PSTRING
 
g
);

7349 
INT
 
S_WPAPSK_Proc
(

7350 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7351 
IN
 
PSTRING
 
g
);

7354 
INT
 
S_PSMode_Proc
(

7355 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7356 
IN
 
PSTRING
 
g
);

7358 #ifde
WPA_SUPPLICANT_SUPPORT


7359 
INT
 
S_W_Sut
(

7360 
IN
 
PRTMP_ADAPTER
 
pAd
,

7361 
IN
 
PSTRING
 
g
);

7364 #ifde
DBG


7366 
VOID
 
RTMPIolMAC
(

7367 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7368 
IN
 
iwq
 *
wrq
);

7370 
VOID
 
RTMPIolE2PROM
(

7371 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7372 
IN
 
iwq
 *
wrq
);

7376 
NDIS_STATUS
 
RTMPWPANeAddKeyProc
(

7377 
IN
 
PRTMP_ADAPTER
 
pAd
,

7378 
IN
 
PVOID
 
pBuf
);

7380 
INT
 
S_FgTe_Proc
(

7381 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7382 
IN
 
PSTRING
 
g
);

7384 #ifde
DOT11_N_SUPPORT


7385 
INT
 
S_TGnWifiTe_Proc
(

7386 
IN
 
PRTMP_ADAPTER
 
pAd
,

7387 
IN
 
PSTRING
 
g
);

7390 
INT
 
S_LgRryLim_Proc
(

7391 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7392 
IN
 
PSTRING
 
g
);

7394 
INT
 
S_ShtRryLim_Proc
(

7395 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7396 
IN
 
PSTRING
 
g
);

7398 #ifde
EXT_BUILD_CHANNEL_LIST


7399 
INT
 
S_Ie80211dClMode_Proc
(

7400 
IN
 
PRTMP_ADAPTER
 
pAdr
,

7401 
IN
 
PSTRING
 
g
);

7404 #ifde
CARRIER_DETECTION_SUPPORT


7405 
INT
 
S_CrrDe_Proc
(

7406 
IN
 
PRTMP_ADAPTER
 
pAd
,

7407 
IN
 
PSTRING
 
g
);

7410 
INT
 
Show_Adhoc_MacTab_Proc
(

7411 
IN
 
PRTMP_ADAPTER
 
pAd
,

7412 
IN
 
PSTRING
 
exa
);

7416 
INT
 
S_BcLoTime_Proc
(

7417 
IN
 
PRTMP_ADAPTER
 
pAd
,

7418 
IN
 
PSTRING
 
g
);

7420 
INT
 
S_AutoRmg_Proc
(

7421 
IN
 
PRTMP_ADAPTER
 
pAd
,

7422 
IN
 
PSTRING
 
g
);

7424 
INT
 
S_SeSurvey_Proc
(

7425 
IN
 
PRTMP_ADAPTER
 
pAd
,

7426 
IN
 
PSTRING
 
g
);

7428 
INT
 
S_FTxBur_Proc
(

7429 
IN
 
PRTMP_ADAPTER
 
pAd
,

7430 
IN
 
PSTRING
 
g
);

7433 
VOID
 
RTMPAddKey
(

7434 
IN
 
PRTMP_ADAPTER
 
pAd
,

7435 
IN
 
PNDIS_802_11_KEY
 
pKey
);

7438 
VOID
 
SSeSurvey
(

7439 
IN
 
PRTMP_ADAPTER
 
pAd
,

7440 
IN
 
PNDIS_802_11_SSID
 
pSsid
,

7441 
IN
 
UCHAR
 
SnTy
);

7444 
gRe
(

7445 
IN
 
HTTRANSMIT_SETTING
 
HTStg
,

7446 
OUT
 
ULONG
* 
fLaTxRxRe
);

	@include/rtmp_chip.h

38 #idef 
__RTMP_CHIP_H__


39 
	#__RTMP_CHIP_H__


	)

41 
	~"mp_ty.h
"

44 #ifde
RT2860


45 
	~"ch/2860.h
"

59 
	#IS_RT3090A
(
_pAd
((((_pAd)->
MACVsi
 & 0xffff0000=0x30900000))

	)

62 
	#IS_RT3090
(
_pAd
((((_pAd)->
MACVsi
 & 0xffff0000=0x30710000|| (
	`IS_RT3090A
(_pAd)))

	)

64 
	#IS_RT3070
(
_pAd
(((_pAd)->
MACVsi
 & 0xffff0000=0x30700000)

	)

65 
	#IS_RT3071
(
_pAd
(((_pAd)->
MACVsi
 & 0xffff0000=0x30710000)

	)

66 
	#IS_RT2070
(
_pAd
(((_pAd)->
RfIcTy
 =
RFIC_2020
|| ((_pAd)->
EFuTag
 =0x27))

	)

68 
	#IS_RT2860
(
_pAd
(((_pAd)->
MACVsi
 & 0xffff0000=0x28600000)

	)

69 
	#IS_RT2872
(
_pAd
(((_pAd)->
MACVsi
 & 0xffff0000=0x28720000)

	)

71 
	#IS_RT30xx
(
_pAd
(((_pAd)->
MACVsi
 & 0xfff00000=0x30700000||
	`IS_RT3090A
(_pAd)||
	`IS_RT3390
(_pAd))

	)

75 
	#IS_RT3572
(
_pAd
(((_pAd)->
MACVsi
 & 0xffff0000=0x35720000)

	)

77 
	#IS_RT2883
(
_pAd
(((_pAd)->
MACVsi
 & 0xffff0000=0x28830000)

	)

78 
	#IS_RT3883
(
_pAd
(((_pAd)->
MACVsi
 & 0xffff0000=0x38830000)

	)

79 
	#IS_VERSION_BEFORE_F
(
_pAd
(((_pAd)->
MACVsi
&0xffff<0x0211)

	)

81 
	#IS_VERSION_AFTER_F
(
_pAd
((((_pAd)->
MACVsi
&0xffff>0x0212|| (((_pAd)->
b3090ESclCh
 =
TRUE
)))

	)

84 
	#IS_RT3593
(
_pAd
(((_pAd)->
MACVsi
 & 0xFFFF0000=0x35930000)

	)

87 
	#RT3593OvPCIe
(
_pAd
(
	`IS_RT3593
(_pAd&& (_pAd->
CommCfg
.
bPCIeBus
 =
TRUE
))

	)

90 
	#RT3593OvPCI
(
_pAd
(
	`IS_RT3593
(_pAd&& (_pAd->
CommCfg
.
bPCIeBus
 =
FALSE
))

	)

93 
	#IS_RT3390
(
_pAd
(((_pAd)->
MACVsi
 & 0xFFFF0000=0x33900000)

	)

98 
	#CHIP_PCI_CFG
 0x0000

	)

99 
	#CHIP_PCI_EECTRL
 0x0004

	)

100 
	#CHIP_PCI_MCUCTRL
 0x0008

	)

102 
	#OPT_14
 0x114

	)

104 
	#RETRY_LIMIT
 10

	)

111 
	#BUSY
 1

	)

112 
	#IDLE
 0

	)

118 
	#EEDO
 0x08

	)

119 
	#EEDI
 0x04

	)

120 
	#EECS
 0x02

	)

121 
	#EESK
 0x01

	)

122 
	#EERL
 0x80

	)

124 
	#EEPROM_WRITE_OPCODE
 0x05

	)

125 
	#EEPROM_READ_OPCODE
 0x06

	)

126 
	#EEPROM_EWDS_OPCODE
 0x10

	)

127 
	#EEPROM_EWEN_OPCODE
 0x13

	)

129 
	#NUM_EEPROM_BBP_PARMS
 19

130 
	#NUM_EEPROM_TX_G_PARMS
 7

	)

132 
	#VALID_EEPROM_VERSION
 1

	)

133 
	#EEPROM_VERSION_OFFSET
 0x02

	)

134 
	#EEPROM_NIC1_OFFSET
 0x34

135 
	#EEPROM_NIC2_OFFSET
 0x36

136 

	)

138 
	#EEPROM_COUNTRY_REGION
 0x38

	)

140 
	#EEPROM_DEFINE_MAX_TXPWR
 0x4e

	)

142 
	#EEPROM_FREQ_OFFSET
 0x3a

	)

143 
	#EEPROM_LED1_OFFSET
 0x3c

	)

144 
	#EEPROM_LED2_OFFSET
 0x3e

	)

145 
	#EEPROM_LED3_OFFSET
 0x40

	)

147 
	#EEPROM_LNA_OFFSET
 0x44

	)

149 
	#EEPROM_RSSI_BG_OFFSET
 0x46

	)

150 
	#EEPROM_RSSI_A_OFFSET
 0x4a

	)

151 
	#EEPROM_TXMIXER_GAIN_2_4G
 0x48

	)

152 
	#EEPROM_TXMIXER_GAIN_5G
 0x4c

	)

154 
	#EEPROM_TXPOWER_DELTA
 0x50

155 

	)

157 
	#EEPROM_G_TX_PWR_OFFSET
 0x52

	)

158 
	#EEPROM_G_TX2_PWR_OFFSET
 0x60

	)

160 
	#EEPROM_G_TSSI_BOUND1
 0x6e

	)

161 
	#EEPROM_G_TSSI_BOUND2
 0x70

	)

162 
	#EEPROM_G_TSSI_BOUND3
 0x72

	)

163 
	#EEPROM_G_TSSI_BOUND4
 0x74

	)

164 
	#EEPROM_G_TSSI_BOUND5
 0x76

	)

166 
	#EEPROM_A_TX_PWR_OFFSET
 0x78

	)

167 
	#EEPROM_A_TX2_PWR_OFFSET
 0xa6

	)

169 
	#EEPROM_A_TSSI_BOUND1
 0xd4

	)

170 
	#EEPROM_A_TSSI_BOUND2
 0xd6

	)

171 
	#EEPROM_A_TSSI_BOUND3
 0xd8

	)

172 
	#EEPROM_A_TSSI_BOUND4
 0xda

	)

173 
	#EEPROM_A_TSSI_BOUND5
 0xdc

	)

175 
	#EEPROM_ITXBF_CAL_RX0
 0x1a0

	)

176 
	#EEPROM_ITXBF_CAL_TX0
 0x1a2

	)

177 
	#EEPROM_ITXBF_CAL_RX1
 0x1a4

	)

178 
	#EEPROM_ITXBF_CAL_TX1
 0x1a6

	)

179 
	#EEPROM_ITXBF_CAL_RX2
 0x1a8

	)

180 
	#EEPROM_ITXBF_CAL_TX2
 0x1

	)

182 
	#EEPROM_TXPOWER_BYRATE
 0xde

183 
	#EEPROM_TXPOWER_BYRATE_20MHZ_2_4G
 0xde

184 
	#EEPROM_TXPOWER_BYRATE_40MHZ_2_4G
 0xee

185 
	#EEPROM_TXPOWER_BYRATE_20MHZ_5G
 0xfa

186 
	#EEPROM_TXPOWER_BYRATE_40MHZ_5G
 0x10a

187 

	)

188 
	#EEPROM_BBP_BASE_OFFSET
 0xf0

189 

	)

193 
	#GET_TX_ALC_BIT_MASK
 0x1F

194 
	#GET_TX_FINE_POWER_CTRL_BIT_MASK
 0xE0

195 
	#NUMBER_OF_BITS_FOR_TX_ALC
 5

196 

	)

204 
	#EEPROM_NIC_CFG1_OFFSET
 0

	)

205 
	#EEPROM_NIC_CFG2_OFFSET
 1

	)

206 
	#EEPROM_NIC_CFG3_OFFSET
 2

	)

207 
	#EEPROM_COUNTRY_REG_OFFSET
 3

	)

208 
	#EEPROM_BBP_ARRAY_OFFSET
 4

	)

210 #ifde
RTMP_INTERNAL_TX_ALC


214 
	#EEPROM_TSSI_OVER_OFDM_54
 0x6E

	)

219 
	#EEPROM_TSSI_STEP_OVER_2DOT4G
 0x77

	)

224 
	#EEPROM_CCK_MCS0_MCS1
 0xDE

	)

225 
	#EEPROM_CCK_MCS2_MCS3
 0xDF

	)

226 
	#EEPROM_OFDM_MCS0_MCS1
 0xE0

	)

227 
	#EEPROM_OFDM_MCS2_MCS3
 0xE1

	)

228 
	#EEPROM_OFDM_MCS4_MCS5
 0xE2

	)

229 
	#EEPROM_OFDM_MCS6_MCS7
 0xE3

	)

230 
	#EEPROM_HT_MCS0_MCS1
 0xE4

	)

231 
	#EEPROM_HT_MCS2_MCS3
 0xE5

	)

232 
	#EEPROM_HT_MCS4_MCS5
 0xE6

	)

233 
	#EEPROM_HT_MCS6_MCS7
 0xE7

	)

234 
	#EEPROM_HT_USING_STBC_MCS0_MCS1
 0xEC

	)

235 
	#EEPROM_HT_USING_STBC_MCS2_MCS3
 0xED

	)

236 
	#EEPROM_HT_USING_STBC_MCS4_MCS5
 0xEE

	)

237 
	#EEPROM_HT_USING_STBC_MCS6_MCS7
 0xEF

	)

242 
	#GET_TX_ALC_BIT_MASK
 0x1F

243 
	#GET_TX_FINE_POWER_CTRL_BIT_MASK
 0xE0

244 
	#NUMBER_OF_BITS_FOR_TX_ALC
 5

245 

	)

246 
	#DEFAULT_BBP_TX_FINE_POWER_CTRL
 0

	)

255 
	#RT28xx_EEPROM_READ16
(
_pAd
, 
_offt
, 
_vue
) \

256 (
_pAd
)->
chOps
.
	`ad
((
RTMP_ADAPTER
 *)(_pAd), (
USHORT
)(
_offt
), (
PUSHORT
)&(
_vue
))

	)

258 
	#RT28xx_EEPROM_WRITE16
(
_pAd
, 
_offt
, 
_vue
) \

259 (
_pAd
)->
chOps
.
	`wre
((
RTMP_ADAPTER
 *)(_pAd), (
USHORT
)(
_offt
), (USHORT)(
_vue
))

	)

270 
	u_MCU_LEDCS_STRUC
 {

272 #ifde
RT_BIG_ENDIAN


273 
UCHAR
 
	mPެy
:1;

274 
UCHAR
 
	mLedMode
:7;

276 
UCHAR
 
	mLedMode
:7;

277 
UCHAR
 
	mPެy
:1;

279 } 
	mfld
;

280 
UCHAR
 
	mwd
;

281 } 
	tMCU_LEDCS_STRUC
, *
	tPMCU_LEDCS_STRUC
;

287 #ifde
RT_BIG_ENDIAN


288 
	u_EEPROM_ANTENNA_STRUC
 {

290 
USHORT
 
	mRsv
:4;

291 
USHORT
 
	mRfIcTy
:4;

292 
USHORT
 
	mTxPh
:4;

293 
USHORT
 
	mRxPh
:4;

294 } 
	mfld
;

295 
USHORT
 
	mwd
;

296 } 
	tEEPROM_ANTENNA_STRUC
, *
	tPEEPROM_ANTENNA_STRUC
;

298 
	u_EEPROM_ANTENNA_STRUC
 {

300 
USHORT
 
	mRxPh
:4;

301 
USHORT
 
	mTxPh
:4;

302 
USHORT
 
	mRfIcTy
:4;

303 
USHORT
 
	mRsv
:4;

304 } 
	mfld
;

305 
USHORT
 
	mwd
;

306 } 
	tEEPROM_ANTENNA_STRUC
, *
	tPEEPROM_ANTENNA_STRUC
;

309 #ifde
RT_BIG_ENDIAN


310 
	u_EEPROM_NIC_CINFIG2_STRUC
 {

312 
USHORT
 
	mDACTeB
:1;

313 
USHORT
 
	mCxB
:1;

314 
USHORT
 
	mbIlTxALC
:1;

315 
USHORT
 
	mAO
:1;

316 
USHORT
 
	mADivsy
:1;

317 
USHORT
 
	mRsv1
:1;

318 
USHORT
 
	mBW40MAvaFA
:1;

319 
USHORT
 
	mBW40MAvaFG
:1;

320 
USHORT
 
	mEbWPSPBC
:1;

321 
USHORT
 
	mBW40MSidebdFA
:1;

322 
USHORT
 
	mBW40MSidebdFG
:1;

323 
USHORT
 
	mCdbusAc˿ti
:1;

324 
USHORT
 
	mExLNAFA
:1;

325 
USHORT
 
	mExLNAFG
:1;

326 
USHORT
 
	mDymicTxAgcCڌ
:1;

327 
USHORT
 
	mHdweRadioCڌ
:1;

328 } 
	mfld
;

329 
USHORT
 
	mwd
;

330 } 
	tEEPROM_NIC_CONFIG2_STRUC
, *
	tPEEPROM_NIC_CONFIG2_STRUC
;

332 
	u_EEPROM_NIC_CINFIG2_STRUC
 {

334 
USHORT
 
	mHdweRadioCڌ
:1;

335 
USHORT
 
	mDymicTxAgcCڌ
:1;

336 
USHORT
 
	mExLNAFG
:1;

337 
USHORT
 
	mExLNAFA
:1;

338 
USHORT
 
	mCdbusAc˿ti
:1;

339 
USHORT
 
	mBW40MSidebdFG
:1;

340 
USHORT
 
	mBW40MSidebdFA
:1;

341 
USHORT
 
	mEbWPSPBC
:1;

342 
USHORT
 
	mBW40MAvaFG
:1;

343 
USHORT
 
	mBW40MAvaFA
:1;

344 
USHORT
 
	mRsv1
:1;

345 
USHORT
 
	mADivsy
:1;

346 
USHORT
 
	mAO
:1;

347 
USHORT
 
	mbIlTxALC
:1;

348 
USHORT
 
	mCxB
:1;

349 
USHORT
 
	mDACTeB
:1;

350 } 
	mfld
;

351 
USHORT
 
	mwd
;

352 } 
	tEEPROM_NIC_CONFIG2_STRUC
, *
	tPEEPROM_NIC_CONFIG2_STRUC
;

359 #ifde
RT_BIG_ENDIAN


360 
	u_EEPROM_TX_PWR_STRUC
 {

362 sigd 
	mBy1
;

363 sigd 
	mBy0
;

364 } 
	mfld
;

365 
USHORT
 
	mwd
;

366 } 
	tEEPROM_TX_PWR_STRUC
, *
	tPEEPROM_TX_PWR_STRUC
;

368 
	u_EEPROM_TX_PWR_STRUC
 {

370 sigd 
	mBy0
;

371 sigd 
	mBy1
;

372 } 
	mfld
;

373 
USHORT
 
	mwd
;

374 } 
	tEEPROM_TX_PWR_STRUC
, *
	tPEEPROM_TX_PWR_STRUC
;

377 #ifde
RT_BIG_ENDIAN


378 
	u_EEPROM_VERSION_STRUC
 {

380 
UCHAR
 
	mVsi
;

381 
UCHAR
 
	mFRNumb
;

382 } 
	mfld
;

383 
USHORT
 
	mwd
;

384 } 
	tEEPROM_VERSION_STRUC
, *
	tPEEPROM_VERSION_STRUC
;

386 
	u_EEPROM_VERSION_STRUC
 {

388 
UCHAR
 
	mFRNumb
;

389 
UCHAR
 
	mVsi
;

390 } 
	mfld
;

391 
USHORT
 
	mwd
;

392 } 
	tEEPROM_VERSION_STRUC
, *
	tPEEPROM_VERSION_STRUC
;

395 #ifde
RT_BIG_ENDIAN


396 
	u_EEPROM_LED_STRUC
 {

398 
USHORT
 
	mRsvd
:3;

399 
USHORT
 
	mLedMode
:5;

400 
USHORT
 
	mPެyGPIO_4
:1;

401 
USHORT
 
	mPެyGPIO_3
:1;

402 
USHORT
 
	mPެyGPIO_2
:1;

403 
USHORT
 
	mPެyGPIO_1
:1;

404 
USHORT
 
	mPެyGPIO_0
:1;

405 
USHORT
 
	mPެyACT
:1;

406 
USHORT
 
	mPެyRDY_A
:1;

407 
USHORT
 
	mPެyRDY_G
:1;

408 } 
	mfld
;

409 
USHORT
 
	mwd
;

410 } 
	tEEPROM_LED_STRUC
, *
	tPEEPROM_LED_STRUC
;

412 
	u_EEPROM_LED_STRUC
 {

414 
USHORT
 
	mPެyRDY_G
:1;

415 
USHORT
 
	mPެyRDY_A
:1;

416 
USHORT
 
	mPެyACT
:1;

417 
USHORT
 
	mPެyGPIO_0
:1;

418 
USHORT
 
	mPެyGPIO_1
:1;

419 
USHORT
 
	mPެyGPIO_2
:1;

420 
USHORT
 
	mPެyGPIO_3
:1;

421 
USHORT
 
	mPެyGPIO_4
:1;

422 
USHORT
 
	mLedMode
:5;

423 
USHORT
 
	mRsvd
:3;

424 } 
	mfld
;

425 
USHORT
 
	mwd
;

426 } 
	tEEPROM_LED_STRUC
, *
	tPEEPROM_LED_STRUC
;

429 #ifde
RT_BIG_ENDIAN


430 
	u_EEPROM_TXPOWER_DELTA_STRUC
 {

432 
UCHAR
 
	mTxPowEb
:1;

433 
UCHAR
 
	mTy
:1;

434 
UCHAR
 
	mDVue
:6;

435 } 
	mfld
;

436 
UCHAR
 
	mvue
;

437 } 
	tEEPROM_TXPOWER_DELTA_STRUC
, *
	tPEEPROM_TXPOWER_DELTA_STRUC
;

439 
	u_EEPROM_TXPOWER_DELTA_STRUC
 {

441 
UCHAR
 
	mDVue
:6;

442 
UCHAR
 
	mTy
:1;

443 
UCHAR
 
	mTxPowEb
:1;

444 } 
	mfld
;

445 
UCHAR
 
	mvue
;

446 } 
	tEEPROM_TXPOWER_DELTA_STRUC
, *
	tPEEPROM_TXPOWER_DELTA_STRUC
;

	@include/rtmp_cmd.h

27 #ide
__RTMP_CMD_H__


28 
	#__RTMP_CMD_H__


	)

30 
	~"mp_ty.h
"

33 
	s_CmdQElmt
 {

34 
UINT
 
	mcommd
;

35 
PVOID
 
	mbufr
;

36 
ULONG
 
	mbuf㾒gth
;

37 
BOOLEAN
 
	mCmdFromNdis
;

38 
BOOLEAN
 
	mSOti
;

39 
_CmdQElmt
 *
	mxt
;

40 } 
	tCmdQElmt
, *
	tPCmdQElmt
;

42 
	s_CmdQ
 {

43 
UINT
 
	msize
;

44 
CmdQElmt
 *
	mhd
;

45 
CmdQElmt
 *
	m
;

46 
UINT32
 
	mCmdQS
;

47 } 
	tCmdQ
, *
	tPCmdQ
;

50 
	#EnqueueCmd
(
cmdq
, 
cmdqmt
) \

52 i(
cmdq
->
size
 == 0) \

53 
cmdq
->
hd
 = 
cmdqmt
; \

55 
cmdq
->

->
xt
 = 
cmdqmt
; \

56 
cmdq
->

 = 
cmdqmt
; \

57 
cmdqmt
->
xt
 = 
NULL
; \

58 
cmdq
->
size
++; \

59 }

	)

61 
	#NDIS_OID
 
UINT


	)

63 #ifde
KTHREAD_SUPPORT


64 
	#RTCMDUp
(
pAd
) \

66 
RTMP_OS_TASK
 *
_pTask
 = &((
pAd
)->
cmdQTask
); \

68 
_pTask
->
kthad_rug
 = 
TRUE
; \

69 
	`wake_up
(&
_pTask
->
kthad_q
); \

71 }0)

	)

73 
	#RTCMDUp
(
pAd
) \

75 
RTMP_OS_TASK
 *
_pTask
 = &((
pAd
)->
cmdQTask
); \

76 
	`CHECK_PID_LEGALITY
(
_pTask
->
skPID
) \

78 
	`RTMP_SEM_EVENT_UP
(&(
_pTask
->
skSema
)); \

80 }0)

	)

83 #ifde
CONFIG_STA_SUPPORT


84 * 
rchr
(cڡ * 
s
, 
c
);

86 
_iol_am
(
t_devi
 *
dev
, 
iw_que_fo
 *
fo
,

87 *
w
, *
exa
);

89 
_iol_siwsn
(
t_devi
 *
dev
,

90 
iw_que_fo
 *
fo
,

91 
iwq_da
 *
wq
, *
exa
);

94 
gRe
(
HTTRANSMIT_SETTING
 
HTStg
, 
ULONG
* 
fLaTxRxRe
);

	@include/rtmp_def.h

39 #ide
__RTMP_DEF_H__


40 
	#__RTMP_DEF_H__


	)

42 
	~"oid.h
"

44 #unde
AP_WSC_INCLUDED


45 #unde
STA_WSC_INCLUDED


46 #unde
WSC_INCLUDED


49 #ifde
CONFIG_STA_SUPPORT


52 #i
defed
(
AP_WSC_INCLUDED
|| defed(
STA_WSC_INCLUDED
)

53 
	#WSC_INCLUDED


	)

58 
	#RT_DEBUG_OFF
 0

	)

59 
	#RT_DEBUG_ERROR
 1

	)

60 
	#RT_DEBUG_WARN
 2

	)

61 
	#RT_DEBUG_TRACE
 3

	)

62 
	#RT_DEBUG_INFO
 4

	)

63 
	#RT_DEBUG_LOUD
 5

	)

65 
	#NIC_TAG
 ((
ULONG
)'0682')

	)

66 
	#NIC_DBG_STRING
 ("**RT28xx**")

	)

68 #ifde
SNMP_SUPPORT


71 
	#MuurOUI_LEN
 3

	)

72 
	#MuurNAME
 ("Rk Technogy Comny.")

	)

73 
	#ResourTyIdName
 ("Rk_ID")

	)

78 
	#RALINK_2883_VERSION
 ((
UINT32
)0x28830300)

	)

79 
	#RALINK_2880E_VERSION
 ((
UINT32
)0x28720200)

	)

80 
	#RALINK_3883_VERSION
 ((
UINT32
)0x38830400)

	)

81 
	#RALINK_3070_VERSION
 ((
UINT32
)0x30700200)

	)

83 
	#MAX_RX_PKT_LEN
 1520

	)

89 #ifde
RTMP_MAC_PCI


90 #ifde
MEMORY_OPTIMIZATION


91 
	#TX_RING_SIZE
 64

	)

92 
	#MGMT_RING_SIZE
 32

	)

93 
	#RX_RING_SIZE
 64

	)

95 
	#TX_RING_SIZE
 64

96 
	#MGMT_RING_SIZE
 128

	)

97 
	#RX_RING_SIZE
 128

99 
	#MAX_TX_PROCESS
 
TX_RING_SIZE


100 
	#MAX_DMA_DONE_PROCESS
 
TX_RING_SIZE


	)

101 
	#MAX_TX_DONE_PROCESS
 
TX_RING_SIZE


102 
	#LOCAL_TXBUF_SIZE
 2

	)

105 
	#PCI_VIRT_TO_PHYS
(
__Addr
(((
UINT32
)(__Addr)& 0x0FFFFFFF)

	)

108 #ifde
MULTIPLE_CARD_SUPPORT


110 
	#MAX_NUM_OF_MULTIPLE_CARD
 32

	)

113 #ifde
MEMORY_OPTIMIZATION


114 
	#MAX_RX_PROCESS
 32

	)

116 
	#MAX_RX_PROCESS
 128

118 
	#NUM_OF_LOCAL_TXBUF
 2

	)

119 
	#TXD_SIZE
 16

	)

120 
	#TXWI_SIZE
 16

	)

121 
	#RXD_SIZE
 16

	)

122 
	#RXWI_SIZE
 16

	)

124 
	#TX_DMA_1ST_BUFFER_SIZE
 96

125 

	)

132 
	#MGMT_DMA_BUFFER_SIZE
 1600

133 

	)

134 
	#RX_BUFFER_AGGRESIZE
 3840

135 
	#RX_BUFFER_NORMSIZE
 3840

136 
	#TX_BUFFER_NORMSIZE
 
RX_BUFFER_NORMSIZE


	)

137 
	#MAX_FRAME_SIZE
 2346

138 
	#MAX_AGGREGATION_SIZE
 3840

139 
	#MAX_NUM_OF_TUPLE_CACHE
 2

	)

140 
	#MAX_MCAST_LIST_SIZE
 32

	)

141 
	#MAX_LEN_OF_VENDOR_DESC
 64

	)

143 
	#MAX_SIZE_OF_MCAST_PSQ
 32

	)

145 
	#MAX_RX_PROCESS_CNT
 (
RX_RING_SIZE
)

	)

167 
	#MAX_PACKETS_IN_MCAST_PS_QUEUE
 32

	)

168 
	#MAX_PACKETS_IN_PS_QUEUE
 128

169 
	#WMM_NUM_OF_AC
 4

	)

172 #ifde
RTMP_EFUSE_SUPPORT


174 
	#MAX_EEPROM_BIN_FILE_SIZE
 1024

	)

175 
	#EFUSE_BUFFER_PATH
 "/tmp/RT30xxEEPROM.b"

	)

179 
	#MAX_AGG_3SS_BALIMIT
 31

	)

182 
	#STANORMAL
 0x17f97

	)

183 
	#APNORMAL
 0x15f97

	)

184 #ifde
CONFIG_STA_SUPPORT


185 #ifde
XLINK_SUPPORT


186 
	#PSPXLINK
 0x17f93

	)

194 
	#fRTMP_ADAPTER_MAP_REGISTER
 0x00000001

	)

195 
	#fRTMP_ADAPTER_INTERRUPT_IN_USE
 0x00000002

	)

196 
	#fRTMP_ADAPTER_HARDWARE_ERROR
 0x00000004

	)

197 
	#fRTMP_ADAPTER_SCATTER_GATHER
 0x00000008

	)

198 
	#fRTMP_ADAPTER_SEND_PACKET_ERROR
 0x00000010

	)

199 
	#fRTMP_ADAPTER_MLME_RESET_IN_PROGRESS
 0x00000020

	)

200 
	#fRTMP_ADAPTER_HALT_IN_PROGRESS
 0x00000040

	)

201 
	#fRTMP_ADAPTER_RESET_IN_PROGRESS
 0x00000080

	)

202 
	#fRTMP_ADAPTER_NIC_NOT_EXIST
 0x00000100

	)

203 
	#fRTMP_ADAPTER_TX_RING_ALLOCATED
 0x00000200

	)

204 
	#fRTMP_ADAPTER_REMOVE_IN_PROGRESS
 0x00000400

	)

205 
	#fRTMP_ADAPTER_MIMORATE_INUSED
 0x00000800

	)

206 
	#fRTMP_ADAPTER_RX_RING_ALLOCATED
 0x00001000

	)

207 
	#fRTMP_ADAPTER_INTERRUPT_ACTIVE
 0x00002000

	)

208 
	#fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
 0x00004000

	)

209 
	#fRTMP_ADAPTER_REASSOC_IN_PROGRESS
 0x00008000

	)

210 
	#fRTMP_ADAPTER_MEDIA_STATE_PENDING
 0x00010000

	)

211 
	#fRTMP_ADAPTER_RADIO_OFF
 0x00020000

	)

212 
	#fRTMP_ADAPTER_BULKOUT_RESET
 0x00040000

	)

213 
	#fRTMP_ADAPTER_BULKIN_RESET
 0x00080000

	)

214 
	#fRTMP_ADAPTER_RDG_ACTIVE
 0x00100000

	)

215 
	#fRTMP_ADAPTER_DYNAMIC_BE_TXOP_ACTIVE
 0x00200000

	)

216 
	#fRTMP_ADAPTER_SCAN_2040
 0x04000000

	)

217 
	#fRTMP_ADAPTER_RADIO_MEASUREMENT
 0x08000000

	)

219 
	#fRTMP_ADAPTER_START_UP
 0x10000000

220 
	#fRTMP_ADAPTER_MEDIA_STATE_CHANGE
 0x20000000

	)

221 
	#fRTMP_ADAPTER_IDLE_RADIO_OFF
 0x40000000

	)

223 
	#fRTMP_ADAPTER_DISABLE_DOT_11N
 0x00000001

	)

224 
	#fRTMP_ADAPTER_WSC_PBC_PIN0
 0x00000002

	)

239 
	#fOP_STATUS_INFRA_ON
 0x00000001

	)

240 
	#fOP_STATUS_ADHOC_ON
 0x00000002

	)

241 
	#fOP_STATUS_BG_PROTECTION_INUSED
 0x00000004

	)

242 
	#fOP_STATUS_SHORT_SLOT_INUSED
 0x00000008

	)

243 
	#fOP_STATUS_SHORT_PREAMBLE_INUSED
 0x00000010

	)

244 
	#fOP_STATUS_RECEIVE_DTIM
 0x00000020

	)

246 
	#fOP_STATUS_MEDIA_STATE_CONNECTED
 0x00000080

	)

247 
	#fOP_STATUS_WMM_INUSED
 0x00000100

	)

248 
	#fOP_STATUS_AGGREGATION_INUSED
 0x00000200

	)

249 
	#fOP_STATUS_DOZE
 0x00000400

250 
	#fOP_STATUS_PIGGYBACK_INUSED
 0x00000800

251 
	#fOP_STATUS_APSD_INUSED
 0x00001000

	)

252 
	#fOP_STATUS_TX_AMSDU_INUSED
 0x00002000

	)

253 
	#fOP_STATUS_MAX_RETRY_ENABLED
 0x00004000

	)

254 
	#fOP_STATUS_WAKEUP_NOW
 0x00008000

	)

255 
	#fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
 0x00020000

	)

262 
	#fRTMP_PS_CAN_GO_SLEEP
 0x00000001

	)

264 
	#fRTMP_PS_SET_PCI_CLK_OFF_COMMAND
 0x00000002

	)

266 
	#fRTMP_PS_DISABLE_TX
 0x00000004

	)

269 
	#fRTMP_PS_GO_TO_SLEEP_NOW
 0x00000008

	)

270 
	#fRTMP_PS_TOGGLE_L1
 0x00000010

271 

	)

273 
	#WAKE_MCU_CMD
 0x31

	)

274 
	#SLEEP_MCU_CMD
 0x30

	)

275 
	#RFOFF_MCU_CMD
 0x35

	)

278 #ifde
DOT11N_DRAFT3


279 
	#fOP_STATUS_SCAN_2040
 0x00040000

	)

282 
	#CCKSETPROTECT
 0x1

	)

283 
	#OFDMSETPROTECT
 0x2

	)

284 
	#MM20SETPROTECT
 0x4

	)

285 
	#MM40SETPROTECT
 0x8

	)

286 
	#GF20SETPROTECT
 0x10

	)

287 
	#GR40SETPROTECT
 0x20

	)

288 
	#ALLN_SETPROTECT
 (
GR40SETPROTECT
 | 
GF20SETPROTECT
 | 
MM40SETPROTECT
 | 
MM20SETPROTECT
)

	)

293 
	#fCLIENT_STATUS_WMM_CAPABLE
 0x00000001

294 
	#fCLIENT_STATUS_AGGREGATION_CAPABLE
 0x00000002

295 
	#fCLIENT_STATUS_PIGGYBACK_CAPABLE
 0x00000004

296 
	#fCLIENT_STATUS_AMSDU_INUSED
 0x00000008

	)

297 
	#fCLIENT_STATUS_SGI20_CAPABLE
 0x00000010

	)

298 
	#fCLIENT_STATUS_SGI40_CAPABLE
 0x00000020

	)

299 
	#fCLIENT_STATUS_TxSTBC_CAPABLE
 0x00000040

	)

300 
	#fCLIENT_STATUS_RxSTBC_CAPABLE
 0x00000080

	)

301 
	#fCLIENT_STATUS_HTC_CAPABLE
 0x00000100

	)

302 
	#fCLIENT_STATUS_RDG_CAPABLE
 0x00000200

	)

303 
	#fCLIENT_STATUS_MCSFEEDBACK_CAPABLE
 0x00000400

	)

304 
	#fCLIENT_STATUS_APSD_CAPABLE
 0x00000800

	)

306 #ifde
DOT11N_DRAFT3


307 
	#fCLIENT_STATUS_BSSCOEXIST_CAPABLE
 0x00001000

	)

309 
	#fCLIENT_STATUS_SOFTWARE_ENCRYPT
 0x00002000

	)

310 
	#fCLIENT_STATUS_RALINK_CHIPSET
 0x00100000

	)

312 #ifde
CLIENT_WDS


313 
	#fCLIENT_STATUS_CLI_WDS
 0x00200000

	)

322 
	#HT_NO_PROTECT
 0

	)

323 
	#HT_LEGACY_PROTECT
 1

	)

324 
	#HT_40_PROTECT
 2

	)

325 
	#HT_2040_PROTECT
 3

	)

326 
	#HT_RTSCTS_6M
 7

	)

328 
	#HT_ATHEROS
 8

329 
	#HT_FORCERTSCTS
 9

330 

	)

334 
	#fRX_FILTER_ACCEPT_DIRECT
 
NDIS_PACKET_TYPE_DIRECTED


	)

335 
	#fRX_FILTER_ACCEPT_MULTICAST
 
NDIS_PACKET_TYPE_MULTICAST


	)

336 
	#fRX_FILTER_ACCEPT_BROADCAST
 
NDIS_PACKET_TYPE_BROADCAST


	)

337 
	#fRX_FILTER_ACCEPT_ALL_MULTICAST
 
NDIS_PACKET_TYPE_ALL_MULTICAST


	)

338 
	#fRX_FILTER_ACCEPT_PROMISCUOUS
 
NDIS_PACKET_TYPE_PROMISCUOUS


	)

344 
	#ERRLOG_READ_PCI_SLOT_FAILED
 0x00000101L

	)

345 
	#ERRLOG_WRITE_PCI_SLOT_FAILED
 0x00000102L

	)

346 
	#ERRLOG_VENDOR_DEVICE_NOMATCH
 0x00000103L

	)

349 
	#ERRLOG_BUS_MASTER_DISABLED
 0x00000201L

	)

352 
	#ERRLOG_INVALID_SPEED_DUPLEX
 0x00000301L

	)

353 
	#ERRLOG_SET_SECONDARY_FAILED
 0x00000302L

	)

356 
	#ERRLOG_OUT_OF_MEMORY
 0x00000401L

	)

357 
	#ERRLOG_OUT_OF_SHARED_MEMORY
 0x00000402L

	)

358 
	#ERRLOG_OUT_OF_MAP_REGISTERS
 0x00000403L

	)

359 
	#ERRLOG_OUT_OF_BUFFER_POOL
 0x00000404L

	)

360 
	#ERRLOG_OUT_OF_NDIS_BUFFER
 0x00000405L

	)

361 
	#ERRLOG_OUT_OF_PACKET_POOL
 0x00000406L

	)

362 
	#ERRLOG_OUT_OF_NDIS_PACKET
 0x00000407L

	)

363 
	#ERRLOG_OUT_OF_LOOKASIDE_MEMORY
 0x00000408L

	)

366 
	#ERRLOG_SELFTEST_FAILED
 0x00000501L

	)

367 
	#ERRLOG_INITIALIZE_ADAPTER
 0x00000502L

	)

368 
	#ERRLOG_REMOVE_MINIPORT
 0x00000503L

	)

371 
	#ERRLOG_MAP_IO_SPACE
 0x00000601L

	)

372 
	#ERRLOG_QUERY_ADAPTER_RESOURCES
 0x00000602L

	)

373 
	#ERRLOG_NO_IO_RESOURCE
 0x00000603L

	)

374 
	#ERRLOG_NO_INTERRUPT_RESOURCE
 0x00000604L

	)

375 
	#ERRLOG_NO_MEMORY_RESOURCE
 0x00000605L

	)

379 
	#MAX_WDS_ENTRY
 4

	)

380 
	#WDS_PAIRWISE_KEY_OFFSET
 60

381 

	)

382 
	#WDS_DISABLE_MODE
 0

	)

383 
	#WDS_RESTRICT_MODE
 1

	)

384 
	#WDS_BRIDGE_MODE
 2

	)

385 
	#WDS_REPEATER_MODE
 3

	)

386 
	#WDS_LAZY_MODE
 4

	)

389 
	#MAX_MESH_NUM
 0

	)

391 
	#MAX_APCLI_NUM
 0

	)

393 
	#MAX_MBSSID_NUM
 1

	)

394 #ifde
MBSS_SUPPORT


395 #unde
MAX_MBSSID_NUM


396 #ifde
SPECIFIC_BCN_BUF_SUPPORT


397 
	#HW_BEACON_MAX_COUNT
 16

	)

401 
	#MAX_MBSSID_NUM
 (16 - 
MAX_MESH_NUM
)

	)

403 
	#HW_BEACON_MAX_COUNT
 8

	)

404 
	#MAX_MBSSID_NUM
 (
HW_BEACON_MAX_COUNT
 - 
MAX_MESH_NUM
 - 
MAX_APCLI_NUM
)

	)

407 
	#HW_BEACON_MAX_COUNT
 8

	)

411 
	#MBSS_MR_APIDX_SANITY_CHECK
(
idx
) \

412 { i(
idx
 > 
MAX_MBSSID_NUM
) { \

413 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s> E!pidx = %d > MAX_MBSSID_NUM!\n", 
__FUNCTION__
, 
idx
)); \

414 
idx
 = 
MAIN_MBSSID
; } }

	)

416 
	#VALID_WCID
(
_wcid
((_wcid> 0 && (_wcid< 
MAX_LEN_OF_MAC_TABLE
 )

	)

418 
	#MAIN_MBSSID
 0

	)

419 
	#FIRST_MBSSID
 1

	)

422 
	#MAX_BEACON_SIZE
 512

	)

423 #ifde
SPECIFIC_BCN_BUF_SUPPORT


424 
	#HW_RESERVED_WCID
 255

	)

429 #i
defed
(
MAX_MBSSID_NUM
) && (MAX_MBSSID_NUM == 8)

430 
	#HW_RESERVED_WCID
 222

	)

431 #i
defed
(
MAX_MBSSID_NUM
) && (MAX_MBSSID_NUM == 7)

432 
	#HW_RESERVED_WCID
 238

	)

434 
	#HW_RESERVED_WCID
 255

	)

438 
	#DFS_CTS_WCID
 (
HW_RESERVED_WCID
 - 1)

	)

439 
	#CS_CTS_WCID
 (
HW_RESERVED_WCID
 - 2)

	)

440 
	#LAST_SPECIFIC_WCID
 (
HW_RESERVED_WCID
 - 2)

	)

444 
	#MAX_AVAILABLE_CLIENT_WCID
 (
LAST_SPECIFIC_WCID
 - 
MAX_MBSSID_NUM
 - 1)

	)

448 
	#GET_GroupKey_WCID
(
__wcid
, 
__bssidx
) \

450 
__wcid
 = 
LAST_SPECIFIC_WCID
 - (
MAX_MBSSID_NUM
+ 
__bssidx
; \

451 }

	)

453 
	#IsGroupKeyWCID
(
__wcid
(((__wcid< 
LAST_SPECIFIC_WCID
&& ((__wcid>(LAST_SPECIFIC_WCID - (
MAX_MBSSID_NUM
))))

	)

457 
	#BSS0
 0

	)

458 
	#BSS1
 1

	)

459 
	#BSS2
 2

	)

460 
	#BSS3
 3

	)

461 
	#BSS4
 4

	)

462 
	#BSS5
 5

	)

463 
	#BSS6
 6

	)

464 
	#BSS7
 7

	)

469 
	#PEER_KEY_NO
 2

	)

470 
	#MAC_ADDR_LEN
 6

	)

471 
	#TIMESTAMP_LEN
 8

	)

472 
	#MAX_LEN_OF_SUPPORTED_RATES
 
MAX_LENGTH_OF_SUPPORT_RATES


473 
	#MAX_NUM_OF_REGULATORY_CLASS
 16

	)

474 
	#MAX_LEN_OF_KEY
 32

475 
	#MAX_NUM_OF_CHANNELS
 
MAX_NUM_OF_CHS


476 
	#MAX_NUM_OF_11JCHANNELS
 20

477 
	#MAX_LEN_OF_SSID
 32

	)

478 
	#CIPHER_TEXT_LEN
 128

	)

479 
	#HASH_TABLE_SIZE
 256

	)

480 
	#MAX_VIE_LEN
 1024

481 
	#MAX_SUPPORT_MCS
 32

	)

482 
	#MAX_NUM_OF_BBP_LATCH
 255

	)

486 
	#BSSID_WCID
 1

487 
	#MCAST_WCID
 0x0

	)

488 
	#BSS0M_WCID
 0x0

	)

489 
	#BSS1M_WCID
 0xf8

	)

490 
	#BSS2M_WCID
 0xf9

	)

491 
	#BSS3M_WCID
 0x

	)

492 
	#BSS4M_WCID
 0xfb

	)

493 
	#BSS5M_WCID
 0xfc

	)

494 
	#BSS6M_WCID
 0xfd

	)

495 
	#BSS7M_WCID
 0x

	)

496 
	#RESERVED_WCID
 0xff

	)

498 
	#MAX_NUM_OF_ACL_LIST
 
MAX_NUMBER_OF_ACL


	)

500 
	#MAX_LEN_OF_MAC_TABLE
 
MAX_NUMBER_OF_MAC


501 

	)

502 #i
MAX_LEN_OF_MAC_TABLE
>
MAX_AVAILABLE_CLIENT_WCID


503 #r 
MAX_LEN_OF_MAC_TABLE
 
n
 
n
 
be
 
rg
 
th
 
MAX_AVAILABLE_CLIENT_WCID
!!!!

506 
	#MAX_NUM_OF_WDS_LINK_PERBSSID
 3

	)

507 
	#MAX_NUM_OF_WDS_LINK
 (
MAX_NUM_OF_WDS_LINK_PERBSSID
*
MAX_MBSSID_NUM
)

	)

508 
	#MAX_NUM_OF_EVENT
 
MAX_NUMBER_OF_EVENT


	)

509 
	#WDS_LINK_START_WCID
 (
MAX_LEN_OF_MAC_TABLE
-1)

	)

511 
	#NUM_OF_TID
 8

	)

512 
	#MAX_AID_BA
 4

	)

513 
	#MAX_LEN_OF_BA_REC_TABLE
 ((
NUM_OF_TID
 * 
MAX_LEN_OF_MAC_TABLE
)/2)

514 
	#MAX_LEN_OF_BA_ORI_TABLE
 ((
NUM_OF_TID
 * 
MAX_LEN_OF_MAC_TABLE
)/2)

515 #ifde
MEMORY_OPTIMIZATION


	)

516 
	#MAX_LEN_OF_BSS_TABLE
 1

	)

517 
	#MAX_REORDERING_MPDU_NUM
 256

	)

519 
	#MAX_LEN_OF_BSS_TABLE
 64

	)

520 
	#MAX_REORDERING_MPDU_NUM
 512

	)

524 
	#SHARE_KEY_NUM
 4

	)

525 
	#MAX_LEN_OF_SHARE_KEY
 16

526 
	#MAX_LEN_OF_PEER_KEY
 16

527 
	#PAIRWISE_KEY_NUM
 64

528 
	#GROUP_KEY_NUM
 4

	)

529 
	#PMK_LEN
 32

	)

530 
	#WDS_PAIRWISE_KEY_OFFSET
 60

531 
	#PMKID_NO
 4

532 
	#MAX_LEN_OF_MLME_BUFFER
 2048

	)

535 
	#PWR_ACTIVE
 0

	)

536 
	#PWR_SAVE
 1

	)

537 
	#PWR_MMPS
 2

539 

	)

541 
	#AUTH_MODE_OPEN
 0x00

	)

542 
	#AUTH_MODE_KEY
 0x01

	)

548 
	#BSS_ADHOC
 0

549 
	#BSS_INFRA
 1

550 
	#BSS_ANY
 2

551 
	#BSS_MONITOR
 3

552 

	)

555 
	#REASON_RESERVED
 0

	)

556 
	#REASON_UNSPECIFY
 1

	)

557 
	#REASON_NO_LONGER_VALID
 2

	)

558 
	#REASON_DEAUTH_STA_LEAVING
 3

	)

559 
	#REASON_DISASSOC_INACTIVE
 4

	)

560 
	#REASON_DISASSPC_AP_UNABLE
 5

	)

561 
	#REASON_CLS2ERR
 6

	)

562 
	#REASON_CLS3ERR
 7

	)

563 
	#REASON_DISASSOC_STA_LEAVING
 8

	)

564 
	#REASON_STA_REQ_ASSOC_NOT_AUTH
 9

	)

565 
	#REASON_INVALID_IE
 13

	)

566 
	#REASON_MIC_FAILURE
 14

	)

567 
	#REASON_4_WAY_TIMEOUT
 15

	)

568 
	#REASON_GROUP_KEY_HS_TIMEOUT
 16

	)

569 
	#REASON_IE_DIFFERENT
 17

	)

570 
	#REASON_MCIPHER_NOT_VALID
 18

	)

571 
	#REASON_UCIPHER_NOT_VALID
 19

	)

572 
	#REASON_AKMP_NOT_VALID
 20

	)

573 
	#REASON_UNSUPPORT_RSNE_VER
 21

	)

574 
	#REASON_INVALID_RSNE_CAP
 22

	)

575 
	#REASON_8021X_AUTH_FAIL
 23

	)

576 
	#REASON_CIPHER_SUITE_REJECTED
 24

	)

577 
	#REASON_DECLINED
 37

	)

579 
	#REASON_QOS_UNSPECIFY
 32

	)

580 
	#REASON_QOS_LACK_BANDWIDTH
 33

	)

581 
	#REASON_POOR_CHANNEL_CONDITION
 34

	)

582 
	#REASON_QOS_OUTSIDE_TXOP_LIMITION
 35

	)

583 
	#REASON_QOS_QSTA_LEAVING_QBSS
 36

	)

584 
	#REASON_QOS_UNWANTED_MECHANISM
 37

	)

585 
	#REASON_QOS_MECH_SETUP_REQUIRED
 38

	)

586 
	#REASON_QOS_REQUEST_TIMEOUT
 39

	)

587 
	#REASON_QOS_CIPHER_NOT_SUPPORT
 45

	)

590 
	#REASON_FT_INVALID_FTIE
 55

	)

593 
	#MLME_SUCCESS
 0

	)

594 
	#MLME_UNSPECIFY_FAIL
 1

	)

595 
	#MLME_CANNOT_SUPPORT_CAP
 10

	)

596 
	#MLME_REASSOC_DENY_ASSOC_EXIST
 11

	)

597 
	#MLME_ASSOC_DENY_OUT_SCOPE
 12

	)

598 
	#MLME_ALG_NOT_SUPPORT
 13

	)

599 
	#MLME_SEQ_NR_OUT_OF_SEQUENCE
 14

	)

600 
	#MLME_REJ_CHALLENGE_FAILURE
 15

	)

601 
	#MLME_REJ_TIMEOUT
 16

	)

602 
	#MLME_ASSOC_REJ_UNABLE_HANDLE_STA
 17

	)

603 
	#MLME_ASSOC_REJ_DATA_RATE
 18

	)

605 
	#MLME_ASSOC_REJ_NO_EXT_RATE
 22

	)

606 
	#MLME_ASSOC_REJ_NO_EXT_RATE_PBCC
 23

	)

607 
	#MLME_ASSOC_REJ_NO_CCK_OFDM
 24

	)

610 
	#MLME_QOS_UNSPECIFY
 32

	)

611 
	#MLME_REQUEST_DECLINED
 37

	)

612 
	#MLME_REQUEST_WITH_INVALID_PARAM
 38

	)

613 
	#MLME_INVALID_INFORMATION_ELEMENT
 40

	)

614 
	#MLME_INVALID_GROUP_CIPHER
 41

	)

615 
	#MLME_INVALID_PAIRWISE_CIPHER
 42

	)

616 
	#MLME_INVALID_AKMP
 43

	)

617 
	#MLME_NOT_SUPPORT_RSN_VERSION
 44

	)

618 
	#MLME_INVALID_RSN_CAPABILITIES
 45

	)

619 
	#MLME_DLS_NOT_ALLOW_IN_QBSS
 48

	)

620 
	#MLME_DEST_STA_NOT_IN_QBSS
 49

	)

621 
	#MLME_DEST_STA_IS_NOT_A_QSTA
 50

	)

623 
	#MLME_INVALID_FORMAT
 0x51

	)

624 
	#MLME_FAIL_NO_RESOURCE
 0x52

	)

625 
	#MLME_STATE_MACHINE_REJECT
 0x53

	)

626 
	#MLME_MAC_TABLE_FAIL
 0x54

	)

629 
	#IE_SSID
 0

	)

630 
	#IE_SUPP_RATES
 1

	)

631 
	#IE_FH_PARM
 2

	)

632 
	#IE_DS_PARM
 3

	)

633 
	#IE_CF_PARM
 4

	)

634 
	#IE_TIM
 5

	)

635 
	#IE_IBSS_PARM
 6

	)

636 
	#IE_COUNTRY
 7

637 
	#IE_802_11D_REQUEST
 10

638 
	#IE_QBSS_LOAD
 11

639 
	#IE_EDCA_PARAMETER
 12

640 
	#IE_TSPEC
 13

641 
	#IE_TCLAS
 14

642 
	#IE_SCHEDULE
 15

643 
	#IE_CHALLENGE_TEXT
 16

	)

644 
	#IE_POWER_CONSTRAINT
 32

645 
	#IE_POWER_CAPABILITY
 33

646 
	#IE_TPC_REQUEST
 34

647 
	#IE_TPC_REPORT
 35

648 
	#IE_SUPP_CHANNELS
 36

649 
	#IE_CHANNEL_SWITCH_ANNOUNCEMENT
 37

650 
	#IE_MEASUREMENT_REQUEST
 38

651 
	#IE_MEASUREMENT_REPORT
 39

652 
	#IE_QUIET
 40

653 
	#IE_IBSS_DFS
 41

654 
	#IE_ERP
 42

655 
	#IE_TS_DELAY
 43

656 
	#IE_TCLAS_PROCESSING
 44

657 
	#IE_QOS_CAPABILITY
 46

658 
	#IE_HT_CAP
 45

659 
	#IE_AP_CHANNEL_REPORT
 51

660 
	#IE_HT_CAP2
 52

661 
	#IE_RSN
 48

662 
	#IE_WPA2
 48

663 
	#IE_EXT_SUPP_RATES
 50

664 
	#IE_SUPP_REG_CLASS
 59

665 
	#IE_EXT_CHANNEL_SWITCH_ANNOUNCEMENT
 60

666 
	#IE_ADD_HT
 61

667 
	#IE_ADD_HT2
 53

668 

	)

672 
	#IE_SECONDARY_CH_OFFSET
 62

673 
	#IE_WAPI
 68

674 
	#IE_2040_BSS_COEXIST
 72

675 
	#IE_2040_BSS_INTOLERANT_REPORT
 73

676 
	#IE_OVERLAPBSS_SCAN_PARM
 74

677 
	#IE_EXT_CAPABILITY
 127

678 

	)

680 
	#IE_WPA
 221

681 
	#IE_VENDOR_SPECIFIC
 221

682 
	#IE_WFA_WSC
 221

	)

684 
	#OUI_BROADCOM_HT
 51

685 
	#OUI_BROADCOM_HTADD
 52

686 
	#OUI_PREN_HT_CAP
 51

687 
	#OUI_PREN_ADD_HT
 52

688 

	)

690 
	#IE_AIRONET_CKIP
 133

691 
	#IE_AP_TX_POWER
 150

692 
	#IE_MEASUREMENT_CAPABILITY
 221

693 
	#IE_CCX_V2
 221

	)

694 
	#IE_AIRONET_IPADDRESS
 149

695 
	#IE_AIRONET_CCKMREASSOC
 156

696 
	#CKIP_NEGOTIATION_LENGTH
 30

	)

697 
	#AIRONET_IPADDRESS_LENGTH
 10

	)

698 
	#AIRONET_CCKMREASSOC_LENGTH
 24

	)

705 
	#ASSOC_STATE_MACHINE
 1

	)

706 
	#AUTH_STATE_MACHINE
 2

	)

707 
	#AUTH_RSP_STATE_MACHINE
 3

	)

708 
	#SYNC_STATE_MACHINE
 4

	)

709 
	#MLME_CNTL_STATE_MACHINE
 5

	)

710 
	#WPA_PSK_STATE_MACHINE
 6

	)

712 
	#AIRONET_STATE_MACHINE
 8

	)

713 
	#ACTION_STATE_MACHINE
 9

	)

716 
	#AP_ASSOC_STATE_MACHINE
 11

	)

717 
	#AP_AUTH_STATE_MACHINE
 12

	)

718 
	#AP_SYNC_STATE_MACHINE
 14

	)

719 
	#AP_CNTL_STATE_MACHINE
 15

	)

720 
	#WSC_STATE_MACHINE
 17

	)

721 
	#WSC_UPNP_STATE_MACHINE
 18

	)

724 
	#WPA_STATE_MACHINE
 23

	)

727 #ifde
QOS_DLS_SUPPORT


728 
	#DLS_STATE_MACHINE
 26

	)

739 
	#CNTL_IDLE
 0

	)

740 
	#CNTL_WAIT_DISASSOC
 1

	)

741 
	#CNTL_WAIT_JOIN
 2

	)

742 
	#CNTL_WAIT_REASSOC
 3

	)

743 
	#CNTL_WAIT_START
 4

	)

744 
	#CNTL_WAIT_AUTH
 5

	)

745 
	#CNTL_WAIT_ASSOC
 6

	)

746 
	#CNTL_WAIT_AUTH2
 7

	)

747 
	#CNTL_WAIT_OID_LIST_SCAN
 8

	)

748 
	#CNTL_WAIT_OID_DISASSOC
 9

	)

750 
	#MT2_ASSOC_CONF
 34

	)

751 
	#MT2_AUTH_CONF
 35

	)

752 
	#MT2_DEAUTH_CONF
 36

	)

753 
	#MT2_DISASSOC_CONF
 37

	)

754 
	#MT2_REASSOC_CONF
 38

	)

755 
	#MT2_PWR_MGMT_CONF
 39

	)

756 
	#MT2_JOIN_CONF
 40

	)

757 
	#MT2_SCAN_CONF
 41

	)

758 
	#MT2_START_CONF
 42

	)

759 
	#MT2_GET_CONF
 43

	)

760 
	#MT2_SET_CONF
 44

	)

761 
	#MT2_RESET_CONF
 45

	)

762 
	#MT2_FT_OTD_CONF
 46

	)

763 
	#MT2_MLME_ROAMING_REQ
 52

	)

765 
	#CNTL_FUNC_SIZE
 1

	)

770 
	#ASSOC_IDLE
 0

	)

771 
	#ASSOC_WAIT_RSP
 1

	)

772 
	#REASSOC_WAIT_RSP
 2

	)

773 
	#DISASSOC_WAIT_RSP
 3

	)

774 
	#MAX_ASSOC_STATE
 4

	)

776 
	#ASSOC_MACHINE_BASE
 0

	)

777 
	#MT2_MLME_ASSOC_REQ
 0

	)

778 
	#MT2_MLME_REASSOC_REQ
 1

	)

779 
	#MT2_MLME_DISASSOC_REQ
 2

	)

780 
	#MT2_PEER_DISASSOC_REQ
 3

	)

781 
	#MT2_PEER_ASSOC_REQ
 4

	)

782 
	#MT2_PEER_ASSOC_RSP
 5

	)

783 
	#MT2_PEER_REASSOC_REQ
 6

	)

784 
	#MT2_PEER_REASSOC_RSP
 7

	)

785 
	#MT2_DISASSOC_TIMEOUT
 8

	)

786 
	#MT2_ASSOC_TIMEOUT
 9

	)

787 
	#MT2_REASSOC_TIMEOUT
 10

	)

788 
	#MAX_ASSOC_MSG
 11

	)

790 
	#ASSOC_FUNC_SIZE
 (
MAX_ASSOC_STATE
 * 
MAX_ASSOC_MSG
)

	)

795 
	#ACT_IDLE
 0

	)

796 
	#MAX_ACT_STATE
 1

	)

798 
	#ACT_MACHINE_BASE
 0

	)

803 
	#MT2_PEER_SPECTRUM_CATE
 0

	)

804 
	#MT2_PEER_QOS_CATE
 1

	)

805 
	#MT2_PEER_DLS_CATE
 2

	)

806 
	#MT2_PEER_BA_CATE
 3

	)

807 
	#MT2_PEER_PUBLIC_CATE
 4

	)

808 
	#MT2_PEER_RM_CATE
 5

	)

810 
	#MT2_PEER_HT_CATE
 7

811 
	#MT2_PEER_PMF_CATE
 8

	)

812 
	#MT2_PEER_RESV_9
 9

	)

813 
	#MT2_PEER_RESV_10
 10

	)

814 
	#MT2_PEER_RESV_11
 11

	)

815 
	#MT2_PEER_RESV_12
 12

	)

816 
	#MT2_PEER_RESV_13
 13

	)

817 
	#MT2_PEER_RESV_14
 14

	)

818 
	#MT2_PEER_RESV_15
 15

	)

819 
	#MT2_PEER_RESV_16
 16

	)

824 
	#MT2_PEER_WMM
 17

	)

825 
	#MAX_IEEE_STD_CATE
 17

	)

826 
	#MAX_PEER_CATE_MSG
 
MAX_IEEE_STD_CATE


	)

828 
	#MT2_MLME_ADD_BA_CATE
 (
MAX_IEEE_STD_CATE
 + 1)

	)

829 
	#MT2_MLME_ORI_DELBA_CATE
 (
MAX_IEEE_STD_CATE
 + 2)

	)

830 
	#MT2_MLME_REC_DELBA_CATE
 (
MAX_IEEE_STD_CATE
 + 3)

	)

831 
	#MT2_MLME_QOS_CATE
 (
MAX_IEEE_STD_CATE
 + 4)

	)

832 
	#MT2_MLME_DLS_CATE
 (
MAX_IEEE_STD_CATE
 + 5)

	)

833 
	#MT2_ACT_INVALID
 (
MAX_IEEE_STD_CATE
 + 6)

	)

835 
	#MAX_ACT_MSG
 (
MAX_IEEE_STD_CATE
 + 7)

	)

839 
	#CATEGORY_SPECTRUM
 0

	)

840 
	#CATEGORY_QOS
 1

	)

841 
	#CATEGORY_DLS
 2

	)

842 
	#CATEGORY_BA
 3

	)

843 
	#CATEGORY_PUBLIC
 4

	)

844 
	#CATEGORY_RM
 5

	)

845 
	#CATEGORY_FT
 6

	)

846 
	#CATEGORY_HT
 7

	)

847 
	#CATEGORY_PMF
 8

	)

850 
	#ACTION_DLS_REQUEST
 0

	)

851 
	#ACTION_DLS_RESPONSE
 1

	)

852 
	#ACTION_DLS_TEARDOWN
 2

	)

855 
	#SPEC_MRQ
 0

856 
	#SPEC_MRP
 1

857 
	#SPEC_TPCRQ
 2

	)

858 
	#SPEC_TPCRP
 3

	)

859 
	#SPEC_CHANNEL_SWITCH
 4

	)

863 
	#ADDBA_REQ
 0

	)

864 
	#ADDBA_RESP
 1

	)

865 
	#DELBA
 2

	)

868 
	#ACTION_BSS_2040_COEXIST
 0

869 
	#ACTION_DSE_ENABLEMENT
 1

870 
	#ACTION_DSE_DEENABLEMENT
 2

871 
	#ACTION_DSE_REG_LOCATION_ANNOUNCE
 3

872 
	#ACTION_EXT_CH_SWITCH_ANNOUNCE
 4

873 
	#ACTION_DSE_MEASUREMENT_REQ
 5

874 
	#ACTION_DSE_MEASUREMENT_REPORT
 6

875 
	#ACTION_MEASUREMENT_PILOT_ACTION
 7

876 
	#ACTION_DSE_POWER_CONSTRAINT
 8

877 
	#ACTION_VENDOR_USAGE
 221

	)

880 
	#NOTIFY_BW_ACTION
 0

	)

881 
	#SMPS_ACTION
 1

	)

882 
	#PSMP_ACTION
 2

	)

883 
	#SETPCO_ACTION
 3

	)

884 
	#MIMO_CHA_MEASURE_ACTION
 4

	)

885 
	#MIMO_N_BEACONFORM
 5

	)

886 
	#MIMO_BEACONFORM
 6

	)

887 
	#ANTENNA_SELECT
 7

	)

888 
	#HT_INFO_EXCHANGE
 8

	)

890 
	#ACT_FUNC_SIZE
 (
MAX_ACT_STATE
 * 
MAX_ACT_MSG
)

	)

894 
	#AUTH_REQ_IDLE
 0

	)

895 
	#AUTH_WAIT_SEQ2
 1

	)

896 
	#AUTH_WAIT_SEQ4
 2

	)

897 
	#MAX_AUTH_STATE
 3

	)

899 
	#AUTH_MACHINE_BASE
 0

	)

900 
	#MT2_MLME_AUTH_REQ
 0

	)

901 
	#MT2_PEER_AUTH_EVEN
 1

	)

902 
	#MT2_AUTH_TIMEOUT
 2

	)

903 
	#MAX_AUTH_MSG
 3

	)

905 
	#AUTH_FUNC_SIZE
 (
MAX_AUTH_STATE
 * 
MAX_AUTH_MSG
)

	)

910 
	#AUTH_RSP_IDLE
 0

	)

911 
	#AUTH_RSP_WAIT_CHAL
 1

	)

912 
	#MAX_AUTH_RSP_STATE
 2

	)

914 
	#AUTH_RSP_MACHINE_BASE
 0

	)

915 
	#MT2_AUTH_CHALLENGE_TIMEOUT
 0

	)

916 
	#MT2_PEER_AUTH_ODD
 1

	)

917 
	#MT2_PEER_DEAUTH
 2

	)

918 
	#MAX_AUTH_RSP_MSG
 3

	)

920 
	#AUTH_RSP_FUNC_SIZE
 (
MAX_AUTH_RSP_STATE
 * 
MAX_AUTH_RSP_MSG
)

	)

925 
	#SYNC_IDLE
 0

926 
	#JOIN_WAIT_BEACON
 1

	)

927 
	#SCAN_LISTEN
 2

	)

928 
	#SCAN_PENDING
 3

	)

929 
	#MAX_SYNC_STATE
 4

	)

931 
	#SYNC_MACHINE_BASE
 0

	)

932 
	#MT2_MLME_SCAN_REQ
 0

	)

933 
	#MT2_MLME_JOIN_REQ
 1

	)

934 
	#MT2_MLME_START_REQ
 2

	)

935 
	#MT2_PEER_BEACON
 3

	)

936 
	#MT2_PEER_PROBE_RSP
 4

	)

937 
	#MT2_PEER_ATIM
 5

	)

938 
	#MT2_SCAN_TIMEOUT
 6

	)

939 
	#MT2_BEACON_TIMEOUT
 7

	)

940 
	#MT2_ATIM_TIMEOUT
 8

	)

941 
	#MT2_PEER_PROBE_REQ
 9

	)

942 
	#MAX_SYNC_MSG
 10

	)

944 
	#SYNC_FUNC_SIZE
 (
MAX_SYNC_STATE
 * 
MAX_SYNC_MSG
)

	)

947 
	#DLS_IDLE
 0

	)

948 
	#MAX_DLS_STATE
 1

	)

950 
	#DLS_MACHINE_BASE
 0

	)

951 
	#MT2_MLME_DLS_REQ
 0

	)

952 
	#MT2_PEER_DLS_REQ
 1

	)

953 
	#MT2_PEER_DLS_RSP
 2

	)

954 
	#MT2_MLME_DLS_TEAR_DOWN
 3

	)

955 
	#MT2_PEER_DLS_TEAR_DOWN
 4

	)

956 
	#MAX_DLS_MSG
 5

	)

958 
	#DLS_FUNC_SIZE
 (
MAX_DLS_STATE
 * 
MAX_DLS_MSG
)

	)

968 
	#AP_CNTL_FUNC_SIZE
 1

	)

973 
	#AP_ASSOC_IDLE
 0

	)

974 
	#AP_MAX_ASSOC_STATE
 1

	)

976 
	#AP_ASSOC_MACHINE_BASE
 0

	)

977 
	#APMT2_MLME_DISASSOC_REQ
 0

	)

978 
	#APMT2_PEER_DISASSOC_REQ
 1

	)

979 
	#APMT2_PEER_ASSOC_REQ
 2

	)

980 
	#APMT2_PEER_REASSOC_REQ
 3

	)

981 
	#APMT2_CLS3ERR
 4

	)

982 
	#AP_MAX_ASSOC_MSG
 5

	)

984 
	#AP_ASSOC_FUNC_SIZE
 (
AP_MAX_ASSOC_STATE
 * 
AP_MAX_ASSOC_MSG
)

	)

989 
	#AP_AUTH_REQ_IDLE
 0

	)

990 
	#AP_MAX_AUTH_STATE
 1

	)

992 
	#AP_AUTH_MACHINE_BASE
 0

	)

993 
	#APMT2_MLME_DEAUTH_REQ
 0

	)

994 
	#APMT2_CLS2ERR
 1

	)

995 
	#APMT2_PEER_DEAUTH
 2

	)

996 
	#APMT2_PEER_AUTH_REQ
 3

	)

997 
	#APMT2_PEER_AUTH_CONFIRM
 4

	)

998 
	#AP_MAX_AUTH_MSG
 5

	)

1000 
	#AP_AUTH_FUNC_SIZE
 (
AP_MAX_AUTH_STATE
 * 
AP_MAX_AUTH_MSG
)

	)

1005 
	#AP_SYNC_IDLE
 0

	)

1006 #ifde
AP_SCAN_SUPPORT


1007 
	#AP_SCAN_LISTEN
 1

	)

1008 
	#AP_MAX_SYNC_STATE
 2

	)

1010 
	#AP_MAX_SYNC_STATE
 1

	)

1013 
	#AP_SYNC_MACHINE_BASE
 0

	)

1014 
	#APMT2_PEER_PROBE_REQ
 0

	)

1015 
	#APMT2_PEER_BEACON
 1

	)

1016 
	#APMT2_PEER_PROBE_RSP
 2

	)

1017 #ifde
AP_SCAN_SUPPORT


1018 
	#APMT2_MLME_SCAN_REQ
 3

	)

1019 
	#APMT2_SCAN_TIMEOUT
 4

	)

1020 
	#APMT2_MLME_SCAN_CNCL
 5

	)

1021 
	#AP_MAX_SYNC_MSG
 6

	)

1023 
	#AP_MAX_SYNC_MSG
 3

	)

1026 
	#AP_SYNC_FUNC_SIZE
 (
AP_MAX_SYNC_STATE
 * 
AP_MAX_SYNC_MSG
)

	)

1029 #ifde
CONFIG_STA_SUPPORT


1035 
	#BTYPE_MGMT
 0

	)

1036 
	#BTYPE_CNTL
 1

	)

1037 
	#BTYPE_DATA
 2

	)

1040 
	#SUBTYPE_ASSOC_REQ
 0

	)

1041 
	#SUBTYPE_ASSOC_RSP
 1

	)

1042 
	#SUBTYPE_REASSOC_REQ
 2

	)

1043 
	#SUBTYPE_REASSOC_RSP
 3

	)

1044 
	#SUBTYPE_PROBE_REQ
 4

	)

1045 
	#SUBTYPE_PROBE_RSP
 5

	)

1046 
	#SUBTYPE_BEACON
 8

	)

1047 
	#SUBTYPE_ATIM
 9

	)

1048 
	#SUBTYPE_DISASSOC
 10

	)

1049 
	#SUBTYPE_AUTH
 11

	)

1050 
	#SUBTYPE_DEAUTH
 12

	)

1051 
	#SUBTYPE_ACTION
 13

	)

1052 
	#SUBTYPE_ACTION_NO_ACK
 14

	)

1055 
	#SUBTYPE_WRAPPER
 7

	)

1056 
	#SUBTYPE_BLOCK_ACK_REQ
 8

	)

1057 
	#SUBTYPE_BLOCK_ACK
 9

	)

1058 
	#SUBTYPE_PS_POLL
 10

	)

1059 
	#SUBTYPE_RTS
 11

	)

1060 
	#SUBTYPE_CTS
 12

	)

1061 
	#SUBTYPE_ACK
 13

	)

1062 
	#SUBTYPE_CFEND
 14

	)

1063 
	#SUBTYPE_CFEND_CFACK
 15

	)

1066 
	#SUBTYPE_DATA
 0

	)

1067 
	#SUBTYPE_DATA_CFACK
 1

	)

1068 
	#SUBTYPE_DATA_CFPOLL
 2

	)

1069 
	#SUBTYPE_DATA_CFACK_CFPOLL
 3

	)

1070 
	#SUBTYPE_NULL_FUNC
 4

	)

1071 
	#SUBTYPE_CFACK
 5

	)

1072 
	#SUBTYPE_CFPOLL
 6

	)

1073 
	#SUBTYPE_CFACK_CFPOLL
 7

	)

1074 
	#SUBTYPE_QDATA
 8

	)

1075 
	#SUBTYPE_QDATA_CFACK
 9

	)

1076 
	#SUBTYPE_QDATA_CFPOLL
 10

	)

1077 
	#SUBTYPE_QDATA_CFACK_CFPOLL
 11

	)

1078 
	#SUBTYPE_QOS_NULL
 12

	)

1079 
	#SUBTYPE_QOS_CFACK
 13

	)

1080 
	#SUBTYPE_QOS_CFPOLL
 14

	)

1081 
	#SUBTYPE_QOS_CFACK_CFPOLL
 15

	)

1084 
	#NORMAL_ACK
 0x00

1085 
	#NO_ACK
 0x20

1086 
	#NO_EXPLICIT_ACK
 0x40

1087 
	#BLOCK_ACK
 0x60

1088 

	)

1092 
	#LENGTH_802_11
 24

	)

1093 
	#LENGTH_802_11_AND_H
 30

	)

1094 
	#LENGTH_802_11_CRC_H
 34

	)

1095 
	#LENGTH_802_11_CRC
 28

	)

1096 
	#LENGTH_802_11_WITH_ADDR4
 30

	)

1097 
	#LENGTH_802_3
 14

	)

1098 
	#LENGTH_802_3_TYPE
 2

	)

1099 
	#LENGTH_802_1_H
 8

	)

1100 
	#LENGTH_EAPOL_H
 4

	)

1101 
	#LENGTH_WMMQOS_H
 2

	)

1102 
	#LENGTH_CRC
 4

	)

1103 
	#MAX_SEQ_NUMBER
 0x0fff

	)

1104 
	#LENGTH_802_3_NO_TYPE
 12

	)

1105 
	#LENGTH_802_1Q
 4

	)

1108 
	#TX_RESULT_SUCCESS
 0

	)

1109 
	#TX_RESULT_ZERO_LENGTH
 1

	)

1110 
	#TX_RESULT_UNDER_RUN
 2

	)

1111 
	#TX_RESULT_OHY_ERROR
 4

	)

1112 
	#TX_RESULT_RETRY_FAIL
 6

	)

1116 
	#MODE_CCK
 0

	)

1117 
	#MODE_OFDM
 1

	)

1118 #ifde
DOT11_N_SUPPORT


1119 
	#MODE_HTMIX
 2

	)

1120 
	#MODE_HTGREENFIELD
 3

	)

1123 
	#MCS_LONGP_RATE_1
 0

1124 
	#MCS_LONGP_RATE_2
 1

1125 
	#MCS_LONGP_RATE_5_5
 2

	)

1126 
	#MCS_LONGP_RATE_11
 3

	)

1127 
	#MCS_SHORTP_RATE_1
 4

1128 
	#MCS_SHORTP_RATE_2
 5

1129 
	#MCS_SHORTP_RATE_5_5
 6

	)

1130 
	#MCS_SHORTP_RATE_11
 7

	)

1132 
	#MCS_RATE_6
 0

1133 
	#MCS_RATE_9
 1

1134 
	#MCS_RATE_12
 2

1135 
	#MCS_RATE_18
 3

1136 
	#MCS_RATE_24
 4

1137 
	#MCS_RATE_36
 5

1138 
	#MCS_RATE_48
 6

1139 
	#MCS_RATE_54
 7

1141 
	#MCS_0
 0

1142 
	#MCS_1
 1

	)

1143 
	#MCS_2
 2

	)

1144 
	#MCS_3
 3

	)

1145 
	#MCS_4
 4

	)

1146 
	#MCS_5
 5

	)

1147 
	#MCS_6
 6

	)

1148 
	#MCS_7
 7

	)

1149 
	#MCS_8
 8

1150 
	#MCS_9
 9

	)

1151 
	#MCS_10
 10

	)

1152 
	#MCS_11
 11

	)

1153 
	#MCS_12
 12

	)

1154 
	#MCS_13
 13

	)

1155 
	#MCS_14
 14

	)

1156 
	#MCS_15
 15

	)

1157 
	#MCS_16
 16

1158 
	#MCS_17
 17

	)

1159 
	#MCS_18
 18

	)

1160 
	#MCS_19
 19

	)

1161 
	#MCS_20
 20

	)

1162 
	#MCS_21
 21

	)

1163 
	#MCS_22
 22

	)

1164 
	#MCS_23
 23

	)

1165 
	#MCS_32
 32

	)

1166 
	#MCS_AUTO
 33

	)

1168 #ifde
DOT11_N_SUPPORT


1171 
	#HTMODE_MM
 0

	)

1172 
	#HTMODE_GF
 1

	)

1176 
	#FIXED_TXMODE_HT
 0

	)

1177 
	#FIXED_TXMODE_CCK
 1

	)

1178 
	#FIXED_TXMODE_OFDM
 2

	)

1180 
	#BW_20
 
BAND_WIDTH_20


	)

1181 
	#BW_40
 
BAND_WIDTH_40


	)

1182 
	#BW_BOTH
 
BAND_WIDTH_BOTH


	)

1183 
	#BW_10
 
BAND_WIDTH_10


1184 

	)

1185 #ifde
DOT11_N_SUPPORT


1187 
	#GI_400
 
GAP_INTERVAL_400


1188 
	#GI_BOTH
 
GAP_INTERVAL_BOTH


	)

1190 
	#GI_800
 
GAP_INTERVAL_800


	)

1192 
	#STBC_NONE
 0

	)

1193 #ifde
DOT11_N_SUPPORT


1194 
	#STBC_USE
 1

1195 
	#RXSTBC_ONE
 1

1196 
	#RXSTBC_TWO
 2

1197 
	#RXSTBC_THR
 3

1199 
	#MCSFBK_NONE
 0

1200 
	#MCSFBK_RSV
 1

1201 
	#MCSFBK_UNSOLICIT
 2

1202 
	#MCSFBK_MRQ
 3

1203 

	)

1205 
	#MMPS_STATIC
 0

	)

1206 
	#MMPS_DYNAMIC
 1

	)

1207 
	#MMPS_RSV
 2

	)

1208 
	#MMPS_ENABLE
 3

	)

1212 
	#AMSDU_0
 0

	)

1213 
	#AMSDU_1
 1

	)

1218 
	#TXRATEMIMO
 0x80

	)

1219 
	#TXRATEMCS
 0x7F

	)

1220 
	#TXRATEOFDM
 0x7F

	)

1221 
	#RATE_1
 0

	)

1222 
	#RATE_2
 1

	)

1223 
	#RATE_5_5
 2

	)

1224 
	#RATE_11
 3

	)

1225 
	#RATE_6
 4

1226 
	#RATE_9
 5

1227 
	#RATE_12
 6

1228 
	#RATE_18
 7

1229 
	#RATE_24
 8

1230 
	#RATE_36
 9

1231 
	#RATE_48
 10

1232 
	#RATE_54
 11

1233 
	#RATE_FIRST_OFDM_RATE
 
RATE_6


	)

1234 
	#RATE_LAST_OFDM_RATE
 
RATE_54


	)

1235 
	#RATE_6_5
 12

1236 
	#RATE_13
 13

1237 
	#RATE_19_5
 14

1238 
	#RATE_26
 15

1239 
	#RATE_39
 16

1240 
	#RATE_52
 17

1241 
	#RATE_58_5
 18

1242 
	#RATE_65
 19

1243 
	#RATE_78
 20

1244 
	#RATE_104
 21

1245 
	#RATE_117
 22

1246 
	#RATE_130
 23

1248 
	#HTRATE_0
 12

	)

1249 
	#RATE_FIRST_MM_RATE
 
HTRATE_0


	)

1250 
	#RATE_FIRST_HT_RATE
 
HTRATE_0


	)

1251 
	#RATE_LAST_HT_RATE
 
HTRATE_0


	)

1254 
	#IFS_HTTXOP
 0

1255 
	#IFS_PIFS
 1

	)

1256 
	#IFS_SIFS
 2

	)

1257 
	#IFS_BACKOFF
 3

	)

1260 
	#LONG_RETRY
 1

	)

1261 
	#SHORT_RETRY
 0

	)

1264 
	#REGION_MINIMUM_BG_BAND
 0

	)

1265 
	#REGION_0_BG_BAND
 0

1266 
	#REGION_1_BG_BAND
 1

1267 
	#REGION_2_BG_BAND
 2

1268 
	#REGION_3_BG_BAND
 3

1269 
	#REGION_4_BG_BAND
 4

1270 
	#REGION_5_BG_BAND
 5

1271 
	#REGION_6_BG_BAND
 6

1272 
	#REGION_7_BG_BAND
 7

1273 
	#REGION_31_BG_BAND
 31

1274 
	#REGION_MAXIMUM_BG_BAND
 7

	)

1276 
	#REGION_MINIMUM_A_BAND
 0

	)

1277 
	#REGION_0_A_BAND
 0

1278 
	#REGION_1_A_BAND
 1

1279 
	#REGION_2_A_BAND
 2

1280 
	#REGION_3_A_BAND
 3

1281 
	#REGION_4_A_BAND
 4

1282 
	#REGION_5_A_BAND
 5

1283 
	#REGION_6_A_BAND
 6

1284 
	#REGION_7_A_BAND
 7

1285 
	#REGION_8_A_BAND
 8

1286 
	#REGION_9_A_BAND
 9

1287 
	#REGION_10_A_BAND
 10

1288 
	#REGION_11_A_BAND
 11

1289 
	#REGION_12_A_BAND
 12

1290 
	#REGION_13_A_BAND
 13

1291 
	#REGION_14_A_BAND
 14

1292 
	#REGION_15_A_BAND
 15

1293 
	#REGION_16_A_BAND
 16

1294 
	#REGION_17_A_BAND
 17

	)

1295 
	#REGION_18_A_BAND
 18

	)

1296 
	#REGION_19_A_BAND
 19

	)

1297 
	#REGION_20_A_BAND
 20

	)

1298 
	#REGION_21_A_BAND
 21

	)

1299 
	#REGION_MAXIMUM_A_BAND
 21

	)

1302 
	#CIPHER_NONE
 0

	)

1303 
	#CIPHER_WEP64
 1

	)

1304 
	#CIPHER_WEP128
 2

	)

1305 
	#CIPHER_TKIP
 3

	)

1306 
	#CIPHER_AES
 4

	)

1307 
	#CIPHER_CKIP64
 5

	)

1308 
	#CIPHER_CKIP128
 6

	)

1309 
	#CIPHER_CKIP152
 7

	)

1310 
	#CIPHER_SMS4
 8

	)

1314 
	#LED_LINK_DOWN
 0

	)

1315 
	#LED_LINK_UP
 1

	)

1316 
	#LED_RADIO_OFF
 2

	)

1317 
	#LED_RADIO_ON
 3

	)

1318 
	#LED_HALT
 4

	)

1319 
	#LED_WPS
 5

	)

1320 
	#LED_ON_SITE_SURVEY
 6

	)

1321 
	#LED_POWER_UP
 7

	)

1324 
	#LED_HW_CONTROL
 19

	)

1329 
	#LED_MODE_DEFAULT
 0

	)

1330 
	#LED_MODE_TWO_LED
 1

	)

1332 
	#LED_MODE_SIGNAL_STREGTH
 0x40

1333 

	)

1335 
	#PPPINITFCS32
 0xfffffff

	)

1338 
	#WPA_802_1X_PORT_SECURED
 1

	)

1339 
	#WPA_802_1X_PORT_NOT_SECURED
 2

	)

1341 
	#PAIRWISE_KEY
 1

	)

1342 
	#GROUP_KEY
 2

	)

1345 
	#MAX_STEP_OF_TX_RATE_SWITCH
 32

	)

1349 
	#MAX_NUM_OF_FREE_NDIS_PACKET
 128

	)

1352 
	#MAX_TX_REORDERBUF
 64

	)

1353 
	#MAX_RX_REORDERBUF
 64

	)

1354 
	#DEFAULT_TX_TIMEOUT
 30

	)

1355 
	#DEFAULT_RX_TIMEOUT
 30

	)

1359 
	#I_RECIPIENT
 
TRUE


	)

1360 
	#I_ORIGINATOR
 
FALSE


	)

1362 
	#DEFAULT_BBP_TX_POWER
 0

	)

1363 
	#DEFAULT_RF_TX_POWER
 5

	)

1364 
	#DEFAULT_BBP_TX_FINE_POWER_CTRL
 0

	)

1366 
	#MAX_INI_BUFFER_SIZE
 4096

	)

1367 
	#MAX_PARAM_BUFFER_SIZE
 (2048)

1371 
	#OPMODE_STA
 0

	)

1372 
	#OPMODE_AP
 1

	)

1375 #ifde
RT_BIG_ENDIAN


1376 
	#DIR_READ
 0

	)

1377 
	#DIR_WRITE
 1

	)

1378 
	#TYPE_TXD
 0

	)

1379 
	#TYPE_RXD
 1

	)

1380 
	#TYPE_TXINFO
 0

	)

1381 
	#TYPE_RXINFO
 1

	)

1382 
	#TYPE_TXWI
 0

	)

1383 
	#TYPE_RXWI
 1

	)

1388 
	#EVENT_RESET_ACCESS_POINT
 0

1389 
	#EVENT_ASSOCIATED
 1

1390 
	#EVENT_DISASSOCIATED
 2

1391 
	#EVENT_AGED_OUT
 3

1392 
	#EVENT_COUNTER_M
 4

	)

1393 
	#EVENT_INVALID_PSK
 5

	)

1394 
	#EVENT_MAX_EVENT_TYPE
 6

	)

1398 
	#RSSI_0
 0

	)

1399 
	#RSSI_1
 1

	)

1400 
	#RSSI_2
 2

	)

1403 
	#RD_NORMAL_MODE
 0

1404 
	#RD_SWITCHING_MODE
 1

1405 
	#RD_SILENCE_MODE
 2

1406 

	)

1408 
	#SLEEPCID
 0x11

	)

1409 
	#WAKECID
 0x22

	)

1410 
	#QUERYPOWERCID
 0x33

	)

1411 
	#OWNERMCU
 0x1

	)

1412 
	#OWNERCPU
 0x0

	)

1415 
	#ENTRY_NOT_FOUND
 0xFF

	)

1418 
	#SIGNAL_THRESHOLD_OVER_NEW_RATE_ADAPT
 -65

	)

1427 
	#INT_MAIN
 0x0100

	)

1428 
	#INT_MBSSID
 0x0200

	)

1429 
	#INT_WDS
 0x0300

	)

1430 
	#INT_APCLI
 0x0400

	)

1431 
	#INT_MESH
 0x0500

	)

1433 
	#ENTRY_NONE
 0

	)

1434 
	#ENTRY_CLIENT
 1

	)

1435 
	#ENTRY_WDS
 2

	)

1436 
	#ENTRY_APCLI
 3

	)

1437 
	#ENTRY_MESH
 4

	)

1438 
	#ENTRY_DLS
 5

	)

1439 
	#ENTRY_TDLS
 6

	)

1441 
	#IS_ENTRY_NONE
(
_x
((_x)->
EryTy
 =
ENTRY_NONE
)

	)

1442 
	#IS_ENTRY_CLIENT
(
_x
((_x)->
EryTy
 =
ENTRY_CLIENT
)

	)

1443 
	#IS_ENTRY_WDS
(
_x
((_x)->
EryTy
 =
ENTRY_WDS
)

	)

1444 
	#IS_ENTRY_APCLI
(
_x
((_x)->
EryTy
 =
ENTRY_APCLI
)

	)

1445 
	#IS_ENTRY_MESH
(
_x
((_x)->
EryTy
 =
ENTRY_MESH
)

	)

1446 
	#IS_ENTRY_DLS
(
_x
((_x)->
EryTy
 =
ENTRY_DLS
)

	)

1447 
	#IS_ENTRY_TDLS
(
_x
((_x)->
EryTy
 =
ENTRY_TDLS
)

	)

1448 #ifde
CLIENT_WDS


1449 
	#IS_ENTRY_CLIWDS
(
_x

	`CLIENT_STATUS_TEST_FLAG
((_x), 
fCLIENT_STATUS_CLI_WDS
)

	)

1452 
	#SET_ENTRY_NONE
(
_x
((_x)->
EryTy
 = 
ENTRY_NONE
)

	)

1453 
	#SET_ENTRY_CLIENT
(
_x
((_x)->
EryTy
 = 
ENTRY_CLIENT
)

	)

1454 
	#SET_ENTRY_WDS
(
_x
((_x)->
EryTy
 = 
ENTRY_WDS
)

	)

1455 
	#SET_ENTRY_APCLI
(
_x
((_x)->
EryTy
 = 
ENTRY_APCLI
)

	)

1456 
	#SET_ENTRY_MESH
(
_x
((_x)->
EryTy
 = 
ENTRY_MESH
)

	)

1457 
	#SET_ENTRY_DLS
(
_x
((_x)->
EryTy
 = 
ENTRY_DLS
)

	)

1458 
	#SET_ENTRY_TDLS
(
_x
((_x)->
EryTy
 = 
ENTRY_TDLS
)

	)

1459 #ifde
CLIENT_WDS


1460 
	#SET_ENTRY_CLIWDS
(
_x

	`CLIENT_STATUS_SET_FLAG
((_x), 
fCLIENT_STATUS_CLI_WDS
)

	)

1463 
	#INF_MAIN_DEV_NAME
 ""

	)

1464 
	#INF_MBSSID_DEV_NAME
 ""

	)

1465 
	#INF_WDS_DEV_NAME
 "wds"

	)

1466 
	#INF_APCLI_DEV_NAME
 "i"

	)

1467 
	#INF_MESH_DEV_NAME
 "mesh"

	)

1469 #ifde
RALINK_ATE


1474 
	#fATE_IDLE
 0x00

	)

1475 
	#fATE_TX_ENABLE
 0x01

	)

1476 
	#fATE_RX_ENABLE
 0x02

	)

1477 
	#fATE_TXCONT_ENABLE
 0x04

	)

1478 
	#fATE_TXCARR_ENABLE
 0x08

	)

1479 
	#fATE_TXCARRSUPP_ENABLE
 0x10

	)

1480 
	#fATE_RESERVED_1
 0x20

	)

1481 
	#fATE_RESERVED_2
 0x40

	)

1482 
	#fATE_EXIT
 0x80

	)

1485 
	#ATE_START
 (
fATE_IDLE
)

	)

1487 
	#ATE_STOP
 (
fATE_EXIT
)

	)

1489 
	#ATE_TXCONT
 ((
fATE_TX_ENABLE
)|(
fATE_TXCONT_ENABLE
))

	)

1491 
	#ATE_TXCARR
 ((
fATE_TX_ENABLE
)|(
fATE_TXCARR_ENABLE
))

	)

1493 
	#ATE_TXCARRSUPP
 ((
fATE_TX_ENABLE
)|(
fATE_TXCARRSUPP_ENABLE
))

	)

1495 
	#ATE_TXFRAME
 (
fATE_TX_ENABLE
)

	)

1497 
	#ATE_RXFRAME
 (
fATE_RX_ENABLE
)

	)

1498 #ifde
RALINK_QA


1500 
	#ATE_TXSTOP
 ((~(
fATE_TX_ENABLE
))&(~(
fATE_TXCONT_ENABLE
))&(~(
fATE_TXCARR_ENABLE
))&(~(
fATE_TXCARRSUPP_ENABLE
)))

	)

1502 
	#ATE_RXSTOP
 (~(
fATE_RX_ENABLE
))

	)

1505 
	#BBP22_TXFRAME
 0x00

	)

1506 
	#BBP22_TXCONT_OR_CARRSUPP
 0x80

	)

1507 
	#BBP22_TXCARR
 0xc1

	)

1508 
	#BBP24_TXCONT
 0x00

	)

1509 
	#BBP24_CARRSUPP
 0x01

	)

1515 
	#WEP_HEXADECIMAL_TYPE
 0

	)

1516 
	#WEP_ASCII_TYPE
 1

	)

1522 
	#IW_CUSTOM_MAX_LEN
 255

	)

1525 
	#IW_SYS_EVENT_FLAG_START
 0x0200

	)

1526 
	#IW_ASSOC_EVENT_FLAG
 0x0200

	)

1527 
	#IW_DISASSOC_EVENT_FLAG
 0x0201

	)

1528 
	#IW_DEAUTH_EVENT_FLAG
 0x0202

	)

1529 
	#IW_AGEOUT_EVENT_FLAG
 0x0203

	)

1530 
	#IW_COUNTER_MEASURES_EVENT_FLAG
 0x0204

	)

1531 
	#IW_REPLAY_COUNTER_DIFF_EVENT_FLAG
 0x0205

	)

1532 
	#IW_RSNIE_DIFF_EVENT_FLAG
 0x0206

	)

1533 
	#IW_MIC_DIFF_EVENT_FLAG
 0x0207

	)

1534 
	#IW_ICV_ERROR_EVENT_FLAG
 0x0208

	)

1535 
	#IW_MIC_ERROR_EVENT_FLAG
 0x0209

	)

1536 
	#IW_GROUP_HS_TIMEOUT_EVENT_FLAG
 0x020A

	)

1537 
	#IW_PAIRWISE_HS_TIMEOUT_EVENT_FLAG
 0x020B

	)

1538 
	#IW_RSNIE_SANITY_FAIL_EVENT_FLAG
 0x020C

	)

1539 
	#IW_SET_KEY_DONE_WPA1_EVENT_FLAG
 0x020D

	)

1540 
	#IW_SET_KEY_DONE_WPA2_EVENT_FLAG
 0x020E

	)

1541 
	#IW_STA_LINKUP_EVENT_FLAG
 0x020F

	)

1542 
	#IW_STA_LINKDOWN_EVENT_FLAG
 0x0210

	)

1543 
	#IW_SCAN_COMPLETED_EVENT_FLAG
 0x0211

	)

1544 
	#IW_SCAN_ENQUEUE_FAIL_EVENT_FLAG
 0x0212

	)

1545 
	#IW_CHANNEL_CHANGE_EVENT_FLAG
 0x0213

	)

1546 
	#IW_STA_MODE_EVENT_FLAG
 0x0214

	)

1547 
	#IW_MAC_FILTER_LIST_EVENT_FLAG
 0x0215

	)

1548 
	#IW_AUTH_REJECT_CHALLENGE_FAILURE
 0x0216

	)

1549 
	#IW_SCANNING_EVENT_FLAG
 0x0217

	)

1550 
	#IW_START_IBSS_FLAG
 0x0218

	)

1551 
	#IW_JOIN_IBSS_FLAG
 0x0219

	)

1552 
	#IW_SHARED_WEP_FAIL
 0x021A

	)

1553 
	#IW_WPS_END_EVENT_FLAG
 0x021B

	)

1555 
	#IW_SYS_EVENT_FLAG_END
 0x021B

	)

1556 
	#IW_SYS_EVENT_TYPE_NUM
 (
IW_SYS_EVENT_FLAG_END
 - 
IW_SYS_EVENT_FLAG_START
 + 1)

	)

1559 #ifde
IDS_SUPPORT


1561 
	#IW_SPOOF_EVENT_FLAG_START
 0x0300

	)

1562 
	#IW_CONFLICT_SSID_EVENT_FLAG
 0x0300

	)

1563 
	#IW_SPOOF_ASSOC_RESP_EVENT_FLAG
 0x0301

	)

1564 
	#IW_SPOOF_REASSOC_RESP_EVENT_FLAG
 0x0302

	)

1565 
	#IW_SPOOF_PROBE_RESP_EVENT_FLAG
 0x0303

	)

1566 
	#IW_SPOOF_BEACON_EVENT_FLAG
 0x0304

	)

1567 
	#IW_SPOOF_DISASSOC_EVENT_FLAG
 0x0305

	)

1568 
	#IW_SPOOF_AUTH_EVENT_FLAG
 0x0306

	)

1569 
	#IW_SPOOF_DEAUTH_EVENT_FLAG
 0x0307

	)

1570 
	#IW_SPOOF_UNKNOWN_MGMT_EVENT_FLAG
 0x0308

	)

1571 
	#IW_REPLAY_ATTACK_EVENT_FLAG
 0x0309

	)

1573 
	#IW_SPOOF_EVENT_FLAG_END
 0x0309

	)

1574 
	#IW_SPOOF_EVENT_TYPE_NUM
 (
IW_SPOOF_EVENT_FLAG_END
 - 
IW_SPOOF_EVENT_FLAG_START
 + 1)

	)

1578 
	#IW_FLOOD_EVENT_FLAG_START
 0x0400

	)

1579 
	#IW_FLOOD_AUTH_EVENT_FLAG
 0x0400

	)

1580 
	#IW_FLOOD_ASSOC_REQ_EVENT_FLAG
 0x0401

	)

1581 
	#IW_FLOOD_REASSOC_REQ_EVENT_FLAG
 0x0402

	)

1582 
	#IW_FLOOD_PROBE_REQ_EVENT_FLAG
 0x0403

	)

1583 
	#IW_FLOOD_DISASSOC_EVENT_FLAG
 0x0404

	)

1584 
	#IW_FLOOD_DEAUTH_EVENT_FLAG
 0x0405

	)

1585 
	#IW_FLOOD_EAP_REQ_EVENT_FLAG
 0x0406

	)

1587 
	#IW_FLOOD_EVENT_FLAG_END
 0x0406

	)

1588 
	#IW_FLOOD_EVENT_TYPE_NUM
 (
IW_FLOOD_EVENT_FLAG_END
 - 
IW_FLOOD_EVENT_FLAG_START
 + 1)

	)

1594 #ifde
CONFIG_STA_SUPPORT


1596 
	#MAX_NUM_OF_INIT_DLS_ENTRY
 1

	)

1597 
	#MAX_NUM_OF_DLS_ENTRY
 
MAX_NUMBER_OF_DLS_ENTRY


	)

1600 
	#MAX_TX_REORDERBUF
 64

	)

1601 
	#MAX_RX_REORDERBUF
 64

	)

1602 
	#DEFAULT_TX_TIMEOUT
 30

	)

1603 
	#DEFAULT_RX_TIMEOUT
 30

	)

1604 
	#MAX_BARECI_SESSION
 8

	)

1606 #ide
IW_ESSID_MAX_SIZE


1608 
	#IW_ESSID_MAX_SIZE
 32

	)

1612 #ifde
MCAST_RATE_SPECIFIC


1613 
	#MCAST_DISABLE
 0

	)

1614 
	#MCAST_CCK
 1

	)

1615 
	#MCAST_OFDM
 2

	)

1616 
	#MCAST_HTMIX
 3

	)

1620 
	#DOT11POWERSAVE
 0

	)

1621 
	#GUIRADIO_OFF
 1

	)

1622 
	#RTMP_HALT
 2

	)

1623 
	#GUI_IDLE_POWER_SAVE
 3

	)

1628 
	#WPA_SUPPLICANT_DISABLE
 0x00

	)

1629 
	#WPA_SUPPLICANT_ENABLE
 0x01

	)

1630 
	#WPA_SUPPLICANT_ENABLE_WITH_WEB_UI
 0x02

	)

1631 
	#WPA_SUPPLICANT_ENABLE_WPS
 0x80

	)

1637 
	#SWAP16
(
x
) \

1638 ((
UINT16
)( \

1639 (((
UINT16
)(
x
) & (UINT16) 0x00ffU) << 8) | \

1640 (((
UINT16
)(
x
& (UINT160xff00U>> 8))

	)

1642 
	#SWAP32
(
x
) \

1643 ((
UINT32
)( \

1644 (((
UINT32
)(
x
) & (UINT32) 0x000000ffUL) << 24) | \

1645 (((
UINT32
)(
x
) & (UINT32) 0x0000ff00UL) << 8) | \

1646 (((
UINT32
)(
x
) & (UINT32) 0x00ff0000UL) >> 8) | \

1647 (((
UINT32
)(
x
& (UINT320xff000000UL>> 24))

	)

1649 
	#SWAP64
(
x
) \

1650 ((
UINT64
)( \

1651 (
UINT64
)(((UINT64)(
x
) & (UINT64) 0x00000000000000ffULL) << 56) | \

1652 (
UINT64
)(((UINT64)(
x
) & (UINT64) 0x000000000000ff00ULL) << 40) | \

1653 (
UINT64
)(((UINT64)(
x
) & (UINT64) 0x0000000000ff0000ULL) << 24) | \

1654 (
UINT64
)(((UINT64)(
x
) & (UINT64) 0x00000000ff000000ULL) << 8) | \

1655 (
UINT64
)(((UINT64)(
x
) & (UINT64) 0x000000ff00000000ULL) >> 8) | \

1656 (
UINT64
)(((UINT64)(
x
) & (UINT64) 0x0000ff0000000000ULL) >> 24) | \

1657 (
UINT64
)(((UINT64)(
x
) & (UINT64) 0x00ff000000000000ULL) >> 40) | \

1658 (
UINT64
)(((UINT64)(
x
& (UINT640xff00000000000000ULL>> 56))

	)

1660 #ifde
RT_BIG_ENDIAN


1662 
	#u264
(
x

	`SWAP64
((x))

	)

1663 
	#2u64
(
x

	`SWAP64
((x))

	)

1664 
	#u232
(
x

	`SWAP32
((x))

	)

1665 
	#2u32
(
x

	`SWAP32
((x))

	)

1666 
	#u216
(
x

	`SWAP16
((x))

	)

1667 
	#2u16
(
x

	`SWAP16
((x))

	)

1668 
	#u2be64
(
x
((
UINT64
)(x))

	)

1669 
	#be2u64
(
x
((
UINT64
)(x))

	)

1670 
	#u2be32
(
x
((
UINT32
)(x))

	)

1671 
	#be2u32
(
x
((
UINT32
)(x))

	)

1672 
	#u2be16
(
x
((
UINT16
)(x))

	)

1673 
	#be2u16
(
x
((
UINT16
)(x))

	)

1677 
	#u264
(
x
((
UINT64
)(x))

	)

1678 
	#2u64
(
x
((
UINT64
)(x))

	)

1679 
	#u232
(
x
((
UINT32
)(x))

	)

1680 
	#2u32
(
x
((
UINT32
)(x))

	)

1681 
	#u216
(
x
((
UINT16
)(x))

	)

1682 
	#2u16
(
x
((
UINT16
)(x))

	)

1683 
	#u2be64
(
x

	`SWAP64
((x))

	)

1684 
	#be2u64
(
x

	`SWAP64
((x))

	)

1685 
	#u2be32
(
x

	`SWAP32
((x))

	)

1686 
	#be2u32
(
x

	`SWAP32
((x))

	)

1687 
	#u2be16
(
x

	`SWAP16
((x))

	)

1688 
	#be2u16
(
x

	`SWAP16
((x))

	)

1692 
	#ABS
(
_x
, 
_y
((_x> (_y)? ((_x-(_y): ((_y-(_x))

	)

1695 
	#A2Dec
(
_X
, 
_p
) \

1697 
UCHAR
 *
p
; \

1698 
_X
 = 0; \

1699 
p
 = 
_p
; \

1700 ((*
p
 >= '0') && (*p <= '9'))) \

1702 i((*
p
 >= '0') && (*p <= '9')) \

1703 
_X
 = _X * 10 + *
p
 - 48; \

1704 
p
++; \

1706 }

	)

1709 
	#A2Hex
(
_X
, 
_p
) \

1711 *
__p
; \

1712 (
_X
) = 0; \

1713 
__p
 = (*)(
_p
); \

1714 ((*
__p
 >= 'a') && (*__p <= 'f')) || ((*__p >= 'A') && (*__p <= 'F')) || ((*__p >= '0') && (*__p <= '9'))) \

1716 i((*
__p
 >= 'a') && (*__p <= 'f')) \

1717 (
_X
(_X* 16 + *
__p
 - 87; \

1718 i((*
__p
 >= 'A') && (*__p <= 'F')) \

1719 (
_X
(_X* 16 + *
__p
 - 55; \

1720 i((*
__p
 >= '0') && (*__p <= '9')) \

1721 (
_X
(_X* 16 + *
__p
 - 48; \

1722 
__p
++; \

1724 }0)

	)

	@include/rtmp_dot11.h

28 #ide
__DOT11_BASE_H__


29 
	#__DOT11_BASE_H__


	)

31 
	~"mp_ty.h
"

35 
	sGNU_PACKED
 {

36 #ifde
RT_BIG_ENDIAN


37 
UINT32
 
	mRDG
:1;

38 
UINT32
 
	mACCڡt
:1;

39 
UINT32
 
	mrsv2
:5;

40 
UINT32
 
	mNDPAou
:1;

41 
UINT32
 
	mCSISTEERING
:2;

42 
UINT32
 
	mrsv1
:2;

43 
UINT32
 
	mCSeq
:2;

44 
UINT32
 
	mCPos
:2;

45 
UINT32
 
	mMFBASC
:7;

46 
UINT32
 
	mMFSI
:3;

47 
UINT32
 
	mMSI
:3;

48 
UINT32
 
	mMRQ
:1;

49 
UINT32
 
	mTRQ
:1;

50 
UINT32
 
	mrsv
:1;

52 
UINT32
 
	mrsv
:1;

53 
UINT32
 
	mTRQ
:1;

54 
UINT32
 
	mMRQ
:1;

55 
UINT32
 
	mMSI
:3;

56 
UINT32
 
	mMFSI
:3;

57 
UINT32
 
	mMFBASC
:7;

58 
UINT32
 
	mCPos
:2;

59 
UINT32
 
	mCSeq
:2;

60 
UINT32
 
	mrsv1
:2;

61 
UINT32
 
	mCSISTEERING
:2;

62 
UINT32
 
	mNDPAou
:1;

63 
UINT32
 
	mrsv2
:5;

64 
UINT32
 
	mACCڡt
:1;

65 
UINT32
 
	mRDG
:1;

67 } 
	tHT_CONTROL
, *
	tPHT_CONTROL
;

70 
	sGNU_PACKED
 {

71 #ifde
RT_BIG_ENDIAN


72 
USHORT
 
	mTx_QueueSize
:8;

73 
USHORT
 
	mAMsduP
:1;

74 
USHORT
 
	mAckPicy
:2;

75 
USHORT
 
	mEOSP
:1;

76 
USHORT
 
	mTID
:4;

78 
USHORT
 
	mTID
:4;

79 
USHORT
 
	mEOSP
:1;

80 
USHORT
 
	mAckPicy
:2;

81 
USHORT
 
	mAMsduP
:1;

82 
USHORT
 
	mTx_QueueSize
:8;

84 } 
	tQOS_CONTROL
, *
	tPQOS_CONTROL
;

88 
	sGNU_PACKED
 {

89 #ifde
RT_BIG_ENDIAN


90 
USHORT
 
	mOrd
:1;

91 
USHORT
 
	mW
:1;

92 
USHORT
 
	mMeDa
:1;

93 
USHORT
 
	mPwrMgmt
:1;

94 
USHORT
 
	mRry
:1;

95 
USHORT
 
	mMeFg
:1;

96 
USHORT
 
	mFrDs
:1;

97 
USHORT
 
	mToDs
:1;

98 
USHORT
 
	mSubTy
:4;

99 
USHORT
 
	mTy
:2;

100 
USHORT
 
	mV
:2;

102 
USHORT
 
	mV
:2;

103 
USHORT
 
	mTy
:2;

104 
USHORT
 
	mSubTy
:4;

105 
USHORT
 
	mToDs
:1;

106 
USHORT
 
	mFrDs
:1;

107 
USHORT
 
	mMeFg
:1;

108 
USHORT
 
	mRry
:1;

109 
USHORT
 
	mPwrMgmt
:1;

110 
USHORT
 
	mMeDa
:1;

111 
USHORT
 
	mW
:1;

112 
USHORT
 
	mOrd
:1;

114 } 
	tFRAME_CONTROL
, *
	tPFRAME_CONTROL
;

116 
GNU_PACKED
 
	t_HEADER_802_11
 {

117 
FRAME_CONTROL
 
	gFC
;

118 
USHORT
 
	gDuti
;

119 
UCHAR
 
	gAddr1
[
MAC_ADDR_LEN
];

120 
UCHAR
 
	gAddr2
[
MAC_ADDR_LEN
];

121 
UCHAR
 
	gAddr3
[
MAC_ADDR_LEN
];

122 #ifde
RT_BIG_ENDIAN


123 
USHORT
 
	gSequ
:12;

124 
USHORT
 
	gFg
:4;

126 
USHORT
 
	gFg
:4;

127 
USHORT
 
	gSequ
:12;

129 
UCHAR
 
	gO
[0];

130 } 
	tHEADER_802_11
, *
	tPHEADER_802_11
;

132 
GNU_PACKED
 
	t_PSPOLL_FRAME
 {

133 
FRAME_CONTROL
 
	gFC
;

134 
USHORT
 
	gAid
;

135 
UCHAR
 
	gBssid
[
MAC_ADDR_LEN
];

136 
UCHAR
 
	gTa
[
MAC_ADDR_LEN
];

137 } 
	tPSPOLL_FRAME
, *
	tPPSPOLL_FRAME
;

139 
GNU_PACKED
 
	t_RTS_FRAME
 {

140 
FRAME_CONTROL
 
	gFC
;

141 
USHORT
 
	gDuti
;

142 
UCHAR
 
	gAddr1
[
MAC_ADDR_LEN
];

143 
UCHAR
 
	gAddr2
[
MAC_ADDR_LEN
];

144 }
	tRTS_FRAME
, *
	tPRTS_FRAME
;

	@include/rtmp_iface.h

37 #ide
__RTMP_IFACE_H__


38 
	#__RTMP_IFACE_H__


	)

41 #ifde
RTMP_PCI_SUPPORT


42 
	~"i/mp_pci.h
"

48 
	s_INF_PCI_CONFIG_


50 
	mCSRBaAddss
;

51 
	mq_num
;

52 }
	tINF_PCI_CONFIG
;

55 
	s_INF_USB_CONFIG_


57 
	mBulkInEpAddr
;

58 
	mBulkOutEpAddr
[6];

59 }
	tINF_USB_CONFIG
;

62 
	s_INF_RBUS_CONFIG_


64 
	mc_addr
;

65 
	mq
;

66 }
	tINF_RBUS_CONFIG
;

69 
	e_RTMP_INF_TYPE_


71 
	mRTMP_DEV_INF_UNKNOWN
 = 0,

72 
	mRTMP_DEV_INF_PCI
 = 1,

73 
	mRTMP_DEV_INF_USB
 = 2,

74 
	mRTMP_DEV_INF_RBUS
 = 4,

75 
	mRTMP_DEV_INF_PCIE
 = 5,

76 }
	tRTMP_INF_TYPE
;

79 
	u_RTMP_INF_CONFIG_
{

80 
_INF_PCI_CONFIG_
 
	mpciCfig
;

81 
_INF_USB_CONFIG_
 
	musbCfig
;

82 
_INF_RBUS_CONFIG_
 
	mrbusCfig
;

83 }
	tRTMP_INF_CONFIG
;

	@include/rtmp_mcu.h

38 #ide
__RTMP_MCU_H__


39 
	#__RTMP_MCU_H__


	)

42 
INT
 
RtmpAsicEFmwe
(

43 
IN
 
PRTMP_ADAPTER
 
pAd
);

45 
NDIS_STATUS
 
RtmpAsicLdFmwe
(

46 
IN
 
PRTMP_ADAPTER
 
pAd
);

48 
INT
 
RtmpAsicSdCommdToMcu
(

49 
IN
 
PRTMP_ADAPTER
 
pAd
,

50 
IN
 
UCHAR
 
Commd
,

51 
IN
 
UCHAR
 
Tok
,

52 
IN
 
UCHAR
 
Arg0
,

53 
IN
 
UCHAR
 
Arg1
);

	@include/rtmp_os.h

38 #ide
__RTMP_OS_H__


39 
	#__RTMP_OS_H__


	)

41 #ifde
LINUX


42 
	~"os/_lux.h
"

56 
	s_RTMP_OS_NETDEV_OP_HOOK_


58 *
	mݒ
;

59 *
	m
;

60 *
	mxm
;

61 *
	miol
;

62 *
	mg_s
;

63 *
	miv
;

64 *
	mg_ws
;

65 *
	miw_hdr
;

66 
	miv_ags
;

67 
	mdevAddr
[6];

68 
	mdevName
[16];

69 
	medPred
;

70 }
	tRTMP_OS_NETDEV_OP_HOOK
, *
	tPRTMP_OS_NETDEV_OP_HOOK
;

73 
	e_RTMP_TASK_STATUS_


75 
	mRTMP_TASK_STAT_UNKNOWN
 = 0,

76 
	mRTMP_TASK_STAT_INITED
 = 1,

77 
	mRTMP_TASK_STAT_RUNNING
 = 2,

78 
	mRTMP_TASK_STAT_STOPED
 = 4,

79 }
	tRTMP_TASK_STATUS
;

80 
	#RTMP_TASK_CAN_DO_INSERT
 (
RTMP_TASK_STAT_INITED
 |
RTMP_TASK_STAT_RUNNING
)

	)

82 
	#RTMP_OS_TASK_NAME_LEN
 16

	)

83 
	s_RTMP_OS_TASK_


85 
	mskName
[
RTMP_OS_TASK_NAME_LEN
];

86 *
	miv
;

88 
RTMP_TASK_STATUS
 
	mskStus
;

89 #ide
KTHREAD_SUPPORT


90 
RTMP_OS_SEM
 
	mskSema
;

91 
RTMP_OS_PID
 
	mskPID
;

92 
comi
 
	mskCome
;

94 
	msk_kd
;

95 #ifde
KTHREAD_SUPPORT


96 
sk_ru
 *
	mkthad_sk
;

97 
wa_queue_hd_t
 
	mkthad_q
;

98 
BOOLEAN
 
	mkthad_rug
;

100 }
	tRTMP_OS_TASK
;

103 
RtmpOSIRQReque
(
IN
 
PNET_DEV
 
pNDev
);

104 
RtmpOSIRQR
(
IN
 
PNET_DEV
 
pNDev
);

106 #ide
OS_ABL_SUPPORT


107 
	#RTMP_MATOpsIn
(
__pAd
)

	)

108 
	#RTMP_MATPktRxNdCvt
(
__pAd
, 
__pDev
) \

109 
	`MATPktRxNdCvt
(
__pAd
, 
__pDev
)

	)

110 
	#RTMP_MATEngeRxHd
(
__pAd
, 
__pPkt
, 
__InfIdx
) \

111 
	`MATEngeRxHd
(
__pAd
, 
__pPkt
, 
__InfIdx
)

	)

114 
	#RTMP_MATOpsIn
(
__pAd
) \

115 (
__pAd
)->
MATPktRxNdCvt
 = MATPktRxNeedConvert; \

116 (
__pAd
)->
MATEngeRxHd
 = MATEngeRxHd;

	)

117 
	#RTMP_MATPktRxNdCvt
(
__pAd
, 
__pDev
) \

118 ((
__pAd
)->
	`MATPktRxNdCvt
(__pAd, 
__pDev
))

	)

119 
	#RTMP_MATEngeRxHd
(
__pAd
, 
__pPkt
, 
__InfIdx
) \

120 ((
__pAd
)->
	`MATEngeRxHd
(__pAd, 
__pPkt
, 
__InfIdx
))

	)

	@include/rtmp_timer.h

41 #ide
__RTMP_TIMER_H__


42 
	#__RTMP_TIMER_H__


	)

44 
	~"mp_os.h
"

47 
	#DECLARE_TIMER_FUNCTION
(
_func
) \

48 
mp_tim_
##
	`_func
(
da
)

	)

50 
	#GET_TIMER_FUNCTION
(
_func
) \

51 (
PVOID
)
mp_tim_
##
_func


	)

59 #ifde
RTMP_TIMER_TASK_SUPPORT


60 
	$VOID
 (*
	tRTMP_TIMER_TASK_HANDLE
)(

61 
	tIN
 
	tPVOID
 
	tSyemScific1
,

62 
	tIN
 
	tPVOID
 
	tFuniCڋxt
,

63 
	tIN
 
	tPVOID
 
	tSyemScific2
,

64 
	tIN
 
	tPVOID
 
	tSyemScific3
);

67 
	s_RALINK_TIMER_STRUCT
 {

68 
RTMP_OS_TIMER
 
TimObj
;

69 
BOOLEAN
 
Vid
;

70 
BOOLEAN
 
S
;

71 
BOOLEAN
 
PiodicTy
;

72 
BOOLEAN
 
Rt
;

73 
ULONG
 
TimVue
;

74 
ULONG
 
cook
;

75 *
pAd
;

76 #ifde
RTMP_TIMER_TASK_SUPPORT


77 
RTMP_TIMER_TASK_HANDLE
 
hd
;

79 }
	tRALINK_TIMER_STRUCT
, *
	tPRALINK_TIMER_STRUCT
;

82 #ifde
RTMP_TIMER_TASK_SUPPORT


83 
	s_RTMP_TIMER_TASK_ENTRY_


85 
RALINK_TIMER_STRUCT
 *
pRaTim
;

86 
_RTMP_TIMER_TASK_ENTRY_
 *
pNext
;

87 }
	tRTMP_TIMER_TASK_ENTRY
;

90 
	#TIMER_QUEUE_SIZE_MAX
 128

	)

91 
	s_RTMP_TIMER_TASK_QUEUE_


93 
us
;

94 *
pTimQPl
;

95 
RTMP_TIMER_TASK_ENTRY
 *
pQPlFeLi
;

96 
RTMP_TIMER_TASK_ENTRY
 *
pQHd
;

97 
RTMP_TIMER_TASK_ENTRY
 *
pQTa
;

98 }
	tRTMP_TIMER_TASK_QUEUE
;

100 
	#BUILD_TIMER_FUNCTION
(
_func
) \

101 
mp_tim_
##
	`_func
(
da
) \

103 
PRALINK_TIMER_STRUCT
 
_pTim
 = (PRALINK_TIMER_STRUCT)
da
; \

104 
RTMP_TIMER_TASK_ENTRY
 *
_pQNode
; \

105 
RTMP_ADAPTER
 *
_pAd
; \

107 
_pTim
->
hd
 = 
_func
; \

108 
_pAd
 = (
RTMP_ADAPTER
 *)
_pTim
->
pAd
; \

109 
_pQNode
 = 
	`RtmpTimQIn
(
_pAd
, 
_pTim
); \

110 i((
_pQNode
 =
NULL
&& (
_pAd
->
TimQ
.
us
 & 
RTMP_TASK_CAN_DO_INSERT
)) \

111 
	`RTMP_OS_Add_Tim
(&
_pTim
->
TimObj
, 
OS_HZ
); \

112 
	}

	)
}

114 
	#BUILD_TIMER_FUNCTION
(
_func
) \

115 
mp_tim_
##
	`_func
(
da
) \

117 
PRALINK_TIMER_STRUCT
 
pTim
 = (PRALINK_TIMER_STRUCT
da
; \

119 
	`_func
(
NULL
, (
PVOID

pTim
->
cook
, NULL,Timer); \

120 i(
pTim
->
Rt
) \

121 
	`RTMP_OS_Add_Tim
(&
pTim
->
TimObj
,Tim->
TimVue
); \

122 }

	)

126 
DECLARE_TIMER_FUNCTION
(
MlmePiodicExec
);

127 
DECLARE_TIMER_FUNCTION
(
MlmeRssiRtExec
);

128 
DECLARE_TIMER_FUNCTION
(
AsicRxAEvTimeout
);

129 
DECLARE_TIMER_FUNCTION
(
APSDPiodicExec
);

130 
DECLARE_TIMER_FUNCTION
(
EnqueueSFPSKExec
);

131 #ifde
CONFIG_STA_SUPPORT


135 #ifde
CONFIG_STA_SUPPORT


136 
DECLARE_TIMER_FUNCTION
(
BcTimeout
);

137 
DECLARE_TIMER_FUNCTION
(
SnTimeout
);

138 
DECLARE_TIMER_FUNCTION
(
AuthTimeout
);

139 
DECLARE_TIMER_FUNCTION
(
AssocTimeout
);

140 
DECLARE_TIMER_FUNCTION
(
RssocTimeout
);

141 
DECLARE_TIMER_FUNCTION
(
DissocTimeout
);

142 
DECLARE_TIMER_FUNCTION
(
LkDownExec
);

143 
DECLARE_TIMER_FUNCTION
(
SQuickReeFReUpExec
);

144 
DECLARE_TIMER_FUNCTION
(
WDissocApAndBlockAssoc
);

146 #ifde
RTMP_PCI_SUPPORT


147 
DECLARE_TIMER_FUNCTION
(
PsPlWakeExec
);

148 
DECLARE_TIMER_FUNCTION
(
RadioOnExec
);

150 #ifde
QOS_DLS_SUPPORT


151 
DECLARE_TIMER_FUNCTION
(
DlsTimeoutAi
);

162 #i
defed
 (
WLAN_LED
)

163 
DECLARE_TIMER_FUNCTION
(
LedClMa
);

	@include/rtmp_type.h

39 #ide
__RTMP_TYPE_H__


40 
	#__RTMP_TYPE_H__


	)

44 #ide
GNU_PACKED


45 
	#GNU_PACKED
 
	`__ibu__
 ((
cked
))

	)

48 #ifde
LINUX


51 
	tUINT8
;

52 
	tUINT16
;

53 
	tUINT32
;

54 
	tUINT64
;

55 
	tINT32
;

56 
	tINT64
;

58 
	tUCHAR
;

59 
	tUSHORT
;

60 
	tUINT
;

61 
	tULONG
;

64 * 
	tPUINT8
;

65 * 
	tPUINT16
;

66 * 
	tPUINT32
;

67 * 
	tPUINT64
;

68 * 
	tPINT32
;

69 * 
	tPINT64
;

72 
	tSTRING
;

74 sigd 
	tCHAR
;

76 sigd 
	tSHORT
;

77 sigd 
	tINT
;

78 sigd 
	tLONG
;

79 sigd 
	tLONGLONG
;

81 
	tULONGLONG
;

83 
	tBOOLEAN
;

84 #ifde
LINUX


85 
	tVOID
;

88 * 
	tPSTRING
;

89 
VOID
 * 
	tPVOID
;

90 
CHAR
 * 
	tPCHAR
;

91 
UCHAR
 * 
	tPUCHAR
;

92 
USHORT
 * 
	tPUSHORT
;

93 
LONG
 * 
	tPLONG
;

94 
ULONG
 * 
	tPULONG
;

95 
UINT
 * 
	tPUINT
;

97 
	tNDIS_MEDIA_STATE
;

99 
	u_LARGE_INTEGER
 {

101 #ifde
RT_BIG_ENDIAN


102 
INT32
 
	mHighPt
;

103 
UINT
 
	mLowPt
;

105 
UINT
 
	mLowPt
;

106 
INT32
 
	mHighPt
;

108 } 
	mu
;

109 
INT64
 
	mQuadPt
;

110 } 
	tLARGE_INTEGER
;

116 
	s_RTMP_REG_PAIR


118 
ULONG
 
	mRegi
;

119 
ULONG
 
	mVue
;

120 } 
	tRTMP_REG_PAIR
, *
	tPRTMP_REG_PAIR
;

122 
	s_REG_PAIR


124 
UCHAR
 
	mRegi
;

125 
UCHAR
 
	mVue
;

126 } 
	tREG_PAIR
, *
	tPREG_PAIR
;

131 
	s_RTMP_RF_REGS


133 
UCHAR
 
	mChl
;

134 
UINT32
 
	mR1
;

135 
UINT32
 
	mR2
;

136 
UINT32
 
	mR3
;

137 
UINT32
 
	mR4
;

138 } 
	tRTMP_RF_REGS
, *
	tPRTMP_RF_REGS
;

140 
	s_FREQUENCY_ITEM
 {

141 
UCHAR
 
	mChl
;

142 
UCHAR
 
	mN
;

143 
UCHAR
 
	mR
;

144 
UCHAR
 
	mK
;

145 } 
	tFREQUENCY_ITEM
, *
	tPFREQUENCY_ITEM
;

148 
	tNTSTATUS
;

151 
	#STATUS_SUCCESS
 0x00

	)

152 
	#STATUS_UNSUCCESSFUL
 0x01

	)

154 
	s_QUEUE_ENTRY
 {

155 
_QUEUE_ENTRY
 *
	mNext
;

156 } 
	tQUEUE_ENTRY
, *
	tPQUEUE_ENTRY
;

159 
	s_QUEUE_HEADER
 {

160 
PQUEUE_ENTRY
 
	mHd
;

161 
PQUEUE_ENTRY
 
	mTa
;

162 
ULONG
 
	mNumb
;

163 } 
	tQUEUE_HEADER
, *
	tPQUEUE_HEADER
;

	@include/spectrum.h

28 #ide
__SPECTRUM_H__


29 
	#__SPECTRUM_H__


	)

31 
	~"mp_ty.h
"

32 
	~"erum_def.h
"

35 
UINT8
 
GRegutyMaxTxPwr
(

36 
IN
 
PRTMP_ADAPTER
 
pAd
,

37 
IN
 
UINT8
 
chl
);

39 
CHAR
 
RTMP_GTxPwr
(

40 
IN
 
PRTMP_ADAPTER
 
pAd
,

41 
IN
 
HTTRANSMIT_SETTING
 
HTTxMode
);

55 
VOID
 
MakeMsumtReqFme
(

56 
IN
 
PRTMP_ADAPTER
 
pAd
,

57 
OUT
 
PUCHAR
 
pOutBufr
,

58 
OUT
 
PULONG
 
pFmeL
,

59 
IN
 
UINT8
 
TٮL
,

60 
IN
 
UINT8
 
Cegy
,

61 
IN
 
UINT8
 
Ai
,

62 
IN
 
UINT8
 
MsuTok
,

63 
IN
 
UINT8
 
MsuReqMode
,

64 
IN
 
UINT8
 
MsuReqTy
,

65 
IN
 
UINT16
 
NumOfRis
);

79 
VOID
 
EnqueueMsumtR
(

80 
IN
 
PRTMP_ADAPTER
 
pAd
,

81 
IN
 
PUCHAR
 
pDA
,

82 
IN
 
UINT8
 
DlogTok
,

83 
IN
 
UINT8
 
MsuTok
,

84 
IN
 
UINT8
 
MsuReqMode
,

85 
IN
 
UINT8
 
MsuReqTy
,

86 
IN
 
UINT8
 
RtInfoL
,

87 
IN
 
PUINT8
 
pRtInfo
);

101 
VOID
 
EnqueueTPCReq
(

102 
IN
 
PRTMP_ADAPTER
 
pAd
,

103 
IN
 
PUCHAR
 
pDA
,

104 
IN
 
UCHAR
 
DlogTok
);

118 
VOID
 
EnqueueTPCR
(

119 
IN
 
PRTMP_ADAPTER
 
pAd
,

120 
IN
 
PUCHAR
 
pDA
,

121 
IN
 
UINT8
 
DlogTok
,

122 
IN
 
UINT8
 
TxPwr
,

123 
IN
 
UINT8
 
LkMg
);

125 #ifde
WDS_SUPPORT


140 
VOID
 
EnqueueChSwA
(

141 
IN
 
PRTMP_ADAPTER
 
pAd
,

142 
IN
 
PUCHAR
 
pDA
,

143 
IN
 
UINT8
 
ChSwMode
,

144 
IN
 
UINT8
 
NewCh
);

159 
VOID
 
PrSrumAi
(

160 
IN
 
PRTMP_ADAPTER
 
pAd
,

161 
IN
 
MLME_QUEUE_ELEM
 *
Em
);

172 
INT
 
S_MsuReq_Proc
(

173 
IN
 
PRTMP_ADAPTER
 
pAd
,

174 
IN
 
PSTRING
 
g
);

176 
INT
 
S_TpcReq_Proc
(

177 
IN
 
PRTMP_ADAPTER
 
pAd
,

178 
IN
 
PSTRING
 
g
);

180 
INT
 
S_PwrCڡt
(

181 
IN
 
PRTMP_ADAPTER
 
pAd
,

182 
IN
 
PSTRING
 
g
);

185 
NDIS_STATUS
 
MsuReqTabIn
(

186 
IN
 
PRTMP_ADAPTER
 
pAd
);

188 
VOID
 
MsuReqTabEx
(

189 
IN
 
PRTMP_ADAPTER
 
pAd
);

191 
PMEASURE_REQ_ENTRY
 
MsuReqLookUp
(

192 
IN
 
PRTMP_ADAPTER
 
pAd
,

193 
IN
 
UINT8
 
DlogTok
);

195 
PMEASURE_REQ_ENTRY
 
MsuReqIn
(

196 
IN
 
PRTMP_ADAPTER
 
pAd
,

197 
IN
 
UINT8
 
DlogTok
);

199 
VOID
 
MsuReqDe
(

200 
IN
 
PRTMP_ADAPTER
 
pAd
,

201 
IN
 
UINT8
 
DlogTok
);

203 
VOID
 
InChlRIE
(

204 
IN
 
PRTMP_ADAPTER
 
pAd
,

205 
OUT
 
PUCHAR
 
pFmeBuf
,

206 
OUT
 
PULONG
 
pFmeL
,

207 
IN
 
PSTRING
 
pCoury
,

208 
IN
 
UINT8
 
RegutyCss
);

210 
VOID
 
InTpcRtIE
(

211 
IN
 
PRTMP_ADAPTER
 
pAd
,

212 
OUT
 
PUCHAR
 
pFmeBuf
,

213 
OUT
 
PULONG
 
pFmeL
,

214 
IN
 
UINT8
 
TxPwr
,

215 
IN
 
UINT8
 
LkMg
);

217 
VOID
 
InDlogTok
(

218 
IN
 
PRTMP_ADAPTER
 
pAd
,

219 
OUT
 
PUCHAR
 
pFmeBuf
,

220 
OUT
 
PULONG
 
pFmeL
,

221 
IN
 
UINT8
 
DlogTok
);

223 
NDIS_STATUS
 
TpcReqTabIn
(

224 
IN
 
PRTMP_ADAPTER
 
pAd
);

226 
VOID
 
TpcReqTabEx
(

227 
IN
 
PRTMP_ADAPTER
 
pAd
);

229 
VOID
 
NifyChSwAToPrAPs
(

230 
IN
 
PRTMP_ADAPTER
 
pAd
,

231 
IN
 
PUCHAR
 
pRA
,

232 
IN
 
PUCHAR
 
pTA
,

233 
IN
 
UINT8
 
ChSwMode
,

234 
IN
 
UINT8
 
Chl
);

236 
VOID
 
RguCss_BudBChLi
(

237 
IN
 
PRTMP_ADAPTER
 
pAd
,

238 
OUT
 
PUCHAR
 
pBuf
,

239 
OUT
 
PULONG
 
pBufL
);

	@include/spectrum_def.h

39 #ide
__SPECTRUM_DEF_H__


40 
	#__SPECTRUM_DEF_H__


	)

43 
	#MAX_MEASURE_REQ_TAB_SIZE
 32

	)

45 
	#MAX_HASH_MEASURE_REQ_TAB_SIZE
 
MAX_MEASURE_REQ_TAB_SIZE


	)

47 
	#MAX_TPC_REQ_TAB_SIZE
 32

	)

49 
	#MAX_HASH_TPC_REQ_TAB_SIZE
 
MAX_TPC_REQ_TAB_SIZE


	)

51 
	#MIN_RCV_PWR
 100

	)

53 
	#TPC_REQ_AGE_OUT
 500

	)

54 
	#MQ_REQ_AGE_OUT
 500

	)

56 
	#TPC_DIALOGTOKEN_HASH_INDEX
(
_DlogTok
((_DlogTok& (
MAX_HASH_TPC_REQ_TAB_SIZE
 - 1))

	)

57 
	#MQ_DIALOGTOKEN_HASH_INDEX
(
_DlogTok
((_DlogTok& (
MAX_MEASURE_REQ_TAB_SIZE
 - 1))

	)

59 
	s_MEASURE_REQ_ENTRY


61 
_MEASURE_REQ_ENTRY
 *
	mpNext
;

62 
ULONG
 
	mϡTime
;

63 
BOOLEAN
 
	mVid
;

64 
UINT8
 
	mDlogTok
;

65 
UINT8
 
	mMsuDlogTok
[3];

66 } 
	tMEASURE_REQ_ENTRY
, *
	tPMEASURE_REQ_ENTRY
;

68 
	s_MEASURE_REQ_TAB


70 
UCHAR
 
	mSize
;

71 
PMEASURE_REQ_ENTRY
 
	mHash
[
MAX_HASH_MEASURE_REQ_TAB_SIZE
];

72 
MEASURE_REQ_ENTRY
 
	mCڋ
[
MAX_MEASURE_REQ_TAB_SIZE
];

73 } 
	tMEASURE_REQ_TAB
, *
	tPMEASURE_REQ_TAB
;

75 
	s_TPC_REQ_ENTRY


77 
_TPC_REQ_ENTRY
 *
	mpNext
;

78 
ULONG
 
	mϡTime
;

79 
BOOLEAN
 
	mVid
;

80 
UINT8
 
	mDlogTok
;

81 } 
	tTPC_REQ_ENTRY
, *
	tPTPC_REQ_ENTRY
;

83 
	s_TPC_REQ_TAB


85 
UCHAR
 
	mSize
;

86 
PTPC_REQ_ENTRY
 
	mHash
[
MAX_HASH_TPC_REQ_TAB_SIZE
];

87 
TPC_REQ_ENTRY
 
	mCڋ
[
MAX_TPC_REQ_TAB_SIZE
];

88 } 
	tTPC_REQ_TAB
, *
	tPTPC_REQ_TAB
;

92 
	s_DOT11_CHANNEL_SET


94 
UCHAR
 
	mNumbOfChls
;

95 
UINT8
 
	mMaxTxPwr
;

96 
UCHAR
 
	mChlLi
[16];

97 } 
	tDOT11_CHANNEL_SET
, *
	tPDOT11_CHANNEL_SET
;

99 
	s_DOT11_REGULATORY_INFORMATION


101 
UCHAR
 
	mRegutyCss
;

102 
DOT11_CHANNEL_SET
 
	mChlS
;

103 } 
	tDOT11_REGULATORY_INFORMATION
, *
	tPDOT11_REGULATORY_INFORMATION
;

107 
	#RM_TPC_REQ
 0

	)

108 
	#RM_MEASURE_REQ
 1

	)

110 
	#RM_BASIC
 0

	)

111 
	#RM_CCA
 1

	)

112 
	#RM_RPI_HISTOGRAM
 2

	)

113 
	#RM_CH_LOAD
 3

	)

114 
	#RM_NOISE_HISTOGRAM
 4

	)

117 
GNU_PACKED
 
	t_TPC_REPORT_INFO


119 
UINT8
 
	gTxPwr
;

120 
UINT8
 
	gLkMg
;

121 } 
	tTPC_REPORT_INFO
, *
	tPTPC_REPORT_INFO
;

123 
GNU_PACKED
 
	t_CH_SW_ANN_INFO


125 
UINT8
 
	gChSwMode
;

126 
UINT8
 
	gChl
;

127 
UINT8
 
	gChSwC
;

128 } 
	tCH_SW_ANN_INFO
, *
	tPCH_SW_ANN_INFO
;

130 
GNU_PACKED
 
	t_MEASURE_REQ_MODE


132 #ifde
RT_BIG_ENDIAN


133 
	sGNU_PACKED


136 
	gUINT8
 :3;

137 
UINT8
 
	gDutiMdy
:1;

138 
UINT8
 
	gRt
:1;

139 
UINT8
 
	gReque
:1;

140 
UINT8
 
	gEb
:1;

141 
UINT8
 
	gPl
:1;

142 } 
	gfld
;

144 
	sGNU_PACKED


146 
UINT8
 
	gPl
:1;

147 
UINT8
 
	gEb
:1;

148 
UINT8
 
	gReque
:1;

149 
UINT8
 
	gRt
:1;

150 
UINT8
 
	gDutiMdy
:1;

151 
	gUINT8
 :3;

152 } 
	gfld
;

154 
UINT8
 
	gwd
;

155 } 
	tMEASURE_REQ_MODE
, *
	tPMEASURE_REQ_MODE
;

157 
GNU_PACKED
 
	t_MEASURE_REQ


159 
UINT8
 
	gChNum
;

160 
UINT64
 
	gMsuSTime
;

161 
UINT16
 
	gMsuDuti
;

162 } 
	tMEASURE_REQ
, *
	tPMEASURE_REQ
;

164 
GNU_PACKED
 
	t_MEASURE_REQ_INFO


166 
UINT8
 
	gTok
;

167 
MEASURE_REQ_MODE
 
	gReqMode
;

168 
UINT8
 
	gReqTy
;

169 
UINT8
 
	gO
[0];

170 } 
	tMEASURE_REQ_INFO
, *
	tPMEASURE_REQ_INFO
;

172 
GNU_PACKED
 
	t_MEASURE_BASIC_REPORT_MAP


174 #ifde
RT_BIG_ENDIAN


175 
	sGNU_PACKED


177 
UINT8
 
	gRev
:3;

179 
UINT8
 
	gUnmsu
:1;

180 
UINT8
 
	gRad
:1;

181 
UINT8
 
	gUnidtifdSigl
:1;

182 
UINT8
 
	gOfdmPamb
:1;

183 
UINT8
 
	gBSS
:1;

184 } 
	gfld
;

186 
	sGNU_PACKED


188 
UINT8
 
	gBSS
:1;

190 
UINT8
 
	gOfdmPamb
:1;

191 
UINT8
 
	gUnidtifdSigl
:1;

192 
UINT8
 
	gRad
:1;

193 
UINT8
 
	gUnmsu
:1;

194 
UINT8
 
	gRev
:3;

195 } 
	gfld
;

197 
UINT8
 
	gwd
;

198 } 
	tMEASURE_BASIC_REPORT_MAP
, *
	tPMEASURE_BASIC_REPORT_MAP
;

200 
GNU_PACKED
 
	t_MEASURE_BASIC_REPORT


202 
UINT8
 
	gChNum
;

203 
UINT64
 
	gMsuSTime
;

204 
UINT16
 
	gMsuDuti
;

205 
MEASURE_BASIC_REPORT_MAP
 
	gM
;

206 } 
	tMEASURE_BASIC_REPORT
, *
	tPMEASURE_BASIC_REPORT
;

208 
GNU_PACKED
 
	t_MEASURE_CCA_REPORT


210 
UINT8
 
	gChNum
;

211 
UINT64
 
	gMsuSTime
;

212 
UINT16
 
	gMsuDuti
;

213 
UINT8
 
	gCCA_Busy_Fi
;

214 } 
	tMEASURE_CCA_REPORT
, *
	tPMEASURE_CCA_REPORT
;

216 
GNU_PACKED
 
	t_MEASURE_RPI_REPORT


218 
UINT8
 
	gChNum
;

219 
UINT64
 
	gMsuSTime
;

220 
UINT16
 
	gMsuDuti
;

221 
UINT8
 
	gRPI_Dsy
[8];

222 } 
	tMEASURE_RPI_REPORT
, *
	tPMEASURE_RPI_REPORT
;

224 
GNU_PACKED
 
	t_MEASURE_REPORT_MODE


226 
	sGNU_PACKED


228 #ifde
RT_BIG_ENDIAN


229 
UINT8
 
	gRev
:5;

230 
UINT8
 
	gRefud
:1;

231 
UINT8
 
	gInb
:1;

232 
UINT8
 
	gLe
:1;

234 
UINT8
 
	gLe
:1;

235 
UINT8
 
	gInb
:1;

236 
UINT8
 
	gRefud
:1;

237 
UINT8
 
	gRev
:5;

239 } 
	gfld
;

240 
UINT8
 
	gwd
;

241 } 
	tMEASURE_REPORT_MODE
, *
	tPMEASURE_REPORT_MODE
;

243 
GNU_PACKED
 
	t_MEASURE_REPORT_INFO


245 
UINT8
 
	gTok
;

246 
UINT8
 
	gRtMode
;

247 
UINT8
 
	gRtTy
;

248 
UINT8
 
	gOe
[0];

249 } 
	tMEASURE_REPORT_INFO
, *
	tPMEASURE_REPORT_INFO
;

251 
GNU_PACKED
 
	t_QUIET_INFO


253 
UINT8
 
	gQutC
;

254 
UINT8
 
	gQutPiod
;

255 
UINT16
 
	gQutDuti
;

256 
UINT16
 
	gQutOfft
;

257 } 
	tQUIET_INFO
, *
	tPQUIET_INFO
;

	@include/sta_cfg.h

1 #ide
__STA_CFG_H__


2 
	#__STA_CFG_H__


	)

43 
INT
 
RTMPSTAPrivIolS
(

44 
IN
 
RTMP_ADAPTER
 *
pAd
,

45 
IN
 
PSTRING
 
SProcName
,

46 
IN
 
PSTRING
 
ProcArg
);

	@include/vr_ikans.h

40 #ide
__VR_IKANS_H__


41 
	#__VR_IKANS_H__


	)

43 #ide
MODULE_IKANOS


44 
	#IKANOS_EXTERN
 

	)

46 
	#IKANOS_EXTERN


	)

49 #ifde
IKANOS_VX_1X0


50 (*
	tIkosWnTxCbFuncP
)(*, *);

52 
	sIKANOS_TX_INFO


54 
t_devi
 *
tdev
;

55 
IkosWnTxCbFuncP
 *

;

60 
IKANOS_EXTERN
 
	`VR_IKANOS_FP_In
(
UINT8
 
BssNum
, UINT8 *
pApMac
);

62 
IKANOS_EXTERN
 
INT32
 
	`IKANOS_DaFmesTx
(
sk_buff
 *
pSkb
,

63 
t_devi
 *
pNDev
);

65 
IKANOS_EXTERN
 
	`IKANOS_DaFmeRx
(
PRTMP_ADAPTER
 
pAd
,

66 *
pRxPam
,

67 
sk_buff
 *
pSkb
,

68 
UINT32
 
Lgth
);

	@include/wpa.h

38 #idef 
__WPA_H__


39 
	#__WPA_H__


	)

41 #ide
ROUND_UP


42 
	#ROUND_UP
(
__x
, 
__y
) \

43 (((
ULONG
)((
__x
)+((
__y
)-1))& ((ULONG)~((__y)-1)))

	)

46 
	#SET_UINT16_TO_ARRARY
(
_V
, 
_LEN
) \

48 
_V
[0] = ((
UINT16
)
_LEN
) >> 8; \

49 
_V
[1] = ((
UINT16
)
_LEN
 & 0xFF); \

50 }

	)

52 
	#INC_UINT16_TO_ARRARY
(
_V
, 
_LEN
) \

54 
UINT16
 
v_n
; \

56 
v_n
 = (
_V
[0]<<8) | (_V[1]); \

57 
v_n
 +
_LEN
; \

59 
_V
[0] = (
v_n
 & 0xFF00) >> 8; \

60 
_V
[1] = (
v_n
 & 0xFF); \

61 }

	)

63 
	#CONV_ARRARY_TO_UINT16
(
_V
((_V[0]<<8| (_V[1]))

	)

65 
	#ADD_ONE_To_64BIT_VAR
(
_V
) \

67 
UCHAR
 
t
 = 
LEN_KEY_DESC_REPLAY
; \

70 
t
--; \

71 
_V
[
t
]++; \

72 i(
t
 == 0) \

74 }
_V
[
t
] == 0); \

75 }

	)

77 
	#INC_TX_TSC
(
_tsc
, 
_t
) \

79 
INT
 
i
=0; \

80 ++
_tsc
[
i
] == 0x0) \

82 
i
++; \

83 i(
i
 =(
_t
)) \

86 }

	)

88 
	#IS_WPA_CAPABILITY
(
a
((>
Ndis802_11AuthModeWPA
&& (<
Ndis802_11AuthModeWPA1PSKWPA2PSK
))

	)

94 
	#IS_INVALID_HT_SECURITY
(
_mode
) \

95 (((
_mode
=
Ndis802_11Enyi1Ebd
) || \

96 ((
_mode
=
Ndis802_11Enyi2Ebd
))

	)

98 
	#MIX_CIPHER_WPA_TKIP_ON
(
x
(((x& 0x08!0)

	)

99 
	#MIX_CIPHER_WPA_AES_ON
(
x
(((x& 0x04!0)

	)

100 
	#MIX_CIPHER_WPA2_TKIP_ON
(
x
(((x& 0x02!0)

	)

101 
	#MIX_CIPHER_WPA2_AES_ON
(
x
(((x& 0x01!0)

	)

104 #ifde
WPA_DAEMON_MODE


106 
	#WPA_GET_BSS_NUM
(
_pAd
(_pAd)->
mbss_num


	)

108 
	#WPA_GET_PMK
(
_pAd
, 
_pEry
, 
_pmk
) \

110 
_pmk
 = 
_pAd
->
MBSS
[
_pEry
->
idx
].
PMK
; \

111 }

	)

113 
	#WPA_GET_GTK
(
_pAd
, 
_pEry
, 
_gtk
) \

115 
_gtk
 = 
_pAd
->
MBSS
[
_pEry
->
idx
].
GTK
; \

116 }

	)

118 
	#WPA_GET_GROUP_CIPHER
(
_pAd
, 
_pEry
, 
_ch
) \

120 
_ch
 = (
_pAd
)->
MBSS
[
_pEry
->
idx
].
GroupEnypTy
; \

121 }

	)

123 
	#WPA_GET_DEFAULT_KEY_ID
(
_pAd
, 
_pEry
, 
_idx
) \

125 
_idx
 = (
_pAd
)->
MBSS
[
_pEry
->
idx
].
DeuKeyId
; \

126 }

	)

128 
	#WPA_GET_BMCST_TSC
(
_pAd
, 
_pEry
, 
_tsc
) \

130 
_tsc
 = 1; \

131 }

	)

133 
	#WPA_BSSID
(
_pAd
, 
_idx
(_pAd)->
MBSS
[_idx].
wn_addr


	)

135 
	#WPA_OS_MALLOC
(
_p
, 
_s
) \

137 
_p
 = 
	`os_mloc
(
_s
); \

138 }

	)

140 
	#WPA_OS_FREE
(
_p
) \

142 
	`os_
(
_p
); \

143 }

	)

145 
	#WPA_GET_CURRENT_TIME
(
_time
) \

147 
timev
 
tv
; \

148 
	`gtimeofday
(&
tv
, 
NULL
); \

149 *(
_time

tv
.
tv_c
; \

150 }

	)

155 #i
defed
(
CONFIG_AP_SUPPORT
&& defed(
CONFIG_STA_SUPPORT
)

156 
	#WPA_GET_BSS_NUM
(
_pAd
(((_pAd)->
OpMode
 =
OPMODE_AP
? (_pAd)->
ApCfg
.
BssidNum
 : 1)

	)

157 
	#WPA_GET_GROUP_CIPHER
(
_pAd
, 
_pEry
, 
_ch
) \

159 
_ch
 = 
Ndis802_11WEPDibd
; \

160 i((
_pAd
)->
OpMode
 =
OPMODE_AP
) \

162 i(
	`IS_ENTRY_APCLI
(
_pEry
) && \

163 ((
_pEry
)->
MchAPCLITabIdx
 < 
MAX_APCLI_NUM
)) \

164 
_ch
 = (
_pAd
)->
ApCfg
.
ApCliTab
[(
_pEry
)->
MchAPCLITabIdx
].
GroupCh
; \

165 i((
_pEry
)->
idx
 < (
_pAd
)->
ApCfg
.
BssidNum
) \

166 
_ch
 = (
_pAd
)->
ApCfg
.
MBSSID
[
_pEry
->
idx
].
GroupKeyWStus
;\

169 
_ch
 = (
_pAd
)->
SCfg
.
GroupCh
; \

170 }

	)

172 
	#WPA_BSSID
(
_pAd
, 
_idx
(((_pAd)->
OpMode
 =
OPMODE_AP
) ?\

173 (
_pAd
)->
ApCfg
.
MBSSID
[
_idx
].
Bssid
 :\

174 (
_pAd
)->
CommCfg
.
Bssid
)

	)

175 #i
defed
(
CONFIG_AP_SUPPORT
)

176 
	#WPA_GET_BSS_NUM
(
_pAd
(_pAd)->
ApCfg
.
BssidNum


	)

177 
	#WPA_GET_GROUP_CIPHER
(
_pAd
, 
_pEry
, 
_ch
) \

179 
_ch
 = 
Ndis802_11WEPDibd
; \

180 i(
	`IS_ENTRY_APCLI
(
_pEry
) && \

181 ((
_pEry
)->
MchAPCLITabIdx
 < 
MAX_APCLI_NUM
)) \

182 
_ch
 = (
_pAd
)->
ApCfg
.
ApCliTab
[(
_pEry
)->
MchAPCLITabIdx
].
GroupCh
; \

183 i((
_pEry
)->
idx
 < (
_pAd
)->
ApCfg
.
BssidNum
) \

184 
_ch
 = (
_pAd
)->
ApCfg
.
MBSSID
[
_pEry
->
idx
].
GroupKeyWStus
;\

185 }

	)

187 
	#WPA_BSSID
(
_pAd
, 
_idx
(_pAd)->
ApCfg
.
MBSSID
[_idx].
Bssid


	)

189 #i
defed
(
CONFIG_STA_SUPPORT
)

190 
	#WPA_GET_BSS_NUM
(
_pAd
1

	)

191 
	#WPA_GET_GROUP_CIPHER
(
_pAd
, 
_pEry
, 
_ch
) \

193 
_ch
 = (
_pAd
)->
SCfg
.
GroupCh
; \

194 }

	)

195 
	#WPA_BSSID
(
_pAd
, 
_idx
(_pAd)->
CommCfg
.
Bssid


	)

199 
	#WPA_OS_MALLOC
(
_p
, 
_s
) \

201 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
_p
, 
_s
); \

202 }

	)

204 
	#WPA_OS_FREE
(
_p
) \

206 
	`os__mem
(
NULL
, 
_p
); \

207 }

	)

209 
	#WPA_GET_CURRENT_TIME
(
_time

	`NdisGSyemUpTime
(_time);

	)

217 
c_iv_by
(

218 
UCHAR
 *
iv
,

219 
UINT
 
n
,

220 
UINT
 
t
);

222 
BOOLEAN
 
WMsgTySub
(

223 
IN
 
UCHAR
 
EAPTy
,

224 
OUT
 
INT
 *
MsgTy
);

226 
VOID
 
PRF
(

227 
IN
 
UCHAR
 *
key
,

228 
IN
 
INT
 
key_n
,

229 
IN
 
UCHAR
 *
efix
,

230 
IN
 
INT
 
efix_n
,

231 
IN
 
UCHAR
 *
da
,

232 
IN
 
INT
 
da_n
,

233 
OUT
 
UCHAR
 *
ouut
,

234 
IN
 
INT
 
n
);

236 
RtmpPasswdHash
(

237 *
sswd
,

238 *
ssid
,

239 
ssidngth
,

240 *
ouut
);

242 
VOID
 
KDF
(

243 
IN
 
PUINT8
 
key
,

244 
IN
 
INT
 
key_n
,

245 
IN
 
PUINT8
 
b
,

246 
IN
 
INT
 
b_n
,

247 
IN
 
PUINT8
 
da
,

248 
IN
 
INT
 
da_n
,

249 
OUT
 
PUINT8
 
ouut
,

250 
IN
 
USHORT
 
n
);

252 
PUINT8
 
WPA_ExaSueFromRSNIE
(

253 
IN
 
PUINT8
 
r
,

254 
IN
 
UINT
 
r_n
,

255 
IN
 
UINT8
 
ty
,

256 
OUT
 
UINT8
 *
cou
);

258 
VOID
 
WShowAsue
(

259 
IN
 
PUINT8
 
r
,

260 
IN
 
UINT
 
r_n
);

262 
VOID
 
RTMPInRSNIE
(

263 
IN
 
PUCHAR
 
pFmeBuf
,

264 
OUT
 
PULONG
 
pFmeL
,

265 
IN
 
PUINT8
 
r_r
,

266 
IN
 
UINT8
 
r_n
,

267 
IN
 
PUINT8
 
pmkid_r
,

268 
IN
 
UINT8
 
pmkid_n
);

275 
VOID
 
RTMPToWessS
(

276 
IN
 
PRTMP_ADAPTER
 
pAd
,

277 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

278 
IN
 
PUCHAR
 
pHd802_3
,

279 
IN
 
UINT
 
HdrL
,

280 
IN
 
PUCHAR
 
pDa
,

281 
IN
 
UINT
 
DaL
,

282 
IN
 
BOOLEAN
 
bCˬFme
);

284 
VOID
 
WDivePTK
(

285 
IN
 
PRTMP_ADAPTER
 
pAd
,

286 
IN
 
UCHAR
 *
PMK
,

287 
IN
 
UCHAR
 *
AN
,

288 
IN
 
UCHAR
 *
AA
,

289 
IN
 
UCHAR
 *
SN
,

290 
IN
 
UCHAR
 *
SA
,

291 
OUT
 
UCHAR
 *
ouut
,

292 
IN
 
UINT
 
n
);

294 
VOID
 
WDiveGTK
(

295 
IN
 
UCHAR
 *
PMK
,

296 
IN
 
UCHAR
 *
GN
,

297 
IN
 
UCHAR
 *
AA
,

298 
OUT
 
UCHAR
 *
ouut
,

299 
IN
 
UINT
 
n
);

301 
VOID
 
GRdom
(

302 
IN
 
PRTMP_ADAPTER
 
pAd
,

303 
IN
 
UCHAR
 *
macAddr
,

304 
OUT
 
UCHAR
 *
ndom
);

306 
BOOLEAN
 
RTMPCheckWPAame
(

307 
IN
 
PRTMP_ADAPTER
 
pAd
,

308 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

309 
IN
 
PUCHAR
 
pDa
,

310 
IN
 
ULONG
 
DaByCou
,

311 
IN
 
UCHAR
 
FromWhichBSSID
);

313 
BOOLEAN
 
RTMPPEKeyDa
(

314 
IN
 
PRTMP_ADAPTER
 
pAd
,

315 
IN
 
PUCHAR
 
pKeyDa
,

316 
IN
 
UCHAR
 
KeyDaL
,

317 
IN
 
UCHAR
 
GroupKeyIndex
,

318 
IN
 
UCHAR
 
MsgTy
,

319 
IN
 
BOOLEAN
 
bWPA2
,

320 
IN
 
MAC_TABLE_ENTRY
 *
pEry
);

322 
VOID
 
WPA_CڡruKdeHdr
(

323 
IN
 
UINT8
 
da_ty
,

324 
IN
 
UINT8
 
da_n
,

325 
OUT
 
PUCHAR
 
pBuf
);

327 
VOID
 
CڡruEMsg
(

328 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

329 
IN
 
UCHAR
 
GroupKeyWStus
,

330 
IN
 
UCHAR
 
MsgTy
,

331 
IN
 
UCHAR
 
DeuKeyIdx
,

332 
IN
 
UCHAR
 *
KeyN
,

333 
IN
 
UCHAR
 *
TxRSC
,

334 
IN
 
UCHAR
 *
GTK
,

335 
IN
 
UCHAR
 *
RSNIE
,

336 
IN
 
UCHAR
 
RSNIE_L
,

337 
OUT
 
PEAPOL_PACKET
 
pMsg
);

339 
PCIPHER_KEY
 
RTMPSwChKeySei
(

340 
IN
 
PRTMP_ADAPTER
 
pAd
,

341 
IN
 
PUCHAR
 
pIV
,

342 
IN
 
RX_BLK
 *
pRxBlk
,

343 
IN
 
PMAC_TABLE_ENTRY
 
pEry
);

345 
NDIS_STATUS
 
RTMPSoDeyiAi
(

346 
IN
 
PRTMP_ADAPTER
 
pAd
,

347 
IN
 
PUCHAR
 
pHdr
,

348 
IN
 
UCHAR
 
UrPriܙy
,

349 
IN
 
PCIPHER_KEY
 
pKey
,

350 
INOUT
 
PUCHAR
 
pDa
,

351 
INOUT
 
UINT16
 *
DaByC
);

353 
VOID
 
RTMPSoCڡruIVHdr
(

354 
IN
 
UCHAR
 
ChAlg
,

355 
IN
 
UCHAR
 
key_id
,

356 
IN
 
PUCHAR
 
pTxIv
,

357 
OUT
 
PUCHAR
 
pHdrIv
,

358 
OUT
 
UINT8
 *
hdr_iv_n
);

360 
VOID
 
RTMPSoEnyiAi
(

361 
IN
 
PRTMP_ADAPTER
 
pAd
,

362 
IN
 
UCHAR
 
ChAlg
,

363 
IN
 
PUCHAR
 
pHdr
,

364 
IN
 
PUCHAR
 
pSrcBufDa
,

365 
IN
 
UINT32
 
SrcBufL
,

366 
IN
 
UCHAR
 
KeyIdx
,

367 
IN
 
PCIPHER_KEY
 
pKey
,

368 
OUT
 
UINT8
 *
ext_n
);

370 
VOID
 
RTMPMakeRSNIE
(

371 
IN
 
PRTMP_ADAPTER
 
pAd
,

372 
IN
 
UINT
 
AuthMode
,

373 
IN
 
UINT
 
WStus
,

374 
IN
 
UCHAR
 
idx
);

376 
VOID
 
WPAInlPawiKey
(

377 
PRTMP_ADAPTER
 
pAd
,

378 
UINT8
 
BssIdx
,

379 
PMAC_TABLE_ENTRY
 
pEry
,

380 
BOOLEAN
 
bAE
);

382 
VOID
 
WPAInlShedKey
(

383 
PRTMP_ADAPTER
 
pAd
,

384 
UINT8
 
GroupCh
,

385 
UINT8
 
BssIdx
,

386 
UINT8
 
KeyIdx
,

387 
UINT8
 
Wcid
,

388 
BOOLEAN
 
bAE
,

389 
PUINT8
 
pGtk
);

391 
VOID
 
RTMPSWcidSecuryInfo
(

392 
PRTMP_ADAPTER
 
pAd
,

393 
UINT8
 
BssIdx
,

394 
UINT8
 
KeyIdx
,

395 
UINT8
 
ChAlg
,

396 
UINT8
 
Wcid
,

397 
UINT8
 
KeyTabFg
);

399 
VOID
 
CcuϋMIC
(

400 
IN
 
UCHAR
 
KeyDescV
,

401 
IN
 
UCHAR
 *
PTK
,

402 
OUT
 
PEAPOL_PACKET
 
pMsg
);

404 
PSTRING
 
GEMsgTy
(
CHAR
 
msg
);

406 #ifde
CONFIG_STA_SUPPORT


414 
UINT
 
RTMP_CALC_FCS32
(

415 
IN
 
UINT
 
Fcs
,

416 
IN
 
PUCHAR
 
Cp
,

417 
IN
 
INT
 
L
);

419 
VOID
 
RTMPCڡruWEPIVHdr
(

420 
IN
 
UINT8
 
key_idx
,

421 
IN
 
UCHAR
 *

,

422 
OUT
 
UCHAR
 *
iv_hdr
);

424 
BOOLEAN
 
RTMPSoEnyWEP
(

425 
IN
 
PRTMP_ADAPTER
 
pAd
,

426 
IN
 
PUCHAR
 
pIvHdr
,

427 
IN
 
PCIPHER_KEY
 
pKey
,

428 
INOUT
 
PUCHAR
 
pDa
,

429 
IN
 
ULONG
 
DaByC
);

431 
BOOLEAN
 
RTMPSoDeyWEP
(

432 
IN
 
PRTMP_ADAPTER
 
pAd
,

433 
IN
 
PCIPHER_KEY
 
pKey
,

434 
INOUT
 
PUCHAR
 
pDa
,

435 
INOUT
 
UINT16
 *
DaByC
);

442 
BOOLEAN
 
RTMPSoDeyTKIP
(

443 
IN
 
PRTMP_ADAPTER
 
pAd
,

444 
IN
 
PUCHAR
 
pHdr
,

445 
IN
 
UCHAR
 
UrPriܙy
,

446 
IN
 
PCIPHER_KEY
 
pKey
,

447 
INOUT
 
PUCHAR
 
pDa
,

448 
IN
 
UINT16
 *
DaByC
);

450 
VOID
 
TKIP_GTK_KEY_WRAP
(

451 
IN
 
UCHAR
 *
key
,

452 
IN
 
UCHAR
 *
iv
,

453 
IN
 
UCHAR
 *
put_xt
,

454 
IN
 
UINT32
 
put_n
,

455 
OUT
 
UCHAR
 *
ouut_xt
);

457 
VOID
 
TKIP_GTK_KEY_UNWRAP
(

458 
IN
 
UCHAR
 *
key
,

459 
IN
 
UCHAR
 *
iv
,

460 
IN
 
UCHAR
 *
put_xt
,

461 
IN
 
UINT32
 
put_n
,

462 
OUT
 
UCHAR
 *
ouut_xt
);

469 
BOOLEAN
 
RTMPSoDeyAES
(

470 
IN
 
PRTMP_ADAPTER
 
pAd
,

471 
IN
 
PUCHAR
 
pDa
,

472 
IN
 
ULONG
 
DaByC
,

473 
IN
 
PCIPHER_KEY
 
pWKey
);

475 
VOID
 
RTMPCڡruCCMPHdr
(

476 
IN
 
UINT8
 
key_idx
,

477 
IN
 
UCHAR
 *

,

478 
OUT
 
UCHAR
 *
ccmp_hdr
);

480 
BOOLEAN
 
RTMPSoEnyCCMP
(

481 
IN
 
PRTMP_ADAPTER
 
pAd
,

482 
IN
 
PUCHAR
 
pHdr
,

483 
IN
 
PUCHAR
 
pIV
,

484 
IN
 
PUCHAR
 
pKey
,

485 
INOUT
 
PUCHAR
 
pDa
,

486 
IN
 
UINT32
 
DaL
);

488 
BOOLEAN
 
RTMPSoDeyCCMP
(

489 
IN
 
PRTMP_ADAPTER
 
pAd
,

490 
IN
 
PUCHAR
 
pHdr
,

491 
IN
 
PCIPHER_KEY
 
pKey
,

492 
INOUT
 
PUCHAR
 
pDa
,

493 
INOUT
 
UINT16
 *
DaL
);

495 
VOID
 
CCMP__ve
(

496 
IN
 
PRTMP_ADAPTER
 
pAd
,

497 
IN
 
INT
 
put
);

	@include/wpa_cmm.h

27 #ide
WPA_CMM_H


28 
	#WPA_CMM_H


	)

30 
	~"mp_ty.h
"

31 
	~"d11i_w.h
"

33 
	#CACHE_NOT_FOUND
 -1

	)

35 
	#TX_EAPOL_BUFFER
 1500

	)

38 
	#PEER_MSG1_RETRY_TIMER_CTR
 0

	)

39 
	#PEER_MSG3_RETRY_TIMER_CTR
 10

	)

40 
	#GROUP_MSG1_RETRY_TIMER_CTR
 20

	)

43 
	#PEER_MSG1_RETRY_EXEC_INTV
 1000

44 
	#PEER_MSG3_RETRY_EXEC_INTV
 3000

45 
	#GROUP_KEY_UPDATE_EXEC_INTV
 1000

46 
	#PEER_GROUP_KEY_UPDATE_INIV
 2000

47 

	)

48 
	#EAPOL_MSG_INVALID
 0

	)

49 
	#EAPOL_PAIR_MSG_1
 1

	)

50 
	#EAPOL_PAIR_MSG_2
 2

	)

51 
	#EAPOL_PAIR_MSG_3
 3

	)

52 
	#EAPOL_PAIR_MSG_4
 4

	)

53 
	#EAPOL_GROUP_MSG_1
 5

	)

54 
	#EAPOL_GROUP_MSG_2
 6

	)

56 
	#ENQUEUE_EAPOL_START_TIMER
 200

57 

	)

59 
	#TIME_REKEY
 0

	)

60 
	#PKT_REKEY
 1

	)

61 
	#DISABLE_REKEY
 2

	)

62 
	#MAX_REKEY
 2

	)

64 
	#MAX_REKEY_INTER
 0x3ffffff

	)

66 
	#EAPOL_START_DISABLE
 0

	)

67 
	#EAPOL_START_PSK
 1

	)

68 
	#EAPOL_START_1X
 2

	)

73 
	#WPA_PTK
 0

	)

74 
	#MAX_WPA_PTK_STATE
 1

	)

76 
	#WPA_MACHINE_BASE
 0

	)

77 
	#MT2_EAPPack
 0

	)

78 
	#MT2_EAPOLS
 1

	)

79 
	#MT2_EAPOLLogoff
 2

	)

80 
	#MT2_EAPOLKey
 3

	)

81 
	#MT2_EAPOLASFA˹
 4

	)

82 
	#MAX_WPA_MSG
 5

	)

84 
	#WPA_FUNC_SIZE
 (
MAX_WPA_PTK_STATE
 * 
MAX_WPA_MSG
)

	)

86 
	e_WRe
 {

87 
	mWPA_NONE
,

88 
	mWPA_Authtit
,

89 
	mWPA_Suli
,

90 
	mWPA_BOTH
,

91 } 
	tWPA_ROLE
;

94 
	e_ApWS
 {

95 
	mAS_NOTUSE
,

96 
	mAS_DISCONNECT
,

97 
	mAS_DISCONNECTED
,

98 
	mAS_INITIALIZE
,

99 
	mAS_AUTHENTICATION
,

100 
	mAS_AUTHENTICATION2
,

101 
	mAS_INITPMK
,

102 
	mAS_INITPSK
,

103 
	mAS_PTKSTART
,

104 
	mAS_PTKINIT_NEGOTIATING
,

105 
	mAS_PTKINITDONE
,

106 
	mAS_UPDATEKEYS
,

107 
	mAS_INTEGRITY_FAILURE
,

108 
	mAS_KEYUPDATE
,

109 } 
	tAP_WPA_STATE
;

113 
	e_WS


115 
	mSS_NOTUSE
,

116 
	mSS_START
,

117 
	mSS_WAIT_MSG_3
,

118 
	mSS_WAIT_GROUP
,

119 
	mSS_FINISH
,

120 
	mSS_KEYUPDATE
,

121 } 
	tWPA_STATE
;

124 
	e_GTKS
 {

125 
	mREKEY_NEGOTIATING
,

126 
	mREKEY_ESTABLISHED
,

127 
	mKEYERROR
,

128 } 
	tGTK_STATE
;

131 
	e_WGTKS
 {

132 
	mSETKEYS
,

133 
	mSETKEYS_DONE
,

134 } 
	tWPA_GTK_STATE
;

137 
	#WPA_SM_4WAY_HS_START
 1

	)

138 
	#WPA_SM_DISCONNECT
 0xff

	)

141 
	e_WPA_VARIABLE_ELEMENT_ID


143 
	mWPA_ELEM_CMD
 = 1,

144 
	mWPA_ELEM_PEER_RSNIE
,

145 
	mWPA_ELEM_LOCAL_RSNIE
,

146 
	mWPA_ELEM_PMK
,

147 
	mWPA_ELEM_RESV


148 } 
	tWPA_VARIABLE_ELEMENT_ID
;

150 
	#GROUP_SUITE
 0

	)

151 
	#PAIRWISE_SUITE
 1

	)

152 
	#AKM_SUITE
 2

	)

153 
	#RSN_CAP_INFO
 3

	)

154 
	#PMKID_LIST
 4

	)

155 
	#G_MGMT_SUITE
 5

	)

174 
	e_WMixPaCh


176 
	mMIX_CIPHER_NOTUSE
 = 0x00,

177 
	mWPA_NONE_WPA2_TKIPAES
 = 0x03,

178 
	mWPA_AES_WPA2_TKIP
 = 0x06,

179 
	mWPA_AES_WPA2_TKIPAES
 = 0x07,

180 
	mWPA_TKIP_WPA2_AES
 = 0x09,

181 
	mWPA_TKIP_WPA2_TKIPAES
 = 0x0B,

182 
	mWPA_TKIPAES_WPA2_NONE
 = 0x0C,

183 
	mWPA_TKIPAES_WPA2_AES
 = 0x0D,

184 
	mWPA_TKIPAES_WPA2_TKIP
 = 0x0E,

185 
	mWPA_TKIPAES_WPA2_TKIPAES
 = 0x0F,

186 } 
	tWPA_MIX_PAIR_CIPHER
;

189 
	e_D1xIlCmd


191 
	mDOT1X_DISCONNECT_ENTRY
,

192 
	mDOT1X_RELOAD_CONFIG
,

193 } 
	tDOT1X_INTERNAL_CMD
;

196 
	s_IEEE8021X_FRAME
 {

197 
UCHAR
 
	mVsi
;

198 
UCHAR
 
	mTy
;

199 
USHORT
 
	mLgth
;

200 } 
	tIEEE8021X_FRAME
, *
	tPIEEE8021X_FRAME
;

202 
GNU_PACKED
 
	t_RSN_IE_HEADER_STRUCT
 {

203 
UCHAR
 
	gEid
;

204 
UCHAR
 
	gLgth
;

205 
USHORT
 
	gVsi
;

206 } 
	tRSN_IE_HEADER_STRUCT
, *
	tPRSN_IE_HEADER_STRUCT
;

209 
GNU_PACKED
 
	t_CIPHER_SUITE_STRUCT
 {

210 
UCHAR
 
	gOui
[3];

211 
UCHAR
 
	gTy
;

212 } 
	tCIPHER_SUITE_STRUCT
, *
	tPCIPHER_SUITE_STRUCT
;

215 
GNU_PACKED
 
	t_AKM_SUITE_STRUCT
 {

216 
UCHAR
 
	gOui
[3];

217 
UCHAR
 
	gTy
;

218 } 
	tAKM_SUITE_STRUCT
, *
	tPAKM_SUITE_STRUCT
;

221 
GNU_PACKED
 
	t_RSN_CAPABILITY
 {

222 
USHORT
 
	gRsv
:10;

223 
USHORT
 
	gGTKSARyC
:2;

224 
USHORT
 
	gPTKSARyC
:2;

225 
USHORT
 
	gNoPawi
:1;

226 
USHORT
 
	gPAuth
:1;

227 } 
	tRSN_CAPABILITY
, *
	tPRSN_CAPABILITY
;

229 
	s_CIPHER_KEY
 {

230 
UCHAR
 
	mKey
[16];

231 
UCHAR
 
	mTxMic
[8];

232 
UCHAR
 
	mRxMic
[8];

233 
UCHAR
 
	mTxTsc
[16];

234 
UCHAR
 
	mRxTsc
[16];

235 
UCHAR
 
	mChAlg
;

236 
UCHAR
 
	mKeyL
;

237 #ifde
CONFIG_STA_SUPPORT


238 
UCHAR
 
	mBssId
[6];

240 
UCHAR
 
	mTy
;

241 } 
	tCIPHER_KEY
, *
	tPCIPHER_KEY
;

	@include/wsc.h

39 #idef 
__WSC_H__


40 
	#__WSC_H__


	)

43 
	#WSC_OUI
 0x0050f204

	)

44 
	#WSC_SMI
 0x00372A

	)

45 
	#WSC_VENDOR_TYPE
 0x00000001

	)

48 
	#EAP_CODE_REQ
 0x01

	)

49 
	#EAP_CODE_RSP
 0x02

	)

50 
	#EAP_CODE_FAIL
 0x04

	)

51 
	#EAP_TYPE_ID
 0x01

	)

52 
	#EAP_TYPE_NOTIFY
 0x02

	)

53 
	#EAP_TYPE_WSC
 0x

	)

56 
GNU_PACKED
 
	t_WSC_LV_INFO
 {

57 
USHORT
 
	gVueL
;

58 
UCHAR
 
	gVue
[512];

59 } 
	tWSC_LV_INFO
;

61 
GNU_PACKED
 
	t_WSC_IE_HEADER
 {

62 
UCHAR
 
	gemId
;

63 
UCHAR
 
	gngth
;

64 
UCHAR
 
	goui
[4];

65 } 
	tWSC_IE_HEADER
;

68 
GNU_PACKED
 
	t_WSC_IE


70 
USHORT
 
	gTy
;

71 
USHORT
 
	gLgth
;

72 
UCHAR
 
	gDa
[1];

73 } 
	tWSC_IE
, *
	tPWSC_IE
;

76 
GNU_PACKED
 
	t_WSC_FRAME
 {

77 
UCHAR
 
	gSMI
[3];

78 
UINT
 
	gVdTy
;

79 
UCHAR
 
	gOpCode
;

80 
UCHAR
 
	gFgs
;

81 } 
	tWSC_FRAME
, *
	tPWSC_FRAME
;

84 
GNU_PACKED
 
	t_EAP_FRAME
 {

85 
UCHAR
 
	gCode
;

86 
UCHAR
 
	gId
;

87 
USHORT
 
	gLgth
;

88 
UCHAR
 
	gTy
;

89 } 
	tEAP_FRAME
, *
	tPEAP_FRAME
;

91 
le
 
BOOLEAN
 
	$WscCheckWSCHd
(

92 
IN
 
PUCHAR
 
pDa
)

94 
PWSC_FRAME
 
pWsc
;

96 
pWsc
 = (
PWSC_FRAME

pDa
;

99 i(((
pWsc
->
SMI
[0] * 256 +Wsc->SMI[1]* 256 +Wsc->SMI[2]!
WSC_SMI
)

102  
FALSE
;

106 i(
	`u2be32
(
	`g_uligd
(&
pWsc
->
VdTy
)!
WSC_VENDOR_TYPE
)

109  
FALSE
;

111  
TRUE
;

112 
	}
}

	@os/linux/br_ftph.c

40 
	~"_cfig.h
"

42 #ifde
BG_FT_SUPPORT


43 #i
defed
(
CONFIG_BRIDGE
|| defed(
CONFIG_BRIDGE_MODULE
)

44 
	~<lux/tfr_bridge.h
>

45 
	~"../t/bridge/br_ive.h
"

70 
UINT32
 
BG_FTPH_PackFromApHd
(

71 
IN
 
PNDIS_PACKET
 
pPack
);

73 #ifde
BG_FT_OPEN_SUPPORT


74 
	$UINT32
 (*
RALINK_FP_Hd
)(
PNDIS_PACKET
 
pPack
);

76 
	$UINT32
 (*
RALINK_FP_Hd
)(
PNDIS_PACKET
 
pPack
);

99 
VOID
 
	$BG_FTPH_In
(
VOID
)

101 
RALINK_FP_Hd
 = 
BG_FTPH_PackFromApHd
;

102 
	}
}

120 
VOID
 
	$BG_FTPH_Remove
(
VOID
)

122 
RALINK_FP_Hd
 = 
NULL
;

123 
	}
}

142 
UINT32
 
	$BG_FTPH_PackFromApHd
(

143 
IN
 
PNDIS_PACKET
 
pPack
)

145 
t_devi
 *
pNDev
;

146 
sk_buff
 *
pRxPkt
;

147 
t_bridge_fdb_y
 *
pSrcFdbEry
, *
pDFdbEry
;

151 
pRxPkt
 = 
	`RTPKT_TO_OSPKT
(
pPack
);

152 
pNDev
 = 
pRxPkt
->
dev
;

155 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("ft bg> BG_FTPH_PacketFromApHandle\n"));

157 i(
pNDev
 !
NULL
)

159 i(
pNDev
->
br_pt
 !
NULL
)

161 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,12)

162 
pDFdbEry
 = 
	`br_fdb_g_hook
(
pNDev
->
br_pt
->
br
, 
pRxPkt
->
da
);

163 
pSrcFdbEry
 = 
	`br_fdb_g_hook
(
pNDev
->
br_pt
->
br
, 
pRxPkt
->
da
 + 6);

166 
pDFdbEry
 = 
	`br_fdb_g
(
pNDev
->
br_pt
->
br
, 
pRxPkt
->
da
);

167 
pSrcFdbEry
 = 
	`br_fdb_g
(
pNDev
->
br_pt
->
br
, 
pRxPkt
->
da
 + 6);

171 i((
pSrcFdbEry
 =
NULL
) ||

172 (
pDFdbEry
 =
NULL
) ||

173 (
pDFdbEry
->
is_lol
) ||

174 (
pDFdbEry
->
d
 =
NULL
) ||

175 (
pDFdbEry
->
d
->
dev
 =
NULL
) ||

176 (
pDFdbEry
->
d
->
dev
 =
pNDev
) ||

177 (
pNDev
->
br_pt
->
e
 !
BR_STATE_FORWARDING
) ||

178 ((
pSrcFdbEry
->
d
 !
NULL
) &&

179 (
pSrcFdbEry
->
d
->
dev
 !
NULL
) &&

180 (
pSrcFdbEry
->
d
->
dev
 !
pNDev
)))

183 
LabPassToULay
;

186 i((!
pDFdbEry
->
is_lol
) &&

187 (
pDFdbEry
->
d
 !
NULL
) &&

188 (
pDFdbEry
->
d
->
dev
 !
NULL
))

190 
pRxPkt
->
dev
 = 
pDFdbEry
->
d
->dev;

191 
pDFdbEry
->
d
->
dev
->
	`hd_t_xm
(
pRxPkt
,DstFdbEntry->dst->dev);

197 
LabPassToULay
:

198 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ft bg> Passacketo bridge module.\n"));

200 
	}
}

	@os/linux/cfg80211.c

53 
	~"_cfig.h
"

56 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,28))

57 #ifde
RT_CFG80211_SUPPORT


59 
	#RT_CFG80211_DEBUG


	)

60 
	#CFG80211CB
 ((
CFG80211_CB
 *)(
pAd
->
pCfg80211_CB
))

	)

63 #ifde
RT_CFG80211_DEBUG


64 
	#CFG80211DBG
(
__Flg
, 
__pMsg

	`DBGPRINT
(__Flg, __pMsg)

	)

66 
	#CFG80211DBG
(
__Flg
, 
__pMsg
)

	)

70 
	#CFG80211_NUM_OF_CHAN_2GHZ
 14

	)

73 
	#CFG80211_NUM_OF_CHAN_5GHZ
 \

74 ((
Cfg80211_Ch
)-
CFG80211_NUM_OF_CHAN_2GHZ
)

	)

83 cڡ 
80211_
 
	gCfg80211_SupRe
[12] = {

85 .
ags
 = 
IEEE80211_RATE_SHORT_PREAMBLE
,

86 .
	gb
 = 10,

87 .
	ghw_vue
 = 0,

88 .
	ghw_vue_sht
 = 0,

91 .
	gags
 = 
IEEE80211_RATE_SHORT_PREAMBLE
,

92 .
	gb
 = 20,

93 .
	ghw_vue
 = 1,

94 .
	ghw_vue_sht
 = 1,

97 .
	gags
 = 
IEEE80211_RATE_SHORT_PREAMBLE
,

98 .
	gb
 = 55,

99 .
	ghw_vue
 = 2,

100 .
	ghw_vue_sht
 = 2,

103 .
	gags
 = 
IEEE80211_RATE_SHORT_PREAMBLE
,

104 .
	gb
 = 110,

105 .
	ghw_vue
 = 3,

106 .
	ghw_vue_sht
 = 3,

109 .
	gags
 = 0,

110 .
	gb
 = 60,

111 .
	ghw_vue
 = 4,

112 .
	ghw_vue_sht
 = 4,

115 .
	gags
 = 0,

116 .
	gb
 = 90,

117 .
	ghw_vue
 = 5,

118 .
	ghw_vue_sht
 = 5,

121 .
	gags
 = 0,

122 .
	gb
 = 120,

123 .
	ghw_vue
 = 6,

124 .
	ghw_vue_sht
 = 6,

127 .
	gags
 = 0,

128 .
	gb
 = 180,

129 .
	ghw_vue
 = 7,

130 .
	ghw_vue_sht
 = 7,

133 .
	gags
 = 0,

134 .
	gb
 = 240,

135 .
	ghw_vue
 = 8,

136 .
	ghw_vue_sht
 = 8,

139 .
	gags
 = 0,

140 .
	gb
 = 360,

141 .
	ghw_vue
 = 9,

142 .
	ghw_vue_sht
 = 9,

145 .
	gags
 = 0,

146 .
	gb
 = 480,

147 .
	ghw_vue
 = 10,

148 .
	ghw_vue_sht
 = 10,

151 .
	gags
 = 0,

152 .
	gb
 = 540,

153 .
	ghw_vue
 = 11,

154 .
	ghw_vue_sht
 = 11,

159 cڡ 
UCHAR
 
	gCfg80211_Ch
[] = {

176 cڡ 
UINT32
 
	gChSues
[] = {

177 
WLAN_CIPHER_SUITE_WEP40
,

178 
WLAN_CIPHER_SUITE_WEP104
,

179 
WLAN_CIPHER_SUITE_TKIP
,

180 
WLAN_CIPHER_SUITE_CCMP
,

184 
	s__CFG80211_CB


187 
80211_su܋d_bd
 
	mCfg80211_bds
[
IEEE80211_NUM_BANDS
];

188 
80211_chl
 *
	mpCfg80211_Chls
;

189 
80211_
 *
	mpCfg80211_Res
;

192 
wess_dev
 *
	mpCfg80211_Wdev
;

195 
cfg80211_sn_que
 *
	mpCfg80211_SnReq
;

198 
UINT32
 
	mMFrFg
;

199 } 
	tCFG80211_CB
;

204 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,30))

205 
INT32
 
CFG80211_RegNifr
(

206 
IN
 
why
 *
pWhy
,

207 
IN
 
guty_que
 *
pReque
);

209 
INT32
 
CFG80211_RegNifr
(

210 
IN
 
why
 *
pWhy
,

211 
IN
 
g_t_by
 
Reque
);

217 
BOOLEAN
 
CFG80211_SupBdIn
(

218 
IN
 
PRTMP_ADAPTER
 
pAd
,

219 
IN
 
why
 *
pWhy
,

220 
IN
 
80211_chl
 *
pChls
,

221 
IN
 
80211_
 *
pRes
);

229 
	#MAC80211_PAD_GET
(
__pAd
, 
__pWhy
) \

231 
ULONG
 *
__pPriv
; \

232 
__pPriv
 = (
ULONG
 *)(
	`why_iv
(
__pWhy
)); \

233 
__pAd
 = (
PRTMP_ADAPTER
)(*
__pPriv
); \

234 i(
__pAd
 =
NULL
) \

236 
	`DBGPRINT
(
RT_DEBUG_ERROR
, \

237 ("80211> %bupAd = NULL!", 
__FUNCTION__
)); \

238  -
EINVAL
; \

240 }

	)

267 
	$CFG80211_OpsSChl
(

268 
IN
 
why
 *
pWhy
,

269 
IN
 
80211_chl
 *
pCh
,

270 
IN
 
80211_chl_ty
 
ChlTy
)

272 
PRTMP_ADAPTER
 
pAd
;

273 
UINT32
 
ChId
;

274 
STRING
 
ChS
[5] = { 0 };

275 #ifde
DOT11_N_SUPPORT


276 
UCHAR
 
BW_Old
;

277 
BOOLEAN
 
FlgIsChged
;

281 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_OpsSetChannel ==>\n"));

282 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

285 
ChId
 = 
	`80211_equcy_to_chl
(
pCh
->
_eq
);

286 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> Ch%d\n", 
ChId
));

287 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> ChlTy = %d\n", 
ChlTy
));

289 #ifde
DOT11_N_SUPPORT


290 i(
CFG80211CB
->
pCfg80211_Wdev
->
iy
 !
NL80211_IFTYPE_MONITOR
)

293 
FlgIsChged
 = 
FALSE
;

294 
BW_Old
 = 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
;

297 i(
ChlTy
 =
NL80211_CHAN_HT20
)

299 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 = 
BW_20
;

300 
FlgIsChged
 = 
TRUE
;

302 i((
ChlTy
 =
NL80211_CHAN_HT40MINUS
) ||

303 (
ChlTy
 =
NL80211_CHAN_HT40PLUS
))

307 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 = 
BW_40
;

308 
FlgIsChged
 = 
TRUE
;

311 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> New BW = %d\n",

312 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
));

315 i(((
ChlTy
 =
NL80211_CHAN_NO_HT
) &&

316 (
pAd
->
CommCfg
.
HT_Dib
 == 0)) ||

317 ((
ChlTy
 !
NL80211_CHAN_NO_HT
) &&

318 (
pAd
->
CommCfg
.
HT_Dib
 == 1)))

320 i(
ChlTy
 =
NL80211_CHAN_NO_HT
)

321 
pAd
->
CommCfg
.
HT_Dib
 = 1;

323 
pAd
->
CommCfg
.
HT_Dib
 = 0;

326 
FlgIsChged
 = 
TRUE
;

327 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> HT Disable = %d\n",

328 
pAd
->
CommCfg
.
HT_Dib
));

334 
FlgIsChged
 = 
TRUE
;

335 
pAd
->
CommCfg
.
HT_Dib
 = 0;

336 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 = 
BW_40
;

339 i(
FlgIsChged
 =
TRUE
)

340 
	`SCommHT
(
pAd
);

345 
	`rtf
(
ChS
, "%d", 
ChId
);

346 i(
	`S_Chl_Proc
(
pAd
, 
ChS
=
FALSE
)

348 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> Change channel fail!\n"));

351 #ifde
CONFIG_STA_SUPPORT


352 #ifde
DOT11_N_SUPPORT


353 i((
CFG80211CB
->
pCfg80211_Wdev
->
iy
 =
NL80211_IFTYPE_STATION
) &&

354 (
FlgIsChged
 =
TRUE
))

363 
	`S_SSID_Proc
(
pAd
, (
PSTRING
Ad->
CommCfg
.
Ssid
);

367 i(
CFG80211CB
->
pCfg80211_Wdev
->
iy
 =
NL80211_IFTYPE_ADHOC
)

370 
	`MlmeUpdeTxRes
(
pAd
, 
FALSE
, 0);

371 
	`MakeIbssBc
(
pAd
);

372 
	`AsicEbIbssSync
(
pAd
);

374 
	`S_SSID_Proc
(
pAd
, (
PSTRING
Ad->
CommCfg
.
Ssid
);

377 i(
CFG80211CB
->
pCfg80211_Wdev
->
iy
 =
NL80211_IFTYPE_MONITOR
)

380 
	`S_NwkTy_Proc
(
pAd
, "Monitor");

381 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 
CFG80211CB
->
MFrFg
);

386 
	}
}

409 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,32))

410 
	$CFG80211_OpsChgVtuInf
(

411 
IN
 
why
 *
pWhy
,

412 
IN
 
t_devi
 *
pNDevIn
,

413 
IN
 
80211_iy
 
Ty
,

414 
IN
 
u32
 *
pFgs
,

415 
vif_ms
 *
pPams
)

417 
	$CFG80211_OpsChgVtuInf
(

418 
IN
 
why
 *
pWhy
,

419 
IN
 
IfIndex
,

420 
IN
 
80211_iy
 
Ty
,

421 
IN
 
u32
 *
pFgs
,

422 
vif_ms
 *
pPams
)

425 
PRTMP_ADAPTER
 
pAd
;

426 
t_devi
 *
pNDev
;

429 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_OpsChgVirtualInf ==>\n"));

430 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

432 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> Ty = %d\n", 
Ty
));

435 #ifde
CONFIG_STA_SUPPORT


436 i((
Ty
 !
NL80211_IFTYPE_ADHOC
) &&

437 (
Ty
 !
NL80211_IFTYPE_STATION
) &&

438 (
Ty
 !
NL80211_IFTYPE_MONITOR
))

441 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("80211> Wrg iy %d!\n", 
Ty
));

442  -
EINVAL
;

446 #i(
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,32))

447 
pNDev
 = 
pNDevIn
;

449 
pNDev
 = 
	`__dev_g_by_dex
(&
_t
, 
IfIndex
);

452 i(
pNDev
 =
NULL
)

453  -
ENODEV
;

456 
pNDev
->
80211_r
->
iy
 = 
Ty
;

459 #ifde
CONFIG_STA_SUPPORT


460 i(
Ty
 =
NL80211_IFTYPE_ADHOC
)

461 
	`S_NwkTy_Proc
(
pAd
, "Adhoc");

462 i(
Ty
 =
NL80211_IFTYPE_STATION
)

463 
	`S_NwkTy_Proc
(
pAd
, "Infra");

464 #i(
LINUX_VERSION_CODE
 > 
	`KERNEL_VERSION
(2,4,20))

465 i(
Ty
 =
NL80211_IFTYPE_MONITOR
)

468 
	`S_NwkTy_Proc
(
pAd
, "Monitor");

470 i(
pFgs
 !
NULL
)

472 
UINT32
 
Fr
;

475 
	`RTMP_IO_READ32
(
pAd
, 
RX_FILTR_CFG
, &
Fr
);

477 i(((*
pFgs
& 
NL80211_MNTR_FLAG_FCSFAIL
) == NL80211_MNTR_FLAG_FCSFAIL)

478 
Fr
 = Filter & (~0x01);

480 
Fr
 = Filter | 0x01;

483 i(((*
pFgs
& 
NL80211_MNTR_FLAG_FCSFAIL
=
NL80211_MNTR_FLAG_PLCPFAIL
)

484 
Fr
 = Filter & (~0x02);

486 
Fr
 = Filter | 0x02;

489 i(((*
pFgs
& 
NL80211_MNTR_FLAG_CONTROL
) == NL80211_MNTR_FLAG_CONTROL)

490 
Fr
 = Filter & (~0xFF00);

492 
Fr
 = Filter | 0xFF00;

495 i(((*
pFgs
& 
NL80211_MNTR_FLAG_CONTROL
=
NL80211_MNTR_FLAG_OTHER_BSS
)

496 
Fr
 = Filter & (~0x08);

498 
Fr
 = Filter | 0x08;

501 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 
Fr
);

502 
CFG80211CB
->
MFrFg
 = 
Fr
;

509 
pAd
->
SCfg
.
bAutoRec
 = 
TRUE
;

511 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> SSID = %s\n", 
pAd
->
CommCfg
.
Ssid
));

512 
	`S_SSID_Proc
(
pAd
, (
PSTRING
Ad->
CommCfg
.
Ssid
);

516 
	}
}

519 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,30))

520 #ifde
CONFIG_STA_SUPPORT


557 
	$CFG80211_OpsSn
(

558 
IN
 
why
 *
pWhy
,

559 
IN
 
t_devi
 *
pNdev
,

560 
IN
 
cfg80211_sn_que
 *
pReque
)

562 
PRTMP_ADAPTER
 
pAd
;

565 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_OpsScan ==>\n"));

566 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

569 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

571 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("80211> Network is down!\n"));

572  -
ENETDOWN
;

575 i((
pNdev
->
80211_r
->
iy
 !
NL80211_IFTYPE_STATION
) &&

576 (
pNdev
->
80211_r
->
iy
 !
NL80211_IFTYPE_ADHOC
))

578  -
EOPNOTSUPP
;

581 i(
pAd
->
FlgCfg80211Sg
 =
TRUE
)

582  -
EBUSY
;

586 
pAd
->
FlgCfg80211Sg
 = 
TRUE
;

587 
CFG80211CB
->
pCfg80211_SnReq
 = 
pReque
;

589 
	`_iol_siwsn
(
pNdev
, 
NULL
, NULL, NULL);

591 
	}
}

596 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,31))

597 #ifde
CONFIG_STA_SUPPORT


620 
	$CFG80211_OpsJoIbss
(

621 
IN
 
why
 *
pWhy
,

622 
IN
 
t_devi
 *
pNdev
,

623 
IN
 
cfg80211_ibss_ms
 *
pPams
)

625 
PRTMP_ADAPTER
 
pAd
;

627 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_OpsJoinIbss ==>\n"));

628 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

630 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> SSID = %s\n",

631 
pPams
->
ssid
));

632 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> Beacon Interval = %d\n",

633 
pPams
->
bc_rv
));

635 
pAd
->
SCfg
.
bAutoRec
 = 
TRUE
;

637 
pAd
->
CommCfg
.
BcPiod
 = 
pPams
->
bc_rv
;

638 
	`S_SSID_Proc
(
pAd
, (
PSTRING
)
pPams
->
ssid
);

641 
	}
}

661 
	$CFG80211_OpsLveIbss
(

662 
IN
 
why
 *
pWhy
,

663 
IN
 
t_devi
 *
pNdev
)

665 
PRTMP_ADAPTER
 
pAd
;

667 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_OpsLeaveIbss ==>\n"));

668 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

670 
pAd
->
SCfg
.
bAutoRec
 = 
FALSE
;

671 
	`LkDown
(
pAd
, 
FALSE
);

674 
	}
}

679 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,32))

701 
	$CFG80211_TxPwrS
(

702 
IN
 
why
 *
pWhy
,

703 
IN
 
tx_pow_g
 
Ty
,

704 
IN
 
dBm
)

706  -
EOPNOTSUPP
;

707 
	}
}

726 
	$CFG80211_TxPwrG
(

727 
IN
 
why
 *
pWhy
,

728 
IN
 *
pdBm
)

730  -
EOPNOTSUPP
;

731 
	}
}

752 
	$CFG80211_PwrMgmt
(

753 
IN
 
why
 *
pWhy
,

754 
IN
 
t_devi
 *
pNdev
,

755 
IN
 
bo
 
FlgIsEbd
,

756 
IN
 
Timeout
)

758  -
EOPNOTSUPP
;

759 
	}
}

780 
	$CFG80211_SG
(

781 
IN
 
why
 *
pWhy
,

782 
IN
 
t_devi
 *
pNdev
,

783 
IN
 
UINT8
 *
pMac
,

784 
IN
 
i_fo
 *
pSfo
)

786 
PRTMP_ADAPTER
 
pAd
;

789 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_StaGet ==>\n"));

790 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

792 
	`memt
(
pSfo
, 0, (*pSinfo));

795 #ifde
CONFIG_STA_SUPPORT


797 
HTTRANSMIT_SETTING
 
PhyInfo
;

798 
ULONG
 
DaRe
 = 0;

799 
UINT32
 
RSSI
;

803 i((
pAd
->
CommCfg
.
PhyMode
 <
PHY_11G
) ||

804 (
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
MODE
 <
MODE_OFDM
))

806 
PhyInfo
.
wd
 = 
pAd
->
SCfg
.
HTPhyMode
.word;

809 
PhyInfo
.
wd
 = 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.word;

812 
	`gRe
(
PhyInfo
, &
DaRe
);

814 i((
PhyInfo
.
fld
.
MODE
 =
MODE_HTMIX
) ||

815 (
PhyInfo
.
fld
.
MODE
 =
MODE_HTGREENFIELD
))

817 
pSfo
->
tx
.
ags
 = 
RATE_INFO_FLAGS_MCS
;

818 i(
PhyInfo
.
fld
.
BW
)

819 
pSfo
->
tx
.
ags
 |
RATE_INFO_FLAGS_40_MHZ_WIDTH
;

821 i(
PhyInfo
.
fld
.
ShtGI
)

822 
pSfo
->
tx
.
ags
 |
RATE_INFO_FLAGS_SHORT_GI
;

825 
pSfo
->
tx
.
mcs
 = 
PhyInfo
.
fld
.
MCS
;

829 
pSfo
->
tx
.
gacy
 = 
DaRe
*10;

832 
pSfo
->
fd
 |
STATION_INFO_TX_BITRATE
;

835 
RSSI
 = (
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
 +

836 
pAd
->
SCfg
.
RssiSame
.
AvgRssi1
 +

837 
pAd
->
SCfg
.
RssiSame
.
AvgRssi2
) / 3;

838 
pSfo
->
sigl
 = 
	`32_to_u
(
RSSI
);

839 
pSfo
->
fd
 |
STATION_INFO_SIGNAL
;

844 
	}
}

866 
	$CFG80211_SDump
(

867 
IN
 
why
 *
pWhy
,

868 
IN
 
t_devi
 *
pNdev
,

869 
IN
 
Idx
,

870 
IN
 
UINT8
 *
pMac
,

871 
IN
 
i_fo
 *
pSfo
)

873 
PRTMP_ADAPTER
 
pAd
;

876 i(
Idx
 != 0)

877  -
ENOENT
;

880 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_StaDump ==>\n"));

881 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

883 #ifde
CONFIG_STA_SUPPORT


884 i(
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
)

886 
	`memy
(
pMac
, 
pAd
->
MlmeAux
.
Bssid
, 6);

887  
	`CFG80211_SG
(
pWhy
, 
pNdev
, 
pMac
, 
pSfo
);

890  -
EBUSY
;

894  -
EOPNOTSUPP
;

895 
	}
}

914 
	$CFG80211_WhyPamsS
(

915 
IN
 
why
 *
pWhy
,

916 
IN
 
UINT32
 
Chged
)

918  -
EOPNOTSUPP
;

919 
	}
}

942 
	$CFG80211_KeyAdd
(

943 
IN
 
why
 *
pWhy
,

944 
IN
 
t_devi
 *
pNdev
,

945 
IN
 
UINT8
 
KeyIdx
,

946 
IN
 cڡ 
UINT8
 *
pMacAddr
,

947 
IN
 
key_ms
 *
pPams
)

949 
PRTMP_ADAPTER
 
pAd
;

950 
UCHAR
 
KeyBuf
[50];

953 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_KeyAdd ==>\n"));

954 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

956 #ifde
RT_CFG80211_DEBUG


957 
	`hex_dump
("KeyBuf=", (
UINT8
 *)
pPams
->
key
,Pams->
key_n
);

960 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> KeyIdx = %d\n", 
KeyIdx
));

962 i(
pPams
->
key_n
 >(
KeyBuf
))

963  -
EINVAL
;

966 
	`memy
(
KeyBuf
, 
pPams
->
key
,Pams->
key_n
);

967 
KeyBuf
[
pPams
->
key_n
] = 0x00;

969 #ifde
CONFIG_STA_SUPPORT


970 
pPams
->
ch
)

972 
WLAN_CIPHER_SUITE_WEP40
:

973 
WLAN_CIPHER_SUITE_WEP104
:

974 
KeyIdx
+1)

978 
	`S_Key1_Proc
(
pAd
, (
PSTRING
)
KeyBuf
);

982 
	`S_Key2_Proc
(
pAd
, (
PSTRING
)
KeyBuf
);

986 
	`S_Key3_Proc
(
pAd
, (
PSTRING
)
KeyBuf
);

990 
	`S_Key4_Proc
(
pAd
, (
PSTRING
)
KeyBuf
);

995 
WLAN_CIPHER_SUITE_TKIP
:

996 
WLAN_CIPHER_SUITE_CCMP
:

997 
	`S_WPAPSK_Proc
(
pAd
, (
PSTRING
)
KeyBuf
);

1001  -
ENOTSUPP
;

1007 
	}
}

1037 
CFG80211_KeyG
(

1038 
IN
 
why
 *
pWhy
,

1039 
IN
 
t_devi
 *
pNdev
,

1040 
IN
 
UINT8
 
KeyIdx
,

1041 
IN
 cڡ 
UINT8
 *
pMacAddr
,

1042 
IN
 *
pCook
,

1043 
IN
 (*
pClback
)(*
cook
,

1044 
key_ms
 *))

1047  -
ENOTSUPP
;

1048 
	}
}

1070 
	$CFG80211_KeyD
(

1071 
IN
 
why
 *
pWhy
,

1072 
IN
 
t_devi
 *
pNdev
,

1073 
IN
 
UINT8
 
KeyIdx
,

1074 
IN
 cڡ 
UINT8
 *
pMacAddr
)

1076 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_KeyDel ==>\n"));

1077  -
ENOTSUPP
;

1078 
	}
}

1098 
	$CFG80211_KeyDeuS
(

1099 
IN
 
why
 *
pWhy
,

1100 
IN
 
t_devi
 *
pNdev
,

1101 
IN
 
UINT8
 
KeyIdx
)

1103 
PRTMP_ADAPTER
 
pAd
;

1106 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_KeyDefaultSet ==>\n"));

1107 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

1109 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> KeyIdx = %d\n", 
KeyIdx
));

1111 #ifde
CONFIG_STA_SUPPORT


1112 
pAd
->
SCfg
.
DeuKeyId
 = 
KeyIdx
;

1115 
	}
}

1118 #ifde
CONFIG_STA_SUPPORT


1147 
	$CFG80211_C
(

1148 
IN
 
why
 *
pWhy
,

1149 
IN
 
t_devi
 *
pNdev
,

1150 
IN
 
cfg80211_c_ms
 *
pSme
)

1152 
PRTMP_ADAPTER
 
pAd
;

1153 
80211_chl
 *
pChl
 = 
pSme
->
chl
;

1154 
UCHAR
 
SSID
[
NDIS_802_11_LENGTH_SSID
];

1155 
INT32
 
Pawi
 = 0;

1156 
INT32
 
Groupwi
 = 0;

1157 
INT32
 
Keymgmt
 = 0;

1158 
INT32
 
WVsi
 = 
NL80211_WPA_VERSION_2
;

1159 
INT32
 
Ch
 = -1, 
Idx
, 
SSIDL
;

1162 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_Connect ==>\n"));

1165 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

1167 i(
pChl
 !
NULL
)

1168 
Ch
 = 
	`80211_equcy_to_chl
(
pChl
->
_eq
);

1170 
Groupwi
 = 
pSme
->
yo
.
ch_group
;

1171 
Idx
=0; Idx<
pSme
->
yo
.
n_chs_wi
; Idx++)

1172 
Pawi
 |
pSme
->
yo
.
chs_wi
[
Idx
];

1175 
Idx
=0; Idx<
pSme
->
yo
.
n_akm_sues
; Idx++)

1176 
Keymgmt
 |
pSme
->
yo
.
akm_sues
[
Idx
];

1179 
WVsi
 = 
pSme
->
yo
.
w_vsis
;

1182 
	`S_NwkTy_Proc
(
pAd
, "Infra");

1185 i(
WVsi
 & 
NL80211_WPA_VERSION_2
)

1187 i(
Keymgmt
 & 
WLAN_AKM_SUITE_8021X
)

1188 
	`S_AuthMode_Proc
(
pAd
, "WPA2");

1190 
	`S_AuthMode_Proc
(
pAd
, "WPA2PSK");

1193 i(
WVsi
 & 
NL80211_WPA_VERSION_1
)

1195 i(
Keymgmt
 & 
WLAN_AKM_SUITE_8021X
)

1196 
	`S_AuthMode_Proc
(
pAd
, "WPA");

1198 
	`S_AuthMode_Proc
(
pAd
, "WPAPSK");

1201 i(
pSme
->
auth_ty
 =
NL80211_AUTHTYPE_SHARED_KEY
)

1202 
	`S_AuthMode_Proc
(
pAd
, "SHARED");

1203 i(
pSme
->
auth_ty
 =
NL80211_AUTHTYPE_OPEN_SYSTEM
)

1204 
	`S_AuthMode_Proc
(
pAd
, "OPEN");

1206 
	`S_AuthMode_Proc
(
pAd
, "OPEN");

1209 
	`CFG80211DBG
(
RT_DEBUG_ERROR
,

1211 
pSme
->
auth_ty
, 
pAd
->
SCfg
.
AuthMode
));

1214 i(
Pawi
 & 
WLAN_CIPHER_SUITE_CCMP
)

1215 
	`S_EnypTy_Proc
(
pAd
, "AES");

1216 i(
Pawi
 & 
WLAN_CIPHER_SUITE_TKIP
)

1217 
	`S_EnypTy_Proc
(
pAd
, "TKIP");

1218 i((
Pawi
 & 
WLAN_CIPHER_SUITE_WEP40
) ||

1219 (
Pawi
 & 
WLAN_CIPHER_SUITE_WEP104
))

1221 
	`S_EnypTy_Proc
(
pAd
, "WEP");

1223 i(
Groupwi
 & 
WLAN_CIPHER_SUITE_CCMP
)

1224 
	`S_EnypTy_Proc
(
pAd
, "AES");

1225 i(
Groupwi
 & 
WLAN_CIPHER_SUITE_TKIP
)

1226 
	`S_EnypTy_Proc
(
pAd
, "TKIP");

1228 
	`S_EnypTy_Proc
(
pAd
, "NONE");

1231 
	`CFG80211DBG
(
RT_DEBUG_ERROR
,

1232 ("80211> EnypTy = %d\n", 
pAd
->
SCfg
.
WStus
));

1237 i(
pSme
->
key
 && (((
Groupwi
 | 
Pawi
& 
WLAN_CIPHER_SUITE_WEP40
) ||

1238 ((
Groupwi
 | 
Pawi
& 
WLAN_CIPHER_SUITE_WEP104
)))

1240 
UCHAR
 
KeyBuf
[50];

1243 
	`S_AuthMode_Proc
(
pAd
, "SHARED");

1244 
	`S_EnypTy_Proc
(
pAd
, "WEP");

1247 #ifde
RT_CFG80211_DEBUG


1248 
	`hex_dump
("KeyBuf=", (
UINT8
 *)
pSme
->
key
,Sme->
key_n
);

1251 
pAd
->
SCfg
.
DeuKeyId
 = 
pSme
->
key_idx
;

1252 i(
pSme
->
key_n
 >(
KeyBuf
))

1253  -
EINVAL
;

1255 
	`memy
(
KeyBuf
, 
pSme
->
key
,Sme->
key_n
);

1256 
KeyBuf
[
pSme
->
key_n
] = 0x00;

1258 
	`CFG80211DBG
(
RT_DEBUG_ERROR
,

1260 
pAd
->
SCfg
.
DeuKeyId
));

1262 
pSme
->
key_idx
)

1266 
	`S_Key1_Proc
(
pAd
, (
PSTRING
)
KeyBuf
);

1270 
	`S_Key2_Proc
(
pAd
, (
PSTRING
)
KeyBuf
);

1274 
	`S_Key3_Proc
(
pAd
, (
PSTRING
)
KeyBuf
);

1278 
	`S_Key4_Proc
(
pAd
, (
PSTRING
)
KeyBuf
);

1286 
pAd
->
SCfg
.
bAutoRec
 = 
TRUE
;

1287 
pAd
->
FlgCfg80211Cg
 = 
TRUE
;

1289 
SSIDL
 = 
pSme
->
ssid_n
;

1290 i(
SSIDL
 > 
NDIS_802_11_LENGTH_SSID
)

1291 
SSIDL
 = 
NDIS_802_11_LENGTH_SSID
;

1294 
	`memt
(&
SSID
, 0, (SSID));

1295 
	`memy
(
SSID
, 
pSme
->
ssid
, 
SSIDL
);

1296 
	`S_SSID_Proc
(
pAd
, (
PSTRING
)
SSID
);

1298 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> SSID = %s\n", 
SSID
));

1300 
	}
}

1321 
	$CFG80211_Disc
(

1322 
IN
 
why
 *
pWhy
,

1323 
IN
 
t_devi
 *
pNdev
,

1324 
IN
 
u16
 
RsCode
)

1326 
PRTMP_ADAPTER
 
pAd
;

1329 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_Disconnect ==>\n"));

1330 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> RsCod%d\n", 
RsCode
));

1332 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

1334 
pAd
->
SCfg
.
bAutoRec
 = 
FALSE
;

1335 
pAd
->
FlgCfg80211Cg
 = 
FALSE
;

1336 
	`LkDown
(
pAd
, 
FALSE
);

1338 
	}
}

1342 #ifde
RFKILL_HW_SUPPORT


1343 
	$CFG80211_RFKl
(

1344 
IN
 
why
 *
pWhy
)

1346 
PRTMP_ADAPTER
 
pAd
;

1347 
UINT32
 
da
 = 0;

1348 
BOOLEAN
 
aive
;

1350 
	`MAC80211_PAD_GET
(
pAd
, 
pWhy
);

1353 
	`RTMP_IO_READ32
(
pAd
, 
GPIO_CTRL_CFG
, &
da
);

1354 
aive
 = !!(
da
 & 0x04);

1355 
	`why_rfkl_t_hw_e
(
pWhy
, !
aive
);

1357  
aive
;

1358 
	}
}

1361 
cfg80211_s
 
	gCFG80211_Ops
 = {

1362 .
t_chl
 = 
CFG80211_OpsSChl
,

1363 .
	gchge_vtu_tf
 = 
CFG80211_OpsChgVtuInf
,

1365 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,30))

1366 #ifde
CONFIG_STA_SUPPORT


1367 .
	gsn
 = 
CFG80211_OpsSn
,

1371 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,31))

1372 #ifde
CONFIG_STA_SUPPORT


1373 .
	gjo_ibss
 = 
CFG80211_OpsJoIbss
,

1374 .
	gave_ibss
 = 
CFG80211_OpsLveIbss
,

1378 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,32))

1379 .
	gt_tx_pow
 = 
CFG80211_TxPwrS
,

1380 .
	gg_tx_pow
 = 
CFG80211_TxPwrG
,

1381 .
	gt_pow_mgmt
 = 
CFG80211_PwrMgmt
,

1382 .
	gg_i
 = 
CFG80211_SG
,

1383 .
	gdump_i
 = 
CFG80211_SDump
,

1384 .
	gt_why_ms
 = 
CFG80211_WhyPamsS
,

1385 .
	gadd_key
 = 
CFG80211_KeyAdd
,

1386 .
	gg_key
 = 
CFG80211_KeyG
,

1387 .
	gd_key
 = 
CFG80211_KeyD
,

1388 .
	gt_deu_key
 = 
CFG80211_KeyDeuS
,

1389 #ifde
CONFIG_STA_SUPPORT


1390 .
	gc
 = 
CFG80211_C
,

1391 .
	gdisc
 = 
CFG80211_Disc
,

1394 #ifde
RFKILL_HW_SUPPORT


1395 .
	grfkl_pl
 = 
CFG80211_RFKl
,

1415 
wess_dev
 *
	$CFG80211_WdevAoc
(

1416 
IN
 
PRTMP_ADAPTER
 
pAd
,

1417 
devi
 *
pDev
)

1419 
wess_dev
 *
pWdev
;

1420 
ULONG
 *
pPriv
;

1433 
pWdev
 = 
	`kzloc
((
wess_dev
), 
GFP_KERNEL
);

1434 i(
pWdev
 =
NULL
)

1436 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("80211> Wireless devicellocation fail!\n"));

1437  
NULL
;

1440 
pWdev
->
why
 = 
	`why_w
(&
CFG80211_Ops
, (
ULONG
 *));

1441 i(
pWdev
->
why
 =
NULL
)

1443 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("80211> Wiphy devicellocation fail!\n"));

1444 
LabEWhyNew
;

1448 
pPriv
 = (
ULONG
 *)(
	`why_iv
(
pWdev
->
why
));

1449 *
pPriv
 = (
ULONG
)
pAd
;

1451 
	`t_why_dev
(
pWdev
->
why
, 
pDev
);

1453 #i(
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,30))

1454 
pWdev
->
why
->
max_sn_ssids
 = 
MAX_LEN_OF_BSS_TABLE
;

1458 #ifde
CONFIG_STA_SUPPORT


1459 
pWdev
->
why
->
r_modes
 = 
	`BIT
(
NL80211_IFTYPE_STATION
) |

1460 
	`BIT
(
NL80211_IFTYPE_ADHOC
) |

1461 
	`BIT
(
NL80211_IFTYPE_MONITOR
);

1463 
pWdev
->
why
->
g_nifr
 = 
CFG80211_RegNifr
;

1466 
	`CFG80211_SupBdIn
(
pAd
, 
pWdev
->
why
, 
NULL
, NULL);

1468 #i(
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,30))

1470 
pWdev
->
why
->
sigl_ty
 = 
CFG80211_SIGNAL_TYPE_MBM
;

1473 #i(
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,32))

1474 
pWdev
->
why
->
ch_sues
 = 
ChSues
;

1475 
pWdev
->
why
->
n_ch_sues
 = 
	`ARRAY_SIZE
(
ChSues
);

1478 i(
	`why_gi
(
pWdev
->
why
) < 0)

1480 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("80211> Register wiphy device fail!\n"));

1481 
LabEReg
;

1484  
pWdev
;

1486 
LabEReg
:

1487 
	`why_
(
pWdev
->
why
);

1489 
LabEWhyNew
:

1490 
	`os__mem
(
NULL
, 
pWdev
);

1492  
NULL
;

1493 
	}
}

1520 
VOID
 
	$CFG80211_Regi
(

1521 
IN
 
VOID
 *
pAdCB
,

1522 
IN
 
devi
 *
pDev
,

1523 
IN
 
t_devi
 *
pNDev
)

1525 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pAdCB
;

1529 i(
pAd
->
pCfg80211_CB
 !
NULL
)

1533 
	`os_loc_mem
(
pAd
, (
UCHAR
 **)&pAd->
pCfg80211_CB
, (
CFG80211_CB
));

1534 i(
pAd
->
pCfg80211_CB
 =
NULL
)

1536 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("80211> Allocate MAC80211 CB fail!\n"));

1541 
CFG80211CB
->
pCfg80211_Wdev
 = 
	`CFG80211_WdevAoc
(
pAd
, 
pDev
);

1542 i(
CFG80211CB
->
pCfg80211_Wdev
 =
NULL
)

1544 
	`os__mem
(
NULL
, 
pAd
->
pCfg80211_CB
);

1545 
pAd
->
pCfg80211_CB
 = 
NULL
;

1551 #ifde
CONFIG_STA_SUPPORT


1553 
CFG80211CB
->
pCfg80211_Wdev
->
iy
 = 
NL80211_IFTYPE_STATION
;

1556 
pNDev
->
80211_r
 = 
CFG80211CB
->
pCfg80211_Wdev
;

1557 
	`SET_NETDEV_DEV
(
pNDev
, 
	`why_dev
(
CFG80211CB
->
pCfg80211_Wdev
->
why
));

1558 
CFG80211CB
->
pCfg80211_Wdev
->
tdev
 = 
pNDev
;

1561 
	`RT_CFG80211_API_INIT
(
pAd
);

1563 #ifde
RFKILL_HW_SUPPORT


1564 
	`why_rfkl_t_plg
(
CFG80211CB
->
pCfg80211_Wdev
->
why
);

1567 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_Register\n"));

1568 
	}
}

1586 
VOID
 
	$CFG80211_UnRegi
(

1587 
IN
 
PRTMP_ADAPTER
 
pAd
,

1588 
IN
 
t_devi
 *
pNDev
)

1590 #ifde
CONFIG_STA_SUPPORT


1591 
UINT32
 
BssId
;

1594 
BssId
=0; BssId<
MAX_LEN_OF_BSS_TABLE
; BssId++)

1596 i(
pAd
->
SnTab
.
BssEry
[
BssId
].
pCfg80211_Ch
 !
NULL
)

1597 
	`os__mem
(
NULL
, 
pAd
->
SnTab
.
BssEry
[
BssId
].
pCfg80211_Ch
);

1600 
pAd
->
SnTab
.
BssEry
[
BssId
].
pCfg80211_Ch
 = 
NULL
;

1605 i(
pAd
->
pCfg80211_CB
 =
NULL
)

1610 i(
CFG80211CB
->
pCfg80211_Wdev
 !
NULL
)

1612 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("80211> unregister/free wireless device\n"));

1619 #ifde
RFKILL_HW_SUPPORT


1620 
	`why_rfkl__plg
(
CFG80211CB
->
pCfg80211_Wdev
->
why
);

1622 
	`why_uegi
(
CFG80211CB
->
pCfg80211_Wdev
->
why
);

1623 
	`why_
(
CFG80211CB
->
pCfg80211_Wdev
->
why
);

1624 
	`os__mem
(
NULL
, 
CFG80211CB
->
pCfg80211_Wdev
);

1626 i(
CFG80211CB
->
pCfg80211_Chls
 !
NULL
)

1627 
	`os__mem
(
NULL
, 
CFG80211CB
->
pCfg80211_Chls
);

1630 i(
CFG80211CB
->
pCfg80211_Res
 !
NULL
)

1631 
	`os__mem
(
NULL
, 
CFG80211CB
->
pCfg80211_Res
);

1634 
CFG80211CB
->
pCfg80211_Wdev
 = 
NULL
;

1635 
CFG80211CB
->
pCfg80211_Chls
 = 
NULL
;

1636 
CFG80211CB
->
pCfg80211_Res
 = 
NULL
;

1639 
pNDev
->
80211_r
 = 
NULL
;

1640 
	`SET_NETDEV_DEV
(
pNDev
, 
NULL
);

1643 
	`os__mem
(
NULL
, 
pAd
->
pCfg80211_CB
);

1644 
pAd
->
pCfg80211_CB
 = 
NULL
;

1645 
pAd
->
CommCfg
.
HT_Dib
 = 0;

1646 
	}
}

1665 
VOID
 
	$CFG80211_BcCouryRegiP
(

1666 
IN
 
VOID
 *
pAdCB
,

1667 
IN
 
NDIS_802_11_VARIABLE_IEs
 *
pVIE
,

1668 
IN
 
UINT16
 
LVIE
)

1670 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pAdCB
;

1671 
UCHAR
 *
pEmt
 = (UCHAR *)
pVIE
;

1672 
UINT32
 
LEmt
;

1675 
LVIE
 > 0)

1677 
pVIE
 = (
NDIS_802_11_VARIABLE_IEs
 *)
pEmt
;

1679 i(
pVIE
->
EmtID
 =
IE_COUNTRY
)

1682 
	`RTEnqueueIlCmd
(
pAd
, 
CMDTHREAD_REG_HINT_11D
,

1683 
pVIE
->
da
,VIE->
Lgth
);

1687 
LEmt
 = 
pVIE
->
Lgth
 + 2;

1689 i(
LVIE
 <
LEmt
)

1693 
pEmt
 +
LEmt
;

1694 
LVIE
 -
LEmt
;

1696 
	}
}

1716 
VOID
 
	$CFG80211_RegHt
(

1717 
IN
 
VOID
 *
pAdCB
,

1718 
IN
 
UCHAR
 *
pCouryIe
,

1719 
IN
 
ULONG
 
CouryIeL
)

1721 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pAdCB
;

1724 
	`CFG80211DBG
(
RT_DEBUG_ERROR
,

1726 
pCouryIe
[0],CountryIe[1]));

1728 i((
CFG80211CB
->
pCfg80211_Wdev
 =
NULL
|| (
pCouryIe
 == NULL))

1730 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>egulatory domain hintot support!\n"));

1736 
	`guty_ht
(
CFG80211CB
->
pCfg80211_Wdev
->
why
, (cڡ *)
pCouryIe
);

1737 
	}
}

1757 
VOID
 
	$CFG80211_RegHt11D
(

1758 
IN
 
VOID
 *
pAdCB
,

1759 
IN
 
UCHAR
 *
pCouryIe
,

1760 
IN
 
ULONG
 
CouryIeL
)

1763 #i(
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,32))

1764 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pAdCB
;

1767 i((
CFG80211CB
->
pCfg80211_Wdev
 =
NULL
|| (
pCouryIe
 == NULL))

1769 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>egulatory domain hintot support!\n"));

1773 
	`CFG80211DBG
(
RT_DEBUG_ERROR
,

1775 
pCouryIe
[0],CountryIe[1]));

1782 
	`guty_ht_11d
(
CFG80211CB
->
pCfg80211_Wdev
->
why
, 
pCouryIe
, 
CouryIeL
);

1784 
	}
}

1807 
VOID
 
	$CFG80211_RegRuAly
(

1808 
IN
 
VOID
 *
pAdCB
,

1809 
IN
 
why
 *
pWhy
,

1810 
IN
 
UCHAR
 *
pAha2
)

1812 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pAdCB
;

1813 
80211_bd
 
IdBd
;

1814 
80211_su܋d_bd
 *
pSbd
;

1815 
80211_chl
 *
pCh
;

1816 
RADAR_DETECT_STRUCT
 *
pRadDe
;

1817 
UINT32
 
IdCh
, 
IdPwr
;

1818 
UINT32
 
ChId
, 
RecId
, 
DfsTy
;

1819 
ULONG
 
IrqFgs
;

1822 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda> CFG80211_RegRuleApply ==>\n"));

1825 i(
pWhy
 =
NULL
)

1827 i((
CFG80211CB
 !
NULL
&& (CFG80211CB->
pCfg80211_Wdev
 != NULL))

1828 
pWhy
 = 
CFG80211CB
->
pCfg80211_Wdev
->
why
;

1832 i((
pWhy
 =
NULL
|| (
pAha2
 == NULL))

1835 
	`RTMP_IRQ_LOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

1838 
	`NdisZoMemy
(
pAd
->
ChlLi
,

1839 
MAX_NUM_OF_CHANNELS
 * (
CHANNEL_TX_POWER
));

1842 
RecId
 = 0;

1843 
pRadDe
 = &
pAd
->
CommCfg
.
RadDe
;

1846 
DfsTy
 = 
CE
;

1848 #ifde
AUTO_CH_SELECT_ENHANCE


1849 #ifde
EXT_BUILD_CHANNEL_LIST


1850 i((
pAha2
[0] != '0') && (pAlpha2[1] != '0'))

1852 
UINT32
 
IdReg
;

1854 i(
pWhy
->
bds
[
IEEE80211_BAND_5GHZ
] !
NULL
)

1856 
IdReg
=0; ; IdReg++)

1858 i(
ChRegi
[
IdReg
].
CouReg
[0] == 0x00)

1862 i((
pAha2
[0] =
ChRegi
[
IdReg
].
CouReg
[0]) &&

1863 (
pAha2
[1] =
ChRegi
[
IdReg
].
CouReg
[1]))

1865 
DfsTy
 = 
ChRegi
[
IdReg
].DfsType;

1867 
	`CFG80211DBG
(
RT_DEBUG_ERROR
,

1869 
pAha2
[0],Aha2[1], 
DfsTy
));

1878 
IdBd
=0; IdBd<
IEEE80211_NUM_BANDS
; IdBand++)

1880 i(!
pWhy
->
bds
[
IdBd
])

1884 i(
IdBd
 =
IEEE80211_BAND_2GHZ
)

1886 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>eset chan/power for 2.4GHz\n"));

1890 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>eset chan/power for 5GHz\n"));

1893 
pSbd
 = 
pWhy
->
bds
[
IdBd
];

1895 
IdCh
=0; IdCh<
pSbd
->
n_chls
; IdChan++)

1897 
pCh
 = &
pSbd
->
chls
[
IdCh
];

1898 
ChId
 = 
	`80211_equcy_to_chl
(
pCh
->
_eq
);

1900 i((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11A
) ||

1901 (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11AN_MIXED
))

1904 i(
ChId
 <
CFG80211_NUM_OF_CHAN_2GHZ
)

1909 i((
pAd
->
CommCfg
.
PhyMode
 !
PHY_11A
) &&

1910 (
pAd
->
CommCfg
.
PhyMode
 !
PHY_11ABG_MIXED
) &&

1911 (
pAd
->
CommCfg
.
PhyMode
 !
PHY_11AN_MIXED
) &&

1912 (
pAd
->
CommCfg
.
PhyMode
 !
PHY_11ABGN_MIXED
) &&

1913 (
pAd
->
CommCfg
.
PhyMode
 !
PHY_11AGN_MIXED
))

1916 i(
ChId
 > 
CFG80211_NUM_OF_CHAN_2GHZ
)

1921 i(
pCh
->
ags
 & 
IEEE80211_CHAN_DISABLED
)

1924 
	`CFG80211DBG
(
RT_DEBUG_ERROR
,

1926 
ChId
, 
pCh
->
_eq
));

1932 
IdPwr
=0; IdPwr<
MAX_NUM_OF_CHANNELS
; IdPwr++)

1934 i(
ChId
 =
pAd
->
TxPow
[
IdPwr
].
Chl
)

1937 
	`NdisMoveMemy
(&
pAd
->
ChlLi
[
RecId
],

1938 &
pAd
->
TxPow
[
IdPwr
],

1939 (
CHANNEL_TX_POWER
));

1942 
pAd
->
ChlLi
[
RecId
].
Chl
 = 
ChId
;

1945 
pAd
->
ChlLi
[
RecId
].
MaxTxPwr
 = 
pCh
->
max_pow
;

1948 i(
pCh
->
ags
 & 
IEEE80211_CHAN_RADAR
)

1949 
pAd
->
ChlLi
[
RecId
].
DfsReq
 = 
TRUE
;

1951 
pAd
->
ChlLi
[
RecId
].
DfsReq
 = 
FALSE
;

1955 
pAd
->
ChlLi
[
RecId
].
RegutyDoma
 = 
DfsTy
;

1958 
pRadDe
->
RDDurRegi
 = 
DfsTy
;

1960 i(
DfsTy
 =
JAP_W53
)

1961 
pRadDe
->
DfsSessiTime
 = 15;

1962 i(
DfsTy
 =
JAP_W56
)

1963 
pRadDe
->
DfsSessiTime
 = 13;

1964 i(
DfsTy
 =
JAP
)

1965 
pRadDe
->
DfsSessiTime
 = 5;

1966 i(
DfsTy
 =
FCC
)

1968 
pRadDe
->
DfsSessiTime
 = 5;

1970 i(
DfsTy
 =
CE
)

1971 
pRadDe
->
DfsSessiTime
 = 13;

1973 
pRadDe
->
DfsSessiTime
 = 13;

1976 
	`CFG80211DBG
(
RT_DEBUG_ERROR
,

1979 
ChId
, 
pCh
->
_eq
,Ch->
max_pow
,

1980 ((
pCh
->
ags
 & 
IEEE80211_CHAN_RADAR
)?1:0),

1981 
DfsTy
));

1984 
RecId
 ++;

1991 
pAd
->
ChlLiNum
 = 
RecId
;

1992 
	`RTMP_IRQ_UNLOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

1994 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("da> Numb ochl%d\n", 
RecId
));

1995 
	}
}

2013 
VOID
 
	$CFG80211_Sng
(

2014 
IN
 
VOID
 *
pAdCB
,

2015 
IN
 
UINT32
 
BssIdx
,

2016 
IN
 
UINT32
 
ChId
,

2017 
IN
 
UCHAR
 *
pFme
,

2018 
IN
 
UINT32
 
FmeL
,

2019 
IN
 
INT32
 
RSSI
,

2020 
IN
 
INT32
 
MemFg
)

2022 #i(
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,30))

2023 #ifde
CONFIG_STA_SUPPORT


2024 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pAdCB
;

2025 
80211_chl
 *
pCh
;

2028 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_Scaning ==>\n"));

2030 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2032 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("80211> Network is down!\n"));

2040 i((
pAd
->
FlgCfg80211Sg
 =
FALSE
) &&

2041 (
pAd
->
FlgCfg80211Cg
 =
FALSE
))

2048 i(
pAd
->
SnTab
.
BssEry
[
BssIdx
].
pCfg80211_Ch
 =
NULL
)

2050 
	`os_loc_mem
(
pAd
,

2051 (
UCHAR
 **)&
pAd
->
SnTab
.
BssEry
[
BssIdx
].
pCfg80211_Ch
,

2052 (
80211_chl
));

2053 i(
pAd
->
SnTab
.
BssEry
[
BssIdx
].
pCfg80211_Ch
 =
NULL
)

2055 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("80211> Allocate chan fail!\n"));

2060 
pCh
 = 
pAd
->
SnTab
.
BssEry
[
BssIdx
].
pCfg80211_Ch
;

2061 
	`memt
(
pCh
, 0, (*pChan));

2063 i(
ChId
 > 14)

2064 
pCh
->
bd
 = 
IEEE80211_BAND_5GHZ
;

2066 
pCh
->
bd
 = 
IEEE80211_BAND_2GHZ
;

2069 
pCh
->
_eq
 = 
	`80211_chl_to_equcy
(
ChId
);

2071 #i(
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,32))

2072 i(
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
)

2074 i(
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 =
BW_20
)

2075 
pCh
->
max_bdwidth
 = 20;

2077 
pCh
->
max_bdwidth
 = 40;

2081 
pCh
->
max_bdwidth
 = 5;

2093 
	`cfg80211_fm_bss_ame
(
CFG80211CB
->
pCfg80211_Wdev
->
why
,

2094 
pAd
->
SnTab
.
BssEry
[
BssIdx
].
pCfg80211_Ch
,

2095 (
80211_mgmt
 *)
pFme
,

2096 
FmeL
,

2097 
RSSI
,

2098 
MemFg
);

2100 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> cfg80211_inform_bss_frame\n"));

2103 
	}
}

2121 
VOID
 
	$CFG80211_SnEnd
(

2122 
IN
 
VOID
 *
pAdCB
,

2123 
IN
 
BOOLEAN
 
FlgIsAb܋d
)

2125 #i(
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,30))

2126 #ifde
CONFIG_STA_SUPPORT


2127 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pAdCB
;

2130 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2132 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("80211> Network is down!\n"));

2136 i(
pAd
->
FlgCfg80211Sg
 =
FALSE
)

2140 i(
FlgIsAb܋d
 =
TRUE
)

2141 
FlgIsAb܋d
 = 1;

2143 
FlgIsAb܋d
 = 0;

2146 
	`cfg80211_sn_de
(
CFG80211CB
->
pCfg80211_SnReq
, 
FlgIsAb܋d
);

2148 
pAd
->
FlgCfg80211Sg
 = 
FALSE
;

2151 
	}
}

2172 
BOOLEAN
 
	$CFG80211_SupBdReIn
(

2173 
IN
 
VOID
 *
pAdCB
)

2175 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pAdCB
;

2176 
why
 *
pWhy
;

2180 i(
CFG80211CB
->
pCfg80211_Wdev
 =
NULL
)

2181  
FALSE
;

2184 
pWhy
 = 
CFG80211CB
->
pCfg80211_Wdev
->
why
;

2186 i(
pWhy
 !
NULL
)

2188 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211>e-init bands...\n"));

2191 
	`CFG80211_SupBdIn
(
pAd
, 
pWhy
,

2192 
CFG80211CB
->
pCfg80211_Chls
,

2193 
CFG80211CB
->
pCfg80211_Res
);

2195 #i(
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,32))

2197 
UINT32
 
Vue
 = 0;

2200 
pWhy
->
s_thshd
 = 
pAd
->
CommCfg
.
RtsThshd
;

2201 
pWhy
->
ag_thshd
 = 
pAd
->
CommCfg
.
FgmtThshd
;

2203 
	`RTMP_IO_READ32
(
pAd
, 
TX_RTY_CFG
, &
Vue
);

2204 
pWhy
->
y_sht
 = 
Vue
 & 0xff;

2205 
pWhy
->
y_lg
 = (
Vue
 & 0xff00)>>8;

2209  
TRUE
;

2212  
FALSE
;

2213 
	}
}

2236 
	$CFG80211_CResuInfm
(

2237 
IN
 
VOID
 *
pAdCB
,

2238 
IN
 
UCHAR
 *
pBSSID
,

2239 
IN
 
UCHAR
 *
pReqIe
,

2240 
IN
 
UINT32
 
ReqIeL
,

2241 
IN
 
UCHAR
 *
pRIe
,

2242 
IN
 
UINT32
 
RIeL
,

2243 
IN
 
UCHAR
 
FlgIsSucss
)

2245 #i(
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,32))

2246 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pAdCB
;

2249 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CFG80211_ConnectResultInform ==>\n"));

2251 i((
CFG80211CB
->
pCfg80211_Wdev
->
tdev
 =
NULL
|| (
pBSSID
 == NULL))

2255 i(
FlgIsSucss
)

2257 
	`cfg80211_c_su
(
CFG80211CB
->
pCfg80211_Wdev
->
tdev
,

2258 
pBSSID
,

2259 
pReqIe
,

2260 
ReqIeL
,

2261 
pRIe
,

2262 
RIeL
,

2263 
WLAN_STATUS_SUCCESS
,

2264 
GFP_KERNEL
);

2268 
	`cfg80211_c_su
(
CFG80211CB
->
pCfg80211_Wdev
->
tdev
,

2269 
pBSSID
,

2270 
NULL
, 0, NULL, 0,

2271 
WLAN_STATUS_UNSPECIFIED_FAILURE
,

2272 
GFP_KERNEL
);

2275 
pAd
->
FlgCfg80211Cg
 = 
FALSE
;

2277 
	}
}

2299 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,30))

2300 
INT32
 
	$CFG80211_RegNifr
(

2301 
IN
 
why
 *
pWhy
,

2302 
IN
 
guty_que
 *
pReque
)

2304 
PRTMP_ADAPTER
 
pAd
;

2305 
ULONG
 *
pPriv
;

2309 
pPriv
 = (
ULONG
 *)(
	`why_iv
(
pWhy
));

2310 
pAd
 = (
PRTMP_ADAPTER
)(*
pPriv
);

2312 i(
pAd
 =
NULL
)

2314 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("crda>egotify butAd = NULL!"));

2353 
pReque
->
t
)

2355 
NL80211_REGDOM_SET_BY_CORE
:

2359 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>equlationequestion by core: "));

2362 
NL80211_REGDOM_SET_BY_USER
:

2367 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>equlationequestion by user: "));

2370 
NL80211_REGDOM_SET_BY_DRIVER
:

2376 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>equlationequestion by driver: "));

2379 
NL80211_REGDOM_SET_BY_COUNTRY_IE
:

2385 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>equlationequestion by country IE: "));

2389 
	`CFG80211DBG
(
RT_DEBUG_ERROR
,

2390 ("%c%c\n", 
pReque
->
pha2
[0],Request->alpha2[1]));

2393 i(
pReque
->
t
 =
NL80211_REGDOM_SET_BY_USER
)

2396 
pAd
->
Cfg80211_Aha2
[0] = 
pReque
->
pha2
[0];

2397 
pAd
->
Cfg80211_Aha2
[1] = 
pReque
->
pha2
[1];

2400 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_START_UP
))

2403 
	`CFG80211_RegRuAly
(
pAd
, 
pWhy
, (
UCHAR
 *)
pReque
->
pha2
);

2407 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda> interface is down!\n"));

2412 
	}
}

2415 
INT32
 
	$CFG80211_RegNifr
(

2416 
IN
 
why
 *
pWhy
,

2417 
IN
 
g_t_by
 
Reque
)

2419 
devi
 *
pDev
 = 
pWhy
->
dev
.

;

2420 
t_devi
 *
pNDev
 = 
	`dev_g_drvda
(
pDev
);

2421 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
	`RTMP_OS_NETDEV_GET_PRIV
(
pNDev
);

2422 
UINT32
 
ReqTy
 = 
Reque
;

2426 i(
pAd
 =
NULL
)

2428 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("crda>egotify butAd = NULL!"));

2467 
ReqTy
)

2469 
REGDOM_SET_BY_CORE
:

2473 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>equlationequestion by core: "));

2476 
REGDOM_SET_BY_USER
:

2481 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>equlationequestion by user: "));

2484 
REGDOM_SET_BY_DRIVER
:

2490 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>equlationequestion by driver: "));

2493 
REGDOM_SET_BY_COUNTRY_IE
:

2499 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda>equlationequestion by country IE: "));

2503 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("00\n"));

2506 i(
ReqTy
 =
REGDOM_SET_BY_USER
)

2509 
pAd
->
Cfg80211_Aha2
[0] = '0';

2510 
pAd
->
Cfg80211_Aha2
[1] = '0';

2513 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_START_UP
))

2516 
	`CFG80211_RegRuAly
(
pAd
, 
pWhy
,Ad->
Cfg80211_Aha2
);

2520 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("crda> interface is down!\n"));

2525 
	}
}

2559 
BOOLEAN
 
	$CFG80211_SupBdIn
(

2560 
IN
 
PRTMP_ADAPTER
 
pAd
,

2561 
IN
 
why
 *
pWhy
,

2562 
IN
 
80211_chl
 *
pChls
,

2563 
IN
 
80211_
 *
pRes
)

2565 
80211_su܋d_bd
 *
pBd
;

2566 
UINT32
 
NumOfCh
, 
NumOfRe
;

2567 
UINT32
 
IdLo
;

2568 
UINT32
 
CurTxPow
;

2572 i(
pAd
->
RFICTy
 == 0)

2573 
pAd
->
RFICTy
 = 
RFIC_24GHZ
 | 
RFIC_5GHZ
;

2576 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> RFICTy = %d\n", 
pAd
->
RFICTy
));

2579 i(
pAd
->
RFICTy
 & 
RFIC_5GHZ
)

2580 
NumOfCh
 = 
CFG80211_NUM_OF_CHAN_2GHZ
 + 
CFG80211_NUM_OF_CHAN_5GHZ
;

2582 
NumOfCh
 = 
CFG80211_NUM_OF_CHAN_2GHZ
;

2585 i(
pAd
->
CommCfg
.
PhyMode
 =
PHY_11B
)

2586 
NumOfRe
 = 4;

2588 
NumOfRe
 = 4 + 8;

2591 i(
pChls
 =
NULL
)

2593 
pChls
 = 
	`kzloc
((*pChls* 
NumOfCh
, 
GFP_KERNEL
);

2594 i(!
pChls
)

2596 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("80211> ieee80211_channelllocation fail!\n"));

2597  
FALSE
;

2601 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> Number of channel = %d\n",

2602 
CFG80211_NUM_OF_CHAN_5GHZ
));

2604 i(
pRes
 =
NULL
)

2606 
pRes
 = 
	`kzloc
((*pRes* 
NumOfRe
, 
GFP_KERNEL
);

2607 i(!
pRes
)

2609 
	`os__mem
(
NULL
, 
pChls
);

2610 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("80211> ieee80211_ratellocation fail!\n"));

2611  
FALSE
;

2615 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> Numb o࿋ = %d\n", 
NumOfRe
));

2618 #ifde
SINGLE_SKU


2619 
CurTxPow
 = 
pAd
->
CommCfg
.
DefeMaxTxPwr
;

2621 
CurTxPow
 = 0;

2624 
	`CFG80211DBG
(
RT_DEBUG_ERROR
, ("80211> CurTxPow = %d dBm\n", 
CurTxPow
));

2627 
IdLo
=0; IdLo<
NumOfCh
; IdLoop++)

2629 
pChls
[
IdLo
].
_eq
 = \

2630 
	`80211_chl_to_equcy
(
Cfg80211_Ch
[
IdLo
]);

2631 
pChls
[
IdLo
].
hw_vue
 = IdLoop;

2633 i(
IdLo
 < 
CFG80211_NUM_OF_CHAN_2GHZ
)

2634 
pChls
[
IdLo
].
max_pow
 = 
CurTxPow
;

2636 
pChls
[
IdLo
].
max_pow
 = 
CurTxPow
;

2639 
pChls
[
IdLo
].
max_a_ga
 = 0xff;

2643 
IdLo
=0; IdLo<
NumOfRe
; IdLoop++)

2644 
	`memy
(&
pRes
[
IdLo
], &
Cfg80211_SupRe
[IdLoop], (*pRates));

2647 
pBd
 = &
CFG80211CB
->
Cfg80211_bds
[
IEEE80211_BAND_2GHZ
];

2648 i(
pAd
->
RFICTy
 & 
RFIC_24GHZ
)

2650 
pBd
->
n_chls
 = 
CFG80211_NUM_OF_CHAN_2GHZ
;

2651 
pBd
->
n_bs
 = 
NumOfRe
;

2652 
pBd
->
chls
 = 
pChls
;

2653 
pBd
->
bs
 = 
pRes
;

2655 #ifde
DOT11_N_SUPPORT


2657 
pBd
->
ht_p
.
ht_su܋d
 = 
ue
;

2658 
pBd
->
ht_p
.
p
 = 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 |

2659 
IEEE80211_HT_CAP_SM_PS
 |

2660 
IEEE80211_HT_CAP_SGI_40
 |

2661 
IEEE80211_HT_CAP_DSSSCCK40
;

2662 
pBd
->
ht_p
.
ampdu_
 = 3;

2663 
pBd
->
ht_p
.
ampdu_dsy
 = \

2664 
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
;

2666 
	`memt
(&
pBd
->
ht_p
.
mcs
, 0, (pBand->ht_cap.mcs));

2667 
	`CFG80211DBG
(
RT_DEBUG_ERROR
,

2668 ("80211> TxSm = %d\n", 
pAd
->
CommCfg
.
TxSm
));

2670 
pAd
->
CommCfg
.
TxSm
)

2674 
pBd
->
ht_p
.
mcs
.
rx_mask
[0] = 0xff;

2678 
pBd
->
ht_p
.
mcs
.
rx_mask
[0] = 0xff;

2679 
pBd
->
ht_p
.
mcs
.
rx_mask
[1] = 0xff;

2683 
pBd
->
ht_p
.
mcs
.
rx_mask
[0] = 0xff;

2684 
pBd
->
ht_p
.
mcs
.
rx_mask
[1] = 0xff;

2685 
pBd
->
ht_p
.
mcs
.
rx_mask
[2] = 0xff;

2689 
pBd
->
ht_p
.
mcs
.
tx_ms
 = 
IEEE80211_HT_MCS_TX_DEFINED
;

2692 
pWhy
->
bds
[
IEEE80211_BAND_2GHZ
] = 
pBd
;

2696 
pWhy
->
bds
[
IEEE80211_BAND_2GHZ
] = 
NULL
;

2697 
pBd
->
chls
 = 
NULL
;

2698 
pBd
->
bs
 = 
NULL
;

2701 
pBd
 = &
CFG80211CB
->
Cfg80211_bds
[
IEEE80211_BAND_5GHZ
];

2702 i(
pAd
->
RFICTy
 & 
RFIC_5GHZ
)

2704 
pBd
->
n_chls
 = 
CFG80211_NUM_OF_CHAN_5GHZ
;

2705 
pBd
->
n_bs
 = 
NumOfRe
 - 4;

2706 
pBd
->
chls
 = &
pChls
[
CFG80211_NUM_OF_CHAN_2GHZ
];

2707 
pBd
->
bs
 = &
pRes
[4];

2710 #ifde
DOT11_N_SUPPORT


2712 
pBd
->
ht_p
.
ht_su܋d
 = 
ue
;

2713 
pBd
->
ht_p
.
p
 = 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 |

2714 
IEEE80211_HT_CAP_SM_PS
 |

2715 
IEEE80211_HT_CAP_SGI_40
 |

2716 
IEEE80211_HT_CAP_DSSSCCK40
;

2717 
pBd
->
ht_p
.
ampdu_
 = 3;

2718 
pBd
->
ht_p
.
ampdu_dsy
 = \

2719 
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
;

2721 
	`memt
(&
pBd
->
ht_p
.
mcs
, 0, (pBand->ht_cap.mcs));

2722 
pAd
->
CommCfg
.
RxSm
)

2726 
pBd
->
ht_p
.
mcs
.
rx_mask
[0] = 0xff;

2730 
pBd
->
ht_p
.
mcs
.
rx_mask
[0] = 0xff;

2731 
pBd
->
ht_p
.
mcs
.
rx_mask
[1] = 0xff;

2735 
pBd
->
ht_p
.
mcs
.
rx_mask
[0] = 0xff;

2736 
pBd
->
ht_p
.
mcs
.
rx_mask
[1] = 0xff;

2737 
pBd
->
ht_p
.
mcs
.
rx_mask
[2] = 0xff;

2741 
pBd
->
ht_p
.
mcs
.
tx_ms
 = 
IEEE80211_HT_MCS_TX_DEFINED
;

2744 
pWhy
->
bds
[
IEEE80211_BAND_5GHZ
] = 
pBd
;

2748 
pWhy
->
bds
[
IEEE80211_BAND_5GHZ
] = 
NULL
;

2749 
pBd
->
chls
 = 
NULL
;

2750 
pBd
->
bs
 = 
NULL
;

2753 
CFG80211CB
->
pCfg80211_Chls
 = 
pChls
;

2754 
CFG80211CB
->
pCfg80211_Res
 = 
pRes
;

2756  
TRUE
;

2757 
	}
}

	@os/linux/pci_main_dev.c

38 
	~"_cfig.h
"

39 
	~<lux/pci.h
>

44 
28xx_o
(
IN
 
t_devi
 *
t_dev
);

45 
28xx_ݒ
(
t_devi
 *
t_dev
);

47 
VOID
 
__devex
 
2860_move_e
(
pci_dev
 *pci_dev);

48 
INT
 
__dev
 
2860_obe
(
pci_dev
 *pci_dev, cڡ 
pci_devi_id
 *
t
);

49 
__ex
 
2860_nup_modu
();

50 
__
 
2860__modu
();

52 
VOID
 
RTMPInPCIeDevi
(

53 
IN
 
pci_dev
 *pci_dev,

54 
IN
 
PRTMP_ADAPTER
 
pAd
);

56 #ifde
CONFIG_PM


57 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,5,0)

58 #i
LINUX_VERSION_CODE
 <
KERNEL_VERSION
(2,6,10)

59 
	#pm_mesge_t
 
u32


	)

62 
2860_sud
(
pci_dev
 *pci_dev, 
pm_mesge_t
 
e
);

63 
2860_sume
(
pci_dev
 *pci_dev);

70 
pci_devi_id
 
	g2860_pci_tbl
[] 
	g__devda
 =

72 #ifde
RT2860


73 {
PCI_DEVICE
(
NIC_PCI_VENDOR_ID
, 
NIC2860_PCI_DEVICE_ID
)},

74 {
PCI_DEVICE
(
NIC_PCI_VENDOR_ID
, 
NIC2860_PCIe_DEVICE_ID
)},

75 {
PCI_DEVICE
(
NIC_PCI_VENDOR_ID
, 
NIC2760_PCI_DEVICE_ID
)},

76 {
PCI_DEVICE
(
NIC_PCI_VENDOR_ID
, 
NIC2790_PCIe_DEVICE_ID
)},

77 {
PCI_DEVICE
(
VEN_AWT_PCI_VENDOR_ID
, 
VEN_AWT_PCIe_DEVICE_ID
)},

78 {
PCI_DEVICE
(
EDIMAX_PCI_VENDOR_ID
, 0x7708)},

79 {
PCI_DEVICE
(
EDIMAX_PCI_VENDOR_ID
, 0x7728)},

80 {
PCI_DEVICE
(
EDIMAX_PCI_VENDOR_ID
, 0x7758)},

81 {
PCI_DEVICE
(
EDIMAX_PCI_VENDOR_ID
, 0x7727)},

82 {
PCI_DEVICE
(
EDIMAX_PCI_VENDOR_ID
, 0x7738)},

83 {
PCI_DEVICE
(
EDIMAX_PCI_VENDOR_ID
, 0x7748)},

84 {
PCI_DEVICE
(
EDIMAX_PCI_VENDOR_ID
, 0x7768)},

89 
MODULE_DEVICE_TABLE
(
pci
, 
2860_pci_tbl
);

90 #ifde
CONFIG_STA_SUPPORT


91 #ifde
MODULE_VERSION


92 
MODULE_VERSION
(
STA_DRIVER_VERSION
);

95 
MODULE_LICENSE
("GPL");

100 
pci_driv
 
	g2860_driv
 =

102 
me
: "rt2860",

103 
id_b
: 
2860_pci_tbl
,

104 
obe
: 
2860_obe
,

105 #i
LINUX_VERSION_CODE
 >= 0x20412

106 
move
: 
__devex_p
(
2860_move_e
),

108 
move
: 
__devex
(
2860_move_e
),

111 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,5,0)

112 #ifde
CONFIG_PM


113 
sud
: 
2860_sud
,

114 
sume
: 
2860_sume
,

125 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,5,0)

126 #ifde
CONFIG_PM


128 
VOID
 
	$RT2860RejePdgPacks
(

129 
IN
 
PRTMP_ADAPTER
 
pAd
)

133 
	}
}

135 
	$2860_sud
(

136 
pci_dev
 *pci_dev,

137 
pm_mesge_t
 
e
)

139 
t_devi
 *
t_dev
 = 
	`pci_g_drvda
(
pci_dev
);

140 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
NULL
;

141 
INT32
 
tv
 = 0;

144 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>t2860_suspend()\n"));

146 i(
t_dev
 =
NULL
)

148 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("net_dev == NULL!\n"));

152 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

157 i(
	`VIRTUAL_IF_NUM
(
pAd
) > 0)

162 
	`tif_r_off
(
t_dev
);

163 
	`tif__queue
(
t_dev
);

166 
	`tif_devi_dach
(
t_dev
);

169 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
);

170 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
);

173 
	`28xx_o
((
PNET_DEV
)
t_dev
);

175 
	`RT_MOD_DEC_USE_COUNT
();

179 #i
LINUX_VERSION_CODE
 > 
	`KERNEL_VERSION
(2,6,10)

183 
tv
 = 
	`pci_ab_wake
(
pci_dev
, 
	`pci_choo_e
ci_dev, 
e
), 1);

185 
	`pci_ve_e
(
pci_dev
);

187 
	`pci_dib_devi
(
pci_dev
);

189 
tv
 = 
	`pci_t_pow_e
(
pci_dev
, 
	`pci_choo_e
ci_dev, 
e
));

192 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<===t2860_suspend()\n"));

193  
tv
;

194 
	}
}

196 
	$2860_sume
(

197 
pci_dev
 *pci_dev)

199 
t_devi
 *
t_dev
 = 
	`pci_g_drvda
(
pci_dev
);

200 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
NULL
;

202 #i
LINUX_VERSION_CODE
 > 
	`KERNEL_VERSION
(2,6,10)

203 
INT32
 
tv
;

216 
tv
 = 
	`pci_t_pow_e
(
pci_dev
, 
PCI_D0
);

219 
	`pci_e_e
(
pci_dev
);

222 i(
	`pci_ab_devi
(
pci_dev
))

224 
	`tk
("pcinable fail!\n");

229 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>t2860_resume()\n"));

231 i(
t_dev
 =
NULL
)

233 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("net_dev == NULL!\n"));

236 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

238 i(
pAd
 !
NULL
)

243 i(
	`VIRTUAL_IF_NUM
(
pAd
) > 0)

246 
	`tif_devi_ch
(
t_dev
);

248 i(
	`28xx_ݒ
((
PNET_DEV
)
t_dev
) != 0)

251 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<===t2860_resume()\n"));

256 
	`RT_MOD_INC_USE_COUNT
();

258 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
);

259 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
);

261 
	`tif_t_queue
(
t_dev
);

262 
	`tif_r_
(
t_dev
);

263 
	`tif_wake_queue
(
t_dev
);

267 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<===t2860_resume()\n"));

269 
	}
}

274 
INT
 
__
 
	$2860__modu
(
VOID
)

276 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

277  
	`pci_gi_driv
(&
2860_driv
);

279  
	`pci_modu_
(&
2860_driv
);

281 
	}
}

287 
VOID
 
__ex
 
	$2860_nup_modu
(
VOID
)

289 
	`pci_uegi_driv
(&
2860_driv
);

290 
	}
}

292 
modu_
(
2860__modu
);

293 
modu_ex
(
2860_nup_modu
);

299 
INT
 
__dev
 
	$2860_obe
(

300 
IN
 
pci_dev
 *pci_dev,

301 
IN
 cڡ 
pci_devi_id
 *
pci_id
)

303 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
NULL
;

304 
t_devi
 *
t_dev
;

305 
PVOID
 
hd
;

306 
PSTRING
 
t_me
;

307 
ULONG
 
c_addr
;

308 
INT
 
rv
 = 0;

309 
RTMP_OS_NETDEV_OP_HOOK
 
tDevHook
;

311 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>t2860_probe\n"));

315 i((
rv
 = 
	`pci_ab_devi
(
pci_dev
))!= 0)

317 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Eb PCI devi faed,no=%d!\n", 
rv
));

318  
rv
;

321 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

322 
t_me
 = 
pci_dev
 ? 
	`pci_me
(pci_dev) : "rt2860";

324 
t_me
 = 
pci_dev
 ?ci_dev->
_me
 : "rt2860";

327 i((
rv
 = 
	`pci_que_gis
(
pci_dev
, 
t_me
)) != 0)

329 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Reque PCIesour faed,no=%d!\n", 
rv
));

330 
r_out
;

334 
c_addr
 = (
	`iem
(
	`pci_sour_t
(
pci_dev
, 0), 
	`pci_sour_n
(pci_dev, 0));

335 i(!
c_addr
)

337 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("ioremap failed for device %s,egion 0x%lX @ 0x%lX\n",

338 
t_me
, (
ULONG
)
	`pci_sour_n
(
pci_dev
, 0), (ULONG)
	`pci_sour_t
(pci_dev, 0)));

339 
r_out__s
;

343 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s:0x%lx, VA 0x%lx, IRQ %d. \n", 
t_me
,

344 (
ULONG
)
	`pci_sour_t
(
pci_dev
, 0), (ULONG)
c_addr
,ci_dev->
q
));

348 
	`pci_t_ma
(
pci_dev
);

353 
hd
 = 
	`kmloc
((
os_cook
), 
GFP_KERNEL
);

354 i(
hd
 =
NULL
)

356 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s(): Ao memy f ohd faed!\n", 
__FUNCTION__
));

357 
r_out_iounm
;

360 
	`memt
(
hd
, 0, (
os_cook
));

362 ((
POS_COOKIE
)
hd
)->
pci_dev
 =ci_dev;

364 
rv
 = 
	`RTMPAocAdrBlock
(
hd
, &
pAd
);

365 i(
rv
 !
NDIS_STATUS_SUCCESS
)

366 
r_out_iounm
;

368 
pAd
->
CSRBaAddss
 = (
PUCHAR
)
c_addr
;

369 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("pAd->CSRBaAdds=0x%lx, c_addr=0x%lx!\n", (
ULONG
)
pAd
->
CSRBaAddss
, 
c_addr
));

371 
	`RTMPInPCIeDevi
(
pci_dev
, 
pAd
);

374 
t_dev
 = 
	`RtmpPhyNDevIn
(
pAd
, &
tDevHook
);

375 i(
t_dev
 =
NULL
)

376 
r_out__dev
;

379 
t_dev
->
q
 = 
pci_dev
->irq;

380 
t_dev
->
ba_addr
 = 
c_addr
;

381 
	`pci_t_drvda
(
pci_dev
, 
t_dev
);

383 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


388 #i(
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,0))

389 
	`SET_NETDEV_DEV
(
t_dev
, &(
pci_dev
->
dev
));

395 #ifde
RT_CFG80211_SUPPORT


396 
pAd
->
pCfgDev
 = &(
pci_dev
->
dev
);

397 
pAd
->
CFG80211_Regi
 = CFG80211_Register;

400 
rv
 = 
	`RtmpOSNDevAach
(
t_dev
, &
tDevHook
);

401 i(
rv
)

402 
r_out__tdev
;

404 #ifde
CONFIG_STA_SUPPORT


405 
pAd
->
SCfg
.
OriDevTy
 = 
t_dev
->
ty
;

408 #ifde
KTHREAD_SUPPORT


409 
	`_waqueue_hd
(&
pAd
->
cmdQTask
.
kthad_q
);

412 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<===t2860_probe\n"));

418 
r_out__tdev
:

419 
	`RtmpOSNDevFe
(
t_dev
);

421 
r_out__dev
:

423 
	`RTMPFeAdr
(
pAd
);

425 
r_out_iounm
:

426 
	`iounm
((*)(
c_addr
));

427 
	`a_mem_gi
(
	`pci_sour_t
(
pci_dev
, 0), 
	`pci_sour_n
(pci_dev, 0));

429 
r_out__s
:

430 
	`pci_a_gis
(
pci_dev
);

432 
r_out
:

433 
	`pci_dib_devi
(
pci_dev
);

435 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("<==2860_obed whv = %d!\n", 
rv
));

437  -
ENODEV
;

438 
	}
}

441 
VOID
 
__devex
 
	$2860_move_e
(

442 
IN
 
pci_dev
 *pci_dev)

444 
PNET_DEV
 
t_dev
 = 
	`pci_g_drvda
(
pci_dev
);

445 
RTMP_ADAPTER
 *
pAd
 = 
NULL
;

446 
ULONG
 
c_addr
 = 
t_dev
->
ba_addr
;

448 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

450 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>t2860_remove_one\n"));

452 i(
pAd
 !
NULL
)

455 
	`RtmpPhyNDevEx
(
pAd
, 
t_dev
);

458 
	`iounm
((*)(
c_addr
));

461 
	`a_mem_gi
(
	`pci_sour_t
(
pci_dev
, 0), 
	`pci_sour_n
(pci_dev, 0));

463 #ifde
RT_CFG80211_SUPPORT


464 
	`CFG80211_UnRegi
(
pAd
, 
t_dev
);

468 
	`RtmpRaDevClEx
(
pAd
);

474 
	`RtmpOSNDevDach
(
t_dev
);

477 
	`iounm
((*)(
t_dev
->
ba_addr
));

480 
	`a_mem_gi
(
	`pci_sour_t
(
pci_dev
, 0), 
	`pci_sour_n
(pci_dev, 0));

484 
	`RtmpOSNDevFe
(
t_dev
);

486 #ifde
VENDOR_FEATURE4_SUPPORT


488 
ULONG
 
OS_NumOfMemAoc
, 
OS_NumOfMemFe
;

489 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("OS_NumOfMemAlloc = %ld, OS_NumOfMemFree = %ld\n",

490 
OS_NumOfMemAoc
, 
OS_NumOfMemFe
));

493 
	}
}

502 
VOID
 
	$RTMPInPCIeDevi
(

503 
IN
 
pci_dev
 *pci_dev,

504 
IN
 
PRTMP_ADAPTER
 
pAd
)

506 
USHORT
 
devi_id
;

507 
POS_COOKIE
 
pObj
;

509 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

510 
	`pci_ad_cfig_wd
(
pci_dev
, 
PCI_DEVICE_ID
, &
devi_id
);

511 
devi_id
 = 
	`2u16
(device_id);

512 
pObj
->
DeviID
 = 
devi_id
;

513 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
);

515 #ifde
RT2860


516 (
devi_id
 =
NIC2860_PCIe_DEVICE_ID
) ||

517 (
devi_id
 =
NIC2790_PCIe_DEVICE_ID
) ||

518 (
devi_id
 =
VEN_AWT_PCIe_DEVICE_ID
) ||

523 
UINT32
 
MacC0
 = 0, 
Index
= 0;

526 
	`RTMP_IO_READ32
(
pAd
, 
MAC_CSR0
, &
MacC0
);

528 i((
MacC0
 != 0x00) && (MacCsr0 != 0xFFFFFFFF))

531 
	`RTMPucDay
(10);

532 } 
Index
++ < 100);

536 i((
MacC0
&0xffff0000) != 0x28600000)

538 #ifde
PCIE_PS_SUPPORT


539 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
);

541 
	`RtmpRaDevClIn
(
pAd
, 
RTMP_DEV_INF_PCIE
);

547 
	`RtmpRaDevClIn
(
pAd
, 
RTMP_DEV_INF_PCI
);

549 
	}
}

551 #ifde
CONFIG_STA_SUPPORT


552 #ifde
PCIE_PS_SUPPORT


553 
VOID
 
	$RTMPInPCIeLkClVue
(

554 
IN
 
PRTMP_ADAPTER
 
pAd
)

556 
INT
 
pos
;

557 
USHORT
 
g16
, 
da2
, 
PCIePowSaveLev
, 
Cfiguti
;

558 
UINT32
 
MacVue
;

559 
BOOLEAN
 
bFdI
 = 
FALSE
;

560 
POS_COOKIE
 
pObj
;

562 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

564 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

566 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Not PCIe device.\n"));

570 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s.===>\n", 
__FUNCTION__
));

572 i(!(
	`IS_RT3090
(
pAd
|| 
	`IS_RT3572
Ad|| 
	`IS_RT3390
Ad|| 
	`IS_RT3593
(pAd)))

574 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x22, 
PCIePowSaveLev
);

575 
pAd
->
PCIePowSaveLev
 = PCIePowerSaveLevel & 0xff;

576 
pAd
->
LnkClBMask
 = 0;

577 i((
PCIePowSaveLev
&0xff) == 0xff)

579 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
);

580 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====> PCIePowSaveLev = 0x%x.\n", 
PCIePowSaveLev
));

585 
PCIePowSaveLev
 &= 0x3;

586 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x24, 
da2
);

588 if!(((
da2
&0xff00) == 0x9200) && ((data2&0x80) !=0)) )

590 i(
PCIePowSaveLev
 > 1 )

591 
PCIePowSaveLev
 = 1;

594 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====> Wr0x83 = 0x%x.\n", 
PCIePowSaveLev
));

595 
	`AsicSdCommdToMcu
(
pAd
, 0x83, 0xff, (
UCHAR
)
PCIePowSaveLev
, 0x00);

596 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x22, 
PCIePowSaveLev
);

597 
PCIePowSaveLev
 &= 0xff;

598 
PCIePowSaveLev
 = PCIePowerSaveLevel >> 6;

599 
PCIePowSaveLev
)

602 
pAd
->
LnkClBMask
 = 0;

605 
pAd
->
LnkClBMask
 = 1;

608 
pAd
->
LnkClBMask
 = 3;

611 
pAd
->
LnkClBMask
 = 0x103;

614 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x24, 
da2
);

615 i((
PCIePowSaveLev
&0xff) != 0xff)

617 
PCIePowSaveLev
 &= 0x3;

619 if!(((
da2
&0xff00) == 0x9200) && ((data2&0x80) !=0)) )

621 i(
PCIePowSaveLev
 > 1 )

622 
PCIePowSaveLev
 = 1;

625 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====>t28xx Wr0x83 Commd = 0x%x.\n", 
PCIePowSaveLev
));

626 
	`tk
("\n\n\n%s:%d\n",
__FUNCTION__
,
__LINE__
);

628 
	`AsicSdCommdToMcu
(
pAd
, 0x83, 0xff, (
UCHAR
)
PCIePowSaveLev
, 0x00);

630 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====> LnkClBMask = 0x%x.\n", 
pAd
->
LnkClBMask
));

633 i(
	`IS_RT3090
(
pAd
|| 
	`IS_RT3572
Ad|| 
	`IS_RT3390
Ad|| 
	`IS_RT3593
(pAd))

635 
UCHAR
 
LkClStg
 = 0;

638 
	`RT28xx_EEPROM_READ16
(
pAd
, 0x24, 
da2
);

639 i((
da2
 =0x9280&& ((
pAd
->
MACVsi
&0xffff) == 0x0211))

641 
pAd
->
b3090ESclCh
 = 
TRUE
;

642 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,("Special 3090E chip \n"));

645 
	`RTMP_IO_READ32
(
pAd
, 
AUX_CTRL
, &
MacVue
);

648 
MacVue
 |= 0x402;

649 
	`RTMP_IO_WRITE32
(
pAd
, 
AUX_CTRL
, 
MacVue
);

650 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,(" AUX_CTRL = 0x%32x\n", 
MacVue
));

655 i((
	`IS_VERSION_AFTER_F
(
pAd
))

656 && (
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxPowMode
 >= 2)

657 && (
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxPowMode
 <= 3))

659 
	`RTMP_IO_READ32
(
pAd
, 
AUX_CTRL
, &
MacVue
);

660 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,(" Rd AUX_CTRL = 0x%x\n", 
MacVue
));

663 
MacVue
 |= 0x1000;

664 i(
MacVue
 != 0xffffffff)

666 
	`RTMP_IO_WRITE32
(
pAd
, 
AUX_CTRL
, 
MacVue
);

667 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,(" WrAUX_CTRL = 0x%x\n", 
MacVue
));

669 
MacVue
 = 0x3ff11;

670 
	`RTMP_IO_WRITE32
(
pAd
, 
OSC_CTRL
, 
MacVue
);

671 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,(" OSC_CTRL = 0x%x\n", 
MacVue
));

673 
	`RTMP3xSPCIePowLkCl
(
pAd
);

678 
	`DBGPRINT
(
RT_DEBUG_ERROR
,(" E Vu AUX_CTRL = 0x%x\n", 
MacVue
));

679 
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxPowMode
 = 1;

680 
	`DBGPRINT
(
RT_DEBUG_ERROR
,(" Forceo useower solution1 \n"));

685 
PCIePowSaveLev
 = (
USHORT
)
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxPowMode
;

686 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("====>t30xx Rd PowLevMod 0x%x.\n", 
PCIePowSaveLev
));

688 i(
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
FALSE
)

689 
PCIePowSaveLev
 = 1;

691 i(
	`IS_VERSION_BEFORE_F
(
pAd
&& (pAd->
b3090ESclCh
 =
FALSE
))

694 
PCIePowSaveLev
 &= 0x1;

695 
pAd
->
PCIePowSaveLev
 = (
USHORT
)PCIePowerSaveLevel;

696 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====>t30xx E Wr0x83 Commd = 0x%x.\n", 
PCIePowSaveLev
));

698 
	`AsicSdCommdToMcu
(
pAd
, 0x83, 0xff, (
UCHAR
)
PCIePowSaveLev
, 0x00);

703 i(!((
PCIePowSaveLev
 == 1) || (PCIePowerSaveLevel == 3)))

704 
PCIePowSaveLev
 = 1;

705 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("====>t30xx F Wr0x83 Commd = 0x%x.\n", 
PCIePowSaveLev
));

706 
pAd
->
PCIePowSaveLev
 = (
USHORT
)PCIePowerSaveLevel;

709 i((
pAd
->
Rt3xxRkLkCl
 & 0x2&& (pAd->
Rt3xxHoLkCl
 & 0x2))

711 
LkClStg
 = 1;

713 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====>t30xxF LkClStg = 0x%x.\n", 
LkClStg
));

714 
	`AsicSdCommdToMcu
(
pAd
, 0x83, 0xff, (
UCHAR
)
PCIePowSaveLev
, 
LkClStg
);

720 
pos
 = 
	`pci_fd_by
(
pObj
->
pci_dev
, 
PCI_CAP_ID_EXP
);

722 i(
pos
 != 0)

725 
pAd
->
RLnkClOfft
 = 
pos
 + 
PCI_EXP_LNKCTL
;

726 
	`pci_ad_cfig_wd
(
pObj
->
pci_dev
, 
pAd
->
RLnkClOfft
, &
g16
);

727 
Cfiguti
 = 
	`2u16
(
g16
);

728 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Read (Ralink PCIe Link Control Register) offset 0x%x = 0x%x\n",

729 
pAd
->
RLnkClOfft
, 
Cfiguti
));

730 
pAd
->
RLnkClCfiguti
 = (
Cfiguti
 & 0x103);

731 
Cfiguti
 &= 0xfefc;

732 
Cfiguti
 |= (0x0);

733 #ifde
RT2860


734 i((
pObj
->
DeviID
 =
NIC2860_PCIe_DEVICE_ID
)

735 ||(
pObj
->
DeviID
 =
NIC2790_PCIe_DEVICE_ID
))

737 
g16
 = 
	`u216
(
Cfiguti
);

738 
	`pci_wre_cfig_wd
(
pObj
->
pci_dev
, 
pAd
->
RLnkClOfft
, 
g16
);

739 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Write (Ralink PCIe Link Control Register) offset 0x%x = 0x%x\n",

740 
pos
 + 
PCI_EXP_LNKCTL
, 
Cfiguti
));

744 
	`RTMPFdHoPCIDev
(
pAd
);

745 i(
pObj
->
_pci_dev
)

747 
USHORT
 
vd_id
;

749 
	`pci_ad_cfig_wd
(
pObj
->
_pci_dev
, 
PCI_VENDOR_ID
, &
vd_id
);

750 
vd_id
 = 
	`2u16
(vendor_id);

751 i(
vd_id
 =
PCIBUS_INTEL_VENDOR
)

753 
bFdI
 = 
TRUE
;

754 
	`RTMP_SET_PSFLAG
(
pAd
, 
fRTMP_PS_TOGGLE_L1
);

768 
pos
 = 
	`pci_fd_by
(
pObj
->
_pci_dev
, 
PCI_CAP_ID_EXP
);

770 i(
pos
 != 0)

772 
BOOLEAN
 
bChge
 = 
FALSE
;

774 
pAd
->
HoLnkClOfft
 = 
pos
 + 
PCI_EXP_LNKCTL
;

775 
	`pci_ad_cfig_wd
(
pObj
->
_pci_dev
, 
pAd
->
HoLnkClOfft
, &
g16
);

776 
Cfiguti
 = 
	`2u16
(
g16
);

777 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Read (Host PCI-to-PCI Bridge Link Control Register) offset 0x%x = 0x%x\n",

778 
pAd
->
HoLnkClOfft
, 
Cfiguti
));

779 
pAd
->
HoLnkClCfiguti
 = (
Cfiguti
 & 0x103);

780 
Cfiguti
 &= 0xfefc;

781 
Cfiguti
 |= (0x0);

783 
pObj
->
DeviID
)

785 #ifde
RT2860


786 
NIC2860_PCIe_DEVICE_ID
:

787 
NIC2790_PCIe_DEVICE_ID
:

788 
bChge
 = 
TRUE
;

795 i(
bChge
)

797 
g16
 = 
	`u216
(
Cfiguti
);

798 
	`pci_wre_cfig_wd
(
pObj
->
_pci_dev
, 
pAd
->
HoLnkClOfft
, 
g16
);

799 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Write (Host PCI-to-PCI Bridge Link Control Register) offset 0x%x = 0x%x\n",

800 
pAd
->
HoLnkClOfft
, 
Cfiguti
));

805 
pAd
->
HoLnkClOfft
 = 0;

806 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: cn fd PCI-to-PCI BridgPCI ExesCaby!\n", 
__FUNCTION__
));

812 
pAd
->
RLnkClOfft
 = 0;

813 
pAd
->
HoLnkClOfft
 = 0;

814 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: cn fd Rk PCIDevi'PCI ExesCaby!\n", 
__FUNCTION__
));

817 i(
bFdI
 =
FALSE
)

819 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Doesn't find Intel PCI host controller. \n"));

821 
pAd
->
PCIePowSaveLev
 = 0xff;

823 i((
pAd
->
RLnkClOfft
 != 0)

826 
	`pci_ad_cfig_wd
(
pObj
->
pci_dev
, 
pAd
->
RLnkClOfft
, &
g16
);

827 
Cfiguti
 = 
	`2u16
(
g16
);

828 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Read (Ralink 30xx PCIe Link Control Register) offset 0x%x = 0x%x\n",

829 
pAd
->
RLnkClOfft
, 
Cfiguti
));

830 
pAd
->
RLnkClCfiguti
 = (
Cfiguti
 & 0x103);

831 
Cfiguti
 &= 0xfefc;

832 
Cfiguti
 |= (0x0);

833 
g16
 = 
	`u216
(
Cfiguti
);

834 
	`pci_wre_cfig_wd
(
pObj
->
pci_dev
, 
pAd
->
RLnkClOfft
, 
g16
);

835 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Write (Ralink PCIe Link Control Register) offset 0x%x = 0x%x\n",

836 
pos
 + 
PCI_EXP_LNKCTL
, 
Cfiguti
));

839 
	}
}

841 
VOID
 
	$RTMPFdHoPCIDev
(

842 
IN
 
PRTMP_ADAPTER
 
pAd
)

844 
USHORT
 
g16
;

845 
UCHAR
 
g8
;

846 
UINT
 
DevFn
;

847 
PPCI_DEV
 
pPci_dev
;

848 
POS_COOKIE
 
pObj
;

850 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

852 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

855 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s.===>\n", 
__FUNCTION__
));

857 
pObj
->
_pci_dev
 = 
NULL
;

858 i(
pObj
->
pci_dev
->
bus
->

)

860 
DevFn
 = 0; DevFn < 255; DevFn++)

862 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,0)

863 
pPci_dev
 = 
	`pci_g_
(
pObj
->
pci_dev
->
bus
->

, 
DevFn
);

865 
pPci_dev
 = 
	`pci_fd_
(
pObj
->
pci_dev
->
bus
->

->
numb
, 
DevFn
);

867 i(
pPci_dev
)

869 
	`pci_ad_cfig_wd
(
pPci_dev
, 
PCI_CLASS_DEVICE
, &
g16
);

870 
g16
 = 
	`2u16
(reg16);

871 
	`pci_ad_cfig_by
(
pPci_dev
, 
PCI_CB_CARD_BUS
, &
g8
);

872 i((
g16
 =
PCI_CLASS_BRIDGE_PCI
) &&

873 (
g8
 =
pObj
->
pci_dev
->
bus
->
numb
))

875 
pObj
->
_pci_dev
 = 
pPci_dev
;

880 
	}
}

890 
VOID
 
	$RTMP3xSPCIePowLkCl
(

891 
IN
 
PRTMP_ADAPTER
 
pAd
)

894 
ULONG
 
HoCfiguti
;

895 
ULONG
 
Cfiguti
;

896 
ULONG
 
Vd
;

897 
ULONG
 
offt
;

898 
POS_COOKIE
 
pObj
;

899 
INT
 
pos
;

900 
USHORT
 
g16
;

902 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

904 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("RTMP3xSPCIePowLkCl.===> %x\n", 
pAd
->
SCfg
.
PSCڌ
.
wd
));

907 i(
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
FALSE
)

909 
	`RTMPFdHoPCIDev
(
pAd
);

910 i(
pObj
->
_pci_dev
)

912 
USHORT
 
vd_id
;

914 
pos
 = 
	`pci_fd_by
(
pObj
->
_pci_dev
, 
PCI_CAP_ID_EXP
);

916 i(
pos
 != 0)

918 
pAd
->
HoLnkClOfft
 = 
pos
 + 
PCI_EXP_LNKCTL
;

921 
HoCfiguti
 = 0;

922 i(
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxFASPMTe
 == 1)

924 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Enter,PSM : Force ASPM \n"));

927 i((
pAd
->
HoLnkClOfft
 != 0))

929 
	`PCI_REG_READ_WORD
(
pObj
->
_pci_dev
, 
pAd
->
HoLnkClOfft
, 
HoCfiguti
);

931 
HoCfiguti
 |= 0x3;

932 
	`PCI_REG_WIRTE_WORD
(
pObj
->
_pci_dev
, 
pAd
->
HoLnkClOfft
, 
HoCfiguti
);

933 
pAd
->
Rt3xxHoLkCl
 = 
HoCfiguti
;

936 
HoCfiguti
 = 0x3;

937 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PSM : F ASPM : Ho devi L1/L0Vu 0x%x\n", 
HoCfiguti
));

940 i(
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxFlowHoASPM
 == 1)

944 i((
pAd
->
HoLnkClOfft
 != 0))

946 
	`PCI_REG_READ_WORD
(
pObj
->
_pci_dev
, 
pAd
->
HoLnkClOfft
, 
HoCfiguti
);

947 
pAd
->
Rt3xxHoLkCl
 = 
HoCfiguti
;

948 
HoCfiguti
 &= 0x3;

949 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PSM : Flow Ho ASPM : Ho devi L1/L0Vu 0x%x\n", 
HoCfiguti
));

955 
pos
 = 
	`pci_fd_by
(
pObj
->
pci_dev
, 
PCI_CAP_ID_EXP
);

957 i(
pos
 != 0)

960 
pAd
->
RLnkClOfft
 = 
pos
 + 
PCI_EXP_LNKCTL
;

961 
	`pci_ad_cfig_wd
(
pObj
->
pci_dev
, 
pAd
->
RLnkClOfft
, &
g16
);

962 
Cfiguti
 = 
	`2u16
(
g16
);

963 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Read (Ralink PCIe Link Control Register) offset 0x%x = 0x%x\n",

964 
pAd
->
RLnkClOfft
, 
Cfiguti
));

965 
Cfiguti
 |= 0x100;

966 i((
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxFlowHoASPM
 == 1)

967 || (
pAd
->
SCfg
.
PSCڌ
.
fld
.
30xxFASPMTe
 == 1))

969 
HoCfiguti
)

972 
Cfiguti
 &= 0xffffffc;

975 
Cfiguti
 &= 0xffffffc;

976 
Cfiguti
 |= 0x1;

979 
Cfiguti
 &= 0xffffffc;

980 
Cfiguti
 |= 0x2;

983 
Cfiguti
 |= 0x3;

987 
g16
 = 
	`u216
(
Cfiguti
);

988 
	`pci_wre_cfig_wd
(
pObj
->
pci_dev
, 
pAd
->
RLnkClOfft
, 
g16
);

989 
pAd
->
Rt3xxRkLkCl
 = 
Cfiguti
;

990 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PSM :WrRk devi L1/L0Vu 0x%x\n", 
Cfiguti
));

992 
	`DBGPRINT
(
RT_DEBUG_INFO
,("PSM :RTMPrt3xSetPCIePowerLinkCtrl <==============\n"));

994 
	}
}

	@os/linux/rt_linux.c

28 
	~"_cfig.h
"

30 
ULONG
 
	gRTDebugLev
 = 
RT_DEBUG_ERROR
;

33 #ifde
VENDOR_FEATURE4_SUPPORT


34 
ULONG
 
	gOS_NumOfMemAoc
 = 0, 
	gOS_NumOfMemFe
 = 0;

38 #ifde
SYSTEM_LOG_SUPPORT


40 cڡ *
	gpWessSysEvtText
[
IW_SYS_EVENT_TYPE_NUM
] = {

71 #ifde
IDS_SUPPORT


73 cڡ *
	gpWessSpoofEvtText
[
IW_SPOOF_EVENT_TYPE_NUM
] = {

87 cڡ *
	gpWessFloodEvtText
[
IW_FLOOD_EVENT_TYPE_NUM
] = {

101 
VOID
 
	$RTMP_SPiodicTim
(

102 
IN
 
NDIS_MINIPORT_TIMER
 *
pTim
,

103 
IN
 
timeout
)

105 
timeout
 = (imeout*
OS_HZ
) / 1000);

106 
pTim
->
expes
 = 
jiffs
 + 
timeout
;

107 
	`add_tim
(
pTim
);

108 
	}
}

111 
VOID
 
	$RTMP_OS_In_Tim
(

112 
IN
 
PRTMP_ADAPTER
 
pAd
,

113 
IN
 
NDIS_MINIPORT_TIMER
 *
pTim
,

114 
IN
 
TIMER_FUNCTION
 
funi
,

115 
IN
 
PVOID
 
da
)

117 i(!
	`tim_ndg
(
pTim
))

119 
	`_tim
(
pTim
);

120 
pTim
->
da
 = ()data;

121 
pTim
->
funi
 = function;

123 
	}
}

126 
VOID
 
	$RTMP_OS_Add_Tim
(

127 
IN
 
NDIS_MINIPORT_TIMER
 *
pTim
,

128 
IN
 
timeout
)

130 i(
	`tim_ndg
(
pTim
))

133 
timeout
 = (imeout*
OS_HZ
) / 1000);

134 
pTim
->
expes
 = 
jiffs
 + 
timeout
;

135 
	`add_tim
(
pTim
);

136 
	}
}

138 
VOID
 
	$RTMP_OS_Mod_Tim
(

139 
IN
 
NDIS_MINIPORT_TIMER
 *
pTim
,

140 
IN
 
timeout
)

142 
timeout
 = (imeout*
OS_HZ
) / 1000);

143 
	`mod_tim
(
pTim
, 
jiffs
 + 
timeout
);

144 
	}
}

146 
VOID
 
	$RTMP_OS_D_Tim
(

147 
IN
 
NDIS_MINIPORT_TIMER
 *
pTim
,

148 
OUT
 
BOOLEAN
 *
pCed
)

150 i(
	`tim_ndg
(
pTim
))

152 *
pCed
 = 
	`d_tim_sync
(
pTim
);

156 *
pCed
 = 
TRUE
;

159 
	}
}

163 
VOID
 
	$RTMPucDay
(

164 
IN
 
ULONG
 
uc
)

166 
ULONG
 
i
;

168 
i
 = 0; i < (
uc
 / 50); i++)

169 
	`uday
(50);

171 i(
uc
 % 50)

172 
	`uday
(
uc
 % 50);

173 
	}
}

175 
	$RTMP_GCutSyemTime
(
LARGE_INTEGER
 *
time
)

177 
time
->
u
.
LowPt
 = 
jiffs
;

178 
	}
}

181 
NDIS_STATUS
 
	$os_loc_mem
(

182 
IN
 
RTMP_ADAPTER
 *
pAd
,

183 
OUT
 
UCHAR
 **
mem
,

184 
IN
 
ULONG
 
size
)

186 *
mem
 = (
PUCHAR

	`kmloc
(
size
, 
GFP_ATOMIC
);

187 i(*
mem
)

189 #ifde
VENDOR_FEATURE4_SUPPORT


190 
OS_NumOfMemAoc
 ++;

193  (
NDIS_STATUS_SUCCESS
);

196  (
NDIS_STATUS_FAILURE
);

197 
	}
}

200 
NDIS_STATUS
 
	$os__mem
(

201 
IN
 
PRTMP_ADAPTER
 
pAd
,

202 
IN
 
PVOID
 
mem
)

204 
	`ASSERT
(
mem
);

205 
	`k
(
mem
);

207 #ifde
VENDOR_FEATURE4_SUPPORT


208 
OS_NumOfMemFe
 ++;

211  (
NDIS_STATUS_SUCCESS
);

212 
	}
}

215 #i
defed
(
RTMP_RBUS_SUPPORT
|| defed (
RTMP_FLASH_SUPPORT
)

217 #ifde
CONFIG_RALINK_FLASH_API


219 
t32_t
 
FshRd
(
ut32_t
 *
d
, ut32_*
c
, ut32_
cou
);

220 
t32_t
 
FshWre
(
ut16_t
 *
sour
, ut16_*
dei
, 
ut32_t
 
numBys
);

221 
	#NVRAM_OFFSET
 0x30000

	)

222 #i
defed
 (
CONFIG_RT2880_FLASH_32M
)

223 
	#RF_OFFSET
 0x1FE0000

	)

225 #ifde
RTMP_FLASH_SUPPORT


226 
	#RF_OFFSET
 0x48000

	)

228 
	#RF_OFFSET
 0x40000

	)

234 #ifde
RA_MTD_RW_BY_NUM


235 #i
defed
 (
CONFIG_RT2880_FLASH_32M
)

236 
	#MTD_NUM_FACTORY
 5

	)

238 
	#MTD_NUM_FACTORY
 2

	)

240 
_mtd_wre
(
num
, 
loff_t
 
to
, 
size_t
 
n
, cڡ 
u_ch
 *
buf
);

241 
_mtd_ad
(
num
, 
loff_t
 
om
, 
size_t
 
n
, 
u_ch
 *
buf
);

243 
_mtd_wre_nm
(*
me
, 
loff_t
 
to
, 
size_t
 
n
, cڡ 
u_ch
 *
buf
);

244 
_mtd_ad_nm
(*
me
, 
loff_t
 
om
, 
size_t
 
n
, 
u_ch
 *
buf
);

249 
	$RtmpFshRd
(
UCHAR
 * 
p
, 
ULONG
 
a
, ULONG 
b
)

251 #ifde
CONFIG_RALINK_FLASH_API


252 
	`FshRd
((
ut32_t
 *)
p
, (ut32_*)
a
, (ut32_t)
b
);

254 #ifde
RA_MTD_RW_BY_NUM


255 
	`_mtd_ad
(
MTD_NUM_FACTORY
, 0, (
size_t
)
b
, 
p
);

257 
	`_mtd_ad_nm
("Fay", 0, (
size_t
)
b
, 
p
);

260 
	}
}

262 
	$RtmpFshWre
(
UCHAR
 * 
p
, 
ULONG
 
a
, ULONG 
b
)

264 #ifde
CONFIG_RALINK_FLASH_API


265 
	`FshWre
((
ut16_t
 *)
p
, (ut16_*)
a
, (
ut32_t
)
b
);

267 #ifde
RA_MTD_RW_BY_NUM


268 
	`_mtd_wre
(
MTD_NUM_FACTORY
, 0, (
size_t
)
b
, 
p
);

270 
	`_mtd_wre_nm
("Fay", 0, (
size_t
)
b
, 
p
);

273 
	}
}

277 
PNDIS_PACKET
 
	$RtmpOSNPktAoc
(

278 
IN
 
RTMP_ADAPTER
 *
pAd
,

279 
IN
 
size
)

281 
sk_buff
 *
skb
;

283 
skb
 = 
	`dev_loc_skb
(
size
+2);

284 i(
skb
 !
NULL
)

286 
	`MEM_DBG_PKT_ALLOC_INC
(
pAd
);

289  ((
PNDIS_PACKET
)
skb
);

290 
	}
}

293 
PNDIS_PACKET
 
	$RTMP_AoFgPackBufr
(

294 
IN
 
PRTMP_ADAPTER
 
pAd
,

295 
IN
 
ULONG
 
Lgth
)

297 
sk_buff
 *
pkt
;

299 
pkt
 = 
	`dev_loc_skb
(
Lgth
);

301 i(
pkt
 =
NULL
)

303 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("n'lo fgx %ld sizck\n",
Lgth
));

306 i(
pkt
)

308 
	`MEM_DBG_PKT_ALLOC_INC
(
pAd
);

309 
	`RTMP_SET_PACKET_SOURCE
(
	`OSPKT_TO_RTPKT
(
pkt
), 
PKTSRC_NDIS
);

312  (
PNDIS_PACKET

pkt
;

313 
	}
}

315 
VOID
 
	$RTMPFeAdr
(

316 
IN
 
PRTMP_ADAPTER
 
pAd
)

318 
POS_COOKIE
 
os_cook
;

319 
dex
;

321 
os_cook
=(
POS_COOKIE
)
pAd
->
OS_Cook
;

323 i(
pAd
->
BcBuf
)

324 
	`k
(
pAd
->
BcBuf
);

327 
	`NdisFeSpLock
(&
pAd
->
MgmtRgLock
);

329 #ifde
RTMP_MAC_PCI


330 
	`NdisFeSpLock
(&
pAd
->
RxRgLock
);

333 
dex
 =0 ; index < 
NUM_OF_TX_RING
; index++)

335 
	`NdisFeSpLock
(&
pAd
->
TxSwQueueLock
[
dex
]);

336 
	`NdisFeSpLock
(&
pAd
->
DeQueueLock
[
dex
]);

337 
pAd
->
DeQueueRug
[
dex
] = 
FALSE
;

340 
	`NdisFeSpLock
(&
pAd
->
q_lock
);

343 
	`v
(
pAd
);

344 i(
os_cook
)

345 
	`k
(
os_cook
);

346 
	}
}

350 
NDIS_STATUS
 
	$RTMPAoNdisPack
(

351 
IN
 
PRTMP_ADAPTER
 
pAd
,

352 
OUT
 
PNDIS_PACKET
 *
Pack
,

353 
IN
 
PUCHAR
 
pHd
,

354 
IN
 
UINT
 
HdL
,

355 
IN
 
PUCHAR
 
pDa
,

356 
IN
 
UINT
 
DaL
)

358 
PNDIS_PACKET
 
pPack
;

359 
	`ASSERT
(
pDa
);

360 
	`ASSERT
(
DaL
);

363 
pPack
 = (
PNDIS_PACKET
 *
	`dev_loc_skb
(
HdL
 + 
DaL
 + 
RTMP_PKT_TAIL_PADDING
);

365 i(
pPack
 =
NULL
)

367 *
Pack
 = 
NULL
;

368 #ifde
DEBUG


369 
	`tk
("RTMPAllocateNdisPacket Fail\n\n");

371  
NDIS_STATUS_FAILURE
;

373 
	`MEM_DBG_PKT_ALLOC_INC
(
pAd
);

376 i(
HdL
 > 0)

377 
	`NdisMoveMemy
(
	`GET_OS_PKT_DATAPTR
(
pPack
), 
pHd
, 
HdL
);

378 i(
DaL
 > 0)

379 
	`NdisMoveMemy
(
	`GET_OS_PKT_DATAPTR
(
pPack
+ 
HdL
, 
pDa
, 
DaL
);

382 
	`skb_put
(
	`GET_OS_PKT_TYPE
(
pPack
), 
HdL
+
DaL
);

384 
	`RTMP_SET_PACKET_SOURCE
(
pPack
, 
PKTSRC_NDIS
);

386 *
Pack
 = 
pPack
;

387  
NDIS_STATUS_SUCCESS
;

388 
	}
}

397 
VOID
 
	$RTMPFeNdisPack
(

398 
IN
 
PRTMP_ADAPTER
 
pAd
,

399 
IN
 
PNDIS_PACKET
 
pPack
)

401 
	`dev_k_skb_y
(
	`RTPKT_TO_OSPKT
(
pPack
));

402 
	`MEM_DBG_PKT_FREE_INC
(
pAd
);

403 
	}
}

409 
NDIS_STATUS
 
	$Sniff2BysFromNdisBufr
(

410 
IN
 
PNDIS_BUFFER
 
pFBufr
,

411 
IN
 
UCHAR
 
DesedOfft
,

412 
OUT
 
PUCHAR
 
pBy0
,

413 
OUT
 
PUCHAR
 
pBy1
)

415 *
pBy0
 = *(
PUCHAR
)(
pFBufr
 + 
DesedOfft
);

416 *
pBy1
 = *(
PUCHAR
)(
pFBufr
 + 
DesedOfft
 + 1);

418  
NDIS_STATUS_SUCCESS
;

419 
	}
}

422 
	$RTMP_QuyPackInfo
(

423 
IN
 
PNDIS_PACKET
 
pPack
,

424 
OUT
 
PACKET_INFO
 *
pPackInfo
,

425 
OUT
 
PUCHAR
 *
pSrcBufVA
,

426 
OUT
 
UINT
 *
pSrcBufL
)

428 
pPackInfo
->
BufrCou
 = 1;

429 
pPackInfo
->
pFBufr
 = (
PNDIS_BUFFER
)
	`GET_OS_PKT_DATAPTR
(
pPack
);

430 
pPackInfo
->
PhysilBufrCou
 = 1;

431 
pPackInfo
->
TٮPackLgth
 = 
	`GET_OS_PKT_LEN
(
pPack
);

433 *
pSrcBufVA
 = 
	`GET_OS_PKT_DATAPTR
(
pPack
);

434 *
pSrcBufL
 = 
	`GET_OS_PKT_LEN
(
pPack
);

435 
	}
}

438 
PNDIS_PACKET
 
	$DuiPack
(

439 
IN
 
PRTMP_ADAPTER
 
pAd
,

440 
IN
 
PNDIS_PACKET
 
pPack
,

441 
IN
 
UCHAR
 
FromWhichBSSID
)

443 
sk_buff
 *
skb
;

444 
PNDIS_PACKET
 
pRPack
 = 
NULL
;

445 
USHORT
 
DaSize
;

446 
UCHAR
 *
pDa
;

448 
DaSize
 = (
USHORT

	`GET_OS_PKT_LEN
(
pPack
);

449 
pDa
 = (
PUCHAR

	`GET_OS_PKT_DATAPTR
(
pPack
);

452 
skb
 = 
	`skb_e
(
	`RTPKT_TO_OSPKT
(
pPack
), 
MEM_ALLOC_FLAG
);

453 i(
skb
)

455 
	`MEM_DBG_PKT_ALLOC_INC
(
pAd
);

456 
skb
->
dev
 = 
	`g_tdev_om_bssid
(
pAd
, 
FromWhichBSSID
);

457 
pRPack
 = 
	`OSPKT_TO_RTPKT
(
skb
);

461  
pRPack
;

463 
	}
}

465 
PNDIS_PACKET
 
	$dui_pkt
(

466 
IN
 
PRTMP_ADAPTER
 
pAd
,

467 
IN
 
PUCHAR
 
pHd802_3
,

468 
IN
 
UINT
 
HdrL
,

469 
IN
 
PUCHAR
 
pDa
,

470 
IN
 
ULONG
 
DaSize
,

471 
IN
 
UCHAR
 
FromWhichBSSID
)

473 
sk_buff
 *
skb
;

474 
PNDIS_PACKET
 
pPack
 = 
NULL
;

476 i((
skb
 = 
	`__dev_loc_skb
(
HdrL
 + 
DaSize
 + 2, 
MEM_ALLOC_FLAG
)!
NULL
)

478 
	`MEM_DBG_PKT_ALLOC_INC
(
pAd
);

480 
	`skb_rve
(
skb
, 2);

481 
	`NdisMoveMemy
(
skb
->

, 
pHd802_3
, 
HdrL
);

482 
	`skb_put
(
skb
, 
HdrL
);

483 
	`NdisMoveMemy
(
skb
->

, 
pDa
, 
DaSize
);

484 
	`skb_put
(
skb
, 
DaSize
);

485 
skb
->
dev
 = 
	`g_tdev_om_bssid
(
pAd
, 
FromWhichBSSID
);

486 
pPack
 = 
	`OSPKT_TO_RTPKT
(
skb
);

489  
pPack
;

490 
	}
}

493 
	#TKIP_TX_MIC_SIZE
 8

	)

494 
PNDIS_PACKET
 
	$dui_pkt_wh_TKIP_MIC
(

495 
IN
 
PRTMP_ADAPTER
 
pAd
,

496 
IN
 
PNDIS_PACKET
 
pPack
)

498 
sk_buff
 *
skb
, *
wskb
;

501 
skb
 = 
	`RTPKT_TO_OSPKT
(
pPack
);

502 i(
	`skb_room
(
skb
< 
TKIP_TX_MIC_SIZE
)

505 
wskb
 = 
	`skb_cy_exnd
(
skb
, 
	`skb_hdroom
(skb), 
TKIP_TX_MIC_SIZE
, 
GFP_ATOMIC
);

506 
	`MEM_DBG_PKT_ALLOC_INC
(
pAd
);

508 
	`dev_k_skb_y
(
skb
);

509 
	`MEM_DBG_PKT_FREE_INC
(
pAd
);

511 i(
wskb
 =
NULL
)

513 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Extend Tx.MIC foracket failed!, droppingacket!\n"));

514  
NULL
;

516 
skb
 = 
wskb
;

519  
	`OSPKT_TO_RTPKT
(
skb
);

522 
	}
}

541 
BOOLEAN
 
	$RTMPL2FmeTxAi
(

542 
IN
 
PRTMP_ADAPTER
 
pAd
,

543 
IN
 
UCHAR
 
idx
,

544 
IN
 
PUCHAR
 
pDa
,

545 
IN
 
UINT32
 
da_n
)

547 
sk_buff
 *
skb
 = 
	`dev_loc_skb
(
da_n
+2);

549 i(!
skb
)

551 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: E! C'lo skb.\n", 
__FUNCTION__
));

552  
FALSE
;

555 
	`MEM_DBG_PKT_ALLOC_INC
(
pAd
);

556 
	`SET_OS_PKT_NETDEV
(
skb
, 
	`g_tdev_om_bssid
(
pAd
, 
idx
));

559 
	`skb_rve
(
skb
, 2);

562 
	`NdisMoveMemy
(
	`GET_OS_PKT_DATAPTR
(
skb
), 
pDa
, 
da_n
);

565 
	`skb_put
(
	`GET_OS_PKT_TYPE
(
skb
), 
da_n
);

567 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%dn\n", 
__FUNCTION__
));

569 
	`noun_802_3_ck
(
pAd
, 
skb
);

571  
TRUE
;

573 
	}
}

575 
PNDIS_PACKET
 
	$ExndPack
(

576 
IN
 
PRTMP_ADAPTER
 
pAd
,

577 
IN
 
PNDIS_PACKET
 
pPack
,

578 
IN
 
UINT32
 
ext_hd_n
,

579 
IN
 
UINT32
 
ext__n
)

581 
sk_buff
 *
skb
, *
wskb
;

584 
skb
 = 
	`RTPKT_TO_OSPKT
(
pPack
);

586 i(
	`skb_ed
(
skb
|| (
	`skb_hdroom
(skb< 
ext_hd_n
|| (
	`skb_room
(skb< 
ext__n
))

588 
UINT32
 
hd_n
 = (
	`skb_hdroom
(
skb
< 
ext_hd_n
) ?xt_head_len : skb_headroom(skb);

589 
UINT32
 
_n
 = (
	`skb_room
(
skb
< 
ext__n
) ?xt_tail_len : skb_tailroom(skb);

592 
wskb
 = 
	`skb_cy_exnd
(
skb
, 
hd_n
, 
_n
, 
GFP_ATOMIC
);

593 
	`MEM_DBG_PKT_ALLOC_INC
(
pAd
);

595 
	`dev_k_skb_y
(
skb
);

596 
	`MEM_DBG_PKT_FREE_INC
(
pAd
);

598 i(
wskb
 =
NULL
)

600 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Extend Tx buffer for WPI failed!, droppingacket!\n"));

601  
NULL
;

603 
skb
 = 
wskb
;

607  
	`OSPKT_TO_RTPKT
(
skb
);

609 
	}
}

611 
PNDIS_PACKET
 
	$ClePack
(

612 
IN
 
PRTMP_ADAPTER
 
pAd
,

613 
IN
 
PNDIS_PACKET
 
pPack
,

614 
IN
 
PUCHAR
 
pDa
,

615 
IN
 
ULONG
 
DaSize
)

617 
sk_buff
 *
pRxPkt
;

618 
sk_buff
 *
pCledPkt
;

620 
	`ASSERT
(
pPack
);

621 
pRxPkt
 = 
	`RTPKT_TO_OSPKT
(
pPack
);

624 
pCledPkt
 = 
	`skb_e
(
pRxPkt
, 
MEM_ALLOC_FLAG
);

626 i(
pCledPkt
)

629 
	`MEM_DBG_PKT_ALLOC_INC
(
pAd
);

630 
pCledPkt
->
dev
 = 
pRxPkt
->dev;

631 
pCledPkt
->
da
 = 
pDa
;

632 
pCledPkt
->
n
 = 
DaSize
;

633 
pCledPkt
->

 =CledPkt->
da
 +CledPkt->
n
;

634 
	`ASSERT
(
DaSize
 < 1530);

636  
pCledPkt
;

637 
	}
}

642 
	$upde_os_ck_fo
(

643 
IN
 
PRTMP_ADAPTER
 
pAd
,

644 
IN
 
RX_BLK
 *
pRxBlk
,

645 
IN
 
UCHAR
 
FromWhichBSSID
)

647 
sk_buff
 *
pOSPkt
;

649 
	`ASSERT
(
pRxBlk
->
pRxPack
);

650 
pOSPkt
 = 
	`RTPKT_TO_OSPKT
(
pRxBlk
->
pRxPack
);

652 
pOSPkt
->
dev
 = 
	`g_tdev_om_bssid
(
pAd
, 
FromWhichBSSID
);

653 
pOSPkt
->
da
 = 
pRxBlk
->
pDa
;

654 
pOSPkt
->
n
 = 
pRxBlk
->
DaSize
;

655 
pOSPkt
->

 =OSPkt->
da
 +OSPkt->
n
;

656 
	}
}

659 
	$wn_802_11_to_802_3_ck
(

660 
IN
 
PRTMP_ADAPTER
 
pAd
,

661 
IN
 
RX_BLK
 *
pRxBlk
,

662 
IN
 
PUCHAR
 
pHd802_3
,

663 
IN
 
UCHAR
 
FromWhichBSSID
,

664 
IN
 
UCHAR
 *
TPID
)

666 
sk_buff
 *
pOSPkt
;

668 
	`ASSERT
(
pRxBlk
->
pRxPack
);

669 
	`ASSERT
(
pHd802_3
);

671 
pOSPkt
 = 
	`RTPKT_TO_OSPKT
(
pRxBlk
->
pRxPack
);

673 
pOSPkt
->
dev
 = 
	`g_tdev_om_bssid
(
pAd
, 
FromWhichBSSID
);

674 
pOSPkt
->
da
 = 
pRxBlk
->
pDa
;

675 
pOSPkt
->
n
 = 
pRxBlk
->
DaSize
;

676 
pOSPkt
->

 =OSPkt->
da
 +OSPkt->
n
;

683 #ifde
CONFIG_STA_SUPPORT


684 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

685 
	`NdisMoveMemy
(
	`skb_push
(
pOSPkt
, 
LENGTH_802_3
), 
pHd802_3
, LENGTH_802_3);

687 
	}
}

690 
	$noun_802_3_ck
(

691 
IN
 
PRTMP_ADAPTER
 
pAd
,

692 
IN
 
PNDIS_PACKET
 
pPack
)

695 
sk_buff
 *
pRxPkt
;

696 #ifde
INF_PPA_SUPPORT


697 
t
 = 0;

698 
a_ags
 = 0;

702 
	`ASSERT
(
pPack
);

704 
	`MEM_DBG_PKT_FREE_INC
(
pAd
);

706 
pRxPkt
 = 
	`RTPKT_TO_OSPKT
(
pPack
);

708 #ifde
CONFIG_STA_SUPPORT


713 #ifde
IKANOS_VX_1X0


714 
	`IKANOS_DaFmeRx
(
pAd
, 
pRxPkt
->
dev
,RxPkt,RxPkt->
n
);

720 #ifde
INF_PPA_SUPPORT


721 i(
a_hook_deth_nd_
 && 
pAd
->
PPAEb
==
TRUE
 )

723 
pRxPkt
->
oc
 = 
	`h_ty_s
RxPkt,RxPkt->
dev
);

725 
	`memt
(
pRxPkt
->
hd
,0,pRxPkt->
da
-pRxPkt->head-14);

726 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("a_hook_deth_nd_x :t:%d hdroom:%d dev:%pk:%d<===\n",
t
,
	`skb_hdroom
(
pRxPkt
)

727 ,
pRxPkt
->
dev
->
me
,pRxPkt->
n
));

728 
	`hex_dump
("rxack", 
pRxPkt
->
da
, 32);

729 
t
 = 
	`a_hook_deth_nd_
(
pAd
->
g_if_id
, 
pRxPkt
,RxPkt->
n
, 
a_ags
);

730 
pRxPkt
=
NULL
;

742 
pRxPkt
->
oc
 = 
	`h_ty_s
RxPkt,RxPkt->
dev
);

743 
	`tif_rx
(
pRxPkt
);

747 
	}
}

750 
PRTMP_SCATTER_GATHER_LIST


751 
	$_g_sg_li_om_ck
(
PNDIS_PACKET
 
pPack
, 
RTMP_SCATTER_GATHER_LIST
 *
sg
)

753 
sg
->
NumbOfEmts
 = 1;

754 
sg
->
Emts
[0].
Addss
 = 
	`GET_OS_PKT_DATAPTR
(
pPack
);

755 
sg
->
Emts
[0].
Lgth
 = 
	`GET_OS_PKT_LEN
(
pPack
);

756  (
sg
);

757 
	}
}

759 
	$hex_dump
(*
r
, *
pSrcBufVA
, 
SrcBufL
)

761 #ifde
DBG


762 *

;

763 
x
;

765 i(
RTDebugLev
 < 
RT_DEBUG_TRACE
)

768 

 = 
pSrcBufVA
;

769 
	`tk
("%s: %p, = %d\n",
r
, 
pSrcBufVA
, 
SrcBufL
);

770 
x
=0; x<
SrcBufL
; x++)

772 i(
x
 % 16 == 0)

773 
	`tk
("0x%04x : ", 
x
);

774 
	`tk
("%02x ", (()

[
x
]));

775 i(
x
%16 =15
	`tk
("\n");

777 
	`tk
("\n");

779 
	}
}

781 #ifde
SYSTEM_LOG_SUPPORT


802 
VOID
 
	$RTMPSdWessEvt
(

803 
IN
 
PRTMP_ADAPTER
 
pAd
,

804 
IN
 
USHORT
 
Evt_ag
,

805 
IN
 
PUCHAR
 
pAddr
,

806 
IN
 
UCHAR
 
BssIdx
,

807 
IN
 
CHAR
 
Rssi
)

809 
PSTRING
 
pBuf
 = 
NULL
, 
pBufP
 = NULL;

810 
USHORT
 
evt
, 
ty
, 
BufL
;

811 
UCHAR
 
evt_b_n
 = 0;

813 i(
pAd
->
CommCfg
.
bWessEvt
 =
FALSE
)

816 #i
WIRELESS_EXT
 >= 15

818 
ty
 = 
Evt_ag
 & 0xFF00;

819 
evt
 = 
Evt_ag
 & 0x00FF;

821 
ty
)

823 
IW_SYS_EVENT_FLAG_START
:

824 
evt_b_n
 = 
IW_SYS_EVENT_TYPE_NUM
;

826 #ifde
IDS_SUPPORT


827 
IW_SPOOF_EVENT_FLAG_START
:

828 
evt_b_n
 = 
IW_SPOOF_EVENT_TYPE_NUM
;

831 
IW_FLOOD_EVENT_FLAG_START
:

832 
evt_b_n
 = 
IW_FLOOD_EVENT_TYPE_NUM
;

837 i(
evt_b_n
 == 0)

839 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: Thty(%0x02xin vid.\n", 
__FUNCTION__
, 
ty
));

843 i(
evt
 >
evt_b_n
)

845 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: Thevt(%0x02xin vid.\n", 
__FUNCTION__
, 
evt
));

850 if((
pBuf
 = 
	`kmloc
(
IW_CUSTOM_MAX_LEN
, 
GFP_ATOMIC
)!
NULL
)

853 
	`memt
(
pBuf
, 0, 
IW_CUSTOM_MAX_LEN
);

855 
pBufP
 = 
pBuf
;

857 i(
pAddr
)

858 
pBufP
 +
	`rtf
BufP, "(RT2860STA(%02x:%02x:%02x:%02x:%02x:%02x", 
	`PRINT_MAC
(
pAddr
));

859 i(
BssIdx
 < 
MAX_MBSSID_NUM
)

860 
pBufP
 +
	`rtf
BufP, "(RT2860BSSa%d", 
BssIdx
);

862 
pBufP
 +
	`rtf
(pBufPtr, "(RT2860) ");

864 i(
ty
 =
IW_SYS_EVENT_FLAG_START
)

866 
pBufP
 +
	`rtf
BufP, "%s", 
pWessSysEvtText
[
evt
]);

868 i(
Evt_ag
 =
IW_CHANNEL_CHANGE_EVENT_FLAG
)

870 
pBufP
 +
	`rtf
BufP, "%3d", 
Rssi
);

873 #ifde
IDS_SUPPORT


874 i(
ty
 =
IW_SPOOF_EVENT_FLAG_START
)

875 
pBufP
 +
	`rtf
BufP, "%(RSSI=%d)", 
pWessSpoofEvtText
[
evt
], 
Rssi
);

876 i(
ty
 =
IW_FLOOD_EVENT_FLAG_START
)

877 
pBufP
 +
	`rtf
BufP, "%s", 
pWessFloodEvtText
[
evt
]);

880 
pBufP
 +
	`rtf
(pBufPtr, "%s", "unknownvent");

882 
pBufP
[pBufP - 
pBuf
] = '\0';

883 
BufL
 = 
pBufP
 - 
pBuf
;

885 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, 
Evt_ag
, 
NULL
, (
PUCHAR
)
pBuf
, 
BufL
);

888 
	`k
(
pBuf
);

891 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: C'lo memy f wesevt.\n", 
__FUNCTION__
));

893 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: ThWesExnsi MUST bv15 ow.\n", 
__FUNCTION__
));

895 
	}
}

900 #ifde
CONFIG_STA_SUPPORT


901 
__s32
 
	glk
[] =

913 
UINT32
 
	gRT_ReSize
 = (
lk
);

915 
nd_mڙ_cks
(

916 
IN
 
PRTMP_ADAPTER
 
pAd
,

917 
IN
 
RX_BLK
 *
pRxBlk
,

918 
IN
 
	$CHAR
 (*
RTMPMaxRssi
)(

919 
IN
 
PRTMP_ADAPTER
 
pAd
,

920 
IN
 
CHAR
 
Rssi0
,

921 
IN
 
CHAR
 
Rssi1
,

922 
IN
 
CHAR
 
Rssi2
),

923 
IN
 
	$CHAR
 (*
CvtToRssi
)(

924 
IN
 
PRTMP_ADAPTER
 
pAd
,

925 
IN
 
CHAR
 
Rssi
,

926 
IN
 
UCHAR
 
RssiNumb
))

928 
sk_buff
 *
pOSPkt
;

929 
wn_ng_ism2_hd
 *
ph
;

930 #ifde
MONITOR_FLAG_11N_SNIFFER_SUPPORT


931 
ETHEREAL_RADIO
 
h
, *
ph_11n33
;

933 
_dex
 = 0;

934 
USHORT
 
hd_n
 = 0;

935 
UCHAR
 
mp_hd
[40] = {0};

938 
	`MEM_DBG_PKT_FREE_INC
(
pAd
);

940 
	`ASSERT
(
pRxBlk
->
pRxPack
);

941 i(
pRxBlk
->
DaSize
 < 10)

943 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: Sizitosml! (%d)\n", 
__FUNCTION__
, 
pRxBlk
->
DaSize
));

944 
r__sk_buff
;

947 i(
pRxBlk
->
DaSize
 + (
wn_ng_ism2_hd
> 
RX_BUFFER_AGGRESIZE
)

949 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: Sizitorge! (%d)\n", 
__FUNCTION__
, 
pRxBlk
->
DaSize
 + (
wn_ng_ism2_hd
)));

950 
r__sk_buff
;

953 
pOSPkt
 = 
	`RTPKT_TO_OSPKT
(
pRxBlk
->
pRxPack
);

954 
pOSPkt
->
dev
 = 
	`g_tdev_om_bssid
(
pAd
, 
BSS0
);

955 i(
pRxBlk
->
pHd
->
FC
.
Ty
 =
BTYPE_DATA
)

957 
pRxBlk
->
DaSize
 -
LENGTH_802_11
;

958 i((
pRxBlk
->
pHd
->
FC
.
ToDs
 == 1) &&

959 (
pRxBlk
->
pHd
->
FC
.
FrDs
 == 1))

960 
hd_n
 = 
LENGTH_802_11_WITH_ADDR4
;

962 
hd_n
 = 
LENGTH_802_11
;

965 i(
pRxBlk
->
pHd
->
FC
.
SubTy
 & 0x08)

967 
hd_n
 += 2;

969 
pRxBlk
->
DaSize
 -=2;

973 i(
pRxBlk
->
pHd
->
FC
.
Ord
)

975 
hd_n
 += 4;

977 
pRxBlk
->
DaSize
 -= 4;

981 i(
hd_n
 <= 40)

982 
	`NdisMoveMemy
(
mp_hd
, 
pRxBlk
->
pDa
, 
hd_n
);

985 i(
pRxBlk
->
RxD
.
L2PAD
)

986 
pRxBlk
->
pDa
 +(
hd_n
 + 2);

988 
pRxBlk
->
pDa
 +
hd_n
;

992 i(
pRxBlk
->
DaSize
 < 
pOSPkt
->
n
) {

993 
	`skb_im
(
pOSPkt
,
pRxBlk
->
DaSize
);

995 
	`skb_put
(
pOSPkt
,(
pRxBlk
->
DaSize
 -OSPkt->
n
));

998 i((
pRxBlk
->
pDa
 - 
pOSPkt
->
da
) > 0) {

999 
	`skb_put
(
pOSPkt
,(
pRxBlk
->
pDa
 -OSPkt->
da
));

1000 
	`skb_pu
(
pOSPkt
,(
pRxBlk
->
pDa
 -OSPkt->
da
));

1003 i(
	`skb_hdroom
(
pOSPkt
< ((
wn_ng_ism2_hd
)+ 
hd_n
)) {

1004 i(
	`pskb_exnd_hd
(
pOSPkt
, ((
wn_ng_ism2_hd
+ 
hd_n
), 0, 
GFP_ATOMIC
)) {

1005 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%: Ro hd sizosk_buf!\n", 
__FUNCTION__
));

1006 
r__sk_buff
;

1010 i(
hd_n
 > 0)

1011 
	`NdisMoveMemy
(
	`skb_push
(
pOSPkt
, 
hd_n
), 
mp_hd
, header_len);

1013 #ifde
MONITOR_FLAG_11N_SNIFFER_SUPPORT


1014 i((
pAd
->
SCfg
.
BssMڙFg
 & 
MONITOR_FLAG_11N_SNIFFER
) == 0)

1017 
ph
 = (
wn_ng_ism2_hd
 *
	`skb_push
(
pOSPkt
, (wlan_ng_prism2_header));

1018 
	`NdisZoMemy
(
ph
, (
wn_ng_ism2_hd
));

1020 
ph
->
msgcode
 = 
DIDmsg_xd_wnifm
;

1021 
ph
->
msgn
 = (
wn_ng_ism2_hd
);

1022 
	`ry
((
PSTRING

ph
->
devme
, (PSTRING
pAd
->
t_dev
->
me
);

1024 
ph
->
hotime
.
did
 = 
DIDmsg_xd_wnifm_hotime
;

1025 
ph
->
hotime
.
us
 = 0;

1026 
ph
->
hotime
.
n
 = 4;

1027 
ph
->
hotime
.
da
 = 
jiffs
;

1029 
ph
->
maime
.
did
 = 
DIDmsg_xd_wnifm_maime
;

1030 
ph
->
maime
.
us
 = 0;

1031 
ph
->
maime
.
n
 = 0;

1032 
ph
->
maime
.
da
 = 0;

1034 
ph
->
ix
.
did
 = 
DIDmsg_xd_wnifm_ix
;

1035 
ph
->
ix
.
us
 = 0;

1036 
ph
->
ix
.
n
 = 0;

1037 
ph
->
ix
.
da
 = 0;

1039 
ph
->
chl
.
did
 = 
DIDmsg_xd_wnifm_chl
;

1040 
ph
->
chl
.
us
 = 0;

1041 
ph
->
chl
.
n
 = 4;

1043 
ph
->
chl
.
da
 = (
u_t32_t
)
pAd
->
CommCfg
.
Chl
;

1045 
ph
->
rssi
.
did
 = 
DIDmsg_xd_wnifm_rssi
;

1046 
ph
->
rssi
.
us
 = 0;

1047 
ph
->
rssi
.
n
 = 4;

1048 
ph
->
rssi
.
da
 = (
u_t32_t
)
	`RTMPMaxRssi
(
pAd
, 
	`CvtToRssi
Ad, 
pRxBlk
->
pRxWI
->
RSSI0
, 
RSSI_0
), CvtToRssiAd,RxBlk->pRxWI->
RSSI1
, 
RSSI_1
), CvtToRssiAd,RxBlk->pRxWI->
RSSI2
, 
RSSI_2
));;

1050 
ph
->
sigl
.
did
 = 
DIDmsg_xd_wnifm_sigl
;

1051 
ph
->
sigl
.
us
 = 0;

1052 
ph
->
sigl
.
n
 = 4;

1053 
ph
->
sigl
.
da
 = 0;

1055 
ph
->
noi
.
did
 = 
DIDmsg_xd_wnifm_noi
;

1056 
ph
->
noi
.
us
 = 0;

1057 
ph
->
noi
.
n
 = 4;

1058 
ph
->
noi
.
da
 = 0;

1060 #ifde
DOT11_N_SUPPORT


1061 i(
pRxBlk
->
pRxWI
->
PHYMODE
 >
MODE_HTMIX
)

1063 
_dex
 = 12 + ((
UCHAR
)
pRxBlk
->
pRxWI
->
BW
 *24+ ((UCHARRxBlk->pRxWI->
ShtGI
 *48+ ((UCHARRxBlk->pRxWI->
MCS
);

1067 i(
pRxBlk
->
pRxWI
->
PHYMODE
 =
MODE_OFDM
)

1068 
_dex
 = (
UCHAR
)(
pRxBlk
->
pRxWI
->
MCS
) + 4;

1070 
_dex
 = (
UCHAR
)(
pRxBlk
->
pRxWI
->
MCS
);

1072 i(
_dex
 < 0)

1073 
_dex
 = 0;

1074 i(
_dex
 > 255)

1075 
_dex
 = 255;

1077 
ph
->

.
did
 = 
DIDmsg_xd_wnifm_
;

1078 
ph
->

.
us
 = 0;

1079 
ph
->

.
n
 = 4;

1080 
ph
->

.
da
 = 
lk
[
_dex
];

1082 
ph
->
mn
.
did
 = 
DIDmsg_xd_wnifm_mn
;

1083 
ph
->
mn
.
us
 = 0;

1084 
ph
->
mn
.
n
 = 4;

1085 
ph
->
mn
.
da
 = (
u_t32_t
)
pRxBlk
->
DaSize
;

1087 #ifde
MONITOR_FLAG_11N_SNIFFER_SUPPORT


1090 
ph_11n33
 = &
h
;

1091 
	`NdisZoMemy
((*)
ph_11n33
, (
ETHEREAL_RADIO
));

1094 i(
pRxBlk
->
pRxWI
->
MCS
 > 15)

1095 
ph_11n33
->
Fg_80211n
 |
WIRESHARK_11N_FLAG_3x3
;

1097 i(
pRxBlk
->
pRxWI
->
PHYMODE
 =
MODE_HTGREENFIELD
 )

1098 
ph_11n33
->
Fg_80211n
 |
WIRESHARK_11N_FLAG_GF
;

1101 i(
pRxBlk
->
pRxWI
->
BW
 == 1){

1102 
ph_11n33
->
Fg_80211n
 |
WIRESHARK_11N_FLAG_BW40
;

1104 i(
pAd
->
CommCfg
.
Chl
 <Ad->CommCfg.
CChl
){

1105 
ph_11n33
->
Fg_80211n
 |
WIRESHARK_11N_FLAG_BW20U
;

1107 i(
pAd
->
CommCfg
.
Chl
 >Ad->CommCfg.
CChl
){

1108 
ph_11n33
->
Fg_80211n
 |
WIRESHARK_11N_FLAG_BW20D
;

1111 
ph_11n33
->
Fg_80211n
 |(
WIRESHARK_11N_FLAG_BW20U
 | 
WIRESHARK_11N_FLAG_BW20D
);

1114 i(
pRxBlk
->
pRxWI
->
ShtGI
 == 1)

1115 
ph_11n33
->
Fg_80211n
 |
WIRESHARK_11N_FLAG_SGI
;

1117 i(
pRxBlk
->
RxD
.
AMPDU
)

1118 
ph_11n33
->
Fg_80211n
 |
WIRESHARK_11N_FLAG_AMPDU
;

1120 i(
pRxBlk
->
pRxWI
->
STBC
)

1121 
ph_11n33
->
Fg_80211n
 |
WIRESHARK_11N_FLAG_STBC
;

1123 
ph_11n33
->
sigl_v
 = (
UCHAR
)
pRxBlk
->
pRxWI
->
RSSI1
;

1126 i(
pRxBlk
->
pRxWI
->
PHYMODE
 >
MODE_HTMIX
)

1128 i(
pRxBlk
->
pRxWI
->
MCS
 == 32)

1130 i(
pRxBlk
->
pRxWI
->
ShtGI
)

1131 
ph_11n33
->
da_
 = 16;

1133 
ph_11n33
->
da_
 = 4;

1135 i(
pRxBlk
->
pRxWI
->
MCS
 > 15)

1136 
ph_11n33
->
da_
 = (16*4 + ((
UCHAR
)
pRxBlk
->
pRxWI
->
BW
 *16+ ((UCHARRxBlk->pRxWI->
ShtGI
 *32+ ((UCHARRxBlk->pRxWI->
MCS
));

1138 
ph_11n33
->
da_
 = 16 + ((
UCHAR
)
pRxBlk
->
pRxWI
->
BW
 *16+ ((UCHARRxBlk->pRxWI->
ShtGI
 *32+ ((UCHARRxBlk->pRxWI->
MCS
);

1140 i(
pRxBlk
->
pRxWI
->
PHYMODE
 =
MODE_OFDM
)

1141 
ph_11n33
->
da_
 = (
UCHAR
)(
pRxBlk
->
pRxWI
->
MCS
) + 4;

1143 
ph_11n33
->
da_
 = (
UCHAR
)(
pRxBlk
->
pRxWI
->
MCS
);

1146 
ph_11n33
->
chl
 = (
UCHAR
)
pAd
->
CommCfg
.
Chl
;

1148 
	`NdisMoveMemy
(
	`skb_put
(
pOSPkt
, (
ETHEREAL_RADIO
)), (
UCHAR
 *)
ph_11n33
, (ETHEREAL_RADIO));

1152 
pOSPkt
->
pkt_ty
 = 
PACKET_OTHERHOST
;

1153 
pOSPkt
->
oc
 = 
	`h_ty_s
OSPkt,OSPkt->
dev
);

1154 
pOSPkt
->
_summed
 = 
CHECKSUM_NONE
;

1155 
	`tif_rx
(
pOSPkt
);

1159 
r__sk_buff
:

1160 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

1163 
	}
}

1174 
RTMP_OS_FD
 
	$RtmpOSFeOn
(*
pPh
, 
ag
, 
mode
)

1176 
fe
 *
feP
;

1178 
feP
 = 
	`fp_ݒ
(
pPh
, 
ag
, 0);

1179 i(
	`IS_ERR
(
feP
))

1181 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s(): E %ld ong %s\n", 
__FUNCTION__
, -
	`PTR_ERR
(
feP
), 
pPh
));

1184  (
RTMP_OS_FD
)
feP
;

1185 
	}
}

1187 
	$RtmpOSFeClo
(
RTMP_OS_FD
 
osfd
)

1189 
	`fp_o
(
osfd
, 
NULL
);

1191 
	}
}

1194 
	$RtmpOSFeSk
(
RTMP_OS_FD
 
osfd
, 
offt
)

1196 
osfd
->
f_pos
 = 
offt
;

1197 
	}
}

1200 
	$RtmpOSFeRd
(
RTMP_OS_FD
 
osfd
, *
pDaP
, 
adL
)

1203 i(
osfd
->
f_
 && osfd->f_->
ad
)

1205  
osfd
->
f_
->
	`ad
(osfd, 
pDaP
, 
adL
, &osfd->
f_pos
);

1209 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("no fileead method\n"));

1212 
	}
}

1215 
	$RtmpOSFeWre
(
RTMP_OS_FD
 
osfd
, *
pDaP
, 
wreL
)

1217  
osfd
->
f_
->
	`wre
(osfd, 
pDaP
, (
size_t
)
wreL
, &osfd->
f_pos
);

1218 
	}
}

1221 
	$RtmpOSFSInfoChge
(
RTMP_OS_FS_INFO
 *
pOSFSInfo
, 
BOOLEAN
 
bS
)

1223 i(
bS
)

1227 #i
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,29)

1228 
pOSFSInfo
->
fsuid

cut
->fsuid;

1229 
pOSFSInfo
->
fsgid
 = 
cut
->fsgid;

1230 
cut
->
fsuid
 = cut->
fsgid
 = 0;

1232 
pOSFSInfo
->
fsuid
 = 
	`cut_fsuid
();

1233 
pOSFSInfo
->
fsgid
 = 
	`cut_fsgid
();

1235 
pOSFSInfo
->
fs
 = 
	`g_fs
();

1236 
	`t_fs
(
KERNEL_DS
);

1240 
	`t_fs
(
pOSFSInfo
->
fs
);

1241 #i
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,29)

1242 
cut
->
fsuid
 = 
pOSFSInfo
->fsuid;

1243 
cut
->
fsgid
 = 
pOSFSInfo
->fsgid;

1246 
	}
}

1255 
NDIS_STATUS
 
	$RtmpOSTaskKl
(

1256 
IN
 
RTMP_OS_TASK
 *
pTask
)

1258 
RTMP_ADAPTER
 *
pAd
;

1259 
t
 = 
NDIS_STATUS_FAILURE
;

1261 
pAd
 = (
RTMP_ADAPTER
 *)
pTask
->
iv
;

1263 #ifde
KTHREAD_SUPPORT


1264 i(
pTask
->
kthad_sk
)

1266 
	`kthad_
(
pTask
->
kthad_sk
);

1267 
t
 = 
NDIS_STATUS_SUCCESS
;

1270 
	`CHECK_PID_LEGALITY
(
pTask
->
skPID
)

1272 
	`DBGPRINT
(
RT_DEBUG_TRACE
,

1273 ("Tmthsk(%swhid(%d)!\n", 
pTask
->
skName
, 
	`GET_PID_NUMBER
Task->
skPID
)));

1274 
	`mb
();

1275 
pTask
->
sk_kd
 = 1;

1276 
	`mb
();

1277 
t
 = 
	`KILL_THREAD_PID
(
pTask
->
skPID
, 
SIGTERM
, 1);

1278 i(
t
)

1280 
	`tk
(
KERN_WARNING
 "killask(%s) withid(%d) failed(retVal=%d)!\n",

1281 
pTask
->
skName
, 
	`GET_PID_NUMBER
Task->
skPID
), 
t
);

1285 
	`wa_f_comi
(&
pTask
->
skCome
);

1286 
pTask
->
skPID
 = 
THREAD_PID_INIT_VALUE
;

1287 
pTask
->
sk_kd
 = 0;

1288 
	`RTMP_SEM_EVENT_DESTORY
(&
pTask
->
skSema
);

1289 
t
 = 
NDIS_STATUS_SUCCESS
;

1294  
t
;

1296 
	}
}

1299 
INT
 
	$RtmpOSTaskNifyToEx
(

1300 
IN
 
RTMP_OS_TASK
 *
pTask
)

1303 #ide
KTHREAD_SUPPORT


1304 
	`come_d_ex
(&
pTask
->
skCome
, 0);

1308 
	}
}

1311 
	$RtmpOSTaskCuomize
(

1312 
IN
 
RTMP_OS_TASK
 *
pTask
)

1315 #ide
KTHREAD_SUPPORT


1317 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

1318 
	`dmize
((
PSTRING
)&
pTask
->
skName
[0] );

1320 
	`low_sigl
(
SIGTERM
);

1321 
	`low_sigl
(
SIGKILL
);

1322 
cut
->
ags
 |
PF_NOFREEZE
;

1324 
ags
;

1326 
	`dmize
();

1327 
	`_to_
();

1328 
	`ry
(
cut
->
comm
, &
pTask
->
skName
[0]);

1330 
	`sigtv
(&
cut
->
blocked
, 
	`sigmask
(
SIGTERM
| sigmask(
SIGKILL
));

1334 #i
LINUX_VERSION_CODE
 > 
	`KERNEL_VERSION
(2,4,22)

1335 
	`_lock_qve
(&
cut
->
sigmask_lock
, 
ags
);

1336 
	`ush_sigls
(
cut
);

1337 
	`lc_signdg
(
cut
);

1338 
	`_uock_qe
(&
cut
->
sigmask_lock
, 
ags
);

1342 
	`RTMP_GET_OS_PID
(
pTask
->
skPID
, 
cut
->
pid
);

1345 
	`come
(&
pTask
->
skCome
);

1348 
	}
}

1350 
NDIS_STATUS
 
	$RtmpOSTaskAach
(

1351 
IN
 
RTMP_OS_TASK
 *
pTask
,

1352 
IN
 
RTMP_OS_TASK_CALLBACK
 

,

1353 
IN
 
ULONG
 
g
)

1355 
NDIS_STATUS
 
us
 = 
NDIS_STATUS_SUCCESS
;

1356 #ide
KTHREAD_SUPPORT


1357 
pid_t
 
pid_numb
 = -1;

1360 #ifde
KTHREAD_SUPPORT


1361 
pTask
->
sk_kd
 = 0;

1362 
pTask
->
kthad_sk
 = 
NULL
;

1363 
pTask
->
kthad_sk
 = 
	`kthad_run
((
_
)

, (*)
g
,Task->
skName
);

1364 i(
	`IS_ERR
(
pTask
->
kthad_sk
))

1365 
us
 = 
NDIS_STATUS_FAILURE
;

1367 
pid_numb
 = 
	`kl_thad
((
_
)

, (*)
g
, 
RTMP_OS_MGMT_TASK_FLAGS
);

1368 i(
pid_numb
 < 0)

1370 
	`DBGPRINT
 (
RT_DEBUG_ERROR
, ("Aachask(%sed!\n", 
pTask
->
skName
));

1371 
us
 = 
NDIS_STATUS_FAILURE
;

1376 
	`wa_f_comi
(&
pTask
->
skCome
);

1377 
us
 = 
NDIS_STATUS_SUCCESS
;

1380  
us
;

1381 
	}
}

1384 
NDIS_STATUS
 
	$RtmpOSTaskIn
(

1385 
IN
 
RTMP_OS_TASK
 *
pTask
,

1386 
IN
 
PSTRING
 
pTaskName
,

1387 
IN
 
VOID
 *
pPriv
)

1389 
n
;

1391 
	`ASSERT
(
pTask
);

1393 #ide
KTHREAD_SUPPORT


1394 
	`NdisZoMemy
((
PUCHAR
)(
pTask
), (
RTMP_OS_TASK
));

1397 
n
 = 
	`
(
pTaskName
);

1398 
n
 = > (
RTMP_OS_TASK_NAME_LEN
 -1) ? (RTMP_OS_TASK_NAME_LEN-1) :en;

1399 
	`NdisMoveMemy
(&
pTask
->
skName
[0], 
pTaskName
, 
n
);

1400 
pTask
->
iv
 = 
pPriv
;

1402 #ide
KTHREAD_SUPPORT


1403 
	`RTMP_SEM_EVENT_INIT_LOCKED
(&(
pTask
->
skSema
));

1404 
pTask
->
skPID
 = 
THREAD_PID_INIT_VALUE
;

1406 
	`_comi
 (&
pTask
->
skCome
);

1409  
NDIS_STATUS_SUCCESS
;

1410 
	}
}

1413 
	$RTMP_IndiMedS
(

1414 
IN
 
PRTMP_ADAPTER
 
pAd
,

1415 
IN
 
NDIS_MEDIA_STATE
 
med_e
)

1417 #ifde
SYSTEM_LOG_SUPPORT


1418 
pAd
->
IndiMedS
 = 
med_e
;

1419 i(
pAd
->
IndiMedS
 =
NdisMedSCed
)

1421 
	`RTMPSdWessEvt
(
pAd
, 
IW_STA_LINKUP_EVENT_FLAG
,Ad->
MacTab
.
Cڋ
[
BSSID_WCID
].
Addr
, 
BSS0
, 0);

1425 
	`RTMPSdWessEvt
(
pAd
, 
IW_STA_LINKDOWN_EVENT_FLAG
,Ad->
MacTab
.
Cڋ
[
BSSID_WCID
].
Addr
, 
BSS0
, 0);

1428 
	}
}

1431 #i
LINUX_VERSION_CODE
 <= 0x20402

1433 
t_devi
 *
loc_tdev
(

1434 
sizeof_iv
,

1435 cڡ *
mask
,

1436 (*
tup
)(
t_devi
 *))

1438 
t_devi
 *
dev
;

1439 
INT
 
loc_size
;

1443 
loc_size
 =  (*
dev
+ 
sizeof_iv
 + 31;

1445 
dev
 = (
t_devi
 *
	`kmloc
(
loc_size
, 
GFP_KERNEL
);

1446 i(
dev
 =
NULL
)

1448 
	`DBGPRINT
(
RT_DEBUG_ERROR
,

1450  
NULL
;

1453 
	`memt
(
dev
, 0, 
loc_size
);

1455 i(
sizeof_iv
)

1456 
dev
->
iv
 = (*) ((()(dev + 1) + 31) & ~31);

1458 
	`tup
(
dev
);

1459 
	`ry
(
dev
->
me
, 
mask
);

1461  
dev
;

1462 
	}
}

1466 
	$RtmpOSWrssEvtSd
(

1467 
IN
 
RTMP_ADAPTER
 *
pAd
,

1468 
IN
 
UINT32
 
evtTy
,

1469 
IN
 
INT
 
ags
,

1470 
IN
 
PUCHAR
 
pSrcMac
,

1471 
IN
 
PUCHAR
 
pDa
,

1472 
IN
 
UINT32
 
daL
)

1474 
iwq_da
 
wrqu
;

1476 
	`memt
(&
wrqu
, 0, (wrqu));

1478 i(
ags
 > -1)

1479 
wrqu
.
da
.
ags
 = flags;

1481 i(
pSrcMac
)

1482 
	`memy
(
wrqu
.
_addr
.
_da
, 
pSrcMac
, 
MAC_ADDR_LEN
);

1484 i((
pDa
!
NULL
&& (
daL
 > 0))

1485 
wrqu
.
da
.
ngth
 = 
daL
;

1487 
	`wess_nd_evt
(
pAd
->
t_dev
, 
evtTy
, &
wrqu
, (*)
pDa
);

1489 
	}
}

1492 
	$RtmpOSNDevAddrS
(

1493 
IN
 
PNET_DEV
 
pNDev
,

1494 
IN
 
PUCHAR
 
pMacAddr
)

1496 
t_devi
 *
t_dev
;

1497 
RTMP_ADAPTER
 *
pAd
;

1499 
t_dev
 = 
pNDev
;

1500 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

1502 #ifde
CONFIG_STA_SUPPORT


1504 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1506 
	`NdisZoMemy
(
pAd
->
SCfg
.
dev_me
, 16);

1507 
	`NdisMoveMemy
(
pAd
->
SCfg
.
dev_me
, 
t_dev
->
me
, 
	`
(net_dev->name));

1511 
	`NdisMoveMemy
(
t_dev
->
dev_addr
, 
pMacAddr
, 6);

1514 
	}
}

1521 
	$RtmpOSNDevRequeName
(

1522 
IN
 
RTMP_ADAPTER
 *
pAd
,

1523 
IN
 
PNET_DEV
 
dev
,

1524 
IN
 
PSTRING
 
pPfixS
,

1525 
IN
 
INT
 
devIdx
)

1527 
PNET_DEV
 
exiNDev
;

1528 
STRING
 
suffixName
[
IFNAMSIZ
];

1529 
STRING
 
desedName
[
IFNAMSIZ
];

1530 
ifNameIdx
, 
efixL
, 
NameL
;

1531 
Stus
;

1534 
efixL
 = 
	`
(
pPfixS
);

1535 
	`ASSERT
((
efixL
 < 
IFNAMSIZ
));

1537 
ifNameIdx
 = 
devIdx
; ifNameIdx < 32; ifNameIdx++)

1539 
	`memt
(
suffixName
, 0, 
IFNAMSIZ
);

1540 
	`memt
(
desedName
, 0, 
IFNAMSIZ
);

1541 
	`y
(&
desedName
[0], 
pPfixS
, 
efixL
);

1543 #ifde
MULTIPLE_CARD_SUPPORT


1544 i(
pAd
->
MC_RowID
 >= 0)

1545 
	`rtf
(
suffixName
, "%02d_%d", 
pAd
->
MC_RowID
, 
ifNameIdx
);

1548 
	`rtf
(
suffixName
, "%d", 
ifNameIdx
);

1550 
NameL
 = 
	`
(
suffixName
);

1551 
	`ASSERT
(((
NameL
 + 
efixL
< 
IFNAMSIZ
));

1552 
	`rt
(
desedName
, 
suffixName
);

1554 
exiNDev
 = 
	`RtmpOSNDevGByName
(
dev
, &
desedName
[0]);

1555 i(
exiNDev
 =
NULL
)

1558 
	`RtmpOSNDeviRefPut
(
exiNDev
);

1561 if(
ifNameIdx
 < 32)

1563 #ifde
HOSTAPD_SUPPORT


1564 
pAd
->
IolIF
=
ifNameIdx
;

1566 
	`ry
(&
dev
->
me
[0], &
desedName
[0]);

1567 
Stus
 = 
NDIS_STATUS_SUCCESS
;

1571 
	`DBGPRINT
(
RT_DEBUG_ERROR
,

1572 ("Cnلeque DevNamwhifx(%sd inge(0~32asuffix from OS!\n", 
pPfixS
));

1573 
Stus
 = 
NDIS_STATUS_FAILURE
;

1576  
Stus
;

1577 
	}
}

1580 
	$RtmpOSNDevClo
(

1581 
IN
 
PNET_DEV
 
pNDev
)

1583 
	`dev_o
(
pNDev
);

1584 
	}
}

1587 
	$RtmpOSNDevFe
(
PNET_DEV
 
pNDev
)

1589 
	`ASSERT
(
pNDev
);

1591 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

1592 
	`_tdev
(
pNDev
);

1594 
	`k
(
pNDev
);

1596 
	}
}

1599 
INT
 
	$RtmpOSNDevAoc
(

1600 
IN
 
PNET_DEV
 *
w_dev_p
,

1601 
IN
 
UINT32
 
ivDaSize
)

1604 *
w_dev_p
 = 
NULL
;

1606 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ao devi whrivdsize=%d!\n", 
ivDaSize
));

1607 #i
LINUX_VERSION_CODE
 <= 0x20402

1608 *
w_dev_p
 = 
	`loc_tdev
(
ivDaSize
, "h%d", 
h_tup
);

1610 *
w_dev_p
 = 
	`loc_hdev
(
ivDaSize
);

1613 i(*
w_dev_p
)

1614  
NDIS_STATUS_SUCCESS
;

1616  
NDIS_STATUS_FAILURE
;

1617 
	}
}

1619 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,31)

1620 
INT
 
	$RtmpOSNDevOpsAoc
(

1621 
IN
 
PVOID
 *
pNDevOps
)

1623 *
pNDevOps
 = (
PVOID
)
	`vmloc
((
t_devi_s
));

1624 i(*
pNDevOps
)

1626 
	`NdisZoMemy
(*
pNDevOps
,(
t_devi_s
));

1627  
NDIS_STATUS_SUCCESS
;

1631  
NDIS_STATUS_FAILURE
;

1633 
	}
}

1635 
PNET_DEV
 
	$RtmpOSNDevGByName
(
PNET_DEV
 
pNDev
, 
PSTRING
 
pDevName
)

1637 
PNET_DEV
 
pTgNDev
 = 
NULL
;

1640 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

1642 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,24)

1643 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,26)

1644 
pTgNDev
 = 
	`dev_g_by_me
(
	`dev_t
(
pNDev
), 
pDevName
);

1646 
	`ASSERT
(
pNDev
);

1647 
pTgNDev
 = 
	`dev_g_by_me
(
pNDev
->
nd_t
, 
pDevName
);

1650 
pTgNDev
 = 
	`dev_g_by_me
(
pDevName
);

1654 
devNameL
;

1656 
devNameL
 = 
	`
(
pDevName
);

1657 
	`ASSERT
((
devNameL
 <
IFNAMSIZ
));

1659 
pTgNDev
=
dev_ba
;TgNDev!=
NULL
;TgNDevTgNDev->
xt
)

1661 i(
	`cmp
(
pTgNDev
->
me
, 
pDevName
, 
devNameL
) == 0)

1666  
pTgNDev
;

1667 
	}
}

1670 
	$RtmpOSNDeviRefPut
(
PNET_DEV
 
pNDev
)

1672 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

1678 if(
pNDev
)

1679 
	`dev_put
(
pNDev
);

1681 
	}
}

1684 
INT
 
	$RtmpOSNDevDey
(

1685 
IN
 
RTMP_ADAPTER
 *
pAd
,

1686 
IN
 
PNET_DEV
 
pNDev
)

1690 
	`tk
("WARNING: Thifuni(%sn imemy!!!\n", 
__FUNCTION__
);

1692 
	}
}

1695 
	$RtmpOSNDevDach
(
PNET_DEV
 
pNDev
)

1697 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,31)

1698 
t_devi_s
 *
pNDevOps
 = 
pNDev
->
tdev_s
;

1701 
	`uegi_tdev
(
pNDev
);

1703 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,31)

1704 
	`v
(
pNDevOps
);

1706 
	}
}

1709 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,18)

1710 
	$RALINK_ET_DrvInfoG
(

1711 
IN
 
t_devi
 *
pDev
,

1712 
IN
 
hto_drvfo
 *
pInfo
)

1714 
	`ry
(
pInfo
->
driv
, "RALINK WLAN");

1716 #ifde
CONFIG_STA_SUPPORT


1717 
	`ry
(
pInfo
->
vsi
, 
STA_DRIVER_VERSION
);

1720 
	`rtf
(
pInfo
->
bus_fo
, "CSR 0x%lx", 
pDev
->
ba_addr
);

1721 
	}
}

1723 
hto_s
 
	gRALINK_Ethto_Ops
 = {

1724 .
g_drvfo
 = 
RALINK_ET_DrvInfoG
,

1728 
	$RtmpOSNDevAach
(

1729 
IN
 
PNET_DEV
 
pNDev
,

1730 
IN
 
RTMP_OS_NETDEV_OP_HOOK
 *
pDevOpHook
)

1732 
t
, 
_locked
 = 
FALSE
;

1734 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,31)

1735 
t_devi_s
 *
pNDevOps
 = 
pNDev
->
tdev_s
;

1738 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RtmpOSNetDevAttach()--->\n"));

1741 i(
pDevOpHook
)

1743 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1745 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
pNDev
);

1747 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,31)

1748 
pNDevOps
->
ndo_ݒ
 = 
pDevOpHook
->
ݒ
;

1749 
pNDevOps
->
ndo_
 = 
pDevOpHook
->

;

1750 
pNDevOps
->
ndo_t_xm
 = (
HARD_START_XMIT_FUNC
)(
pDevOpHook
->
xm
);

1751 
pNDevOps
->
ndo_do_iol
 = 
pDevOpHook
->
iol
;

1753 
pNDev
->
ݒ
 = 
pDevOpHook
->open;

1754 
pNDev
->

 = 
pDevOpHook
->stop;

1755 
pNDev
->
hd_t_xm
 = (
HARD_START_XMIT_FUNC
)(
pDevOpHook
->
xm
);

1756 
pNDev
->
do_iol
 = 
pDevOpHook
->
iol
;

1759 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,18)

1760 
pNDev
->
hto_s
 = &
RALINK_Ethto_Ops
;

1766 i(
pDevOpHook
->
g_s
)

1767 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,31)

1768 
pNDevOps
->
ndo_g_s
 = 
pDevOpHook
->
g_s
;

1770 
pNDev
->
g_s
 = 
pDevOpHook
->get_stats;

1774 
pNDev
->
iv_ags
 = 
pDevOpHook
->priv_flags;

1776 #i(
WIRELESS_EXT
 < 21) && (WIRELESS_EXT >= 12)

1778 
pNDev
->
g_wess_s
 = 
pDevOpHook
->
g_ws
;

1781 #ifde
CONFIG_STA_SUPPORT


1782 #i
WIRELESS_EXT
 >= 12

1783 i(
pAd
->
OpMode
 =
OPMODE_STA
)

1786 
pNDev
->
wess_hdrs
 = 
pDevOpHook
->
iw_hdr
;

1791 #ifde
CONFIG_APSTA_MIXED_SUPPORT


1792 #i
WIRELESS_EXT
 >= 12

1793 i(
pAd
->
OpMode
 =
OPMODE_AP
)

1796 
pNDev
->
wess_hdrs
 = 
pDevOpHook
->
iw_hdr
;

1802 
	`NdisMoveMemy
(
pNDev
->
dev_addr
, &
pDevOpHook
->
devAddr
[0], 
MAC_ADDR_LEN
);

1804 
_locked
 = 
pDevOpHook
->
edPred
;

1806 #ifde
RT_CFG80211_SUPPORT


1813 
	`RT_CFG80211_REGISTER
(
pAd
,Ad->
pCfgDev
, 
pNDev
);

1817 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,24)

1818 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,31)

1819 
pNDevOps
->
ndo_vide_addr
 = 
NULL
;

1822 
pNDev
->
vide_addr
 = 
NULL
;

1826 i(
_locked
)

1827 
t
 = 
	`gi_tdevi
(
pNDev
);

1829 
t
 = 
	`gi_tdev
(
pNDev
);

1831 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<---RtmpOSNDevAach(),=%d\n", 
t
));

1832 i(
t
 == 0)

1833  
NDIS_STATUS_SUCCESS
;

1835  
NDIS_STATUS_FAILURE
;

1836 
	}
}

1839 
PNET_DEV
 
	$RtmpOSNDevCe
(

1840 
IN
 
RTMP_ADAPTER
 *
pAd
,

1841 
IN
 
INT
 
devTy
,

1842 
IN
 
INT
 
devNum
,

1843 
IN
 
INT
 
ivMemSize
,

1844 
IN
 
PSTRING
 
pNamePfix
)

1846 
t_devi
 *
pNDev
 = 
NULL
;

1847 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,31)

1848 
t_devi_s
 *
pNDevOps
 = 
NULL
;

1850 
us
;

1854 
us
 = 
	`RtmpOSNDevAoc
(&
pNDev
, 0 );

1855 i(
us
 !
NDIS_STATUS_SUCCESS
)

1858 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Aowk devi fa (%s)...\n", 
pNamePfix
));

1859  
NULL
;

1861 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,31)

1862 
us
 = 
	`RtmpOSNDevOpsAoc
((
PVOID
)&
pNDevOps
);

1863 i(
us
 !
NDIS_STATUS_SUCCESS
)

1866 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Allocateet device ops fail!\n"));

1867 
	`RtmpOSNDevFe
(
pNDev
);

1869  
NULL
;

1873 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Allocateet device ops success!\n"));

1874 
pNDev
->
tdev_s
 = 
pNDevOps
;

1878 
us
 = 
	`RtmpOSNDevRequeName
(
pAd
, 
pNDev
, 
pNamePfix
, 
devNum
);

1879 i(
us
 !
NDIS_STATUS_SUCCESS
)

1882 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Assigram(%wh suffix 0~32ed...\n", 
pNamePfix
));

1883 
	`RtmpOSNDevFe
(
pNDev
);

1885  
NULL
;

1889 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Thmothw %r i%s...\n", 
pNamePfix
, 
pNDev
->
me
));

1892  
pNDev
;

1893 
	}
}

1898 
PNET_DEV
 
	$g_tdev_om_bssid
(

1899 
IN
 
PRTMP_ADAPTER
 
pAd
,

1900 
IN
 
UCHAR
 
FromWhichBSSID
)

1902 
PNET_DEV
 
dev_p
 = 
NULL
;

1906 #ifde
CONFIG_STA_SUPPORT


1907 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

1909 
dev_p
 = 
pAd
->
t_dev
;

1913 
	`ASSERT
(
dev_p
);

1914  
dev_p
;

1915 
	}
}

1935 
NDIS_STATUS
 
	$AdrBlockAoMemy
(

1936 
IN
 
PVOID
 
hd
,

1937 
OUT
 
PVOID
 *
Ad
)

1939 #ifde
WORKQUEUE_BH


1940 
POS_COOKIE
 
cook
;

1944 *
Ad
 = (
PVOID
)
	`vmloc
((
RTMP_ADAPTER
));

1946 i(*
Ad
)

1948 
	`NdisZoMemy
(*
Ad
, (
RTMP_ADAPTER
));

1949 ((
PRTMP_ADAPTER
)*
Ad
)->
OS_Cook
 = 
hd
;

1950 #ifde
WORKQUEUE_BH


1951 
cook
 = (
POS_COOKIE
)(((
PRTMP_ADAPTER
)*
Ad
)->
OS_Cook
);

1952 
cook
->
pAd_va
 = *
Ad
;

1955  (
NDIS_STATUS_SUCCESS
);

1957  (
NDIS_STATUS_FAILURE
);

1959 
	}
}

1963 #ifde
OS_ABL_SUPPORT


1965 
EXPORT_SYMBOL
(
RTDebugLev
);

1967 
EXPORT_SYMBOL
(
RtmpOSTaskNifyToEx
);

1969 
EXPORT_SYMBOL
(
RTMPFeNdisPack
);

1970 
EXPORT_SYMBOL
(
AdrBlockAoMemy
);

1971 
EXPORT_SYMBOL
(
RTMP_IndiMedS
);

1973 
EXPORT_SYMBOL
(
RTMP_SPiodicTim
);

1974 
EXPORT_SYMBOL
(
RTMP_OS_Add_Tim
);

1975 
EXPORT_SYMBOL
(
RTMP_OS_Mod_Tim
);

1976 
EXPORT_SYMBOL
(
RTMP_OS_D_Tim
);

1977 
EXPORT_SYMBOL
(
RTMP_OS_In_Tim
);

1979 
EXPORT_SYMBOL
(
os_loc_mem
);

1980 
EXPORT_SYMBOL
(
os__mem
);

1982 
EXPORT_SYMBOL
(
RTMPL2FmeTxAi
);

1983 
EXPORT_SYMBOL
(
ExndPack
);

1984 
EXPORT_SYMBOL
(
ClePack
);

1985 
EXPORT_SYMBOL
(
RTMP_AoFgPackBufr
);

1986 
EXPORT_SYMBOL
(
noun_802_3_ck
);

1987 
EXPORT_SYMBOL
(
Sniff2BysFromNdisBufr
);

1988 
EXPORT_SYMBOL
(
RtmpOSNPktAoc
);

1989 
EXPORT_SYMBOL
(
dui_pkt
);

1990 
EXPORT_SYMBOL
(
dui_pkt_wh_TKIP_MIC
);

1991 
EXPORT_SYMBOL
(
DuiPack
);

1992 
EXPORT_SYMBOL
(
wn_802_11_to_802_3_ck
);

1993 
EXPORT_SYMBOL
(
RTMPAoNdisPack
);

1994 
EXPORT_SYMBOL
(
upde_os_ck_fo
);

1995 
EXPORT_SYMBOL
(
RTMP_QuyPackInfo
);

1997 
EXPORT_SYMBOL
(
RtmpOSNDevCe
);

1998 
EXPORT_SYMBOL
(
RtmpOSNDevAddrS
);

1999 
EXPORT_SYMBOL
(
RtmpOSNDevClo
);

2000 
EXPORT_SYMBOL
(
RtmpOSNDevAach
);

2001 
EXPORT_SYMBOL
(
RtmpOSNDevDach
);

2002 
EXPORT_SYMBOL
(
RtmpOSNDevFe
);

2004 
EXPORT_SYMBOL
(
RtmpOSFeOn
);

2005 
EXPORT_SYMBOL
(
RtmpOSFSInfoChge
);

2006 
EXPORT_SYMBOL
(
RtmpOSFeWre
);

2007 
EXPORT_SYMBOL
(
RtmpOSFeRd
);

2008 
EXPORT_SYMBOL
(
RtmpOSFeClo
);

2009 
EXPORT_SYMBOL
(
RtmpOSFeSk
);

2011 
EXPORT_SYMBOL
(
RtmpOSTaskIn
);

2012 
EXPORT_SYMBOL
(
RtmpOSTaskAach
);

2013 
EXPORT_SYMBOL
(
RtmpOSTaskCuomize
);

2014 
EXPORT_SYMBOL
(
RtmpOSTaskKl
);

2016 
EXPORT_SYMBOL
(
g_tdev_om_bssid
);

2017 
EXPORT_SYMBOL
(
hex_dump
);

2018 
EXPORT_SYMBOL
(
RTMPFeAdr
);

2019 
EXPORT_SYMBOL
(
RTMP_GCutSyemTime
);

2020 #ifde
SYSTEM_LOG_SUPPORT


2021 
EXPORT_SYMBOL
(
RTMPSdWessEvt
);

2023 
EXPORT_SYMBOL
(
RTMPucDay
);

2024 
EXPORT_SYMBOL
(
RtmpOSWrssEvtSd
);

2027 #ifde
CONFIG_STA_SUPPORT


2028 
EXPORT_SYMBOL
(
lk
);

2029 
EXPORT_SYMBOL
(
RT_ReSize
);

2030 
EXPORT_SYMBOL
(
nd_mڙ_cks
);

2033 #ifde
RTMP_MAC_PCI


2034 
EXPORT_SYMBOL
(
RTMP_AoMgmtDescMemy
);

2035 
EXPORT_SYMBOL
(
RTMP_AoRxPackBufr
);

2036 
EXPORT_SYMBOL
(
RTMP_FeDescMemy
);

2037 
EXPORT_SYMBOL
(
RTMP_AoTxDescMemy
);

2038 
EXPORT_SYMBOL
(
lux_pci_unm_sg
);

2039 
EXPORT_SYMBOL
(
RTMP_AoFTxBufr
);

2040 
EXPORT_SYMBOL
(
lux_pci_m_sg
);

2041 
EXPORT_SYMBOL
(
RTMP_AoRxDescMemy
);

2042 
EXPORT_SYMBOL
(
RTMP_FeFTxBufr
);

2043 #ifde
CONFIG_STA_SUPPORT


2044 #ifde
PCIE_PS_SUPPORT


2045 
EXPORT_SYMBOL
(
RTMPPCIeLkClVueRee
);

2046 
EXPORT_SYMBOL
(
RTMPPCIeLkClStg
);

	@os/linux/rt_main_dev.c

38 
	~"_cfig.h
"

41 #ifde
CONFIG_APSTA_MIXED_SUPPORT


42 
UINT32
 
	gCW_MAX_IN_BITS
;

49 
PSTRING
 
	gmac
 = "";

50 
PSTRING
 
	ghome
 = "";

51 #i
LINUX_VERSION_CODE
 <
KERNEL_VERSION
(2,6,12)

52 
MODULE_PARM
 (
mac
, "s");

54 
modu_m
 (
mac
, 
chp
, 0);

56 
MODULE_PARM_DESC
 (
mac
, "rt28xx: wireless macddr");

58 #ifde
OS_ABL_SUPPORT


60 
UCHAR
 
	gZERO_MAC_ADDR
[
MAC_ADDR_LEN
] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

69 
28xx_o
(
IN
 
t_devi
 *
t_dev
);

70 
28xx_ݒ
(
t_devi
 *
t_dev
);

73 
INT
 
28xx_nd_cks
(
IN
 
sk_buff
 *
skb_p
, IN 
t_devi
 *
t_dev
);

78 
t_devi_s
 *
RT28xx_g_h_s
(

79 
IN
 
t_devi
 *
t_dev
);

101 
	$MaVtuIF_o
(
IN
 
t_devi
 *
t_dev
)

103 
RTMP_ADAPTER
 *
pAd
 = 
NULL
;

105 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

108 i(
pAd
 =
NULL
)

111 
	`tif_r_off
(
pAd
->
t_dev
);

112 
	`tif__queue
(
pAd
->
t_dev
);

117 #ifde
CONFIG_STA_SUPPORT


118 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

120 
BOOLEAN
 
Ced
;

121 #ifde
QOS_DLS_SUPPORT


123 i(
pAd
->
CommCfg
.
bDLSCab
)

125 
UCHAR
 
i
;

128 
i
=0; i<
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

130 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
))

132 
	`RTMPSdDLSTrDownFme
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
);

133 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

134 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

139 
i
=
MAX_NUM_OF_INIT_DLS_ENTRY
; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

141 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
))

143 
	`RTMPSdDLSTrDownFme
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
);

144 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

145 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

148 
	`RTMP_MLME_HANDLER
(
pAd
);

152 i(
	`INFRA_ON
(
pAd
) &&

153 (!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_NIC_NOT_EXIST
)))

155 
MLME_DISASSOC_REQ_STRUCT
 
DisReq
;

156 
MLME_QUEUE_ELEM
 *
MsgEm
 = (MLME_QUEUE_ELEM *
	`kmloc
((MLME_QUEUE_ELEM), 
MEM_ALLOC_FLAG
);

158 i(
MsgEm
)

160 
	`COPY_MAC_ADDR
(
DisReq
.
Addr
, 
pAd
->
CommCfg
.
Bssid
);

161 
DisReq
.
Rs
 = 
REASON_DEAUTH_STA_LEAVING
;

163 
MsgEm
->
Mache
 = 
ASSOC_STATE_MACHINE
;

164 
MsgEm
->
MsgTy
 = 
MT2_MLME_DISASSOC_REQ
;

165 
MsgEm
->
MsgL
 = (
MLME_DISASSOC_REQ_STRUCT
);

166 
	`NdisMoveMemy
(
MsgEm
->
Msg
, &
DisReq
, (
MLME_DISASSOC_REQ_STRUCT
));

169 
pAd
->
MlmeAux
.
AutoRecSsidL
= 32;

170 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
AutoRecSsidL
);

172 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_DISASSOC
;

173 
	`MlmeDissocReqAi
(
pAd
, 
MsgEm
);

174 
	`k
(
MsgEm
);

177 
	`RTMPucDay
(1000);

180 #ifde
WPA_SUPPLICANT_SUPPORT


181 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


183 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, 
RT_INTERFACE_DOWN
, 
NULL
, NULL, 0);

186 i(
pAd
->
SCfg
.
pWpsProbeReqIe
)

188 
	`k
(
pAd
->
SCfg
.
pWpsProbeReqIe
);

189 
pAd
->
SCfg
.
pWpsProbeReqIe
 = 
NULL
;

190 
pAd
->
SCfg
.
WpsProbeReqIeL
 = 0;

193 i(
pAd
->
SCfg
.
pWAssocIe
)

195 
	`k
(
pAd
->
SCfg
.
pWAssocIe
);

196 
pAd
->
SCfg
.
pWAssocIe
 = 
NULL
;

197 
pAd
->
SCfg
.
WAssocIeL
 = 0;

205 
	`VIRTUAL_IF_DOWN
(
pAd
);

207 
	`RT_MOD_DEC_USE_COUNT
();

210 
	}
}

232 
	$MaVtuIF_ݒ
(
IN
 
t_devi
 *
t_dev
)

234 
RTMP_ADAPTER
 *
pAd
 = 
NULL
;

236 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

239 i(
pAd
 =
NULL
)

242 i(
	`VIRTUAL_IF_UP
(
pAd
) != 0)

246 
	`RT_MOD_INC_USE_COUNT
();

248 
	`tif_t_queue
(
t_dev
);

249 
	`tif_r_
(
t_dev
);

250 
	`tif_wake_queue
(
t_dev
);

253 
	}
}

275 
	$28xx_o
(
IN
 
PNET_DEV
 
dev
)

277 
t_devi
 * 
t_dev
 = (t_devi *)
dev
;

278 
RTMP_ADAPTER
 *
pAd
 = 
NULL
;

279 
BOOLEAN
 
Ced
;

280 
UINT32
 
i
 = 0;

282 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

284 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>t28xx_close\n"));

287 
Ced
 = 
FALSE
;

289 i(
pAd
 =
NULL
)

293 #ifde
CONFIG_STA_SUPPORT


294 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

296 #ifde
PCIE_PS_SUPPORT


297 
	`RTMPPCIeLkClVueRee
(
pAd
, 
RESTORE_CLOSE
);

302 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

304 
	`AsicFWakeup
(
pAd
, 
TRUE
);

308 #ifde
RTMP_MAC_PCI


309 
pAd
->
bPCIkOff
 = 
FALSE
;

314 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
);

318 #ifde
WDS_SUPPORT


319 
	`WdsDown
(
pAd
);

322 
i
 = 0 ; i < 
NUM_OF_TX_RING
; i++)

324 
pAd
->
DeQueueRug
[
i
] =
TRUE
)

326 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Wag f TxQueue[%d] de..........\n", 
i
));

327 
	`RTMPucDay
(1000);

334 
	`MlmeHt
(
pAd
);

337 
	`RtmpNTaskEx
(
pAd
);

340 #ifde
CONFIG_STA_SUPPORT


341 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

343 
	`MacTabRet
(
pAd
);

344 #ifde
LED_CONTROL_SUPPORT


345 
	`RTMPSLED
(
pAd
, 
LED_LINK_DOWN
);

347 
	`MlmeRadioOff
(
pAd
);

352 
	`MsuReqTabEx
(
pAd
);

353 
	`TpcReqTabEx
(
pAd
);

357 
	`RtmpMgmtTaskEx
(
pAd
);

359 #ifde
RTMP_MAC_PCI


361 
BOOLEAN
 
brc
;

364 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_ACTIVE
))

366 
	`RTMP_ASIC_INTERRUPT_DISABLE
(
pAd
);

375 
brc
=
	`RT28xxPciAsicRadioOff
(
pAd
, 
RTMP_HALT
, 0);

378 #ifde
PCIE_PS_SUPPORT


379 
pAd
->
bPCIkOff
 = 
FALSE
;

382 i(
brc
==
FALSE
)

384 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("% RT28xxPciAsicRadioOf !!\n", 
__FUNCTION__
));

401 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

403 #ifde
RTMP_MAC_PCI


405 
	`RtmpOSIRQR
(
t_dev
);

407 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
);

410 #ifde
RESOURCE_PRE_ALLOC


411 
	`RTMPRetTxRxRgMemy
(
pAd
);

414 
	`RTMPFeTxRxRgMemy
(
pAd
);

417 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
);

419 #ifde
DOT11_N_SUPPORT


421 
	`ba_dg_sour_a
(
pAd
);

424 #ifde
CONFIG_STA_SUPPORT


427 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_START_UP
);

430 #ifde
CONFIG_STA_SUPPORT


431 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

436 #ifde
VENDOR_FEATURE2_SUPPORT


437 
	`tk
("Numb oPack Aod = %d\n", 
pAd
->
NumOfPktAoc
);

438 
	`tk
("Numb oPack Fed = %d\n", 
pAd
->
NumOfPktFe
);

441 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<===t28xx_close\n"));

443 
	}
}

461 
	$28xx_ݒ
(
IN
 
PNET_DEV
 
dev
)

463 
t_devi
 * 
t_dev
 = (t_devi *)
dev
;

464 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

465 
tv
 = 0;

468 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

471 i(
pAd
 =
NULL
)

478 #ifde
CONFIG_APSTA_MIXED_SUPPORT


479 i(
pAd
->
OpMode
 =
OPMODE_AP
)

481 
CW_MAX_IN_BITS
 = 6;

483 i(
pAd
->
OpMode
 =
OPMODE_STA
)

485 
CW_MAX_IN_BITS
 = 10;

489 #i
WIRELESS_EXT
 >= 12

490 i(
t_dev
->
iv_ags
 =
INT_MAIN
)

492 #ifde
CONFIG_APSTA_MIXED_SUPPORT


493 i(
pAd
->
OpMode
 =
OPMODE_AP
)

494 
t_dev
->
wess_hdrs
 = (
iw_hdr_def
 *&
28xx__iw_hdr_def
;

496 #ifde
CONFIG_STA_SUPPORT


497 i(
pAd
->
OpMode
 =
OPMODE_STA
)

498 
t_dev
->
wess_hdrs
 = (
iw_hdr_def
 *&
28xx_iw_hdr_def
;

509 
	`RtmpOSIRQReque
(
t_dev
);

512 
	`RTMP_IRQ_INIT
(
pAd
);

515 i(
	`28xx_
(
pAd
, 
mac
, 
home
=
FALSE
)

516 
r
;

518 #ifde
LINUX


519 #ifde
RT_CFG80211_SUPPORT


520 
	`RT_CFG80211_REINIT
(
pAd
);

521 
	`RT_CFG80211_CRDA_REG_RULE_APPLY
(
pAd
);

525 #ifde
CONFIG_STA_SUPPORT


529 
	`RTMP_IRQ_ENABLE
(
pAd
);

532 
	`RTMPEbRxTx
(
pAd
);

533 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_START_UP
);

536 
UINT32
 
g
 = 0;

537 
	`RTMP_IO_READ32
(
pAd
, 0x1300, &
g
);

538 
	`tk
("0x1300 = %08x\n", 
g
);

555 #ifde
CONFIG_STA_SUPPORT


556 #ifde
PCIE_PS_SUPPORT


557 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

558 
	`RTMPInPCIeLkClVue
(
pAd
);

566 #ifde
CONFIG_STA_SUPPORT


571 i(
pAd
->
OpMode
 =
OPMODE_STA
)

572 
	`MlmeAutoRecLaSSID
(
pAd
);

575 #ifde
VENDOR_FEATURE2_SUPPORT


576 
	`tk
("Numb oPack Aod iݒ = %d\n", 
pAd
->
NumOfPktAoc
);

577 
	`tk
("Numb oPack Fed iݒ = %d\n", 
pAd
->
NumOfPktFe
);

580  (
tv
);

582 
r
:

584 
	`RtmpOSIRQR
(
t_dev
);

588 
	}
}

591 
PNET_DEV
 
	$RtmpPhyNDevIn
(

592 
IN
 
RTMP_ADAPTER
 *
pAd
,

593 
IN
 
RTMP_OS_NETDEV_OP_HOOK
 *
pNDevHook
)

595 
t_devi
 *
t_dev
 = 
NULL
;

598 
t_dev
 = 
	`RtmpOSNDevCe
(
pAd
, 
INT_MAIN
, 0, (
PRTMP_ADAPTER
), 
INF_MAIN_DEV_NAME
);

599 i(
t_dev
 =
NULL
)

601 
	`tk
("RtmpPhyNetDevInit(): creation failed for mainhysicalet device!\n");

602  
NULL
;

605 
	`NdisZoMemy
((*)
pNDevHook
, (
RTMP_OS_NETDEV_OP_HOOK
));

606 
pNDevHook
->
ݒ
 = 
MaVtuIF_ݒ
;

607 
pNDevHook
->

 = 
MaVtuIF_o
;

608 
pNDevHook
->
xm
 = 
28xx_nd_cks
;

609 #ifde
IKANOS_VX_1X0


610 
pNDevHook
->
xm
 = 
IKANOS_DaFmesTx
;

612 
pNDevHook
->
iol
 = 
28xx_iol
;

613 
pNDevHook
->
iv_ags
 = 
INT_MAIN
;

614 
pNDevHook
->
g_s
 = 
RT28xx_g_h_s
;

616 
pNDevHook
->
edPred
 = 
FALSE
;

618 #i(
WIRELESS_EXT
 < 21) && (WIRELESS_EXT >= 12)

619 
pNDevHook
->
g_ws
 = 
28xx_g_wess_s
;

622 #ifde
CONFIG_STA_SUPPORT


623 #i
WIRELESS_EXT
 >= 12

624 i(
pAd
->
OpMode
 =
OPMODE_STA
)

626 
pNDevHook
->
iw_hdr
 = (*)&
28xx_iw_hdr_def
;

631 #ifde
CONFIG_APSTA_MIXED_SUPPORT


632 #i
WIRELESS_EXT
 >= 12

633 i(
pAd
->
OpMode
 =
OPMODE_AP
)

635 
pNDevHook
->
iw_hdr
 = &
28xx__iw_hdr_def
;

640 
	`RTMP_OS_NETDEV_SET_PRIV
(
t_dev
, 
pAd
);

641 
pAd
->
t_dev
 =et_dev;

645 #i
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,24)

646 
	`SET_MODULE_OWNER
(
t_dev
);

649 
	`tif__queue
(
t_dev
);

651  
t_dev
;

653 
	}
}

673 
	$28xx_ck_xm
(
sk_buff
 *
skb
)

675 
t_devi
 *
t_dev
 = 
skb
->
dev
;

676 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

677 
us
 = 0;

678 
PNDIS_PACKET
 
pPack
 = (PNDIS_PACKET
skb
;

680 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

683 #ifde
RALINK_ATE


684 i(
	`ATE_ON
(
pAd
))

686 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_RESOURCES
);

691 #ifde
CONFIG_STA_SUPPORT


692 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

695 i(
	`MONITOR_ON
(
pAd
))

697 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

698 
de
;

704 i(
skb
->
n
 < 14)

707 
	`hex_dump
("badack", 
skb
->
da
, skb->
n
);

708 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

709 
de
;

714 
	`RTMP_SET_PACKET_5VT
(
pPack
, 0);

716 #ifde
CONFIG_5VT_ENHANCE


717 i(*(*)(
skb
->
cb
=
BRIDGE_TAG
) {

718 
	`RTMP_SET_PACKET_5VT
(
pPack
, 1);

724 #ifde
CONFIG_STA_SUPPORT


725 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

728 
	`STASdPacks
((
NDIS_HANDLE
)
pAd
, (
PPNDIS_PACKET
&
pPack
, 1);

733 
us
 = 0;

734 
de
:

736  
us
;

737 
	}
}

756 
	$28xx_nd_cks
(

757 
IN
 
sk_buff
 *
skb_p
,

758 
IN
 
t_devi
 *
t_dev
)

760 
RTMP_ADAPTER
 *
pAd
 = 
NULL
;

762 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

764 i(!(
	`RTMP_OS_NETDEV_STATE_RUNNING
(
t_dev
)))

766 
	`RELEASE_NDIS_PACKET
(
pAd
, (
PNDIS_PACKET
)
skb_p
, 
NDIS_STATUS_FAILURE
);

770 
	`NdisZoMemy
((
PUCHAR
)&
skb_p
->
cb
[
CB_OFF
], 15);

771 
	`RTMP_SET_PACKET_NET_DEVICE_MBSSID
(
skb_p
, 
MAIN_MBSSID
);

773 
	`MEM_DBG_PKT_ALLOC_INC
(
pAd
);

775  
	`28xx_ck_xm
(
skb_p
);

776 
	}
}

779 #i
WIRELESS_EXT
 >= 12

781 
iw_iics
 *
	$28xx_g_wess_s
(

782 
IN
 
t_devi
 *
t_dev
)

784 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

786 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

789 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("rt28xx_get_wireless_stats --->\n"));

792 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

793  
NULL
;

795 
pAd
->
iw_s
.
us
 = 0;

798 #ifde
CONFIG_STA_SUPPORT


799 i(
pAd
->
OpMode
 =
OPMODE_STA
)

800 
pAd
->
iw_s
.
qu
.qu = (Ad->
Mlme
.
ChlQuy
 * 12)/10 + 10);

803 if(
pAd
->
iw_s
.
qu
.qual > 100)

804 
pAd
->
iw_s
.
qu
.qual = 100;

806 #ifde
CONFIG_STA_SUPPORT


807 i(
pAd
->
OpMode
 =
OPMODE_STA
)

809 
pAd
->
iw_s
.
qu
.
v
 =

810 
	`RTMPMaxRssi
(
pAd
,Ad->
SCfg
.
RssiSame
.
AvgRssi0
,

811 
pAd
->
SCfg
.
RssiSame
.
AvgRssi1
,

812 
pAd
->
SCfg
.
RssiSame
.
AvgRssi2
);

816 #ifde
CONFIG_STA_SUPPORT


817 
pAd
->
iw_s
.
qu
.
noi
 = 
	`RTMPMaxRssi
Ad,Ad->
SCfg
.
RssiSame
.
AvgRssi0
,

818 
pAd
->
SCfg
.
RssiSame
.
AvgRssi1
,

819 
pAd
->
SCfg
.
RssiSame
.
AvgRssi2
) -

820 
	`RTMPMS
(
pAd
,Ad->
SCfg
.
RssiSame
.
AvgS0
,

821 
pAd
->
SCfg
.
RssiSame
.
AvgS1
);

824 
pAd
->
iw_s
.
qu
.
upded
 = 1;

825 #ifde
IW_QUAL_DBM


826 
pAd
->
iw_s
.
qu
.
upded
 |
IW_QUAL_DBM
;

829 
pAd
->
iw_s
.
disrd
.
nwid
 = 0;

830 
pAd
->
iw_s
.
miss
.
bc
 = 0;

832 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<---t28xx_get_wireless_stats\n"));

833  &
pAd
->
iw_s
;

834 
	}
}

838 #ifde
WORKQUEUE_BH


839 
	$tb_wkq
(
wk_ru
 *
wk
)

841 
	$tb_skt
(
da
)

846 
	}
}

848 
INT
 
	$28xx_iol
(

849 
IN
 
PNET_DEV
 
t_dev
,

850 
IN
 
OUT
 
ieq
 *
rq
,

851 
IN
 
INT
 
cmd
)

853 
RTMP_ADAPTER
 *
pAd
 = 
NULL
;

854 
INT
 
t
 = 0;

856 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

858 i(
pAd
 =
NULL
)

862  -
ENETDOWN
;

866 #ifde
CONFIG_STA_SUPPORT


867 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

869 
t
 = 
	`28xx_a_iol
(
t_dev
, 
rq
, 
cmd
);

873  
t
;

874 
	}
}

893 
t_devi_s
 *
	$RT28xx_g_h_s
(

894 
IN
 
t_devi
 *
t_dev
)

896 
RTMP_ADAPTER
 *
pAd
 = 
NULL
;

898 i(
t_dev
)

899 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

901 i(
pAd
)

904 
pAd
->
s
.
rx_cks
 =Ad->
WnCous
.
ReivedFgmtCou
.
QuadPt
;

905 
pAd
->
s
.
tx_cks
 =Ad->
WnCous
.
TnsmdFgmtCou
.
QuadPt
;

907 
pAd
->
s
.
rx_bys
 =Ad->
RkCous
.
ReivedByCou
;

908 
pAd
->
s
.
tx_bys
 =Ad->
RkCous
.
TnsmdByCou
;

910 
pAd
->
s
.
rx_rs
 =Ad->
Cous8023
.
RxEs
;

911 
pAd
->
s
.
tx_rs
 =Ad->
Cous8023
.
TxEs
;

913 
pAd
->
s
.
rx_drݳd
 = 0;

914 
pAd
->
s
.
tx_drݳd
 = 0;

916 
pAd
->
s
.
mui
 =Ad->
WnCous
.
MuiReivedFmeCou
.
QuadPt
;

917 
pAd
->
s
.
clisis
 =Ad->
Cous8023
.
OClisi
 +Ad->Cous8023.
MeClisis
;

919 
pAd
->
s
.
rx_ngth_rs
 = 0;

920 
pAd
->
s
.
rx_ov_rs
 =Ad->
Cous8023
.
RxNoBufr
;

921 
pAd
->
s
.
rx_c_rs
 = 0;

922 
pAd
->
s
.
rx_ame_rs
 =Ad->
Cous8023
.
RcvAlignmtEs
;

923 
pAd
->
s
.
rx_fifo_rs
 =Ad->
Cous8023
.
RxNoBufr
;

924 
pAd
->
s
.
rx_misd_rs
 = 0;

927 
pAd
->
s
.
tx_ab܋d_rs
 = 0;

928 
pAd
->
s
.
tx_r_rs
 = 0;

929 
pAd
->
s
.
tx_fifo_rs
 = 0;

930 
pAd
->
s
.
tx_hbt_rs
 = 0;

931 
pAd
->
s
.
tx_wdow_rs
 = 0;

934 
pAd
->
s
.
rx_comesd
 = 0;

935 
pAd
->
s
.
tx_comesd
 = 0;

937  &
pAd
->
s
;

940  
NULL
;

941 
	}
}

944 
BOOLEAN
 
	$RtmpPhyNDevEx
(

945 
IN
 
RTMP_ADAPTER
 *
pAd
,

946 
IN
 
PNET_DEV
 
t_dev
)

951 #ifde
INF_PPA_SUPPORT


952 i(
a_hook_deth_gi_dev_
 && 
pAd
->
PPAEb
==
TRUE
)

954 
UINT
 
us
;

955 
us
=
	`a_hook_deth_gi_dev_
(&
pAd
->
g_if_id
,Ad->
t_dev
, 
NULL
, 
PPA_F_DIRECTPATH_REGISTER
);

956 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("uegi PPA:g_if_id=%d stus=%d\n",
pAd
->
g_if_id
,
us
));

958 
	`k
(
pAd
->
pDethCb
);

962 i(
t_dev
 !
NULL
)

964 
	`tk
("RtmpOSNDevDach(): RtmpOSNDeviDach(), dev->me=%s!\n", 
t_dev
->
me
);

965 
	`RtmpOSNDevDach
(
t_dev
);

968  
TRUE
;

970 
	}
}

978 
	$RtmpOSIRQReque
(
IN
 
PNET_DEV
 
pNDev
)

980 #i
	`defed
(
RTMP_PCI_SUPPORT
|| defed(
RTMP_RBUS_SUPPORT
)

981 
t_devi
 *
t_dev
 = 
pNDev
;

984 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

985 
tv
 = 0;

987 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
pNDev
);

989 
	`ASSERT
(
pAd
);

991 #ifde
RTMP_PCI_SUPPORT


992 i(
pAd
->
fTy
 =
RTMP_DEV_INF_PCI
 ||Ad->fTy =
RTMP_DEV_INF_PCIE
)

994 
POS_COOKIE
 
_pObj
 = (POS_COOKIE)(
pAd
->
OS_Cook
);

995 
	`RTMP_MSI_ENABLE
(
pAd
);

996 
tv
 = 
	`que_q
(
_pObj
->
pci_dev
->
q
, 
2860_u
, 
SA_SHIRQ
, (
t_dev
)->
me
, (net_dev));

997 i(
tv
 != 0)

998 
	`tk
("RT2860:eque_q ERROR(%d)\n", 
tv
);

1003  
tv
;

1005 
	}
}

1008 
	$RtmpOSIRQR
(
IN
 
PNET_DEV
 
pNDev
)

1010 
t_devi
 *
t_dev
 = 
pNDev
;

1011 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1013 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

1015 
	`ASSERT
(
pAd
);

1017 #ifde
RTMP_PCI_SUPPORT


1018 i(
pAd
->
fTy
 =
RTMP_DEV_INF_PCI
 ||Ad->fTy =
RTMP_DEV_INF_PCIE
)

1020 
POS_COOKIE
 
pObj
 = (POS_COOKIE)(
pAd
->
OS_Cook
);

1021 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

1022 
	`synchrize_q
(
pObj
->
pci_dev
->
q
);

1024 
	`_q
(
pObj
->
pci_dev
->
q
, (
t_dev
));

1025 
	`RTMP_MSI_DISABLE
(
pAd
);

1031 
	}
}

	@os/linux/rt_pci_rbus.c

38 
	~<_cfig.h
>

39 
	~<lux/pci.h
>

42 
	gIRQ_HANDLE_TYPE


43 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,19))

44 
2860_u
(
q
, *
dev_
);

46 
2860_u
(
q
, *
dev_
, 
_gs
 *
gs
);

49 #ifde
WORKQUEUE_BH


50 
rx_de_wkq
(
wk_ru
 *
wk
);

51 
mgmt_dma_de_wkq
(
wk_ru
 *
wk
);

52 
ac0_dma_de_wkq
(
wk_ru
 *
wk
);

53 
ac1_dma_de_wkq
(
wk_ru
 *
wk
);

54 
ac2_dma_de_wkq
(
wk_ru
 *
wk
);

55 
ac3_dma_de_wkq
(
wk_ru
 *
wk
);

56 
hc_dma_de_wkq
(
wk_ru
 *
wk
);

57 
fifo_iic_fu_wkq
(
wk_ru
 *
wk
);

59 
rx_de_skt
(
da
);

60 
mgmt_dma_de_skt
(
da
);

61 
ac0_dma_de_skt
(
da
);

62 #ifde
RALINK_ATE


63 
e_ac0_dma_de_skt
(
da
);

65 
ac1_dma_de_skt
(
da
);

66 
ac2_dma_de_skt
(
da
);

67 
ac3_dma_de_skt
(
da
);

68 
hc_dma_de_skt
(
da
);

69 
fifo_iic_fu_skt
(
da
);

77 
	#RT2860_INT_RX_DLY
 (1<<0)

78 
	#RT2860_INT_TX_DLY
 (1<<1)

79 
	#RT2860_INT_RX_DONE
 (1<<2)

80 
	#RT2860_INT_AC0_DMA_DONE
 (1<<3)

81 
	#RT2860_INT_AC1_DMA_DONE
 (1<<4)

82 
	#RT2860_INT_AC2_DMA_DONE
 (1<<5)

83 
	#RT2860_INT_AC3_DMA_DONE
 (1<<6)

84 
	#RT2860_INT_HCCA_DMA_DONE
 (1<<7)

85 
	#RT2860_INT_MGMT_DONE
 (1<<8)

86 #i
	`defed
(
TONE_RADAR_DETECT_SUPPORT
|| defed(
DFS_INTERRUPT_SUPPORT
)

	)

87 
	#RT2860_INT_TONE_RADAR
 (1<<20)

89 

	)

90 
	#INT_RX
 
RT2860_INT_RX_DONE


	)

92 
	#INT_AC0_DLY
 (
RT2860_INT_AC0_DMA_DONE
)

93 
	#INT_AC1_DLY
 (
RT2860_INT_AC1_DMA_DONE
)

94 
	#INT_AC2_DLY
 (
RT2860_INT_AC2_DMA_DONE
)

95 
	#INT_AC3_DLY
 (
RT2860_INT_AC3_DMA_DONE
)

96 
	#INT_HCCA_DLY
 (
RT2860_INT_HCCA_DMA_DONE
)

97 
	#INT_MGMT_DLY
 
RT2860_INT_MGMT_DONE


	)

98 #i
defed
(
TONE_RADAR_DETECT_SUPPORT
|| defed(
DFS_INTERRUPT_SUPPORT
)

99 
	#INT_TONE_RADAR
 (
RT2860_INT_TONE_RADAR
)

	)

112 
VOID
 
	$Invid_Remag_Pack
(

113 
IN
 
PRTMP_ADAPTER
 
pAd
,

114 
IN
 
ULONG
 
VtuAddss
)

116 
NDIS_PHYSICAL_ADDRESS
 
PhysilAddss
;

118 
PhysilAddss
 = 
	`PCI_MAP_SINGLE
(
pAd
, (*)(
VtuAddss
+1600), 
RX_BUFFER_NORMSIZE
-1600, -1, 
PCI_DMA_FROMDEVICE
);

119 
	}
}

122 
NDIS_STATUS
 
	$RtmpNTaskIn
(
IN
 
RTMP_ADAPTER
 *
pAd
)

124 
POS_COOKIE
 
pObj
;

126 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

128 #ifde
WORKQUEUE_BH


129 
	`INIT_WORK
(&
pObj
->
rx_de_wk
, 
rx_de_wkq
);

130 
	`INIT_WORK
(&
pObj
->
mgmt_dma_de_wk
, 
mgmt_dma_de_wkq
);

131 
	`INIT_WORK
(&
pObj
->
ac0_dma_de_wk
, 
ac0_dma_de_wkq
);

132 
	`INIT_WORK
(&
pObj
->
ac1_dma_de_wk
, 
ac1_dma_de_wkq
);

133 
	`INIT_WORK
(&
pObj
->
ac2_dma_de_wk
, 
ac2_dma_de_wkq
);

134 
	`INIT_WORK
(&
pObj
->
ac3_dma_de_wk
, 
ac3_dma_de_wkq
);

135 
	`INIT_WORK
(&
pObj
->
hc_dma_de_wk
, 
hc_dma_de_wkq
);

136 
	`INIT_WORK
(&
pObj
->
tb_wk
, 
tb_wkq
);

137 
	`INIT_WORK
(&
pObj
->
fifo_iic_fu_wk
, 
fifo_iic_fu_wkq
);

139 
	`skt_
(&
pObj
->
rx_de_sk
, 
rx_de_skt
, ()
pAd
);

140 
	`skt_
(&
pObj
->
mgmt_dma_de_sk
, 
mgmt_dma_de_skt
, ()
pAd
);

141 
	`skt_
(&
pObj
->
ac0_dma_de_sk
, 
ac0_dma_de_skt
, ()
pAd
);

142 #ifde
RALINK_ATE


143 
	`skt_
(&
pObj
->
e_ac0_dma_de_sk
, 
e_ac0_dma_de_skt
, ()
pAd
);

145 
	`skt_
(&
pObj
->
ac1_dma_de_sk
, 
ac1_dma_de_skt
, ()
pAd
);

146 
	`skt_
(&
pObj
->
ac2_dma_de_sk
, 
ac2_dma_de_skt
, ()
pAd
);

147 
	`skt_
(&
pObj
->
ac3_dma_de_sk
, 
ac3_dma_de_skt
, ()
pAd
);

148 
	`skt_
(&
pObj
->
hc_dma_de_sk
, 
hc_dma_de_skt
, ()
pAd
);

149 
	`skt_
(&
pObj
->
tb_sk
, 
tb_skt
, ()
pAd
);

150 
	`skt_
(&
pObj
->
fifo_iic_fu_sk
, 
fifo_iic_fu_skt
, ()
pAd
);

153  
NDIS_STATUS_SUCCESS
;

154 
	}
}

157 
	$RtmpNTaskEx
(
IN
 
RTMP_ADAPTER
 *
pAd
)

159 
POS_COOKIE
 
pObj
;

161 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

163 #ide
WORKQUEUE_BH


164 
	`skt_kl
(&
pObj
->
rx_de_sk
);

165 
	`skt_kl
(&
pObj
->
mgmt_dma_de_sk
);

166 
	`skt_kl
(&
pObj
->
ac0_dma_de_sk
);

167 #ifde
RALINK_ATE


168 
	`skt_kl
(&
pObj
->
e_ac0_dma_de_sk
);

170 
	`skt_kl
(&
pObj
->
ac1_dma_de_sk
);

171 
	`skt_kl
(&
pObj
->
ac2_dma_de_sk
);

172 
	`skt_kl
(&
pObj
->
ac3_dma_de_sk
);

173 
	`skt_kl
(&
pObj
->
hc_dma_de_sk
);

174 
	`skt_kl
(&
pObj
->
tb_sk
);

175 
	`skt_kl
(&
pObj
->
fifo_iic_fu_sk
);

177 
	}
}

180 
NDIS_STATUS
 
	$RtmpMgmtTaskIn
(
IN
 
RTMP_ADAPTER
 *
pAd
)

182 
RTMP_OS_TASK
 *
pTask
;

183 
NDIS_STATUS
 
us
;

187 
pTask
 = &
pAd
->
cmdQTask
;

188 
	`RtmpOSTaskIn
(
pTask
, "RtmpCmdQTask", 
pAd
);

189 
us
 = 
	`RtmpOSTaskAach
(
pTask
, 
RTPCICmdThad
, (
ULONG
)pTask);

190 i(
us
 =
NDIS_STATUS_FAILURE
)

192 
	`tk
 (
KERN_WARNING
 "%s: ubˁءRTPCICmdThad\n", 
	`RTMP_OS_NETDEV_GET_DEVNAME
(
pAd
->
t_dev
));

193  
NDIS_STATUS_FAILURE
;

197  
NDIS_STATUS_SUCCESS
;

198 
	}
}

215 
VOID
 
	$RtmpMgmtTaskEx
(

216 
IN
 
RTMP_ADAPTER
 *
pAd
)

218 
INT
 
t
;

219 
RTMP_OS_TASK
 *
pTask
;

222 
pTask
 = &
pAd
->
cmdQTask
;

223 #ifde
KTHREAD_SUPPORT


224 i(
pTask
->
kthad_sk
)

226 
	`CHECK_PID_LEGALITY
(
pTask
->
skPID
)

229 
	`NdisAcqueSpLock
(&
pAd
->
CmdQLock
);

230 
pAd
->
CmdQ
.
CmdQS
 = 
RTMP_TASK_STAT_STOPED
;

231 
	`NdisRSpLock
(&
pAd
->
CmdQLock
);

234 
t
 = 
	`RtmpOSTaskKl
(
pTask
);

235 i(
t
 =
NDIS_STATUS_FAILURE
)

237 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: killask(%s) failed!\n",

238 
	`RTMP_OS_NETDEV_GET_DEVNAME
(
pAd
->
t_dev
), 
pTask
->
skName
));

240 
pAd
->
CmdQ
.
CmdQS
 = 
RTMP_TASK_STAT_UNKNOWN
;

245 
	}
}

248 
le
 
	$2860_t_ab
(
PRTMP_ADAPTER
 
pAd
, 
mode
)

250 
u32
 
gVue
;

252 
pAd
->
t_dib_mask
 &~(
mode
);

253 
gVue
 = 
pAd
->
t_ab_g
 & ~Ad->
t_dib_mask
);

256 
	`RTMP_IO_WRITE32
(
pAd
, 
INT_MASK_CSR
, 
gVue
);

261 i(
gVue
 != 0)

262 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_ACTIVE
);

263 
	}
}

266 
le
 
	$2860_t_dib
(
PRTMP_ADAPTER
 
pAd
, 
mode
)

268 
u32
 
gVue
;

270 
pAd
->
t_dib_mask
 |
mode
;

271 
gVue
 = 
pAd
->
t_ab_g
 & ~Ad->
t_dib_mask
);

272 
	`RTMP_IO_WRITE32
(
pAd
, 
INT_MASK_CSR
, 
gVue
);

274 i(
gVue
 == 0)

276 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_ACTIVE
);

278 
	}
}

286 #ifde
WORKQUEUE_BH


287 
	$mgmt_dma_de_wkq
(
wk_ru
 *
wk
)

289 
	$mgmt_dma_de_skt
(
da
)

292 
ags
;

293 
INT_SOURCE_CSR_STRUC
 
ISour
;

294 #ifde
WORKQUEUE_BH


295 
POS_COOKIE
 
pObj
 = 
	`cڏ_of
(
wk
, 
os_cook
, 
mgmt_dma_de_wk
);

296 
PRTMP_ADAPTER
 
pAd
 = 
pObj
->
pAd_va
;

298 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER
da
;

299 
POS_COOKIE
 
pObj
;

304 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

307 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

310 
ISour
.
wd
 = 0;

311 
ISour
.
fld
.
MgmtDmaDe
 = 1;

312 
pAd
->
t_ndg
 &~
INT_MGMT_DLY
;

314 
	`RTMPHdMgmtRgDmaDeIru
(
pAd
);

316 
	`RTMP_INT_LOCK
(&
pAd
->
q_lock
, 
ags
);

320 i(
pAd
->
t_ndg
 & 
INT_MGMT_DLY
)

322 #ifde
WORKQUEUE_BH


323 
	`schedu_wk
(&
pObj
->
mgmt_dma_de_wk
);

325 
	`skt_hi_schedu
(&
pObj
->
mgmt_dma_de_sk
);

327 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

332 
	`2860_t_ab
(
pAd
, 
INT_MGMT_DLY
);

333 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

334 
	}
}

337 #ifde
WORKQUEUE_BH


338 
	$rx_de_wkq
(
wk_ru
 *
wk
)

340 
	$rx_de_skt
(
da
)

343 
ags
;

344 
BOOLEAN
 
bReschedu
 = 0;

345 #ifde
WORKQUEUE_BH


346 
POS_COOKIE
 
pObj
 = 
	`cڏ_of
(
wk
, 
os_cook
, 
rx_de_wk
);

347 
PRTMP_ADAPTER
 
pAd
 = 
pObj
->
pAd_va
;

349 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER
da
;

350 
POS_COOKIE
 
pObj
;

355 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

358 #ifde
UAPSD_AP_SUPPORT


359 
	`UAPSD_TIMING_RECORD
(
pAd
, 
UAPSD_TIMING_RECORD_TASKLET
);

362 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

364 
pAd
->
t_ndg
 &~(
INT_RX
);

365 #ifde
CONFIG_STA_SUPPORT


366 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

367 
bReschedu
 = 
	`STARxDeIruHd
(
pAd
, 0);

370 #ifde
UAPSD_AP_SUPPORT


371 
	`UAPSD_TIMING_RECORD_STOP
();

374 
	`RTMP_INT_LOCK
(&
pAd
->
q_lock
, 
ags
);

378 i(
pAd
->
t_ndg
 & 
INT_RX
 || 
bReschedu
)

380 #ifde
WORKQUEUE_BH


381 
	`schedu_wk
(&
pObj
->
rx_de_wk
);

383 
	`skt_hi_schedu
(&
pObj
->
rx_de_sk
);

385 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

390 
	`2860_t_ab
(
pAd
, 
INT_RX
);

391 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

393 
	}
}

395 #ifde
WORKQUEUE_BH


396 
	$fifo_iic_fu_wkq
(
wk_ru
 *
wk
)

398 
	$fifo_iic_fu_skt
(
da
)

401 
ags
;

402 #ifde
WORKQUEUE_BH


403 
POS_COOKIE
 
pObj
 = 
	`cڏ_of
(
wk
, 
os_cook
, 
fifo_iic_fu_wk
);

404 
PRTMP_ADAPTER
 
pAd
 = 
pObj
->
pAd_va
;

406 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER
da
;

407 
POS_COOKIE
 
pObj
;

412 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

415 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

417 
pAd
->
t_ndg
 &~(
FifoSFuI
);

418 
	`NICUpdeFifoSCous
(
pAd
);

420 
	`RTMP_INT_LOCK
(&
pAd
->
q_lock
, 
ags
);

424 i(
pAd
->
t_ndg
 & 
FifoSFuI
)

426 #ifde
WORKQUEUE_BH


427 
	`schedu_wk
(&
pObj
->
fifo_iic_fu_wk
);

429 
	`skt_hi_schedu
(&
pObj
->
fifo_iic_fu_sk
);

431 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

437 
	`2860_t_ab
(
pAd
, 
FifoSFuI
);

438 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

440 
	}
}

442 #ifde
WORKQUEUE_BH


443 
	$hc_dma_de_wkq
(
wk_ru
 *
wk
)

445 
	$hc_dma_de_skt
(
da
)

448 
ags
;

449 
INT_SOURCE_CSR_STRUC
 
ISour
;

450 #ifde
WORKQUEUE_BH


451 
POS_COOKIE
 
pObj
 = 
	`cڏ_of
(
wk
, 
os_cook
, 
hc_dma_de_wk
);

452 
PRTMP_ADAPTER
 
pAd
 = 
pObj
->
pAd_va
;

454 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER
da
;

455 
POS_COOKIE
 
pObj
;

460 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

463 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

466 
ISour
.
wd
 = 0;

467 
ISour
.
fld
.
HcDmaDe
 = 1;

468 
pAd
->
t_ndg
 &~
INT_HCCA_DLY
;

470 
	`RTMPHdTxRgDmaDeIru
(
pAd
, 
ISour
);

472 
	`RTMP_INT_LOCK
(&
pAd
->
q_lock
, 
ags
);

476 i(
pAd
->
t_ndg
 & 
INT_HCCA_DLY
)

478 #ifde
WORKQUEUE_BH


479 
	`schedu_wk
(&
pObj
->
hc_dma_de_wk
);

481 
	`skt_hi_schedu
(&
pObj
->
hc_dma_de_sk
);

483 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

488 
	`2860_t_ab
(
pAd
, 
INT_HCCA_DLY
);

489 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

490 
	}
}

492 #ifde
WORKQUEUE_BH


493 
	$ac3_dma_de_wkq
(
wk_ru
 *
wk
)

495 
	$ac3_dma_de_skt
(
da
)

498 
ags
;

499 
INT_SOURCE_CSR_STRUC
 
ISour
;

500 
BOOLEAN
 
bReschedu
 = 0;

501 #ifde
WORKQUEUE_BH


502 
POS_COOKIE
 
pObj
 = 
	`cڏ_of
(
wk
, 
os_cook
, 
ac3_dma_de_wk
);

503 
PRTMP_ADAPTER
 
pAd
 = 
pObj
->
pAd_va
;

505 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER
da
;

506 
POS_COOKIE
 
pObj
;

511 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

514 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

517 
ISour
.
wd
 = 0;

518 
ISour
.
fld
.
Ac3DmaDe
 = 1;

519 
pAd
->
t_ndg
 &~
INT_AC3_DLY
;

521 
bReschedu
 = 
	`RTMPHdTxRgDmaDeIru
(
pAd
, 
ISour
);

523 
	`RTMP_INT_LOCK
(&
pAd
->
q_lock
, 
ags
);

527 i((
pAd
->
t_ndg
 & 
INT_AC3_DLY
|| 
bReschedu
)

529 #ifde
WORKQUEUE_BH


530 
	`schedu_wk
(&
pObj
->
ac3_dma_de_wk
);

532 
	`skt_hi_schedu
(&
pObj
->
ac3_dma_de_sk
);

534 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

539 
	`2860_t_ab
(
pAd
, 
INT_AC3_DLY
);

540 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

541 
	}
}

543 #ifde
WORKQUEUE_BH


544 
	$ac2_dma_de_wkq
(
wk_ru
 *
wk
)

546 
	$ac2_dma_de_skt
(
da
)

549 
ags
;

550 
INT_SOURCE_CSR_STRUC
 
ISour
;

551 
BOOLEAN
 
bReschedu
 = 0;

552 #ifde
WORKQUEUE_BH


553 
POS_COOKIE
 
pObj
 = 
	`cڏ_of
(
wk
, 
os_cook
, 
ac2_dma_de_wk
);

554 
PRTMP_ADAPTER
 
pAd
 = 
pObj
->
pAd_va
;

556 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER
da
;

557 
POS_COOKIE
 
pObj
;

562 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

565 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

567 
ISour
.
wd
 = 0;

568 
ISour
.
fld
.
Ac2DmaDe
 = 1;

569 
pAd
->
t_ndg
 &~
INT_AC2_DLY
;

571 
bReschedu
 = 
	`RTMPHdTxRgDmaDeIru
(
pAd
, 
ISour
);

573 
	`RTMP_INT_LOCK
(&
pAd
->
q_lock
, 
ags
);

578 i((
pAd
->
t_ndg
 & 
INT_AC2_DLY
|| 
bReschedu
)

580 #ifde
WORKQUEUE_BH


581 
	`schedu_wk
(&
pObj
->
ac2_dma_de_wk
);

583 
	`skt_hi_schedu
(&
pObj
->
ac2_dma_de_sk
);

585 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

590 
	`2860_t_ab
(
pAd
, 
INT_AC2_DLY
);

591 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

592 
	}
}

594 #ifde
WORKQUEUE_BH


595 
	$ac1_dma_de_wkq
(
wk_ru
 *
wk
)

597 
	$ac1_dma_de_skt
(
da
)

600 
ags
;

601 
BOOLEAN
 
bReschedu
 = 0;

602 
INT_SOURCE_CSR_STRUC
 
ISour
;

603 #ifde
WORKQUEUE_BH


604 
POS_COOKIE
 
pObj
 = 
	`cڏ_of
(
wk
, 
os_cook
, 
ac1_dma_de_wk
);

605 
PRTMP_ADAPTER
 
pAd
 = 
pObj
->
pAd_va
;

607 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER
da
;

608 
POS_COOKIE
 
pObj
;

613 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

616 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

619 
ISour
.
wd
 = 0;

620 
ISour
.
fld
.
Ac1DmaDe
 = 1;

621 
pAd
->
t_ndg
 &~
INT_AC1_DLY
;

623 
bReschedu
 = 
	`RTMPHdTxRgDmaDeIru
(
pAd
, 
ISour
);

625 
	`RTMP_INT_LOCK
(&
pAd
->
q_lock
, 
ags
);

629 i((
pAd
->
t_ndg
 & 
INT_AC1_DLY
|| 
bReschedu
)

631 #ifde
WORKQUEUE_BH


632 
	`schedu_wk
(&
pObj
->
ac1_dma_de_wk
);

634 
	`skt_hi_schedu
(&
pObj
->
ac1_dma_de_sk
);

637 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

642 
	`2860_t_ab
(
pAd
, 
INT_AC1_DLY
);

643 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

644 
	}
}

646 #ifde
WORKQUEUE_BH


647 
	$ac0_dma_de_wkq
(
wk_ru
 *
wk
)

649 
	$ac0_dma_de_skt
(
da
)

652 
ags
;

653 
INT_SOURCE_CSR_STRUC
 
ISour
;

654 
BOOLEAN
 
bReschedu
 = 0;

655 #ifde
WORKQUEUE_BH


656 
POS_COOKIE
 
pObj
 = 
	`cڏ_of
(
wk
, 
os_cook
, 
ac0_dma_de_wk
);

657 
PRTMP_ADAPTER
 
pAd
 = 
pObj
->
pAd_va
;

659 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER
da
;

660 
POS_COOKIE
 
pObj
;

665 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

668 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

671 
ISour
.
wd
 = 0;

672 
ISour
.
fld
.
Ac0DmaDe
 = 1;

673 
pAd
->
t_ndg
 &~
INT_AC0_DLY
;

676 
bReschedu
 = 
	`RTMPHdTxRgDmaDeIru
(
pAd
, 
ISour
);

678 
	`RTMP_INT_LOCK
(&
pAd
->
q_lock
, 
ags
);

682 i((
pAd
->
t_ndg
 & 
INT_AC0_DLY
|| 
bReschedu
)

684 #ifde
WORKQUEUE_BH


685 
	`schedu_wk
(&
pObj
->
ac0_dma_de_wk
);

687 
	`skt_hi_schedu
(&
pObj
->
ac0_dma_de_sk
);

689 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

694 
	`2860_t_ab
(
pAd
, 
INT_AC0_DLY
);

695 
	`RTMP_INT_UNLOCK
(&
pAd
->
q_lock
, 
ags
);

696 
	}
}

699 #ifde
RALINK_ATE


700 
	$e_ac0_dma_de_skt
(
da
)

703 
	}
}

714 
	gt_t_cou
;

716 
	gIRQ_HANDLE_TYPE


717 #i(
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,19))

718 
	$2860_u
(
q
, *
dev_
)

720 
	$2860_u
(
q
, *
dev_
, 
_gs
 *
gs
)

723 
t_devi
 *
t_dev
 = (t_devi *
dev_
;

724 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

725 
INT_SOURCE_CSR_STRUC
 
ISour
;

726 
POS_COOKIE
 
pObj
;

728 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

730 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

742 
ISour
.
wd
 = 0x00000000L;

762 
	`RTMP_IO_READ32
(
pAd
, 
INT_SOURCE_CSR
, &
ISour
.
wd
);

763 
	`RTMP_IO_WRITE32
(
pAd
, 
INT_SOURCE_CSR
, 
ISour
.
wd
);

773 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_START_UP
))

775 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

776  
IRQ_HANDLED
;

783 i(
	`RTMP_TEST_FLAG
(
pAd
, (
fRTMP_ADAPTER_RESET_IN_PROGRESS
 |
fRTMP_ADAPTER_HALT_IN_PROGRESS
)))

785 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

786  
IRQ_HANDLED
;

798 #ifde
DBG


802 #ifde 
INF_VR9_HW_INT_WORKAROUND


803 
do
:

806 
pAd
->
bPCIkOff
 = 
FALSE
;

813 i(
ISour
.
wd
 == 0xffffffff)

815 
	`RTMP_SET_FLAG
(
pAd
, (
fRTMP_ADAPTER_NIC_NOT_EXIST
 | 
fRTMP_ADAPTER_HALT_IN_PROGRESS
));

816 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

817  
IRQ_HANDLED
;

823 i(
ISour
.
wd
 & 
TxCoht
)

825 
	`DBGPRINT
(
RT_DEBUG_ERROR
, (">>>TxCoherent<<<\n"));

826 
	`RTMPHdRxCohtIru
(
pAd
);

829 i(
ISour
.
wd
 & 
RxCoht
)

831 
	`DBGPRINT
(
RT_DEBUG_ERROR
, (">>>RxCoherent<<<\n"));

832 
	`RTMPHdRxCohtIru
(
pAd
);

835 i(
ISour
.
wd
 & 
FifoSFuI
)

837 i((
pAd
->
t_dib_mask
 & 
FifoSFuI
) == 0)

840 
	`2860_t_dib
(
pAd
, 
FifoSFuI
);

841 #ifde
WORKQUEUE_BH


842 
	`schedu_wk
(&
pObj
->
fifo_iic_fu_wk
);

844 
	`skt_hi_schedu
(&
pObj
->
fifo_iic_fu_sk
);

847 
pAd
->
t_ndg
 |
FifoSFuI
;

850 i(
ISour
.
wd
 & 
INT_MGMT_DLY
)

852 i((
pAd
->
t_dib_mask
 & 
INT_MGMT_DLY
) ==0 )

854 
	`2860_t_dib
(
pAd
, 
INT_MGMT_DLY
);

855 #ifde
WORKQUEUE_BH


856 
	`schedu_wk
(&
pObj
->
mgmt_dma_de_wk
);

858 
	`skt_hi_schedu
(&
pObj
->
mgmt_dma_de_sk
);

861 
pAd
->
t_ndg
 |
INT_MGMT_DLY
 ;

864 i(
ISour
.
wd
 & 
INT_RX
)

866 i((
pAd
->
t_dib_mask
 & 
INT_RX
) == 0)

870 
	`2860_t_dib
(
pAd
, 
INT_RX
);

871 #ifde
WORKQUEUE_BH


872 
	`schedu_wk
(&
pObj
->
rx_de_wk
);

874 
	`skt_hi_schedu
(&
pObj
->
rx_de_sk
);

877 
pAd
->
t_ndg
 |
INT_RX
;

880 i(
ISour
.
wd
 & 
INT_HCCA_DLY
)

883 i((
pAd
->
t_dib_mask
 & 
INT_HCCA_DLY
) == 0)

886 
	`2860_t_dib
(
pAd
, 
INT_HCCA_DLY
);

887 #ifde
WORKQUEUE_BH


888 
	`schedu_wk
(&
pObj
->
hc_dma_de_wk
);

890 
	`skt_hi_schedu
(&
pObj
->
hc_dma_de_sk
);

893 
pAd
->
t_ndg
 |
INT_HCCA_DLY
;

896 i(
ISour
.
wd
 & 
INT_AC3_DLY
)

899 i((
pAd
->
t_dib_mask
 & 
INT_AC3_DLY
) == 0)

902 
	`2860_t_dib
(
pAd
, 
INT_AC3_DLY
);

903 #ifde
WORKQUEUE_BH


904 
	`schedu_wk
(&
pObj
->
ac3_dma_de_wk
);

906 
	`skt_hi_schedu
(&
pObj
->
ac3_dma_de_sk
);

909 
pAd
->
t_ndg
 |
INT_AC3_DLY
;

912 i(
ISour
.
wd
 & 
INT_AC2_DLY
)

915 i((
pAd
->
t_dib_mask
 & 
INT_AC2_DLY
) == 0)

918 
	`2860_t_dib
(
pAd
, 
INT_AC2_DLY
);

919 #ifde
WORKQUEUE_BH


920 
	`schedu_wk
(&
pObj
->
ac2_dma_de_wk
);

922 
	`skt_hi_schedu
(&
pObj
->
ac2_dma_de_sk
);

925 
pAd
->
t_ndg
 |
INT_AC2_DLY
;

928 i(
ISour
.
wd
 & 
INT_AC1_DLY
)

931 
pAd
->
t_ndg
 |
INT_AC1_DLY
;

933 i((
pAd
->
t_dib_mask
 & 
INT_AC1_DLY
) == 0)

936 
	`2860_t_dib
(
pAd
, 
INT_AC1_DLY
);

937 #ifde
WORKQUEUE_BH


938 
	`schedu_wk
(&
pObj
->
ac1_dma_de_wk
);

940 
	`skt_hi_schedu
(&
pObj
->
ac1_dma_de_sk
);

946 i(
ISour
.
wd
 & 
INT_AC0_DLY
)

956 
pAd
->
t_ndg
 |
INT_AC0_DLY
;

958 i((
pAd
->
t_dib_mask
 & 
INT_AC0_DLY
) == 0)

961 
	`2860_t_dib
(
pAd
, 
INT_AC0_DLY
);

962 #ifde
WORKQUEUE_BH


963 
	`schedu_wk
(&
pObj
->
ac0_dma_de_wk
);

965 
	`skt_hi_schedu
(&
pObj
->
ac0_dma_de_sk
);

971 i(
ISour
.
wd
 & 
PTBTTI
)

973 
	`RTMPHdPTBTTIru
(
pAd
);

976 i(
ISour
.
wd
 & 
TBTTI
)

978 
	`RTMPHdTBTTIru
(
pAd
);

984 #ifde
CONFIG_STA_SUPPORT


985 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

987 i(
ISour
.
wd
 & 
AutoWakeupI
)

988 
	`RTMPHdTwakeupIru
(
pAd
);

992 #ifde 
INF_VR9_HW_INT_WORKAROUND


999 
ISour
.
wd
 = 0x00000000L;

1001 
	`RTMP_IO_READ32
(
pAd
, 
INT_SOURCE_CSR
, &
ISour
.
wd
);

1002 
	`RTMP_IO_WRITE32
(
pAd
, 
INT_SOURCE_CSR
, 
ISour
.
wd
);

1004 i(
ISour
.
wd
 != 0)

1006 
do
;

1010 #i
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,5,0)

1011  
IRQ_HANDLED
;

1014 
	}
}

1032 
INT
 
	$RTPCICmdThad
(

1033 
IN
 
ULONG
 
Cڋxt
)

1035 
RTMP_ADAPTER
 *
pAd
;

1036 
RTMP_OS_TASK
 *
pTask
;

1037 
us
;

1038 
us
 = 0;

1040 
pTask
 = (
RTMP_OS_TASK
 *)
Cڋxt
;

1041 
pAd
 = (
PRTMP_ADAPTER
)
pTask
->
iv
;

1043 
	`RtmpOSTaskCuomize
(
pTask
);

1045 
	`NdisAcqueSpLock
(&
pAd
->
CmdQLock
);

1046 
pAd
->
CmdQ
.
CmdQS
 = 
RTMP_TASK_STAT_RUNNING
;

1047 
	`NdisRSpLock
(&
pAd
->
CmdQLock
);

1049 
pAd
 &&Ad->
CmdQ
.
CmdQS
 =
RTMP_TASK_STAT_RUNNING
)

1051 #ifde
KTHREAD_SUPPORT


1052 
	`RTMP_WAIT_EVENT_INTERRUPTIBLE
(
pAd
, 
pTask
);

1055 
	`RTMP_SEM_EVENT_WAIT
(&(
pTask
->
skSema
), 
us
);

1057 i(
us
 != 0)

1059 
	`RTMP_SET_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
);

1064 i(
pAd
->
CmdQ
.
CmdQS
 =
RTMP_TASK_STAT_STOPED
)

1067 i(!
pAd
->
PM_FlgSud
)

1068 
	`CMDHdr
(
pAd
);

1071 i(
pAd
 && !pAd->
PM_FlgSud
)

1073 
CmdQElmt
 *
pCmdQElmt
 = 
NULL
;

1075 
	`NdisAcqueSpLock
(&
pAd
->
CmdQLock
);

1076 
pAd
->
CmdQ
.
CmdQS
 = 
RTMP_TASK_STAT_STOPED
;

1077 
pAd
->
CmdQ
.
size
)

1079 
	`RTThadDequeueCmd
(&
pAd
->
CmdQ
, &
pCmdQElmt
);

1080 i(
pCmdQElmt
)

1082 i(
pCmdQElmt
->
CmdFromNdis
 =
TRUE
)

1084 i(
pCmdQElmt
->
bufr
 !
NULL
)

1085 
	`os__mem
(
pAd
, 
pCmdQElmt
->
bufr
);

1086 
	`os__mem
(
pAd
, (
PUCHAR
)
pCmdQElmt
);

1090 i((
pCmdQElmt
->
bufr
 !
NULL
&& (pCmdQElmt->
buf㾒gth
 != 0))

1091 
	`os__mem
(
pAd
, 
pCmdQElmt
->
bufr
);

1092 
	`os__mem
(
pAd
, (
PUCHAR
)
pCmdQElmt
);

1097 
	`NdisRSpLock
(&
pAd
->
CmdQLock
);

1113 
	`DBGPRINT
(
RT_DEBUG_TRACE
,( "<---RTPCICmdThread\n"));

1115 #ide
KTHREAD_SUPPORT


1116 
pTask
->
skPID
 = 
THREAD_PID_INIT_VALUE
;

1117 
	`come_d_ex
 (&
pTask
->
skCome
, 0);

1121 
	}
}

	@os/linux/rt_profile.c

37 
	~"_cfig.h
"

40 
NDIS_STATUS
 
	$RTMPRdPamsHook
(

41 
IN
 
PRTMP_ADAPTER
 
pAd
)

43 
PSTRING
 
c
 = 
NULL
;

44 
RTMP_OS_FD
 
cf
;

45 
RTMP_OS_FS_INFO
 
osFSInfo
;

46 
INT
 
tv
 = 
NDIS_STATUS_FAILURE
;

47 
PSTRING
 
bufr
;

49 
bufr
 = 
	`kmloc
(
MAX_INI_BUFFER_SIZE
, 
MEM_ALLOC_FLAG
);

50 if(
bufr
 =
NULL
)

51  
NDIS_STATUS_FAILURE
;

52 
	`memt
(
bufr
, 0x00, 
MAX_INI_BUFFER_SIZE
);

56 #ifde
CONFIG_STA_SUPPORT


57 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

59 
c
 = 
STA_PROFILE_PATH
;

62 #ifde
MULTIPLE_CARD_SUPPORT


63 
c
 = (
PSTRING
)
pAd
->
MC_FeName
;

67 i(
c
 && *src)

69 
	`RtmpOSFSInfoChge
(&
osFSInfo
, 
TRUE
);

70 
cf
 = 
	`RtmpOSFeOn
(
c
, 
O_RDONLY
, 0);

71 i(
	`IS_FILE_OPEN_ERR
(
cf
))

73 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Of\"%s\" faed!\n", 
c
));

77 
tv
 =
	`RtmpOSFeRd
(
cf
, 
bufr
, 
MAX_INI_BUFFER_SIZE
);

78 i(
tv
 > 0)

80 
	`RTMPSProfePams
(
pAd
, 
bufr
);

81 
tv
 = 
NDIS_STATUS_SUCCESS
;

84 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Rd f\"%s\" faedӼCode=%d)!\n", 
c
, 
tv
));

86 
tv
 = 
	`RtmpOSFeClo
(
cf
);

87 i
tv
 != 0)

89 
tv
 = 
NDIS_STATUS_FAILURE
;

90 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Clo f\"%s\" faedӼCode=%d)!\n", 
c
, 
tv
));

94 
	`RtmpOSFSInfoChge
(&
osFSInfo
, 
FALSE
);

97 
	`k
(
bufr
);

99  (
tv
);

101 
	}
}

	@os/linux/rt_rbus_pci_util.c

39 
	~"_cfig.h
"

43 
	$RTMP_AoTxDescMemy
(

44 
IN
 
PRTMP_ADAPTER
 
pAd
,

45 
IN
 
UINT
 
Index
,

46 
IN
 
ULONG
 
Lgth
,

47 
IN
 
BOOLEAN
 
Cached
,

48 
OUT
 
PVOID
 *
VtuAddss
,

49 
OUT
 
PNDIS_PHYSICAL_ADDRESS
 
PhysilAddss
)

51 
POS_COOKIE
 
pObj
 = (POS_COOKIE)
pAd
->
OS_Cook
;

53 *
VtuAddss
 = (
PVOID
)
	`pci_loc_csit
(
pObj
->
pci_dev
,()*
Lgth
, 
PhysilAddss
);

55 
	}
}

59 
	$RTMP_AoMgmtDescMemy
(

60 
IN
 
PRTMP_ADAPTER
 
pAd
,

61 
IN
 
ULONG
 
Lgth
,

62 
IN
 
BOOLEAN
 
Cached
,

63 
OUT
 
PVOID
 *
VtuAddss
,

64 
OUT
 
PNDIS_PHYSICAL_ADDRESS
 
PhysilAddss
)

66 
POS_COOKIE
 
pObj
 = (POS_COOKIE)
pAd
->
OS_Cook
;

68 *
VtuAddss
 = (
PVOID
)
	`pci_loc_csit
(
pObj
->
pci_dev
,()*
Lgth
, 
PhysilAddss
);

70 
	}
}

74 
	$RTMP_AoRxDescMemy
(

75 
IN
 
PRTMP_ADAPTER
 
pAd
,

76 
IN
 
ULONG
 
Lgth
,

77 
IN
 
BOOLEAN
 
Cached
,

78 
OUT
 
PVOID
 *
VtuAddss
,

79 
OUT
 
PNDIS_PHYSICAL_ADDRESS
 
PhysilAddss
)

81 
POS_COOKIE
 
pObj
 = (POS_COOKIE)
pAd
->
OS_Cook
;

83 *
VtuAddss
 = (
PVOID
)
	`pci_loc_csit
(
pObj
->
pci_dev
,()*
Lgth
, 
PhysilAddss
);

85 
	}
}

89 
	$RTMP_FeDescMemy
(

90 
IN
 
PRTMP_ADAPTER
 
pAd
,

91 
IN
 
ULONG
 
Lgth
,

92 
IN
 
PVOID
 
VtuAddss
,

93 
IN
 
NDIS_PHYSICAL_ADDRESS
 
PhysilAddss
)

95 
POS_COOKIE
 
pObj
 = (POS_COOKIE)
pAd
->
OS_Cook
;

97 
	`pci__csit
(
pObj
->
pci_dev
, 
Lgth
, 
VtuAddss
, 
PhysilAddss
);

98 
	}
}

102 
	$RTMP_AoFTxBufr
(

103 
IN
 
PRTMP_ADAPTER
 
pAd
,

104 
IN
 
UINT
 
Index
,

105 
IN
 
ULONG
 
Lgth
,

106 
IN
 
BOOLEAN
 
Cached
,

107 
OUT
 
PVOID
 *
VtuAddss
,

108 
OUT
 
PNDIS_PHYSICAL_ADDRESS
 
PhysilAddss
)

110 
POS_COOKIE
 
pObj
 = (POS_COOKIE)
pAd
->
OS_Cook
;

112 *
VtuAddss
 = (
PVOID
)
	`pci_loc_csit
(
pObj
->
pci_dev
,()*
Lgth
, 
PhysilAddss
);

113 
	}
}

116 
	$RTMP_FeFTxBufr
(

117 
IN
 
PRTMP_ADAPTER
 
pAd
,

118 
IN
 
ULONG
 
Lgth
,

119 
IN
 
BOOLEAN
 
Cached
,

120 
IN
 
PVOID
 
VtuAddss
,

121 
IN
 
NDIS_PHYSICAL_ADDRESS
 
PhysilAddss
)

123 
POS_COOKIE
 
pObj
 = (POS_COOKIE)
pAd
->
OS_Cook
;

125 
	`pci__csit
(
pObj
->
pci_dev
, 
Lgth
, 
VtuAddss
, 
PhysilAddss
);

126 
	}
}

140 
PNDIS_PACKET
 
	$RTMP_AoRxPackBufr
(

141 
IN
 
PRTMP_ADAPTER
 
pAd
,

142 
IN
 
ULONG
 
Lgth
,

143 
IN
 
BOOLEAN
 
Cached
,

144 
OUT
 
PVOID
 *
VtuAddss
,

145 
OUT
 
PNDIS_PHYSICAL_ADDRESS
 
PhysilAddss
)

147 
sk_buff
 *
pkt
;

150 
	`DEV_ALLOC_SKB
(
pAd
, 
pkt
, 
Lgth
);

152 i(
pkt
 =
NULL
) {

153 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("n'lox %ld sizck\n",
Lgth
));

156 i(
pkt
) {

157 
	`RTMP_SET_PACKET_SOURCE
(
	`OSPKT_TO_RTPKT
(
pkt
), 
PKTSRC_NDIS
);

158 *
VtuAddss
 = (
PVOID

pkt
->
da
;

162 *
PhysilAddss
 = 
	`PCI_MAP_SINGLE
(
pAd
, *
VtuAddss
, 
Lgth
, -1, 
PCI_DMA_FROMDEVICE
);

165 *
VtuAddss
 = (
PVOID

NULL
;

166 *
PhysilAddss
 = (
NDIS_PHYSICAL_ADDRESS

NULL
;

169  (
PNDIS_PACKET

pkt
;

170 
	}
}

176 
dma_addr_t
 
	$lux_pci_m_sg
(*
hd
, *
r
, 
size_t
 
size
, 
sd_idx
, 
dei
)

178 
PRTMP_ADAPTER
 
pAd
;

179 
POS_COOKIE
 
pObj
;

197 
pAd
 = (
PRTMP_ADAPTER
)
hd
;

198 
pObj
 = (
POS_COOKIE
)
pAd
->
OS_Cook
;

200 i(
sd_idx
 == 1)

202 
PTX_BLK
 
pTxBlk
;

203 
pTxBlk
 = (
PTX_BLK
)
r
;

204  
	`pci_m_sg
(
pObj
->
pci_dev
, 
pTxBlk
->
pSrcBufDa
,TxBlk->
SrcBufL
, 
dei
);

208  
	`pci_m_sg
(
pObj
->
pci_dev
, 
r
, 
size
, 
dei
);

211 
	}
}

213 
	$lux_pci_unm_sg
(*
hd
, 
dma_addr_t
 
dma_addr
, 
size_t
 
size
, 
dei
)

215 
PRTMP_ADAPTER
 
pAd
;

216 
POS_COOKIE
 
pObj
;

218 
pAd
=(
PRTMP_ADAPTER
)
hd
;

219 
pObj
 = (
POS_COOKIE
)
pAd
->
OS_Cook
;

221 i(
size
 > 0)

222 
	`pci_unm_sg
(
pObj
->
pci_dev
, 
dma_addr
, 
size
, 
dei
);

224 
	}
}

226 #ifde
CONFIG_STA_SUPPORT


227 #ifde
PCIE_PS_SUPPORT


239 
VOID
 
	$RTMPPCIeLkClVueRee
(

240 
IN
 
PRTMP_ADAPTER
 
pAd
,

241 
IN
 
UCHAR
 
Lev
)

243 
USHORT
 
PCIePowSaveLev
, 
g16
;

244 
USHORT
 
Cfiguti
;

245 
POS_COOKIE
 
pObj
;

247 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

249 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

253 i(
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
FALSE
)

258 #ifde
RT2860


259 i(!((
pObj
->
DeviID
 =
NIC2860_PCIe_DEVICE_ID
)

260 ||(
pObj
->
DeviID
 =
NIC2790_PCIe_DEVICE_ID
)))

266 #ifde
RT3590


267 i((
pObj
->
DeviID
 =
NIC3590_PCIe_DEVICE_ID
)

268 ||(
pObj
->
DeviID
 =
NIC3591_PCIe_DEVICE_ID
)

269 ||(
pObj
->
DeviID
 =
NIC3592_PCIe_DEVICE_ID
))

273 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s.===>\n", 
__FUNCTION__
));

274 
PCIePowSaveLev
 = 
pAd
->PCIePowerSaveLevel;

275 i((
PCIePowSaveLev
&0xff) == 0xff)

277 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("return \n"));

281 i(
pObj
->
_pci_dev
 && (
pAd
->
HoLnkClOfft
 != 0))

283 
	`PCI_REG_READ_WORD
(
pObj
->
_pci_dev
, 
pAd
->
HoLnkClOfft
, 
Cfiguti
);

284 i((
Cfiguti
 != 0) &&

285 (
Cfiguti
 != 0xFFFF))

287 
Cfiguti
 &= 0xfefc;

289 i(
Lev
 =
RESTORE_CLOSE
)

291 
Cfiguti
 |
pAd
->
HoLnkClCfiguti
;

294 
Cfiguti
 |= 0x0;

295 
	`PCI_REG_WIRTE_WORD
(
pObj
->
_pci_dev
, 
pAd
->
HoLnkClOfft
, 
Cfiguti
);

296 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ReܐPCI ho : off0x%x = 0x%x\n", 
pAd
->
HoLnkClOfft
, 
Cfiguti
));

299 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("ReܐPCI ho : PCI_REG_READ_WORD faed (Cfiguti = 0x%x)\n", 
Cfiguti
));

302 i(
pObj
->
pci_dev
 && (
pAd
->
RLnkClOfft
 != 0))

304 
	`PCI_REG_READ_WORD
(
pObj
->
pci_dev
, 
pAd
->
RLnkClOfft
, 
Cfiguti
);

305 i((
Cfiguti
 != 0) &&

306 (
Cfiguti
 != 0xFFFF))

308 
Cfiguti
 &= 0xfefc;

310 i(
Lev
 =
RESTORE_CLOSE
)

311 
Cfiguti
 |
pAd
->
RLnkClCfiguti
;

313 
Cfiguti
 |= 0x0;

314 
	`PCI_REG_WIRTE_WORD
(
pObj
->
pci_dev
, 
pAd
->
RLnkClOfft
, 
Cfiguti
);

315 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ReܐRk : off0x%x = 0x%x\n", 
pAd
->
RLnkClOfft
, 
Cfiguti
));

318 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("ReܐRk : PCI_REG_READ_WORD faed (Cfiguti = 0x%x)\n", 
Cfiguti
));

321 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("%<===\n", 
__FUNCTION__
));

322 
	}
}

335 
VOID
 
	$RTMPPCIeLkClStg
(

336 
IN
 
PRTMP_ADAPTER
 
pAd
,

337 
IN
 
USHORT
 
Max
)

339 
USHORT
 
PCIePowSaveLev
, 
g16
;

340 
USHORT
 
Cfiguti
;

341 
POS_COOKIE
 
pObj
;

343 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

345 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

349 i(
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
FALSE
)

355 #ifde
RT2860


356 i(!((
pObj
->
DeviID
 =
NIC2860_PCIe_DEVICE_ID
)

357 ||(
pObj
->
DeviID
 =
NIC2790_PCIe_DEVICE_ID
)))

361 i(!
	`RTMP_TEST_PSFLAG
(
pAd
, 
fRTMP_PS_CAN_GO_SLEEP
))

363 
	`DBGPRINT
(
RT_DEBUG_INFO
, ("RTMPPCIePowerLinkCtrleturn on fRTMP_PS_CAN_GO_SLEEP flag\n"));

366 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("%s===>\n", 
__FUNCTION__
));

367 
PCIePowSaveLev
 = 
pAd
->PCIePowerSaveLevel;

368 i((
PCIePowSaveLev
&0xff) == 0xff)

370 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("return \n"));

373 
PCIePowSaveLev
 = PCIePowerSaveLevel>>6;

376 i(
pObj
->
_pci_dev
 && (
pAd
->
HoLnkClOfft
 != 0))

378 
	`PCI_REG_READ_WORD
(
pObj
->
_pci_dev
, 
pAd
->
HoLnkClOfft
, 
Cfiguti
);

379 
PCIePowSaveLev
)

383 
Cfiguti
 &= 0xfefc;

387 
Cfiguti
 &= 0xfefc;

388 
Cfiguti
 |= 0x1;

392 
Cfiguti
 &= 0xfefc;

393 
Cfiguti
 |= 0x3;

397 
Cfiguti
 &= 0xfefc;

398 
Cfiguti
 |= 0x103;

401 
	`PCI_REG_WIRTE_WORD
(
pObj
->
_pci_dev
, 
pAd
->
HoLnkClOfft
, 
Cfiguti
);

402 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("WrPCI ho off0x%x = 0x%x\n", 
pAd
->
HoLnkClOfft
, 
Cfiguti
));

405 i(
pObj
->
pci_dev
 && (
pAd
->
RLnkClOfft
 != 0))

408 i(
PCIePowSaveLev
 > 
Max
)

409 
PCIePowSaveLev
 = 
Max
;

411 
	`PCI_REG_READ_WORD
(
pObj
->
pci_dev
, 
pAd
->
RLnkClOfft
, 
Cfiguti
);

412 
Cfiguti
 |= 0x100;

413 
	`PCI_REG_WIRTE_WORD
(
pObj
->
pci_dev
, 
pAd
->
RLnkClOfft
, 
Cfiguti
);

414 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("WrRk devi : off0x%x = 0x%x\n", 
pAd
->
RLnkClOfft
, 
Cfiguti
));

417 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("RTMPPCIePowerLinkCtrl <==============\n"));

418 
	}
}

	@os/linux/sta_ioctl.c

40 
	~"_cfig.h
"

42 #ifde
DBG


43 
ULONG
 
RTDebugLev
;

46 
	#NR_WEP_KEYS
 4

	)

47 
	#WEP_SMALL_KEY_LEN
 (40/8)

	)

48 
	#WEP_LARGE_KEY_LEN
 (104/8)

	)

50 
	#GROUP_KEY_NO
 4

	)

52 #i
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,27)

53 
	#IWE_STREAM_ADD_EVENT
(
_A
, 
_B
, 
_C
, 
_D
, 
_E

	`iwe_am_add_evt
(_A, _B, _C, _D, _E)

	)

54 
	#IWE_STREAM_ADD_POINT
(
_A
, 
_B
, 
_C
, 
_D
, 
_E

	`iwe_am_add_pot
(_A, _B, _C, _D, _E)

	)

55 
	#IWE_STREAM_ADD_VALUE
(
_A
, 
_B
, 
_C
, 
_D
, 
_E
, 
_F

	`iwe_am_add_vue
(_A, _B, _C, _D, _E, _F)

	)

57 
	#IWE_STREAM_ADD_EVENT
(
_A
, 
_B
, 
_C
, 
_D
, 
_E

	`iwe_am_add_evt
(_B, _C, _D, _E)

	)

58 
	#IWE_STREAM_ADD_POINT
(
_A
, 
_B
, 
_C
, 
_D
, 
_E

	`iwe_am_add_pot
(_B, _C, _D, _E)

	)

59 
	#IWE_STREAM_ADD_VALUE
(
_A
, 
_B
, 
_C
, 
_D
, 
_E
, 
_F

	`iwe_am_add_vue
(_B, _C, _D, _E, _F)

	)

62 
UCHAR
 
ChW2Teme
[];

64 
GNU_PACKED
 
	t_RT_VERSION_INFO
{

65 
UCHAR
 
	gDrivVsiW
;

66 
UCHAR
 
	gDrivVsiX
;

67 
UCHAR
 
	gDrivVsiY
;

68 
UCHAR
 
	gDrivVsiZ
;

69 
UINT
 
	gDrivBudYr
;

70 
UINT
 
	gDrivBudMth
;

71 
UINT
 
	gDrivBudDay
;

72 } 
	tRT_VERSION_INFO
, *
	tPRT_VERSION_INFO
;

74 
iw_iv_gs
 
	givb
[] = {

75 { 
RTPRIV_IOCTL_SET
,

76 
IW_PRIV_TYPE_CHAR
 | 1024, 0,

79 { 
RTPRIV_IOCTL_SHOW
, 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 
IW_PRIV_SIZE_MASK
,

82 { 
SHOW_CONN_STATUS
,

83 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 
IW_PRIV_SIZE_MASK
, "connStatus" },

84 { 
SHOW_DRVIER_VERION
,

85 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 
IW_PRIV_SIZE_MASK
, "driverVer" },

86 { 
SHOW_BA_INFO
,

87 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 
IW_PRIV_SIZE_MASK
, "bainfo" },

88 { 
SHOW_DESC_INFO
,

89 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 
IW_PRIV_SIZE_MASK
, "descinfo" },

90 { 
RAIO_OFF
,

91 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 
IW_PRIV_SIZE_MASK
, "radio_off" },

92 { 
RAIO_ON
,

93 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 
IW_PRIV_SIZE_MASK
, "radio_on" },

94 #ifde
QOS_DLS_SUPPORT


95 { 
SHOW_DLS_ENTRY_INFO
,

96 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 
IW_PRIV_SIZE_MASK
, "dlsentryinfo" },

98 { 
SHOW_CFG_VALUE
,

99 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 
IW_PRIV_SIZE_MASK
, "show" },

100 { 
SHOW_ADHOC_ENTRY_INFO
,

101 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 
IW_PRIV_SIZE_MASK
, "adhocEntry" },

104 #ifde
DBG


105 { 
RTPRIV_IOCTL_BBP
,

106 
IW_PRIV_TYPE_CHAR
 | 
IW_PRIV_SIZE_MASK
, IW_PRIV_TYPE_CHAR | IW_PRIV_SIZE_MASK,

108 { 
RTPRIV_IOCTL_MAC
,

109 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 1024,

111 { 
RTPRIV_IOCTL_E2P
,

112 
IW_PRIV_TYPE_CHAR
 | 1024, IW_PRIV_TYPE_CHAR | 1024,

116 { 
RTPRIV_IOCTL_STATISTICS
,

117 0, 
IW_PRIV_TYPE_CHAR
 | 
IW_PRIV_SIZE_MASK
,

119 { 
RTPRIV_IOCTL_GSITESURVEY
,

120 0, 
IW_PRIV_TYPE_CHAR
 | 1024,

125 
__s32
 
lk
[];

126 
UINT32
 
RT_ReSize
;

136 
	$_iol_giwme
(
t_devi
 *
dev
,

137 
iw_que_fo
 *
fo
,

138 *
me
, *
exa
)

140 
	`y
(
me
, "Rk STA", 
IFNAMSIZ
);

142 
	}
}

144 
	$_iol_siweq
(
t_devi
 *
dev
,

145 
iw_que_fo
 *
fo
,

146 
iw_eq
 *
eq
, *
exa
)

148 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

149 
ch
 = -1;

151 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

154 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

156 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

157  -
ENETDOWN
;

161 i(
eq
->
e
 > 1)

162  -
EINVAL
;

164 if((
eq
->
e
 =0&& (eq->
m
 <= 1000))

165 
ch
 = 
eq
->
m
;

167 
	`MAP_KHZ_TO_CHANNEL_ID
(
eq
->
m
 /100, 
ch
);

169 i(
	`ChlSy
(
pAd
, 
ch
=
TRUE
)

171 
pAd
->
CommCfg
.
Chl
 = 
ch
;

175 
pAd
->
MlmeAux
.
Chl
 =Ad->
CommCfg
.Channel;

176 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("==>_iol_siweq::SIOCSIWFREQ[cmd=0x%x] (Chl=%d)\n", 
SIOCSIWFREQ
, 
pAd
->
CommCfg
.
Chl
));

179  -
EINVAL
;

182 
	}
}

185 
	$_iol_giweq
(
t_devi
 *
dev
,

186 
iw_que_fo
 *
fo
,

187 
iw_eq
 *
eq
, *
exa
)

189 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

190 
UCHAR
 
ch
;

191 
ULONG
 
m
 = 2412000;

193 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

195 i(
pAd
 =
NULL
)

199  -
ENETDOWN
;

203 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

205 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

206  -
ENETDOWN
;

208 
ch
 = 
pAd
->
CommCfg
.
Chl
;

210 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("==>_iol_giweq %d\n", 
ch
));

212 
	`MAP_CHANNEL_ID_TO_KHZ
(
ch
, 
m
);

213 
eq
->
m
 = m * 100;

214 
eq
->
e
 = 1;

215 
eq
->
i
 = 0;

218 
	}
}

221 
	$_iol_siwmode
(
t_devi
 *
dev
,

222 
iw_que_fo
 *
fo
,

223 
__u32
 *
mode
, *
exa
)

225 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

227 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

230 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

232 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

233  -
ENETDOWN
;

236 *
mode
)

238 
IW_MODE_ADHOC
:

239 
	`S_NwkTy_Proc
(
pAd
, "Adhoc");

241 
IW_MODE_INFRA
:

242 
	`S_NwkTy_Proc
(
pAd
, "Infra");

244 #i(
LINUX_VERSION_CODE
 > 
	`KERNEL_VERSION
(2,4,20))

245 
IW_MODE_MONITOR
:

246 
	`S_NwkTy_Proc
(
pAd
, "Monitor");

250 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>_iol_siwmode::SIOCSIWMODE (unknow%d)\n", *
mode
));

251  -
EINVAL
;

255 
pAd
->
SCfg
.
WS
 = 
SS_NOTUSE
;

258 
	}
}

261 
	$_iol_giwmode
(
t_devi
 *
dev
,

262 
iw_que_fo
 *
fo
,

263 
__u32
 *
mode
, *
exa
)

265 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

267 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

269 i(
pAd
 =
NULL
)

273  -
ENETDOWN
;

277 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

279 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

280  -
ENETDOWN
;

283 i(
	`ADHOC_ON
(
pAd
))

284 *
mode
 = 
IW_MODE_ADHOC
;

285 i(
	`INFRA_ON
(
pAd
))

286 *
mode
 = 
IW_MODE_INFRA
;

287 #i(
LINUX_VERSION_CODE
 > 
	`KERNEL_VERSION
(2,4,20))

288 i(
	`MONITOR_ON
(
pAd
))

290 *
mode
 = 
IW_MODE_MONITOR
;

294 *
mode
 = 
IW_MODE_AUTO
;

296 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("==>_iol_giwmode(mode=%d)\n", *
mode
));

298 
	}
}

300 
	$_iol_siwns
(
t_devi
 *
dev
,

301 
iw_que_fo
 *
fo
,

302 *
me
, *
exa
)

304 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

306 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

309 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

311 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

312  -
ENETDOWN
;

316 
	}
}

318 
	$_iol_giwns
(
t_devi
 *
dev
,

319 
iw_que_fo
 *
fo
,

320 *
me
, *
exa
)

323 
	}
}

325 
	$_iol_giwnge
(
t_devi
 *
dev
,

326 
iw_que_fo
 *
fo
,

327 
iw_pot
 *
da
, *
exa
)

329 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

330 
iw_nge
 *
nge
 = (iw_ng*
exa
;

331 
u16
 
v
;

332 
i
;

334 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

336 i(
pAd
 =
NULL
)

340  -
ENETDOWN
;

343 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


344 #ide
RT_CFG80211_SUPPORT


345 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

347 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

348  -
ENETDOWN
;

353 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("===>rt_ioctl_giwrange\n"));

354 
da
->
ngth
 = (
iw_nge
);

355 
	`memt
(
nge
, 0, (
iw_nge
));

357 
nge
->
txpow_
 = 
IW_TXPOW_DBM
;

359 i(
	`INFRA_ON
(
pAd
)||
	`ADHOC_ON
(pAd))

361 
nge
->
m_pmp
 = 1 * 1024;

362 
nge
->
max_pmp
 = 65535 * 1024;

363 
nge
->
m_pmt
 = 1 * 1024;

364 
nge
->
max_pmt
 = 1000 * 1024;

365 
nge
->
pmp_ags
 = 
IW_POWER_PERIOD
;

366 
nge
->
pmt_ags
 = 
IW_POWER_TIMEOUT
;

367 
nge
->
pm_
 = 
IW_POWER_PERIOD
 | 
IW_POWER_TIMEOUT
 |

368 
IW_POWER_UNICAST_R
 | 
IW_POWER_ALL_R
;

371 
nge
->
we_vsi_comped
 = 
WIRELESS_EXT
;

372 
nge
->
we_vsi_sour
 = 14;

374 
nge
->
y_
 = 
IW_RETRY_LIMIT
;

375 
nge
->
y_ags
 = 
IW_RETRY_LIMIT
;

376 
nge
->
m_y
 = 0;

377 
nge
->
max_y
 = 255;

379 
nge
->
num_chls
 = 
pAd
->
ChlLiNum
;

381 
v
 = 0;

382 
i
 = 1; i <
nge
->
num_chls
; i++)

384 
u32
 
m
 = 2412000;

385 
nge
->
eq
[
v
].
i
 = 
pAd
->
ChlLi
[i-1].
Chl
;

386 
	`MAP_CHANNEL_ID_TO_KHZ
(
pAd
->
ChlLi
[
i
-1].
Chl
, 
m
);

387 
nge
->
eq
[
v
].
m
 = m * 100;

389 
nge
->
eq
[
v
].
e
 = 1;

390 
v
++;

391 i(
v
 =
IW_MAX_FREQUENCIES
)

394 
nge
->
num_equcy
 = 
v
;

396 
nge
->
max_qu
.
qu
 = 100;

399 
nge
->
max_qu
.
v
 = 0;

400 
nge
->
max_qu
.
noi
 = 0;

403 
nge
->
avg_qu
.
qu
 = 20;

404 
nge
->
avg_qu
.
v
 = -60;

405 
nge
->
avg_qu
.
noi
 = -95;

406 
nge
->
nsivy
 = 3;

408 
nge
->
max_codg_toks
 = 
NR_WEP_KEYS
;

409 
nge
->
num_codg_sizes
 = 2;

410 
nge
->
codg_size
[0] = 5;

411 
nge
->
codg_size
[1] = 13;

413 
nge
->
m_s
 = 0;

414 
nge
->
max_s
 = 2347;

415 
nge
->
m_ag
 = 256;

416 
nge
->
max_ag
 = 2346;

418 #i
WIRELESS_EXT
 > 17

420 
nge
->
c_
 = 
IW_ENC_CAPA_WPA
 | 
IW_ENC_CAPA_WPA2
 |

421 
IW_ENC_CAPA_CIPHER_TKIP
 | 
IW_ENC_CAPA_CIPHER_CCMP
;

425 
	}
}

427 
	$_iol_siw
(
t_devi
 *
dev
,

428 
iw_que_fo
 *
fo
,

429 
sockaddr
 *
_addr
, *
exa
)

431 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

432 
NDIS_802_11_MAC_ADDRESS
 
Bssid
;

434 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

437 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

439 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

440  -
ENETDOWN
;

443 i(
pAd
->
Mlme
.
ClMache
.
CuS
 !
CNTL_IDLE
)

445 
	`RTMP_MLME_RESET_STATE_MACHINE
(
pAd
);

446 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! MLME busy,eset MLME state machine !!!\n"));

451 
pAd
->
MlmeAux
.
CuReqIsFromNdis
 = 
FALSE
;

453 
pAd
->
MlmeAux
.
AutoRecSsidL
= 32;

455 
	`memt
(
Bssid
, 0, 
MAC_ADDR_LEN
);

456 
	`memy
(
Bssid
, 
_addr
->
_da
, 
MAC_ADDR_LEN
);

458 i(
	`MAC_ADDR_EQUAL
(
Bssid
, 
ZERO_MAC_ADDR
))

460 i(
	`INFRA_ON
(
pAd
))

462 
	`LkDown
(
pAd
, 
FALSE
);

467 
	`MlmeEnqueue
(
pAd
,

468 
MLME_CNTL_STATE_MACHINE
,

469 
OID_802_11_BSSID
,

470 (
NDIS_802_11_MAC_ADDRESS
),

471 (
VOID
 *)&
Bssid
, 0);

474 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IOCTL::SIOCSIWAP %02x:%02x:%02x:%02x:%02x:%02x\n",

475 
Bssid
[0], Bssid[1], Bssid[2], Bssid[3], Bssid[4], Bssid[5]));

478 
	}
}

480 
	$_iol_giw
(
t_devi
 *
dev
,

481 
iw_que_fo
 *
fo
,

482 
sockaddr
 *
_addr
, *
exa
)

484 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

486 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

488 i(
pAd
 =
NULL
)

492  -
ENETDOWN
;

496 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

498 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

499  -
ENETDOWN
;

502 i(
	`INFRA_ON
(
pAd
|| 
	`ADHOC_ON
(pAd))

504 
_addr
->
_my
 = 
ARPHRD_ETHER
;

505 
	`memy
(
_addr
->
_da
, &
pAd
->
CommCfg
.
Bssid
, 
ETH_ALEN
);

507 #ifde
WPA_SUPPLICANT_SUPPORT


509 i(
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
)

511 
_addr
->
_my
 = 
ARPHRD_ETHER
;

512 
	`memy
(
_addr
->
_da
, &
pAd
->
MlmeAux
.
Bssid
, 
ETH_ALEN
);

517 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IOCTL::SIOCGIWAP(=EMPTY)\n"));

518  -
ENOTCONN
;

522 
	}
}

540 
	$t_quy
(
PRTMP_ADAPTER
 
pAd
,

541 
iw_quy
 *
iq
,

542 
PBSS_ENTRY
 
pBssEry
)

544 
__u8
 
ChlQuy
;

547 i(
pBssEry
->
Rssi
 >= -50)

548 
ChlQuy
 = 100;

549 i(
pBssEry
->
Rssi
 >= -80)

550 
ChlQuy
 = (
__u8
)(24 + ((
pBssEry
->
Rssi
 + 80) * 26)/10);

551 i(
pBssEry
->
Rssi
 >= -90)

552 
ChlQuy
 = (
__u8
)((
pBssEry
->
Rssi
 + 90) * 26)/10;

554 
ChlQuy
 = 0;

556 
iq
->
qu
 = (
__u8
)
ChlQuy
;

558 
iq
->
v
 = (
__u8
)(
pBssEry
->
Rssi
);

560 i(
pBssEry
->
Rssi
 >= -70)

561 
iq
->
noi
 = -92;

563 
iq
->
noi
 = 
pBssEry
->
Rssi
 -BssEry->
MSNR
;

565 
iq
->
upded
 = 
pAd
->
iw_s
.
qu
.updated;

566 
	}
}

568 
	$_iol_iwli
(
t_devi
 *
dev
,

569 
iw_que_fo
 *
fo
,

570 
iw_pot
 *
da
, *
exa
)

572 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

574 
sockaddr
 
addr
[
IW_MAX_AP
];

575 
iw_quy
 
qu
[
IW_MAX_AP
];

576 
i
;

578 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

581 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

583 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

584 
da
->
ngth
 = 0;

589 
i
 = 0; i <
IW_MAX_AP
 ; i++)

591 i(
i
 >
pAd
->
SnTab
.
BssNr
)

593 
addr
[
i
].
_my
 = 
ARPHRD_ETHER
;

594 
	`memy
(
addr
[
i
].
_da
, &
pAd
->
SnTab
.
BssEry
[i].
Bssid
, 
MAC_ADDR_LEN
);

595 
	`t_quy
(
pAd
, &
qu
[
i
], &pAd->
SnTab
.
BssEry
[i]);

597 
da
->
ngth
 = 
i
;

598 
	`memy
(
exa
, &
addr
, 
i
*(addr[0]));

599 
da
->
ags
 = 1;

600 
	`memy
(
exa
 + 
i
*(
addr
[0]), &
qu
, i*(qual[i]));

603 
	}
}

605 #i
defed
(
SIOCGIWSCAN
|| defed(
RT_CFG80211_SUPPORT
)

606 
	$_iol_siwsn
(
t_devi
 *
dev
,

607 
iw_que_fo
 *
fo
,

608 
iwq_da
 *
wq
, *
exa
)

610 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

611 
Stus
 = 
NDIS_STATUS_SUCCESS
;

613 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

616 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

618 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

619  -
ENETDOWN
;

622 i(
	`MONITOR_ON
(
pAd
))

624 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! Driver is in Monitor Modeow !!!\n"));

625  -
EINVAL
;

629 #ifde
WPA_SUPPLICANT_SUPPORT


630 i((
pAd
->
SCfg
.
WSuliUP
 & 0x7F=
WPA_SUPPLICANT_ENABLE
)

632 
pAd
->
SCfg
.
WSuliSnCou
++;

636 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
TRUE
;

639 #ifde
WPA_SUPPLICANT_SUPPORT


640 i(((
pAd
->
SCfg
.
WSuliUP
 & 0x7F=
WPA_SUPPLICANT_ENABLE
) &&

641 (
pAd
->
SCfg
.
WSuliSnCou
 > 3))

643 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! WpaSupplicantScanCount > 3\n"));

644 
Stus
 = 
NDIS_STATUS_SUCCESS
;

649 i((
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
)) &&

650 ((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
) ||

651 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

652 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
) ||

653 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
)) &&

654 (
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
))

656 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! Link UP, Port Not Secured! ignorehis set::OID_802_11_BSSID_LIST_SCAN\n"));

657 
Stus
 = 
NDIS_STATUS_SUCCESS
;

661 #ifde
WPA_SUPPLICANT_SUPPORT


662 #i
WIRELESS_EXT
 > 17

663 i(
wq
->
da
.
ngth
 =(
iw_sn_q
) &&

664 
wq
->
da
.
ags
 & 
IW_SCAN_THIS_ESSID
)

666 
NDIS_802_11_SSID
 
Ssid
;

667 
iw_sn_q
 *
q
 = (iw_sn_q *)
exa
;

668 
Ssid
.
SsidLgth
 = 
q
->
essid_n
;

669 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("_iol_siwsn::eq.essid_n-%d,ssid-%s\n", 
q
->
essid_n
,eq->
essid
));

670 
	`NdisZoMemy
(&
Ssid
.Ssid, 
NDIS_802_11_LENGTH_SSID
);

671 
	`NdisMoveMemy
(
Ssid
.Ssid, 
q
->
essid
, Ssid.
SsidLgth
);

672 
	`SSeSurvey
(
pAd
, &
Ssid
, 
SCAN_ACTIVE
);

677 
	`SSeSurvey
(
pAd
, 
NULL
, 
SCAN_ACTIVE
);

679  
NDIS_STATUS_SUCCESS
;

680 
	}
}

682 
	$_iol_giwsn
(
t_devi
 *
dev
,

683 
iw_que_fo
 *
fo
,

684 
iw_pot
 *
da
, *
exa
)

686 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

687 
i
=0;

688 
PSTRING
 
cut_ev
 = 
exa
, 
evious_ev
 =xtra;

689 
PSTRING
 
d_buf
;

690 
PSTRING
 
cut_v
;

691 
STRING
 
cuom
[
MAX_CUSTOM_LEN
] = {0};

692 #ide
IWEVGENIE


693 
idx
;

695 
iw_evt
 
iwe
;

697 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

700 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

702 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

703  -
ENETDOWN
;

706 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

711 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
TRUE
;

712 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("rt_ioctl_giwscan:: Still scanning\n"));

713  -
EAGAIN
;

716 i(
pAd
->
SCfg
.
bImovedSn
)

721 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
TRUE
;

722 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("rt_ioctl_giwscan:: Still scanning\n"));

723  -
EAGAIN
;

727 #ifde
WPA_SUPPLICANT_SUPPORT


728 i((
pAd
->
SCfg
.
WSuliUP
 & 0x7F=
WPA_SUPPLICANT_ENABLE
)

730 
pAd
->
SCfg
.
WSuliSnCou
 = 0;

734 i(
pAd
->
SnTab
.
BssNr
 == 0)

736 
da
->
ngth
 = 0;

740 #i
WIRELESS_EXT
 >= 17

741 i(
da
->
ngth
 > 0)

742 
d_buf
 = 
exa
 + 
da
->
ngth
;

744 
d_buf
 = 
exa
 + 
IW_SCAN_MAX_DATA
;

746 
d_buf
 = 
exa
 + 
IW_SCAN_MAX_DATA
;

749 
i
 = 0; i < 
pAd
->
SnTab
.
BssNr
; i++)

751 i(
cut_ev
 >
d_buf
)

753 #i
WIRELESS_EXT
 >= 17

754  -
E2BIG
;

762 
	`memt
(&
iwe
, 0, (iwe));

763 
iwe
.
cmd
 = 
SIOCGIWAP
;

764 
iwe
.
u
.
_addr
.
_my
 = 
ARPHRD_ETHER
;

765 
	`memy
(
iwe
.
u
.
_addr
.
_da
, &
pAd
->
SnTab
.
BssEry
[
i
].
Bssid
, 
ETH_ALEN
);

767 
evious_ev
 = 
cut_ev
;

768 
cut_ev
 = 
	`IWE_STREAM_ADD_EVENT
(
fo
, cut_ev,
d_buf
, &
iwe
, 
IW_EV_ADDR_LEN
);

769 i(
cut_ev
 =
evious_ev
)

770 #i
WIRELESS_EXT
 >= 17

771  -
E2BIG
;

787 
	`memt
(&
iwe
, 0, (iwe));

788 
iwe
.
cmd
 = 
SIOCGIWNAME
;

792 
PBSS_ENTRY
 
pBssEry
=&
pAd
->
SnTab
.
BssEry
[
i
];

793 
BOOLEAN
 
isGly
=
FALSE
;

794 
C
=0;

796 i(
pBssEry
->
Chl
>14)

798 i(
pBssEry
->
HtCabyL
!=0)

799 
	`ry
(
iwe
.
u
.
me
,"802.11a/n");

801 
	`ry
(
iwe
.
u
.
me
,"802.11a");

808 
C
=0;C<
pBssEry
->
SupReL
;rateCnt++)

813 i(
pBssEry
->
SupRe
[
C
]==140 ||BssEntry->SupRate[rateCnt]==146 ||BssEntry->SupRate[rateCnt]>=152)

814 
isGly
=
TRUE
;

817 
C
=0;C<
pBssEry
->
ExtReL
;rateCnt++)

819 i(
pBssEry
->
ExtRe
[
C
]==140 ||BssEntry->ExtRate[rateCnt]==146 ||BssEntry->ExtRate[rateCnt]>=152)

820 
isGly
=
TRUE
;

824 i(
pBssEry
->
HtCabyL
!=0)

826 i(
isGly
==
TRUE
)

827 
	`ry
(
iwe
.
u
.
me
,"802.11g/n");

829 
	`ry
(
iwe
.
u
.
me
,"802.11b/g/n");

833 i(
isGly
==
TRUE
)

834 
	`ry
(
iwe
.
u
.
me
,"802.11g");

837 i(
pBssEry
->
SupReL
==4 &&BssEry->
ExtReL
==0)

838 
	`ry
(
iwe
.
u
.
me
,"802.11b");

840 
	`ry
(
iwe
.
u
.
me
,"802.11b/g");

846 
evious_ev
 = 
cut_ev
;

847 
cut_ev
 = 
	`IWE_STREAM_ADD_EVENT
(
fo
, cut_ev,
d_buf
, &
iwe
, 
IW_EV_ADDR_LEN
);

848 i(
cut_ev
 =
evious_ev
)

849 #i
WIRELESS_EXT
 >= 17

850  -
E2BIG
;

857 
	`memt
(&
iwe
, 0, (iwe));

858 
iwe
.
cmd
 = 
SIOCGIWESSID
;

859 
iwe
.
u
.
da
.
ngth
 = 
pAd
->
SnTab
.
BssEry
[
i
].
SsidL
;

860 
iwe
.
u
.
da
.
ags
 = 1;

862 
evious_ev
 = 
cut_ev
;

863 
cut_ev
 = 
	`IWE_STREAM_ADD_POINT
(
fo
, cut_ev,
d_buf
, &
iwe
, (
PSTRING

pAd
->
SnTab
.
BssEry
[
i
].
Ssid
);

864 i(
cut_ev
 =
evious_ev
)

865 #i
WIRELESS_EXT
 >= 17

866  -
E2BIG
;

873 
	`memt
(&
iwe
, 0, (iwe));

874 
iwe
.
cmd
 = 
SIOCGIWMODE
;

875 i(
pAd
->
SnTab
.
BssEry
[
i
].
BssTy
 =
Ndis802_11IBSS
)

877 
iwe
.
u
.
mode
 = 
IW_MODE_ADHOC
;

879 i(
pAd
->
SnTab
.
BssEry
[
i
].
BssTy
 =
Ndis802_11Inaruu
)

881 
iwe
.
u
.
mode
 = 
IW_MODE_INFRA
;

885 
iwe
.
u
.
mode
 = 
IW_MODE_AUTO
;

887 
iwe
.
n
 = 
IW_EV_UINT_LEN
;

889 
evious_ev
 = 
cut_ev
;

890 
cut_ev
 = 
	`IWE_STREAM_ADD_EVENT
(
fo
, cut_ev, 
d_buf
, &
iwe
, 
IW_EV_UINT_LEN
);

891 i(
cut_ev
 =
evious_ev
)

892 #i
WIRELESS_EXT
 >= 17

893  -
E2BIG
;

900 
	`memt
(&
iwe
, 0, (iwe));

901 
iwe
.
cmd
 = 
SIOCGIWFREQ
;

903 
UCHAR
 
ch
 = 
pAd
->
SnTab
.
BssEry
[
i
].
Chl
;

904 
ULONG
 
m
 = 0;

905 
	`MAP_CHANNEL_ID_TO_KHZ
(
ch
, 
m
);

906 
iwe
.
u
.
eq
.
m
 = m * 100;

907 
iwe
.
u
.
eq
.
e
 = 1;

908 
iwe
.
u
.
eq
.
i
 = 0;

909 
evious_ev
 = 
cut_ev
;

910 
cut_ev
 = 
	`IWE_STREAM_ADD_EVENT
(
fo
, cut_ev,
d_buf
, &
iwe
, 
IW_EV_FREQ_LEN
);

911 i(
cut_ev
 =
evious_ev
)

912 #i
WIRELESS_EXT
 >= 17

913  -
E2BIG
;

921 
	`memt
(&
iwe
, 0, (iwe));

922 
iwe
.
cmd
 = 
IWEVQUAL
;

923 
iwe
.
u
.
qu
.
v
 = 0;

924 
iwe
.
u
.
qu
.
noi
 = 0;

925 
	`t_quy
(
pAd
, &
iwe
.
u
.
qu
, &pAd->
SnTab
.
BssEry
[
i
]);

926 
cut_ev
 = 
	`IWE_STREAM_ADD_EVENT
(
fo
, cut_ev, 
d_buf
, &
iwe
, 
IW_EV_QUAL_LEN
);

927 i(
cut_ev
 =
evious_ev
)

928 #i
WIRELESS_EXT
 >= 17

929  -
E2BIG
;

936 
	`memt
(&
iwe
, 0, (iwe));

937 
iwe
.
cmd
 = 
SIOCGIWENCODE
;

938 i(
	`CAP_IS_PRIVACY_ON
 (
pAd
->
SnTab
.
BssEry
[
i
].
CabyInfo
 ))

939 
iwe
.
u
.
da
.
ags
 =
IW_ENCODE_ENABLED
 | 
IW_ENCODE_NOKEY
;

941 
iwe
.
u
.
da
.
ags
 = 
IW_ENCODE_DISABLED
;

943 
evious_ev
 = 
cut_ev
;

944 
cut_ev
 = 
	`IWE_STREAM_ADD_POINT
(
fo
, cut_ev, 
d_buf
,&
iwe
, (*)
pAd
->
ShedKey
[
BSS0
][(iwe.
u
.
da
.
ags
 & 
IW_ENCODE_INDEX
)-1].
Key
);

945 i(
cut_ev
 =
evious_ev
)

946 #i
WIRELESS_EXT
 >= 17

947  -
E2BIG
;

954 i(
pAd
->
SnTab
.
BssEry
[
i
].
SupReL
)

956 
UCHAR
 
tmpRe
 = 
pAd
->
SnTab
.
BssEry
[
i
].
SupRe
[pAd->SnTab.BssEry[i].
SupReL
-1];

957 
	`memt
(&
iwe
, 0, (iwe));

958 
iwe
.
cmd
 = 
SIOCGIWRATE
;

959 
cut_v
 = 
cut_ev
 + 
IW_EV_LCP_LEN
;

960 i(
tmpRe
 == 0x82)

961 
iwe
.
u
.
b
.
vue
 = 1 * 1000000;

962 i(
tmpRe
 == 0x84)

963 
iwe
.
u
.
b
.
vue
 = 2 * 1000000;

964 i(
tmpRe
 == 0x8B)

965 
iwe
.
u
.
b
.
vue
 = 5.5 * 1000000;

966 i(
tmpRe
 == 0x96)

967 
iwe
.
u
.
b
.
vue
 = 11 * 1000000;

969 
iwe
.
u
.
b
.
vue
 = (
tmpRe
/2) * 1000000;

971 i(
pAd
->
SnTab
.
BssEry
[
i
].
ExtReL
)

973 
UCHAR
 
tmpSupRe
 =(
pAd
->
SnTab
.
BssEry
[
i
].
SupRe
[pAd->SnTab.BssEry[i].
SupReL
-1]& 0x7f);

974 
UCHAR
 
tmpExtRe
 =(
pAd
->
SnTab
.
BssEry
[
i
].
ExtRe
[pAd->SnTab.BssEry[i].
ExtReL
-1]& 0x7f);

975 
iwe
.
u
.
b
.
vue
 = (
tmpSupRe
 > 
tmpExtRe
) ? (tmpSupRate)*500000 : (tmpExtRate)*500000;

978 i(
tmpRe
 =0x6&& 
pAd
->
SnTab
.
BssEry
[
i
].
HtCabyL
 > 0)

980 
_cou
 = 
RT_ReSize
/(
__s32
);

981 
HT_CAP_INFO
 
pInfo
 = 
pAd
->
SnTab
.
BssEry
[
i
].
HtCaby
.
HtCInfo
;

982 
shtGI
 = 
pInfo
.
ChlWidth
 ? cInfo.
ShtGIf40
 : cInfo.
ShtGIf20
;

983 
maxMCS
 = 
pAd
->
SnTab
.
BssEry
[
i
].
HtCaby
.
MCSS
[1] ? 15 : 7;

984 
_dex
 = 12 + ((
UCHAR
)
pInfo
.
ChlWidth
 * 24+ ((UCHAR)
shtGI
 *48+ ((UCHAR)
maxMCS
);

985 i(
_dex
 < 0)

986 
_dex
 = 0;

987 i(
_dex
 >
_cou
)

988 
_dex
 = 
_cou
-1;

989 
iwe
.
u
.
b
.
vue
 = 
lk
[
_dex
] * 500000;

992 
iwe
.
u
.
b
.
dibd
 = 0;

993 
cut_v
 = 
	`IWE_STREAM_ADD_VALUE
(
fo
, 
cut_ev
,

994 
cut_v
, 
d_buf
, &
iwe
,

995 
IW_EV_PARAM_LEN
);

997 if((
cut_v
-
cut_ev
)>
IW_EV_LCP_LEN
)

998 
cut_ev
 = 
cut_v
;

1000 #i
WIRELESS_EXT
 >= 17

1001  -
E2BIG
;

1007 #ifde
IWEVGENIE


1009 i(
pAd
->
SnTab
.
BssEry
[
i
].
WIE
.
IEL
 > 0)

1011 
	`memt
(&
iwe
, 0, (iwe));

1012 
	`memt
(&
cuom
[0], 0, 
MAX_CUSTOM_LEN
);

1013 
	`memy
(
cuom
, &(
pAd
->
SnTab
.
BssEry
[
i
].
WIE
.
IE
[0]),

1014 
pAd
->
SnTab
.
BssEry
[
i
].
WIE
.
IEL
);

1015 
iwe
.
cmd
 = 
IWEVGENIE
;

1016 
iwe
.
u
.
da
.
ngth
 = 
pAd
->
SnTab
.
BssEry
[
i
].
WIE
.
IEL
;

1017 
cut_ev
 = 
	`IWE_STREAM_ADD_POINT
(
fo
, cut_ev, 
d_buf
, &
iwe
, 
cuom
);

1018 i(
cut_ev
 =
evious_ev
)

1019 #i
WIRELESS_EXT
 >= 17

1020  -
E2BIG
;

1027 i(
pAd
->
SnTab
.
BssEry
[
i
].
RIE
.
IEL
 > 0)

1029 
	`memt
(&
iwe
, 0, (iwe));

1030 
	`memt
(&
cuom
[0], 0, 
MAX_CUSTOM_LEN
);

1031 
	`memy
(
cuom
, &(
pAd
->
SnTab
.
BssEry
[
i
].
RIE
.
IE
[0]),

1032 
pAd
->
SnTab
.
BssEry
[
i
].
RIE
.
IEL
);

1033 
iwe
.
cmd
 = 
IWEVGENIE
;

1034 
iwe
.
u
.
da
.
ngth
 = 
pAd
->
SnTab
.
BssEry
[
i
].
RIE
.
IEL
;

1035 
cut_ev
 = 
	`IWE_STREAM_ADD_POINT
(
fo
, cut_ev, 
d_buf
, &
iwe
, 
cuom
);

1036 i(
cut_ev
 =
evious_ev
)

1037 #i
WIRELESS_EXT
 >= 17

1038  -
E2BIG
;

1045 i(
pAd
->
SnTab
.
BssEry
[
i
].
WpsIE
.
IEL
 > 0)

1047 
	`memt
(&
iwe
, 0, (iwe));

1048 
	`memt
(&
cuom
[0], 0, 
MAX_CUSTOM_LEN
);

1049 
	`memy
(
cuom
, &(
pAd
->
SnTab
.
BssEry
[
i
].
WpsIE
.
IE
[0]),

1050 
pAd
->
SnTab
.
BssEry
[
i
].
WpsIE
.
IEL
);

1051 
iwe
.
cmd
 = 
IWEVGENIE
;

1052 
iwe
.
u
.
da
.
ngth
 = 
pAd
->
SnTab
.
BssEry
[
i
].
WpsIE
.
IEL
;

1053 
cut_ev
 = 
	`IWE_STREAM_ADD_POINT
(
fo
, cut_ev, 
d_buf
, &
iwe
, 
cuom
);

1054 i(
cut_ev
 =
evious_ev
)

1055 #i
WIRELESS_EXT
 >= 17

1056  -
E2BIG
;

1064 i(
pAd
->
SnTab
.
BssEry
[
i
].
WIE
.
IEL
 > 0)

1066 
	`NdisZoMemy
(&
iwe
, (iwe));

1067 
	`memt
(&
cuom
[0], 0, 
MAX_CUSTOM_LEN
);

1068 
iwe
.
cmd
 = 
IWEVCUSTOM
;

1069 
iwe
.
u
.
da
.
ngth
 = (
pAd
->
SnTab
.
BssEry
[
i
].
WIE
.
IEL
 * 2) + 7;

1070 
	`NdisMoveMemy
(
cuom
, "wpa_ie=", 7);

1071 
idx
 = 0; idx < 
pAd
->
SnTab
.
BssEry
[
i
].
WIE
.
IEL
; idx++)

1072 
	`rtf
(
cuom
, "%s%02x", cuom, 
pAd
->
SnTab
.
BssEry
[
i
].
WIE
.
IE
[
idx
]);

1073 
evious_ev
 = 
cut_ev
;

1074 
cut_ev
 = 
	`IWE_STREAM_ADD_POINT
(
fo
, cut_ev, 
d_buf
, &
iwe
, 
cuom
);

1075 i(
cut_ev
 =
evious_ev
)

1076 #i
WIRELESS_EXT
 >= 17

1077  -
E2BIG
;

1084 i(
pAd
->
SnTab
.
BssEry
[
i
].
RIE
.
IEL
 > 0)

1086 
	`NdisZoMemy
(&
iwe
, (iwe));

1087 
	`memt
(&
cuom
[0], 0, 
MAX_CUSTOM_LEN
);

1088 
iwe
.
cmd
 = 
IWEVCUSTOM
;

1089 
iwe
.
u
.
da
.
ngth
 = (
pAd
->
SnTab
.
BssEry
[
i
].
RIE
.
IEL
 * 2) + 7;

1090 
	`NdisMoveMemy
(
cuom
, "rsn_ie=", 7);

1091 
idx
 = 0; idx < 
pAd
->
SnTab
.
BssEry
[
i
].
RIE
.
IEL
; idx++)

1092 
	`rtf
(
cuom
, "%s%02x", cuom, 
pAd
->
SnTab
.
BssEry
[
i
].
RIE
.
IE
[
idx
]);

1093 
evious_ev
 = 
cut_ev
;

1094 
cut_ev
 = 
	`IWE_STREAM_ADD_POINT
(
fo
, cut_ev, 
d_buf
, &
iwe
, 
cuom
);

1095 i(
cut_ev
 =
evious_ev
)

1096 #i
WIRELESS_EXT
 >= 17

1097  -
E2BIG
;

1107 
da
->
ngth
 = 
cut_ev
 - 
exa
;

1108 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
FALSE
;

1109 
	`DBGPRINT
(
RT_DEBUG_ERROR
 ,("===>_iol_giwsn. %d(%dBSSued, da->ngth = %d\n",
i
 , 
pAd
->
SnTab
.
BssNr
, 
da
->
ngth
));

1111 
	}
}

1114 
	$_iol_siwessid
(
t_devi
 *
dev
,

1115 
iw_que_fo
 *
fo
,

1116 
iw_pot
 *
da
, *
essid
)

1118 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1120 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1123 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1125 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1126  -
ENETDOWN
;

1129 i(
da
->
ags
)

1131 
PSTRING
 
pSsidSg
 = 
NULL
;

1134 i(
da
->
ngth
 > (
IW_ESSID_MAX_SIZE
 + 1))

1135  -
E2BIG
;

1137 
pSsidSg
 = 
	`kmloc
(
MAX_LEN_OF_SSID
+1, 
MEM_ALLOC_FLAG
);

1138 i(
pSsidSg
)

1140 
	`NdisZoMemy
(
pSsidSg
, 
MAX_LEN_OF_SSID
+1);

1141 
	`NdisMoveMemy
(
pSsidSg
, 
essid
, 
da
->
ngth
);

1142 i(
	`S_SSID_Proc
(
pAd
, 
pSsidSg
=
FALSE
)

1144 
	`k
(
pSsidSg
);

1145  -
EINVAL
;

1147 
	`k
(
pSsidSg
);

1150  -
ENOMEM
;

1155 i(
	`S_SSID_Proc
(
pAd
, ""=
FALSE
)

1156  -
EINVAL
;

1159 
	}
}

1161 
	$_iol_giwessid
(
t_devi
 *
dev
,

1162 
iw_que_fo
 *
fo
,

1163 
iw_pot
 *
da
, *
essid
)

1165 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1167 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1169 i(
pAd
 =
NULL
)

1173  -
ENETDOWN
;

1177 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1179 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1180  -
ENETDOWN
;

1183 
da
->
ags
 = 1;

1184 i(
	`MONITOR_ON
(
pAd
))

1186 
da
->
ngth
 = 0;

1190 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
))

1192 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("MediaState is connected\n"));

1193 
da
->
ngth
 = 
pAd
->
CommCfg
.
SsidL
;

1194 
	`memy
(
essid
, 
pAd
->
CommCfg
.
Ssid
,Ad->CommCfg.
SsidL
);

1198 
da
->
ngth
 = 0;

1199 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("MediaState isot connected,ss\n"));

1204 
	}
}

1206 
	$_iol_siwnickn
(
t_devi
 *
dev
,

1207 
iw_que_fo
 *
fo
,

1208 
iw_pot
 *
da
, *
nickme
)

1210 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1212 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1215 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1217 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("INFO::Network is down!\n"));

1218  -
ENETDOWN
;

1221 i(
da
->
ngth
 > 
IW_ESSID_MAX_SIZE
)

1222  -
EINVAL
;

1224 
	`memt
(
pAd
->
nickme
, 0, 
IW_ESSID_MAX_SIZE
 + 1);

1225 
	`memy
(
pAd
->
nickme
,ickme, 
da
->
ngth
);

1229 
	}
}

1231 
	$_iol_giwnickn
(
t_devi
 *
dev
,

1232 
iw_que_fo
 *
fo
,

1233 
iw_pot
 *
da
, *
nickme
)

1235 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1237 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1239 i(
pAd
 =
NULL
)

1243  -
ENETDOWN
;

1247 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1249 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1250 
da
->
ngth
 = 0;

1251  -
ENETDOWN
;

1254 i(
da
->
ngth
 > 
	`
((
PSTRING

pAd
->
nickme
) + 1)

1255 
da
->
ngth
 = 
	`
((
PSTRING

pAd
->
nickme
) + 1;

1256 i(
da
->
ngth
 > 0) {

1257 
	`memy
(
nickme
, 
pAd
->nickme, 
da
->
ngth
-1);

1258 
nickme
[
da
->
ngth
-1] = '\0';

1261 
	}
}

1263 
	$_iol_siws
(
t_devi
 *
dev
,

1264 
iw_que_fo
 *
fo
,

1265 
iw_m
 *
s
, *
exa
)

1267 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1268 
u16
 
v
;

1270 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1273 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1275 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1276  -
ENETDOWN
;

1279 i(
s
->
dibd
)

1280 
v
 = 
MAX_RTS_THRESHOLD
;

1281 i(
s
->
vue
 < 0 ||ts->vu> 
MAX_RTS_THRESHOLD
)

1282  -
EINVAL
;

1283 i(
s
->
vue
 == 0)

1284 
v
 = 
MAX_RTS_THRESHOLD
;

1286 
v
 = 
s
->
vue
;

1288 i(
v
 !
pAd
->
CommCfg
.
RtsThshd
)

1289 
pAd
->
CommCfg
.
RtsThshd
 = 
v
;

1292 
	}
}

1294 
	$_iol_giws
(
t_devi
 *
dev
,

1295 
iw_que_fo
 *
fo
,

1296 
iw_m
 *
s
, *
exa
)

1298 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1300 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1302 i(
pAd
 =
NULL
)

1306  -
ENETDOWN
;

1310 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1312 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1313  -
ENETDOWN
;

1316 
s
->
vue
 = 
pAd
->
CommCfg
.
RtsThshd
;

1317 
s
->
dibd
 = (s->
vue
 =
MAX_RTS_THRESHOLD
);

1318 
s
->
fixed
 = 1;

1321 
	}
}

1323 
	$_iol_siwag
(
t_devi
 *
dev
,

1324 
iw_que_fo
 *
fo
,

1325 
iw_m
 *
ag
, *
exa
)

1327 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1328 
u16
 
v
;

1330 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1333 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1335 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1336  -
ENETDOWN
;

1339 i(
ag
->
dibd
)

1340 
v
 = 
MAX_FRAG_THRESHOLD
;

1341 i(
ag
->
vue
 >
MIN_FRAG_THRESHOLD
 || fg->vu<
MAX_FRAG_THRESHOLD
)

1342 
v
 = 
	`__u_to_16
(
ag
->
vue
 & ~0x1);

1343 i(
ag
->
vue
 == 0)

1344 
v
 = 
MAX_FRAG_THRESHOLD
;

1346  -
EINVAL
;

1348 
pAd
->
CommCfg
.
FgmtThshd
 = 
v
;

1350 
	}
}

1352 
	$_iol_giwag
(
t_devi
 *
dev
,

1353 
iw_que_fo
 *
fo
,

1354 
iw_m
 *
ag
, *
exa
)

1356 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1358 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1360 i(
pAd
 =
NULL
)

1364  -
ENETDOWN
;

1368 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1370 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1371  -
ENETDOWN
;

1374 
ag
->
vue
 = 
pAd
->
CommCfg
.
FgmtThshd
;

1375 
ag
->
dibd
 = (ag->
vue
 =
MAX_FRAG_THRESHOLD
);

1376 
ag
->
fixed
 = 1;

1379 
	}
}

1381 
	#MAX_WEP_KEY_SIZE
 13

	)

1382 
	#MIN_WEP_KEY_SIZE
 5

	)

1383 
	$_iol_siwcode
(
t_devi
 *
dev
,

1384 
iw_que_fo
 *
fo
,

1385 
iw_pot
 *
q
, *
exa
)

1387 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1389 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1392 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1394 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1395  -
ENETDOWN
;

1398 i((
q
->
ngth
 == 0) &&

1399 (
q
->
ags
 & 
IW_ENCODE_DISABLED
))

1401 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11WEPDibd
;

1402 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11WEPDibd
;

1403 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11WEPDibd
;

1404 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeOn
;

1405 
de
;

1407 i(
q
->
ags
 & 
IW_ENCODE_RESTRICTED
 ||rq->ag& 
IW_ENCODE_OPEN
)

1410 
	`STA_PORT_SECURED
(
pAd
);

1411 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11WEPEbd
;

1412 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11WEPEbd
;

1413 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11WEPEbd
;

1414 i(
q
->
ags
 & 
IW_ENCODE_RESTRICTED
)

1415 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeShed
;

1417 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeOn
;

1420 i(
q
->
ngth
 > 0)

1422 
keyIdx
 = (
q
->
ags
 & 
IW_ENCODE_INDEX
) - 1;

1424 i(
q
->
ngth
 > 
MAX_WEP_KEY_SIZE
)

1426  -
EINVAL
;

1429 i((
keyIdx
 < 0|| (keyIdx >
NR_WEP_KEYS
))

1431 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("==>rt_ioctl_siwencode::Wrong keyIdx=%d! Using default key instead (%d)\n",

1432 
keyIdx
, 
pAd
->
SCfg
.
DeuKeyId
));

1435 
keyIdx
 = 
pAd
->
SCfg
.
DeuKeyId
;

1438 
pAd
->
SCfg
.
DeuKeyId
 = 
keyIdx
;

1440 
	`NdisZoMemy
(
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
Key
, 16);

1442 i(
q
->
ngth
 =
MAX_WEP_KEY_SIZE
)

1444 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
KeyL
 = 
MAX_WEP_KEY_SIZE
;

1445 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
ChAlg
 = 
CIPHER_WEP128
;

1447 i(
q
->
ngth
 =
MIN_WEP_KEY_SIZE
)

1449 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
KeyL
 = 
MIN_WEP_KEY_SIZE
;

1450 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
ChAlg
 = 
CIPHER_WEP64
;

1454 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
KeyL
 = 0;

1457 if(!(
q
->
ags
 & 
IW_ENCODE_NOKEY
))

1460 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
Key
, 
exa
, 
q
->
ngth
);

1466 
dex
 = (
q
->
ags
 & 
IW_ENCODE_INDEX
) - 1;

1467 i((
dex
 >= 0) && (index < 4))

1469 
pAd
->
SCfg
.
DeuKeyId
 = 
dex
;

1473 if(!
q
->
ags
 & 
IW_ENCODE_MODE
)

1475  -
EINVAL
;

1479 
de
:

1480 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("==>_iol_siwcode::q->ags=%x\n",
q
->
ags
));

1481 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("==>_iol_siwcode::AuthMode=%x\n",
pAd
->
SCfg
.
AuthMode
));

1482 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("==>_iol_siwcode::DeuKeyId=%x, KeyL = %d\n",
pAd
->
SCfg
.
DeuKeyId
 ,Ad->
ShedKey
[
BSS0
][pAd->SCfg.DeuKeyId].
KeyL
));

1483 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("==>_iol_siwcode::WStus=%x\n",
pAd
->
SCfg
.
WStus
));

1485 
	}
}

1488 
	$_iol_giwcode
(
t_devi
 *
dev
,

1489 
iw_que_fo
 *
fo
,

1490 
iw_pot
 *
q
, *
key
)

1492 
kid
;

1493 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1495 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1497 i(
pAd
 =
NULL
)

1501  -
ENETDOWN
;

1505 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1507 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1508  -
ENETDOWN
;

1511 
kid
 = 
q
->
ags
 & 
IW_ENCODE_INDEX
;

1512 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>_iol_giwcod%d\n", 
q
->
ags
 & 
IW_ENCODE_INDEX
));

1514 i(
pAd
->
SCfg
.
WStus
 =
Ndis802_11WEPDibd
)

1516 
q
->
ngth
 = 0;

1517 
q
->
ags
 = 
IW_ENCODE_DISABLED
;

1519 i((
kid
 > 0) && (kid <=4))

1522 
q
->
ags
 = 
kid
 ;

1523 i(
q
->
ngth
 > 
pAd
->
ShedKey
[
BSS0
][
kid
-1].
KeyL
)

1524 
q
->
ngth
 = 
pAd
->
ShedKey
[
BSS0
][
kid
-1].
KeyL
;

1525 
	`memy
(
key
, 
pAd
->
ShedKey
[
BSS0
][
kid
-1].
Key
, 
q
->
ngth
);

1528 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeShed
)

1529 
q
->
ags
 |
IW_ENCODE_RESTRICTED
;

1531 
q
->
ags
 |
IW_ENCODE_OPEN
;

1534 i(
kid
 == 0)

1536 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeShed
)

1537 
q
->
ags
 |
IW_ENCODE_RESTRICTED
;

1539 
q
->
ags
 |
IW_ENCODE_OPEN
;

1540 
q
->
ngth
 = 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
KeyL
;

1541 
	`memy
(
key
, 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
Key
, 
q
->
ngth
);

1543 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeShed
)

1544 
q
->
ags
 |
IW_ENCODE_RESTRICTED
;

1546 
q
->
ags
 |
IW_ENCODE_OPEN
;

1547 
q
->
ags
 = 
pAd
->
SCfg
.
DeuKeyId
 + 1;

1548 
q
->
ags
 |
IW_ENCODE_ENABLED
;

1553 
	}
}

1555 
	$_iol_am
(
t_devi
 *
dev
, 
iw_que_fo
 *
fo
,

1556 *
w
, *
exa
)

1558 
PRTMP_ADAPTER
 
pAd
;

1559 
POS_COOKIE
 
pObj
;

1560 
PSTRING
 
this_ch
 = 
exa
;

1561 
PSTRING
 
vue
;

1562 
Stus
=0;

1564 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1566 i(
pAd
 =
NULL
)

1570  -
ENETDOWN
;

1573 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

1575 
pObj
->
iol_if_ty
 = 
INT_MAIN
;

1576 
pObj
->
iol_if
 = 
MAIN_MBSSID
;

1580 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1582 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1583  -
ENETDOWN
;

1586 i(!*
this_ch
)

1587  -
EINVAL
;

1589 i((
vue
 = 
	`rchr
(
this_ch
, '=')!
NULL
)

1590 *
vue
++ = 0;

1592 i(!
vue
 && (
	`rcmp
(
this_ch
, "SiteSurvey") != 0))

1593  -
EINVAL
;

1594 i(!
vue
 && (
	`rcmp
(
this_ch
, "SiteSurvey") == 0))

1595 
SET_PROC
;

1598 i(!*
vue
 && (
	`rcmp
(
this_ch
, "SSID") != 0))

1599  -
EINVAL
;

1601 
SET_PROC
:

1602 
Stus
 = 
	`RTMPSTAPrivIolS
(
pAd
, 
this_ch
, 
vue
);

1604  
Stus
;

1605 
	}
}

1610 
	$_ive_g_iics
(
t_devi
 *
dev
, 
iw_que_fo
 *
fo
,

1611 
iw_pot
 *
wrq
, *
exa
)

1613 
INT
 
Stus
 = 0;

1614 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1616 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1619 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1621 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1622  -
ENETDOWN
;

1625 i(
exa
 =
NULL
)

1627 
wrq
->
ngth
 = 0;

1628  -
EIO
;

1631 
	`memt
(
exa
, 0x00, 
IW_PRIV_SIZE_MASK
);

1632 
	`rtf
(
exa
, "\n\n");

1634 #ifde
RALINK_ATE


1635 i(
	`ATE_ON
(
pAd
))

1637 
	`rtf
(
exa
+
	`
xa), "Tx sucs = %ld\n", (
ULONG
)
pAd
->
e
.
TxDeCou
);

1643 
	`rtf
(
exa
+
	`
xa), "Tx sucs = %lu\n", (
ULONG
)
pAd
->
WnCous
.
TnsmdFgmtCou
.
u
.
LowPt
);

1645 
	`rtf
(
exa
+
	`
xa), "Txry cou = %lu\n", (
ULONG
)
pAd
->
WnCous
.
RryCou
.
u
.
LowPt
);

1646 
	`rtf
(
exa
+
	`
xa), "Tx faRcv ACKᔄry = %lu\n", (
ULONG
)
pAd
->
WnCous
.
FaedCou
.
u
.
LowPt
);

1647 
	`rtf
(
exa
+
	`
xa), "RTS SucsRcv CTS = %lu\n", (
ULONG
)
pAd
->
WnCous
.
RTSSucssCou
.
u
.
LowPt
);

1648 
	`rtf
(
exa
+
	`
xa), "RTS Fa Rcv CTS = %lu\n", (
ULONG
)
pAd
->
WnCous
.
RTSFauCou
.
u
.
LowPt
);

1650 
	`rtf
(
exa
+
	`
xa), "Rx sucs = %lu\n", (
ULONG
)
pAd
->
WnCous
.
ReivedFgmtCou
.
QuadPt
);

1651 
	`rtf
(
exa
+
	`
xa), "Rx wh CRC = %lu\n", (
ULONG
)
pAd
->
WnCous
.
FCSECou
.
u
.
LowPt
);

1652 
	`rtf
(
exa
+
	`
xa), "Rx dr dutouosour = %lu\n", (
ULONG
)
pAd
->
Cous8023
.
RxNoBufr
);

1653 
	`rtf
(
exa
+
	`
xa), "Rx dui fm = %lu\n", (
ULONG
)
pAd
->
WnCous
.
FmeDuiCou
.
u
.
LowPt
);

1655 
	`rtf
(
exa
+
	`
xa), "F CCA (ڐcd = %lu\n", (
ULONG
)
pAd
->
RkCous
.
OSecFCCAC
);

1657 #ifde
RALINK_ATE


1658 i(
	`ATE_ON
(
pAd
))

1660 i(
pAd
->
e
.
RxAS
 == 0)

1662 
	`rtf
(
exa
+
	`
xa), "RSSI-A = %ld\n", (
LONG
)(
pAd
->
e
.
LaRssi0
 -Ad->
BbpRssiToDbmD
));

1663 
	`rtf
(
exa
+
	`
xa), "RSSI-B (iavaab = %ld\n", (
LONG
)(
pAd
->
e
.
LaRssi1
 -Ad->
BbpRssiToDbmD
));

1664 
	`rtf
(
exa
+
	`
xa), "RSSI-C (iavaab = %ld\n\n", (
LONG
)(
pAd
->
e
.
LaRssi2
 -Ad->
BbpRssiToDbmD
));

1668 
	`rtf
(
exa
+
	`
xa), "RSSI = %ld\n", (
LONG
)(
pAd
->
e
.
LaRssi0
 -Ad->
BbpRssiToDbmD
));

1675 
	`rtf
(
exa
+
	`
xa), "RSSI-A = %ld\n", (
LONG
)(
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
 -Ad->
BbpRssiToDbmD
));

1676 
	`rtf
(
exa
+
	`
xa), "RSSI-B (iavaab = %ld\n", (
LONG
)(
pAd
->
SCfg
.
RssiSame
.
AvgRssi1
 -Ad->
BbpRssiToDbmD
));

1677 
	`rtf
(
exa
+
	`
xa), "RSSI-C (iavaab = %ld\n\n", (
LONG
)(
pAd
->
SCfg
.
RssiSame
.
AvgRssi2
 -Ad->
BbpRssiToDbmD
));

1678 
	`rtf
(
exa
+
	`
xa), "SNR-A = %ld\n", (
LONG
)(
pAd
->
SCfg
.
RssiSame
.
AvgS0
));

1679 
	`rtf
(
exa
+
	`
xa), "SNR-B (iavaab = %ld\n\n", (
LONG
)(
pAd
->
SCfg
.
RssiSame
.
AvgS1
)); }

1680 #ifde
WPA_SUPPLICANT_SUPPORT


1681 
	`rtf
(
exa
+
	`
xa), "WSuliUP = %d\n\n", 
pAd
->
SCfg
.
WSuliUP
);

1686 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

1687 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<=_ive_g_iics, wrq->ngth = %d\n", 
wrq
->
ngth
));

1689  
Stus
;

1690 
	}
}

1692 #ifde
DOT11_N_SUPPORT


1693 
	$gBaInfo
(

1694 
IN
 
PRTMP_ADAPTER
 
pAd
,

1695 
IN
 
PSTRING
 
pOutBuf
)

1697 
INT
 
i
, 
j
;

1698 
BA_ORI_ENTRY
 *
pOriBAEry
;

1699 
BA_REC_ENTRY
 *
pRecBAEry
;

1701 
i
=0; i<
MAX_LEN_OF_MAC_TABLE
; i++)

1703 
PMAC_TABLE_ENTRY
 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
i
];

1704 i(((
	`IS_ENTRY_CLIENT
(
pEry
|| 
	`IS_ENTRY_APCLI
Ery|| 
	`IS_ENTRY_TDLS
Ery)&& (pEry->
S
 =
SST_ASSOC
))

1705 || 
	`IS_ENTRY_WDS
(
pEry
|| 
	`IS_ENTRY_MESH
(pEntry))

1707 
	`rtf
(
pOutBuf
, "%s\n%02X:%02X:%02X:%02X:%02X:%02X (Aid = %d) (AP) -\n",

1708 
pOutBuf
,

1709 
pEry
->
Addr
[0],Entry->Addr[1],Entry->Addr[2],

1710 
pEry
->
Addr
[3],Ery->Addr[4],Ery->Addr[5],Ery->
Aid
);

1712 
	`rtf
(
pOutBuf
, "%s[Recipient]\n",OutBuf);

1713 
j
=0; j < 
NUM_OF_TID
; j++)

1715 i(
pEry
->
BARecWcidAay
[
j
] != 0)

1717 
pRecBAEry
 =&
pAd
->
BATab
.
BARecEry
[
pEry
->
BARecWcidAay
[
j
]];

1718 
	`rtf
(
pOutBuf
, "%sTID=%d, BAWSize=%d, LaIndSeq=%d, RedgPkts=%d\n",OutBuf, 
j
, 
pRecBAEry
->
BAWSize
,RecBAEry->
LaIndSeq
,RecBAEry->
li
.
qn
);

1721 
	`rtf
(
pOutBuf
, "%s\n",OutBuf);

1723 
	`rtf
(
pOutBuf
, "%s[Originator]\n",OutBuf);

1724 
j
=0; j < 
NUM_OF_TID
; j++)

1726 i(
pEry
->
BAOriWcidAay
[
j
] != 0)

1728 
pOriBAEry
 =&
pAd
->
BATab
.
BAOriEry
[
pEry
->
BAOriWcidAay
[
j
]];

1729 
	`rtf
(
pOutBuf
, "%sTID=%d, BAWSize=%d, SSeq=%d, CurTxSeq=%d\n",OutBuf, 
j
, 
pOriBAEry
->
BAWSize
,OriBAEry->
Sequ
, 
pEry
->
TxSeq
[j]);

1732 
	`rtf
(
pOutBuf
, "%s\n\n",OutBuf);

1734 i(
	`
(
pOutBuf
> (
IW_PRIV_SIZE_MASK
 - 100))

1739 
	}
}

1743 
	$_ive_show
(
t_devi
 *
dev
, 
iw_que_fo
 *
fo
,

1744 
iw_pot
 *
wrq
, 
PSTRING
 
exa
)

1746 
INT
 
Stus
 = 0;

1747 
PRTMP_ADAPTER
 
pAd
;

1748 
POS_COOKIE
 
pObj
;

1749 
u32
 
subcmd
 = 
wrq
->
ags
;

1751 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1753 i(
pAd
 =
NULL
)

1757  -
ENETDOWN
;

1761 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1763 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1764  -
ENETDOWN
;

1767 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

1768 i(
exa
 =
NULL
)

1770 
wrq
->
ngth
 = 0;

1771  -
EIO
;

1773 
	`memt
(
exa
, 0x00, 
IW_PRIV_SIZE_MASK
);

1776 
pObj
->
iol_if_ty
 = 
INT_MAIN
;

1777 
pObj
->
iol_if
 = 
MAIN_MBSSID
;

1780 
subcmd
)

1783 
SHOW_CONN_STATUS
:

1784 i(
	`MONITOR_ON
(
pAd
))

1786 #ifde
DOT11_N_SUPPORT


1787 i(
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
 &&

1788 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
)

1789 
	`rtf
(
exa
, "Mڙ Mode(CCh%d)\n", 
pAd
->
CommCfg
.
CChl
);

1792 
	`rtf
(
exa
, "Mڙ Mode(Ch%d)\n", 
pAd
->
CommCfg
.
Chl
);

1796 i(
pAd
->
IndiMedS
 =
NdisMedSCed
)

1798 i(
	`INFRA_ON
(
pAd
))

1800 
	`rtf
(
exa
, "Connected(AP: %s[%02X:%02X:%02X:%02X:%02X:%02X])\n",

1801 
pAd
->
CommCfg
.
Ssid
,

1802 
pAd
->
CommCfg
.
Bssid
[0],

1803 
pAd
->
CommCfg
.
Bssid
[1],

1804 
pAd
->
CommCfg
.
Bssid
[2],

1805 
pAd
->
CommCfg
.
Bssid
[3],

1806 
pAd
->
CommCfg
.
Bssid
[4],

1807 
pAd
->
CommCfg
.
Bssid
[5]);

1808 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("Ssid=%,Ssid%d\n",
pAd
->
CommCfg
.
Ssid
,Ad->CommCfg.
SsidL
));

1810 i(
	`ADHOC_ON
(
pAd
))

1811 
	`rtf
(
exa
, "Connected\n");

1815 
	`rtf
(
exa
, "Disconnected\n");

1816 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("ConnStatus isot connected\n"));

1819 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

1821 
SHOW_DRVIER_VERION
:

1822 
	`rtf
(
exa
, "Driv vsi-%s, %%s\n", 
STA_DRIVER_VERSION
, 
__DATE__
, 
__TIME__
 );

1823 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

1825 #ifde
DOT11_N_SUPPORT


1826 
SHOW_BA_INFO
:

1827 
	`gBaInfo
(
pAd
, 
exa
);

1828 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

1831 
SHOW_DESC_INFO
:

1833 
	`Show_DescInfo_Proc
(
pAd
, 
NULL
);

1834 
wrq
->
ngth
 = 0;

1837 
RAIO_OFF
:

1838 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

1840 i(
pAd
->
Mlme
.
ClMache
.
CuS
 !
CNTL_IDLE
)

1842 
	`RTMP_MLME_RESET_STATE_MACHINE
(
pAd
);

1843 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! MLME busy,eset MLME state machine !!!\n"));

1846 
pAd
->
SCfg
.
bSwRadio
 = 
FALSE
;

1847 i(
pAd
->
SCfg
.
bRadio
 !Ad->SCfg.
bHwRadio
 &&Ad->SCfg.
bSwRadio
))

1849 
pAd
->
SCfg
.
bRadio
 = (pAd->SCfg.
bHwRadio
 &&Ad->SCfg.
bSwRadio
);

1850 i(
pAd
->
SCfg
.
bRadio
 =
FALSE
)

1852 
	`MlmeRadioOff
(
pAd
);

1854 
pAd
->
ExaInfo
 = 
SW_RADIO_OFF
;

1857 
	`rtf
(
exa
, "Radio Off\n");

1858 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

1860 
RAIO_ON
:

1861 
pAd
->
SCfg
.
bSwRadio
 = 
TRUE
;

1864 
pAd
->
SCfg
.
bRadio
 = (pAd->SCfg.
bHwRadio
 &&Ad->SCfg.
bSwRadio
);

1865 i(
pAd
->
SCfg
.
bRadio
 =
TRUE
)

1867 
	`MlmeRadioOn
(
pAd
);

1869 
pAd
->
ExaInfo
 = 
EXTRA_INFO_CLEAR
;

1872 
	`rtf
(
exa
, "Radio On\n");

1873 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

1877 #ifde
QOS_DLS_SUPPORT


1878 
SHOW_DLS_ENTRY_INFO
:

1880 
	`S_DlsEryInfo_Diy_Proc
(
pAd
, 
NULL
);

1881 
wrq
->
ngth
 = 0;

1887 
SHOW_CFG_VALUE
:

1889 
Stus
 = 
	`RTMPShowCfgVue
(
pAd
, (
PSTRING

wrq
->
por
, 
exa
);

1890 i(
Stus
 == 0)

1891 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

1894 
SHOW_ADHOC_ENTRY_INFO
:

1895 
	`Show_Adhoc_MacTab_Proc
(
pAd
, 
exa
);

1896 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

1900 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%- unknow subcmd = %d\n", 
__FUNCTION__
, 
subcmd
));

1904  
Stus
;

1905 
	}
}

1907 #ifde
SIOCSIWMLME


1908 
	$_iol_siwmlme
(
t_devi
 *
dev
,

1909 
iw_que_fo
 *
fo
,

1910 
iwq_da
 *
wrqu
,

1911 *
exa
)

1913 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1914 
iw_mlme
 *
pMlme
 = (iw_mlm*)
wrqu
->
da
.
por
;

1916 
MLME_QUEUE_ELEM
 *
pMsgEm
 = 
NULL
;

1917 
MLME_DISASSOC_REQ_STRUCT
 
DisAssocReq
;

1918 
MLME_DEAUTH_REQ_STRUCT
 
DeAuthReq
;

1920 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1922 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====> %s\n", 
__FUNCTION__
));

1925 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1927 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1928  -
ENETDOWN
;

1931 i(
pMlme
 =
NULL
)

1932  -
EINVAL
;

1935 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
pMsgEm
, (
MLME_QUEUE_ELEM
));

1936 i(
pMsgEm
 =
NULL
)

1938 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: Ao memy fa!!!\n", 
__FUNCTION__
));

1939  -
ENOMEM
;

1942 
pMlme
->
cmd
)

1944 #ifde
IW_MLME_DEAUTH


1945 
IW_MLME_DEAUTH
:

1946 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====> %- IW_MLME_DEAUTH\n", 
__FUNCTION__
));

1947 
	`COPY_MAC_ADDR
(
DeAuthReq
.
Addr
, 
pAd
->
CommCfg
.
Bssid
);

1948 
DeAuthReq
.
Rs
 = 
pMlme
->
as_code
;

1949 
pMsgEm
->
MsgL
 = (
MLME_DEAUTH_REQ_STRUCT
);

1950 
	`NdisMoveMemy
(
pMsgEm
->
Msg
, &
DeAuthReq
, (
MLME_DEAUTH_REQ_STRUCT
));

1951 
	`MlmeDuthReqAi
(
pAd
, 
pMsgEm
);

1952 i(
	`INFRA_ON
(
pAd
))

1954 
	`LkDown
(
pAd
, 
FALSE
);

1955 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

1959 #ifde
IW_MLME_DISASSOC


1960 
IW_MLME_DISASSOC
:

1961 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====> %- IW_MLME_DISASSOC\n", 
__FUNCTION__
));

1962 
	`COPY_MAC_ADDR
(
DisAssocReq
.
Addr
, 
pAd
->
CommCfg
.
Bssid
);

1963 
DisAssocReq
.
Rs
 = 
pMlme
->
as_code
;

1965 
pMsgEm
->
Mache
 = 
ASSOC_STATE_MACHINE
;

1966 
pMsgEm
->
MsgTy
 = 
MT2_MLME_DISASSOC_REQ
;

1967 
pMsgEm
->
MsgL
 = (
MLME_DISASSOC_REQ_STRUCT
);

1968 
	`NdisMoveMemy
(
pMsgEm
->
Msg
, &
DisAssocReq
, (
MLME_DISASSOC_REQ_STRUCT
));

1970 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_DISASSOC
;

1971 
	`MlmeDissocReqAi
(
pAd
, 
pMsgEm
);

1975 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====> %- Unknow Commd\n", 
__FUNCTION__
));

1979 i(
pMsgEm
 !
NULL
)

1980 
	`os__mem
(
NULL
, 
pMsgEm
);

1983 
	}
}

1986 #i
WIRELESS_EXT
 > 17

1989 
	$_iol_siwauth
(
t_devi
 *
dev
,

1990 
iw_que_fo
 *
fo
,

1991 
iwq_da
 *
wrqu
, *
exa
)

1993 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

1994 
iw_m
 *
m
 = &
wrqu
->param;

1996 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

1999 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2001 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

2002  -
ENETDOWN
;

2004 
m
->
ags
 & 
IW_AUTH_INDEX
) {

2005 
IW_AUTH_WPA_VERSION
:

2006 i(
m
->
vue
 =
IW_AUTH_WPA_VERSION_WPA
)

2008 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPAPSK
;

2009 i(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
)

2010 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPANe
;

2012 i(
m
->
vue
 =
IW_AUTH_WPA_VERSION_WPA2
)

2013 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPA2PSK
;

2015 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_AUTH_WPA_VERSION -am->vu%d!\n", 
__FUNCTION__
, 
m
->
vue
));

2017 
IW_AUTH_CIPHER_PAIRWISE
:

2018 i(
m
->
vue
 =
IW_AUTH_CIPHER_NONE
)

2020 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11WEPDibd
;

2021 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11WEPDibd
;

2023 i(
m
->
vue
 =
IW_AUTH_CIPHER_WEP40
 ||

2024 
m
->
vue
 =
IW_AUTH_CIPHER_WEP104
)

2026 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11WEPEbd
;

2027 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11WEPEbd
;

2028 #ifde
WPA_SUPPLICANT_SUPPORT


2029 
pAd
->
SCfg
.
IEEE8021X
 = 
FALSE
;

2032 i(
m
->
vue
 =
IW_AUTH_CIPHER_TKIP
)

2034 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11Enyi2Ebd
;

2035 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11Enyi2Ebd
;

2037 i(
m
->
vue
 =
IW_AUTH_CIPHER_CCMP
)

2039 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11Enyi3Ebd
;

2040 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11Enyi3Ebd
;

2042 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_AUTH_CIPHER_PAIRWISE -am->vu%d!\n", 
__FUNCTION__
, 
m
->
vue
));

2044 
IW_AUTH_CIPHER_GROUP
:

2045 i(
m
->
vue
 =
IW_AUTH_CIPHER_NONE
)

2047 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11WEPDibd
;

2049 i(
m
->
vue
 =
IW_AUTH_CIPHER_WEP40
)

2051 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11GroupWEP40Ebd
;

2053 i(
m
->
vue
 =
IW_AUTH_CIPHER_WEP104
)

2055 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11GroupWEP104Ebd
;

2057 i(
m
->
vue
 =
IW_AUTH_CIPHER_TKIP
)

2059 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11Enyi2Ebd
;

2061 i(
m
->
vue
 =
IW_AUTH_CIPHER_CCMP
)

2063 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11Enyi3Ebd
;

2065 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_AUTH_CIPHER_GROUP -am->vu%d!\n", 
__FUNCTION__
, 
m
->
vue
));

2067 
IW_AUTH_KEY_MGMT
:

2068 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


2069 
pAd
->
SCfg
.
WSuliUP
 &= 0x7F;

2071 i(
m
->
vue
 =
IW_AUTH_KEY_MGMT_802_1X
)

2073 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
)

2075 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPA
;

2076 #ifde
WPA_SUPPLICANT_SUPPORT


2077 
pAd
->
SCfg
.
IEEE8021X
 = 
FALSE
;

2080 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
)

2082 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPA2
;

2083 #ifde
WPA_SUPPLICANT_SUPPORT


2084 
pAd
->
SCfg
.
IEEE8021X
 = 
FALSE
;

2087 #ifde
WPA_SUPPLICANT_SUPPORT


2090 
pAd
->
SCfg
.
IEEE8021X
 = 
TRUE
;

2093 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


2095 i(
m
->
vue
 == 0)

2098 
	`STA_PORT_SECURED
(
pAd
);

2100 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_AUTH_KEY_MGMT -am->vu%d!\n", 
__FUNCTION__
, 
m
->
vue
));

2102 
IW_AUTH_RX_UNENCRYPTED_EAPOL
:

2104 
IW_AUTH_PRIVACY_INVOKED
:

2112 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_AUTH_PRIVACY_INVOKED -am->vu%d!\n", 
__FUNCTION__
, 
m
->
vue
));

2114 
IW_AUTH_DROP_UNENCRYPTED
:

2115 i(
m
->
vue
 != 0)

2116 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_NOT_SECURED
;

2120 
	`STA_PORT_SECURED
(
pAd
);

2122 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_AUTH_DROP_UNENCRYPTED -am->vu%d!\n", 
__FUNCTION__
, 
m
->
vue
));

2124 
IW_AUTH_80211_AUTH_ALG
:

2125 i(
m
->
vue
 =
IW_AUTH_ALG_OPEN_SYSTEM
)

2126 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeOn
;

2127 i(
m
->
vue
 =
IW_AUTH_ALG_SHARED_KEY
)

2128 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeShed
;

2130 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeAutoSwch
;

2131 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_AUTH_80211_AUTH_ALG -am->vu%d!\n", 
__FUNCTION__
, 
m
->
vue
));

2133 
IW_AUTH_WPA_ENABLED
:

2134 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_AUTH_WPA_ENABLED - Driv sutWPA!լam->vu%d)\n", 
__FUNCTION__
, 
m
->
vue
));

2137  -
EOPNOTSUPP
;

2141 
	}
}

2143 
	$_iol_giwauth
(
t_devi
 *
dev
,

2144 
iw_que_fo
 *
fo
,

2145 
iwq_da
 *
wrqu
, *
exa
)

2147 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

2148 
iw_m
 *
m
 = &
wrqu
->param;

2150 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

2153 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2155 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

2156  -
ENETDOWN
;

2159 
m
->
ags
 & 
IW_AUTH_INDEX
) {

2160 
IW_AUTH_DROP_UNENCRYPTED
:

2161 
m
->
vue
 = (
pAd
->
SCfg
.
WStus
 =
Ndis802_11WEPDibd
) ? 0 : 1;

2164 
IW_AUTH_80211_AUTH_ALG
:

2165 
m
->
vue
 = (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeShed
? 
IW_AUTH_ALG_SHARED_KEY
 : 
IW_AUTH_ALG_OPEN_SYSTEM
;

2168 
IW_AUTH_WPA_ENABLED
:

2169 
m
->
vue
 = (
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
) ? 1 : 0;

2173  -
EOPNOTSUPP
;

2175 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("_iol_giwauth::m->vu%d!\n", 
m
->
vue
));

2177 
	}
}

2179 
	$SChKey
(

2180 
IN
 
PRTMP_ADAPTER
 
pAd
,

2181 
IN
 
INT
 
keyIdx
,

2182 
IN
 
UCHAR
 
ChAlg
,

2183 
IN
 
BOOLEAN
 
bGTK
,

2184 
IN
 
iw_code_ext
 *
ext
)

2186 
	`NdisZoMemy
(&
pAd
->
ShedKey
[
BSS0
][
keyIdx
], (
CIPHER_KEY
));

2187 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
KeyL
 = 
LEN_TK
;

2188 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
Key
, 
ext
->
key
, 
LEN_TK
);

2189 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
TxMic
, 
ext
->
key
 + 
LEN_TK
, 
LEN_TKIP_MIC
);

2190 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
RxMic
, 
ext
->
key
 + 
LEN_TK
 + 
LEN_TKIP_MIC
, LEN_TKIP_MIC);

2191 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
ChAlg
 = CipherAlg;

2194 
	`AsicAddShedKeyEry
(
pAd
,

2195 
BSS0
,

2196 
keyIdx
,

2197 &
pAd
->
ShedKey
[
BSS0
][
keyIdx
]);

2200 i(!
bGTK
)

2201 
	`RTMPSWcidSecuryInfo
(
pAd
,

2202 
BSS0
,

2203 
keyIdx
,

2204 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
ChAlg
,

2205 
BSSID_WCID
,

2206 
SHAREDKEYTABLE
);

2207 
	}
}

2209 
	$_iol_siwcodxt
(
t_devi
 *
dev
,

2210 
iw_que_fo
 *
fo
,

2211 
iwq_da
 *
wrqu
,

2212 *
exa
)

2214 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

2215 
iw_pot
 *
codg
 = &
wrqu
->encoding;

2216 
iw_code_ext
 *
ext
 = (iw_code_ex*)
exa
;

2217 
keyIdx
, 
g
 = 
ext
->alg;

2219 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

2222 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2224 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

2225  -
ENETDOWN
;

2228 i(
codg
->
ags
 & 
IW_ENCODE_DISABLED
)

2230 
keyIdx
 = (
codg
->
ags
 & 
IW_ENCODE_INDEX
) - 1;

2232 
	`AsicRemovePawiKeyEry
(
pAd
, 
BSSID_WCID
);

2233 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
KeyL
 = 0;

2234 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
ChAlg
 = 
CIPHER_NONE
;

2235 
	`AsicRemoveShedKeyEry
(
pAd
, 0, (
UCHAR
)
keyIdx
);

2236 
	`NdisZoMemy
(&
pAd
->
ShedKey
[
BSS0
][
keyIdx
], (
CIPHER_KEY
));

2237 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::Removkeys!ncodg->ag%x)\n", 
__FUNCTION__
, 
codg
->
ags
));

2242 
keyIdx
 = (
codg
->
ags
 & 
IW_ENCODE_INDEX
) - 1;

2243 if((
keyIdx
 < 0|| (keyIdx >
NR_WEP_KEYS
))

2244  -
EINVAL
;

2246 i(
ext
->
ext_ags
 & 
IW_ENCODE_EXT_SET_TX_KEY
)

2248 
pAd
->
SCfg
.
DeuKeyId
 = 
keyIdx
;

2249 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::DeuKeyId = %d\n", 
__FUNCTION__
, 
pAd
->
SCfg
.
DeuKeyId
));

2252 
g
) {

2253 
IW_ENCODE_ALG_NONE
:

2254 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_ENCODE_ALG_NONE\n", 
__FUNCTION__
));

2256 
IW_ENCODE_ALG_WEP
:

2257 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_ENCODE_ALG_WEP -xt->key_%d, keyIdx = %d\n", 
__FUNCTION__
, 
ext
->
key_n
, 
keyIdx
));

2258 i(
ext
->
key_n
 =
MAX_WEP_KEY_SIZE
)

2260 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
KeyL
 = 
MAX_WEP_KEY_SIZE
;

2261 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
ChAlg
 = 
CIPHER_WEP128
;

2263 i(
ext
->
key_n
 =
MIN_WEP_KEY_SIZE
)

2265 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
KeyL
 = 
MIN_WEP_KEY_SIZE
;

2266 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
ChAlg
 = 
CIPHER_WEP64
;

2269  -
EINVAL
;

2271 
	`NdisZoMemy
(
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
Key
, 16);

2272 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
Key
, 
ext
->
key
,xt->
key_n
);

2274 i((
pAd
->
SCfg
.
GroupCh
 =
Ndis802_11GroupWEP40Ebd
) ||

2275 (
pAd
->
SCfg
.
GroupCh
 =
Ndis802_11GroupWEP104Ebd
))

2278 
	`AsicAddShedKeyEry
(
pAd
, 
BSS0
, 
keyIdx
, &pAd->
ShedKey
[BSS0][keyIdx]);

2281 
	`RTMPSWcidSecuryInfo
(
pAd
,

2282 
BSS0
,

2283 
keyIdx
,

2284 
pAd
->
ShedKey
[
BSS0
][
keyIdx
].
ChAlg
,

2285 
BSSID_WCID
,

2286 
SHAREDKEYTABLE
);

2287 
	`STA_PORT_SECURED
(
pAd
);

2290 
IW_ENCODE_ALG_TKIP
:

2291 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s::IW_ENCODE_ALG_TKIP - keyIdx = %d,xt->key_%d\n", 
__FUNCTION__
, 
keyIdx
, 
ext
->
key_n
));

2292 i(
ext
->
key_n
 == 32)

2294 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPANe
)

2296 
	`RTMPZoMemy
(
pAd
->
SCfg
.
PMK
, 
LEN_PMK
);

2297 
	`RTMPMoveMemy
(
pAd
->
SCfg
.
PMK
, 
ext
->
key
,xt->
key_n
);

2301 i(
ext
->
ext_ags
 & 
IW_ENCODE_EXT_SET_TX_KEY
)

2303 
	`SChKey
(
pAd
, 
keyIdx
, 
CIPHER_TKIP
, 
FALSE
, 
ext
);

2304 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA2
)

2306 
	`STA_PORT_SECURED
(
pAd
);

2309 i(
ext
->
ext_ags
 & 
IW_ENCODE_EXT_GROUP_KEY
)

2311 
	`SChKey
(
pAd
, 
keyIdx
, 
CIPHER_TKIP
, 
TRUE
, 
ext
);

2314 
	`STA_PORT_SECURED
(
pAd
);

2319  -
EINVAL
;

2321 
IW_ENCODE_ALG_CCMP
:

2322 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPANe
)

2324 
	`RTMPZoMemy
(
pAd
->
SCfg
.
PMK
, 
LEN_PMK
);

2325 
	`RTMPMoveMemy
(
pAd
->
SCfg
.
PMK
, 
ext
->
key
,xt->
key_n
);

2329 i(
ext
->
ext_ags
 & 
IW_ENCODE_EXT_SET_TX_KEY
)

2331 
	`SChKey
(
pAd
, 
keyIdx
, 
CIPHER_AES
, 
FALSE
, 
ext
);

2332 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA2
)

2333 
	`STA_PORT_SECURED
(
pAd
);

2335 i(
ext
->
ext_ags
 & 
IW_ENCODE_EXT_GROUP_KEY
)

2337 
	`SChKey
(
pAd
, 
keyIdx
, 
CIPHER_AES
, 
TRUE
, 
ext
);

2340 
	`STA_PORT_SECURED
(
pAd
);

2345  -
EINVAL
;

2350 
	}
}

2353 
	$_iol_giwcodxt
(
t_devi
 *
dev
,

2354 
iw_que_fo
 *
fo
,

2355 
iwq_da
 *
wrqu
, *
exa
)

2357 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

2358 
PCHAR
 
pKey
 = 
NULL
;

2359 
iw_pot
 *
codg
 = &
wrqu
->encoding;

2360 
iw_code_ext
 *
ext
 = (iw_code_ex*)
exa
;

2361 
idx
, 
max_key_n
;

2363 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

2365 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("===>t_ioctl_giwencodeext\n"));

2368 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2370 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

2371  -
ENETDOWN
;

2374 
max_key_n
 = 
codg
->
ngth
 - (*
ext
);

2375 i(
max_key_n
 < 0)

2376  -
EINVAL
;

2378 
idx
 = 
codg
->
ags
 & 
IW_ENCODE_INDEX
;

2379 i(
idx
)

2381 i(
idx
 < 1 || idx > 4)

2382  -
EINVAL
;

2383 
idx
--;

2385 i((
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi2Ebd
) ||

2386 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi3Ebd
))

2388 i(
idx
 !
pAd
->
SCfg
.
DeuKeyId
)

2390 
ext
->
key_n
 = 0;

2396 
idx
 = 
pAd
->
SCfg
.
DeuKeyId
;

2398 
codg
->
ags
 = 
idx
 + 1;

2399 
	`memt
(
ext
, 0, (*ext));

2401 
ext
->
key_n
 = 0;

2402 
pAd
->
SCfg
.
WStus
) {

2403 
Ndis802_11WEPDibd
:

2404 
ext
->
g
 = 
IW_ENCODE_ALG_NONE
;

2405 
codg
->
ags
 |
IW_ENCODE_DISABLED
;

2407 
Ndis802_11WEPEbd
:

2408 
ext
->
g
 = 
IW_ENCODE_ALG_WEP
;

2409 i(
pAd
->
ShedKey
[
BSS0
][
idx
].
KeyL
 > 
max_key_n
)

2410  -
E2BIG
;

2413 
ext
->
key_n
 = 
pAd
->
ShedKey
[
BSS0
][
idx
].
KeyL
;

2414 
pKey
 = (
PCHAR
)&(
pAd
->
ShedKey
[
BSS0
][
idx
].
Key
[0]);

2417 
Ndis802_11Enyi2Ebd
:

2418 
Ndis802_11Enyi3Ebd
:

2419 i(
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi2Ebd
)

2420 
ext
->
g
 = 
IW_ENCODE_ALG_TKIP
;

2422 
ext
->
g
 = 
IW_ENCODE_ALG_CCMP
;

2424 i(
max_key_n
 < 32)

2425  -
E2BIG
;

2428 
ext
->
key_n
 = 32;

2429 
pKey
 = (
PCHAR
)&
pAd
->
SCfg
.
PMK
[0];

2433  -
EINVAL
;

2436 i(
ext
->
key_n
 && 
pKey
)

2438 
codg
->
ags
 |
IW_ENCODE_ENABLED
;

2439 
	`memy
(
ext
->
key
, 
pKey
,xt->
key_n
);

2443 
	}
}

2445 #ifde
SIOCSIWGENIE


2446 
	$_iol_siwg
(
t_devi
 *
dev
,

2447 
iw_que_fo
 *
fo
,

2448 
iwq_da
 *
wrqu
, *
exa
)

2450 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

2452 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

2455 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2457 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

2458  -
ENETDOWN
;

2460 #ifde
WPA_SUPPLICANT_SUPPORT


2461 i(
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
)

2463 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("===>t_ioctl_siwgenie\n"));

2464 
pAd
->
SCfg
.
bRSN_IE_FromWSuli
 = 
FALSE
;

2465 i((
wrqu
->
da
.
ngth
 > 0) &&

2466 (
exa
 =
NULL
))

2468  -
EINVAL
;

2470 i(
wrqu
->
da
.
ngth
)

2472 i(
pAd
->
SCfg
.
pWAssocIe
)

2474 
	`k
(
pAd
->
SCfg
.
pWAssocIe
);

2475 
pAd
->
SCfg
.
pWAssocIe
 = 
NULL
;

2477 
pAd
->
SCfg
.
pWAssocIe
 = 
	`kmloc
(
wrqu
->
da
.
ngth
, 
MEM_ALLOC_FLAG
);

2478 i(
pAd
->
SCfg
.
pWAssocIe
)

2480 
pAd
->
SCfg
.
WAssocIeL
 = 
wrqu
->
da
.
ngth
;

2481 
	`NdisMoveMemy
(
pAd
->
SCfg
.
pWAssocIe
, 
exa
,Ad->SCfg.
WAssocIeL
);

2482 
pAd
->
SCfg
.
bRSN_IE_FromWSuli
 = 
TRUE
;

2485 
pAd
->
SCfg
.
WAssocIeL
 = 0;

2491  -
EOPNOTSUPP
;

2492 
	}
}

2495 
	$_iol_giwg
(
t_devi
 *
dev
,

2496 
iw_que_fo
 *
fo
,

2497 
iwq_da
 *
wrqu
, *
exa
)

2499 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

2501 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

2504 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2506 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

2507  -
ENETDOWN
;

2510 i((
pAd
->
SCfg
.
RSNIE_L
 == 0) ||

2511 (
pAd
->
SCfg
.
AuthMode
 < 
Ndis802_11AuthModeWPA
))

2513 
wrqu
->
da
.
ngth
 = 0;

2517 #ifde
WPA_SUPPLICANT_SUPPORT


2518 #ifde
SIOCSIWGENIE


2519 i((
pAd
->
SCfg
.
WSuliUP
 & 0x7F=
WPA_SUPPLICANT_ENABLE
 &&

2520 (
pAd
->
SCfg
.
WAssocIeL
 > 0))

2522 i(
wrqu
->
da
.
ngth
 < 
pAd
->
SCfg
.
WAssocIeL
)

2523  -
E2BIG
;

2525 
wrqu
->
da
.
ngth
 = 
pAd
->
SCfg
.
WAssocIeL
;

2526 
	`memy
(
exa
, 
pAd
->
SCfg
.
pWAssocIe
,Ad->SCfg.
WAssocIeL
);

2532 
UCHAR
 
RSNIe
 = 
IE_WPA
;

2534 i(
wrqu
->
da
.
ngth
 < (
pAd
->
SCfg
.
RSNIE_L
 + 2))

2535  -
E2BIG
;

2536 
wrqu
->
da
.
ngth
 = 
pAd
->
SCfg
.
RSNIE_L
 + 2;

2538 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
) ||

2539 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
))

2540 
RSNIe
 = 
IE_RSN
;

2542 
exa
[0] = ()
RSNIe
;

2543 
exa
[1] = 
pAd
->
SCfg
.
RSNIE_L
;

2544 
	`memy
(
exa
+2, &
pAd
->
SCfg
.
RSN_IE
[0],Ad->SCfg.
RSNIE_L
);

2548 
	}
}

2550 
	$_iol_siwpmk
(
t_devi
 *
dev
,

2551 
iw_que_fo
 *
fo
,

2552 
iwq_da
 *
wrqu
,

2553 *
exa
)

2555 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

2556 
iw_pmk
 *
pPmk
 = (iw_pmk *)
wrqu
->
da
.
por
;

2557 
INT
 
CachedIdx
 = 0, 
idx
 = 0;

2559 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

2562 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2564 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

2565  -
ENETDOWN
;

2568 i(
pPmk
 =
NULL
)

2569  -
EINVAL
;

2571 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("===>t_ioctl_siwpmksa\n"));

2572 
pPmk
->
cmd
)

2574 
IW_PMKSA_FLUSH
:

2575 
	`NdisZoMemy
(
pAd
->
SCfg
.
SavedPMK
, (
BSSID_INFO
)*
PMKID_NO
);

2576 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("rt_ioctl_siwpmksa - IW_PMKSA_FLUSH\n"));

2578 
IW_PMKSA_REMOVE
:

2579 
CachedIdx
 = 0; CachedIdx < 
pAd
->
SCfg
.
SavedPMKNum
; CachedIdx++)

2582 i(
	`NdisEquMemy
(
pPmk
->
bssid
.
_da
, 
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
].
BSSID
, 
MAC_ADDR_LEN
))

2584 
	`NdisZoMemy
(
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
].
BSSID
, 
MAC_ADDR_LEN
);

2585 
	`NdisZoMemy
(
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
].
PMKID
, 16);

2586 
idx
 = 
CachedIdx
; idx < (
pAd
->
SCfg
.
SavedPMKNum
 - 1); idx++)

2588 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
SavedPMK
[
idx
].
BSSID
[0], &pAd->SCfg.SavedPMK[idx+1].BSSID[0], 
MAC_ADDR_LEN
);

2589 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
SavedPMK
[
idx
].
PMKID
[0], &pAd->StaCfg.SavedPMK[idx+1].PMKID[0], 16);

2591 
pAd
->
SCfg
.
SavedPMKNum
--;

2596 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("rt_ioctl_siwpmksa - IW_PMKSA_REMOVE\n"));

2598 
IW_PMKSA_ADD
:

2599 
CachedIdx
 = 0; CachedIdx < 
pAd
->
SCfg
.
SavedPMKNum
; CachedIdx++)

2602 i(
	`NdisEquMemy
(
pPmk
->
bssid
.
_da
, 
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
].
BSSID
, 
MAC_ADDR_LEN
))

2607 i(
CachedIdx
 < 
PMKID_NO
)

2609 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("UpdPMKID, idx = %d\n", 
CachedIdx
));

2610 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
].
BSSID
[0], 
pPmk
->
bssid
.
_da
, 
MAC_ADDR_LEN
);

2611 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
].
PMKID
[0], 
pPmk
->
pmkid
, 16);

2612 
pAd
->
SCfg
.
SavedPMKNum
++;

2618 
CachedIdx
 = (
pPmk
->
bssid
.
_da
[5] % 
PMKID_NO
);

2619 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("UpdPMKID, idx = %d\n", 
CachedIdx
));

2620 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
].
BSSID
[0], 
pPmk
->
bssid
.
_da
, 
MAC_ADDR_LEN
);

2621 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
].
PMKID
[0], 
pPmk
->
pmkid
, 16);

2624 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("rt_ioctl_siwpmksa - IW_PMKSA_ADD\n"));

2627 
	`DBGPRINT
(
RT_DEBUG_TRACE
 ,("rt_ioctl_siwpmksa - Unknow Command!!\n"));

2632 
	}
}

2635 #ifde
DBG


2637 
	$_ive_iol_bbp
(
t_devi
 *
dev
, 
iw_que_fo
 *
fo
,

2638 
iw_pot
 *
wrq
, *
exa
)

2640 
PSTRING
 
this_ch
;

2641 
PSTRING
 
vue
 = 
NULL
;

2642 
UCHAR
 
gBBP
 = 0;

2644 
UINT32
 
bbpId
;

2645 
UINT32
 
bbpVue
;

2646 
BOOLEAN
 
bIsPrtABBP
 = 
FALSE
;

2647 
INT
 
Stus
 = 0;

2648 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

2650 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

2653 
	`memt
(
exa
, 0x00, 
IW_PRIV_SIZE_MASK
);

2655 i(
wrq
->
ngth
 > 1)

2657 
	`rtf
(
exa
, "\n");

2660 
this_ch
 = 
wrq
->
por
;

2661 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("this_ch=%s\n", 
this_ch
));

2662 i(!*
this_ch
)

2663 
xt
;

2665 i((
vue
 = 
	`rchr
(
this_ch
, '=')!
NULL
)

2666 *
vue
++ = 0;

2668 i(!
vue
 || !*value)

2670 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("this_ch=%s, vue=%s\n", 
this_ch
, 
vue
));

2671 i(
	`ssnf
(
this_ch
, "%d", &(
bbpId
)) == 1)

2673 i(
bbpId
 <
MAX_BBP_ID
)

2675 #ifde
RALINK_ATE


2676 i(
	`ATE_ON
(
pAd
))

2678 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
bbpId
, &
gBBP
);

2683 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
bbpId
, &
gBBP
);

2685 
	`rtf
(
exa
+
	`
xa), "R%02d[0x%02X]:%02X\n", 
bbpId
, bbpId, 
gBBP
);

2686 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

2687 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("msg=%s\n", 
exa
));

2691 
bIsPrtABBP
 = 
TRUE
;

2692 
xt
;

2697 
bIsPrtABBP
 = 
TRUE
;

2698 
xt
;

2703 i((
	`ssnf
(
this_ch
, "%d", &(
bbpId
)=1&& (ssnf(
vue
, "%x", &(
bbpVue
)) == 1))

2705 i(
bbpId
 <
MAX_BBP_ID
)

2707 #ifde
RALINK_ATE


2708 i(
	`ATE_ON
(
pAd
))

2710 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
bbpId
, 
bbpVue
);

2712 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
bbpId
, &
gBBP
);

2717 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
bbpId
, 
bbpVue
);

2719 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
bbpId
, &
gBBP
);

2721 
	`rtf
(
exa
+
	`
xa), "R%02d[0x%02X]:%02X\n", 
bbpId
, bbpId, 
gBBP
);

2722 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

2723 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("msg=%s\n", 
exa
));

2727 
bIsPrtABBP
 = 
TRUE
;

2728 
xt
;

2733 
bIsPrtABBP
 = 
TRUE
;

2734 
xt
;

2739 
bIsPrtABBP
 = 
TRUE
;

2741 
xt
:

2742 i(
bIsPrtABBP
)

2744 
	`memt
(
exa
, 0x00, 
IW_PRIV_SIZE_MASK
);

2745 
	`rtf
(
exa
, "\n");

2746 
bbpId
 = 0; bbpId <
MAX_BBP_ID
; bbpId++)

2748 i(
	`
(
exa
>(
IW_PRIV_SIZE_MASK
 - 20))

2750 #ifde
RALINK_ATE


2751 i(
	`ATE_ON
(
pAd
))

2753 
	`ATE_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
bbpId
, &
gBBP
);

2757 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
bbpId
, &
gBBP
);

2758 
	`rtf
(
exa
+
	`
xa), "R%02d[0x%02X]:%02X ", 
bbpId
, bbpId, 
gBBP
);

2759 i(
bbpId
%5 == 4)

2760 
	`rtf
(
exa
+
	`
xa), "%03d = %02X\n", 
bbpId
, 
gBBP
);

2763 
wrq
->
ngth
 = 
	`
(
exa
) + 1;

2764 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("wrq->ngth = %d\n", 
wrq
->
ngth
));

2767 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<==rt_private_ioctl_bbp\n\n"));

2769  
Stus
;

2770 
	}
}

2773 
	$_iol_siw
(
t_devi
 *
dev
,

2774 
iw_que_fo
 *
fo
,

2775 
iwq_da
 *
wrqu
, *
exa
)

2777 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

2778 
UINT32
 

 = 
wrqu
->
b
.
vue
, 
fixed
 = wrqu->bitrate.fixed;

2780 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

2783 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2785 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("rt_ioctl_siwrate::Network is down!\n"));

2786  -
ENETDOWN
;

2789 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("_iol_siw::ԩ%d, fixed = %d)\n", 

, 
fixed
));

2793 i(

 == -1)

2796 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_AUTO
;

2797 
pAd
->
SCfg
.
bAutoTxReSwch
 = 
TRUE
;

2798 i((
pAd
->
CommCfg
.
PhyMode
 <
PHY_11G
) ||

2799 (
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
MODE
 <
MODE_OFDM
))

2800 
	`RTMPSDesedRes
(
pAd
, -1);

2802 #ifde
DOT11_N_SUPPORT


2803 
	`SCommHT
(
pAd
);

2808 i(
fixed
)

2810 
pAd
->
SCfg
.
bAutoTxReSwch
 = 
FALSE
;

2811 i((
pAd
->
CommCfg
.
PhyMode
 <
PHY_11G
) ||

2812 (
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
MODE
 <
MODE_OFDM
))

2813 
	`RTMPSDesedRes
(
pAd
, 

);

2816 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 = 
MCS_AUTO
;

2817 #ifde
DOT11_N_SUPPORT


2818 
	`SCommHT
(
pAd
);

2821 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("_iol_siw::(HtMcs=%d)\n",
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
));

2826  -
EOPNOTSUPP
;

2831 
	}
}

2833 
	$_iol_giw
(
t_devi
 *
dev
,

2834 
iw_que_fo
 *
fo
,

2835 
iwq_da
 *
wrqu
, *
exa
)

2837 
PRTMP_ADAPTER
 
pAd
 = 
NULL
;

2838 
_dex
 = 0, 
_cou
 = 0;

2839 
HTTRANSMIT_SETTING
 
ht_g
;

2841 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
dev
);

2843 
_cou
 = 
RT_ReSize
/(
__s32
);

2845 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

2847 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

2848  -
ENETDOWN
;

2851 i((
pAd
->
SCfg
.
bAutoTxReSwch
 =
FALSE
) &&

2852 (
	`INFRA_ON
(
pAd
)) &&

2853 ((
pAd
->
CommCfg
.
PhyMode
 <
PHY_11G
|| (pAd->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
MODE
 <
MODE_OFDM
)))

2854 
ht_g
.
wd
 = 
pAd
->
SCfg
.
HTPhyMode
.word;

2856 
ht_g
.
wd
 = 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.word;

2858 #ifde
DOT11_N_SUPPORT


2859 i(
ht_g
.
fld
.
MODE
 >
MODE_HTMIX
)

2862 
_dex
 = 12 + ((
UCHAR
)
ht_g
.
fld
.
BW
 *24+ ((UCHAR)ht_g.fld.
ShtGI
 *48+ ((UCHAR)ht_g.fld.
MCS
);

2866 i(
ht_g
.
fld
.
MODE
 =
MODE_OFDM
)

2867 
_dex
 = (
UCHAR
)(
ht_g
.
fld
.
MCS
) + 4;

2868 i(
ht_g
.
fld
.
MODE
 =
MODE_CCK
)

2869 
_dex
 = (
UCHAR
)(
ht_g
.
fld
.
MCS
);

2871 i(
_dex
 < 0)

2872 
_dex
 = 0;

2874 i(
_dex
 >
_cou
)

2875 
_dex
 = 
_cou
-1;

2877 
wrqu
->
b
.
vue
 = 
lk
[
_dex
] * 500000;

2878 
wrqu
->
b
.
dibd
 = 0;

2881 
	}
}

2883 cڡ 
iw_hdr
 
	g_hdr
[] =

2885 (
iw_hdr

NULL
,

2886 (
iw_hdr

_iol_giwme
,

2887 (
iw_hdr

NULL
,

2888 (
iw_hdr

NULL
,

2889 (
iw_hdr

_iol_siweq
,

2890 (
iw_hdr

_iol_giweq
,

2891 (
iw_hdr

_iol_siwmode
,

2892 (
iw_hdr

_iol_giwmode
,

2893 (
iw_hdr

NULL
,

2894 (
iw_hdr

NULL
,

2895 (
iw_hdr

NULL
 ,

2896 (
iw_hdr

_iol_giwnge
,

2897 (
iw_hdr

NULL
 ,

2898 (
iw_hdr

NULL
 ,

2899 (
iw_hdr

NULL
 ,

2900 (
iw_hdr

28xx_g_wess_s
 ,

2901 (
iw_hdr

NULL
,

2902 (
iw_hdr

NULL
,

2903 (
iw_hdr

NULL
,

2904 (
iw_hdr

NULL
,

2905 (
iw_hdr

_iol_siw
,

2906 (
iw_hdr

_iol_giw
,

2907 #ifde
SIOCSIWMLME


2908 (
iw_hdr

_iol_siwmlme
,

2910 (
iw_hdr

NULL
,

2912 (
iw_hdr

_iol_iwli
,

2913 #ifde
SIOCGIWSCAN


2914 (
iw_hdr

_iol_siwsn
,

2915 (
iw_hdr

_iol_giwsn
,

2917 (
iw_hdr

NULL
,

2918 (
iw_hdr

NULL
,

2920 (
iw_hdr

_iol_siwessid
,

2921 (
iw_hdr

_iol_giwessid
,

2922 (
iw_hdr

_iol_siwnickn
,

2923 (
iw_hdr

_iol_giwnickn
,

2924 (
iw_hdr

NULL
,

2925 (
iw_hdr

NULL
,

2926 (
iw_hdr

_iol_siw
,

2927 (
iw_hdr

_iol_giw
,

2928 (
iw_hdr

_iol_siws
,

2929 (
iw_hdr

_iol_giws
,

2930 (
iw_hdr

_iol_siwag
,

2931 (
iw_hdr

_iol_giwag
,

2932 (
iw_hdr

NULL
,

2933 (
iw_hdr

NULL
,

2934 (
iw_hdr

NULL
,

2935 (
iw_hdr

NULL
,

2936 (
iw_hdr

_iol_siwcode
,

2937 (
iw_hdr

_iol_giwcode
,

2938 (
iw_hdr

NULL
,

2939 (
iw_hdr

NULL
,

2940 (
iw_hdr

NULL
,

2941 (
iw_hdr

NULL
,

2942 #i
WIRELESS_EXT
 > 17

2943 (
iw_hdr

_iol_siwg
,

2944 (
iw_hdr

_iol_giwg
,

2945 (
iw_hdr

_iol_siwauth
,

2946 (
iw_hdr

_iol_giwauth
,

2947 (
iw_hdr

_iol_siwcodxt
,

2948 (
iw_hdr

_iol_giwcodxt
,

2949 (
iw_hdr

_iol_siwpmk
,

2953 cڡ 
iw_hdr
 
	g_iv_hdrs
[] = {

2954 (
iw_hdr

NULL
,

2955 (
iw_hdr

NULL
,

2956 (
iw_hdr

_iol_am
,

2957 #ifde
DBG


2958 (
iw_hdr

_ive_iol_bbp
,

2960 (
iw_hdr

NULL
,

2962 (
iw_hdr

NULL
,

2963 (
iw_hdr

NULL
,

2964 (
iw_hdr

NULL
,

2965 (
iw_hdr

NULL
,

2966 (
iw_hdr

NULL
,

2967 (
iw_hdr

_ive_g_iics
,

2968 (
iw_hdr

NULL
,

2969 (
iw_hdr

NULL
,

2970 (
iw_hdr

NULL
,

2971 (
iw_hdr

NULL
,

2972 (
iw_hdr

NULL
,

2973 (
iw_hdr

NULL
,

2974 (
iw_hdr

NULL
,

2975 (
iw_hdr

_ive_show
,

2976 (
iw_hdr

NULL
,

2977 (
iw_hdr

NULL
,

2978 (
iw_hdr

NULL
,

2979 (
iw_hdr

NULL
,

2980 (
iw_hdr

NULL
,

2981 (
iw_hdr

NULL
,

2982 (
iw_hdr

NULL
,

2985 cڡ 
iw_hdr_def
 
	g28xx_iw_hdr_def
 =

2987 
	#N
(
a
( (a/  (a[0]))

	)

2988 .
dd
 = (
iw_hdr
 *
_hdr
,

2989 .
	gnum_dd
 = (
_hdr
/ (
iw_hdr
),

2990 .
	give
 = (
iw_hdr
 *
_iv_hdrs
,

2991 .
	gnum_ive
 = 
N
(
_iv_hdrs
),

2992 .
	give_gs
 = (
iw_iv_gs
 *
ivb
,

2993 .
	gnum_ive_gs
 = 
N
(
ivb
),

2994 #i
IW_HANDLER_VERSION
 >= 7

2995 .
	gg_wess_s
 = 
28xx_g_wess_s
,

2999 
INT
 
	$RTMPSInfmi
(

3000 
IN
 
PRTMP_ADAPTER
 
pAd
,

3001 
IN
 
OUT
 
ieq
 *
rq
,

3002 
IN
 
INT
 
cmd
)

3004 
iwq
 *
wrq
 = (iwq *
rq
;

3005 
NDIS_802_11_SSID
 
Ssid
;

3006 
NDIS_802_11_MAC_ADDRESS
 
Bssid
;

3007 
RT_802_11_PHY_MODE
 
PhyMode
;

3008 
RT_802_11_STA_CONFIG
 
SCfig
;

3009 
NDIS_802_11_RATES
 
yRes
;

3010 
RT_802_11_PREAMBLE
 
Pamb
;

3011 
NDIS_802_11_WEP_STATUS
 
WStus
;

3012 
NDIS_802_11_AUTHENTICATION_MODE
 
AuthMode
 = 
Ndis802_11AuthModeMax
;

3013 
NDIS_802_11_NETWORK_INFRASTRUCTURE
 
BssTy
;

3014 
NDIS_802_11_RTS_THRESHOLD
 
RtsThsh
;

3015 
NDIS_802_11_FRAGMENTATION_THRESHOLD
 
FgThsh
;

3016 
NDIS_802_11_POWER_MODE
 
PowMode
;

3017 
PNDIS_802_11_KEY
 
pKey
 = 
NULL
;

3018 
PNDIS_802_11_WEP
 
pWKey
 =
NULL
;

3019 
PNDIS_802_11_REMOVE_KEY
 
pRemoveKey
 = 
NULL
;

3020 
NDIS_802_11_CONFIGURATION
 
Cfig
, *
pCfig
 = 
NULL
;

3021 
NDIS_802_11_NETWORK_TYPE
 
NTy
;

3022 
ULONG
 
Now
;

3023 
UINT
 
KeyIdx
 = 0;

3024 
INT
 
Stus
 = 
NDIS_STATUS_SUCCESS
, 
MaxPhyMode
 = 
PHY_11G
;

3025 
ULONG
 
PowTemp
;

3026 
BOOLEAN
 
RadioS
;

3027 
BOOLEAN
 
SMacheTouched
 = 
FALSE
;

3028 
PNDIS_802_11_PASSPHRASE
 
ash
 = 
NULL
;

3029 #ifde
DOT11_N_SUPPORT


3030 
OID_SET_HT_PHYMODE
 
HT_PhyMode
;

3032 #ifde
WPA_SUPPLICANT_SUPPORT


3033 
PNDIS_802_11_PMKID
 
pPmkId
 = 
NULL
;

3034 
BOOLEAN
 
IEEE8021xS
 = 
FALSE
;

3035 
BOOLEAN
 
IEEE8021x_qued_keys
 = 
FALSE
;

3036 
UCHAR
 
w_suli_ab
 = 0;

3039 #ifde
SNMP_SUPPORT


3040 
TX_RTY_CFG_STRUC
 
tx_y_cfg
;

3041 
ULONG
 
ShtRryLim
, 
LgRryLim
;

3042 
UCHAR
 
mp
;

3048 #ifde
DOT11_N_SUPPORT


3049 
MaxPhyMode
 = 
PHY_11N_5G
;

3052 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("-->RTMPSInfmi(), 0x%08x\n", 
cmd
&0x7FFF));

3053 
cmd
 & 0x7FFF) {

3054 
RT_OID_802_11_COUNTRY_REGION
:

3055 i(
wrq
->
u
.
da
.
ngth
 < (
UCHAR
))

3056 
Stus
 = -
EINVAL
;

3058 i(!(
pAd
->
CommCfg
.
CouryRegi
 & 0x80&& !Ad->CommCfg.
CouryRegiFABd
 & 0x80))

3060 
ULONG
 
Coury
;

3061 
UCHAR
 
TmpPhy
;

3063 
Stus
 = 
	`cy_om_ur
(&
Coury
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3064 
pAd
->
CommCfg
.
CouryRegi
 = (
UCHAR
)(
Coury
 & 0x000000FF);

3065 
pAd
->
CommCfg
.
CouryRegiFABd
 = (
UCHAR
)((
Coury
 >> 8) & 0x000000FF);

3066 
TmpPhy
 = 
pAd
->
CommCfg
.
PhyMode
;

3067 
pAd
->
CommCfg
.
PhyMode
 = 0xff;

3069 
	`RTMPSPhyMode
(
pAd
, 
TmpPhy
);

3070 #ifde
DOT11_N_SUPPORT


3071 
	`SCommHT
(
pAd
);

3073 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_802_11_COUNTRY_REGION (A:%d B/G:%d)\n", 
pAd
->
CommCfg
.
CouryRegiFABd
,

3074 
pAd
->
CommCfg
.
CouryRegi
));

3077 
OID_802_11_BSSID_LIST_SCAN
:

3078 
Now
 = 
jiffs
;

3079 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_BSSID_LIST_SCAN, TxC = %d \n", 
pAd
->
RkCous
.
LaOSecTٮTxCou
));

3081 i(
	`MONITOR_ON
(
pAd
))

3083 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! Driver is in Monitor Modeow !!!\n"));

3088 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
))

3091 i(
pAd
->
RkCous
.
LaOSecTٮTxCou
 > 100)

3093 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! Link UP, ignorehis set::OID_802_11_BSSID_LIST_SCAN\n"));

3094 
Stus
 = 
NDIS_STATUS_SUCCESS
;

3098 i((
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
)) &&

3099 ((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
) ||

3100 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

3101 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
) ||

3102 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
)) &&

3103 (
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
))

3105 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! Link UP, Port Not Secured! ignorehis set::OID_802_11_BSSID_LIST_SCAN\n"));

3106 
Stus
 = 
NDIS_STATUS_SUCCESS
;

3111 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
TRUE
;

3112 
	`SSeSurvey
(
pAd
, 
NULL
, 
SCAN_ACTIVE
);

3114 
OID_802_11_SSID
:

3115 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_SSID
))

3116 
Stus
 = -
EINVAL
;

3119 
PSTRING
 
pSsidSg
 = 
NULL
;

3120 
Stus
 = 
	`cy_om_ur
(&
Ssid
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3122 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_SSID (L=%d,Ssid=%s)\n", 
Ssid
.
SsidLgth
, Ssid.Ssid));

3123 i(
Ssid
.
SsidLgth
 > 
MAX_LEN_OF_SSID
)

3124 
Stus
 = -
EINVAL
;

3127 i(
Ssid
.
SsidLgth
 == 0)

3129 
	`S_SSID_Proc
(
pAd
, "");

3133 
pSsidSg
 = (
PSTRING
)
	`kmloc
(
MAX_LEN_OF_SSID
+1, 
MEM_ALLOC_FLAG
);

3134 i(
pSsidSg
)

3136 
	`NdisZoMemy
(
pSsidSg
, 
MAX_LEN_OF_SSID
+1);

3137 
	`NdisMoveMemy
(
pSsidSg
, 
Ssid
.Ssid, Ssid.
SsidLgth
);

3138 
	`S_SSID_Proc
(
pAd
, 
pSsidSg
);

3139 
	`k
(
pSsidSg
);

3142 
Stus
 = -
ENOMEM
;

3147 
OID_802_11_SET_PASSPHRASE
:

3148 
ash

	`kmloc
(
wrq
->
u
.
da
.
ngth
, 
MEM_ALLOC_FLAG
);

3150 if(
ash
=
NULL
)

3152 
Stus
 = -
ENOMEM
;

3153 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_SET_PASSPHRASE, Failed!!\n"));

3158 
Stus
 = 
	`cy_om_ur
(
ash
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3160 i(
Stus
)

3162 
Stus
 = -
EINVAL
;

3163 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_SET_PASSPHRASE, Failed (length mismatch)!!\n"));

3167 if(
ash
->
KeyLgth
 < 8 ||passphrase->KeyLength > 64)

3169 
Stus
 = -
EINVAL
;

3170 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_SET_PASSPHRASE, Failed (lenesshan 8 or greaterhan 64)!!\n"));

3175 
	`NdisZoMemy
(
pAd
->
SCfg
.
WPassPh
, 64);

3176 
	`NdisMoveMemy
(
pAd
->
SCfg
.
WPassPh
, &
ash
->
KeyMl
,sh->
KeyLgth
);

3177 
pAd
->
SCfg
.
WPassPhL
 = 
ash
->
KeyLgth
;

3178 
	`hex_dump
("pAd->SCfg.WPassPh", 
pAd
->
SCfg
.
WPassPh
, 64);

3179 
	`tk
("WPassPh=%s\n",
pAd
->
SCfg
.
WPassPh
);

3183 
	`k
(
ash
);

3186 
OID_802_11_BSSID
:

3187 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_MAC_ADDRESS
))

3188 
Stus
 = -
EINVAL
;

3191 
Stus
 = 
	`cy_om_ur
(&
Bssid
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3195 
pAd
->
MlmeAux
.
CuReqIsFromNdis
 = 
FALSE
;

3198 
pAd
->
MlmeAux
.
AutoRecSsidL
= 32;

3200 i(
pAd
->
Mlme
.
ClMache
.
CuS
 !
CNTL_IDLE
)

3202 
	`RTMP_MLME_RESET_STATE_MACHINE
(
pAd
);

3203 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! MLME busy,eset MLME state machine !!!\n"));

3205 
	`MlmeEnqueue
(
pAd
,

3206 
MLME_CNTL_STATE_MACHINE
,

3207 
OID_802_11_BSSID
,

3208 (
NDIS_802_11_MAC_ADDRESS
),

3209 (
VOID
 *)&
Bssid
, 0);

3210 
Stus
 = 
NDIS_STATUS_SUCCESS
;

3211 
SMacheTouched
 = 
TRUE
;

3213 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_BSSID %02x:%02x:%02x:%02x:%02x:%02x\n",

3214 
Bssid
[0], Bssid[1], Bssid[2], Bssid[3], Bssid[4], Bssid[5]));

3217 
RT_OID_802_11_RADIO
:

3218 i(
wrq
->
u
.
da
.
ngth
 !(
BOOLEAN
))

3219 
Stus
 = -
EINVAL
;

3222 
Stus
 = 
	`cy_om_ur
(&
RadioS
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3223 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_802_11_RADIO (=%d)\n", 
RadioS
));

3224 i(
pAd
->
SCfg
.
bSwRadio
 !
RadioS
)

3226 
pAd
->
SCfg
.
bSwRadio
 = 
RadioS
;

3227 i(
pAd
->
SCfg
.
bRadio
 !Ad->SCfg.
bHwRadio
 &&Ad->SCfg.
bSwRadio
))

3229 
pAd
->
SCfg
.
bRadio
 = (pAd->SCfg.
bHwRadio
 &&Ad->SCfg.
bSwRadio
);

3230 i(
pAd
->
SCfg
.
bRadio
 =
TRUE
)

3232 
	`MlmeRadioOn
(
pAd
);

3234 
pAd
->
ExaInfo
 = 
EXTRA_INFO_CLEAR
;

3238 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

3240 i(
pAd
->
Mlme
.
ClMache
.
CuS
 !
CNTL_IDLE
)

3242 
	`RTMP_MLME_RESET_STATE_MACHINE
(
pAd
);

3243 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! MLME busy,eset MLME state machine !!!\n"));

3247 
	`MlmeRadioOff
(
pAd
);

3249 
pAd
->
ExaInfo
 = 
SW_RADIO_OFF
;

3255 
RT_OID_802_11_PHY_MODE
:

3256 i(
wrq
->
u
.
da
.
ngth
 !(
RT_802_11_PHY_MODE
))

3257 
Stus
 = -
EINVAL
;

3260 
Stus
 = 
	`cy_om_ur
(&
PhyMode
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3261 i(
PhyMode
 <
MaxPhyMode
)

3263 
pAd
->
CommCfg
.
DesedPhyMode
 = 
PhyMode
;

3264 
	`RTMPSPhyMode
(
pAd
, 
PhyMode
);

3265 #ifde
DOT11_N_SUPPORT


3266 
	`SCommHT
(
pAd
);

3269 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_802_11_PHY_MODE (=%d)\n", 
PhyMode
));

3272 
RT_OID_802_11_STA_CONFIG
:

3273 i(
wrq
->
u
.
da
.
ngth
 !(
RT_802_11_STA_CONFIG
))

3274 
Stus
 = -
EINVAL
;

3277 
UINT32
 
Vue
;

3279 
Stus
 = 
	`cy_om_ur
(&
SCfig
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3280 
pAd
->
CommCfg
.
bEbTxBur
 = 
SCfig
.
EbTxBur
;

3281 
pAd
->
CommCfg
.
UBGPrei
 = 
SCfig
.UseBGProtection;

3282 
pAd
->
CommCfg
.
bUShtSlTime
 = 1;

3283 i((
pAd
->
CommCfg
.
PhyMode
 !
SCfig
.
AdhocMode
) &&

3284 (
SCfig
.
AdhocMode
 <
MaxPhyMode
))

3288 i(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
)

3290 
pAd
->
CommCfg
.
PhyMode
 = 
SCfig
.
AdhocMode
;

3291 
	`RTMPSPhyMode
(
pAd
,Ad->
CommCfg
.
PhyMode
);

3292 
	`MlmeUpdeTxRes
(
pAd
, 
FALSE
, 0);

3293 
	`MakeIbssBc
(
pAd
);

3294 
	`AsicEbIbssSync
(
pAd
);

3297 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::RT_OID_802_11_SET_STA_CONFIG (Burst=%d, Protection=%ld,ShortSlot=%d\n",

3298 
pAd
->
CommCfg
.
bEbTxBur
,

3299 
pAd
->
CommCfg
.
UBGPrei
,

3300 
pAd
->
CommCfg
.
bUShtSlTime
));

3302 #ifde
XLINK_SUPPORT


3303 i(
pAd
->
SCfg
.
PSPXlk
)

3304 
Vue
 = 
PSPXLINK
;

3307 
Vue
 = 
STANORMAL
;

3308 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 
Vue
);

3311 
OID_802_11_DESIRED_RATES
:

3312 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_RATES
))

3313 
Stus
 = -
EINVAL
;

3316 
Stus
 = 
	`cy_om_ur
(&
yRes
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3317 
	`NdisZoMemy
(
pAd
->
CommCfg
.
DeseRe
, 
MAX_LEN_OF_SUPPORTED_RATES
);

3318 
	`NdisMoveMemy
(
pAd
->
CommCfg
.
DeseRe
, &
yRes
, (
NDIS_802_11_RATES
));

3319 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_DESIRED_RATES (%02x,%02x,%02x,%02x,%02x,%02x,%02x,%02x)\n",

3320 
pAd
->
CommCfg
.
DeseRe
[0],pAd->CommonCfg.DesireRate[1],

3321 
pAd
->
CommCfg
.
DeseRe
[2],pAd->CommonCfg.DesireRate[3],

3322 
pAd
->
CommCfg
.
DeseRe
[4],pAd->CommonCfg.DesireRate[5],

3323 
pAd
->
CommCfg
.
DeseRe
[6],pAd->CommonCfg.DesireRate[7] ));

3325 
	`MlmeUpdeTxRes
(
pAd
, 
FALSE
, 0);

3328 
RT_OID_802_11_PREAMBLE
:

3329 i(
wrq
->
u
.
da
.
ngth
 !(
RT_802_11_PREAMBLE
))

3330 
Stus
 = -
EINVAL
;

3333 
Stus
 = 
	`cy_om_ur
(&
Pamb
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3334 i(
Pamb
 =
Rt802_11PambSht
)

3336 
pAd
->
CommCfg
.
TxPamb
 = 
Pamb
;

3337 
	`MlmeSTxPamb
(
pAd
, 
Rt802_11PambSht
);

3339 i((
Pamb
 =
Rt802_11PambLg
|| (Pamb =
Rt802_11PambAuto
))

3343 
pAd
->
CommCfg
.
TxPamb
 = 
Pamb
;

3344 
	`MlmeSTxPamb
(
pAd
, 
Rt802_11PambLg
);

3348 
Stus
 = -
EINVAL
;

3351 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_802_11_PREAMBLE (=%d)\n", 
Pamb
));

3354 
OID_802_11_WEP_STATUS
:

3355 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_WEP_STATUS
))

3356 
Stus
 = -
EINVAL
;

3359 
Stus
 = 
	`cy_om_ur
(&
WStus
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3361 i(
WStus
 <
Ndis802_11Enyi3KeyAb
)

3363 i(
pAd
->
SCfg
.
WStus
 != WepStatus)

3366 
pAd
->
bCfigChged
 = 
TRUE
;

3368 
pAd
->
SCfg
.
WStus
 = WepStatus;

3369 
pAd
->
SCfg
.
PaCh
 = 
WStus
;

3370 
pAd
->
SCfg
.
GroupCh
 = 
WStus
;

3372 i(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
)

3375 
	`RTMPSPhyMode
(
pAd
,Ad->
CommCfg
.
DesedPhyMode
);

3376 #ifde
DOT11_N_SUPPORT


3377 
	`SCommHT
(
pAd
);

3383 
Stus
 = -
EINVAL
;

3386 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_WEP_STATUS (=%d)\n",
WStus
));

3389 
OID_802_11_AUTHENTICATION_MODE
:

3390 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_AUTHENTICATION_MODE
))

3391 
Stus
 = -
EINVAL
;

3394 
Stus
 = 
	`cy_om_ur
(&
AuthMode
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3395 i(
AuthMode
 > 
Ndis802_11AuthModeMax
)

3397 
Stus
 = -
EINVAL
;

3402 i(
pAd
->
SCfg
.
AuthMode
 != AuthMode)

3405 
pAd
->
bCfigChged
 = 
TRUE
;

3407 
pAd
->
SCfg
.
AuthMode
 = AuthMode;

3409 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_NOT_SECURED
;

3410 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_AUTHENTICATION_MODE (=%d\n",
pAd
->
SCfg
.
AuthMode
));

3413 
OID_802_11_INFRASTRUCTURE_MODE
:

3414 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_NETWORK_INFRASTRUCTURE
))

3415 
Stus
 = -
EINVAL
;

3418 
Stus
 = 
	`cy_om_ur
(&
BssTy
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3420 i(
BssTy
 =
Ndis802_11IBSS
)

3421 
	`S_NwkTy_Proc
(
pAd
, "Adhoc");

3422 i(
BssTy
 =
Ndis802_11Inaruu
)

3423 
	`S_NwkTy_Proc
(
pAd
, "Infra");

3424 i(
BssTy
 =
Ndis802_11Mڙ
)

3425 
	`S_NwkTy_Proc
(
pAd
, "Monitor");

3428 
Stus
 = -
EINVAL
;

3429 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_INFRASTRUCTURE_MODE (unknown)\n"));

3433 
OID_802_11_REMOVE_WEP
:

3434 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_REMOVE_WEP\n"));

3435 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_KEY_INDEX
))

3437 
Stus
 = -
EINVAL
;

3441 
KeyIdx
 = *(
NDIS_802_11_KEY_INDEX
 *
wrq
->
u
.
da
.
por
;

3443 i(
KeyIdx
 & 0x80000000)

3446 
Stus
 = -
EINVAL
;

3450 
KeyIdx
 = KeyIdx & 0x0fffffff;

3451 i(
KeyIdx
 >= 4){

3452 
Stus
 = -
EINVAL
;

3456 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
KeyL
 = 0;

3457 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
ChAlg
 = 
CIPHER_NONE
;

3458 
	`AsicRemoveShedKeyEry
(
pAd
, 0, (
UCHAR
)
KeyIdx
);

3463 
RT_OID_802_11_RESET_COUNTERS
:

3464 
	`NdisZoMemy
(&
pAd
->
WnCous
, (
COUNTER_802_11
));

3465 
	`NdisZoMemy
(&
pAd
->
Cous8023
, (
COUNTER_802_3
));

3466 
	`NdisZoMemy
(&
pAd
->
RkCous
, (
COUNTER_RALINK
));

3467 
pAd
->
Cous8023
.
RxNoBufr
 = 0;

3468 
pAd
->
Cous8023
.
GoodReives
 = 0;

3469 
pAd
->
Cous8023
.
RxNoBufr
 = 0;

3470 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::RT_OID_802_11_RESET_COUNTERS \n"));

3472 
OID_802_11_RTS_THRESHOLD
:

3473 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_RTS_THRESHOLD
))

3474 
Stus
 = -
EINVAL
;

3477 
Stus
 = 
	`cy_om_ur
(&
RtsThsh
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3478 i(
RtsThsh
 > 
MAX_RTS_THRESHOLD
)

3480 
Stus
 = -
EINVAL
;

3481 
RtsThsh
 = 0;

3484 
pAd
->
CommCfg
.
RtsThshd
 = (
USHORT
)
RtsThsh
;

3486 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_RTS_THRESHOLD (=%ld)\n",
RtsThsh
));

3488 
OID_802_11_FRAGMENTATION_THRESHOLD
:

3489 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_FRAGMENTATION_THRESHOLD
))

3491 
Stus
 = -
EINVAL
;

3492 
FgThsh
 = 0;

3496 
Stus
 = 
	`cy_om_ur
(&
FgThsh
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3497 
pAd
->
CommCfg
.
bUZoToDibFgmt
 = 
FALSE
;

3498 i(
FgThsh
 > 
MAX_FRAG_THRESHOLD
 || FgThsh < 
MIN_FRAG_THRESHOLD
)

3500 i(
FgThsh
 == 0)

3502 
pAd
->
CommCfg
.
FgmtThshd
 = 
MAX_FRAG_THRESHOLD
;

3503 
pAd
->
CommCfg
.
bUZoToDibFgmt
 = 
TRUE
;

3506 
Stus
 = -
EINVAL
;

3509 
pAd
->
CommCfg
.
FgmtThshd
 = (
USHORT
)
FgThsh
;

3511 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_FRAGMENTATION_THRESHOLD (=%ld\n",
FgThsh
));

3513 
OID_802_11_POWER_MODE
:

3514 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_POWER_MODE
))

3516 
Stus
 = -
EINVAL
;

3517 
PowMode
 = 0;

3521 
Stus
 = 
	`cy_om_ur
(&
PowMode
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3522 i(
PowMode
 =
Ndis802_11PowModeCAM
)

3523 
	`S_PSMode_Proc
(
pAd
, "CAM");

3524 i(
PowMode
 =
Ndis802_11PowModeMAX_PSP
)

3525 
	`S_PSMode_Proc
(
pAd
, "Max_PSP");

3526 i(
PowMode
 =
Ndis802_11PowModeFa_PSP
)

3527 
	`S_PSMode_Proc
(
pAd
, "Fast_PSP");

3528 i(
PowMode
 =
Ndis802_11PowModeLegacy_PSP
)

3529 
	`S_PSMode_Proc
(
pAd
, "Legacy_PSP");

3531 
Stus
 = -
EINVAL
;

3533 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_POWER_MODE (=%d)\n",
PowMode
));

3535 
RT_OID_802_11_TX_POWER_LEVEL_1
:

3536 i(
wrq
->
u
.
da
.
ngth
 < (
ULONG
))

3537 
Stus
 = -
EINVAL
;

3540 
Stus
 = 
	`cy_om_ur
(&
PowTemp
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3541 i(
PowTemp
 > 100)

3542 
PowTemp
 = 0xffffffff;

3543 
pAd
->
CommCfg
.
TxPowDeu
 = 
PowTemp
;

3544 
pAd
->
CommCfg
.
TxPowPage
 =Ad->CommCfg.
TxPowDeu
;

3545 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_802_11_TX_POWER_LEVEL_1 (=%ld)\n", 
pAd
->
CommCfg
.
TxPowPage
));

3548 
OID_802_11_NETWORK_TYPE_IN_USE
:

3549 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_NETWORK_TYPE
))

3550 
Stus
 = -
EINVAL
;

3553 
Stus
 = 
	`cy_om_ur
(&
NTy
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3555 i(
NTy
 =
Ndis802_11DS
)

3556 
	`RTMPSPhyMode
(
pAd
, 
PHY_11B
);

3557 i(
NTy
 =
Ndis802_11OFDM24
)

3558 
	`RTMPSPhyMode
(
pAd
, 
PHY_11BG_MIXED
);

3559 i(
NTy
 =
Ndis802_11OFDM5
)

3560 
	`RTMPSPhyMode
(
pAd
, 
PHY_11A
);

3562 
Stus
 = -
EINVAL
;

3563 #ifde
DOT11_N_SUPPORT


3564 i(
Stus
 =
NDIS_STATUS_SUCCESS
)

3565 
	`SCommHT
(
pAd
);

3567 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_NETWORK_TYPE_IN_USE (=%d)\n",
NTy
));

3571 
RT_OID_802_11_ADD_WPA
:

3572 
pKey
 = 
	`kmloc
(
wrq
->
u
.
da
.
ngth
, 
MEM_ALLOC_FLAG
);

3573 if(
pKey
 =
NULL
)

3575 
Stus
 = -
ENOMEM
;

3579 
Stus
 = 
	`cy_om_ur
(
pKey
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3580 i(
pKey
->
Lgth
 !
wrq
->
u
.
da
.
ngth
)

3582 
Stus
 = -
EINVAL
;

3583 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::RT_OID_802_11_ADD_WPA, Failed!!\n"));

3587 i((
pAd
->
SCfg
.
AuthMode
 !
Ndis802_11AuthModeWPAPSK
) &&

3588 (
pAd
->
SCfg
.
AuthMode
 !
Ndis802_11AuthModeWPA2PSK
) &&

3589 (
pAd
->
SCfg
.
AuthMode
 !
Ndis802_11AuthModeWPANe
) )

3591 
Stus
 = -
EOPNOTSUPP
;

3592 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::RT_OID_802_11_ADD_WPA, Failed!! [AuthMode != WPAPSK/WPA2PSK/WPANONE]\n"));

3594 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

3595 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
) ||

3596 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPANe
) )

3598 
	`NdisMoveMemy
(
pAd
->
SCfg
.
PMK
, &
pKey
->
KeyMl
,Key->
KeyLgth
);

3601 i(
pAd
->
SCfg
.
AuthMode
 !
Ndis802_11AuthModeWPANe
)

3602 
pAd
->
SCfg
.
WS
 = 
SS_START
;

3604 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_802_11_ADD_WPA (id=0x%x, L=%d-by)\n", 
pKey
->
KeyIndex
,Key->
KeyLgth
));

3608 
pAd
->
SCfg
.
WS
 = 
SS_NOTUSE
;

3609 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_802_11_ADD_WPA (id=0x%x, L=%d-by)\n", 
pKey
->
KeyIndex
,Key->
KeyLgth
));

3612 
	`k
(
pKey
);

3614 
OID_802_11_REMOVE_KEY
:

3615 
pRemoveKey
 = 
	`kmloc
(
wrq
->
u
.
da
.
ngth
, 
MEM_ALLOC_FLAG
);

3616 if(
pRemoveKey
 =
NULL
)

3618 
Stus
 = -
ENOMEM
;

3622 
Stus
 = 
	`cy_om_ur
(
pRemoveKey
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3623 i(
pRemoveKey
->
Lgth
 !
wrq
->
u
.
da
.
ngth
)

3625 
Stus
 = -
EINVAL
;

3626 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_REMOVE_KEY, Failed!!\n"));

3630 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

3632 
	`RTMPWPARemoveKeyProc
(
pAd
, 
pRemoveKey
);

3633 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_REMOVE_KEY, Remove WPA Key!!\n"));

3637 
KeyIdx
 = 
pRemoveKey
->
KeyIndex
;

3639 i(
KeyIdx
 & 0x80000000)

3642 
Stus
 = -
EINVAL
;

3643 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_REMOVE_KEY, Failed!!(Shouldever set default bit whenemove key)\n"));

3647 
KeyIdx
 = KeyIdx & 0x0fffffff;

3648 i(
KeyIdx
 > 3)

3650 
Stus
 = -
EINVAL
;

3651 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_REMOVE_KEY, Faed!!(KeyId[%d] ouonge)\n", 
KeyIdx
));

3655 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
KeyL
 = 0;

3656 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
ChAlg
 = 
CIPHER_NONE
;

3657 
	`AsicRemoveShedKeyEry
(
pAd
, 0, (
UCHAR
)
KeyIdx
);

3658 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_REMOVE_KEY (id=0x%x, L=%d-by)\n", 
pRemoveKey
->
KeyIndex
,RemoveKey->
Lgth
));

3663 
	`k
(
pRemoveKey
);

3666 
OID_802_11_ADD_KEY
:

3667 
pKey
 = 
	`kmloc
(
wrq
->
u
.
da
.
ngth
, 
MEM_ALLOC_FLAG
);

3668 if(
pKey
 =
NULL
)

3670 
Stus
 = -
ENOMEM
;

3673 
Stus
 = 
	`cy_om_ur
(
pKey
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3674 i(
pKey
->
Lgth
 !
wrq
->
u
.
da
.
ngth
)

3676 
Stus
 = -
EINVAL
;

3677 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_ADD_KEY, Failed!!\n"));

3681 
	`RTMPAddKey
(
pAd
, 
pKey
);

3682 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_ADD_KEY (id=0x%x, L=%d-by)\n", 
pKey
->
KeyIndex
,Key->
KeyLgth
));

3684 
	`k
(
pKey
);

3686 
OID_802_11_CONFIGURATION
:

3687 i(
wrq
->
u
.
da
.
ngth
 !(
NDIS_802_11_CONFIGURATION
))

3688 
Stus
 = -
EINVAL
;

3691 
Stus
 = 
	`cy_om_ur
(&
Cfig
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3692 
pCfig
 = &
Cfig
;

3694 i((
pCfig
->
BcPiod
 >= 20) && (pConfig->BeaconPeriod <=400))

3695 
pAd
->
CommCfg
.
BcPiod
 = (
USHORT

pCfig
->BeaconPeriod;

3697 
pAd
->
SAive
.
AtimW
 = (
USHORT

pCfig
->
ATIMWdow
;

3698 
	`MAP_KHZ_TO_CHANNEL_ID
(
pCfig
->
DSCfig
, 
pAd
->
CommCfg
.
Chl
);

3702 
pAd
->
MlmeAux
.
Chl
 =Ad->
CommCfg
.Channel;

3704 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_CONFIGURATION (BeacnPeriod=%ld,AtimW=%ld,Ch=%d)\n",

3705 
pCfig
->
BcPiod
,Cfig->
ATIMWdow
, 
pAd
->
CommCfg
.
Chl
));

3707 
pAd
->
bCfigChged
 = 
TRUE
;

3710 #ifde
DOT11_N_SUPPORT


3711 
RT_OID_802_11_SET_HT_PHYMODE
:

3712 i(
wrq
->
u
.
da
.
ngth
 !(
OID_SET_HT_PHYMODE
))

3713 
Stus
 = -
EINVAL
;

3716 
POID_SET_HT_PHYMODE
 
pHTPhyMode
 = &
HT_PhyMode
;

3718 
Stus
 = 
	`cy_om_ur
(&
HT_PhyMode
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3719 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::pHTPhyMode (PhyMode = %d,TransmitNo = %d, HtMode = %d, ExtOffset = %d , MCS = %d, BW = %d, STBC = %d, SHORTGI = %d) \n",

3720 
pHTPhyMode
->
PhyMode
,HTPhyMode->
TnsmNo
,pHTPhyMode->
HtMode
,pHTPhyMode->
ExtOfft
,

3721 
pHTPhyMode
->
MCS
,HTPhyMode->
BW
,HTPhyMode->
STBC
,HTPhyMode->
SHORTGI
));

3722 i(
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
)

3723 
	`RTMPSHT
(
pAd
, 
pHTPhyMode
);

3725 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::RT_OID_802_11_SET_HT_PHYMODE(MCS=%d,BW=%d,SGI=%d,STBC=%d)\n",

3726 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
MCS
,Ad->SCfg.HTPhyMode.fld.
BW
,Ad->SCfg.HTPhyMode.fld.
ShtGI
,

3727 
pAd
->
SCfg
.
HTPhyMode
.
fld
.
STBC
));

3730 
RT_OID_802_11_SET_APSD_SETTING
:

3731 i(
wrq
->
u
.
da
.
ngth
 !(
ULONG
))

3732 
Stus
 = -
EINVAL
;

3735 
ULONG
 
sd
 ;

3736 
Stus
 = 
	`cy_om_ur
(&
sd
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3743 
pAd
->
CommCfg
.
bAPSDCab
 = (
sd
 & 0x00000001? 
TRUE
 : 
FALSE
;

3744 
pAd
->
CommCfg
.
bAPSDAC_BE
 = ((
sd
 & 0x00000002>> 1? 
TRUE
 : 
FALSE
;

3745 
pAd
->
CommCfg
.
bAPSDAC_BK
 = ((
sd
 & 0x00000004>> 2? 
TRUE
 : 
FALSE
;

3746 
pAd
->
CommCfg
.
bAPSDAC_VI
 = ((
sd
 & 0x00000008>> 3? 
TRUE
 : 
FALSE
;

3747 
pAd
->
CommCfg
.
bAPSDAC_VO
 = ((
sd
 & 0x00000010>> 4? 
TRUE
 : 
FALSE
;

3748 
pAd
->
CommCfg
.
MaxSPLgth
 = (
UCHAR
)((
sd
 & 0x00000060) >> 5);

3750 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_802_11_SET_APSD_SETTING (sd=0x%lx, APSDC=%d, [BE,BK,VI,VO]=[%d/%d/%d/%d], MaxSPL=%d)\n", 
sd
, 
pAd
->
CommCfg
.
bAPSDCab
,

3751 
pAd
->
CommCfg
.
bAPSDAC_BE
,Ad->CommCfg.
bAPSDAC_BK
,Ad->CommCfg.
bAPSDAC_VI
,Ad->CommCfg.
bAPSDAC_VO
,Ad->CommCfg.
MaxSPLgth
));

3755 
RT_OID_802_11_SET_APSD_PSM
:

3756 i(
wrq
->
u
.
da
.
ngth
 !(
ULONG
))

3757 
Stus
 = -
EINVAL
;

3761 
Stus
 = 
	`cy_om_ur
(&
pAd
->
CommCfg
.
bAPSDFPowSave
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3762 i(
pAd
->
CommCfg
.
bAPSDFPowSave
 !pAd->
SCfg
.
Psm
)

3764 
	`RTMP_SET_PSM_BIT
(
pAd
,Ad->
CommCfg
.
bAPSDFPowSave
);

3765 
	`RTMPSdNuFme
(
pAd
,Ad->
CommCfg
.
TxRe
, 
TRUE
);

3767 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_802_11_SET_APSD_PSM (bAPSDFPowSave:%d)\n", 
pAd
->
CommCfg
.
bAPSDFPowSave
));

3770 #ifde
QOS_DLS_SUPPORT


3771 
RT_OID_802_11_SET_DLS
:

3772 i(
wrq
->
u
.
da
.
ngth
 !(
ULONG
))

3773 
Stus
 = -
EINVAL
;

3776 
BOOLEAN
 
dvue
 = 
pAd
->
CommCfg
.
bDLSCab
;

3777 
Stus
 = 
	`cy_om_ur
(&
pAd
->
CommCfg
.
bDLSCab
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3778 i(
dvue
 && !
pAd
->
CommCfg
.
bDLSCab
)

3780 
i
;

3782 
i
=0; i<
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

3784 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
))

3786 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

3787 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

3788 
	`RTMPSdDLSTrDownFme
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
);

3793 
i
=
MAX_NUM_OF_INIT_DLS_ENTRY
; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

3795 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
))

3797 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

3798 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

3799 
	`RTMPSdDLSTrDownFme
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
);

3804 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("S::RT_OID_802_11_SET_DLS (=%d)\n", 
pAd
->
CommCfg
.
bDLSCab
));

3808 
RT_OID_802_11_SET_DLS_PARAM
:

3809 i(
wrq
->
u
.
da
.
ngth
 !(
RT_802_11_DLS_UI
))

3810 
Stus
 = -
EINVAL
;

3813 
RT_802_11_DLS
 
Dls
;

3815 
	`NdisZoMemy
(&
Dls
, (
RT_802_11_DLS
));

3816 
	`RTMPMoveMemy
(&
Dls
, 
wrq
->
u
.
da
.
por
, (
RT_802_11_DLS_UI
));

3817 
	`MlmeEnqueue
(
pAd
,

3818 
MLME_CNTL_STATE_MACHINE
,

3819 
RT_OID_802_11_SET_DLS_PARAM
,

3820 (
RT_802_11_DLS
),

3821 &
Dls
, 0);

3822 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Set::RT_OID_802_11_SET_DLS_PARAM \n"));

3828 
RT_OID_802_11_SET_WMM
:

3829 i(
wrq
->
u
.
da
.
ngth
 !(
BOOLEAN
))

3830 
Stus
 = -
EINVAL
;

3833 
Stus
 = 
	`cy_om_ur
(&
pAd
->
CommCfg
.
bWmmCab
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3834 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_802_11_SET_WMM (=%d) \n", 
pAd
->
CommCfg
.
bWmmCab
));

3838 
OID_802_11_DISASSOCIATE
:

3847 
pAd
->
CommCfg
.
NdisRadioSOff
 = 
TRUE
;

3849 
pAd
->
MlmeAux
.
CuReqIsFromNdis
 = 
TRUE
;

3850 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_DISASSOCIATE \n"));

3853 i(
	`INFRA_ON
(
pAd
))

3855 i(
pAd
->
Mlme
.
ClMache
.
CuS
 !
CNTL_IDLE
)

3857 
	`RTMP_MLME_RESET_STATE_MACHINE
(
pAd
);

3858 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! MLME busy,eset MLME state machine !!!\n"));

3861 
	`MlmeEnqueue
(
pAd
,

3862 
MLME_CNTL_STATE_MACHINE
,

3863 
OID_802_11_DISASSOCIATE
,

3865 
NULL
, 0);

3867 
SMacheTouched
 = 
TRUE
;

3871 #ifde
DOT11_N_SUPPORT


3872 
RT_OID_802_11_SET_IMME_BA_CAP
:

3873 i(
wrq
->
u
.
da
.
ngth
 !(
OID_BACAP_STRUC
))

3874 
Stus
 = -
EINVAL
;

3877 
OID_BACAP_STRUC
 
Orde
 ;

3878 
Stus
 = 
	`cy_om_ur
(&
Orde
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3879 i(
Orde
.
Picy
 > 
BA_NOTUSE
)

3881 
Stus
 = 
NDIS_STATUS_INVALID_DATA
;

3883 i(
Orde
.
Picy
 =
BA_NOTUSE
)

3885 
pAd
->
CommCfg
.
BACaby
.
fld
.
Picy
 = 
BA_NOTUSE
;

3886 
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
 = 
Orde
.MpduDensity;

3887 
pAd
->
CommCfg
.
DesedHtPhy
.
MpduDsy
 = 
Orde
.MpduDensity;

3888 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduEb
 = 
Orde
.AmsduEnable;

3889 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduSize

Orde
.AmsduSize;

3890 
pAd
->
CommCfg
.
DesedHtPhy
.
MimoPs

Orde
.
MMPSmode
;

3891 
pAd
->
CommCfg
.
BACaby
.
fld
.
MMPSmode
 = 
Orde
.MMPSmode;

3893 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
MimoPs
 = 
Orde
.
MMPSmode
;

3894 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
AMsduSize
 = 
Orde
.
AmsduSize
;

3895 
pAd
->
CommCfg
.
HtCaby
.
HtCPm
.
MpduDsy
 = 
Orde
.MpduDensity;

3899 
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 = 
Orde
.AutoBA;

3900 
pAd
->
CommCfg
.
BACaby
.
fld
.
Picy
 = 
IMMED_BA
;

3901 
pAd
->
CommCfg
.
BACaby
.
fld
.
MpduDsy
 = 
Orde
.MpduDensity;

3902 
pAd
->
CommCfg
.
DesedHtPhy
.
MpduDsy
 = 
Orde
.MpduDensity;

3903 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduEb
 = 
Orde
.AmsduEnable;

3904 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduSize

Orde
.AmsduSize;

3905 
pAd
->
CommCfg
.
DesedHtPhy
.
MimoPs
 = 
Orde
.
MMPSmode
;

3906 
pAd
->
CommCfg
.
BACaby
.
fld
.
MMPSmode
 = 
Orde
.MMPSmode;

3909 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
MimoPs
 = 
Orde
.
MMPSmode
;

3910 
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
AMsduSize
 = 
Orde
.
AmsduSize
;

3911 
pAd
->
CommCfg
.
HtCaby
.
HtCPm
.
MpduDsy
 = 
Orde
.MpduDensity;

3913 i(
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
 > 
MAX_RX_REORDERBUF
)

3914 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
 = 
MAX_RX_REORDERBUF
;

3918 
pAd
->
CommCfg
.
REGBACaby
.
wd
 =Ad->CommCfg.
BACaby
.word;

3919 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::(Orde.AutoBA = %d(Picy=%d)(ReBAWLim=%d)(TxBAWLim=%d)(AutoMode=%d)\n",
Orde
.
AutoBA
, 
pAd
->
CommCfg
.
BACaby
.
fld
.
Picy
,

3920 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
,pAd->CommCfg.BACaby.fld.
TxBAWLim
,Ad->CommCfg.BACaby.fld.
AutoBA
));

3921 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::(MimoP%d)(AmsduEb = %d(AmsduSize=%d)(MpduDsy=%d)\n",
pAd
->
CommCfg
.
DesedHtPhy
.
MimoPs
,Ad->CommCfg.DesedHtPhy.
AmsduEb
,

3922 
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduSize
,Ad->CommCfg.DesedHtPhy.
MpduDsy
));

3926 
RT_OID_802_11_ADD_IMME_BA
:

3927 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" Set :: RT_OID_802_11_ADD_IMME_BA \n"));

3928 i(
wrq
->
u
.
da
.
ngth
 !(
OID_ADD_BA_ENTRY
))

3929 
Stus
 = -
EINVAL
;

3932 
UCHAR
 
dex
;

3933 
OID_ADD_BA_ENTRY
 
BA
;

3934 
MAC_TABLE_ENTRY
 *
pEry
;

3936 
Stus
 = 
	`cy_om_ur
(&
BA
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3937 i(
BA
.
TID
 > (
NUM_OF_TID
-1))

3939 
Stus
 = 
NDIS_STATUS_INVALID_DATA
;

3946 
dex
 = 
BA
.
TID
;

3948 
pEry
 = 
	`MacTabLookup
(
pAd
, 
BA
.
MACAddr
);

3949 i(!
pEry
)

3951 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RT_OID_802_11_ADD_IMME_BA. bak onci.----:%x:%x\n", 
BA
.
MACAddr
[4], BA.MACAddr[5]));

3954 i(
BA
.
IsRec
 =
FALSE
)

3956 i(
pEry
->
bIAmBadAthos
 =
TRUE
)

3957 
pAd
->
CommCfg
.
BACaby
.
fld
.
RxBAWLim
 = 0x10;

3959 
	`BAOriSessiSUp
(
pAd
, 
pEry
, 
dex
, 0, 100, 
TRUE
);

3966 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::RT_OID_802_11_ADD_IMME_BA. Rec = %d. Mac = %x:%x:%x:%x:%x:%x . \n",

3967 
BA
.
IsRec
, BA.
MACAddr
[0], BA.MACAddr[1], BA.MACAddr[2], BA.MACAddr[2]

3968 , 
BA
.
MACAddr
[4], BA.MACAddr[5]));

3973 
RT_OID_802_11_TEAR_IMME_BA
:

3974 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set :: RT_OID_802_11_TEAR_IMME_BA \n"));

3975 i(
wrq
->
u
.
da
.
ngth
 !(
OID_ADD_BA_ENTRY
))

3976 
Stus
 = -
EINVAL
;

3979 
POID_ADD_BA_ENTRY
 
pBA
;

3980 
MAC_TABLE_ENTRY
 *
pEry
;

3982 
pBA
 = 
	`kmloc
(
wrq
->
u
.
da
.
ngth
, 
MEM_ALLOC_FLAG
);

3984 i(
pBA
 =
NULL
)

3986 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set :: RT_OID_802_11_TEAR_IMME_BA kmalloc() can'tllocatenough memory\n"));

3987 
Stus
 = 
NDIS_STATUS_FAILURE
;

3991 
Stus
 = 
	`cy_om_ur
(
pBA
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

3992 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S :: RT_OID_802_11_TEAR_IMME_BA(TID=%d, bATid=%d)\n", 
pBA
->
TID
,BA->
bATid
));

3994 i(!
pBA
->
bATid
 && (pBA->
TID
 > (
NUM_OF_TID
-1)))

3996 
Stus
 = 
NDIS_STATUS_INVALID_DATA
;

3997 
	`k
(
pBA
);

4001 i(
pBA
->
IsRec
 =
FALSE
)

4003 
pEry
 = 
	`MacTabLookup
(
pAd
, 
pBA
->
MACAddr
);

4004 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BA->IsRecipient == FALSE\n"));

4005 i(
pEry
)

4007 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BA->pEntry\n"));

4008 
	`BAOriSessiTrDown
(
pAd
, 
pEry
->
Aid
, 
pBA
->
TID
, 
FALSE
, 
TRUE
);

4011 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set :: Not foundEntry \n"));

4015 
pEry
 = 
	`MacTabLookup
(
pAd
, 
pBA
->
MACAddr
);

4016 i(
pEry
)

4018 
	`BARecSessiTrDown

pAd
, (
UCHAR
)
pEry
->
Aid
, 
pBA
->
TID
, 
TRUE
);

4021 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set :: Not foundEntry \n"));

4023 
	`k
(
pBA
);

4030 
OID_802_11_ADD_WEP
:

4031 
pWKey
 = 
	`kmloc
(
wrq
->
u
.
da
.
ngth
, 
MEM_ALLOC_FLAG
);

4033 if(
pWKey
 =
NULL
)

4035 
Stus
 = -
ENOMEM
;

4036 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_ADD_WEP, Failed!!\n"));

4039 
Stus
 = 
	`cy_om_ur
(
pWKey
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4040 i(
Stus
)

4042 
Stus
 = -
EINVAL
;

4043 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_ADD_WEP, Failed (length mismatch)!!\n"));

4047 
KeyIdx
 = 
pWKey
->
KeyIndex
 & 0x0fffffff;

4049 i(
KeyIdx
 >= 4)

4051 
Stus
 = -
EINVAL
;

4052 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_ADD_WEP, Failed (KeyIdx must be smallerhan 4)!!\n"));

4056 
UCHAR
 
ChAlg
 = 0;

4057 
PUCHAR
 
Key
;

4060 
	`NdisZoMemy
(&
pAd
->
ShedKey
[
BSS0
][
KeyIdx
], (
CIPHER_KEY
));

4063 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
KeyL
 = (
UCHAR

pWKey
->
KeyLgth
;

4064 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
Key
, &
pWKey
->
KeyMl
,WKey->
KeyLgth
);

4066 
pWKey
->
KeyLgth
)

4069 
ChAlg
 = 
CIPHER_WEP64
;

4072 
ChAlg
 = 
CIPHER_WEP128
;

4075 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_ADD_WEP, only support CIPHER_WEP64(len:5) & CIPHER_WEP128(len:13)!!\n"));

4076 
Stus
 = -
EINVAL
;

4079 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
ChAlg
 = CipherAlg;

4082 i(
pWKey
->
KeyIndex
 & 0x80000000)

4084 #ifde
WPA_SUPPLICANT_SUPPORT


4085 
	`NdisZoMemy
(&
pAd
->
SCfg
.
DeseShedKey
[
KeyIdx
], (
CIPHER_KEY
));

4088 
pAd
->
SCfg
.
DeseShedKey
[
KeyIdx
].
KeyL
 = (
UCHAR

pWKey
->
KeyLgth
;

4089 
	`NdisMoveMemy
(
pAd
->
SCfg
.
DeseShedKey
[
KeyIdx
].
Key
, &
pWKey
->
KeyMl
,WKey->
KeyLgth
);

4090 
pAd
->
SCfg
.
DeseShedKeyId
 = 
KeyIdx
;

4091 
pAd
->
SCfg
.
DeseShedKey
[
KeyIdx
].
ChAlg
 = CipherAlg;

4093 
pAd
->
SCfg
.
DeuKeyId
 = (
UCHAR

KeyIdx
;

4096 #ifde
WPA_SUPPLICANT_SUPPORT


4097 i((
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
) &&

4098 (
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
))

4100 
Key
 = 
pWKey
->
KeyMl
;

4103 
	`AsicAddShedKeyEry
(
pAd
, 
BSS0
, 
KeyIdx
, &pAd->
ShedKey
[BSS0][KeyIdx]);

4105 
	`STA_PORT_SECURED
(
pAd
);

4107 i(
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_SECURED
)

4110 
Key
 = 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].Key;

4113 
	`AsicAddShedKeyEry
(
pAd
, 
BSS0
, 
KeyIdx
, &pAd->
ShedKey
[BSS0][KeyIdx]);

4115 i(
pWKey
->
KeyIndex
 & 0x80000000)

4118 
	`RTMPSWcidSecuryInfo
(
pAd
,

4119 
BSS0
,

4120 
KeyIdx
,

4121 
ChAlg
,

4122 
BSSID_WCID
,

4123 
SHAREDKEYTABLE
);

4126 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_ADD_WEP (id=0x%x, L=%d-by), %s\n", 
pWKey
->
KeyIndex
,WKey->
KeyLgth
, (
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_SECURED
) ? "Port Secured":"Port NOT Secured"));

4129 
	`k
(
pWKey
);

4131 #ifde
WPA_SUPPLICANT_SUPPORT


4132 
OID_SET_COUNTERMEASURES
:

4133 i(
wrq
->
u
.
da
.
ngth
 != ())

4134 
Stus
 = -
EINVAL
;

4137 
abd
 = 0;

4138 
Stus
 = 
	`cy_om_ur
(&
abd
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4139 i(
abd
 == 1)

4140 
pAd
->
SCfg
.
bBlockAssoc
 = 
TRUE
;

4143 
pAd
->
SCfg
.
bBlockAssoc
 = 
FALSE
;

4144 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_SET_COUNTERMEASURES bBlockAssoc=%s\n", 
pAd
->
SCfg
.
bBlockAssoc
 ? "TRUE":"FALSE"));

4147 
RT_OID_WPA_SUPPLICANT_SUPPORT
:

4148 i(
wrq
->
u
.
da
.
ngth
 !(
UCHAR
))

4149 
Stus
 = -
EINVAL
;

4152 
Stus
 = 
	`cy_om_ur
(&
w_suli_ab
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4153 i(
w_suli_ab
 & 
WPA_SUPPLICANT_ENABLE_WPS
)

4154 
pAd
->
SCfg
.
WSuliUP
 |
WPA_SUPPLICANT_ENABLE_WPS
;

4157 
pAd
->
SCfg
.
WSuliUP
 = 
w_suli_ab
;

4158 
pAd
->
SCfg
.
WSuliUP
 &= 0x7F;

4160 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::RT_OID_WPA_SUPPLICANT_SUPPORT (=0x%02X)\n", 
pAd
->
SCfg
.
WSuliUP
));

4163 
OID_802_11_DEAUTHENTICATION
:

4164 i(
wrq
->
u
.
da
.
ngth
 !(
MLME_DEAUTH_REQ_STRUCT
))

4165 
Stus
 = -
EINVAL
;

4168 
MLME_DEAUTH_REQ_STRUCT
 *
pInfo
;

4169 
MLME_QUEUE_ELEM
 *
MsgEm
 = (MLME_QUEUE_ELEM *
	`kmloc
((MLME_QUEUE_ELEM), 
MEM_ALLOC_FLAG
);

4170 i(
MsgEm
 =
NULL
)

4172 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s():lomemy faed!\n", 
__FUNCTION__
));

4173  -
EINVAL
;

4176 
pInfo
 = (
MLME_DEAUTH_REQ_STRUCT
 *
MsgEm
->
Msg
;

4177 
Stus
 = 
	`cy_om_ur
(
pInfo
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4178 
	`MlmeDuthReqAi
(
pAd
, 
MsgEm
);

4179 
	`k
(
MsgEm
);

4181 i(
	`INFRA_ON
(
pAd
))

4183 
	`LkDown
(
pAd
, 
FALSE
);

4184 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

4186 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_DEAUTHENTICATION (Rs=%d)\n", 
pInfo
->
Rs
));

4189 
OID_802_11_DROP_UNENCRYPTED
:

4190 i(
wrq
->
u
.
da
.
ngth
 != ())

4191 
Stus
 = -
EINVAL
;

4194 
abd
 = 0;

4195 
Stus
 = 
	`cy_om_ur
(&
abd
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4196 i(
abd
 == 1)

4197 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_NOT_SECURED
;

4199 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_SECURED
;

4200 
	`NdisAcqueSpLock
(&
pAd
->
MacTabLock
);

4201 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
PtSecud
 =Ad->
SCfg
.PortSecured;

4202 
	`NdisRSpLock
(&
pAd
->
MacTabLock
);

4203 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_DROP_UNENCRYPTED (=%d)\n", 
abd
));

4206 
OID_802_11_SET_IEEE8021X
:

4207 i(
wrq
->
u
.
da
.
ngth
 !(
BOOLEAN
))

4208 
Stus
 = -
EINVAL
;

4211 
Stus
 = 
	`cy_om_ur
(&
IEEE8021xS
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4212 
pAd
->
SCfg
.
IEEE8021X
 = 
IEEE8021xS
;

4213 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_SET_IEEE8021X (=%d)\n", 
IEEE8021xS
));

4216 
OID_802_11_SET_IEEE8021X_REQUIRE_KEY
:

4217 i(
wrq
->
u
.
da
.
ngth
 !(
BOOLEAN
))

4218 
Stus
 = -
EINVAL
;

4221 
Stus
 = 
	`cy_om_ur
(&
IEEE8021x_qued_keys
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4222 
pAd
->
SCfg
.
IEEE8021x_qued_keys
 = IEEE8021x_required_keys;

4223 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_SET_IEEE8021X_REQUIRE_KEY (%d)\n", 
IEEE8021x_qued_keys
));

4226 
OID_802_11_PMKID
:

4227 
pPmkId
 = 
	`kmloc
(
wrq
->
u
.
da
.
ngth
, 
MEM_ALLOC_FLAG
);

4229 if(
pPmkId
 =
NULL
) {

4230 
Stus
 = -
ENOMEM
;

4233 
Stus
 = 
	`cy_om_ur
(
pPmkId
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4236 i(
pPmkId
->
BSSIDInfoCou
 == 0)

4237 
	`NdisZoMemy
(
pAd
->
SCfg
.
SavedPMK
, (
BSSID_INFO
)*
PMKID_NO
);

4240 
PBSSID_INFO
 
pBssIdInfo
;

4241 
UINT
 
BssIdx
;

4242 
UINT
 
CachedIdx
;

4244 
BssIdx
 = 0; BssIdx < 
pPmkId
->
BSSIDInfoCou
; BssIdx++)

4247 
pBssIdInfo
 = (
PBSSID_INFO
((
PUCHAR

pPmkId
 + 2 * (
UINT
+ 
BssIdx
 * (
BSSID_INFO
));

4249 
CachedIdx
 = 0; CachedIdx < 
pAd
->
SCfg
.
SavedPMKNum
; CachedIdx++)

4252 i(
	`NdisEquMemy
(
pBssIdInfo
->
BSSID
, 
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
].BSSID, (
NDIS_802_11_MAC_ADDRESS
)))

4257 i(
CachedIdx
 < 
PMKID_NO
)

4259 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("UpdOID_802_11_PMKID, idx = %d\n", 
CachedIdx
));

4260 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
], 
pBssIdInfo
, (
BSSID_INFO
));

4261 
pAd
->
SCfg
.
SavedPMKNum
++;

4267 
CachedIdx
 = (
pBssIdInfo
->
BSSID
[5] % 
PMKID_NO
);

4268 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("UpdOID_802_11_PMKID, idx = %d\n", 
CachedIdx
));

4269 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
SavedPMK
[
CachedIdx
], 
pBssIdInfo
, (
BSSID_INFO
));

4273 if(
pPmkId
)

4274 
	`k
(
pPmkId
);

4277 
RT_OID_WPS_PROBE_REQ_IE
:

4278 i(
pAd
->
SCfg
.
pWpsProbeReqIe
)

4280 
	`k
(
pAd
->
SCfg
.
pWpsProbeReqIe
);

4281 
pAd
->
SCfg
.
pWpsProbeReqIe
 = 
NULL
;

4283 
pAd
->
SCfg
.
WpsProbeReqIeL
 = 0;

4284 
pAd
->
SCfg
.
pWpsProbeReqIe
 = 
	`kmloc
(
wrq
->
u
.
da
.
ngth
, 
MEM_ALLOC_FLAG
);

4285 i(
pAd
->
SCfg
.
pWpsProbeReqIe
)

4287 
Stus
 = 
	`cy_om_ur
(
pAd
->
SCfg
.
pWpsProbeReqIe
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4289 i(
Stus
)

4291 
Stus
 = -
EINVAL
;

4292 i(
pAd
->
SCfg
.
pWpsProbeReqIe
)

4294 
	`k
(
pAd
->
SCfg
.
pWpsProbeReqIe
);

4295 
pAd
->
SCfg
.
pWpsProbeReqIe
 = 
NULL
;

4297 
pAd
->
SCfg
.
WpsProbeReqIeL
 = 0;

4298 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::RT_OID_WPS_PROBE_REQ_IE, Failed (copy_from_user failed)!!\n"));

4302 
pAd
->
SCfg
.
WpsProbeReqIeL
 = 
wrq
->
u
.
da
.
ngth
;

4303 
	`hex_dump
("WpsProbeReqIe", 
pAd
->
SCfg
.
pWpsProbeReqIe
,Ad->SCfg.
WpsProbeReqIeL
);

4304 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::RT_OID_WPS_PROBE_REQ_IE, WpsProbeReqIeLen = %d!!\n",

4305 
pAd
->
SCfg
.
WpsProbeReqIeL
));

4309 
Stus
 = -
ENOMEM
;

4315 #ifde
SNMP_SUPPORT


4316 
OID_802_11_SHORTRETRYLIMIT
:

4317 i(
wrq
->
u
.
da
.
ngth
 !(
ULONG
))

4318 
Stus
 = -
EINVAL
;

4321 
Stus
 = 
	`cy_om_ur
(&
ShtRryLim
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4322 
	`RTMP_IO_READ32
(
pAd
, 
TX_RTY_CFG
, &
tx_y_cfg
.
wd
);

4323 
tx_y_cfg
.
fld
.
ShtRtyLim
 = 
ShtRryLim
;

4324 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_RTY_CFG
, 
tx_y_cfg
.
wd
);

4325 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_SHORTRETRYLIMIT (tx_y_cfg.fld.ShtRryLim=%d, ShtRryLim=%ld)\n", 
tx_y_cfg
.
fld
.
ShtRtyLim
, 
ShtRryLim
));

4329 
OID_802_11_LONGRETRYLIMIT
:

4330 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_LONGRETRYLIMIT \n"));

4331 i(
wrq
->
u
.
da
.
ngth
 !(
ULONG
))

4332 
Stus
 = -
EINVAL
;

4335 
Stus
 = 
	`cy_om_ur
(&
LgRryLim
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4336 
	`RTMP_IO_READ32
(
pAd
, 
TX_RTY_CFG
, &
tx_y_cfg
.
wd
);

4337 
tx_y_cfg
.
fld
.
LgRtyLim
 = 
LgRryLim
;

4338 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_RTY_CFG
, 
tx_y_cfg
.
wd
);

4339 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::OID_802_11_LONGRETRYLIMIT (tx_y_cfg.fld.LgRryLim%d,LgRryLim=%ld)\n", 
tx_y_cfg
.
fld
.
LgRtyLim
, 
LgRryLim
));

4343 
OID_802_11_WEPDEFAULTKEYVALUE
:

4344 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_WEPDEFAULTKEYVALUE\n"));

4345 
pKey
 = 
	`kmloc
(
wrq
->
u
.
da
.
ngth
, 
GFP_KERNEL
);

4346 i(
pKey
 =
NULL
)

4348 
Stus
 = -
EINVAL
;

4349 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_WEPDEFAULTKEYVALUE, Failed!!\n"));

4353 
Stus
 = 
	`cy_om_ur
(
pKey
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4356 i
pKey
->
Lgth
 !
wrq
->
u
.
da
.
ngth
)

4358 
Stus
 = -
EINVAL
;

4359 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_WEPDEFAULTKEYVALUE, Failed!!\n"));

4361 
KeyIdx
 = 
pKey
->
KeyIndex
 & 0x0fffffff;

4362 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("pKey->KeyIndex =%d,Key->KeyLgth=%d\n", 
pKey
->
KeyIndex
,Key->
KeyLgth
));

4365 i(
KeyIdx
 >= 4)

4366 
Stus
 = -
EINVAL
;

4369 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
KeyL
 = (
UCHAR

pKey
->
KeyLgth
;

4370 
	`NdisMoveMemy
(&
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
Key
, &
pKey
->
KeyMl
,Key->
KeyLgth
);

4371 i(
pKey
->
KeyIndex
 & 0x80000000)

4374 
pAd
->
SCfg
.
DeuKeyId
 = (
UCHAR

KeyIdx
;

4378 
	`k
(
pKey
);

4382 
OID_802_11_WEPDEFAULTKEYID
:

4383 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_WEPDEFAULTKEYID \n"));

4385 i(
wrq
->
u
.
da
.
ngth
 !(
UCHAR
))

4386 
Stus
 = -
EINVAL
;

4388 
Stus
 = 
	`cy_om_ur
(&
pAd
->
SCfg
.
DeuKeyId
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4393 
OID_802_11_CURRENTCHANNEL
:

4394 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set::OID_802_11_CURRENTCHANNEL \n"));

4395 i(
wrq
->
u
.
da
.
ngth
 !(
UCHAR
))

4396 
Stus
 = -
EINVAL
;

4399 
Stus
 = 
	`cy_om_ur
(&
mp
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4400 
	`rtf
((
PSTRING
)&
mp
,"%d", ctmp);

4401 
	`S_Chl_Proc
(
pAd
, (
PSTRING
)&
mp
);

4408 #ifde
XLINK_SUPPORT


4409 
RT_OID_802_11_SET_PSPXLINK_MODE
:

4410 i(
wrq
->
u
.
da
.
ngth
 !(
BOOLEAN
))

4411 
Stus
 = -
EINVAL
;

4414 
Stus
 = 
	`cy_om_ur
(&
pAd
->
SCfg
.
PSPXlk
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
);

4417 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("S::RT_OID_802_11_SET_PSPXLINK_MODE(=%d\n", 
pAd
->
SCfg
.
PSPXlk
));

4424 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S::unknowIOCTL'subcmd = 0x%08x\n", 
cmd
));

4425 
Stus
 = -
EOPNOTSUPP
;

4430  
Stus
;

4431 
	}
}

4433 
INT
 
	$RTMPQuyInfmi
(

4434 
IN
 
PRTMP_ADAPTER
 
pAd
,

4435 
IN
 
OUT
 
ieq
 *
rq
,

4436 
IN
 
INT
 
cmd
)

4438 
iwq
 *
wrq
 = (iwq *
rq
;

4439 
NDIS_802_11_BSSID_LIST_EX
 *
pBssidLi
 = 
NULL
;

4440 
PNDIS_WLAN_BSSID_EX
 
pBss
;

4441 
NDIS_802_11_SSID
 
Ssid
;

4442 
NDIS_802_11_CONFIGURATION
 *
pCfiguti
 = 
NULL
;

4443 
RT_802_11_LINK_STATUS
 *
pLkStus
 = 
NULL
;

4444 
RT_802_11_STA_CONFIG
 *
pSCfig
 = 
NULL
;

4445 
NDIS_802_11_STATISTICS
 *
pStiics
 = 
NULL
;

4446 
NDIS_802_11_RTS_THRESHOLD
 
RtsThsh
;

4447 
NDIS_802_11_FRAGMENTATION_THRESHOLD
 
FgThsh
;

4448 
NDIS_802_11_POWER_MODE
 
PowMode
;

4449 
NDIS_802_11_NETWORK_INFRASTRUCTURE
 
BssTy
;

4450 
RT_802_11_PREAMBLE
 
PamTy
;

4451 
NDIS_802_11_AUTHENTICATION_MODE
 
AuthMode
;

4452 
NDIS_802_11_WEP_STATUS
 
WStus
;

4453 
NDIS_MEDIA_STATE
 
MedS
;

4454 
ULONG
 
BssBufSize
, 
ulInfo
=0, 
NwkTyLi
[4], 
sd
 = 0, 
ReVue
=0;

4455 
USHORT
 
BssL
 = 0;

4456 
PUCHAR
 
pBuf
 = 
NULL
, 
pP
;

4457 
INT
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

4458 
UINT
 
we_vsi_comped
;

4459 
UCHAR
 
i
, 
Paddg
 = 0;

4460 
BOOLEAN
 
RadioS
;

4461 
STRING
 
drivVsi
[8];

4462 
OID_SET_HT_PHYMODE
 *
pHTPhyMode
 = 
NULL
;

4463 
HTTRANSMIT_SETTING
 
HTPhyMode
;

4466 #ifde
SNMP_SUPPORT


4468 
DeuKeyIdxVue
 *
pKeyIdxVue
;

4469 
INT
 
vueL
;

4470 
TX_RTY_CFG_STRUC
 
tx_y_cfg
;

4471 
ULONG
 
ShtRryLim
, 
LgRryLim
;

4472 
UCHAR
 
tmp
[64];

4476 
cmd
)

4478 
RT_OID_DEVICE_NAME
:

4479 
wrq
->
u
.
da
.
ngth
 = (
pAd
->
nickme
);

4480 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pAd
->
nickme
, wrq->u.da.
ngth
);

4482 
RT_OID_VERSION_INFO
:

4483 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_VERSION_INFO \n"));

4484 
wrq
->
u
.
da
.
ngth
 = 8*(
CHAR
);

4485 
	`rtf
(&
drivVsi
[0], "%s", 
STA_DRIVER_VERSION
);

4486 
drivVsi
[7] = '\0';

4487 i(
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
drivVsi
[0], wrq->u.da.
ngth
))

4489 
Stus
 = -
EFAULT
;

4493 
OID_802_11_BSSID_LIST
:

4494 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

4499 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
TRUE
;

4500 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_BSSID_LIST (Still scanning)\n"));

4501  -
EAGAIN
;

4504 i(
pAd
->
SCfg
.
bImovedSn
)

4509 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
TRUE
;

4510 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_BSSID_LIST (Still scanning)\n"));

4511  -
EAGAIN
;

4514 #ifde
WPA_SUPPLICANT_SUPPORT


4515 i((
pAd
->
SCfg
.
WSuliUP
 & 0x7F=
WPA_SUPPLICANT_ENABLE
)

4517 
pAd
->
SCfg
.
WSuliSnCou
 = 0;

4520 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_BSSID_LIST (%d BSSued)\n",
pAd
->
SnTab
.
BssNr
));

4522 
BssBufSize
 = (
ULONG
);

4524 
i
 = 0; i < 
pAd
->
SnTab
.
BssNr
; i++)

4530 
BssBufSize
 +((
NDIS_WLAN_BSSID_EX
- 1 + (
NDIS_802_11_FIXED_IEs
+ 
pAd
->
SnTab
.
BssEry
[
i
].
VIEL
 + 
Paddg
);

4534 
BssBufSize
 += 256;

4536 
pBuf
 = 
	`kmloc
(
BssBufSize
, 
MEM_ALLOC_FLAG
);

4537 if(
pBuf
 =
NULL
)

4539 
Stus
 = -
ENOMEM
;

4543 
	`NdisZoMemy
(
pBuf
, 
BssBufSize
);

4544 
pBssidLi
 = (
PNDIS_802_11_BSSID_LIST_EX

pBuf
;

4545 
pBssidLi
->
NumbOfIms
 = 
pAd
->
SnTab
.
BssNr
;

4548 
BssL
 = 4;

4551 
pP
 = (
PUCHAR
&
pBssidLi
->
Bssid
[0];

4552 
i
 = 0; i < 
pAd
->
SnTab
.
BssNr
; i++)

4554 
pBss
 = (
PNDIS_WLAN_BSSID_EX

pP
;

4555 
	`NdisMoveMemy
(&
pBss
->
MacAddss
, &
pAd
->
SnTab
.
BssEry
[
i
].
Bssid
, 
MAC_ADDR_LEN
);

4556 i((
pAd
->
SnTab
.
BssEry
[
i
].
Hidd
 =1&& (pAd->
SCfg
.
bShowHiddSSID
 =
FALSE
))

4562 i((
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
&& (pAd->SCfg.
PtSecud
 !
WPA_802_1X_PORT_SECURED
))

4564 
pBss
->
Ssid
.
SsidLgth
 = 
pAd
->
SnTab
.
BssEry
[
i
].
SsidL
;

4565 
	`NdisMoveMemy
(
pBss
->
Ssid
.Ssid, 
pAd
->
SnTab
.
BssEry
[
i
].Ssid,Ad->SnTab.BssEry[i].
SsidL
);

4568 
pBss
->
Ssid
.
SsidLgth
 = 0;

4572 
pBss
->
Ssid
.
SsidLgth
 = 
pAd
->
SnTab
.
BssEry
[
i
].
SsidL
;

4573 
	`NdisMoveMemy
(
pBss
->
Ssid
.Ssid, 
pAd
->
SnTab
.
BssEry
[
i
].Ssid,Ad->SnTab.BssEry[i].
SsidL
);

4575 
pBss
->
Privacy
 = 
pAd
->
SnTab
.
BssEry
[
i
].Privacy;

4576 
pBss
->
Rssi
 = 
pAd
->
SnTab
.
BssEry
[
i
].Rss-Ad->
BbpRssiToDbmD
;

4577 
pBss
->
NwkTyInU
 = 
	`NwkTyInUSy
(&
pAd
->
SnTab
.
BssEry
[
i
]);

4578 
pBss
->
Cfiguti
.
Lgth
 = (
NDIS_802_11_CONFIGURATION
);

4579 
pBss
->
Cfiguti
.
BcPiod
 = 
pAd
->
SnTab
.
BssEry
[
i
].BeaconPeriod;

4580 
pBss
->
Cfiguti
.
ATIMWdow
 = 
pAd
->
SnTab
.
BssEry
[
i
].
AtimW
;

4583 
	`MAP_CHANNEL_ID_TO_KHZ
(
pAd
->
SnTab
.
BssEry
[
i
].
Chl
, 
pBss
->
Cfiguti
.
DSCfig
);

4585 i(
pAd
->
SnTab
.
BssEry
[
i
].
BssTy
 =
BSS_INFRA
)

4586 
pBss
->
InaruuMode
 = 
Ndis802_11Inaruu
;

4588 
pBss
->
InaruuMode
 = 
Ndis802_11IBSS
;

4590 
	`NdisMoveMemy
(
pBss
->
Su܋dRes
, 
pAd
->
SnTab
.
BssEry
[
i
].
SupRe
,Ad->SnTab.BssEry[i].
SupReL
);

4591 
	`NdisMoveMemy
(
pBss
->
Su܋dRes
 + 
pAd
->
SnTab
.
BssEry
[
i
].
SupReL
,

4592 
pAd
->
SnTab
.
BssEry
[
i
].
ExtRe
,

4593 
pAd
->
SnTab
.
BssEry
[
i
].
ExtReL
);

4595 i(
pAd
->
SnTab
.
BssEry
[
i
].
VIEL
 == 0)

4597 
pBss
->
IELgth
 = (
NDIS_802_11_FIXED_IEs
);

4598 
	`NdisMoveMemy
(
pBss
->
IEs
, &
pAd
->
SnTab
.
BssEry
[
i
].
FixIEs
, (
NDIS_802_11_FIXED_IEs
));

4599 
pP
 =P + (
NDIS_WLAN_BSSID_EX
- 1 + (
NDIS_802_11_FIXED_IEs
);

4603 
pBss
->
IELgth
 = (
ULONG
)((
NDIS_802_11_FIXED_IEs
+ 
pAd
->
SnTab
.
BssEry
[
i
].
VIEL
);

4604 
pP
 =P + (
NDIS_WLAN_BSSID_EX
- 1 + (
NDIS_802_11_FIXED_IEs
);

4605 
	`NdisMoveMemy
(
pBss
->
IEs
, &
pAd
->
SnTab
.
BssEry
[
i
].
FixIEs
, (
NDIS_802_11_FIXED_IEs
));

4606 
	`NdisMoveMemy
(
pBss
->
IEs
 + (
NDIS_802_11_FIXED_IEs
), 
pAd
->
SnTab
.
BssEry
[
i
].
VIEs
,Ad->SnTab.BssEry[i].
VIEL
);

4607 
pP
 +
pAd
->
SnTab
.
BssEry
[
i
].
VIEL
;

4609 
pBss
->
Lgth
 = (
ULONG
)((
NDIS_WLAN_BSSID_EX
- 1 + (
NDIS_802_11_FIXED_IEs
+ 
pAd
->
SnTab
.
BssEry
[
i
].
VIEL
 + 
Paddg
);

4611 #i
WIRELESS_EXT
 < 17

4612 i((
BssL
 + 
pBss
->
Lgth
< 
wrq
->
u
.
da
.
ngth
)

4613 
BssL
 +
pBss
->
Lgth
;

4616 
pBssidLi
->
NumbOfIms
 = 
i
;

4620 
BssL
 +
pBss
->
Lgth
;

4624 #i
WIRELESS_EXT
 < 17

4625 
wrq
->
u
.
da
.
ngth
 = 
BssL
;

4627 i(
BssL
 > 
wrq
->
u
.
da
.
ngth
)

4629 
	`k
(
pBssidLi
);

4630  -
E2BIG
;

4633 
wrq
->
u
.
da
.
ngth
 = 
BssL
;

4635 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pBssidLi
, 
BssL
);

4636 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
FALSE
;

4637 
	`k
(
pBssidLi
);

4639 
OID_802_3_CURRENT_ADDRESS
:

4640 
wrq
->
u
.
da
.
ngth
 = 
MAC_ADDR_LEN
;

4641 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CutAddss
, wrq->u.da.
ngth
);

4643 
OID_GEN_MEDIA_CONNECT_STATUS
:

4644 i(
pAd
->
IndiMedS
 =
NdisMedSCed
)

4645 
MedS
 = 
NdisMedSCed
;

4647 
MedS
 = 
NdisMedSDisced
;

4649 
wrq
->
u
.
da
.
ngth
 = (
NDIS_MEDIA_STATE
);

4650 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
MedS
, wrq->u.da.
ngth
);

4652 
OID_802_11_BSSID
:

4653 i(
	`INFRA_ON
(
pAd
|| 
	`ADHOC_ON
(pAd))

4655 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CommCfg
.
Bssid
, (
NDIS_802_11_MAC_ADDRESS
));

4660 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_BSSID(=EMPTY)\n"));

4661 
Stus
 = -
ENOTCONN
;

4664 
OID_802_11_SSID
:

4665 
	`NdisZoMemy
(&
Ssid
, (
NDIS_802_11_SSID
));

4666 
	`NdisZoMemy
(
Ssid
.Ssid, 
MAX_LEN_OF_SSID
);

4667 
Ssid
.
SsidLgth
 = 
pAd
->
CommCfg
.
SsidL
;

4668 
	`memy
(
Ssid
.Ssid, 
pAd
->
CommCfg
.Ssid, Ssid.
SsidLgth
);

4669 
wrq
->
u
.
da
.
ngth
 = (
NDIS_802_11_SSID
);

4670 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
Ssid
, wrq->u.da.
ngth
);

4671 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_SSID (L=%d, ssid=%s)\n", 
Ssid
.
SsidLgth
,Ssid.Ssid));

4673 
RT_OID_802_11_QUERY_LINK_STATUS
:

4674 
pLkStus
 = (
RT_802_11_LINK_STATUS
 *
	`kmloc
((RT_802_11_LINK_STATUS), 
MEM_ALLOC_FLAG
);

4675 i(
pLkStus
)

4677 
pLkStus
->
CuTxRe
 = 
ReIdTo500Kbps
[
pAd
->
CommCfg
.
TxRe
];

4678 
pLkStus
->
ChlQuy
 = 
pAd
->
Mlme
.ChannelQuality;

4679 
pLkStus
->
RxByCou
 = 
pAd
->
RkCous
.
ReivedByCou
;

4680 
pLkStus
->
TxByCou
 = 
pAd
->
RkCous
.
TnsmdByCou
;

4681 
pLkStus
->
CChl
 = 
pAd
->
CommCfg
.CentralChannel;

4682 
wrq
->
u
.
da
.
ngth
 = (
RT_802_11_LINK_STATUS
);

4683 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pLkStus
, wrq->u.da.
ngth
);

4684 
	`k
(
pLkStus
);

4685 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_QUERY_LINK_STATUS\n"));

4689 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_QUERY_LINK_STATUS(kmalloc failed)\n"));

4690 
Stus
 = -
EFAULT
;

4693 
OID_802_11_CONFIGURATION
:

4694 
pCfiguti
 = (
NDIS_802_11_CONFIGURATION
 *
	`kmloc
((NDIS_802_11_CONFIGURATION), 
MEM_ALLOC_FLAG
);

4695 i(
pCfiguti
)

4697 
pCfiguti
->
Lgth
 = (
NDIS_802_11_CONFIGURATION
);

4698 
pCfiguti
->
BcPiod
 = 
pAd
->
CommCfg
.BeaconPeriod;

4699 
pCfiguti
->
ATIMWdow
 = 
pAd
->
SAive
.
AtimW
;

4700 
	`MAP_CHANNEL_ID_TO_KHZ
(
pAd
->
CommCfg
.
Chl
, 
pCfiguti
->
DSCfig
);

4701 
wrq
->
u
.
da
.
ngth
 = (
NDIS_802_11_CONFIGURATION
);

4702 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pCfiguti
, wrq->u.da.
ngth
);

4703 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_CONFIGURATION(BeaconPeriod=%ld,AtimW=%ld,Channel=%d) \n",

4704 
pCfiguti
->
BcPiod
,Cfiguti->
ATIMWdow
, 
pAd
->
CommCfg
.
Chl
));

4705 
	`k
(
pCfiguti
);

4709 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_CONFIGURATION(kmalloc failed)\n"));

4710 
Stus
 = -
EFAULT
;

4713 
RT_OID_802_11_SNR_0
:

4714 i((
pAd
->
SCfg
.
LaSNR0
 > 0))

4717 
ulInfo
 = ((0xeb - 
pAd
->
SCfg
.
LaSNR0
) * 3) / 16 ;

4719 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4720 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4721 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_SNR_0(0x=%lx)\n", 
ulInfo
));

4724 
Stus
 = -
EFAULT
;

4726 
RT_OID_802_11_SNR_1
:

4727 i((
pAd
->
A
.
fld
.
RxPh
 > 1) &&

4728 (
pAd
->
SCfg
.
LaSNR1
 > 0))

4731 
ulInfo
 = ((0xeb - 
pAd
->
SCfg
.
LaSNR1
) * 3) / 16 ;

4733 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4734 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4735 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Quy::RT_OID_802_11_SNR_1(0x=%lx)\n",
ulInfo
));

4738 
Stus
 = -
EFAULT
;

4739 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Quy::RT_OID_802_11_SNR_1Ad->SCfg.LaSNR1=%d)\n",
pAd
->
SCfg
.
LaSNR1
));

4744 
OID_802_11_RSSI_TRIGGER
:

4745 
ulInfo
 = 
pAd
->
SCfg
.
RssiSame
.
LaRssi0
 -Ad->
BbpRssiToDbmD
;

4746 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4747 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4748 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_RSSI_TRIGGER(=%ld)\n", 
ulInfo
));

4750 
OID_802_11_RSSI
:

4751 
RT_OID_802_11_RSSI
:

4752 
ulInfo
 = 
pAd
->
SCfg
.
RssiSame
.
LaRssi0
;

4753 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4754 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4756 
RT_OID_802_11_RSSI_1
:

4757 
ulInfo
 = 
pAd
->
SCfg
.
RssiSame
.
LaRssi1
;

4758 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4759 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4761 
RT_OID_802_11_RSSI_2
:

4762 
ulInfo
 = 
pAd
->
SCfg
.
RssiSame
.
LaRssi2
;

4763 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4764 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4766 
OID_802_11_STATISTICS
:

4767 
pStiics
 = (
NDIS_802_11_STATISTICS
 *
	`kmloc
((NDIS_802_11_STATISTICS), 
MEM_ALLOC_FLAG
);

4768 i(
pStiics
)

4770 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_STATISTICS \n"));

4772 
	`NICUpdeRawCous
(
pAd
);

4775 i(
pAd
->
WnCous
.
TnsmdFgmtCou
.
QuadPt
 <Ad->WnCous.
RryCou
.QuadPart)

4776 
pAd
->
WnCous
.
TnsmdFgmtCou
.
QuadPt
 =Ad->WnCous.
RryCou
.QuadPart;

4778 
pStiics
->
TnsmdFgmtCou
.
QuadPt
 = 
pAd
->
WnCous
.TransmittedFragmentCount.QuadPart;

4779 
pStiics
->
MuiTnsmdFmeCou
.
QuadPt
 = 
pAd
->
WnCous
.MulticastTransmittedFrameCount.QuadPart;

4780 
pStiics
->
FaedCou
.
QuadPt
 = 
pAd
->
WnCous
.FailedCount.QuadPart;

4781 
pStiics
->
RryCou
.
QuadPt
 = 
pAd
->
WnCous
.RetryCount.QuadPart;

4782 
pStiics
->
MuɝRryCou
.
QuadPt
 = 
pAd
->
WnCous
.MultipleRetryCount.QuadPart;

4783 
pStiics
->
RTSSucssCou
.
QuadPt
 = 
pAd
->
WnCous
.RTSSuccessCount.QuadPart;

4784 
pStiics
->
RTSFauCou
.
QuadPt
 = 
pAd
->
WnCous
.RTSFailureCount.QuadPart;

4785 
pStiics
->
ACKFauCou
.
QuadPt
 = 
pAd
->
WnCous
.ACKFailureCount.QuadPart;

4786 
pStiics
->
FmeDuiCou
.
QuadPt
 = 
pAd
->
WnCous
.FrameDuplicateCount.QuadPart;

4787 
pStiics
->
ReivedFgmtCou
.
QuadPt
 = 
pAd
->
WnCous
.ReceivedFragmentCount.QuadPart;

4788 
pStiics
->
MuiReivedFmeCou
.
QuadPt
 = 
pAd
->
WnCous
.MulticastReceivedFrameCount.QuadPart;

4789 #ifde
DBG


4790 
pStiics
->
FCSECou
 = 
pAd
->
RkCous
.
RlFcsECou
;

4792 
pStiics
->
FCSECou
.
QuadPt
 = 
pAd
->
WnCous
.FCSErrorCount.QuadPart;

4793 
pStiics
->
FmeDuiCou
.
u
.
LowPt
 = 
pAd
->
WnCous
.FrameDuplicateCount.u.LowPart / 100;

4795 
wrq
->
u
.
da
.
ngth
 = (
NDIS_802_11_STATISTICS
);

4796 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pStiics
, wrq->u.da.
ngth
);

4797 
	`k
(
pStiics
);

4801 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_STATISTICS(kmalloc failed)\n"));

4802 
Stus
 = -
EFAULT
;

4805 
OID_GEN_RCV_OK
:

4806 
ulInfo
 = 
pAd
->
Cous8023
.
GoodReives
;

4807 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4808 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4810 
OID_GEN_RCV_NO_BUFFER
:

4811 
ulInfo
 = 
pAd
->
Cous8023
.
RxNoBufr
;

4812 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4813 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4815 
RT_OID_802_11_PHY_MODE
:

4816 
ulInfo
 = (
ULONG
)
pAd
->
CommCfg
.
PhyMode
;

4817 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4818 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4819 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_PHY_MODE (=%ld)\n", 
ulInfo
));

4821 
RT_OID_802_11_STA_CONFIG
:

4822 
pSCfig
 = (
RT_802_11_STA_CONFIG
 *
	`kmloc
((RT_802_11_STA_CONFIG), 
MEM_ALLOC_FLAG
);

4823 i(
pSCfig
)

4825 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_STA_CONFIG\n"));

4826 
pSCfig
->
EbTxBur
 = 
pAd
->
CommCfg
.
bEbTxBur
;

4827 
pSCfig
->
EbTurboRe
 = 0;

4828 
pSCfig
->
UBGPrei
 = 
pAd
->
CommCfg
.UseBGProtection;

4829 
pSCfig
->
UShtSlTime
 = 
pAd
->
CommCfg
.
bUShtSlTime
;

4831 
pSCfig
->
HwRadioStus
 = (
pAd
->
SCfg
.
bHwRadio
 =
TRUE
) ? 1 : 0;

4832 
pSCfig
->
Rsv1
 = 0;

4833 
pSCfig
->
SyemEBm
 = 
pAd
->SystemErrorBitmap;

4834 
wrq
->
u
.
da
.
ngth
 = (
RT_802_11_STA_CONFIG
);

4835 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pSCfig
, wrq->u.da.
ngth
);

4836 
	`k
(
pSCfig
);

4840 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_STA_CONFIG(kmalloc failed)\n"));

4841 
Stus
 = -
EFAULT
;

4844 
OID_802_11_RTS_THRESHOLD
:

4845 
RtsThsh
 = 
pAd
->
CommCfg
.
RtsThshd
;

4846 
wrq
->
u
.
da
.
ngth
 = (
RtsThsh
);

4847 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
RtsThsh
, wrq->u.da.
ngth
);

4848 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_RTS_THRESHOLD(=%ld)\n", 
RtsThsh
));

4850 
OID_802_11_FRAGMENTATION_THRESHOLD
:

4851 
FgThsh
 = 
pAd
->
CommCfg
.
FgmtThshd
;

4852 i(
pAd
->
CommCfg
.
bUZoToDibFgmt
 =
TRUE
)

4853 
FgThsh
 = 0;

4854 
wrq
->
u
.
da
.
ngth
 = (
FgThsh
);

4855 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
FgThsh
, wrq->u.da.
ngth
);

4856 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_FRAGMENTATION_THRESHOLD(=%ld)\n", 
FgThsh
));

4858 
OID_802_11_POWER_MODE
:

4859 
PowMode
 = 
pAd
->
SCfg
.
WdowsPowMode
;

4860 
wrq
->
u
.
da
.
ngth
 = (
PowMode
);

4861 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
PowMode
, wrq->u.da.
ngth
);

4862 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_POWER_MODE(=%d)\n", 
PowMode
));

4864 
RT_OID_802_11_RADIO
:

4865 
RadioS
 = (
BOOLEAN

pAd
->
SCfg
.
bSwRadio
;

4866 
wrq
->
u
.
da
.
ngth
 = (
RadioS
);

4867 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
RadioS
, wrq->u.da.
ngth
);

4868 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_QUERY_RADIO (=%d)\n", 
RadioS
));

4870 
OID_802_11_INFRASTRUCTURE_MODE
:

4871 i(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
)

4872 
BssTy
 = 
Ndis802_11IBSS
;

4873 i(
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
)

4874 
BssTy
 = 
Ndis802_11Inaruu
;

4875 i(
pAd
->
SCfg
.
BssTy
 =
BSS_MONITOR
)

4876 
BssTy
 = 
Ndis802_11Mڙ
;

4878 
BssTy
 = 
Ndis802_11AutoUnknown
;

4880 
wrq
->
u
.
da
.
ngth
 = (
BssTy
);

4881 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
BssTy
, wrq->u.da.
ngth
);

4882 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_INFRASTRUCTURE_MODE(=%d)\n", 
BssTy
));

4884 
RT_OID_802_11_PREAMBLE
:

4885 
PamTy
 = 
pAd
->
CommCfg
.
TxPamb
;

4886 
wrq
->
u
.
da
.
ngth
 = (
PamTy
);

4887 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
PamTy
, wrq->u.da.
ngth
);

4888 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_PREAMBLE(=%d)\n", 
PamTy
));

4890 
OID_802_11_AUTHENTICATION_MODE
:

4891 
AuthMode
 = 
pAd
->
SCfg
.AuthMode;

4892 
wrq
->
u
.
da
.
ngth
 = (
AuthMode
);

4893 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
AuthMode
, wrq->u.da.
ngth
);

4894 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_AUTHENTICATION_MODE(=%d)\n", 
AuthMode
));

4896 
OID_802_11_WEP_STATUS
:

4897 
WStus
 = 
pAd
->
SCfg
.WepStatus;

4898 
wrq
->
u
.
da
.
ngth
 = (
WStus
);

4899 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
WStus
, wrq->u.da.
ngth
);

4900 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_WEP_STATUS(=%d)\n", 
WStus
));

4902 
OID_802_11_TX_POWER_LEVEL
:

4903 
wrq
->
u
.
da
.
ngth
 = (
ULONG
);

4904 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CommCfg
.
TxPow
, wrq->u.da.
ngth
);

4905 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_TX_POWER_LEVEL %x\n",
pAd
->
CommCfg
.
TxPow
));

4907 
RT_OID_802_11_TX_POWER_LEVEL_1
:

4908 
wrq
->
u
.
da
.
ngth
 = (
ULONG
);

4909 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CommCfg
.
TxPowPage
, wrq->u.da.
ngth
);

4910 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_TX_POWER_LEVEL_1 (=%ld)\n", 
pAd
->
CommCfg
.
TxPowPage
));

4912 
OID_802_11_NETWORK_TYPES_SUPPORTED
:

4913 i((
pAd
->
RfIcTy
 =
RFIC_2850
) ||

4914 (
pAd
->
RfIcTy
 =
RFIC_2750
) ||

4915 (
pAd
->
RfIcTy
 =
RFIC_3052
) ||

4916 (
pAd
->
RfIcTy
 =
RFIC_3053
) ||

4917 (
pAd
->
RfIcTy
 =
RFIC_2853
) ||

4918 (
pAd
->
RfIcTy
 =
RFIC_3853
))

4920 
NwkTyLi
[0] = 3;

4921 
NwkTyLi
[1] = 
Ndis802_11DS
;

4922 
NwkTyLi
[2] = 
Ndis802_11OFDM24
;

4923 
NwkTyLi
[3] = 
Ndis802_11OFDM5
;

4924 
wrq
->
u
.
da
.
ngth
 = 16;

4925 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
NwkTyLi
[0], wrq->u.da.
ngth
);

4929 
NwkTyLi
[0] = 2;

4930 
NwkTyLi
[1] = 
Ndis802_11DS
;

4931 
NwkTyLi
[2] = 
Ndis802_11OFDM24
;

4932 
wrq
->
u
.
da
.
ngth
 = 12;

4933 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
NwkTyLi
[0], wrq->u.da.
ngth
);

4935 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_NETWORK_TYPES_SUPPORTED\n"));

4937 
OID_802_11_NETWORK_TYPE_IN_USE
:

4938 
wrq
->
u
.
da
.
ngth
 = (
ULONG
);

4939 i(
pAd
->
CommCfg
.
PhyMode
 =
PHY_11A
)

4940 
ulInfo
 = 
Ndis802_11OFDM5
;

4941 i((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11BG_MIXED
|| (pAd->CommCfg.PhyMod=
PHY_11G
))

4942 
ulInfo
 = 
Ndis802_11OFDM24
;

4944 
ulInfo
 = 
Ndis802_11DS
;

4945 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4947 
RT_OID_802_11_QUERY_LAST_RX_RATE
:

4948 
ulInfo
 = (
ULONG
)
pAd
->
LaRxRe
;

4949 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4950 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4951 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_QUERY_LAST_RX_RATE (=%ld)\n", 
ulInfo
));

4953 
RT_OID_802_11_QUERY_LAST_TX_RATE
:

4954 
ulInfo
 = (
ULONG
)
pAd
->
LaTxRe
;

4955 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4956 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4957 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_QUERY_LAST_TX_RATE (=%lx)\n", 
ulInfo
));

4959 
RT_OID_802_11_QUERY_MAP_REAL_RX_RATE
:

4960 
ReVue
=0;

4961 
HTPhyMode
.
wd
 =(
USHORT

pAd
->
LaRxRe
;

4962 
	`gRe
(
HTPhyMode
, &
ReVue
);

4963 
wrq
->
u
.
da
.
ngth
 = (
ReVue
);

4964 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ReVue
, wrq->u.da.
ngth
);

4965 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_QUERY_LAST_RX_RATE (=%ld)\n", 
ReVue
));

4967 
RT_OID_802_11_QUERY_MAP_REAL_TX_RATE
:

4968 
ReVue
=0;

4969 
HTPhyMode
.
wd
 = (
USHORT
)
pAd
->
LaTxRe
;

4970 
	`gRe
(
HTPhyMode
, &
ReVue
);

4971 
wrq
->
u
.
da
.
ngth
 = (
ReVue
);

4972 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ReVue
, wrq->u.da.
ngth
);

4973 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_QUERY_LAST_TX_RATE (=%ld)\n", 
ReVue
));

4975 
RT_OID_802_11_QUERY_TX_PHYMODE
:

4976 
ulInfo
 = (
ULONG
)
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
wd
;

4977 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

4978 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

4979 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_QUERY_TX_PHYMODE (=%lx)\n", 
ulInfo
));

4981 
RT_OID_802_11_QUERY_EEPROM_VERSION
:

4982 
wrq
->
u
.
da
.
ngth
 = (
ULONG
);

4983 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
EromVsi
, wrq->u.da.
ngth
);

4985 
RT_OID_802_11_QUERY_FIRMWARE_VERSION
:

4986 
wrq
->
u
.
da
.
ngth
 = (
ULONG
);

4987 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
FmweVsi
, wrq->u.da.
ngth
);

4989 
RT_OID_802_11_QUERY_NOISE_LEVEL
:

4990 
wrq
->
u
.
da
.
ngth
 = (
UCHAR
);

4991 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
BbpWreLch
[17], wrq->u.da.
ngth
);

4992 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_QUERY_NOISE_LEVEL (=%d)\n", 
pAd
->
BbpWreLch
[17]));

4994 
RT_OID_802_11_EXTRA_INFO
:

4995 
wrq
->
u
.
da
.
ngth
 = (
ULONG
);

4996 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
ExaInfo
, wrq->u.da.
ngth
);

4997 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_EXTRA_INFO (=%ld)\n", 
pAd
->
ExaInfo
));

4999 
RT_OID_WE_VERSION_COMPILED
:

5000 
wrq
->
u
.
da
.
ngth
 = (
UINT
);

5001 
we_vsi_comped
 = 
WIRELESS_EXT
;

5002 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
we_vsi_comped
, wrq->u.da.
ngth
);

5004 
RT_OID_802_11_QUERY_APSD_SETTING
:

5005 
sd
 = (
pAd
->
CommCfg
.
bAPSDCab
 | (pAd->CommCfg.
bAPSDAC_BE
 << 1| (pAd->CommCfg.
bAPSDAC_BK
 << 2)

5006 | (
pAd
->
CommCfg
.
bAPSDAC_VI
 << 3| (pAd->CommCfg.
bAPSDAC_VO
 << 4| (pAd->CommCfg.
MaxSPLgth
 << 5));

5008 
wrq
->
u
.
da
.
ngth
 = (
ULONG
);

5009 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
sd
, wrq->u.da.
ngth
);

5010 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_QUERY_APSD_SETTING (=0x%lx,APSDCap=%d,AC_BE=%d,AC_BK=%d,AC_VI=%d,AC_VO=%d,MAXSPLen=%d)\n",

5011 
sd
,
pAd
->
CommCfg
.
bAPSDCab
,pAd->CommCfg.
bAPSDAC_BE
,pAd->CommCfg.
bAPSDAC_BK
,pAd->CommCfg.
bAPSDAC_VI
,pAd->CommCfg.
bAPSDAC_VO
,pAd->CommCfg.
MaxSPLgth
));

5013 
RT_OID_802_11_QUERY_APSD_PSM
:

5014 
wrq
->
u
.
da
.
ngth
 = (
ULONG
);

5015 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CommCfg
.
bAPSDFPowSave
, wrq->u.da.
ngth
);

5016 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_QUERY_APSD_PSM (=%d)\n", 
pAd
->
CommCfg
.
bAPSDFPowSave
));

5018 
RT_OID_802_11_QUERY_WMM
:

5019 
wrq
->
u
.
da
.
ngth
 = (
BOOLEAN
);

5020 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CommCfg
.
bWmmCab
, wrq->u.da.
ngth
);

5021 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_QUERY_WMM (=%d)\n", 
pAd
->
CommCfg
.
bWmmCab
));

5025 #ifde
WPA_SUPPLICANT_SUPPORT


5026 
RT_OID_NEW_DRIVER
:

5028 
UCHAR
 
abd
 = 1;

5029 
wrq
->
u
.
da
.
ngth
 = (
UCHAR
);

5030 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
abd
, wrq->u.da.
ngth
);

5031 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_NEW_DRIVER (=%d)\n", 
abd
));

5034 
RT_OID_WPA_SUPPLICANT_SUPPORT
:

5035 
wrq
->
u
.
da
.
ngth
 = (
UCHAR
);

5036 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
SCfg
.
WSuliUP
, wrq->u.da.
ngth
);

5037 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_WPA_SUPPLICANT_SUPPORT (=%d)\n", 
pAd
->
SCfg
.
WSuliUP
));

5041 
RT_OID_DRIVER_DEVICE_NAME
:

5042 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_DRIVER_DEVICE_NAME \n"));

5043 
wrq
->
u
.
da
.
ngth
 = 16;

5044 i(
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pAd
->
SCfg
.
dev_me
, wrq->u.da.
ngth
))

5046 
Stus
 = -
EFAULT
;

5049 
RT_OID_802_11_QUERY_HT_PHYMODE
:

5050 
pHTPhyMode
 = (
OID_SET_HT_PHYMODE
 *
	`kmloc
((OID_SET_HT_PHYMODE), 
MEM_ALLOC_FLAG
);

5051 i(
pHTPhyMode
)

5053 
pHTPhyMode
->
PhyMode
 = 
pAd
->
CommCfg
.PhyMode;

5054 
pHTPhyMode
->
HtMode
 = (
UCHAR
)
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
MODE
;

5055 
pHTPhyMode
->
BW
 = (
UCHAR
)
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.BW;

5056 
pHTPhyMode
->
MCS
(
UCHAR
)
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.MCS;

5057 
pHTPhyMode
->
SHORTGI
(
UCHAR
)
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
ShtGI
;

5058 
pHTPhyMode
->
STBC
(
UCHAR
)
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.STBC;

5060 
pHTPhyMode
->
ExtOfft
 = ((
pAd
->
CommCfg
.
CChl
 <Ad->CommCfg.
Chl
? (
EXTCHA_BELOW
: (
EXTCHA_ABOVE
));

5061 
wrq
->
u
.
da
.
ngth
 = (
OID_SET_HT_PHYMODE
);

5062 i(
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pHTPhyMode
, wrq->u.da.
ngth
))

5064 
Stus
 = -
EFAULT
;

5066 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_QUERY_HT_PHYMODE (PhyMode = %d, MCS =%d, BW = %d, STBC = %d, ExtOffset=%d)\n",

5067 
pHTPhyMode
->
HtMode
,HTPhyMode->
MCS
,HTPhyMode->
BW
,HTPhyMode->
STBC
,HTPhyMode->
ExtOfft
));

5068 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" MlmeUpdeTxRe(.wd = %x )\n", 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
wd
));

5069 
	`k
(
pHTPhyMode
);

5073 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_STA_CONFIG(kmalloc failed)\n"));

5074 
Stus
 = -
EFAULT
;

5077 
RT_OID_802_11_COUNTRY_REGION
:

5078 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_COUNTRY_REGION \n"));

5079 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

5080 
ulInfo
 = 
pAd
->
CommCfg
.
CouryRegiFABd
;

5081 
ulInfo
 = (ulInf<< 8)|(
pAd
->
CommCfg
.
CouryRegi
);

5082 i(
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
))

5084 
Stus
 = -
EFAULT
;

5087 
RT_OID_802_11_QUERY_DAT_HT_PHYMODE
:

5088 
pHTPhyMode
 = (
OID_SET_HT_PHYMODE
 *
	`kmloc
((OID_SET_HT_PHYMODE), 
MEM_ALLOC_FLAG
);

5089 i(
pHTPhyMode
)

5091 
pHTPhyMode
->
PhyMode
 = 
pAd
->
CommCfg
.PhyMode;

5092 
pHTPhyMode
->
HtMode
 = (
UCHAR
)
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
HTMODE
;

5093 
pHTPhyMode
->
BW
 = (
UCHAR
)
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.BW;

5094 
pHTPhyMode
->
MCS
(
UCHAR
)
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.MCS;

5095 
pHTPhyMode
->
SHORTGI
(
UCHAR
)
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
ShtGI
;

5096 
pHTPhyMode
->
STBC
(
UCHAR
)
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.STBC;

5098 
wrq
->
u
.
da
.
ngth
 = (
OID_SET_HT_PHYMODE
);

5099 i(
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pHTPhyMode
, wrq->u.da.
ngth
))

5101 
Stus
 = -
EFAULT
;

5103 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_QUERY_HT_PHYMODE (PhyMode = %d, MCS =%d, BW = %d, STBC = %d, ExtOffset=%d)\n",

5104 
pHTPhyMode
->
HtMode
,HTPhyMode->
MCS
,HTPhyMode->
BW
,HTPhyMode->
STBC
,HTPhyMode->
ExtOfft
));

5105 
	`DBGPRINT
(
RT_DEBUG_TRACE
, (" MlmeUpdeTxRe(.wd = %x )\n", 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
wd
));

5106 
	`k
(
pHTPhyMode
);

5110 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_STA_CONFIG(kmalloc failed)\n"));

5111 
Stus
 = -
EFAULT
;

5114 
RT_OID_QUERY_MULTIPLE_CARD_SUPPORT
:

5115 
wrq
->
u
.
da
.
ngth
 = (
UCHAR
);

5116 
i
 = 0;

5117 #ifde
MULTIPLE_CARD_SUPPORT


5118 
i
 = 1;

5120 i(
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
i
, wrq->u.da.
ngth
))

5122 
Stus
 = -
EFAULT
;

5124 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_QUERY_MULTIPLE_CARD_SUPPORT(=%d\n", 
i
));

5126 #ifde
SNMP_SUPPORT


5127 
RT_OID_802_11_MAC_ADDRESS
:

5128 
wrq
->
u
.
da
.
ngth
 = 
MAC_ADDR_LEN
;

5129 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CutAddss
, wrq->u.da.
ngth
);

5132 
RT_OID_802_11_MANUFACTUREROUI
:

5133 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_MANUFACTUREROUI \n"));

5134 
wrq
->
u
.
da
.
ngth
 = 
MuurOUI_LEN
;

5135 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CutAddss
, wrq->u.da.
ngth
);

5138 
RT_OID_802_11_MANUFACTURERNAME
:

5139 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_MANUFACTURERNAME \n"));

5140 
wrq
->
u
.
da
.
ngth
 = 
	`
(
MuurNAME
);

5141 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
MuurNAME
, wrq->u.da.
ngth
);

5144 
RT_OID_802_11_RESOURCETYPEIDNAME
:

5145 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_RESOURCETYPEIDNAME \n"));

5146 
wrq
->
u
.
da
.
ngth
 = 
	`
(
ResourTyIdName
);

5147 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
ResourTyIdName
, wrq->u.da.
ngth
);

5150 
RT_OID_802_11_PRIVACYOPTIONIMPLEMENTED
:

5151 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_PRIVACYOPTIONIMPLEMENTED \n"));

5152 
ulInfo
 = 1;

5153 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

5154 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

5157 
RT_OID_802_11_POWERMANAGEMENTMODE
:

5158 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_POWERMANAGEMENTMODE \n"));

5159 i(
pAd
->
SCfg
.
Psm
 =
PSMP_ACTION
)

5160 
ulInfo
 = 1;

5162 
ulInfo
 = 2;

5164 
wrq
->
u
.
da
.
ngth
 = (
ulInfo
);

5165 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ulInfo
, wrq->u.da.
ngth
);

5168 
OID_802_11_WEPDEFAULTKEYVALUE
:

5169 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_WEPDEFAULTKEYVALUE \n"));

5171 
pKeyIdxVue
 = 
wrq
->
u
.
da
.
por
;

5172 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("KeyIdxVue.KeyIdx = %d, \n",
pKeyIdxVue
->
KeyIdx
));

5173 
vueL
 = 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
KeyL
;

5174 
	`NdisMoveMemy
(
pKeyIdxVue
->
Vue
,

5175 &
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
Key
,

5176 
vueL
);

5177 
pKeyIdxVue
->
Vue
[
vueL
]='\0';

5179 
wrq
->
u
.
da
.
ngth
 = (
DeuKeyIdxVue
);

5181 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pKeyIdxVue
, wrq->u.da.
ngth
);

5182 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DefaultKeyId = %d,otalen = %d, stren=%d, KeyValue= %02x %02x %02x %02x \n",

5183 
pAd
->
SCfg
.
DeuKeyId
,

5184 
wrq
->
u
.
da
.
ngth
,

5185 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
KeyL
,

5186 
pAd
->
ShedKey
[
BSS0
][0].
Key
[0],

5187 
pAd
->
ShedKey
[
BSS0
][1].
Key
[0],

5188 
pAd
->
ShedKey
[
BSS0
][2].
Key
[0],

5189 
pAd
->
ShedKey
[
BSS0
][3].
Key
[0]));

5192 
OID_802_11_WEPDEFAULTKEYID
:

5193 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_WEPDEFAULTKEYID \n"));

5194 
wrq
->
u
.
da
.
ngth
 = (
UCHAR
);

5195 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
SCfg
.
DeuKeyId
, wrq->u.da.
ngth
);

5196 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("DeuKeyId =%d \n", 
pAd
->
SCfg
.
DeuKeyId
));

5199 
RT_OID_802_11_WEPKEYMAPPINGLENGTH
:

5200 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_WEPKEYMAPPINGLENGTH \n"));

5201 
wrq
->
u
.
da
.
ngth
 = (
UCHAR
);

5202 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
,

5203 &
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
KeyL
,

5204 
wrq
->
u
.
da
.
ngth
);

5207 
OID_802_11_SHORTRETRYLIMIT
:

5208 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_SHORTRETRYLIMIT \n"));

5209 
wrq
->
u
.
da
.
ngth
 = (
ULONG
);

5210 
	`RTMP_IO_READ32
(
pAd
, 
TX_RTY_CFG
, &
tx_y_cfg
.
wd
);

5211 
ShtRryLim
 = 
tx_y_cfg
.
fld
.
ShtRtyLim
;

5212 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ShtRryLim =%ld,x_y_cfg.fld.ShtRryLim=%d\n", 
ShtRryLim
, 
tx_y_cfg
.
fld
.
ShtRtyLim
));

5213 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
ShtRryLim
, wrq->u.da.
ngth
);

5216 
OID_802_11_LONGRETRYLIMIT
:

5217 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_LONGRETRYLIMIT \n"));

5218 
wrq
->
u
.
da
.
ngth
 = (
ULONG
);

5219 
	`RTMP_IO_READ32
(
pAd
, 
TX_RTY_CFG
, &
tx_y_cfg
.
wd
);

5220 
LgRryLim
 = 
tx_y_cfg
.
fld
.
LgRtyLim
;

5221 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("LgRryLim =%ld,x_y_cfg.fld.LgRtyLim=%d\n", 
LgRryLim
, 
tx_y_cfg
.
fld
.
LgRtyLim
));

5222 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
LgRryLim
, wrq->u.da.
ngth
);

5225 
RT_OID_802_11_PRODUCTID
:

5226 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_PRODUCTID \n"));

5228 #ifde
RTMP_MAC_PCI


5231 
USHORT
 
devi_id
;

5232 i(((
POS_COOKIE
)
pAd
->
OS_Cook
)->
pci_dev
 !
NULL
)

5233 
	`pci_ad_cfig_wd
(((
POS_COOKIE
)
pAd
->
OS_Cook
)->
pci_dev
, 
PCI_DEVICE_ID
, &
devi_id
);

5235 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ci_dev = NULL\n"));

5236 
	`rtf
((
PSTRING
)
tmp
, "%04x %04x\n", 
NIC_PCI_VENDOR_ID
, 
devi_id
);

5239 
wrq
->
u
.
da
.
ngth
 = 
	`
((
PSTRING
)
tmp
);

5240 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
tmp
, wrq->u.da.
ngth
);

5243 
RT_OID_802_11_MANUFACTUREID
:

5244 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_MANUFACTUREID \n"));

5245 
wrq
->
u
.
da
.
ngth
 = 
	`
(
MuurNAME
);

5246 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
MuurNAME
, wrq->u.da.
ngth
);

5249 
OID_802_11_CURRENTCHANNEL
:

5250 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_CURRENTCHANNEL \n"));

5251 
wrq
->
u
.
da
.
ngth
 = (
UCHAR
);

5252 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("sizeoUCHAR=%d, chl=%d \n", (
UCHAR
), 
pAd
->
CommCfg
.
Chl
));

5253 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CommCfg
.
Chl
, wrq->u.da.
ngth
);

5254 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Stus=%d\n", 
Stus
));

5258 
OID_802_11_BUILD_CHANNEL_EX
:

5260 
UCHAR
 
vue
;

5261 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_BUILD_CHANNEL_EX \n"));

5262 
wrq
->
u
.
da
.
ngth
 = (
UCHAR
);

5263 #ifde
EXT_BUILD_CHANNEL_LIST


5264 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Support EXT_BUILD_CHANNEL_LIST.\n"));

5265 
vue
 = 1;

5267 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Doesn't support EXT_BUILD_CHANNEL_LIST.\n"));

5268 
vue
 = 0;

5270 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
vue
, 1);

5271 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Stus=%d\n", 
Stus
));

5275 
OID_802_11_GET_CH_LIST
:

5277 
PRT_CHANNEL_LIST_INFO
 
pChLiBuf
;

5279 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_GET_CH_LIST \n"));

5280 i(
pAd
->
ChlLiNum
 == 0)

5282 
wrq
->
u
.
da
.
ngth
 = 0;

5286 
pChLiBuf
 = (
RT_CHANNEL_LIST_INFO
 *
	`kmloc
((RT_CHANNEL_LIST_INFO), 
MEM_ALLOC_FLAG
);

5287 i(
pChLiBuf
 =
NULL
)

5289 
wrq
->
u
.
da
.
ngth
 = 0;

5293 
pChLiBuf
->
ChlLiNum
 = 
pAd
->ChannelListNum;

5294 
i
 = 0; i < 
pChLiBuf
->
ChlLiNum
; i++)

5295 
pChLiBuf
->
ChlLi
[
i
] = 
pAd
->ChlLi[i].
Chl
;

5297 
wrq
->
u
.
da
.
ngth
 = (
RT_CHANNEL_LIST_INFO
);

5298 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pChLiBuf
, (
RT_CHANNEL_LIST_INFO
));

5299 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Stus=%d\n", 
Stus
));

5301 i(
pChLiBuf
)

5302 
	`k
(
pChLiBuf
);

5306 
OID_802_11_GET_COUNTRY_CODE
:

5307 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_GET_COUNTRY_CODE \n"));

5308 
wrq
->
u
.
da
.
ngth
 = 2;

5309 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CommCfg
.
CouryCode
, 2);

5310 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Stus=%d\n", 
Stus
));

5313 #ifde
EXT_BUILD_CHANNEL_LIST


5314 
OID_802_11_GET_CHANNEL_GEOGRAPHY
:

5315 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::OID_802_11_GET_CHANNEL_GEOGRAPHY \n"));

5316 
wrq
->
u
.
da
.
ngth
 = 1;

5317 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CommCfg
.
Geogphy
, 1);

5318 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Stus=%d\n", 
Stus
));

5323 #ifde
QOS_DLS_SUPPORT


5324 
RT_OID_802_11_QUERY_DLS
:

5325 
wrq
->
u
.
da
.
ngth
 = (
BOOLEAN
);

5326 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
CommCfg
.
bDLSCab
, wrq->u.da.
ngth
);

5327 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::RT_OID_802_11_QUERY_DLS(=%d)\n", 
pAd
->
CommCfg
.
bDLSCab
));

5330 
RT_OID_802_11_QUERY_DLS_PARAM
:

5332 
PRT_802_11_DLS_INFO
 
pDlsInfo
 = 
	`kmloc
((
RT_802_11_DLS_INFO
), 
GFP_ATOMIC
);

5333 i(
pDlsInfo
 =
NULL
)

5336 
i
=0; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

5338 
	`RTMPMoveMemy
(&
pDlsInfo
->
Ery
[
i
], &
pAd
->
SCfg
.
DLSEry
[i], (
RT_802_11_DLS_UI
));

5341 
pDlsInfo
->
num
 = 
MAX_NUM_OF_DLS_ENTRY
;

5342 
wrq
->
u
.
da
.
ngth
 = (
RT_802_11_DLS_INFO
);

5343 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
pDlsInfo
, wrq->u.da.
ngth
);

5344 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Query::RT_OID_802_11_QUERY_DLS_PARAM\n"));

5346 i(
pDlsInfo
)

5347 
	`k
(
pDlsInfo
);

5352 #ifde
XLINK_SUPPORT


5353 
OID_802_11_SET_PSPXLINK_MODE
:

5354 
wrq
->
u
.
da
.
ngth
 = (
BOOLEAN
);

5355 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, &
pAd
->
SCfg
.
PSPXlk
, wrq->u.da.
ngth
);

5356 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::OID_802_11_SET_PSPXLINK_MODE(=%d)\n", 
pAd
->
SCfg
.
PSPXlk
));

5362 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Quy::unknowIOCTL'subcmd = 0x%08x\n", 
cmd
));

5363 
Stus
 = -
EOPNOTSUPP
;

5366  
Stus
;

5367 
	}
}

5369 
INT
 
	$28xx_a_iol
(

5370 
IN
 
t_devi
 *
t_dev
,

5371 
IN
 
OUT
 
ieq
 *
rq
,

5372 
IN
 
INT
 
cmd
)

5374 
POS_COOKIE
 
pObj
;

5375 
RTMP_ADAPTER
 *
pAd
 = 
NULL
;

5376 
iwq
 *
wrq
 = (iwq *
rq
;

5377 
BOOLEAN
 
SMacheTouched
 = 
FALSE
;

5378 
INT
 
Stus
 = 
NDIS_STATUS_SUCCESS
;

5379 
USHORT
 
subcmd
;

5381 
	`GET_PAD_FROM_NET_DEV
(
pAd
, 
t_dev
);

5383 i(
pAd
 =
NULL
)

5387  -
ENETDOWN
;

5389 
pObj
 = (
POS_COOKIE

pAd
->
OS_Cook
;

5392 if(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

5394 #ifde
CONFIG_APSTA_MIXED_SUPPORT


5395 i(
wrq
->
u
.
da
.
por
 =
NULL
)

5397  
Stus
;

5400 i(
	`rr
(
wrq
->
u
.
da
.
por
, "OpMode"=
NULL
)

5403 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

5404  -
ENETDOWN
;

5409 
pObj
->
iol_if_ty
 = 
INT_MAIN
;

5410 
pObj
->
iol_if
 = 
MAIN_MBSSID
;

5413 
cmd
)

5415 #ifde
RALINK_ATE


5416 #ifde
RALINK_QA


5417 
RTPRIV_IOCTL_ATE
:

5419 
	`RtmpDoA
(
pAd
, 
wrq
);

5424 
SIOCGIFHWADDR
:

5425 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IOCTL::SIOCGIFHWADDR\n"));

5426 
	`memy
(
wrq
->
u
.
me
, 
pAd
->
CutAddss
, 
ETH_ALEN
);

5428 
SIOCGIWNAME
:

5430 *
me
=&
wrq
->
u
.name[0];

5431 
	`_iol_giwme
(
t_dev
, 
NULL
, 
me
, NULL);

5434 
SIOCGIWESSID
:

5436 
iw_pot
 *
essid
=&
wrq
->
u
.essid;

5437 
	`_iol_giwessid
(
t_dev
, 
NULL
, 
essid
,ssid->
por
);

5440 
SIOCSIWESSID
:

5442 
iw_pot
 *
essid
=&
wrq
->
u
.essid;

5443 
	`_iol_siwessid
(
t_dev
, 
NULL
, 
essid
,ssid->
por
);

5446 
SIOCSIWNWID
:

5447 
SIOCGIWNWID
:

5448 
Stus
 = -
EOPNOTSUPP
;

5450 
SIOCSIWFREQ
:

5452 
iw_eq
 *
eq
=&
wrq
->
u
.freq;

5453 
	`_iol_siweq
(
t_dev
, 
NULL
, 
eq
, NULL);

5456 
SIOCGIWFREQ
:

5458 
iw_eq
 *
eq
=&
wrq
->
u
.freq;

5459 
	`_iol_giweq
(
t_dev
, 
NULL
, 
eq
, NULL);

5462 
SIOCSIWNICKN
:

5468 
SIOCGIWNICKN
:

5470 
iw_pot
 *
q
 = 
NULL
;

5471 
q
 = &
wrq
->
u
.
da
;

5472 
q
->
ngth
 = 
	`
((
PSTRING

pAd
->
nickme
);

5473 
Stus
 = 
	`cy_to_ur
(
q
->
por
, 
pAd
->
nickme
,rq->
ngth
);

5476 
SIOCGIWRATE
:

5477 
	`_iol_giw
(
t_dev
, 
NULL
, &
wrq
->
u
, NULL);

5479 
SIOCSIWRATE
:

5480 
	`_iol_siw
(
t_dev
, 
NULL
, &
wrq
->
u
, NULL);

5482 
SIOCGIWRTS
:

5484 
iw_m
 *
s
=&
wrq
->
u
.rts;

5485 
	`_iol_giws
(
t_dev
, 
NULL
, 
s
, NULL);

5488 
SIOCSIWRTS
:

5490 
iw_m
 *
s
=&
wrq
->
u
.rts;

5491 
	`_iol_siws
(
t_dev
, 
NULL
, 
s
, NULL);

5494 
SIOCGIWFRAG
:

5496 
iw_m
 *
ag
=&
wrq
->
u
.frag;

5497 
	`_iol_giwag
(
t_dev
, 
NULL
, 
ag
, NULL);

5500 
SIOCSIWFRAG
:

5502 
iw_m
 *
ag
=&
wrq
->
u
.frag;

5503 
	`_iol_siwag
(
t_dev
, 
NULL
, 
ag
, NULL);

5506 
SIOCGIWENCODE
:

5508 
iw_pot
 *
q
=&
wrq
->
u
.
codg
;

5509 if(
q
)

5510 
	`_iol_giwcode
(
t_dev
, 
NULL
, 
q
,rq->
por
);

5513 
SIOCSIWENCODE
:

5515 
iw_pot
 *
q
=&
wrq
->
u
.
codg
;

5516 if(
q
)

5517 
	`_iol_siwcode
(
t_dev
, 
NULL
, 
q
,rq->
por
);

5520 
SIOCGIWAP
:

5522 
sockaddr
 *
_addr
=&
wrq
->
u
.ap_addr;

5523 
	`_iol_giw
(
t_dev
, 
NULL
, 
_addr
,p_addr->
_da
);

5526 
SIOCSIWAP
:

5528 
sockaddr
 *
_addr
=&
wrq
->
u
.ap_addr;

5529 
	`_iol_siw
(
t_dev
, 
NULL
, 
_addr
,p_addr->
_da
);

5532 
SIOCGIWMODE
:

5534 
__u32
 *
mode
=&
wrq
->
u
.mode;

5535 
	`_iol_giwmode
(
t_dev
, 
NULL
, 
mode
, NULL);

5538 
SIOCSIWMODE
:

5540 
__u32
 *
mode
=&
wrq
->
u
.mode;

5541 
	`_iol_siwmode
(
t_dev
, 
NULL
, 
mode
, NULL);

5544 
SIOCGIWSENS
:

5545 
SIOCSIWSENS
:

5546 
SIOCGIWPOWER
:

5547 
SIOCSIWPOWER
:

5548 
SIOCGIWTXPOW
:

5549 
SIOCSIWTXPOW
:

5550 
SIOCGIWRANGE
:

5551 
SIOCGIWRETRY
:

5552 
SIOCSIWRETRY
:

5553 
Stus
 = -
EOPNOTSUPP
;

5556 
RT_PRIV_IOCTL
:

5557 
RT_PRIV_IOCTL_EXT
:

5558 
subcmd
 = 
wrq
->
u
.
da
.
ags
;

5559 if
subcmd
 & 
OID_GET_SET_TOGGLE
)

5560 
Stus
 = 
	`RTMPSInfmi
(
pAd
, 
rq
, 
subcmd
);

5562 
Stus
 = 
	`RTMPQuyInfmi
(
pAd
, 
rq
, 
subcmd
);

5564 
SIOCGIWPRIV
:

5565 i(
wrq
->
u
.
da
.
por
)

5567 i
	`acss_ok
(
VERIFY_WRITE
, 
wrq
->
u
.
da
.
por
, (
ivb
)!
TRUE
)

5569 i(((
ivb
/ rivb[0])<
wrq
->
u
.
da
.
ngth
)

5571 
wrq
->
u
.
da
.
ngth
 = (
ivb
) / (privtab[0]);

5572 i(
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
ivb
, (privtab)))

5573 
Stus
 = -
EFAULT
;

5576 
Stus
 = -
E2BIG
;

5579 
RTPRIV_IOCTL_SET
:

5580 if(
	`acss_ok
(
VERIFY_READ
, 
wrq
->
u
.
da
.
por
, wrq->u.da.
ngth
!
TRUE
)

5582 
	`_iol_am
(
t_dev
, 
NULL
, NULL, 
wrq
->
u
.
da
.
por
);

5584 
RTPRIV_IOCTL_GSITESURVEY
:

5585 
	`RTMPIolGSeSurvey
(
pAd
, 
wrq
);

5587 #ifde
DBG


5588 
RTPRIV_IOCTL_MAC
:

5589 
	`RTMPIolMAC
(
pAd
, 
wrq
);

5591 
RTPRIV_IOCTL_E2P
:

5592 
	`RTMPIolE2PROM
(
pAd
, 
wrq
);

5596 
SIOCETHTOOL
:

5599 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("IOCTL::unknowIOCTL'cmd = 0x%08x\n", 
cmd
));

5600 
Stus
 = -
EOPNOTSUPP
;

5604 if(
SMacheTouched
)

5605 
	`RTMP_MLME_HANDLER
(
pAd
);

5607  
Stus
;

5608 
	}
}

5610 #ifde
DBG


5628 
VOID
 
	$RTMPIolMAC
(

5629 
IN
 
PRTMP_ADAPTER
 
pAd
,

5630 
IN
 
iwq
 *
wrq
)

5632 
PSTRING
 
this_ch
;

5633 
PSTRING
 
vue
;

5634 
INT
 
j
 = 0, 
k
 = 0;

5635 
STRING
 
msg
[1024];

5636 
STRING
 
g
[255];

5637 
ULONG
 
macAddr
 = 0;

5638 
UCHAR
 
mp
[16];

5639 
STRING
 
mp2
[16];

5640 
UINT32
 
macVue
 = 0;

5641 
INT
 
Stus
;

5642 
BOOLEAN
 
bIsPrtAMAC
 = 
FALSE
;

5645 
	`memt
(
msg
, 0x00, 1024);

5646 
	`memt
(
g
, 0x00, 255);

5647 i(
wrq
->
u
.
da
.
ngth
 > 1)

5649 
Stus
 = 
	`cy_om_ur
(
g
, 
wrq
->
u
.
da
.
por
, (wrq->u.da.
ngth
 > 255) ? 255 : wrq->u.data.length);

5650 
	`rtf
(
msg
, "\n");

5653 
this_ch
 = 
g
;

5654 i(!*
this_ch
)

5655 
xt
;

5657 i((
vue
 = 
	`rchr
(
this_ch
, '=')!
NULL
)

5658 *
vue
++ = 0;

5660 i(!
vue
 || !*value)

5663 if(
	`
(
this_ch
) > 4)

5664 
xt
;

5666 
j
 = 
	`
(
this_ch
);

5667 
j
-- > 0)

5669 if(
this_ch
[
j
] > 'f' ||his_char[j] < '0')

5674 
k
 = 
j
 = 
	`
(
this_ch
);

5675 
j
-- > 0)

5677 
this_ch
[4-
k
+
j
] =his_char[j];

5680 
k
 < 4)

5681 
this_ch
[3-
k
++]='0';

5682 
this_ch
[4]='\0';

5684 if(
	`
(
this_ch
) == 4)

5686 
	`AtoH
(
this_ch
, 
mp
, 2);

5687 
macAddr
 = *
mp
*256 +emp[1];

5688 i(
macAddr
 < 0xFFFF)

5690 
	`RTMP_IO_READ32
(
pAd
, 
macAddr
, &
macVue
);

5691 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MacAddr=%lx, MacVue=%x\n", 
macAddr
, 
macVue
));

5692 
	`rtf
(
msg
+
	`
(msg), "[0x%08lX]:%08X ", 
macAddr
 , 
macVue
);

5696 
bIsPrtAMAC
 = 
TRUE
;

5697 
xt
;

5703 
	`memy
(&
mp2
, 
vue
, 
	`
(value));

5704 
mp2
[
	`
(
vue
)] = '\0';

5707 if((
	`
(
this_ch
> 4|| sn(
mp2
) > 8)

5708 
xt
;

5710 
j
 = 
	`
(
this_ch
);

5711 
j
-- > 0)

5713 if(
this_ch
[
j
] > 'f' ||his_char[j] < '0')

5717 
j
 = 
	`
(
mp2
);

5718 
j
-- > 0)

5720 if(
mp2
[
j
] > 'f' ||emp2[j] < '0')

5725 
k
 = 
j
 = 
	`
(
this_ch
);

5726 
j
-- > 0)

5728 
this_ch
[4-
k
+
j
] =his_char[j];

5731 
k
 < 4)

5732 
this_ch
[3-
k
++]='0';

5733 
this_ch
[4]='\0';

5736 
k
 = 
j
 = 
	`
(
mp2
);

5737 
j
-- > 0)

5739 
mp2
[8-
k
+
j
] =emp2[j];

5742 
k
 < 8)

5743 
mp2
[7-
k
++]='0';

5744 
mp2
[8]='\0';

5747 
	`AtoH
(
this_ch
, 
mp
, 2);

5748 
macAddr
 = *
mp
*256 +emp[1];

5750 
	`AtoH
(
mp2
, 
mp
, 4);

5751 
macVue
 = *
mp
*256*256*256 +emp[1]*256*256 +emp[2]*256 +emp[3];

5754 i(
macAddr
 =(
HW_DEBUG_SETTING_BASE
 + 4))

5757 i(
macVue
 & 0x000000ff)

5759 
pAd
->
BbpTung
.
bEb
 = 
TRUE
;

5760 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("turn on R17uning\n"));

5764 
UCHAR
 
R66
;

5765 
pAd
->
BbpTung
.
bEb
 = 
FALSE
;

5766 
R66
 = 0x26 + 
	`GET_LNA_GAIN
(
pAd
);

5767 #ifde
RALINK_ATE


5768 i(
	`ATE_ON
(
pAd
))

5770 
	`ATE_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, (0x26 + 
	`GET_LNA_GAIN
(pAd)));

5775 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R66
, (0x26 + 
	`GET_LNA_GAIN
(pAd)));

5777 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("tu ofR17ung,eܐt0x%02x\n", 
R66
));

5782 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MacAddr=%02lx, MacVue=0x%x\n", 
macAddr
, 
macVue
));

5784 
	`RTMP_IO_WRITE32
(
pAd
, 
macAddr
, 
macVue
);

5785 
	`rtf
(
msg
+
	`
(msg), "[0x%08lX]:%08X ", 
macAddr
, 
macVue
);

5790 
bIsPrtAMAC
 = 
TRUE
;

5791 
xt
:

5792 i(
bIsPrtAMAC
)

5794 
fe
 *
fe_w
;

5795 
PSTRING
 
feName
 = "MacDump.txt";

5796 
mm_gmt_t
 
ig_fs
;

5798 
ig_fs
 = 
	`g_fs
();

5799 
	`t_fs
(
KERNEL_DS
);

5802 
fe_w
 = 
	`fp_ݒ
(
feName
, 
O_WRONLY
|
O_CREAT
, 0);

5803 i(
	`IS_ERR
(
fe_w
))

5805 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("-->2%s: E %ld ong %s\n", 
__FUNCTION__
, -
	`PTR_ERR
(
fe_w
), 
feName
));

5809 i(
fe_w
->
f_
 && fe_w->f_->
wre
)

5811 
fe_w
->
f_pos
 = 0;

5812 
macAddr
 = 0x1000;

5814 
macAddr
 <= 0x1800)

5816 
	`RTMP_IO_READ32
(
pAd
, 
macAddr
, &
macVue
);

5817 
	`rtf
(
msg
, "%08lx = %08X\n", 
macAddr
, 
macVue
);

5820 
fe_w
->
f_
->
	`wre
(fe_w, 
msg
, 
	`
(msg), &fe_w->
f_pos
);

5822 
	`tk
("%s", 
msg
);

5823 
macAddr
 += 4;

5825 
	`rtf
(
msg
, "\nDumMAC vuet%s\n", 
feName
);

5827 
	`fp_o
(
fe_w
, 
NULL
);

5829 
	`t_fs
(
ig_fs
);

5831 if(
	`
(
msg
) == 1)

5832 
	`rtf
(
msg
+
	`
(msg), "===>Error command format!");

5835 
wrq
->
u
.
da
.
ngth
 = 
	`
(
msg
);

5836 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
msg
, wrq->u.da.
ngth
);

5838 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<==RTMPIoctlMAC\n\n"));

5839 
	}
}

5858 
VOID
 
	$RTMPIolE2PROM
(

5859 
IN
 
PRTMP_ADAPTER
 
pAd
,

5860 
IN
 
iwq
 *
wrq
)

5862 
PSTRING
 
this_ch
;

5863 
PSTRING
 
vue
;

5864 
INT
 
j
 = 0, 
k
 = 0;

5865 
STRING
 
msg
[1024];

5866 
STRING
 
g
[255];

5867 
USHORT
 
pAddr
 = 0;

5868 
UCHAR
 
mp
[16];

5869 
STRING
 
mp2
[16];

5870 
USHORT
 
pVue
;

5871 
Stus
;

5872 
BOOLEAN
 
bIsPrtAE2P
 = 
FALSE
;

5875 
	`memt
(
msg
, 0x00, 1024);

5876 
	`memt
(
g
, 0x00, 255);

5877 i(
wrq
->
u
.
da
.
ngth
 > 1)

5879 
Stus
 = 
	`cy_om_ur
(
g
, 
wrq
->
u
.
da
.
por
, (wrq->u.da.
ngth
 > 255) ? 255 : wrq->u.data.length);

5880 
	`rtf
(
msg
, "\n");

5883 
this_ch
 = 
g
;

5886 i(!*
this_ch
)

5887 
xt
;

5889 i((
vue
 = 
	`rchr
(
this_ch
, '=')!
NULL
)

5890 *
vue
++ = 0;

5892 i(!
vue
 || !*value)

5896 if(
	`
(
this_ch
) > 4)

5897 
xt
;

5899 
j
 = 
	`
(
this_ch
);

5900 
j
-- > 0)

5902 if(
this_ch
[
j
] > 'f' ||his_char[j] < '0')

5907 
k
 = 
j
 = 
	`
(
this_ch
);

5908 
j
-- > 0)

5910 
this_ch
[4-
k
+
j
] =his_char[j];

5913 
k
 < 4)

5914 
this_ch
[3-
k
++]='0';

5915 
this_ch
[4]='\0';

5917 if(
	`
(
this_ch
) == 4)

5919 
	`AtoH
(
this_ch
, 
mp
, 2);

5920 
pAddr
 = *
mp
*256 +emp[1];

5921 i(
pAddr
 < 0xFFFF)

5923 
	`RT28xx_EEPROM_READ16
(
pAd
, 
pAddr
, 
pVue
);

5924 
	`rtf
(
msg
+
	`
(msg), "[0x%04X]:0x%04X ", 
pAddr
 , 
pVue
);

5928 
bIsPrtAE2P
 = 
TRUE
;

5929 
xt
;

5935 
	`memy
(&
mp2
, 
vue
, 
	`
(value));

5936 
mp2
[
	`
(
vue
)] = '\0';

5939 if((
	`
(
this_ch
> 4|| sn(
mp2
) > 8)

5940 
xt
;

5942 
j
 = 
	`
(
this_ch
);

5943 
j
-- > 0)

5945 if(
this_ch
[
j
] > 'f' ||his_char[j] < '0')

5948 
j
 = 
	`
(
mp2
);

5949 
j
-- > 0)

5951 if(
mp2
[
j
] > 'f' ||emp2[j] < '0')

5956 
k
 = 
j
 = 
	`
(
this_ch
);

5957 
j
-- > 0)

5959 
this_ch
[4-
k
+
j
] =his_char[j];

5962 
k
 < 4)

5963 
this_ch
[3-
k
++]='0';

5964 
this_ch
[4]='\0';

5967 
k
 = 
j
 = 
	`
(
mp2
);

5968 
j
-- > 0)

5970 
mp2
[4-
k
+
j
] =emp2[j];

5973 
k
 < 4)

5974 
mp2
[3-
k
++]='0';

5975 
mp2
[4]='\0';

5977 
	`AtoH
(
this_ch
, 
mp
, 2);

5978 
pAddr
 = *
mp
*256 +emp[1];

5980 
	`AtoH
(
mp2
, 
mp
, 2);

5981 
pVue
 = *
mp
*256 +emp[1];

5983 
	`RT28xx_EEPROM_WRITE16
(
pAd
, 
pAddr
, 
pVue
);

5984 
	`rtf
(
msg
+
	`
(msg), "[0x%02X]:%02X ", 
pAddr
, 
pVue
);

5988 
bIsPrtAE2P
 = 
TRUE
;

5989 
xt
:

5990 i(
bIsPrtAE2P
)

5992 
fe
 *
fe_w
;

5993 
PSTRING
 
feName
 = "EEPROMDump.txt";

5994 
mm_gmt_t
 
ig_fs
;

5996 
ig_fs
 = 
	`g_fs
();

5997 
	`t_fs
(
KERNEL_DS
);

6000 
fe_w
 = 
	`fp_ݒ
(
feName
, 
O_WRONLY
|
O_CREAT
, 0);

6001 i(
	`IS_ERR
(
fe_w
))

6003 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("-->2%s: E %ld ong %s\n", 
__FUNCTION__
, -
	`PTR_ERR
(
fe_w
), 
feName
));

6007 i(
fe_w
->
f_
 && fe_w->f_->
wre
)

6009 
fe_w
->
f_pos
 = 0;

6010 
pAddr
 = 0x00;

6012 
pAddr
 <= 0xFE)

6014 
	`RT28xx_EEPROM_READ16
(
pAd
, 
pAddr
, 
pVue
);

6015 
	`rtf
(
msg
, "%08x = %04x\n", 
pAddr
 , 
pVue
);

6018 
fe_w
->
f_
->
	`wre
(fe_w, 
msg
, 
	`
(msg), &fe_w->
f_pos
);

6020 
	`tk
("%s", 
msg
);

6021 
pAddr
 += 2;

6023 
	`rtf
(
msg
, "\nDumEEPROM vuet%s\n", 
feName
);

6025 
	`fp_o
(
fe_w
, 
NULL
);

6027 
	`t_fs
(
ig_fs
);

6029 if(
	`
(
msg
) == 1)

6030 
	`rtf
(
msg
+
	`
(msg), "===>Error command format!");

6034 
wrq
->
u
.
da
.
ngth
 = 
	`
(
msg
);

6035 
Stus
 = 
	`cy_to_ur
(
wrq
->
u
.
da
.
por
, 
msg
, wrq->u.da.
ngth
);

6037 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<==RTMPIoctlE2PROM\n"));

6038 
	}
}

	@os/linux/vr_bdlt.c

42 
	#MODULE_BDLT


	)

44 
	~"_cfig.h
"

47 #ifde
PLATFORM_BL2348


50 (*
pToULayPktSt
)(
sk_buff
 *
pSkb

tif_rx
 ;

70 
VOID
 
	$a_u_y_ck_dei
(
VOID
 *
pXiDei
)

72 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ralink broadight>eplace_upper_layer_packet_destination\n"));

73 
pToULayPktSt
 = 
pXiDei
 ;

74 
	}
}

77 
EXPORT_SYMBOL
(
a_u_y_ck_dei
);

	@os/linux/vr_ikans.c

42 
	#MODULE_IKANOS


	)

44 
	~"_cfig.h
"

45 
	~<lux/cfig.h
>

46 
	~<lux/vsi.h
>

47 
	~<lux/modu.h
>

48 
	~<lux/skbuff.h
>

49 
	~<lux/tdevi.h
>

50 
	~<Íro/ehdr.h
>

53 #ifde
IKANOS_VX_1X0


55 
	#IKANOS_PERAP_ID
 7

	)

56 
	#K0_TO_K1
(
x
(()(x)|0xA0000000

	)

60 
INT
 
28xx_nd_cks
(

61 
IN
 
sk_buff
 *
skb_p
,

62 
IN
 
t_devi
 *
t_dev
);

64 
INT32
 
IKANOS_WnDaFmesTx
(

65 
IN
 *
_pAdBuf
,

66 
IN
 
t_devi
 *
pNDev
);

68 
IKANOS_WnPktFromAp
(

69 
IN
 
PHd_t
 *
pFme
);

71 
INT32
 
GScInfoIdxFromBssid
(

72 
IN
 
PRTMP_ADAPTER
 
pAd
,

73 
IN
 
INT32
 
FromWhichBSSID
);

95 
	$VR_IKANOS_FP_In
(

96 
IN
 
UINT8
 
BssNum
,

97 
IN
 
UINT8
 *
pApMac
)

99 
UINT32
 
i
;

100 
UINT8
 
mac
[6];

103 
	`memy
(
mac
, 
pApMac
, 6);

106 
i
=0; i<
BssNum
; i++)

108 
	`MacAddrCfig
(7, 
mac
, 0xAD);

109 
mac
[5] ++;

111 
	}
}

129 
INT32
 
	$IKANOS_DaFmesTx
(

130 
IN
 
sk_buff
 *
pSkb
,

131 
IN
 
t_devi
 *
pNDev
)

133 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER)
pNDev
->
iv
;

134 
IkosWnTxCbFuncP
 *

 = &
IKANOS_WnDaFmesTx
;

136 
pSkb
->
FlowDa
.
txDev
 = 
pNDev
;

137 
pSkb
->
FlowDa
.
txApId
 = 
IKANOS_PERAP_ID
;

138 
pAd
->
IkosTxInfo
.
tdev
 = 
pNDev
;

139 
pAd
->
IkosTxInfo
.

 = fp;

140 
pSkb
->
FlowDa
.
txHd
 = &(
pAd
->
IkosTxInfo
);

141 
	`2FlowPross
(
pSkb
, 
pNDev
);

143 #ifde
IKANOS_DEBUG


144 
	`tk
("ikanos>xo fp\n");

147  
	`28xx_nd_cks
(
pSkb
, 
pNDev
);

148 
	}
}

171 
PRTMP_ADAPTER
 
	gpIkosAd
;

173 
	$IKANOS_DaFmeRx
(

174 
IN
 
PRTMP_ADAPTER
 
pAd
,

175 
IN
 *
pRxPam
,

176 
IN
 
sk_buff
 *
pSkb
,

177 
IN
 
UINT32
 
Lgth
)

179 
PHd_t
 *
Buf
;

182 
Buf
 = (
PHd_t
 *)(
	`eMbuf2Apbuf
(
pSkb
, 0));

184 
Buf
->
ags1
 = 1 << 
AP_FLAG1_IS_ETH_BIT
;

185 
Buf
->
ecInfoEmt
 = 
	`RTMP_GET_PACKET_NET_DEVICE_MBSSID
(
pSkb
);

186 
pIkosAd
 = 
pAd
;

190 
Buf
->
ags2
 = 0;

192 
	`Cssify
(
IKANOS_PERAP_ID
, 
Buf
, (*)
IKANOS_WnPktFromAp
);

193 
	`dev_k_skb
(
pSkb
);

194 
	}
}

216 
INT32
 
	$IKANOS_WnDaFmesTx
(

217 
IN
 *
_pAdBuf
,

218 
IN
 
t_devi
 *
pNDev
)

220 
PHd_t
 *
pApBuf
 = (PHd_*)
_pAdBuf
;

221 
sk_buff
 *
sk
 = 
NULL
;

223 
sk
 = (
sk_buff
 *)
	`eApbuf2Mbuf
(
pApBuf
);

224 i(
sk
 =
NULL
)

226 
	`tk
("ikanos>ranslateApbuf2Mbufeturned NULL!\n");

230 
sk
->
FlowDa
.
ags2
 = 0;

231 
sk
->
FlowDa
.
wnFgs
 = 0;

232 
sk
->
oc
 = 
ETH_P_IP
;

233 
sk
->
dev
 = 
pNDev
;

234 
sk
->
iܙy
 = 0;

236  
	`28xx_nd_cks
(
sk
, 
pNDev
);

237 
	}
}

240 
INT32
 
	$GScInfoIdxFromBssid
(

241 
IN
 
PRTMP_ADAPTER
 
pAd
,

242 
IN
 
INT32
 
FromWhichBSSID
)

244 
INT32
 
IfIdx
 = 
MAIN_MBSSID
;

247 #ifde
CONFIG_STA_SUPPORT


248 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

250 
IfIdx
 = 
MAIN_MBSSID
;

254  
IfIdx
;

255 
	}
}

272 
INT32
 
	$GScInfoIdxFromBssid
(

273 
IN
 
PRTMP_ADAPTER
 
pAd
,

274 
IN
 
INT32
 
FromWhichBSSID
)

276 
INT32
 
IfIdx
 = 
MAIN_MBSSID
;

279 #ifde
CONFIG_STA_SUPPORT


280 
	`IF_DEV_CONFIG_OPMODE_ON_STA
(
pAd
)

282 
IfIdx
 = 
MAIN_MBSSID
;

286  
IfIdx
;

287 
	}
}

305 
	$IKANOS_WnPktFromAp
(

306 
IN
 
PHd_t
 *
pFme
)

308 
PRTMP_ADAPTER
 
pAd
;

309 
t_devi
 *
dev
 = 
NULL
;

310 
sk_buff
 *
skb
;

311 
INT32
 
dex
;

312 
PHd_t
 *
Buf
 = 
	`K0_TO_K1
(
pFme
);

315 
pAd
 = 
pIkosAd
;

318 
dex
 = 
	`GScInfoIdxFromBssid
(
pAd
, 
Buf
->
ecInfoEmt
);

319 
dev
 = 
	`g_tdev_om_bssid
(
pAd
, 
Buf
->
ecInfoEmt
);

320 i(
dev
 =
NULL
)

322 
	`tk
("ikos> %s: ERRORu devi ***************\n", 
__FUNCTION__
);

326 
skb
 = (
sk_buff
 *)
	`eApbuf2Mbuf
(
Buf
);

327 i(
NULL
 =
skb
)

329 
	`tk
("ikos> %s: skb inu *********************\n", 
__FUNCTION__
);

333 
pAd
->
IkosRxInfo
[
dex
].
tdev
 = 
dev
;

334 
pAd
->
IkosRxInfo
[
dex
].

 = &
IKANOS_WnDaFmesTx
;

336 
skb
->
dev
 = dev;

337 
skb
->
FlowDa
.
rxApId
 = 
IKANOS_PERAP_ID
;

339 
skb
->
FlowDa
.
rxHd
 = &(
pAd
->
IkosRxInfo
[
dex
]);

340 
skb
->
oc
 = 
	`h_ty_s
(skb, skb->
dev
);

342 #ifde
IKANOS_DEBUG


343 
	`tk
("ikanos>xo fp!\n");

346 
	`tif_rx
(
skb
);

348 
	}
}

	@sta/assoc.c

37 
	~"_cfig.h
"

39 
UCHAR
 
	gChWTeme
[] = {

51 
UCHAR
 
	gChW2Teme
[] = {

74 
VOID
 
	$AssocSMacheIn
(

75 
IN
 
PRTMP_ADAPTER
 
pAd
,

76 
IN
 
STATE_MACHINE
 *
S
,

77 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[])

79 
	`SMacheIn
(
S
, 
Tns
, 
MAX_ASSOC_STATE
, 
MAX_ASSOC_MSG
, (
STATE_MACHINE_FUNC
)
Dr
, 
ASSOC_IDLE
, 
ASSOC_MACHINE_BASE
);

82 
	`SMacheSAi
(
S
, 
ASSOC_IDLE
, 
MT2_MLME_ASSOC_REQ
, (
STATE_MACHINE_FUNC
)
MlmeAssocReqAi
);

83 
	`SMacheSAi
(
S
, 
ASSOC_IDLE
, 
MT2_MLME_REASSOC_REQ
, (
STATE_MACHINE_FUNC
)
MlmeRssocReqAi
);

84 
	`SMacheSAi
(
S
, 
ASSOC_IDLE
, 
MT2_MLME_DISASSOC_REQ
, (
STATE_MACHINE_FUNC
)
MlmeDissocReqAi
);

85 
	`SMacheSAi
(
S
, 
ASSOC_IDLE
, 
MT2_PEER_DISASSOC_REQ
, (
STATE_MACHINE_FUNC
)
PrDissocAi
);

88 
	`SMacheSAi
(
S
, 
ASSOC_WAIT_RSP
, 
MT2_MLME_ASSOC_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhAssoc
);

89 
	`SMacheSAi
(
S
, 
ASSOC_WAIT_RSP
, 
MT2_MLME_REASSOC_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhRssoc
);

90 
	`SMacheSAi
(
S
, 
ASSOC_WAIT_RSP
, 
MT2_MLME_DISASSOC_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhDissoc
);

91 
	`SMacheSAi
(
S
, 
ASSOC_WAIT_RSP
, 
MT2_PEER_DISASSOC_REQ
, (
STATE_MACHINE_FUNC
)
PrDissocAi
);

92 
	`SMacheSAi
(
S
, 
ASSOC_WAIT_RSP
, 
MT2_PEER_ASSOC_RSP
, (
STATE_MACHINE_FUNC
)
PrAssocRAi
);

97 
	`SMacheSAi
(
S
, 
ASSOC_WAIT_RSP
, 
MT2_PEER_REASSOC_RSP
, (
STATE_MACHINE_FUNC
)
PrAssocRAi
);

98 
	`SMacheSAi
(
S
, 
ASSOC_WAIT_RSP
, 
MT2_ASSOC_TIMEOUT
, (
STATE_MACHINE_FUNC
)
AssocTimeoutAi
);

101 
	`SMacheSAi
(
S
, 
REASSOC_WAIT_RSP
, 
MT2_MLME_ASSOC_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhAssoc
);

102 
	`SMacheSAi
(
S
, 
REASSOC_WAIT_RSP
, 
MT2_MLME_REASSOC_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhRssoc
);

103 
	`SMacheSAi
(
S
, 
REASSOC_WAIT_RSP
, 
MT2_MLME_DISASSOC_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhDissoc
);

104 
	`SMacheSAi
(
S
, 
REASSOC_WAIT_RSP
, 
MT2_PEER_DISASSOC_REQ
, (
STATE_MACHINE_FUNC
)
PrDissocAi
);

105 
	`SMacheSAi
(
S
, 
REASSOC_WAIT_RSP
, 
MT2_PEER_REASSOC_RSP
, (
STATE_MACHINE_FUNC
)
PrRssocRAi
);

109 
	`SMacheSAi
(
S
, 
REASSOC_WAIT_RSP
, 
MT2_PEER_ASSOC_RSP
, (
STATE_MACHINE_FUNC
)
PrRssocRAi
);

110 
	`SMacheSAi
(
S
, 
REASSOC_WAIT_RSP
, 
MT2_REASSOC_TIMEOUT
, (
STATE_MACHINE_FUNC
)
RssocTimeoutAi
);

113 
	`SMacheSAi
(
S
, 
DISASSOC_WAIT_RSP
, 
MT2_MLME_ASSOC_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhAssoc
);

114 
	`SMacheSAi
(
S
, 
DISASSOC_WAIT_RSP
, 
MT2_MLME_REASSOC_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhRssoc
);

115 
	`SMacheSAi
(
S
, 
DISASSOC_WAIT_RSP
, 
MT2_MLME_DISASSOC_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhDissoc
);

116 
	`SMacheSAi
(
S
, 
DISASSOC_WAIT_RSP
, 
MT2_PEER_DISASSOC_REQ
, (
STATE_MACHINE_FUNC
)
PrDissocAi
);

117 
	`SMacheSAi
(
S
, 
DISASSOC_WAIT_RSP
, 
MT2_DISASSOC_TIMEOUT
, (
STATE_MACHINE_FUNC
)
DissocTimeoutAi
);

120 
	`RTMPInTim
(
pAd
, &pAd->
MlmeAux
.
AssocTim
, 
	`GET_TIMER_FUNCTION
(
AssocTimeout
),Ad, 
FALSE
);

121 
	`RTMPInTim
(
pAd
, &pAd->
MlmeAux
.
RssocTim
, 
	`GET_TIMER_FUNCTION
(
RssocTimeout
),Ad, 
FALSE
);

122 
	`RTMPInTim
(
pAd
, &pAd->
MlmeAux
.
DissocTim
, 
	`GET_TIMER_FUNCTION
(
DissocTimeout
),Ad, 
FALSE
);

123 
	}
}

137 
VOID
 
	$AssocTimeout
(
IN
 
PVOID
 
SyemScific1
,

138 
IN
 
PVOID
 
FuniCڋxt
,

139 
IN
 
PVOID
 
SyemScific2
,

140 
IN
 
PVOID
 
SyemScific3
)

142 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

146 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

149 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_ASSOC_TIMEOUT
, 0, 
NULL
, 0);

150 
	`RTMP_MLME_HANDLER
(
pAd
);

151 
	}
}

165 
VOID
 
	$RssocTimeout
(
IN
 
PVOID
 
SyemScific1
,

166 
IN
 
PVOID
 
FuniCڋxt
,

167 
IN
 
PVOID
 
SyemScific2
,

168 
IN
 
PVOID
 
SyemScific3
)

170 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

174 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

177 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_REASSOC_TIMEOUT
, 0, 
NULL
, 0);

178 
	`RTMP_MLME_HANDLER
(
pAd
);

179 
	}
}

193 
VOID
 
	$DissocTimeout
(
IN
 
PVOID
 
SyemScific1
,

194 
IN
 
PVOID
 
FuniCڋxt
,

195 
IN
 
PVOID
 
SyemScific2
,

196 
IN
 
PVOID
 
SyemScific3
)

198 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

202 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

205 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_DISASSOC_TIMEOUT
, 0, 
NULL
, 0);

206 
	`RTMP_MLME_HANDLER
(
pAd
);

207 
	}
}

231 
VOID
 
	$MlmeAssocReqAi
(

232 
IN
 
PRTMP_ADAPTER
 
pAd
,

233 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

235 
UCHAR
 
ApAddr
[6];

236 
HEADER_802_11
 
AssocHdr
;

237 
UCHAR
 
WmeIe
[9] = {
IE_VENDOR_SPECIFIC
, 0x07, 0x00, 0x50, 0xf2, 0x02, 0x00, 0x01, 0x00};

238 
USHORT
 
LiIv
;

239 
ULONG
 
Timeout
;

240 
USHORT
 
CabyInfo
;

241 
BOOLEAN
 
TimCed
;

242 
PUCHAR
 
pOutBufr
 = 
NULL
;

243 
NDIS_STATUS
 
NStus
;

244 
ULONG
 
FmeL
 = 0;

245 
ULONG
 
tmp
;

246 
USHORT
 
VIesOfft
 = 0;

247 
USHORT
 
Stus
;

250 i(
pAd
->
SCfg
.
bBlockAssoc
 =
TRUE
)

252 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - Block Assocequest durning WPA blockeriod!\n"));

253 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

254 
Stus
 = 
MLME_STATE_MACHINE_REJECT
;

255 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_ASSOC_CONF
, 2, &
Stus
, 0);

258 i(
	`MlmeAssocReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
ApAddr
, &
CabyInfo
, &
Timeout
, &
LiIv
))

260 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
AssocTim
, &
TimCed
);

261 
	`COPY_MAC_ADDR
(
pAd
->
MlmeAux
.
Bssid
, 
ApAddr
);

264 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

265 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

267 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ASSOC - MlmeAssocReqAction()llocate memory failed \n"));

268 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

269 
Stus
 = 
MLME_FAIL_NO_RESOURCE
;

270 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_ASSOC_CONF
, 2, &
Stus
, 0);

275 
pAd
->
SCfg
.
AssocInfo
.
Lgth
 = (
NDIS_802_11_ASSOCIATION_INFORMATION
);

277 
pAd
->
SCfg
.
AssocInfo
.
AvaabRequeFixedIEs
 =

278 
NDIS_802_11_AI_REQFI_CAPABILITIES
 | 
NDIS_802_11_AI_REQFI_LISTENINTERVAL
;

279 
pAd
->
SCfg
.
AssocInfo
.
RequeFixedIEs
.
Cabs
 = 
CabyInfo
;

280 
pAd
->
SCfg
.
AssocInfo
.
RequeFixedIEs
.
LiIv
 = 
LiIv
;

283 
pAd
->
SCfg
.
AssocInfo
.
OfftRequeIEs
 = (
NDIS_802_11_ASSOCIATION_INFORMATION
);

285 
	`NdisZoMemy
(
pAd
->
SCfg
.
ReqVIEs
, 
MAX_VIE_LEN
);

287 
VIesOfft
 = 0;

288 
	`NdisMoveMemy
(
pAd
->
SCfg
.
ReqVIEs
 + 
VIesOfft
, &
SsidIe
, 1);

289 
VIesOfft
 += 1;

290 
	`NdisMoveMemy
(
pAd
->
SCfg
.
ReqVIEs
 + 
VIesOfft
, &pAd->
MlmeAux
.
SsidL
, 1);

291 
VIesOfft
 += 1;

292 
	`NdisMoveMemy
(
pAd
->
SCfg
.
ReqVIEs
 + 
VIesOfft
,Ad->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
);

293 
VIesOfft
 +
pAd
->
MlmeAux
.
SsidL
;

296 
	`NdisMoveMemy
(
pAd
->
SCfg
.
ReqVIEs
 + 
VIesOfft
, &
SupReIe
, 1);

297 
VIesOfft
 += 1;

298 
	`NdisMoveMemy
(
pAd
->
SCfg
.
ReqVIEs
 + 
VIesOfft
, &pAd->
MlmeAux
.
SupReL
, 1);

299 
VIesOfft
 += 1;

300 
	`NdisMoveMemy
(
pAd
->
SCfg
.
ReqVIEs
 + 
VIesOfft
,Ad->
MlmeAux
.
SupRe
,Ad->MlmeAux.
SupReL
);

301 
VIesOfft
 +
pAd
->
MlmeAux
.
SupReL
;

304 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - Send ASSOCequest...\n"));

305 
	`MgtMacHdIn
(
pAd
, &
AssocHdr
, 
SUBTYPE_ASSOC_REQ
, 0, 
ApAddr
, ApAddr);

308 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

309 (
HEADER_802_11
), &
AssocHdr
,

310 2, &
CabyInfo
,

311 2, &
LiIv
,

312 1, &
SsidIe
,

313 1, &
pAd
->
MlmeAux
.
SsidL
,

314 
pAd
->
MlmeAux
.
SsidL
,Ad->MlmeAux.
Ssid
,

315 1, &
SupReIe
,

316 1, &
pAd
->
MlmeAux
.
SupReL
,

317 
pAd
->
MlmeAux
.
SupReL
,Ad->MlmeAux.
SupRe
,

318 
END_OF_ARGS
);

320 i(
pAd
->
MlmeAux
.
ExtReL
 != 0)

322 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

323 1, &
ExtReIe
,

324 1, &
pAd
->
MlmeAux
.
ExtReL
,

325 
pAd
->
MlmeAux
.
ExtReL
,Ad->MlmeAux.
ExtRe
,

326 
END_OF_ARGS
);

327 
FmeL
 +
tmp
;

331 #ifde
DOT11_N_SUPPORT


333 i((
pAd
->
MlmeAux
.
HtCabyL
 > 0&& (pAd->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
))

335 
ULONG
 
TmpL
;

336 
UCHAR
 
HtL
;

337 
UCHAR
 
BROADCOM
[4] = {0x0, 0x90, 0x4c, 0x33};

338 
PHT_CAPABILITY_IE
 
pHtCaby
;

339 #ifde
RT_BIG_ENDIAN


340 
HT_CAPABILITY_IE
 
HtCabyTmp
;

341 
	`NdisZoMemy
(&
HtCabyTmp
, (
HT_CAPABILITY_IE
));

342 
	`NdisMoveMemy
(&
HtCabyTmp
, &
pAd
->
MlmeAux
.
HtCaby
,Ad->MlmeAux.
HtCabyL
);

343 *(
USHORT
 *)(&
HtCabyTmp
.
HtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.HtCapInfo));

344 *(
USHORT
 *)(&
HtCabyTmp
.
ExtHtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.ExtHtCapInfo));

345 
pHtCaby
 = &
HtCabyTmp
;

347 
pHtCaby
 = &
pAd
->
MlmeAux
.
HtCaby
;

350 i(
pAd
->
SAive
.
Su܋dPhyInfo
.
bPNHt
 =
TRUE
)

352 
HtL
 = 
SIZE_HT_CAP_IE
 + 4;

353 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
TmpL
,

354 1, &
WIe
,

355 1, &
HtL
,

356 4, &
BROADCOM
[0],

357 
pAd
->
MlmeAux
.
HtCabyL
, 
pHtCaby
,

358 
END_OF_ARGS
);

362 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
TmpL
,

363 1, &
HtCIe
,

364 1, &
pAd
->
MlmeAux
.
HtCabyL
,

365 
pAd
->
MlmeAux
.
HtCabyL
, 
pHtCaby
,

366 
END_OF_ARGS
);

368 
FmeL
 +
TmpL
;

372 #i
	`defed
(
DOT11N_DRAFT3
|| defed(
DOT11V_WNM_SUPPORT
)

374 
ULONG
 
TmpL
;

375 
EXT_CAP_INFO_ELEMENT
 
extCInfo
;

376 
UCHAR
 
extInfoL
;

379 
extInfoL
 = (
EXT_CAP_INFO_ELEMENT
);

380 
	`NdisZoMemy
(&
extCInfo
, 
extInfoL
);

382 #ifde
DOT11N_DRAFT3


383 i((
pAd
->
CommCfg
.
bBssCxEb
 =
TRUE
) &&

384 (
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
&& (pAd->CommCfg.
Chl
 <= 14)

387 
extCInfo
.
BssCxiMgmtSut
 = 1;

392 
	`MakeOutgogFme
(
pOutBufr
+
FmeL
, &
TmpL
,

393 1, &
ExtCIe
,

394 1, &
extInfoL
,

395 
extInfoL
, &
extCInfo
,

396 
END_OF_ARGS
);

397 
FmeL
 +
TmpL
;

409 i(
pAd
->
CommCfg
.
bAgggiCab
)

411 i((
pAd
->
CommCfg
.
bPiggyBackCab
&& (Ad->
MlmeAux
.
APRkIe
 & 0x00000003) == 3))

413 
ULONG
 
TmpL
;

414 
UCHAR
 
RkIe
[9] = {
IE_VENDOR_SPECIFIC
, 7, 0x00, 0x0c, 0x43, 0x03, 0x00, 0x00, 0x00};

415 
	`MakeOutgogFme
(
pOutBufr
+
FmeL
, &
TmpL
,

416 9, 
RkIe
,

417 
END_OF_ARGS
);

418 
FmeL
 +
TmpL
;

420 i(
pAd
->
MlmeAux
.
APRkIe
 & 0x00000001)

422 
ULONG
 
TmpL
;

423 
UCHAR
 
RkIe
[9] = {
IE_VENDOR_SPECIFIC
, 7, 0x00, 0x0c, 0x43, 0x01, 0x00, 0x00, 0x00};

424 
	`MakeOutgogFme
(
pOutBufr
+
FmeL
, &
TmpL
,

425 9, 
RkIe
,

426 
END_OF_ARGS
);

427 
FmeL
 +
TmpL
;

432 
ULONG
 
TmpL
;

433 
UCHAR
 
RkIe
[9] = {
IE_VENDOR_SPECIFIC
, 7, 0x00, 0x0c, 0x43, 0x06, 0x00, 0x00, 0x00};

434 
	`MakeOutgogFme
(
pOutBufr
+
FmeL
, &
TmpL
,

435 9, 
RkIe
,

436 
END_OF_ARGS
);

437 
FmeL
 +
TmpL
;

440 i(
pAd
->
MlmeAux
.
APEdPm
.
bVid
)

442 i(
pAd
->
CommCfg
.
bAPSDCab
 &&Ad->
MlmeAux
.
APEdPm
.bAPSDCapable)

444 
QBSS_STA_INFO_PARM
 
QosInfo
;

446 
	`NdisZoMemy
(&
QosInfo
, (
QBSS_STA_INFO_PARM
));

447 
QosInfo
.
UAPSD_AC_BE
 = 
pAd
->
CommCfg
.
bAPSDAC_BE
;

448 
QosInfo
.
UAPSD_AC_BK
 = 
pAd
->
CommCfg
.
bAPSDAC_BK
;

449 
QosInfo
.
UAPSD_AC_VI
 = 
pAd
->
CommCfg
.
bAPSDAC_VI
;

450 
QosInfo
.
UAPSD_AC_VO
 = 
pAd
->
CommCfg
.
bAPSDAC_VO
;

451 
QosInfo
.
MaxSPLgth
 = 
pAd
->
CommCfg
.MaxSPLength;

452 
WmeIe
[8] |*(
PUCHAR
)&
QosInfo
;

460 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

461 9, &
WmeIe
[0],

462 
END_OF_ARGS
);

463 
FmeL
 +
tmp
;

472 i(((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

473 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
) ||

474 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
) ||

475 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
)

479 
UCHAR
 
RSNIe
 = 
IE_WPA
;

481 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
) ||

482 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
))

484 
RSNIe
 = 
IE_WPA2
;

487 #ifde
WPA_SUPPLICANT_SUPPORT


488 i(
pAd
->
SCfg
.
bRSN_IE_FromWSuli
 =
FALSE
)

490 
	`RTMPMakeRSNIE
(
pAd
,Ad->
SCfg
.
AuthMode
,Ad->SCfg.
WStus
, 
BSS0
);

493 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
)

495 
INT
 
idx
;

496 
BOOLEAN
 
FoundPMK
 = 
FALSE
;

498 
idx
 = 0; idx < 
PMKID_NO
; idx++)

500 i(
	`NdisEquMemy
(
ApAddr
, &
pAd
->
SCfg
.
SavedPMK
[
idx
].
BSSID
, 6))

502 
FoundPMK
 = 
TRUE
;

507 #ifde
WPA_SUPPLICANT_SUPPORT


513 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
) &&

514 (
	`NdisEquMemy
(
pAd
->
MlmeAux
.
Bssid
,Ad->
CommCfg
.
LaBssid
, 
MAC_ADDR_LEN
)))

516 
FoundPMK
 = 
FALSE
;

520 i(
FoundPMK
)

523 *(
PUSHORT
&
pAd
->
SCfg
.
RSN_IE
[pAd->SCfg.
RSNIE_L
] = 1;

524 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
RSN_IE
[pAd->SCfg.
RSNIE_L
 + 2], &pAd->SCfg.
SavedPMK
[
idx
].
PMKID
, 16);

525 
pAd
->
SCfg
.
RSNIE_L
 += 18;

529 #ifde
WPA_SUPPLICANT_SUPPORT


530 #ifde
SIOCSIWGENIE


531 i((
pAd
->
SCfg
.
WSuliUP
 & 
WPA_SUPPLICANT_ENABLE
) &&

532 (
pAd
->
SCfg
.
bRSN_IE_FromWSuli
 =
TRUE
))

540 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

541 1, &
RSNIe
,

542 1, &
pAd
->
SCfg
.
RSNIE_L
,

543 
pAd
->
SCfg
.
RSNIE_L
,Ad->SCfg.
RSN_IE
,

544 
END_OF_ARGS
);

545 
FmeL
 +
tmp
;

548 #ifde
WPA_SUPPLICANT_SUPPORT


549 #ifde
SIOCSIWGENIE


550 i(((
pAd
->
SCfg
.
WSuliUP
 & 0x7F!
WPA_SUPPLICANT_ENABLE
) ||

551 (
pAd
->
SCfg
.
bRSN_IE_FromWSuli
 =
FALSE
))

556 
	`NdisMoveMemy
(
pAd
->
SCfg
.
ReqVIEs
 + 
VIesOfft
, &
RSNIe
, 1);

557 
VIesOfft
 += 1;

558 
	`NdisMoveMemy
(
pAd
->
SCfg
.
ReqVIEs
 + 
VIesOfft
, &pAd->SCfg.
RSNIE_L
, 1);

559 
VIesOfft
 += 1;

561 
	`NdisMoveMemy
(
pAd
->
SCfg
.
ReqVIEs
 + 
VIesOfft
,Ad->SCfg.
RSN_IE
,Ad->SCfg.
RSNIE_L
);

562 
VIesOfft
 +
pAd
->
SCfg
.
RSNIE_L
;

565 
pAd
->
SCfg
.
ReqVIEL
 = 
VIesOfft
;

569 #ifde
WPA_SUPPLICANT_SUPPORT


570 #ifde
SIOCSIWGENIE


571 i((
pAd
->
SCfg
.
WSuliUP
 & 
WPA_SUPPLICANT_ENABLE
) &&

572 (
pAd
->
SCfg
.
bRSN_IE_FromWSuli
 =
TRUE
))

574 
ULONG
 
TmpWAssocIeL
 = 0;

575 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
TmpWAssocIeL
,

576 
pAd
->
SCfg
.
WAssocIeL
,Ad->SCfg.
pWAssocIe
,

577 
END_OF_ARGS
);

579 
FmeL
 +
TmpWAssocIeL
;

581 
	`NdisMoveMemy
(
pAd
->
SCfg
.
ReqVIEs
 + 
VIesOfft
,Ad->SCfg.
pWAssocIe
,Ad->SCfg.
WAssocIeL
);

582 
VIesOfft
 +
pAd
->
SCfg
.
WAssocIeL
;

585 
pAd
->
SCfg
.
ReqVIEL
 = 
VIesOfft
;

591 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

592 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

594 
	`RTMPSTim
(&
pAd
->
MlmeAux
.
AssocTim
, 
Timeout
);

595 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_WAIT_RSP
;

599 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ASSOC - MlmeAssocReqAction() sanity check failed. BUG!!!!!! \n"));

600 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

601 
Stus
 = 
MLME_INVALID_FORMAT
;

602 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_ASSOC_CONF
, 2, &
Stus
, 0);

605 
	}
}

624 
VOID
 
	$MlmeRssocReqAi
(

625 
IN
 
PRTMP_ADAPTER
 
pAd
,

626 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

628 
UCHAR
 
ApAddr
[6];

629 
HEADER_802_11
 
RssocHdr
;

630 
UCHAR
 
WmeIe
[9] = {
IE_VENDOR_SPECIFIC
, 0x07, 0x00, 0x50, 0xf2, 0x02, 0x00, 0x01, 0x00};

631 
USHORT
 
CabyInfo
, 
LiIv
;

632 
ULONG
 
Timeout
;

633 
ULONG
 
FmeL
 = 0;

634 
BOOLEAN
 
TimCed
;

635 
NDIS_STATUS
 
NStus
;

636 
ULONG
 
tmp
;

637 
PUCHAR
 
pOutBufr
 = 
NULL
;

638 
USHORT
 
Stus
;

641 i(
pAd
->
SCfg
.
bBlockAssoc
 =
TRUE
)

643 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - Block ReAssocequest durning WPA blockeriod!\n"));

644 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

645 
Stus
 = 
MLME_STATE_MACHINE_REJECT
;

646 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_REASSOC_CONF
, 2, &
Stus
, 0);

649 if(
	`MlmeAssocReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
ApAddr
, &
CabyInfo
, &
Timeout
, &
LiIv
))

651 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
RssocTim
, &
TimCed
);

653 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

654 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

656 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ASSOC - MlmeReassocReqAction()llocate memory failed \n"));

657 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

658 
Stus
 = 
MLME_FAIL_NO_RESOURCE
;

659 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_REASSOC_CONF
, 2, &
Stus
, 0);

663 
	`COPY_MAC_ADDR
(
pAd
->
MlmeAux
.
Bssid
, 
ApAddr
);

666 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - Send RE-ASSOCequest...\n"));

667 
	`MgtMacHdIn
(
pAd
, &
RssocHdr
, 
SUBTYPE_REASSOC_REQ
, 0, 
ApAddr
, ApAddr);

668 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

669 (
HEADER_802_11
), &
RssocHdr
,

670 2, &
CabyInfo
,

671 2, &
LiIv
,

672 
MAC_ADDR_LEN
, 
ApAddr
,

673 1, &
SsidIe
,

674 1, &
pAd
->
MlmeAux
.
SsidL
,

675 
pAd
->
MlmeAux
.
SsidL
,Ad->MlmeAux.
Ssid
,

676 1, &
SupReIe
,

677 1, &
pAd
->
MlmeAux
.
SupReL
,

678 
pAd
->
MlmeAux
.
SupReL
,Ad->MlmeAux.
SupRe
,

679 
END_OF_ARGS
);

681 i(
pAd
->
MlmeAux
.
ExtReL
 != 0)

683 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

684 1, &
ExtReIe
,

685 1, &
pAd
->
MlmeAux
.
ExtReL
,

686 
pAd
->
MlmeAux
.
ExtReL
,Ad->MlmeAux.
ExtRe
,

687 
END_OF_ARGS
);

688 
FmeL
 +
tmp
;

692 i(
pAd
->
MlmeAux
.
APEdPm
.
bVid
)

694 i(
pAd
->
CommCfg
.
bAPSDCab
 &&Ad->
MlmeAux
.
APEdPm
.bAPSDCapable)

696 
QBSS_STA_INFO_PARM
 
QosInfo
;

698 
	`NdisZoMemy
(&
QosInfo
, (
QBSS_STA_INFO_PARM
));

699 
QosInfo
.
UAPSD_AC_BE
 = 
pAd
->
CommCfg
.
bAPSDAC_BE
;

700 
QosInfo
.
UAPSD_AC_BK
 = 
pAd
->
CommCfg
.
bAPSDAC_BK
;

701 
QosInfo
.
UAPSD_AC_VI
 = 
pAd
->
CommCfg
.
bAPSDAC_VI
;

702 
QosInfo
.
UAPSD_AC_VO
 = 
pAd
->
CommCfg
.
bAPSDAC_VO
;

703 
QosInfo
.
MaxSPLgth
 = 
pAd
->
CommCfg
.MaxSPLength;

705 
	`DBGPRINT
(
RT_DEBUG_TRACE
,

706 ("usd> MaxSPLgth = %d!\n", 
QosInfo
.
MaxSPLgth
));

707 
WmeIe
[8] |*(
PUCHAR
)&
QosInfo
;

710 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

711 9, &
WmeIe
[0],

712 
END_OF_ARGS
);

713 
FmeL
 +
tmp
;

716 #ifde
DOT11_N_SUPPORT


718 i((
pAd
->
MlmeAux
.
HtCabyL
 > 0&& (pAd->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
))

720 
ULONG
 
TmpL
;

721 
UCHAR
 
HtL
;

722 
UCHAR
 
BROADCOM
[4] = {0x0, 0x90, 0x4c, 0x33};

723 
PHT_CAPABILITY_IE
 
pHtCaby
;

725 #ifde
RT_BIG_ENDIAN


726 
HT_CAPABILITY_IE
 
HtCabyTmp
;

727 
	`NdisZoMemy
(&
HtCabyTmp
, (
HT_CAPABILITY_IE
));

728 
	`NdisMoveMemy
(&
HtCabyTmp
, &
pAd
->
MlmeAux
.
HtCaby
,Ad->MlmeAux.
HtCabyL
);

729 *(
USHORT
 *)(&
HtCabyTmp
.
HtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.HtCapInfo));

730 *(
USHORT
 *)(&
HtCabyTmp
.
ExtHtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.ExtHtCapInfo));

731 
pHtCaby
 = &
HtCabyTmp
;

733 
pHtCaby
 = &
pAd
->
MlmeAux
.
HtCaby
;

736 i(
pAd
->
SAive
.
Su܋dPhyInfo
.
bPNHt
 =
TRUE
)

738 
HtL
 = 
SIZE_HT_CAP_IE
 + 4;

739 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
TmpL
,

740 1, &
WIe
,

741 1, &
HtL
,

742 4, &
BROADCOM
[0],

743 
pAd
->
MlmeAux
.
HtCabyL
, 
pHtCaby
,

744 
END_OF_ARGS
);

748 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
TmpL
,

749 1, &
HtCIe
,

750 1, &
pAd
->
MlmeAux
.
HtCabyL
,

751 
pAd
->
MlmeAux
.
HtCabyL
, 
pHtCaby
,

752 
END_OF_ARGS
);

754 
FmeL
 +
TmpL
;

767 i(
pAd
->
CommCfg
.
bAgggiCab
)

769 i((
pAd
->
CommCfg
.
bPiggyBackCab
&& (Ad->
MlmeAux
.
APRkIe
 & 0x00000003) == 3))

771 
ULONG
 
TmpL
;

772 
UCHAR
 
RkIe
[9] = {
IE_VENDOR_SPECIFIC
, 7, 0x00, 0x0c, 0x43, 0x03, 0x00, 0x00, 0x00};

773 
	`MakeOutgogFme
(
pOutBufr
+
FmeL
, &
TmpL
,

774 9, 
RkIe
,

775 
END_OF_ARGS
);

776 
FmeL
 +
TmpL
;

778 i(
pAd
->
MlmeAux
.
APRkIe
 & 0x00000001)

780 
ULONG
 
TmpL
;

781 
UCHAR
 
RkIe
[9] = {
IE_VENDOR_SPECIFIC
, 7, 0x00, 0x0c, 0x43, 0x01, 0x00, 0x00, 0x00};

782 
	`MakeOutgogFme
(
pOutBufr
+
FmeL
, &
TmpL
,

783 9, 
RkIe
,

784 
END_OF_ARGS
);

785 
FmeL
 +
TmpL
;

790 
ULONG
 
TmpL
;

791 
UCHAR
 
RkIe
[9] = {
IE_VENDOR_SPECIFIC
, 7, 0x00, 0x0c, 0x43, 0x04, 0x00, 0x00, 0x00};

792 
	`MakeOutgogFme
(
pOutBufr
+
FmeL
, &
TmpL
,

793 9, 
RkIe
,

794 
END_OF_ARGS
);

795 
FmeL
 +
TmpL
;

798 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

799 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

801 
	`RTMPSTim
(&
pAd
->
MlmeAux
.
RssocTim
, 
Timeout
*2);

802 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
REASSOC_WAIT_RSP
;

806 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("ASSOC - MlmeReassocReqAction() sanity check failed. BUG!!!! \n"));

807 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

808 
Stus
 = 
MLME_INVALID_FORMAT
;

809 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_REASSOC_CONF
, 2, &
Stus
, 0);

811 
	}
}

824 
VOID
 
	$MlmeDissocReqAi
(

825 
IN
 
PRTMP_ADAPTER
 
pAd
,

826 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

828 
PMLME_DISASSOC_REQ_STRUCT
 
pDissocReq
;

829 
HEADER_802_11
 
DissocHdr
;

830 
PHEADER_802_11
 
pDissocHdr
;

831 
PUCHAR
 
pOutBufr
 = 
NULL
;

832 
ULONG
 
FmeL
 = 0;

833 
NDIS_STATUS
 
NStus
;

834 
BOOLEAN
 
TimCed
;

835 
ULONG
 
Timeout
 = 500;

836 
USHORT
 
Stus
;

838 #ifde
QOS_DLS_SUPPORT


840 i(
pAd
->
CommCfg
.
bDLSCab
)

842 
UCHAR
 
i
;

845 
i
=0; i<
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

847 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
))

849 
	`RTMPSdDLSTrDownFme
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
);

850 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

851 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

856 
i
=
MAX_NUM_OF_INIT_DLS_ENTRY
; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

858 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
))

860 
	`RTMPSdDLSTrDownFme
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
);

861 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

862 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

870 
pDissocReq
 = (
PMLME_DISASSOC_REQ_STRUCT
)(
Em
->
Msg
);

872 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

873 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

875 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - MlmeDisassocReqAction()llocate memory failed\n"));

876 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

877 
Stus
 = 
MLME_FAIL_NO_RESOURCE
;

878 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_DISASSOC_CONF
, 2, &
Stus
, 0);

885 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
DissocTim
, &
TimCed
);

887 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - Send DISASSOCequest[BSSID::%02x:%02x:%02x:%02x:%02x:%02x (Reason=%d)\n",

888 
pDissocReq
->
Addr
[0],DisassocReq->Addr[1],DisassocReq->Addr[2],

889 
pDissocReq
->
Addr
[3],DissocReq->Addr[4],DissocReq->Addr[5],DissocReq->
Rs
));

890 
	`MgtMacHdIn
(
pAd
, &
DissocHdr
, 
SUBTYPE_DISASSOC
, 0, 
pDissocReq
->
Addr
,DisassocReq->Addr);

891 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

892 (
HEADER_802_11
),&
DissocHdr
,

893 2, &
pDissocReq
->
Rs
,

894 
END_OF_ARGS
);

895 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

900 
pDissocHdr
 = (
PHEADER_802_11
)
pOutBufr
;

901 
pDissocHdr
->
FC
.
SubTy
 = 
SUBTYPE_DEAUTH
;

902 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

904 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

906 
pAd
->
SCfg
.
DissocRs
 = 
REASON_DISASSOC_STA_LEAVING
;

907 
	`COPY_MAC_ADDR
(
pAd
->
SCfg
.
DissocS
, 
pDissocReq
->
Addr
);

909 
	`RTMPSTim
(&
pAd
->
MlmeAux
.
DissocTim
, 
Timeout
);

910 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
DISASSOC_WAIT_RSP
;

912 #ifde
WPA_SUPPLICANT_SUPPORT


913 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


914 i(
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
)

917 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, 
RT_DISASSOC_EVENT_FLAG
, 
NULL
, NULL, 0);

922 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


923 
	`RtmpOSWrssEvtSd
(
pAd
, 
SIOCGIWAP
, -1, 
NULL
, NULL, 0);

926 
	`RTMPSdWessEvt
(
pAd
, 
IW_DISASSOC_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

928 
	}
}

941 
VOID
 
	$PrAssocRAi
(

942 
IN
 
PRTMP_ADAPTER
 
pAd
,

943 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

945 
USHORT
 
CabyInfo
, 
Stus
, 
Aid
;

946 
UCHAR
 
SupRe
[
MAX_LEN_OF_SUPPORTED_RATES
], 
SupReL
;

947 
UCHAR
 
ExtRe
[
MAX_LEN_OF_SUPPORTED_RATES
], 
ExtReL
;

948 
UCHAR
 
Addr2
[
MAC_ADDR_LEN
];

949 
BOOLEAN
 
TimCed
;

950 
UCHAR
 
CkFg
;

951 
EDCA_PARM
 
EdPm
;

952 
HT_CAPABILITY_IE
 
HtCaby
;

953 
ADD_HT_INFO_IE
 
AddHtInfo
;

954 
UCHAR
 
HtCabyL
 = 0;

955 
UCHAR
 
AddHtInfoL
;

956 
UCHAR
 
NewExtChlOfft
 = 0xff;

957 
EXT_CAP_INFO_ELEMENT
 
ExtCInfo
;

960 i(
	`PrAssocRSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
,

961 
Addr2
, &
CabyInfo
, &
Stus
, &
Aid
, 
SupRe
, &
SupReL
,

962 
ExtRe
, &
ExtReL
, &
HtCaby
,&
AddHtInfo
, &
HtCabyL
,

963 &
AddHtInfoL
,&
NewExtChlOfft
, &
EdPm
,

964 &
ExtCInfo
,

965 &
CkFg
))

968 if(
	`MAC_ADDR_EQUAL
(
Addr2
, 
pAd
->
MlmeAux
.
Bssid
))

970 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrAssocRAi():ASSOC -eivASSOC_RSPm(us=%d)\n", 
Stus
));

971 #ifde
DOT11_N_SUPPORT


972 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrAssocRAi():MacTab [%d].AMsduSiz%d. ClStusFg0x%lx \n",
Em
->
Wcid
, 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
AMsduSize
,Ad->MacTab.Cڋ[BSSID_WCID].
ClStusFgs
));

974 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
AssocTim
, &
TimCed
);

978 if(
Stus
 =
MLME_SUCCESS
)

980 
UCHAR
 
MaxSu܋dReIn500Kbps
 = 0;

981 
UCHAR
 
idx
;

984 
idx
=0; idx<
SupReL
; idx++)

986 i(
MaxSu܋dReIn500Kbps
 < (
SupRe
[
idx
] & 0x7f))

987 
MaxSu܋dReIn500Kbps
 = 
SupRe
[
idx
] & 0x7f;

990 
idx
=0; idx<
ExtReL
; idx++)

992 i(
MaxSu܋dReIn500Kbps
 < (
ExtRe
[
idx
] & 0x7f))

993 
MaxSu܋dReIn500Kbps
 = 
ExtRe
[
idx
] & 0x7f;

996 
	`AssocPoProc
(
pAd
, 
Addr2
, 
CabyInfo
, 
Aid
, 
SupRe
, 
SupReL
, 
ExtRe
, 
ExtReL
,

997 &
EdPm
, &
HtCaby
, 
HtCabyL
, &
AddHtInfo
);

999 
	`SAddMacTabEry
(
pAd
,

1000 &
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
],

1001 
MaxSu܋dReIn500Kbps
,

1002 &
HtCaby
,

1003 
HtCabyL
,

1004 &
AddHtInfo
,

1005 
AddHtInfoL
,

1006 
CabyInfo
);

1008 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

1009 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_ASSOC_CONF
, 2, &
Stus
, 0);

1011 #ifde
LINUX


1012 #ifde
RT_CFG80211_SUPPORT


1014 
PFRAME_802_11
 
pFme
 = (PFRAME_802_11)(
Em
->
Msg
);

1015 
	`RTEnqueueIlCmd
(
pAd
, 
CMDTHREAD_CONNECT_RESULT_INFORM
,

1016 &
pFme
->
O
[6],

1017 
Em
->
MsgL
 - 6 - (
HEADER_802_11
));

1025 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - PeerAssocRspAction() sanity check fail\n"));

1027 
	}
}

1040 
VOID
 
	$PrRssocRAi
(

1041 
IN
 
PRTMP_ADAPTER
 
pAd
,

1042 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1044 
USHORT
 
CabyInfo
;

1045 
USHORT
 
Stus
;

1046 
USHORT
 
Aid
;

1047 
UCHAR
 
SupRe
[
MAX_LEN_OF_SUPPORTED_RATES
], 
SupReL
;

1048 
UCHAR
 
ExtRe
[
MAX_LEN_OF_SUPPORTED_RATES
], 
ExtReL
;

1049 
UCHAR
 
Addr2
[
MAC_ADDR_LEN
];

1050 
UCHAR
 
CkFg
;

1051 
BOOLEAN
 
TimCed
;

1052 
EDCA_PARM
 
EdPm
;

1053 
HT_CAPABILITY_IE
 
HtCaby
;

1054 
ADD_HT_INFO_IE
 
AddHtInfo
;

1055 
UCHAR
 
HtCabyL
;

1056 
UCHAR
 
AddHtInfoL
;

1057 
UCHAR
 
NewExtChlOfft
 = 0xff;

1058 
EXT_CAP_INFO_ELEMENT
 
ExtCInfo
;

1061 i(
	`PrAssocRSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
Addr2
,

1062 &
CabyInfo
, &
Stus
, &
Aid
, 
SupRe
, &
SupReL
, 
ExtRe
, &
ExtReL
,

1063 &
HtCaby
, &
AddHtInfo
, &
HtCabyL
, &
AddHtInfoL
,&
NewExtChlOfft
, &
EdPm
,

1064 &
ExtCInfo
,

1065 &
CkFg
))

1067 if(
	`MAC_ADDR_EQUAL
(
Addr2
, 
pAd
->
MlmeAux
.
Bssid
))

1069 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC -eivREASSOC_RSPm(us=%d)\n", 
Stus
));

1070 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
RssocTim
, &
TimCed
);

1072 if(
Stus
 =
MLME_SUCCESS
)

1075 
	`AssocPoProc
(
pAd
, 
Addr2
, 
CabyInfo
, 
Aid
, 
SupRe
, 
SupReL
, 
ExtRe
, 
ExtReL
,

1076 &
EdPm
, &
HtCaby
, 
HtCabyL
, &
AddHtInfo
);

1078 #ifde
WPA_SUPPLICANT_SUPPORT


1079 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


1080 i(
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
)

1082 
	`SdAssocIEsToWSuli
(
pAd
);

1083 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, 
RT_ASSOC_EVENT_FLAG
, 
NULL
, NULL, 0);

1088 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


1090 
	`wext_nify_evt_assoc
(
pAd
);

1091 
	`RtmpOSWrssEvtSd
(
pAd
, 
SIOCGIWAP
, -1, &pAd->
MlmeAux
.
Bssid
[0], 
NULL
, 0);

1099 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

1100 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_REASSOC_CONF
, 2, &
Stus
, 0);

1105 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - PeerReassocRspAction() sanity check fail\n"));

1108 
	}
}

1120 
VOID
 
	$AssocPoProc
(

1121 
IN
 
PRTMP_ADAPTER
 
pAd
,

1122 
IN
 
PUCHAR
 
pAddr2
,

1123 
IN
 
USHORT
 
CabyInfo
,

1124 
IN
 
USHORT
 
Aid
,

1125 
IN
 
UCHAR
 
SupRe
[],

1126 
IN
 
UCHAR
 
SupReL
,

1127 
IN
 
UCHAR
 
ExtRe
[],

1128 
IN
 
UCHAR
 
ExtReL
,

1129 
IN
 
PEDCA_PARM
 
pEdPm
,

1130 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

1131 
IN
 
UCHAR
 
HtCabyL
,

1132 
IN
 
ADD_HT_INFO_IE
 *
pAddHtInfo
)

1134 
ULONG
 
Idx
;

1136 
pAd
->
MlmeAux
.
BssTy
 = 
BSS_INFRA
;

1137 
	`COPY_MAC_ADDR
(
pAd
->
MlmeAux
.
Bssid
, 
pAddr2
);

1138 
pAd
->
MlmeAux
.
Aid
 = Aid;

1139 
pAd
->
MlmeAux
.
CabyInfo
 = CabyInf& 
SUPPORTED_CAPABILITY_INFO
;

1141 #ifde
DOT11_N_SUPPORT


1143 i((
HtCabyL
 > 0&& (
pEdPm
->
bVid
 =
FALSE
))

1145 
pEdPm
->
bVid
 = 
TRUE
;

1146 
pEdPm
->
Aif
[0] = 3;

1147 
pEdPm
->
Aif
[1] = 7;

1148 
pEdPm
->
Aif
[2] = 2;

1149 
pEdPm
->
Aif
[3] = 2;

1151 
pEdPm
->
Cwm
[0] = 4;

1152 
pEdPm
->
Cwm
[1] = 4;

1153 
pEdPm
->
Cwm
[2] = 3;

1154 
pEdPm
->
Cwm
[3] = 2;

1156 
pEdPm
->
Cwmax
[0] = 10;

1157 
pEdPm
->
Cwmax
[1] = 10;

1158 
pEdPm
->
Cwmax
[2] = 4;

1159 
pEdPm
->
Cwmax
[3] = 3;

1161 
pEdPm
->
Tx
[0] = 0;

1162 
pEdPm
->
Tx
[1] = 0;

1163 
pEdPm
->
Tx
[2] = 96;

1164 
pEdPm
->
Tx
[3] = 48;

1169 
	`NdisMoveMemy
(&
pAd
->
MlmeAux
.
APEdPm
, 
pEdPm
, (
EDCA_PARM
));

1172 
pAd
->
MlmeAux
.
SupReL
 = SupRateLen;

1173 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
SupRe
, SupRe, 
SupReL
);

1174 
	`RTMPCheckRes
(
pAd
,Ad->
MlmeAux
.
SupRe
, &pAd->MlmeAux.
SupReL
);

1177 
pAd
->
MlmeAux
.
ExtReL
 = ExtRateLen;

1178 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
ExtRe
, ExtRe, 
ExtReL
);

1179 
	`RTMPCheckRes
(
pAd
,Ad->
MlmeAux
.
ExtRe
, &pAd->MlmeAux.
ExtReL
);

1181 #ifde
DOT11_N_SUPPORT


1182 i(
HtCabyL
 > 0)

1184 
	`RTMPCheckHt
(
pAd
, 
BSSID_WCID
, 
pHtCaby
, 
pAddHtInfo
);

1186 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AssocPoProc===> AP.AMsduSiz%d. ClStusFg0x%lx \n", 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
AMsduSize
,Ad->MacTab.Cڋ[BSSID_WCID].
ClStusFgs
));

1188 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AssocPostProc===> (Mmps=%d, AmsduSize=%d, )\n",

1189 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
MmpsMode
,Ad->MacTab.Cڋ[BSSID_WCID].
AMsduSize
));

1193 
Idx
 = 
	`BssTabSrch
(&
pAd
->
SnTab
, 
pAddr2
,Ad->
MlmeAux
.
Chl
);

1194 i(
Idx
 =
BSS_NOT_FOUND
)

1196 
	`DBGPRINT_ERR
(("ASSOC - Can't find BSSftereceiving Assocesponse\n"));

1201 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
RSNIE_L
 = 0;

1202 
	`NdisZoMemy
(
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
RSN_IE
, 
MAX_LEN_OF_RSNIE
);

1205 i((
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
&& (pAd->
SnTab
.
BssEry
[
Idx
].
VIEL
 != 0))

1207 
PUCHAR
 
pVIE
;

1208 
USHORT
 
n
;

1209 
PEID_STRUCT
 
pEid
;

1211 
pVIE
 = 
pAd
->
SnTab
.
BssEry
[
Idx
].
VIEs
;

1212 
n
 = 
pAd
->
SnTab
.
BssEry
[
Idx
].
VIEL
;

1215 #ifde
PCIE_PS_SUPPORT


1218 
	`RTMP_CLEAR_PSFLAG
(
pAd
, 
fRTMP_PS_CAN_GO_SLEEP
);

1220 
n
 > 0)

1222 
pEid
 = (
PEID_STRUCT

pVIE
;

1224 i((
pEid
->
Eid
 =
IE_WPA
&& (
	`NdisEquMemy
Eid->
O
, 
WPA_OUI
, 4))

1225 && (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
 ||Ad->SCfg.AuthMod=
Ndis802_11AuthModeWPAPSK
))

1227 
	`NdisMoveMemy
(
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
RSN_IE
, 
pVIE
, (
pEid
->
L
 + 2));

1228 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
RSNIE_L
 = (
pEid
->
L
 + 2);

1229 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AssocPostProc===> Store RSN_IE for WPA SMegotiation \n"));

1232 i((
pEid
->
Eid
 =
IE_RSN
&& (
	`NdisEquMemy
Eid->
O
 + 2, 
RSN_OUI
, 3))

1233 && (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
 ||Ad->SCfg.AuthMod=
Ndis802_11AuthModeWPA2PSK
))

1235 
	`NdisMoveMemy
(
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
RSN_IE
, 
pVIE
, (
pEid
->
L
 + 2));

1236 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
RSNIE_L
 = (
pEid
->
L
 + 2);

1237 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AssocPostProc===> Store RSN_IE for WPA2 SMegotiation \n"));

1240 
pVIE
 +(
pEid
->
L
 + 2);

1241 
n
 -(
pEid
->
L
 + 2);

1247 i(
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
RSNIE_L
 == 0)

1249 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AssocPostProc===>o RSN_IE \n"));

1253 
	`hex_dump
("RSN_IE", 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
RSN_IE
,Ad->MacTab.Cڋ[BSSID_WCID].
RSNIE_L
);

1256 
	}
}

1269 
VOID
 
	$PrDissocAi
(

1270 
IN
 
PRTMP_ADAPTER
 
pAd
,

1271 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1273 
UCHAR
 
Addr2
[
MAC_ADDR_LEN
];

1274 
USHORT
 
Rs
;

1276 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - PeerDisassocAction()\n"));

1277 if(
	`PrDissocSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
Addr2
, &
Rs
))

1279 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - PrDissocAi(Rs = %d\n", 
Rs
));

1280 i(
	`INFRA_ON
(
pAd
&& 
	`MAC_ADDR_EQUAL
Ad->
CommCfg
.
Bssid
, 
Addr2
))

1283 
	`RTMPSdWessEvt
(
pAd
, 
IW_DISASSOC_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

1295 i(
pAd
->
Mlme
.
ClMache
.
CuS
 =
CNTL_WAIT_DISASSOC
)

1297 
USHORT
 
Stus
;

1298 
Stus
 = 
MLME_SUCCESS
;

1299 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_DISASSOC_CONF
, 2, &
Stus
, 0);

1302 
	`LkDown
(
pAd
, 
TRUE
);

1304 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

1306 #ifde
WPA_SUPPLICANT_SUPPORT


1307 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


1308 i(
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
)

1311 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, 
RT_DISASSOC_EVENT_FLAG
, 
NULL
, NULL, 0);

1316 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


1317 
	`RtmpOSWrssEvtSd
(
pAd
, 
SIOCGIWAP
, -1, 
NULL
, NULL, 0);

1323 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - PeerDisassocAction() sanity check fail\n"));

1326 
	}
}

1339 
VOID
 
	$AssocTimeoutAi
(

1340 
IN
 
PRTMP_ADAPTER
 
pAd
,

1341 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1343 
USHORT
 
Stus
;

1344 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - AssocTimeoutAction\n"));

1345 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

1346 
Stus
 = 
MLME_REJ_TIMEOUT
;

1347 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_ASSOC_CONF
, 2, &
Stus
, 0);

1348 
	}
}

1359 
VOID
 
	$RssocTimeoutAi
(

1360 
IN
 
PRTMP_ADAPTER
 
pAd
,

1361 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1363 
USHORT
 
Stus
;

1364 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - ReassocTimeoutAction\n"));

1365 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

1366 
Stus
 = 
MLME_REJ_TIMEOUT
;

1367 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_REASSOC_CONF
, 2, &
Stus
, 0);

1368 
	}
}

1379 
VOID
 
	$DissocTimeoutAi
(

1380 
IN
 
PRTMP_ADAPTER
 
pAd
,

1381 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1383 
USHORT
 
Stus
;

1384 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - DisassocTimeoutAction\n"));

1385 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

1386 
Stus
 = 
MLME_SUCCESS
;

1387 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_DISASSOC_CONF
, 2, &
Stus
, 0);

1388 
	}
}

1390 
VOID
 
	$InvidSWhAssoc
(

1391 
IN
 
PRTMP_ADAPTER
 
pAd
,

1392 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1394 
USHORT
 
Stus
;

1395 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - InvalidStateWhenAssoc(state=%ld),eset ASSOC state machine\n",

1396 
pAd
->
Mlme
.
AssocMache
.
CuS
));

1397 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

1398 
Stus
 = 
MLME_STATE_MACHINE_REJECT
;

1399 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_ASSOC_CONF
, 2, &
Stus
, 0);

1400 
	}
}

1402 
VOID
 
	$InvidSWhRssoc
(

1403 
IN
 
PRTMP_ADAPTER
 
pAd
,

1404 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1406 
USHORT
 
Stus
;

1407 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - InvalidStateWhenReassoc(state=%ld),eset ASSOC state machine\n",

1408 
pAd
->
Mlme
.
AssocMache
.
CuS
));

1409 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

1410 
Stus
 = 
MLME_STATE_MACHINE_REJECT
;

1411 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_REASSOC_CONF
, 2, &
Stus
, 0);

1412 
	}
}

1414 
VOID
 
	$InvidSWhDissoc
(

1415 
IN
 
PRTMP_ADAPTER
 
pAd
,

1416 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1418 
USHORT
 
Stus
;

1419 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - InvalidStateWhenDisassoc(state=%ld),eset ASSOC state machine\n",

1420 
pAd
->
Mlme
.
AssocMache
.
CuS
));

1421 
pAd
->
Mlme
.
AssocMache
.
CuS
 = 
ASSOC_IDLE
;

1422 
Stus
 = 
MLME_STATE_MACHINE_REJECT
;

1423 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_DISASSOC_CONF
, 2, &
Stus
, 0);

1424 
	}
}

1439 
VOID
 
	$Cls3rAi
(

1440 
IN
 
PRTMP_ADAPTER
 
pAd
,

1441 
IN
 
PUCHAR
 
pAddr
)

1443 
HEADER_802_11
 
DissocHdr
;

1444 
PHEADER_802_11
 
pDissocHdr
;

1445 
PUCHAR
 
pOutBufr
 = 
NULL
;

1446 
ULONG
 
FmeL
 = 0;

1447 
NDIS_STATUS
 
NStus
;

1448 
USHORT
 
Rs
 = 
REASON_CLS3ERR
;

1450 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

1451 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

1454 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ASSOC - Class 3 Error, Send DISASSOC frame\n"));

1455 
	`MgtMacHdIn
(
pAd
, &
DissocHdr
, 
SUBTYPE_DISASSOC
, 0, 
pAddr
,Ad->
CommCfg
.
Bssid
);

1456 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1457 (
HEADER_802_11
),&
DissocHdr
,

1458 2, &
Rs
,

1459 
END_OF_ARGS
);

1460 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

1465 
pDissocHdr
 = (
PHEADER_802_11
)
pOutBufr
;

1466 
pDissocHdr
->
FC
.
SubTy
 = 
SUBTYPE_DEAUTH
;

1467 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

1469 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1471 
pAd
->
SCfg
.
DissocRs
 = 
REASON_CLS3ERR
;

1472 
	`COPY_MAC_ADDR
(
pAd
->
SCfg
.
DissocS
, 
pAddr
);

1473 
	}
}

1475 #ifde
WPA_SUPPLICANT_SUPPORT


1476 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


1477 
VOID
 
	$SdAssocIEsToWSuli
(

1478 
IN
 
PRTMP_ADAPTER
 
pAd
)

1480 
STRING
 
cuom
[
IW_CUSTOM_MAX
] = {0};

1482 i((
pAd
->
SCfg
.
ReqVIEL
 + 17<
IW_CUSTOM_MAX
)

1484 
	`rtf
(
cuom
, "ASSOCINFO_ReqIEs=");

1485 
	`NdisMoveMemy
(
cuom
+17, 
pAd
->
SCfg
.
ReqVIEs
,Ad->SCfg.
ReqVIEL
);

1486 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, 
RT_REQIE_EVENT_FLAG
, 
NULL
, (
PUCHAR
)
cuom
,Ad->
SCfg
.
ReqVIEL
 + 17);

1488 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, 
RT_ASSOCINFO_EVENT_FLAG
, 
NULL
, NULL, 0);

1491 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("pAd->StaCfg.ReqVarIELen + 17 > MAX_CUSTOM_LEN\n"));

1494 
	}
}

1498 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


1499 
	$wext_nify_evt_assoc
(

1500 
IN
 
RTMP_ADAPTER
 *
pAd
)

1502 
cuom
[
IW_CUSTOM_MAX
] = {0};

1504 #i
WIRELESS_EXT
 > 17

1505 i(
pAd
->
SCfg
.
ReqVIEL
 <
IW_CUSTOM_MAX
)

1507 
	`NdisMoveMemy
(
cuom
, 
pAd
->
SCfg
.
ReqVIEs
,Ad->SCfg.
ReqVIEL
);

1508 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVASSOCREQIE
, -1, 
NULL
, 
cuom
,Ad->
SCfg
.
ReqVIEL
);

1511 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("pAd->StaCfg.ReqVarIELen > MAX_CUSTOM_LEN\n"));

1513 
n
;

1515 
n
 = (
pAd
->
SCfg
.
ReqVIEL
*2) + 17;

1516 i(
n
 <
IW_CUSTOM_MAX
)

1518 
UCHAR
 
idx
;

1519 
	`rtf
(
cuom
, "ASSOCINFO(ReqIEs=");

1520 
idx
=0; idx<
pAd
->
SCfg
.
ReqVIEL
; idx++)

1521 
	`rtf
(
cuom
, "%s%02x", cuom, 
pAd
->
SCfg
.
ReqVIEs
[
idx
]);

1522 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, -1, 
NULL
, 
cuom
, 
n
);

1525 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("n(%d> MAX_CUSTOM_LEN\n", 
n
));

1530 
	}
}

1534 
BOOLEAN
 
	$SAddMacTabEry
(

1535 
IN
 
PRTMP_ADAPTER
 
pAd
,

1536 
IN
 
PMAC_TABLE_ENTRY
 
pEry
,

1537 
IN
 
UCHAR
 
MaxSu܋dReIn500Kbps
,

1538 
IN
 
HT_CAPABILITY_IE
 *
pHtCaby
,

1539 
IN
 
UCHAR
 
HtCabyL
,

1540 
IN
 
ADD_HT_INFO_IE
 *
pAddHtInfo
,

1541 
IN
 
UCHAR
 
AddHtInfoL
,

1542 
IN
 
USHORT
 
CabyInfo
)

1544 
UCHAR
 
MaxSu܋dRe
 = 
RATE_11
;

1545 
BOOLEAN
 
bSutN
 = 
FALSE
;

1547 i(!
pEry
)

1548  
FALSE
;

1550 i(
	`ADHOC_ON
(
pAd
))

1551 
	`CLIENT_STATUS_CLEAR_FLAG
(
pEry
, 
fCLIENT_STATUS_WMM_CAPABLE
);

1553 
MaxSu܋dReIn500Kbps
)

1555 108: 
MaxSu܋dRe
 = 
RATE_54
; ;

1556 96: 
MaxSu܋dRe
 = 
RATE_48
; ;

1557 72: 
MaxSu܋dRe
 = 
RATE_36
; ;

1558 48: 
MaxSu܋dRe
 = 
RATE_24
; ;

1559 36: 
MaxSu܋dRe
 = 
RATE_18
; ;

1560 24: 
MaxSu܋dRe
 = 
RATE_12
; ;

1561 18: 
MaxSu܋dRe
 = 
RATE_9
; ;

1562 12: 
MaxSu܋dRe
 = 
RATE_6
; ;

1563 22: 
MaxSu܋dRe
 = 
RATE_11
; ;

1564 11: 
MaxSu܋dRe
 = 
RATE_5_5
; ;

1565 4: 
MaxSu܋dRe
 = 
RATE_2
; ;

1566 2: 
MaxSu܋dRe
 = 
RATE_1
; ;

1567 : 
MaxSu܋dRe
 = 
RATE_11
; ;

1570 i((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11G
&& (
MaxSu܋dRe
 < 
RATE_FIRST_OFDM_RATE
))

1571  
FALSE
;

1573 #ifde
DOT11_N_SUPPORT


1575 i(((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11N_2_4G
|| (pAd->CommCfg.PhyMod=
PHY_11N_5G
))&& (
HtCabyL
 == 0))

1576  
FALSE
;

1579 
	`NdisAcqueSpLock
(&
pAd
->
MacTabLock
);

1580 i(
pEry
)

1582 
pEry
->
PtSecud
 = 
WPA_802_1X_PORT_SECURED
;

1583 i((
MaxSu܋dRe
 < 
RATE_FIRST_OFDM_RATE
) ||

1584 (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11B
))

1586 
pEry
->
ReL
 = 4;

1587 i(
MaxSu܋dRe
 >
RATE_FIRST_OFDM_RATE
)

1588 
MaxSu܋dRe
 = 
RATE_11
;

1591 
pEry
->
ReL
 = 12;

1593 
pEry
->
MaxHTPhyMode
.
wd
 = 0;

1594 
pEry
->
MHTPhyMode
.
wd
 = 0;

1595 
pEry
->
HTPhyMode
.
wd
 = 0;

1596 
pEry
->
MaxSu܋dRe
 = MaxSupportedRate;

1597 i(
pEry
->
MaxSu܋dRe
 < 
RATE_FIRST_OFDM_RATE
)

1599 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

1600 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

1601 
pEry
->
MHTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

1602 
pEry
->
MHTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

1603 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

1604 
pEry
->
HTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

1608 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

1609 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

1610 
pEry
->
MHTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

1611 
pEry
->
MHTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

1612 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

1613 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

1615 
pEry
->
CabyInfo
 = CapabilityInfo;

1616 
	`CLIENT_STATUS_CLEAR_FLAG
(
pEry
, 
fCLIENT_STATUS_AGGREGATION_CAPABLE
);

1617 
	`CLIENT_STATUS_CLEAR_FLAG
(
pEry
, 
fCLIENT_STATUS_PIGGYBACK_CAPABLE
);

1620 #ifde
DOT11_N_SUPPORT


1621 
	`NdisZoMemy
(&
pEry
->
HTCaby
, (pEntry->HTCapability));

1623 i(((
pAd
->
SCfg
.
WStus
 !
Ndis802_11WEPEbd
&& (pAd->SCfg.WStu!
Ndis802_11Enyi2Ebd
))

1624 || (
pAd
->
CommCfg
.
HT_DiowTKIP
 =
FALSE
))

1626 i((
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
) &&

1627 (
HtCabyL
 != 0) &&

1628 (
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
))

1629 
bSutN
 = 
TRUE
;

1630 i((
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
) &&

1631 (
pAd
->
SCfg
.
bAdhocN
 =
TRUE
) &&

1632 (
HtCabyL
 != 0) &&

1633 (
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
))

1634 
bSutN
 = 
TRUE
;

1636 i(
bSutN
)

1638 
UCHAR
 
j
, 
bmask
;

1639 
CHAR
 
i
;

1641 i(
	`ADHOC_ON
(
pAd
))

1642 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_WMM_CAPABLE
);

1643 i((
pHtCaby
->
HtCInfo
.
GF
&& (
pAd
->
CommCfg
.
DesedHtPhy
.GF))

1645 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTGREENFIELD
;

1649 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTMIX
;

1650 
pAd
->
MacTab
.
fAnyStiNGF
 = 
TRUE
;

1651 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo2
.
NGfP
 = 1;

1654 i((
pHtCaby
->
HtCInfo
.
ChlWidth
) &&

1655 (
pAd
->
CommCfg
.
DesedHtPhy
.
ChlWidth
))

1657 
pEry
->
MaxHTPhyMode
.
fld
.
BW

BW_40
;

1658 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = ((
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf40
)&(
pHtCaby
->
HtCInfo
.ShortGIfor40));

1662 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 
BW_20
;

1663 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = ((
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf20
)&(
pHtCaby
->
HtCInfo
.ShortGIfor20));

1664 
pAd
->
MacTab
.
fAnySti20Oy
 = 
TRUE
;

1669 
i
=23; i>=0; i--)

1671 
j
 = 
i
/8;

1672 
bmask
 = (1<<(
i
-(
j
*8)));

1673 i((
pAd
->
SCfg
.
DesedHtPhyInfo
.
MCSS
[
j
] & 
bmask
&& (
pHtCaby
->MCSSet[j] & bitmask))

1675 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
i
;

1678 i(
i
==0)

1683 i(
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 !
MCS_AUTO
)

1685 i(
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 == 32)

1688 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 1;

1689 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTMIX
;

1690 
pEry
->
MaxHTPhyMode
.
fld
.
STBC
 = 0;

1691 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = 0;

1692 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 32;

1694 i(
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 > 
pAd
->
SCfg
.
HTPhyMode
.field.MCS)

1697 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.
HTPhyMode
.field.MCS;

1701 
pEry
->
MaxHTPhyMode
.
fld
.
STBC
 = (
pHtCaby
->
HtCInfo
.
RxSTBC
 & (
pAd
->
CommCfg
.
DesedHtPhy
.
TxSTBC
));

1702 
pEry
->
MpduDsy
 = 
pHtCaby
->
HtCPm
.MpduDensity;

1703 
pEry
->
MaxRAmpduFa
 = 
pHtCaby
->
HtCPm
.MaxRAmpduFactor;

1704 
pEry
->
MmpsMode
 = (
UCHAR
)
pHtCaby
->
HtCInfo
.
MimoPs
;

1705 
pEry
->
AMsduSize
 = (
UCHAR
)
pHtCaby
->
HtCInfo
.AMsduSize;

1706 
pEry
->
HTPhyMode
.
wd
 =Ery->
MaxHTPhyMode
.word;

1708 i(
pAd
->
CommCfg
.
DesedHtPhy
.
AmsduEb
 && (pAd->CommCfg.
REGBACaby
.
fld
.
AutoBA
 =
FALSE
))

1709 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_AMSDU_INUSED
);

1710 i(
pHtCaby
->
HtCInfo
.
ShtGIf20
)

1711 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_SGI20_CAPABLE
);

1712 i(
pHtCaby
->
HtCInfo
.
ShtGIf40
)

1713 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_SGI40_CAPABLE
);

1714 i(
pHtCaby
->
HtCInfo
.
TxSTBC
)

1715 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_TxSTBC_CAPABLE
);

1716 i(
pHtCaby
->
HtCInfo
.
RxSTBC
)

1717 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_RxSTBC_CAPABLE
);

1718 i(
pHtCaby
->
ExtHtCInfo
.
PlusHTC
)

1719 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_HTC_CAPABLE
);

1720 i(
pAd
->
CommCfg
.
bRdg
 && 
pHtCaby
->
ExtHtCInfo
.
RDGSut
)

1721 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_RDG_CAPABLE
);

1722 i(
pHtCaby
->
ExtHtCInfo
.
MCSFdback
 == 0x03)

1723 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_MCSFEEDBACK_CAPABLE
);

1724 
	`NdisMoveMemy
(&
pEry
->
HTCaby
, 
pHtCaby
, 
HtCabyL
);

1728 
pAd
->
MacTab
.
fAnyStiIsLegacy
 = 
TRUE
;

1732 
pEry
->
HTPhyMode
.
wd
 =Ery->
MaxHTPhyMode
.word;

1733 
pEry
->
CuTxRe
 =Ery->
MaxSu܋dRe
;

1736 i(
pAd
->
SCfg
.
bAutoTxReSwch
 =
TRUE
)

1738 
PUCHAR
 
pTab
;

1739 
UCHAR
 
TabSize
 = 0;

1741 
	`MlmeSeTxReTab
(
pAd
, 
pEry
, &
pTab
, &
TabSize
, &pEry->
CuTxReIndex
);

1742 
pEry
->
bAutoTxReSwch
 = 
TRUE
;

1746 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
pAd
->
SCfg
.HTPhyMode.field.MODE;

1747 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.HTPhyMode.field.MCS;

1748 
pEry
->
bAutoTxReSwch
 = 
FALSE
;

1751 
	`RTMPUpdeLegacyTxStg
((
UCHAR
)
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
, 
pEry
);

1754 
pEry
->
PtSecud
 = 
WPA_802_1X_PORT_SECURED
;

1755 
pEry
->
S
 = 
SST_ASSOC
;

1756 
pEry
->
AuthS
 = 
AS_AUTH_OPEN
;

1757 
pEry
->
AuthMode
 = 
pAd
->
SCfg
.AuthMode;

1758 
pEry
->
WStus
 = 
pAd
->
SCfg
.WepStatus;

1760 
	`NdisRSpLock
(&
pAd
->
MacTabLock
);

1762 #ifde
WPA_SUPPLICANT_SUPPORT


1763 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


1764 i(
pAd
->
SCfg
.
WSuliUP
)

1766 
iwq_da
 
wrqu
;

1768 
	`SdAssocIEsToWSuli
(
pAd
);

1769 
	`memt
(&
wrqu
, 0, (wrqu));

1770 
wrqu
.
da
.
ags
 = 
RT_ASSOC_EVENT_FLAG
;

1771 
	`wess_nd_evt
(
pAd
->
t_dev
, 
IWEVCUSTOM
, &
wrqu
, 
NULL
);

1776 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


1778 
iwq_da
 
wrqu
;

1779 
	`wext_nify_evt_assoc
(
pAd
);

1781 
	`memt
(
wrqu
.
_addr
.
_da
, 0, 
MAC_ADDR_LEN
);

1782 
	`memy
(
wrqu
.
_addr
.
_da
, 
pAd
->
MlmeAux
.
Bssid
, 
MAC_ADDR_LEN
);

1783 
	`wess_nd_evt
(
pAd
->
t_dev
, 
SIOCGIWAP
, &
wrqu
, 
NULL
);

1787  
TRUE
;

1788 
	}
}

	@sta/auth.c

37 
	~"_cfig.h
"

58 
	$AuthSMacheIn
(

59 
IN
 
PRTMP_ADAPTER
 
pAd
,

60 
IN
 
STATE_MACHINE
 *
Sm
,

61 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[])

63 
	`SMacheIn
(
Sm
, 
Tns
, 
MAX_AUTH_STATE
, 
MAX_AUTH_MSG
, (
STATE_MACHINE_FUNC
)
Dr
, 
AUTH_REQ_IDLE
, 
AUTH_MACHINE_BASE
);

66 
	`SMacheSAi
(
Sm
, 
AUTH_REQ_IDLE
, 
MT2_MLME_AUTH_REQ
, (
STATE_MACHINE_FUNC
)
MlmeAuthReqAi
);

69 
	`SMacheSAi
(
Sm
, 
AUTH_WAIT_SEQ2
, 
MT2_MLME_AUTH_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhAuth
);

70 
	`SMacheSAi
(
Sm
, 
AUTH_WAIT_SEQ2
, 
MT2_PEER_AUTH_EVEN
, (
STATE_MACHINE_FUNC
)
PrAuthRAtSeq2Ai
);

71 
	`SMacheSAi
(
Sm
, 
AUTH_WAIT_SEQ2
, 
MT2_AUTH_TIMEOUT
, (
STATE_MACHINE_FUNC
)
AuthTimeoutAi
);

74 
	`SMacheSAi
(
Sm
, 
AUTH_WAIT_SEQ4
, 
MT2_MLME_AUTH_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhAuth
);

75 
	`SMacheSAi
(
Sm
, 
AUTH_WAIT_SEQ4
, 
MT2_PEER_AUTH_EVEN
, (
STATE_MACHINE_FUNC
)
PrAuthRAtSeq4Ai
);

76 
	`SMacheSAi
(
Sm
, 
AUTH_WAIT_SEQ4
, 
MT2_AUTH_TIMEOUT
, (
STATE_MACHINE_FUNC
)
AuthTimeoutAi
);

78 
	`RTMPInTim
(
pAd
, &pAd->
MlmeAux
.
AuthTim
, 
	`GET_TIMER_FUNCTION
(
AuthTimeout
),Ad, 
FALSE
);

79 
	}
}

90 
VOID
 
	$AuthTimeout
(

91 
IN
 
PVOID
 
SyemScific1
,

92 
IN
 
PVOID
 
FuniCڋxt
,

93 
IN
 
PVOID
 
SyemScific2
,

94 
IN
 
PVOID
 
SyemScific3
)

96 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

98 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("AUTH - AuthTimeout\n"));

102 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 | 
fRTMP_ADAPTER_NIC_NOT_EXIST
))

106 i(
pAd
->
Mlme
.
AuthMache
.
CuS
 =
AUTH_WAIT_SEQ2
)

107 
	`Cls2rAi
(
pAd
,Ad->
MlmeAux
.
Bssid
);

110 
	`MlmeEnqueue
(
pAd
, 
AUTH_STATE_MACHINE
, 
MT2_AUTH_TIMEOUT
, 0, 
NULL
, 0);

111 
	`RTMP_MLME_HANDLER
(
pAd
);

112 
	}
}

123 
VOID
 
	$MlmeAuthReqAi
(

124 
IN
 
PRTMP_ADAPTER
 
pAd
,

125 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

127 i(
	`AUTH_ReqSd
(
pAd
, 
Em
, &pAd->
MlmeAux
.
AuthTim
, "AUTH", 1, 
NULL
, 0))

128 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_WAIT_SEQ2
;

131 
USHORT
 
Stus
;

133 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

134 
Stus
 = 
MLME_INVALID_FORMAT
;

135 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_AUTH_CONF
, 2, &
Stus
, 0);

137 
	}
}

147 
VOID
 
	$PrAuthRAtSeq2Ai
(

148 
IN
 
PRTMP_ADAPTER
 
pAd
,

149 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

151 
UCHAR
 
Addr2
[
MAC_ADDR_LEN
];

152 
USHORT
 
Seq
, 
Stus
, 
RemeStus
, 
Alg
;

153 
UCHAR
 
iv_hdr
[4];

155 
UCHAR
 *
ChlgText
 = 
NULL
;

157 
UCHAR
 *
CyrChlgText
 = 
NULL
;

158 
ULONG
 
c_n
 = 0;

159 
HEADER_802_11
 
AuthHdr
;

160 
BOOLEAN
 
TimCed
;

161 
PUCHAR
 
pOutBufr
 = 
NULL
;

162 
NDIS_STATUS
 
NStus
;

163 
ULONG
 
FmeL
 = 0;

164 
USHORT
 
Stus2
;

165 
UCHAR
 
ChngeIe
 = 
IE_CHALLENGE_TEXT
;

166 
UCHAR
 
n_chngeText
 = 
CIPHER_TEXT_LEN
;

169 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
ChlgText
, 
CIPHER_TEXT_LEN
);

170 i(
ChlgText
 =
NULL
)

172 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: ChlgTexAo memy fa!!!\n", 
__FUNCTION__
));

176 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
CyrChlgText
, 
CIPHER_TEXT_LEN
 + 8 + 8);

177 i(
CyrChlgText
 =
NULL
)

179 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: CyrChlgTexAo memy fa!!!\n", 
__FUNCTION__
));

183 i(
	`PrAuthSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
Addr2
, &
Alg
, &
Seq
, &
Stus
, (
PCHAR
)
ChlgText
))

185 i(
	`MAC_ADDR_EQUAL
(
pAd
->
MlmeAux
.
Bssid
, 
Addr2
&& 
Seq
 == 2)

187 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - ReivAUTH_RSP seq#2m(Alg=%d, Stus=%d)\n", 
Alg
, 
Stus
));

188 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
AuthTim
, &
TimCed
);

190 i(
Stus
 =
MLME_SUCCESS
)

193 i(
pAd
->
MlmeAux
.
Alg
 =
Ndis802_11AuthModeOn
)

195 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

196 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_AUTH_CONF
, 2, &
Stus
, 0);

201 
Seq
++;

202 
RemeStus
 = 
MLME_SUCCESS
;

205 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

206 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

208 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - PeerAuthRspAtSeq2Action()llocate memory fail\n"));

209 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

210 
Stus2
 = 
MLME_FAIL_NO_RESOURCE
;

211 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_AUTH_CONF
, 2, &
Stus2
, 0);

212 
LabOK
;

215 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - Send AUTHequest seq#3...\n"));

216 
	`MgtMacHdIn
(
pAd
, &
AuthHdr
, 
SUBTYPE_AUTH
, 0, 
Addr2
,Ad->
MlmeAux
.
Bssid
);

217 
AuthHdr
.
FC
.
W
 = 1;

220 
	`INC_TX_TSC
(
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
TxTsc
, 
LEN_WEP_TSC
);

223 
	`RTMPCڡruWEPIVHdr
(
pAd
->
SCfg
.
DeuKeyId
,

224 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
TxTsc
,

225 
iv_hdr
);

227 
Alg
 = 
	`u216
(*(
USHORT
 *)&Alg);

228 
Seq
 = 
	`u216
(*(
USHORT
 *)&Seq);

229 
RemeStus

	`u216
(*(
USHORT
 *)&RemoteStatus);

232 
	`MakeOutgogFme
(
CyrChlgText
, &
c_n
,

233 2, &
Alg
,

234 2, &
Seq
,

235 2, &
RemeStus
,

236 1, &
ChngeIe
,

237 1, &
n_chngeText
,

238 
n_chngeText
, 
ChlgText
,

239 
END_OF_ARGS
);

241 i(
	`RTMPSoEnyWEP
(
pAd
,

242 
iv_hdr
,

243 &
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
],

244 
CyrChlgText
,

245 
c_n
=
FALSE
)

247 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

248 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

249 
Stus2
 = 
MLME_FAIL_NO_RESOURCE
;

250 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_AUTH_CONF
, 2, &
Stus2
, 0);

251 
LabOK
;

255 
c_n
 +
LEN_ICV
;

257 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

258 (
HEADER_802_11
), &
AuthHdr
,

259 
LEN_WEP_IV_HDR
, 
iv_hdr
,

260 
c_n
, 
CyrChlgText
,

261 
END_OF_ARGS
);

264 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

265 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

267 
	`RTMPSTim
(&
pAd
->
MlmeAux
.
AuthTim
, 
AUTH_TIMEOUT
);

268 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_WAIT_SEQ4
;

273 
pAd
->
SCfg
.
AuthFaRs
 = 
Stus
;

274 
	`COPY_MAC_ADDR
(
pAd
->
SCfg
.
AuthFaS
, 
Addr2
);

275 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

276 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_AUTH_CONF
, 2, &
Stus
, 0);

282 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - PeerAuthSanity() sanity check fail\n"));

285 
LabOK
:

286 i(
ChlgText
 !
NULL
)

287 
	`os__mem
(
NULL
, 
ChlgText
);

289 i(
CyrChlgText
 !
NULL
)

290 
	`os__mem
(
NULL
, 
CyrChlgText
);

292 
	}
}

302 
VOID
 
	$PrAuthRAtSeq4Ai
(

303 
IN
 
PRTMP_ADAPTER
 
pAd
,

304 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

306 
UCHAR
 
Addr2
[
MAC_ADDR_LEN
];

307 
USHORT
 
Alg
, 
Seq
, 
Stus
;

309 
CHAR
 *
ChlgText
 = 
NULL
;

310 
BOOLEAN
 
TimCed
;

313 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
ChlgText
, 
CIPHER_TEXT_LEN
);

314 i(
ChlgText
 =
NULL
)

316 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: ChlgTexAo memy fa!!!\n", 
__FUNCTION__
));

320 if(
	`PrAuthSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
Addr2
, &
Alg
, &
Seq
, &
Stus
, 
ChlgText
))

322 if(
	`MAC_ADDR_EQUAL
(
pAd
->
MlmeAux
.
Bssid
, 
Addr2
&& 
Seq
 == 4)

324 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - Receive AUTH_RSP seq#4o me\n"));

325 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
AuthTim
, &
TimCed
);

327 i(
Stus
 !
MLME_SUCCESS
)

329 
pAd
->
SCfg
.
AuthFaRs
 = 
Stus
;

330 
	`COPY_MAC_ADDR
(
pAd
->
SCfg
.
AuthFaS
, 
Addr2
);

331 
	`RTMPSdWessEvt
(
pAd
, 
IW_SHARED_WEP_FAIL
, 
NULL
, 
BSS0
, 0);

334 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

335 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_AUTH_CONF
, 2, &
Stus
, 0);

340 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - PeerAuthRspAtSeq4Action() sanity check fail\n"));

343 i(
ChlgText
 !
NULL
)

344 
	`os__mem
(
NULL
, 
ChlgText
);

345 
	}
}

355 
VOID
 
	$MlmeDuthReqAi
(

356 
IN
 
PRTMP_ADAPTER
 
pAd
,

357 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

359 
MLME_DEAUTH_REQ_STRUCT
 *
pInfo
;

360 
HEADER_802_11
 
DuthHdr
;

361 
PUCHAR
 
pOutBufr
 = 
NULL
;

362 
NDIS_STATUS
 
NStus
;

363 
ULONG
 
FmeL
 = 0;

364 
USHORT
 
Stus
;

366 
pInfo
 = (
MLME_DEAUTH_REQ_STRUCT
 *)
Em
->
Msg
;

368 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

369 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

371 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - MlmeDeauthReqAction()llocate memory fail\n"));

372 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

373 
Stus
 = 
MLME_FAIL_NO_RESOURCE
;

374 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_DEAUTH_CONF
, 2, &
Stus
, 0);

379 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - Sd DE-AUTHeque (Rs=%d)...\n", 
pInfo
->
Rs
));

380 
	`MgtMacHdIn
(
pAd
, &
DuthHdr
, 
SUBTYPE_DEAUTH
, 0, 
pInfo
->
Addr
,Ad->
MlmeAux
.
Bssid
);

381 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

382 (
HEADER_802_11
),&
DuthHdr
,

383 2, &
pInfo
->
Rs
,

384 
END_OF_ARGS
);

385 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

386 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

388 
pAd
->
SCfg
.
DuthRs
 = 
pInfo
->
Rs
;

389 
	`COPY_MAC_ADDR
(
pAd
->
SCfg
.
DuthS
, 
pInfo
->
Addr
);

390 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

391 
Stus
 = 
MLME_SUCCESS
;

392 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_DEAUTH_CONF
, 2, &
Stus
, 0);

395 
	`RTMPSdWessEvt
(
pAd
, 
IW_DEAUTH_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

396 
	}
}

406 
VOID
 
	$AuthTimeoutAi
(

407 
IN
 
PRTMP_ADAPTER
 
pAd
,

408 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

410 
USHORT
 
Stus
;

411 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - AuthTimeoutAction\n"));

412 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

413 
Stus
 = 
MLME_REJ_TIMEOUT
;

414 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_AUTH_CONF
, 2, &
Stus
, 0);

415 
	}
}

425 
VOID
 
	$InvidSWhAuth
(

426 
IN
 
PRTMP_ADAPTER
 
pAd
,

427 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

429 
USHORT
 
Stus
;

430 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - InvidSWhAuth (e=%ld),eAUTH s mache\n", 
pAd
->
Mlme
.
AuthMache
.
CuS
));

431 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

432 
Stus
 = 
MLME_STATE_MACHINE_REJECT
;

433 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_AUTH_CONF
, 2, &
Stus
, 0);

434 
	}
}

448 
VOID
 
	$Cls2rAi
(

449 
IN
 
PRTMP_ADAPTER
 
pAd
,

450 
IN
 
PUCHAR
 
pAddr
)

452 
HEADER_802_11
 
DuthHdr
;

453 
PUCHAR
 
pOutBufr
 = 
NULL
;

454 
NDIS_STATUS
 
NStus
;

455 
ULONG
 
FmeL
 = 0;

456 
USHORT
 
Rs
 = 
REASON_CLS2ERR
;

458 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

459 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

462 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AUTH - Class 2rror, Send DEAUTH frame...\n"));

463 
	`MgtMacHdIn
(
pAd
, &
DuthHdr
, 
SUBTYPE_DEAUTH
, 0, 
pAddr
,Ad->
MlmeAux
.
Bssid
);

464 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

465 (
HEADER_802_11
),&
DuthHdr
,

466 2, &
Rs
,

467 
END_OF_ARGS
);

468 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

469 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

471 
pAd
->
SCfg
.
DuthRs
 = 
Rs
;

472 
	`COPY_MAC_ADDR
(
pAd
->
SCfg
.
DuthS
, 
pAddr
);

473 
	}
}

475 
BOOLEAN
 
	$AUTH_ReqSd
(

476 
IN
 
PRTMP_ADAPTER
 
pAd
,

477 
IN
 
PMLME_QUEUE_ELEM
 
pEm
,

478 
IN
 
PRALINK_TIMER_STRUCT
 
pAuthTim
,

479 
IN
 
PSTRING
 
pSMName
,

480 
IN
 
USHORT
 
SeqNo
,

481 
IN
 
PUCHAR
 
pNewEmt
,

482 
IN
 
ULONG
 
EmtL
)

484 
USHORT
 
Alg
, 
Seq
, 
Stus
;

485 
UCHAR
 
Addr
[6];

486 
ULONG
 
Timeout
;

487 
HEADER_802_11
 
AuthHdr
;

488 
BOOLEAN
 
TimCed
;

489 
NDIS_STATUS
 
NStus
;

490 
PUCHAR
 
pOutBufr
 = 
NULL
;

491 
ULONG
 
FmeL
 = 0, 
tmp
 = 0;

494 i(
pAd
->
SCfg
.
bBlockAssoc
 =
TRUE
)

496 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%- Block Autheque dug WPA blockiod!\n", 
pSMName
));

497 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

498 
Stus
 = 
MLME_STATE_MACHINE_REJECT
;

499 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_AUTH_CONF
, 2, &
Stus
, 0);

501 if(
	`MlmeAuthReqSy
(
pAd
, 
pEm
->
Msg
,Em->
MsgL
, 
Addr
, &
Timeout
, &
Alg
))

504 
	`RTMPClTim
(
pAuthTim
, &
TimCed
);

506 
	`COPY_MAC_ADDR
(
pAd
->
MlmeAux
.
Bssid
, 
Addr
);

507 
pAd
->
MlmeAux
.
Alg
 = Alg;

508 
Seq
 = 
SeqNo
;

509 
Stus
 = 
MLME_SUCCESS
;

511 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

512 if(
NStus
 !
NDIS_STATUS_SUCCESS
)

514 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%- MlmeAuthReqAi(Alg:%dlo memy faed\n", 
pSMName
, 
Alg
));

515 
pAd
->
Mlme
.
AuthMache
.
CuS
 = 
AUTH_REQ_IDLE
;

516 
Stus
 = 
MLME_FAIL_NO_RESOURCE
;

517 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_AUTH_CONF
, 2, &
Stus
, 0);

518  
FALSE
;

521 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%- Sd AUTHeque seq#1 (Alg=%d)...\n", 
pSMName
, 
Alg
));

522 
	`MgtMacHdIn
(
pAd
, &
AuthHdr
, 
SUBTYPE_AUTH
, 0, 
Addr
,Ad->
MlmeAux
.
Bssid
);

523 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

524 (
HEADER_802_11
),&
AuthHdr
,

525 2, &
Alg
,

526 2, &
Seq
,

527 2, &
Stus
,

528 
END_OF_ARGS
);

530 i(
pNewEmt
 && 
EmtL
)

532 
	`MakeOutgogFme
(
pOutBufr
+
FmeL
, &
tmp
,

533 
EmtL
, 
pNewEmt
,

534 
END_OF_ARGS
);

535 
FmeL
 +
tmp
;

538 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

539 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

541 
	`RTMPSTim
(
pAuthTim
, 
Timeout
);

542  
TRUE
;

546 
	`DBGPRINT_ERR
(("%- MlmeAuthReqAi(ny check faed\n", 
pSMName
));

547  
FALSE
;

550  
TRUE
;

551 
	}
}

	@sta/auth_rsp.c

37 
	~"_cfig.h
"

50 
VOID
 
	$AuthRSMacheIn
(

51 
IN
 
PRTMP_ADAPTER
 
pAd
,

52 
IN
 
PSTATE_MACHINE
 
Sm
,

53 
IN
 
STATE_MACHINE_FUNC
 
Tns
[])

55 
	`SMacheIn
(
Sm
, 
Tns
, 
MAX_AUTH_RSP_STATE
, 
MAX_AUTH_RSP_MSG
, (
STATE_MACHINE_FUNC
)
Dr
, 
AUTH_RSP_IDLE
, 
AUTH_RSP_MACHINE_BASE
);

58 
	`SMacheSAi
(
Sm
, 
AUTH_RSP_IDLE
, 
MT2_PEER_DEAUTH
, (
STATE_MACHINE_FUNC
)
PrDuthAi
);

61 
	`SMacheSAi
(
Sm
, 
AUTH_RSP_WAIT_CHAL
, 
MT2_PEER_DEAUTH
, (
STATE_MACHINE_FUNC
)
PrDuthAi
);

63 
	}
}

73 
VOID
 
	$PrAuthSimeRGAndSd
(

74 
IN
 
PRTMP_ADAPTER
 
pAd
,

75 
IN
 
PHEADER_802_11
 
pHdr80211
,

76 
IN
 
USHORT
 
Alg
,

77 
IN
 
USHORT
 
Seq
,

78 
IN
 
USHORT
 
Rs
,

79 
IN
 
USHORT
 
Stus
)

81 
HEADER_802_11
 
AuthHdr
;

82 
ULONG
 
FmeL
 = 0;

83 
PUCHAR
 
pOutBufr
 = 
NULL
;

84 
NDIS_STATUS
 
NStus
;

86 i(
Rs
 !
MLME_SUCCESS
)

88 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Peer AUTH fail...\n"));

93 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

94 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

97 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Send AUTHesponse (seq#2)...\n"));

98 
	`MgtMacHdIn
(
pAd
, &
AuthHdr
, 
SUBTYPE_AUTH
, 0, 
pHdr80211
->
Addr2
,Ad->
MlmeAux
.
Bssid
);

99 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

100 (
HEADER_802_11
), &
AuthHdr
,

101 2, &
Alg
,

102 2, &
Seq
,

103 2, &
Rs
,

104 
END_OF_ARGS
);

105 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

106 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

107 
	}
}

117 
VOID
 
	$PrDuthAi
(

118 
IN
 
PRTMP_ADAPTER
 
pAd
,

119 
IN
 
PMLME_QUEUE_ELEM
 
Em
)

121 
UCHAR
 
Addr1
[
MAC_ADDR_LEN
];

122 
UCHAR
 
Addr2
[
MAC_ADDR_LEN
];

123 
UCHAR
 
Addr3
[
MAC_ADDR_LEN
];

124 
USHORT
 
Rs
;

125 
BOOLEAN
 
bDoI
 = 
FALSE
;

127 i(
	`PrDuthSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
Addr1
, 
Addr2
, 
Addr3
, &
Rs
))

129 i(
	`INFRA_ON
(
pAd
)

130 && (
	`MAC_ADDR_EQUAL
(
Addr1
, 
pAd
->
CutAddss
|| MAC_ADDR_EQUAL(Addr1, 
BROADCAST_ADDR
))

131 && 
	`MAC_ADDR_EQUAL
(
Addr2
, 
pAd
->
CommCfg
.
Bssid
)

132 && 
	`MAC_ADDR_EQUAL
(
Addr3
, 
pAd
->
CommCfg
.
Bssid
)

135 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("AUTH_RSP -eivDE-AUTH from ouAP (Rs=%d)\n", 
Rs
));

137 i(
Rs
 =
REASON_4_WAY_TIMEOUT
)

138 
	`RTMPSdWessEvt
(
pAd
, 
IW_PAIRWISE_HS_TIMEOUT_EVENT_FLAG
, 
NULL
, 0, 0);

140 i(
Rs
 =
REASON_GROUP_KEY_HS_TIMEOUT
)

141 
	`RTMPSdWessEvt
(
pAd
, 
IW_GROUP_HS_TIMEOUT_EVENT_FLAG
, 
NULL
, 0, 0);

144 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


145 
	`RtmpOSWrssEvtSd
(
pAd
, 
SIOCGIWAP
, -1, 
NULL
, NULL, 0);

150 
	`RTMPSdWessEvt
(
pAd
, 
IW_DEAUTH_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

152 #ifde
WPA_SUPPLICANT_SUPPORT


153 i((
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
) &&

154 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
) &&

155 (
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_SECURED
))

156 
pAd
->
SCfg
.
bLoAp
 = 
TRUE
;

163 i((
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
)

164 && ((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPA2PSK
))

166 
bDoI
 = 
TRUE
;

168 
	`LkDown
(
pAd
, 
TRUE
);

170 i(
bDoI
)

172 
pAd
->
MlmeAux
.
BssIdx
++;

173 
	`IOnBssTab
(
pAd
);

180 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("AUTH_RSP - PeerDeauthAction() sanity check fail\n"));

182 
	}
}

	@sta/connect.c

37 
	~"_cfig.h
"

39 
UCHAR
 
	gChSueWNeTk
[] = {

48 
UCHAR
 
	gChSueWNeTkL
 = ((
ChSueWNeTk
) / (UCHAR));

50 
UCHAR
 
	gChSueWNeAes
[] = {

59 
UCHAR
 
	gChSueWNeAesL
 = ((
ChSueWNeAes
) / (UCHAR));

65 
	#COPY_SETTINGS_FROM_MLME_AUX_TO_ACTIVE_CFG
(
_pAd
) \

67 
	`NdisZoMemy
((
_pAd
)->
CommCfg
.
Ssid
, 
MAX_LEN_OF_SSID
); \

68 (
_pAd
)->
CommCfg
.
SsidL
 = (_pAd)->
MlmeAux
.SsidLen; \

69 
	`NdisMoveMemy
((
_pAd
)->
CommCfg
.
Ssid
, (_pAd)->
MlmeAux
.Ssid, (_pAd)->MlmeAux.
SsidL
); \

70 
	`COPY_MAC_ADDR
((
_pAd
)->
CommCfg
.
Bssid
, (_pAd)->
MlmeAux
.Bssid); \

71 (
_pAd
)->
CommCfg
.
Chl
 = (_pAd)->
MlmeAux
.Channel; \

72 (
_pAd
)->
CommCfg
.
CChl
 = (_pAd)->
MlmeAux
.CentralChannel; \

73 (
_pAd
)->
SAive
.
Aid
 = (_pAd)->
MlmeAux
.Aid; \

74 (
_pAd
)->
SAive
.
AtimW
 = (_pAd)->
MlmeAux
.AtimWin; \

75 (
_pAd
)->
SAive
.
CabyInfo
 = (_pAd)->
MlmeAux
.CapabilityInfo; \

76 (
_pAd
)->
CommCfg
.
BcPiod
 = (_pAd)->
MlmeAux
.BeaconPeriod; \

77 (
_pAd
)->
SAive
.
CMaxDuti
 = (_pAd)->
MlmeAux
.CfpMaxDuration; \

78 (
_pAd
)->
SAive
.
CPiod
 = (_pAd)->
MlmeAux
.CfpPeriod; \

79 (
_pAd
)->
SAive
.
SupReL
 = (_pAd)->
MlmeAux
.SupRateLen; \

80 
	`NdisMoveMemy
((
_pAd
)->
SAive
.
SupRe
, (_pAd)->
MlmeAux
.SupRe, (_pAd)->MlmeAux.
SupReL
);\

81 (
_pAd
)->
SAive
.
ExtReL
 = (_pAd)->
MlmeAux
.ExtRateLen; \

82 
	`NdisMoveMemy
((
_pAd
)->
SAive
.
ExtRe
, (_pAd)->
MlmeAux
.ExtRe, (_pAd)->MlmeAux.
ExtReL
);\

83 
	`NdisMoveMemy
(&(
_pAd
)->
CommCfg
.
APEdPm
, &(_pAd)->
MlmeAux
.APEdPm, (
EDCA_PARM
));\

84 
	`NdisMoveMemy
(&(
_pAd
)->
CommCfg
.
APQosCaby
, &(_pAd)->
MlmeAux
.APQosCaby, (
QOS_CAPABILITY_PARM
));\

85 
	`NdisMoveMemy
(&(
_pAd
)->
CommCfg
.
APQbssLd
, &(_pAd)->
MlmeAux
.APQbssLd, (
QBSS_LOAD_PARM
));\

86 
	`COPY_MAC_ADDR
((
_pAd
)->
MacTab
.
Cڋ
[
BSSID_WCID
].
Addr
, (_pAd)->
MlmeAux
.
Bssid
); \

87 (
_pAd
)->
MacTab
.
Cڋ
[
BSSID_WCID
].
Aid
 = (_pAd)->
MlmeAux
.Aid; \

88 (
_pAd
)->
MacTab
.
Cڋ
[
BSSID_WCID
].
PawiKey
.
ChAlg
 = (_pAd)->
SCfg
.
PaCh
;\

89 
	`COPY_MAC_ADDR
((
_pAd
)->
MacTab
.
Cڋ
[
BSSID_WCID
].
PawiKey
.
BssId
, (_pAd)->
MlmeAux
.
Bssid
);\

90 (
_pAd
)->
MacTab
.
Cڋ
[
BSSID_WCID
].
ReL
 = (_pAd)->
SAive
.
SupReL
 + (_pAd)->SAive.
ExtReL
;\

91 }

	)

101 
VOID
 
	$MlmeClIn
(

102 
IN
 
PRTMP_ADAPTER
 
pAd
,

103 
IN
 
STATE_MACHINE
 *
S
,

104 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[])

108 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

109 
	}
}

119 
VOID
 
	$MlmeClMachePfmAi
(

120 
IN
 
PRTMP_ADAPTER
 
pAd
,

121 
IN
 
STATE_MACHINE
 *
S
,

122 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

124 
pAd
->
Mlme
.
ClMache
.
CuS
)

126 
CNTL_IDLE
:

127 
	`ClIdProc
(
pAd
, 
Em
);

129 
CNTL_WAIT_DISASSOC
:

130 
	`ClWaDissocProc
(
pAd
, 
Em
);

132 
CNTL_WAIT_JOIN
:

133 
	`ClWaJoProc
(
pAd
, 
Em
);

142 
CNTL_WAIT_REASSOC
:

143 
	`ClWaRssocProc
(
pAd
, 
Em
);

146 
CNTL_WAIT_START
:

147 
	`ClWaSProc
(
pAd
, 
Em
);

149 
CNTL_WAIT_AUTH
:

150 
	`ClWaAuthProc
(
pAd
, 
Em
);

152 
CNTL_WAIT_AUTH2
:

153 
	`ClWaAuthProc2
(
pAd
, 
Em
);

155 
CNTL_WAIT_ASSOC
:

156 
	`ClWaAssocProc
(
pAd
, 
Em
);

159 
CNTL_WAIT_OID_LIST_SCAN
:

160 if(
Em
->
MsgTy
 =
MT2_SCAN_CONF
)

164 
	`RTMPResumeMsduTnsmissi
(
pAd
);

166 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

169 
pAd
->
SCfg
.
bImovedSn
 = 
FALSE
;

174 i(
pAd
->
bLedOnSg
)

176 
pAd
->
bLedOnSg
 = 
FALSE
;

177 #ifde
LED_CONTROL_SUPPORT


178 
	`RTMPSLED
(
pAd
,Ad->
LedStus
);

181 #ifde
DOT11N_DRAFT3


183 i((
pAd
->
CommCfg
.
BSSCxi2040
.
fld
.
InfoReq
 == 1) &&

184 
	`INFRA_ON
(
pAd
) &&

185 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_SCAN_2040
))

187 
	`Upde2040CxiFmeAndNify
(
pAd
, 
BSSID_WCID
, 
TRUE
);

191 #ifde
WPA_SUPPLICANT_SUPPORT


192 
	`RtmpOSWrssEvtSd
(
pAd
, 
SIOCGIWSCAN
, -1, 
NULL
, NULL, 0);

197 
CNTL_WAIT_OID_DISASSOC
:

198 i(
Em
->
MsgTy
 =
MT2_DISASSOC_CONF
)

200 
	`LkDown
(
pAd
, 
FALSE
);

201 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

205 
	`DBGPRINT_ERR
(("!ERROR! CNTL - Ieg mesgty(=%ld)", 
Em
->
MsgTy
));

208 
	}
}

219 
VOID
 
	$ClIdProc
(

220 
IN
 
PRTMP_ADAPTER
 
pAd
,

221 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

223 
MLME_DISASSOC_REQ_STRUCT
 
DissocReq
;

225 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
))

228 
Em
->
MsgTy
)

230 
OID_802_11_SSID
:

231 
	`ClOidSsidProc
(
pAd
, 
Em
);

234 
OID_802_11_BSSID
:

235 
	`ClOidRTBssidProc
(
pAd
,
Em
);

238 
OID_802_11_BSSID_LIST_SCAN
:

239 
	`ClOidSnProc
(
pAd
,
Em
);

242 
OID_802_11_DISASSOCIATE
:

243 
	`DissocPmFl
(
pAd
, &
DissocReq
,Ad->
CommCfg
.
Bssid
, 
REASON_DISASSOC_STA_LEAVING
);

244 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_MLME_DISASSOC_REQ
, (
MLME_DISASSOC_REQ_STRUCT
), &
DissocReq
, 0);

245 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_DISASSOC
;

246 #ifde
WPA_SUPPLICANT_SUPPORT


247 i((
pAd
->
SCfg
.
WSuliUP
 & 0x7F!
WPA_SUPPLICANT_ENABLE_WITH_WEB_UI
)

252 
pAd
->
MlmeAux
.
AutoRecSsidL
= 32;

253 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
AutoRecSsidL
);

257 
MT2_MLME_ROAMING_REQ
:

258 
	`ClMlmeRmgProc
(
pAd
, 
Em
);

261 
OID_802_11_MIC_FAILURE_REPORT_FRAME
:

262 
	`WMicFauRtFme
(
pAd
, 
Em
);

265 #ifde
QOS_DLS_SUPPORT


266 
RT_OID_802_11_SET_DLS_PARAM
:

267 
	`ClOidDLSSupProc
(
pAd
, 
Em
);

273 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - Ieg mesg ClIdProc(MsgTy=%ld)\n",
Em
->
MsgTy
));

276 
	}
}

278 
VOID
 
	$ClOidSnProc
(

279 
IN
 
PRTMP_ADAPTER
 
pAd
,

280 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

282 
MLME_SCAN_REQ_STRUCT
 
SnReq
;

283 
ULONG
 
BssIdx
 = 
BSS_NOT_FOUND
;

285 
BSS_ENTRY
 *
pCuBss
 = 
NULL
;

287 #ifde
RALINK_ATE


289 i(
	`ATE_ON
(
pAd
))

296 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
pCuBss
, (
BSS_ENTRY
));

297 i(
pCuBss
 =
NULL
)

299 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: Ao memy fa!!!\n", 
__FUNCTION__
));

305 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
))

307 
BssIdx
 = 
	`BssSsidTabSrch
(&
pAd
->
SnTab
,Ad->
CommCfg
.
Bssid
, (
PUCHAR
Ad->CommCfg.
Ssid
,Ad->CommCfg.
SsidL
,Ad->CommCfg.
Chl
);

308 i(
BssIdx
 !
BSS_NOT_FOUND
)

310 
	`NdisMoveMemy
(
pCuBss
, &
pAd
->
SnTab
.
BssEry
[
BssIdx
], (
BSS_ENTRY
));

315 
	`BssTabIn
(&
pAd
->
SnTab
);

316 i(
BssIdx
 !
BSS_NOT_FOUND
)

323 
	`NdisMoveMemy
(&
pAd
->
SnTab
.
BssEry
[0], 
pCuBss
, (
BSS_ENTRY
));

324 
pAd
->
SnTab
.
BssNr
 = 1;

327 
	`SnPmFl
(
pAd
, &
SnReq
, (
PSTRING

Em
->
Msg
, Em->
MsgL
, 
BSS_ANY
, 
SCAN_ACTIVE
);

328 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_SCAN_REQ
,

329 (
MLME_SCAN_REQ_STRUCT
), &
SnReq
, 0);

330 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_LIST_SCAN
;

332 i(
pCuBss
 !
NULL
)

333 
	`os__mem
(
NULL
, 
pCuBss
);

334 
	}
}

345 
VOID
 
	$ClOidSsidProc
(

346 
IN
 
PRTMP_ADAPTER
 
pAd
,

347 
IN
 
MLME_QUEUE_ELEM
 * 
Em
)

349 
PNDIS_802_11_SSID
 
pOidSsid
 = (
NDIS_802_11_SSID
 *)
Em
->
Msg
;

350 
MLME_DISASSOC_REQ_STRUCT
 
DissocReq
;

351 
ULONG
 
Now
;

355 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
Ssid
, 
MAX_LEN_OF_SSID
);

356 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
Ssid
, 
pOidSsid
->Ssid,OidSsid->
SsidLgth
);

357 
pAd
->
MlmeAux
.
SsidL
 = (
UCHAR
)
pOidSsid
->
SsidLgth
;

358 i(
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
)

359 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
Bssid
, 
MAC_ADDR_LEN
);

360 
pAd
->
MlmeAux
.
BssTy
 =Ad->
SCfg
.BssType;

362 
pAd
->
SCfg
.
bAutoCByBssid
 = 
FALSE
;

367 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
, 
MAX_LEN_OF_SSID
);

368 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
Ssid
,Ad->MlmeAux.
SsidL
);

369 
pAd
->
MlmeAux
.
AutoRecSsidL
 =Ad->MlmeAux.
SsidL
;

373 
	`BssTabSsidSt
(
pAd
, &pAd->
MlmeAux
.
SsidBssTab
, (
PCHAR
Ad->MlmeAux.
Ssid
,Ad->MlmeAux.
SsidL
);

375 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CntlOidSsidProc():CNTL - %d BSS of %d BSS matchhe desire ",

376 
pAd
->
MlmeAux
.
SsidBssTab
.
BssNr
,Ad->
SnTab
.BssNr));

377 i(
pAd
->
MlmeAux
.
SsidL
 =
MAX_LEN_OF_SSID
)

378 
	`hex_dump
("\nSSID", 
pAd
->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
);

380 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("(%d)SSID - %s\n", 
pAd
->
MlmeAux
.
SsidL
,Ad->MlmeAux.
Ssid
));

382 
	`NdisGSyemUpTime
(&
Now
);

384 i(
	`INFRA_ON
(
pAd
) &&

385 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
) &&

386 (
pAd
->
CommCfg
.
SsidL
 =pAd->
MlmeAux
.
SsidBssTab
.
BssEry
[0].SsidLen) &&

387 
	`NdisEquMemy
(
pAd
->
CommCfg
.
Ssid
,Ad->
MlmeAux
.
SsidBssTab
.
BssEry
[0].Ssid,Ad->CommCfg.
SsidL
) &&

388 
	`MAC_ADDR_EQUAL
(
pAd
->
CommCfg
.
Bssid
,Ad->
MlmeAux
.
SsidBssTab
.
BssEry
[0].Bssid))

394 i(((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
) ||

395 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

396 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
) ||

397 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
)

399 (
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
))

403 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CntlOidSsidProc():CNTL - disassociate with current AP...\n"));

404 
	`DissocPmFl
(
pAd
, &
DissocReq
,Ad->
CommCfg
.
Bssid
, 
REASON_DISASSOC_STA_LEAVING
);

405 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_MLME_DISASSOC_REQ
,

406 (
MLME_DISASSOC_REQ_STRUCT
), &
DissocReq
, 0);

407 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_DISASSOC
;

409 i(
pAd
->
bCfigChged
 =
TRUE
)

412 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CntlOidSsidProc():CNTL - disassociate with current AP Because config changed...\n"));

413 
	`DissocPmFl
(
pAd
, &
DissocReq
,Ad->
CommCfg
.
Bssid
, 
REASON_DISASSOC_STA_LEAVING
);

414 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_MLME_DISASSOC_REQ
,

415 (
MLME_DISASSOC_REQ_STRUCT
), &
DissocReq
, 0);

416 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_DISASSOC
;

421 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CntlOidSsidProc():CNTL -lready withhis BSSID. ignorehis SET_SSIDequest\n"));

426 i(
	`INFRA_ON
(
pAd
))

432 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSCed
);

433 
pAd
->
ExaInfo
 = 
GENERAL_LINK_UP
;

436 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

437 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


438 
	`RtmpOSWrssEvtSd
(
pAd
, 
SIOCGIWAP
, -1, &pAd->
MlmeAux
.
Bssid
[0], 
NULL
, 0);

442 i(
	`INFRA_ON
(
pAd
))

450 i(!
	`SSID_EQUAL
(
pAd
->
CommCfg
.
Ssid
,Ad->CommCfg.
SsidL
,Ad->
MlmeAux
.Ssid,Ad->MlmeAux.SsidLen))

455 
pAd
->
MlmeAux
.
CuReqIsFromNdis
 = 
TRUE
;

463 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CntlOidSsidProc():CNTL - disassociate with current AP...\n"));

464 
	`DissocPmFl
(
pAd
, &
DissocReq
,Ad->
CommCfg
.
Bssid
, 
REASON_DISASSOC_STA_LEAVING
);

465 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_MLME_DISASSOC_REQ
,

466 (
MLME_DISASSOC_REQ_STRUCT
), &
DissocReq
, 0);

467 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_DISASSOC
;

471 i(
	`ADHOC_ON
(
pAd
))

473 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CntlOidSsidProc():CNTL - drop current ADHOC\n"));

474 
	`LkDown
(
pAd
, 
FALSE
);

475 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

476 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSDisced
);

477 
pAd
->
ExaInfo
 = 
GENERAL_LINK_DOWN
;

478 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CntlOidSsidProc():NDIS_STATUS_MEDIA_DISCONNECT Event C!\n"));

481 i((
pAd
->
MlmeAux
.
SsidBssTab
.
BssNr
 == 0) &&

482 (
pAd
->
SCfg
.
bAutoRec
 =
TRUE
) &&

483 ((
pAd
->
MlmeAux
.
BssTy
 =
BSS_INFRA
|| (Ad->MlmeAux.BssTy =
BSS_ADHOC
&& !pAd->
SCfg
.
bNFSn
)) &&

484 (
	`MlmeVideSSID
(
pAd
->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
=
TRUE
)

487 
MLME_SCAN_REQ_STRUCT
 
SnReq
;

488 i(
pAd
->
MlmeAux
.
BssTy
 =
BSS_ADHOC
)

489 
pAd
->
SCfg
.
bNFSn
 = 
TRUE
;

490 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CntlOidSsidProc():CNTL - No matching BSS, startew scan\n"));

491 
	`BssTabIn
(&
pAd
->
SnTab
);

492 
	`SnPmFl
(
pAd
, &
SnReq
, (
PSTRING
pAd->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
, 
BSS_ANY
, 
SCAN_ACTIVE
);

493 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_SCAN_REQ
, (
MLME_SCAN_REQ_STRUCT
), &
SnReq
, 0);

494 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_LIST_SCAN
;

496 
pAd
->
SCfg
.
LaSnTime
 = 
Now
;

497 
pAd
->
SCfg
.
bNFSn
 = 
TRUE
;

502 
pAd
->
MlmeAux
.
BssIdx
 = 0;

503 
	`IOnBssTab
(
pAd
);

506 
	}
}

517 
VOID
 
	$ClOidRTBssidProc
(

518 
IN
 
PRTMP_ADAPTER
 
pAd
,

519 
IN
 
MLME_QUEUE_ELEM
 * 
Em
)

521 
ULONG
 
BssIdx
;

522 
PUCHAR
 
pOidBssid
 = (PUCHAR)
Em
->
Msg
;

523 
MLME_DISASSOC_REQ_STRUCT
 
DissocReq
;

524 
MLME_JOIN_REQ_STRUCT
 
JoReq
;

525 
PBSS_ENTRY
 
pInBss
 = 
NULL
;

527 #ifde
RALINK_ATE


529 i(
	`ATE_ON
(
pAd
))

534 
	`COPY_MAC_ADDR
(
pAd
->
MlmeAux
.
Bssid
, 
pOidBssid
);

535 
pAd
->
MlmeAux
.
BssTy
 =Ad->
SCfg
.BssType;

538 
BssIdx
 = 
	`BssTabSrch
(&
pAd
->
SnTab
, 
pOidBssid
,Ad->
MlmeAux
.
Chl
);

540 #ifde
WPA_SUPPLICANT_SUPPORT


541 i(
pAd
->
SCfg
.
WSuliUP
 & 
WPA_SUPPLICANT_ENABLE_WPS
)

547 
pInBss
 = &
pAd
->
SnTab
.
BssEry
[
BssIdx
];

549 i(
	`SSID_EQUAL
(
pAd
->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
, 
pInBss
->Ssid,InBss->SsidL=
FALSE
)

550 
BssIdx
 = 
BSS_NOT_FOUND
;

552 i(
pAd
->
SCfg
.
AuthMode
 <
Ndis802_11AuthModeAutoSwch
)

554 i(
pAd
->
SCfg
.
WStus
 !
pInBss
->WepStatus)

555 
BssIdx
 = 
BSS_NOT_FOUND
;

560 i((
pAd
->
SCfg
.
AuthMode
 !
pInBss
->AuthMode) &&

561 (
pAd
->
SCfg
.
AuthMode
 !
pInBss
->
AuthModeAux
))

562 
BssIdx
 = 
BSS_NOT_FOUND
;

566 i(
BssIdx
 =
BSS_NOT_FOUND
)

569 i((
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
) ||

570 (
pAd
->
SCfg
.
bNFSn
 =
FALSE
))

572 
MLME_SCAN_REQ_STRUCT
 
SnReq
;

574 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - BSSIDot found.eply NDIS_STATUS_NOT_ACCEPTED\n"));

575 i(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
)

576 
pAd
->
SCfg
.
bNFSn
 = 
TRUE
;

578 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - BSSIDot found. startew scan\n"));

579 
	`BssTabIn
(&
pAd
->
SnTab
);

580 
	`SnPmFl
(
pAd
, &
SnReq
, (
PSTRING
pAd->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
, 
BSS_ANY
, 
SCAN_ACTIVE
);

581 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_SCAN_REQ
, (
MLME_SCAN_REQ_STRUCT
), &
SnReq
, 0);

582 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_LIST_SCAN
;

584 
	`NdisGSyemUpTime
(&
pAd
->
SCfg
.
LaSnTime
);

588 
MLME_START_REQ_STRUCT
 
SReq
;

589 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - BSSID found. sew ADHOC (Ssid=%s)...\n",
pAd
->
MlmeAux
.
Ssid
));

590 
	`SPmFl
(
pAd
, &
SReq
, (
PCHAR
Ad->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
);

591 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_START_REQ
, (
MLME_START_REQ_STRUCT
), &
SReq
, 0);

593 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_START
;

598 
pInBss
 = &
pAd
->
SnTab
.
BssEry
[
BssIdx
];

602 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
, 
MAX_LEN_OF_SSID
);

603 
pAd
->
MlmeAux
.
AutoRecSsidL
 = 
pInBss
->
SsidL
;

604 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
, 
pInBss
->
Ssid
,InBss->
SsidL
);

608 
pAd
->
MlmeAux
.
BssIdx
 = 0;

609 
pAd
->
MlmeAux
.
SsidBssTab
.
BssNr
 = 1;

610 
	`NdisMoveMemy
(&
pAd
->
MlmeAux
.
SsidBssTab
.
BssEry
[0], 
pInBss
, (
BSS_ENTRY
));

613 i(
	`INFRA_ON
(
pAd
))

616 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - disassociate with current AP ...\n"));

617 
	`DissocPmFl
(
pAd
, &
DissocReq
,Ad->
CommCfg
.
Bssid
, 
REASON_DISASSOC_STA_LEAVING
);

618 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_MLME_DISASSOC_REQ
,

619 (
MLME_DISASSOC_REQ_STRUCT
), &
DissocReq
, 0);

621 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_DISASSOC
;

625 i(
	`ADHOC_ON
(
pAd
))

627 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - drop current ADHOC\n"));

628 
	`LkDown
(
pAd
, 
FALSE
);

629 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

630 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSDisced
);

631 
pAd
->
ExaInfo
 = 
GENERAL_LINK_DOWN
;

632 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("NDIS_STATUS_MEDIA_DISCONNECT Event C!\n"));

635 
pInBss
 = &
pAd
->
MlmeAux
.
SsidBssTab
.
BssEry
[0];

637 
pAd
->
SCfg
.
PaCh
 =Ad->SCfg.
WStus
;

638 
pAd
->
SCfg
.
GroupCh
 =Ad->SCfg.
WStus
;

643 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPAPSK
))

645 
pAd
->
SCfg
.
GroupCh
 = 
pInBss
->
WPA
.GroupCipher;

647 i(
pAd
->
SCfg
.
WStus
 =
pInBss
->
WPA
.
PaCh
)

648 
pAd
->
SCfg
.
PaCh
 = 
pInBss
->
WPA
.PairCipher;

649 i(
pInBss
->
WPA
.
PaChAux
 !
Ndis802_11WEPDibd
)

650 
pAd
->
SCfg
.
PaCh
 = 
pInBss
->
WPA
.
PaChAux
;

652 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11Enyi2Ebd
;

654 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPA2PSK
))

656 
pAd
->
SCfg
.
GroupCh
 = 
pInBss
->
WPA2
.GroupCipher;

658 i(
pAd
->
SCfg
.
WStus
 =
pInBss
->
WPA2
.
PaCh
)

659 
pAd
->
SCfg
.
PaCh
 = 
pInBss
->
WPA2
.PairCipher;

660 i(
pInBss
->
WPA2
.
PaChAux
 !
Ndis802_11WEPDibd
)

661 
pAd
->
SCfg
.
PaCh
 = 
pInBss
->
WPA2
.
PaChAux
;

663 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11Enyi2Ebd
;

666 
pAd
->
SCfg
.
RCaby
 = 
pInBss
->
WPA2
.RsnCapability;

670 
pAd
->
SCfg
.
bMixCh
 = (pAd->SCfg.
PaCh
 =pAd->SCfg.
GroupCh
? 
FALSE
 : 
TRUE
;

674 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - joining %02x:%02x:%02x:%02x:%02x:%02x ...\n",

675 
pOidBssid
[0],pOidBssid[1],pOidBssid[2],pOidBssid[3],pOidBssid[4],pOidBssid[5]));

677 
	`JoPmFl
(
pAd
, &
JoReq
,Ad->
MlmeAux
.
BssIdx
);

678 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_JOIN_REQ
, (
MLME_JOIN_REQ_STRUCT
), &
JoReq
, 0);

680 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_JOIN
;

683 
	}
}

693 
VOID
 
	$ClMlmeRmgProc
(

694 
IN
 
PRTMP_ADAPTER
 
pAd
,

695 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

697 
UCHAR
 
BBPVue
 = 0;

699 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("CNTL - Roaming in MlmeAux.RoamTab...\n"));

703 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BBPVue
);

704 
BBPVue
 &= (~0x18);

705 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BBPVue
);

707 
	`NdisMoveMemy
(&
pAd
->
MlmeAux
.
SsidBssTab
, &pAd->MlmeAux.
RmTab
, (pAd->MlmeAux.RoamTab));

708 
pAd
->
MlmeAux
.
SsidBssTab
.
BssNr
 =Ad->MlmeAux.
RmTab
.BssNr;

710 
	`BssTabStByRssi
(&
pAd
->
MlmeAux
.
SsidBssTab
);

711 
pAd
->
MlmeAux
.
BssIdx
 = 0;

712 
	`IOnBssTab
(
pAd
);

714 
	}
}

716 #ifde
QOS_DLS_SUPPORT


725 
VOID
 
	$ClOidDLSSupProc
(

726 
IN
 
PRTMP_ADAPTER
 
pAd
,

727 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

729 
PRT_802_11_DLS
 
pDLS
 = (PRT_802_11_DLS)
Em
->
Msg
;

730 
MLME_DLS_REQ_STRUCT
 
MlmeDlsReq
;

731 
INT
 
i
;

732 
USHORT
 
as
 = 
REASON_UNSPECIFY
;

734 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("CNTL - (OID set %02x:%02x:%02x:%02x:%02x:%02x with Valid=%d, Status=%d, TimeOut=%d, CountDownTimer=%d)\n",

735 
pDLS
->
MacAddr
[0],DLS->MacAddr[1],DLS->MacAddr[2],DLS->MacAddr[3],DLS->MacAddr[4],DLS->MacAddr[5],

736 
pDLS
->
Vid
,DLS->
Stus
,DLS->
TimeOut
,DLS->
CouDownTim
));

738 i(!
pAd
->
CommCfg
.
bDLSCab
)

742 i(
	`INFRA_ON
(
pAd
))

744 
i
 = 0; i < 
MAX_NUM_OF_DLS_ENTRY
; i++)

746 i(
pDLS
->
Vid
 && 
pAd
->
SCfg
.
DLSEry
[
i
].Vid && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
) &&

747 (
pDLS
->
TimeOut
 =
pAd
->
SCfg
.
DLSEry
[
i
].TimeOut&& 
	`MAC_ADDR_EQUAL
DLS->
MacAddr
,Ad->StaCfg.DLSEntry[i].MacAddr))

750 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("CNTL - setting unchanged\n"));

753 i(!
pDLS
->
Vid
 && 
pAd
->
SCfg
.
DLSEry
[
i
].Vid && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
) &&

754 
	`MAC_ADDR_EQUAL
(
pDLS
->
MacAddr
, 
pAd
->
SCfg
.
DLSEry
[
i
].MacAddr))

757 
as
 = 
REASON_QOS_UNWANTED_MECHANISM
;

758 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

759 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

760 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

761 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_TEAR_DOWN
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

762 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("CNTL - startear downrocedure\n"));

765 i((
i
 < 
MAX_NUM_OF_DLS_ENTRY
&& 
pDLS
->
Vid
 && !
pAd
->
SCfg
.
DLSEry
[i].Valid)

768 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
DLSEry
[
i
], 
pDLS
, (
RT_802_11_DLS_UI
));

771 
pAd
->
SCfg
.
DLSEry
[
i
].
CouDownTim
 =Ad->SCfg.DLSEry[i].
TimeOut
;

772 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

773 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_REQ
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

774 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("CNTL - DLS setup case\n"));

777 i((
i
 < 
MAX_NUM_OF_DLS_ENTRY
&& 
pDLS
->
Vid
 && 
pAd
->
SCfg
.
DLSEry
[i].Valid &&

778 (
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 =
DLS_FINISH
&& !
	`MAC_ADDR_EQUAL
(
pDLS
->
MacAddr
,Ad->StaCfg.DLSEntry[i].MacAddr))

781 
as
 = 
REASON_QOS_UNWANTED_MECHANISM
;

782 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

783 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

784 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

785 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_TEAR_DOWN
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

786 
	`NdisMoveMemy
(&
pAd
->
SCfg
.
DLSEry
[
i
], 
pDLS
, (
RT_802_11_DLS_UI
));

787 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

788 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_REQ
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

789 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("CNTL - DLSear downndestart case\n"));

792 i(
pDLS
->
Vid
 && 
pAd
->
SCfg
.
DLSEry
[
i
].Valid &&

793 
	`MAC_ADDR_EQUAL
(
pDLS
->
MacAddr
, 
pAd
->
SCfg
.
DLSEry
[
i
].MacAddr&& (pAd->SCfg.DLSEry[i].
TimeOut
 !=DLS->TimeOut))

796 
pAd
->
SCfg
.
DLSEry
[
i
].
TimeOut
 = 
pDLS
->TimeOut;

798 
pAd
->
SCfg
.
DLSEry
[
i
].
CouDownTim
 =Ad->SCfg.DLSEry[i].
TimeOut
;

799 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

800 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_REQ
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

801 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("CNTL - DLS updateimeout case\n"));

804 i(
pDLS
->
Vid
 && 
pAd
->
SCfg
.
DLSEry
[
i
].Valid &&

805 (
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 !
DLS_FINISH
&& 
	`MAC_ADDR_EQUAL
(
pDLS
->
MacAddr
,Ad->StaCfg.DLSEntry[i].MacAddr))

808 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

809 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_REQ
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

810 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("CNTL - DLSetry setuprocedure\n"));

815 
	`DBGPRINT
(
RT_DEBUG_WARN
,("CNTL - DLSot changed inntry - %d - Valid=%d, Status=%d, TimeOut=%d\n",

816 
i
, 
pAd
->
SCfg
.
DLSEry
[i].
Vid
,Ad->SCfg.DLSEry[i].
Stus
,Ad->SCfg.DLSEry[i].
TimeOut
));

820 
	}
}

831 
VOID
 
	$ClWaDissocProc
(

832 
IN
 
PRTMP_ADAPTER
 
pAd
,

833 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

835 
MLME_START_REQ_STRUCT
 
SReq
;

837 i(
Em
->
MsgTy
 =
MT2_DISASSOC_CONF
)

839 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - Dis-associate successful\n"));

841 
	`RTMPSdWessEvt
(
pAd
, 
IW_DISASSOC_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

843 
	`LkDown
(
pAd
, 
FALSE
);

846 i((
pAd
->
MlmeAux
.
SsidBssTab
.
BssNr
==0&& (pAd->
SCfg
.
BssTy
 =
BSS_ADHOC
))

848 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - Nmchg BSS, sew ADHOC (Ssid=%s)...\n",
pAd
->
MlmeAux
.
Ssid
));

849 
	`SPmFl
(
pAd
, &
SReq
, (
PCHAR
Ad->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
);

850 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_START_REQ
, (
MLME_START_REQ_STRUCT
), &
SReq
, 0);

851 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_START
;

856 
pAd
->
MlmeAux
.
BssIdx
 = 0;

858 
	`IOnBssTab
(
pAd
);

861 
	}
}

871 
VOID
 
	$ClWaJoProc
(

872 
IN
 
PRTMP_ADAPTER
 
pAd
,

873 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

875 
USHORT
 
Rs
;

876 
MLME_AUTH_REQ_STRUCT
 
AuthReq
;

878 i(
Em
->
MsgTy
 =
MT2_JOIN_CONF
)

880 
	`NdisMoveMemy
(&
Rs
, 
Em
->
Msg
, (
USHORT
));

881 i(
Rs
 =
MLME_SUCCESS
)

884 i(
pAd
->
MlmeAux
.
BssTy
 =
BSS_ADHOC
)

890 i(
pAd
->
CommCfg
.
bIEEE80211H
 == 1) &&

891 
	`RadChlCheck
(
pAd
,Ad->
CommCfg
.
Chl
)

894 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

895 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - Chl=%d, Jodho W53(52,56,60,64Chlnهced\n", 
pAd
->
CommCfg
.
Chl
));

899 
	`LkUp
(
pAd
, 
BSS_ADHOC
);

900 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

901 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - joinhe IBSS = %02x:%02x:%02x:%02x:%02x:%02x ...\n",

902 
pAd
->
CommCfg
.
Bssid
[0],pAd->CommonCfg.Bssid[1],pAd->CommonCfg.Bssid[2],

903 
pAd
->
CommCfg
.
Bssid
[3],pAd->CommonCfg.Bssid[4],pAd->CommonCfg.Bssid[5]));

905 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSCed
);

906 
pAd
->
ExaInfo
 = 
GENERAL_LINK_UP
;

908 
	`RTMPSdWessEvt
(
pAd
, 
IW_JOIN_IBSS_FLAG
, 
NULL
, 
BSS0
, 0);

915 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeShed
) ||

916 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeAutoSwch
))

918 
	`AuthPmFl
(
pAd
, &
AuthReq
,Ad->
MlmeAux
.
Bssid
, 
AUTH_MODE_KEY
);

922 
	`AuthPmFl
(
pAd
, &
AuthReq
,Ad->
MlmeAux
.
Bssid
, 
AUTH_MODE_OPEN
);

924 
	`MlmeEnqueue
(
pAd
, 
AUTH_STATE_MACHINE
, 
MT2_MLME_AUTH_REQ
,

925 (
MLME_AUTH_REQ_STRUCT
), &
AuthReq
, 0);

928 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_AUTH
;

934 
pAd
->
MlmeAux
.
BssIdx
++;

935 
	`IOnBssTab
(
pAd
);

938 
	}
}

949 
VOID
 
	$ClWaSProc
(

950 
IN
 
PRTMP_ADAPTER
 
pAd
,

951 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

953 
USHORT
 
Resu
;

955 i(
Em
->
MsgTy
 =
MT2_START_CONF
)

957 
	`NdisMoveMemy
(&
Resu
, 
Em
->
Msg
, (
USHORT
));

958 i(
Resu
 =
MLME_SUCCESS
)

964 i(
pAd
->
CommCfg
.
bIEEE80211H
 == 1) &&

965 
	`RadChlCheck
(
pAd
,Ad->
CommCfg
.
Chl
)

968 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

969 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - Chl=%d, Sdho W53(52,56,60,64Chlnهced\n", 
pAd
->
CommCfg
.
Chl
));

972 #ifde
DOT11_N_SUPPORT


973 
	`NdisZoMemy
(&
pAd
->
SAive
.
Su܋dPhyInfo
.
MCSS
[0], 16);

974 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
) &&

975 (
pAd
->
SCfg
.
bAdhocN
 =
TRUE
) &&

976 (!
pAd
->
CommCfg
.
HT_DiowTKIP
 || !
	`IS_INVALID_HT_SECURITY
Ad->
SCfg
.
WStus
)))

978 
	`N_ChlCheck
(
pAd
);

979 
	`SCommHT
(
pAd
);

980 i((
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
) &&

981 (
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
ExtChOfft
 =
EXTCHA_ABOVE
))

983 
pAd
->
MlmeAux
.
CChl
 =Ad->
CommCfg
.
Chl
 + 2;

985 i((
pAd
->
CommCfg
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
) &&

986 (
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo
.
ExtChOfft
 =
EXTCHA_BELOW
))

988 
pAd
->
MlmeAux
.
CChl
 =Ad->
CommCfg
.
Chl
 - 2;

990 
	`NdisMoveMemy
(&
pAd
->
MlmeAux
.
AddHtInfo
, &pAd->
CommCfg
.
AddHTInfo
, (
ADD_HT_INFO_IE
));

991 
	`RTMPCheckHt
(
pAd
, 
BSSID_WCID
, &pAd->
CommCfg
.
HtCaby
, &pAd->CommCfg.
AddHTInfo
);

992 
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 = 
TRUE
;

993 
	`NdisMoveMemy
(&
pAd
->
SAive
.
Su܋dPhyInfo
.
MCSS
[0], &pAd->
CommCfg
.
HtCaby
.MCSSet[0], 16);

994 
	`COPY_HTSETTINGS_FROM_MLME_AUX_TO_ACTIVE_CFG
(
pAd
);

999 
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 = 
FALSE
;

1001 
pAd
->
SCfg
.
bAdhocC
 = 
TRUE
;

1002 
	`LkUp
(
pAd
, 
BSS_ADHOC
);

1003 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

1005 i((
pAd
->
CommCfg
.
Chl
 > 14 )

1006 && (
pAd
->
CommCfg
.
bIEEE80211H
 == 1)

1007 && 
	`RadChlCheck
(
pAd
,Ad->
CommCfg
.
Chl
))

1009 
pAd
->
CommCfg
.
RadDe
.
RDMode
 = 
RD_SILENCE_MODE
;

1010 
pAd
->
CommCfg
.
RadDe
.
RDCou
 = 0;

1011 #ifde
DFS_SUPPORT


1012 #ifde
DFS_SOFTWARE_SUPPORT


1013 
	`BbpRadDeiS
(
pAd
);

1017 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - startew IBSS = %02x:%02x:%02x:%02x:%02x:%02x ...\n",

1018 
pAd
->
CommCfg
.
Bssid
[0],pAd->CommonCfg.Bssid[1],pAd->CommonCfg.Bssid[2],

1019 
pAd
->
CommCfg
.
Bssid
[3],pAd->CommonCfg.Bssid[4],pAd->CommonCfg.Bssid[5]));

1021 
	`RTMPSdWessEvt
(
pAd
, 
IW_START_IBSS_FLAG
, 
NULL
, 
BSS0
, 0);

1025 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - Start IBSS fail. BUG!!!!!\n"));

1026 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

1029 
	}
}

1039 
VOID
 
	$ClWaAuthProc
(

1040 
IN
 
PRTMP_ADAPTER
 
pAd
,

1041 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1043 
USHORT
 
Rs
;

1044 
MLME_ASSOC_REQ_STRUCT
 
AssocReq
;

1045 
MLME_AUTH_REQ_STRUCT
 
AuthReq
;

1047 i(
Em
->
MsgTy
 =
MT2_AUTH_CONF
)

1049 
	`NdisMoveMemy
(&
Rs
, 
Em
->
Msg
, (
USHORT
));

1050 i(
Rs
 =
MLME_SUCCESS
)

1052 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - AUTH OK\n"));

1053 
	`AssocPmFl
(
pAd
, &
AssocReq
,Ad->
MlmeAux
.
Bssid
,Ad->MlmeAux.
CabyInfo
,

1054 
ASSOC_TIMEOUT
, 
pAd
->
SCfg
.
DeuLiCou
);

1057 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_MLME_ASSOC_REQ
,

1058 (
MLME_ASSOC_REQ_STRUCT
), &
AssocReq
, 0);

1060 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_ASSOC
;

1068 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - AUTH FAIL,rygain...\n"));

1070 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeShed
) ||

1071 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeAutoSwch
))

1074 
	`AuthPmFl
(
pAd
, &
AuthReq
,Ad->
MlmeAux
.
Bssid
, 
AUTH_MODE_KEY
);

1078 
	`AuthPmFl
(
pAd
, &
AuthReq
,Ad->
MlmeAux
.
Bssid
, 
AUTH_MODE_OPEN
);

1080 
	`MlmeEnqueue
(
pAd
, 
AUTH_STATE_MACHINE
, 
MT2_MLME_AUTH_REQ
,

1081 (
MLME_AUTH_REQ_STRUCT
), &
AuthReq
, 0);

1084 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_AUTH2
;

1087 
	}
}

1097 
VOID
 
	$ClWaAuthProc2
(

1098 
IN
 
PRTMP_ADAPTER
 
pAd
,

1099 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1101 
USHORT
 
Rs
;

1102 
MLME_ASSOC_REQ_STRUCT
 
AssocReq
;

1103 
MLME_AUTH_REQ_STRUCT
 
AuthReq
;

1105 i(
Em
->
MsgTy
 =
MT2_AUTH_CONF
)

1107 
	`NdisMoveMemy
(&
Rs
, 
Em
->
Msg
, (
USHORT
));

1108 i(
Rs
 =
MLME_SUCCESS
)

1110 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - AUTH OK\n"));

1111 
	`AssocPmFl
(
pAd
, &
AssocReq
,Ad->
MlmeAux
.
Bssid
,Ad->MlmeAux.
CabyInfo
,

1112 
ASSOC_TIMEOUT
, 
pAd
->
SCfg
.
DeuLiCou
);

1114 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_MLME_ASSOC_REQ
,

1115 (
MLME_ASSOC_REQ_STRUCT
), &
AssocReq
, 0);

1117 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_ASSOC
;

1122 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeAutoSwch
) &&

1123 (
pAd
->
MlmeAux
.
Alg
 =
Ndis802_11AuthModeShed
))

1125 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - AUTH FAIL,ry OPEN system...\n"));

1126 
	`AuthPmFl
(
pAd
, &
AuthReq
,Ad->
MlmeAux
.
Bssid
, 
Ndis802_11AuthModeOn
);

1127 
	`MlmeEnqueue
(
pAd
, 
AUTH_STATE_MACHINE
, 
MT2_MLME_AUTH_REQ
,

1128 (
MLME_AUTH_REQ_STRUCT
), &
AuthReq
, 0);

1130 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_AUTH2
;

1135 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - AUTH FAIL, give up;ryext BSS\n"));

1136 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

1137 
pAd
->
MlmeAux
.
BssIdx
++;

1138 
	`IOnBssTab
(
pAd
);

1142 
	}
}

1152 
VOID
 
	$ClWaAssocProc
(

1153 
IN
 
PRTMP_ADAPTER
 
pAd
,

1154 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1156 
USHORT
 
Rs
;

1158 i(
Em
->
MsgTy
 =
MT2_ASSOC_CONF
)

1160 
	`NdisMoveMemy
(&
Rs
, 
Em
->
Msg
, (
USHORT
));

1161 i(
Rs
 =
MLME_SUCCESS
)

1163 
	`RTMPSdWessEvt
(
pAd
, 
IW_ASSOC_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

1165 
	`LkUp
(
pAd
, 
BSS_INFRA
);

1166 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

1167 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - Assocti sucssfu BSS #%ld\n",
pAd
->
MlmeAux
.
BssIdx
));

1172 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - Assocti fa BSS #%ld\n",
pAd
->
MlmeAux
.
BssIdx
));

1173 
pAd
->
MlmeAux
.
BssIdx
++;

1174 
	`IOnBssTab
(
pAd
);

1177 
	}
}

1187 
VOID
 
	$ClWaRssocProc
(

1188 
IN
 
PRTMP_ADAPTER
 
pAd
,

1189 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1191 
USHORT
 
Resu
;

1193 i(
Em
->
MsgTy
 =
MT2_REASSOC_CONF
)

1195 
	`NdisMoveMemy
(&
Resu
, 
Em
->
Msg
, (
USHORT
));

1196 i(
Resu
 =
MLME_SUCCESS
)

1199 
	`RTMPSdWessEvt
(
pAd
, 
IW_ASSOC_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

1205 
	`LkUp
(
pAd
, 
BSS_INFRA
);

1207 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

1208 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - Re-associ sucssfu BSS #%ld\n", 
pAd
->
MlmeAux
.
RmIdx
));

1213 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - Re-associ fa BSS #%ld\n", 
pAd
->
MlmeAux
.
RmIdx
));

1215 
pAd
->
MlmeAux
.
RmIdx
++;

1216 
	`IOnBssTab2
(
pAd
);

1220 
	}
}

1223 
VOID
 
	$AdhocTuOnQos
(

1224 
IN
 
PRTMP_ADAPTER
 
pAd
)

1226 
	#AC0_DEF_TXOP
 0

	)

1227 
	#AC1_DEF_TXOP
 0

	)

1228 
	#AC2_DEF_TXOP
 94

	)

1229 
	#AC3_DEF_TXOP
 47

	)

1232 i(
pAd
->
CommCfg
.
APEdPm
.
bVid
 =
FALSE
)

1234 
pAd
->
CommCfg
.
APEdPm
.
bVid
 = 
TRUE
;

1235 
pAd
->
CommCfg
.
APEdPm
.
Aif
[0] = 3;

1236 
pAd
->
CommCfg
.
APEdPm
.
Aif
[1] = 7;

1237 
pAd
->
CommCfg
.
APEdPm
.
Aif
[2] = 1;

1238 
pAd
->
CommCfg
.
APEdPm
.
Aif
[3] = 1;

1240 
pAd
->
CommCfg
.
APEdPm
.
Cwm
[0] = 4;

1241 
pAd
->
CommCfg
.
APEdPm
.
Cwm
[1] = 4;

1242 
pAd
->
CommCfg
.
APEdPm
.
Cwm
[2] = 3;

1243 
pAd
->
CommCfg
.
APEdPm
.
Cwm
[3] = 2;

1245 
pAd
->
CommCfg
.
APEdPm
.
Cwmax
[0] = 10;

1246 
pAd
->
CommCfg
.
APEdPm
.
Cwmax
[1] = 6;

1247 
pAd
->
CommCfg
.
APEdPm
.
Cwmax
[2] = 4;

1248 
pAd
->
CommCfg
.
APEdPm
.
Cwmax
[3] = 3;

1250 
pAd
->
CommCfg
.
APEdPm
.
Tx
[0] = 0;

1251 
pAd
->
CommCfg
.
APEdPm
.
Tx
[1] = 0;

1252 
pAd
->
CommCfg
.
APEdPm
.
Tx
[2] = 
AC2_DEF_TXOP
;

1253 
pAd
->
CommCfg
.
APEdPm
.
Tx
[3] = 
AC3_DEF_TXOP
;

1255 
	`AsicSEdPm
(
pAd
, &pAd->
CommCfg
.
APEdPm
);

1256 
	}
}

1266 
VOID
 
	$LkUp
(

1267 
IN
 
PRTMP_ADAPTER
 
pAd
,

1268 
IN
 
UCHAR
 
BssTy
)

1270 
ULONG
 
Now
;

1271 
UINT32
 
Da
;

1272 
BOOLEAN
 
Ced
;

1273 
UCHAR
 
Vue
 = 0, 
idx
 = 0, 
HashIdx
 = 0;

1274 
MAC_TABLE_ENTRY
 *
pEry
 = 
NULL
, *
pCuEry
 = NULL;

1277 
pAd
->
Mlme
.
ChlQuy
 = 50;

1280 
pAd
->
SCfg
.
bImovedSn
 = 
FALSE
;

1281 
pAd
->
SCfg
.
bNFSn
 = 
TRUE
;

1282 
pAd
->
SCfg
.
bAutoCByBssid
 = 
FALSE
;

1284 
pEry
 = 
	`MacTabLookup
(
pAd
,Ad->
CommCfg
.
Bssid
);

1285 i(
pEry
)

1287 
	`MacTabDeEry
(
pAd
, 
pEry
->
Aid
,Ery->
Addr
);

1288 
pEry
 = 
NULL
;

1292 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
];

1303 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
DissocTim
, &
Ced
);

1305 
	`COPY_SETTINGS_FROM_MLME_AUX_TO_ACTIVE_CFG
(
pAd
);

1307 #ifde
DOT11_N_SUPPORT


1308 
	`COPY_HTSETTINGS_FROM_MLME_AUX_TO_ACTIVE_CFG
(
pAd
);

1311 i(
BssTy
 =
BSS_ADHOC
)

1313 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_ADHOC_ON
);

1314 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_INFRA_ON
);

1316 #ifde
CARRIER_DETECTION_SUPPORT


1319 
pAd
->
CommCfg
.
CrrDe
.
CD_S
 = 
CD_NORMAL
;

1322 #ifde
DOT11_N_SUPPORT


1323 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
&& (pAd->
SCfg
.
bAdhocN
 =
TRUE
))

1324 
	`AdhocTuOnQos
(
pAd
);

1327 
	`InChlRedVue
(
pAd
);

1329 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!Adhoc LINK UP !!! \n" ));

1333 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_INFRA_ON
);

1334 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_ADHOC_ON
);

1336 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!Infra LINK UP !!! \n" ));

1339 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! LINK UP !!! (BssType=%d, AID=%d, ssid=%s, Channel=%d, CentralChannel = %d)\n",

1340 
BssTy
, 
pAd
->
SAive
.
Aid
,Ad->
CommCfg
.
Ssid
,Ad->CommCfg.
Chl
,Ad->CommCfg.
CChl
));

1342 #ifde
DOT11_N_SUPPORT


1343 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! LINK UP !!! (Dsy =%d, )\n", 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
MpduDsy
));

1346 
	`AsicSBssid
(
pAd
,Ad->
CommCfg
.
Bssid
);

1349 
	`AsicSSlTime
(
pAd
, 
TRUE
);

1350 
	`AsicSEdPm
(
pAd
, &pAd->
CommCfg
.
APEdPm
);

1354 
	`AsicUpdePre
(
pAd
, 0, (
OFDMSETPROTECT
 | 
CCKSETPROTECT
), 
TRUE
, 
FALSE
);

1356 #ifde
DOT11_N_SUPPORT


1357 i((
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 =
TRUE
))

1360 i(
pAd
->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
NGfP
 == 1)

1362 
	`AsicUpdePre
(
pAd
,Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
, 
ALLN_SETPROTECT
, 
FALSE
, 
TRUE
);

1365 
	`AsicUpdePre
(
pAd
,Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
, 
ALLN_SETPROTECT
, 
FALSE
, FALSE);

1369 
	`NdisZoMemy
(&
pAd
->
DrsCous
, (
COUNTER_DRS
));

1371 
	`NdisGSyemUpTime
(&
Now
);

1372 
pAd
->
SCfg
.
LaBcRxTime
 = 
Now
;

1374 i((
pAd
->
CommCfg
.
TxPamb
 !
Rt802_11PambLg
) &&

1375 
	`CAP_IS_SHORT_PREAMBLE_ON
(
pAd
->
SAive
.
CabyInfo
))

1377 
	`MlmeSTxPamb
(
pAd
, 
Rt802_11PambSht
);

1380 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_AGGREGATION_INUSED
);

1382 i(
pAd
->
CommCfg
.
RadDe
.
RDMode
 =
RD_SILENCE_MODE
)

1384 #ifde
DFS_SUPPORT


1385 #ifde
DFS_SOFTWARE_SUPPORT


1386 
	`RadDeiSt
(
pAd
);

1390 
pAd
->
CommCfg
.
RadDe
.
RDMode
 = 
RD_NORMAL_MODE
;

1392 i(
BssTy
 =
BSS_ADHOC
)

1394 
	`MakeIbssBc
(
pAd
);

1395 i((
pAd
->
CommCfg
.
Chl
 > 14)

1396 && (
pAd
->
CommCfg
.
bIEEE80211H
 == 1)

1397 && 
	`RadChlCheck
(
pAd
,Ad->
CommCfg
.
Chl
))

1403 
	`AsicEbIbssSync
(
pAd
);

1408 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_WCID_BASE
, 0x00);

1409 
	`RTMP_IO_WRITE32
(
pAd
, 0x1808, 0x00);

1414 i(
pAd
->
SCfg
.
WStus
 =
Ndis802_11WEPEbd
)

1416 
UCHAR
 
ChAlg
;

1418 
idx
=0; idx < 
SHARE_KEY_NUM
; idx++)

1420 
ChAlg
 = 
pAd
->
ShedKey
[
BSS0
][
idx
].CipherAlg;

1422 i(
pAd
->
ShedKey
[
BSS0
][
idx
].
KeyL
 > 0)

1425 
	`AsicAddShedKeyEry
(
pAd
, 
BSS0
, 
idx
, &pAd->
ShedKey
[BSS0][idx]);

1427 i(
idx
 =
pAd
->
SCfg
.
DeuKeyId
)

1429 
INT
 
t
;

1432 
t
 = 0; c < 
LEN_WEP_TSC
; cnt++)

1433 
pAd
->
ShedKey
[
BSS0
][
idx
].
TxTsc
[
t
] = 
	`RdomBy
(pAd);

1436 
	`RTMPSWcidSecuryInfo
(
pAd
,

1437 
BSS0
,

1438 
idx
,

1439 
ChAlg
,

1440 
MCAST_WCID
,

1441 
SHAREDKEYTABLE
);

1450 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPANe
)

1452 
pAd
->
SCfg
.
DeuKeyId
 = 0;

1454 
	`NdisZoMemy
(&
pAd
->
ShedKey
[
BSS0
][0], (
CIPHER_KEY
));

1455 
pAd
->
ShedKey
[
BSS0
][0].
KeyL
 = 
LEN_TK
;

1456 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][0].
Key
,Ad->
SCfg
.
PMK
, 
LEN_TK
);

1458 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi2Ebd
)

1460 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][0].
RxMic
, &pAd->
SCfg
.
PMK
[16], 
LEN_TKIP_MIC
);

1461 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][0].
TxMic
, &pAd->
SCfg
.
PMK
[16], 
LEN_TKIP_MIC
);

1465 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi2Ebd
)

1466 
pAd
->
ShedKey
[
BSS0
][0].
ChAlg
 = 
CIPHER_TKIP
;

1467 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi3Ebd
)

1468 
pAd
->
ShedKey
[
BSS0
][0].
ChAlg
 = 
CIPHER_AES
;

1471 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Unknow Ch (=%d), s ChAES\n", 
pAd
->
SCfg
.
PaCh
));

1472 
pAd
->
ShedKey
[
BSS0
][0].
ChAlg
 = 
CIPHER_AES
;

1476 
	`AsicAddShedKeyEry
(
pAd
,

1477 
BSS0
,

1479 &
pAd
->
ShedKey
[
BSS0
][0]);

1482 
	`RTMPSWcidSecuryInfo
(
pAd
,

1483 
BSS0
,

1485 
pAd
->
ShedKey
[
BSS0
][0].
ChAlg
,

1486 
MCAST_WCID
,

1487 
SHAREDKEYTABLE
);

1493 
Ced
 =
TRUE
)

1495 i(
pAd
->
CommCfg
.
LaSsidL
 =pAd->CommCfg.
SsidL
)

1497 i(
	`RTMPComMemy
(
pAd
->
CommCfg
.
LaSsid
,Ad->CommCfg.
Ssid
,Ad->CommCfg.
LaSsidL
) == 0)

1504 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSDisced
);

1505 
pAd
->
ExaInfo
 = 
GENERAL_LINK_DOWN
;

1506 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("NDIS_STATUS_MEDIA_DISCONNECT Event AA!\n"));

1514 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

1519 #ifde
PCIE_PS_SUPPORT


1520 
	`RTMP_CLEAR_PSFLAG
(
pAd
, 
fRTMP_PS_CAN_GO_SLEEP
);

1523 
	`RTMPWPARemoveAKeys
(
pAd
);

1524 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_NOT_SECURED
;

1525 
pAd
->
SCfg
.
PrivacyFr
 = 
Ndis802_11PrivFr8021xWEP
;

1528 #ifde
SOFT_ENCRYPT


1534 i(!(
	`IS_HW_WAPI_SUPPORT
(
pAd
)) &&

1535 (
FALSE


1538 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_SOFTWARE_ENCRYPT
);

1553 
	`CompoPsPl
(
pAd
);

1554 
	`CompoNuFme
(
pAd
);

1556 
	`AsicEbBssSync
(
pAd
);

1559 
	`AsicUpdeRxWCIDTab
(
pAd
, 
BSSID_WCID
,Ad->
CommCfg
.
Bssid
);

1562 #ifde
WPA_SUPPLICANT_SUPPORT


1563 i(((
pAd
->
SCfg
.
WSuliUP
)&&

1564 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11WEPEbd
)&&

1565 (
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_SECURED
)) ||

1566 ((
pAd
->
SCfg
.
WSuliUP
 =
WPA_SUPPLICANT_DISABLE
)&&

1567 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11WEPEbd
)))

1569 i(
pAd
->
SCfg
.
WStus
 =
Ndis802_11WEPEbd
)

1572 
UCHAR
 
ChAlg
;

1574 
idx
=0; idx < 
SHARE_KEY_NUM
; idx++)

1576 
ChAlg
 = 
pAd
->
ShedKey
[
BSS0
][
idx
].CipherAlg;

1578 i(
pAd
->
ShedKey
[
BSS0
][
idx
].
KeyL
 > 0)

1581 
	`AsicAddShedKeyEry
(
pAd
, 
BSS0
, 
idx
, &pAd->
ShedKey
[BSS0][idx]);

1583 i(
idx
 =
pAd
->
SCfg
.
DeuKeyId
)

1588 
pEry
->
Aid
 = 
BSSID_WCID
;

1589 
	`RTMPSWcidSecuryInfo
(
pAd
, 
BSS0
, 
idx
,

1590 
ChAlg
, 
pEry
->
Aid
, 
SHAREDKEYTABLE
);

1598 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

1601 i(
pAd
->
SCfg
.
AuthMode
 < 
Ndis802_11AuthModeWPA
)

1603 
pAd
->
ExaInfo
 = 
GENERAL_LINK_UP
;

1604 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSCed
);

1606 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

1607 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
))

1609 #ifde
WPA_SUPPLICANT_SUPPORT


1610 i(
pAd
->
SCfg
.
WSuliUP
 =
WPA_SUPPLICANT_DISABLE
)

1612 
	`RTMPSTim
(&
pAd
->
Mlme
.
LkDownTim
, 
LINK_DOWN_TIMEOUT
);

1618 
	`NdisAcqueSpLock
(&
pAd
->
MacTabLock
);

1620 i(
pEry
)

1622 
HashIdx
 = 
	`MAC_ADDR_HASH_INDEX
(
pAd
->
CommCfg
.
Bssid
);

1623 i(
pAd
->
MacTab
.
Hash
[
HashIdx
] =
NULL
)

1625 
pAd
->
MacTab
.
Hash
[
HashIdx
] = 
pEry
;

1629 
pCuEry
 = 
pAd
->
MacTab
.
Hash
[
HashIdx
];

1630 
pCuEry
->
pNext
 !
NULL
)

1632 
pCuEry
 =CuEry->
pNext
;

1634 
pCuEry
->
pNext
 = 
pEry
;

1637 
	`RTMPMoveMemy
(
pEry
->
Addr
, 
pAd
->
CommCfg
.
Bssid
, 
MAC_ADDR_LEN
);

1638 
pEry
->
Aid
 = 
BSSID_WCID
;

1639 
pEry
->
pAd
 =Ad;

1640 
	`SET_ENTRY_CLIENT
(
pEry
);

1641 
pAd
->
MacTab
.
Size
 = 1;

1642 
pEry
->
S
 = 
SST_ASSOC
;

1643 
pEry
->
AuthS
 = 
SST_ASSOC
;

1644 
pEry
->
AuthMode
 = 
pAd
->
SCfg
.AuthMode;

1645 
pEry
->
WStus
 = 
pAd
->
SCfg
.WepStatus;

1646 i(
pEry
->
AuthMode
 < 
Ndis802_11AuthModeWPA
)

1648 
pEry
->
WS
 = 
AS_NOTUSE
;

1649 
pEry
->
PrivacyFr
 = 
Ndis802_11PrivFrAcA
;

1653 
pEry
->
WS
 = 
AS_PTKSTART
;

1654 
pEry
->
PrivacyFr
 = 
Ndis802_11PrivFr8021xWEP
;

1656 
	`NdisRSpLock
(&
pAd
->
MacTabLock
);

1658 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! LINK UP !!! ClientStatusFlags=%lx)\n",

1659 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
ClStusFgs
));

1662 
	`MlmeUpdeTxRes
(
pAd
, 
TRUE
, 
BSS0
);

1663 #ifde
DOT11_N_SUPPORT


1664 
	`MlmeUpdeHtTxRes
(
pAd
, 
BSS0
);

1665 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! LINK UP !! (SAive.bHtEb =%d, )\n", 
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
));

1669 i(
pAd
->
CommCfg
.
bAgggiCab
)

1671 i((
pAd
->
CommCfg
.
bPiggyBackCab
&& (pAd->
MlmeAux
.
APRkIe
 & 0x00000003) == 3)

1673 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_PIGGYBACK_INUSED
);

1674 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_AGGREGATION_INUSED
);

1675 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_AGGREGATION_CAPABLE
);

1676 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_PIGGYBACK_CAPABLE
);

1677 
	`RTMPSPiggyBack
(
pAd
, 
TRUE
);

1678 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Turn on Piggy-Back\n"));

1680 i(
pAd
->
MlmeAux
.
APRkIe
 & 0x00000001)

1682 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_AGGREGATION_INUSED
);

1683 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_AGGREGATION_CAPABLE
);

1684 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Ralink Aggregation\n"));

1688 i(
pAd
->
MlmeAux
.
APRkIe
 != 0x0)

1690 #ifde
DOT11_N_SUPPORT


1691 i(
	`CLIENT_STATUS_TEST_FLAG
(
pEry
, 
fCLIENT_STATUS_RDG_CAPABLE
))

1693 
	`AsicEbRDG
(
pAd
);

1696 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fCLIENT_STATUS_RALINK_CHIPSET
);

1697 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_RALINK_CHIPSET
);

1701 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fCLIENT_STATUS_RALINK_CHIPSET
);

1702 
	`CLIENT_STATUS_CLEAR_FLAG
(
pEry
, 
fCLIENT_STATUS_RALINK_CHIPSET
);

1707 #ifde
DOT11_N_SUPPORT


1708 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("NDIS_STATUS_MEDIA_CONNECT EvB!.BACaby = %x. ClStusFg%lx\n", 
pAd
->
CommCfg
.
BACaby
.
wd
,Ad->
MacTab
.
Cڋ
[
BSSID_WCID
].
ClStusFgs
));

1711 #ifde
LED_CONTROL_SUPPORT


1713 
	`RTMPSLED
(
pAd
, 
LED_LINK_UP
);

1716 
pAd
->
Mlme
.
PiodicRound
 = 0;

1717 
pAd
->
Mlme
.
OSecPiodicRound
 = 0;

1718 
pAd
->
bCfigChged
 = 
FALSE
;

1719 
pAd
->
ExaInfo
 = 
GENERAL_LINK_UP
;

1723 
PUCHAR
 
pTab
;

1724 
UCHAR
 
TabSize
 = 0;

1726 
	`MlmeSeTxReTab
(
pAd
, &pAd->
MacTab
.
Cڋ
[
BSSID_WCID
], &
pTab
, &
TabSize
, &pAd->
CommCfg
.
TxReIndex
);

1727 
	`AsicUpdeAutoFlBackTab
(
pAd
, 
pTab
);

1730 
	`NdisAcqueSpLock
(&
pAd
->
MacTabLock
);

1731 
pEry
->
HTPhyMode
.
wd
 = 
pAd
->
SCfg
.HTPhyMode.word;

1732 
pEry
->
MaxHTPhyMode
.
wd
 = 
pAd
->
SCfg
.
HTPhyMode
.word;

1733 i(
pAd
->
SCfg
.
bAutoTxReSwch
 =
FALSE
)

1735 
pEry
->
bAutoTxReSwch
 = 
FALSE
;

1736 #ifde
DOT11_N_SUPPORT


1737 i(
pEry
->
HTPhyMode
.
fld
.
MCS
 == 32)

1738 
pEry
->
HTPhyMode
.
fld
.
ShtGI
 = 
GI_800
;

1740 i((
pEry
->
HTPhyMode
.
fld
.
MCS
 > 
MCS_7
) || (pEntry->HTPhyMode.field.MCS == 32))

1741 
pEry
->
HTPhyMode
.
fld
.
STBC
 = 
STBC_NONE
;

1744 i(
pEry
->
HTPhyMode
.
fld
.
MODE
 <
MODE_OFDM
)

1745 
	`RTMPUpdeLegacyTxStg
((
UCHAR
)
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
, 
pEry
);

1748 
pEry
->
bAutoTxReSwch
 = 
TRUE
;

1749 
	`NdisRSpLock
(&
pAd
->
MacTabLock
);

1752 
pAd
->
LaTxRe
 = (
USHORT
)(
pEry
->
HTPhyMode
.
wd
);

1755 i(
pAd
->
SAive
.
Su܋dPhyInfo
.
MCSS
[0] != 0x00)

1757 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R1
, &
Vue
);

1758 
Vue
 &= (~0x18);

1761 i(
pAd
->
A
.
fld
.
TxPh
 >= 2)

1763 
Vue
 |= 0x10;

1766 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
Vue
);

1770 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R1
, &
Vue
);

1771 
Vue
 &= (~0x18);

1772 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
Vue
);

1775 #ifde
DOT11_N_SUPPORT


1776 i((
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 =
TRUE
))

1778 i(
pEry
->
MaxRAmpduFa
 == 0)

1782 
	`RTMP_IO_WRITE32
(
pAd
, 
MAX_LEN_CFG
, 0x000A0fff);

1784 i(
pEry
->
MaxRAmpduFa
 == 1)

1786 
	`RTMP_IO_WRITE32
(
pAd
, 
MAX_LEN_CFG
, 0x000A1fff);

1788 i(
pEry
->
MaxRAmpduFa
 == 2)

1790 
	`RTMP_IO_WRITE32
(
pAd
, 
MAX_LEN_CFG
, 0x000A2fff);

1792 i(
pEry
->
MaxRAmpduFa
 == 3)

1794 
	`RTMP_IO_WRITE32
(
pAd
, 
MAX_LEN_CFG
, 0x000A3fff);

1796 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!MaxRAmpduFa%d \n", 
pEry
->
MaxRAmpduFa
));

1810 #ifde
DOT11_N_SUPPORT


1811 i(!((
pAd
->
CommCfg
.
RxSm
 =1)&&Ad->CommCfg.
TxSm
 == 1)) &&

1812 (
pAd
->
SCfg
.
bFTxBur
 =
FALSE
) &&

1813 (((
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 =
FALSE
&& 
	`OPSTATUS_TEST_FLAG
Ad, 
fOP_STATUS_WMM_INUSED
))

1814 || ((
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 =
TRUE
&& (pAd->
CommCfg
.
BACaby
.
fld
.
Picy
 =
BA_NOTUSE
))))

1816 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC0_CFG
, &
Da
);

1817 
Da
 &= 0xFFFFFF00;

1818 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC0_CFG
, 
Da
);

1820 
	`RTMP_IO_WRITE32
(
pAd
, 
PBF_MAX_PCNT
, 0x1F3F7F9F);

1821 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Txburst 1\n"));

1825 i(
pAd
->
CommCfg
.
bEbTxBur
)

1827 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC0_CFG
, &
Da
);

1828 
Da
 &= 0xFFFFFF00;

1829 
Da
 |= 0x60;

1830 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC0_CFG
, 
Da
);

1831 
pAd
->
CommCfg
.
IOTePm
.
bNowAthosBurOn
 = 
TRUE
;

1833 
	`RTMP_IO_WRITE32
(
pAd
, 
PBF_MAX_PCNT
, 0x1F3FBF9F);

1834 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Txburst 2\n"));

1838 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC0_CFG
, &
Da
);

1839 
Da
 &= 0xFFFFFF00;

1840 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC0_CFG
, 
Da
);

1842 
	`RTMP_IO_WRITE32
(
pAd
, 
PBF_MAX_PCNT
, 0x1F3F7F9F);

1843 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Txburst 3\n"));

1846 #ifde
DOT11_N_SUPPORT


1848 i((
pAd
->
CommCfg
.
IOTePm
.
bLaAthos
 =
TRUE
&& ((
	`STA_WEP_ON
Ad))||(
	`STA_TKIP_ON
(pAd))))

1850 
pAd
->
CommCfg
.
IOTePm
.
bNextDibRxBA
 = 
TRUE
;

1851 i(
pAd
->
CommCfg
.
bEbTxBur
)

1853 
UINT32
 
MACVue
 = 0;

1856 
	`RTMP_IO_READ32
(
pAd
, 
EDCA_AC0_CFG
, &
MACVue
);

1857 
MACVue
 &= 0xFFFFFF00;

1858 
	`RTMP_IO_WRITE32
(
pAd
, 
EDCA_AC0_CFG
, 
MACVue
);

1859 
pAd
->
CommCfg
.
IOTePm
.
bNowAthosBurOn
 = 
FALSE
;

1864 
pAd
->
CommCfg
.
IOTePm
.
bNextDibRxBA
 = 
FALSE
;

1868 
pAd
->
CommCfg
.
IOTePm
.
bLaAthos
 = 
FALSE
;

1870 #ifde
WPA_SUPPLICANT_SUPPORT


1874 i((
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
) &&

1875 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
) &&

1876 (
	`NdisEquMemy
(
pAd
->
CommCfg
.
Bssid
,Ad->CommCfg.
LaBssid
, 
MAC_ADDR_LEN
=
FALSE
) &&

1877 (
pAd
->
SCfg
.
bLoAp
 =
TRUE
))

1879 
pAd
->
SCfg
.
bLoAp
 = 
FALSE
;

1886 
	`COPY_MAC_ADDR
(
pAd
->
CommCfg
.
LaBssid
,Ad->CommCfg.
Bssid
);

1887 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!pAd->bNextDibRxBA%d \n", 
pAd
->
CommCfg
.
IOTePm
.
bNextDibRxBA
));

1892 i(
pAd
->
SCfg
.
WStus
 <
Ndis802_11WEPDibd
)

1894 #ifde
WPA_SUPPLICANT_SUPPORT


1895 i(
pAd
->
SCfg
.
WSuliUP
 &&

1896 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11WEPEbd
) &&

1897 (
pAd
->
SCfg
.
IEEE8021X
 =
TRUE
))

1902 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_SECURED
;

1903 
pAd
->
SCfg
.
PrivacyFr
 = 
Ndis802_11PrivFrAcA
;

1907 
	`NdisAcqueSpLock
(&
pAd
->
MacTabLock
);

1908 
pEry
->
PtSecud
 = 
pAd
->
SCfg
.PortSecured;

1909 
	`NdisRSpLock
(&
pAd
->
MacTabLock
);

1915 i(
	`INFRA_ON
(
pAd
&& 
	`OPSTATUS_TEST_FLAG
Ad, 
fOP_STATUS_WMM_INUSED
&& 
	`STA_TKIP_ON
(pAd))

1917 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_PARSER_CFG
, 0x01);

1921 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_PARSER_CFG
, 0x00);

1924 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
);

1928 #ifde
DOT11_N_SUPPORT


1929 #ifde
DOT11N_DRAFT3


1930 i(
	`INFRA_ON
(
pAd
))

1932 i((
pAd
->
CommCfg
.
bBssCxEb
 =
TRUE
&& (pAd->CommCfg.
Chl
 <= 14)

1933 && (
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 =
TRUE
&& (pAd->
MlmeAux
.
ExtCInfo
.
BssCxiMgmtSut
 == 1))

1935 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_SCAN_2040
);

1936 
	`BudEfedChlLi
(
pAd
);

1938 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("LkUP AP sut20/40 BSS COEX !!! D11BssWidthTriggSnI[%d]\n",
pAd
->
CommCfg
.
D11BssWidthTriggSnI
));

1942 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("not supports 20/40 BSS COEX !!! \n"));

1943 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("pAd->CommCfg.bBssCxEb %d !!! \n", 
pAd
->
CommCfg
.
bBssCxEb
));

1944 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("pAd->CommCfg.Ch%d !!! \n",
pAd
->
CommCfg
.
Chl
));

1945 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("pAd->SAive.Su܋dHtPhy.bHtEb %d !!! \n",
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
));

1946 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("pAd->MlmeAux.ExtCInfo.BssCxSu%d !!! \n",
pAd
->
MlmeAux
.
ExtCInfo
.
BssCxiMgmtSut
));

1947 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("pAd->CommCfg.CCh%d !!! \n",
pAd
->
CommCfg
.
CChl
));

1948 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("pAd->CommCfg.PhyMod%d !!! \n",
pAd
->
CommCfg
.
PhyMode
));

1954 #ifde
WPA_SUPPLICANT_SUPPORT


1960 i((
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
) &&

1961 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
) &&

1962 (
	`NdisEquMemy
(
pAd
->
CommCfg
.
Bssid
,Ad->CommCfg.
LaBssid
, 
MAC_ADDR_LEN
)) &&

1963 (
pAd
->
SCfg
.
bLoAp
 =
TRUE
))

1965 
	`WSdES
(
pAd
,Ad->
CommCfg
.
Bssid
);

1966 
pAd
->
SCfg
.
bLoAp
 = 
FALSE
;

1970 #ifde
RTMP_INTERNAL_TX_ALC


1972 i(
pAd
->
TxPowCl
.
bIlTxALC
 =
TRUE
)

1974 
UCHAR
 
dex
 = 0;

1976 
dex
 = 0; index < 
MAX_NUM_OF_CHANNELS
; index++)

1978 i(
pAd
->
CommCfg
.
Chl
 =pAd->
TxPow
[
dex
].Channel)

1980 
pAd
->
TxPowCl
.
idxTxPowTab
 =Ad->
TxPow
[
dex
].
Pow
;

1985 i(
pAd
->
CommCfg
.
Chl
 <= 14)

1990 i((
pAd
->
TxPowCl
.
idxTxPowTab
 < 
LOWERBOUND_TX_POWER_TUNING_ENTRY
) ||

1991 (
pAd
->
TxPowCl
.
idxTxPowTab
 > 
UPPERBOUND_TX_POWER_TUNING_ENTRY
))

1993 
pAd
->
TxPowCl
.
idxTxPowTab
 = 0;

1996 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s:Ad->TxPowerCtrl.idxTxPowerTable = %d\n",

1997 
__FUNCTION__
,

1998 
pAd
->
TxPowCl
.
idxTxPowTab
));

2002 
pAd
->
TxPowCl
.
idxTxPowTab
 = 0;

2004 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s:Ad->TxPowerCtrl.idxTxPowerTable = %d\n",

2005 
__FUNCTION__
,

2006 
pAd
->
TxPowCl
.
idxTxPowTab
));

2010 
	}
}

2037 
VOID
 
	$LkDown
(

2038 
IN
 
PRTMP_ADAPTER
 
pAd
,

2039 
IN
 
BOOLEAN
 
IsReqFromAP
)

2041 
UCHAR
 
i
, 
ByVue
 = 0;

2044 i(
	`MONITOR_ON
(
pAd
))

2047 #ifde
RALINK_ATE


2049 i(
	`ATE_ON
(
pAd
))

2053 #ifde
PCIE_PS_SUPPORT


2055 
	`RTMP_CLEAR_PSFLAG
(
pAd
, 
fRTMP_PS_CAN_GO_SLEEP
);

2059 
	`RTMPSdWessEvt
(
pAd
, 
IW_STA_LINKDOWN_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

2061 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! LINK DOWN !!!\n"));

2062 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_AGGREGATION_INUSED
);

2065 
pAd
->
SCfg
.
bImovedSn
 = 
FALSE
;

2067 #ifde
PCIE_PS_SUPPORT


2069 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

2071 
BOOLEAN
 
Ced
;

2072 
pAd
->
Mlme
.
bPsPlTimRug
 = 
FALSE
;

2073 
	`RTMPClTim
(&
pAd
->
Mlme
.
PsPlTim
, &
Ced
);

2076 
pAd
->
bPCIkOff
 = 
FALSE
;

2078 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
)

2080 || 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
))

2082 
AUTO_WAKEUP_STRUC
 
AutoWakeupCfg
;

2083 
	`AsicFWakeup
(
pAd
, 
TRUE
);

2084 
AutoWakeupCfg
.
wd
 = 0;

2085 
	`RTMP_IO_WRITE32
(
pAd
, 
AUTO_WAKEUP_CFG
, 
AutoWakeupCfg
.
wd
);

2086 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_DOZE
);

2089 i(
	`ADHOC_ON
(
pAd
))

2091 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! LINK DOWN 1!!!\n"));

2094 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_ADHOC_ON
);

2095 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

2096 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSDisced
);

2097 
pAd
->
ExaInfo
 = 
GENERAL_LINK_DOWN
;

2098 
	`BssTabDeEry
(&
pAd
->
SnTab
,Ad->
CommCfg
.
Bssid
,Ad->CommCfg.
Chl
);

2099 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! MacTab.Size=%d !!!\n", 
pAd
->
MacTab
.
Size
));

2103 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! LINK DOWN 2!!!\n"));

2105 #ifde
QOS_DLS_SUPPORT


2108 i(
pAd
->
CommCfg
.
bDLSCab
)

2111 
i
=0; i<
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

2113 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
))

2115 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

2116 
	`RTMPSdDLSTrDownFme
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
);

2121 
i
=
MAX_NUM_OF_INIT_DLS_ENTRY
; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

2123 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
))

2125 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

2126 
	`RTMPSdDLSTrDownFme
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
);

2134 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_INFRA_ON
);

2135 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

2139 
pAd
->
CommCfg
.
LaSsidL
 =Ad->CommCfg.
SsidL
;

2140 
	`NdisMoveMemy
(
pAd
->
CommCfg
.
LaSsid
,Ad->CommCfg.
Ssid
,Ad->CommCfg.
LaSsidL
);

2141 
	`COPY_MAC_ADDR
(
pAd
->
CommCfg
.
LaBssid
,Ad->CommCfg.
Bssid
);

2142 i(
pAd
->
MlmeAux
.
CuReqIsFromNdis
 =
TRUE
)

2144 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("NDIS_STATUS_MEDIA_DISCONNECT Event A!\n"));

2145 
pAd
->
MlmeAux
.
CuReqIsFromNdis
 = 
FALSE
;

2149 i((
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_SECURED
) ||

2150 (
pAd
->
SCfg
.
AuthMode
 < 
Ndis802_11AuthModeWPA
))

2158 
	`BssTabDeEry
(&
pAd
->
SnTab
,Ad->
CommCfg
.
Bssid
,Ad->CommCfg.
Chl
);

2166 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_BG_PROTECTION_INUSED
);

2168 #ifde
EXT_BUILD_CHANNEL_LIST


2170 i(
pAd
->
SCfg
.
IEEE80211dClMode
 !
Rt802_11_D_Ne
)

2172 
	`NdisMoveMemy
(&
pAd
->
CommCfg
.
CouryCode
[0], &pAd->
SCfg
.
SOriCouryCode
[0], 2);

2173 
pAd
->
CommCfg
.
Geogphy
 =Ad->
SCfg
.
SOriGeogphy
;

2174 
	`BudChlLiEx
(
pAd
);

2181 
i
=1; i<
MAX_LEN_OF_MAC_TABLE
; i++)

2183 i(
	`IS_ENTRY_CLIENT
(&
pAd
->
MacTab
.
Cڋ
[
i
]))

2184 
	`MacTabDeEry
(
pAd
,Ad->
MacTab
.
Cڋ
[
i
].
Aid
,Ad->MacTab.Cڋ[i].
Addr
);

2187 
	`AsicSSlTime
(
pAd
, 
TRUE
);

2188 
	`AsicSEdPm
(
pAd
, 
NULL
);

2190 #ifde
LED_CONTROL_SUPPORT


2192 
	`RTMPSLED
(
pAd
, 
LED_LINK_DOWN
);

2193 
pAd
->
LedInditSgth
 = 0xF0;

2194 
	`RTMPSSiglLED
(
pAd
, -100);

2197 
	`AsicDibSync
(
pAd
);

2199 
pAd
->
Mlme
.
PiodicRound
 = 0;

2200 
pAd
->
Mlme
.
OSecPiodicRound
 = 0;

2202 #ifde
DOT11_N_SUPPORT


2203 
	`NdisZoMemy
(&
pAd
->
MlmeAux
.
HtCaby
, (
HT_CAPABILITY_IE
));

2204 
	`NdisZoMemy
(&
pAd
->
MlmeAux
.
AddHtInfo
, (
ADD_HT_INFO_IE
));

2205 
pAd
->
MlmeAux
.
HtCabyL
 = 0;

2206 
pAd
->
MlmeAux
.
NewExtChlOfft
 = 0xff;

2208 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("LinkDownCleanMlmeAux.ExtCapInfo!\n"));

2209 
	`NdisZoMemy
((
PUCHAR
)(&
pAd
->
MlmeAux
.
ExtCInfo
), (
EXT_CAP_INFO_ELEMENT
));

2213 i(
pAd
->
SCfg
.
WS
 !
SS_NOTUSE
)

2215 
pAd
->
SCfg
.
WS
 = 
SS_START
;

2217 
	`NdisZoMemy
(
pAd
->
SCfg
.
RyCou
, 8);

2219 #ifde
QOS_DLS_SUPPORT


2220 i(
pAd
->
CommCfg
.
bDLSCab
)

2221 
	`NdisZoMemy
(
pAd
->
SCfg
.
DlsRyCou
, 8);

2229 i((
IsReqFromAP
&& (
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
))

2232 
	`RTMPWPARemoveAKeys
(
pAd
);

2236 #ifde
WPA_SUPPLICANT_SUPPORT


2239 i(
pAd
->
SCfg
.
WSuliUP
 &&

2240 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11WEPEbd
) &&

2241 (
pAd
->
SCfg
.
IEEE8021X
 =
FALSE
))

2243 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_SECURED
;

2248 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_NOT_SECURED
;

2249 
pAd
->
SCfg
.
PrivacyFr
 = 
Ndis802_11PrivFr8021xWEP
;

2252 
	`NdisAcqueSpLock
(&
pAd
->
MacTabLock
);

2253 
	`NdisZoMemy
(&
pAd
->
MacTab
, (
MAC_TABLE
));

2254 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
PtSecud
 =Ad->
SCfg
.PortSecured;

2255 
	`NdisRSpLock
(&
pAd
->
MacTabLock
);

2257 
pAd
->
SCfg
.
MicEC
 = 0;

2259 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSDisced
);

2261 
pAd
->
ExaInfo
 = 
GENERAL_LINK_DOWN
;

2263 
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 = 
FALSE
;

2267 
	`NdisZoMemy
(&
pAd
->
SCfg
.
AssocInfo
, (
NDIS_802_11_ASSOCIATION_INFORMATION
));

2268 
pAd
->
SCfg
.
AssocInfo
.
Lgth
 = (
NDIS_802_11_ASSOCIATION_INFORMATION
);

2269 
pAd
->
SCfg
.
ReqVIEL
 = 0;

2270 
pAd
->
SCfg
.
ResVIEL
 = 0;

2275 
	`NdisZoMemy
((
PUCHAR
)(&
pAd
->
SCfg
.
RssiSame
), (pAd->StaCfg.RssiSample));

2278 
pAd
->
CommCfg
.
MlmeRe
 =Ad->CommCfg.
BasicMlmeRe
;

2279 
pAd
->
CommCfg
.
RtsRe
 =Ad->CommCfg.
BasicMlmeRe
;

2281 #ifde
DOT11_N_SUPPORT


2285 i(
pAd
->
CommCfg
.
BBPCutBW
 =
BW_40
)

2287 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_20
;

2288 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
ByVue
);

2289 
ByVue
 &= (~0x18);

2290 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
ByVue
);

2297 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R1
, &
ByVue
);

2298 
ByVue
 &= (~0x18);

2301 i(
pAd
->
A
.
fld
.
TxPh
 >= 2)

2303 
ByVue
 |= 0x10;

2306 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R1
, 
ByVue
);

2309 
	`RTMPSPiggyBack
(
pAd
,
FALSE
);

2310 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_PIGGYBACK_INUSED
);

2312 #ifde
DOT11_N_SUPPORT


2313 
pAd
->
CommCfg
.
BACaby
.
wd
 =Ad->CommCfg.
REGBACaby
.word;

2317 
	`AsicUpdePre
(
pAd
, 0, (
ALLN_SETPROTECT
|
CCKSETPROTECT
|
OFDMSETPROTECT
), 
TRUE
, 
FALSE
);

2318 #ifde
DOT11_N_SUPPORT


2319 
	`AsicDibRDG
(
pAd
);

2321 
pAd
->
CommCfg
.
IOTePm
.
bCutAthos
 = 
FALSE
;

2322 
pAd
->
CommCfg
.
IOTePm
.
bNowAthosBurOn
 = 
FALSE
;

2324 #ifde
DOT11_N_SUPPORT


2325 #ifde
DOT11N_DRAFT3


2326 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_SCAN_2040
);

2327 
pAd
->
CommCfg
.
BSSCxi2040
.
wd
 = 0;

2328 
	`TriEvtIn
(
pAd
);

2329 
i
 = 0; i < (
pAd
->
ChlLiNum
 - 1); i++)

2331 
pAd
->
ChlLi
[
i
].
bEfedChl
 = 
FALSE
;

2336 
	`RTMP_IO_WRITE32
(
pAd
, 
MAX_LEN_CFG
, 0x1fff);

2337 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
);

2339 #ifde 
PCIE_PS_SUPPORT


2341 
	`RTMP_SET_PSFLAG
(
pAd
, 
fRTMP_PS_CAN_GO_SLEEP
);

2344 #ifde
WPA_SUPPLICANT_SUPPORT


2345 #ide
NATIVE_WPA_SUPPLICANT_SUPPORT


2346 i(
pAd
->
SCfg
.
WSuliUP
) {

2348 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, 
RT_DISASSOC_EVENT_FLAG
, 
NULL
, NULL, 0);

2353 #ifde
NATIVE_WPA_SUPPLICANT_SUPPORT


2354 
	`RtmpOSWrssEvtSd
(
pAd
, 
SIOCGIWAP
, -1, 
NULL
, NULL, 0);

2358 i(
pAd
->
SCfg
.
BssTy
 !
BSS_ADHOC
)

2359 
pAd
->
SCfg
.
bNFSn
 = 
FALSE
;

2361 
pAd
->
SCfg
.
bAdhocC
 = 
FALSE
;

2363 
	}
}

2373 
VOID
 
	$IOnBssTab
(

2374 
IN
 
PRTMP_ADAPTER
 
pAd
)

2376 
MLME_START_REQ_STRUCT
 
SReq
;

2377 
MLME_JOIN_REQ_STRUCT
 
JoReq
;

2378 
ULONG
 
BssIdx
;

2379 
BSS_ENTRY
 *
pInBss
 = 
NULL
;

2382 
pAd
->
SCfg
.
PaCh
 =Ad->SCfg.
WStus
;

2383 
pAd
->
SCfg
.
GroupCh
 =Ad->SCfg.
WStus
;

2385 
BssIdx
 = 
pAd
->
MlmeAux
.BssIdx;

2387 i(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
)

2389 i(
BssIdx
 < 
pAd
->
MlmeAux
.
SsidBssTab
.
BssNr
)

2391 
pInBss
 = &
pAd
->
MlmeAux
.
SsidBssTab
.
BssEry
[
BssIdx
];

2392 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - i BSS %ld o%d\n", 
BssIdx
, 
pAd
->
MlmeAux
.
SsidBssTab
.
BssNr
));

2393 
	`JoPmFl
(
pAd
, &
JoReq
, 
BssIdx
);

2394 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_JOIN_REQ
, (
MLME_JOIN_REQ_STRUCT
),

2395 &
JoReq
, 0);

2396 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_JOIN
;

2399 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - A BSS fa; sew ADHOC (Ssid=%s)...\n",
pAd
->
MlmeAux
.
Ssid
));

2400 
	`SPmFl
(
pAd
, &
SReq
, (
PCHAR
Ad->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
);

2401 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_START_REQ
, (
MLME_START_REQ_STRUCT
), &
SReq
, 0);

2403 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_START
;

2405 i((
BssIdx
 < 
pAd
->
MlmeAux
.
SsidBssTab
.
BssNr
) &&

2406 (
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
))

2408 
pInBss
 = &
pAd
->
MlmeAux
.
SsidBssTab
.
BssEry
[
BssIdx
];

2412 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPAPSK
))

2414 
pAd
->
SCfg
.
GroupCh
 = 
pInBss
->
WPA
.GroupCipher;

2416 i(
pAd
->
SCfg
.
WStus
 =
pInBss
->
WPA
.
PaCh
)

2417 
pAd
->
SCfg
.
PaCh
 = 
pInBss
->
WPA
.PairCipher;

2418 i(
pInBss
->
WPA
.
PaChAux
 !
Ndis802_11WEPDibd
)

2419 
pAd
->
SCfg
.
PaCh
 = 
pInBss
->
WPA
.
PaChAux
;

2421 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11Enyi2Ebd
;

2423 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPA2PSK
))

2425 
pAd
->
SCfg
.
GroupCh
 = 
pInBss
->
WPA2
.GroupCipher;

2427 i(
pAd
->
SCfg
.
WStus
 =
pInBss
->
WPA2
.
PaCh
)

2428 
pAd
->
SCfg
.
PaCh
 = 
pInBss
->
WPA2
.PairCipher;

2429 i(
pInBss
->
WPA2
.
PaChAux
 !
Ndis802_11WEPDibd
)

2430 
pAd
->
SCfg
.
PaCh
 = 
pInBss
->
WPA2
.
PaChAux
;

2432 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11Enyi2Ebd
;

2435 
pAd
->
SCfg
.
RCaby
 = 
pInBss
->
WPA2
.RsnCapability;

2439 
pAd
->
SCfg
.
bMixCh
 = (pAd->SCfg.
PaCh
 =pAd->SCfg.
GroupCh
? 
FALSE
 : 
TRUE
;

2440 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - i BSS %ld o%d\n", 
BssIdx
, 
pAd
->
MlmeAux
.
SsidBssTab
.
BssNr
));

2441 
	`JoPmFl
(
pAd
, &
JoReq
, 
BssIdx
);

2442 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_JOIN_REQ
, (
MLME_JOIN_REQ_STRUCT
),

2443 &
JoReq
, 0);

2444 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_JOIN
;

2449 #ifde
DOT11_N_SUPPORT


2452 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

2453 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

2454 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - A΄mg faed,eܐtch%d, Tٮ BSS[%02d]\n",
pAd
->
CommCfg
.
Chl
,Ad->
SnTab
.
BssNr
));

2457 
pAd
->
MlmeAux
.
SsidBssTab
.
BssNr
 = 0;

2458 
	`BssTabDeEry
(&
pAd
->
SnTab
,

2459 
pAd
->
MlmeAux
.
SsidBssTab
.
BssEry
[0].
Bssid
,

2460 
pAd
->
MlmeAux
.
SsidBssTab
.
BssEry
[0].
Chl
);

2462 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

2464 
	}
}

2468 
VOID
 
	$IOnBssTab2
(

2469 
IN
 
PRTMP_ADAPTER
 
pAd
)

2471 
MLME_REASSOC_REQ_STRUCT
 
RssocReq
;

2472 
ULONG
 
BssIdx
;

2473 
BSS_ENTRY
 *
pBss
;

2475 
BssIdx
 = 
pAd
->
MlmeAux
.
RmIdx
;

2476 
pBss
 = &
pAd
->
MlmeAux
.
RmTab
.
BssEry
[
BssIdx
];

2478 i(
BssIdx
 < 
pAd
->
MlmeAux
.
RmTab
.
BssNr
)

2480 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - i BSS %ld o%d\n", 
BssIdx
, 
pAd
->
MlmeAux
.
RmTab
.
BssNr
));

2482 
	`AsicSwchChl
(
pAd
, 
pBss
->
Chl
, 
FALSE
);

2483 
	`AsicLockChl
(
pAd
, 
pBss
->
Chl
);

2486 
	`AssocPmFl
(
pAd
, &
RssocReq
, 
pBss
->
Bssid
,Bss->
CabyInfo
,

2487 
ASSOC_TIMEOUT
, 
pAd
->
SCfg
.
DeuLiCou
);

2488 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_MLME_REASSOC_REQ
,

2489 (
MLME_REASSOC_REQ_STRUCT
), &
RssocReq
, 0);

2491 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_REASSOC
;

2496 #ifde
DOT11_N_SUPPORT


2499 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

2500 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

2501 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("CNTL - A΄mg faed,eܐtch%d, Tٮ BSS[%02d]\n",
pAd
->
CommCfg
.
Chl
,Ad->
SnTab
.
BssNr
));

2504 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_IDLE
;

2506 
	}
}

2516 
VOID
 
	$JoPmFl
(

2517 
IN
 
PRTMP_ADAPTER
 
pAd
,

2518 
IN
 
OUT
 
MLME_JOIN_REQ_STRUCT
 *
JoReq
,

2519 
IN
 
ULONG
 
BssIdx
)

2521 
JoReq
->
BssIdx
 = BssIdx;

2522 
	}
}

2532 
VOID
 
	$SnPmFl
(

2533 
IN
 
PRTMP_ADAPTER
 
pAd
,

2534 
IN
 
OUT
 
MLME_SCAN_REQ_STRUCT
 *
SnReq
,

2535 
IN
 
STRING
 
Ssid
[],

2536 
IN
 
UCHAR
 
SsidL
,

2537 
IN
 
UCHAR
 
BssTy
,

2538 
IN
 
UCHAR
 
SnTy
)

2540 
	`NdisZoMemy
(
SnReq
->
Ssid
, 
MAX_LEN_OF_SSID
);

2541 
SnReq
->
SsidL
 = SsidLen;

2542 
	`NdisMoveMemy
(
SnReq
->
Ssid
, Ssid, 
SsidL
);

2543 
SnReq
->
BssTy
 = BssType;

2544 
SnReq
->
SnTy
 = ScanType;

2545 
	}
}

2547 #ifde
QOS_DLS_SUPPORT


2556 
VOID
 
	$DlsPmFl
(

2557 
IN
 
PRTMP_ADAPTER
 
pAd
,

2558 
IN
 
OUT
 
MLME_DLS_REQ_STRUCT
 *
pDlsReq
,

2559 
IN
 
PRT_802_11_DLS
 
pDls
,

2560 
IN
 
USHORT
 
as
)

2562 
pDlsReq
->
pDLS
 = 
pDls
;

2563 
pDlsReq
->
Rs
 = 
as
;

2564 
	}
}

2575 
VOID
 
	$SPmFl
(

2576 
IN
 
PRTMP_ADAPTER
 
pAd
,

2577 
IN
 
OUT
 
MLME_START_REQ_STRUCT
 *
SReq
,

2578 
IN
 
CHAR
 
Ssid
[],

2579 
IN
 
UCHAR
 
SsidL
)

2581 
	`ASSERT
(
SsidL
 <
MAX_LEN_OF_SSID
);

2582 i(
SsidL
 > 
MAX_LEN_OF_SSID
)

2583 
SsidL
 = 
MAX_LEN_OF_SSID
;

2584 
	`NdisMoveMemy
(
SReq
->
Ssid
, Ssid, 
SsidL
);

2585 
SReq
->
SsidL
 = SsidLen;

2586 
	}
}

2596 
VOID
 
	$AuthPmFl
(

2597 
IN
 
PRTMP_ADAPTER
 
pAd
,

2598 
IN
 
OUT
 
MLME_AUTH_REQ_STRUCT
 *
AuthReq
,

2599 
IN
 
PUCHAR
 
pAddr
,

2600 
IN
 
USHORT
 
Alg
)

2602 
	`COPY_MAC_ADDR
(
AuthReq
->
Addr
, 
pAddr
);

2603 
AuthReq
->
Alg
 = Alg;

2604 
AuthReq
->
Timeout
 = 
AUTH_TIMEOUT
;

2605 
	}
}

2615 #ifde
RTMP_MAC_PCI


2616 
VOID
 
	$CompoPsPl
(

2617 
IN
 
PRTMP_ADAPTER
 
pAd
)

2619 
	`NdisZoMemy
(&
pAd
->
PsPlFme
, (
PSPOLL_FRAME
));

2620 
pAd
->
PsPlFme
.
FC
.
Ty
 = 
BTYPE_CNTL
;

2621 
pAd
->
PsPlFme
.
FC
.
SubTy
 = 
SUBTYPE_PS_POLL
;

2622 
pAd
->
PsPlFme
.
Aid
 =Ad->
SAive
.Aid | 0xC000;

2623 
	`COPY_MAC_ADDR
(
pAd
->
PsPlFme
.
Bssid
,Ad->
CommCfg
.Bssid);

2624 
	`COPY_MAC_ADDR
(
pAd
->
PsPlFme
.
Ta
,Ad->
CutAddss
);

2625 
	}
}

2628 
VOID
 
	$CompoNuFme
(

2629 
IN
 
PRTMP_ADAPTER
 
pAd
)

2631 
	`NdisZoMemy
(&
pAd
->
NuFme
, (
HEADER_802_11
));

2632 
pAd
->
NuFme
.
FC
.
Ty
 = 
BTYPE_DATA
;

2633 
pAd
->
NuFme
.
FC
.
SubTy
 = 
SUBTYPE_NULL_FUNC
;

2634 
pAd
->
NuFme
.
FC
.
ToDs
 = 1;

2635 
	`COPY_MAC_ADDR
(
pAd
->
NuFme
.
Addr1
,Ad->
CommCfg
.
Bssid
);

2636 
	`COPY_MAC_ADDR
(
pAd
->
NuFme
.
Addr2
,Ad->
CutAddss
);

2637 
	`COPY_MAC_ADDR
(
pAd
->
NuFme
.
Addr3
,Ad->
CommCfg
.
Bssid
);

2638 
	}
}

2654 
ULONG
 
	$MakeIbssBc
(

2655 
IN
 
PRTMP_ADAPTER
 
pAd
)

2657 
UCHAR
 
DsL
 = 1, 
IbssL
 = 2;

2658 
UCHAR
 
LolEIe
[3] = {
IE_ERP
, 1, 0x04};

2659 
HEADER_802_11
 
BHdr
;

2660 
USHORT
 
CabyInfo
;

2661 
LARGE_INTEGER
 
FakeTimeamp
;

2662 
ULONG
 
FmeL
 = 0;

2663 
PTXWI_STRUC
 
pTxWI
 = &
pAd
->
BcTxWI
;

2664 
UCHAR
 *
pBcFme
 = 
pAd
->
BcBuf
;

2665 
BOOLEAN
 
Privacy
;

2666 
UCHAR
 
SupRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

2667 
UCHAR
 
SupReL
 = 0;

2668 
UCHAR
 
ExtRe
[
MAX_LEN_OF_SUPPORTED_RATES
];

2669 
UCHAR
 
ExtReL
 = 0;

2671 i((
pAd
->
CommCfg
.
PhyMode
 =
PHY_11B
&& (pAd->CommCfg.
Chl
 <= 14))

2673 
SupRe
[0] = 0x82;

2674 
SupRe
[1] = 0x84;

2675 
SupRe
[2] = 0x8b;

2676 
SupRe
[3] = 0x96;

2677 
SupReL
 = 4;

2678 
ExtReL
 = 0;

2680 i(
pAd
->
CommCfg
.
Chl
 > 14)

2682 
SupRe
[0] = 0x8C;

2683 
SupRe
[1] = 0x12;

2684 
SupRe
[2] = 0x98;

2685 
SupRe
[3] = 0x24;

2686 
SupRe
[4] = 0xb0;

2687 
SupRe
[5] = 0x48;

2688 
SupRe
[6] = 0x60;

2689 
SupRe
[7] = 0x6c;

2690 
SupReL
 = 8;

2691 
ExtReL
 = 0;

2696 
pAd
->
CommCfg
.
MlmeRe
 = 
RATE_6
;

2697 
pAd
->
CommCfg
.
RtsRe
 = 
RATE_6
;

2698 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MODE
 = 
MODE_OFDM
;

2699 
pAd
->
CommCfg
.
MlmeTnsm
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pAd->CommCfg.
MlmeRe
];

2700 
pAd
->
MacTab
.
Cڋ
[
BSS0M_WCID
].
HTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

2701 
pAd
->
MacTab
.
Cڋ
[
BSS0M_WCID
].
HTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pAd->
CommCfg
.
MlmeRe
];

2705 
SupRe
[0] = 0x82;

2706 
SupRe
[1] = 0x84;

2707 
SupRe
[2] = 0x8b;

2708 
SupRe
[3] = 0x96;

2709 
SupReL
 = 4;

2711 
ExtRe
[0] = 0x0C;

2712 
ExtRe
[1] = 0x12;

2713 
ExtRe
[2] = 0x18;

2714 
ExtRe
[3] = 0x24;

2715 
ExtRe
[4] = 0x30;

2716 
ExtRe
[5] = 0x48;

2717 
ExtRe
[6] = 0x60;

2718 
ExtRe
[7] = 0x6c;

2719 
ExtReL
 = 8;

2722 
pAd
->
SAive
.
SupReL
 = SupRateLen;

2723 
	`NdisMoveMemy
(
pAd
->
SAive
.
SupRe
, SupRe, 
SupReL
);

2724 
pAd
->
SAive
.
ExtReL
 = ExtRateLen;

2725 
	`NdisMoveMemy
(
pAd
->
SAive
.
ExtRe
, ExtRe, 
ExtReL
);

2728 
	`MgtMacHdIn
(
pAd
, &
BHdr
, 
SUBTYPE_BEACON
, 0, 
BROADCAST_ADDR
,Ad->
CommCfg
.
Bssid
);

2729 
Privacy
 = (
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi1Ebd
) ||

2730 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi2Ebd
) ||

2731 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi3Ebd
);

2732 
CabyInfo
 = 
	`CAP_GENERATE
(0, 1, 
Privacy
, (
pAd
->
CommCfg
.
TxPamb
 =
Rt802_11PambSht
), 0, 0);

2734 
	`MakeOutgogFme
(
pBcFme
, &
FmeL
,

2735 (
HEADER_802_11
), &
BHdr
,

2736 
TIMESTAMP_LEN
, &
FakeTimeamp
,

2737 2, &
pAd
->
CommCfg
.
BcPiod
,

2738 2, &
CabyInfo
,

2739 1, &
SsidIe
,

2740 1, &
pAd
->
CommCfg
.
SsidL
,

2741 
pAd
->
CommCfg
.
SsidL
,Ad->CommCfg.
Ssid
,

2742 1, &
SupReIe
,

2743 1, &
SupReL
,

2744 
SupReL
, 
SupRe
,

2745 1, &
DsIe
,

2746 1, &
DsL
,

2747 1, &
pAd
->
CommCfg
.
Chl
,

2748 1, &
IbssIe
,

2749 1, &
IbssL
,

2750 2, &
pAd
->
SAive
.
AtimW
,

2751 
END_OF_ARGS
);

2754 i(
ExtReL
)

2756 
ULONG
 
tmp
;

2758 
	`MakeOutgogFme
(
pBcFme
 + 
FmeL
, &
tmp
,

2759 3, 
LolEIe
,

2760 1, &
ExtReIe
,

2761 1, &
ExtReL
,

2762 
ExtReL
, 
ExtRe
,

2763 
END_OF_ARGS
);

2764 
FmeL
 +
tmp
;

2769 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPANe
)

2772 
UCHAR
 
RSNIe
 = 
IE_WPA
;

2773 
ULONG
 
tmp
;

2775 
	`RTMPMakeRSNIE
(
pAd
,Ad->
SCfg
.
AuthMode
,Ad->SCfg.
WStus
, 
BSS0
);

2777 
	`MakeOutgogFme
(
pBcFme
 + 
FmeL
, &
tmp
,

2778 1, &
RSNIe
,

2779 1, &
pAd
->
SCfg
.
RSNIE_L
,

2780 
pAd
->
SCfg
.
RSNIE_L
,Ad->SCfg.
RSN_IE
,

2781 
END_OF_ARGS
);

2782 
FmeL
 +
tmp
;

2786 #ifde
DOT11_N_SUPPORT


2787 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
&& (pAd->
SCfg
.
bAdhocN
 =
TRUE
))

2789 
ULONG
 
TmpL
;

2790 
UCHAR
 
HtL
, 
HtL1
;

2792 #ifde
RT_BIG_ENDIAN


2793 
HT_CAPABILITY_IE
 
HtCabyTmp
;

2794 
ADD_HT_INFO_IE
 
addHTInfoTmp
;

2795 
USHORT
 
b2lTmp
, 
b2lTmp2
;

2799 
HtL
 = (
pAd
->
CommCfg
.
HtCaby
);

2800 
HtL1
 = (
pAd
->
CommCfg
.
AddHTInfo
);

2801 #ide
RT_BIG_ENDIAN


2802 
	`MakeOutgogFme
(
pBcFme
+
FmeL
, &
TmpL
,

2803 1, &
HtCIe
,

2804 1, &
HtL
,

2805 
HtL
, &
pAd
->
CommCfg
.
HtCaby
,

2806 1, &
AddHtInfoIe
,

2807 1, &
HtL1
,

2808 
HtL1
, &
pAd
->
CommCfg
.
AddHTInfo
,

2809 
END_OF_ARGS
);

2811 
	`NdisMoveMemy
(&
HtCabyTmp
, &
pAd
->
CommCfg
.
HtCaby
, 
HtL
);

2812 *(
USHORT
 *)(&
HtCabyTmp
.
HtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.HtCapInfo));

2813 *(
USHORT
 *)(&
HtCabyTmp
.
ExtHtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.ExtHtCapInfo));

2815 
	`NdisMoveMemy
(&
addHTInfoTmp
, &
pAd
->
CommCfg
.
AddHTInfo
, 
HtL1
);

2816 *(
USHORT
 *)(&
addHTInfoTmp
.
AddHtInfo2

	`SWAP16
(*(USHORT *)(&addHTInfoTmp.AddHtInfo2));

2817 *(
USHORT
 *)(&
addHTInfoTmp
.
AddHtInfo3

	`SWAP16
(*(USHORT *)(&addHTInfoTmp.AddHtInfo3));

2819 
	`MakeOutgogFme
(
pBcFme
+
FmeL
, &
TmpL
,

2820 1, &
HtCIe
,

2821 1, &
HtL
,

2822 
HtL
, &
HtCabyTmp
,

2823 1, &
AddHtInfoIe
,

2824 1, &
HtL1
,

2825 
HtL1
, &
addHTInfoTmp
,

2826 
END_OF_ARGS
);

2828 
FmeL
 +
TmpL
;

2833 i(
pAd
->
CommCfg
.
Chl
 > 14)

2835 
	`RTMPWreTxWI
(
pAd
, 
pTxWI
, 
FALSE
, FALSE, 
TRUE
, FALSE, FALSE, TRUE, 0, 0xff, 
FmeL
,

2836 
PID_MGMT
, 
PID_BEACON
, 
RATE_1
, 
IFS_HTTXOP
, 
FALSE
, &
pAd
->
CommCfg
.
MlmeTnsm
);

2841 
HTTRANSMIT_SETTING
 
Tnsm
;

2842 
Tnsm
.
wd
 = 0;

2843 
	`RTMPWreTxWI
(
pAd
, 
pTxWI
, 
FALSE
, FALSE, 
TRUE
, FALSE, FALSE, TRUE, 0, 0xff, 
FmeL
,

2844 
PID_MGMT
, 
PID_BEACON
, 
RATE_1
, 
IFS_HTTXOP
, 
FALSE
, &
Tnsm
);

2847 #ifde
RT_BIG_ENDIAN


2848 
	`RTMPFmeEndnChge
(
pAd
, 
pBcFme
, 
DIR_WRITE
, 
FALSE
);

2849 
	`RTMPWIEndnChge
((
PUCHAR
)
pTxWI
, 
TYPE_TXWI
);

2852 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MakeIbssBeacon (len=%ld), SupRateLen=%d, ExtRateLen=%d, Channel=%d, PhyMode=%d\n",

2853 
FmeL
, 
SupReL
, 
ExtReL
, 
pAd
->
CommCfg
.
Chl
,Ad->CommCfg.
PhyMode
));

2854  
FmeL
;

2855 
	}
}

2857 
VOID
 
	$InChlRedVue
(

2858 
IN
 
PRTMP_ADAPTER
 
pAd
)

2860 
UCHAR
 
Vue
 = 0;

2861 
UINT32
 
Da
 = 0;

2863 #ifde
RTMP_MAC_PCI


2866 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
Vue
);

2867 if(
pAd
->
A
.
fld
.
RxPh
 == 3)

2869 
Vue
 |= (0x10);

2871 if(
pAd
->
A
.
fld
.
RxPh
 == 2)

2873 
Vue
 |= (0x8);

2875 if(
pAd
->
A
.
fld
.
RxPh
 == 1)

2877 
Vue
 |= (0x0);

2879 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
Vue
);

2880 
pAd
->
SCfg
.
BBPR3
 = 
Vue
;

2883 
pAd
->
CommCfg
.
CChl
 =Ad->
MlmeAux
.CentralChannel;

2884 
pAd
->
CommCfg
.
Chl
 =Ad->
MlmeAux
.Channel;

2885 #ifde
DOT11_N_SUPPORT


2887 i((
pAd
->
CommCfg
.
CChl
 >Ad->CommCfg.
Chl
&& (pAd->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
))

2890 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_40
;

2891 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

2892 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

2894 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
Vue
);

2895 
Vue
 &= (~0x18);

2896 
Vue
 |= 0x10;

2897 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
Vue
);

2900 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
Vue
);

2901 
Vue
 &= (~0x20);

2902 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
Vue
);

2903 #ifde
RTMP_MAC_PCI


2904 
pAd
->
SCfg
.
BBPR3
 = 
Vue
;

2907 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Da
);

2908 
Da
 &= 0xfffffffe;

2909 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Da
);

2911 i(
pAd
->
MACVsi
 == 0x28600100)

2913 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x1A);

2914 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x0A);

2915 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x16);

2916 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!rt2860C !!! \n" ));

2919 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!40MHz Low !!! Cڌ Chȩ Bow. C = %d \n", 
pAd
->
CommCfg
.
CChl
 ));

2921 i((
pAd
->
CommCfg
.
CChl
 <Ad->CommCfg.
Chl
&& (pAd->
MlmeAux
.
HtCaby
.
HtCInfo
.
ChlWidth
 =
BW_40
))

2924 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_40
;

2925 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

2926 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

2928 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
Vue
);

2929 
Vue
 &= (~0x18);

2930 
Vue
 |= 0x10;

2931 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
Vue
);

2933 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Da
);

2934 
Da
 |= 0x1;

2935 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Da
);

2937 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
Vue
);

2938 
Vue
 |= (0x20);

2939 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
Vue
);

2940 #ifde
RTMP_MAC_PCI


2941 
pAd
->
SCfg
.
BBPR3
 = 
Vue
;

2944 i(
pAd
->
MACVsi
 == 0x28600100)

2946 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x1A);

2947 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x0A);

2948 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x16);

2949 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!rt2860C !!! \n" ));

2952 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! 40MHz U !!! Cڌ Chȩ UC = %d \n", 
pAd
->
CommCfg
.
CChl
 ));

2957 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_20
;

2958 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
;

2959 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

2960 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

2962 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
Vue
);

2963 
Vue
 &= (~0x18);

2964 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
Vue
);

2966 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Da
);

2967 
Da
 &= 0xfffffffe;

2968 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Da
);

2970 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
Vue
);

2971 
Vue
 &= (~0x20);

2972 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
Vue
);

2973 #ifde
RTMP_MAC_PCI


2974 
pAd
->
SCfg
.
BBPR3
 = 
Vue
;

2977 i(
pAd
->
MACVsi
 == 0x28600100)

2979 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x16);

2980 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x08);

2981 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x11);

2982 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!rt2860C !!! \n" ));

2985 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! 20MHz !!! \n" ));

2988 
	`RTMPSAGCInVue
(
pAd
,Ad->
CommCfg
.
BBPCutBW
);

2993 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R66
, &pAd->
BbpTung
.
R66CutVue
);

2994 
	}
}

	@sta/dls.c

40 
	~"_cfig.h
"

62 
	$DlsSMacheIn
(

63 
IN
 
PRTMP_ADAPTER
 
pAd
,

64 
IN
 
STATE_MACHINE
 *
Sm
,

65 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[])

67 
UCHAR
 
i
;

69 
	`SMacheIn
(
Sm
, (
STATE_MACHINE_FUNC
*)
Tns
, 
MAX_DLS_STATE
, 
MAX_DLS_MSG
, (STATE_MACHINE_FUNC)
Dr
, 
DLS_IDLE
, 
DLS_MACHINE_BASE
);

72 
	`SMacheSAi
(
Sm
, 
DLS_IDLE
, 
MT2_MLME_DLS_REQ
, (
STATE_MACHINE_FUNC
)
MlmeDlsReqAi
);

73 
	`SMacheSAi
(
Sm
, 
DLS_IDLE
, 
MT2_PEER_DLS_REQ
, (
STATE_MACHINE_FUNC
)
PrDlsReqAi
);

74 
	`SMacheSAi
(
Sm
, 
DLS_IDLE
, 
MT2_PEER_DLS_RSP
, (
STATE_MACHINE_FUNC
)
PrDlsRAi
);

75 
	`SMacheSAi
(
Sm
, 
DLS_IDLE
, 
MT2_MLME_DLS_TEAR_DOWN
, (
STATE_MACHINE_FUNC
)
MlmeDlsTrDownAi
);

76 
	`SMacheSAi
(
Sm
, 
DLS_IDLE
, 
MT2_PEER_DLS_TEAR_DOWN
, (
STATE_MACHINE_FUNC
)
PrDlsTrDownAi
);

78 
i
=0; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

80 
pAd
->
SCfg
.
DLSEry
[
i
].pAd =Ad;

81 
	`RTMPInTim
(
pAd
, &pAd->
SCfg
.
DLSEry
[
i
].
Tim
, 
	`GET_TIMER_FUNCTION
(
DlsTimeoutAi
),Ad, 
FALSE
);

83 
	}
}

93 
VOID
 
	$MlmeDlsReqAi
(

94 
IN
 
PRTMP_ADAPTER
 
pAd
,

95 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

97 
PUCHAR
 
pOutBufr
 = 
NULL
;

98 
NDIS_STATUS
 
NStus
;

99 
ULONG
 
FmeL
 = 0;

100 
HEADER_802_11
 
DlsReqHdr
;

101 
PRT_802_11_DLS
 
pDLS
 = 
NULL
;

102 
UCHAR
 
Cegy
 = 
CATEGORY_DLS
;

103 
UCHAR
 
Ai
 = 
ACTION_DLS_REQUEST
;

104 
ULONG
 
tmp
;

105 
USHORT
 
as
;

106 
ULONG
 
Timeout
;

107 
BOOLEAN
 
TimCed
;

109 if(!
	`MlmeDlsReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, &
pDLS
, &
as
))

112 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - MlmeDlsReqAction() \n"));

114 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

115 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

117 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("DLS - MlmeDlsReqAction()llocate memory failed \n"));

121 
	`AHdIn
(
pAd
, &
DlsReqHdr
,Ad->
CommCfg
.
Bssid
,Ad->
CutAddss
,Ad->CommonCfg.Bssid);

124 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

125 (
HEADER_802_11
), &
DlsReqHdr
,

126 1, &
Cegy
,

127 1, &
Ai
,

128 6, &
pDLS
->
MacAddr
,

129 6, 
pAd
->
CutAddss
,

130 2, &
pAd
->
SAive
.
CabyInfo
,

131 2, &
pDLS
->
TimeOut
,

132 1, &
SupReIe
,

133 1, &
pAd
->
MlmeAux
.
SupReL
,

134 
pAd
->
MlmeAux
.
SupReL
,Ad->MlmeAux.
SupRe
,

135 
END_OF_ARGS
);

137 i(
pAd
->
MlmeAux
.
ExtReL
 != 0)

139 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

140 1, &
ExtReIe
,

141 1, &
pAd
->
MlmeAux
.
ExtReL
,

142 
pAd
->
MlmeAux
.
ExtReL
,Ad->MlmeAux.
ExtRe
,

143 
END_OF_ARGS
);

144 
FmeL
 +
tmp
;

147 #ifde
DOT11_N_SUPPORT


148 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
))

150 
UCHAR
 
HtL
;

152 #ifde
RT_BIG_ENDIAN


153 
HT_CAPABILITY_IE
 
HtCabyTmp
;

157 
HtL
 = (
HT_CAPABILITY_IE
);

158 #ide
RT_BIG_ENDIAN


159 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

160 1, &
HtCIe
,

161 1, &
HtL
,

162 
HtL
, &
pAd
->
CommCfg
.
HtCaby
,

163 
END_OF_ARGS
);

165 
	`NdisMoveMemy
(&
HtCabyTmp
, &
pAd
->
CommCfg
.
HtCaby
, 
HtL
);

166 *(
USHORT
 *)(&
HtCabyTmp
.
HtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.HtCapInfo));

167 *(
USHORT
 *)(&
HtCabyTmp
.
ExtHtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.ExtHtCapInfo));

169 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

170 1, &
HtCIe
,

171 1, &
HtL
,

172 
HtL
, &
HtCabyTmp
,

173 
END_OF_ARGS
);

175 
FmeL
 = FmeL + 
tmp
;

179 
	`RTMPClTim
(&
pDLS
->
Tim
, &
TimCed
);

180 
Timeout
 = 
DLS_TIMEOUT
;

181 
	`RTMPSTim
(&
pDLS
->
Tim
, 
Timeout
);

183 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

184 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

185 
	}
}

195 
VOID
 
	$PrDlsReqAi
(

196 
IN
 
PRTMP_ADAPTER
 
pAd
,

197 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

199 
PUCHAR
 
pOutBufr
 = 
NULL
;

200 
NDIS_STATUS
 
NStus
;

201 
ULONG
 
FmeL
 = 0;

202 
USHORT
 
StusCode
 = 
MLME_SUCCESS
;

203 
HEADER_802_11
 
DlsRHdr
;

204 
UCHAR
 
Cegy
 = 
CATEGORY_DLS
;

205 
UCHAR
 
Ai
 = 
ACTION_DLS_RESPONSE
;

206 
ULONG
 
tmp
;

207 
USHORT
 
CabyInfo
;

208 
UCHAR
 
DA
[
MAC_ADDR_LEN
], 
SA
[MAC_ADDR_LEN];

209 
USHORT
 
DLSTimeOut
;

210 
SHORT
 
i
;

211 
ULONG
 
Timeout
;

212 
BOOLEAN
 
TimCed
;

213 
PRT_802_11_DLS
 
pDLS
 = 
NULL
;

214 
UCHAR
 
MaxSu܋dReIn500Kbps
 = 0;

215 
UCHAR
 
Su܋dResL
;

216 
UCHAR
 
Su܋dRes
[
MAX_LEN_OF_SUPPORTED_RATES
];

217 
UCHAR
 
HtCabyL
;

218 
HT_CAPABILITY_IE
 
HtCaby
;

220 i(!
	`PrDlsReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
DA
, 
SA
, &
CabyInfo
, &
DLSTimeOut
,

221 &
Su܋dResL
, &
Su܋dRes
[0], &
HtCabyL
, &
HtCaby
))

225 
i
 = 0; i < 
Su܋dResL
; i++)

227 i(
MaxSu܋dReIn500Kbps
 < (
Su܋dRes
[
i
] & 0x7f))

228 
MaxSu܋dReIn500Kbps
 = 
Su܋dRes
[
i
] & 0x7f;

231 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - PrDlsReqAi(om %02x:%02x:%02x:%02x:%02x:%02x\n", 
SA
[0], SA[1], SA[2], SA[3], SA[4], SA[5]));

233 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

234 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

236 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("DLS - PeerDlsReqAction()llocate memory failed \n"));

240 i(!
	`INFRA_ON
(
pAd
))

242 
StusCode
 = 
MLME_REQUEST_DECLINED
;

244 i(!
pAd
->
CommCfg
.
bWmmCab
)

246 
StusCode
 = 
MLME_DEST_STA_IS_NOT_A_QSTA
;

248 i(!
pAd
->
CommCfg
.
bDLSCab
)

250 
StusCode
 = 
MLME_REQUEST_DECLINED
;

255 
i
 = (
MAX_NUM_OF_DLS_ENTRY
-1); i >= 0; i--)

257 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && 
	`MAC_ADDR_EQUAL
(
SA
,Ad->SCfg.DLSEry[i].
MacAddr
))

259 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

260 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_WAIT_KEY
;

263 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

264 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_FINISH
;

267 
pAd
->
SCfg
.
DLSEry
[
i
].
Sequ
 = 0;

268 
pAd
->
SCfg
.
DLSEry
[
i
].
TimeOut
 = 
DLSTimeOut
;

269 
pAd
->
SCfg
.
DLSEry
[
i
].
CouDownTim
 = 
DLSTimeOut
;

270 i(
HtCabyL
 != 0)

271 
pAd
->
SCfg
.
DLSEry
[
i
].
bHTC
 = 
TRUE
;

273 
pAd
->
SCfg
.
DLSEry
[
i
].
bHTC
 = 
FALSE
;

274 
pDLS
 = &
pAd
->
SCfg
.
DLSEry
[
i
];

280 i(
i
 < 0)

282 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - PeerDlsReqAction() canot find samentry \n"));

283 
i
=(
MAX_NUM_OF_DLS_ENTRY
 - 1); i >
MAX_NUM_OF_INIT_DLS_ENTRY
; i--)

285 i(!
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
)

287 
MAC_TABLE_ENTRY
 *
pEry
;

288 
UCHAR
 
MaxSu܋dRe
 = 
RATE_11
;

290 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

292 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_WAIT_KEY
;

296 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

297 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_FINISH
;

300 
pAd
->
SCfg
.
DLSEry
[
i
].
Sequ
 = 0;

301 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
TRUE
;

302 
pAd
->
SCfg
.
DLSEry
[
i
].
TimeOut
 = 
DLSTimeOut
;

303 
pAd
->
SCfg
.
DLSEry
[
i
].
CouDownTim
 = 
DLSTimeOut
;

304 
	`NdisMoveMemy
(
pAd
->
SCfg
.
DLSEry
[
i
].
MacAddr
, 
SA
, 
MAC_ADDR_LEN
);

305 i(
HtCabyL
 != 0)

306 
pAd
->
SCfg
.
DLSEry
[
i
].
bHTC
 = 
TRUE
;

308 
pAd
->
SCfg
.
DLSEry
[
i
].
bHTC
 = 
FALSE
;

309 
pDLS
 = &
pAd
->
SCfg
.
DLSEry
[
i
];

310 
pEry
 = 
	`MacTabInDlsEry
(
pAd
, 
SA
, 
i
);

312 
MaxSu܋dReIn500Kbps
)

314 108: 
MaxSu܋dRe
 = 
RATE_54
; ;

315 96: 
MaxSu܋dRe
 = 
RATE_48
; ;

316 72: 
MaxSu܋dRe
 = 
RATE_36
; ;

317 48: 
MaxSu܋dRe
 = 
RATE_24
; ;

318 36: 
MaxSu܋dRe
 = 
RATE_18
; ;

319 24: 
MaxSu܋dRe
 = 
RATE_12
; ;

320 18: 
MaxSu܋dRe
 = 
RATE_9
; ;

321 12: 
MaxSu܋dRe
 = 
RATE_6
; ;

322 22: 
MaxSu܋dRe
 = 
RATE_11
; ;

323 11: 
MaxSu܋dRe
 = 
RATE_5_5
; ;

324 4: 
MaxSu܋dRe
 = 
RATE_2
; ;

325 2: 
MaxSu܋dRe
 = 
RATE_1
; ;

326 : 
MaxSu܋dRe
 = 
RATE_11
; ;

329 
pEry
->
MaxSu܋dRe
 = 
	`m
(
pAd
->
CommCfg
.
MaxTxRe
, MaxSupportedRate);

331 i(
pEry
->
MaxSu܋dRe
 < 
RATE_FIRST_OFDM_RATE
)

333 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

334 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

335 
pEry
->
MHTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

336 
pEry
->
MHTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

337 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

338 
pEry
->
HTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

342 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

343 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

344 
pEry
->
MHTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

345 
pEry
->
MHTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

346 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

347 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

350 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 
BW_20
;

351 
pEry
->
MHTPhyMode
.
fld
.
BW
 = 
BW_20
;

353 #ifde
DOT11_N_SUPPORT


354 
pEry
->
HTCaby
.
MCSS
[0] = 0;

355 
pEry
->
HTCaby
.
MCSS
[1] = 0;

358 i((
HtCabyL
 !0&& (
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
))

360 
UCHAR
 
j
, 
bmask
;

361 
CHAR
 
ii
;

363 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("DLS - PeerDlsReqAction() Receive Peer HT Capable STA from %02x:%02x:%02x:%02x:%02x:%02x\n",

364 
SA
[0], SA[1], SA[2], SA[3], SA[4], SA[5]));

366 i((
HtCaby
.
HtCInfo
.
GF
&& (
pAd
->
CommCfg
.
DesedHtPhy
.GF))

368 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTGREENFIELD
;

372 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTMIX
;

373 
pAd
->
MacTab
.
fAnyStiNGF
 = 
TRUE
;

374 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo2
.
NGfP
 = 1;

377 i((
HtCaby
.
HtCInfo
.
ChlWidth
&& (
pAd
->
CommCfg
.
DesedHtPhy
.ChannelWidth))

379 
pEry
->
MaxHTPhyMode
.
fld
.
BW

BW_40
;

380 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = ((
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf40
)&(
HtCaby
.
HtCInfo
.ShortGIfor40));

384 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 
BW_20
;

385 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = ((
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf20
)&(
HtCaby
.
HtCInfo
.ShortGIfor20));

386 
pAd
->
MacTab
.
fAnySti20Oy
 = 
TRUE
;

390 
ii
=15; ii>=0; ii--)

392 
j
 = 
ii
/8;

393 
bmask
 = (1<<(
ii
-(
j
*8)));

394 i(
pAd
->
SCfg
.
DesedHtPhyInfo
.
MCSS
[
j
]&
bmask
&& (
HtCaby
.MCSSet[j]&bitmask))

396 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
ii
;

399 i(
ii
==0)

404 i(
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 !
MCS_AUTO
)

407 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("@@@Ad->CommonCfg.RegTransmitSetting.field.MCS = %d\n",

408 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
));

409 i(
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 == 32)

412 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 1;

413 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTMIX
;

414 
pEry
->
MaxHTPhyMode
.
fld
.
STBC
 = 0;

415 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = 0;

416 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 32;

418 i(
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 > 
pAd
->
SCfg
.
HTPhyMode
.field.MCS)

421 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.
HTPhyMode
.field.MCS;

425 
pEry
->
MaxHTPhyMode
.
fld
.
STBC
 = (
HtCaby
.
HtCInfo
.
RxSTBC
 & (
pAd
->
CommCfg
.
DesedHtPhy
.
TxSTBC
));

426 
pEry
->
MpduDsy
 = 
HtCaby
.
HtCPm
.MpduDensity;

427 
pEry
->
MaxRAmpduFa
 = 
HtCaby
.
HtCPm
.MaxRAmpduFactor;

428 
pEry
->
MmpsMode
 = (
UCHAR
)
HtCaby
.
HtCInfo
.
MimoPs
;

429 
pEry
->
AMsduSize
 = (
UCHAR
)
HtCaby
.
HtCInfo
.AMsduSize;

430 
pEry
->
HTPhyMode
.
wd
 =Ery->
MaxHTPhyMode
.word;

432 i(
HtCaby
.
HtCInfo
.
ShtGIf20
)

433 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_SGI20_CAPABLE
);

434 i(
HtCaby
.
HtCInfo
.
ShtGIf40
)

435 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_SGI40_CAPABLE
);

436 i(
HtCaby
.
HtCInfo
.
TxSTBC
)

437 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_TxSTBC_CAPABLE
);

438 i(
HtCaby
.
HtCInfo
.
RxSTBC
)

439 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_RxSTBC_CAPABLE
);

440 i(
HtCaby
.
ExtHtCInfo
.
PlusHTC
)

441 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_HTC_CAPABLE
);

442 i(
pAd
->
CommCfg
.
bRdg
 && 
HtCaby
.
ExtHtCInfo
.
RDGSut
)

443 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_RDG_CAPABLE
);

444 i(
HtCaby
.
ExtHtCInfo
.
MCSFdback
 == 0x03)

445 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_MCSFEEDBACK_CAPABLE
);

447 
	`NdisMoveMemy
(&
pEry
->
HTCaby
, &
HtCaby
, (
HT_CAPABILITY_IE
));

451 
pEry
->
HTPhyMode
.
wd
 =Ery->
MaxHTPhyMode
.word;

452 
pEry
->
CuTxRe
 =Ery->
MaxSu܋dRe
;

453 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_WMM_CAPABLE
);

455 i(
pAd
->
SCfg
.
bAutoTxReSwch
 =
TRUE
)

457 
PUCHAR
 
pTab
;

458 
UCHAR
 
TabSize
 = 0;

460 
	`MlmeSeTxReTab
(
pAd
, 
pEry
, &
pTab
, &
TabSize
, &pEry->
CuTxReIndex
);

461 
pEry
->
bAutoTxReSwch
 = 
TRUE
;

465 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
pAd
->
SCfg
.HTPhyMode.field.MODE;

466 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.HTPhyMode.field.MCS;

467 
pEry
->
bAutoTxReSwch
 = 
FALSE
;

469 
	`RTMPUpdeLegacyTxStg
((
UCHAR
)
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
, 
pEry
);

471 
pEry
->
ReL
 = 
Su܋dResL
;

477 
StusCode
 = 
MLME_SUCCESS
;

480 i(
i
 < 0)

482 
StusCode
 = 
MLME_QOS_UNSPECIFY
;

483 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("DLS - PrDlsReqAi(DLSEryab fu(ly c su܈%d DLS sessi\n", 
MAX_NUM_OF_DLS_ENTRY
 - 
MAX_NUM_OF_INIT_DLS_ENTRY
));

487 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - PeerDlsReqAction() usentry(%d) %02x:%02x:%02x:%02x:%02x:%02x\n",

488 
i
, 
SA
[0], SA[1], SA[2], SA[3], SA[4], SA[5]));

492 
	`AHdIn
(
pAd
, &
DlsRHdr
,Ad->
CommCfg
.
Bssid
,Ad->
CutAddss
,Ad->CommonCfg.Bssid);

495 i(
StusCode
 =
MLME_SUCCESS
)

497 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

498 (
HEADER_802_11
), &
DlsRHdr
,

499 1, &
Cegy
,

500 1, &
Ai
,

501 2, &
StusCode
,

502 6, 
SA
,

503 6, 
pAd
->
CutAddss
,

504 2, &
pAd
->
SAive
.
CabyInfo
,

505 1, &
SupReIe
,

506 1, &
pAd
->
MlmeAux
.
SupReL
,

507 
pAd
->
MlmeAux
.
SupReL
,Ad->MlmeAux.
SupRe
,

508 
END_OF_ARGS
);

510 i(
pAd
->
MlmeAux
.
ExtReL
 != 0)

512 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

513 1, &
ExtReIe
,

514 1, &
pAd
->
MlmeAux
.
ExtReL
,

515 
pAd
->
MlmeAux
.
ExtReL
,Ad->MlmeAux.
ExtRe
,

516 
END_OF_ARGS
);

517 
FmeL
 +
tmp
;

520 #ifde
DOT11_N_SUPPORT


521 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
))

523 
UCHAR
 
HtL
;

525 #ifde
RT_BIG_ENDIAN


526 
HT_CAPABILITY_IE
 
HtCabyTmp
;

530 
HtL
 = (
HT_CAPABILITY_IE
);

531 #ide
RT_BIG_ENDIAN


532 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

533 1, &
HtCIe
,

534 1, &
HtL
,

535 
HtL
, &
pAd
->
CommCfg
.
HtCaby
,

536 
END_OF_ARGS
);

538 
	`NdisMoveMemy
(&
HtCabyTmp
, &
pAd
->
CommCfg
.
HtCaby
, 
HtL
);

539 *(
USHORT
 *)(&
HtCabyTmp
.
HtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.HtCapInfo));

540 *(
USHORT
 *)(&
HtCabyTmp
.
ExtHtCInfo

	`SWAP16
(*(USHORT *)(&HtCapabilityTmp.ExtHtCapInfo));

542 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

543 1, &
HtCIe
,

544 1, &
HtL
,

545 
HtL
, &
HtCabyTmp
,

546 
END_OF_ARGS
);

548 
FmeL
 = FmeL + 
tmp
;

552 i(
pDLS
 && (pDLS->
Stus
 !
DLS_FINISH
))

554 
	`RTMPClTim
(&
pDLS
->
Tim
, &
TimCed
);

555 
Timeout
 = 
DLS_TIMEOUT
;

556 
	`RTMPSTim
(&
pDLS
->
Tim
, 
Timeout
);

561 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

562 (
HEADER_802_11
), &
DlsRHdr
,

563 1, &
Cegy
,

564 1, &
Ai
,

565 2, &
StusCode
,

566 6, 
SA
,

567 6, 
pAd
->
CutAddss
,

568 
END_OF_ARGS
);

571 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

572 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

573 
	}
}

583 
VOID
 
	$PrDlsRAi
(

584 
IN
 
PRTMP_ADAPTER
 
pAd
,

585 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

587 
USHORT
 
CabyInfo
;

588 
UCHAR
 
DA
[
MAC_ADDR_LEN
], 
SA
[MAC_ADDR_LEN];

589 
USHORT
 
StusCode
;

590 
SHORT
 
i
;

591 
BOOLEAN
 
TimCed
;

592 
UCHAR
 
MaxSu܋dReIn500Kbps
 = 0;

593 
UCHAR
 
Su܋dResL
;

594 
UCHAR
 
Su܋dRes
[
MAX_LEN_OF_SUPPORTED_RATES
];

595 
UCHAR
 
HtCabyL
;

596 
HT_CAPABILITY_IE
 
HtCaby
;

598 i(!
pAd
->
CommCfg
.
bDLSCab
)

601 i(!
	`INFRA_ON
(
pAd
))

604 i(!
	`PrDlsRSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
DA
, 
SA
, &
CabyInfo
, &
StusCode
,

605 &
Su܋dResL
, &
Su܋dRes
[0], &
HtCabyL
, &
HtCaby
))

609 
i
=0; i<
Su܋dResL
; i++)

611 i(
MaxSu܋dReIn500Kbps
 < (
Su܋dRes
[
i
] & 0x7f))

612 
MaxSu܋dReIn500Kbps
 = 
Su܋dRes
[
i
] & 0x7f;

615 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - PeerDlsRspAction() from %02x:%02x:%02x:%02x:%02x:%02x with StatusCode=%d, CapabilityInfo=0x%x\n",

616 
SA
[0], SA[1], SA[2], SA[3], SA[4], SA[5], 
StusCode
, 
CabyInfo
));

618 
i
 = 0; i < 
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

620 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && 
	`MAC_ADDR_EQUAL
(
SA
,Ad->SCfg.DLSEry[i].
MacAddr
))

622 i(
StusCode
 =
MLME_SUCCESS
)

624 
MAC_TABLE_ENTRY
 *
pEry
;

625 
UCHAR
 
MaxSu܋dRe
 = 
RATE_11
;

627 
pEry
 = 
	`MacTabInDlsEry
(
pAd
, 
SA
, 
i
);

629 
MaxSu܋dReIn500Kbps
)

631 108: 
MaxSu܋dRe
 = 
RATE_54
; ;

632 96: 
MaxSu܋dRe
 = 
RATE_48
; ;

633 72: 
MaxSu܋dRe
 = 
RATE_36
; ;

634 48: 
MaxSu܋dRe
 = 
RATE_24
; ;

635 36: 
MaxSu܋dRe
 = 
RATE_18
; ;

636 24: 
MaxSu܋dRe
 = 
RATE_12
; ;

637 18: 
MaxSu܋dRe
 = 
RATE_9
; ;

638 12: 
MaxSu܋dRe
 = 
RATE_6
; ;

639 22: 
MaxSu܋dRe
 = 
RATE_11
; ;

640 11: 
MaxSu܋dRe
 = 
RATE_5_5
; ;

641 4: 
MaxSu܋dRe
 = 
RATE_2
; ;

642 2: 
MaxSu܋dRe
 = 
RATE_1
; ;

643 : 
MaxSu܋dRe
 = 
RATE_11
; ;

646 
pEry
->
MaxSu܋dRe
 = 
	`m
(
pAd
->
CommCfg
.
MaxTxRe
, MaxSupportedRate);

648 i(
pEry
->
MaxSu܋dRe
 < 
RATE_FIRST_OFDM_RATE
)

650 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

651 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

652 
pEry
->
MHTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

653 
pEry
->
MHTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

654 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

655 
pEry
->
HTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

659 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

660 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

661 
pEry
->
MHTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

662 
pEry
->
MHTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

663 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

664 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

667 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 
BW_20
;

668 
pEry
->
MHTPhyMode
.
fld
.
BW
 = 
BW_20
;

670 #ifde
DOT11_N_SUPPORT


671 
pEry
->
HTCaby
.
MCSS
[0] = 0;

672 
pEry
->
HTCaby
.
MCSS
[1] = 0;

675 i((
HtCabyL
 !0&& (
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
))

677 
UCHAR
 
j
, 
bmask
;

678 
CHAR
 
ii
;

680 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("DLS - PeerDlsRspAction Receive Peer HT Capable STA from %02x:%02x:%02x:%02x:%02x:%02x\n",

681 
SA
[0], SA[1], SA[2], SA[3], SA[4], SA[5]));

683 i((
HtCaby
.
HtCInfo
.
GF
&& (
pAd
->
CommCfg
.
DesedHtPhy
.GF))

685 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTGREENFIELD
;

689 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTMIX
;

690 
pAd
->
MacTab
.
fAnyStiNGF
 = 
TRUE
;

691 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo2
.
NGfP
 = 1;

694 i((
HtCaby
.
HtCInfo
.
ChlWidth
&& (
pAd
->
CommCfg
.
DesedHtPhy
.ChannelWidth))

696 
pEry
->
MaxHTPhyMode
.
fld
.
BW

BW_40
;

697 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = ((
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf40
)&(
HtCaby
.
HtCInfo
.ShortGIfor40));

701 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 
BW_20
;

702 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = ((
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf20
)&(
HtCaby
.
HtCInfo
.ShortGIfor20));

703 
pAd
->
MacTab
.
fAnySti20Oy
 = 
TRUE
;

707 
ii
=15; ii>=0; ii--)

709 
j
 = 
ii
/8;

710 
bmask
 = (1<<(
ii
-(
j
*8)));

711 i(
pAd
->
SCfg
.
DesedHtPhyInfo
.
MCSS
[
j
]&
bmask
&& (
HtCaby
.MCSSet[j]&bitmask))

713 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
ii
;

716 i(
ii
==0)

720 i(
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 !
MCS_AUTO
)

722 i(
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 == 32)

725 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 1;

726 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTMIX
;

727 
pEry
->
MaxHTPhyMode
.
fld
.
STBC
 = 0;

728 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = 0;

729 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 32;

731 i(
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 > 
pAd
->
SCfg
.
HTPhyMode
.field.MCS)

734 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.
HTPhyMode
.field.MCS;

738 
pEry
->
MaxHTPhyMode
.
fld
.
STBC
 = (
HtCaby
.
HtCInfo
.
RxSTBC
 & (
pAd
->
CommCfg
.
DesedHtPhy
.
TxSTBC
));

739 
pEry
->
MpduDsy
 = 
HtCaby
.
HtCPm
.MpduDensity;

740 
pEry
->
MaxRAmpduFa
 = 
HtCaby
.
HtCPm
.MaxRAmpduFactor;

741 
pEry
->
MmpsMode
 = (
UCHAR
)
HtCaby
.
HtCInfo
.
MimoPs
;

742 
pEry
->
AMsduSize
 = (
UCHAR
)
HtCaby
.
HtCInfo
.AMsduSize;

743 
pEry
->
HTPhyMode
.
wd
 =Ery->
MaxHTPhyMode
.word;

745 i(
HtCaby
.
HtCInfo
.
ShtGIf20
)

746 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_SGI20_CAPABLE
);

747 i(
HtCaby
.
HtCInfo
.
ShtGIf40
)

748 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_SGI40_CAPABLE
);

749 i(
HtCaby
.
HtCInfo
.
TxSTBC
)

750 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_TxSTBC_CAPABLE
);

751 i(
HtCaby
.
HtCInfo
.
RxSTBC
)

752 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_RxSTBC_CAPABLE
);

753 i(
HtCaby
.
ExtHtCInfo
.
PlusHTC
)

754 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_HTC_CAPABLE
);

755 i(
pAd
->
CommCfg
.
bRdg
 && 
HtCaby
.
ExtHtCInfo
.
RDGSut
)

756 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_RDG_CAPABLE
);

757 i(
HtCaby
.
ExtHtCInfo
.
MCSFdback
 == 0x03)

758 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_MCSFEEDBACK_CAPABLE
);

760 
	`NdisMoveMemy
(&
pEry
->
HTCaby
, &
HtCaby
, (
HT_CAPABILITY_IE
));

763 
pEry
->
HTPhyMode
.
wd
 =Ery->
MaxHTPhyMode
.word;

764 
pEry
->
CuTxRe
 =Ery->
MaxSu܋dRe
;

765 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_WMM_CAPABLE
);

767 i(
pAd
->
SCfg
.
bAutoTxReSwch
 =
TRUE
)

769 
PUCHAR
 
pTab
;

770 
UCHAR
 
TabSize
 = 0;

772 
	`MlmeSeTxReTab
(
pAd
, 
pEry
, &
pTab
, &
TabSize
, &pEry->
CuTxReIndex
);

773 
pEry
->
bAutoTxReSwch
 = 
TRUE
;

777 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
pAd
->
SCfg
.HTPhyMode.field.MODE;

778 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.HTPhyMode.field.MCS;

779 
pEry
->
bAutoTxReSwch
 = 
FALSE
;

781 
	`RTMPUpdeLegacyTxStg
((
UCHAR
)
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
, 
pEry
);

783 
pEry
->
ReL
 = 
Su܋dResL
;

785 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

789 i(
	`RTMPSdSTAKeyReque
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
!
NDIS_STATUS_SUCCESS
)

791 
MLME_DLS_REQ_STRUCT
 
MlmeDlsReq
;

792 
USHORT
 
as
 = 
REASON_QOS_CIPHER_NOT_SUPPORT
;

794 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

795 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_TEAR_DOWN
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

796 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

797 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

798 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("DLS - PeerDlsRspAction failed when call RTMPSendSTAKeyRequest \n"));

802 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_WAIT_KEY
;

803 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - waiting for STAKey handshakerocedure\n"));

808 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

809 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_FINISH
;

810 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - PrDlsRAi(om %02x:%02x:%02x:%02x:%02x:%02x Suced wh WEP onأcury\n", 
SA
[0], SA[1], SA[2], SA[3], SA[4], SA[5]));

814 
pAd
->
SCfg
.
DLSEry
[
i
].
Sequ
 = 0;

815 i(
HtCabyL
 != 0)

816 
pAd
->
SCfg
.
DLSEry
[
i
].
bHTC
 = 
TRUE
;

818 
pAd
->
SCfg
.
DLSEry
[
i
].
bHTC
 = 
FALSE
;

823 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

824 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

825 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

826 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("DLS - PrDlsRAi faed wh StusCode=%d \n", 
StusCode
));

831 i(
i
 >
MAX_NUM_OF_INIT_DLS_ENTRY
)

833 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - PeerDlsRspAction() updateimeout value \n"));

834 
i
=(
MAX_NUM_OF_DLS_ENTRY
-1); i>=
MAX_NUM_OF_INIT_DLS_ENTRY
; i--)

836 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && 
	`MAC_ADDR_EQUAL
(
SA
,Ad->SCfg.DLSEry[i].
MacAddr
))

838 i(
StusCode
 =
MLME_SUCCESS
)

840 
MAC_TABLE_ENTRY
 *
pEry
;

841 
UCHAR
 
MaxSu܋dRe
 = 
RATE_11
;

843 
pEry
 = 
	`MacTabInDlsEry
(
pAd
, 
SA
, 
i
);

845 
MaxSu܋dReIn500Kbps
)

847 108: 
MaxSu܋dRe
 = 
RATE_54
; ;

848 96: 
MaxSu܋dRe
 = 
RATE_48
; ;

849 72: 
MaxSu܋dRe
 = 
RATE_36
; ;

850 48: 
MaxSu܋dRe
 = 
RATE_24
; ;

851 36: 
MaxSu܋dRe
 = 
RATE_18
; ;

852 24: 
MaxSu܋dRe
 = 
RATE_12
; ;

853 18: 
MaxSu܋dRe
 = 
RATE_9
; ;

854 12: 
MaxSu܋dRe
 = 
RATE_6
; ;

855 22: 
MaxSu܋dRe
 = 
RATE_11
; ;

856 11: 
MaxSu܋dRe
 = 
RATE_5_5
; ;

857 4: 
MaxSu܋dRe
 = 
RATE_2
; ;

858 2: 
MaxSu܋dRe
 = 
RATE_1
; ;

859 : 
MaxSu܋dRe
 = 
RATE_11
; ;

862 
pEry
->
MaxSu܋dRe
 = 
	`m
(
pAd
->
CommCfg
.
MaxTxRe
, MaxSupportedRate);

864 i(
pEry
->
MaxSu܋dRe
 < 
RATE_FIRST_OFDM_RATE
)

866 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

867 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

868 
pEry
->
MHTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

869 
pEry
->
MHTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

870 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
MODE_CCK
;

871 
pEry
->
HTPhyMode
.
fld
.
MCS
 =Ery->
MaxSu܋dRe
;

875 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

876 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

877 
pEry
->
MHTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

878 
pEry
->
MHTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

879 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
MODE_OFDM
;

880 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
OfdmReToRxwiMCS
[pEry->
MaxSu܋dRe
];

883 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 
BW_20
;

884 
pEry
->
MHTPhyMode
.
fld
.
BW
 = 
BW_20
;

886 #ifde
DOT11_N_SUPPORT


887 
pEry
->
HTCaby
.
MCSS
[0] = 0;

888 
pEry
->
HTCaby
.
MCSS
[1] = 0;

891 i((
HtCabyL
 !0&& (
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
))

893 
UCHAR
 
j
, 
bmask
;

894 
CHAR
 
ii
;

896 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("DLS - PeerDlsRspAction Receive Peer HT Capable STA from %02x:%02x:%02x:%02x:%02x:%02x\n",

897 
SA
[0], SA[1], SA[2], SA[3], SA[4], SA[5]));

899 i((
HtCaby
.
HtCInfo
.
GF
&& (
pAd
->
CommCfg
.
DesedHtPhy
.GF))

901 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTGREENFIELD
;

905 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTMIX
;

906 
pAd
->
MacTab
.
fAnyStiNGF
 = 
TRUE
;

907 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo2
.
NGfP
 = 1;

910 i((
HtCaby
.
HtCInfo
.
ChlWidth
&& (
pAd
->
CommCfg
.
DesedHtPhy
.ChannelWidth))

912 
pEry
->
MaxHTPhyMode
.
fld
.
BW

BW_40
;

913 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = ((
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf40
)&(
HtCaby
.
HtCInfo
.ShortGIfor40));

917 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 
BW_20
;

918 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = ((
pAd
->
CommCfg
.
DesedHtPhy
.
ShtGIf20
)&(
HtCaby
.
HtCInfo
.ShortGIfor20));

919 
pAd
->
MacTab
.
fAnySti20Oy
 = 
TRUE
;

923 
ii
=15; ii>=0; ii--)

925 
j
 = 
ii
/8;

926 
bmask
 = (1<<(
ii
-(
j
*8)));

927 i(
pAd
->
SCfg
.
DesedHtPhyInfo
.
MCSS
[
j
]&
bmask
&& (
HtCaby
.MCSSet[j]&bitmask))

929 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
ii
;

932 i(
ii
==0)

936 i(
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 !
MCS_AUTO
)

938 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("@@@Ad->CommonCfg.RegTransmitSetting.field.MCS = %d\n",

939 
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
));

940 i(
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
MCS
 == 32)

943 
pEry
->
MaxHTPhyMode
.
fld
.
BW
 = 1;

944 
pEry
->
MaxHTPhyMode
.
fld
.
MODE
 = 
MODE_HTMIX
;

945 
pEry
->
MaxHTPhyMode
.
fld
.
STBC
 = 0;

946 
pEry
->
MaxHTPhyMode
.
fld
.
ShtGI
 = 0;

947 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 32;

949 i(
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 > 
pAd
->
SCfg
.
HTPhyMode
.field.MCS)

952 
pEry
->
MaxHTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.
HTPhyMode
.field.MCS;

956 
pEry
->
MaxHTPhyMode
.
fld
.
STBC
 = (
HtCaby
.
HtCInfo
.
RxSTBC
 & (
pAd
->
CommCfg
.
DesedHtPhy
.
TxSTBC
));

957 
pEry
->
MpduDsy
 = 
HtCaby
.
HtCPm
.MpduDensity;

958 
pEry
->
MaxRAmpduFa
 = 
HtCaby
.
HtCPm
.MaxRAmpduFactor;

959 
pEry
->
MmpsMode
 = (
UCHAR
)
HtCaby
.
HtCInfo
.
MimoPs
;

960 
pEry
->
AMsduSize
 = (
UCHAR
)
HtCaby
.
HtCInfo
.AMsduSize;

961 
pEry
->
HTPhyMode
.
wd
 =Ery->
MaxHTPhyMode
.word;

963 i(
HtCaby
.
HtCInfo
.
ShtGIf20
)

964 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_SGI20_CAPABLE
);

965 i(
HtCaby
.
HtCInfo
.
ShtGIf40
)

966 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_SGI40_CAPABLE
);

967 i(
HtCaby
.
HtCInfo
.
TxSTBC
)

968 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_TxSTBC_CAPABLE
);

969 i(
HtCaby
.
HtCInfo
.
RxSTBC
)

970 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_RxSTBC_CAPABLE
);

971 i(
HtCaby
.
ExtHtCInfo
.
PlusHTC
)

972 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_HTC_CAPABLE
);

973 i(
pAd
->
CommCfg
.
bRdg
 && 
HtCaby
.
ExtHtCInfo
.
RDGSut
)

974 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_RDG_CAPABLE
);

975 i(
HtCaby
.
ExtHtCInfo
.
MCSFdback
 == 0x03)

976 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_MCSFEEDBACK_CAPABLE
);

978 
	`NdisMoveMemy
(&
pEry
->
HTCaby
, &
HtCaby
, (
HT_CAPABILITY_IE
));

982 
pEry
->
HTPhyMode
.
wd
 =Ery->
MaxHTPhyMode
.word;

983 
pEry
->
CuTxRe
 =Ery->
MaxSu܋dRe
;

984 
	`CLIENT_STATUS_SET_FLAG
(
pEry
, 
fCLIENT_STATUS_WMM_CAPABLE
);

986 i(
pAd
->
SCfg
.
bAutoTxReSwch
 =
TRUE
)

988 
PUCHAR
 
pTab
;

989 
UCHAR
 
TabSize
 = 0;

991 
	`MlmeSeTxReTab
(
pAd
, 
pEry
, &
pTab
, &
TabSize
, &pEry->
CuTxReIndex
);

992 
pEry
->
bAutoTxReSwch
 = 
TRUE
;

996 
pEry
->
HTPhyMode
.
fld
.
MODE
 = 
pAd
->
SCfg
.HTPhyMode.field.MODE;

997 
pEry
->
HTPhyMode
.
fld
.
MCS
 = 
pAd
->
SCfg
.HTPhyMode.field.MCS;

998 
pEry
->
bAutoTxReSwch
 = 
FALSE
;

1000 
	`RTMPUpdeLegacyTxStg
((
UCHAR
)
pAd
->
SCfg
.
DesedTnsmStg
.
fld
.
FixedTxMode
, 
pEry
);

1002 
pEry
->
ReL
 = 
Su܋dResL
;

1004 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

1008 i(
	`RTMPSdSTAKeyReque
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
!
NDIS_STATUS_SUCCESS
)

1010 
MLME_DLS_REQ_STRUCT
 
MlmeDlsReq
;

1011 
USHORT
 
as
 = 
REASON_QOS_CIPHER_NOT_SUPPORT
;

1013 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

1014 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_TEAR_DOWN
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

1015 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

1016 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

1017 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("DLS - PeerDlsRspAction failed when call RTMPSendSTAKeyRequest \n"));

1021 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_WAIT_KEY
;

1022 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - waiting for STAKey handshakerocedure\n"));

1027 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

1028 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_FINISH
;

1029 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - PrDlsRAi(om %02x:%02x:%02x:%02x:%02x:%02x Suced wh WEP onأcury\n", 
SA
[0], SA[1], SA[2], SA[3], SA[4], SA[5]));

1031 
pAd
->
SCfg
.
DLSEry
[
i
].
Sequ
 = 0;

1032 i(
HtCabyL
 != 0)

1033 
pAd
->
SCfg
.
DLSEry
[
i
].
bHTC
 = 
TRUE
;

1035 
pAd
->
SCfg
.
DLSEry
[
i
].
bHTC
 = 
FALSE
;

1040 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

1041 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

1042 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

1043 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("DLS - PrDlsRAi faed wh StusCode=%d \n", 
StusCode
));

1048 
	}
}

1058 
VOID
 
	$MlmeDlsTrDownAi
(

1059 
IN
 
PRTMP_ADAPTER
 
pAd
,

1060 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1062 
PUCHAR
 
pOutBufr
 = 
NULL
;

1063 
NDIS_STATUS
 
NStus
;

1064 
ULONG
 
FmeL
 = 0;

1065 
UCHAR
 
Cegy
 = 
CATEGORY_DLS
;

1066 
UCHAR
 
Ai
 = 
ACTION_DLS_TEARDOWN
;

1067 
USHORT
 
RsCode
 = 
REASON_QOS_UNSPECIFY
;

1068 
HEADER_802_11
 
DlsTrDownHdr
;

1069 
PRT_802_11_DLS
 
pDLS
;

1070 
BOOLEAN
 
TimCed
;

1071 
UCHAR
 
i
;

1073 if(!
	`MlmeDlsReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, &
pDLS
, &
RsCode
))

1076 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - MlmeDlsTrDownAi(wh RsCode=%d \n", 
RsCode
));

1078 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

1079 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

1081 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("DLS - MlmeDlsTearDownAction()llocate memory failed \n"));

1085 
	`AHdIn
(
pAd
, &
DlsTrDownHdr
,Ad->
CommCfg
.
Bssid
,Ad->
CutAddss
,Ad->CommonCfg.Bssid);

1088 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1089 (
HEADER_802_11
), &
DlsTrDownHdr
,

1090 1, &
Cegy
,

1091 1, &
Ai
,

1092 6, &
pDLS
->
MacAddr
,

1093 6, 
pAd
->
CutAddss
,

1094 2, &
RsCode
,

1095 
END_OF_ARGS
);

1097 
	`MtMMReque
(
pAd
, 
QID_AC_BE
, 
pOutBufr
, 
FmeL
);

1098 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1099 
	`RTMPClTim
(&
pDLS
->
Tim
, &
TimCed
);

1102 
i
 = 0; i < 
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

1104 i(
	`MAC_ADDR_EQUAL
(
pDLS
->
MacAddr
, 
pAd
->
SCfg
.
DLSEry
[
i
].MacAddr))

1106 
	`MacTabDeDlsEry
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
,Ad->SCfg.DLSEry[i].
MacAddr
);

1111 
i
 = 
MAX_NUM_OF_INIT_DLS_ENTRY
; i < 
MAX_NUM_OF_DLS_ENTRY
; i++)

1113 i(
	`MAC_ADDR_EQUAL
(
pDLS
->
MacAddr
, 
pAd
->
SCfg
.
DLSEry
[
i
].MacAddr))

1115 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

1116 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

1117 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

1118 
	`MacTabDeDlsEry
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
,Ad->SCfg.DLSEry[i].
MacAddr
);

1121 
	}
}

1131 
VOID
 
	$PrDlsTrDownAi
(

1132 
IN
 
PRTMP_ADAPTER
 
pAd
,

1133 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1135 
UCHAR
 
DA
[
MAC_ADDR_LEN
], 
SA
[MAC_ADDR_LEN];

1136 
USHORT
 
RsCode
;

1137 
UINT
 
i
;

1138 
BOOLEAN
 
TimCed
;

1140 i(!
pAd
->
CommCfg
.
bDLSCab
)

1143 i(!
	`INFRA_ON
(
pAd
))

1146 i(!
	`PrDlsTrDownSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
DA
, 
SA
, &
RsCode
))

1149 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - PrDlsTrDownAi(om %02x:%02x:%02x:%02x:%02x:%02x wh RsCode=%d\n", 
SA
[0], SA[1], SA[2], SA[3], SA[4], SA[5], 
RsCode
));

1152 
i
=0; i<
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

1154 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && 
	`MAC_ADDR_EQUAL
(
SA
,Ad->SCfg.DLSEry[i].
MacAddr
))

1156 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

1157 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

1158 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

1161 
	`MacTabDeDlsEry
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
,Ad->SCfg.DLSEry[i].
MacAddr
);

1166 
i
=
MAX_NUM_OF_INIT_DLS_ENTRY
; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

1168 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && 
	`MAC_ADDR_EQUAL
(
SA
,Ad->SCfg.DLSEry[i].
MacAddr
))

1170 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

1171 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

1172 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

1175 
	`MacTabDeDlsEry
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
,Ad->SCfg.DLSEry[i].
MacAddr
);

1178 
	}
}

1188 
VOID
 
	$RTMPCheckDLSTimeOut
(

1189 
IN
 
PRTMP_ADAPTER
 
pAd
)

1191 
ULONG
 
i
;

1192 
MLME_DLS_REQ_STRUCT
 
MlmeDlsReq
;

1193 
USHORT
 
as
 = 
REASON_QOS_UNSPECIFY
;

1195 i(! 
pAd
->
CommCfg
.
bDLSCab
)

1198 i(! 
	`INFRA_ON
(
pAd
))

1204 
i
=0; i<
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

1206 i((
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
&& (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
)

1207 && (
pAd
->
SCfg
.
DLSEry
[
i
].
TimeOut
 != 0))

1209 
pAd
->
SCfg
.
DLSEry
[
i
].
CouDownTim
 --;

1211 i(
pAd
->
SCfg
.
DLSEry
[
i
].
CouDownTim
 == 0)

1213 
as
 = 
REASON_QOS_REQUEST_TIMEOUT
;

1214 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

1215 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

1216 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

1217 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_TEAR_DOWN
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

1223 
i
=
MAX_NUM_OF_INIT_DLS_ENTRY
; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

1225 i((
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
&& (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
)

1226 && (
pAd
->
SCfg
.
DLSEry
[
i
].
TimeOut
 != 0))

1228 
pAd
->
SCfg
.
DLSEry
[
i
].
CouDownTim
 --;

1230 i(
pAd
->
SCfg
.
DLSEry
[
i
].
CouDownTim
 == 0)

1232 
as
 = 
REASON_QOS_REQUEST_TIMEOUT
;

1233 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

1234 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

1235 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

1236 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_TEAR_DOWN
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

1240 
	}
}

1250 
BOOLEAN
 
	$RTMPRcvFmeDLSCheck
(

1251 
IN
 
PRTMP_ADAPTER
 
pAd
,

1252 
IN
 
PHEADER_802_11
 
pHd
,

1253 
IN
 
ULONG
 
L
,

1254 
IN
 
PRT28XX_RXD_STRUC
 
pRxD
)

1256 
ULONG
 
i
;

1257 
BOOLEAN
 
bFdEry
 = 
FALSE
;

1258 
BOOLEAN
 
bSTAKeyFme
 = 
FALSE
;

1259 
PEAPOL_PACKET
 
pE
;

1260 
PUCHAR
 
pPro
, 
pAddr
 = 
NULL
;

1261 
PUCHAR
 
pSTAKey
 = 
NULL
;

1262 
UCHAR
 
ZoRy
[
LEN_KEY_DESC_REPLAY
];

1263 
UCHAR
 
Mic
[16], 
OldMic
[16];

1264 
UCHAR
 
dige
[80];

1265 
UCHAR
 
DlsPTK
[80];

1266 
UCHAR
 
mp
[64];

1267 
BOOLEAN
 
TimCed
;

1268 
CIPHER_KEY
 
PawiKey
;

1271 i(! 
pAd
->
CommCfg
.
bDLSCab
)

1272  
bSTAKeyFme
;

1274 i(! 
	`INFRA_ON
(
pAd
))

1275  
bSTAKeyFme
;

1277 i(
L
 < 
LENGTH_802_11
 + 6 + 2)

1278  
bSTAKeyFme
;

1280 
pPro
 = (
PUCHAR
)
pHd
 + 
LENGTH_802_11
;

1282 i((
pHd
->
FC
.
SubTy
 & 0x08))

1283 
pPro
 += 2;

1286 i(
pHd
->
FC
.
Ord
 && (!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_AGGREGATION_INUSED
)))

1288 
pPro
 += 4;

1292 i(
pRxD
->
L2PAD
)

1294 
pPro
 += 2;

1297 
pPro
 += 6;

1299 i((!(
pHd
->
FC
.
SubTy
 & 0x08)&& (!
	`RTMPEquMemy
(
EAPOL
, 
pPro
, 2)))

1300  
bSTAKeyFme
;

1302 
pAddr
 = 
pHd
->
Addr2
;

1304 i(
	`RTMPEquMemy
(
EAPOL
, 
pPro
, 2&& (
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
))

1306 
pE
 = (
PEAPOL_PACKET
(
pPro
 + 2);

1308 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - SnifL=%ld, DaL=%d, KeyMic=%d, Inl=%d, KeyAck=%d, Secu=%d, EKD_DL=%d, E=%d, Reque=%d\n", 
L
,

1309 (
LENGTH_802_11
 + 6 + 2 + 2 + 
MIN_LEN_OF_EAPOL_KEY_MSG
 + 16),

1310 
pE
->
KeyDesc
.
KeyInfo
.
KeyMic
,

1311 
pE
->
KeyDesc
.
KeyInfo
.
Inl
,

1312 
pE
->
KeyDesc
.
KeyInfo
.
KeyAck
,

1313 
pE
->
KeyDesc
.
KeyInfo
.
Secu
,

1314 
pE
->
KeyDesc
.
KeyInfo
.
EKD_DL
,

1315 
pE
->
KeyDesc
.
KeyInfo
.
E
,

1316 
pE
->
KeyDesc
.
KeyInfo
.
Reque
));

1318 i((
L
 >(
LENGTH_802_11
 + 6 + 2 + 2 + 
MIN_LEN_OF_EAPOL_KEY_MSG
 + 16)&& 
pE
->
KeyDesc
.
KeyInfo
.
KeyMic


1319 && 
pE
->
KeyDesc
.
KeyInfo
.
Inl
 &&E->KeyDesc.KeyInfo.
KeyAck
 &&E->KeyDesc.KeyInfo.
Secu


1320 && 
pE
->
KeyDesc
.
KeyInfo
.
EKD_DL
 && !pE->KeyDesc.KeyInfo.
E
 && !pE->KeyDesc.KeyInfo.
Reque
)

1324 
	`NdisZoMemy
(
ZoRy
, 
LEN_KEY_DESC_REPLAY
);

1325 i((
	`RTMPComMemy
(
pE
->
KeyDesc
.
RyCou
, 
pAd
->
SCfg
.RyCou, 
LEN_KEY_DESC_REPLAY
) != 1) &&

1326 (
	`RTMPComMemy
(
pE
->
KeyDesc
.
RyCou
, 
ZoRy
, 
LEN_KEY_DESC_REPLAY
) != 0))

1327  
bSTAKeyFme
;

1330 
	`RTMPMoveMemy
(
pAd
->
SCfg
.
DlsRyCou
, 
pE
->
KeyDesc
.
RyCou
, 
LEN_KEY_DESC_REPLAY
);

1331 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - Sniffeplay counter (%02x-%02x-%02x-%02x-%02x-%02x-%02x-%02x) Len=%ld, KeyDataLen=%d\n",

1332 
pAd
->
SCfg
.
RyCou
[0],Ad->StaCfg.ReplayCounter[1],Ad->StaCfg.ReplayCounter[2],

1333 
pAd
->
SCfg
.
RyCou
[3],Ad->StaCfg.ReplayCounter[4],Ad->StaCfg.ReplayCounter[5],

1334 
pAd
->
SCfg
.
RyCou
[6],Ad->SCfg.RyCou[7], 
L
, 
pE
->
KeyDesc
.
KeyDa
[1]));

1337 i(
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
)

1338  
bSTAKeyFme
;

1343 
	`NdisZoMemy
(
mp
, 64);

1344 
	`NdisMoveMemy
(
mp
, "IEEE802.11 WIRELESS ACCESS POINT", 32);

1345 
	`WDivePTK
(
pAd
, 
mp
,emp,Ad->
CommCfg
.
Bssid
,emp,Ad->
CutAddss
, 
DlsPTK
, 
LEN_PTK
);

1347 
	`NdisMoveMemy
(
OldMic
, 
pE
->
KeyDesc
.
KeyMic
, 
LEN_KEY_DESC_MIC
);

1348 
	`NdisZoMemy
(
pE
->
KeyDesc
.
KeyMic
, 
LEN_KEY_DESC_MIC
);

1349 i(
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi3Ebd
)

1352 
	`RT_HMAC_SHA1
(
DlsPTK
, 
LEN_PTK_KCK
, (
PUCHAR

pE
,E->
Body_L
[1] + 4, 
dige
, 
SHA1_DIGEST_SIZE
);

1353 
	`NdisMoveMemy
(
Mic
, 
dige
, 
LEN_KEY_DESC_MIC
);

1357 
	`RT_HMAC_MD5
(
DlsPTK
, 
LEN_PTK_KCK
, (
PUCHAR

pE
,E->
Body_L
[1] + 4, 
Mic
, 
MD5_DIGEST_SIZE
);

1360 i(!
	`NdisEquMemy
(
OldMic
, 
Mic
, 
LEN_KEY_DESC_MIC
))

1362 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("MIC Different in Msg1 of STAKey handshake! \n"));

1363  
bSTAKeyFme
;

1366 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MIC VALID in Msg1 of STAKey handshake! \n"));

1367 i((
pE
->
KeyDesc
.
KeyDa
[0] == 0xDD) && (pEap->KeyDesc.KeyData[2] == 0x00) && (pEap->KeyDesc.KeyData[3] == 0x0C)

1368 && (
pE
->
KeyDesc
.
KeyDa
[4] == 0x43) && (pEap->KeyDesc.KeyData[5] == 0x02))

1370 
pAddr
 = 
pE
->
KeyDesc
.
KeyDa
 + 8;

1371 
pSTAKey
 = 
pE
->
KeyDesc
.
KeyDa
 + 14;

1373 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - Receive STAKey Message-1 from %02x:%02x:%02x:%02x:%02x:%02x Len=%ld, KeyDataLen=%d\n",

1374 
pAddr
[0],Addr[1],Addr[2],Addr[3],Addr[4],Addr[5], 
L
, 
pE
->
KeyDesc
.
KeyDa
[1]));

1376 
bSTAKeyFme
 = 
TRUE
;

1380 i(
L
 >(
LENGTH_802_11
 + 6 + 2 + 2 + 
MIN_LEN_OF_EAPOL_KEY_MSG
))

1382 
	`RTMPMoveMemy
(
pAd
->
SCfg
.
DlsRyCou
, 
pE
->
KeyDesc
.
RyCou
, 
LEN_KEY_DESC_REPLAY
);

1383 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - Sniffeplay counter 2(%02x-%02x-%02x-%02x-%02x-%02x-%02x-%02x) Len=%ld, KeyDataLen=%d\n",

1384 
pAd
->
SCfg
.
RyCou
[0],Ad->StaCfg.ReplayCounter[1],Ad->StaCfg.ReplayCounter[2],

1385 
pAd
->
SCfg
.
RyCou
[3],Ad->StaCfg.ReplayCounter[4],Ad->StaCfg.ReplayCounter[5],

1386 
pAd
->
SCfg
.
RyCou
[6],Ad->SCfg.RyCou[7], 
L
, 
pE
->
KeyDesc
.
KeyDa
[1]));

1392 
i
0; i < 
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

1394 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && 
	`MAC_ADDR_EQUAL
(
pAddr
,Ad->SCfg.DLSEry[i].
MacAddr
))

1396 i(
bSTAKeyFme
)

1398 
PMAC_TABLE_ENTRY
 
pEry
;

1401 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_FINISH
;

1402 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

1404 
PawiKey
.
KeyL
 = 
LEN_TK
;

1405 
	`NdisMoveMemy
(
PawiKey
.
Key
, &
pSTAKey
[0], 
LEN_TK
);

1406 
	`NdisMoveMemy
(
PawiKey
.
TxMic
, &
pSTAKey
[16], 
LEN_TKIP_MIC
);

1407 
	`NdisMoveMemy
(
PawiKey
.
RxMic
, &
pSTAKey
[24], 
LEN_TKIP_MIC
);

1410 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi2Ebd
)

1411 
PawiKey
.
ChAlg
 = 
CIPHER_TKIP
;

1412 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi3Ebd
)

1413 
PawiKey
.
ChAlg
 = 
CIPHER_AES
;

1415 
pEry
 = 
	`DlsEryTabLookup
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
, 
TRUE
);

1420 
	`RTMP_ASIC_PAIRWISE_KEY_TABLE
(
pAd
,

1421 (
UCHAR
)
pAd
->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
,

1422 &
PawiKey
);

1424 
	`RTMP_SET_WCID_SEC_INFO
(
pAd
,

1425 
BSS0
,

1427 
PawiKey
.
ChAlg
,

1428 (
UCHAR
)
pAd
->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
,

1429 
PAIRWISEKEYTABLE
);

1431 
	`NdisMoveMemy
(&
pEry
->
PawiKey
, &PawiKey, (
CIPHER_KEY
));

1432 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - Receive STAKey Message-1 (Peer STA MAC Address STAKey) \n"));

1434 
	`RTMPSdSTAKeyHdShake
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
);

1436 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - Finish STAKey handshakerocedure (Initiator side)\n"));

1441 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 =
DLS_FINISH
)

1443 
pAd
->
SCfg
.
DLSEry
[
i
].
CouDownTim
 =Ad->SCfg.DLSEry[i].
TimeOut
;

1448 
bFdEry
 = 
TRUE
;

1453 
i
=
MAX_NUM_OF_INIT_DLS_ENTRY
; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

1455 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && 
	`MAC_ADDR_EQUAL
(
pAddr
,Ad->SCfg.DLSEry[i].
MacAddr
))

1457 i(
bSTAKeyFme
)

1459 
PMAC_TABLE_ENTRY
 
pEry
 = 
NULL
;

1462 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_FINISH
;

1463 
	`RTMPClTim
(&
pAd
->
SCfg
.
DLSEry
[
i
].
Tim
, &
TimCed
);

1465 
PawiKey
.
KeyL
 = 
LEN_TK
;

1466 
	`NdisMoveMemy
(
PawiKey
.
Key
, &
pSTAKey
[0], 
LEN_TK
);

1467 
	`NdisMoveMemy
(
PawiKey
.
TxMic
, &
pSTAKey
[16], 
LEN_TKIP_MIC
);

1468 
	`NdisMoveMemy
(
PawiKey
.
RxMic
, &
pSTAKey
[24], 
LEN_TKIP_MIC
);

1471 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi2Ebd
)

1472 
PawiKey
.
ChAlg
 = 
CIPHER_TKIP
;

1473 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi3Ebd
)

1474 
PawiKey
.
ChAlg
 = 
CIPHER_AES
;

1476 
pEry
 = 
	`DlsEryTabLookup
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacAddr
, 
TRUE
);

1481 
	`RTMP_ASIC_PAIRWISE_KEY_TABLE
(
pAd
,

1482 (
UCHAR
)
pAd
->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
,

1483 &
PawiKey
);

1485 
	`RTMP_SET_WCID_SEC_INFO
(
pAd
,

1486 
BSS0
,

1488 
PawiKey
.
ChAlg
,

1489 (
UCHAR
)
pAd
->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
,

1490 
PAIRWISEKEYTABLE
);

1492 
	`NdisMoveMemy
(&
pEry
->
PawiKey
, &PawiKey, (
CIPHER_KEY
));

1493 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - Receive STAKey Message-1 (Initiator STA MAC Address STAKey)\n"));

1497 i(
	`RTMPSdSTAKeyHdShake
(
pAd
, 
pAddr
!
NDIS_STATUS_SUCCESS
)

1499 
MLME_DLS_REQ_STRUCT
 
MlmeDlsReq
;

1500 
USHORT
 
as
 = 
REASON_QOS_CIPHER_NOT_SUPPORT
;

1502 
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 = 
FALSE
;

1503 
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 = 
DLS_NONE
;

1504 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, &pAd->
SCfg
.
DLSEry
[
i
], 
as
);

1505 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_TEAR_DOWN
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

1509 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - Finish STAKey handshakerocedure (Peer side)\n"));

1515 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Stus
 =
DLS_FINISH
)

1517 
pAd
->
SCfg
.
DLSEry
[
i
].
CouDownTim
 =Ad->SCfg.DLSEry[i].
TimeOut
;

1521 
bFdEry
 = 
TRUE
;

1526  
bSTAKeyFme
;

1527 
	}
}

1545 
INT
 
	$RTMPCheckDLSFme
(

1546 
IN
 
PRTMP_ADAPTER
 
pAd
,

1547 
IN
 
PUCHAR
 
pDA
)

1549 
INT
 
rv
 = -1;

1550 
INT
 
i
;

1552 i(!
pAd
->
CommCfg
.
bDLSCab
)

1553  
rv
;

1555 i(!
	`INFRA_ON
(
pAd
))

1556  
rv
;

1560 
i
=0; i<
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

1562 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
) &&

1563 
	`MAC_ADDR_EQUAL
(
pDA
, 
pAd
->
SCfg
.
DLSEry
[
i
].
MacAddr
))

1565 
rv
 = 
i
;

1571 
i
=
MAX_NUM_OF_INIT_DLS_ENTRY
; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

1573 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
) &&

1574 
	`MAC_ADDR_EQUAL
(
pDA
, 
pAd
->
SCfg
.
DLSEry
[
i
].
MacAddr
))

1576 
rv
 = 
i
;

1580 } 
FALSE
);

1582  
rv
;

1583 
	}
}

1593 
VOID
 
	$RTMPSdDLSTrDownFme
(

1594 
IN
 
PRTMP_ADAPTER
 
pAd
,

1595 
IN
 
PUCHAR
 
pDA
)

1597 
PUCHAR
 
pOutBufr
 = 
NULL
;

1598 
NDIS_STATUS
 
NStus
;

1599 
HEADER_802_11
 
DlsTrDownHdr
;

1600 
ULONG
 
FmeL
 = 0;

1601 
USHORT
 
Rs
 = 
REASON_QOS_QSTA_LEAVING_QBSS
;

1602 
UCHAR
 
Cegy
 = 
CATEGORY_DLS
;

1603 
UCHAR
 
Ai
 = 
ACTION_DLS_TEARDOWN
;

1604 
UCHAR
 
i
 = 0;

1606 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RESET_IN_PROGRESS
) ||

1607 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
))

1610 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Send DLS TearDown Frame \n"));

1612 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

1613 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

1615 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("ASSOC - RTMPSendDLSTearDownFrame()llocate memory failed \n"));

1619 
	`AHdIn
(
pAd
, &
DlsTrDownHdr
,Ad->
CommCfg
.
Bssid
,Ad->
CutAddss
,Ad->CommonCfg.Bssid);

1620 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1621 (
HEADER_802_11
), &
DlsTrDownHdr
,

1622 1, &
Cegy
,

1623 1, &
Ai
,

1624 6, 
pDA
,

1625 6, 
pAd
->
CutAddss
,

1626 2, &
Rs
,

1627 
END_OF_ARGS
);

1629 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

1630 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1633 
i
 = 0; i < 
MAX_NUM_OF_INIT_DLS_ENTRY
; i++)

1635 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
)

1636 && 
	`MAC_ADDR_EQUAL
(
pDA
, 
pAd
->
SCfg
.
DLSEry
[
i
].
MacAddr
))

1638 
	`MacTabDeDlsEry
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
,Ad->SCfg.DLSEry[i].
MacAddr
);

1643 
i
=
MAX_NUM_OF_INIT_DLS_ENTRY
; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

1645 i(
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
 && (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
)

1646 && 
	`MAC_ADDR_EQUAL
(
pDA
, 
pAd
->
SCfg
.
DLSEry
[
i
].
MacAddr
))

1648 
	`MacTabDeDlsEry
(
pAd
,Ad->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
,Ad->SCfg.DLSEry[i].
MacAddr
);

1652 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Sd DLS TrDowFmdemovkey i(i=%d\n", 
i
));

1653 
	}
}

1663 
NDIS_STATUS
 
	$RTMPSdSTAKeyReque
(

1664 
IN
 
PRTMP_ADAPTER
 
pAd
,

1665 
IN
 
PUCHAR
 
pDA
)

1667 
UCHAR
 
Hd802_3
[14];

1668 
NDIS_STATUS
 
NStus
;

1669 
ULONG
 
FmeL
 = 0;

1670 
PEAPOL_PACKET
 
pPack
;

1671 
UCHAR
 *
mpo
;

1672 
UCHAR
 
Mic
[16];

1673 
UCHAR
 
dige
[80];

1674 
PUCHAR
 
pOutBufr
 = 
NULL
;

1675 
PNDIS_PACKET
 
pNdisPack
;

1676 
UCHAR
 
mp
[64];

1677 
UCHAR
 
DlsPTK
[80];

1679 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - RTMPSdSTAKeyReque(t%02x:%02x:%02x:%02x:%02x:%02x\n", 
pDA
[0],DA[1],DA[2],DA[3],DA[4],DA[5]));

1681 
pAd
->
Sequ
 ++;

1682 
	`MAKE_802_3_HEADER
(
Hd802_3
, 
pAd
->
CommCfg
.
Bssid
,Ad->
CutAddss
, 
EAPOL
);

1685 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mpo
, 
TX_EAPOL_BUFFER
);

1686 i(
mpo
 =
NULL
)

1688 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!%:memy!!!\n", 
__FUNCTION__
));

1689  
NDIS_STATUS_FAILURE
;

1693 
pPack
 = (
PEAPOL_PACKET
)
mpo
;

1694 
	`NdisZoMemy
(
pPack
, 
TX_EAPOL_BUFFER
);

1696 
pPack
->
ProV
 = 
EAPOL_VER
;

1697 
pPack
->
ProTy
 = 
EAPOLKey
;

1698 
pPack
->
Body_L
[1] = (
KEY_DESCRIPTER
+ 6 + 
MAC_ADDR_LEN
;

1701 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPAPSK
))

1703 
pPack
->
KeyDesc
.
Ty
 = 
WPA1_KEY_DESC
;

1705 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPA2PSK
))

1707 
pPack
->
KeyDesc
.
Ty
 = 
WPA2_KEY_DESC
;

1711 
pPack
->
KeyDesc
.
KeyInfo
.
KeyDescV
 =

1712 (((
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi3Ebd
|| (pAd->SCfg.
GroupCh
 =Ndis802_11Enyi3Ebd)? (
KEY_DESC_AES
: (
KEY_DESC_TKIP
));

1714 
pPack
->
KeyDesc
.
KeyInfo
.
KeyMic
 = 1;

1715 
pPack
->
KeyDesc
.
KeyInfo
.
Secu
 = 1;

1716 
pPack
->
KeyDesc
.
KeyInfo
.
Reque
 = 1;

1718 
pPack
->
KeyDesc
.
KeyDaL
[1] = 12;

1721 
pPack
->
KeyDesc
.
KeyDa
[0] = 0xDD;

1722 
pPack
->
KeyDesc
.
KeyDa
[1] = 0x0A;

1723 
pPack
->
KeyDesc
.
KeyDa
[2] = 0x00;

1724 
pPack
->
KeyDesc
.
KeyDa
[3] = 0x0C;

1725 
pPack
->
KeyDesc
.
KeyDa
[4] = 0x43;

1726 
pPack
->
KeyDesc
.
KeyDa
[5] = 0x03;

1727 
	`NdisMoveMemy
(&
pPack
->
KeyDesc
.
KeyDa
[6], 
pDA
, 
MAC_ADDR_LEN
);

1729 
	`NdisMoveMemy
(
pPack
->
KeyDesc
.
RyCou
, 
pAd
->
SCfg
.
DlsRyCou
, 
LEN_KEY_DESC_REPLAY
);

1732 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

1733 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

1735 
	`os__mem
(
NULL
, 
mpo
);

1736  
NStus
;

1740 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1741 
pPack
->
Body_L
[1] + 4,Packet,

1742 
END_OF_ARGS
);

1745 
	`NdisZoMemy
(
mp
, 64);

1746 
	`NdisMoveMemy
(
mp
, "IEEE802.11 WIRELESS ACCESS POINT", 32);

1747 
	`WDivePTK
(
pAd
, 
mp
,emp,Ad->
CommCfg
.
Bssid
,emp,Ad->
CutAddss
, 
DlsPTK
, 
LEN_PTK
);

1750 i(
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi3Ebd
)

1753 
	`NdisZoMemy
(
dige
, (digest));

1754 
	`RT_HMAC_SHA1
(
DlsPTK
, 
LEN_PTK_KCK
, 
pOutBufr
, 
FmeL
, 
dige
, 
SHA1_DIGEST_SIZE
);

1755 
	`NdisMoveMemy
(
pPack
->
KeyDesc
.
KeyMic
, 
dige
, 
LEN_KEY_DESC_MIC
);

1759 
	`NdisZoMemy
(
Mic
, (Mic));

1760 
	`RT_HMAC_MD5
(
DlsPTK
, 
LEN_PTK_KCK
, 
pOutBufr
, 
FmeL
, 
Mic
, 
MD5_DIGEST_SIZE
);

1761 
	`NdisMoveMemy
(
pPack
->
KeyDesc
.
KeyMic
, 
Mic
, 
LEN_KEY_DESC_MIC
);

1764 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1765 (
Hd802_3
), Header802_3,

1766 
pPack
->
Body_L
[1] + 4,Packet,

1767 
END_OF_ARGS
);

1769 
NStus
 = 
	`RTMPAoNdisPack
(
pAd
, &
pNdisPack
, 
NULL
, 0, 
pOutBufr
, 
FmeL
);

1770 i(
NStus
 =
NDIS_STATUS_SUCCESS
)

1772 
	`RTMP_SET_PACKET_WCID
(
pNdisPack
, 
BSSID_WCID
);

1773 
	`STASdPack
(
pAd
, 
pNdisPack
);

1774 
	`RTMPDeQueuePack
(
pAd
, 
FALSE
, 
NUM_OF_TX_RING
, 
MAX_TX_PROCESS
);

1777 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1778 
	`os__mem
(
NULL
, 
mpo
);

1780 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPSdSTAKeyReque- Sd STAKeyeque (NStus=%x, FmeL=%ld)\n", 
NStus
, 
FmeL
));

1782  
NStus
;

1783 
	}
}

1793 
NDIS_STATUS
 
	$RTMPSdSTAKeyHdShake
(

1794 
IN
 
PRTMP_ADAPTER
 
pAd
,

1795 
IN
 
PUCHAR
 
pDA
)

1797 
UCHAR
 
Hd802_3
[14];

1798 
NDIS_STATUS
 
NStus
;

1799 
ULONG
 
FmeL
 = 0;

1800 
PEAPOL_PACKET
 
pPack
;

1801 
UCHAR
 *
mpo
;

1802 
UCHAR
 
Mic
[16];

1803 
UCHAR
 
dige
[80];

1804 
PUCHAR
 
pOutBufr
 = 
NULL
;

1805 
PNDIS_PACKET
 
pNdisPack
;

1806 
UCHAR
 
mp
[64];

1807 
UCHAR
 
DlsPTK
[80];

1809 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("DLS - RTMPSdSTAKeyHdShake(t%02x:%02x:%02x:%02x:%02x:%02x\n", 
pDA
[0],DA[1],DA[2],DA[3],DA[4],DA[5]));

1811 
pAd
->
Sequ
 ++;

1812 
	`MAKE_802_3_HEADER
(
Hd802_3
, 
pAd
->
CommCfg
.
Bssid
,Ad->
CutAddss
, 
EAPOL
);

1815 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mpo
, 
TX_EAPOL_BUFFER
);

1816 i(
mpo
 =
NULL
)

1818 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!%:memy!!!\n", 
__FUNCTION__
));

1819  
NDIS_STATUS_FAILURE
;

1823 
pPack
 = (
PEAPOL_PACKET
)
mpo
;

1824 
	`NdisZoMemy
(
pPack
, 
TX_EAPOL_BUFFER
);

1826 
pPack
->
ProV
 = 
EAPOL_VER
;

1827 
pPack
->
ProTy
 = 
EAPOLKey
;

1828 
pPack
->
Body_L
[1] = (
KEY_DESCRIPTER
+ 6 + 
MAC_ADDR_LEN
;

1831 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPAPSK
))

1833 
pPack
->
KeyDesc
.
Ty
 = 
WPA1_KEY_DESC
;

1835 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
|| (pAd->SCfg.AuthMod=
Ndis802_11AuthModeWPA2PSK
))

1837 
pPack
->
KeyDesc
.
Ty
 = 
WPA2_KEY_DESC
;

1841 
pPack
->
KeyDesc
.
KeyInfo
.
KeyDescV
 =

1842 (((
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi3Ebd
|| (pAd->SCfg.
GroupCh
 =Ndis802_11Enyi3Ebd)? (
KEY_DESC_AES
: (
KEY_DESC_TKIP
));

1844 
pPack
->
KeyDesc
.
KeyInfo
.
KeyMic
 = 1;

1845 
pPack
->
KeyDesc
.
KeyInfo
.
Secu
 = 1;

1847 
pPack
->
KeyDesc
.
KeyDaL
[1] = 12;

1850 
pPack
->
KeyDesc
.
KeyDa
[0] = 0xDD;

1851 
pPack
->
KeyDesc
.
KeyDa
[1] = 0x0A;

1852 
pPack
->
KeyDesc
.
KeyDa
[2] = 0x00;

1853 
pPack
->
KeyDesc
.
KeyDa
[3] = 0x0C;

1854 
pPack
->
KeyDesc
.
KeyDa
[4] = 0x43;

1855 
pPack
->
KeyDesc
.
KeyDa
[5] = 0x03;

1856 
	`NdisMoveMemy
(&
pPack
->
KeyDesc
.
KeyDa
[6], 
pDA
, 
MAC_ADDR_LEN
);

1858 
	`NdisMoveMemy
(
pPack
->
KeyDesc
.
RyCou
, 
pAd
->
SCfg
.
DlsRyCou
, 
LEN_KEY_DESC_REPLAY
);

1861 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

1862 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

1864 
	`os__mem
(
NULL
, 
mpo
);

1865  
NStus
;

1869 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1870 
pPack
->
Body_L
[1] + 4,Packet,

1871 
END_OF_ARGS
);

1874 
	`NdisZoMemy
(
mp
, 64);

1875 
	`NdisMoveMemy
(
mp
, "IEEE802.11 WIRELESS ACCESS POINT", 32);

1876 
	`WDivePTK
(
pAd
, 
mp
,emp,Ad->
CommCfg
.
Bssid
,emp,Ad->
CutAddss
, 
DlsPTK
, 
LEN_PTK
);

1879 i(
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi3Ebd
)

1882 
	`NdisZoMemy
(
dige
, (digest));

1883 
	`RT_HMAC_SHA1
(
DlsPTK
, 
LEN_PTK_KCK
, 
pOutBufr
, 
FmeL
, 
dige
, 
SHA1_DIGEST_SIZE
);

1884 
	`NdisMoveMemy
(
pPack
->
KeyDesc
.
KeyMic
, 
dige
, 
LEN_KEY_DESC_MIC
);

1888 
	`NdisZoMemy
(
Mic
, (Mic));

1889 
	`RT_HMAC_MD5
(
DlsPTK
, 
LEN_PTK_KCK
, 
pOutBufr
, 
FmeL
, 
Mic
, 
MD5_DIGEST_SIZE
);

1890 
	`NdisMoveMemy
(
pPack
->
KeyDesc
.
KeyMic
, 
Mic
, 
LEN_KEY_DESC_MIC
);

1893 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1894 (
Hd802_3
), Header802_3,

1895 
pPack
->
Body_L
[1] + 4,Packet,

1896 
END_OF_ARGS
);

1898 
NStus
 = 
	`RTMPAoNdisPack
(
pAd
, &
pNdisPack
, 
NULL
, 0, 
pOutBufr
, 
FmeL
);

1899 i(
NStus
 =
NDIS_STATUS_SUCCESS
)

1901 
	`RTMP_SET_PACKET_WCID
(
pNdisPack
, 
BSSID_WCID
);

1902 
	`STASdPack
(
pAd
, 
pNdisPack
);

1903 
	`RTMPDeQueuePack
(
pAd
, 
FALSE
, 
NUM_OF_TX_RING
, 
MAX_TX_PROCESS
);

1906 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

1907 
	`os__mem
(
NULL
, 
mpo
);

1909 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPSdSTAKeyHdShake- Sd STAKey Mesge-2 (NStus=%x, FmeL=%ld)\n", 
NStus
, 
FmeL
));

1911  
NStus
;

1912 
	}
}

1914 
VOID
 
	$DlsTimeoutAi
(

1915 
IN
 
PVOID
 
SyemScific1
,

1916 
IN
 
PVOID
 
FuniCڋxt
,

1917 
IN
 
PVOID
 
SyemScific2
,

1918 
IN
 
PVOID
 
SyemScific3
)

1920 
MLME_DLS_REQ_STRUCT
 
MlmeDlsReq
;

1921 
USHORT
 
as
;

1922 
PRT_802_11_DLS
 
pDLS
 = (PRT_802_11_DLS)
FuniCڋxt
;

1923 
PRTMP_ADAPTER
 
pAd
 = 
pDLS
->pAd;

1925 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("DlsTimeout - Tear down DLSinks (%02x:%02x:%02x:%02x:%02x:%02x)\n",

1926 
pDLS
->
MacAddr
[0],DLS->MacAddr[1],DLS->MacAddr[2],DLS->MacAddr[3],DLS->MacAddr[4],DLS->MacAddr[5]));

1928 i((
pDLS
&& (pDLS->
Vid
))

1930 
as
 = 
REASON_QOS_REQUEST_TIMEOUT
;

1931 
pDLS
->
Vid
 = 
FALSE
;

1932 
pDLS
->
Stus
 = 
DLS_NONE
;

1933 
	`DlsPmFl
(
pAd
, &
MlmeDlsReq
, 
pDLS
, 
as
);

1934 
	`MlmeEnqueue
(
pAd
, 
DLS_STATE_MACHINE
, 
MT2_MLME_DLS_TEAR_DOWN
, (
MLME_DLS_REQ_STRUCT
), &
MlmeDlsReq
, 0);

1935 
	`RTMP_MLME_HANDLER
(
pAd
);

1937 
	}
}

1948 
MAC_TABLE_ENTRY
 *
	$MacTabInDlsEry
(

1949 
IN
 
PRTMP_ADAPTER
 
pAd
,

1950 
IN
 
PUCHAR
 
pAddr
,

1951 
IN
 
UINT
 
DlsEryIdx
)

1953 
PMAC_TABLE_ENTRY
 
pEry
 = 
NULL
;

1955 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====> MacTableInsertDlsEntry\n"));

1957 i(
pAd
->
MacTab
.
Size
 >
MAX_LEN_OF_MAC_TABLE
)

1958  
NULL
;

1962 if((
pEry
 = 
	`DlsEryTabLookup
(
pAd
, 
pAddr
, 
TRUE
)!
NULL
)

1966 
pEry
 = 
	`MacTabInEry
(
pAd
, 
pAddr
, 
DlsEryIdx
 + 
MIN_NET_DEVICE_FOR_DLS
, 
TRUE
);

1967 i(
pEry
)

1969 
pAd
->
SCfg
.
DLSEry
[
DlsEryIdx
].
MacTabMchWCID
 = 
pEry
->
Aid
;

1970 
pEry
->
MchDlsEryIdx
 = 
DlsEryIdx
;

1971 
pEry
->
AuthMode
 = 
pAd
->
SCfg
.AuthMode;

1972 
pEry
->
WStus
 = 
pAd
->
SCfg
.WepStatus;

1973 
pEry
->
PtSecud
 = 
WPA_802_1X_PORT_SECURED
;

1975 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MacTabInDlsEry -ory #%d, Tٮ%d\n",
pEry
->
Aid
, 
pAd
->
MacTab
.
Size
));

1978 i(
	`IS_ENTRY_DLS
(
pEry
&& (
pAd
->
SCfg
.
WStus
 =
Ndis802_11WEPEbd
))

1980 
UCHAR
 
KeyIdx
 = 0;

1981 
UCHAR
 
ChAlg
 = 0;

1983 
KeyIdx
 = 
pAd
->
SCfg
.
DeuKeyId
;

1985 
ChAlg
 = 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].CipherAlg;

1987 
	`RTMPSWcidSecuryInfo
(
pAd
,

1988 
BSS0
,

1989 
pAd
->
SCfg
.
DeuKeyId
,

1990 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
ChAlg
,

1991 
pEry
->
Aid
,

1992 
SHAREDKEYTABLE
);

1997 } 
FALSE
);

1999 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<==== MacTableInsertDlsEntry\n"));

2001  
pEry
;

2002 
	}
}

2011 
BOOLEAN
 
	$MacTabDeDlsEry
(

2012 
IN
 
PRTMP_ADAPTER
 
pAd
,

2013 
IN
 
USHORT
 
wcid
,

2014 
IN
 
PUCHAR
 
pAddr
)

2016 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("====> MacTableDeleteDlsEntry\n"));

2018 i(!
	`VALID_WCID
(
wcid
))

2019  
FALSE
;

2021 
	`MacTabDeEry
(
pAd
, 
wcid
, 
pAddr
);

2023 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<==== MacTableDeleteDlsEntry\n"));

2025  
TRUE
;

2026 
	}
}

2028 
MAC_TABLE_ENTRY
 *
	$DlsEryTabLookup
(

2029 
IN
 
PRTMP_ADAPTER
 
pAd
,

2030 
IN
 
PUCHAR
 
pAddr
,

2031 
IN
 
BOOLEAN
 
bRetIdCou
)

2033 
ULONG
 
HashIdx
;

2034 
MAC_TABLE_ENTRY
 *
pEry
 = 
NULL
;

2036 
	`RTMP_SEM_LOCK
(&
pAd
->
MacTabLock
);

2037 
HashIdx
 = 
	`MAC_ADDR_HASH_INDEX
(
pAddr
);

2038 
pEry
 = 
pAd
->
MacTab
.
Hash
[
HashIdx
];

2040 
pEry
)

2042 i(
	`IS_ENTRY_DLS
(
pEry
)

2043 && 
	`MAC_ADDR_EQUAL
(
pEry
->
Addr
, 
pAddr
))

2045 if(
bRetIdCou
)

2046 
pEry
->
NoDaIdCou
 = 0;

2050 
pEry
 =Ery->
pNext
;

2053 
	`RTMP_SEM_UNLOCK
(&
pAd
->
MacTabLock
);

2054  
pEry
;

2055 
	}
}

2057 
MAC_TABLE_ENTRY
 *
	$DlsEryTabLookupByWcid
(

2058 
IN
 
PRTMP_ADAPTER
 
pAd
,

2059 
IN
 
UCHAR
 
wcid
,

2060 
IN
 
PUCHAR
 
pAddr
,

2061 
IN
 
BOOLEAN
 
bRetIdCou
)

2063 
ULONG
 
DLsIndex
;

2064 
PMAC_TABLE_ENTRY
 
pCurEry
 = 
NULL
;

2065 
PMAC_TABLE_ENTRY
 
pEry
 = 
NULL
;

2067 i(!
	`VALID_WCID
(
wcid
))

2068  
NULL
;

2070 
	`RTMP_SEM_LOCK
(&
pAd
->
MacTabLock
);

2074 
pCurEry
 = &
pAd
->
MacTab
.
Cڋ
[
wcid
];

2076 
DLsIndex
 = 0xff;

2077 i((
pCurEry
&& 
	`IS_ENTRY_DLS
(pCurEntry))

2079 
DLsIndex
 = 
pCurEry
->
MchDlsEryIdx
;

2082 i(
DLsIndex
 == 0xff)

2085 i(
	`MAC_ADDR_EQUAL
(
pCurEry
->
Addr
, 
pAddr
))

2087 if(
bRetIdCou
)

2088 
pCurEry
->
NoDaIdCou
 = 0;

2089 
pEry
 = 
pCurEry
;

2092 } 
FALSE
);

2094 
	`RTMP_SEM_UNLOCK
(&
pAd
->
MacTabLock
);

2096  
pEry
;

2097 
	}
}

2099 
INT
 
	$S_DlsEryInfo_Diy_Proc
(

2100 
IN
 
PRTMP_ADAPTER
 
pAd
,

2101 
IN
 
PUCHAR
 
g
)

2103 
INT
 
i
;

2105 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n%-19s%-8s\n", "MAC", "TIMEOUT\n"));

2106 
i
=0; i<
MAX_NUM_OF_DLS_ENTRY
; i++)

2108 i((
pAd
->
SCfg
.
DLSEry
[
i
].
Vid
&& (pAd->SCfg.DLSEry[i].
Stus
 =
DLS_FINISH
))

2110 
PMAC_TABLE_ENTRY
 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[pAd->
SCfg
.
DLSEry
[
i
].
MacTabMchWCID
];

2112 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%02x:%02x:%02x:%02x:%02x:%02x ",

2113 
pAd
->
SCfg
.
DLSEry
[
i
].
MacAddr
[0],Ad->StaCfg.DLSEntry[i].MacAddr[1],Ad->StaCfg.DLSEntry[i].MacAddr[2],

2114 
pAd
->
SCfg
.
DLSEry
[
i
].
MacAddr
[3],Ad->StaCfg.DLSEntry[i].MacAddr[4],Ad->StaCfg.DLSEntry[i].MacAddr[5]));

2115 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-8d\n", 
pAd
->
SCfg
.
DLSEry
[
i
].
TimeOut
));

2117 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n"));

2118 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n%-19s%-4s%-4s%-4s%-4s%-7s%-7s%-7s","MAC", "AID", "BSS", "PSM", "WMM", "RSSI0", "RSSI1", "RSSI2"));

2119 #ifde
DOT11_N_SUPPORT


2120 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-8s%-10s%-6s%-6s%-6s%-6s", "MIMOPS", "PhMd", "BW", "MCS", "SGI", "STBC"));

2122 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n%02X:%02X:%02X:%02X:%02X:%02X ",

2123 
pEry
->
Addr
[0],Entry->Addr[1],Entry->Addr[2],

2124 
pEry
->
Addr
[3],Entry->Addr[4],Entry->Addr[5]));

2125 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-4d", ()
pEry
->
Aid
));

2126 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-4d", ()
pEry
->
idx
));

2127 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-4d", ()
pEry
->
PsMode
));

2128 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-4d", ()
	`CLIENT_STATUS_TEST_FLAG
(
pEry
, 
fCLIENT_STATUS_WMM_CAPABLE
)));

2129 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-7d", 
pEry
->
RssiSame
.
AvgRssi0
));

2130 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-7d", 
pEry
->
RssiSame
.
AvgRssi1
));

2131 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-7d", 
pEry
->
RssiSame
.
AvgRssi2
));

2132 #ifde
DOT11_N_SUPPORT


2133 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-8d", ()
pEry
->
MmpsMode
));

2134 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-10s", 
	`GPhyMode
(
pEry
->
HTPhyMode
.
fld
.
MODE
)));

2135 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-6s", 
	`GBW
(
pEry
->
HTPhyMode
.
fld
.
BW
)));

2136 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-6d", 
pEry
->
HTPhyMode
.
fld
.
MCS
));

2137 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-6d", 
pEry
->
HTPhyMode
.
fld
.
ShtGI
));

2138 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-6d", 
pEry
->
HTPhyMode
.
fld
.
STBC
));

2140 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("%-10d, %d, %d%%\n", 
pEry
->
DebugFIFOCou
,Ery->
DebugTxCou
,

2141 (
pEry
->
DebugTxCou
? (Ery->DebugTxCou-pEry->
DebugFIFOCou
)*100/pEntry->DebugTxCount) : 0));

2142 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n"));

2147  
TRUE
;

2148 
	}
}

2150 
INT
 
	$S_DlsAddEry_Proc
(

2151 
IN
 
PRTMP_ADAPTER
 
pAd
,

2152 
IN
 
PSTRING
 
g
)

2154 
UCHAR
 
mac
[
MAC_ADDR_LEN
];

2155 
USHORT
 
Timeout
;

2156 
PSTRING
 
tok
;

2157 
STRING
 
pVue
[] = ":", 
DASH
 = '-';

2158 
INT
 
i
;

2159 
RT_802_11_DLS
 
Dls
;

2161 if(
	`
(
g
) < 19)

2162  
FALSE
;

2164 
tok
 = 
	`rchr
(
g
, 
DASH
);

2165 i((
tok
 !
NULL
&& (
	`
(token)>1))

2167 
Timeout
 = (
USHORT

	`sime_
((
tok
+1), 0, 10);

2169 *
tok
 = '\0';

2170 
i
 = 0, 
tok
 = 
	`rok
(
g
, &
pVue
[0]);ok;ok =ok(
NULL
, &sepValue[0]), i++)

2172 if((
	`
(
tok
!2|| (!
	`isxdig
(*token)) || (!isxdigit(*(token+1))))

2173  
FALSE
;

2174 
	`AtoH
(
tok
, (&
mac
[
i
]), 1);

2176 if(
i
 != 6)

2177  
FALSE
;

2179 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n%02x:%02x:%02x:%02x:%02x:%02x-%d", 
mac
[0], mac[1],

2180 
mac
[2], mac[3], mac[4], mac[5], ()
Timeout
));

2182 
	`NdisZoMemy
(&
Dls
, (
RT_802_11_DLS
));

2183 
Dls
.
TimeOut
 = 
Timeout
;

2184 
	`COPY_MAC_ADDR
(
Dls
.
MacAddr
, 
mac
);

2185 
Dls
.
Vid
 = 1;

2187 
	`MlmeEnqueue
(
pAd
,

2188 
MLME_CNTL_STATE_MACHINE
,

2189 
RT_OID_802_11_SET_DLS_PARAM
,

2190 (
RT_802_11_DLS
),

2191 &
Dls
, 0);

2193  
TRUE
;

2196  
FALSE
;

2198 
	}
}

2200 
INT
 
	$S_DlsTrDownEry_Proc
(

2201 
IN
 
PRTMP_ADAPTER
 
pAd
,

2202 
IN
 
PSTRING
 
g
)

2204 
UCHAR
 
macAddr
[
MAC_ADDR_LEN
];

2205 
PSTRING
 
vue
;

2206 
INT
 
i
;

2207 
RT_802_11_DLS
 
Dls
;

2209 if(
	`
(
g
) != 17)

2210  
FALSE
;

2212 
i
=0, 
vue
 = 
	`rok
(
g
,":"); vue; vurok(
NULL
,":"))

2214 if((
	`
(
vue
!2|| (!
	`isxdig
(*value)) || (!isxdigit(*(value+1))) )

2215  
FALSE
;

2217 
	`AtoH
(
vue
, &
macAddr
[
i
++], 2);

2220 
	`DBGPRINT
(
RT_DEBUG_OFF
, ("\n%02x:%02x:%02x:%02x:%02x:%02x", 
macAddr
[0], macAddr[1],

2221 
macAddr
[2], macAddr[3], macAddr[4], macAddr[5]));

2223 
	`NdisZoMemy
(&
Dls
, (
RT_802_11_DLS
));

2224 
	`COPY_MAC_ADDR
(
Dls
.
MacAddr
, 
macAddr
);

2225 
Dls
.
Vid
 = 0;

2227 
	`MlmeEnqueue
(
pAd
,

2228 
MLME_CNTL_STATE_MACHINE
,

2229 
RT_OID_802_11_SET_DLS_PARAM
,

2230 (
RT_802_11_DLS
),

2231 &
Dls
, 0);

2233  
TRUE
;

2234 
	}
}

	@sta/rtmp_ckipmic.c

37 
	~"_cfig.h
"

38 
	~"mp_ckmic.h
"

40 
	#MIC_ACCUM
(
v

pCڋxt
->
accum
 +(
ULONGLONG
)v * 
	`RTMPMicGCffic
Cڋxt)

	)

41 
	#GB
(
p
,
i
,
s
((
ULONG
*((
UCHAR
*))+i<< (s)

	)

42 
	#GETBIG32
(
p

	`GB
,0,24)|GB,1,16)|GB,2,8)|GB,3,0)

	)

48 
UCHAR
 
	gSboxTab
[256] =

89 cڡ 
USHORT
 
	gSbox
[256] =

125 
	#Lo8
(
v16
((v16& 0xFF)

	)

126 
	#Hi8
(
v16
(((v16>> 8& 0xFF)

	)

127 
	#u16Sw
(
i
(((i>> 8& 0xFF| (((i<< 8& 0xFF00)

	)

128 
	#_S_
(
i
(
Sbox
[
	`Lo8
(i)] ^ 
	`u16Sw
(Sbox[
	`Hi8
(i)]))

	)

130 
	#rLe_1
(
x
((((x<< 1| ((x>> 15)& 0xFFFF)

	)

131 
VOID
 
	gCKIP_key_rmu


133 
OUT
 
UCHAR
 *
	gPK
,

134 
IN
 
UCHAR
 *
	gCK
,

135 
IN
 
UCHAR
 
	gtoDsFromDs
,

136 
IN
 
UCHAR
 *
	gpiv


139 
	gi
;

140 
USHORT
 
	gH
[2], 
	gtmp
;

141 
USHORT
 
	gL
[8], 
	gR
[8];

144 
memt
(
L
, 0, (L));

145 
	gi
=0; i<16; i++) {

146 
	gL
[
i
>>1] |((
USHORT
)(
CK
[i])) << ( i & 1 ? 8 : 0) );

149 
	gH
[0] = (((
USHORT
)
piv
[0]) << 8) +iv[1];

150 
	gH
[1] = ( ((
USHORT
)
toDsFromDs
<< 8| 
piv
[2];

152 
	gi
=0; i<8; i++) {

153 
	gH
[0] ^
L
[
i
];

154 
	gtmp
 = 
_S_
(
H
[0]);

155 
	gH
[0] = 
tmp
 ^ 
H
[1];

156 
	gH
[1] = 
tmp
;

157 
	gR
[
i
] = 
H
[0];

161 
	gtmp
=
L
[0];

162 
	gi
=7; i>0; i--) {

163 
	gR
[
i
] = 
tmp
 = 
rLe_1
mp+ 
R
[i];

167 
	gPK
[0] = 
piv
[0];

168 
	gPK
[1] = 
piv
[1];

169 
	gPK
[2] = 
piv
[2];

172 
	gi
=3; i<16; i++) {

173 
	gPK
[
i
] = (
UCHAR
(
R
[i>>1] >> (i & 1 ? 8 : 0));

178 
VOID
 
	$RTMPCkMicIn
(

179 
IN
 
PMIC_CONTEXT
 
pCڋxt
,

180 
IN
 
PUCHAR
 
CK
)

183 
	`NdisMoveMemy
(
pCڋxt
->
CK
, CK, (pContext->CK));

184 
pCڋxt
->
accum
 = 0;

185 
pCڋxt
->
posi
 = 0;

186 
	}
}

189 
VOID
 
	$RTMPMicUpde
(

190 
IN
 
PMIC_CONTEXT
 
pCڋxt
,

191 
IN
 
PUCHAR
 
pOs
,

192 
IN
 
INT
 
n
)

194 
INT
 
by_posi
;

195 
ULONG
 
v
;

197 
by_posi
 = (
pCڋxt
->
posi
 & 3);

198 
n
 > 0) {

201 i(
n
 == 0) ;

202 
pCڋxt
->

[
by_posi
++] = *
pOs
++;

203 
pCڋxt
->
posi
++;

204 
n
--;

205 } 
by_posi
 < 4);

207 
v
 = 
	`GETBIG32
(&
pCڋxt
->

[0]);

208 
	`MIC_ACCUM
(
v
);

209 
by_posi
 = 0;

211 
	}
}

213 
ULONG
 
	$RTMPMicGCffic
(

214 
IN
 
PMIC_CONTEXT
 
pCڋxt
)

216 
UCHAR
 
s_cou
[16];

217 
INT
 
cff_posi
;

218 
UCHAR
 *
p
;

220 
cff_posi
 = (
pCڋxt
->
posi
 - 1) >> 2;

221 i(
cff_posi
 & 3) == 0) {

223 
u32
 
cou
 = (
cff_posi
 >> 2);

226 
	`memt
(&
s_cou
[0], 0, (aes_counter));

227 
s_cou
[15] = (
UINT8
)(
cou
 >> 0);

228 
s_cou
[14] = (
UINT8
)(
cou
 >> 8);

229 
s_cou
[13] = (
UINT8
)(
cou
 >> 16);

230 
s_cou
[12] = (
UINT8
)(
cou
 >> 24);

232 
	`RTMPAesEny
(&
pCڋxt
->
CK
[0], &
s_cou
[0],Cڋxt->
cffic
);

234 
p
 = &(
pCڋxt
->
cffic
[ (
cff_posi
 & 3) << 2 ]);

235  
	`GETBIG32
(
p
);

236 
	}
}

243 
VOID
 
	$x_128
(

244 
IN
 
PUCHAR
 
a
,

245 
IN
 
PUCHAR
 
b
,

246 
OUT
 
PUCHAR
 
out
)

248 
INT
 
i
;

250 
i
=0;i<16; i++)

252 
out
[
i
] = 
a
[i] ^ 
b
[i];

254 
	}
}

256 
UCHAR
 
	$RTMPCkSbox
(

257 
IN
 
UCHAR
 
a
)

259  
SboxTab
[()
a
];

260 
	}
}

262 
VOID
 
	$x_32
(

263 
IN
 
PUCHAR
 
a
,

264 
IN
 
PUCHAR
 
b
,

265 
OUT
 
PUCHAR
 
out
)

267 
INT
 
i
;

269 
i
=0;i<4; i++)

271 
out
[
i
] = 
a
[i] ^ 
b
[i];

273 
	}
}

275 
VOID
 
	$xt_key
(

276 
IN
 
PUCHAR
 
key
,

277 
IN
 
INT
 
round
)

279 
UCHAR
 
rc
;

280 
UCHAR
 
sbox_key
[4];

281 
UCHAR
 
rc_b
[12] =

287 
sbox_key
[0] = 
	`RTMPCkSbox
(
key
[13]);

288 
sbox_key
[1] = 
	`RTMPCkSbox
(
key
[14]);

289 
sbox_key
[2] = 
	`RTMPCkSbox
(
key
[15]);

290 
sbox_key
[3] = 
	`RTMPCkSbox
(
key
[12]);

292 
rc
 = 
rc_b
[
round
];

294 
	`x_32
(&
key
[0], 
sbox_key
, &key[0]);

295 
key
[0] = key[0] ^ 
rc
;

297 
	`x_32
(&
key
[4], &key[0], &key[4]);

298 
	`x_32
(&
key
[8], &key[4], &key[8]);

299 
	`x_32
(&
key
[12], &key[8], &key[12]);

300 
	}
}

302 
VOID
 
	$by_sub
(

303 
IN
 
PUCHAR
 

,

304 
OUT
 
PUCHAR
 
out
)

306 
INT
 
i
;

308 
i
=0; i< 16; i++)

310 
out
[
i
] = 
	`RTMPCkSbox
(

[i]);

312 
	}
}

314 
VOID
 
	$shi_row
(

315 
IN
 
PUCHAR
 

,

316 
OUT
 
PUCHAR
 
out
)

318 
out
[0] = 

[0];

319 
out
[1] = 

[5];

320 
out
[2] = 

[10];

321 
out
[3] = 

[15];

322 
out
[4] = 

[4];

323 
out
[5] = 

[9];

324 
out
[6] = 

[14];

325 
out
[7] = 

[3];

326 
out
[8] = 

[8];

327 
out
[9] = 

[13];

328 
out
[10] = 

[2];

329 
out
[11] = 

[7];

330 
out
[12] = 

[12];

331 
out
[13] = 

[1];

332 
out
[14] = 

[6];

333 
out
[15] = 

[11];

334 
	}
}

336 
VOID
 
	$mix_cumn
(

337 
IN
 
PUCHAR
 

,

338 
OUT
 
PUCHAR
 
out
)

340 
INT
 
i
;

341 
UCHAR
 
add1b
[4];

342 
UCHAR
 
add1bf7
[4];

343 
UCHAR
 
rl
[4];

344 
UCHAR
 
sw_hfs
[4];

345 
UCHAR
 
df7
[4];

346 
UCHAR
 
rr
[4];

347 
UCHAR
 
mp
[4];

348 
UCHAR
 
mpb
[4];

350 
i
=0 ; i<4; i++)

352 i((

[
i
] & 0x80)== 0x80)

353 
add1b
[
i
] = 0x1b;

355 
add1b
[
i
] = 0x00;

358 
sw_hfs
[0] = 

[2];

359 
sw_hfs
[1] = 

[3];

360 
sw_hfs
[2] = 

[0];

361 
sw_hfs
[3] = 

[1];

363 
rl
[0] = 

[3];

364 
rl
[1] = 

[0];

365 
rl
[2] = 

[1];

366 
rl
[3] = 

[2];

368 
df7
[0] = 

[0] & 0x7f;

369 
df7
[1] = 

[1] & 0x7f;

370 
df7
[2] = 

[2] & 0x7f;

371 
df7
[3] = 

[3] & 0x7f;

373 
i
 = 3; i>0; i--)

375 
df7
[
i
] =ndf7[i] << 1;

376 i((
df7
[
i
-1] & 0x80) == 0x80)

378 
df7
[
i
] = (andf7[i] | 0x01);

381 
df7
[0] =ndf7[0] << 1;

382 
df7
[0] =ndf7[0] & 0xfe;

384 
	`x_32
(
add1b
, 
df7
, 
add1bf7
);

386 
	`x_32
(

, 
add1bf7
, 
rr
);

388 
mp
[0] = 
rr
[0];

389 
rr
[0] =otr[1];

390 
rr
[1] =otr[2];

391 
rr
[2] =otr[3];

392 
rr
[3] = 
mp
[0];

394 
	`x_32
(
add1bf7
, 
rr
, 
mp
);

395 
	`x_32
(
sw_hfs
, 
rl
,
mpb
);

396 
	`x_32
(
mp
, 
mpb
, 
out
);

397 
	}
}

399 
VOID
 
	$RTMPAesEny
(

400 
IN
 
PUCHAR
 
key
,

401 
IN
 
PUCHAR
 
da
,

402 
IN
 
PUCHAR
 
chxt
)

404 
INT
 
round
;

405 
INT
 
i
;

406 
UCHAR
 
rmeda
[16];

407 
UCHAR
 
rmedb
[16];

408 
UCHAR
 
round_key
[16];

410 
i
=0; i<16; i++
round_key
[i] = 
key
[i];

412 
round
 = 0;ound < 11;ound++)

414 i(
round
 == 0)

416 
	`x_128
(
round_key
, 
da
, 
chxt
);

417 
	`xt_key
(
round_key
, 
round
);

419 i(
round
 == 10)

421 
	`by_sub
(
chxt
, 
rmeda
);

422 
	`shi_row
(
rmeda
, 
rmedb
);

423 
	`x_128
(
rmedb
, 
round_key
, 
chxt
);

427 
	`by_sub
(
chxt
, 
rmeda
);

428 
	`shi_row
(
rmeda
, 
rmedb
);

429 
	`mix_cumn
(&
rmedb
[0], &
rmeda
[0]);

430 
	`mix_cumn
(&
rmedb
[4], &
rmeda
[4]);

431 
	`mix_cumn
(&
rmedb
[8], &
rmeda
[8]);

432 
	`mix_cumn
(&
rmedb
[12], &
rmeda
[12]);

433 
	`x_128
(
rmeda
, 
round_key
, 
chxt
);

434 
	`xt_key
(
round_key
, 
round
);

438 
	}
}

441 
VOID
 
	$RTMPMicF
(

442 
IN
 
PMIC_CONTEXT
 
pCڋxt
,

443 
OUT
 
UCHAR
 
dige
[4])

445 
INT
 
by_posi
;

446 
ULONG
 
v
;

447 
ULONGLONG
 
sum
, 
utmp
;

448 
LONGLONG
 
mp
;

451 i(
by_posi
 = (
pCڋxt
->
posi
 & 3)) != 0) {

454 
pCڋxt
->

[
by_posi
++] = 0;

455 
pCڋxt
->
posi
++;

456 } 
by_posi
 < 4);

457 
v
 = 
	`GETBIG32
(&
pCڋxt
->

[0]);

458 
	`MIC_ACCUM
(
v
);

462 
sum
 = 
pCڋxt
->
accum
;

463 
mp
 = (
sum
 & 0xffffffffL) - ((sum >> 32) * 15);

464 
utmp
 = (
mp
 & 0xffffffffL) - ((stmp >> 32) * 15);

465 
sum
 = 
utmp
 & 0xffffffffL;

466 i(
utmp
 > 0x10000000fL)

467 
sum
 -= 15;

469 
v
 = (
ULONG
)
sum
;

470 
dige
[0] = (
UCHAR
)((
v
>>24) & 0xFF);

471 
dige
[1] = (
UCHAR
((
v
>>16) & 0xFF);

472 
dige
[2] = (
UCHAR
((
v
>>8) & 0xFF);

473 
dige
[3] = (
UCHAR
)((
v
>>0) & 0xFF);

474 
	}
}

476 
VOID
 
	$RTMPCkInCMIC
(

477 
IN
 
PRTMP_ADAPTER
 
pAd
,

478 
OUT
 
PUCHAR
 
pMIC
,

479 
IN
 
PUCHAR
 
p80211hdr
,

480 
IN
 
PNDIS_PACKET
 
pPack
,

481 
IN
 
PCIPHER_KEY
 
pKey
,

482 
IN
 
PUCHAR
 
mic_
)

484 
PACKET_INFO
 
PackInfo
;

485 
PUCHAR
 
pSrcBufVA
;

486 
ULONG
 
SrcBufL
;

487 
PUCHAR
 
pDA
, 
pSA
, 
pPro
;

488 
UCHAR
 
bighn
[2];

489 
UCHAR
 
ck_ck
[16];

490 
MIC_CONTEXT
 
mic_x
;

491 
USHORT
 
yldn
;

492 
UCHAR
 
i
;

494 i(
pKey
 =
NULL
)

496 
	`DBGPRINT_ERR
(("RTMPCkipInsertCMIC, Beforeo formhe CKIP key (CK),Key can't be NULL\n"));

500 *(
p80211hdr
+1) & 3)

503 
pDA
 = 
p80211hdr
+4;

504 
pSA
 = 
p80211hdr
+10;

507 
pDA
 = 
p80211hdr
+16;

508 
pSA
 = 
p80211hdr
+10;

511 
pDA
 = 
p80211hdr
+4;

512 
pSA
 = 
p80211hdr
+16;

515 
pDA
 = 
p80211hdr
+16;

516 
pSA
 = 
p80211hdr
+24;

520 
	`RTMP_QuyPackInfo
(
pPack
, &
PackInfo
, &
pSrcBufVA
, &
SrcBufL
);

522 i(
SrcBufL
 < 
LENGTH_802_3
)

525 
pPro
 = 
pSrcBufVA
 + 12;

526 
yldn
 = 
PackInfo
.
TٮPackLgth
 - 
LENGTH_802_3
 + 18;

528 
bighn
[0] = ()(
yldn
 >> 8);

529 
bighn
[1] = ()
yldn
;

534 i(
pKey
->
KeyL
 < 16)

536 
i
 = 0; i < (16 / 
pKey
->
KeyL
); i++)

538 
	`NdisMoveMemy
(
ck_ck
 + 
i
 * 
pKey
->
KeyL
,

539 
pKey
->
Key
,

540 
pKey
->
KeyL
);

542 
	`NdisMoveMemy
(
ck_ck
 + 
i
 * 
pKey
->
KeyL
,

543 
pKey
->
Key
,

544 16 - (
i
 * 
pKey
->
KeyL
));

548 
	`NdisMoveMemy
(
ck_ck
, 
pKey
->
Key
,Key->
KeyL
);

550 
	`RTMPCkMicIn
(&
mic_x
, 
ck_ck
);

551 
	`RTMPMicUpde
(&
mic_x
, 
pDA
, 
MAC_ADDR_LEN
);

552 
	`RTMPMicUpde
(&
mic_x
, 
pSA
, 
MAC_ADDR_LEN
);

553 
	`RTMPMicUpde
(&
mic_x
, 
bighn
, 2);

554 
	`RTMPMicUpde
(&
mic_x
, 
mic_
, 8);

555 
	`RTMPMicUpde
(&
mic_x
, 
pAd
->
SCfg
.
TxSEQ
, 4);

556 
	`RTMPMicUpde
(&
mic_x
, 
pPro
, 2);

558 
pSrcBufVA
 +
LENGTH_802_3
;

559 
SrcBufL
 -
LENGTH_802_3
;

564 i(
SrcBufL
 > 0)

565 
	`RTMPMicUpde
(&
mic_x
, 
pSrcBufVA
, 
SrcBufL
);

567 
	`NdisGNextBufr
(
PackInfo
.
pFBufr
, &PacketInfo.pFirstBuffer);

568 i(
PackInfo
.
pFBufr
)

570 
	`NDIS_QUERY_BUFFER
(
PackInfo
.
pFBufr
, &
pSrcBufVA
, &
SrcBufL
);

574 } 
TRUE
);

576 
	`RTMPMicF
(&
mic_x
, 
pMIC
);

577 
	}
}

	@sta/rtmp_data.c

37 
	~"_cfig.h
"

41 
VOID
 
	$STARxEAPOLFmeIndi
(

42 
IN
 
PRTMP_ADAPTER
 
pAd
,

43 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

44 
IN
 
RX_BLK
 *
pRxBlk
,

45 
IN
 
UCHAR
 
FromWhichBSSID
)

47 
PRXWI_STRUC
 
pRxWI
 = 
pRxBlk
->pRxWI;

48 
UCHAR
 *
pTmpBuf
;

51 #ifde
WPA_SUPPLICANT_SUPPORT


52 i(
pAd
->
SCfg
.
WSuliUP
)

58 i(
pAd
->
SCfg
.
IEEE8021X
 =
TRUE
) &&

59 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11WEPEbd
) &&

60 (
EAP_CODE_SUCCESS
 =
	`WCheckECode
(
pAd
, 
pRxBlk
->
pDa
,RxBlk->
DaSize
, 
LENGTH_802_1_H
)))

62 
PUCHAR
 
Key
;

63 
UCHAR
 
ChAlg
;

64 
idx
 = 0;

66 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, ("Receive EAP-SUCCESS Packet\n"));

68 
	`STA_PORT_SECURED
(
pAd
);

70 i(
pAd
->
SCfg
.
IEEE8021x_qued_keys
 =
FALSE
)

72 
idx
 = 
pAd
->
SCfg
.
DeseShedKeyId
;

73 
ChAlg
 = 
pAd
->
SCfg
.
DeseShedKey
[
idx
].CipherAlg;

74 
Key
 = 
pAd
->
SCfg
.
DeseShedKey
[
idx
].Key;

76 i(
pAd
->
SCfg
.
DeseShedKey
[
idx
].
KeyL
 > 0)

79 
	`RTMP_ASIC_SHARED_KEY_TABLE
(
pAd
, 
BSS0
, 
idx
, &pAd->
SCfg
.
DeseShedKey
[idx]);

84 
	`RTMP_SET_WCID_SEC_INFO
(
pAd
, 
BSS0
, 
idx
, 
ChAlg
, 
BSSID_WCID
, 
SHAREDKEYTABLE
);

86 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSCed
);

87 
pAd
->
ExaInfo
 = 
GENERAL_LINK_UP
;

90 
pAd
->
ShedKey
[
BSS0
][
idx
].
ChAlg
 = CipherAlg;

91 
pAd
->
ShedKey
[
BSS0
][
idx
].
KeyL
 =Ad->
SCfg
.
DeseShedKey
[idx].KeyLen;

92 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][
idx
].
Key
,

93 
pAd
->
SCfg
.
DeseShedKey
[
idx
].
Key
,

94 
pAd
->
SCfg
.
DeseShedKey
[
idx
].
KeyL
);

99 
	`Indi_Legacy_Pack
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

110 
pTmpBuf
 = 
pRxBlk
->
pDa
 - 
LENGTH_802_11
;

111 
	`NdisMoveMemy
(
pTmpBuf
, 
pRxBlk
->
pHd
, 
LENGTH_802_11
);

112 
	`REPORT_MGMT_FRAME_TO_MLME
(
pAd
, 
pRxWI
->
WessCliID
, 
pTmpBuf
, 
pRxBlk
->
DaSize
 + 
LENGTH_802_11
,RxWI->
RSSI0
,RxWI->
RSSI1
,RxWI->
RSSI2
, 0);

113 
	`DBGPRINT_RAW
(
RT_DEBUG_TRACE
, ("!!!܈EAPOL/AIRONET DATAMLME (n=%d!!!\n", 
pRxBlk
->
DaSize
));

117 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

120 
	}
}

122 
VOID
 
	$STARxDaFmeAoun
(

123 
IN
 
PRTMP_ADAPTER
 
pAd
,

124 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

125 
IN
 
RX_BLK
 *
pRxBlk
,

126 
IN
 
UCHAR
 
FromWhichBSSID
)

130 i(!
	`RTMPCheckWPAame
(
pAd
, 
pEry
, 
pRxBlk
->
pDa
,RxBlk->
DaSize
, 
FromWhichBSSID
))

138 i(
pRxBlk
->
pHd
->
FC
.
W
)

141 i(
pAd
->
SCfg
.
WStus
 =
Ndis802_11EnyiDibd
)

144 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

151 i((
pAd
->
SCfg
.
WStus
 !
Ndis802_11EnyiDibd
) &&

152 (
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
))

155 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

160 
	`RX_BLK_CLEAR_FLAG
(
pRxBlk
, 
fRX_EAP
);

163 i(!
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_ARALINK
))

166 
	`CmmRxnRkFmeIndi
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

172 
	`CmmRxRkFmeIndi
(
pAd
, 
pEry
, 
pRxBlk
, 
FromWhichBSSID
);

174 #ifde
QOS_DLS_SUPPORT


175 
	`RX_BLK_CLEAR_FLAG
(
pRxBlk
, 
fRX_DLS
);

180 
	`RX_BLK_SET_FLAG
(
pRxBlk
, 
fRX_EAP
);

181 #ifde
DOT11_N_SUPPORT


182 i(
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_AMPDU
&& (
pAd
->
CommCfg
.
bDibRedg
 == 0))

184 
	`Indi_AMPDU_Pack
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

191 
	`STARxEAPOLFmeIndi
(
pAd
, 
pEry
, 
pRxBlk
, 
FromWhichBSSID
);

194 
	}
}

198 
BOOLEAN
 
	$STACheckTkMICVue
(

199 
IN
 
PRTMP_ADAPTER
 
pAd
,

200 
IN
 
MAC_TABLE_ENTRY
 *
pEry
,

201 
IN
 
RX_BLK
 *
pRxBlk
)

203 
PHEADER_802_11
 
pHd
 = 
pRxBlk
->pHeader;

204 
UCHAR
 *
pDa
 = 
pRxBlk
->pData;

205 
USHORT
 
DaSize
 = 
pRxBlk
->DataSize;

206 
UCHAR
 
UrPriܙy
 = 
pRxBlk
->UserPriority;

207 
PCIPHER_KEY
 
pWKey
;

208 
UCHAR
 *
pDA
, *
pSA
;

210 
pWKey
 = &
pAd
->
ShedKey
[
BSS0
][
pRxBlk
->
pRxWI
->
KeyIndex
];

212 
pDA
 = 
pHd
->
Addr1
;

213 i(
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_INFRA
))

215 
pSA
 = 
pHd
->
Addr3
;

219 
pSA
 = 
pHd
->
Addr2
;

222 i(
	`RTMPTkComMICVue
(
pAd
,

223 
pDa
,

224 
pDA
,

225 
pSA
,

226 
pWKey
->
RxMic
,

227 
UrPriܙy
,

228 
DaSize
=
FALSE
)

230 
	`DBGPRINT_RAW
(
RT_DEBUG_ERROR
,("Rx MIC Valuerror 2\n"));

232 #ifde
WPA_SUPPLICANT_SUPPORT


233 i(
pAd
->
SCfg
.
WSuliUP
)

235 
	`WSdMicFauToWSuli
(
pAd
, (
pWKey
->
Ty
 =
PAIRWISEKEY
? 
TRUE
 : 
FALSE
);

240 
	`RTMPRtMicE
(
pAd
, 
pWKey
);

244 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxBlk
->
pRxPack
, 
NDIS_STATUS_FAILURE
);

245  
FALSE
;

248  
TRUE
;

249 
	}
}

262 
VOID
 
	$STAHdRxDaFme
(

263 
IN
 
PRTMP_ADAPTER
 
pAd
,

264 
IN
 
RX_BLK
 *
pRxBlk
)

266 
PRT28XX_RXD_STRUC
 
pRxD
 = &(
pRxBlk
->
RxD
);

267 
PRXWI_STRUC
 
pRxWI
 = 
pRxBlk
->pRxWI;

268 
PHEADER_802_11
 
pHd
 = 
pRxBlk
->pHeader;

269 
PNDIS_PACKET
 
pRxPack
 = 
pRxBlk
->pRxPacket;

270 
BOOLEAN
 
bFgmt
 = 
FALSE
;

271 
MAC_TABLE_ENTRY
 *
pEry
 = 
NULL
;

272 
UCHAR
 
FromWhichBSSID
 = 
BSS0
;

273 
UCHAR
 
UrPriܙy
 = 0;

275 i((
pHd
->
FC
.
FrDs
 =1&& (pHd->FC.
ToDs
 == 1))

277 #ifde
CLIENT_WDS


278 i((
pRxWI
->
WessCliID
 < 
MAX_LEN_OF_MAC_TABLE
)

279 && 
	`IS_ENTRY_CLIENT
(&
pAd
->
MacTab
.
Cڋ
[
pRxWI
->
WessCliID
]))

281 
	`RX_BLK_SET_FLAG
(
pRxBlk
, 
fRX_WDS
);

286 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

293 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
))

296 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

301 #ifde
QOS_DLS_SUPPORT


303 i(
	`RTMPRcvFmeDLSCheck
(
pAd
, 
pHd
, 
pRxWI
->
MPDUtٮByCou
, 
pRxD
))

310 i(
pRxD
->
MyBss
 == 0)

314 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

319 
pAd
->
RkCous
.
RxCouSLaNULL
++;

320 i(
pAd
->
CommCfg
.
bAPSDCab
 &&Ad->CommCfg.
APEdPm
.bAPSDCab && (
pHd
->
FC
.
SubTy
 & 0x08))

322 
UCHAR
 *
pDa
;

323 
	`DBGPRINT
(
RT_DEBUG_INFO
,("bAPSDCapable\n"));

326 
pDa
 = (
PUCHAR
)
pHd
 + 
LENGTH_802_11
;

327 i((*
pDa
 >> 4) & 0x01)

329 
	`DBGPRINT
(
RT_DEBUG_INFO
,("RxDone- Rcv EOSP frame, driver may fall into sleep\n"));

330 
pAd
->
CommCfg
.
bInSviPiod
 = 
FALSE
;

333 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

335 #ifde
RTMP_MAC_PCI


336 
USHORT
 
TbNumToNextWakeUp
;

337 
USHORT
 
NextDtim
 = 
pAd
->
SCfg
.
DtimPiod
;

338 
ULONG
 
Now
;

340 
	`NdisGSyemUpTime
(&
Now
);

341 
NextDtim
 -(
USHORT
)(
Now
 - 
pAd
->
SCfg
.
LaBcRxTime
)/pAd->
CommCfg
.
BcPiod
;

343 
TbNumToNextWakeUp
 = 
pAd
->
SCfg
.
DeuLiCou
;

344 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_RECEIVE_DTIM
&& (
TbNumToNextWakeUp
 > 
NextDtim
))

345 
TbNumToNextWakeUp
 = 
NextDtim
;

347 
	`RTMP_SET_PSM_BIT
(
pAd
, 
PWR_SAVE
);

349 
	`AsicS˕ThAutoWakeup
(
pAd
, 
TbNumToNextWakeUp
);

355 i((
pHd
->
FC
.
MeDa
&& (
pAd
->
CommCfg
.
bInSviPiod
))

357 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("Sendingnotherrigger frame when More Data bit is seto 1\n"));

362 i((
pHd
->
FC
.
SubTy
 & 0x04))

365 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

370 i(
	`INFRA_ON
(
pAd
))

374 #ifde
QOS_DLS_SUPPORT


375 && (!
pAd
->
CommCfg
.
bDLSCab
)

379 i(!
	`RTMPEquMemy
(&
pHd
->
Addr2
, &
pAd
->
CommCfg
.
Bssid
, 6))

383 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

391 i(!
	`RTMPEquMemy
(&
pHd
->
Addr3
, &
pAd
->
CommCfg
.
Bssid
, 6))

395 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

403 i(
pRxWI
->
WessCliID
 < 
MAX_LEN_OF_MAC_TABLE
)

405 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
pRxWI
->
WessCliID
];

410 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

415 i(
	`INFRA_ON
(
pAd
))

417 
	`RX_BLK_SET_FLAG
(
pRxBlk
, 
fRX_INFRA
);

418 #i
	`defed
(
DOT11Z_TDLS_SUPPORT
|| defed(
QOS_DLS_SUPPORT
)

419 i((
pHd
->
FC
.
FrDs
 =0&& (pHd->FC.
ToDs
 == 0))

420 
	`RX_BLK_SET_FLAG
(
pRxBlk
, 
fRX_DLS
);

423 
	`ASSERT
(
pRxWI
->
WessCliID
 =
BSSID_WCID
);

427 i((
pEry
->
bIAmBadAthos
 =
FALSE
&& (
pRxD
->
AMPDU
 =1&& (
pHd
->
FC
.
Rry
 ))

429 
pEry
->
bIAmBadAthos
 = 
TRUE
;

430 
pAd
->
CommCfg
.
IOTePm
.
bCutAthos
 = 
TRUE
;

431 
pAd
->
CommCfg
.
IOTePm
.
bLaAthos
 = 
TRUE
;

432 i(!
	`STA_AES_ON
(
pAd
))

434 
	`AsicUpdePre
(
pAd
, 8, 
ALLN_SETPROTECT
, 
TRUE
, 
FALSE
);

439 
pRxBlk
->
pDa
 = (
UCHAR
 *)
pHd
;

447 #ifde
CLIENT_WDS


448 i(
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_WDS
))

450 
pRxBlk
->
pDa
 +
LENGTH_802_11_WITH_ADDR4
;

451 
pRxBlk
->
DaSize
 -
LENGTH_802_11_WITH_ADDR4
;

456 
pRxBlk
->
pDa
 +
LENGTH_802_11
;

457 
pRxBlk
->
DaSize
 -
LENGTH_802_11
;

461 i(
pHd
->
FC
.
SubTy
 & 0x08)

463 
	`RX_BLK_SET_FLAG
(
pRxBlk
, 
fRX_QOS
);

464 
UrPriܙy
 = *(
pRxBlk
->
pDa
) & 0x0f;

466 i((*
pRxBlk
->
pDa
) & 0x80)

468 
	`RX_BLK_SET_FLAG
(
pRxBlk
, 
fRX_AMSDU
);

472 
pRxBlk
->
pDa
 += 2;

473 
pRxBlk
->
DaSize
 -=2;

475 
pRxBlk
->
UrPriܙy
 = UserPriority;

478 i((
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
&& (
pHd
->
FC
.
MeDa
 == 1))

480 i((((
UrPriܙy
 == 0) || (UserPriority == 3)) &&

481 
pAd
->
CommCfg
.
bAPSDAC_BE
 == 0) ||

482 (((
UrPriܙy
 == 1) || (UserPriority == 2)) &&

483 
pAd
->
CommCfg
.
bAPSDAC_BK
 == 0) ||

484 (((
UrPriܙy
 == 4) || (UserPriority == 5)) &&

485 
pAd
->
CommCfg
.
bAPSDAC_VI
 == 0) ||

486 (((
UrPriܙy
 == 6) || (UserPriority == 7)) &&

487 
pAd
->
CommCfg
.
bAPSDAC_VO
 == 0))

490 
	`RTMP_PS_POLL_ENQUEUE
(
pAd
);

495 i(
pHd
->
FC
.
Ord
)

497 #ifde
AGGREGATION_SUPPORT


498 i((
pRxWI
->
PHYMODE
 <
MODE_OFDM
&& (
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_AGGREGATION_INUSED
)))

500 
	`RX_BLK_SET_FLAG
(
pRxBlk
, 
fRX_ARALINK
);

505 #ifde
DOT11_N_SUPPORT


506 
	`RX_BLK_SET_FLAG
(
pRxBlk
, 
fRX_HTC
);

508 
pRxBlk
->
pDa
 += 4;

509 
pRxBlk
->
DaSize
 -= 4;

515 i(
pRxD
->
L2PAD
)

519 
	`RX_BLK_SET_FLAG
(
pRxBlk
, 
fRX_PAD
);

520 
pRxBlk
->
pDa
 += 2;

523 #ifde
DOT11_N_SUPPORT


524 i(
pRxD
->
BA
)

526 
	`RX_BLK_SET_FLAG
(
pRxBlk
, 
fRX_AMPDU
);

530 #i
	`defed
(
SOFT_ENCRYPT
|| defed(
ADHOC_WPA2PSK_SUPPORT
)

534 i((
pHd
->
FC
.
W
 =1&& (
pRxD
->
Deyed
 == 0))

536 
PCIPHER_KEY
 
pSwKey
 = 
NULL
;

539 i((
pSwKey
 = 
	`RTMPSwChKeySei
(
pAd
,

540 
pRxBlk
->
pDa
,

541 
pRxBlk
,

542 
pEry
)=
NULL
)

544 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("No vaild cipher key for SW decryption!!!\n"));

546 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

551 i(
	`RTMPSoDeyiAi
(
pAd
,

552 (
PUCHAR
)
pHd
,

553 
UrPriܙy
,

554 
pSwKey
,

555 
pRxBlk
->
pDa
,

556 &(
pRxBlk
->
DaSize
)!
NDIS_STATUS_SUCCESS
)

559 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

563 
pRxD
->
Deyed
 = 1;

571 i(
pRxD
->
B
 ||RxD->
M
)

573 #ifde
STATS_COUNT_SUPPORT


574 
	`INC_COUNTER64
(
pAd
->
WnCous
.
MuiReivedFmeCou
);

578 i(
pHd
->
FC
.
MeFg
)

581 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

586 i(
pHd
->
FC
.
FrDs
 && 
	`MAC_ADDR_EQUAL
Hd->
Addr3
, 
pAd
->
CutAddss
))

589 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

593 i(
	`ADHOC_ON
(
pAd
))

595 
MAC_TABLE_ENTRY
 *
pAdhocEry
 = 
NULL
;

596 
pAdhocEry
 = 
	`MacTabLookup
(
pAd
, 
pHd
->
Addr2
);

597 i(
pAdhocEry
)

598 
	`Upde_Rssi_Same
(
pAd
, &
pAdhocEry
->
RssiSame
, 
pRxWI
);

601 
	`Indi_Legacy_Pack
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

604 i(
pRxD
->
U2M
)

606 
pAd
->
LaRxRe
 = (
USHORT
)((
pRxWI
->
MCS
+ (pRxWI->
BW
 <<7+ (pRxWI->
ShtGI
 <<8)+ (pRxWI->
PHYMODE
 <<14)) ;

609 #i
	`defed
(
DOT11Z_TDLS_SUPPORT
|| defed(
QOS_DLS_SUPPORT
)

610 i(
	`RX_BLK_TEST_FLAG
(
pRxBlk
, 
fRX_DLS
))

612 
MAC_TABLE_ENTRY
 *
pDlsEry
 = 
NULL
;

615 
pDlsEry
 = &
pAd
->
MacTab
.
Cڋ
[
pRxWI
->
WessCliID
];

617 i(
pDlsEry
 && (
pRxWI
->
WessCliID
 < 
MAX_LEN_OF_MAC_TABLE
))

619 
	`Upde_Rssi_Same
(
pAd
, &
pDlsEry
->
RssiSame
, 
pRxWI
);

620 
	`NdisAcqueSpLock
(&
pAd
->
MacTabLock
);

621 
pDlsEry
->
NoDaIdCou
 = 0;

622 
	`NdisRSpLock
(&
pAd
->
MacTabLock
);

627 i(
	`ADHOC_ON
(
pAd
))

629 
MAC_TABLE_ENTRY
 *
pAdhocEry
 = 
NULL
;

630 
pAdhocEry
 = 
	`MacTabLookup
(
pAd
, 
pHd
->
Addr2
);

631 i(
pAdhocEry
)

632 
	`Upde_Rssi_Same
(
pAd
, &
pAdhocEry
->
RssiSame
, 
pRxWI
);

636 
	`Upde_Rssi_Same
(
pAd
, &pAd->
SCfg
.
RssiSame
, 
pRxWI
);

638 
pAd
->
SCfg
.
LaSNR0
 = (
UCHAR
)(
pRxWI
->
SNR0
);

639 
pAd
->
SCfg
.
LaSNR1
 = (
UCHAR
)(
pRxWI
->
SNR1
);

643 
pAd
->
RkCous
.
OSecRxOkDaC
++;

646 i(!((
pHd
->
Fg
 =0&& (pHd->
FC
.
MeFg
 == 0)))

650 
bFgmt
 = 
TRUE
;

651 
pRxPack
 = 
	`RTMPDeFgmtDaFme
(
pAd
, 
pRxBlk
);

654 i(
pRxPack
)

656 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
pRxWI
->
WessCliID
];

659 i(
bFgmt
 && (
pRxD
->
Deyed
&& (
pEry
->
WStus
 =
Ndis802_11Enyi2Ebd
))

662 
pRxBlk
->
DaSize
 -= 8;

665 i(
	`STACheckTkMICVue
(
pAd
, 
pEry
, 
pRxBlk
=
FALSE
)

671 
	`STARxDaFmeAoun
(
pAd
, 
pEry
, 
pRxBlk
, 
FromWhichBSSID
);

682 #ifde
XLINK_SUPPORT


683 i(
pAd
->
SCfg
.
PSPXlk
)

685 
	`Indi_Legacy_Pack
(
pAd
, 
pRxBlk
, 
FromWhichBSSID
);

690 
	`ASSERT
(0);

692 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

693 
	}
}

695 
VOID
 
	$STAHdRxMgmtFme
(

696 
IN
 
PRTMP_ADAPTER
 
pAd
,

697 
IN
 
RX_BLK
 *
pRxBlk
)

699 
PRXWI_STRUC
 
pRxWI
 = 
pRxBlk
->pRxWI;

700 
PHEADER_802_11
 
pHd
 = 
pRxBlk
->pHeader;

701 
PNDIS_PACKET
 
pRxPack
 = 
pRxBlk
->pRxPacket;

702 
UCHAR
 
MSNR
 = 0;

709 i((
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
&& (
pHd
->
FC
.
MeDa
 == 1))

712 i(
pAd
->
CommCfg
.
bAPSDAC_VO
 == 0)

715 
	`RTMP_PS_POLL_ENQUEUE
(
pAd
);

723 i((
pHd
->
FC
.
SubTy
 =
SUBTYPE_BEACON
&& (
	`MAC_ADDR_EQUAL
(&
pAd
->
CommCfg
.
Bssid
, &pHd->
Addr2
))

724 && (
pAd
->
RxA
.
EvuePiod
 == 0))

726 
	`Upde_Rssi_Same
(
pAd
, &pAd->
SCfg
.
RssiSame
, 
pRxWI
);

728 
pAd
->
SCfg
.
LaSNR0
 = (
UCHAR
)(
pRxWI
->
SNR0
);

729 
pAd
->
SCfg
.
LaSNR1
 = (
UCHAR
)(
pRxWI
->
SNR1
);

732 i((
pHd
->
FC
.
SubTy
 =
SUBTYPE_BEACON
) &&

733 (
	`ADHOC_ON
(
pAd
)) &&

734 (
pRxWI
->
WessCliID
 < 
MAX_LEN_OF_MAC_TABLE
))

736 
MAC_TABLE_ENTRY
 *
pEry
 = 
NULL
;

737 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
pRxWI
->
WessCliID
];

738 i(
pEry
)

739 
	`Upde_Rssi_Same
(
pAd
, &
pEry
->
RssiSame
, 
pRxWI
);

744 i(
pRxWI
->
MPDUtٮByCou
 > 
MGMT_DMA_BUFFER_SIZE
)

746 
	`DBGPRINT_ERR
(("STAHdRxMgmtFme: fmtorge, siz%d \n", 
pRxWI
->
MPDUtٮByCou
));

750 
MSNR
 = 
	`m
((
CHAR
)
pRxWI
->
SNR0
, (CHARRxWI->
SNR1
);

755 
	`REPORT_MGMT_FRAME_TO_MLME
(
pAd
, 
pRxWI
->
WessCliID
, 
pHd
,RxWI->
MPDUtٮByCou
,

756 
pRxWI
->
RSSI0
,RxWI->
RSSI1
,RxWI->
RSSI2
, 
MSNR
);

757 } 
FALSE
);

759 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_SUCCESS
);

760 
	}
}

762 
VOID
 
	$STAHdRxCڌFme
(

763 
IN
 
PRTMP_ADAPTER
 
pAd
,

764 
IN
 
RX_BLK
 *
pRxBlk
)

766 #ifde
DOT11_N_SUPPORT


767 
PRXWI_STRUC
 
pRxWI
 = 
pRxBlk
->pRxWI;

769 
PHEADER_802_11
 
pHd
 = 
pRxBlk
->pHeader;

770 
PNDIS_PACKET
 
pRxPack
 = 
pRxBlk
->pRxPacket;

771 
BOOLEAN
 
tStus
;

772 
NDIS_STATUS
 
us
 = 
NDIS_STATUS_FAILURE
;

774 
pHd
->
FC
.
SubTy
)

776 
SUBTYPE_BLOCK_ACK_REQ
:

777 #ifde
DOT11_N_SUPPORT


779 
tStus
 = 
	`ClEnqueueFRecv
(
pAd
, 
pRxWI
->
WessCliID
, (pRxWI->
MPDUtٮByCou
), (
PFRAME_BA_REQ
)
pHd
);

780 
us
 = (
tStus
 =
TRUE
? 
NDIS_STATUS_SUCCESS
 : 
NDIS_STATUS_FAILURE
;

784 
SUBTYPE_BLOCK_ACK
:

785 
SUBTYPE_ACK
:

790 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
us
);

791 
	}
}

813 
BOOLEAN
 
	$STARxDeIruHd
(

814 
IN
 
PRTMP_ADAPTER
 
pAd
,

815 
IN
 
BOOLEAN
 
gc
)

817 
NDIS_STATUS
 
Stus
;

818 
UINT32
 
RxProsd
, 
RxPdg
;

819 
BOOLEAN
 
bReschedu
 = 
FALSE
;

820 
RT28XX_RXD_STRUC
 *
pRxD
;

821 
UCHAR
 *
pDa
;

822 
PRXWI_STRUC
 
pRxWI
;

823 
PNDIS_PACKET
 
pRxPack
;

824 
PHEADER_802_11
 
pHd
;

825 
RX_BLK
 
RxCl
;

827 
RxProsd
 = 
RxPdg
 = 0;

833 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
 |

834 
fRTMP_ADAPTER_RESET_IN_PROGRESS
 |

835 
fRTMP_ADAPTER_HALT_IN_PROGRESS
 |

836 
fRTMP_ADAPTER_NIC_NOT_EXIST
) ||

837 !
	`RTMP_TEST_FLAG
(
pAd
,
fRTMP_ADAPTER_START_UP
))

842 #ifde
RTMP_MAC_PCI


843 i(
RxProsd
++ > 
MAX_RX_PROCESS_CNT
)

846 
bReschedu
 = 
TRUE
;

851 
RxProsd
 ++;

860 
pRxPack
 = 
	`GPackFromRxRg
(
pAd
, &(
RxCl
.
RxD
), &
bReschedu
, &
RxPdg
);

861 i(
pRxPack
 =
NULL
)

868 
pRxD
 = &(
RxCl
.
RxD
);

870 
pDa
 = 
	`GET_OS_PKT_DATAPTR
(
pRxPack
);

871 
pRxWI
 = (
PRXWI_STRUC

pDa
;

872 
pHd
 = (
PHEADER_802_11
(
pDa
+
RXWI_SIZE
) ;

874 #ifde
RT_BIG_ENDIAN


875 
	`RTMPFmeEndnChge
(
pAd
, (
PUCHAR
)
pHd
, 
DIR_READ
, 
TRUE
);

876 
	`RTMPWIEndnChge
((
PUCHAR
)
pRxWI
, 
TYPE_RXWI
);

880 
RxCl
.
pRxWI
 =RxWI;

881 
RxCl
.
pHd
 =Header;

882 
RxCl
.
pRxPack
 =RxPacket;

883 
RxCl
.
pDa
 = (
UCHAR
 *
pHd
;

884 
RxCl
.
DaSize
 = 
pRxWI
->
MPDUtٮByCou
;

885 
RxCl
.
Fgs
 = 0;

888 
pAd
->
RkCous
.
ReivedByCou
 +
pRxWI
->
MPDUtٮByCou
;

889 
pAd
->
RkCous
.
OSecReivedByCou
 +
pRxWI
->
MPDUtٮByCou
;

890 
pAd
->
RkCous
.
RxCou
 ++;

892 #ifde
STATS_COUNT_SUPPORT


893 
	`INC_COUNTER64
(
pAd
->
WnCous
.
ReivedFgmtCou
);

896 i(
pRxWI
->
MPDUtٮByCou
 < 14)

897 
Stus
 = 
NDIS_STATUS_FAILURE
;

899 i(
	`MONITOR_ON
(
pAd
))

901 
	`nd_mڙ_cks
(
pAd
, &
RxCl
, 
RTMPMaxRssi
, 
CvtToRssi
);

906 #ifde
RALINK_ATE


907 i(
	`ATE_ON
(
pAd
))

909 
pAd
->
e
.
RxCPSec
++;

910 
	`ATESameRssi
(
pAd
, 
pRxWI
);

911 #ifde
RALINK_QA


912 i(
pAd
->
e
.
bQARxS
 =
TRUE
)

915 
	`ATE_QA_Stiics
(
pAd
, 
pRxWI
, 
pRxD
, 
pHd
);

918 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_SUCCESS
);

924 
Stus
 = 
	`RTMPCheckRxE
(
pAd
, 
pHd
, 
pRxWI
, 
pRxD
);

927 i(
Stus
 =
NDIS_STATUS_SUCCESS
)

930 
pHd
->
FC
.
Ty
)

933 
BTYPE_DATA
:

936 
	`STAHdRxDaFme
(
pAd
, &
RxCl
);

940 
BTYPE_MGMT
:

942 
	`STAHdRxMgmtFme
(
pAd
, &
RxCl
);

946 
BTYPE_CNTL
:

948 
	`STAHdRxCڌFme
(
pAd
, &
RxCl
);

953 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

959 
pAd
->
Cous8023
.
RxEs
++;

961 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pRxPack
, 
NDIS_STATUS_FAILURE
);

965  
bReschedu
;

966 
	}
}

979 
VOID
 
	$RTMPHdTwakeupIru
(

980 
IN
 
PRTMP_ADAPTER
 
pAd
)

982 
	`AsicFWakeup
(
pAd
, 
FALSE
);

983 
	}
}

1003 
VOID
 
	$STASdPacks
(

1004 
IN
 
NDIS_HANDLE
 
MtAdrCڋxt
,

1005 
IN
 
PPNDIS_PACKET
 
PackAay
,

1006 
IN
 
UINT
 
NumbOfPacks
)

1008 
UINT
 
Index
;

1009 
PRTMP_ADAPTER
 
pAd
 = (PRTMP_ADAPTER
MtAdrCڋxt
;

1010 
PNDIS_PACKET
 
pPack
;

1011 
BOOLEAN
 
lowToSd
 = 
FALSE
;

1014 
Index
 = 0; Index < 
NumbOfPacks
; Index++)

1016 
pPack
 = 
PackAay
[
Index
];

1021 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RESET_IN_PROGRESS
) ||

1022 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
) ||

1023 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_RADIO_OFF
))

1028 i(!
	`INFRA_ON
(
pAd
&& !
	`ADHOC_ON
(pAd))

1038 #ifde
QOS_DLS_SUPPORT


1039 || (
pAd
->
CommCfg
.
bDLSCab
)

1043 
MAC_TABLE_ENTRY
 *
pEry
;

1044 
PUCHAR
 
pSrcBufVA
 = 
	`GET_OS_PKT_DATAPTR
(
pPack
);

1046 
pEry
 = 
	`MacTabLookup
(
pAd
, 
pSrcBufVA
);

1048 i(
pEry
 && (
	`IS_ENTRY_DLS
Ery|| 
	`IS_ENTRY_TDLS
(pEntry)))

1050 
	`RTMP_SET_PACKET_WCID
(
pPack
, 
pEry
->
Aid
);

1054 
	`RTMP_SET_PACKET_WCID
(
pPack
, 0);

1059 
	`RTMP_SET_PACKET_WCID
(
pPack
, 0);

1062 
	`RTMP_SET_PACKET_SOURCE
(
pPack
, 
PKTSRC_NDIS
);

1063 
	`NDIS_SET_PACKET_STATUS
(
pPack
, 
NDIS_STATUS_PENDING
);

1064 
pAd
->
RkCous
.
PdgNdisPackCou
++;

1066 
lowToSd
 = 
TRUE
;

1068 } 
FALSE
);

1070 i(
lowToSd
 =
TRUE
)

1071 
	`STASdPack
(
pAd
, 
pPack
);

1073 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1077 
	`RTMPDeQueuePack
(
pAd
, 
FALSE
, 
NUM_OF_TX_RING
, 
MAX_TX_PROCESS
);

1079 
	}
}

1101 
NDIS_STATUS
 
	$STASdPack
(

1102 
IN
 
PRTMP_ADAPTER
 
pAd
,

1103 
IN
 
PNDIS_PACKET
 
pPack
)

1105 
PACKET_INFO
 
PackInfo
;

1106 
PUCHAR
 
pSrcBufVA
;

1107 
UINT
 
SrcBufL
;

1108 
UINT
 
AowFgSize
;

1109 
UCHAR
 
NumbOfFg
;

1110 
UCHAR
 
RTSRequed
;

1111 
UCHAR
 
QueIdx
, 
UrPriܙy
;

1112 
MAC_TABLE_ENTRY
 *
pEry
 = 
NULL
;

1113 
IrqFgs
;

1114 
UCHAR
 
Re
;

1118 
	`RTMP_QuyPackInfo
(
pPack
, &
PackInfo
, &
pSrcBufVA
, &
SrcBufL
);

1120 i(
pSrcBufVA
 =
NULL
)

1122 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("STASdPack -->SrcBufVA =NULL !!!SrcBufL=%x\n",
SrcBufL
));

1125 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1126  
NDIS_STATUS_FAILURE
;

1130 i(
SrcBufL
 < 14)

1132 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("STASendPacket --> Ndis Packet bufferrror !!!\n"));

1133 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1134  (
NDIS_STATUS_FAILURE
);

1141 if(
	`INFRA_ON
(
pAd
))

1143 #i
	`defed
(
QOS_DLS_SUPPORT
|| defed(
DOT11Z_TDLS_SUPPORT
)

1144 
USHORT
 
tmpWcid
;

1146 
tmpWcid
 = 
	`RTMP_GET_PACKET_WCID
(
pPack
);

1148 i(
	`VALID_WCID
(
tmpWcid
) &&

1149 (
	`IS_ENTRY_DLS
(&
pAd
->
MacTab
.
Cڋ
[
tmpWcid
]) ||

1150 
	`IS_ENTRY_TDLS
(&
pAd
->
MacTab
.
Cڋ
[
tmpWcid
])))

1152 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
tmpWcid
];

1153 
Re
 = 
pAd
->
MacTab
.
Cڋ
[
tmpWcid
].
CuTxRe
;

1158 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
];

1159 
	`RTMP_SET_PACKET_WCID
(
pPack
, 
BSSID_WCID
);

1160 
Re
 = 
pAd
->
CommCfg
.
TxRe
;

1163 i(
	`ADHOC_ON
(
pAd
))

1165 i(*
pSrcBufVA
 & 0x01)

1167 
	`RTMP_SET_PACKET_WCID
(
pPack
, 
MCAST_WCID
);

1168 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
MCAST_WCID
];

1172 #ifde
XLINK_SUPPORT


1173 i(
pAd
->
SCfg
.
PSPXlk
)

1175 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
MCAST_WCID
];

1176 
pEry
->
Aid
 = 
MCAST_WCID
;

1180 
pEry
 = 
	`MacTabLookup
(
pAd
, 
pSrcBufVA
);

1182 i(
pEry
)

1183 
	`RTMP_SET_PACKET_WCID
(
pPack
, 
pEry
->
Aid
);

1185 
Re
 = 
pAd
->
CommCfg
.
TxRe
;

1189 i(!
pEry
)

1191 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("STASdPack->Cn fdEry(%2x:%2x:%2x:%2x:%2x:%2x MacTab!\n", 
	`PRINT_MAC
(
pSrcBufVA
)));

1194 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1195  
NDIS_STATUS_FAILURE
;

1198 i(
	`ADHOC_ON
(
pAd
)

1201 
	`RTMP_SET_PACKET_WCID
(
pPack
, (
UCHAR
)
pEry
->
Aid
);

1207 
UrPriܙy
 = 0;

1208 
QueIdx
 = 
QID_AC_BE
;

1209 
	`RTMPCheckEthTy
(
pAd
, 
pPack
, 
pEry
, &
UrPriܙy
, &
QueIdx
);

1217 i(((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
) ||

1218 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

1219 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
) ||

1220 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
)

1221 #ifde
WPA_SUPPLICANT_SUPPORT


1222 || (
pAd
->
SCfg
.
IEEE8021X
 =
TRUE
)

1225 && ((
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
|| (pAd->SCfg.
MicEC
 >= 2))

1226 && (
	`RTMP_GET_PACKET_EAPOL
(
pPack
)=
FALSE
)

1229 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("STASendPacket --> Dropacket beforeort secured !!!\n"));

1230 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1232  (
NDIS_STATUS_FAILURE
);

1244 i(*
pSrcBufVA
 & 0x01)

1245 
NumbOfFg
 = 1;

1246 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_AGGREGATION_INUSED
))

1247 
NumbOfFg
 = 1;

1248 i(
	`CLIENT_STATUS_TEST_FLAG
(
pEry
, 
fCLIENT_STATUS_AMSDU_INUSED
))

1249 
NumbOfFg
 = 1;

1250 #ifde
DOT11_N_SUPPORT


1251 i((
pAd
->
SCfg
.
HTPhyMode
.
fld
.
MODE
 =
MODE_HTMIX
|| (pAd->SCfg.HTPhyMode.fld.MODE =
MODE_HTGREENFIELD
))

1252 
NumbOfFg
 = 1;

1265 
AowFgSize
 = (
pAd
->
CommCfg
.
FgmtThshd
- 
LENGTH_802_11
 - 
LENGTH_CRC
;

1266 
NumbOfFg
 = ((
PackInfo
.
TٮPackLgth
 - 
LENGTH_802_3
 + 
LENGTH_802_1_H
/ 
AowFgSize
) + 1;

1268 i(((
PackInfo
.
TٮPackLgth
 - 
LENGTH_802_3
 + 
LENGTH_802_1_H
% 
AowFgSize
) == 0)

1270 
NumbOfFg
--;

1275 
	`RTMP_SET_PACKET_FRAGMENTS
(
pPack
, 
NumbOfFg
);

1283 i(
NumbOfFg
 > 1)

1284 
RTSRequed
 = (
pAd
->
CommCfg
.
FgmtThshd
 >Ad->CommCfg.
RtsThshd
) ? 1 : 0;

1286 
RTSRequed
 = (
PackInfo
.
TٮPackLgth
 > 
pAd
->
CommCfg
.
RtsThshd
) ? 1 : 0;

1289 
	`RTMP_SET_PACKET_RTS
(
pPack
, 
RTSRequed
);

1290 
	`RTMP_SET_PACKET_TXRATE
(
pPack
, 
pAd
->
CommCfg
.
TxRe
);

1293 
	`RTMP_SET_PACKET_UP
(
pPack
, 
UrPriܙy
);

1297 
	`RTMP_IRQ_LOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

1298 i(
pAd
->
TxSwQueue
[
QueIdx
].
Numb
 >
MAX_PACKETS_IN_QUEUE
)

1300 
	`RTMP_IRQ_UNLOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

1301 #ifde
BLOCK_NET_IF


1302 
	`StNIfQueue
(
pAd
, 
QueIdx
, 
pPack
);

1304 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

1306  
NDIS_STATUS_FAILURE
;

1310 
	`InTaQueueAc
(
pAd
, 
pEry
, &pAd->
TxSwQueue
[
QueIdx
], 
	`PACKET_TO_QUEUE_ENTRY
(
pPack
));

1312 
	`RTMP_IRQ_UNLOCK
(&
pAd
->
q_lock
, 
IrqFgs
);

1314 #ifde
DOT11_N_SUPPORT


1315 i((
pAd
->
CommCfg
.
BACaby
.
fld
.
AutoBA
 =
TRUE
)&&

1316 (
pEry
->
NoBADaCouDown
 == 0) &&

1317 
	`IS_HT_STA
(
pEry
))

1320 i(((
pEry
->
TXBAbm
 & (1<<
UrPriܙy
)) == 0) &&

1321 ((
pEry
->
BADeeBm
 & (1<<
UrPriܙy
)) == 0) &&

1322 (
pEry
->
PtSecud
 =
WPA_802_1X_PORT_SECURED
)

1327 && ((
	`IS_ENTRY_CLIENT
(
pEry
&& 
pAd
->
MlmeAux
.
APRkIe
 != 0x0) ||

1328 (
pEry
->
WStus
 !
Ndis802_11WEPEbd
 &&Ery->WStu!
Ndis802_11Enyi2Ebd
))

1329 && (!(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
)))

1332 
	`BAOriSessiSUp
(
pAd
, 
pEry
, 
UrPriܙy
, 0, 10, 
FALSE
);

1337 
pAd
->
RkCous
.
OSecOsTxCou
[
QueIdx
]++;

1338  
NDIS_STATUS_SUCCESS
;

1339 
	}
}

1364 #ifde
RTMP_MAC_PCI


1365 
NDIS_STATUS
 
	$RTMPFeTXDReque
(

1366 
IN
 
PRTMP_ADAPTER
 
pAd
,

1367 
IN
 
UCHAR
 
QueIdx
,

1368 
IN
 
UCHAR
 
NumbRequed
,

1369 
IN
 
PUCHAR
 
FeNumbIs
)

1371 
ULONG
 
FeNumb
 = 0;

1372 
NDIS_STATUS
 
Stus
 = 
NDIS_STATUS_FAILURE
;

1374 
QueIdx
)

1376 
QID_AC_BK
:

1377 
QID_AC_BE
:

1378 
QID_AC_VI
:

1379 
QID_AC_VO
:

1380 
QID_HCCA
:

1381 i(
pAd
->
TxRg
[
QueIdx
].
TxSwFeIdx
 >Ad->TxRg[QueIdx].
TxCpuIdx
)

1382 
FeNumb
 = 
pAd
->
TxRg
[
QueIdx
].
TxSwFeIdx
 -Ad->TxRg[QueIdx].
TxCpuIdx
 - 1;

1384 
FeNumb
 = 
pAd
->
TxRg
[
QueIdx
].
TxSwFeIdx
 + 
TX_RING_SIZE
 -Ad->TxRg[QueIdx].
TxCpuIdx
 - 1;

1386 i(
FeNumb
 >
NumbRequed
)

1387 
Stus
 = 
NDIS_STATUS_SUCCESS
;

1390 
QID_MGMT
:

1391 i(
pAd
->
MgmtRg
.
TxSwFeIdx
 >Ad->MgmtRg.
TxCpuIdx
)

1392 
FeNumb
 = 
pAd
->
MgmtRg
.
TxSwFeIdx
 -Ad->MgmtRg.
TxCpuIdx
 - 1;

1394 
FeNumb
 = 
pAd
->
MgmtRg
.
TxSwFeIdx
 + 
MGMT_RING_SIZE
 -Ad->MgmtRg.
TxCpuIdx
 - 1;

1396 i(
FeNumb
 >
NumbRequed
)

1397 
Stus
 = 
NDIS_STATUS_SUCCESS
;

1401 
	`DBGPRINT
(
RT_DEBUG_ERROR
,("RTMPFeTXDReque::Invid QueIdx(=%d)\n", 
QueIdx
));

1404 *
FeNumbIs
 = (
UCHAR
)
FeNumb
;

1406  (
Stus
);

1407 
	}
}

1411 
VOID
 
	$RTMPSdNuFme
(

1412 
IN
 
PRTMP_ADAPTER
 
pAd
,

1413 
IN
 
UCHAR
 
TxRe
,

1414 
IN
 
BOOLEAN
 
bQosNu
)

1416 
UCHAR
 
NuFme
[48];

1417 
ULONG
 
Lgth
;

1418 
PHEADER_802_11
 
pHd_802_11
;

1421 #ifde
RALINK_ATE


1422 if(
	`ATE_ON
(
pAd
))

1429 i(((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA
) ||

1430 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPAPSK
) ||

1431 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2
) ||

1432 (
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPA2PSK
)

1433 #ifde
WPA_SUPPLICANT_SUPPORT


1434 || (
pAd
->
SCfg
.
IEEE8021X
 =
TRUE
)

1437 (
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
))

1442 
	`NdisZoMemy
(
NuFme
, 48);

1443 
Lgth
 = (
HEADER_802_11
);

1445 
pHd_802_11
 = (
PHEADER_802_11

NuFme
;

1447 
pHd_802_11
->
FC
.
Ty
 = 
BTYPE_DATA
;

1448 
pHd_802_11
->
FC
.
SubTy
 = 
SUBTYPE_NULL_FUNC
;

1449 
pHd_802_11
->
FC
.
ToDs
 = 1;

1450 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr1
, 
pAd
->
CommCfg
.
Bssid
);

1451 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr2
, 
pAd
->
CutAddss
);

1452 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr3
, 
pAd
->
CommCfg
.
Bssid
);

1454 i(
pAd
->
CommCfg
.
bAPSDFPowSave
)

1456 
pHd_802_11
->
FC
.
PwrMgmt
 = 
PWR_SAVE
;

1460 
pHd_802_11
->
FC
.
PwrMgmt
 = (
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
) ? 1: 0;

1462 
pHd_802_11
->
Duti
 = 
pAd
->
CommCfg
.
Dsifs
 + 
	`RTMPCcDuti
Ad, 
TxRe
, 14);

1465 
pHd_802_11
->
Sequ
 = 
pAd
->Sequence;

1466 
pAd
->
Sequ
 = (pAd->Sequ+1& 
MAXSEQ
;

1469 i(
bQosNu
)

1471 
pHd_802_11
->
FC
.
SubTy
 = 
SUBTYPE_QOS_NULL
;

1474 
NuFme
[
Lgth
] = 0;

1475 
NuFme
[
Lgth
+1] = 0;

1476 
Lgth
 += 2;

1479 
	`HAL_KickOutNuFmeTx
(
pAd
, 0, 
NuFme
, 
Lgth
);

1481 
	}
}

1492 
VOID
 
	$STAFdChAlgܙhm
(

1493 
IN
 
PRTMP_ADAPTER
 
pAd
,

1494 
IN
 
TX_BLK
 *
pTxBlk
)

1496 
NDIS_802_11_ENCRYPTION_STATUS
 
Ch
;

1497 
UCHAR
 
ChAlg
 = 
CIPHER_NONE
;

1498 
UCHAR
 
KeyIdx
 = 0xff;

1499 
PUCHAR
 
pSrcBufVA
;

1500 
PCIPHER_KEY
 
pKey
 = 
NULL
;

1501 
PMAC_TABLE_ENTRY
 
pMacEry
;

1503 
pSrcBufVA
 = 
	`GET_OS_PKT_DATAPTR
(
pTxBlk
->
pPack
);

1504 
pMacEry
 = 
pTxBlk
->pMacEntry;

1508 i((*
pSrcBufVA
 & 0x01&& (
	`ADHOC_ON
(
pAd
)))

1509 
Ch
 = 
pAd
->
SCfg
.
GroupCh
;

1511 
Ch
 = 
pAd
->
SCfg
.
PaCh
;

1513 i(
	`RTMP_GET_PACKET_EAPOL
(
pTxBlk
->
pPack
))

1515 
	`ASSERT
(
pAd
->
ShedKey
[
BSS0
][0].
ChAlg
 <
CIPHER_CKIP128
);

1518 i(!(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bCˬEAPFme
)) &&

1519 (
pAd
->
ShedKey
[
BSS0
][0].
ChAlg
) &&

1520 (
pAd
->
ShedKey
[
BSS0
][0].
KeyL
))

1522 
ChAlg
 = 
pAd
->
ShedKey
[
BSS0
][0].CipherAlg;

1523 
KeyIdx
 = 0;

1526 i(
Ch
 =
Ndis802_11Enyi1Ebd
)

1528 
KeyIdx
 = 
pAd
->
SCfg
.
DeuKeyId
;

1530 i((
Ch
 =
Ndis802_11Enyi2Ebd
) ||

1531 (
Ch
 =
Ndis802_11Enyi3Ebd
))

1533 i((*
pSrcBufVA
 & 0x01&& (
	`ADHOC_ON
(
pAd
)))

1534 
KeyIdx
 = 
pAd
->
SCfg
.
DeuKeyId
;

1535 i(
pAd
->
ShedKey
[
BSS0
][0].
KeyL
)

1536 
KeyIdx
 = 0;

1538 
KeyIdx
 = 
pAd
->
SCfg
.
DeuKeyId
;

1541 i(
KeyIdx
 == 0xff)

1542 
ChAlg
 = 
CIPHER_NONE
;

1543 i((
Ch
 =
Ndis802_11EnyiDibd
|| (
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
KeyL
 == 0))

1544 
ChAlg
 = 
CIPHER_NONE
;

1545 #ifde
WPA_SUPPLICANT_SUPPORT


1546 i
pAd
->
SCfg
.
WSuliUP
 &&

1547 (
Ch
 =
Ndis802_11Enyi1Ebd
) &&

1548 (
pAd
->
SCfg
.
IEEE8021X
 =
TRUE
) &&

1549 (
pAd
->
SCfg
.
PtSecud
 =
WPA_802_1X_PORT_NOT_SECURED
))

1550 
ChAlg
 = 
CIPHER_NONE
;

1555 
ChAlg
 = 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].CipherAlg;

1556 
pKey
 = &
pAd
->
ShedKey
[
BSS0
][
KeyIdx
];

1560 
pTxBlk
->
ChAlg
 = CipherAlg;

1561 
pTxBlk
->
pKey
 =Key;

1562 
pTxBlk
->
KeyIdx
 = KeyIdx;

1563 
	}
}

1566 
VOID
 
	$STABudComm802_11Hd
(

1567 
IN
 
PRTMP_ADAPTER
 
pAd
,

1568 
IN
 
TX_BLK
 *
pTxBlk
)

1571 
HEADER_802_11
 *
pHd_802_11
;

1572 #ifde
QOS_DLS_SUPPORT


1573 
BOOLEAN
 
bDLSFme
 = 
FALSE
;

1574 
INT
 
DlsEryIndex
 = 0;

1582 
pTxBlk
->
MpduHdL
 = (
HEADER_802_11
);

1584 
pHd_802_11
 = (
HEADER_802_11
 *&
pTxBlk
->
HdBuf
[
TXINFO_SIZE
 + 
TXWI_SIZE
];

1586 
	`NdisZoMemy
(
pHd_802_11
, (
HEADER_802_11
));

1588 
pHd_802_11
->
FC
.
FrDs
 = 0;

1589 
pHd_802_11
->
FC
.
Ty
 = 
BTYPE_DATA
;

1590 
pHd_802_11
->
FC
.
SubTy
 = ((
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bWMM
)? 
SUBTYPE_QDATA
 : 
SUBTYPE_DATA
);

1592 #ifde
QOS_DLS_SUPPORT


1593 i(
	`INFRA_ON
(
pAd
))

1597 
DlsEryIndex
 = 
	`RTMPCheckDLSFme
(
pAd
, 
pTxBlk
->
pSrcBufHd
);

1598 i(
DlsEryIndex
 >= 0)

1599 
bDLSFme
 = 
TRUE
;

1601 
bDLSFme
 = 
FALSE
;

1605 i(
pTxBlk
->
pMacEry
)

1607 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bFNQoS
))

1609 
pHd_802_11
->
Sequ
 = 
pTxBlk
->
pMacEry
->
NQosDaSeq
;

1610 
pTxBlk
->
pMacEry
->
NQosDaSeq
 = (pTxBlk->pMacEry->NQosDaSeq+1& 
MAXSEQ
;

1614 
pHd_802_11
->
Sequ
 = 
pTxBlk
->
pMacEry
->
TxSeq
[pTxBlk->
UrPriܙy
];

1615 
pTxBlk
->
pMacEry
->
TxSeq
[pTxBlk->
UrPriܙy
] = (pTxBlk->pMacEry->TxSeq[pTxBlk->UrPriܙy]+1& 
MAXSEQ
;

1620 
pHd_802_11
->
Sequ
 = 
pAd
->Sequence;

1621 
pAd
->
Sequ
 = (pAd->Sequ+1& 
MAXSEQ
;

1624 
pHd_802_11
->
Fg
 = 0;

1626 
pHd_802_11
->
FC
.
MeDa
 = 
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bMeDa
);

1629 i(
	`INFRA_ON
(
pAd
))

1631 #ifde
QOS_DLS_SUPPORT


1632 i(
bDLSFme
)

1634 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr1
, 
pTxBlk
->
pSrcBufHd
);

1635 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr2
, 
pAd
->
CutAddss
);

1636 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr3
, 
pAd
->
CommCfg
.
Bssid
);

1637 
pHd_802_11
->
FC
.
ToDs
 = 0;

1642 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr1
, 
pAd
->
CommCfg
.
Bssid
);

1643 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr2
, 
pAd
->
CutAddss
);

1644 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr3
, 
pTxBlk
->
pSrcBufHd
);

1645 
pHd_802_11
->
FC
.
ToDs
 = 1;

1646 #ifde
CLIENT_WDS


1647 i(!
	`MAC_ADDR_EQUAL
((
pTxBlk
->
pSrcBufHd
 + 
MAC_ADDR_LEN
),

1648 
pAd
->
CutAddss
))

1650 
pHd_802_11
->
FC
.
FrDs
 = 1;

1651 
	`COPY_MAC_ADDR
(&
pHd_802_11
->
O
[0], 
pTxBlk
->
pSrcBufHd
 + 
MAC_ADDR_LEN
);

1652 
pTxBlk
->
MpduHdL
 +
MAC_ADDR_LEN
;

1657 i(
	`ADHOC_ON
(
pAd
))

1659 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr1
, 
pTxBlk
->
pSrcBufHd
);

1660 #ifde
XLINK_SUPPORT


1661 i(
pAd
->
SCfg
.
PSPXlk
)

1663 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr2
, 
pTxBlk
->
pSrcBufHd
 + 
MAC_ADDR_LEN
);

1666 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr2
, 
pAd
->
CutAddss
);

1667 
	`COPY_MAC_ADDR
(
pHd_802_11
->
Addr3
, 
pAd
->
CommCfg
.
Bssid
);

1668 
pHd_802_11
->
FC
.
ToDs
 = 0;

1672 i(
pTxBlk
->
ChAlg
 !
CIPHER_NONE
)

1673 
pHd_802_11
->
FC
.
W
 = 1;

1678 i(
pAd
->
CommCfg
.
bAPSDFPowSave
)

1679 
pHd_802_11
->
FC
.
PwrMgmt
 = 
PWR_SAVE
;

1681 
pHd_802_11
->
FC
.
PwrMgmt
 = (
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
);

1682 
	}
}

1684 #ifde
DOT11_N_SUPPORT


1685 
VOID
 
	$STABudCache802_11Hd
(

1686 
IN
 
RTMP_ADAPTER
 *
pAd
,

1687 
IN
 
TX_BLK
 *
pTxBlk
,

1688 
IN
 
UCHAR
 *
pHd
)

1690 
MAC_TABLE_ENTRY
 *
pMacEry
;

1691 
PHEADER_802_11
 
pHd80211
;

1693 
pHd80211
 = (
PHEADER_802_11
)
pHd
;

1694 
pMacEry
 = 
pTxBlk
->pMacEntry;

1701 
pTxBlk
->
MpduHdL
 = (
HEADER_802_11
);

1704 
pHd80211
->
FC
.
MeDa
 = 
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bMeDa
);

1707 
pHd80211
->
Sequ
 = 
pMacEry
->
TxSeq
[
pTxBlk
->
UrPriܙy
];

1708 
pMacEry
->
TxSeq
[
pTxBlk
->
UrPriܙy
] = (pMacEry->TxSeq[pTxBlk->UrPriܙy]+1& 
MAXSEQ
;

1713 #ifde
QOS_DLS_SUPPORT


1714 
BOOLEAN
 
bDLSFme
 = 
FALSE
;

1715 
INT
 
DlsEryIndex
 = 0;

1717 
DlsEryIndex
 = 
	`RTMPCheckDLSFme
(
pAd
, 
pTxBlk
->
pSrcBufHd
);

1718 i(
DlsEryIndex
 >= 0)

1719 
bDLSFme
 = 
TRUE
;

1721 
bDLSFme
 = 
FALSE
;

1725 #ifde
QOS_DLS_SUPPORT


1726 i(
bDLSFme
)

1728 
	`COPY_MAC_ADDR
(
pHd80211
->
Addr1
, 
pTxBlk
->
pSrcBufHd
);

1729 
	`COPY_MAC_ADDR
(
pHd80211
->
Addr3
, 
pAd
->
CommCfg
.
Bssid
);

1730 
pHd80211
->
FC
.
ToDs
 = 0;

1734 i(
	`ADHOC_ON
(
pAd
))

1735 
	`COPY_MAC_ADDR
(
pHd80211
->
Addr3
, 
pAd
->
CommCfg
.
Bssid
);

1738 
	`COPY_MAC_ADDR
(
pHd80211
->
Addr3
, 
pTxBlk
->
pSrcBufHd
);

1739 #ifde
CLIENT_WDS


1740 i(!
	`MAC_ADDR_EQUAL
((
pTxBlk
->
pSrcBufHd
 + 
MAC_ADDR_LEN
),

1741 
pAd
->
CutAddss
))

1743 
pHd80211
->
FC
.
FrDs
 = 1;

1744 
	`COPY_MAC_ADDR
(&
pHd80211
->
O
[0], 
pTxBlk
->
pSrcBufHd
 + 
MAC_ADDR_LEN
);

1745 
pTxBlk
->
MpduHdL
 +
MAC_ADDR_LEN
;

1754 i(
pAd
->
CommCfg
.
bAPSDFPowSave
)

1755 
pHd80211
->
FC
.
PwrMgmt
 = 
PWR_SAVE
;

1757 
pHd80211
->
FC
.
PwrMgmt
 = (
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
);

1758 
	}
}

1761 
le
 
PUCHAR
 
	$STA_Bud_ARk_Fme_Hd
(

1762 
IN
 
RTMP_ADAPTER
 *
pAd
,

1763 
IN
 
TX_BLK
 *
pTxBlk
)

1765 
PUCHAR
 
pHdBufP
;

1766 
HEADER_802_11
 *
pHd_802_11
;

1767 
PNDIS_PACKET
 
pNextPack
;

1768 
UINT32
 
xtBufL
;

1769 
PQUEUE_ENTRY
 
pQEry
;

1771 
	`STAFdChAlgܙhm
(
pAd
, 
pTxBlk
);

1772 
	`STABudComm802_11Hd
(
pAd
, 
pTxBlk
);

1775 
pHdBufP
 = &
pTxBlk
->
HdBuf
[
TXINFO_SIZE
 + 
TXWI_SIZE
];

1776 
pHd_802_11
 = (
HEADER_802_11
 *
pHdBufP
;

1779 
pHd_802_11
->
FC
.
Ord
 = 1;

1782 
pHdBufP
 +
pTxBlk
->
MpduHdL
;

1784 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bWMM
))

1789 *
pHdBufP
 = (
pTxBlk
->
UrPriܙy
 & 0x0F);

1791 *(
pHdBufP
+1) = 0;

1792 
pHdBufP
 +=2;

1793 
pTxBlk
->
MpduHdL
 += 2;

1797 
pTxBlk
->
HdrPadL
 = (
ULONG
)
pHdBufP
;

1798 
pHdBufP
 = (
PUCHAR
)
	`ROUND_UP
(pHeaderBufPtr, 4);

1799 
pTxBlk
->
HdrPadL
 = (
ULONG
)(
pHdBufP
 -TxBlk->HdrPadLen);

1803 
pQEry
 = 
pTxBlk
->
TxPackLi
.
Hd
;

1804 
pNextPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pQEry
);

1805 
xtBufL
 = 
	`GET_OS_PKT_LEN
(
pNextPack
);

1806 i(
	`RTMP_GET_PACKET_VLAN
(
pNextPack
))

1807 
xtBufL
 -
LENGTH_802_1Q
;

1809 *
pHdBufP
 = (
UCHAR
)
xtBufL
 & 0xff;

1810 *(
pHdBufP
+1(
UCHAR
)(
xtBufL
 >> 8);

1812 
pHdBufP
 += 2;

1813 
pTxBlk
->
MpduHdL
 += 2;

1815  
pHdBufP
;

1817 
	}
}

1819 #ifde
DOT11_N_SUPPORT


1820 
le
 
PUCHAR
 
	$STA_Bud_AMSDU_Fme_Hd
(

1821 
IN
 
RTMP_ADAPTER
 *
pAd
,

1822 
IN
 
TX_BLK
 *
pTxBlk
)

1824 
PUCHAR
 
pHdBufP
;

1825 
HEADER_802_11
 *
pHd_802_11
;

1828 
	`STAFdChAlgܙhm
(
pAd
, 
pTxBlk
);

1829 
	`STABudComm802_11Hd
(
pAd
, 
pTxBlk
);

1831 
pHdBufP
 = &
pTxBlk
->
HdBuf
[
TXINFO_SIZE
 + 
TXWI_SIZE
];

1832 
pHd_802_11
 = (
HEADER_802_11
 *
pHdBufP
;

1835 
pHdBufP
 +
pTxBlk
->
MpduHdL
;

1840 *
pHdBufP
 = (
pTxBlk
->
UrPriܙy
 & 0x0F| (
pAd
->
CommCfg
.
AckPicy
[pTxBlk->
QueIdx
]<<5);

1845 *
pHdBufP
 |= 0x80;

1847 *(
pHdBufP
+1) = 0;

1848 
pHdBufP
 +=2;

1849 
pTxBlk
->
MpduHdL
 += 2;

1859 
pTxBlk
->
HdrPadL
 = (
ULONG
)
pHdBufP
;

1860 
pHdBufP
 = (
PUCHAR

	`ROUND_UP
(pHeaderBufPtr, 4);

1861 
pTxBlk
->
HdrPadL
 = (
ULONG
)(
pHdBufP
 -TxBlk->HdrPadLen);

1863  
pHdBufP
;

1865 
	}
}

1868 
VOID
 
	$STA_AMPDU_Fme_Tx
(

1869 
IN
 
PRTMP_ADAPTER
 
pAd
,

1870 
IN
 
TX_BLK
 *
pTxBlk
)

1872 
HEADER_802_11
 *
pHd_802_11
;

1873 
PUCHAR
 
pHdBufP
;

1874 
USHORT
 
FeNumb
;

1875 
MAC_TABLE_ENTRY
 *
pMacEry
;

1876 
BOOLEAN
 
bVLANPkt
;

1877 
PQUEUE_ENTRY
 
pQEry
;

1879 
	`ASSERT
(
pTxBlk
);

1881 
pTxBlk
->
TxPackLi
.
Hd
)

1883 
pQEry
 = 
	`RemoveHdQueue
(&
pTxBlk
->
TxPackLi
);

1884 
pTxBlk
->
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pQEry
);

1885 i
	`RTMP_FlTxBlkInfo
(
pAd
, 
pTxBlk
!
TRUE
)

1887 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pTxBlk
->
pPack
, 
NDIS_STATUS_FAILURE
);

1891 
bVLANPkt
 = (
	`RTMP_GET_PACKET_VLAN
(
pTxBlk
->
pPack
? 
TRUE
 : 
FALSE
);

1893 
pMacEry
 = 
pTxBlk
->pMacEntry;

1894 i(
pMacEry
->
isCached
)

1897 #ide
VENDOR_FEATURE1_SUPPORT


1898 
	`NdisMoveMemy
((
PUCHAR
)(&
pTxBlk
->
HdBuf
[
TXINFO_SIZE
]), (PUCHAR)(&
pMacEry
->
CachedBuf
[0]), 
TXWI_SIZE
 + (
HEADER_802_11
));

1900 
pTxBlk
->
HdBuf
 = (
UCHAR
 *)(
pMacEry
->HeaderBuf);

1903 
pHdBufP
 = (
PUCHAR
)(&
pTxBlk
->
HdBuf
[
TXINFO_SIZE
 + 
TXWI_SIZE
]);

1904 
	`STABudCache802_11Hd
(
pAd
, 
pTxBlk
, 
pHdBufP
);

1906 #ifde
SOFT_ENCRYPT


1907 
	`RTMPUpdeSwCacheChInfo
(
pAd
, 
pTxBlk
, 
pHdBufP
);

1912 
	`STAFdChAlgܙhm
(
pAd
, 
pTxBlk
);

1913 
	`STABudComm802_11Hd
(
pAd
, 
pTxBlk
);

1915 
pHdBufP
 = &
pTxBlk
->
HdBuf
[
TXINFO_SIZE
 + 
TXWI_SIZE
];

1918 #ifde
SOFT_ENCRYPT


1919 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bSwEny
))

1923 i(
	`RTMPExndPackFSwEny
(
pAd
, 
pTxBlk
=
FALSE
)

1925 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pTxBlk
->
pPack
, 
NDIS_STATUS_FAILURE
);

1932 #ifde
VENDOR_FEATURE1_SUPPORT


1933 if(
pMacEry
->
isCached


1934 && (
pMacEry
->
Proc
 =
	`RTMP_GET_PACKET_PROTOCOL
(
pTxBlk
->
pPack
))

1935 #ifde
SOFT_ENCRYPT


1936 && !
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bSwEny
)

1940 
pHd_802_11
 = (
HEADER_802_11
 *
pHdBufP
;

1943 
pHdBufP
 +
pTxBlk
->
MpduHdL
;

1948 *
pHdBufP
 = (
pTxBlk
->
UrPriܙy
 & 0x0F);

1949 
pTxBlk
->
MpduHdL
 = 
pMacEry
->MpduHeaderLen;

1950 
pHdBufP
 = ((
PUCHAR
)
pHd_802_11
+ 
pTxBlk
->
MpduHdL
;

1952 
pTxBlk
->
HdrPadL
 = 
pMacEry
->HdrPadLen;

1955 
pTxBlk
->
pSrcBufDa
 =TxBlk->
pSrcBufHd
 + 
LENGTH_802_3
;

1956 
pTxBlk
->
SrcBufL
 -
LENGTH_802_3
;

1959 i(
	`RTMP_GET_PACKET_VLAN
(
pTxBlk
->
pPack
))

1961 
pTxBlk
->
pSrcBufDa
 +
LENGTH_802_1Q
;

1962 
pTxBlk
->
SrcBufL
 -
LENGTH_802_1Q
;

1968 
pHd_802_11
 = (
HEADER_802_11
 *
pHdBufP
;

1971 
pHdBufP
 +
pTxBlk
->
MpduHdL
;

1976 *
pHdBufP
 = (
pTxBlk
->
UrPriܙy
 & 0x0F);

1977 *(
pHdBufP
+1) = 0;

1978 
pHdBufP
 +=2;

1979 
pTxBlk
->
MpduHdL
 += 2;

1985 i((
pAd
->
CommCfg
.
bRdg
 =
TRUE
&& 
	`CLIENT_STATUS_TEST_FLAG
(
pTxBlk
->
pMacEry
, 
fCLIENT_STATUS_RDG_CAPABLE
))

1987 i(
pMacEry
->
isCached
 =
FALSE
)

1990 
pHd_802_11
->
FC
.
Ord
 = 1;

1992 
	`NdisZoMemy
(
pHdBufP
, 4);

1993 *(
pHdBufP
+3) |= 0x80;

1995 
pHdBufP
 += 4;

1996 
pTxBlk
->
MpduHdL
 += 4;

2000 
	`ASSERT
(
pTxBlk
->
MpduHdL
 >= 24);

2003 
pTxBlk
->
pSrcBufDa
 =TxBlk->
pSrcBufHd
 + 
LENGTH_802_3
;

2004 
pTxBlk
->
SrcBufL
 -
LENGTH_802_3
;

2007 i(
bVLANPkt
)

2009 
pTxBlk
->
pSrcBufDa
 +
LENGTH_802_1Q
;

2010 
pTxBlk
->
SrcBufL
 -
LENGTH_802_1Q
;

2019 
pTxBlk
->
HdrPadL
 = (
ULONG
)
pHdBufP
;

2020 
pHdBufP
 = (
PUCHAR

	`ROUND_UP
(pHeaderBufPtr, 4);

2021 
pTxBlk
->
HdrPadL
 = (
ULONG
)(
pHdBufP
 -TxBlk->HdrPadLen);

2023 #ifde
VENDOR_FEATURE1_SUPPORT


2024 
pMacEry
->
HdrPadL
 = 
pTxBlk
->HdrPadLen;

2027 #ifde
SOFT_ENCRYPT


2028 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bSwEny
))

2030 
UCHAR
 
iv_offt
 = 0, 
ext_offt
 = 0;

2034 
	`EXTRA_LLCSNAP_ENCAP_FROM_PKT_OFFSET
(
pTxBlk
->
pSrcBufDa
-2,TxBlk->
pExaLlcSpEnp
);

2037 i(
pTxBlk
->
pExaLlcSpEnp
)

2040 
pTxBlk
->
pSrcBufDa
 -
LENGTH_802_1_H
;

2041 
pTxBlk
->
SrcBufL
 +
LENGTH_802_1_H
;

2043 
	`NdisMoveMemy
(
pTxBlk
->
pSrcBufDa
,TxBlk->
pExaLlcSpEnp
, 6);

2047 
	`RTMPSoCڡruIVHdr
(
pTxBlk
->
ChAlg
,

2048 
pTxBlk
->
KeyIdx
,

2049 
pTxBlk
->
pKey
->
TxTsc
,

2050 
pHdBufP
,

2051 &
iv_offt
);

2052 
pHdBufP
 +
iv_offt
;

2053 
pTxBlk
->
MpduHdL
 +
iv_offt
;

2056 
	`RTMPSoEnyiAi
(
pAd
,

2057 
pTxBlk
->
ChAlg
,

2058 (
PUCHAR
)
pHd_802_11
,

2059 
pTxBlk
->
pSrcBufDa
,

2060 
pTxBlk
->
SrcBufL
,

2061 
pTxBlk
->
KeyIdx
,

2062 
pTxBlk
->
pKey
,

2063 &
ext_offt
);

2064 
pTxBlk
->
SrcBufL
 +
ext_offt
;

2065 
pTxBlk
->
TٮFmeL
 +
ext_offt
;

2075 
	`EXTRA_LLCSNAP_ENCAP_FROM_PKT_OFFSET
(
pTxBlk
->
pSrcBufDa
-2,TxBlk->
pExaLlcSpEnp
);

2076 i(
pTxBlk
->
pExaLlcSpEnp
)

2078 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pExaLlcSpEnp
, 6);

2079 
pHdBufP
 += 6;

2081 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pSrcBufDa
-2, 2);

2082 
pHdBufP
 += 2;

2083 
pTxBlk
->
MpduHdL
 +
LENGTH_802_1_H
;

2088 #ifde
VENDOR_FEATURE1_SUPPORT


2089 
pMacEry
->
Proc
 = 
	`RTMP_GET_PACKET_PROTOCOL
(
pTxBlk
->
pPack
);

2090 
pMacEry
->
MpduHdL
 = 
pTxBlk
->MpduHeaderLen;

2094 i(
pMacEry
->
isCached
)

2096 
	`RTMPWreTxWI_Cache
(
pAd
, (
PTXWI_STRUC
)(&
pTxBlk
->
HdBuf
[
TXINFO_SIZE
]),TxBlk);

2100 
	`RTMPWreTxWI_Da
(
pAd
, (
PTXWI_STRUC
)(&
pTxBlk
->
HdBuf
[
TXINFO_SIZE
]),TxBlk);

2102 
	`NdisZoMemy
((
PUCHAR
)(&
pMacEry
->
CachedBuf
[0]), (pMacEntry->CachedBuf));

2103 
	`NdisMoveMemy
((
PUCHAR
)(&
pMacEry
->
CachedBuf
[0]), (PUCHAR)(&
pTxBlk
->
HdBuf
[
TXINFO_SIZE
]), (
pHdBufP
 - (PUCHAR)(&pTxBlk->HeaderBuf[TXINFO_SIZE])));

2105 #ifde
VENDOR_FEATURE1_SUPPORT


2107 
	`NdisZoMemy
((
PUCHAR
)(&
pMacEry
->
HdBuf
[0]), (pMacEntry->HeaderBuf));

2108 
	`NdisMoveMemy
((
PUCHAR
)(&
pMacEry
->
HdBuf
[0]), (PUCHAR)(&
pTxBlk
->HdBuf[0]), (
pHdBufP
 - (PUCHAR)(&pTxBlk->HeaderBuf[0])));

2111 
pMacEry
->
isCached
 = 
TRUE
;

2114 #ifde
STATS_COUNT_SUPPORT


2117 
pAd
->
RkCous
.
TnsmdMPDUsInAMPDUCou
.
u
.
LowPt
 ++;

2118 
pAd
->
RkCous
.
TnsmdOsInAMPDUCou
.
QuadPt
 +
pTxBlk
->
SrcBufL
;

2124 
	`HAL_WreTxResour
(
pAd
, 
pTxBlk
, 
TRUE
, &
FeNumb
);

2129 #ifde
PCIE_PS_SUPPORT


2130 i(!
	`RTMP_TEST_PSFLAG
(
pAd
, 
fRTMP_PS_DISABLE_TX
))

2132 
	`HAL_KickOutTx
(
pAd
, 
pTxBlk
,TxBlk->
QueIdx
);

2134 
pAd
->
RkCous
.
KickTxCou
++;

2135 
pAd
->
RkCous
.
OSecTxDeCou
++;

2138 
	}
}

2141 
VOID
 
	$STA_AMSDU_Fme_Tx
(

2142 
IN
 
PRTMP_ADAPTER
 
pAd
,

2143 
IN
 
TX_BLK
 *
pTxBlk
)

2145 
PUCHAR
 
pHdBufP
;

2146 
USHORT
 
FeNumb
;

2147 
USHORT
 
subFmePayldL
 = 0;

2148 
USHORT
 
tٮMPDUSize
=0;

2149 
UCHAR
 *
subFmeHd
;

2150 
UCHAR
 
ddg
 = 0;

2151 
USHORT
 
FTx
 = 0, 
LaTxIdx
 = 0;

2152 
BOOLEAN
 
bVLANPkt
;

2153 
ameNum
 = 0;

2154 
PQUEUE_ENTRY
 
pQEry
;

2157 
	`ASSERT
(
pTxBlk
);

2159 
	`ASSERT
((
pTxBlk
->
TxPackLi
.
Numb
 > 1));

2161 
pTxBlk
->
TxPackLi
.
Hd
)

2163 
pQEry
 = 
	`RemoveHdQueue
(&
pTxBlk
->
TxPackLi
);

2164 
pTxBlk
->
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pQEry
);

2165 i(
	`RTMP_FlTxBlkInfo
(
pAd
, 
pTxBlk
!
TRUE
)

2167 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pTxBlk
->
pPack
, 
NDIS_STATUS_FAILURE
);

2171 
bVLANPkt
 = (
	`RTMP_GET_PACKET_VLAN
(
pTxBlk
->
pPack
? 
TRUE
 : 
FALSE
);

2174 
pTxBlk
->
pSrcBufDa
 =TxBlk->
pSrcBufHd
 + 
LENGTH_802_3
;

2175 
pTxBlk
->
SrcBufL
 -
LENGTH_802_3
;

2178 i(
bVLANPkt
)

2180 
pTxBlk
->
pSrcBufDa
 +
LENGTH_802_1Q
;

2181 
pTxBlk
->
SrcBufL
 -
LENGTH_802_1Q
;

2184 i(
ameNum
 == 0)

2186 
pHdBufP
 = 
	`STA_Bud_AMSDU_Fme_Hd
(
pAd
, 
pTxBlk
);

2189 
	`RTMPWreTxWI_Da
(
pAd
, (
PTXWI_STRUC
)(&
pTxBlk
->
HdBuf
[
TXINFO_SIZE
]),TxBlk);

2193 
pHdBufP
 = &
pTxBlk
->
HdBuf
[0];

2194 
ddg
 = 
	`ROUND_UP
(
LENGTH_AMSDU_SUBFRAMEHEAD
 + 
subFmePayldL
, 4) - (LENGTH_AMSDU_SUBFRAMEHEAD + subFramePayloadLen);

2195 
	`NdisZoMemy
(
pHdBufP
, 
ddg
 + 
LENGTH_AMSDU_SUBFRAMEHEAD
);

2196 
pHdBufP
 +
ddg
;

2197 
pTxBlk
->
MpduHdL
 = 
ddg
;

2204 
subFmeHd
 = 
pHdBufP
;

2205 
subFmePayldL
 = 
pTxBlk
->
SrcBufL
;

2207 
	`NdisMoveMemy
(
subFmeHd
, 
pTxBlk
->
pSrcBufHd
, 12);

2210 
pHdBufP
 +
LENGTH_AMSDU_SUBFRAMEHEAD
;

2211 
pTxBlk
->
MpduHdL
 +
LENGTH_AMSDU_SUBFRAMEHEAD
;

2217 
	`EXTRA_LLCSNAP_ENCAP_FROM_PKT_OFFSET
(
pTxBlk
->
pSrcBufDa
-2,TxBlk->
pExaLlcSpEnp
);

2219 
subFmePayldL
 = 
pTxBlk
->
SrcBufL
;

2221 i(
pTxBlk
->
pExaLlcSpEnp
)

2223 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pExaLlcSpEnp
, 6);

2224 
pHdBufP
 += 6;

2226 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pSrcBufDa
-2, 2);

2227 
pHdBufP
 += 2;

2228 
pTxBlk
->
MpduHdL
 +
LENGTH_802_1_H
;

2229 
subFmePayldL
 +
LENGTH_802_1_H
;

2233 
subFmeHd
[12] = (
subFmePayldL
 & 0xFF00) >> 8;

2234 
subFmeHd
[13] = 
subFmePayldL
 & 0xFF;

2236 
tٮMPDUSize
 +
pTxBlk
->
MpduHdL
 +TxBlk->
SrcBufL
;

2238 i(
ameNum
 ==0)

2239 
FTx
 = 
	`HAL_WreMuiTxResour
(
pAd
, 
pTxBlk
, 
ameNum
, &
FeNumb
);

2241 
LaTxIdx
 = 
	`HAL_WreMuiTxResour
(
pAd
, 
pTxBlk
, 
ameNum
, &
FeNumb
);

2243 
ameNum
++;

2245 
pAd
->
RkCous
.
KickTxCou
++;

2246 
pAd
->
RkCous
.
OSecTxDeCou
++;

2250 
pAd
->
RkCous
.
TnsmdAMSDUCou
.
u
.
LowPt
 ++;

2251 
pAd
->
RkCous
.
TnsmdOsInAMSDU
.
QuadPt
 +
tٮMPDUSize
;

2256 
	`HAL_FWreTxResour
(
pAd
, 
pTxBlk
, 
tٮMPDUSize
, 
FTx
);

2257 
	`HAL_LaTxIdx
(
pAd
, 
pTxBlk
->
QueIdx
, 
LaTxIdx
);

2262 #ifde
PCIE_PS_SUPPORT


2263 i(!
	`RTMP_TEST_PSFLAG
(
pAd
, 
fRTMP_PS_DISABLE_TX
))

2265 
	`HAL_KickOutTx
(
pAd
, 
pTxBlk
,TxBlk->
QueIdx
);

2266 
	}
}

2269 
VOID
 
	$STA_Legacy_Fme_Tx
(

2270 
IN
 
PRTMP_ADAPTER
 
pAd
,

2271 
IN
 
TX_BLK
 *
pTxBlk
)

2273 
HEADER_802_11
 *
pHd_802_11
;

2274 
PUCHAR
 
pHdBufP
;

2275 
USHORT
 
FeNumb
;

2276 
BOOLEAN
 
bVLANPkt
;

2277 
PQUEUE_ENTRY
 
pQEry
;

2279 
	`ASSERT
(
pTxBlk
);

2282 
pQEry
 = 
	`RemoveHdQueue
(&
pTxBlk
->
TxPackLi
);

2283 
pTxBlk
->
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pQEry
);

2284 i(
	`RTMP_FlTxBlkInfo
(
pAd
, 
pTxBlk
!
TRUE
)

2286 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pTxBlk
->
pPack
, 
NDIS_STATUS_FAILURE
);

2290 #ifde
STATS_COUNT_SUPPORT


2291 i(
pTxBlk
->
TxFmeTy
 =
TX_MCAST_FRAME
)

2293 
	`INC_COUNTER64
(
pAd
->
WnCous
.
MuiTnsmdFmeCou
);

2297 i(
	`RTMP_GET_PACKET_RTS
(
pTxBlk
->
pPack
))

2298 
	`TX_BLK_SET_FLAG
(
pTxBlk
, 
fTX_bRtsRequed
);

2300 
	`TX_BLK_CLEAR_FLAG
(
pTxBlk
, 
fTX_bRtsRequed
);

2302 
bVLANPkt
 = (
	`RTMP_GET_PACKET_VLAN
(
pTxBlk
->
pPack
? 
TRUE
 : 
FALSE
);

2304 i(
pTxBlk
->
TxRe
 < 
pAd
->
CommCfg
.
MTxRe
)

2305 
pTxBlk
->
TxRe
 = 
pAd
->
CommCfg
.
MTxRe
;

2307 
	`STAFdChAlgܙhm
(
pAd
, 
pTxBlk
);

2308 
	`STABudComm802_11Hd
(
pAd
, 
pTxBlk
);

2310 #ifde
SOFT_ENCRYPT


2311 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bSwEny
))

2315 i(
	`RTMPExndPackFSwEny
(
pAd
, 
pTxBlk
=
FALSE
)

2317 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pTxBlk
->
pPack
, 
NDIS_STATUS_FAILURE
);

2324 
pTxBlk
->
pSrcBufDa
 =TxBlk->
pSrcBufHd
 + 
LENGTH_802_3
;

2325 
pTxBlk
->
SrcBufL
 -
LENGTH_802_3
;

2328 i(
bVLANPkt
)

2330 
pTxBlk
->
pSrcBufDa
 +
LENGTH_802_1Q
;

2331 
pTxBlk
->
SrcBufL
 -
LENGTH_802_1Q
;

2334 
pHdBufP
 = &
pTxBlk
->
HdBuf
[
TXINFO_SIZE
 + 
TXWI_SIZE
];

2335 
pHd_802_11
 = (
HEADER_802_11
 *
pHdBufP
;

2338 
pHdBufP
 +
pTxBlk
->
MpduHdL
;

2340 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bWMM
))

2345 *(
pHdBufP
((
pTxBlk
->
UrPriܙy
 & 0x0F| (
pAd
->
CommCfg
.
AckPicy
[pTxBlk->
QueIdx
]<<5));

2346 *(
pHdBufP
+1) = 0;

2347 
pHdBufP
 +=2;

2348 
pTxBlk
->
MpduHdL
 += 2;

2352 
pTxBlk
->
HdrPadL
 = (
ULONG
)
pHdBufP
;

2353 
pHdBufP
 = (
PUCHAR

	`ROUND_UP
(pHeaderBufPtr, 4);

2354 
pTxBlk
->
HdrPadL
 = (
ULONG
)(
pHdBufP
 -TxBlk->HdrPadLen);

2356 #ifde
SOFT_ENCRYPT


2357 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bSwEny
))

2359 
UCHAR
 
iv_offt
 = 0, 
ext_offt
 = 0;

2363 
	`EXTRA_LLCSNAP_ENCAP_FROM_PKT_OFFSET
(
pTxBlk
->
pSrcBufDa
 - 2,TxBlk->
pExaLlcSpEnp
);

2366 i(
pTxBlk
->
pExaLlcSpEnp
)

2369 
pTxBlk
->
pSrcBufDa
 -
LENGTH_802_1_H
;

2370 
pTxBlk
->
SrcBufL
 +
LENGTH_802_1_H
;

2372 
	`NdisMoveMemy
(
pTxBlk
->
pSrcBufDa
,TxBlk->
pExaLlcSpEnp
, 6);

2376 
	`RTMPSoCڡruIVHdr
(
pTxBlk
->
ChAlg
,

2377 
pTxBlk
->
KeyIdx
,

2378 
pTxBlk
->
pKey
->
TxTsc
,

2379 
pHdBufP
,

2380 &
iv_offt
);

2381 
pHdBufP
 +
iv_offt
;

2382 
pTxBlk
->
MpduHdL
 +
iv_offt
;

2385 
	`RTMPSoEnyiAi
(
pAd
,

2386 
pTxBlk
->
ChAlg
,

2387 (
PUCHAR
)
pHd_802_11
,

2388 
pTxBlk
->
pSrcBufDa
,

2389 
pTxBlk
->
SrcBufL
,

2390 
pTxBlk
->
KeyIdx
,

2391 
pTxBlk
->
pKey
,

2392 &
ext_offt
);

2393 
pTxBlk
->
SrcBufL
 +
ext_offt
;

2394 
pTxBlk
->
TٮFmeL
 +
ext_offt
;

2408 
	`EXTRA_LLCSNAP_ENCAP_FROM_PKT_START
(
pTxBlk
->
pSrcBufHd
,TxBlk->
pExaLlcSpEnp
);

2409 i(
pTxBlk
->
pExaLlcSpEnp
)

2411 
UCHAR
 
vn_size
;

2413 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pExaLlcSpEnp
, 6);

2414 
pHdBufP
 += 6;

2416 
vn_size
 = (
bVLANPkt
? 
LENGTH_802_1Q
 : 0;

2418 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pSrcBufHd
+12+
vn_size
, 2);

2419 
pHdBufP
 += 2;

2420 
pTxBlk
->
MpduHdL
 +
LENGTH_802_1_H
;

2431 
	`RTMPWreTxWI_Da
(
pAd
, (
PTXWI_STRUC
)(&
pTxBlk
->
HdBuf
[
TXINFO_SIZE
]),TxBlk);

2435 
	`HAL_WreTxResour
(
pAd
, 
pTxBlk
, 
TRUE
, &
FeNumb
);

2437 
pAd
->
RkCous
.
KickTxCou
++;

2438 
pAd
->
RkCous
.
OSecTxDeCou
++;

2443 #ifde
PCIE_PS_SUPPORT


2444 i(!
	`RTMP_TEST_PSFLAG
(
pAd
, 
fRTMP_PS_DISABLE_TX
))

2446 
	`HAL_KickOutTx
(
pAd
, 
pTxBlk
,TxBlk->
QueIdx
);

2447 
	}
}

2450 
VOID
 
	$STA_ARk_Fme_Tx
(

2451 
IN
 
PRTMP_ADAPTER
 
pAd
,

2452 
IN
 
TX_BLK
 *
pTxBlk
)

2454 
PUCHAR
 
pHdBufP
;

2455 
USHORT
 
FeNumb
;

2456 
USHORT
 
tٮMPDUSize
=0;

2457 
USHORT
 
FTx
, 
LaTxIdx
;

2458 
ameNum
 = 0;

2459 
BOOLEAN
 
bVLANPkt
;

2460 
PQUEUE_ENTRY
 
pQEry
;

2463 
	`ASSERT
(
pTxBlk
);

2465 
	`ASSERT
((
pTxBlk
->
TxPackLi
.
Numb
== 2));

2468 
FTx
 = 
LaTxIdx
 = 0;

2469 
pTxBlk
->
TxPackLi
.
Hd
)

2471 
pQEry
 = 
	`RemoveHdQueue
(&
pTxBlk
->
TxPackLi
);

2472 
pTxBlk
->
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pQEry
);

2474 i(
	`RTMP_FlTxBlkInfo
(
pAd
, 
pTxBlk
!
TRUE
)

2476 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pTxBlk
->
pPack
, 
NDIS_STATUS_FAILURE
);

2480 
bVLANPkt
 = (
	`RTMP_GET_PACKET_VLAN
(
pTxBlk
->
pPack
? 
TRUE
 : 
FALSE
);

2483 
pTxBlk
->
pSrcBufDa
 =TxBlk->
pSrcBufHd
 + 
LENGTH_802_3
;

2484 
pTxBlk
->
SrcBufL
 -
LENGTH_802_3
;

2487 i(
bVLANPkt
)

2489 
pTxBlk
->
pSrcBufDa
 +
LENGTH_802_1Q
;

2490 
pTxBlk
->
SrcBufL
 -
LENGTH_802_1Q
;

2493 i(
ameNum
 == 0)

2496 
pHdBufP
 = 
	`STA_Bud_ARk_Fme_Hd
(
pAd
, 
pTxBlk
);

2500 
	`RTMPWreTxWI_Da
(
pAd
, (
PTXWI_STRUC
)(&
pTxBlk
->
HdBuf
[
TXINFO_SIZE
]),TxBlk);

2506 
	`EXTRA_LLCSNAP_ENCAP_FROM_PKT_OFFSET
(
pTxBlk
->
pSrcBufDa
-2,TxBlk->
pExaLlcSpEnp
);

2508 i(
pTxBlk
->
pExaLlcSpEnp
)

2510 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pExaLlcSpEnp
, 6);

2511 
pHdBufP
 += 6;

2513 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pSrcBufDa
-2, 2);

2514 
pHdBufP
 += 2;

2515 
pTxBlk
->
MpduHdL
 +
LENGTH_802_1_H
;

2521 
pHdBufP
 = &
pTxBlk
->
HdBuf
[0];

2522 
pTxBlk
->
MpduHdL
 = 0;

2526 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pSrcBufHd
, 12);

2527 
pHdBufP
 += 12;

2529 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pSrcBufDa
-2, 2);

2530 
pHdBufP
 += 2;

2531 
pTxBlk
->
MpduHdL
 = 
LENGTH_ARALINK_SUBFRAMEHEAD
;

2534 
tٮMPDUSize
 +
pTxBlk
->
MpduHdL
 +TxBlk->
SrcBufL
;

2537 i(
ameNum
 ==0)

2538 
FTx
 = 
	`HAL_WreMuiTxResour
(
pAd
, 
pTxBlk
, 
ameNum
, &
FeNumb
);

2540 
LaTxIdx
 = 
	`HAL_WreMuiTxResour
(
pAd
, 
pTxBlk
, 
ameNum
, &
FeNumb
);

2542 
ameNum
++;

2544 
pAd
->
RkCous
.
OSecTxAgggiCou
++;

2545 
pAd
->
RkCous
.
KickTxCou
++;

2546 
pAd
->
RkCous
.
OSecTxDeCou
++;

2550 
	`HAL_FWreTxResour
(
pAd
, 
pTxBlk
, 
tٮMPDUSize
, 
FTx
);

2551 
	`HAL_LaTxIdx
(
pAd
, 
pTxBlk
->
QueIdx
, 
LaTxIdx
);

2556 #ifde
PCIE_PS_SUPPORT


2557 i(!
	`RTMP_TEST_PSFLAG
(
pAd
, 
fRTMP_PS_DISABLE_TX
))

2559 
	`HAL_KickOutTx
(
pAd
, 
pTxBlk
,TxBlk->
QueIdx
);

2561 
	}
}

2564 
VOID
 
	$STA_Fgmt_Fme_Tx
(

2565 
IN
 
RTMP_ADAPTER
 *
pAd
,

2566 
IN
 
TX_BLK
 *
pTxBlk
)

2568 
HEADER_802_11
 *
pHd_802_11
;

2569 
PUCHAR
 
pHdBufP
;

2570 
USHORT
 
FeNumb
;

2571 
UCHAR
 
agNum
 = 0;

2572 
PACKET_INFO
 
PackInfo
;

2573 
USHORT
 
EnyiOvhd
 = 0;

2574 
UINT32
 
FeMpduSize
, 
SrcRemagBys
;

2575 
USHORT
 
AckDuti
;

2576 
UINT
 
NextMpduSize
;

2577 
BOOLEAN
 
bVLANPkt
;

2578 
PQUEUE_ENTRY
 
pQEry
;

2579 
HTTRANSMIT_SETTING
 *
pTnsm
;

2580 #ifde
SOFT_ENCRYPT


2581 
PUCHAR
 
tmp_r
 = 
NULL
;

2582 
UINT32
 
buf_offt
 = 0;

2586 
	`ASSERT
(
pTxBlk
);

2588 
pQEry
 = 
	`RemoveHdQueue
(&
pTxBlk
->
TxPackLi
);

2589 
pTxBlk
->
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pQEry
);

2590 i(
	`RTMP_FlTxBlkInfo
(
pAd
, 
pTxBlk
!
TRUE
)

2592 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pTxBlk
->
pPack
, 
NDIS_STATUS_FAILURE
);

2596 
	`ASSERT
(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bAowFg
));

2597 
bVLANPkt
 = (
	`RTMP_GET_PACKET_VLAN
(
pTxBlk
->
pPack
? 
TRUE
 : 
FALSE
);

2599 
	`STAFdChAlgܙhm
(
pAd
, 
pTxBlk
);

2600 
	`STABudComm802_11Hd
(
pAd
, 
pTxBlk
);

2602 #ifde
SOFT_ENCRYPT


2605 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bSwEny
))

2607 i(
	`RTMPExndPackFSwEny
(
pAd
, 
pTxBlk
=
FALSE
)

2609 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pTxBlk
->
pPack
, 
NDIS_STATUS_FAILURE
);

2615 i(
pTxBlk
->
ChAlg
 =
CIPHER_TKIP
)

2617 
pTxBlk
->
pPack
 = 
	`dui_pkt_wh_TKIP_MIC
(
pAd
,TxBlk->pPacket);

2618 i(
pTxBlk
->
pPack
 =
NULL
)

2620 
	`RTMP_QuyPackInfo
(
pTxBlk
->
pPack
, &
PackInfo
, &pTxBlk->
pSrcBufHd
, &pTxBlk->
SrcBufL
);

2624 
pTxBlk
->
pSrcBufDa
 =TxBlk->
pSrcBufHd
 + 
LENGTH_802_3
;

2625 
pTxBlk
->
SrcBufL
 -
LENGTH_802_3
;

2629 i(
bVLANPkt
)

2631 
pTxBlk
->
pSrcBufDa
 +
LENGTH_802_1Q
;

2632 
pTxBlk
->
SrcBufL
 -
LENGTH_802_1Q
;

2635 
pHdBufP
 = &
pTxBlk
->
HdBuf
[
TXINFO_SIZE
 + 
TXWI_SIZE
];

2636 
pHd_802_11
 = (
HEADER_802_11
 *)
pHdBufP
;

2640 
pHdBufP
 +
pTxBlk
->
MpduHdL
;

2642 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bWMM
))

2647 *
pHdBufP
 = (
pTxBlk
->
UrPriܙy
 & 0x0F);

2649 *(
pHdBufP
+1) = 0;

2650 
pHdBufP
 +=2;

2651 
pTxBlk
->
MpduHdL
 += 2;

2658 
pTxBlk
->
HdrPadL
 = (
ULONG
)
pHdBufP
;

2659 
pHdBufP
 = (
PUCHAR

	`ROUND_UP
(pHeaderBufPtr, 4);

2660 
pTxBlk
->
HdrPadL
 = (
ULONG
)(
pHdBufP
 -TxBlk->HdrPadLen);

2662 #ifde
SOFT_ENCRYPT


2663 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bSwEny
))

2665 
UCHAR
 
iv_offt
 = 0;

2669 
	`EXTRA_LLCSNAP_ENCAP_FROM_PKT_OFFSET
(
pTxBlk
->
pSrcBufDa
 - 2,TxBlk->
pExaLlcSpEnp
);

2672 i(
pTxBlk
->
pExaLlcSpEnp
)

2675 
pTxBlk
->
pSrcBufDa
 -
LENGTH_802_1_H
;

2676 
pTxBlk
->
SrcBufL
 +
LENGTH_802_1_H
;

2678 
	`NdisMoveMemy
(
pTxBlk
->
pSrcBufDa
,TxBlk->
pExaLlcSpEnp
, 6);

2682 
	`RTMPSoCڡruIVHdr
(
pTxBlk
->
ChAlg
,

2683 
pTxBlk
->
KeyIdx
,

2684 
pTxBlk
->
pKey
->
TxTsc
,

2685 
pHdBufP
,

2686 &
iv_offt
);

2687 
pHdBufP
 +
iv_offt
;

2688 
pTxBlk
->
MpduHdL
 +
iv_offt
;

2703 
	`EXTRA_LLCSNAP_ENCAP_FROM_PKT_START
(
pTxBlk
->
pSrcBufHd
,TxBlk->
pExaLlcSpEnp
);

2704 i(
pTxBlk
->
pExaLlcSpEnp
)

2706 
UCHAR
 
vn_size
;

2708 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pExaLlcSpEnp
, 6);

2709 
pHdBufP
 += 6;

2711 
vn_size
 = (
bVLANPkt
? 
LENGTH_802_1Q
 : 0;

2713 
	`NdisMoveMemy
(
pHdBufP
, 
pTxBlk
->
pSrcBufHd
+12+
vn_size
, 2);

2714 
pHdBufP
 += 2;

2715 
pTxBlk
->
MpduHdL
 +
LENGTH_802_1_H
;

2722 i(
pTxBlk
->
ChAlg
 =
CIPHER_TKIP
)

2724 
	`RTMPCcuϋMICVue
(
pAd
, 
pTxBlk
->
pPack
,TxBlk->
pExaLlcSpEnp
,TxBlk->
pKey
, 0);

2728 
	`NdisMoveMemy
(
pTxBlk
->
pSrcBufDa
 +TxBlk->
SrcBufL
, &
pAd
->
PriveInfo
.
Tx
.
MIC
[0], 8);

2730 
pTxBlk
->
SrcBufL
 += 8;

2731 
pTxBlk
->
TٮFmeL
 += 8;

2738 i((
pTxBlk
->
ChAlg
 =
CIPHER_WEP64
|| (pTxBlk->ChAlg =
CIPHER_WEP128
))

2739 
EnyiOvhd
 = 8;

2740 i(
pTxBlk
->
ChAlg
 =
CIPHER_TKIP
)

2741 
EnyiOvhd
 = 12;

2742 i(
pTxBlk
->
ChAlg
 =
CIPHER_AES
)

2743 
EnyiOvhd
 = 16;

2745 
EnyiOvhd
 = 0;

2747 
pTnsm
 = 
pTxBlk
->pTransmit;

2749 i(
pTnsm
->
fld
.
MODE
 =
MODE_CCK
)

2750 
pTxBlk
->
TxRe
 = 
pTnsm
->
fld
.
MCS
;

2751 i(
pTnsm
->
fld
.
MODE
 =
MODE_OFDM
)

2752 
pTxBlk
->
TxRe
 = 
pTnsm
->
fld
.
MCS
 + 
RATE_FIRST_OFDM_RATE
;

2754 
pTxBlk
->
TxRe
 = 
RATE_6_5
;

2757 i(
pTxBlk
->
TxRe
 <
RATE_LAST_OFDM_RATE
)

2758 
AckDuti
 = 
	`RTMPCcDuti
(
pAd
,Ad->
CommCfg
.
ExedACKRe
[
pTxBlk
->
TxRe
], 14);

2760 
AckDuti
 = 
	`RTMPCcDuti
(
pAd
, 
RATE_6_5
, 14);

2763 
SrcRemagBys
 = 
pTxBlk
->
SrcBufL
;

2765 
pTxBlk
->
TٮFgNum
 = 0xff;

2767 #ifde
SOFT_ENCRYPT


2768 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bSwEny
))

2771 
	`os_loc_mem
(
pAd
, (
PUCHAR
 *)&
tmp_r
, 
pTxBlk
->
SrcBufL
);

2772 i(
tmp_r
 =
NULL
)

2774 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!%s :o memory for SW MIC calculation !!!\n",

2775 
__FUNCTION__
));

2776 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pTxBlk
->
pPack
, 
NDIS_STATUS_FAILURE
);

2779 
	`NdisMoveMemy
(
tmp_r
, 
pTxBlk
->
pSrcBufDa
,TxBlk->
SrcBufL
);

2785 
FeMpduSize
 = 
pAd
->
CommCfg
.
FgmtThshd
 - 
LENGTH_CRC
;

2787 
FeMpduSize
 -
pTxBlk
->
MpduHdL
;

2789 i(
SrcRemagBys
 <
FeMpduSize
)

2792 
pTxBlk
->
SrcBufL
 = 
SrcRemagBys
;

2794 
pHd_802_11
->
FC
.
MeFg
 = 0;

2795 
pHd_802_11
->
Duti
 = 
pAd
->
CommCfg
.
Dsifs
 + 
AckDuti
;

2798 
pTxBlk
->
TٮFgNum
 = 
agNum
;

2803 
pTxBlk
->
SrcBufL
 = 
FeMpduSize
;

2805 
NextMpduSize
 = 
	`m
(((
UINT
)
SrcRemagBys
 - 
pTxBlk
->
SrcBufL
), ((UINT)
pAd
->
CommCfg
.
FgmtThshd
));

2806 
pHd_802_11
->
FC
.
MeFg
 = 1;

2807 
pHd_802_11
->
Duti
 = (3 * 
pAd
->
CommCfg
.
Dsifs
+ (2 * 
AckDuti
+ 
	`RTMPCcDuti
Ad, 
pTxBlk
->
TxRe
, 
NextMpduSize
 + 
EnyiOvhd
);

2812 
SrcRemagBys
 -
pTxBlk
->
SrcBufL
;

2814 i(
agNum
 == 0)

2815 
pTxBlk
->
FmeG
 = 
IFS_HTTXOP
;

2817 
pTxBlk
->
FmeG
 = 
IFS_SIFS
;

2819 #ifde
SOFT_ENCRYPT


2820 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bSwEny
))

2822 
UCHAR
 
ext_offt
 = 0;

2824 
	`NdisMoveMemy
(
pTxBlk
->
pSrcBufDa
, 
tmp_r
 + 
buf_offt
,TxBlk->
SrcBufL
);

2825 
buf_offt
 +
pTxBlk
->
SrcBufL
;

2828 
	`RTMPSoEnyiAi
(
pAd
,

2829 
pTxBlk
->
ChAlg
,

2830 (
PUCHAR
)
pHd_802_11
,

2831 
pTxBlk
->
pSrcBufDa
,

2832 
pTxBlk
->
SrcBufL
,

2833 
pTxBlk
->
KeyIdx
,

2834 
pTxBlk
->
pKey
,

2835 &
ext_offt
);

2836 
pTxBlk
->
SrcBufL
 +
ext_offt
;

2837 
pTxBlk
->
TٮFmeL
 +
ext_offt
;

2842 
	`RTMPWreTxWI_Da
(
pAd
, (
PTXWI_STRUC
)(&
pTxBlk
->
HdBuf
[
TXINFO_SIZE
]),TxBlk);

2844 
	`HAL_WreFgTxResour
(
pAd
, 
pTxBlk
, 
agNum
, &
FeNumb
);

2846 
pAd
->
RkCous
.
KickTxCou
++;

2847 
pAd
->
RkCous
.
OSecTxDeCou
++;

2851 #ifde
SOFT_ENCRYPT


2852 i(
	`TX_BLK_TEST_FLAG
(
pTxBlk
, 
fTX_bSwEny
))

2854 i((
pTxBlk
->
ChAlg
 =
CIPHER_WEP64
|| (pTxBlk->ChAlg =
CIPHER_WEP128
))

2856 
	`c_iv_by
(
pTxBlk
->
pKey
->
TxTsc
, 
LEN_WEP_TSC
, 1);

2858 
	`RTMPCڡruWEPIVHdr
(
pTxBlk
->
KeyIdx
,TxBlk->
pKey
->
TxTsc
,

2859 
pHdBufP
 - (
LEN_WEP_IV_HDR
));

2861 i(
pTxBlk
->
ChAlg
 =
CIPHER_TKIP
)

2863 i(
pTxBlk
->
ChAlg
 =
CIPHER_AES
)

2865 
	`c_iv_by
(
pTxBlk
->
pKey
->
TxTsc
, 
LEN_WPA_TSC
, 1);

2867 
	`RTMPCڡruCCMPHdr
(
pTxBlk
->
KeyIdx
,TxBlk->
pKey
->
TxTsc
,

2868 
pHdBufP
 - (
LEN_CCMP_HDR
));

2875 i(
agNum
 =0 && 
pTxBlk
->
pExaLlcSpEnp
)

2876 
pTxBlk
->
MpduHdL
 -
LENGTH_802_1_H
;

2879 
agNum
++;

2881 
pTxBlk
->
pSrcBufDa
 +pTxBlk->
SrcBufL
;

2883 
pHd_802_11
->
Fg
++;

2885 }
SrcRemagBys
 > 0);

2887 #ifde
SOFT_ENCRYPT


2888 i(
tmp_r
 !
NULL
)

2889 
	`os__mem
(
pAd
, 
tmp_r
);

2895 #ifde
PCIE_PS_SUPPORT


2896 i(!
	`RTMP_TEST_PSFLAG
(
pAd
, 
fRTMP_PS_DISABLE_TX
))

2898 
	`HAL_KickOutTx
(
pAd
, 
pTxBlk
,TxBlk->
QueIdx
);

2899 
	}
}

2902 
	#RELEASE_FRAMES_OF_TXBLK
(
_pAd
, 
_pTxBlk
, 
_pQEry
, 
_Stus
) \

2903 
_pTxBlk
->
TxPackLi
.
Hd
) \

2905 
_pQEry
 = 
	`RemoveHdQueue
(&
_pTxBlk
->
TxPackLi
); \

2906 
	`RELEASE_NDIS_PACKET
(
_pAd
, 
	`QUEUE_ENTRY_TO_PACKET
(
_pQEry
), 
_Stus
); \

2907 }

	)

2932 
NDIS_STATUS
 
	$STAHdTnsm
(

2933 
IN
 
PRTMP_ADAPTER
 
pAd
,

2934 
IN
 
TX_BLK
 *
pTxBlk
,

2935 
IN
 
UCHAR
 
QueIdx
)

2937 
NDIS_PACKET
 *
pPack
;

2938 
PQUEUE_ENTRY
 
pQEry
;

2944 
	`ASSERT
(
pTxBlk
->
TxPackLi
.
Numb
);

2945 i(
pTxBlk
->
TxPackLi
.
Hd
 =
NULL
)

2947 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("pTxBlk->TٮFmeNum =%ld!\n", 
pTxBlk
->
TxPackLi
.
Numb
));

2948  
NDIS_STATUS_FAILURE
;

2951 
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pTxBlk
->
TxPackLi
.
Hd
);

2960 i((
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
&& 
	`OPSTATUS_TEST_FLAG
Ad, 
fOP_STATUS_DOZE
))

2962 
	`DBGPRINT_RAW
(
RT_DEBUG_INFO
, ("AsicForceWakeup At HardTx\n"));

2963 #ifde
RTMP_MAC_PCI


2964 
	`AsicFWakeup
(
pAd
, 
TRUE
);

2969 i((!(
pAd
->
CommCfg
.
bAPSDCab
 &&Ad->CommCfg.
APEdPm
.bAPSDCab&& (pAd->CommCfg.
bAPSDFPowSave
 =
FALSE
))

2970 || (
	`RTMP_GET_PACKET_EAPOL
(
pTxBlk
->
pPack
))

2971 || (
	`RTMP_GET_PACKET_WAI
(
pTxBlk
->
pPack
)))

2973 i((
pAd
->
SCfg
.
Psm
 =
PWR_SAVE
) &&

2974 (
pAd
->
SCfg
.
WdowsPowMode
 =
Ndis802_11PowModeFa_PSP
))

2975 
	`RTMP_SET_PSM_BIT
(
pAd
, 
PWR_ACTIVE
);

2978 
pTxBlk
->
TxFmeTy
)

2980 #ifde
DOT11_N_SUPPORT


2981 
TX_AMPDU_FRAME
:

2982 
	`STA_AMPDU_Fme_Tx
(
pAd
, 
pTxBlk
);

2984 
TX_AMSDU_FRAME
:

2985 
	`STA_AMSDU_Fme_Tx
(
pAd
, 
pTxBlk
);

2988 
TX_LEGACY_FRAME
:

2989 
	`STA_Legacy_Fme_Tx
(
pAd
, 
pTxBlk
);

2991 
TX_MCAST_FRAME
:

2992 
	`STA_Legacy_Fme_Tx
(
pAd
, 
pTxBlk
);

2994 
TX_RALINK_FRAME
:

2995 
	`STA_ARk_Fme_Tx
(
pAd
, 
pTxBlk
);

2997 
TX_FRAG_FRAME
:

2998 
	`STA_Fgmt_Fme_Tx
(
pAd
, 
pTxBlk
);

3003 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("Sendacekt wasot classified!! It shouldot happen!\n"));

3004 
pTxBlk
->
TxPackLi
.
Numb
)

3006 
pQEry
 = 
	`RemoveHdQueue
(&
pTxBlk
->
TxPackLi
);

3007 
pPack
 = 
	`QUEUE_ENTRY_TO_PACKET
(
pQEry
);

3008 i(
pPack
)

3009 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

3015  (
NDIS_STATUS_SUCCESS
);

3017 
	}
}

3019 
ULONG
 
	$HashBysPynoml
(
UCHAR
 *
vue
, 
n
)

3021 *
wd
 = 
vue
;

3022 
t
 = 0;

3023 
i
;

3025 
i
=0; i < 
n
; i++)

3027 
mod
 = 
i
 % 32;

3028 
t
 ^=((
wd
[
i
]<< 
mod
;

3029 
t
 ^=((
wd
[
i
]>> (32 - 
mod
);

3031  
t
;

3032 
	}
}

3034 
VOID
 
	$S_Aoun__Fwd_802_3_Pack
(

3035 
IN
 
PRTMP_ADAPTER
 
pAd
,

3036 
IN
 
PNDIS_PACKET
 
pPack
,

3037 
IN
 
UCHAR
 
FromWhichBSSID
)

3039 i(
TRUE


3042 
	`noun_802_3_ck
(
pAd
, 
pPack
);

3047 
	`RELEASE_NDIS_PACKET
(
pAd
, 
pPack
, 
NDIS_STATUS_FAILURE
);

3049 
	}
}

	@sta/sanity.c

37 
	~"_cfig.h
"

39 
UCHAR
 
CISCO_OUI
[];

41 
UCHAR
 
WPA_OUI
[];

42 
UCHAR
 
RSN_OUI
[];

43 
UCHAR
 
WME_INFO_ELEM
[];

44 
UCHAR
 
WME_PARM_ELEM
[];

45 
UCHAR
 
RALINK_OUI
[];

46 
UCHAR
 
BROADCOM_OUI
[];

56 
BOOLEAN
 
	$MlmeSReqSy
(

57 
IN
 
PRTMP_ADAPTER
 
pAd
,

58 
IN
 
VOID
 *
Msg
,

59 
IN
 
ULONG
 
MsgL
,

60 
OUT
 
CHAR
 
Ssid
[],

61 
OUT
 
UCHAR
 *
pSsidL
)

63 
MLME_START_REQ_STRUCT
 *
Info
;

65 
Info
 = (
MLME_START_REQ_STRUCT
 *)(
Msg
);

67 i(
Info
->
SsidL
 > 
MAX_LEN_OF_SSID
)

69 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeStartReqSanity fail - wrong SSIDength\n"));

70  
FALSE
;

73 *
pSsidL
 = 
Info
->
SsidL
;

74 
	`NdisMoveMemy
(
Ssid
, 
Info
->Ssid, *
pSsidL
);

76  
TRUE
;

77 
	}
}

90 
BOOLEAN
 
	$PrAssocRSy
(

91 
IN
 
PRTMP_ADAPTER
 
pAd
,

92 
IN
 
VOID
 *
pMsg
,

93 
IN
 
ULONG
 
MsgL
,

94 
OUT
 
PUCHAR
 
pAddr2
,

95 
OUT
 
USHORT
 *
pCabyInfo
,

96 
OUT
 
USHORT
 *
pStus
,

97 
OUT
 
USHORT
 *
pAid
,

98 
OUT
 
UCHAR
 
SupRe
[],

99 
OUT
 
UCHAR
 *
pSupReL
,

100 
OUT
 
UCHAR
 
ExtRe
[],

101 
OUT
 
UCHAR
 *
pExtReL
,

102 
OUT
 
HT_CAPABILITY_IE
 *
pHtCaby
,

103 
OUT
 
ADD_HT_INFO_IE
 *
pAddHtInfo
,

104 
OUT
 
UCHAR
 *
pHtCabyL
,

105 
OUT
 
UCHAR
 *
pAddHtInfoL
,

106 
OUT
 
UCHAR
 *
pNewExtChlOfft
,

107 
OUT
 
PEDCA_PARM
 
pEdPm
,

108 
OUT
 
EXT_CAP_INFO_ELEMENT
 *
pExtCInfo
,

109 
OUT
 
UCHAR
 *
pCkFg
)

111 
CHAR
 
IeTy
, *
P
;

112 
PFRAME_802_11
 
pFme
 = (PFRAME_802_11)
pMsg
;

113 
PEID_STRUCT
 
pEid
;

114 
ULONG
 
Lgth
 = 0;

116 *
pNewExtChlOfft
 = 0xff;

117 *
pHtCabyL
 = 0;

118 *
pAddHtInfoL
 = 0;

119 
	`COPY_MAC_ADDR
(
pAddr2
, 
pFme
->
Hdr
.
Addr2
);

120 
P
 = (
PCHAR
)
pFme
->
O
;

121 
Lgth
 +
LENGTH_802_11
;

123 
	`NdisMoveMemy
(
pCabyInfo
, &
pFme
->
O
[0], 2);

124 
Lgth
 += 2;

125 
	`NdisMoveMemy
(
pStus
, &
pFme
->
O
[2], 2);

126 
Lgth
 += 2;

127 *
pCkFg
 = 0;

128 *
pExtReL
 = 0;

129 
pEdPm
->
bVid
 = 
FALSE
;

131 i(*
pStus
 !
MLME_SUCCESS
)

132  
TRUE
;

134 
	`NdisMoveMemy
(
pAid
, &
pFme
->
O
[4], 2);

135 
Lgth
 += 2;

138 *
pAid
 = (*pAid) & 0x3fff;

141 
IeTy
 = 
pFme
->
O
[6];

142 *
pSupReL
 = 
pFme
->
O
[7];

143 i((
IeTy
 !
IE_SUPP_RATES
|| (*
pSupReL
 > 
MAX_LEN_OF_SUPPORTED_RATES
))

145 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerAssocRspSanity fail - wrong SupportedRates IE\n"));

146  
FALSE
;

149 
	`NdisMoveMemy
(
SupRe
, &
pFme
->
O
[8], *
pSupReL
);

152 
Lgth
 = Lgth + 2 + *
pSupReL
;

156 
pEid
 = (
PEID_STRUCT
&
pFme
->
O
[8 + (*
pSupReL
)];

159 (
Lgth
 + 2 + 
pEid
->
L
<
MsgL
)

161 
pEid
->
Eid
)

163 
IE_EXT_SUPP_RATES
:

164 i(
pEid
->
L
 <
MAX_LEN_OF_SUPPORTED_RATES
)

166 
	`NdisMoveMemy
(
ExtRe
, 
pEid
->
O
,Eid->
L
);

167 *
pExtReL
 = 
pEid
->
L
;

171 
IE_HT_CAP
:

172 
IE_HT_CAP2
:

173 i(
pEid
->
L
 >
SIZE_HT_CAP_IE
)

175 
	`NdisMoveMemy
(
pHtCaby
, 
pEid
->
O
, 
SIZE_HT_CAP_IE
);

177 *(
USHORT
 *)(&
pHtCaby
->
HtCInfo

	`u216
(*(USHORT *)(&pHtCapability->HtCapInfo));

178 *(
USHORT
 *)(&
pHtCaby
->
ExtHtCInfo

	`u216
(*(USHORT *)(&pHtCapability->ExtHtCapInfo));

180 *
pHtCabyL
 = 
SIZE_HT_CAP_IE
;

184 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("PeerAssocRspSanity - wrong IE_HT_CAP. \n"));

188 #ifde
DOT11_N_SUPPORT


189 
IE_ADD_HT
:

190 
IE_ADD_HT2
:

191 i(
pEid
->
L
 >(
ADD_HT_INFO_IE
))

195 
	`NdisMoveMemy
(
pAddHtInfo
, 
pEid
->
O
, (
ADD_HT_INFO_IE
));

197 *(
USHORT
 *)(&
pAddHtInfo
->
AddHtInfo2

	`u216
(*(USHORT *)(&pAddHtInfo->AddHtInfo2));

198 *(
USHORT
 *)(&
pAddHtInfo
->
AddHtInfo3

	`u216
(*(USHORT *)(&pAddHtInfo->AddHtInfo3));

200 *
pAddHtInfoL
 = 
SIZE_ADD_HT_INFO_IE
;

204 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("PeerAssocRspSanity - wrong IE_ADD_HT. \n"));

208 
IE_SECONDARY_CH_OFFSET
:

209 i(
pEid
->
L
 == 1)

211 *
pNewExtChlOfft
 = 
pEid
->
O
[0];

215 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("PeerAssocRspSanity - wrong IE_SECONDARY_CH_OFFSET. \n"));

220 
IE_VENDOR_SPECIFIC
:

222 i(
	`NdisEquMemy
(
pEid
->
O
, 
WME_PARM_ELEM
, 6&& (pEid->
L
 == 24))

224 
PUCHAR
 
r
;

225 
i
;

228 
pEdPm
->
bVid
 = 
TRUE
;

229 
pEdPm
->
bQAck
 = 
FALSE
;

230 
pEdPm
->
bQueueReque
 = 
FALSE
;

231 
pEdPm
->
bTxReque
 = 
FALSE
;

233 
pEdPm
->
EdUpdeCou
 = 
pEid
->
O
[6] & 0x0f;

234 
pEdPm
->
bAPSDCab
 = (
pEid
->
O
[6] & 0x80) ? 1 : 0;

235 
r
 = (
PUCHAR
)&
pEid
->
O
[8];

236 
i
=0; i<4; i++)

238 
UCHAR
 
aci
 = (*
r
 & 0x60) >> 5;

239 
pEdPm
->
bACM
[
aci
] = (((*
r
) & 0x10) == 0x10);

240 
pEdPm
->
Aif
[
aci
] = (*
r
) & 0x0f;

241 
pEdPm
->
Cwm
[
aci
] = *(
r
+1) & 0x0f;

242 
pEdPm
->
Cwmax
[
aci
] = *(
r
+1) >> 4;

243 
pEdPm
->
Tx
[
aci
] = *(
r
+2) + 256 * (*(ptr+3));

244 
r
 += 4;

248 
IE_EXT_CAPABILITY
:

249 i(
pEid
->
L
 >(
EXT_CAP_INFO_ELEMENT
))

251 
	`NdisMoveMemy
(
pExtCInfo
, &
pEid
->
O
[0], 4);

252 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("PeerAssocReqSanity - IE_EXT_CAPABILITY!\n"));

257 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrAssocRSy - ignܐuecognized EID = %d\n", 
pEid
->
Eid
));

261 
Lgth
 = Lgth + 2 + 
pEid
->
L
;

262 
pEid
 = (
PEID_STRUCT
)((
UCHAR
*Eid + 2 +Eid->
L
);

266  
TRUE
;

267 
	}
}

276 
BOOLEAN
 
	$GTimB
(

277 
IN
 
CHAR
 *
P
,

278 
IN
 
USHORT
 
Aid
,

279 
OUT
 
UCHAR
 *
TimL
,

280 
OUT
 
UCHAR
 *
BFg
,

281 
OUT
 
UCHAR
 *
DtimCou
,

282 
OUT
 
UCHAR
 *
DtimPiod
,

283 
OUT
 
UCHAR
 *
MesgeToMe
)

285 
UCHAR
 
BCl
, 
N1
, 
N2
, 
MyBy
, 
MyB
;

286 
CHAR
 *
IdxP
;

288 
IdxP
 = 
P
;

290 
IdxP
 ++;

291 *
TimL
 = *
IdxP
;

294 
IdxP
 ++;

295 *
DtimCou
 = *
IdxP
;

298 
IdxP
++;

299 *
DtimPiod
 = *
IdxP
;

302 
IdxP
++;

303 
BCl
 = *
IdxP
;

305 i((*
DtimCou
 =0&& (
BCl
 & 0x01))

306 *
BFg
 = 
TRUE
;

308 *
BFg
 = 
FALSE
;

311 
N1
 = 
BCl
 & 0xfe;

312 
N2
 = *
TimL
 - 4 + 
N1
;

314 i((
Aid
 < (
N1
 << 3)|| (Aid >((
N2
 + 1) << 3)))

315 *
MesgeToMe
 = 
FALSE
;

318 
MyBy
 = (
Aid
 >> 3- 
N1
;

319 
MyB
 = 
Aid
 % 16 - ((
MyBy
 & 0x01)? 8:0);

321 
IdxP
 +(
MyBy
 + 1);

326 i(*
IdxP
 & (0x01 << 
MyB
))

327 *
MesgeToMe
 = 
TRUE
;

329 *
MesgeToMe
 = 
FALSE
;

332  
TRUE
;

333 
	}
}

	@sta/sta_cfg.c

40 
	~"_cfig.h
"

44 
INT
 
S_AutoRec_Proc
(

45 
IN
 
PRTMP_ADAPTER
 
pAd
,

46 
IN
 
PSTRING
 
g
);

48 
INT
 
S_AdhocN_Proc
(

49 
IN
 
PRTMP_ADAPTER
 
pAd
,

50 
IN
 
PSTRING
 
g
);

53 * 
	$rchr
(cڡ * 
s
, 
c
)

55 ; *
s
 !(
c
; ++s)

56 i(*
s
 == '\0')

57  
NULL
;

58  (*
s
;

59 
	}
}

62 
PSTRING
 
	mme
;

63 
INT
 (*
t_oc
)(
PRTMP_ADAPTER
 
	mpAdr
, 
PSTRING
 
	mg
);

64 } *
	gPRTMP_PRIVATE_SET_PROC
, 
	gRTMP_PRIVATE_SUPPORT_PROC
[] = {

65 {"DrivVsi", 
S_DrivVsi_Proc
},

66 {"CouryRegi", 
S_CouryRegi_Proc
},

67 {"CouryRegiABd", 
S_CouryRegiABd_Proc
},

68 {"SSID", 
S_SSID_Proc
},

69 {"WessMode", 
S_WessMode_Proc
},

70 {"TxBur", 
S_TxBur_Proc
},

71 {"TxPamb", 
S_TxPamb_Proc
},

72 {"TxPow", 
S_TxPow_Proc
},

73 {"Chl", 
S_Chl_Proc
},

74 {"BGPrei", 
S_BGPrei_Proc
},

75 {"RTSThshd", 
S_RTSThshd_Proc
},

76 {"FgThshd", 
S_FgThshd_Proc
},

77 #ifde
DOT11_N_SUPPORT


78 {"HtBw", 
S_HtBw_Proc
},

79 {"HtMcs", 
S_HtMcs_Proc
},

80 {"HtGi", 
S_HtGi_Proc
},

81 {"HtOpMode", 
S_HtOpMode_Proc
},

82 {"HtStbc", 
S_HtStbc_Proc
},

83 {"HtExtcha", 
S_HtExtcha_Proc
},

84 {"HtMpduDsy", 
S_HtMpduDsy_Proc
},

85 {"HtBaWSize", 
S_HtBaWSize_Proc
},

86 {"HtRdg", 
S_HtRdg_Proc
},

87 {"HtAmsdu", 
S_HtAmsdu_Proc
},

88 {"HtAutoBa", 
S_HtAutoBa_Proc
},

89 {"HtBaDee", 
S_BADee_Proc
},

90 {"HtPre", 
S_HtPre_Proc
},

91 {"HtMimoPs", 
S_HtMimoPs_Proc
},

92 {"HtDiowTKIP", 
S_HtDiowTKIP_Proc
},

93 #ifde
DOT11N_DRAFT3


94 {"HtBssCx", 
S_HT_BssCx_Proc
},

98 #ifde
AGGREGATION_SUPPORT


99 {"PktAggge", 
S_PktAggge_Proc
},

102 #ifde
WMM_SUPPORT


103 {"WmmCab", 
S_WmmCab_Proc
},

105 {"IEEE80211H", 
S_IEEE80211H_Proc
},

106 {"NwkTy", 
S_NwkTy_Proc
},

107 {"AuthMode", 
S_AuthMode_Proc
},

108 {"EnypTy", 
S_EnypTy_Proc
},

109 {"DeuKeyID", 
S_DeuKeyID_Proc
},

110 {"Key1", 
S_Key1_Proc
},

111 {"Key2", 
S_Key2_Proc
},

112 {"Key3", 
S_Key3_Proc
},

113 {"Key4", 
S_Key4_Proc
},

114 {"WPAPSK", 
S_WPAPSK_Proc
},

115 {"RetCou", 
S_RetStCou_Proc
},

116 {"PSMode", 
S_PSMode_Proc
},

117 #ifde
DBG


118 {"Debug", 
S_Debug_Proc
},

122 #ifde
RALINK_ATE


123 {"ATE", 
S_ATE_Proc
},

124 {"ATEDA", 
S_ATE_DA_Proc
},

125 {"ATESA", 
S_ATE_SA_Proc
},

126 {"ATEBSSID", 
S_ATE_BSSID_Proc
},

127 {"ATECHANNEL", 
S_ATE_CHANNEL_Proc
},

128 {"ATETXPOW0", 
S_ATE_TX_POWER0_Proc
},

129 {"ATETXPOW1", 
S_ATE_TX_POWER1_Proc
},

130 {"ATETXANT", 
S_ATE_TX_A_Proc
},

131 {"ATERXANT", 
S_ATE_RX_A_Proc
},

132 {"ATETXFREQOFFSET", 
S_ATE_TX_FREQOFFSET_Proc
},

133 {"ATETXBW", 
S_ATE_TX_BW_Proc
},

134 {"ATETXLEN", 
S_ATE_TX_LENGTH_Proc
},

135 {"ATETXCNT", 
S_ATE_TX_COUNT_Proc
},

136 {"ATETXMCS", 
S_ATE_TX_MCS_Proc
},

137 {"ATETXMODE", 
S_ATE_TX_MODE_Proc
},

138 {"ATETXGI", 
S_ATE_TX_GI_Proc
},

139 {"ATERXFER", 
S_ATE_RX_FER_Proc
},

140 {"ATERRF", 
S_ATE_Rd_RF_Proc
},

141 {"ATEWRF1", 
S_ATE_Wre_RF1_Proc
},

142 {"ATEWRF2", 
S_ATE_Wre_RF2_Proc
},

143 {"ATEWRF3", 
S_ATE_Wre_RF3_Proc
},

144 {"ATEWRF4", 
S_ATE_Wre_RF4_Proc
},

145 {"ATELDE2P", 
S_ATE_Ld_E2P_Proc
},

146 {"ATERE2P", 
S_ATE_Rd_E2P_Proc
},

147 {"ATEAUTOALC", 
S_ATE_AUTO_ALC_Proc
},

148 {"ATEIPG", 
S_ATE_IPG_Proc
},

149 {"ATEPAYLOAD", 
S_ATE_Payld_Proc
},

150 {"ATESHOW", 
S_ATE_Show_Proc
},

151 {"ATEHELP", 
S_ATE_Hp_Proc
},

153 #ifde
RALINK_QA


154 {"TxSt", 
S_TxSt_Proc
},

155 {"RxSt", 
S_RxSt_Proc
},

159 #ifde
WPA_SUPPLICANT_SUPPORT


160 {"WSut", 
S_W_Sut
},

167 {"FixedTxMode", 
S_FixedTxMode_Proc
},

168 #ifde
CONFIG_APSTA_MIXED_SUPPORT


169 {"OpMode", 
S_OpMode_Proc
},

171 #ifde
DOT11_N_SUPPORT


172 {"TGnWifiTe", 
S_TGnWifiTe_Proc
},

174 #ifde
QOS_DLS_SUPPORT


175 {"DlsAddEry", 
S_DlsAddEry_Proc
},

176 {"DlsTrDownEry", 
S_DlsTrDownEry_Proc
},

178 {"LgRry", 
S_LgRryLim_Proc
},

179 {"ShtRry", 
S_ShtRryLim_Proc
},

180 {"AutoFlBack", 
S_AutoFlBack_Proc
},

181 #ifde
EXT_BUILD_CHANNEL_LIST


182 {"11dClMode", 
S_Ie80211dClMode_Proc
},

184 #ifde
CARRIER_DETECTION_SUPPORT


185 {"CrrDe", 
S_CrrDe_Proc
},

191 {"BcLoTime", 
S_BcLoTime_Proc
},

192 {"AutoRmg", 
S_AutoRmg_Proc
},

193 {"SeSurvey", 
S_SeSurvey_Proc
},

194 {"FTxBur", 
S_FTxBur_Proc
},

197 #ifde
XLINK_SUPPORT


198 {"XlkMode", 
S_XlkMode_Proc
},

202 {"AutoRec", 
S_AutoRec_Proc
},

203 {"AdhocN", 
S_AdhocN_Proc
},

205 {
NULL
,}

209 
INT
 
	$RTMPSTAPrivIolS
(

210 
IN
 
RTMP_ADAPTER
 *
pAd
,

211 
IN
 
PSTRING
 
SProcName
,

212 
IN
 
PSTRING
 
ProcArg
)

214 
t
 = 0;

216 
PRTMP_PRIVATE_SET_PROC
 = 
RTMP_PRIVATE_SUPPORT_PROC
; PRTMP_PRIVATE_SET_PROC->
me
; PRTMP_PRIVATE_SET_PROC++)

218 i(
	`rcmp
(
SProcName
, 
PRTMP_PRIVATE_SET_PROC
->
me
) == 0)

220 if(!
PRTMP_PRIVATE_SET_PROC
->
	`t_oc
(
pAd
, 
ProcArg
))

222  
NDIS_STATUS_FAILURE
;

228 if(
PRTMP_PRIVATE_SET_PROC
->
me
 =
NULL
)

230 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>_iol_am:: (iwivN Su܈S Commd [%s=%s]\n", 
SProcName
, 
ProcArg
));

231  -
EINVAL
;

235  
t
;

236 
	}
}

247 
INT
 
	$S_SSID_Proc
(

248 
IN
 
PRTMP_ADAPTER
 
pAd
,

249 
IN
 
PSTRING
 
g
)

251 
NDIS_802_11_SSID
 
Ssid
, *
pSsid
=
NULL
;

252 
BOOLEAN
 
SMacheTouched
 = 
FALSE
;

253 
sucss
 = 
TRUE
;

259 
pAd
->
MlmeAux
.
AutoRecSsidL
= 32;

260 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
AutoRecSsidL
);

262 if
	`
(
g
<
MAX_LEN_OF_SSID
)

264 
	`NdisZoMemy
(&
Ssid
, (
NDIS_802_11_SSID
));

265 i(
	`
(
g
) != 0)

267 
	`NdisMoveMemy
(
Ssid
.Ssid, 
g
, 
	`
(arg));

268 
Ssid
.
SsidLgth
 = 
	`
(
g
);

272 
Ssid
.
SsidLgth
 = 0;

273 
	`memy
(
Ssid
.Ssid, "", 0);

274 
pAd
->
SCfg
.
BssTy
 = 
BSS_INFRA
;

275 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeOn
;

276 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11EnyiDibd
;

278 
pSsid
 = &
Ssid
;

280 i(
pAd
->
Mlme
.
ClMache
.
CuS
 !
CNTL_IDLE
)

282 
	`RTMP_MLME_RESET_STATE_MACHINE
(
pAd
);

283 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! MLME busy,eset MLME state machine !!!\n"));

286 i((
pAd
->
SCfg
.
WPassPhL
 >= 8) &&

287 (
pAd
->
SCfg
.
WPassPhL
 <= 64))

289 
UCHAR
 
keyMl
[40];

291 
	`RTMPZoMemy
(
pAd
->
SCfg
.
PMK
, 32);

292 i(
pAd
->
SCfg
.
WPassPhL
 == 64)

294 
	`AtoH
((
PSTRING

pAd
->
SCfg
.
WPassPh
,Ad->SCfg.
PMK
, 32);

298 
	`RtmpPasswdHash
((
PSTRING

pAd
->
SCfg
.
WPassPh
, 
Ssid
.Ssid, Ssid.
SsidLgth
, 
keyMl
);

299 
	`NdisMoveMemy
(
pAd
->
SCfg
.
PMK
, 
keyMl
, 32);

304 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
Ssid
, 
MAX_LEN_OF_SSID
);

305 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
Ssid
, Ssid.Ssid, Ssid.
SsidLgth
);

306 
pAd
->
MlmeAux
.
SsidL
 = (
UCHAR
)
Ssid
.
SsidLgth
;

308 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
, 
Ssid
.Ssid, Ssid.
SsidLgth
);

309 
pAd
->
MlmeAux
.
AutoRecSsidL
 = (
UCHAR
)
Ssid
.
SsidLgth
;

311 
pAd
->
MlmeAux
.
CuReqIsFromNdis
 = 
TRUE
;

312 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
FALSE
;

313 
pAd
->
bCfigChged
 = 
TRUE
;

314 
pAd
->
SCfg
.
bNFSn
 = 
FALSE
;

316 
	`MlmeEnqueue
(
pAd
,

317 
MLME_CNTL_STATE_MACHINE
,

318 
OID_802_11_SSID
,

319 (
NDIS_802_11_SSID
),

320 (
VOID
 *)
pSsid
, 0);

322 
SMacheTouched
 = 
TRUE
;

323 i(
Ssid
.
SsidLgth
 =
MAX_LEN_OF_SSID
)

324 
	`hex_dump
("S_SSID_Proc::Ssid", 
Ssid
.Ssid, Ssid.
SsidLgth
);

326 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_SSID_Proc::(L=%d,Ssid=%s)\n", 
Ssid
.
SsidLgth
, Ssid.Ssid));

329 
sucss
 = 
FALSE
;

331 i(
SMacheTouched
)

332 
	`RTMP_MLME_HANDLER
(
pAd
);

334  
sucss
;

335 
	}
}

337 #ifde
WMM_SUPPORT


346 
INT
 
	$S_WmmCab_Proc
(

347 
IN
 
PRTMP_ADAPTER
 
pAd
,

348 
IN
 
PSTRING
 
g
)

350 
BOOLEAN
 
bWmmCab
;

352 
bWmmCab
 = 
	`sime_
(
g
, 0, 10);

354 i((
bWmmCab
 == 1)

356 
pAd
->
CommCfg
.
bWmmCab
 = 
TRUE
;

357 i(
bWmmCab
 == 0)

358 
pAd
->
CommCfg
.
bWmmCab
 = 
FALSE
;

360  
FALSE
;

362 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set_WmmCapable_Proc::(bWmmCapable=%d)\n",

363 
pAd
->
CommCfg
.
bWmmCab
));

365  
TRUE
;

366 
	}
}

377 
INT
 
	$S_NwkTy_Proc
(

378 
IN
 
PRTMP_ADAPTER
 
pAd
,

379 
IN
 
PSTRING
 
g
)

381 
UINT32
 
Vue
 = 0;

383 i(
	`rcmp
(
g
, "Adhoc") == 0)

385 i(
pAd
->
SCfg
.
BssTy
 !
BSS_ADHOC
)

388 
pAd
->
bCfigChged
 = 
TRUE
;

389 i(
	`MONITOR_ON
(
pAd
))

391 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 
STANORMAL
);

392 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
Vue
);

393 
Vue
 &= (~0x80);

394 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
Vue
);

395 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

396 
pAd
->
SCfg
.
bAutoRec
 = 
TRUE
;

397 
	`LkDown
(
pAd
, 
FALSE
);

399 i(
	`INFRA_ON
(
pAd
))

404 
pAd
->
MlmeAux
.
AutoRecSsidL
= 32;

405 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
AutoRecSsidL
);

407 
	`LkDown
(
pAd
, 
FALSE
);

409 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("NDIS_STATUS_MEDIA_DISCONNECT Event BB!\n"));

411 #ifde
DOT11_N_SUPPORT


412 
	`SCommHT
(
pAd
);

415 
pAd
->
SCfg
.
BssTy
 = 
BSS_ADHOC
;

416 
	`RTMP_OS_NETDEV_SET_TYPE
(
pAd
->
t_dev
,Ad->
SCfg
.
OriDevTy
);

418 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>Set_NetworkType_Proc::(AD-HOC)\n"));

420 i(
	`rcmp
(
g
, "Infra") == 0)

422 i(
pAd
->
SCfg
.
BssTy
 !
BSS_INFRA
)

425 
pAd
->
bCfigChged
 = 
TRUE
;

426 i(
	`MONITOR_ON
(
pAd
))

428 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 
STANORMAL
);

429 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
Vue
);

430 
Vue
 &= (~0x80);

431 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
Vue
);

432 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

433 
pAd
->
SCfg
.
bAutoRec
 = 
TRUE
;

434 
	`LkDown
(
pAd
, 
FALSE
);

436 i(
	`ADHOC_ON
(
pAd
))

440 
pAd
->
MlmeAux
.
AutoRecSsidL
= 32;

441 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
AutoRecSsid
,Ad->MlmeAux.
AutoRecSsidL
);

443 
	`LkDown
(
pAd
, 
FALSE
);

445 #ifde
DOT11_N_SUPPORT


446 
	`SCommHT
(
pAd
);

449 
pAd
->
SCfg
.
BssTy
 = 
BSS_INFRA
;

450 
	`RTMP_OS_NETDEV_SET_TYPE
(
pAd
->
t_dev
,Ad->
SCfg
.
OriDevTy
);

451 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>Set_NetworkType_Proc::(INFRA)\n"));

453 #ifde
MONITOR_FLAG_11N_SNIFFER_SUPPORT


458 i((
	`rcmp
(
g
, "Monitor") == 0) || (strcmp(arg, "Monitor2") == 0))

460 i(
	`rcmp
(
g
, "Monitor") == 0)

463 
UCHAR
 
bbpVue
 = 0;

464 
BCN_TIME_CFG_STRUC
 
c
;

466 #ifde
MONITOR_FLAG_11N_SNIFFER_SUPPORT


467 i(
	`rcmp
(
g
, "Monitor2") == 0)

468 
pAd
->
SCfg
.
BssMڙFg
 |
MONITOR_FLAG_11N_SNIFFER
;

472 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_INFRA_ON
);

473 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_ADHOC_ON
);

474 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

476 
pAd
->
SCfg
.
bAutoRec
 = 
FALSE
;

478 
	`RTMP_MLME_RESET_STATE_MACHINE
(
pAd
);

479 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("fOP_STATUS_MEDIA_STATE_CONNECTED \n"));

480 i(
pAd
->
CommCfg
.
CChl
 == 0)

482 #ifde
DOT11_N_SUPPORT


483 i(
pAd
->
CommCfg
.
PhyMode
 =
PHY_11AN_MIXED
)

484 
pAd
->
CommCfg
.
CChl
 = 36;

487 
pAd
->
CommCfg
.
CChl
 = 6;

489 #ifde
DOT11_N_SUPPORT


491 
	`N_ChlCheck
(
pAd
);

496 #ifde
DOT11_N_SUPPORT


497 i(
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
 &&

498 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 =
BW_40
 &&

499 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 =
EXTCHA_ABOVE
)

502 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
bbpVue
);

503 
bbpVue
 &= (~0x18);

504 
bbpVue
 |= 0x10;

505 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
bbpVue
);

506 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_40
;

508 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
bbpVue
);

509 
bbpVue
 &= (~0x20);

510 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
bbpVue
);

512 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Vue
);

513 
Vue
 &= 0xfffffffe;

514 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

515 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
 + 2;

516 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

517 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

518 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BW_40 ,control_channel(%d), CentralChannel(%d) \n",

519 
pAd
->
CommCfg
.
Chl
,

520 
pAd
->
CommCfg
.
CChl
));

522 i(
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
 &&

523 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
BW
 =
BW_40
 &&

524 
pAd
->
CommCfg
.
RegTnsmStg
.
fld
.
EXTCHA
 =
EXTCHA_BELOW
)

527 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
bbpVue
);

528 
bbpVue
 &= (~0x18);

529 
bbpVue
 |= 0x10;

530 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
bbpVue
);

531 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_40
;

532 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Vue
);

533 
Vue
 |= 0x1;

534 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Vue
);

536 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
bbpVue
);

537 
bbpVue
 |= (0x20);

538 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
bbpVue
);

539 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
 - 2;

540 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

541 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

542 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BW_40 ,control_channel(%d), CentralChannel(%d) \n",

543 
pAd
->
CommCfg
.
Chl
,

544 
pAd
->
CommCfg
.
CChl
));

550 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
bbpVue
);

551 
bbpVue
 &= (~0x18);

552 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
bbpVue
);

553 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_20
;

554 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

555 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

556 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BW_20, Chl(%d)\n", 
pAd
->
CommCfg
.
Chl
));

561 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 0x3);

567 
	`RTMP_IO_READ32
(
pAd
, 
BCN_TIME_CFG
, &
c
.
wd
);

568 
c
.
fld
.
bBcG
 = 0;

569 
c
.
fld
.
bTBTTEb
 = 0;

570 
c
.
fld
.
TsfSyncMode
 = 0;

571 
	`RTMP_IO_WRITE32
(
pAd
, 
BCN_TIME_CFG
, 
c
.
wd
);

573 
pAd
->
SCfg
.
BssTy
 = 
BSS_MONITOR
;

574 
	`RTMP_OS_NETDEV_SET_TYPE
(
pAd
->
t_dev
, 
ARPHRD_IEEE80211_PRISM
);

575 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("===>Set_NetworkType_Proc::(MONITOR)\n"));

579 
pAd
->
SCfg
.
WS
 = 
SS_NOTUSE
;

581 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_NwkTy_Proc::(NwkTy=%d)\n", 
pAd
->
SCfg
.
BssTy
));

583  
TRUE
;

584 
	}
}

594 
INT
 
	$S_AuthMode_Proc
(

595 
IN
 
PRTMP_ADAPTER
 
pAd
,

596 
IN
 
PSTRING
 
g
)

598 i((
	`rcmp
(
g
, "WEPAUTO") == 0) || (strcmp(arg, "wepauto") == 0))

599 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeAutoSwch
;

600 i((
	`rcmp
(
g
, "OPEN") == 0) || (strcmp(arg, "open") == 0))

601 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeOn
;

602 i((
	`rcmp
(
g
, "SHARED") == 0) || (strcmp(arg, "shared") == 0))

603 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeShed
;

604 i((
	`rcmp
(
g
, "WPAPSK") == 0) || (strcmp(arg, "wpapsk") == 0))

605 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPAPSK
;

606 i((
	`rcmp
(
g
, "WPANONE") == 0) || (strcmp(arg, "wpanone") == 0))

607 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPANe
;

608 i((
	`rcmp
(
g
, "WPA2PSK") == 0) || (strcmp(arg, "wpa2psk") == 0))

609 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPA2PSK
;

610 #ifde
WPA_SUPPLICANT_SUPPORT


611 i((
	`rcmp
(
g
, "WPA") == 0) || (strcmp(arg, "wpa") == 0))

612 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPA
;

613 i((
	`rcmp
(
g
, "WPA2") == 0) || (strcmp(arg, "wpa2") == 0))

614 
pAd
->
SCfg
.
AuthMode
 = 
Ndis802_11AuthModeWPA2
;

617  
FALSE
;

619 
pAd
->
SCfg
.
PtSecud
 = 
WPA_802_1X_PORT_NOT_SECURED
;

621 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_AuthMode_Proc::(AuthMode=%d)\n", 
pAd
->
SCfg
.
AuthMode
));

623  
TRUE
;

624 
	}
}

634 
INT
 
	$S_EnypTy_Proc
(

635 
IN
 
PRTMP_ADAPTER
 
pAd
,

636 
IN
 
PSTRING
 
g
)

638 i((
	`rcmp
(
g
, "NONE") == 0) || (strcmp(arg, "none") == 0))

640 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

641  
TRUE
;

643 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11WEPDibd
;

644 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11WEPDibd
;

645 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11WEPDibd
;

647 i((
	`rcmp
(
g
, "WEP") == 0) || (strcmp(arg, "wep") == 0))

649 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

650  
TRUE
;

652 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11WEPEbd
;

653 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11WEPEbd
;

654 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11WEPEbd
;

656 i((
	`rcmp
(
g
, "TKIP") == 0) || (strcmp(arg, "tkip") == 0))

658 i(
pAd
->
SCfg
.
AuthMode
 < 
Ndis802_11AuthModeWPA
)

659  
TRUE
;

661 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11Enyi2Ebd
;

662 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11Enyi2Ebd
;

663 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11Enyi2Ebd
;

665 i((
	`rcmp
(
g
, "AES") == 0) || (strcmp(arg, "aes") == 0))

667 i(
pAd
->
SCfg
.
AuthMode
 < 
Ndis802_11AuthModeWPA
)

668  
TRUE
;

670 
pAd
->
SCfg
.
WStus
 = 
Ndis802_11Enyi3Ebd
;

671 
pAd
->
SCfg
.
PaCh
 = 
Ndis802_11Enyi3Ebd
;

672 
pAd
->
SCfg
.
GroupCh
 = 
Ndis802_11Enyi3Ebd
;

675  
FALSE
;

677 i(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
)

680 
	`RTMPSPhyMode
(
pAd
,Ad->
CommCfg
.
DesedPhyMode
);

681 #ifde
DOT11_N_SUPPORT


682 
	`SCommHT
(
pAd
);

686 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_EnypTy_Proc::(EnypTy=%d)\n", 
pAd
->
SCfg
.
WStus
));

688  
TRUE
;

689 
	}
}

699 
INT
 
	$S_DeuKeyID_Proc
(

700 
IN
 
PRTMP_ADAPTER
 
pAdr
,

701 
IN
 
PSTRING
 
g
)

703 
ULONG
 
KeyIdx
;

705 
KeyIdx
 = 
	`sime_
(
g
, 0, 10);

706 if((
KeyIdx
 >= 1 ) && (KeyIdx <= 4))

707 
pAdr
->
SCfg
.
DeuKeyId
 = (
UCHAR
(
KeyIdx
 - 1 );

709  
FALSE
;

711 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_DeuKeyID_Proc::(DeuKeyID=%d)\n", 
pAdr
->
SCfg
.
DeuKeyId
));

713  
TRUE
;

714 
	}
}

724 
INT
 
	$S_Key1_Proc
(

725 
IN
 
PRTMP_ADAPTER
 
pAdr
,

726 
IN
 
PSTRING
 
g
)

728 
KeyL
;

729 
i
;

730 
UCHAR
 
ChAlg
=
CIPHER_WEP64
;

732 i(
pAdr
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

733  
TRUE
;

735 
KeyL
 = 
	`
(
g
);

737 
KeyL
)

740 
pAdr
->
ShedKey
[
BSS0
][0].
KeyL
 = KeyLen;

741 
	`memy
(
pAdr
->
ShedKey
[
BSS0
][0].
Key
, 
g
, 
KeyL
);

742 
ChAlg
 = 
CIPHER_WEP64
;

743 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key1_Proc::(Key1=%dy=%s)\n", 
g
, "Ascii"));

746 
i
=0; i < 
KeyL
; i++)

748 if!
	`isxdig
(*(
g
+
i
)) )

749  
FALSE
;

751 
pAdr
->
ShedKey
[
BSS0
][0].
KeyL
 = KeyLen / 2 ;

752 
	`AtoH
(
g
, 
pAdr
->
ShedKey
[
BSS0
][0].
Key
, 
KeyL
 / 2);

753 
ChAlg
 = 
CIPHER_WEP64
;

754 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key1_Proc::(Key1=%dy=%s)\n", 
g
, "Hex"));

757 
pAdr
->
ShedKey
[
BSS0
][0].
KeyL
 = KeyLen;

758 
	`memy
(
pAdr
->
ShedKey
[
BSS0
][0].
Key
, 
g
, 
KeyL
);

759 
ChAlg
 = 
CIPHER_WEP128
;

760 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key1_Proc::(Key1=%dy=%s)\n", 
g
, "Ascii"));

763 
i
=0; i < 
KeyL
; i++)

765 if!
	`isxdig
(*(
g
+
i
)) )

766  
FALSE
;

768 
pAdr
->
ShedKey
[
BSS0
][0].
KeyL
 = KeyLen / 2 ;

769 
	`AtoH
(
g
, 
pAdr
->
ShedKey
[
BSS0
][0].
Key
, 
KeyL
 / 2);

770 
ChAlg
 = 
CIPHER_WEP128
;

771 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key1_Proc::(Key1=%dy=%s)\n", 
g
, "Hex"));

774 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key1_Proc::Invidrgum(=%s)\n", 
g
));

775  
FALSE
;

778 
pAdr
->
ShedKey
[
BSS0
][0].
ChAlg
 = CipherAlg;

781 i(
pAdr
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

785 
	`AsicAddShedKeyEry
(
pAdr
,

788 &
pAdr
->
ShedKey
[
BSS0
][0]);

791  
TRUE
;

792 
	}
}

802 
INT
 
	$S_Key2_Proc
(

803 
IN
 
PRTMP_ADAPTER
 
pAdr
,

804 
IN
 
PSTRING
 
g
)

806 
KeyL
;

807 
i
;

808 
UCHAR
 
ChAlg
=
CIPHER_WEP64
;

810 i(
pAdr
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

811  
TRUE
;

813 
KeyL
 = 
	`
(
g
);

815 
KeyL
)

818 
pAdr
->
ShedKey
[
BSS0
][1].
KeyL
 = KeyLen;

819 
	`memy
(
pAdr
->
ShedKey
[
BSS0
][1].
Key
, 
g
, 
KeyL
);

820 
ChAlg
 = 
CIPHER_WEP64
;

821 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key2_Proc::(Key2=%dy=%s)\n", 
g
, "Ascii"));

824 
i
=0; i < 
KeyL
; i++)

826 if!
	`isxdig
(*(
g
+
i
)) )

827  
FALSE
;

829 
pAdr
->
ShedKey
[
BSS0
][1].
KeyL
 = KeyLen / 2 ;

830 
	`AtoH
(
g
, 
pAdr
->
ShedKey
[
BSS0
][1].
Key
, 
KeyL
 / 2);

831 
ChAlg
 = 
CIPHER_WEP64
;

832 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key2_Proc::(Key2=%dy=%s)\n", 
g
, "Hex"));

835 
pAdr
->
ShedKey
[
BSS0
][1].
KeyL
 = KeyLen;

836 
	`memy
(
pAdr
->
ShedKey
[
BSS0
][1].
Key
, 
g
, 
KeyL
);

837 
ChAlg
 = 
CIPHER_WEP128
;

838 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key2_Proc::(Key2=%dy=%s)\n", 
g
, "Ascii"));

841 
i
=0; i < 
KeyL
; i++)

843 if!
	`isxdig
(*(
g
+
i
)) )

844  
FALSE
;

846 
pAdr
->
ShedKey
[
BSS0
][1].
KeyL
 = KeyLen / 2 ;

847 
	`AtoH
(
g
, 
pAdr
->
ShedKey
[
BSS0
][1].
Key
, 
KeyL
 / 2);

848 
ChAlg
 = 
CIPHER_WEP128
;

849 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key2_Proc::(Key2=%dy=%s)\n", 
g
, "Hex"));

852 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key2_Proc::Invidrgum(=%s)\n", 
g
));

853  
FALSE
;

855 
pAdr
->
ShedKey
[
BSS0
][1].
ChAlg
 = CipherAlg;

858 i(
pAdr
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

862 
	`AsicAddShedKeyEry
(
pAdr
,

865 &
pAdr
->
ShedKey
[
BSS0
][1]);

868  
TRUE
;

869 
	}
}

878 
INT
 
	$S_Key3_Proc
(

879 
IN
 
PRTMP_ADAPTER
 
pAdr
,

880 
IN
 
PSTRING
 
g
)

882 
KeyL
;

883 
i
;

884 
UCHAR
 
ChAlg
=
CIPHER_WEP64
;

886 i(
pAdr
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

887  
TRUE
;

889 
KeyL
 = 
	`
(
g
);

891 
KeyL
)

894 
pAdr
->
ShedKey
[
BSS0
][2].
KeyL
 = KeyLen;

895 
	`memy
(
pAdr
->
ShedKey
[
BSS0
][2].
Key
, 
g
, 
KeyL
);

896 
ChAlg
 = 
CIPHER_WEP64
;

897 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key3_Proc::(Key3=%dy=Ascii)\n", 
g
));

900 
i
=0; i < 
KeyL
; i++)

902 if!
	`isxdig
(*(
g
+
i
)) )

903  
FALSE
;

905 
pAdr
->
ShedKey
[
BSS0
][2].
KeyL
 = KeyLen / 2 ;

906 
	`AtoH
(
g
, 
pAdr
->
ShedKey
[
BSS0
][2].
Key
, 
KeyL
 / 2);

907 
ChAlg
 = 
CIPHER_WEP64
;

908 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key3_Proc::(Key3=%dy=Hex)\n", 
g
));

911 
pAdr
->
ShedKey
[
BSS0
][2].
KeyL
 = KeyLen;

912 
	`memy
(
pAdr
->
ShedKey
[
BSS0
][2].
Key
, 
g
, 
KeyL
);

913 
ChAlg
 = 
CIPHER_WEP128
;

914 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key3_Proc::(Key3=%dy=Ascii)\n", 
g
));

917 
i
=0; i < 
KeyL
; i++)

919 if!
	`isxdig
(*(
g
+
i
)) )

920  
FALSE
;

922 
pAdr
->
ShedKey
[
BSS0
][2].
KeyL
 = KeyLen / 2 ;

923 
	`AtoH
(
g
, 
pAdr
->
ShedKey
[
BSS0
][2].
Key
, 
KeyL
 / 2);

924 
ChAlg
 = 
CIPHER_WEP128
;

925 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key3_Proc::(Key3=%dy=Hex)\n", 
g
));

928 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key3_Proc::Invidrgum(=%s)\n", 
g
));

929  
FALSE
;

931 
pAdr
->
ShedKey
[
BSS0
][2].
ChAlg
 = CipherAlg;

934 i(
pAdr
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

938 
	`AsicAddShedKeyEry
(
pAdr
,

941 &
pAdr
->
ShedKey
[
BSS0
][2]);

944  
TRUE
;

945 
	}
}

954 
INT
 
	$S_Key4_Proc
(

955 
IN
 
PRTMP_ADAPTER
 
pAdr
,

956 
IN
 
PSTRING
 
g
)

958 
KeyL
;

959 
i
;

960 
UCHAR
 
ChAlg
=
CIPHER_WEP64
;

962 i(
pAdr
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

963  
TRUE
;

965 
KeyL
 = 
	`
(
g
);

967 
KeyL
)

970 
pAdr
->
ShedKey
[
BSS0
][3].
KeyL
 = KeyLen;

971 
	`memy
(
pAdr
->
ShedKey
[
BSS0
][3].
Key
, 
g
, 
KeyL
);

972 
ChAlg
 = 
CIPHER_WEP64
;

973 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key4_Proc::(Key4=%dy=%s)\n", 
g
, "Ascii"));

976 
i
=0; i < 
KeyL
; i++)

978 if!
	`isxdig
(*(
g
+
i
)) )

979  
FALSE
;

981 
pAdr
->
ShedKey
[
BSS0
][3].
KeyL
 = KeyLen / 2 ;

982 
	`AtoH
(
g
, 
pAdr
->
ShedKey
[
BSS0
][3].
Key
, 
KeyL
 / 2);

983 
ChAlg
 = 
CIPHER_WEP64
;

984 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key4_Proc::(Key4=%dy=%s)\n", 
g
, "Hex"));

987 
pAdr
->
ShedKey
[
BSS0
][3].
KeyL
 = KeyLen;

988 
	`memy
(
pAdr
->
ShedKey
[
BSS0
][3].
Key
, 
g
, 
KeyL
);

989 
ChAlg
 = 
CIPHER_WEP128
;

990 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key4_Proc::(Key4=%dy=%s)\n", 
g
, "Ascii"));

993 
i
=0; i < 
KeyL
; i++)

995 if!
	`isxdig
(*(
g
+
i
)) )

996  
FALSE
;

998 
pAdr
->
ShedKey
[
BSS0
][3].
KeyL
 = KeyLen / 2 ;

999 
	`AtoH
(
g
, 
pAdr
->
ShedKey
[
BSS0
][3].
Key
, 
KeyL
 / 2);

1000 
ChAlg
 = 
CIPHER_WEP128
;

1001 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key4_Proc::(Key4=%dy=%s)\n", 
g
, "Hex"));

1004 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Key4_Proc::Invidrgum(=%s)\n", 
g
));

1005  
FALSE
;

1007 
pAdr
->
ShedKey
[
BSS0
][3].
ChAlg
 = CipherAlg;

1010 i(
pAdr
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

1014 
	`AsicAddShedKeyEry
(
pAdr
,

1017 &
pAdr
->
ShedKey
[
BSS0
][3]);

1020  
TRUE
;

1021 
	}
}

1031 
INT
 
	$S_WPAPSK_Proc
(

1032 
IN
 
PRTMP_ADAPTER
 
pAd
,

1033 
IN
 
PSTRING
 
g
)

1035 
us
;

1037 i((
pAd
->
SCfg
.
AuthMode
 !
Ndis802_11AuthModeWPAPSK
) &&

1038 (
pAd
->
SCfg
.
AuthMode
 !
Ndis802_11AuthModeWPA2PSK
) &&

1039 (
pAd
->
SCfg
.
AuthMode
 !
Ndis802_11AuthModeWPANe
)

1041  
TRUE
;

1043 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_WPAPSK_Proc::(WPAPSK=%s)\n", 
g
));

1045 
us
 = 
	`RT_CfgSWPAPSKKey
(
pAd
, 
g
,Ad->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
,Ad->
SCfg
.
PMK
);

1046 i(
us
 =
FALSE
)

1048 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set_WPAPSK_Proc(): Set key failed!\n"));

1049  
FALSE
;

1051 
	`NdisZoMemy
(
pAd
->
SCfg
.
WPassPh
, 64);

1052 
	`NdisMoveMemy
(
pAd
->
SCfg
.
WPassPh
, 
g
, 
	`
(arg));

1053 
pAd
->
SCfg
.
WPassPhL
 = (
UINT
)
	`
(
g
);

1057 if(
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
 &&

1058 
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPANe
)

1060 
pAd
->
SCfg
.
WS
 = 
SS_NOTUSE
;

1065 
pAd
->
SCfg
.
WS
 = 
SS_START
;

1068  
TRUE
;

1069 
	}
}

1079 
INT
 
	$S_PSMode_Proc
(

1080 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1081 
IN
 
PSTRING
 
g
)

1083 i(
pAdr
->
SCfg
.
BssTy
 =
BSS_INFRA
)

1085 i((
	`rcmp
(
g
, "Max_PSP") == 0) ||

1086 (
	`rcmp
(
g
, "max_psp") == 0) ||

1087 (
	`rcmp
(
g
, "MAX_PSP") == 0))

1091 i(
pAdr
->
SCfg
.
bWdowsACCAMEb
 =
FALSE
)

1092 
pAdr
->
SCfg
.
WdowsPowMode
 = 
Ndis802_11PowModeMAX_PSP
;

1093 
pAdr
->
SCfg
.
WdowsBryPowMode
 = 
Ndis802_11PowModeMAX_PSP
;

1094 
	`OPSTATUS_SET_FLAG
(
pAdr
, 
fOP_STATUS_RECEIVE_DTIM
);

1095 
pAdr
->
SCfg
.
DeuLiCou
 = 5;

1098 i((
	`rcmp
(
g
, "Fast_PSP") == 0) ||

1099 (
	`rcmp
(
g
, "fast_psp") == 0) ||

1100 (
	`rcmp
(
g
, "FAST_PSP") == 0))

1104 
	`OPSTATUS_SET_FLAG
(
pAdr
, 
fOP_STATUS_RECEIVE_DTIM
);

1105 i(
pAdr
->
SCfg
.
bWdowsACCAMEb
 =
FALSE
)

1106 
pAdr
->
SCfg
.
WdowsPowMode
 = 
Ndis802_11PowModeFa_PSP
;

1107 
pAdr
->
SCfg
.
WdowsBryPowMode
 = 
Ndis802_11PowModeFa_PSP
;

1108 
pAdr
->
SCfg
.
DeuLiCou
 = 3;

1110 i((
	`rcmp
(
g
, "Legacy_PSP") == 0) ||

1111 (
	`rcmp
(
g
, "legacy_psp") == 0) ||

1112 (
	`rcmp
(
g
, "LEGACY_PSP") == 0))

1116 
	`OPSTATUS_SET_FLAG
(
pAdr
, 
fOP_STATUS_RECEIVE_DTIM
);

1117 i(
pAdr
->
SCfg
.
bWdowsACCAMEb
 =
FALSE
)

1118 
pAdr
->
SCfg
.
WdowsPowMode
 = 
Ndis802_11PowModeLegacy_PSP
;

1119 
pAdr
->
SCfg
.
WdowsBryPowMode
 = 
Ndis802_11PowModeLegacy_PSP
;

1120 
pAdr
->
SCfg
.
DeuLiCou
 = 3;

1126 
	`RTMP_SET_PSM_BIT
(
pAdr
, 
PWR_ACTIVE
);

1127 
	`OPSTATUS_SET_FLAG
(
pAdr
, 
fOP_STATUS_RECEIVE_DTIM
);

1128 i(
pAdr
->
SCfg
.
bWdowsACCAMEb
 =
FALSE
)

1129 
pAdr
->
SCfg
.
WdowsPowMode
 = 
Ndis802_11PowModeCAM
;

1130 
pAdr
->
SCfg
.
WdowsBryPowMode
 = 
Ndis802_11PowModeCAM
;

1134 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_PSMode_Proc::(PSMode=%ld)\n", 
pAdr
->
SCfg
.
WdowsPowMode
));

1137  
FALSE
;

1140  
TRUE
;

1141 
	}
}

1143 #ifde
WPA_SUPPLICANT_SUPPORT


1156 
INT
 
	$S_W_Sut
(

1157 
IN
 
PRTMP_ADAPTER
 
pAd
,

1158 
IN
 
PSTRING
 
g
)

1161 i
	`sime_
(
g
, 0, 10) == 0)

1162 
pAd
->
SCfg
.
WSuliUP
 = 
WPA_SUPPLICANT_DISABLE
;

1163 i
	`sime_
(
g
, 0, 10) == 1)

1164 
pAd
->
SCfg
.
WSuliUP
 = 
WPA_SUPPLICANT_ENABLE
;

1165 i
	`sime_
(
g
, 0, 10) == 2)

1166 
pAd
->
SCfg
.
WSuliUP
 = 
WPA_SUPPLICANT_ENABLE_WITH_WEB_UI
;

1168 
pAd
->
SCfg
.
WSuliUP
 = 
WPA_SUPPLICANT_DISABLE
;

1170 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_W_Sut::(WSuliUP=%d)\n", 
pAd
->
SCfg
.
WSuliUP
));

1172  
TRUE
;

1173 
	}
}

1179 
INT
 
	$S_TGnWifiTe_Proc
(

1180 
IN
 
PRTMP_ADAPTER
 
pAd
,

1181 
IN
 
PSTRING
 
g
)

1183 i(
	`sime_
(
g
, 0, 10) == 0)

1184 
pAd
->
SCfg
.
bTGnWifiTe
 = 
FALSE
;

1186 
pAd
->
SCfg
.
bTGnWifiTe
 = 
TRUE
;

1188 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IF S_TGnWifiTe_Proc::(bTGnWifiTe=%d)\n", 
pAd
->
SCfg
.
bTGnWifiTe
));

1189  
TRUE
;

1190 
	}
}

1192 #ifde
EXT_BUILD_CHANNEL_LIST


1193 
INT
 
	$S_Ie80211dClMode_Proc
(

1194 
IN
 
PRTMP_ADAPTER
 
pAdr
,

1195 
IN
 
PSTRING
 
g
)

1197 i(
	`sime_
(
g
, 0, 10) == 0)

1198 
pAdr
->
SCfg
.
IEEE80211dClMode
 = 
Rt802_11_D_Ne
;

1199 i(
	`sime_
(
g
, 0, 10) == 1)

1200 
pAdr
->
SCfg
.
IEEE80211dClMode
 = 
Rt802_11_D_Fxib
;

1201 i(
	`sime_
(
g
, 0, 10) == 2)

1202 
pAdr
->
SCfg
.
IEEE80211dClMode
 = 
Rt802_11_D_Si
;

1204  
FALSE
;

1206 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("S_Ie802dMode_Proc::(IEEEE0211dMode=%d)\n", 
pAdr
->
SCfg
.
IEEE80211dClMode
));

1207  
TRUE
;

1208 
	}
}

1211 #ifde
CARRIER_DETECTION_SUPPORT


1212 
INT
 
	$S_CrrDe_Proc
(

1213 
IN
 
PRTMP_ADAPTER
 
pAd
,

1214 
IN
 
PSTRING
 
g
)

1216 i(
	`sime_
(
g
, 0, 10) == 0)

1217 
pAd
->
CommCfg
.
CrrDe
.
Eb
 = 
FALSE
;

1219 
pAd
->
CommCfg
.
CrrDe
.
Eb
 = 
TRUE
;

1221 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IF S_CrrDe_Proc::(CrrDe.Eb=%d)\n", 
pAd
->
CommCfg
.
CrrDe
.
Eb
));

1222  
TRUE
;

1223 
	}
}

1227 
INT
 
	$Show_Adhoc_MacTab_Proc
(

1228 
IN
 
PRTMP_ADAPTER
 
pAd
,

1229 
IN
 
PSTRING
 
exa
)

1231 
INT
 
i
;

1233 
	`rtf
(
exa
, "\n");

1235 #ifde
DOT11_N_SUPPORT


1236 
	`rtf
(
exa
, "%sHT Otg Mod: %d\n",xa, 
pAd
->
CommCfg
.
AddHTInfo
.
AddHtInfo2
.
OiMode
);

1239 
	`rtf
(
exa
 + 
	`
(extra), "\n%-19s%-4s%-4s%-7s%-7s%-7s%-10s%-6s%-6s%-6s%-6s\n",

1242 
i
=1; i<
MAX_LEN_OF_MAC_TABLE
; i++)

1244 
PMAC_TABLE_ENTRY
 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
i
];

1246 i(
	`
(
exa
> (
IW_PRIV_SIZE_MASK
 - 30))

1248 i((
	`IS_ENTRY_CLIENT
(
pEry
|| 
	`IS_ENTRY_APCLI
Ery)&& (pEry->
S
 =
SST_ASSOC
))

1250 
	`rtf
(
exa
 + 
	`
(extra), "%02X:%02X:%02X:%02X:%02X:%02X ",

1251 
pEry
->
Addr
[0],Entry->Addr[1],Entry->Addr[2],

1252 
pEry
->
Addr
[3],Entry->Addr[4],Entry->Addr[5]);

1253 
	`rtf
(
exa
 + 
	`
xa), "%-4d", ()
pEry
->
Aid
);

1254 
	`rtf
(
exa
 + 
	`
xa), "%-4d", ()
pEry
->
idx
);

1255 
	`rtf
(
exa
 + 
	`
xa), "%-7d", 
pEry
->
RssiSame
.
AvgRssi0
);

1256 
	`rtf
(
exa
 + 
	`
xa), "%-7d", 
pEry
->
RssiSame
.
AvgRssi1
);

1257 
	`rtf
(
exa
 + 
	`
xa), "%-7d", 
pEry
->
RssiSame
.
AvgRssi2
);

1258 
	`rtf
(
exa
 + 
	`
xa), "%-10s", 
	`GPhyMode
(
pEry
->
HTPhyMode
.
fld
.
MODE
));

1259 
	`rtf
(
exa
 + 
	`
xa), "%-6s", 
	`GBW
(
pEry
->
HTPhyMode
.
fld
.
BW
));

1260 
	`rtf
(
exa
 + 
	`
xa), "%-6d", 
pEry
->
HTPhyMode
.
fld
.
MCS
);

1261 
	`rtf
(
exa
 + 
	`
xa), "%-6d", 
pEry
->
HTPhyMode
.
fld
.
ShtGI
);

1262 
	`rtf
(
exa
 + 
	`
xa), "%-6d", 
pEry
->
HTPhyMode
.
fld
.
STBC
);

1263 
	`rtf
(
exa
 + 
	`
xa), "%-10d, %d, %d%%\n", 
pEry
->
DebugFIFOCou
,Ery->
DebugTxCou
,

1264 (
pEry
->
DebugTxCou
? (Ery->DebugTxCou-pEry->
DebugFIFOCou
)*100/pEntry->DebugTxCount) : 0);

1265 
	`rtf
(
exa
 + 
	`
(extra), "\n");

1269  
TRUE
;

1270 
	}
}

1273 
INT
 
	$S_BcLoTime_Proc
(

1274 
IN
 
PRTMP_ADAPTER
 
pAd
,

1275 
IN
 
PSTRING
 
g
)

1277 
ULONG
 
mp
 = (ULONG)
	`sime_
(
g
, 0, 10);

1279 i((
mp
 != 0) && (ltmp <= 60))

1280 
pAd
->
SCfg
.
BcLoTime
 = (
mp
 * 
OS_HZ
);

1282 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IF S_BcLoTime_Proc::(BcLoTime=%ld)\n", 
pAd
->
SCfg
.
BcLoTime
));

1283  
TRUE
;

1284 
	}
}

1286 
INT
 
	$S_AutoRmg_Proc
(

1287 
IN
 
PRTMP_ADAPTER
 
pAd
,

1288 
IN
 
PSTRING
 
g
)

1290 i(
	`sime_
(
g
, 0, 10) == 0)

1291 
pAd
->
SCfg
.
bAutoRmg
 = 
FALSE
;

1293 
pAd
->
SCfg
.
bAutoRmg
 = 
TRUE
;

1295 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IF S_AutoRmg_Proc::(bAutoRmg=%d)\n", 
pAd
->
SCfg
.
bAutoRmg
));

1296  
TRUE
;

1297 
	}
}

1316 
INT
 
	$S_SeSurvey_Proc
(

1317 
IN
 
PRTMP_ADAPTER
 
pAd
,

1318 
IN
 
PSTRING
 
g
)

1320 
NDIS_802_11_SSID
 
Ssid
;

1323 i(!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_INTERRUPT_IN_USE
))

1325 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("INFO::Network is down!\n"));

1326  -
ENETDOWN
;

1329 i(
	`MONITOR_ON
(
pAd
))

1331 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! Driver is in Monitor Modeow !!!\n"));

1332  -
EINVAL
;

1335 
	`RTMPZoMemy
(&
Ssid
, (
NDIS_802_11_SSID
));

1336 
Ssid
.
SsidLgth
 = 0;

1337 i((
g
 !
NULL
) &&

1338 (
	`
(
g
<
MAX_LEN_OF_SSID
))

1340 
	`RTMPMoveMemy
(
Ssid
.Ssid, 
g
, 
	`
(arg));

1341 
Ssid
.
SsidLgth
 = 
	`
(
g
);

1344 
pAd
->
SCfg
.
bSnReqIsFromWebUI
 = 
TRUE
;

1346 
	`SSeSurvey
(
pAd
, &
Ssid
, 
SCAN_ACTIVE
);

1347 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("Set_SiteSurvey_Proc\n"));

1349  
TRUE
;

1350 
	}
}

1352 
INT
 
	$S_FTxBur_Proc
(

1353 
IN
 
PRTMP_ADAPTER
 
pAd
,

1354 
IN
 
PSTRING
 
g
)

1356 i(
	`sime_
(
g
, 0, 10) == 0)

1357 
pAd
->
SCfg
.
bFTxBur
 = 
FALSE
;

1359 
pAd
->
SCfg
.
bFTxBur
 = 
TRUE
;

1361 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IF S_FTxBur_Proc::(bFTxBur=%d)\n", 
pAd
->
SCfg
.
bFTxBur
));

1362  
TRUE
;

1363 
	}
}

1366 #ifde
XLINK_SUPPORT


1367 
INT
 
	$S_XlkMode_Proc
(

1368 
IN
 
PRTMP_ADAPTER
 
pAd
,

1369 
IN
 
PSTRING
 
g
)

1371 
UINT32
 
Vue
 = 0;

1373 i(
	`sime_
(
g
, 0, 10) == 0)

1374 
pAd
->
SCfg
.
PSPXlk
 = 0;

1376 
pAd
->
SCfg
.
PSPXlk
 = 1;

1378 i(
pAd
->
SCfg
.
PSPXlk
)

1379 
Vue
 = 
PSPXLINK
;

1381 
Vue
 = 
STANORMAL
;

1382 
	`RTMP_IO_WRITE32
(
pAd
, 
RX_FILTR_CFG
, 
Vue
);

1383 
Vue
 = 0;

1384 
	`RTMP_IO_READ32
(
pAd
, 
MAC_SYS_CTRL
, &
Vue
);

1385 
Vue
 &= (~0x80);

1386 
	`RTMP_IO_WRITE32
(
pAd
, 
MAC_SYS_CTRL
, 
Vue
);

1388 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IF S_XlkMode_Proc::(PSPXlk=%d)\n", 
pAd
->
SCfg
.
PSPXlk
));

1389  
TRUE
;

1390 
	}
}

1394 
VOID
 
	$RTMPAddKey
(

1395 
IN
 
PRTMP_ADAPTER
 
pAd
,

1396 
IN
 
PNDIS_802_11_KEY
 
pKey
)

1398 
ULONG
 
KeyIdx
;

1399 
MAC_TABLE_ENTRY
 *
pEry
;

1401 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPAddKey ------>\n"));

1403 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA
)

1405 i(
pKey
->
KeyIndex
 & 0x80000000)

1407 i(
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPANe
)

1409 
	`NdisZoMemy
(
pAd
->
SCfg
.
PMK
, 32);

1410 
	`NdisMoveMemy
(
pAd
->
SCfg
.
PMK
, 
pKey
->
KeyMl
,Key->
KeyLgth
);

1411 
d
;

1414 
	`NdisZoMemy
(&
pAd
->
ShedKey
[
BSS0
][0], (
CIPHER_KEY
));

1415 
pAd
->
ShedKey
[
BSS0
][0].
KeyL
 = 
LEN_TK
;

1416 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][0].
Key
, 
pKey
->
KeyMl
, 
LEN_TK
);

1417 #ifde
WPA_SUPPLICANT_SUPPORT


1418 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi2Ebd
)

1420 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][0].
RxMic
, 
pKey
->
KeyMl
 + 
LEN_TK
, 
LEN_TKIP_MIC
);

1421 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][0].
TxMic
, 
pKey
->
KeyMl
 + 
LEN_TK
 + 
LEN_TKIP_MIC
, LEN_TKIP_MIC);

1426 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][0].
TxMic
, 
pKey
->
KeyMl
 + 
LEN_TK
, 
LEN_TKIP_MIC
);

1427 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][0].
RxMic
, 
pKey
->
KeyMl
 + 
LEN_TK
 + 
LEN_TKIP_MIC
, LEN_TKIP_MIC);

1431 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi2Ebd
)

1432 
pAd
->
ShedKey
[
BSS0
][0].
ChAlg
 = 
CIPHER_TKIP
;

1433 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi3Ebd
)

1434 
pAd
->
ShedKey
[
BSS0
][0].
ChAlg
 = 
CIPHER_AES
;

1436 
pAd
->
ShedKey
[
BSS0
][0].
ChAlg
 = 
CIPHER_NONE
;

1439 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
];

1440 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
Key
, 
pAd
->
ShedKey
[
BSS0
][0].Key, 
LEN_TK
);

1441 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
RxMic
, 
pAd
->
ShedKey
[
BSS0
][0].RxMic, 
LEN_TKIP_MIC
);

1442 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
TxMic
, 
pAd
->
ShedKey
[
BSS0
][0].TxMic, 
LEN_TKIP_MIC
);

1443 
pEry
->
PawiKey
.
ChAlg
 = 
pAd
->
ShedKey
[
BSS0
][0].CipherAlg;

1446 
	`AsicAddShedKeyEry
(
pAd
,

1447 
BSS0
,

1449 &
pAd
->
ShedKey
[
BSS0
][0]);

1452 
	`RTMPSWcidSecuryInfo
(
pAd
,

1453 
BSS0
,

1455 
pAd
->
ShedKey
[
BSS0
][0].
ChAlg
,

1456 
BSSID_WCID
,

1457 
SHAREDKEYTABLE
);

1459 i(
pAd
->
SCfg
.
AuthMode
 >
Ndis802_11AuthModeWPA2
)

1462 
	`STA_PORT_SECURED
(
pAd
);

1468 
pAd
->
SCfg
.
DeuKeyId
 = (
pKey
->
KeyIndex
 & 0xFF);

1469 
	`NdisZoMemy
(&
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
], (
CIPHER_KEY
));

1470 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
KeyL
 = 
LEN_TK
;

1471 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
Key
, 
pKey
->
KeyMl
, 
LEN_TK
);

1472 #ifde
WPA_SUPPLICANT_SUPPORT


1473 i(
pAd
->
SCfg
.
GroupCh
 =
Ndis802_11Enyi2Ebd
)

1475 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
RxMic
, 
pKey
->
KeyMl
 + 
LEN_TK
, 
LEN_TKIP_MIC
);

1476 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
TxMic
, 
pKey
->
KeyMl
 + 
LEN_TK
 + 
LEN_TKIP_MIC
, LEN_TKIP_MIC);

1481 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
TxMic
, 
pKey
->
KeyMl
 + 
LEN_TK
, 
LEN_TKIP_MIC
);

1482 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
RxMic
, 
pKey
->
KeyMl
 + 
LEN_TK
 + 
LEN_TKIP_MIC
, LEN_TKIP_MIC);

1486 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
ChAlg
 = 
CIPHER_NONE
;

1487 i(
pAd
->
SCfg
.
GroupCh
 =
Ndis802_11Enyi2Ebd
)

1488 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
ChAlg
 = 
CIPHER_TKIP
;

1489 i(
pAd
->
SCfg
.
GroupCh
 =
Ndis802_11Enyi3Ebd
)

1490 
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
].
ChAlg
 = 
CIPHER_AES
;

1493 
	`AsicAddShedKeyEry
(
pAd
,

1494 
BSS0
,

1495 
pAd
->
SCfg
.
DeuKeyId
,

1496 &
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
]);

1501 
	`STA_PORT_SECURED
(
pAd
);

1506 
UCHAR
 
ChAlg
;

1507 
PUCHAR
 
Key
;

1509 if(
pKey
->
KeyLgth
 == 32)

1510 
d
;

1512 
KeyIdx
 = 
pKey
->
KeyIndex
 & 0x0fffffff;

1514 i(
KeyIdx
 < 4)

1517 i(
pKey
->
KeyIndex
 & 0x80000000)

1519 
pEry
 = 
	`MacTabLookup
(
pAd
, 
pKey
->
BSSID
);

1521 i(
pEry
)

1523 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPAddKey: Set Pair-wise Key\n"));

1526 
pEry
->
PawiKey
.
KeyL
 = (
UCHAR
)
pKey
->
KeyLgth
;

1527 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
Key
, &
pKey
->
KeyMl
,Key->
KeyLgth
);

1530 i(
pKey
->
KeyLgth
 == 5)

1531 
pEry
->
PawiKey
.
ChAlg
 = 
CIPHER_WEP64
;

1533 
pEry
->
PawiKey
.
ChAlg
 = 
CIPHER_WEP128
;

1536 
	`AsicAddPawiKeyEry
(

1537 
pAd
,

1538 (
UCHAR
)
pEry
->
Aid
,

1539 &
pEry
->
PawiKey
);

1542 
	`RTMPSWcidSecuryInfo
(
pAd
,

1543 
BSS0
,

1544 
KeyIdx
,

1545 
pEry
->
PawiKey
.
ChAlg
,

1546 
pEry
->
Aid
,

1547 
PAIRWISEKEYTABLE
);

1553 
pAd
->
SCfg
.
DeuKeyId
 = (
UCHAR

KeyIdx
;

1556 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
KeyL
 = (
UCHAR

pKey
->
KeyLgth
;

1557 
	`NdisMoveMemy
(
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
Key
, &
pKey
->
KeyMl
,Key->
KeyLgth
);

1560 i(
pKey
->
KeyLgth
 == 5)

1561 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
ChAlg
 = 
CIPHER_WEP64
;

1563 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].
ChAlg
 = 
CIPHER_WEP128
;

1565 
ChAlg
 = 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].CipherAlg;

1566 
Key
 = 
pAd
->
ShedKey
[
BSS0
][
KeyIdx
].Key;

1569 
	`AsicAddShedKeyEry
(
pAd
, 
BSS0
, 
KeyIdx
, &pAd->
ShedKey
[BSS0][KeyIdx]);

1575 
d
:

1577 
	}
}

1589 
VOID
 
	$SSeSurvey
(

1590 
IN
 
PRTMP_ADAPTER
 
pAd
,

1591 
IN
 
PNDIS_802_11_SSID
 
pSsid
,

1592 
IN
 
UCHAR
 
SnTy
)

1594 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

1599 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("StaSiteSurvey:: Scanningow\n"));

1602 i(
	`INFRA_ON
(
pAd
))

1604 
pAd
->
SCfg
.
bImovedSn
 = 
TRUE
;

1605 
pAd
->
SCfg
.
SnChlC
 = 0;

1609 i(
pAd
->
Mlme
.
ClMache
.
CuS
 !
CNTL_IDLE
)

1611 
	`RTMP_MLME_RESET_STATE_MACHINE
(
pAd
);

1612 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! MLME busy,eset MLME state machine !!!\n"));

1615 
	`NdisGSyemUpTime
(&
pAd
->
SCfg
.
LaSnTime
);

1616 i(
pSsid
)

1617 
	`MlmeEnqueue
(
pAd
,

1618 
MLME_CNTL_STATE_MACHINE
,

1619 
OID_802_11_BSSID_LIST_SCAN
,

1620 
pSsid
->
SsidLgth
,

1621 
pSsid
->
Ssid
,

1624 
	`MlmeEnqueue
(
pAd
,

1625 
MLME_CNTL_STATE_MACHINE
,

1626 
OID_802_11_BSSID_LIST_SCAN
,

1631 
	`RTMP_MLME_HANDLER
(
pAd
);

1632 
	}
}

1634 
INT
 
	$S_AutoRec_Proc
(

1635 
IN
 
PRTMP_ADAPTER
 
pAd
,

1636 
IN
 
PSTRING
 
g
)

1638 i(
	`sime_
(
g
, 0, 10) == 0)

1639 
pAd
->
SCfg
.
bAutoRec
 = 
FALSE
;

1641 
pAd
->
SCfg
.
bAutoRec
 = 
TRUE
;

1643 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IF S_AutoRec_Proc::(bAdhocN=%d)\n", 
pAd
->
SCfg
.
bAutoRec
));

1644  
TRUE
;

1645 
	}
}

1647 
INT
 
	$S_AdhocN_Proc
(

1648 
IN
 
PRTMP_ADAPTER
 
pAd
,

1649 
IN
 
PSTRING
 
g
)

1651 i(
	`sime_
(
g
, 0, 10) == 0)

1652 
pAd
->
SCfg
.
bAdhocN
 = 
FALSE
;

1654 
pAd
->
SCfg
.
bAdhocN
 = 
TRUE
;

1656 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("IF S_AdhocN_Proc::(bAdhocN=%d)\n", 
pAd
->
SCfg
.
bAdhocN
));

1657  
TRUE
;

1658 
	}
}

	@sta/sync.c

38 
	~"_cfig.h
"

41 
	#ADHOC_ENTRY_BEACON_LOST_TIME
 (2*
OS_HZ
)

42 

	)

54 
VOID
 
	$SyncSMacheIn
(

55 
IN
 
PRTMP_ADAPTER
 
pAd
,

56 
IN
 
STATE_MACHINE
 *
Sm
,

57 
OUT
 
STATE_MACHINE_FUNC
 
Tns
[])

59 
	`SMacheIn
(
Sm
, 
Tns
, 
MAX_SYNC_STATE
, 
MAX_SYNC_MSG
, (
STATE_MACHINE_FUNC
)
Dr
, 
SYNC_IDLE
, 
SYNC_MACHINE_BASE
);

62 
	`SMacheSAi
(
Sm
, 
SYNC_IDLE
, 
MT2_MLME_SCAN_REQ
, (
STATE_MACHINE_FUNC
)
MlmeSnReqAi
);

63 
	`SMacheSAi
(
Sm
, 
SYNC_IDLE
, 
MT2_MLME_JOIN_REQ
, (
STATE_MACHINE_FUNC
)
MlmeJoReqAi
);

64 
	`SMacheSAi
(
Sm
, 
SYNC_IDLE
, 
MT2_MLME_START_REQ
, (
STATE_MACHINE_FUNC
)
MlmeSReqAi
);

65 
	`SMacheSAi
(
Sm
, 
SYNC_IDLE
, 
MT2_PEER_BEACON
, (
STATE_MACHINE_FUNC
)
PrBc
);

66 
	`SMacheSAi
(
Sm
, 
SYNC_IDLE
, 
MT2_PEER_PROBE_REQ
, (
STATE_MACHINE_FUNC
)
PrProbeReqAi
);

69 
	`SMacheSAi
(
Sm
, 
JOIN_WAIT_BEACON
, 
MT2_MLME_SCAN_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhSn
);

70 
	`SMacheSAi
(
Sm
, 
JOIN_WAIT_BEACON
, 
MT2_MLME_JOIN_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhJo
);

71 
	`SMacheSAi
(
Sm
, 
JOIN_WAIT_BEACON
, 
MT2_MLME_START_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhS
);

72 
	`SMacheSAi
(
Sm
, 
JOIN_WAIT_BEACON
, 
MT2_PEER_BEACON
, (
STATE_MACHINE_FUNC
)
PrBcAtJoAi
);

73 
	`SMacheSAi
(
Sm
, 
JOIN_WAIT_BEACON
, 
MT2_BEACON_TIMEOUT
, (
STATE_MACHINE_FUNC
)
BcTimeoutAtJoAi
);

74 
	`SMacheSAi
(
Sm
, 
JOIN_WAIT_BEACON
, 
MT2_PEER_PROBE_RSP
, (
STATE_MACHINE_FUNC
)
PrBcAtSnAi
);

77 
	`SMacheSAi
(
Sm
, 
SCAN_LISTEN
, 
MT2_MLME_SCAN_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhSn
);

78 
	`SMacheSAi
(
Sm
, 
SCAN_LISTEN
, 
MT2_MLME_JOIN_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhJo
);

79 
	`SMacheSAi
(
Sm
, 
SCAN_LISTEN
, 
MT2_MLME_START_REQ
, (
STATE_MACHINE_FUNC
)
InvidSWhS
);

80 
	`SMacheSAi
(
Sm
, 
SCAN_LISTEN
, 
MT2_PEER_BEACON
, (
STATE_MACHINE_FUNC
)
PrBcAtSnAi
);

81 
	`SMacheSAi
(
Sm
, 
SCAN_LISTEN
, 
MT2_PEER_PROBE_RSP
, (
STATE_MACHINE_FUNC
)
PrBcAtSnAi
);

82 
	`SMacheSAi
(
Sm
, 
SCAN_LISTEN
, 
MT2_SCAN_TIMEOUT
, (
STATE_MACHINE_FUNC
)
SnTimeoutAi
);

85 
	`SMacheSAi
(
Sm
, 
SCAN_PENDING
, 
MT2_MLME_SCAN_REQ
, (
STATE_MACHINE_FUNC
)
MlmeSnReqAi
);

88 
	`RTMPInTim
(
pAd
, &pAd->
MlmeAux
.
BcTim
, 
	`GET_TIMER_FUNCTION
(
BcTimeout
),Ad, 
FALSE
);

89 
	`RTMPInTim
(
pAd
, &pAd->
MlmeAux
.
SnTim
, 
	`GET_TIMER_FUNCTION
(
SnTimeout
),Ad, 
FALSE
);

90 
	}
}

101 
VOID
 
	$BcTimeout
(

102 
IN
 
PVOID
 
SyemScific1
,

103 
IN
 
PVOID
 
FuniCڋxt
,

104 
IN
 
PVOID
 
SyemScific2
,

105 
IN
 
PVOID
 
SyemScific3
)

107 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

109 
	`DBGPRINT
(
RT_DEBUG_TRACE
,("SYNC - BeaconTimeout\n"));

113 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
))

116 #ifde
DOT11_N_SUPPORT


117 i((
pAd
->
CommCfg
.
BBPCutBW
 =
BW_40
)

120 
UCHAR
 
BBPVue
 = 0;

121 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
CChl
, 
FALSE
);

122 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
CChl
);

123 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BBPVue
);

124 
BBPVue
 &= (~0x18);

125 
BBPVue
 |= 0x10;

126 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BBPVue
);

127 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - End oSCAN,eܐt40MHz ch%d, Tٮ BSS[%02d]\n",
pAd
->
CommCfg
.
CChl
,Ad->
SnTab
.
BssNr
));

131 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_BEACON_TIMEOUT
, 0, 
NULL
, 0);

132 
	`RTMP_MLME_HANDLER
(
pAd
);

133 
	}
}

144 
VOID
 
	$SnTimeout
(

145 
IN
 
PVOID
 
SyemScific1
,

146 
IN
 
PVOID
 
FuniCڋxt
,

147 
IN
 
PVOID
 
SyemScific2
,

148 
IN
 
PVOID
 
SyemScific3
)

150 
RTMP_ADAPTER
 *
pAd
 = (RTMP_ADAPTER *)
FuniCڋxt
;

155 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_HALT_IN_PROGRESS
))

158 i(
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_SCAN_TIMEOUT
, 0, 
NULL
, 0))

160 
	`RTMP_MLME_HANDLER
(
pAd
);

165 
pAd
->
MlmeAux
.
Chl
 = 0;

166 
	`SnNextChl
(
pAd
);

167 
	`RTMPSdWessEvt
(
pAd
, 
IW_SCAN_ENQUEUE_FAIL_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

170 
	}
}

178 
VOID
 
	$MlmeSnReqAi
(

179 
IN
 
PRTMP_ADAPTER
 
pAd
,

180 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

182 
UCHAR
 
Ssid
[
MAX_LEN_OF_SSID
], 
SsidL
, 
SnTy
, 
BssTy
, 
BBPVue
 = 0;

183 
BOOLEAN
 
TimCed
;

184 
ULONG
 
Now
;

185 
USHORT
 
Stus
;

189 i!
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_START_UP
))

191 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - MlmeScanReqAction before Startup\n"));

195 #ifde
PCIE_PS_SUPPORT


196 i((
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)) &&

197 (
	`IDLE_ON
(
pAd
)) &&

198 (
pAd
->
SCfg
.
bRadio
 =
TRUE
) &&

199 (
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
)))

201 i(
pAd
->
SCfg
.
PSCڌ
.
fld
.
EbNewPS
 =
FALSE
)

203 
	`AsicSdCommdToMcu
(
pAd
, 0x31, 
PowWakeCID
, 0x00, 0x02);

204 
	`AsicCheckCommOk
(
pAd
, 
PowWakeCID
);

205 
	`RTMP_CLEAR_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
);

206 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PSM - Issue Wake up command \n"));

210 
	`RT28xxPciAsicRadioOn
(
pAd
, 
GUI_IDLE_POWER_SAVE
);

216 i(
	`MlmeSnReqSy
(
pAd
,

217 
Em
->
Msg
,

218 
Em
->
MsgL
,

219 &
BssTy
,

220 (
PCHAR
)
Ssid
,

221 &
SsidL
,

222 &
SnTy
))

228 
	`RTMPSudMsduTnsmissi
(
pAd
);

235 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
&& (
	`INFRA_ON
(pAd)))

237 
	`RTMPSdNuFme
(
pAd
,

238 
pAd
->
CommCfg
.
TxRe
,

239 (
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_WMM_INUSED
? 
TRUE
:
FALSE
));

240 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeScanReqAction -- Send PSM Data frame for off channel RM, SCAN_IN_PROGRESS=%d!\n",

241 
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
)));

242 
	`OS_WAIT
(20);

245 
	`RTMPSdWessEvt
(
pAd
, 
IW_SCANNING_EVENT_FLAG
, 
NULL
, 
BSS0
, 0);

247 
	`NdisGSyemUpTime
(&
Now
);

248 
pAd
->
SCfg
.
LaSnTime
 = 
Now
;

250 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
BcTim
, &
TimCed
);

251 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
SnTim
, &
TimCed
);

254 
pAd
->
MlmeAux
.
BssTy
 = BssType;

255 
pAd
->
MlmeAux
.
SnTy
 = ScanType;

256 
pAd
->
MlmeAux
.
SsidL
 = SsidLen;

257 
	`NdisZoMemy
(
pAd
->
MlmeAux
.
Ssid
, 
MAX_LEN_OF_SSID
);

258 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
Ssid
, Ssid, 
SsidL
);

263 i((
pAd
->
SCfg
.
bImovedSn
&& (pAd->
Mlme
.
SyncMache
.
CuS
 =
SCAN_PENDING
))

265 
pAd
->
MlmeAux
.
Chl
 =Ad->
SCfg
.
LaSnChl
;

269 i(
pAd
->
SCfg
.
bFaC
 && (pAd->
CommCfg
.
Chl
 !0&& !pAd->SCfg.
bNFSn
)

271 
pAd
->
MlmeAux
.
Chl
 =Ad->
CommCfg
.Channel;

275 
pAd
->
MlmeAux
.
Chl
 = 
	`FChl
(pAd);

279 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BBPVue
);

280 
BBPVue
 &= (~0x18);

281 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BBPVue
);

282 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - BBP R4o 20MHz.l\n"));

283 #ifde
DOT11_N_SUPPORT


284 #ifde
DOT11N_DRAFT3


286 
	`TriEvtIn
(
pAd
);

289 
	`SnNextChl
(
pAd
);

290 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_LIST_SCAN
;

294 
	`DBGPRINT_ERR
(("SYNC - MlmeScanReqAction() sanity check fail\n"));

295 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

296 
Stus
 = 
MLME_INVALID_FORMAT
;

297 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_SCAN_CONF
, 2, &
Stus
, 0);

299 
	}
}

307 
VOID
 
	$MlmeJoReqAi
(

308 
IN
 
PRTMP_ADAPTER
 
pAd
,

309 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

311 
UCHAR
 
BBPVue
 = 0;

312 
BSS_ENTRY
 *
pBss
;

313 
BOOLEAN
 
TimCed
;

314 
HEADER_802_11
 
Hdr80211
;

315 
NDIS_STATUS
 
NStus
;

316 
ULONG
 
FmeL
 = 0;

317 
PUCHAR
 
pOutBufr
 = 
NULL
;

318 
PUCHAR
 
pSupRe
 = 
NULL
;

319 
UCHAR
 
SupReL
;

320 
PUCHAR
 
pExtRe
 = 
NULL
;

321 
UCHAR
 
ExtReL
;

322 
UCHAR
 
ASupRe
[] = {0x8C, 0x12, 0x98, 0x24, 0xb0, 0x48, 0x60, 0x6C};

323 
UCHAR
 
ASupReL
 = (
ASupRe
)/(UCHAR);

324 
MLME_JOIN_REQ_STRUCT
 *
pInfo
 = (MLME_JOIN_REQ_STRUCT *)(
Em
->
Msg
);

326 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - MlmeJoReqAi(BSS #%ld)\n", 
pInfo
->
BssIdx
));

328 #ifde
PCIE_PS_SUPPORT


329 i((
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
)) &&

330 (
	`IDLE_ON
(
pAd
)) &&

331 (
pAd
->
SCfg
.
bRadio
 =
TRUE
) &&

332 (
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_IDLE_RADIO_OFF
)))

334 
	`RT28xxPciAsicRadioOn
(
pAd
, 
GUI_IDLE_POWER_SAVE
);

339 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
SnTim
, &
TimCed
);

340 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
BcTim
, &
TimCed
);

342 
pBss
 = &
pAd
->
MlmeAux
.
SsidBssTab
.
BssEry
[
pInfo
->
BssIdx
];

345 
	`COPY_MAC_ADDR
(
pAd
->
MlmeAux
.
Bssid
, 
pBss
->Bssid);

348 i(
pBss
->
Hidd
 == 0)

350 
	`RTMPZoMemy
(
pAd
->
MlmeAux
.
Ssid
, 
MAX_LEN_OF_SSID
);

351 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
Ssid
, 
pBss
->Ssid,Bss->
SsidL
);

352 
pAd
->
MlmeAux
.
SsidL
 = 
pBss
->SsidLen;

355 
pAd
->
MlmeAux
.
BssTy
 = 
pBss
->BssType;

356 
pAd
->
MlmeAux
.
Chl
 = 
pBss
->Channel;

357 
pAd
->
MlmeAux
.
CChl
 = 
pBss
->CentralChannel;

359 #ifde
EXT_BUILD_CHANNEL_LIST


361 i((
pAd
->
SCfg
.
IEEE80211dClMode
 !
Rt802_11_D_Ne
) &&

362 (
pBss
->
bHasCouryIE
 =
TRUE
))

364 
	`NdisMoveMemy
(&
pAd
->
CommCfg
.
CouryCode
[0], &
pBss
->
CourySg
[0], 2);

365 i(
pBss
->
CourySg
[2] == 'I')

366 
pAd
->
CommCfg
.
Geogphy
 = 
IDOR
;

367 i(
pBss
->
CourySg
[2] == 'O')

368 
pAd
->
CommCfg
.
Geogphy
 = 
ODOR
;

370 
pAd
->
CommCfg
.
Geogphy
 = 
BOTH
;

371 
	`BudChlLiEx
(
pAd
);

376 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
BBPVue
);

377 
BBPVue
 &= (~0x18);

378 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
BBPVue
);

379 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_20
;

380 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - BBP R4o 20MHz.l\n"));

383 
	`AsicSwchChl
(
pAd
,Ad->
MlmeAux
.
Chl
, 
FALSE
);

384 
	`AsicLockChl
(
pAd
,Ad->
MlmeAux
.
Chl
);

387 
	`RTMPSTim
(&
pAd
->
MlmeAux
.
BcTim
, 
JOIN_TIMEOUT
);

391 i(((
pAd
->
CommCfg
.
bIEEE80211H
 == 1) &&

392 (
pAd
->
MlmeAux
.
Chl
 > 14) &&

393 
	`RadChlCheck
(
pAd
,Ad->
MlmeAux
.
Chl
))

394 #ifde
CARRIER_DETECTION_SUPPORT


395 || (
pAd
->
CommCfg
.
CrrDe
.
Eb
 =
TRUE
)

402 i(
pBss
->
Hidd
 == 0)

409 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

410 i(
NStus
 =
NDIS_STATUS_SUCCESS
)

412 i(
pAd
->
MlmeAux
.
Chl
 <= 14)

414 
pSupRe
 = 
pAd
->
CommCfg
.
SupRe
;

415 
SupReL
 = 
pAd
->
CommCfg
.SupRateLen;

416 
pExtRe
 = 
pAd
->
CommCfg
.
ExtRe
;

417 
ExtReL
 = 
pAd
->
CommCfg
.ExtRateLen;

424 
pSupRe
 = 
ASupRe
;

425 
SupReL
 = 
ASupReL
;

426 
ExtReL
 = 0;

429 i(
pAd
->
MlmeAux
.
BssTy
 =
BSS_INFRA
)

430 
	`MgtMacHdIn
(
pAd
, &
Hdr80211
, 
SUBTYPE_PROBE_REQ
, 0,Ad->
MlmeAux
.
Bssid
,Ad->MlmeAux.Bssid);

432 
	`MgtMacHdIn
(
pAd
, &
Hdr80211
, 
SUBTYPE_PROBE_REQ
, 0, 
BROADCAST_ADDR
, BROADCAST_ADDR);

434 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

435 (
HEADER_802_11
), &
Hdr80211
,

436 1, &
SsidIe
,

437 1, &
pAd
->
MlmeAux
.
SsidL
,

438 
pAd
->
MlmeAux
.
SsidL
,Ad->MlmeAux.
Ssid
,

439 1, &
SupReIe
,

440 1, &
SupReL
,

441 
SupReL
, 
pSupRe
,

442 
END_OF_ARGS
);

444 i(
ExtReL
)

446 
ULONG
 
Tmp
;

447 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
Tmp
,

448 1, &
ExtReIe
,

449 1, &
ExtReL
,

450 
ExtReL
, 
pExtRe
,

451 
END_OF_ARGS
);

452 
FmeL
 +
Tmp
;

456 #ifde
WPA_SUPPLICANT_SUPPORT


457 i((
pAd
->
OpMode
 =
OPMODE_STA
) &&

458 (
pAd
->
SCfg
.
WSuliUP
 !
WPA_SUPPLICANT_DISABLE
) &&

459 (
pAd
->
SCfg
.
WpsProbeReqIeL
 != 0))

461 
ULONG
 
WpsTmpL
 = 0;

463 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
WpsTmpL
,

464 
pAd
->
SCfg
.
WpsProbeReqIeL
,Ad->SCfg.
pWpsProbeReqIe
,

465 
END_OF_ARGS
);

467 
FmeL
 +
WpsTmpL
;

471 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

472 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

474 } 
FALSE
);

476 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - Switcho ch %d, Wait BEACON from %02x:%02x:%02x:%02x:%02x:%02x\n",

477 
pBss
->
Chl
,Bss->
Bssid
[0],Bss->Bssid[1],Bss->Bssid[2],Bss->Bssid[3],Bss->Bssid[4],Bss->Bssid[5]));

479 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
JOIN_WAIT_BEACON
;

480 
	}
}

488 
VOID
 
	$MlmeSReqAi
(

489 
IN
 
PRTMP_ADAPTER
 
pAd
,

490 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

492 
UCHAR
 
Ssid
[
MAX_LEN_OF_SSID
], 
SsidL
;

493 
BOOLEAN
 
TimCed
;

497 
UCHAR
 *
VIE
 = 
NULL
;

498 
NDIS_802_11_VARIABLE_IEs
 *
pVIE
 = 
NULL
;

499 
LARGE_INTEGER
 
TimeSmp
;

500 
BOOLEAN
 
Privacy
;

501 
USHORT
 
Stus
;

505 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
VIE
, 
MAX_VIE_LEN
);

506 i(
VIE
 =
NULL
)

508 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: Ao memy fa!!!\n", 
__FUNCTION__
));

513 
pVIE
 = (
PNDIS_802_11_VARIABLE_IEs

VIE
;

514 
pVIE
->
Lgth
 = 0;

515 
TimeSmp
.
u
.
LowPt
 = 0;

516 
TimeSmp
.
u
.
HighPt
 = 0;

518 i((
	`MlmeSReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, (
PCHAR
)
Ssid
, &
SsidL
)) &&

519 (
	`CHAN_PrݔtyCheck
(
pAd
,Ad->
MlmeAux
.
Chl
, 
CHANNEL_NO_IBSS
=
FALSE
))

522 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
SnTim
, &
TimCed
);

523 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
BcTim
, &
TimCed
);

528 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeStartReqAction - Startew IBSS. All IBSSarametersre decidedow.... \n"));

529 
pAd
->
MlmeAux
.
BssTy
 = 
BSS_ADHOC
;

530 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
Ssid
, Ssid, 
SsidL
);

531 
pAd
->
MlmeAux
.
SsidL
 = SsidLen;

534 
	`MacAddrRdomBssid
(
pAd
,Ad->
MlmeAux
.
Bssid
);

535 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeStartReqAction - generateadomumbers BSSID \n"));

537 
Privacy
 = (
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi1Ebd
) ||

538 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi2Ebd
) ||

539 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi3Ebd
);

540 
pAd
->
MlmeAux
.
CabyInfo
 = 
	`CAP_GENERATE
(0,1,
Privacy
, (pAd->
CommCfg
.
TxPamb
 =
Rt802_11PambSht
), 1, 0);

541 
pAd
->
MlmeAux
.
BcPiod
 =Ad->
CommCfg
.BeaconPeriod;

542 
pAd
->
MlmeAux
.
AtimW
 =Ad->
SCfg
.AtimWin;

543 
pAd
->
MlmeAux
.
Chl
 =Ad->
CommCfg
.Channel;

545 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
;

546 
pAd
->
MlmeAux
.
CChl
 =Ad->
CommCfg
.CentralChannel;

548 
pAd
->
MlmeAux
.
SupReL
pAd->
CommCfg
.SupRateLen;

549 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
SupRe
,Ad->
CommCfg
.SupRe, 
MAX_LEN_OF_SUPPORTED_RATES
);

550 
	`RTMPCheckRes
(
pAd
,Ad->
MlmeAux
.
SupRe
, &pAd->MlmeAux.
SupReL
);

551 
pAd
->
MlmeAux
.
ExtReL
 =Ad->
CommCfg
.ExtRateLen;

552 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
ExtRe
,Ad->
CommCfg
.ExtRe, 
MAX_LEN_OF_SUPPORTED_RATES
);

553 
	`RTMPCheckRes
(
pAd
,Ad->
MlmeAux
.
ExtRe
, &pAd->MlmeAux.
ExtReL
);

554 #ifde
DOT11_N_SUPPORT


555 i((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
&& (pAd->
SCfg
.
bAdhocN
 =
TRUE
))

557 
	`RTMPUpdeHTIE
(&
pAd
->
CommCfg
.
DesedHtPhy
, &pAd->
SCfg
.
DesedHtPhyInfo
.
MCSS
[0], &pAd->
MlmeAux
.
HtCaby
, &pAd->MlmeAux.
AddHtInfo
);

558 
pAd
->
MlmeAux
.
HtCabyL
 = (
HT_CAPABILITY_IE
);

560 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC -pAd->StaActive.SupportedHtPhy.bHtEnable = TRUE\n"));

565 
pAd
->
MlmeAux
.
HtCabyL
 = 0;

566 
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 = 
FALSE
;

567 
	`NdisZoMemy
(&
pAd
->
SAive
.
Su܋dPhyInfo
.
MCSS
[0], 16);

570 
	`NdisZoMemy
(&
pAd
->
MlmeAux
.
APEdPm
, (
EDCA_PARM
));

571 
	`NdisZoMemy
(&
pAd
->
MlmeAux
.
APQbssLd
, (
QBSS_LOAD_PARM
));

572 
	`NdisZoMemy
(&
pAd
->
MlmeAux
.
APQosCaby
, (
QOS_CAPABILITY_PARM
));

574 
	`AsicSwchChl
(
pAd
,Ad->
MlmeAux
.
Chl
, 
FALSE
);

575 
	`AsicLockChl
(
pAd
,Ad->
MlmeAux
.
Chl
);

577 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - MlmeStartReqAction(ch= %d,supates= %d,xtates=%d)\n",

578 
pAd
->
MlmeAux
.
Chl
,Ad->MlmeAux.
SupReL
,Ad->MlmeAux.
ExtReL
));

580 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

581 
Stus
 = 
MLME_SUCCESS
;

582 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_START_CONF
, 2, &
Stus
, 0);

586 
	`DBGPRINT_ERR
(("SYNC - MlmeStartReqAction() sanity check fail.\n"));

587 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

588 
Stus
 = 
MLME_INVALID_FORMAT
;

589 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_START_CONF
, 2, &
Stus
, 0);

592 i(
VIE
 !
NULL
)

593 
	`os__mem
(
NULL
, 
VIE
);

594 
	}
}

602 
VOID
 
	$PrBcAtSnAi
(

603 
IN
 
PRTMP_ADAPTER
 
pAd
,

604 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

606 
UCHAR
 
Bssid
[
MAC_ADDR_LEN
], 
Addr2
[MAC_ADDR_LEN];

607 
UCHAR
 
BssTy
, 
Chl
 = 0, 
NewChl
,

608 
SsidL
, 
DtimCou
, 
DtimPiod
, 
BFg
, 
MesgeToMe
;

609 
UCHAR
 *
Ssid
 = 
NULL
;

610 
CF_PARM
 
CfPm
;

611 
USHORT
 
BcPiod
, 
AtimW
, 
CabyInfo
;

612 
PFRAME_802_11
 
pFme
;

613 
LARGE_INTEGER
 
TimeSmp
;

614 
UCHAR
 
E
;

615 
UCHAR
 
SupRe
[
MAX_LEN_OF_SUPPORTED_RATES
], 
ExtRe
[MAX_LEN_OF_SUPPORTED_RATES];

616 
UCHAR
 
SupReL
, 
ExtReL
;

617 
USHORT
 
LVIE
;

618 
UCHAR
 
CkFg
;

619 
UCHAR
 
AڑClPowLim
;

620 
EDCA_PARM
 
EdPm
;

621 
QBSS_LOAD_PARM
 
QbssLd
;

622 
QOS_CAPABILITY_PARM
 
QosCaby
;

623 
ULONG
 
RkIe
;

625 
UCHAR
 *
VIE
 = 
NULL
;

626 
NDIS_802_11_VARIABLE_IEs
 *
pVIE
 = 
NULL
;

629 
HT_CAPABILITY_IE
 *
pHtCaby
 = 
NULL
;

630 
ADD_HT_INFO_IE
 *
pAddHtInfo
 = 
NULL
;

631 
UCHAR
 
HtCabyL
 = 0, 
PNHtCabyL
 = 0;

632 
UCHAR
 
AddHtInfoL
;

633 
UCHAR
 
NewExtChlOfft
 = 0xff;

635 
EXT_CAP_INFO_ELEMENT
 
ExtCInfo
;

639 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
Ssid
, 
MAX_LEN_OF_SSID
);

640 i(
Ssid
 =
NULL
)

641 
LabE
;

642 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
VIE
, 
MAX_VIE_LEN
);

643 i(
VIE
 =
NULL
)

644 
LabE
;

645 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
pHtCaby
, (
HT_CAPABILITY_IE
));

646 i(
pHtCaby
 =
NULL
)

647 
LabE
;

648 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
pAddHtInfo
, (
ADD_HT_INFO_IE
));

649 i(
pAddHtInfo
 =
NULL
)

650 
LabE
;

652 
	`NdisZoMemy
(
Ssid
, 
MAX_LEN_OF_SSID
);

653 
pFme
 = (
PFRAME_802_11

Em
->
Msg
;

655 
pVIE
 = (
PNDIS_802_11_VARIABLE_IEs

VIE
;

656 
pVIE
->
Lgth
 = 0;

657 #ifde
DOT11_N_SUPPORT


658 
	`RTMPZoMemy
(
pHtCaby
, (
HT_CAPABILITY_IE
));

659 
	`RTMPZoMemy
(
pAddHtInfo
, (
ADD_HT_INFO_IE
));

662 
	`NdisZoMemy
(&
QbssLd
, (
QBSS_LOAD_PARM
));

663 i(
	`PrBcAndProbeRSy
(
pAd
,

664 
Em
->
Msg
,

665 
Em
->
MsgL
,

666 
Em
->
Chl
,

667 
Addr2
,

668 
Bssid
,

669 (
PCHAR
)
Ssid
,

670 &
SsidL
,

671 &
BssTy
,

672 &
BcPiod
,

673 &
Chl
,

674 &
NewChl
,

675 &
TimeSmp
,

676 &
CfPm
,

677 &
AtimW
,

678 &
CabyInfo
,

679 &
E
,

680 &
DtimCou
,

681 &
DtimPiod
,

682 &
BFg
,

683 &
MesgeToMe
,

684 
SupRe
,

685 &
SupReL
,

686 
ExtRe
,

687 &
ExtReL
,

688 &
CkFg
,

689 &
AڑClPowLim
,

690 &
EdPm
,

691 &
QbssLd
,

692 &
QosCaby
,

693 &
RkIe
,

694 &
HtCabyL
,

695 #ifde
CONFIG_STA_SUPPORT


696 &
PNHtCabyL
,

698 
pHtCaby
,

699 &
ExtCInfo
,

700 &
AddHtInfoL
,

701 
pAddHtInfo
,

702 &
NewExtChlOfft
,

703 &
LVIE
,

704 
pVIE
))

706 
ULONG
 
Idx
 = 0;

707 
CHAR
 
Rssi
 = 0;

709 
Idx
 = 
	`BssTabSrch
(&
pAd
->
SnTab
, 
Bssid
, 
Chl
);

710 i(
Idx
 !
BSS_NOT_FOUND
)

711 
Rssi
 = 
pAd
->
SnTab
.
BssEry
[
Idx
].Rssi;

713 
Rssi
 = 
	`RTMPMaxRssi
(
pAd
, 
	`CvtToRssi
Ad, 
Em
->
Rssi0
, 
RSSI_0
), CvtToRssiAd, Em->
Rssi1
, 
RSSI_1
), CvtToRssiAd, Em->
Rssi2
, 
RSSI_2
));

716 #ifde
DOT11_N_SUPPORT


717 i((
HtCabyL
 > 0|| (
PNHtCabyL
 > 0))

718 
HtCabyL
 = 
SIZE_HT_CAP_IE
;

721 
Idx
 = 
	`BssTabSEry
(
pAd
, &pAd->
SnTab
, 
Bssid
, (
PCHAR
)
Ssid
, 
SsidL
, 
BssTy
, 
BcPiod
,

722 &
CfPm
, 
AtimW
, 
CabyInfo
, 
SupRe
, 
SupReL
, 
ExtRe
, 
ExtReL
, 
pHtCaby
,

723 
pAddHtInfo
, 
HtCabyL
, 
AddHtInfoL
, 
NewExtChlOfft
, 
Chl
, 
Rssi
, 
TimeSmp
, 
CkFg
,

724 &
EdPm
, &
QosCaby
, &
QbssLd
, 
LVIE
, 
pVIE
);

725 #ifde
DOT11_N_SUPPORT


727 #ifde
DOT11N_DRAFT3


729 i(
	`INFRA_ON
(
pAd
)

730 && (
pAd
->
CommCfg
.
bBssCxEb
 =
TRUE
)

731 && ((
Chl
 > 0) && (Channel <= 14)))

733 
chLiIdx
;

738 
chLiIdx
 = 0; chLiIdx < 
pAd
->
ChlLiNum
; chListIdx++)

740 i(
Chl
 =
pAd
->
ChlLi
[
chLiIdx
].Channel)

744 i(
chLiIdx
 < 
pAd
->
ChlLiNum
)

749 i(
pAd
->
ChlLi
[
chLiIdx
].
bEfedChl
 =
TRUE
)

751 
UCHAR
 
RegCss
;

752 
OVERLAP_BSS_SCAN_IE
 
BssSn
;

755 
	`PrBcAndProbeRSy2
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, &
BssSn
, &
RegCss
);

756 
	`TriEvtTabSEry
(
pAd
, &pAd->
CommCfg
.
TriggEvtTab
, 
Bssid
, 
pHtCaby
, 
HtCabyL
, 
RegCss
, 
Chl
);

762 i(
Idx
 !
BSS_NOT_FOUND
)

764 
PBSS_ENTRY
 
pBssEry
 = &
pAd
->
SnTab
.
BssEry
[
Idx
];

765 
	`NdisMoveMemy
(
pBssEry
->
PTSF
, &
Em
->
Msg
[24], 4);

766 
	`NdisMoveMemy
(&
pBssEry
->
TTSF
[0], &
Em
->
TimeSmp
.
u
.
LowPt
, 4);

767 
	`NdisMoveMemy
(&
pBssEry
->
TTSF
[4], &
Em
->
TimeSmp
.
u
.
LowPt
, 4);

769 
pBssEry
->
MSNR
 = 
Em
->
Sigl
 % 10;

770 i(
pBssEry
->
MSNR
 == 0)

771 
pBssEry
->
MSNR
 = -5;

773 
	`NdisMoveMemy
(
pBssEry
->
MacAddr
, 
Addr2
, 
MAC_ADDR_LEN
);

775 i((
pFme
->
Hdr
.
FC
.
SubTy
 =
SUBTYPE_PROBE_RSP
) &&

776 (
LVIE
 != 0))

778 
pBssEry
->
VIeFromProbeRL
 = 0;

779 i(
pBssEry
->
pVIeFromProbR
)

781 
pBssEry
->
VIeFromProbeRL
 = 
LVIE
;

782 
	`RTMPZoMemy
(
pBssEry
->
pVIeFromProbR
, 
MAX_VIE_LEN
);

783 
	`RTMPMoveMemy
(
pBssEry
->
pVIeFromProbR
, 
pVIE
, 
LVIE
);

788 #ifde
LINUX


789 #ifde
RT_CFG80211_SUPPORT


790 
	`RT_CFG80211_SCANNING_INFORM
(
pAd
, 
Idx
, 
Em
->
Chl
, (
UCHAR
 *)
pFme
,

791 
Em
->
MsgL
, 
Rssi
, 
MEM_ALLOC_FLAG
);

796 
LabOK
;

798 
LabE
:

799 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: Ao memy fa!!!\n", 
__FUNCTION__
));

801 
LabOK
:

802 i(
Ssid
 !
NULL
)

803 
	`os__mem
(
NULL
, 
Ssid
);

804 i(
VIE
 !
NULL
)

805 
	`os__mem
(
NULL
, 
VIE
);

806 i(
pHtCaby
 !
NULL
)

807 
	`os__mem
(
NULL
, 
pHtCaby
);

808 i(
pAddHtInfo
 !
NULL
)

809 
	`os__mem
(
NULL
, 
pAddHtInfo
);

811 
	}
}

819 
VOID
 
	$PrBcAtJoAi
(

820 
IN
 
PRTMP_ADAPTER
 
pAd
,

821 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

823 
UCHAR
 
Bssid
[
MAC_ADDR_LEN
], 
Addr2
[MAC_ADDR_LEN];

824 
UCHAR
 
SsidL
, 
BssTy
, 
Chl
, 
MesgeToMe
,

825 
DtimCou
, 
DtimPiod
, 
BFg
, 
NewChl
;

826 
UCHAR
 *
Ssid
 = 
NULL
;

827 
LARGE_INTEGER
 
TimeSmp
;

828 
USHORT
 
BcPiod
, 
AtimW
, 
CabyInfo
;

829 
CF_PARM
 
Cf
;

830 
BOOLEAN
 
TimCed
;

831 
UCHAR
 
E
;

832 
UCHAR
 
SupRe
[
MAX_LEN_OF_SUPPORTED_RATES
], 
ExtRe
[MAX_LEN_OF_SUPPORTED_RATES];

833 
UCHAR
 
SupReL
, 
ExtReL
;

834 
UCHAR
 
CkFg
;

835 
USHORT
 
LVIE
;

836 
UCHAR
 
AڑClPowLim
;

837 
EDCA_PARM
 
EdPm
;

838 
QBSS_LOAD_PARM
 
QbssLd
;

839 
QOS_CAPABILITY_PARM
 
QosCaby
;

840 
USHORT
 
Stus
;

842 
UCHAR
 *
VIE
 = 
NULL
;

843 
NDIS_802_11_VARIABLE_IEs
 *
pVIE
 = 
NULL
;

844 
ULONG
 
RkIe
;

845 
ULONG
 
Idx
 = 0;

846 
CHAR
 
Rssi
 = 0;

849 
HT_CAPABILITY_IE
 *
pHtCaby
 = 
NULL
;

850 
ADD_HT_INFO_IE
 *
pAddHtInfo
 = 
NULL
;

851 
UCHAR
 
HtCabyL
 = 0, 
PNHtCabyL
 = 0;

852 
UCHAR
 
AddHtInfoL
;

853 
UCHAR
 
NewExtChlOfft
 = 0xff;

854 #ifde
DOT11_N_SUPPORT


855 
UCHAR
 
CChl
;

856 
BOOLEAN
 
bAowN
 = 
FALSE
;

858 
EXT_CAP_INFO_ELEMENT
 
ExtCInfo
;

862 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
Ssid
, 
MAX_LEN_OF_SSID
);

863 i(
Ssid
 =
NULL
)

864 
LabE
;

865 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
VIE
, 
MAX_VIE_LEN
);

866 i(
VIE
 =
NULL
)

867 
LabE
;

868 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
pHtCaby
, (
HT_CAPABILITY_IE
));

869 i(
pHtCaby
 =
NULL
)

870 
LabE
;

871 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
pAddHtInfo
, (
ADD_HT_INFO_IE
));

872 i(
pAddHtInfo
 =
NULL
)

873 
LabE
;

876 
pVIE
 = (
PNDIS_802_11_VARIABLE_IEs

VIE
;

877 
pVIE
->
Lgth
 = 0;

878 
	`RTMPZoMemy
(
pHtCaby
, (
HT_CAPABILITY_IE
));

879 
	`RTMPZoMemy
(
pAddHtInfo
, (
ADD_HT_INFO_IE
));

881 
EdPm
.
bVid
 = 
FALSE
;

882 i(
	`PrBcAndProbeRSy
(
pAd
,

883 
Em
->
Msg
,

884 
Em
->
MsgL
,

885 
Em
->
Chl
,

886 
Addr2
,

887 
Bssid
,

888 (
PCHAR
)
Ssid
,

889 &
SsidL
,

890 &
BssTy
,

891 &
BcPiod
,

892 &
Chl
,

893 &
NewChl
,

894 &
TimeSmp
,

895 &
Cf
,

896 &
AtimW
,

897 &
CabyInfo
,

898 &
E
,

899 &
DtimCou
,

900 &
DtimPiod
,

901 &
BFg
,

902 &
MesgeToMe
,

903 
SupRe
,

904 &
SupReL
,

905 
ExtRe
,

906 &
ExtReL
,

907 &
CkFg
,

908 &
AڑClPowLim
,

909 &
EdPm
,

910 &
QbssLd
,

911 &
QosCaby
,

912 &
RkIe
,

913 &
HtCabyL
,

914 &
PNHtCabyL
,

915 
pHtCaby
,

916 &
ExtCInfo
,

917 &
AddHtInfoL
,

918 
pAddHtInfo
,

919 &
NewExtChlOfft
,

920 &
LVIE
,

921 
pVIE
))

924 i((
BssTy
 =
BSS_ADHOC
&& (
pAd
->
CommCfg
.
PhyMode
 =
PHY_11G
&& ((
SupReL
+
ExtReL
)< 12))

925 
LabOK
;

933 i(
	`MAC_ADDR_EQUAL
(
pAd
->
MlmeAux
.
Bssid
, Bssid))

935 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC -eivdesed BEACONJoWaBc... Ch%d\n", 
Chl
));

936 
	`RTMPClTim
(&
pAd
->
MlmeAux
.
BcTim
, &
TimCed
);

939 
pAd
->
SCfg
.
RssiSame
.
LaRssi0
 = 
	`CvtToRssi
Ad, 
Em
->
Rssi0
, 
RSSI_0
);

940 
pAd
->
SCfg
.
RssiSame
.
LaRssi1
 = 
	`CvtToRssi
Ad, 
Em
->
Rssi1
, 
RSSI_1
);

941 
pAd
->
SCfg
.
RssiSame
.
LaRssi2
 = 
	`CvtToRssi
Ad, 
Em
->
Rssi2
, 
RSSI_2
);

942 
pAd
->
SCfg
.
RssiSame
.
AvgRssi0
 =Ad->SCfg.RssiSame.
LaRssi0
;

943 
pAd
->
SCfg
.
RssiSame
.
AvgRssi0X8
 =Ad->SCfg.RssiSame.
AvgRssi0
 << 3;

944 
pAd
->
SCfg
.
RssiSame
.
AvgRssi1
 =Ad->SCfg.RssiSame.
LaRssi1
;

945 
pAd
->
SCfg
.
RssiSame
.
AvgRssi1X8
 =Ad->SCfg.RssiSame.
AvgRssi1
 << 3;

946 
pAd
->
SCfg
.
RssiSame
.
AvgRssi2
 =Ad->SCfg.RssiSame.
LaRssi2
;

947 
pAd
->
SCfg
.
RssiSame
.
AvgRssi2X8
 =Ad->SCfg.RssiSame.
AvgRssi2
 << 3;

953 i(
pAd
->
MlmeAux
.
SsidL
 == 0)

955 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
Ssid
, Ssid, 
SsidL
);

956 
pAd
->
MlmeAux
.
SsidL
 = SsidLen;

960 
Idx
 = 
	`BssSsidTabSrch
(&
pAd
->
SnTab
, 
Bssid
,Ad->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
, 
Chl
);

962 i(
Idx
 =
BSS_NOT_FOUND
)

964 
Rssi
 = 
	`RTMPMaxRssi
(
pAd
, 
	`CvtToRssi
Ad, 
Em
->
Rssi0
, 
RSSI_0
), CvtToRssiAd, Em->
Rssi1
, 
RSSI_1
), CvtToRssiAd, Em->
Rssi2
, 
RSSI_2
));

965 
Idx
 = 
	`BssTabSEry
(
pAd
, &pAd->
SnTab
, 
Bssid
, (
CHAR
 *
Ssid
, 
SsidL
, 
BssTy
, 
BcPiod
,

966 &
Cf
, 
AtimW
, 
CabyInfo
, 
SupRe
, 
SupReL
, 
ExtRe
, 
ExtReL
, 
pHtCaby
,

967 
pAddHtInfo
, 
HtCabyL
, 
AddHtInfoL
, 
NewExtChlOfft
, 
Chl
, 
Rssi
, 
TimeSmp
, 
CkFg
,

968 &
EdPm
, &
QosCaby
, &
QbssLd
, 
LVIE
, 
pVIE
);

969 i(
Idx
 !
BSS_NOT_FOUND
)

971 
	`NdisMoveMemy
(
pAd
->
SnTab
.
BssEry
[
Idx
].
PTSF
, &
Em
->
Msg
[24], 4);

972 
	`NdisMoveMemy
(&
pAd
->
SnTab
.
BssEry
[
Idx
].
TTSF
[0], &
Em
->
TimeSmp
.
u
.
LowPt
, 4);

973 
	`NdisMoveMemy
(&
pAd
->
SnTab
.
BssEry
[
Idx
].
TTSF
[4], &
Em
->
TimeSmp
.
u
.
LowPt
, 4);

974 
CabyInfo
 = 
pAd
->
SnTab
.
BssEry
[
Idx
].CapabilityInfo;

976 
pAd
->
SnTab
.
BssEry
[
Idx
].
MSNR
 = 
Em
->
Sigl
 % 10;

977 i(
pAd
->
SnTab
.
BssEry
[
Idx
].
MSNR
 == 0)

978 
pAd
->
SnTab
.
BssEry
[
Idx
].
MSNR
 = -5;

980 
	`NdisMoveMemy
(
pAd
->
SnTab
.
BssEry
[
Idx
].
MacAddr
, 
Addr2
, 
MAC_ADDR_LEN
);

989 i((((
pAd
->
SCfg
.
WStus
 !
Ndis802_11WEPDibd
) << 4) ^

990 
CabyInfo
) &

993 
MLME_SCAN_REQ_STRUCT
 
SnReq
;

994 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s:APrivacy %d idifn from STArivacy%d\n", 
__FUNCTION__
, (
CabyInfo
 & 0x0010>> 4 ,
pAd
->
SCfg
.
WStus
 !
Ndis802_11WEPDibd
));

995 
	`SnPmFl
(
pAd
, &
SnReq
, (
PSTRING
pAd->
MlmeAux
.
Ssid
,Ad->MlmeAux.
SsidL
, 
BSS_ANY
, 
SCAN_ACTIVE
);

996 
	`MlmeEnqueue
(
pAd
, 
SYNC_STATE_MACHINE
, 
MT2_MLME_SCAN_REQ
, (
MLME_SCAN_REQ_STRUCT
), &
SnReq
, 0);

997 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_OID_LIST_SCAN
;

998 
	`NdisGSyemUpTime
(&
pAd
->
SCfg
.
LaSnTime
);

999 
LabOK
;

1005 
CabyInfo
 = 
pAd
->
SnTab
.
BssEry
[
Idx
].CapabilityInfo;

1009 
pAd
->
MlmeAux
.
CabyInfo
 = CabyInf& 
SUPPORTED_CAPABILITY_INFO
;

1010 
pAd
->
MlmeAux
.
BssTy
 = BssType;

1011 
pAd
->
MlmeAux
.
BcPiod
 = BeaconPeriod;

1012 
pAd
->
MlmeAux
.
Chl
 = Channel;

1013 
pAd
->
MlmeAux
.
AtimW
 = AtimWin;

1014 
pAd
->
MlmeAux
.
CPiod
 = 
Cf
.CfpPeriod;

1015 
pAd
->
MlmeAux
.
CMaxDuti
 = 
Cf
.CfpMaxDuration;

1016 
pAd
->
MlmeAux
.
APRkIe
 = 
RkIe
;

1020 
pAd
->
MlmeAux
.
SupReL
 = SupRateLen;

1021 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
SupRe
, SupRe, 
SupReL
);

1022 
	`RTMPCheckRes
(
pAd
,Ad->
MlmeAux
.
SupRe
, &pAd->MlmeAux.
SupReL
);

1023 
pAd
->
MlmeAux
.
ExtReL
 = ExtRateLen;

1024 
	`NdisMoveMemy
(
pAd
->
MlmeAux
.
ExtRe
, ExtRe, 
ExtReL
);

1025 
	`RTMPCheckRes
(
pAd
,Ad->
MlmeAux
.
ExtRe
, &pAd->MlmeAux.
ExtReL
);

1027 
	`NdisZoMemy
(
pAd
->
SAive
.
Su܋dPhyInfo
.
MCSS
, 16);

1031 
	`NdisMoveMemy
(&
pAd
->
MlmeAux
.
ExtCInfo
, &ExtCapInfo,(ExtCapInfo));

1033 #ifde
DOT11_N_SUPPORT


1034 #ifde
DOT11N_DRAFT3


1035 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("MlmeAux.ExtCInfo=%d\n", 
pAd
->
MlmeAux
.
ExtCInfo
.
BssCxiMgmtSut
));

1036 i(
pAd
->
CommCfg
.
bBssCxEb
 =
TRUE
)

1037 
pAd
->
CommCfg
.
ExtCIE
.
BssCxiMgmtSut
 = 1;

1040 i(((
pAd
->
SCfg
.
WStus
 !
Ndis802_11WEPEbd
&& (pAd->SCfg.WStu!
Ndis802_11Enyi2Ebd
))

1041 || (
pAd
->
CommCfg
.
HT_DiowTKIP
 =
FALSE
))

1043 i((
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
) ||

1044 ((
pAd
->
SCfg
.
BssTy
 =
BSS_ADHOC
&& (pAd->SCfg.
bAdhocN
 =
TRUE
)))

1045 
bAowN
 = 
TRUE
;

1048 
pAd
->
MlmeAux
.
NewExtChlOfft
 = NewExtChannelOffset;

1049 
pAd
->
MlmeAux
.
HtCabyL
 = HtCapabilityLen;

1051 
	`RTMPZoMemy
(&
pAd
->
MlmeAux
.
HtCaby
, 
SIZE_HT_CAP_IE
);

1053 i(((
HtCabyL
 > 0|| (
PNHtCabyL
 > 0)) &&

1054 (
pAd
->
SCfg
.
DesedHtPhyInfo
.
bHtEb
) &&

1055 ((
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
&& 
bAowN
))

1057 
	`RTMPMoveMemy
(&
pAd
->
MlmeAux
.
AddHtInfo
, 
pAddHtInfo
, 
SIZE_ADD_HT_INFO_IE
);

1060 
	`NdisMoveMemy
(
pAd
->
SAive
.
Su܋dPhyInfo
.
MCSS
, 
pHtCaby
->MCSSet, 16);

1061 
pAd
->
MlmeAux
.
NewExtChlOfft
 = NewExtChannelOffset;

1062 
pAd
->
MlmeAux
.
HtCabyL
 = 
SIZE_HT_CAP_IE
;

1063 
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 = 
TRUE
;

1064 i(
PNHtCabyL
 > 0)

1065 
pAd
->
SAive
.
Su܋dPhyInfo
.
bPNHt
 = 
TRUE
;

1066 
	`RTMPCheckHt
(
pAd
, 
BSSID_WCID
, 
pHtCaby
, 
pAddHtInfo
);

1068 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PeerBeaconAtJoinAction! (MpduDensity=%d, MaxRAmpduFactor=%d, BW=%d)\n",

1069 
pAd
->
SAive
.
Su܋dHtPhy
.
MpduDsy
,Ad->SAive.Su܋dHtPhy.
MaxRAmpduFa
, 
pHtCaby
->
HtCInfo
.
ChlWidth
));

1071 i(
AddHtInfoL
 > 0)

1073 
CChl
 = 
pAddHtInfo
->
CڌCh
;

1075 i((
pAddHtInfo
->
CڌCh
 > 2)&& (pAddHtInfo->
AddHtInfo
.
ExtChOfft
 =
EXTCHA_BELOW
&& (
pHtCaby
->
HtCInfo
.
ChlWidth
 =
BW_40
))

1077 
CChl
 = 
pAddHtInfo
->
CڌCh
 - 2;

1079 i((
pAddHtInfo
->
AddHtInfo
.
ExtChOfft
 =
EXTCHA_ABOVE
&& (
pHtCaby
->
HtCInfo
.
ChlWidth
 =
BW_40
))

1081 
CChl
 = 
pAddHtInfo
->
CڌCh
 + 2;

1085 i(
pAd
->
MlmeAux
.
CChl
 != CentralChannel)

1086 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("PrBcAtJoAi HT===>Bc C Ch%d, Cڌ Ch%d. Mlmux CCh%d\n", 
CChl
, 
pAddHtInfo
->
CڌCh
, 
pAd
->
MlmeAux
.CentralChannel));

1088 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrBcAtJoAi HT===>C Ch%d, Cڌ Ch%d, .\n", 
CChl
, 
pAddHtInfo
->
CڌCh
));

1097 i((
HtCabyL
 =0&& (
PNHtCabyL
 == 0))

1098 
pAd
->
MlmeAux
.
CChl
 =Ad->MlmeAux.
Chl
;

1100 
pAd
->
SAive
.
Su܋dPhyInfo
.
bHtEb
 = 
FALSE
;

1101 
pAd
->
MlmeAux
.
NewExtChlOfft
 = 0xff;

1102 
	`RTMPZoMemy
(&
pAd
->
MlmeAux
.
HtCaby
, 
SIZE_HT_CAP_IE
);

1103 
pAd
->
MlmeAux
.
HtCabyL
 = 0;

1104 
	`RTMPZoMemy
(&
pAd
->
MlmeAux
.
AddHtInfo
, 
SIZE_ADD_HT_INFO_IE
);

1107 
	`RTMPUpdeMlmeRe
(
pAd
);

1110 i((
pAd
->
CommCfg
.
bWmmCab
)

1111 #ifde
DOT11_N_SUPPORT


1112 || (
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
)

1116 
	`NdisMoveMemy
(&
pAd
->
MlmeAux
.
APEdPm
, &
EdPm
, (
EDCA_PARM
));

1117 
	`NdisMoveMemy
(&
pAd
->
MlmeAux
.
APQbssLd
, &
QbssLd
, (
QBSS_LOAD_PARM
));

1118 
	`NdisMoveMemy
(&
pAd
->
MlmeAux
.
APQosCaby
, &
QosCaby
, (
QOS_CAPABILITY_PARM
));

1122 
	`NdisZoMemy
(&
pAd
->
MlmeAux
.
APEdPm
, (
EDCA_PARM
));

1123 
	`NdisZoMemy
(&
pAd
->
MlmeAux
.
APQbssLd
, (
QBSS_LOAD_PARM
));

1124 
	`NdisZoMemy
(&
pAd
->
MlmeAux
.
APQosCaby
, (
QOS_CAPABILITY_PARM
));

1127 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC -fter JOIN, SupRateLen=%d, ExtRateLen=%d\n",

1128 
pAd
->
MlmeAux
.
SupReL
,Ad->MlmeAux.
ExtReL
));

1130 i(
AڑClPowLim
 != 0xFF)

1133 
	`ChgeToClPowLim
(
pAd
, 
AڑClPowLim
);

1136 
pAd
->
CommCfg
.
TxPowPage
 =Ad->CommCfg.
TxPowDeu
;

1138 i(
pAd
->
SCfg
.
BssTy
 =
BSS_INFRA
)

1143 
	`InChlRedVue
(
pAd
);

1146 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

1147 
Stus
 = 
MLME_SUCCESS
;

1148 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_JOIN_CONF
, 2, &
Stus
, 0);

1150 #ifde
LINUX


1151 #ifde
RT_CFG80211_SUPPORT


1152 
	`RT_CFG80211_SCANNING_INFORM
(
pAd
, 
Idx
, 
Em
->
Chl
, Em->
Msg
,

1153 
Em
->
MsgL
, 
Rssi
, 
MEM_ALLOC_FLAG
);

1161 
LabOK
;

1163 
LabE
:

1164 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: Ao memy fa!!!\n", 
__FUNCTION__
));

1166 
LabOK
:

1167 i(
Ssid
 !
NULL
)

1168 
	`os__mem
(
NULL
, 
Ssid
);

1169 i(
VIE
 !
NULL
)

1170 
	`os__mem
(
NULL
, 
VIE
);

1171 i(
pHtCaby
 !
NULL
)

1172 
	`os__mem
(
NULL
, 
pHtCaby
);

1173 i(
pAddHtInfo
 !
NULL
)

1174 
	`os__mem
(
NULL
, 
pAddHtInfo
);

1176 
	}
}

1187 
VOID
 
	$PrBc
(

1188 
IN
 
PRTMP_ADAPTER
 
pAd
,

1189 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1191 
UCHAR
 
Bssid
[
MAC_ADDR_LEN
], 
Addr2
[MAC_ADDR_LEN];

1193 
CHAR
 *
Ssid
 = 
NULL
;

1194 
CF_PARM
 
CfPm
;

1195 
UCHAR
 
SsidL
, 
MesgeToMe
=0, 
BssTy
, 
Chl
, 
NewChl
, 
dex
=0;

1196 
UCHAR
 
DtimCou
=0, 
DtimPiod
=0, 
BFg
=0;

1197 
USHORT
 
CabyInfo
, 
AtimW
, 
BcPiod
;

1198 
LARGE_INTEGER
 
TimeSmp
;

1199 
USHORT
 
TbNumToNextWakeUp
;

1200 
UCHAR
 
E
;

1201 
UCHAR
 
SupRe
[
MAX_LEN_OF_SUPPORTED_RATES
], 
ExtRe
[MAX_LEN_OF_SUPPORTED_RATES];

1202 
UCHAR
 
SupReL
, 
ExtReL
;

1203 
UCHAR
 
CkFg
;

1204 
USHORT
 
LVIE
;

1205 
UCHAR
 
AڑClPowLim
;

1207 
EDCA_PARM
 *
pEdPm
 = 
NULL
;

1208 
QBSS_LOAD_PARM
 
QbssLd
;

1209 
QOS_CAPABILITY_PARM
 
QosCaby
;

1210 
ULONG
 
RkIe
;

1213 
UCHAR
 *
VIE
 = 
NULL
;

1214 
NDIS_802_11_VARIABLE_IEs
 *
pVIE
 = 
NULL
;

1217 
HT_CAPABILITY_IE
 *
pHtCaby
 = 
NULL
;

1218 
ADD_HT_INFO_IE
 *
pAddHtInfo
 = 
NULL
;

1219 
UCHAR
 
HtCabyL
, 
PNHtCabyL
;

1220 
UCHAR
 
AddHtInfoL
;

1221 
UCHAR
 
NewExtChlOfft
 = 0xff;

1222 
EXT_CAP_INFO_ELEMENT
 
ExtCInfo
;

1225 #ifde
RALINK_ATE


1226 i(
	`ATE_ON
(
pAd
))

1232 i(!(
	`INFRA_ON
(
pAd
|| 
	`ADHOC_ON
(pAd)

1237 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
Ssid
, 
MAX_LEN_OF_SSID
);

1238 i(
Ssid
 =
NULL
)

1239 
LabE
;

1240 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
pEdPm
, (
EDCA_PARM
));

1241 i(
pEdPm
 =
NULL
)

1242 
LabE
;

1243 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
VIE
, 
MAX_VIE_LEN
);

1244 i(
VIE
 =
NULL
)

1245 
LabE
;

1246 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
pHtCaby
, (
HT_CAPABILITY_IE
));

1247 i(
pHtCaby
 =
NULL
)

1248 
LabE
;

1249 
	`os_loc_mem
(
NULL
, (
UCHAR
 **)&
pAddHtInfo
, (
ADD_HT_INFO_IE
));

1250 i(
pAddHtInfo
 =
NULL
)

1251 
LabE
;

1254 
pVIE
 = (
PNDIS_802_11_VARIABLE_IEs

VIE
;

1255 
pVIE
->
Lgth
 = 0;

1256 
	`RTMPZoMemy
(
pHtCaby
, (
HT_CAPABILITY_IE
));

1257 
	`RTMPZoMemy
(
pAddHtInfo
, (
ADD_HT_INFO_IE
));

1258 
	`RTMPZoMemy
(&
ExtCInfo
, (ExtCapInfo));

1260 i(
	`PrBcAndProbeRSy
(
pAd
,

1261 
Em
->
Msg
,

1262 
Em
->
MsgL
,

1263 
Em
->
Chl
,

1264 
Addr2
,

1265 
Bssid
,

1266 
Ssid
,

1267 &
SsidL
,

1268 &
BssTy
,

1269 &
BcPiod
,

1270 &
Chl
,

1271 &
NewChl
,

1272 &
TimeSmp
,

1273 &
CfPm
,

1274 &
AtimW
,

1275 &
CabyInfo
,

1276 &
E
,

1277 &
DtimCou
,

1278 &
DtimPiod
,

1279 &
BFg
,

1280 &
MesgeToMe
,

1281 
SupRe
,

1282 &
SupReL
,

1283 
ExtRe
,

1284 &
ExtReL
,

1285 &
CkFg
,

1286 &
AڑClPowLim
,

1287 
pEdPm
,

1288 &
QbssLd
,

1289 &
QosCaby
,

1290 &
RkIe
,

1291 &
HtCabyL
,

1292 #ifde
CONFIG_STA_SUPPORT


1293 &
PNHtCabyL
,

1295 
pHtCaby
,

1296 &
ExtCInfo
,

1297 &
AddHtInfoL
,

1298 
pAddHtInfo
,

1299 &
NewExtChlOfft
,

1300 &
LVIE
,

1301 
pVIE
))

1303 
BOOLEAN
 
is_my_bssid
, 
is_my_ssid
;

1304 
ULONG
 
Bssidx
, 
Now
;

1305 
BSS_ENTRY
 *
pBss
;

1306 
CHAR
 
RlRssi
 = 
	`RTMPMaxRssi
(
pAd
, 
	`CvtToRssi
Ad, 
Em
->
Rssi0
, 
RSSI_0
), CvtToRssiAd, Em->
Rssi1
, 
RSSI_1
), CvtToRssiAd, Em->
Rssi2
, 
RSSI_2
));

1308 
is_my_bssid
 = 
	`MAC_ADDR_EQUAL
(
Bssid
, 
pAd
->
CommCfg
.Bssid)? 
TRUE
 : 
FALSE
;

1309 
is_my_ssid
 = 
	`SSID_EQUAL
(
Ssid
, 
SsidL
, 
pAd
->
CommCfg
.Ssid,Ad->CommCfg.SsidL)? 
TRUE
:
FALSE
;

1313 i(((
SsidL
 > 0&& !
is_my_ssid
|| (!
is_my_bssid
))

1314 
LabOK
;

1317 i(
pAd
->
Mlme
.
ClMache
.
CuS
 =
CNTL_WAIT_DISASSOC
)

1318 
LabOK
;

1320 #ifde
DOT11_N_SUPPORT


1322 i(
AddHtInfoL
 != 0)

1323 
Chl
 = 
pAddHtInfo
->
CڌCh
;

1325 i((
HtCabyL
 > 0|| (
PNHtCabyL
 > 0))

1326 
HtCabyL
 = 
SIZE_HT_CAP_IE
;

1332 
Bssidx
 = 
	`BssTabSrchWhSSID
(&
pAd
->
MlmeAux
.
SsidBssTab
, 
Bssid
, 
Ssid
, 
SsidL
, 
Chl
);

1333 i(
Bssidx
 =
BSS_NOT_FOUND
)

1336 
Bssidx
 = 
	`BssTabSEry
(
pAd
, &pAd->
MlmeAux
.
SsidBssTab
, 
Bssid
, 
Ssid
, 
SsidL
, 
BssTy
, 
BcPiod
,

1337 &
CfPm
, 
AtimW
, 
CabyInfo
, 
SupRe
, 
SupReL
, 
ExtRe
, 
ExtReL
,

1338 
pHtCaby
, 
pAddHtInfo
, 
HtCabyL
,
AddHtInfoL
,
NewExtChlOfft
, 
Chl
,

1339 
RlRssi
, 
TimeSmp
, 
CkFg
, 
pEdPm
, &
QosCaby
,

1340 &
QbssLd
, 
LVIE
, 
pVIE
);

1341 i(
Bssidx
 =
BSS_NOT_FOUND
)

1345 
PBSS_ENTRY
 
pBssEry
 = &
pAd
->
MlmeAux
.
SsidBssTab
.
BssEry
[
Bssidx
];

1346 
	`NdisMoveMemy
(&
pBssEry
->
PTSF
[0], &
Em
->
Msg
[24], 4);

1347 
	`NdisMoveMemy
(&
pBssEry
->
TTSF
[0], &
Em
->
TimeSmp
.
u
.
LowPt
, 4);

1348 
	`NdisMoveMemy
(&
pBssEry
->
TTSF
[4], &
Em
->
TimeSmp
.
u
.
LowPt
, 4);

1349 
pBssEry
->
Rssi
 = 
RlRssi
;

1351 
	`NdisMoveMemy
(
pBssEry
->
MacAddr
, 
Addr2
, 
MAC_ADDR_LEN
);

1360 
Bssidx
 = 
	`BssTabSrch
(&
pAd
->
SnTab
, 
Bssid
, 
Chl
);

1361 i(
Bssidx
 =
BSS_NOT_FOUND
)

1364 
Bssidx
 = 
	`BssTabSEry
(
pAd
, &pAd->
SnTab
, 
Bssid
, 
Ssid
, 
SsidL
, 
BssTy
, 
BcPiod
,

1365 &
CfPm
, 
AtimW
, 
CabyInfo
, 
SupRe
, 
SupReL
, 
ExtRe
, 
ExtReL
,

1366 
pHtCaby
, 
pAddHtInfo
, 
HtCabyL
,
AddHtInfoL
,
NewExtChlOfft
, 
Chl
,

1367 
RlRssi
, 
TimeSmp
, 
CkFg
, 
pEdPm
, &
QosCaby
,

1368 &
QbssLd
, 
LVIE
, 
pVIE
);

1369 i(
Bssidx
 =
BSS_NOT_FOUND
)

1370 
LabOK
;

1372 
	`NdisMoveMemy
(
pAd
->
SnTab
.
BssEry
[
Bssidx
].
PTSF
, &
Em
->
Msg
[24], 4);

1373 
	`NdisMoveMemy
(&
pAd
->
SnTab
.
BssEry
[
Bssidx
].
TTSF
[0], &
Em
->
TimeSmp
.
u
.
LowPt
, 4);

1374 
	`NdisMoveMemy
(&
pAd
->
SnTab
.
BssEry
[
Bssidx
].
TTSF
[4], &
Em
->
TimeSmp
.
u
.
LowPt
, 4);

1375 
pAd
->
SnTab
.
BssEry
[
Bssidx
].
MSNR
 = 
Em
->
Sigl
 % 10;

1376 i(
pAd
->
SnTab
.
BssEry
[
Bssidx
].
MSNR
 == 0)

1377 
pAd
->
SnTab
.
BssEry
[
Bssidx
].
MSNR
 = -5;

1379 
	`NdisMoveMemy
(
pAd
->
SnTab
.
BssEry
[
Bssidx
].
MacAddr
, 
Addr2
, 
MAC_ADDR_LEN
);

1385 i((
pAd
->
CommCfg
.
bIEEE80211H
 =1&& (
NewChl
 !0&& (
Chl
 != NewChannel))

1389 
	`AsicSwchChl
(
pAd
, 1, 
FALSE
);

1390 
	`AsicLockChl
(
pAd
, 1);

1391 
	`LkDown
(
pAd
, 
FALSE
);

1392 
	`MlmeQueueIn
(&
pAd
->
Mlme
.
Queue
);

1393 
	`BssTabIn
(&
pAd
->
SnTab
);

1394 
	`RTMPucDay
(1000000);

1397 
dex
 = 0 ; index < 
pAd
->
ChlLiNum
; index++)

1399 i(
pAd
->
ChlLi
[
dex
].
Chl
 =
NewChl
)

1401 
pAd
->
SnTab
.
BssEry
[
Bssidx
].
Chl
 = 
NewChl
;

1402 
pAd
->
CommCfg
.
Chl
 = 
NewChl
;

1403 
	`AsicSwchChl
(
pAd
,Ad->
CommCfg
.
Chl
, 
FALSE
);

1404 
	`AsicLockChl
(
pAd
,Ad->
CommCfg
.
Chl
);

1405 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("PrBc - STAeivchswchounmIE (New Ch=%d)\n", 
NewChl
));

1410 i(
dex
 >
pAd
->
ChlLiNum
)

1412 
	`DBGPRINT_ERR
(("PrBc(n fd New Chl=%d iChlLi[%d]\n", 
pAd
->
CommCfg
.
Chl
,Ad->
ChlLiNum
));

1416 i((((
pAd
->
SCfg
.
WStus
 !
Ndis802_11WEPDibd
) << 4) ^

1417 
CabyInfo
) &

1420 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s:APrivacy:%x idifn from STArivacy:%x\n", 
__FUNCTION__
, (
CabyInfo
 & 0x0010>> 4 , 
pAd
->
SCfg
.
WStus
 !
Ndis802_11WEPDibd
));

1421 i(
	`INFRA_ON
(
pAd
))

1423 
	`LkDown
(
pAd
,
FALSE
);

1424 
	`BssTabIn
(&
pAd
->
SnTab
);

1426 
LabOK
;

1432 i((! 
is_my_bssid
&& 
	`ADHOC_ON
(
pAd
))

1434 
INT
 
i
;

1436 i((
pAd
->
SCfg
.
WStus
 !pAd->
SnTab
.
BssEry
[
Bssidx
].WepStatus) ||

1437 (
pAd
->
SCfg
.
AuthMode
 !pAd->
SnTab
.
BssEry
[
Bssidx
].AuthMode))

1439 
LabOK
;

1442 
i
 = 0; i < 6; i++)

1444 i(
Bssid
[
i
] > 
pAd
->
CommCfg
.Bssid[i])

1446 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - mergeohe IBSS with bigger BSSID=%02x:%02x:%02x:%02x:%02x:%02x\n",

1447 
Bssid
[0], Bssid[1], Bssid[2], Bssid[3], Bssid[4], Bssid[5]));

1448 
	`AsicDibSync
(
pAd
);

1449 
	`COPY_MAC_ADDR
(
pAd
->
CommCfg
.
Bssid
, Bssid);

1450 
	`AsicSBssid
(
pAd
,Ad->
CommCfg
.
Bssid
);

1451 
	`MakeIbssBc
(
pAd
);

1452 
	`AsicEbIbssSync
(
pAd
);

1453 
is_my_bssid
 = 
TRUE
;

1456 i(
Bssid
[
i
] < 
pAd
->
CommCfg
.Bssid[i])

1462 
	`NdisGSyemUpTime
(&
Now
);

1463 
pBss
 = &
pAd
->
SnTab
.
BssEry
[
Bssidx
];

1464 
pBss
->
Rssi
 = 
RlRssi
;

1465 
pBss
->
LaBcRxTime
 = 
Now
;

1470 i(
is_my_bssid
)

1472 
RXWI_STRUC
 
RxWI
;

1474 #ifde
DOT11_N_SUPPORT


1475 #ifde
DOT11N_DRAFT3


1476 
OVERLAP_BSS_SCAN_IE
 
BssSn
;

1477 
UCHAR
 
RegCss
;

1478 
BOOLEAN
 
brc
;

1481 
brc
 = 
	`PrBcAndProbeRSy2
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, &
BssSn
, &
RegCss
);

1482 i(
brc
 =
TRUE
)

1484 
	`UpdeBssSnPm
(
pAd
, 
BssSn
);

1485 
pAd
->
SCfg
.
RegCss
 = RegClass;

1490 
pAd
->
SCfg
.
DtimCou
 = DtimCount;

1491 
pAd
->
SCfg
.
DtimPiod
 = DtimPeriod;

1492 
pAd
->
SCfg
.
LaBcRxTime
 = 
Now
;

1495 
RxWI
.
RSSI0
 = 
Em
->
Rssi0
;

1496 
RxWI
.
RSSI1
 = 
Em
->
Rssi1
;

1497 
RxWI
.
RSSI2
 = 
Em
->
Rssi2
;

1498 
RxWI
.
PHYMODE
 = 0;

1500 
	`Upde_Rssi_Same
(
pAd
, &pAd->
SCfg
.
RssiSame
, &
RxWI
);

1502 #ifde
LINUX


1503 #ifde
RT_CFG80211_SUPPORT


1508 i(
AڑClPowLim
 != 0xFF)

1514 
	`ChgeToClPowLim
(
pAd
, 
AڑClPowLim
);

1522 
pAd
->
CommCfg
.
TxPowPage
 =Ad->CommCfg.
TxPowDeu
;

1525 i(
	`ADHOC_ON
(
pAd
&& (
	`CAP_IS_IBSS_ON
(
CabyInfo
)))

1527 
UCHAR
 
MaxSu܋dReIn500Kbps
 = 0;

1528 
UCHAR
 
idx
;

1529 
MAC_TABLE_ENTRY
 *
pEry
;

1532 
idx
=0; idx<
SupReL
; idx++)

1534 i(
MaxSu܋dReIn500Kbps
 < (
SupRe
[
idx
] & 0x7f))

1535 
MaxSu܋dReIn500Kbps
 = 
SupRe
[
idx
] & 0x7f;

1538 
idx
=0; idx<
ExtReL
; idx++)

1540 i(
MaxSu܋dReIn500Kbps
 < (
ExtRe
[
idx
] & 0x7f))

1541 
MaxSu܋dReIn500Kbps
 = 
ExtRe
[
idx
] & 0x7f;

1545 
pEry
 = 
	`MacTabLookup
(
pAd
, 
Addr2
);

1549 i((
	`ADHOC_ON
(
pAd
&& (
Em
->
Wcid
 =
RESERVED_WCID
)) ||

1550 (
pEry
 && 
	`RTMP_TIME_AFTER
(
Now
,Ery->
LaBcRxTime
 + 
ADHOC_ENTRY_BEACON_LOST_TIME
)))

1552 i(
pEry
 =
NULL
)

1554 
pEry
 = 
	`MacTabInEry
(
pAd
, 
Addr2
, 
BSS0
, 
FALSE
);

1556 i(
	`SAddMacTabEry
(
pAd
,

1557 
pEry
,

1558 
MaxSu܋dReIn500Kbps
,

1559 
pHtCaby
,

1560 
HtCabyL
,

1561 
pAddHtInfo
,

1562 
AddHtInfoL
,

1563 
CabyInfo
=
FALSE
)

1565 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ADHOC - Add Entry failed.\n"));

1566 
LabOK
;

1568 
pEry
->
LaBcRxTime
 = 0;

1571 i(
pEry
 &&

1572 (
Em
->
Wcid
 =
RESERVED_WCID
))

1574 
idx
 = 
pAd
->
SCfg
.
DeuKeyId
;

1575 
	`RTMP_SET_WCID_SEC_INFO
(
pAd
, 
BSS0
, 
idx
,

1576 
pAd
->
ShedKey
[
BSS0
][
idx
].
ChAlg
,

1577 
pEry
->
Aid
,

1578 
SHAREDKEYTABLE
);

1582 i(
pEry
 && 
	`IS_ENTRY_CLIENT
(pEntry))

1583 
pEry
->
LaBcRxTime
 = 
Now
;

1586 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
))

1588 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_MEDIA_STATE_CONNECTED
);

1589 
	`RTMP_IndiMedS
(
pAd
, 
NdisMedSCed
);

1590 
pAd
->
ExaInfo
 = 
GENERAL_LINK_UP
;

1591 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("ADHOC fOP_STATUS_MEDIA_STATE_CONNECTED.\n"));

1595 i(
	`INFRA_ON
(
pAd
))

1597 
BOOLEAN
 
bUShtSl
, 
bUBGPrei
;

1606 
bUShtSl
 = 
	`CAP_IS_SHORT_SLOT
(
CabyInfo
);

1607 i(
bUShtSl
 !
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_SHORT_SLOT_INUSED
))

1608 
	`AsicSSlTime
(
pAd
, 
bUShtSl
);

1610 
bUBGPrei
 = (
pAd
->
CommCfg
.
UBGPrei
 == 1) ||

1611 ((
pAd
->
CommCfg
.
UBGPrei
 =0&& 
	`ERP_IS_USE_PROTECTION
(
E
));

1613 i(
pAd
->
CommCfg
.
Chl
 > 14)

1614 
bUBGPrei
 = 
FALSE
;

1616 i(
bUBGPrei
 !
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_BG_PROTECTION_INUSED
))

1618 i(
bUBGPrei
)

1620 
	`OPSTATUS_SET_FLAG
(
pAd
, 
fOP_STATUS_BG_PROTECTION_INUSED
);

1621 
	`AsicUpdePre
(
pAd
,Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
, (
OFDMSETPROTECT
|
CCKSETPROTECT
|
ALLN_SETPROTECT
),
FALSE
,Ad->MlmeAux.AddHtInfo.AddHtInfo2.
NGfP
 == 1));

1625 
	`OPSTATUS_CLEAR_FLAG
(
pAd
, 
fOP_STATUS_BG_PROTECTION_INUSED
);

1626 
	`AsicUpdePre
(
pAd
,Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
, (
OFDMSETPROTECT
|
CCKSETPROTECT
|
ALLN_SETPROTECT
),
TRUE
,Ad->MlmeAux.AddHtInfo.AddHtInfo2.
NGfP
 == 1));

1629 
	`DBGPRINT
(
RT_DEBUG_WARN
, ("SYNC - AP chged B/Greiځ%d\n", 
bUBGPrei
));

1632 #ifde
DOT11_N_SUPPORT


1634 i((
AddHtInfoL
 != 0) &&

1635 ((
pAddHtInfo
->
AddHtInfo2
.
OiMode
 !
pAd
->
MlmeAux
.
AddHtInfo
.AddHtInfo2.OperaionMode) ||

1636 (
pAddHtInfo
->
AddHtInfo2
.
NGfP
 !
pAd
->
MlmeAux
.
AddHtInfo
.AddHtInfo2.NonGfPresent)))

1638 
pAd
->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
NGfP
 = 
pAddHtInfo
->AddHtInfo2.NonGfPresent;

1639 
pAd
->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
 = 
pAddHtInfo
->AddHtInfo2.OperaionMode;

1640 i(
pAd
->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
NGfP
 == 1)

1642 
	`AsicUpdePre
(
pAd
,Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
, 
ALLN_SETPROTECT
, 
FALSE
, 
TRUE
);

1645 
	`AsicUpdePre
(
pAd
,Ad->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
, 
ALLN_SETPROTECT
, 
FALSE
, FALSE);

1647 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - AP chged N OiModt%d\n", 
pAd
->
MlmeAux
.
AddHtInfo
.
AddHtInfo2
.
OiMode
));

1651 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_SHORT_PREAMBLE_INUSED
) &&

1652 
	`ERP_IS_USE_BARKER_PREAMBLE
(
E
))

1654 
	`MlmeSTxPamb
(
pAd
, 
Rt802_11PambLg
);

1655 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - AP forcedo use LONGreamble\n"));

1658 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_WMM_INUSED
) &&

1659 (
pEdPm
->
bVid
 =
TRUE
) &&

1660 (
pEdPm
->
EdUpdeCou
 !
pAd
->
CommCfg
.
APEdPm
.EdcaUpdateCount))

1662 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - AP change EDCAarameters(from %do %d)\n",

1663 
pAd
->
CommCfg
.
APEdPm
.
EdUpdeCou
,

1664 
pEdPm
->
EdUpdeCou
));

1665 
	`AsicSEdPm
(
pAd
, 
pEdPm
);

1669 
	`NdisMoveMemy
(&
pAd
->
CommCfg
.
APQbssLd
, &
QbssLd
, (
QBSS_LOAD_PARM
));

1670 
	`NdisMoveMemy
(&
pAd
->
CommCfg
.
APQosCaby
, &
QosCaby
, (
QOS_CAPABILITY_PARM
));

1671 #ifde
DOT11_N_SUPPORT


1672 #ifde
DOT11N_DRAFT3


1675 i((
AddHtInfoL
 !0&& 
	`INFRA_ON
(
pAd
))

1677 
BOOLEAN
 
bChgeBW
 = 
FALSE
;

1683 i(
pAd
->
CommCfg
.
BBPCutBW
 =
BW_40
)

1685 i(((
pAddHtInfo
->
AddHtInfo
.
ExtChOfft
 =
EXTCHA_NONE
&& (pAddHtInfo->AddHtInfo.
RecomWidth
 == 0))

1686 ||(
NewExtChlOfft
==0x0)

1689 
bChgeBW
 = 
TRUE
;

1690 
pAd
->
CommCfg
.
CChl
 =Ad->CommCfg.
Chl
;

1691 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
BW
 = 0;

1692 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("FallBack from 40MHzo 20MHz(CtrlCh=%d, CentralCh=%d)\n",

1693 
pAd
->
CommCfg
.
Chl
,Ad->CommCfg.
CChl
));

1694 
	`ClChlWidth
(
pAd
,Ad->
CommCfg
.
Chl
,Ad->CommCfg.
CChl
, 
BW_20
, 0);

1703 i(((
pAd
->
CommCfg
.
BBPCutBW
 =
BW_20
||(
NewExtChlOfft
!=0x0)) &&

1704 (
pAd
->
CommCfg
.
DesedHtPhy
.
ChlWidth
 !
BW_20
)

1707 i((
pAddHtInfo
->
AddHtInfo
.
ExtChOfft
 !
EXTCHA_NONE
&& (
HtCabyL
>0&& (
pHtCaby
->
HtCInfo
.
ChlWidth
 == 1))

1709 i((
pAddHtInfo
->
CڌCh
 > 2)&& (pAddHtInfo->
AddHtInfo
.
ExtChOfft
 =
EXTCHA_BELOW
))

1711 
pAd
->
CommCfg
.
CChl
 = 
pAddHtInfo
->
CڌCh
 - 2;

1712 
bChgeBW
 = 
TRUE
;

1714 i((
pAddHtInfo
->
AddHtInfo
.
ExtChOfft
 =
EXTCHA_ABOVE
))

1716 
pAd
->
CommCfg
.
CChl
 = 
pAddHtInfo
->
CڌCh
 + 2;

1717 
bChgeBW
 = 
TRUE
;

1720 i(
bChgeBW
)

1722 
pAd
->
CommCfg
.
Chl
 = 
pAddHtInfo
->
CڌCh
;

1723 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("FallBack from 20MHzo 40MHz(CtrlCh=%d, CentralCh=%d)\n",

1724 
pAd
->
CommCfg
.
Chl
,Ad->CommCfg.
CChl
));

1725 
	`ClChlWidth
(
pAd
,Ad->
CommCfg
.
Chl
,Ad->CommCfg.
CChl
, 
BW_40
, 
pAddHtInfo
->
AddHtInfo
.
ExtChOfft
);

1726 
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
].
HTPhyMode
.
fld
.
BW
 = 1;

1731 i(
bChgeBW
)

1733 
pAd
->
CommCfg
.
BSSCxi2040
.
wd
 = 0;

1734 
	`TriEvtIn
(
pAd
);

1735 
	`BudEfedChlLi
(
pAd
);

1743 i((
	`INFRA_ON
(
pAd
&& (pAd->
SCfg
.
Psm
 =
PWR_SAVE
)|| (pAd->
CommCfg
.
bAPSDFPowSave
))

1745 
UCHAR
 
FeNumb
;

1751 i(
MesgeToMe
)

1753 #ifde
PCIE_PS_SUPPORT


1754 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

1757 i(
pAd
->
A
.
fld
.
RxPh
 > 1)

1758 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
,Ad->
SCfg
.
BBPR3
);

1762 i(
pAd
->
CommCfg
.
bAPSDCab
 &&Ad->CommCfg.
APEdPm
.bAPSDCapable &&

1763 
pAd
->
CommCfg
.
bAPSDAC_BE
 &&Ad->CommCfg.
bAPSDAC_BK
 &&Ad->CommCfg.
bAPSDAC_VI
 &&Ad->CommCfg.
bAPSDAC_VO
)

1765 
pAd
->
CommCfg
.
bNdSdTriggFme
 = 
TRUE
;

1769 i(
pAd
->
SCfg
.
WdowsBryPowMode
 =
Ndis802_11PowModeFa_PSP
)

1772 
	`RTMP_SET_PSM_BIT
(
pAd
, 
PWR_ACTIVE
);

1773 
	`RTMPSdNuFme
(
pAd
,

1774 
pAd
->
CommCfg
.
TxRe
,

1775 (
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_WMM_INUSED
? 
TRUE
:
FALSE
));

1780 
	`RTMP_PS_POLL_ENQUEUE
(
pAd
);

1784 i(
BFg
 && (
DtimCou
 =0&& 
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_RECEIVE_DTIM
))

1786 #ifde
PCIE_PS_SUPPORT


1787 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

1789 i(
pAd
->
A
.
fld
.
RxPh
 > 1)

1790 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
,Ad->
SCfg
.
BBPR3
);

1794 i((
pAd
->
TxSwQueue
[
QID_AC_BK
].
Numb
 != 0) ||

1795 (
pAd
->
TxSwQueue
[
QID_AC_BE
].
Numb
 != 0) ||

1796 (
pAd
->
TxSwQueue
[
QID_AC_VI
].
Numb
 != 0) ||

1797 (
pAd
->
TxSwQueue
[
QID_AC_VO
].
Numb
 != 0) ||

1798 (
	`RTMPFeTXDReque
(
pAd
, 
QID_AC_BK
, 
TX_RING_SIZE
 - 1, &
FeNumb
!
NDIS_STATUS_SUCCESS
) ||

1799 (
	`RTMPFeTXDReque
(
pAd
, 
QID_AC_BE
, 
TX_RING_SIZE
 - 1, &
FeNumb
!
NDIS_STATUS_SUCCESS
) ||

1800 (
	`RTMPFeTXDReque
(
pAd
, 
QID_AC_VI
, 
TX_RING_SIZE
 - 1, &
FeNumb
!
NDIS_STATUS_SUCCESS
) ||

1801 (
	`RTMPFeTXDReque
(
pAd
, 
QID_AC_VO
, 
TX_RING_SIZE
 - 1, &
FeNumb
!
NDIS_STATUS_SUCCESS
) ||

1802 (
	`RTMPFeTXDReque
(
pAd
, 
QID_MGMT
, 
MGMT_RING_SIZE
 - 1, &
FeNumb
!
NDIS_STATUS_SUCCESS
))

1806 #ifde
PCIE_PS_SUPPORT


1807 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_ADVANCE_POWER_SAVE_PCIE_DEVICE
))

1809 i(
pAd
->
A
.
fld
.
RxPh
 > 1)

1810 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
,Ad->
SCfg
.
BBPR3
);

1816 i((
pAd
->
CommCfg
.
bACMAPSDTr
[
QID_AC_VO
]) ||

1817 (
pAd
->
CommCfg
.
bACMAPSDTr
[
QID_AC_VI
]) ||

1818 (
pAd
->
CommCfg
.
bACMAPSDTr
[
QID_AC_BK
]) ||

1819 (
pAd
->
CommCfg
.
bACMAPSDTr
[
QID_AC_BE
]))

1845 
USHORT
 
NextDtim
 = 
DtimCou
;

1848 i(
NextDtim
 == 0)

1849 
NextDtim
 = 
DtimPiod
;

1851 
TbNumToNextWakeUp
 = 
pAd
->
SCfg
.
DeuLiCou
;

1852 i(
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_RECEIVE_DTIM
&& (
TbNumToNextWakeUp
 > 
NextDtim
))

1853 
TbNumToNextWakeUp
 = 
NextDtim
;

1855 i(!
	`OPSTATUS_TEST_FLAG
(
pAd
, 
fOP_STATUS_DOZE
))

1858 
pAd
->
ThisTbNumToNextWakeUp
 = 
TbNumToNextWakeUp
;

1859 
	`AsicS˕ThAutoWakeup
(
pAd
,Ad->
ThisTbNumToNextWakeUp
);

1868 
LabOK
;

1870 
LabE
:

1871 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("%s: Ao memy fa!!!\n", 
__FUNCTION__
));

1873 
LabOK
:

1874 i(
Ssid
 !
NULL
)

1875 
	`os__mem
(
NULL
, 
Ssid
);

1876 i(
pEdPm
 !
NULL
)

1877 
	`os__mem
(
NULL
, 
pEdPm
);

1878 i(
VIE
 !
NULL
)

1879 
	`os__mem
(
NULL
, 
VIE
);

1880 i(
pHtCaby
 !
NULL
)

1881 
	`os__mem
(
NULL
, 
pHtCaby
);

1882 i(
pAddHtInfo
 !
NULL
)

1883 
	`os__mem
(
NULL
, 
pAddHtInfo
);

1885 
	}
}

1893 
VOID
 
	$PrProbeReqAi
(

1894 
IN
 
PRTMP_ADAPTER
 
pAd
,

1895 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

1897 
UCHAR
 
Addr2
[
MAC_ADDR_LEN
];

1898 
CHAR
 
Ssid
[
MAX_LEN_OF_SSID
];

1899 
UCHAR
 
SsidL
;

1900 #ifde
DOT11_N_SUPPORT


1901 
UCHAR
 
HtL
, 
AddHtL
, 
NewExtL
;

1903 
HEADER_802_11
 
ProbeRHdr
;

1904 
NDIS_STATUS
 
NStus
;

1905 
PUCHAR
 
pOutBufr
 = 
NULL
;

1906 
ULONG
 
FmeL
 = 0;

1907 
LARGE_INTEGER
 
FakeTimeamp
;

1908 
UCHAR
 
DsL
 = 1, 
IbssL
 = 2;

1909 
UCHAR
 
LolEIe
[3] = {
IE_ERP
, 1, 0};

1910 
BOOLEAN
 
Privacy
;

1911 
USHORT
 
CabyInfo
;

1913 i(! 
	`ADHOC_ON
(
pAd
))

1916 i(
	`PrProbeReqSy
(
pAd
, 
Em
->
Msg
, Em->
MsgL
, 
Addr2
, 
Ssid
, &
SsidL
, 
NULL
))

1918 i((
SsidL
 =0|| 
	`SSID_EQUAL
(
Ssid
, SsidL, 
pAd
->
CommCfg
.Ssid,Ad->CommonCfg.SsidLen))

1921 
NStus
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

1922 i(
NStus
 !
NDIS_STATUS_SUCCESS
)

1926 
	`MgtMacHdIn
(
pAd
, &
ProbeRHdr
, 
SUBTYPE_PROBE_RSP
, 0, 
Addr2
,Ad->
CommCfg
.
Bssid
);

1928 
Privacy
 = (
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi1Ebd
) ||

1929 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi2Ebd
) ||

1930 (
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi3Ebd
);

1931 
CabyInfo
 = 
	`CAP_GENERATE
(0, 1, 
Privacy
, (
pAd
->
CommCfg
.
TxPamb
 =
Rt802_11PambSht
), 0, 0);

1933 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

1934 (
HEADER_802_11
), &
ProbeRHdr
,

1935 
TIMESTAMP_LEN
, &
FakeTimeamp
,

1936 2, &
pAd
->
CommCfg
.
BcPiod
,

1937 2, &
CabyInfo
,

1938 1, &
SsidIe
,

1939 1, &
pAd
->
CommCfg
.
SsidL
,

1940 
pAd
->
CommCfg
.
SsidL
,Ad->CommCfg.
Ssid
,

1941 1, &
SupReIe
,

1942 1, &
pAd
->
SAive
.
SupReL
,

1943 
pAd
->
SAive
.
SupReL
,Ad->SAive.
SupRe
,

1944 1, &
DsIe
,

1945 1, &
DsL
,

1946 1, &
pAd
->
CommCfg
.
Chl
,

1947 1, &
IbssIe
,

1948 1, &
IbssL
,

1949 2, &
pAd
->
SAive
.
AtimW
,

1950 
END_OF_ARGS
);

1952 i(
pAd
->
SAive
.
ExtReL
)

1954 
ULONG
 
tmp
;

1955 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

1956 3, 
LolEIe
,

1957 1, &
ExtReIe
,

1958 1, &
pAd
->
SAive
.
ExtReL
,

1959 
pAd
->
SAive
.
ExtReL
, &pAd->SAive.
ExtRe
,

1960 
END_OF_ARGS
);

1961 
FmeL
 +
tmp
;

1965 i((
pAd
->
SCfg
.
AuthMode
 =
Ndis802_11AuthModeWPANe
)

1968 
ULONG
 
tmp
;

1969 
UCHAR
 
RSNIe
 = 
IE_WPA
;

1972 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
tmp
,

1973 1, &
RSNIe
,

1974 1, &
pAd
->
SCfg
.
RSNIE_L
,

1975 
pAd
->
SCfg
.
RSNIE_L
,Ad->SCfg.
RSN_IE
,

1976 
END_OF_ARGS
);

1977 
FmeL
 +
tmp
;

1980 #ifde
DOT11_N_SUPPORT


1981 i(
pAd
->
CommCfg
.
PhyMode
 >
PHY_11ABGN_MIXED
)

1983 
ULONG
 
TmpL
;

1984 
USHORT
 
igm__n
;

1985 
UCHAR
 
BROADCOM
[4] = {0x0, 0x90, 0x4c, 0x33};

1986 
HtL
 = (
pAd
->
CommCfg
.
HtCaby
);

1987 
AddHtL
 = (
pAd
->
CommCfg
.
AddHTInfo
);

1988 
NewExtL
 = 1;

1990 i(
pAd
->
bBrdComHT
 =
TRUE
)

1992 
igm__n
 = 
pAd
->
MlmeAux
.
HtCabyL
 + 4;

1993 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
TmpL
,

1994 1, &
WIe
,

1995 1, &
igm__n
,

1996 4, &
BROADCOM
[0],

1997 
pAd
->
MlmeAux
.
HtCabyL
, &pAd->MlmeAux.
HtCaby
,

1998 
END_OF_ARGS
);

2002 
	`MakeOutgogFme
(
pOutBufr
 + 
FmeL
, &
TmpL
,

2003 1, &
HtCIe
,

2004 1, &
HtL
,

2005 (
HT_CAPABILITY_IE
), &
pAd
->
CommCfg
.
HtCaby
,

2006 1, &
AddHtInfoIe
,

2007 1, &
AddHtL
,

2008 (
ADD_HT_INFO_IE
), &
pAd
->
CommCfg
.
AddHTInfo
,

2009 1, &
NewExtChIe
,

2010 1, &
NewExtL
,

2011 (
NEW_EXT_CHAN_IE
), &
pAd
->
CommCfg
.
NewExtChOfft
,

2012 
END_OF_ARGS
);

2014 
FmeL
 +
TmpL
;

2020 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

2021 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

2024 
	}
}

2026 
VOID
 
	$BcTimeoutAtJoAi
(

2027 
IN
 
PRTMP_ADAPTER
 
pAd
,

2028 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

2030 
USHORT
 
Stus
;

2031 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("SYNC - BeaconTimeoutAtJoinAction\n"));

2032 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

2033 
Stus
 = 
MLME_REJ_TIMEOUT
;

2034 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_JOIN_CONF
, 2, &
Stus
, 0);

2035 
	}
}

2043 
VOID
 
	$SnTimeoutAi
(

2044 
IN
 
PRTMP_ADAPTER
 
pAd
,

2045 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

2049 i(
pAd
->
SCfg
.
bFaC
 && !pAd->SCfg.
bNFSn
)

2051 
pAd
->
MlmeAux
.
Chl
 = 0;

2052 
pAd
->
SCfg
.
bNFSn
 = 
TRUE
;

2055 
pAd
->
MlmeAux
.
Chl
 = 
	`NextChl
(pAd,Ad->MlmeAux.Channel);

2058 i((
pAd
->
MlmeAux
.
SnTy
 =
SCAN_CISCO_ACTIVE
) ||

2059 (
pAd
->
MlmeAux
.
SnTy
 =
SCAN_CISCO_PASSIVE
) ||

2060 (
pAd
->
MlmeAux
.
SnTy
 =
SCAN_CISCO_NOISE
) ||

2061 (
pAd
->
MlmeAux
.
SnTy
 =
SCAN_CISCO_CHANNEL_LOAD
))

2062 
pAd
->
MlmeAux
.
Chl
 = 0;

2065 
	`SnNextChl
(
pAd
);

2066 
	}
}

2073 
VOID
 
	$InvidSWhSn
(

2074 
IN
 
PRTMP_ADAPTER
 
pAd
,

2075 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

2077 
USHORT
 
Stus
;

2078 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("AYNC - InvidSWhSn(e=%ld). ReSYNC mache\n", 
pAd
->
Mlme
.
SyncMache
.
CuS
));

2079 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

2080 
Stus
 = 
MLME_STATE_MACHINE_REJECT
;

2081 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_SCAN_CONF
, 2, &
Stus
, 0);

2082 
	}
}

2089 
VOID
 
	$InvidSWhJo
(

2090 
IN
 
PRTMP_ADAPTER
 
pAd
,

2091 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

2093 
USHORT
 
Stus
;

2094 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("InvidSWhJo(e=%ld). ReSYNC mache\n", 
pAd
->
Mlme
.
SyncMache
.
CuS
));

2095 i(
	`RTMP_TEST_FLAG
(
pAd
, 
fRTMP_ADAPTER_BSS_SCAN_IN_PROGRESS
))

2097 
	`RTMPResumeMsduTnsmissi
(
pAd
);

2099 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

2100 
Stus
 = 
MLME_STATE_MACHINE_REJECT
;

2101 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_JOIN_CONF
, 2, &
Stus
, 0);

2102 
	}
}

2109 
VOID
 
	$InvidSWhS
(

2110 
IN
 
PRTMP_ADAPTER
 
pAd
,

2111 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

2113 
USHORT
 
Stus
;

2114 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("InvidSWhS(e=%ld). ReSYNC mache\n", 
pAd
->
Mlme
.
SyncMache
.
CuS
));

2115 
pAd
->
Mlme
.
SyncMache
.
CuS
 = 
SYNC_IDLE
;

2116 
Stus
 = 
MLME_STATE_MACHINE_REJECT
;

2117 
	`MlmeEnqueue
(
pAd
, 
MLME_CNTL_STATE_MACHINE
, 
MT2_START_CONF
, 2, &
Stus
, 0);

2118 
	}
}

2128 
VOID
 
	$EnqueuePsPl
(

2129 
IN
 
PRTMP_ADAPTER
 
pAd
)

2131 #ifde
RALINK_ATE


2132 i(
	`ATE_ON
(
pAd
))

2139 i(
pAd
->
SCfg
.
WdowsPowMode
 =
Ndis802_11PowModeLegacy_PSP
)

2140 
pAd
->
PsPlFme
.
FC
.
PwrMgmt
 = 
PWR_SAVE
;

2141 
	`MtMMReque
(
pAd
, 0, (
PUCHAR
)&pAd->
PsPlFme
, (
PSPOLL_FRAME
));

2142 
	}
}

2150 
VOID
 
	$EnqueueProbeReque
(

2151 
IN
 
PRTMP_ADAPTER
 
pAd
)

2153 
NDIS_STATUS
 
NS
;

2154 
PUCHAR
 
pOutBufr
;

2155 
ULONG
 
FmeL
 = 0;

2156 
HEADER_802_11
 
Hdr80211
;

2158 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("force out ProbeRequest ...\n"));

2160 
NS
 = 
	`MlmeAoMemy
(
pAd
, &
pOutBufr
);

2161 i(
NS
 =
NDIS_STATUS_SUCCESS
)

2163 
	`MgtMacHdIn
(
pAd
, &
Hdr80211
, 
SUBTYPE_PROBE_REQ
, 0, 
BROADCAST_ADDR
, BROADCAST_ADDR);

2166 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

2167 (
HEADER_802_11
), &
Hdr80211
,

2168 1, &
SsidIe
,

2169 1, &
pAd
->
CommCfg
.
SsidL
,

2170 
pAd
->
CommCfg
.
SsidL
,Ad->CommCfg.
Ssid
,

2171 1, &
SupReIe
,

2172 1, &
pAd
->
SAive
.
SupReL
,

2173 
pAd
->
SAive
.
SupReL
,Ad->SAive.
SupRe
,

2174 
END_OF_ARGS
);

2175 
	`MtMMReque
(
pAd
, 0, 
pOutBufr
, 
FmeL
);

2176 
	`MlmeFeMemy
(
pAd
, 
pOutBufr
);

2179 
	}
}

2181 #ifde
DOT11_N_SUPPORT


2182 #ifde
DOT11N_DRAFT3


2183 
VOID
 
	$BudEfedChlLi
(

2184 
IN
 
PRTMP_ADAPTER
 
pAd
)

2186 
UCHAR
 
EChl
[11];

2187 
UCHAR
 
i
, 
j
, 
k
;

2188 
UCHAR
 
UChl
 = 0, 
LowChl
 = 0;

2190 
	`RTMPZoMemy
(
EChl
, 11);

2191 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BuildEffectedChannelList:CtrlCh=%d,CentCh=%d,AuxCtrlCh=%d,AuxExtCh=%d\n",

2192 
pAd
->
CommCfg
.
Chl
,Ad->CommCfg.
CChl
,

2193 
pAd
->
MlmeAux
.
AddHtInfo
.
CڌCh
,

2194 
pAd
->
MlmeAux
.
AddHtInfo
.AddHtInfo.
ExtChOfft
));

2199 
k
 = 0;k < 
pAd
->
ChlLiNum
;k++)

2201 i(
pAd
->
ChlLi
[
k
].
Chl
 <=14 )

2202 
pAd
->
ChlLi
[
k
].
bEfedChl
 = 
TRUE
;

2207 
i
 = 0;

2209 i(
pAd
->
CommCfg
.
CChl
 <Ad->CommCfg.
Chl
)

2211 
UChl
 = 
pAd
->
CommCfg
.
Chl
;

2212 
LowChl
 = 
pAd
->
CommCfg
.
CChl
-2;

2214 i(
pAd
->
CommCfg
.
CChl
 >Ad->CommCfg.
Chl
)

2216 
UChl
 = 
pAd
->
CommCfg
.
CChl
+2;

2217 
LowChl
 = 
pAd
->
CommCfg
.
Chl
;

2221 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("LinkUP 20MHz . No Effected Channel \n"));

2226 
	`DeEfedChlLi
(
pAd
);

2228 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("BudEfedChlLi!LowCh~ UChl; %d ~ %d \n", 
LowChl
, 
UChl
));

2231 i(
LowChl
 > 1)

2233 
EChl
[0] = 
LowChl
 - 1;

2234 
i
 = 1;

2235 i(
LowChl
 > 2)

2237 
EChl
[1] = 
LowChl
 - 2;

2238 
i
 = 2;

2239 i(
LowChl
 > 3)

2241 
EChl
[2] = 
LowChl
 - 3;

2242 
i
 = 3;

2247 
k
 = 
LowChl
;k <
UChl
;k++)

2249 
EChl
[
i
] = 
k
;

2250 
i
++;

2253 i(
UChl
 < 14)

2255 
EChl
[
i
] = 
UChl
 + 1;

2256 
i
++;

2257 i(
UChl
 < 13)

2259 
EChl
[
i
] = 
UChl
 + 2;

2260 
i
++;

2261 i(
UChl
 < 12)

2263 
EChl
[
i
] = 
UChl
 + 3;

2264 
i
++;

2270 
j
 = 0;j < 
i
;j++)

2272 
k
 = 0;k < 
pAd
->
ChlLiNum
;k++)

2274 i(
pAd
->
ChlLi
[
k
].
Chl
 =
EChl
[
j
])

2276 
pAd
->
ChlLi
[
k
].
bEfedChl
 = 
TRUE
;

2277 
	`DBGPRINT
(
RT_DEBUG_TRACE
,(" EfedChl[%d]=%d)\n", 
k
, 
EChl
[
j
]));

2282 
	}
}

2285 
VOID
 
	$DeEfedChlLi
(

2286 
IN
 
PRTMP_ADAPTER
 
pAd
)

2288 
UCHAR
 
i
;

2291 
i
 = 0; i < 
pAd
->
ChlLiNum
; i++)

2293 
pAd
->
ChlLi
[
i
].
bEfedChl
 = 
FALSE
;

2295 
	}
}

2318 
VOID
 
	$ClChlWidth
(

2319 
IN
 
PRTMP_ADAPTER
 
pAd
,

2320 
IN
 
UCHAR
 
PrimyChl
,

2321 
IN
 
UCHAR
 
CChl
,

2322 
IN
 
UCHAR
 
ChlWidth
,

2323 
IN
 
UCHAR
 
SecdyChlOfft
)

2325 
UCHAR
 
Vue
 = 0;

2326 
UINT32
 
Da
 = 0;

2329 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: PrimyChl[%d] \n",
__FUNCTION__
,
PrimyChl
));

2330 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: CChl[%d] \n",
__FUNCTION__
,
CChl
));

2331 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: ChlWidth[%d] \n",
__FUNCTION__
,
ChlWidth
));

2332 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%s: SecdyChlOfft[%d] \n",
__FUNCTION__
,
SecdyChlOfft
));

2334 #ifde
DOT11_N_SUPPORT


2336 i(
ChlWidth
 =
BW_40
)

2338 if(
SecdyChlOfft
 =
EXTCHA_ABOVE
)

2341 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_40
;

2342 
	`AsicSwchChl
(
pAd
, 
CChl
, 
FALSE
);

2343 
	`AsicLockChl
(
pAd
, 
CChl
);

2345 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
Vue
);

2346 
Vue
 &= (~0x18);

2347 
Vue
 |= 0x10;

2348 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
Vue
);

2351 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
Vue
);

2352 
Vue
 &= (~0x20);

2353 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
Vue
);

2354 #ifde
RTMP_MAC_PCI


2355 
pAd
->
SCfg
.
BBPR3
 = 
Vue
;

2358 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Da
);

2359 
Da
 &= 0xfffffffe;

2360 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Da
);

2362 i(
pAd
->
MACVsi
 == 0x28600100)

2364 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x1A);

2365 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x0A);

2366 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x16);

2367 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!rt2860C !!! \n" ));

2370 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!40MHz Low !!! Cڌ Chȩ Bow. C = %d \n", 
pAd
->
CommCfg
.
CChl
 ));

2372 i(
SecdyChlOfft
 =
EXTCHA_BELOW
)

2375 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_40
;

2376 
	`AsicSwchChl
(
pAd
, 
CChl
, 
FALSE
);

2377 
	`AsicLockChl
(
pAd
, 
CChl
);

2379 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
Vue
);

2380 
Vue
 &= (~0x18);

2381 
Vue
 |= 0x10;

2382 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
Vue
);

2384 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Da
);

2385 
Da
 |= 0x1;

2386 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Da
);

2388 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
Vue
);

2389 
Vue
 |= (0x20);

2390 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
Vue
);

2391 #ifde
RTMP_MAC_PCI


2392 
pAd
->
SCfg
.
BBPR3
 = 
Vue
;

2395 i(
pAd
->
MACVsi
 == 0x28600100)

2397 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x1A);

2398 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x0A);

2399 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x16);

2400 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!rt2860C !!! \n" ));

2403 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! 40MHz U !!! Cڌ Chȩ UC = %d \n", 
CChl
));

2409 
pAd
->
CommCfg
.
BBPCutBW
 = 
BW_20
;

2410 
	`AsicSwchChl
(
pAd
, 
PrimyChl
, 
FALSE
);

2411 
	`AsicLockChl
(
pAd
, 
PrimyChl
);

2413 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R4
, &
Vue
);

2414 
Vue
 &= (~0x18);

2415 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R4
, 
Vue
);

2417 
	`RTMP_IO_READ32
(
pAd
, 
TX_BAND_CFG
, &
Da
);

2418 
Da
 &= 0xfffffffe;

2419 
	`RTMP_IO_WRITE32
(
pAd
, 
TX_BAND_CFG
, 
Da
);

2421 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R3
, &
Vue
);

2422 
Vue
 &= (~0x20);

2423 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R3
, 
Vue
);

2424 #ifde
RTMP_MAC_PCI


2425 
pAd
->
SCfg
.
BBPR3
 = 
Vue
;

2428 i(
pAd
->
MACVsi
 == 0x28600100)

2430 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R69
, 0x16);

2431 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R70
, 0x08);

2432 
	`RTMP_BBP_IO_WRITE8_BY_REG_ID
(
pAd
, 
BBP_R73
, 0x11);

2433 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!!rt2860C !!! \n" ));

2436 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("!!! 20MHz !!! \n" ));

2439 
	`RTMPSAGCInVue
(
pAd
,Ad->
CommCfg
.
BBPCutBW
);

2441 
	`RTMP_BBP_IO_READ8_BY_REG_ID
(
pAd
, 
BBP_R66
, &pAd->
BbpTung
.
R66CutVue
);

2442 
	}
}

	@sta/wpa.c

38 
	~"_cfig.h
"

40 
c_by_y
(
UCHAR
 *
cou
, 
n
);

61 
VOID
 
	$RTMPRtMicE
(

62 
IN
 
PRTMP_ADAPTER
 
pAd
,

63 
IN
 
PCIPHER_KEY
 
pWKey
)

65 
ULONG
 
Now
;

66 
UCHAR
 
uniKey
 = (
pWKey
->
Ty
 =
PAIRWISE_KEY
 ? 1:0);

69 
	`NdisGSyemUpTime
(&
Now
);

70 i(
pAd
->
SCfg
.
MicEC
 == 0)

72 
pAd
->
SCfg
.
MicEC
++;

73 
pAd
->
SCfg
.
LaMicETime
 = 
Now
;

74 
	`NdisZoMemy
(
pAd
->
SCfg
.
RyCou
, 8);

76 i(
pAd
->
SCfg
.
MicEC
 == 1)

78 i((
pAd
->
SCfg
.
LaMicETime
 + (60 * 
OS_HZ
)< 
Now
)

81 
pAd
->
SCfg
.
LaMicETime
 = 
Now
;

86 
	`RTMPSdWessEvt
(
pAd
, 
IW_COUNTER_MEASURES_EVENT_FLAG
,Ad->
MacTab
.
Cڋ
[
BSSID_WCID
].
Addr
, 
BSS0
, 0);

88 
pAd
->
SCfg
.
LaMicETime
 = 
Now
;

90 
pAd
->
SCfg
.
MicEC
++;

110 
	`MlmeEnqueue
(
pAd
,

111 
MLME_CNTL_STATE_MACHINE
,

112 
OID_802_11_MIC_FAILURE_REPORT_FRAME
,

114 &
uniKey
, 0);

116 i(
pAd
->
SCfg
.
MicEC
 == 2)

118 
	`RTMPSTim
(&
pAd
->
SCfg
.
WDissocAndBlockAssocTim
, 100);

120 
	}
}

123 #ifde
WPA_SUPPLICANT_SUPPORT


124 
	#LENGTH_EAP_H
 4

	)

126 
INT
 
	$WCheckECode
(

127 
IN
 
PRTMP_ADAPTER
 
pAd
,

128 
IN
 
PUCHAR
 
pFme
,

129 
IN
 
USHORT
 
FmeL
,

130 
IN
 
USHORT
 
OffS
)

133 
PUCHAR
 
pDa
;

134 
INT
 
su
 = 0;

136 if
FmeL
 < 
OffS
 + 
LENGTH_EAPOL_H
 + 
LENGTH_EAP_H
 )

137  
su
;

139 
pDa
 = 
pFme
 + 
OffS
;

141 if(*(
pDa
+1=
EAPPack
)

143 
su
 = *(
pDa
+4);

146  
su
;

147 
	}
}

149 
VOID
 
	$WSdMicFauToWSuli
(

150 
IN
 
PRTMP_ADAPTER
 
pAd
,

151 
IN
 
BOOLEAN
 
bUni
)

153 
cuom
[
IW_CUSTOM_MAX
] = {0};

155 
	`rtf
(
cuom
, "MLME-MICHAELMICFAILURE.indication");

156 if(
bUni
)

157 
	`rtf
(
cuom
, "%s unicast", custom);

159 
	`RtmpOSWrssEvtSd
(
pAd
, 
IWEVCUSTOM
, -1, 
NULL
, (
PUCHAR
)
cuom
, 
	`
(custom));

162 
	}
}

165 
VOID
 
	$WMicFauRtFme
(

166 
IN
 
PRTMP_ADAPTER
 
pAd
,

167 
IN
 
MLME_QUEUE_ELEM
 *
Em
)

169 
PUCHAR
 
pOutBufr
 = 
NULL
;

170 
UCHAR
 
Hd802_3
[14];

171 
ULONG
 
FmeL
 = 0;

172 
UCHAR
 *
mpo
;

173 
PEAPOL_PACKET
 
pPack
;

174 
UCHAR
 
Mic
[16];

175 
BOOLEAN
 
bUni
;

177 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("WpaMicFailureReportFrame ----->\n"));

179 
bUni
 = (
Em
->
Msg
[0] =1 ? 
TRUE
:
FALSE
);

180 
pAd
->
Sequ
 = (Ad->Sequ+ 1& (
MAX_SEQ_NUMBER
);

183 
	`MAKE_802_3_HEADER
(
Hd802_3
, 
pAd
->
CommCfg
.
Bssid
,Ad->
CutAddss
, 
EAPOL
);

186 
	`os_loc_mem
(
NULL
, (
PUCHAR
 *)&
mpo
, 
TX_EAPOL_BUFFER
);

187 i(
mpo
 =
NULL
)

189 
	`DBGPRINT
(
RT_DEBUG_ERROR
, ("!!!%:memy!!!\n", 
__FUNCTION__
));

193 
pPack
 = (
PEAPOL_PACKET
)
mpo
;

194 
	`NdisZoMemy
(
pPack
, 
TX_EAPOL_BUFFER
);

196 
pPack
->
ProV
 = 
EAPOL_VER
;

197 
pPack
->
ProTy
 = 
EAPOLKey
;

199 
pPack
->
KeyDesc
.
Ty
 = 
WPA1_KEY_DESC
;

202 
pPack
->
KeyDesc
.
KeyInfo
.
Reque
 = 1;

204 if(
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi3Ebd
)

206 
pPack
->
KeyDesc
.
KeyInfo
.
KeyDescV
 = 2;

210 
pPack
->
KeyDesc
.
KeyInfo
.
KeyDescV
 = 1;

213 
pPack
->
KeyDesc
.
KeyInfo
.
KeyTy
 = (
bUni
 ? 
PAIRWISEKEY
 : 
GROUPKEY
);

216 
pPack
->
KeyDesc
.
KeyInfo
.
KeyMic
 = 1;

219 
pPack
->
KeyDesc
.
KeyInfo
.
E
 = 1;

222 
	`SET_UINT16_TO_ARRARY
(
pPack
->
Body_L
, 
MIN_LEN_OF_EAPOL_KEY_MSG
)

225 
	`NdisMoveMemy
(
pPack
->
KeyDesc
.
RyCou
, 
pAd
->
SCfg
.RyCou, 
LEN_KEY_DESC_REPLAY
);

226 
	`c_by_y
(
pAd
->
SCfg
.
RyCou
, 8);

229 *((
USHORT
 *)&
pPack
->
KeyDesc
.
KeyInfo

	`u216
(*((USHORT *)&pPacket->KeyDesc.KeyInfo));

232 
	`MlmeAoMemy
(
pAd
, (
PUCHAR
 *)&
pOutBufr
);

233 if(
pOutBufr
 =
NULL
)

235 
	`os__mem
(
NULL
, 
mpo
);

241 
	`MakeOutgogFme
(
pOutBufr
, &
FmeL
,

242 
	`CONV_ARRARY_TO_UINT16
(
pPack
->
Body_L
) + 4,Packet,

243 
END_OF_ARGS
);

246 
	`NdisZoMemy
(
Mic
, (Mic));

247 if(
pAd
->
SCfg
.
WStus
 =
Ndis802_11Enyi3Ebd
)

249 
UCHAR
 
dige
[20] = {0};

250 
	`RT_HMAC_SHA1
(
pAd
->
SCfg
.
PTK
, 
LEN_PTK_KCK
, 
pOutBufr
, 
FmeL
, 
dige
, 
SHA1_DIGEST_SIZE
);

251 
	`NdisMoveMemy
(
Mic
, 
dige
, 
LEN_KEY_DESC_MIC
);

255 
	`RT_HMAC_MD5
(
pAd
->
SCfg
.
PTK
, 
LEN_PTK_KCK
, 
pOutBufr
, 
FmeL
, 
Mic
, 
MD5_DIGEST_SIZE
);

257 
	`NdisMoveMemy
(
pPack
->
KeyDesc
.
KeyMic
, 
Mic
, 
LEN_KEY_DESC_MIC
);

260 
	`RTMPToWessS
(
pAd
, &pAd->
MacTab
.
Cڋ
[
BSSID_WCID
],

261 
Hd802_3
, 
LENGTH_802_3
,

262 (
PUCHAR
)
pPack
,

263 
	`CONV_ARRARY_TO_UINT16
(
pPack
->
Body_L
+ 4, 
FALSE
);

265 
	`MlmeFeMemy
(
pAd
, (
PUCHAR
)
pOutBufr
);

267 
	`os__mem
(
NULL
, 
mpo
);

269 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("WpaMicFailureReportFrame <-----\n"));

270 
	}
}

281 
	$c_by_y
(
UCHAR
 *
cou
, 
n
)

283 
pos
 = 
n
 - 1;

284 
pos
 >= 0) {

285 
cou
[
pos
]++;

286 i(
cou
[
pos
] != 0)

288 
pos
--;

290 
	}
}

292 
VOID
 
	$WDissocApAndBlockAssoc
(

293 
IN
 
PVOID
 
SyemScific1
,

294 
IN
 
PVOID
 
FuniCڋxt
,

295 
IN
 
PVOID
 
SyemScific2
,

296 
IN
 
PVOID
 
SyemScific3
)

298 
RTMP_ADAPTER
 *
pAd
 = (
PRTMP_ADAPTER
)
FuniCڋxt
;

299 
MLME_DISASSOC_REQ_STRUCT
 
DissocReq
;

302 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("RTMPReportMicError - disassociate with current APfter sending second continuous EAPOL frame\n"));

303 
	`DissocPmFl
(
pAd
, &
DissocReq
,Ad->
CommCfg
.
Bssid
, 
REASON_MIC_FAILURE
);

304 
	`MlmeEnqueue
(
pAd
, 
ASSOC_STATE_MACHINE
, 
MT2_MLME_DISASSOC_REQ
, (
MLME_DISASSOC_REQ_STRUCT
), &
DissocReq
, 0);

306 
pAd
->
Mlme
.
ClMache
.
CuS
 = 
CNTL_WAIT_DISASSOC
;

307 
pAd
->
SCfg
.
bBlockAssoc
 = 
TRUE
;

308 
	}
}

310 
VOID
 
	$WSPawiKeyStg
(

311 
IN
 
PRTMP_ADAPTER
 
pAd
)

313 
PCIPHER_KEY
 
pShedKey
;

314 
PMAC_TABLE_ENTRY
 
pEry
;

316 
pEry
 = &
pAd
->
MacTab
.
Cڋ
[
BSSID_WCID
];

319 
pShedKey
 = &
pAd
->
ShedKey
[
BSS0
][0];

321 
	`NdisMoveMemy
(
pAd
->
SCfg
.
PTK
, 
pEry
->PTK, 
LEN_PTK
);

324 
	`NdisZoMemy
(
pShedKey
, (
CIPHER_KEY
));

325 
pShedKey
->
KeyL
 = 
LEN_TK
;

326 
	`NdisMoveMemy
(
pShedKey
->
Key
, &
pAd
->
SCfg
.
PTK
[32], 
LEN_TK
);

327 
	`NdisMoveMemy
(
pShedKey
->
RxMic
, &
pAd
->
SCfg
.
PTK
[48], 
LEN_TKIP_MIC
);

328 
	`NdisMoveMemy
(
pShedKey
->
TxMic
, &
pAd
->
SCfg
.
PTK
[48+
LEN_TKIP_MIC
], LEN_TKIP_MIC);

331 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi2Ebd
)

332 
pShedKey
->
ChAlg
 = 
CIPHER_TKIP
;

333 i(
pAd
->
SCfg
.
PaCh
 =
Ndis802_11Enyi3Ebd
)

334 
pShedKey
->
ChAlg
 = 
CIPHER_AES
;

336 
pShedKey
->
ChAlg
 = 
CIPHER_NONE
;

339 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
Key
, &
pAd
->
SCfg
.
PTK
[32], 
LEN_TK
);

340 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
RxMic
, &
pAd
->
SCfg
.
PTK
[48], 
LEN_TKIP_MIC
);

341 
	`NdisMoveMemy
(
pEry
->
PawiKey
.
TxMic
, &
pAd
->
SCfg
.
PTK
[48+
LEN_TKIP_MIC
], LEN_TKIP_MIC);

342 
pEry
->
PawiKey
.
ChAlg
 = 
pShedKey
->CipherAlg;

345 
	`RTMP_ASIC_SHARED_KEY_TABLE
(
pAd
,

346 
BSS0
,

348 
pShedKey
);

351 
	`RTMP_SET_WCID_SEC_INFO
(
pAd
,

352 
BSS0
,

354 
pShedKey
->
ChAlg
,

355 
BSSID_WCID
,

356 
SHAREDKEYTABLE
);

358 
	`RTMP_SET_PORT_SECURED
(
pAd
);

360 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("%: AID(%dp܈cud\n", 
__FUNCTION__
, 
pEry
->
Aid
));

362 
	}
}

364 
VOID
 
	$WSGroupKeyStg
(

365 
IN
 
PRTMP_ADAPTER
 
pAd
)

367 
PCIPHER_KEY
 
pShedKey
;

369 
pShedKey
 = &
pAd
->
ShedKey
[
BSS0
][pAd->
SCfg
.
DeuKeyId
];

372 
	`NdisZoMemy
(
pShedKey
, (
CIPHER_KEY
));

373 
pShedKey
->
KeyL
 = 
LEN_TK
;

374 
	`NdisMoveMemy
(
pShedKey
->
Key
, 
pAd
->
SCfg
.
GTK
, 
LEN_TK
);

375 
	`NdisMoveMemy
(
pShedKey
->
RxMic
, &
pAd
->
SCfg
.
GTK
[16], 
LEN_TKIP_MIC
);

376 
	`NdisMoveMemy
(
pShedKey
->
TxMic
, &
pAd
->
SCfg
.
GTK
[24], 
LEN_TKIP_MIC
);

379 
pShedKey
->
ChAlg
 = 
CIPHER_NONE
;

380 i(
pAd
->
SCfg
.
GroupCh
 =
Ndis802_11Enyi2Ebd
)

381 
pShedKey
->
ChAlg
 = 
CIPHER_TKIP
;

382 i(
pAd
->
SCfg
.
GroupCh
 =
Ndis802_11Enyi3Ebd
)

383 
pShedKey
->
ChAlg
 = 
CIPHER_AES
;

384 i(
pAd
->
SCfg
.
GroupCh
 =
Ndis802_11GroupWEP40Ebd
)

385 
pShedKey
->
ChAlg
 = 
CIPHER_WEP64
;

386 i(
pAd
->
SCfg
.
GroupCh
 =
Ndis802_11GroupWEP104Ebd
)

387 
pShedKey
->
ChAlg
 = 
CIPHER_WEP128
;

390 
	`RTMP_ASIC_SHARED_KEY_TABLE
(
pAd
,

391 
BSS0
,

392 
pAd
->
SCfg
.
DeuKeyId
,

393 
pShedKey
);

396 
	}
}

420 
VOID
 
	$WSdES
(

421 
IN
 
PRTMP_ADAPTER
 
pAd
,

422 
IN
 
PUCHAR
 
pBssid
)

424 
IEEE8021X_FRAME
 
Pack
;

425 
UCHAR
 
Hd802_3
[14];

427 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("-----> WpaSendEapolStart\n"));

429 
	`NdisZoMemy
(
Hd802_3
,(
UCHAR
)*14);

431 
	`MAKE_802_3_HEADER
(
Hd802_3
, 
pBssid
, &
pAd
->
CutAddss
[0], 
EAPOL
);

434 
	`NdisZoMemy
(&
Pack
, (Packet));

435 
Pack
.
Vsi
 = 
EAPOL_VER
;

436 
Pack
.
Ty
 = 
EAPOLS
;

437 
Pack
.
Lgth
 = 
	`u2be16
(0);

440 
	`RTMPToWessS
((
PRTMP_ADAPTER
)
pAd
, &pAd->
MacTab
.
Cڋ
[
BSSID_WCID
],

441 
Hd802_3
, 
LENGTH_802_3
, (
PUCHAR
)&
Pack
, 4, 
TRUE
);

443 
	`DBGPRINT
(
RT_DEBUG_TRACE
, ("<----- WpaSendEapolStart\n"));

444 
	}
}

	@tools/bin2h.c

28 
	~<dio.h
>

29 
	~<rg.h
>

30 
	~<dlib.h
>

32 
	$ma
(
gc
 ,*
gv
[])

34 
FILE
 *
fe
, *
outfe
;

35 
ame
[1024];

36 
outame
[1024];

37 *
28xxd
;

38 *
cht
;

39 
i
=0;

40 
c
;

42 
	`memt
(
ame
,0,1024);

43 
	`memt
(
outame
,0,1024);

45 
28xxd
 = (*)
	`gv
("RT28xx_DIR");

46 
cht
 = (*)
	`gv
("CHIPSET");

47 if(!
28xxd
)

49 
	`tf
("Environment value \"RT28xx_DIR\"otxport \n");

52 if(!
cht
)

54 
	`tf
("Environment value \"CHIPSET\"otxport \n");

57 
	`rt
(
ame
,
28xxd
);

58 if(
	`cmp
(
cht
, "2860",4)==0)

59 
	`rt
(
ame
,"/common/rt2860.bin");

60 if(
	`cmp
(
cht
, "2870",4)==0)

61 
	`rt
(
ame
,"/common/rt2870.bin");

63 
	`rt
(
ame
,"/common/rt2860.bin");

65 
	`rt
(
outame
,
28xxd
);

66 
	`rt
(
outame
,"/include/firmware.h");

68 
fe
 = 
	`fݒ
(
ame
,"r");

69 i(
fe
 =(
FILE
 *
NULL
)

71 
	`tf
("C'ad f%\n",
ame
);

74 
outfe
 = 
	`fݒ
(
outame
,"w");

76 i(
outfe
 =(
FILE
 *
NULL
)

78 
	`tf
("C'ݒ wrf%\n",
outame
);

82 
	`uts
("/*\n",
outfe
);

83 
	`uts
(" Cyrigh(c2007, Rk Technogy Cpܩi \n",
outfe
);

84 
	`uts
(" A΄ightrved. \n\n",
outfe
);

86 
	`uts
(" Rediributi. Rediributiڇnd u iby fm, whou\n",
outfe
);

87 
	`uts
(" modifiti,mdrovidedhhflowg cdiڠ\n",
outfe
);

88 
	`uts
(" m: \n\n",
outfe
);

90 
	`uts
(" \t* Rediributiڠmuroduhabovcyrighnindh\n",
outfe
);

91 
	`uts
(" \tflowg disaim ithdocumtiڇnd/ oth ml\n",
outfe
);

92 
	`uts
(" \rovided whhdiributi. \n",
outfe
);

93 
	`uts
(" \t* NehhmoRk Technogy Cpܩiڂ܁hmeo\n",
outfe
);

94 
	`uts
(" \tsulrmay budؒdܣ oomِodudived fromhi\n",
outfe
);

95 
	`uts
(" \tsowwhouecifii wrrmissi. \n",
outfe
);

96 
	`uts
(" \t* Nػvngrg, decompi, odismbly othisow\n",
outfe
);

97 
	`uts
(" \tirmd. \n\n",
outfe
);

99 
	`uts
(" Limedlin. Rk Technogy Cpܩi gwld-wide, \n",
outfe
);

100 
	`uts
("oyty-,-exusivlin undtow oh \n",
outfe
);

101 
	`uts
(" own cڌޠtmake, havmade, u, impt, oftأ·nd \n",
outfe
);

102 
	`uts
(" s(\"Utize\"thisowe, busޖythexhny \n",
outfe
);

103 
	`uts
(" suchisryUtizthsowe, o \n",
outfe
);

104 
	`uts
(" combi whݔg syemind undoved O\n",
outfe
);

105 
	`uts
(" Sourinlied byhOSour Intiv \n",
outfe
);

106 
	`uts
(" hp://ݒsour.g/lins. Thin shnهly\n",
outfe
);

107 
	`uts
("ny oth combiڠwhich inudthisowe. Nhdw\n",
outfe
);

108 
	`uts
(" silind heund. \n\n",
outfe
);

110 
	`uts
(" DISCLAIMER. THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND \n",
outfe
);

111 
	`uts
(" CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, \n",
outfe
);

112 
	`uts
(" BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND \n",
outfe
);

113 
	`uts
(" FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE \n",
outfe
);

114 
	`uts
(" COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, \n",
outfe
);

115 
	`uts
(" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, \n",
outfe
);

116 
	`uts
(" BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS \n",
outfe
);

117 
	`uts
(" OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTIONHOWEVER CAUSED AND \n",
outfe
);

118 
	`uts
(" ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR \n",
outfe
);

119 
	`uts
(" TORT (INCLUDING NEGLIGENCE OR OTHERWISEARISING IN ANY WAY OUT OF THE \n",
outfe
);

120 
	`uts
(" USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH \n",
outfe
);

121 
	`uts
(" DAMAGE. \n",
outfe
);

122 
	`uts
("*/ \n",
outfe
);

124 
	`uts
("/* AUTO GEN PLEASE DO NOT MODIFY IT */ \n",
outfe
);

125 
	`uts
("/* AUTO GEN PLEASE DO NOT MODIFY IT */ \n",
outfe
);

126 
	`uts
("\n",
outfe
);

127 
	`uts
("\n",
outfe
);

128 
	`uts
("UCHAR FmweImag[] = { \n",
outfe
);

131 
cc
[3];

133 
c
 = 
	`gc
(
fe
);

135 i(
	`of
(
fe
))

138 
	`memt
(
cc
,0,2);

140 i(
i
>=16)

142 
	`uts
("\n", 
outfe
);

143 
i
 = 0;

145 
	`uts
("0x", 
outfe
);

146 
	`rtf
(
cc
,"%02x",
c
);

147 
	`uts
(
cc
, 
outfe
);

148 
	`uts
(", ", 
outfe
);

149 
i
++;

152 
	`uts
("} ;\n", 
outfe
);

153 
	`fo
(
fe
);

154 
	`fo
(
outfe
);

155 
	`ex
(0);

156 
	}
}

	@/usr/include/linux/errno.h

1 #ide
_LINUX_ERRNO_H


2 
	#_LINUX_ERRNO_H


	)

4 
	~<asm/o.h
>

	@/usr/include/linux/ethtool.h

13 #ide
_LINUX_ETHTOOL_H


14 
	#_LINUX_ETHTOOL_H


	)

16 
	~<lux/tys.h
>

17 
	~<lux/if_h.h
>

20 
	shto_cmd
 {

21 
__u32
 
	mcmd
;

22 
__u32
 
	msu܋d
;

23 
__u32
 
	madvtisg
;

24 
__u16
 
	md
;

28 
__u8
 
	mduex
;

29 
__u8
 
	mpt
;

30 
__u8
 
	mphy_addss
;

34 
__u8
 
	msiv
;

35 
__u8
 
	mauteg
;

36 
__u8
 
	mmdio_sut
;

39 
__u32
 
	mmaxtxpkt
;

40 
__u32
 
	mmaxrxpkt
;

41 
__u16
 
	md_hi
;

45 
__u8
 
	mh__mdix
;

46 
__u8
 
	mrved2
;

47 
__u32
 
	m_advtisg
;

48 
__u32
 
	mrved
[2];

51 
__le__
 
	$hto_cmd_d_t
(
hto_cmd
 *

,

52 
__u32
 
d
)

55 

->
d
 = (
__u16
)speed;

56 

->
d_hi
 = (
__u16
)(
d
 >> 16);

57 
	}
}

59 
__le__
 
__u32
 
	$hto_cmd_d
(cڡ 
hto_cmd
 *

)

61  (

->
d_hi
 << 16|p->
d
;

62 
	}
}

69 
	#ETH_MDIO_SUPPORTS_C22
 1

	)

76 
	#ETH_MDIO_SUPPORTS_C45
 2

	)

78 
	#ETHTOOL_FWVERS_LEN
 32

	)

79 
	#ETHTOOL_BUSINFO_LEN
 32

	)

81 
	shto_drvfo
 {

82 
__u32
 
	mcmd
;

83 
	mdriv
[32];

84 
	mvsi
[32];

85 
	mfw_vsi
[
ETHTOOL_FWVERS_LEN
];

86 
	mbus_fo
[
ETHTOOL_BUSINFO_LEN
];

88 
	mrved1
[32];

89 
	mrved2
[12];

97 
__u32
 
	mn_iv_ags
;

98 
__u32
 
	mn_s
;

99 
__u32
 
	mfo_n
;

100 
__u32
 
	mdump_n
;

101 
__u32
 
	mgdump_n
;

104 
	#SOPASS_MAX
 6

	)

106 
	shto_wޚfo
 {

107 
__u32
 
	mcmd
;

108 
__u32
 
	msu܋d
;

109 
__u32
 
	mwts
;

110 
__u8
 
	msass
[
SOPASS_MAX
];

114 
	shto_vue
 {

115 
__u32
 
	mcmd
;

116 
__u32
 
	mda
;

120 
	shto_gs
 {

121 
__u32
 
	mcmd
;

122 
__u32
 
	mvsi
;

123 
__u32
 
	mn
;

124 
__u8
 
	mda
[0];

128 
	shto_om
 {

129 
__u32
 
	mcmd
;

130 
__u32
 
	mmagic
;

131 
__u32
 
	mofft
;

132 
__u32
 
	mn
;

133 
__u8
 
	mda
[0];

146 
	shto_modfo
 {

147 
__u32
 
	mcmd
;

148 
__u32
 
	mty
;

149 
__u32
 
	mom_n
;

150 
__u32
 
	mrved
[8];

225 
	shto_cs
 {

226 
__u32
 
	mcmd
;

227 
__u32
 
	mrx_cs_ucs
;

228 
__u32
 
	mrx_max_csd_ames
;

229 
__u32
 
	mrx_cs_ucs_q
;

230 
__u32
 
	mrx_max_csd_ames_q
;

231 
__u32
 
	mtx_cs_ucs
;

232 
__u32
 
	mtx_max_csd_ames
;

233 
__u32
 
	mtx_cs_ucs_q
;

234 
__u32
 
	mtx_max_csd_ames_q
;

235 
__u32
 
	ms_block_cs_ucs
;

236 
__u32
 
	mu_adtive_rx_cs
;

237 
__u32
 
	mu_adtive_tx_cs
;

238 
__u32
 
	mpkt__low
;

239 
__u32
 
	mrx_cs_ucs_low
;

240 
__u32
 
	mrx_max_csd_ames_low
;

241 
__u32
 
	mtx_cs_ucs_low
;

242 
__u32
 
	mtx_max_csd_ames_low
;

243 
__u32
 
	mpkt__high
;

244 
__u32
 
	mrx_cs_ucs_high
;

245 
__u32
 
	mrx_max_csd_ames_high
;

246 
__u32
 
	mtx_cs_ucs_high
;

247 
__u32
 
	mtx_max_csd_ames_high
;

248 
__u32
 
	m_me_rv
;

252 
	shto_rgm
 {

253 
__u32
 
	mcmd
;

259 
__u32
 
	mrx_max_ndg
;

260 
__u32
 
	mrx_mi_max_ndg
;

261 
__u32
 
	mrx_jumbo_max_ndg
;

262 
__u32
 
	mtx_max_ndg
;

267 
__u32
 
	mrx_ndg
;

268 
__u32
 
	mrx_mi_ndg
;

269 
__u32
 
	mrx_jumbo_ndg
;

270 
__u32
 
	mtx_ndg
;

289 
	shto_chls
 {

290 
__u32
 
	mcmd
;

291 
__u32
 
	mmax_rx
;

292 
__u32
 
	mmax_tx
;

293 
__u32
 
	mmax_h
;

294 
__u32
 
	mmax_combed
;

295 
__u32
 
	mrx_cou
;

296 
__u32
 
	mtx_cou
;

297 
__u32
 
	mh_cou
;

298 
__u32
 
	mcombed_cou
;

302 
	shto_um
 {

303 
__u32
 
	mcmd
;

315 
__u32
 
	mauteg
;

316 
__u32
 
	mrx_u
;

317 
__u32
 
	mtx_u
;

320 
	#ETH_GSTRING_LEN
 32

	)

321 
	ehto_rgt
 {

322 
	mETH_SS_TEST
 = 0,

323 
	mETH_SS_STATS
,

324 
	mETH_SS_PRIV_FLAGS
,

325 
	mETH_SS_NTUPLE_FILTERS
,

326 
	mETH_SS_FEATURES
,

330 
	shto_grgs
 {

331 
__u32
 
	mcmd
;

332 
__u32
 
	mrg_t
;

333 
__u32
 
	mn
;

334 
__u8
 
	mda
[0];

337 
	shto_st_fo
 {

338 
__u32
 
	mcmd
;

339 
__u32
 
	mrved
;

340 
__u64
 
	mst_mask
;

342 
__u32
 
	mda
[0];

358 
	ehto__ags
 {

359 
	mETH_TEST_FL_OFFLINE
 = (1 << 0),

360 
	mETH_TEST_FL_FAILED
 = (1 << 1),

361 
	mETH_TEST_FL_EXTERNAL_LB
 = (1 << 2),

362 
	mETH_TEST_FL_EXTERNAL_LB_DONE
 = (1 << 3),

366 
	shto_
 {

367 
__u32
 
	mcmd
;

368 
__u32
 
	mags
;

369 
__u32
 
	mrved
;

370 
__u32
 
	mn
;

371 
__u64
 
	mda
[0];

375 
	shto_s
 {

376 
__u32
 
	mcmd
;

377 
__u32
 
	mn_s
;

378 
__u64
 
	mda
[0];

381 
	shto_rm_addr
 {

382 
__u32
 
	mcmd
;

383 
__u32
 
	msize
;

384 
__u8
 
	mda
[0];

396 
	ehto_ags
 {

397 
	mETH_FLAG_TXVLAN
 = (1 << 7),

398 
	mETH_FLAG_RXVLAN
 = (1 << 8),

399 
	mETH_FLAG_LRO
 = (1 << 15),

400 
	mETH_FLAG_NTUPLE
 = (1 << 27),

401 
	mETH_FLAG_RXHASH
 = (1 << 28),

420 
	shto_t4_ec
 {

421 
__be32
 
	m4c
;

422 
__be32
 
	m4d
;

423 
__be16
 
	mpc
;

424 
__be16
 
	mpd
;

425 
__u8
 
	mtos
;

437 
	shto_ah_e4_ec
 {

438 
__be32
 
	m4c
;

439 
__be32
 
	m4d
;

440 
__be32
 
	mi
;

441 
__u8
 
	mtos
;

444 
	#ETH_RX_NFC_IP4
 1

	)

455 
	shto_u4_ec
 {

456 
__be32
 
	m4c
;

457 
__be32
 
	m4d
;

458 
__be32
 
	ml4_4_bys
;

459 
__u8
 
	mtos
;

460 
__u8
 
	m_v
;

461 
__u8
 
	mo
;

464 
	uhto_ow_uni
 {

465 
hto_t4_ec
 
	mt_4_ec
;

466 
hto_t4_ec
 
	mudp_4_ec
;

467 
hto_t4_ec
 
	msp_4_ec
;

468 
hto_ah_e4_ec
 
	mah_4_ec
;

469 
hto_ah_e4_ec
 
	me_4_ec
;

470 
hto_u4_ec
 
	mu_4_ec
;

471 
hhdr
 
	mh_ec
;

472 
__u8
 
	mhda
[60];

475 
	shto_ow_ext
 {

476 
__be16
 
	mvn_y
;

477 
__be16
 
	mvn_tci
;

478 
__be32
 
	mda
[2];

496 
	shto_rx_ow_ec
 {

497 
__u32
 
	mow_ty
;

498 
hto_ow_uni
 
	mh_u
;

499 
hto_ow_ext
 
	mh_ext
;

500 
hto_ow_uni
 
	mm_u
;

501 
hto_ow_ext
 
	mm_ext
;

502 
__u64
 
	mrg_cook
;

503 
__u32
 
	mloti
;

558 
	shto_rxnfc
 {

559 
__u32
 
	mcmd
;

560 
__u32
 
	mow_ty
;

561 
__u64
 
	mda
;

562 
hto_rx_ow_ec
 
	mfs
;

563 
__u32
 
	mru_t
;

564 
__u32
 
	mru_locs
[0];

581 
	shto_rxfh_d
 {

582 
__u32
 
	mcmd
;

583 
__u32
 
	msize
;

584 
__u32
 
	mrg_dex
[0];

603 
	shto_rx_ue_ow_ec
 {

604 
__u32
 
	mow_ty
;

606 
hto_t4_ec
 
	mt_4_ec
;

607 
hto_t4_ec
 
	mudp_4_ec
;

608 
hto_t4_ec
 
	msp_4_ec
;

609 
hto_ah_e4_ec
 
	mah_4_ec
;

610 
hto_ah_e4_ec
 
	me_4_ec
;

611 
hto_u4_ec
 
	mu_4_ec
;

612 
hhdr
 
	mh_ec
;

613 
__u8
 
	mhda
[72];

614 } 
	mh_u
, 
	mm_u
;

616 
__u16
 
	mvn_g
;

617 
__u16
 
	mvn_g_mask
;

618 
__u64
 
	mda
;

619 
__u64
 
	mda_mask
;

621 
__s32
 
	mai
;

622 
	#ETHTOOL_RXNTUPLE_ACTION_DROP
 (-1

	)

623 
	#ETHTOOL_RXNTUPLE_ACTION_CLEAR
 (-2

	)

631 
	shto_rx_ue
 {

632 
__u32
 
	mcmd
;

633 
hto_rx_ue_ow_ec
 
	mfs
;

636 
	#ETHTOOL_FLASH_MAX_FILENAME
 128

	)

637 
	ehto_ash__ty
 {

638 
	mETHTOOL_FLASH_ALL_REGIONS
 = 0,

642 
	shto_ash
 {

643 
__u32
 
	mcmd
;

644 
__u32
 
	mgi
;

645 
	mda
[
ETHTOOL_FLASH_MAX_FILENAME
];

663 
	#ETH_FW_DUMP_DISABLE
 0

	)

665 
	shto_dump
 {

666 
__u32
 
	mcmd
;

667 
__u32
 
	mvsi
;

668 
__u32
 
	mag
;

669 
__u32
 
	mn
;

670 
__u8
 
	mda
[0];

682 
	shto_g_us_block
 {

683 
__u32
 
	mavaab
;

684 
__u32
 
	mqueed
;

685 
__u32
 
	maive
;

686 
__u32
 
	mv_chged
;

696 
	shto_gus
 {

697 
__u32
 
	mcmd
;

698 
__u32
 
	msize
;

699 
hto_g_us_block
 
	mus
[0];

707 
	shto_t_us_block
 {

708 
__u32
 
	mvid
;

709 
__u32
 
	mqueed
;

718 
	shto_sus
 {

719 
__u32
 
	mcmd
;

720 
__u32
 
	msize
;

721 
hto_t_us_block
 
	mus
[0];

737 
	shto_ts_fo
 {

738 
__u32
 
	mcmd
;

739 
__u32
 
	mso_timeampg
;

740 
__s32
 
	mphc_dex
;

741 
__u32
 
	mtx_tys
;

742 
__u32
 
	mtx_rved
[3];

743 
__u32
 
	mrx_frs
;

744 
__u32
 
	mrx_rved
[3];

772 
	ehto_sus_tv_bs
 {

773 
	mETHTOOL_F_UNSUPPORTED__BIT
,

774 
	mETHTOOL_F_WISH__BIT
,

775 
	mETHTOOL_F_COMPAT__BIT
,

778 
	#ETHTOOL_F_UNSUPPORTED
 (1 << 
ETHTOOL_F_UNSUPPORTED__BIT
)

	)

779 
	#ETHTOOL_F_WISH
 (1 << 
ETHTOOL_F_WISH__BIT
)

	)

780 
	#ETHTOOL_F_COMPAT
 (1 << 
ETHTOOL_F_COMPAT__BIT
)

	)

784 
	#ETHTOOL_GSET
 0x00000001

	)

785 
	#ETHTOOL_SSET
 0x00000002

	)

786 
	#ETHTOOL_GDRVINFO
 0x00000003

	)

787 
	#ETHTOOL_GREGS
 0x00000004

	)

788 
	#ETHTOOL_GWOL
 0x00000005

	)

789 
	#ETHTOOL_SWOL
 0x00000006

	)

790 
	#ETHTOOL_GMSGLVL
 0x00000007

	)

791 
	#ETHTOOL_SMSGLVL
 0x00000008

	)

792 
	#ETHTOOL_NWAY_RST
 0x00000009

	)

795 
	#ETHTOOL_GLINK
 0x0000000a

	)

796 
	#ETHTOOL_GEEPROM
 0x0000000b

	)

797 
	#ETHTOOL_SEEPROM
 0x0000000

	)

798 
	#ETHTOOL_GCOALESCE
 0x0000000

	)

799 
	#ETHTOOL_SCOALESCE
 0x0000000

	)

800 
	#ETHTOOL_GRINGPARAM
 0x00000010

	)

801 
	#ETHTOOL_SRINGPARAM
 0x00000011

	)

802 
	#ETHTOOL_GPAUSEPARAM
 0x00000012

	)

803 
	#ETHTOOL_SPAUSEPARAM
 0x00000013

	)

804 
	#ETHTOOL_GRXCSUM
 0x00000014

	)

805 
	#ETHTOOL_SRXCSUM
 0x00000015

	)

806 
	#ETHTOOL_GTXCSUM
 0x00000016

	)

807 
	#ETHTOOL_STXCSUM
 0x00000017

	)

808 
	#ETHTOOL_GSG
 0x00000018

	)

810 
	#ETHTOOL_SSG
 0x00000019

	)

812 
	#ETHTOOL_TEST
 0x0000001

	)

813 
	#ETHTOOL_GSTRINGS
 0x0000001b

	)

814 
	#ETHTOOL_PHYS_ID
 0x0000001

	)

815 
	#ETHTOOL_GSTATS
 0x0000001d

	)

816 
	#ETHTOOL_GTSO
 0x0000001

	)

817 
	#ETHTOOL_STSO
 0x0000001

	)

818 
	#ETHTOOL_GPERMADDR
 0x00000020

	)

819 
	#ETHTOOL_GUFO
 0x00000021

	)

820 
	#ETHTOOL_SUFO
 0x00000022

	)

821 
	#ETHTOOL_GGSO
 0x00000023

	)

822 
	#ETHTOOL_SGSO
 0x00000024

	)

823 
	#ETHTOOL_GFLAGS
 0x00000025

	)

824 
	#ETHTOOL_SFLAGS
 0x00000026

	)

825 
	#ETHTOOL_GPFLAGS
 0x00000027

	)

826 
	#ETHTOOL_SPFLAGS
 0x00000028

	)

828 
	#ETHTOOL_GRXFH
 0x00000029

	)

829 
	#ETHTOOL_SRXFH
 0x0000002

	)

830 
	#ETHTOOL_GGRO
 0x0000002b

	)

831 
	#ETHTOOL_SGRO
 0x0000002

	)

832 
	#ETHTOOL_GRXRINGS
 0x0000002d

	)

833 
	#ETHTOOL_GRXCLSRLCNT
 0x0000002

	)

834 
	#ETHTOOL_GRXCLSRULE
 0x0000002

	)

835 
	#ETHTOOL_GRXCLSRLALL
 0x00000030

	)

836 
	#ETHTOOL_SRXCLSRLDEL
 0x00000031

	)

837 
	#ETHTOOL_SRXCLSRLINS
 0x00000032

	)

838 
	#ETHTOOL_FLASHDEV
 0x00000033

	)

839 
	#ETHTOOL_RESET
 0x00000034

	)

840 
	#ETHTOOL_SRXNTUPLE
 0x00000035

	)

841 
	#ETHTOOL_GRXNTUPLE
 0x00000036

	)

842 
	#ETHTOOL_GSSET_INFO
 0x00000037

	)

843 
	#ETHTOOL_GRXFHINDIR
 0x00000038

	)

844 
	#ETHTOOL_SRXFHINDIR
 0x00000039

	)

846 
	#ETHTOOL_GFEATURES
 0x0000003

	)

847 
	#ETHTOOL_SFEATURES
 0x0000003b

	)

848 
	#ETHTOOL_GCHANNELS
 0x0000003

	)

849 
	#ETHTOOL_SCHANNELS
 0x0000003d

	)

850 
	#ETHTOOL_SET_DUMP
 0x0000003

	)

851 
	#ETHTOOL_GET_DUMP_FLAG
 0x0000003

	)

852 
	#ETHTOOL_GET_DUMP_DATA
 0x00000040

	)

853 
	#ETHTOOL_GET_TS_INFO
 0x00000041

	)

854 
	#ETHTOOL_GMODULEINFO
 0x00000042

	)

855 
	#ETHTOOL_GMODULEEEPROM
 0x00000043

	)

858 
	#SPARC_ETH_GSET
 
ETHTOOL_GSET


	)

859 
	#SPARC_ETH_SSET
 
ETHTOOL_SSET


	)

862 
	#SUPPORTED_10baT_Hf
 (1 << 0)

	)

863 
	#SUPPORTED_10baT_Fu
 (1 << 1)

	)

864 
	#SUPPORTED_100baT_Hf
 (1 << 2)

	)

865 
	#SUPPORTED_100baT_Fu
 (1 << 3)

	)

866 
	#SUPPORTED_1000baT_Hf
 (1 << 4)

	)

867 
	#SUPPORTED_1000baT_Fu
 (1 << 5)

	)

868 
	#SUPPORTED_Auteg
 (1 << 6)

	)

869 
	#SUPPORTED_TP
 (1 << 7)

	)

870 
	#SUPPORTED_AUI
 (1 << 8)

	)

871 
	#SUPPORTED_MII
 (1 << 9)

	)

872 
	#SUPPORTED_FIBRE
 (1 << 10)

	)

873 
	#SUPPORTED_BNC
 (1 << 11)

	)

874 
	#SUPPORTED_10000baT_Fu
 (1 << 12)

	)

875 
	#SUPPORTED_Pau
 (1 << 13)

	)

876 
	#SUPPORTED_Asym_Pau
 (1 << 14)

	)

877 
	#SUPPORTED_2500baX_Fu
 (1 << 15)

	)

878 
	#SUPPORTED_Backe
 (1 << 16)

	)

879 
	#SUPPORTED_1000baKX_Fu
 (1 << 17)

	)

880 
	#SUPPORTED_10000baKX4_Fu
 (1 << 18)

	)

881 
	#SUPPORTED_10000baKR_Fu
 (1 << 19)

	)

882 
	#SUPPORTED_10000baR_FEC
 (1 << 20)

	)

883 
	#SUPPORTED_20000baMLD2_Fu
 (1 << 21)

	)

884 
	#SUPPORTED_20000baKR2_Fu
 (1 << 22)

	)

887 
	#ADVERTISED_10baT_Hf
 (1 << 0)

	)

888 
	#ADVERTISED_10baT_Fu
 (1 << 1)

	)

889 
	#ADVERTISED_100baT_Hf
 (1 << 2)

	)

890 
	#ADVERTISED_100baT_Fu
 (1 << 3)

	)

891 
	#ADVERTISED_1000baT_Hf
 (1 << 4)

	)

892 
	#ADVERTISED_1000baT_Fu
 (1 << 5)

	)

893 
	#ADVERTISED_Auteg
 (1 << 6)

	)

894 
	#ADVERTISED_TP
 (1 << 7)

	)

895 
	#ADVERTISED_AUI
 (1 << 8)

	)

896 
	#ADVERTISED_MII
 (1 << 9)

	)

897 
	#ADVERTISED_FIBRE
 (1 << 10)

	)

898 
	#ADVERTISED_BNC
 (1 << 11)

	)

899 
	#ADVERTISED_10000baT_Fu
 (1 << 12)

	)

900 
	#ADVERTISED_Pau
 (1 << 13)

	)

901 
	#ADVERTISED_Asym_Pau
 (1 << 14)

	)

902 
	#ADVERTISED_2500baX_Fu
 (1 << 15)

	)

903 
	#ADVERTISED_Backe
 (1 << 16)

	)

904 
	#ADVERTISED_1000baKX_Fu
 (1 << 17)

	)

905 
	#ADVERTISED_10000baKX4_Fu
 (1 << 18)

	)

906 
	#ADVERTISED_10000baKR_Fu
 (1 << 19)

	)

907 
	#ADVERTISED_10000baR_FEC
 (1 << 20)

	)

908 
	#ADVERTISED_20000baMLD2_Fu
 (1 << 21)

	)

909 
	#ADVERTISED_20000baKR2_Fu
 (1 << 22)

	)

918 
	#SPEED_10
 10

	)

919 
	#SPEED_100
 100

	)

920 
	#SPEED_1000
 1000

	)

921 
	#SPEED_2500
 2500

	)

922 
	#SPEED_10000
 10000

	)

923 
	#SPEED_UNKNOWN
 -1

	)

926 
	#DUPLEX_HALF
 0x00

	)

927 
	#DUPLEX_FULL
 0x01

	)

928 
	#DUPLEX_UNKNOWN
 0xff

	)

931 
	#PORT_TP
 0x00

	)

932 
	#PORT_AUI
 0x01

	)

933 
	#PORT_MII
 0x02

	)

934 
	#PORT_FIBRE
 0x03

	)

935 
	#PORT_BNC
 0x04

	)

936 
	#PORT_DA
 0x05

	)

937 
	#PORT_NONE
 0xef

	)

938 
	#PORT_OTHER
 0xff

	)

941 
	#XCVR_INTERNAL
 0x00

	)

942 
	#XCVR_EXTERNAL
 0x01

	)

943 
	#XCVR_DUMMY1
 0x02

	)

944 
	#XCVR_DUMMY2
 0x03

	)

945 
	#XCVR_DUMMY3
 0x04

	)

950 
	#AUTONEG_DISABLE
 0x00

	)

951 
	#AUTONEG_ENABLE
 0x01

	)

954 
	#ETH_TP_MDI_INVALID
 0x00

	)

955 
	#ETH_TP_MDI
 0x01

	)

956 
	#ETH_TP_MDI_X
 0x02

	)

959 
	#WAKE_PHY
 (1 << 0)

	)

960 
	#WAKE_UCAST
 (1 << 1)

	)

961 
	#WAKE_MCAST
 (1 << 2)

	)

962 
	#WAKE_BCAST
 (1 << 3)

	)

963 
	#WAKE_ARP
 (1 << 4)

	)

964 
	#WAKE_MAGIC
 (1 << 5)

	)

965 
	#WAKE_MAGICSECURE
 (1 << 6

	)

968 
	#TCP_V4_FLOW
 0x01

	)

969 
	#UDP_V4_FLOW
 0x02

	)

970 
	#SCTP_V4_FLOW
 0x03

	)

971 
	#AH_ESP_V4_FLOW
 0x04

	)

972 
	#TCP_V6_FLOW
 0x05

	)

973 
	#UDP_V6_FLOW
 0x06

	)

974 
	#SCTP_V6_FLOW
 0x07

	)

975 
	#AH_ESP_V6_FLOW
 0x08

	)

976 
	#AH_V4_FLOW
 0x09

	)

977 
	#ESP_V4_FLOW
 0x0

	)

978 
	#AH_V6_FLOW
 0x0b

	)

979 
	#ESP_V6_FLOW
 0x0

	)

980 
	#IP_USER_FLOW
 0x0d

	)

981 
	#IPV4_FLOW
 0x10

	)

982 
	#IPV6_FLOW
 0x11

	)

983 
	#ETHER_FLOW
 0x12

	)

985 
	#FLOW_EXT
 0x80000000

	)

988 
	#RXH_L2DA
 (1 << 1)

	)

989 
	#RXH_VLAN
 (1 << 2)

	)

990 
	#RXH_L3_PROTO
 (1 << 3)

	)

991 
	#RXH_IP_SRC
 (1 << 4)

	)

992 
	#RXH_IP_DST
 (1 << 5)

	)

993 
	#RXH_L4_B_0_1
 (1 << 6

	)

994 
	#RXH_L4_B_2_3
 (1 << 7

	)

995 
	#RXH_DISCARD
 (1 << 31)

	)

997 
	#RX_CLS_FLOW_DISC
 0xffffffffffffffffULL

	)

1000 
	#RX_CLS_LOC_SPECIAL
 0x80000000

	)

1001 
	#RX_CLS_LOC_ANY
 0xffffffff

	)

1002 
	#RX_CLS_LOC_FIRST
 0xffffff

	)

1003 
	#RX_CLS_LOC_LAST
 0xfffffffd

	)

1006 
	#ETH_MODULE_SFF_8079
 0x1

	)

1007 
	#ETH_MODULE_SFF_8079_LEN
 256

	)

1008 
	#ETH_MODULE_SFF_8472
 0x2

	)

1009 
	#ETH_MODULE_SFF_8472_LEN
 512

	)

1018 
	ehto_t_ags
 {

1024 
	mETH_RESET_MGMT
 = 1 << 0,

1025 
	mETH_RESET_IRQ
 = 1 << 1,

1026 
	mETH_RESET_DMA
 = 1 << 2,

1027 
	mETH_RESET_FILTER
 = 1 << 3,

1028 
	mETH_RESET_OFFLOAD
 = 1 << 4,

1029 
	mETH_RESET_MAC
 = 1 << 5,

1030 
	mETH_RESET_PHY
 = 1 << 6,

1031 
	mETH_RESET_RAM
 = 1 << 7,

1034 
	mETH_RESET_DEDICATED
 = 0x0000ffff,

1036 
	mETH_RESET_ALL
 = 0xffffffff,

1039 
	#ETH_RESET_SHARED_SHIFT
 16

	)

	@/usr/include/linux/if_arp.h

23 #ide
_LINUX_IF_ARP_H


24 
	#_LINUX_IF_ARP_H


	)

26 
	~<lux/tdevi.h
>

29 
	#ARPHRD_NETROM
 0

	)

30 
	#ARPHRD_ETHER
 1

	)

31 
	#ARPHRD_EETHER
 2

	)

32 
	#ARPHRD_AX25
 3

	)

33 
	#ARPHRD_PRONET
 4

	)

34 
	#ARPHRD_CHAOS
 5

	)

35 
	#ARPHRD_IEEE802
 6

	)

36 
	#ARPHRD_ARCNET
 7

	)

37 
	#ARPHRD_APPLETLK
 8

	)

38 
	#ARPHRD_DLCI
 15

	)

39 
	#ARPHRD_ATM
 19

	)

40 
	#ARPHRD_METRICOM
 23

	)

41 
	#ARPHRD_IEEE1394
 24

	)

42 
	#ARPHRD_EUI64
 27

	)

43 
	#ARPHRD_INFINIBAND
 32

	)

46 
	#ARPHRD_SLIP
 256

	)

47 
	#ARPHRD_CSLIP
 257

	)

48 
	#ARPHRD_SLIP6
 258

	)

49 
	#ARPHRD_CSLIP6
 259

	)

50 
	#ARPHRD_RSRVD
 260

	)

51 
	#ARPHRD_ADAPT
 264

	)

52 
	#ARPHRD_ROSE
 270

	)

53 
	#ARPHRD_X25
 271

	)

54 
	#ARPHRD_HWX25
 272

	)

55 
	#ARPHRD_CAN
 280

	)

56 
	#ARPHRD_PPP
 512

	)

57 
	#ARPHRD_CISCO
 513

	)

58 
	#ARPHRD_HDLC
 
ARPHRD_CISCO


	)

59 
	#ARPHRD_LAPB
 516

	)

60 
	#ARPHRD_DDCMP
 517

	)

61 
	#ARPHRD_RAWHDLC
 518

	)

63 
	#ARPHRD_TUNNEL
 768

	)

64 
	#ARPHRD_TUNNEL6
 769

	)

65 
	#ARPHRD_FRAD
 770

	)

66 
	#ARPHRD_SKIP
 771

	)

67 
	#ARPHRD_LOOPBACK
 772

	)

68 
	#ARPHRD_LOCALTLK
 773

	)

69 
	#ARPHRD_FDDI
 774

	)

70 
	#ARPHRD_BIF
 775

	)

71 
	#ARPHRD_SIT
 776

	)

72 
	#ARPHRD_IPDDP
 777

	)

73 
	#ARPHRD_IPGRE
 778

	)

74 
	#ARPHRD_PIMREG
 779

	)

75 
	#ARPHRD_HIPPI
 780

	)

76 
	#ARPHRD_ASH
 781

	)

77 
	#ARPHRD_ECONET
 782

	)

78 
	#ARPHRD_IRDA
 783

	)

80 
	#ARPHRD_FCPP
 784

	)

81 
	#ARPHRD_FCAL
 785

	)

82 
	#ARPHRD_FCPL
 786

	)

83 
	#ARPHRD_FCFABRIC
 787

	)

85 
	#ARPHRD_IEEE802_TR
 800

	)

86 
	#ARPHRD_IEEE80211
 801

	)

87 
	#ARPHRD_IEEE80211_PRISM
 802

	)

88 
	#ARPHRD_IEEE80211_RADIOTAP
 803

	)

89 
	#ARPHRD_IEEE802154
 804

	)

90 
	#ARPHRD_IEEE802154_MONITOR
 805

	)

92 
	#ARPHRD_PHONET
 820

	)

93 
	#ARPHRD_PHONET_PIPE
 821

	)

94 
	#ARPHRD_CAIF
 822

	)

96 
	#ARPHRD_VOID
 0xFFFF

	)

97 
	#ARPHRD_NONE
 0xFFFE

	)

100 
	#ARPOP_REQUEST
 1

	)

101 
	#ARPOP_REPLY
 2

	)

102 
	#ARPOP_RREQUEST
 3

	)

103 
	#ARPOP_RREPLY
 4

	)

104 
	#ARPOP_InREQUEST
 8

	)

105 
	#ARPOP_InREPLY
 9

	)

106 
	#ARPOP_NAK
 10

	)

110 
	seq
 {

111 
sockaddr
 
	mp_
;

112 
sockaddr
 
	mp_ha
;

113 
	mp_ags
;

114 
sockaddr
 
	mp_tmask
;

115 
	mp_dev
[16];

118 
	seq_d
 {

119 
sockaddr
 
	mp_
;

120 
sockaddr
 
	mp_ha
;

121 
	mp_ags
;

122 
sockaddr
 
	mp_tmask
;

126 
	#ATF_COM
 0x02

	)

127 
	#ATF_PERM
 0x04

	)

128 
	#ATF_PUBL
 0x08

	)

129 
	#ATF_USETRAILERS
 0x10

	)

130 
	#ATF_NETMASK
 0x20

	)

132 
	#ATF_DONTPUB
 0x40

	)

138 
	sphdr
 {

139 
__be16
 
	m_hrd
;

140 
__be16
 
	m_o
;

141 
	m_h
;

142 
	m_n
;

143 
__be16
 
	m_
;

149 
	m_sha
[
ETH_ALEN
];

150 
	m_s
[4];

151 
	m_tha
[
ETH_ALEN
];

152 
	m_t
[4];

	@/usr/include/linux/kernel.h

1 #ide
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

4 
	~<lux/sysfo.h
>

9 
	#__ALIGN_KERNEL
(
x
, 
a

	`__ALIGN_KERNEL_MASK
(x, (
	`tyof
(x))- 1)

	)

10 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
(((x+ (mask)& ~(mask))

	)

	@/usr/include/linux/netdevice.h

25 #ide
_LINUX_NETDEVICE_H


26 
	#_LINUX_NETDEVICE_H


	)

28 
	~<lux/if.h
>

29 
	~<lux/if_h.h
>

30 
	~<lux/if_ck.h
>

31 
	~<lux/if_lk.h
>

34 
	#MAX_ADDR_LEN
 32

	)

37 
	#INIT_NETDEV_GROUP
 0

	)

43 
	mIF_PORT_UNKNOWN
 = 0,

44 
	mIF_PORT_10BASE2
,

45 
	mIF_PORT_10BASET
,

46 
	mIF_PORT_AUI
,

47 
	mIF_PORT_100BASET
,

48 
	mIF_PORT_100BASETX
,

49 
	mIF_PORT_100BASEFX


	@/usr/include/linux/netfilter_bridge.h

1 #ide
__LINUX_BRIDGE_NETFILTER_H


2 
	#__LINUX_BRIDGE_NETFILTER_H


	)

7 
	~<lux/tfr.h
>

8 
	~<lux/if_h.h
>

9 
	~<lux/if_vn.h
>

10 
	~<lux/if_pox.h
>

14 
	#NF_BR_PRE_ROUTING
 0

	)

16 
	#NF_BR_LOCAL_IN
 1

	)

18 
	#NF_BR_FORWARD
 2

	)

20 
	#NF_BR_LOCAL_OUT
 3

	)

22 
	#NF_BR_POST_ROUTING
 4

	)

24 
	#NF_BR_BROUTING
 5

	)

25 
	#NF_BR_NUMHOOKS
 6

	)

	@/usr/include/linux/pci.h

17 #ide
LINUX_PCI_H


18 
	#LINUX_PCI_H


	)

20 
	~<lux/pci_gs.h
>

30 
	#PCI_DEVFN
(

, 
func
((((& 0x1f<< 3| ((func& 0x07))

	)

31 
	#PCI_SLOT
(
dev
(((dev>> 3& 0x1f)

	)

32 
	#PCI_FUNC
(
dev
((dev& 0x07)

	)

35 
	#PCIIOC_BASE
 ('P' << 24 | 'C' << 16 | 'I' << 8)

	)

36 
	#PCIIOC_CONTROLLER
 (
PCIIOC_BASE
 | 0x00

	)

37 
	#PCIIOC_MMAP_IS_IO
 (
PCIIOC_BASE
 | 0x01

	)

38 
	#PCIIOC_MMAP_IS_MEM
 (
PCIIOC_BASE
 | 0x02

	)

39 
	#PCIIOC_WRITE_COMBINE
 (
PCIIOC_BASE
 | 0x03

	)

	@/usr/include/linux/string.h

1 #ide
_LINUX_STRING_H_


2 
	#_LINUX_STRING_H_


	)

6 
	~<rg.h
>

	@/usr/include/linux/time.h

1 #ide
_LINUX_TIME_H


2 
	#_LINUX_TIME_H


	)

4 
	~<lux/tys.h
>

7 #ide
_STRUCT_TIMESPEC


8 
	#_STRUCT_TIMESPEC


	)

9 
	stimeec
 {

10 
__kl_time_t
 
	mtv_c
;

11 
	mtv_nc
;

15 
	stimev
 {

16 
__kl_time_t
 
	mtv_c
;

17 
__kl_sucds_t
 
	mtv_uc
;

20 
	stimeze
 {

21 
	mtz_muswe
;

22 
	mtz_dtime
;

30 
	#ITIMER_REAL
 0

	)

31 
	#ITIMER_VIRTUAL
 1

	)

32 
	#ITIMER_PROF
 2

	)

34 
	simec
 {

35 
timeec
 
	m_rv
;

36 
timeec
 
	m_vue
;

39 
	simv
 {

40 
timev
 
	m_rv
;

41 
timev
 
	m_vue
;

47 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

49 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

50 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

51 
	#CLOCK_MONOTONIC_RAW
 4

	)

52 
	#CLOCK_REALTIME_COARSE
 5

	)

53 
	#CLOCK_MONOTONIC_COARSE
 6

	)

54 
	#CLOCK_BOOTTIME
 7

	)

55 
	#CLOCK_REALTIME_ALARM
 8

	)

56 
	#CLOCK_BOOTTIME_ALARM
 9

	)

61 
	#CLOCK_SGI_CYCLE
 10

	)

62 
	#MAX_CLOCKS
 16

	)

63 
	#CLOCKS_MASK
 (
CLOCK_REALTIME
 | 
CLOCK_MONOTONIC
)

	)

64 
	#CLOCKS_MONO
 
CLOCK_MONOTONIC


	)

69 
	#TIMER_ABSTIME
 0x01

	)

	@/usr/include/linux/unistd.h

1 #ide
_LINUX_UNISTD_H_


2 
	#_LINUX_UNISTD_H_


	)

7 
	~<asm/unid.h
>

	@/usr/include/linux/version.h

1 
	#LINUX_VERSION_CODE
 197895

	)

2 
	#KERNEL_VERSION
(
a
,
b
,
c
((<< 16+ ((b<< 8+ (c))

	)

	@/usr/include/linux/wireless.h

10 #ide
_LINUX_WIRELESS_H


11 
	#_LINUX_WIRELESS_H


	)

72 
	~<lux/tys.h
>

73 
	~<lux/sock.h
>

74 
	~<lux/if.h
>

83 
	#WIRELESS_EXT
 22

	)

230 
	#SIOCSIWCOMMIT
 0x8B00

	)

231 
	#SIOCGIWNAME
 0x8B01

	)

237 
	#SIOCSIWNWID
 0x8B02

	)

238 
	#SIOCGIWNWID
 0x8B03

	)

239 
	#SIOCSIWFREQ
 0x8B04

	)

240 
	#SIOCGIWFREQ
 0x8B05

	)

241 
	#SIOCSIWMODE
 0x8B06

	)

242 
	#SIOCGIWMODE
 0x8B07

	)

243 
	#SIOCSIWSENS
 0x8B08

	)

244 
	#SIOCGIWSENS
 0x8B09

	)

247 
	#SIOCSIWRANGE
 0x8B0A

	)

248 
	#SIOCGIWRANGE
 0x8B0B

	)

249 
	#SIOCSIWPRIV
 0x8B0C

	)

250 
	#SIOCGIWPRIV
 0x8B0D

	)

251 
	#SIOCSIWSTATS
 0x8B0E

	)

252 
	#SIOCGIWSTATS
 0x8B0F

	)

257 
	#SIOCSIWSPY
 0x8B10

	)

258 
	#SIOCGIWSPY
 0x8B11

	)

259 
	#SIOCSIWTHRSPY
 0x8B12

	)

260 
	#SIOCGIWTHRSPY
 0x8B13

	)

263 
	#SIOCSIWAP
 0x8B14

	)

264 
	#SIOCGIWAP
 0x8B15

	)

265 
	#SIOCGIWAPLIST
 0x8B17

	)

266 
	#SIOCSIWSCAN
 0x8B18

	)

267 
	#SIOCGIWSCAN
 0x8B19

	)

270 
	#SIOCSIWESSID
 0x8B1A

	)

271 
	#SIOCGIWESSID
 0x8B1B

	)

272 
	#SIOCSIWNICKN
 0x8B1C

	)

273 
	#SIOCGIWNICKN
 0x8B1D

	)

279 
	#SIOCSIWRATE
 0x8B20

	)

280 
	#SIOCGIWRATE
 0x8B21

	)

281 
	#SIOCSIWRTS
 0x8B22

	)

282 
	#SIOCGIWRTS
 0x8B23

	)

283 
	#SIOCSIWFRAG
 0x8B24

	)

284 
	#SIOCGIWFRAG
 0x8B25

	)

285 
	#SIOCSIWTXPOW
 0x8B26

	)

286 
	#SIOCGIWTXPOW
 0x8B27

	)

287 
	#SIOCSIWRETRY
 0x8B28

	)

288 
	#SIOCGIWRETRY
 0x8B29

	)

291 
	#SIOCSIWENCODE
 0x8B2A

	)

292 
	#SIOCGIWENCODE
 0x8B2B

	)

294 
	#SIOCSIWPOWER
 0x8B2C

	)

295 
	#SIOCGIWPOWER
 0x8B2D

	)

304 
	#SIOCSIWGENIE
 0x8B30

	)

305 
	#SIOCGIWGENIE
 0x8B31

	)

308 
	#SIOCSIWMLME
 0x8B16

	)

311 
	#SIOCSIWAUTH
 0x8B32

	)

312 
	#SIOCGIWAUTH
 0x8B33

	)

315 
	#SIOCSIWENCODEEXT
 0x8B34

	)

316 
	#SIOCGIWENCODEEXT
 0x8B35

	)

319 
	#SIOCSIWPMKSA
 0x8B36

	)

330 
	#SIOCIWFIRSTPRIV
 0x8BE0

	)

331 
	#SIOCIWLASTPRIV
 0x8BFF

	)

346 
	#SIOCIWFIRST
 0x8B00

	)

347 
	#SIOCIWLAST
 
SIOCIWLASTPRIV


	)

348 
	#IW_IOCTL_IDX
(
cmd
((cmd- 
SIOCIWFIRST
)

	)

349 
	#IW_HANDLER
(
id
, 
func
) \

350 [
	`IW_IOCTL_IDX
(
id
)] = 
func


	)

353 
	#IW_IS_SET
(
cmd
(!((cmd& 0x1))

	)

354 
	#IW_IS_GET
(
cmd
((cmd& 0x1)

	)

360 
	#IWEVTXDROP
 0x8C00

	)

361 
	#IWEVQUAL
 0x8C01

	)

362 
	#IWEVCUSTOM
 0x8C02

	)

363 
	#IWEVREGISTERED
 0x8C03

	)

364 
	#IWEVEXPIRED
 0x8C04

	)

365 
	#IWEVGENIE
 0x8C05

	)

371 
	#IWEVMICHAELMICFAILURE
 0x8C06

	)

374 
	#IWEVASSOCREQIE
 0x8C07

	)

383 
	#IWEVASSOCRESPIE
 0x8C08

	)

390 
	#IWEVPMKIDCAND
 0x8C09

	)

394 
	#IWEVFIRST
 0x8C00

	)

395 
	#IW_EVENT_IDX
(
cmd
((cmd- 
IWEVFIRST
)

	)

404 
	#IW_PRIV_TYPE_MASK
 0x7000

	)

405 
	#IW_PRIV_TYPE_NONE
 0x0000

	)

406 
	#IW_PRIV_TYPE_BYTE
 0x1000

	)

407 
	#IW_PRIV_TYPE_CHAR
 0x2000

	)

408 
	#IW_PRIV_TYPE_INT
 0x4000

	)

409 
	#IW_PRIV_TYPE_FLOAT
 0x5000

	)

410 
	#IW_PRIV_TYPE_ADDR
 0x6000

	)

412 
	#IW_PRIV_SIZE_FIXED
 0x0800

	)

414 
	#IW_PRIV_SIZE_MASK
 0x07FF

	)

424 
	#IW_MAX_FREQUENCIES
 32

	)

430 
	#IW_MAX_BITRATES
 32

	)

433 
	#IW_MAX_TXPOWER
 8

	)

438 
	#IW_MAX_SPY
 8

	)

442 
	#IW_MAX_AP
 64

	)

445 
	#IW_ESSID_MAX_SIZE
 32

	)

448 
	#IW_MODE_AUTO
 0

	)

449 
	#IW_MODE_ADHOC
 1

	)

450 
	#IW_MODE_INFRA
 2

	)

451 
	#IW_MODE_MASTER
 3

	)

452 
	#IW_MODE_REPEAT
 4

	)

453 
	#IW_MODE_SECOND
 5

	)

454 
	#IW_MODE_MONITOR
 6

	)

455 
	#IW_MODE_MESH
 7

	)

458 
	#IW_QUAL_QUAL_UPDATED
 0x01

	)

459 
	#IW_QUAL_LEVEL_UPDATED
 0x02

	)

460 
	#IW_QUAL_NOISE_UPDATED
 0x04

	)

461 
	#IW_QUAL_ALL_UPDATED
 0x07

	)

462 
	#IW_QUAL_DBM
 0x08

	)

463 
	#IW_QUAL_QUAL_INVALID
 0x10

	)

464 
	#IW_QUAL_LEVEL_INVALID
 0x20

	)

465 
	#IW_QUAL_NOISE_INVALID
 0x40

	)

466 
	#IW_QUAL_RCPI
 0x80

	)

467 
	#IW_QUAL_ALL_INVALID
 0x70

	)

470 
	#IW_FREQ_AUTO
 0x00

	)

471 
	#IW_FREQ_FIXED
 0x01

	)

475 
	#IW_MAX_ENCODING_SIZES
 8

	)

478 
	#IW_ENCODING_TOKEN_MAX
 64

	)

481 
	#IW_ENCODE_INDEX
 0x00FF

	)

482 
	#IW_ENCODE_FLAGS
 0xFF00

	)

483 
	#IW_ENCODE_MODE
 0xF000

	)

484 
	#IW_ENCODE_DISABLED
 0x8000

	)

485 
	#IW_ENCODE_ENABLED
 0x0000

	)

486 
	#IW_ENCODE_RESTRICTED
 0x4000

	)

487 
	#IW_ENCODE_OPEN
 0x2000

	)

488 
	#IW_ENCODE_NOKEY
 0x0800

	)

489 
	#IW_ENCODE_TEMP
 0x0400

	)

492 
	#IW_POWER_ON
 0x0000

	)

493 
	#IW_POWER_TYPE
 0xF000

	)

494 
	#IW_POWER_PERIOD
 0x1000

	)

495 
	#IW_POWER_TIMEOUT
 0x2000

	)

496 
	#IW_POWER_MODE
 0x0F00

	)

497 
	#IW_POWER_UNICAST_R
 0x0100

	)

498 
	#IW_POWER_MULTICAST_R
 0x0200

	)

499 
	#IW_POWER_ALL_R
 0x0300

	)

500 
	#IW_POWER_FORCE_S
 0x0400

	)

501 
	#IW_POWER_REPEATER
 0x0800

	)

502 
	#IW_POWER_MODIFIER
 0x000F

	)

503 
	#IW_POWER_MIN
 0x0001

	)

504 
	#IW_POWER_MAX
 0x0002

	)

505 
	#IW_POWER_RELATIVE
 0x0004

	)

508 
	#IW_TXPOW_TYPE
 0x00FF

	)

509 
	#IW_TXPOW_DBM
 0x0000

	)

510 
	#IW_TXPOW_MWATT
 0x0001

	)

511 
	#IW_TXPOW_RELATIVE
 0x0002

	)

512 
	#IW_TXPOW_RANGE
 0x1000

	)

515 
	#IW_RETRY_ON
 0x0000

	)

516 
	#IW_RETRY_TYPE
 0xF000

	)

517 
	#IW_RETRY_LIMIT
 0x1000

	)

518 
	#IW_RETRY_LIFETIME
 0x2000

	)

519 
	#IW_RETRY_MODIFIER
 0x00FF

	)

520 
	#IW_RETRY_MIN
 0x0001

	)

521 
	#IW_RETRY_MAX
 0x0002

	)

522 
	#IW_RETRY_RELATIVE
 0x0004

	)

523 
	#IW_RETRY_SHORT
 0x0010

	)

524 
	#IW_RETRY_LONG
 0x0020

	)

527 
	#IW_SCAN_DEFAULT
 0x0000

	)

528 
	#IW_SCAN_ALL_ESSID
 0x0001

	)

529 
	#IW_SCAN_THIS_ESSID
 0x0002

	)

530 
	#IW_SCAN_ALL_FREQ
 0x0004

	)

531 
	#IW_SCAN_THIS_FREQ
 0x0008

	)

532 
	#IW_SCAN_ALL_MODE
 0x0010

	)

533 
	#IW_SCAN_THIS_MODE
 0x0020

	)

534 
	#IW_SCAN_ALL_RATE
 0x0040

	)

535 
	#IW_SCAN_THIS_RATE
 0x0080

	)

537 
	#IW_SCAN_TYPE_ACTIVE
 0

	)

538 
	#IW_SCAN_TYPE_PASSIVE
 1

	)

540 
	#IW_SCAN_MAX_DATA
 4096

	)

543 
	#IW_SCAN_CAPA_NONE
 0x00

	)

544 
	#IW_SCAN_CAPA_ESSID
 0x01

	)

545 
	#IW_SCAN_CAPA_BSSID
 0x02

	)

546 
	#IW_SCAN_CAPA_CHANNEL
 0x04

	)

547 
	#IW_SCAN_CAPA_MODE
 0x08

	)

548 
	#IW_SCAN_CAPA_RATE
 0x10

	)

549 
	#IW_SCAN_CAPA_TYPE
 0x20

	)

550 
	#IW_SCAN_CAPA_TIME
 0x40

	)

553 
	#IW_CUSTOM_MAX
 256

	)

556 
	#IW_GENERIC_IE_MAX
 1024

	)

559 
	#IW_MLME_DEAUTH
 0

	)

560 
	#IW_MLME_DISASSOC
 1

	)

561 
	#IW_MLME_AUTH
 2

	)

562 
	#IW_MLME_ASSOC
 3

	)

565 
	#IW_AUTH_INDEX
 0x0FFF

	)

566 
	#IW_AUTH_FLAGS
 0xF000

	)

571 
	#IW_AUTH_WPA_VERSION
 0

	)

572 
	#IW_AUTH_CIPHER_PAIRWISE
 1

	)

573 
	#IW_AUTH_CIPHER_GROUP
 2

	)

574 
	#IW_AUTH_KEY_MGMT
 3

	)

575 
	#IW_AUTH_TKIP_COUNTERMEASURES
 4

	)

576 
	#IW_AUTH_DROP_UNENCRYPTED
 5

	)

577 
	#IW_AUTH_80211_AUTH_ALG
 6

	)

578 
	#IW_AUTH_WPA_ENABLED
 7

	)

579 
	#IW_AUTH_RX_UNENCRYPTED_EAPOL
 8

	)

580 
	#IW_AUTH_ROAMING_CONTROL
 9

	)

581 
	#IW_AUTH_PRIVACY_INVOKED
 10

	)

582 
	#IW_AUTH_CIPHER_GROUP_MGMT
 11

	)

583 
	#IW_AUTH_MFP
 12

	)

586 
	#IW_AUTH_WPA_VERSION_DISABLED
 0x00000001

	)

587 
	#IW_AUTH_WPA_VERSION_WPA
 0x00000002

	)

588 
	#IW_AUTH_WPA_VERSION_WPA2
 0x00000004

	)

592 
	#IW_AUTH_CIPHER_NONE
 0x00000001

	)

593 
	#IW_AUTH_CIPHER_WEP40
 0x00000002

	)

594 
	#IW_AUTH_CIPHER_TKIP
 0x00000004

	)

595 
	#IW_AUTH_CIPHER_CCMP
 0x00000008

	)

596 
	#IW_AUTH_CIPHER_WEP104
 0x00000010

	)

597 
	#IW_AUTH_CIPHER_AES_CMAC
 0x00000020

	)

600 
	#IW_AUTH_KEY_MGMT_802_1X
 1

	)

601 
	#IW_AUTH_KEY_MGMT_PSK
 2

	)

604 
	#IW_AUTH_ALG_OPEN_SYSTEM
 0x00000001

	)

605 
	#IW_AUTH_ALG_SHARED_KEY
 0x00000002

	)

606 
	#IW_AUTH_ALG_LEAP
 0x00000004

	)

609 
	#IW_AUTH_ROAMING_ENABLE
 0

	)

610 
	#IW_AUTH_ROAMING_DISABLE
 1

	)

614 
	#IW_AUTH_MFP_DISABLED
 0

	)

615 
	#IW_AUTH_MFP_OPTIONAL
 1

	)

616 
	#IW_AUTH_MFP_REQUIRED
 2

	)

619 
	#IW_ENCODE_SEQ_MAX_SIZE
 8

	)

621 
	#IW_ENCODE_ALG_NONE
 0

	)

622 
	#IW_ENCODE_ALG_WEP
 1

	)

623 
	#IW_ENCODE_ALG_TKIP
 2

	)

624 
	#IW_ENCODE_ALG_CCMP
 3

	)

625 
	#IW_ENCODE_ALG_PMK
 4

	)

626 
	#IW_ENCODE_ALG_AES_CMAC
 5

	)

628 
	#IW_ENCODE_EXT_TX_SEQ_VALID
 0x00000001

	)

629 
	#IW_ENCODE_EXT_RX_SEQ_VALID
 0x00000002

	)

630 
	#IW_ENCODE_EXT_GROUP_KEY
 0x00000004

	)

631 
	#IW_ENCODE_EXT_SET_TX_KEY
 0x00000008

	)

634 
	#IW_MICFAILURE_KEY_ID
 0x00000003

	)

635 
	#IW_MICFAILURE_GROUP
 0x00000004

	)

636 
	#IW_MICFAILURE_PAIRWISE
 0x00000008

	)

637 
	#IW_MICFAILURE_STAKEY
 0x00000010

	)

638 
	#IW_MICFAILURE_COUNT
 0x00000060

	)

642 
	#IW_ENC_CAPA_WPA
 0x00000001

	)

643 
	#IW_ENC_CAPA_WPA2
 0x00000002

	)

644 
	#IW_ENC_CAPA_CIPHER_TKIP
 0x00000004

	)

645 
	#IW_ENC_CAPA_CIPHER_CCMP
 0x00000008

	)

646 
	#IW_ENC_CAPA_4WAY_HANDSHAKE
 0x00000010

	)

651 
	#IW_EVENT_CAPA_BASE
(
cmd
((cmd >
SIOCIWFIRSTPRIV
) ? \

652 (
cmd
 - 
SIOCIWFIRSTPRIV
 + 0x60) : \

653 (
cmd
 - 
SIOCIWFIRST
))

	)

654 
	#IW_EVENT_CAPA_INDEX
(
cmd
(
	`IW_EVENT_CAPA_BASE
(cmd>> 5)

	)

655 
	#IW_EVENT_CAPA_MASK
(
cmd
(1 << (
	`IW_EVENT_CAPA_BASE
(cmd& 0x1F))

	)

658 
	#IW_EVENT_CAPA_K_0
 (
	`IW_EVENT_CAPA_MASK
(0x8B04) | \

659 
	`IW_EVENT_CAPA_MASK
(0x8B06) | \

660 
	`IW_EVENT_CAPA_MASK
(0x8B1A))

	)

661 
	#IW_EVENT_CAPA_K_1
 (
	`IW_EVENT_CAPA_MASK
(0x8B2A))

	)

663 
	#IW_EVENT_CAPA_SET
(
evt_
, 
cmd
vt_[
	`IW_EVENT_CAPA_INDEX
(cmd)] |
	`IW_EVENT_CAPA_MASK
(cmd))

	)

664 
	#IW_EVENT_CAPA_SET_KERNEL
(
evt_
{evt_[0] |
IW_EVENT_CAPA_K_0
;vt_[1] |
IW_EVENT_CAPA_K_1
; }

	)

673 
	siw_m


675 
__s32
 
	mvue
;

676 
__u8
 
	mfixed
;

677 
__u8
 
	mdibd
;

678 
__u16
 
	mags
;

685 
	siw_pot


687 *
	mpor
;

688 
__u16
 
	mngth
;

689 
__u16
 
	mags
;

701 
	siw_eq


703 
__s32
 
	mm
;

704 
__s16
 
	me
;

705 
__u8
 
	mi
;

706 
__u8
 
	mags
;

712 
	siw_quy


714 
__u8
 
	mqu
;

716 
__u8
 
	mv
;

717 
__u8
 
	mnoi
;

718 
__u8
 
	mupded
;

728 
	siw_disrded


730 
__u32
 
	mnwid
;

731 
__u32
 
	mcode
;

732 
__u32
 
	magmt
;

733 
__u32
 
	ms
;

734 
__u32
 
	mmisc
;

741 
	siw_misd


743 
__u32
 
	mbc
;

749 
	siw_thry


751 
sockaddr
 
	maddr
;

752 
iw_quy
 
	mqu
;

753 
iw_quy
 
	mlow
;

754 
iw_quy
 
	mhigh
;

768 
	siw_sn_q


770 
__u8
 
	msn_ty
;

771 
__u8
 
	messid_n
;

772 
__u8
 
	mnum_chls
;

774 
__u8
 
	mags
;

777 
sockaddr
 
	mbssid
;

786 
__u8
 
	messid
[
IW_ESSID_MAX_SIZE
];

798 
__u32
 
	mm_chl_time
;

799 
__u32
 
	mmax_chl_time
;

801 
iw_eq
 
	mchl_li
[
IW_MAX_FREQUENCIES
];

830 
	siw_code_ext


832 
__u32
 
	mext_ags
;

833 
__u8
 
	mtx_q
[
IW_ENCODE_SEQ_MAX_SIZE
];

834 
__u8
 
	mrx_q
[
IW_ENCODE_SEQ_MAX_SIZE
];

835 
sockaddr
 
	maddr
;

838 
__u16
 
	mg
;

839 
__u16
 
	mkey_n
;

840 
__u8
 
	mkey
[0];

844 
	siw_mlme


846 
__u16
 
	mcmd
;

847 
__u16
 
	mas_code
;

848 
sockaddr
 
	maddr
;

852 
	#IW_PMKSA_ADD
 1

	)

853 
	#IW_PMKSA_REMOVE
 2

	)

854 
	#IW_PMKSA_FLUSH
 3

	)

856 
	#IW_PMKID_LEN
 16

	)

858 
	siw_pmk


860 
__u32
 
	mcmd
;

861 
sockaddr
 
	mbssid
;

862 
__u8
 
	mpmkid
[
IW_PMKID_LEN
];

866 
	siw_michlmicu


868 
__u32
 
	mags
;

869 
sockaddr
 
	mc_addr
;

870 
__u8
 
	mtsc
[
IW_ENCODE_SEQ_MAX_SIZE
];

874 
	#IW_PMKID_CAND_PREAUTH
 0x00000001

	)

875 
	siw_pmkid_nd


877 
__u32
 
	mags
;

878 
__u32
 
	mdex
;

880 
sockaddr
 
	mbssid
;

887 
	siw_iics


889 
__u16
 
	mus
;

892 
iw_quy
 
	mqu
;

894 
iw_disrded
 
	mdisrd
;

895 
iw_misd
 
	mmiss
;

909 
	uiwq_da


912 
	mme
[
IFNAMSIZ
];

916 
iw_pot
 
	messid
;

917 
iw_m
 
	mnwid
;

918 
iw_eq
 
	meq
;

922 
iw_m
 
	mns
;

923 
iw_m
 
	mb
;

924 
iw_m
 
	mtxpow
;

925 
iw_m
 
	ms
;

926 
iw_m
 
	mag
;

927 
__u32
 
	mmode
;

928 
iw_m
 
	my
;

930 
iw_pot
 
	mcodg
;

931 
iw_m
 
	mpow
;

932 
iw_quy
 
	mqu
;

934 
sockaddr
 
	m_addr
;

935 
sockaddr
 
	maddr
;

937 
iw_m
 
	mm
;

938 
iw_pot
 
	mda
;

947 
	siwq


951 
	min_me
[
IFNAMSIZ
];

952 } 
	mi_in
;

955 
iwq_da
 
	mu
;

968 
	siw_nge


971 
__u32
 
	mthroughput
;

980 
__u32
 
	mm_nwid
;

981 
__u32
 
	mmax_nwid
;

984 
__u16
 
	md_num_chls
;

985 
__u8
 
	md_num_equcy
;

988 
__u8
 
	msn_
;

991 
__u32
 
	mevt_
[6];

994 
__s32
 
	mnsivy
;

1001 
iw_quy
 
	mmax_qu
;

1011 
iw_quy
 
	mavg_qu
;

1014 
__u8
 
	mnum_bs
;

1015 
__s32
 
	mb
[
IW_MAX_BITRATES
];

1018 
__s32
 
	mm_s
;

1019 
__s32
 
	mmax_s
;

1022 
__s32
 
	mm_ag
;

1023 
__s32
 
	mmax_ag
;

1026 
__s32
 
	mm_pmp
;

1027 
__s32
 
	mmax_pmp
;

1028 
__s32
 
	mm_pmt
;

1029 
__s32
 
	mmax_pmt
;

1030 
__u16
 
	mpmp_ags
;

1031 
__u16
 
	mpmt_ags
;

1032 
__u16
 
	mpm_
;

1035 
__u16
 
	mcodg_size
[
IW_MAX_ENCODING_SIZES
];

1036 
__u8
 
	mnum_codg_sizes
;

1037 
__u8
 
	mmax_codg_toks
;

1039 
__u8
 
	mcodg_log_dex
;

1042 
__u16
 
	mtxpow_
;

1043 
__u8
 
	mnum_txpow
;

1044 
__s32
 
	mtxpow
[
IW_MAX_TXPOWER
];

1047 
__u8
 
	mwe_vsi_comped
;

1048 
__u8
 
	mwe_vsi_sour
;

1051 
__u16
 
	my_
;

1052 
__u16
 
	my_ags
;

1053 
__u16
 
	mr_time_ags
;

1054 
__s32
 
	mm_y
;

1055 
__s32
 
	mmax_y
;

1056 
__s32
 
	mm_r_time
;

1057 
__s32
 
	mmax_r_time
;

1060 
__u16
 
	mnum_chls
;

1061 
__u8
 
	mnum_equcy
;

1062 
iw_eq
 
	meq
[
IW_MAX_FREQUENCIES
];

1066 
__u32
 
	mc_
;

1073 
	siw_iv_gs


1075 
__u32
 
	mcmd
;

1076 
__u16
 
	mt_gs
;

1077 
__u16
 
	mg_gs
;

1078 
	mme
[
IFNAMSIZ
];

1091 
	siw_evt


1093 
__u16
 
	mn
;

1094 
__u16
 
	mcmd
;

1095 
iwq_da
 
	mu
;

1099 
	#IW_EV_LCP_LEN
 ((
iw_evt
- (
iwq_da
))

	)

1101 
	#IW_EV_CHAR_LEN
 (
IW_EV_LCP_LEN
 + 
IFNAMSIZ
)

	)

1102 
	#IW_EV_UINT_LEN
 (
IW_EV_LCP_LEN
 + (
__u32
))

	)

1103 
	#IW_EV_FREQ_LEN
 (
IW_EV_LCP_LEN
 + (
iw_eq
))

	)

1104 
	#IW_EV_PARAM_LEN
 (
IW_EV_LCP_LEN
 + (
iw_m
))

	)

1105 
	#IW_EV_ADDR_LEN
 (
IW_EV_LCP_LEN
 + (
sockaddr
))

	)

1106 
	#IW_EV_QUAL_LEN
 (
IW_EV_LCP_LEN
 + (
iw_quy
))

	)

1111 
	#IW_EV_POINT_OFF
 (((*&(((
iw_pot
 *
NULL
)->
ngth
)) - \

1112 (*
NULL
)

	)

1113 
	#IW_EV_POINT_LEN
 (
IW_EV_LCP_LEN
 + (
iw_pot
) - \

1114 
IW_EV_POINT_OFF
)

	)

1118 
	#IW_EV_LCP_PK_LEN
 (4)

	)

1120 
	#IW_EV_CHAR_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + 
IFNAMSIZ
)

	)

1121 
	#IW_EV_UINT_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
__u32
))

	)

1122 
	#IW_EV_FREQ_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_eq
))

	)

1123 
	#IW_EV_PARAM_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_m
))

	)

1124 
	#IW_EV_ADDR_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
sockaddr
))

	)

1125 
	#IW_EV_QUAL_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_quy
))

	)

1126 
	#IW_EV_POINT_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + 4)

	)

	@/usr/include/stdio.h

24 #ide
_STDIO_H


26 #i!
defed
 
__ed_FILE
 && !defed 
__ed___FILE


27 
	#_STDIO_H
 1

	)

28 
	~<us.h
>

30 
	g__BEGIN_DECLS


32 
	#__ed_size_t


	)

33 
	#__ed_NULL


	)

34 
	~<ddef.h
>

36 
	~<bs/tys.h
>

37 
	#__ed_FILE


	)

38 
	#__ed___FILE


	)

42 #i!
defed
 
__FILE_defed
 && defed 
__ed_FILE


45 
	g_IO_FILE
;

47 
__BEGIN_NAMESPACE_STD


49 
_IO_FILE
 
	tFILE
;

50 
	g__END_NAMESPACE_STD


51 #i
defed
 
__USE_LARGEFILE64
 || defed 
__USE_SVID
 || defed 
__USE_POSIX
 \

52 || 
defed
 
	g__USE_BSD
 || defed 
	g__USE_ISOC99
 || defed 
	g__USE_XOPEN
 \

53 || 
defed
 
__USE_POSIX2


54 
	$__USING_NAMESPACE_STD
(
FILE
)

57 
	#__FILE_defed
 1

	)

59 #unde
__ed_FILE


62 #i!
defed
 
____FILE_defed
 && defed 
__ed___FILE


65 
_IO_FILE
 
	t__FILE
;

67 
	#____FILE_defed
 1

	)

69 #unde
__ed___FILE


72 #ifdef 
_STDIO_H


73 
	#_STDIO_USES_IOSTREAM


	)

75 
	~<libio.h
>

77 #i
defed
 
__USE_XOPEN
 || defed 
__USE_XOPEN2K8


78 #ifde
__GNUC__


79 #ide
_VA_LIST_DEFINED


80 
_G_va_li
 
	tva_li
;

81 
	#_VA_LIST_DEFINED


	)

84 
	~<dg.h
>

88 #ifde
__USE_XOPEN2K8


89 #ide
__off_t_defed


90 #ide
__USE_FILE_OFFSET64


91 
__off_t
 
	toff_t
;

93 
__off64_t
 
	toff_t
;

95 
	#__off_t_defed


	)

97 #i
defed
 
__USE_LARGEFILE64
 && !defed 
__off64_t_defed


98 
__off64_t
 
	toff64_t
;

99 
	#__off64_t_defed


	)

102 #ide
__ssize_t_defed


103 
__ssize_t
 
	tssize_t
;

104 
	#__ssize_t_defed


	)

109 
__BEGIN_NAMESPACE_STD


110 #ide
__USE_FILE_OFFSET64


111 
_G_os_t
 
	tos_t
;

113 
_G_os64_t
 
	tos_t
;

115 
__END_NAMESPACE_STD


116 #ifde
__USE_LARGEFILE64


117 
_G_os64_t
 
	tos64_t
;

121 
	#_IOFBF
 0

	)

122 
	#_IOLBF
 1

	)

123 
	#_IONBF
 2

	)

127 #ide
BUFSIZ


128 
	#BUFSIZ
 
_IO_BUFSIZ


	)

134 #ide
EOF


135 
	#EOF
 (-1)

	)

141 
	#SEEK_SET
 0

	)

142 
	#SEEK_CUR
 1

	)

143 
	#SEEK_END
 2

	)

144 #ifde
__USE_GNU


145 
	#SEEK_DATA
 3

	)

146 
	#SEEK_HOLE
 4

	)

150 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN


152 
	#P_tmpd
 "/tmp"

	)

165 
	~<bs/dio_lim.h
>

169 
_IO_FILE
 *
d
;

170 
_IO_FILE
 *
dout
;

171 
_IO_FILE
 *
dr
;

173 
	#d
 
d


	)

174 
	#dout
 
dout


	)

175 
	#dr
 
dr


	)

177 
__BEGIN_NAMESPACE_STD


179 
	$move
 (
__cڡ
 *
__fame

__THROW
;

181 
	$me
 (
__cڡ
 *
__d
, __cڡ *
__w

__THROW
;

182 
__END_NAMESPACE_STD


184 #ifde
__USE_ATFILE


186 
	$mt
 (
__dfd
, 
__cڡ
 *
__d
, 
__wfd
,

187 
__cڡ
 *
__w

__THROW
;

190 
__BEGIN_NAMESPACE_STD


195 #ide
__USE_FILE_OFFSET64


196 
FILE
 *
	$tmpfe
 (
__wur
;

198 #ifde
__REDIRECT


199 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64

__wur
;

201 
	#tmpfe
 
tmpfe64


	)

205 #ifde
__USE_LARGEFILE64


206 
FILE
 *
	$tmpfe64
 (
__wur
;

210 *
	$tmam
 (*
__s

__THROW
 
__wur
;

211 
__END_NAMESPACE_STD


213 #ifde
__USE_MISC


216 *
	$tmam_r
 (*
__s

__THROW
 
__wur
;

220 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN


228 *
	$mam
 (
__cڡ
 *
__d
, __cڡ *
__pfx
)

229 
__THROW
 
__ibu_mloc__
 
__wur
;

233 
__BEGIN_NAMESPACE_STD


238 
	`fo
 (
FILE
 *
__am
);

243 
	`fush
 (
FILE
 *
__am
);

244 
__END_NAMESPACE_STD


246 #ifde
__USE_MISC


253 
	`fush_uocked
 (
FILE
 *
__am
);

256 #ifde
__USE_GNU


263 
	`fol
 ();

267 
__BEGIN_NAMESPACE_STD


268 #ide
__USE_FILE_OFFSET64


273 
FILE
 *
	$fݒ
 (
__cڡ
 *
__ri
 
__fame
,

274 
__cڡ
 *
__ri
 
__modes

__wur
;

279 
FILE
 *
	$eݒ
 (
__cڡ
 *
__ri
 
__fame
,

280 
__cڡ
 *
__ri
 
__modes
,

281 
FILE
 *
__ri
 
__am

__wur
;

283 #ifde
__REDIRECT


284 
FILE
 *
	`__REDIRECT
 (
fݒ
, (
__cڡ
 *
__ri
 
__fame
,

285 
__cڡ
 *
__ri
 
__modes
), 
fݒ64
)

286 
__wur
;

287 
FILE
 *
	`__REDIRECT
 (
eݒ
, (
__cڡ
 *
__ri
 
__fame
,

288 
__cڡ
 *
__ri
 
__modes
,

289 
FILE
 *
__ri
 
__am
), 
eݒ64
)

290 
__wur
;

292 
	#fݒ
 
fݒ64


	)

293 
	#eݒ
 
eݒ64


	)

296 
__END_NAMESPACE_STD


297 #ifde
__USE_LARGEFILE64


298 
FILE
 *
	$fݒ64
 (
__cڡ
 *
__ri
 
__fame
,

299 
__cڡ
 *
__ri
 
__modes

__wur
;

300 
FILE
 *
	$eݒ64
 (
__cڡ
 *
__ri
 
__fame
,

301 
__cڡ
 *
__ri
 
__modes
,

302 
FILE
 *
__ri
 
__am

__wur
;

305 #ifdef 
__USE_POSIX


307 
FILE
 *
	$fdݒ
 (
__fd
, 
__cڡ
 *
__modes

__THROW
 
__wur
;

310 #ifdef 
__USE_GNU


313 
FILE
 *
	$fݒcook
 (*
__ri
 
__magic_cook
,

314 
__cڡ
 *
__ri
 
__modes
,

315 
_IO_cook_io_funis_t
 
__io_funcs

__THROW
 
__wur
;

318 #ifde
__USE_XOPEN2K8


320 
FILE
 *
	$fmemݒ
 (*
__s
, 
size_t
 
__n
, 
__cڡ
 *
__modes
)

321 
__THROW
 
__wur
;

326 
FILE
 *
	$ݒ_memam
 (**
__buoc
, 
size_t
 *
__sizoc

__THROW
 
__wur
;

330 
__BEGIN_NAMESPACE_STD


333 
	$tbuf
 (
FILE
 *
__ri
 
__am
, *__ri 
__buf

__THROW
;

337 
	$tvbuf
 (
FILE
 *
__ri
 
__am
, *__ri 
__buf
,

338 
__modes
, 
size_t
 
__n

__THROW
;

339 
__END_NAMESPACE_STD


341 #ifdef 
__USE_BSD


344 
	$tbufr
 (
FILE
 *
__ri
 
__am
, *__ri 
__buf
,

345 
size_t
 
__size

__THROW
;

348 
	$ebuf
 (
FILE
 *
__am

__THROW
;

352 
__BEGIN_NAMESPACE_STD


357 
	`rtf
 (
FILE
 *
__ri
 
__am
,

358 
__cڡ
 *
__ri
 
__fm
, ...);

363 
	`tf
 (
__cڡ
 *
__ri
 
__fm
, ...);

365 
	$rtf
 (*
__ri
 
__s
,

366 
__cڡ
 *
__ri
 
__fm
, ...
__THROWNL
;

372 
	`vrtf
 (
FILE
 *
__ri
 
__s
, 
__cڡ
 *__ri 
__fm
,

373 
_G_va_li
 
__g
);

378 
	`vtf
 (
__cڡ
 *
__ri
 
__fm
, 
_G_va_li
 
__g
);

380 
	$vrtf
 (*
__ri
 
__s
, 
__cڡ
 *__ri 
__fm
,

381 
_G_va_li
 
__g

__THROWNL
;

382 
__END_NAMESPACE_STD


384 #i
defed
 
__USE_BSD
 || defed 
__USE_ISOC99
 || defed 
__USE_UNIX98


385 
__BEGIN_NAMESPACE_C99


387 
	$tf
 (*
__ri
 
__s
, 
size_t
 
__maxn
,

388 
__cڡ
 *
__ri
 
__fm
, ...)

389 
__THROWNL
 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 3, 4)));

391 
	$vtf
 (*
__ri
 
__s
, 
size_t
 
__maxn
,

392 
__cڡ
 *
__ri
 
__fm
, 
_G_va_li
 
__g
)

393 
__THROWNL
 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 3, 0)));

394 
__END_NAMESPACE_C99


397 #ifde
__USE_GNU


400 
	$vartf
 (**
__ri
 
__r
, 
__cڡ
 *__ri 
__f
,

401 
_G_va_li
 
__g
)

402 
__THROWNL
 
	`__ibu__
 ((
	$__fm__
 (
__tf__
, 2, 0))
__wur
;

403 
	$__artf
 (**
__ri
 
__r
,

404 
__cڡ
 *
__ri
 
__fmt
, ...)

405 
__THROWNL
 
	`__ibu__
 ((
	$__fm__
 (
__tf__
, 2, 3))
__wur
;

406 
	$artf
 (**
__ri
 
__r
,

407 
__cڡ
 *
__ri
 
__fmt
, ...)

408 
__THROWNL
 
	`__ibu__
 ((
	$__fm__
 (
__tf__
, 2, 3))
__wur
;

411 #ifde
__USE_XOPEN2K8


418 
	$vdtf
 (
__fd
, 
__cڡ
 *
__ri
 
__fmt
,

419 
_G_va_li
 
__g
)

420 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 2, 0)));

421 
	$dtf
 (
__fd
, 
__cڡ
 *
__ri
 
__fmt
, ...)

422 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 2, 3)));

426 
__BEGIN_NAMESPACE_STD


431 
	$fsnf
 (
FILE
 *
__ri
 
__am
,

432 
__cڡ
 *
__ri
 
__fm
, ...
__wur
;

437 
	$snf
 (
__cڡ
 *
__ri
 
__fm
, ...
__wur
;

439 
	$ssnf
 (
__cڡ
 *
__ri
 
__s
,

440 
__cڡ
 *
__ri
 
__fm
, ...
__THROW
;

442 #i
defed
 
__USE_ISOC99
 && !defed 
__USE_GNU
 \

443 && (!
defed
 
__LDBL_COMPAT
 || !defed 
__REDIRECT
) \

444 && (
defed
 
__STRICT_ANSI__
 || defed 
__USE_XOPEN2K
)

445 #ifde
__REDIRECT


449 
	`__REDIRECT
 (
fsnf
, (
FILE
 *
__ri
 
__am
,

450 
__cڡ
 *
__ri
 
__fm
, ...),

451 
__isoc99_fsnf

__wur
;

452 
	`__REDIRECT
 (
snf
, (
__cڡ
 *
__ri
 
__fm
, ...),

453 
__isoc99_snf

__wur
;

454 
	`__REDIRECT_NTH
 (
ssnf
, (
__cڡ
 *
__ri
 
__s
,

455 
__cڡ
 *
__ri
 
__fm
, ...),

456 
__isoc99_ssnf
);

458 
	$__isoc99_fsnf
 (
FILE
 *
__ri
 
__am
,

459 
__cڡ
 *
__ri
 
__fm
, ...
__wur
;

460 
	$__isoc99_snf
 (
__cڡ
 *
__ri
 
__fm
, ...
__wur
;

461 
	$__isoc99_ssnf
 (
__cڡ
 *
__ri
 
__s
,

462 
__cڡ
 *
__ri
 
__fm
, ...
__THROW
;

463 
	#fsnf
 
__isoc99_fsnf


	)

464 
	#snf
 
__isoc99_snf


	)

465 
	#ssnf
 
__isoc99_ssnf


	)

469 
__END_NAMESPACE_STD


471 #ifdef 
__USE_ISOC99


472 
__BEGIN_NAMESPACE_C99


477 
	$vfsnf
 (
FILE
 *
__ri
 
__s
, 
__cڡ
 *__ri 
__fm
,

478 
_G_va_li
 
__g
)

479 
	`__ibu__
 ((
	$__fm__
 (
__snf__
, 2, 0))
__wur
;

485 
	$vsnf
 (
__cڡ
 *
__ri
 
__fm
, 
_G_va_li
 
__g
)

486 
	`__ibu__
 ((
	$__fm__
 (
__snf__
, 1, 0))
__wur
;

489 
	$vssnf
 (
__cڡ
 *
__ri
 
__s
,

490 
__cڡ
 *
__ri
 
__fm
, 
_G_va_li
 
__g
)

491 
__THROW
 
	`__ibu__
 ((
	`__fm__
 (
__snf__
, 2, 0)));

493 #i!
defed
 
__USE_GNU
 \

494 && (!
defed
 
__LDBL_COMPAT
 || !defed 
__REDIRECT
) \

495 && (
defed
 
__STRICT_ANSI__
 || defed 
__USE_XOPEN2K
)

496 #ifde
__REDIRECT


500 
	`__REDIRECT
 (
vfsnf
,

501 (
FILE
 *
__ri
 
__s
,

502 
__cڡ
 *
__ri
 
__fm
, 
_G_va_li
 
__g
),

503 
__isoc99_vfsnf
)

504 
	`__ibu__
 ((
	$__fm__
 (
__snf__
, 2, 0))
__wur
;

505 
	`__REDIRECT
 (
vsnf
, (
__cڡ
 *
__ri
 
__fm
,

506 
_G_va_li
 
__g
), 
__isoc99_vsnf
)

507 
	`__ibu__
 ((
	$__fm__
 (
__snf__
, 1, 0))
__wur
;

508 
	`__REDIRECT_NTH
 (
vssnf
,

509 (
__cڡ
 *
__ri
 
__s
,

510 
__cڡ
 *
__ri
 
__fm
,

511 
_G_va_li
 
__g
), 
__isoc99_vssnf
)

512 
	`__ibu__
 ((
	`__fm__
 (
__snf__
, 2, 0)));

514 
	$__isoc99_vfsnf
 (
FILE
 *
__ri
 
__s
,

515 
__cڡ
 *
__ri
 
__fm
,

516 
_G_va_li
 
__g

__wur
;

517 
	$__isoc99_vsnf
 (
__cڡ
 *
__ri
 
__fm
,

518 
_G_va_li
 
__g

__wur
;

519 
	$__isoc99_vssnf
 (
__cڡ
 *
__ri
 
__s
,

520 
__cڡ
 *
__ri
 
__fm
,

521 
_G_va_li
 
__g

__THROW
;

522 
	#vfsnf
 
__isoc99_vfsnf


	)

523 
	#vsnf
 
__isoc99_vsnf


	)

524 
	#vssnf
 
__isoc99_vssnf


	)

528 
__END_NAMESPACE_C99


532 
__BEGIN_NAMESPACE_STD


537 
	`fgc
 (
FILE
 *
__am
);

538 
	`gc
 (
FILE
 *
__am
);

544 
	`gch
 ();

545 
__END_NAMESPACE_STD


549 
	#gc
(
_

	`_IO_gc
 (_)

	)

551 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC


556 
	`gc_uocked
 (
FILE
 *
__am
);

557 
	`gch_uocked
 ();

560 #ifde
__USE_MISC


567 
	`fgc_uocked
 (
FILE
 *
__am
);

571 
__BEGIN_NAMESPACE_STD


579 
	`utc
 (
__c
, 
FILE
 *
__am
);

580 
	`putc
 (
__c
, 
FILE
 *
__am
);

586 
	`putch
 (
__c
);

587 
__END_NAMESPACE_STD


591 
	#putc
(
_ch
, 
_

	`_IO_putc
 (_ch, _)

	)

593 #ifde
__USE_MISC


600 
	`utc_uocked
 (
__c
, 
FILE
 *
__am
);

603 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC


608 
	`putc_uocked
 (
__c
, 
FILE
 *
__am
);

609 
	`putch_uocked
 (
__c
);

613 #i
defed
 
__USE_SVID
 || defed 
__USE_MISC
 \

614 || (
defed
 
__USE_XOPEN
 && !defed 
__USE_XOPEN2K
)

616 
	`gw
 (
FILE
 *
__am
);

619 
	`putw
 (
__w
, 
FILE
 *
__am
);

623 
__BEGIN_NAMESPACE_STD


628 *
	$fgs
 (*
__ri
 
__s
, 
__n
, 
FILE
 *__ri 
__am
)

629 
__wur
;

636 *
	$gs
 (*
__s

__wur
;

637 
__END_NAMESPACE_STD


639 #ifde
__USE_GNU


646 *
	$fgs_uocked
 (*
__ri
 
__s
, 
__n
,

647 
FILE
 *
__ri
 
__am

__wur
;

651 #ifdef 
__USE_XOPEN2K8


662 
_IO_ssize_t
 
	$__gdim
 (**
__ri
 
__l
,

663 
size_t
 *
__ri
 
__n
, 
__dim
,

664 
FILE
 *
__ri
 
__am

__wur
;

665 
_IO_ssize_t
 
	$gdim
 (**
__ri
 
__l
,

666 
size_t
 *
__ri
 
__n
, 
__dim
,

667 
FILE
 *
__ri
 
__am

__wur
;

675 
_IO_ssize_t
 
	$gle
 (**
__ri
 
__l
,

676 
size_t
 *
__ri
 
__n
,

677 
FILE
 *
__ri
 
__am

__wur
;

681 
__BEGIN_NAMESPACE_STD


686 
	`uts
 (
__cڡ
 *
__ri
 
__s
, 
FILE
 *__ri 
__am
);

692 
	`puts
 (
__cڡ
 *
__s
);

699 
	`ungc
 (
__c
, 
FILE
 *
__am
);

706 
size_t
 
	$d
 (*
__ri
 
__r
, 
size_t
 
__size
,

707 
size_t
 
__n
, 
FILE
 *
__ri
 
__am

__wur
;

712 
size_t
 
	`fwre
 (
__cڡ
 *
__ri
 
__r
, size_
__size
,

713 
size_t
 
__n
, 
FILE
 *
__ri
 
__s
);

714 
__END_NAMESPACE_STD


716 #ifde
__USE_GNU


723 
	`uts_uocked
 (
__cڡ
 *
__ri
 
__s
,

724 
FILE
 *
__ri
 
__am
);

727 #ifde
__USE_MISC


734 
size_t
 
	$d_uocked
 (*
__ri
 
__r
, 
size_t
 
__size
,

735 
size_t
 
__n
, 
FILE
 *
__ri
 
__am

__wur
;

736 
size_t
 
	`fwre_uocked
 (
__cڡ
 *
__ri
 
__r
, size_
__size
,

737 
size_t
 
__n
, 
FILE
 *
__ri
 
__am
);

741 
__BEGIN_NAMESPACE_STD


746 
	`fek
 (
FILE
 *
__am
, 
__off
, 
__wh
);

751 
	$l
 (
FILE
 *
__am

__wur
;

756 
	`wd
 (
FILE
 *
__am
);

757 
__END_NAMESPACE_STD


764 #i
defed
 
__USE_LARGEFILE
 || defed 
__USE_XOPEN2K


765 #ide
__USE_FILE_OFFSET64


770 
	`feko
 (
FILE
 *
__am
, 
__off_t
 
__off
, 
__wh
);

775 
__off_t
 
	$lo
 (
FILE
 *
__am

__wur
;

777 #ifde
__REDIRECT


778 
	`__REDIRECT
 (
feko
,

779 (
FILE
 *
__am
, 
__off64_t
 
__off
, 
__wh
),

780 
feko64
);

781 
__off64_t
 
	`__REDIRECT
 (
lo
, (
FILE
 *
__am
), 
lo64
);

783 
	#feko
 
feko64


	)

784 
	#lo
 
lo64


	)

789 
__BEGIN_NAMESPACE_STD


790 #ide
__USE_FILE_OFFSET64


795 
	`fgpos
 (
FILE
 *
__ri
 
__am
, 
os_t
 *__ri 
__pos
);

800 
	`fos
 (
FILE
 *
__am
, 
__cڡ
 
os_t
 *
__pos
);

802 #ifde
__REDIRECT


803 
	`__REDIRECT
 (
fgpos
, (
FILE
 *
__ri
 
__am
,

804 
os_t
 *
__ri
 
__pos
), 
fgpos64
);

805 
	`__REDIRECT
 (
fos
,

806 (
FILE
 *
__am
, 
__cڡ
 
os_t
 *
__pos
), 
fos64
);

808 
	#fgpos
 
fgpos64


	)

809 
	#fos
 
fos64


	)

812 
__END_NAMESPACE_STD


814 #ifde
__USE_LARGEFILE64


815 
	`feko64
 (
FILE
 *
__am
, 
__off64_t
 
__off
, 
__wh
);

816 
__off64_t
 
	$lo64
 (
FILE
 *
__am

__wur
;

817 
	`fgpos64
 (
FILE
 *
__ri
 
__am
, 
os64_t
 *__ri 
__pos
);

818 
	`fos64
 (
FILE
 *
__am
, 
__cڡ
 
os64_t
 *
__pos
);

821 
__BEGIN_NAMESPACE_STD


823 
	$
 (
FILE
 *
__am

__THROW
;

825 
	$of
 (
FILE
 *
__am

__THROW
 
__wur
;

827 
	$
 (
FILE
 *
__am

__THROW
 
__wur
;

828 
__END_NAMESPACE_STD


830 #ifde
__USE_MISC


832 
	$_uocked
 (
FILE
 *
__am

__THROW
;

833 
	$of_uocked
 (
FILE
 *
__am

__THROW
 
__wur
;

834 
	$_uocked
 (
FILE
 *
__am

__THROW
 
__wur
;

838 
__BEGIN_NAMESPACE_STD


843 
	`
 (
__cڡ
 *
__s
);

844 
__END_NAMESPACE_STD


850 
	~<bs/sys_i.h
>

853 #ifdef 
__USE_POSIX


855 
	$fo
 (
FILE
 *
__am

__THROW
 
__wur
;

858 #ifde
__USE_MISC


860 
	$fo_uocked
 (
FILE
 *
__am

__THROW
 
__wur
;

864 #i(
defed
 
__USE_POSIX2
 || defed 
__USE_SVID
 || defed 
__USE_BSD
 || \

865 
defed
 
__USE_MISC
)

870 
FILE
 *
	$pݒ
 (
__cڡ
 *
__commd
, __cڡ *
__modes

__wur
;

876 
	`po
 (
FILE
 *
__am
);

880 #ifdef 
__USE_POSIX


882 *
	$mid
 (*
__s

__THROW
;

886 #ifde
__USE_XOPEN


888 *
	`curid
 (*
__s
);

892 #ifdef 
__USE_GNU


893 
oback
;

896 
	$oback_tf
 (
oback
 *
__ri
 
__oback
,

897 
__cڡ
 *
__ri
 
__fm
, ...)

898 
__THROWNL
 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 2, 3)));

899 
	$oback_vtf
 (
oback
 *
__ri
 
__oback
,

900 
__cڡ
 *
__ri
 
__fm
,

901 
_G_va_li
 
__gs
)

902 
__THROWNL
 
	`__ibu__
 ((
	`__fm__
 (
__tf__
, 2, 0)));

906 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC


910 
	$ockfe
 (
FILE
 *
__am

__THROW
;

914 
	$rylockfe
 (
FILE
 *
__am

__THROW
 
__wur
;

917 
	$fuockfe
 (
FILE
 *
__am

__THROW
;

920 #i
defed
 
__USE_XOPEN
 && !defed 
__USE_XOPEN2K
 && !defed 
__USE_GNU


924 
	#__ed_gt


	)

925 
	~<gt.h
>

930 #ifde
__USE_EXTERN_INLINES


931 
	~<bs/dio.h
>

933 #i
__USE_FORTIFY_LEVEL
 > 0 && 
defed
 
__ex_ways_le


934 
	~<bs/dio2.h
>

936 #ifde
__LDBL_COMPAT


937 
	~<bs/dio-ldbl.h
>

940 
__END_DECLS


	@/usr/include/stdlib.h

23 #idef 
_STDLIB_H


25 
	~<us.h
>

28 
	#__ed_size_t


	)

29 #ide
__ed_mloc_d_oc


30 
	#__ed_wch_t


	)

31 
	#__ed_NULL


	)

33 
	~<ddef.h
>

35 
	g__BEGIN_DECLS


37 #ide
__ed_mloc_d_oc


38 
	#_STDLIB_H
 1

	)

40 #i(
defed
 
__USE_XOPEN
 || defed 
__USE_XOPEN2K8
&& !defed 
_SYS_WAIT_H


42 
	~<bs/waags.h
>

43 
	~<bs/waus.h
>

45 #ifde
__USE_BSD


50 #i
defed
 
__GNUC__
 && !defed 
__lulus


51 
	#__WAIT_INT
(
us
) \

52 (
	`__exnsi__
 (((uni { 
	`__tyof
(
us

__
; 
__i
; }) \

53 { .
__
 = (
us
}).
__i
))

	)

55 
	#__WAIT_INT
(
us
(*(*&(us))

	)

63 #i!
defed
 
__GNUC__
 || __GNUC__ < 2 || defed 
__lulus


64 
	#__WAIT_STATUS
 *

	)

65 
	#__WAIT_STATUS_DEFN
 *

	)

70 
wa
 *
	m__ur
;

71 *
	m__
;

72 } 
	t__WAIT_STATUS
 
	t__ibu__
 ((
	t__t_uni__
));

73 
	#__WAIT_STATUS_DEFN
 *

	)

78 
	#__WAIT_INT
(
us
(us)

	)

79 
	#__WAIT_STATUS
 *

	)

80 
	#__WAIT_STATUS_DEFN
 *

	)

85 
	#WEXITSTATUS
(
us

	`__WEXITSTATUS
 (
	`__WAIT_INT
 (us))

	)

86 
	#WTERMSIG
(
us

	`__WTERMSIG
 (
	`__WAIT_INT
 (us))

	)

87 
	#WSTOPSIG
(
us

	`__WSTOPSIG
 (
	`__WAIT_INT
 (us))

	)

88 
	#WIFEXITED
(
us

	`__WIFEXITED
 (
	`__WAIT_INT
 (us))

	)

89 
	#WIFSIGNALED
(
us

	`__WIFSIGNALED
 (
	`__WAIT_INT
 (us))

	)

90 
	#WIFSTOPPED
(
us

	`__WIFSTOPPED
 (
	`__WAIT_INT
 (us))

	)

91 #ifde
__WIFCONTINUED


92 
	#WIFCONTINUED
(
us

	`__WIFCONTINUED
 (
	`__WAIT_INT
 (us))

	)

96 
__BEGIN_NAMESPACE_STD


100 
	mqu
;

101 
	mm
;

102 } 
	tdiv_t
;

105 #ide
__ldiv_t_defed


108 
	mqu
;

109 
	mm
;

110 } 
	tldiv_t
;

111 
	#__ldiv_t_defed
 1

	)

113 
	g__END_NAMESPACE_STD


115 #i
defed
 
__USE_ISOC99
 && !defed 
__div_t_defed


116 
__BEGIN_NAMESPACE_C99


118 
__exnsi__
 struct

120 
	mqu
;

121 
	mm
;

122 } 
	tdiv_t
;

123 
	#__div_t_defed
 1

	)

124 
	g__END_NAMESPACE_C99


129 
	#RAND_MAX
 2147483647

	)

134 
	#EXIT_FAILURE
 1

	)

135 
	#EXIT_SUCCESS
 0

	)

139 
	#MB_CUR_MAX
 (
	`__y_g_mb_cur_max
 ())

	)

140 
size_t
 
	$__y_g_mb_cur_max
 (
__THROW
 
__wur
;

143 
__BEGIN_NAMESPACE_STD


145 
	$of
 (
__cڡ
 *
__Ō
)

146 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1)
__wur
;

148 
	$oi
 (
__cڡ
 *
__Ō
)

149 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1)
__wur
;

151 
	$
 (
__cڡ
 *
__Ō
)

152 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1)
__wur
;

153 
__END_NAMESPACE_STD


155 #i
defed
 
__USE_ISOC99
 || (defed 
__GLIBC_HAVE_LONG_LONG
 && defed 
__USE_MISC
)

156 
__BEGIN_NAMESPACE_C99


158 
__exnsi__
 
	$l
 (
__cڡ
 *
__Ō
)

159 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1)
__wur
;

160 
__END_NAMESPACE_C99


163 
__BEGIN_NAMESPACE_STD


165 
	$od
 (
__cڡ
 *
__ri
 
__Ō
,

166 **
__ri
 
__dr
)

167 
__THROW
 
	`__nnu
 ((1)
__wur
;

168 
__END_NAMESPACE_STD


170 #ifdef 
__USE_ISOC99


171 
__BEGIN_NAMESPACE_C99


173 
	$of
 (
__cڡ
 *
__ri
 
__Ō
,

174 **
__ri
 
__dr

__THROW
 
	`__nnu
 ((1)
__wur
;

176 
	$d
 (
__cڡ
 *
__ri
 
__Ō
,

177 **
__ri
 
__dr
)

178 
__THROW
 
	`__nnu
 ((1)
__wur
;

179 
__END_NAMESPACE_C99


182 
__BEGIN_NAMESPACE_STD


184 
	$
 (
__cڡ
 *
__ri
 
__Ō
,

185 **
__ri
 
__dr
, 
__ba
)

186 
__THROW
 
	`__nnu
 ((1)
__wur
;

188 
	$oul
 (
__cڡ
 *
__ri
 
__Ō
,

189 **
__ri
 
__dr
, 
__ba
)

190 
__THROW
 
	`__nnu
 ((1)
__wur
;

191 
__END_NAMESPACE_STD


193 #i
defed
 
__GLIBC_HAVE_LONG_LONG
 && defed 
__USE_BSD


195 
__exnsi__


196 
	$oq
 (
__cڡ
 *
__ri
 
__Ō
,

197 **
__ri
 
__dr
, 
__ba
)

198 
__THROW
 
	`__nnu
 ((1)
__wur
;

200 
__exnsi__


201 
	$ouq
 (
__cڡ
 *
__ri
 
__Ō
,

202 **
__ri
 
__dr
, 
__ba
)

203 
__THROW
 
	`__nnu
 ((1)
__wur
;

206 #i
defed
 
__USE_ISOC99
 || (defed 
__GLIBC_HAVE_LONG_LONG
 && defed 
__USE_MISC
)

207 
__BEGIN_NAMESPACE_C99


209 
__exnsi__


210 
	$l
 (
__cڡ
 *
__ri
 
__Ō
,

211 **
__ri
 
__dr
, 
__ba
)

212 
__THROW
 
	`__nnu
 ((1)
__wur
;

214 
__exnsi__


215 
	$ou
 (
__cڡ
 *
__ri
 
__Ō
,

216 **
__ri
 
__dr
, 
__ba
)

217 
__THROW
 
	`__nnu
 ((1)
__wur
;

218 
__END_NAMESPACE_C99


222 #ifde
__USE_GNU


236 
	~<xlo.h
>

240 
	$_l
 (
__cڡ
 *
__ri
 
__Ō
,

241 **
__ri
 
__dr
, 
__ba
,

242 
__lo_t
 
__loc

__THROW
 
	`__nnu
 ((1, 4)
__wur
;

244 
	$oul_l
 (
__cڡ
 *
__ri
 
__Ō
,

245 **
__ri
 
__dr
,

246 
__ba
, 
__lo_t
 
__loc
)

247 
__THROW
 
	`__nnu
 ((1, 4)
__wur
;

249 
__exnsi__


250 
	$l_l
 (
__cڡ
 *
__ri
 
__Ō
,

251 **
__ri
 
__dr
, 
__ba
,

252 
__lo_t
 
__loc
)

253 
__THROW
 
	`__nnu
 ((1, 4)
__wur
;

255 
__exnsi__


256 
	$ou_l
 (
__cڡ
 *
__ri
 
__Ō
,

257 **
__ri
 
__dr
,

258 
__ba
, 
__lo_t
 
__loc
)

259 
__THROW
 
	`__nnu
 ((1, 4)
__wur
;

261 
	$od_l
 (
__cڡ
 *
__ri
 
__Ō
,

262 **
__ri
 
__dr
, 
__lo_t
 
__loc
)

263 
__THROW
 
	`__nnu
 ((1, 3)
__wur
;

265 
	$of_l
 (
__cڡ
 *
__ri
 
__Ō
,

266 **
__ri
 
__dr
, 
__lo_t
 
__loc
)

267 
__THROW
 
	`__nnu
 ((1, 3)
__wur
;

269 
	$d_l
 (
__cڡ
 *
__ri
 
__Ō
,

270 **
__ri
 
__dr
,

271 
__lo_t
 
__loc
)

272 
__THROW
 
	`__nnu
 ((1, 3)
__wur
;

276 #ifde
__USE_EXTERN_INLINES


277 
__BEGIN_NAMESPACE_STD


278 
__ex_le
 

279 
	`__NTH
 (
	$of
 (
__cڡ
 *
__Ō
))

281  
	`od
 (
__Ō
, (**
NULL
);

282 
	}
}

283 
__ex_le
 

284 
__NTH
 (
	$oi
 (
__cڡ
 *
__Ō
))

286  (
	`
 (
__Ō
, (**
NULL
, 10);

287 
	}
}

288 
__ex_le
 

289 
__NTH
 (
	$
 (
__cڡ
 *
__Ō
))

291  
	`
 (
__Ō
, (**
NULL
, 10);

292 
	}
}

293 
	g__END_NAMESPACE_STD


295 #i
defed
 
__USE_MISC
 || defed 
__USE_ISOC99


296 
__BEGIN_NAMESPACE_C99


297 
__exnsi__
 
__ex_le
 

298 
__NTH
 (
	$l
 (
__cڡ
 *
__Ō
))

300  
	`l
 (
__Ō
, (**
NULL
, 10);

301 
	}
}

302 
	g__END_NAMESPACE_C99


307 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN_EXTENDED


311 *
	$l64a
 (
__n

__THROW
 
__wur
;

314 
	$a64l
 (
__cڡ
 *
__s
)

315 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1)
__wur
;

319 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN_EXTENDED
 || defed 
__USE_BSD


320 
	~<sys/tys.h
>

327 
	$ndom
 (
__THROW
;

330 
	$dom
 (
__ed

__THROW
;

336 *
	$e
 (
__ed
, *
__ebuf
,

337 
size_t
 
__

__THROW
 
	`__nnu
 ((2));

341 *
	$te
 (*
__ebuf

__THROW
 
	`__nnu
 ((1));

344 #ifde
__USE_MISC


349 
	sndom_da


351 
t32_t
 *

;

352 
t32_t
 *

;

353 
t32_t
 *
e
;

354 
nd_ty
;

355 
nd_deg
;

356 
nd_p
;

357 
t32_t
 *
d_r
;

360 
	$ndom_r
 (
ndom_da
 *
__ri
 
__buf
,

361 
t32_t
 *
__ri
 
__su

__THROW
 
	`__nnu
 ((1, 2));

363 
	$dom_r
 (
__ed
, 
ndom_da
 *
__buf
)

364 
__THROW
 
	`__nnu
 ((2));

366 
	$e_r
 (
__ed
, *
__ri
 
__ebuf
,

367 
size_t
 
__
,

368 
ndom_da
 *
__ri
 
__buf
)

369 
__THROW
 
	`__nnu
 ((2, 4));

371 
	$te_r
 (*
__ri
 
__ebuf
,

372 
ndom_da
 *
__ri
 
__buf
)

373 
__THROW
 
	`__nnu
 ((1, 2));

378 
__BEGIN_NAMESPACE_STD


380 
	$nd
 (
__THROW
;

382 
	$d
 (
__ed

__THROW
;

383 
__END_NAMESPACE_STD


385 #ifde
__USE_POSIX


387 
	$nd_r
 (*
__ed

__THROW
;

391 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN


395 
	$dnd48
 (
__THROW
;

396 
	$d48
 (
__xsubi
[3]
__THROW
 
	`__nnu
 ((1));

399 
	$̪d48
 (
__THROW
;

400 
	$Īd48
 (
__xsubi
[3])

401 
__THROW
 
	`__nnu
 ((1));

404 
	$mnd48
 (
__THROW
;

405 
	$jnd48
 (
__xsubi
[3])

406 
__THROW
 
	`__nnu
 ((1));

409 
	$d48
 (
__edv

__THROW
;

410 *
	$ed48
 (
__ed16v
[3])

411 
__THROW
 
	`__nnu
 ((1));

412 
	$lcg48
 (
__m
[7]
__THROW
 
	`__nnu
 ((1));

414 #ifde
__USE_MISC


418 
	sdnd48_da


420 
__x
[3];

421 
__d_x
[3];

422 
__c
;

423 
__
;

424 
__a
;

428 
	$dnd48_r
 (
dnd48_da
 *
__ri
 
__bufr
,

429 *
__ri
 
__su

__THROW
 
	`__nnu
 ((1, 2));

430 
	$d48_r
 (
__xsubi
[3],

431 
dnd48_da
 *
__ri
 
__bufr
,

432 *
__ri
 
__su

__THROW
 
	`__nnu
 ((1, 2));

435 
	$̪d48_r
 (
dnd48_da
 *
__ri
 
__bufr
,

436 *
__ri
 
__su
)

437 
__THROW
 
	`__nnu
 ((1, 2));

438 
	$Īd48_r
 (
__xsubi
[3],

439 
dnd48_da
 *
__ri
 
__bufr
,

440 *
__ri
 
__su
)

441 
__THROW
 
	`__nnu
 ((1, 2));

444 
	$mnd48_r
 (
dnd48_da
 *
__ri
 
__bufr
,

445 *
__ri
 
__su
)

446 
__THROW
 
	`__nnu
 ((1, 2));

447 
	$jnd48_r
 (
__xsubi
[3],

448 
dnd48_da
 *
__ri
 
__bufr
,

449 *
__ri
 
__su
)

450 
__THROW
 
	`__nnu
 ((1, 2));

453 
	$d48_r
 (
__edv
, 
dnd48_da
 *
__bufr
)

454 
__THROW
 
	`__nnu
 ((2));

456 
	$ed48_r
 (
__ed16v
[3],

457 
dnd48_da
 *
__bufr

__THROW
 
	`__nnu
 ((1, 2));

459 
	$lcg48_r
 (
__m
[7],

460 
dnd48_da
 *
__bufr
)

461 
__THROW
 
	`__nnu
 ((1, 2));

467 #ide
__mloc_d_oc_defed


468 
	#__mloc_d_oc_defed


	)

469 
__BEGIN_NAMESPACE_STD


471 *
	$mloc
 (
size_t
 
__size

__THROW
 
__ibu_mloc__
 
__wur
;

473 *
	$oc
 (
size_t
 
__nmemb
, size_
__size
)

474 
__THROW
 
__ibu_mloc__
 
__wur
;

475 
__END_NAMESPACE_STD


478 #ide
__ed_mloc_d_oc


479 
__BEGIN_NAMESPACE_STD


485 *
	$loc
 (*
__r
, 
size_t
 
__size
)

486 
__THROW
 
__ibu_wn_unud_su__
;

488 
	$
 (*
__r

__THROW
;

489 
__END_NAMESPACE_STD


491 #ifdef 
__USE_MISC


493 
	$c
 (*
__r

__THROW
;

496 #i
defed
 
__USE_GNU
 || defed 
__USE_BSD
 || defed 
__USE_MISC


497 
	~<lo.h
>

500 #i(
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_XOPEN2K
) \

501 || 
defed
 
__USE_BSD


503 *
	$vloc
 (
size_t
 
__size

__THROW
 
__ibu_mloc__
 
__wur
;

506 #ifde
__USE_XOPEN2K


508 
	$posix_memign
 (**
__memr
, 
size_t
 
__ignmt
, size_
__size
)

509 
__THROW
 
	`__nnu
 ((1)
__wur
;

512 
__BEGIN_NAMESPACE_STD


514 
	$abt
 (
__THROW
 
	`__ibu__
 ((
__nܑu__
));

518 
	`ex
 ((*
__func
()
__THROW
 
	`__nnu
 ((1));

520 #ifde
__USE_GNU


524 #ifde
__lulus


525 "C++" 
	`_quick_ex
 ((*
__func
) ())

526 
__THROW
 
	`__asm
 ("_quick_ex"
	`__nnu
 ((1));

528 
	`_quick_ex
 ((*
__func
()
__THROW
 
	`__nnu
 ((1));

531 
__END_NAMESPACE_STD


533 #ifdef 
__USE_MISC


536 
	`_ex
 ((*
__func
(
__us
, *
__g
), *__arg)

537 
__THROW
 
	`__nnu
 ((1));

540 
__BEGIN_NAMESPACE_STD


544 
	$ex
 (
__us

__THROW
 
	`__ibu__
 ((
__nܑu__
));

546 #ifde
__USE_GNU


552 
	$quick_ex
 (
__us

__THROW
 
	`__ibu__
 ((
__nܑu__
));

554 
__END_NAMESPACE_STD


556 #ifde
__USE_ISOC99


557 
__BEGIN_NAMESPACE_C99


560 
	$_Ex
 (
__us

__THROW
 
	`__ibu__
 ((
__nܑu__
));

561 
__END_NAMESPACE_C99


565 
__BEGIN_NAMESPACE_STD


567 *
	$gv
 (
__cڡ
 *
__me

__THROW
 
	`__nnu
 ((1)
__wur
;

568 
__END_NAMESPACE_STD


572 *
	$__cu_gv
 (
__cڡ
 *
__me
)

573 
__THROW
 
	`__nnu
 ((1)
__wur
;

575 #i
defed
 
__USE_SVID
 || defed 
__USE_XOPEN


579 
	$punv
 (*
__rg

__THROW
 
	`__nnu
 ((1));

582 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN2K


585 
	$nv
 (
__cڡ
 *
__me
, __cڡ *
__vue
, 
__a
)

586 
__THROW
 
	`__nnu
 ((2));

589 
	$unnv
 (
__cڡ
 *
__me

__THROW
 
	`__nnu
 ((1));

592 #ifdef 
__USE_MISC


596 
	$nv
 (
__THROW
;

600 #i
defed
 
__USE_MISC
 \

601 || (
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_XOPEN2K
)

606 *
	$mkmp
 (*
__me

__THROW
 
	`__nnu
 ((1)
__wur
;

609 #i
defed
 
__USE_MISC
 || defed 
__USE_XOPEN_EXTENDED
 \

610 || 
defed
 
__USE_XOPEN2K8


619 #ide
__USE_FILE_OFFSET64


620 
	$mkemp
 (*
__me

	`__nnu
 ((1)
__wur
;

622 #ifde
__REDIRECT


623 
	`__REDIRECT
 (
mkemp
, (*
__me
), 
mkemp64
)

624 
	`__nnu
 ((1)
__wur
;

626 
	#mkemp
 
mkemp64


	)

629 #ifde
__USE_LARGEFILE64


630 
	$mkemp64
 (*
__me

	`__nnu
 ((1)
__wur
;

634 #ifde
__USE_MISC


641 #ide
__USE_FILE_OFFSET64


642 
	$mkemps
 (*
__me
, 
__suffixn

	`__nnu
 ((1)
__wur
;

644 #ifde
__REDIRECT


645 
	`__REDIRECT
 (
mkemps
, (*
__me
, 
__suffixn
),

646 
mkemps64

	`__nnu
 ((1)
__wur
;

648 
	#mkemps
 
mkemps64


	)

651 #ifde
__USE_LARGEFILE64


652 
	$mkemps64
 (*
__me
, 
__suffixn
)

653 
	`__nnu
 ((1)
__wur
;

657 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN2K8


663 *
	$mkdmp
 (*
__me

__THROW
 
	`__nnu
 ((1)
__wur
;

666 #ifde
__USE_GNU


673 #ide
__USE_FILE_OFFSET64


674 
	$mkoemp
 (*
__me
, 
__ags

	`__nnu
 ((1)
__wur
;

676 #ifde
__REDIRECT


677 
	`__REDIRECT
 (
mkoemp
, (*
__me
, 
__ags
), 
mkoemp64
)

678 
	`__nnu
 ((1)
__wur
;

680 
	#mkoemp
 
mkoemp64


	)

683 #ifde
__USE_LARGEFILE64


684 
	$mkoemp64
 (*
__me
, 
__ags

	`__nnu
 ((1)
__wur
;

693 #ide
__USE_FILE_OFFSET64


694 
	$mkoemps
 (*
__me
, 
__suffixn
, 
__ags
)

695 
	`__nnu
 ((1)
__wur
;

697 #ifde
__REDIRECT


698 
	`__REDIRECT
 (
mkoemps
, (*
__me
, 
__suffixn
,

699 
__ags
), 
mkoemps64
)

700 
	`__nnu
 ((1)
__wur
;

702 
	#mkoemps
 
mkoemps64


	)

705 #ifde
__USE_LARGEFILE64


706 
	$mkoemps64
 (*
__me
, 
__suffixn
, 
__ags
)

707 
	`__nnu
 ((1)
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$syem
 (
__cڡ
 *
__commd

__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$nilize_fe_me
 (
__cڡ
 *
__me
)

725 
__THROW
 
	`__nnu
 ((1)
__wur
;

728 #i
defed
 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED


734 *
	$th
 (
__cڡ
 *
__ri
 
__me
,

735 *
__ri
 
__sved

__THROW
 
__wur
;

740 #ide
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__comr__t
(
	t__cڡ
 *, __const *);

744 #ifdef 
__USE_GNU


745 
__comr__t
 
	tcomris__t
;

748 #ifde
__USE_GNU


749 (*
	t__comr_d__t
(
	t__cڡ
 *, __const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$bch
 (
__cڡ
 *
__key
, __cڡ *
__ba
,

756 
size_t
 
__nmemb
, size_
__size
, 
__comr__t
 
__comr
)

757 
	`__nnu
 ((1, 2, 5)
__wur
;

761 
	$qst
 (*
__ba
, 
size_t
 
__nmemb
, size_
__size
,

762 
__comr__t
 
__comr

	`__nnu
 ((1, 4));

763 #ifde
__USE_GNU


764 
	$qst_r
 (*
__ba
, 
size_t
 
__nmemb
, size_
__size
,

765 
__comr_d__t
 
__comr
, *
__g
)

766 
	`__nnu
 ((1, 4));

771 
	$abs
 (
__x

__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

772 
	$bs
 (
__x

__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

773 
__END_NAMESPACE_STD


775 #ifde
__USE_ISOC99


776 
__exnsi__
 
	$abs
 (
__x
)

777 
__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

781 
__BEGIN_NAMESPACE_STD


785 
div_t
 
	$div
 (
__num
, 
__dom
)

786 
__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

787 
ldiv_t
 
	$ldiv
 (
__num
, 
__dom
)

788 
__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

789 
__END_NAMESPACE_STD


791 #ifde
__USE_ISOC99


792 
__BEGIN_NAMESPACE_C99


793 
__exnsi__
 
div_t
 
	$div
 (
__num
,

794 
__dom
)

795 
__THROW
 
	`__ibu__
 ((
__cڡ__
)
__wur
;

796 
__END_NAMESPACE_C99


800 #i(
defed
 
__USE_XOPEN_EXTENDED
 && !defed 
__USE_XOPEN2K
) \

801 || 
defed
 
__USE_SVID


808 *
	$ecvt
 (
__vue
, 
__ndig
, *
__ri
 
__det
,

809 *
__ri
 
__sign

__THROW
 
	`__nnu
 ((3, 4)
__wur
;

814 *
	$fcvt
 (
__vue
, 
__ndig
, *
__ri
 
__det
,

815 *
__ri
 
__sign

__THROW
 
	`__nnu
 ((3, 4)
__wur
;

820 *
	$gcvt
 (
__vue
, 
__ndig
, *
__buf
)

821 
__THROW
 
	`__nnu
 ((3)
__wur
;

824 #ifde
__USE_MISC


826 *
	$qecvt
 (
__vue
, 
__ndig
,

827 *
__ri
 
__det
, *__ri 
__sign
)

828 
__THROW
 
	`__nnu
 ((3, 4)
__wur
;

829 *
	$qfcvt
 (
__vue
, 
__ndig
,

830 *
__ri
 
__det
, *__ri 
__sign
)

831 
__THROW
 
	`__nnu
 ((3, 4)
__wur
;

832 *
	$qgcvt
 (
__vue
, 
__ndig
, *
__buf
)

833 
__THROW
 
	`__nnu
 ((3)
__wur
;

838 
	$ecvt_r
 (
__vue
, 
__ndig
, *
__ri
 
__det
,

839 *
__ri
 
__sign
, *__ri 
__buf
,

840 
size_t
 
__n

__THROW
 
	`__nnu
 ((3, 4, 5));

841 
	$fcvt_r
 (
__vue
, 
__ndig
, *
__ri
 
__det
,

842 *
__ri
 
__sign
, *__ri 
__buf
,

843 
size_t
 
__n

__THROW
 
	`__nnu
 ((3, 4, 5));

845 
	$qecvt_r
 (
__vue
, 
__ndig
,

846 *
__ri
 
__det
, *__ri 
__sign
,

847 *
__ri
 
__buf
, 
size_t
 
__n
)

848 
__THROW
 
	`__nnu
 ((3, 4, 5));

849 
	$qfcvt_r
 (
__vue
, 
__ndig
,

850 *
__ri
 
__det
, *__ri 
__sign
,

851 *
__ri
 
__buf
, 
size_t
 
__n
)

852 
__THROW
 
	`__nnu
 ((3, 4, 5));

857 
__BEGIN_NAMESPACE_STD


860 
	$mbn
 (
__cڡ
 *
__s
, 
size_t
 
__n

__THROW
 
__wur
;

863 
	$mbtowc
 (
wch_t
 *
__ri
 
__pwc
,

864 
__cڡ
 *
__ri
 
__s
, 
size_t
 
__n

__THROW
 
__wur
;

867 
	$womb
 (*
__s
, 
wch_t
 
__wch

__THROW
 
__wur
;

871 
size_t
 
	$mbowcs
 (
wch_t
 *
__ri
 
__pwcs
,

872 
__cڡ
 *
__ri
 
__s
, 
size_t
 
__n

__THROW
;

874 
size_t
 
	$wcombs
 (*
__ri
 
__s
,

875 
__cڡ
 
wch_t
 *
__ri
 
__pwcs
, 
size_t
 
__n
)

876 
__THROW
;

877 
__END_NAMESPACE_STD


880 #ifde
__USE_SVID


885 
	$mch
 (
__cڡ
 *
__ڣ

__THROW
 
	`__nnu
 ((1)
__wur
;

889 #i
defed
 
__USE_XOPEN_EXTENDED
 || defed 
__USE_XOPEN2K8


896 
	$gsubt
 (**
__ri
 
__tip
,

897 *
__cڡ
 *
__ri
 
__toks
,

898 **
__ri
 
__vu
)

899 
__THROW
 
	`__nnu
 ((1, 2, 3)
__wur
;

903 #ifde
__USE_XOPEN


905 
	$tkey
 (
__cڡ
 *
__key

__THROW
 
	`__nnu
 ((1));

911 #ifde
__USE_XOPEN2KXSI


913 
	$posix_ݒ
 (
__oag

__wur
;

916 #ifde
__USE_XOPEN


921 
	$g
 (
__fd

__THROW
;

925 
	$uock
 (
__fd

__THROW
;

930 *
	$ame
 (
__fd

__THROW
 
__wur
;

933 #ifde
__USE_GNU


937 
	$ame_r
 (
__fd
, *
__buf
, 
size_t
 
__bu
)

938 
__THROW
 
	`__nnu
 ((2));

941 
	`g
 ();

944 #ifde
__USE_BSD


948 
	$gldavg
 (
__ldavg
[], 
__m
)

949 
__THROW
 
	`__nnu
 ((1));

954 #i
__USE_FORTIFY_LEVEL
 > 0 && 
defed
 
__ex_ways_le


955 
	~<bs/dlib.h
>

957 #ifde
__LDBL_COMPAT


958 
	~<bs/dlib-ldbl.h
>

962 #unde
__ed_mloc_d_oc


964 
__END_DECLS


	@/usr/include/string.h

24 #idef 
_STRING_H


25 
	#_STRING_H
 1

	)

27 
	~<us.h
>

29 
	g__BEGIN_DECLS


32 
	#__ed_size_t


	)

33 
	#__ed_NULL


	)

34 
	~<ddef.h
>

37 #i
defed
 
__lulus
 && 
__GNUC_PREREQ
 (4, 4)

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 
__BEGIN_NAMESPACE_STD


44 *
	$memy
 (*
__ri
 
__de
,

45 
__cڡ
 *
__ri
 
__c
, 
size_t
 
__n
)

46 
__THROW
 
	`__nnu
 ((1, 2));

49 *
	$memmove
 (*
__de
, 
__cڡ
 *
__c
, 
size_t
 
__n
)

50 
__THROW
 
	`__nnu
 ((1, 2));

51 
__END_NAMESPACE_STD


56 #i
defed
 
__USE_SVID
 || defed 
__USE_BSD
 || defed 
__USE_XOPEN


57 *
	$memcy
 (*
__ri
 
__de
, 
__cڡ
 *__ri 
__c
,

58 
__c
, 
size_t
 
__n
)

59 
__THROW
 
	`__nnu
 ((1, 2));

63 
__BEGIN_NAMESPACE_STD


65 *
	$memt
 (*
__s
, 
__c
, 
size_t
 
__n

__THROW
 
	`__nnu
 ((1));

68 
	$memcmp
 (
__cڡ
 *
__s1
, __cڡ *
__s2
, 
size_t
 
__n
)

69 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

72 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


75 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

76 
__THROW
 
	`__asm
 ("memchr"
__ibu_pu__
 
	`__nnu
 ((1));

77 
__cڡ
 *
	`memchr
 (__cڡ *
__s
, 
__c
, 
size_t
 
__n
)

78 
__THROW
 
	`__asm
 ("memchr"
__ibu_pu__
 
	`__nnu
 ((1));

80 #ifde
__OPTIMIZE__


81 
__ex_ways_le
 *

82 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n

__THROW


84  
	`__but_memchr
 (
__s
, 
__c
, 
__n
);

87 
__ex_ways_le
 
__cڡ
 *

88 
	`memchr
 (
__cڡ
 *
__s
, 
__c
, 
size_t
 
__n

__THROW


90  
	`__but_memchr
 (
__s
, 
__c
, 
__n
);

93 
	}
}

95 *
	$memchr
 (
__cڡ
 *
__s
, 
__c
, 
size_t
 
__n
)

96 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

98 
__END_NAMESPACE_STD


100 #ifde
__USE_GNU


103 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


104 "C++" *
	$wmemchr
 (*
__s
, 
__c
)

105 
__THROW
 
	`__asm
 ("wmemchr"
__ibu_pu__
 
	`__nnu
 ((1));

106 "C++" 
__cڡ
 *
	$wmemchr
 (
__cڡ
 *
__s
, 
__c
)

107 
__THROW
 
	`__asm
 ("wmemchr"
__ibu_pu__
 
	`__nnu
 ((1));

109 *
	$wmemchr
 (
__cڡ
 *
__s
, 
__c
)

110 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

114 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


115 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

116 
__THROW
 
	`__asm
 ("memrchr"
__ibu_pu__
 
	`__nnu
 ((1));

117 "C++" 
__cڡ
 *
	$memrchr
 (
__cڡ
 *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
	`__asm
 ("memrchr"
__ibu_pu__
 
	`__nnu
 ((1));

120 *
	$memrchr
 (
__cڡ
 *
__s
, 
__c
, 
size_t
 
__n
)

121 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

126 
__BEGIN_NAMESPACE_STD


128 *
	$ry
 (*
__ri
 
__de
, 
__cڡ
 *__ri 
__c
)

129 
__THROW
 
	`__nnu
 ((1, 2));

131 *
	$y
 (*
__ri
 
__de
,

132 
__cڡ
 *
__ri
 
__c
, 
size_t
 
__n
)

133 
__THROW
 
	`__nnu
 ((1, 2));

136 *
	$rt
 (*
__ri
 
__de
, 
__cڡ
 *__ri 
__c
)

137 
__THROW
 
	`__nnu
 ((1, 2));

139 *
	$t
 (*
__ri
 
__de
, 
__cڡ
 *__ri 
__c
,

140 
size_t
 
__n

__THROW
 
	`__nnu
 ((1, 2));

143 
	$rcmp
 (
__cڡ
 *
__s1
, __cڡ *
__s2
)

144 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

146 
	$cmp
 (
__cڡ
 *
__s1
, __cڡ *
__s2
, 
size_t
 
__n
)

147 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

150 
	$rcl
 (
__cڡ
 *
__s1
, __cڡ *
__s2
)

151 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

153 
size_t
 
	$rxm
 (*
__ri
 
__de
,

154 
__cڡ
 *
__ri
 
__c
, 
size_t
 
__n
)

155 
__THROW
 
	`__nnu
 ((2));

156 
__END_NAMESPACE_STD


158 #ifde
__USE_XOPEN2K8


162 
	~<xlo.h
>

165 
	$rcl_l
 (
__cڡ
 *
__s1
, __cڡ *
__s2
, 
__lo_t
 
__l
)

166 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2, 3));

168 
size_t
 
	$rxm_l
 (*
__de
, 
__cڡ
 *
__c
, 
size_t
 
__n
,

169 
__lo_t
 
__l

__THROW
 
	`__nnu
 ((2, 4));

172 #i
defed
 
__USE_SVID
 || defed 
__USE_BSD
 || defed 
__USE_XOPEN_EXTENDED
 \

173 || 
defed
 
__USE_XOPEN2K8


175 *
	$rdup
 (
__cڡ
 *
__s
)

176 
__THROW
 
__ibu_mloc__
 
	`__nnu
 ((1));

182 #i
defed
 
__USE_XOPEN2K8


183 *
	$dup
 (
__cڡ
 *
__rg
, 
size_t
 
__n
)

184 
__THROW
 
__ibu_mloc__
 
	`__nnu
 ((1));

187 #i
defed
 
__USE_GNU
 && defed 
__GNUC__


189 
	#rdu
(
s
) \

190 (
__exnsi__
 \

192 
__cڡ
 *
__d
 = (
s
); \

193 
size_t
 
__n
 = 
	`
 (
__d
) + 1; \

194 *
__w
 = (*
	`__but_lo
 (
__n
); \

195 (*
	`memy
 (
__w
, 
__d
, 
__n
); \

196 
	}
}))

	)

199 
	#du
(
s
, 
n
) \

200 (
__exnsi__
 \

202 
__cڡ
 *
__d
 = (
s
); \

203 
size_t
 
__n
 = 
	`n
 (
__d
, (
n
)); \

204 *
__w
 = (*
	`__but_lo
 (
__n
 + 1); \

205 
__w
[
__n
] = '\0'; \

206 (*
	`memy
 (
__w
, 
__d
, 
__n
); \

207 }))

	)

210 
	g__BEGIN_NAMESPACE_STD


212 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


215 *
rchr
 (*
__s
, 
__c
)

216 
__THROW
 
__asm
 ("rchr"
__ibu_pu__
 
__nnu
 ((1));

217 
__cڡ
 *
rchr
 (__cڡ *
__s
, 
__c
)

218 
__THROW
 
__asm
 ("rchr"
__ibu_pu__
 
__nnu
 ((1));

220 #ifde
__OPTIMIZE__


221 
__ex_ways_le
 *

222 
rchr
 (*
__s
, 
__c

	g__THROW


224  
__but_rchr
 (
__s
, 
__c
);

227 
__ex_ways_le
 
__cڡ
 *

228 
rchr
 (
__cڡ
 *
__s
, 
__c

	g__THROW


230  
__but_rchr
 (
__s
, 
__c
);

235 *
	$rchr
 (
__cڡ
 *
__s
, 
__c
)

236 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

239 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


242 *
	`chr
 (*
__s
, 
__c
)

243 
__THROW
 
	`__asm
 ("chr"
__ibu_pu__
 
	`__nnu
 ((1));

244 
__cڡ
 *
	`chr
 (__cڡ *
__s
, 
__c
)

245 
__THROW
 
	`__asm
 ("chr"
__ibu_pu__
 
	`__nnu
 ((1));

247 #ifde
__OPTIMIZE__


248 
__ex_ways_le
 *

249 
	`chr
 (*
__s
, 
__c

__THROW


251  
	`__but_chr
 (
__s
, 
__c
);

254 
__ex_ways_le
 
__cڡ
 *

255 
	`chr
 (
__cڡ
 *
__s
, 
__c

__THROW


257  
	`__but_chr
 (
__s
, 
__c
);

260 
	}
}

262 *
	$chr
 (
__cڡ
 *
__s
, 
__c
)

263 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

265 
__END_NAMESPACE_STD


267 #ifde
__USE_GNU


270 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


271 "C++" *
	$rchul
 (*
__s
, 
__c
)

272 
__THROW
 
	`__asm
 ("rchul"
__ibu_pu__
 
	`__nnu
 ((1));

273 "C++" 
__cڡ
 *
	$rchul
 (
__cڡ
 *
__s
, 
__c
)

274 
__THROW
 
	`__asm
 ("rchul"
__ibu_pu__
 
	`__nnu
 ((1));

276 *
	$rchul
 (
__cڡ
 *
__s
, 
__c
)

277 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

281 
__BEGIN_NAMESPACE_STD


284 
size_t
 
	$rcn
 (
__cڡ
 *
__s
, __cڡ *
__je
)

285 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

288 
size_t
 
	$rn
 (
__cڡ
 *
__s
, __cڡ *
__ac
)

289 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

291 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


294 *
	`brk
 (*
__s
, 
__cڡ
 *
__ac
)

295 
__THROW
 
	`__asm
 ("brk"
__ibu_pu__
 
	`__nnu
 ((1, 2));

296 
__cڡ
 *
	`brk
 (__cڡ *
__s
, __cڡ *
__ac
)

297 
__THROW
 
	`__asm
 ("brk"
__ibu_pu__
 
	`__nnu
 ((1, 2));

299 #ifde
__OPTIMIZE__


300 
__ex_ways_le
 *

301 
	`brk
 (*
__s
, 
__cڡ
 *
__ac

__THROW


303  
	`__but_brk
 (
__s
, 
__ac
);

306 
__ex_ways_le
 
__cڡ
 *

307 
	`brk
 (
__cڡ
 *
__s
, __cڡ *
__ac

__THROW


309  
	`__but_brk
 (
__s
, 
__ac
);

312 
	}
}

314 *
	$brk
 (
__cڡ
 *
__s
, __cڡ *
__ac
)

315 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

318 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


321 *
	`rr
 (*
__hayack
, 
__cڡ
 *
__ed
)

322 
__THROW
 
	`__asm
 ("rr"
__ibu_pu__
 
	`__nnu
 ((1, 2));

323 
__cڡ
 *
	`rr
 (__cڡ *
__hayack
,

324 
__cڡ
 *
__ed
)

325 
__THROW
 
	`__asm
 ("rr"
__ibu_pu__
 
	`__nnu
 ((1, 2));

327 #ifde
__OPTIMIZE__


328 
__ex_ways_le
 *

329 
	`rr
 (*
__hayack
, 
__cڡ
 *
__ed

__THROW


331  
	`__but_rr
 (
__hayack
, 
__ed
);

334 
__ex_ways_le
 
__cڡ
 *

335 
	`rr
 (
__cڡ
 *
__hayack
, __cڡ *
__ed

__THROW


337  
	`__but_rr
 (
__hayack
, 
__ed
);

340 
	}
}

342 *
	$rr
 (
__cڡ
 *
__hayack
, __cڡ *
__ed
)

343 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

348 *
	$ok
 (*
__ri
 
__s
, 
__cڡ
 *__ri 
__dim
)

349 
__THROW
 
	`__nnu
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__ok_r
 (*
__ri
 
__s
,

355 
__cڡ
 *
__ri
 
__dim
,

356 **
__ri
 
__ve_r
)

357 
__THROW
 
	`__nnu
 ((2, 3));

358 #i
defed
 
__USE_POSIX
 || defed 
__USE_MISC


359 *
	$ok_r
 (*
__ri
 
__s
, 
__cڡ
 *__ri 
__dim
,

360 **
__ri
 
__ve_r
)

361 
__THROW
 
	`__nnu
 ((2, 3));

364 #ifde
__USE_GNU


366 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$rr
 (*
__hayack
, 
__cڡ
 *
__ed
)

368 
__THROW
 
	`__asm
 ("rr"
__ibu_pu__
 
	`__nnu
 ((1, 2));

369 "C++" 
__cڡ
 *
	$rr
 (
__cڡ
 *
__hayack
,

370 
__cڡ
 *
__ed
)

371 
__THROW
 
	`__asm
 ("rr"
__ibu_pu__
 
	`__nnu
 ((1, 2));

373 *
	$rr
 (
__cڡ
 *
__hayack
, __cڡ *
__ed
)

374 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

378 #ifde
__USE_GNU


382 *
	$memmem
 (
__cڡ
 *
__hayack
, 
size_t
 
__hayackn
,

383 
__cڡ
 *
__ed
, 
size_t
 
__edn
)

384 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 3));

388 *
	$__mempy
 (*
__ri
 
__de
,

389 
__cڡ
 *
__ri
 
__c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nnu
 ((1, 2));

391 *
	$mempy
 (*
__ri
 
__de
,

392 
__cڡ
 *
__ri
 
__c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nnu
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$
 (
__cڡ
 *
__s
)

400 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$n
 (
__cڡ
 *
__rg
, 
size_t
 
__maxn
)

407 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$
 (
__um

__THROW
;

414 
__END_NAMESPACE_STD


415 #i
defed
 
__USE_XOPEN2K
 || defed 
__USE_MISC


423 #i
defed
 
__USE_XOPEN2K
 && !defed 
__USE_GNU


426 #ifde
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
_r
,

428 (
__um
, *
__buf
, 
size_t
 
__bu
),

429 
__xpg__r

	`__nnu
 ((2));

431 
	$__xpg__r
 (
__um
, *
__buf
, 
size_t
 
__bu
)

432 
__THROW
 
	`__nnu
 ((2));

433 
	#_r
 
__xpg__r


	)

438 *
	$_r
 (
__um
, *
__buf
, 
size_t
 
__bu
)

439 
__THROW
 
	`__nnu
 ((2));

443 #ifde
__USE_XOPEN2K8


445 *
	$_l
 (
__um
, 
__lo_t
 
__l

__THROW
;

451 
	$__bzo
 (*
__s
, 
size_t
 
__n

__THROW
 
	`__nnu
 ((1));

453 #ifde
__USE_BSD


455 
	$bcy
 (
__cڡ
 *
__c
, *
__de
, 
size_t
 
__n
)

456 
__THROW
 
	`__nnu
 ((1, 2));

459 
	$bzo
 (*
__s
, 
size_t
 
__n

__THROW
 
	`__nnu
 ((1));

462 
	$bcmp
 (
__cڡ
 *
__s1
, __cڡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

466 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`dex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("dex"
__ibu_pu__
 
	`__nnu
 ((1));

471 
__cڡ
 *
	`dex
 (__cڡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("dex"
__ibu_pu__
 
	`__nnu
 ((1));

474 #i
defed
 
__OPTIMIZE__
 && !defed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex_ways_le
 *

476 
	`dex
 (*
__s
, 
__c

__THROW


478  
	`__but_dex
 (
__s
, 
__c
);

481 
__ex_ways_le
 
__cڡ
 *

482 
	`dex
 (
__cڡ
 *
__s
, 
__c

__THROW


484  
	`__but_dex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$dex
 (
__cڡ
 *
__s
, 
__c
)

490 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

494 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`rdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("rdex"
__ibu_pu__
 
	`__nnu
 ((1));

499 
__cڡ
 *
	`rdex
 (__cڡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("rdex"
__ibu_pu__
 
	`__nnu
 ((1));

502 #i
defed
 
__OPTIMIZE__
 && !defed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex_ways_le
 *

504 
	`rdex
 (*
__s
, 
__c

__THROW


506  
	`__but_rdex
 (
__s
, 
__c
);

509 
__ex_ways_le
 
__cڡ
 *

510 
	`rdex
 (
__cڡ
 *
__s
, 
__c

__THROW


512  
	`__but_rdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$rdex
 (
__cڡ
 *
__s
, 
__c
)

518 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1));

523 
	$ffs
 (
__i

__THROW
 
	`__ibu__
 ((
__cڡ__
));

527 #ifdef 
__USE_GNU


528 
	$ff
 (
__l

__THROW
 
	`__ibu__
 ((
__cڡ__
));

529 #ifde
__GNUC__


530 
__exnsi__
 
	$ffl
 (
__
)

531 
__THROW
 
	`__ibu__
 ((
__cڡ__
));

536 
	$rcmp
 (
__cڡ
 *
__s1
, __cڡ *
__s2
)

537 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

540 
	$cmp
 (
__cڡ
 *
__s1
, __cڡ *
__s2
, 
size_t
 
__n
)

541 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

544 #ifdef 
__USE_GNU


547 
	$rcmp_l
 (
__cڡ
 *
__s1
, __cڡ *
__s2
,

548 
__lo_t
 
__loc
)

549 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2, 3));

551 
	$cmp_l
 (
__cڡ
 *
__s1
, __cڡ *
__s2
,

552 
size_t
 
__n
, 
__lo_t
 
__loc
)

553 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2, 4));

556 #ifdef 
__USE_BSD


559 *
	$rp
 (**
__ri
 
__rgp
,

560 
__cڡ
 *
__ri
 
__dim
)

561 
__THROW
 
	`__nnu
 ((1, 2));

564 #ifdef 
__USE_XOPEN2K8


566 *
	$rsigl
 (
__sig

__THROW
;

569 *
	$__py
 (*
__ri
 
__de
, 
__cڡ
 *__ri 
__c
)

570 
__THROW
 
	`__nnu
 ((1, 2));

571 *
	$py
 (*
__ri
 
__de
, 
__cڡ
 *__ri 
__c
)

572 
__THROW
 
	`__nnu
 ((1, 2));

576 *
	$__y
 (*
__ri
 
__de
,

577 
__cڡ
 *
__ri
 
__c
, 
size_t
 
__n
)

578 
__THROW
 
	`__nnu
 ((1, 2));

579 *
	$y
 (*
__ri
 
__de
,

580 
__cڡ
 *
__ri
 
__c
, 
size_t
 
__n
)

581 
__THROW
 
	`__nnu
 ((1, 2));

584 #ifdef 
__USE_GNU


586 
	$rvscmp
 (
__cڡ
 *
__s1
, __cڡ *
__s2
)

587 
__THROW
 
__ibu_pu__
 
	`__nnu
 ((1, 2));

590 *
	$ry
 (*
__rg

__THROW
 
	`__nnu
 ((1));

593 *
	$memob
 (*
__s
, 
size_t
 
__n

__THROW
 
	`__nnu
 ((1));

595 #ide
bame


600 #ifde
__CORRECT_ISO_CPP_STRING_H_PROTO


601 "C++" *
	$bame
 (*
__fame
)

602 
__THROW
 
	`__asm
 ("bame"
	`__nnu
 ((1));

603 "C++" 
__cڡ
 *
	$bame
 (
__cڡ
 *
__fame
)

604 
__THROW
 
	`__asm
 ("bame"
	`__nnu
 ((1));

606 *
	$bame
 (
__cڡ
 *
__fame

__THROW
 
	`__nnu
 ((1));

612 #i
defed
 
__GNUC__
 && __GNUC__ >= 2

613 #i
defed
 
__OPTIMIZE__
 && !defed 
__OPTIMIZE_SIZE__
 \

614 && !
defed
 
__NO_INLINE__
 && !defed 
__lulus


634 
	~<bs/rg.h
>

637 
	~<bs/rg2.h
>

640 #i
__USE_FORTIFY_LEVEL
 > 0 && 
defed
 
__ex_ways_le


642 
	~<bs/rg3.h
>

646 
__END_DECLS


	@/usr/include/alloca.h

19 #idef 
_ALLOCA_H


20 
	#_ALLOCA_H
 1

	)

22 
	~<us.h
>

24 
	#__ed_size_t


	)

25 
	~<ddef.h
>

27 
	g__BEGIN_DECLS


30 #unde
lo


33 *
	$lo
 (
size_t
 
__size

__THROW
;

35 #ifdef 
__GNUC__


36 
	#lo
(
size

	`__but_lo
 (size)

	)

39 
__END_DECLS


	@/usr/include/features.h

20 #idef 
_FEATURES_H


21 
	#_FEATURES_H
 1

	)

98 #unde
__USE_ISOC99


99 #unde
__USE_ISOC95


100 #unde
__USE_POSIX


101 #unde
__USE_POSIX2


102 #unde
__USE_POSIX199309


103 #unde
__USE_POSIX199506


104 #unde
__USE_XOPEN


105 #unde
__USE_XOPEN_EXTENDED


106 #unde
__USE_UNIX98


107 #unde
__USE_XOPEN2K


108 #unde
__USE_XOPEN2KXSI


109 #unde
__USE_XOPEN2K8


110 #unde
__USE_XOPEN2K8XSI


111 #unde
__USE_LARGEFILE


112 #unde
__USE_LARGEFILE64


113 #unde
__USE_FILE_OFFSET64


114 #unde
__USE_BSD


115 #unde
__USE_SVID


116 #unde
__USE_MISC


117 #unde
__USE_ATFILE


118 #unde
__USE_GNU


119 #unde
__USE_REENTRANT


120 #unde
__USE_FORTIFY_LEVEL


121 #unde
__FAVOR_BSD


122 #unde
__KERNEL_STRICT_NAMES


126 #ide
_LOOSE_KERNEL_NAMES


127 
	#__KERNEL_STRICT_NAMES


	)

131 
	#__USE_ANSI
 1

	)

140 #i
defed
 
__GNUC__
 && defed 
__GNUC_MINOR__


141 
	#__GNUC_PREREQ
(
maj
, 
m
) \

142 ((
__GNUC__
 << 16+ 
__GNUC_MINOR__
 >((
maj
<< 16+ (
m
))

	)

144 
	#__GNUC_PREREQ
(
maj
, 
m
0

	)

149 #i
defed
 
_BSD_SOURCE
 && \

150 !(
defed
 
	g_POSIX_SOURCE
 || defed 
	g_POSIX_C_SOURCE
 || \

151 
defed
 
	g_XOPEN_SOURCE
 || defed 
	g_GNU_SOURCE
 || defed 
	g_SVID_SOURCE
)

152 
	#__FAVOR_BSD
 1

	)

156 #ifde
_GNU_SOURCE


157 #unde
_ISOC95_SOURCE


158 
	#_ISOC95_SOURCE
 1

	)

159 #unde
_ISOC99_SOURCE


160 
	#_ISOC99_SOURCE
 1

	)

161 #unde
_POSIX_SOURCE


162 
	#_POSIX_SOURCE
 1

	)

163 #unde
_POSIX_C_SOURCE


164 
	#_POSIX_C_SOURCE
 200809L

	)

165 #unde
_XOPEN_SOURCE


166 
	#_XOPEN_SOURCE
 700

	)

167 #unde
_XOPEN_SOURCE_EXTENDED


168 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

169 #unde
_LARGEFILE64_SOURCE


170 
	#_LARGEFILE64_SOURCE
 1

	)

171 #unde
_BSD_SOURCE


172 
	#_BSD_SOURCE
 1

	)

173 #unde
_SVID_SOURCE


174 
	#_SVID_SOURCE
 1

	)

175 #unde
_ATFILE_SOURCE


176 
	#_ATFILE_SOURCE
 1

	)

181 #i(!
defed
 
__STRICT_ANSI__
 && !defed 
_ISOC99_SOURCE
 && \

182 !
defed
 
	g_POSIX_SOURCE
 && !defed 
	g_POSIX_C_SOURCE
 && \

183 !
defed
 
	g_XOPEN_SOURCE
 && !defed 
	g_BSD_SOURCE
 && !defed 
	g_SVID_SOURCE
)

184 
	#_BSD_SOURCE
 1

	)

185 
	#_SVID_SOURCE
 1

	)

192 #i(
defed
 
_ISOC99_SOURCE
 || defed 
_ISOC9X_SOURCE
 \

193 || (
defed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

194 
	#__USE_ISOC99
 1

	)

198 #i(
defed
 
_ISOC99_SOURCE
 || defed 
_ISOC9X_SOURCE
 \

199 || (
defed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

200 
	#__USE_ISOC95
 1

	)

205 #i((!
defed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

206 !
defed
 
_POSIX_SOURCE
 && !defed 
_POSIX_C_SOURCE
)

207 
	#_POSIX_SOURCE
 1

	)

208 #i
defed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

209 
	#_POSIX_C_SOURCE
 2

	)

210 #i
defed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

211 
	#_POSIX_C_SOURCE
 199506L

	)

212 #i
defed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

213 
	#_POSIX_C_SOURCE
 200112L

	)

215 
	#_POSIX_C_SOURCE
 200809L

	)

217 
	#__USE_POSIX_IMPLICITLY
 1

	)

220 #i
defed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >1 || defed 
_XOPEN_SOURCE


221 
	#__USE_POSIX
 1

	)

224 #i
defed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || defed 
_XOPEN_SOURCE


225 
	#__USE_POSIX2
 1

	)

228 #i(
_POSIX_C_SOURCE
 - 0) >= 199309L

229 
	#__USE_POSIX199309
 1

	)

232 #i(
_POSIX_C_SOURCE
 - 0) >= 199506L

233 
	#__USE_POSIX199506
 1

	)

236 #i(
_POSIX_C_SOURCE
 - 0) >= 200112L

237 
	#__USE_XOPEN2K
 1

	)

238 #unde
__USE_ISOC95


239 
	#__USE_ISOC95
 1

	)

240 #unde
__USE_ISOC99


241 
	#__USE_ISOC99
 1

	)

244 #i(
_POSIX_C_SOURCE
 - 0) >= 200809L

245 
	#__USE_XOPEN2K8
 1

	)

246 #unde
_ATFILE_SOURCE


247 
	#_ATFILE_SOURCE
 1

	)

250 #ifdef 
_XOPEN_SOURCE


251 
	#__USE_XOPEN
 1

	)

252 #i(
_XOPEN_SOURCE
 - 0) >= 500

253 
	#__USE_XOPEN_EXTENDED
 1

	)

254 
	#__USE_UNIX98
 1

	)

255 #unde
_LARGEFILE_SOURCE


256 
	#_LARGEFILE_SOURCE
 1

	)

257 #i(
_XOPEN_SOURCE
 - 0) >= 600

258 #i(
_XOPEN_SOURCE
 - 0) >= 700

259 
	#__USE_XOPEN2K8
 1

	)

260 
	#__USE_XOPEN2K8XSI
 1

	)

262 
	#__USE_XOPEN2K
 1

	)

263 
	#__USE_XOPEN2KXSI
 1

	)

264 #unde
__USE_ISOC95


265 
	#__USE_ISOC95
 1

	)

266 #unde
__USE_ISOC99


267 
	#__USE_ISOC99
 1

	)

270 #ifde
_XOPEN_SOURCE_EXTENDED


271 
	#__USE_XOPEN_EXTENDED
 1

	)

276 #ifde
_LARGEFILE_SOURCE


277 
	#__USE_LARGEFILE
 1

	)

280 #ifde
_LARGEFILE64_SOURCE


281 
	#__USE_LARGEFILE64
 1

	)

284 #i
defed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

285 
	#__USE_FILE_OFFSET64
 1

	)

288 #i
defed
 
_BSD_SOURCE
 || defed 
_SVID_SOURCE


289 
	#__USE_MISC
 1

	)

292 #ifdef 
_BSD_SOURCE


293 
	#__USE_BSD
 1

	)

296 #ifdef 
_SVID_SOURCE


297 
	#__USE_SVID
 1

	)

300 #ifdef 
_ATFILE_SOURCE


301 
	#__USE_ATFILE
 1

	)

304 #ifdef 
_GNU_SOURCE


305 
	#__USE_GNU
 1

	)

308 #i
defed
 
_REENTRANT
 || defed 
_THREAD_SAFE


309 
	#__USE_REENTRANT
 1

	)

312 #i
defed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

313 && 
__GNUC_PREREQ
 (4, 1&& 
defed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

314 #i
_FORTIFY_SOURCE
 > 1

315 
	#__USE_FORTIFY_LEVEL
 2

	)

317 
	#__USE_FORTIFY_LEVEL
 1

	)

320 
	#__USE_FORTIFY_LEVEL
 0

	)

324 
	~<bs/edefs.h
>

327 
	#__STDC_ISO_10646__
 200009L

	)

335 #unde
__GNU_LIBRARY__


336 
	#__GNU_LIBRARY__
 6

	)

340 
	#__GLIBC__
 2

	)

341 
	#__GLIBC_MINOR__
 15

	)

343 
	#__GLIBC_PREREQ
(
maj
, 
m
) \

344 ((
__GLIBC__
 << 16+ 
__GLIBC_MINOR__
 >((
maj
<< 16+ (
m
))

	)

347 #i
defed
 
__GNUC__
 \

348 || (
defed
 
	g__PGI
 && defed 
	g__i386__
 ) \

349 || (
defed
 
	g__INTEL_COMPILER
 && (defed 
	g__i386__
 || defed 
	g__64__
)) \

350 || (
defed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

351 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

355 #ide
__ASSEMBLER__


356 #ide
_SYS_CDEFS_H


357 
	~<sys/cdefs.h
>

362 #i
defed
 
__USE_FILE_OFFSET64
 && !defed 
__REDIRECT


363 
	#__USE_LARGEFILE
 1

	)

364 
	#__USE_LARGEFILE64
 1

	)

370 #i
__GNUC_PREREQ
 (2, 7&& 
defed
 
__OPTIMIZE__
 \

371 && !
defed
 
	g__OPTIMIZE_SIZE__
 && !defed 
	g__NO_INLINE__
 \

372 && 
defed
 
	g__ex_le


373 
	#__USE_EXTERN_INLINES
 1

	)

378 #i
__GNUC_PREREQ
 (2, 7&& 
defed
 
__OPTIMIZE__
 \

379 && (
defed
 
	g_LIBC
 || !defed 
	g__OPTIMIZE_SIZE__
&& !defed 
	g__NO_INLINE__
 \

380 && 
defed
 
	g__ex_le


381 
	#__USE_EXTERN_INLINES_IN_LIBC
 1

	)

389 
	~<gnu/ubs.h
>

	@/usr/include/getopt.h

21 #ide
_GETOPT_H


23 #ide
__ed_gt


24 
	#_GETOPT_H
 1

	)

34 #i!
defed
 
__GNU_LIBRARY__


35 
	~<y.h
>

38 #ide
__THROW


39 #ide
__GNUC_PREREQ


40 
	#__GNUC_PREREQ
(
maj
, 
m
(0)

	)

42 #i
defed
 
__lulus
 && 
__GNUC_PREREQ
 (2,8)

43 
	#__THROW
 
	`throw
 ()

	)

45 
	#__THROW


	)

49 #ifdef 
__lulus


59 *
ݏrg
;

73 
td
;

78 
݋
;

82 
tt
;

84 #ide
__ed_gt


106 
	sti


108 cڡ *
	gme
;

111 
	ghas_g
;

112 *
	gag
;

113 
	gv
;

118 
	#no_gumt
 0

	)

119 
	#qued_gumt
 1

	)

120 
	#tiڮ_gumt
 2

	)

148 #ifde
__GNU_LIBRARY__


152 
gt
 (
___gc
, *cڡ *
___gv
, cڡ *
__shtts
)

153 
__THROW
;

155 #i
defed
 
__ed_gt
 && defed 
__USE_POSIX2
 \

156 && !
defed
 
	g__USE_POSIX_IMPLICITLY
 && !defed 
	g__USE_GNU


160 #ifde
__REDIRECT


161 
__REDIRECT_NTH
 (
gt
, (
___gc
, *cڡ *
___gv
,

162 cڡ *
__shtts
),

163 
__posix_gt
);

165 
__posix_gt
 (
___gc
, *cڡ *
___gv
,

166 cڡ *
__shtts

__THROW
;

167 
	#gt
 
__posix_gt


	)

171 
gt
 ();

174 #ide
__ed_gt


175 
gt_lg
 (
___gc
, *cڡ *
___gv
,

176 cڡ *
__shtts
,

177 cڡ 
ti
 *
__lgts
, *
__lgd
)

178 
__THROW
;

179 
gt_lg_ly
 (
___gc
, *cڡ *
___gv
,

180 cڡ *
__shtts
,

181 cڡ 
ti
 *
__lgts
, *
__lgd
)

182 
__THROW
;

186 #ifdef 
__lulus


191 #unde
__ed_gt


	@/usr/include/libio.h

29 #ide
_IO_STDIO_H


30 
	#_IO_STDIO_H


	)

32 
	~<_G_cfig.h
>

34 
	#_IO_pos_t
 
_G_os_t


	)

35 
	#_IO_os_t
 
_G_os_t


	)

36 
	#_IO_os64_t
 
_G_os64_t


	)

37 
	#_IO_size_t
 
_G_size_t


	)

38 
	#_IO_ssize_t
 
_G_ssize_t


	)

39 
	#_IO_off_t
 
_G_off_t


	)

40 
	#_IO_off64_t
 
_G_off64_t


	)

41 
	#_IO_pid_t
 
_G_pid_t


	)

42 
	#_IO_uid_t
 
_G_uid_t


	)

43 
	#_IO_icv_t
 
_G_icv_t


	)

44 
	#_IO_HAVE_SYS_WAIT
 
_G_HAVE_SYS_WAIT


	)

45 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

46 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

47 
	#_IO_va_li
 
_G_va_li


	)

48 
	#_IO_wt_t
 
_G_wt_t


	)

50 #ifde
_G_NEED_STDARG_H


52 
	#__ed___va_li


	)

53 
	~<dg.h
>

54 #ifde
__GNUC_VA_LIST


55 #unde
_IO_va_li


56 
	#_IO_va_li
 
__gnuc_va_li


	)

60 #ide
__P


61 #i
_G_HAVE_SYS_CDEFS


62 
	~<sys/cdefs.h
>

64 #ifde
__STDC__


65 
	#__P
(
p

	)
p

66 
	#__PMT
(
p

	)
p

68 
	#__P
(
p
()

	)

69 
	#__PMT
(
p
()

	)

75 #ide
_PARAMS


76 
	#_PARAMS
(
os

	`__P
ros)

	)

79 #ide
__STDC__


81 cڡ

	)

84 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

85 #ide
_G_HAVE_PRINTF_FP


86 
	#_IO_USE_DTOA
 1

	)

89 #ide
EOF


90 
	#EOF
 (-1)

	)

92 #ide
NULL


93 #i
defed
 
__GNUG__
 && \

94 (
	g__GNUC__
 > 2 || (__GNUC__ =2 && 
__GNUC_MINOR__
 >= 8))

95 
	#NULL
 (
__nu
)

	)

97 #i!
defed
(
__lulus
)

98 
	#NULL
 ((*)0)

	)

100 
	#NULL
 (0)

	)

105 
	#_IOS_INPUT
 1

	)

106 
	#_IOS_OUTPUT
 2

	)

107 
	#_IOS_ATEND
 4

	)

108 
	#_IOS_APPEND
 8

	)

109 
	#_IOS_TRUNC
 16

	)

110 
	#_IOS_NOCREATE
 32

	)

111 
	#_IOS_NOREPLACE
 64

	)

112 
	#_IOS_BIN
 128

	)

120 
	#_IO_MAGIC
 0xFBAD0000

	)

121 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

122 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

123 
	#_IO_USER_BUF
 1

	)

124 
	#_IO_UNBUFFERED
 2

	)

125 
	#_IO_NO_READS
 4

	)

126 
	#_IO_NO_WRITES
 8

	)

127 
	#_IO_EOF_SEEN
 0x10

	)

128 
	#_IO_ERR_SEEN
 0x20

	)

129 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

130 
	#_IO_LINKED
 0x80

	)

131 
	#_IO_IN_BACKUP
 0x100

	)

132 
	#_IO_LINE_BUF
 0x200

	)

133 
	#_IO_TIED_PUT_GET
 0x400

	)

134 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

135 
	#_IO_IS_APPENDING
 0x1000

	)

136 
	#_IO_IS_FILEBUF
 0x2000

	)

137 
	#_IO_BAD_SEEN
 0x4000

	)

138 
	#_IO_USER_LOCK
 0x8000

	)

140 
	#_IO_FLAGS2_MMAP
 1

	)

141 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

142 #ifde
_LIBC


143 
	#_IO_FLAGS2_FORTIFY
 4

	)

145 
	#_IO_FLAGS2_USER_WBUF
 8

	)

146 #ifde
_LIBC


147 
	#_IO_FLAGS2_SCANF_STD
 16

	)

148 
	#_IO_FLAGS2_NOCLOSE
 32

	)

149 
	#_IO_FLAGS2_CLOEXEC
 64

	)

153 
	#_IO_SKIPWS
 01

	)

154 
	#_IO_LEFT
 02

	)

155 
	#_IO_RIGHT
 04

	)

156 
	#_IO_INTERNAL
 010

	)

157 
	#_IO_DEC
 020

	)

158 
	#_IO_OCT
 040

	)

159 
	#_IO_HEX
 0100

	)

160 
	#_IO_SHOWBASE
 0200

	)

161 
	#_IO_SHOWPOINT
 0400

	)

162 
	#_IO_UPPERCASE
 01000

	)

163 
	#_IO_SHOWPOS
 02000

	)

164 
	#_IO_SCIENTIFIC
 04000

	)

165 
	#_IO_FIXED
 010000

	)

166 
	#_IO_UNITBUF
 020000

	)

167 
	#_IO_STDIO
 040000

	)

168 
	#_IO_DONT_CLOSE
 0100000

	)

169 
	#_IO_BOOLALPHA
 0200000

	)

172 
_IO_jump_t
; 
	g_IO_FILE
;

175 #ifde
_IO_MTSAFE_IO


176 #i
defed
 
__GLIBC__
 && __GLIBC__ >= 2

177 
	~<bs/dio-lock.h
>

182 
	t_IO_lock_t
;

188 
	s_IO_mk
 {

189 
_IO_mk
 *
	m_xt
;

190 
_IO_FILE
 *
	m_sbuf
;

194 
	m_pos
;

196 
t_ampos
(
ampos
 

{ 
	m_os
 = sp; }

197 
t_offt
(
offt
{ 
	m_pos
 = offt; 
	m_os
 = (
ampos
)(-2); }

198 
	mpublic
:

199 
ammk
(
ambuf
 *
sb
);

200 ~
ammk
();

201 
vg
({  
	m_os
 == -2; }

202 
d
(
ammk
&);

203 
d
();

208 
	e__codecvt_su


210 
	m__codecvt_ok
,

211 
	m__codecvt_l
,

212 
	m__codecvt_r
,

213 
	m__codecvt_nocv


216 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


219 
	s_IO_codecvt


221 (*
	m__codecvt_der
(
	m_IO_codecvt
 *);

222 
__codecvt_su
 (*
__codecvt_do_out
(
	m_IO_codecvt
 *,

223 
	m__mbe_t
 *,

224 cڡ 
	mwch_t
 *,

225 cڡ 
	mwch_t
 *,

226 cڡ 
	mwch_t
 **, *,

228 
__codecvt_su
 (*
__codecvt_do_unshi
(
	m_IO_codecvt
 *,

229 
	m__mbe_t
 *, *,

231 
__codecvt_su
 (*
__codecvt_do_
(
	m_IO_codecvt
 *,

232 
	m__mbe_t
 *,

234 cڡ **, 
	mwch_t
 *,

235 
	mwch_t
 *, wchar_t **);

236 (*
	m__codecvt_do_codg
(
	m_IO_codecvt
 *);

237 (*
	m__codecvt_do_ways_nocv
(
	m_IO_codecvt
 *);

238 (*
	m__codecvt_do_ngth
(
	m_IO_codecvt
 *, 
	m__mbe_t
 *,

239 cڡ *, cڡ *, 
	m_IO_size_t
);

240 (*
	m__codecvt_do_max_ngth
(
	m_IO_codecvt
 *);

242 
_IO_icv_t
 
	m__cd_
;

243 
_IO_icv_t
 
	m__cd_out
;

247 
	s_IO_wide_da


249 
wch_t
 *
	m_IO_ad_r
;

250 
wch_t
 *
	m_IO_ad_d
;

251 
wch_t
 *
	m_IO_ad_ba
;

252 
wch_t
 *
	m_IO_wre_ba
;

253 
wch_t
 *
	m_IO_wre_r
;

254 
wch_t
 *
	m_IO_wre_d
;

255 
wch_t
 *
	m_IO_buf_ba
;

256 
wch_t
 *
	m_IO_buf_d
;

258 
wch_t
 *
	m_IO_ve_ba
;

259 
wch_t
 *
	m_IO_backup_ba
;

261 
wch_t
 *
	m_IO_ve_d
;

263 
__mbe_t
 
	m_IO_e
;

264 
__mbe_t
 
	m_IO_ϡ_e
;

265 
_IO_codecvt
 
	m_codecvt
;

267 
wch_t
 
	m_shtbuf
[1];

269 cڡ 
_IO_jump_t
 *
	m_wide_vb
;

273 
	s_IO_FILE
 {

274 
	m_ags
;

275 
	#_IO_fe_ags
 
_ags


	)

279 * 
	m_IO_ad_r
;

280 * 
	m_IO_ad_d
;

281 * 
	m_IO_ad_ba
;

282 * 
	m_IO_wre_ba
;

283 * 
	m_IO_wre_r
;

284 * 
	m_IO_wre_d
;

285 * 
	m_IO_buf_ba
;

286 * 
	m_IO_buf_d
;

288 *
	m_IO_ve_ba
;

289 *
	m_IO_backup_ba
;

290 *
	m_IO_ve_d
;

292 
_IO_mk
 *
	m_mks
;

294 
_IO_FILE
 *
	m_cha
;

296 
	m_fo
;

298 
	m_blksize
;

300 
	m_ags2
;

302 
_IO_off_t
 
	m_d_offt
;

304 
	#__HAVE_COLUMN


	)

306 
	m_cur_cumn
;

307 sigd 
	m_vb_offt
;

308 
	m_shtbuf
[1];

312 
_IO_lock_t
 *
	m_lock
;

313 #ifde
_IO_USE_OLD_IO_FILE


316 
	s_IO_FILE_come


318 
_IO_FILE
 
	m_fe
;

320 #i
defed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

321 
_IO_off64_t
 
	m_offt
;

322 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


324 
_IO_codecvt
 *
	m_codecvt
;

325 
_IO_wide_da
 *
	m_wide_da
;

326 
_IO_FILE
 *
	m_䓻s_li
;

327 *
	m_䓻s_buf
;

328 
size_t
 
	m_䓻s_size
;

330 *
	m__d1
;

331 *
	m__d2
;

332 *
	m__d3
;

333 *
	m__d4
;

334 
size_t
 
	m__d5
;

336 
	m_mode
;

338 
	m_unud2
[15 *  (- 4 *  (*-  (
size_t
)];

342 #ide
__lulus


343 
_IO_FILE
 
	t_IO_FILE
;

346 
	g_IO_FILE_us
;

348 
_IO_FILE_us
 
_IO_2_1_d_
;

349 
_IO_FILE_us
 
_IO_2_1_dout_
;

350 
_IO_FILE_us
 
_IO_2_1_dr_
;

351 #ide
_LIBC


352 
	#_IO_d
 ((
_IO_FILE
*)(&
_IO_2_1_d_
))

	)

353 
	#_IO_dout
 ((
_IO_FILE
*)(&
_IO_2_1_dout_
))

	)

354 
	#_IO_dr
 ((
_IO_FILE
*)(&
_IO_2_1_dr_
))

	)

356 
_IO_FILE
 *
_IO_d
 
ibu_hidd
;

357 
_IO_FILE
 *
_IO_dout
 
ibu_hidd
;

358 
_IO_FILE
 *
_IO_dr
 
ibu_hidd
;

366 
__ssize_t
 
	t__io_ad_
 (*
	t__cook
, *
	t__buf
, 
	tsize_t
 
	t__nbys
);

374 
__ssize_t
 
	t__io_wre_
 (*
	t__cook
, 
	t__cڡ
 *
	t__buf
,

375 
	tsize_t
 
	t__n
);

383 
	t__io_ek_
 (*
	t__cook
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

386 
	t__io_o_
 (*
	t__cook
);

389 #ifde
_GNU_SOURCE


391 
__io_ad_
 
	tcook_ad_funi_t
;

392 
__io_wre_
 
	tcook_wre_funi_t
;

393 
__io_ek_
 
	tcook_ek_funi_t
;

394 
__io_o_
 
	tcook_o_funi_t
;

399 
__io_ad_
 *
	mad
;

400 
__io_wre_
 *
	mwre
;

401 
__io_ek_
 *
	mek
;

402 
__io_o_
 *
	mo
;

403 } 
	t_IO_cook_io_funis_t
;

404 
_IO_cook_io_funis_t
 
	tcook_io_funis_t
;

406 
	g_IO_cook_fe
;

409 
_IO_cook_
 (
_IO_cook_fe
 *
__cfe
, 
__ad_wre
,

410 *
__cook
, 
_IO_cook_io_funis_t
 
__s
);

414 #ifde
__lulus


418 
__undow
 (
_IO_FILE
 *);

419 
__uow
 (
_IO_FILE
 *);

420 
__ovow
 (
_IO_FILE
 *, );

421 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


422 
_IO_wt_t
 
__wundow
 (
_IO_FILE
 *);

423 
_IO_wt_t
 
__wuow
 (
_IO_FILE
 *);

424 
_IO_wt_t
 
__wovow
 (
_IO_FILE
 *, _IO_wint_t);

427 #i 
__GNUC__
 >= 3

428 
	#_IO_BE
(
ex
, 
s

	`__but_ex
 (x),es)

	)

430 
	#_IO_BE
(
ex
, 
s
x)

	)

433 
	#_IO_gc_uocked
(
_
) \

434 (
	`_IO_BE
 ((
_
)->
_IO_ad_r
 >(_)->
_IO_ad_d
, 0) \

435 ? 
	`__uow
 (
_
: *(*(_)->
_IO_ad_r
++)

	)

436 
	#_IO_ekc_uocked
(
_
) \

437 (
	`_IO_BE
 ((
_
)->
_IO_ad_r
 >(_)->
_IO_ad_d
, 0) \

438 && 
	`__undow
 (
_
=
EOF
 ? EOF \

439 : *(*(
_
)->
_IO_ad_r
)

	)

440 
	#_IO_putc_uocked
(
_ch
, 
_
) \

441 (
	`_IO_BE
 ((
_
)->
_IO_wre_r
 >(_)->
_IO_wre_d
, 0) \

442 ? 
	`__ovow
 (
_
, ((
_ch
)) \

443 : ((*(
_
)->
_IO_wre_r
++ = (
_ch
)))

	)

445 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


446 
	#_IO_gwc_uocked
(
_
) \

447 (
	`_IO_BE
 ((
_
)->
_wide_da
 =
NULL
 \

448 || ((
_
)->
_wide_da
->
_IO_ad_r
 \

449 >(
_
)->
_wide_da
->
_IO_ad_d
), 0) \

450 ? 
	`__wuow
 (
_
: (
_IO_wt_t
*(_)->
_wide_da
->
_IO_ad_r
++)

	)

451 
	#_IO_putwc_uocked
(
_wch
, 
_
) \

452 (
	`_IO_BE
 ((
_
)->
_wide_da
 =
NULL
 \

453 || ((
_
)->
_wide_da
->
_IO_wre_r
 \

454 >(
_
)->
_wide_da
->
_IO_wre_d
), 0) \

455 ? 
	`__wovow
 (
_
, 
_wch
) \

456 : (
_IO_wt_t
(*(
_
)->
_wide_da
->
_IO_wre_r
++ = (
_wch
)))

	)

459 
	#_IO_of_uocked
(
__
(((__)->
_ags
 & 
_IO_EOF_SEEN
!0)

	)

460 
	#_IO__uocked
(
__
(((__)->
_ags
 & 
_IO_ERR_SEEN
!0)

	)

462 
_IO_gc
 (
_IO_FILE
 *
__
);

463 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__
);

464 
_IO_of
 (
_IO_FILE
 *
__

__THROW
;

465 
_IO_
 (
_IO_FILE
 *
__

__THROW
;

467 
_IO_ekc_locked
 (
_IO_FILE
 *
__
);

470 
	#_IO_PENDING_OUTPUT_COUNT
(
_
) \

471 ((
_
)->
_IO_wre_r
 - (_)->
_IO_wre_ba
)

	)

473 
_IO_ockfe
 (
_IO_FILE
 *
__THROW
;

474 
_IO_fuockfe
 (
_IO_FILE
 *
__THROW
;

475 
_IO_rylockfe
 (
_IO_FILE
 *
__THROW
;

477 #ifde
_IO_MTSAFE_IO


478 
	#_IO_ekc
(
_

	`_IO_ekc_locked
 (_)

	)

479 
	#_IO_ockfe
(
_
) \

480 i(((
_
)->
_ags
 & 
_IO_USER_LOCK
=0
	`_IO_ockfe
 (_)

	)

481 
	#_IO_fuockfe
(
_
) \

482 i(((
_
)->
_ags
 & 
_IO_USER_LOCK
=0
	`_IO_fuockfe
 (_)

	)

484 
	#_IO_ekc
(
_

	`_IO_ekc_uocked
 (_)

	)

485 
	#_IO_ockfe
(
_


	)

486 
	#_IO_fuockfe
(
_


	)

487 
	#_IO_rylockfe
(
_


	)

488 
	#_IO_nup_gi_t
(
_f
, 
_


	)

489 
	#_IO_nup_gi_d
(
_Do


	)

492 
_IO_vfsnf
 (
_IO_FILE
 * 
__ri
, const * __restrict,

493 
_IO_va_li
, *
__ri
);

494 
_IO_vrtf
 (
_IO_FILE
 *
__ri
, const *__restrict,

495 
_IO_va_li
);

496 
_IO_ssize_t
 
_IO_dn
 (
_IO_FILE
 *, , _IO_ssize_t);

497 
_IO_size_t
 
_IO_sgn
 (
_IO_FILE
 *, *, _IO_size_t);

499 
_IO_off64_t
 
_IO_ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

500 
_IO_off64_t
 
_IO_ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

502 
_IO__backup_
 (
_IO_FILE
 *
__THROW
;

504 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


505 
_IO_wt_t
 
_IO_gwc
 (
_IO_FILE
 *
__
);

506 
_IO_wt_t
 
_IO_putwc
 (
wch_t
 
__wc
, 
_IO_FILE
 *
__
);

507 
_IO_fwide
 (
_IO_FILE
 *
__
, 
__mode

__THROW
;

508 #i
__GNUC__
 >= 2

511 #i
defed
 
_LIBC
 && defed 
SHARED


512 
	~<shlib-comt.h
>

513 #i
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

514 
	#_IO_fwide_maybe_comtib
 \

515 (
	`__but_ex
 (&
_IO_d_ud
 =
NULL
, 0))

	)

516 cڡ 
_IO_d_ud
;

517 
wk_ex
 (
_IO_d_ud
);

520 #ide
_IO_fwide_maybe_comtib


521 
	#_IO_fwide_maybe_comtib
 (0)

	)

525 
	#_IO_fwide
(
__
, 
__mode
) \

526 ({ 
__su
 = (
__mode
); \

527 i(
__su
 < 0 && ! 
_IO_fwide_maybe_comtib
) \

529 i((
__
)->
_mode
 == 0) \

531 (
__
)->
_mode
 = -1; \

532 
__su
 = (
__
)->
_mode
; \

534 i(
	`__but_cڡt_p
 (
__mode
) && (__mode) == 0) \

535 
__su
 = 
_IO_fwide_maybe_comtib
 ? -1 : (
__
)->
_mode
; \

537 
__su
 = 
	`_IO_fwide
 (
__
, __result); \

538 
__su
; })

	)

541 
_IO_vfwsnf
 (
_IO_FILE
 * 
__ri
, cڡ 
wch_t
 * __restrict,

542 
_IO_va_li
, *
__ri
);

543 
_IO_vfwtf
 (
_IO_FILE
 *
__ri
, cڡ 
wch_t
 *__restrict,

544 
_IO_va_li
);

545 
_IO_ssize_t
 
_IO_wdn
 (
_IO_FILE
 *, 
wt_t
, _IO_ssize_t);

546 
_IO__wbackup_
 (
_IO_FILE
 *
__THROW
;

549 #ifde
__LDBL_COMPAT


550 
	~<bs/libio-ldbl.h
>

553 #ifde
__lulus


	@/usr/include/linux/if.h

19 #ide
_LINUX_IF_H


20 
	#_LINUX_IF_H


	)

22 
	~<lux/tys.h
>

23 
	~<lux/sock.h
>

26 
	#IFNAMSIZ
 16

	)

27 
	#IFALIASZ
 256

	)

28 
	~<lux/hdlc/iol.h
>

31 
	#IFF_UP
 0x1

	)

32 
	#IFF_BROADCAST
 0x2

	)

33 
	#IFF_DEBUG
 0x4

	)

34 
	#IFF_LOOPBACK
 0x8

	)

35 
	#IFF_POINTOPOINT
 0x10

	)

36 
	#IFF_NOTRAILERS
 0x20

	)

37 
	#IFF_RUNNING
 0x40

	)

38 
	#IFF_NOARP
 0x80

	)

39 
	#IFF_PROMISC
 0x100

	)

40 
	#IFF_ALLMULTI
 0x200

	)

42 
	#IFF_MASTER
 0x400

	)

43 
	#IFF_SLAVE
 0x800

	)

45 
	#IFF_MULTICAST
 0x1000

	)

47 
	#IFF_PORTSEL
 0x2000

	)

48 
	#IFF_AUTOMEDIA
 0x4000

	)

49 
	#IFF_DYNAMIC
 0x8000

	)

51 
	#IFF_LOWER_UP
 0x10000

	)

52 
	#IFF_DORMANT
 0x20000

	)

54 
	#IFF_ECHO
 0x40000

	)

56 
	#IFF_VOLATILE
 (
IFF_LOOPBACK
|
IFF_POINTOPOINT
|
IFF_BROADCAST
|
IFF_ECHO
|\

57 
IFF_MASTER
|
IFF_SLAVE
|
IFF_RUNNING
|
IFF_LOWER_UP
|
IFF_DORMANT
)

	)

60 
	#IFF_802_1Q_VLAN
 0x1

	)

61 
	#IFF_EBRIDGE
 0x2

	)

62 
	#IFF_SLAVE_INACTIVE
 0x4

	)

63 
	#IFF_MASTER_8023AD
 0x8

	)

64 
	#IFF_MASTER_ALB
 0x10

	)

65 
	#IFF_BONDING
 0x20

	)

66 
	#IFF_SLAVE_NEEDARP
 0x40

	)

67 
	#IFF_ISATAP
 0x80

	)

68 
	#IFF_MASTER_ARPMON
 0x100

	)

69 
	#IFF_WAN_HDLC
 0x200

	)

70 
	#IFF_XMIT_DST_RELEASE
 0x400

	)

73 
	#IFF_DONT_BRIDGE
 0x800

	)

74 
	#IFF_DISABLE_NETPOLL
 0x1000

	)

75 
	#IFF_MACVLAN_PORT
 0x2000

	)

76 
	#IFF_BRIDGE_PORT
 0x4000

	)

77 
	#IFF_OVS_DATAPATH
 0x8000

	)

79 
	#IFF_TX_SKB_SHARING
 0x10000

	)

81 
	#IFF_UNICAST_FLT
 0x20000

	)

82 
	#IFF_TEAM_PORT
 0x40000

	)

83 
	#IFF_SUPP_NOFCS
 0x80000

	)

86 
	#IF_GET_IFACE
 0x0001

	)

87 
	#IF_GET_PROTO
 0x0002

	)

90 
	#IF_IFACE_V35
 0x1000

	)

91 
	#IF_IFACE_V24
 0x1001

	)

92 
	#IF_IFACE_X21
 0x1002

	)

93 
	#IF_IFACE_T1
 0x1003

	)

94 
	#IF_IFACE_E1
 0x1004

	)

95 
	#IF_IFACE_SYNC_SERIAL
 0x1005

	)

96 
	#IF_IFACE_X21D
 0x1006

	)

99 
	#IF_PROTO_HDLC
 0x2000

	)

100 
	#IF_PROTO_PPP
 0x2001

	)

101 
	#IF_PROTO_CISCO
 0x2002

	)

102 
	#IF_PROTO_FR
 0x2003

	)

103 
	#IF_PROTO_FR_ADD_PVC
 0x2004

	)

104 
	#IF_PROTO_FR_DEL_PVC
 0x2005

	)

105 
	#IF_PROTO_X25
 0x2006

	)

106 
	#IF_PROTO_HDLC_ETH
 0x2007

	)

107 
	#IF_PROTO_FR_ADD_ETH_PVC
 0x2008

	)

108 
	#IF_PROTO_FR_DEL_ETH_PVC
 0x2009

	)

109 
	#IF_PROTO_FR_PVC
 0x200A

	)

110 
	#IF_PROTO_FR_ETH_PVC
 0x200B

	)

111 
	#IF_PROTO_RAW
 0x200C

	)

115 
	mIF_OPER_UNKNOWN
,

116 
	mIF_OPER_NOTPRESENT
,

117 
	mIF_OPER_DOWN
,

118 
	mIF_OPER_LOWERLAYERDOWN
,

119 
	mIF_OPER_TESTING
,

120 
	mIF_OPER_DORMANT
,

121 
	mIF_OPER_UP
,

126 
	mIF_LINK_MODE_DEFAULT
,

127 
	mIF_LINK_MODE_DORMANT
,

140 
	sifm
 {

141 
	mmem_t
;

142 
	mmem_d
;

143 
	mba_addr
;

144 
	mq
;

145 
	mdma
;

146 
	mpt
;

150 
	sif_gs
 {

151 
	mty
;

152 
	msize
;

155 
w_hdlc_o
 *
	mw_hdlc
;

156 
cisco_o
 *
	mcisco
;

157 
_o
 *
	m
;

158 
_o_pvc
 *
	m_pvc
;

159 
_o_pvc_fo
 *
	m_pvc_fo
;

162 
sync_rl_gs
 *
	msync
;

163 
1_gs
 *
	m1
;

164 } 
	mifs_ifsu
;

174 
	sieq
 {

175 
	#IFHWADDRLEN
 6

	)

178 
	min_me
[
IFNAMSIZ
];

179 } 
	mi_in
;

182 
sockaddr
 
	miu_addr
;

183 
sockaddr
 
	miu_daddr
;

184 
sockaddr
 
	miu_brdaddr
;

185 
sockaddr
 
	miu_tmask
;

186 
sockaddr
 
	miu_hwaddr
;

187 
	miu_ags
;

188 
	miu_ivue
;

189 
	miu_mtu
;

190 
ifm
 
	miu_m
;

191 
	miu_ave
[
IFNAMSIZ
];

192 
	miu_wme
[
IFNAMSIZ
];

193 * 
	miu_da
;

194 
if_gs
 
	miu_gs
;

195 } 
	mi_iu
;

198 
	#i_me
 
i_in
.
in_me


	)

199 
	#i_hwaddr
 
i_iu
.
iu_hwaddr


	)

200 
	#i_addr
 
i_iu
.
iu_addr


	)

201 
	#i_daddr
 
i_iu
.
iu_daddr


	)

202 
	#i_brdaddr
 
i_iu
.
iu_brdaddr


	)

203 
	#i_tmask
 
i_iu
.
iu_tmask


	)

204 
	#i_ags
 
i_iu
.
iu_ags


	)

205 
	#i_mric
 
i_iu
.
iu_ivue


	)

206 
	#i_mtu
 
i_iu
.
iu_mtu


	)

207 
	#i_m
 
i_iu
.
iu_m


	)

208 
	#i_ave
 
i_iu
.
iu_ave


	)

209 
	#i_da
 
i_iu
.
iu_da


	)

210 
	#i_ifdex
 
i_iu
.
iu_ivue


	)

211 
	#i_bdwidth
 
i_iu
.
iu_ivue


	)

212 
	#i_qn
 
i_iu
.
iu_ivue


	)

213 
	#i_wme
 
i_iu
.
iu_wme


	)

214 
	#i_gs
 
i_iu
.
iu_gs


	)

223 
	sifcf
 {

224 
	mifc_n
;

226 *
	mifcu_buf
;

227 
ieq
 *
	mifcu_q
;

228 } 
	mifc_ifcu
;

230 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

231 
	#ifc_q
 
ifc_ifcu
.
ifcu_q


	)

	@/usr/include/linux/if_ether.h

21 #ide
_LINUX_IF_ETHER_H


22 
	#_LINUX_IF_ETHER_H


	)

24 
	~<lux/tys.h
>

31 
	#ETH_ALEN
 6

	)

32 
	#ETH_HLEN
 14

	)

33 
	#ETH_ZLEN
 60

	)

34 
	#ETH_DATA_LEN
 1500

	)

35 
	#ETH_FRAME_LEN
 1514

	)

36 
	#ETH_FCS_LEN
 4

	)

42 
	#ETH_P_LOOP
 0x0060

	)

43 
	#ETH_P_PUP
 0x0200

	)

44 
	#ETH_P_PUPAT
 0x0201

	)

45 
	#ETH_P_IP
 0x0800

	)

46 
	#ETH_P_X25
 0x0805

	)

47 
	#ETH_P_ARP
 0x0806

	)

48 
	#ETH_P_BPQ
 0x08FF

	)

49 
	#ETH_P_IEEEPUP
 0x0a00

	)

50 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

51 
	#ETH_P_DEC
 0x6000

	)

52 
	#ETH_P_DNA_DL
 0x6001

	)

53 
	#ETH_P_DNA_RC
 0x6002

	)

54 
	#ETH_P_DNA_RT
 0x6003

	)

55 
	#ETH_P_LAT
 0x6004

	)

56 
	#ETH_P_DIAG
 0x6005

	)

57 
	#ETH_P_CUST
 0x6006

	)

58 
	#ETH_P_SCA
 0x6007

	)

59 
	#ETH_P_TEB
 0x6558

	)

60 
	#ETH_P_RARP
 0x8035

	)

61 
	#ETH_P_ATALK
 0x809B

	)

62 
	#ETH_P_AARP
 0x80F3

	)

63 
	#ETH_P_8021Q
 0x8100

	)

64 
	#ETH_P_IPX
 0x8137

	)

65 
	#ETH_P_IPV6
 0x86DD

	)

66 
	#ETH_P_PAUSE
 0x8808

	)

67 
	#ETH_P_SLOW
 0x8809

	)

68 
	#ETH_P_WCCP
 0x883E

	)

70 
	#ETH_P_PPP_DISC
 0x8863

	)

71 
	#ETH_P_PPP_SES
 0x8864

	)

72 
	#ETH_P_MPLS_UC
 0x8847

	)

73 
	#ETH_P_MPLS_MC
 0x8848

	)

74 
	#ETH_P_ATMMPOA
 0x884

	)

75 
	#ETH_P_LINK_CTL
 0x886

	)

76 
	#ETH_P_ATMFATE
 0x8884

	)

79 
	#ETH_P_PAE
 0x888E

	)

80 
	#ETH_P_AOE
 0x88A2

	)

81 
	#ETH_P_8021AD
 0x88A8

	)

82 
	#ETH_P_802_EX1
 0x88B5

	)

83 
	#ETH_P_TIPC
 0x88CA

	)

84 
	#ETH_P_8021AH
 0x88E7

	)

85 
	#ETH_P_1588
 0x88F7

	)

86 
	#ETH_P_FCOE
 0x8906

	)

87 
	#ETH_P_TDLS
 0x890D

	)

88 
	#ETH_P_FIP
 0x8914

	)

89 
	#ETH_P_QINQ1
 0x9100

	)

90 
	#ETH_P_QINQ2
 0x9200

	)

91 
	#ETH_P_QINQ3
 0x9300

	)

92 
	#ETH_P_EDSA
 0xDADA

	)

93 
	#ETH_P_AF_IUCV
 0xFBFB

	)

99 
	#ETH_P_802_3
 0x0001

	)

100 
	#ETH_P_AX25
 0x0002

	)

101 
	#ETH_P_ALL
 0x0003

	)

102 
	#ETH_P_802_2
 0x0004

	)

103 
	#ETH_P_SNAP
 0x0005

	)

104 
	#ETH_P_DDCMP
 0x0006

	)

105 
	#ETH_P_WAN_PPP
 0x0007

	)

106 
	#ETH_P_PPP_MP
 0x0008

	)

107 
	#ETH_P_LOCALTALK
 0x0009

	)

108 
	#ETH_P_CAN
 0x000C

	)

109 
	#ETH_P_PPPTALK
 0x0010

	)

110 
	#ETH_P_TR_802_2
 0x0011

	)

111 
	#ETH_P_MOBITEX
 0x0015

	)

112 
	#ETH_P_CONTROL
 0x0016

	)

113 
	#ETH_P_IRDA
 0x0017

	)

114 
	#ETH_P_ECONET
 0x0018

	)

115 
	#ETH_P_HDLC
 0x0019

	)

116 
	#ETH_P_ARCNET
 0x001A

	)

117 
	#ETH_P_DSA
 0x001B

	)

118 
	#ETH_P_TRAILER
 0x001C

	)

119 
	#ETH_P_PHONET
 0x00F5

	)

120 
	#ETH_P_IEEE802154
 0x00F6

	)

121 
	#ETH_P_CAIF
 0x00F7

	)

127 
	shhdr
 {

128 
	mh_de
[
ETH_ALEN
];

129 
	mh_sour
[
ETH_ALEN
];

130 
__be16
 
	mh_o
;

131 } 
__ibu__
((
cked
));

	@/usr/include/linux/if_link.h

1 #ide
_LINUX_IF_LINK_H


2 
	#_LINUX_IF_LINK_H


	)

4 
	~<lux/tys.h
>

5 
	~<lux/Îk.h
>

8 
	s_lk_s
 {

9 
__u32
 
	mrx_cks
;

10 
__u32
 
	mtx_cks
;

11 
__u32
 
	mrx_bys
;

12 
__u32
 
	mtx_bys
;

13 
__u32
 
	mrx_rs
;

14 
__u32
 
	mtx_rs
;

15 
__u32
 
	mrx_drݳd
;

16 
__u32
 
	mtx_drݳd
;

17 
__u32
 
	mmui
;

18 
__u32
 
	mclisis
;

21 
__u32
 
	mrx_ngth_rs
;

22 
__u32
 
	mrx_ov_rs
;

23 
__u32
 
	mrx_c_rs
;

24 
__u32
 
	mrx_ame_rs
;

25 
__u32
 
	mrx_fifo_rs
;

26 
__u32
 
	mrx_misd_rs
;

29 
__u32
 
	mtx_ab܋d_rs
;

30 
__u32
 
	mtx_r_rs
;

31 
__u32
 
	mtx_fifo_rs
;

32 
__u32
 
	mtx_hbt_rs
;

33 
__u32
 
	mtx_wdow_rs
;

36 
__u32
 
	mrx_comesd
;

37 
__u32
 
	mtx_comesd
;

41 
	s_lk_s64
 {

42 
__u64
 
	mrx_cks
;

43 
__u64
 
	mtx_cks
;

44 
__u64
 
	mrx_bys
;

45 
__u64
 
	mtx_bys
;

46 
__u64
 
	mrx_rs
;

47 
__u64
 
	mtx_rs
;

48 
__u64
 
	mrx_drݳd
;

49 
__u64
 
	mtx_drݳd
;

50 
__u64
 
	mmui
;

51 
__u64
 
	mclisis
;

54 
__u64
 
	mrx_ngth_rs
;

55 
__u64
 
	mrx_ov_rs
;

56 
__u64
 
	mrx_c_rs
;

57 
__u64
 
	mrx_ame_rs
;

58 
__u64
 
	mrx_fifo_rs
;

59 
__u64
 
	mrx_misd_rs
;

62 
__u64
 
	mtx_ab܋d_rs
;

63 
__u64
 
	mtx_r_rs
;

64 
__u64
 
	mtx_fifo_rs
;

65 
__u64
 
	mtx_hbt_rs
;

66 
__u64
 
	mtx_wdow_rs
;

69 
__u64
 
	mrx_comesd
;

70 
__u64
 
	mtx_comesd
;

74 
	s_lk_ifm
 {

75 
__u64
 
	mmem_t
;

76 
__u64
 
	mmem_d
;

77 
__u64
 
	mba_addr
;

78 
__u16
 
	mq
;

79 
__u8
 
	mdma
;

80 
__u8
 
	mpt
;

102 
	mIFLA_UNSPEC
,

103 
	mIFLA_ADDRESS
,

104 
	mIFLA_BROADCAST
,

105 
	mIFLA_IFNAME
,

106 
	mIFLA_MTU
,

107 
	mIFLA_LINK
,

108 
	mIFLA_QDISC
,

109 
	mIFLA_STATS
,

110 
	mIFLA_COST
,

111 
	#IFLA_COST
 
IFLA_COST


	)

112 
	mIFLA_PRIORITY
,

113 
	#IFLA_PRIORITY
 
IFLA_PRIORITY


	)

114 
	mIFLA_MASTER
,

115 
	#IFLA_MASTER
 
IFLA_MASTER


	)

116 
	mIFLA_WIRELESS
,

117 
	#IFLA_WIRELESS
 
IFLA_WIRELESS


	)

118 
	mIFLA_PROTINFO
,

119 
	#IFLA_PROTINFO
 
IFLA_PROTINFO


	)

120 
	mIFLA_TXQLEN
,

121 
	#IFLA_TXQLEN
 
IFLA_TXQLEN


	)

122 
	mIFLA_MAP
,

123 
	#IFLA_MAP
 
IFLA_MAP


	)

124 
	mIFLA_WEIGHT
,

125 
	#IFLA_WEIGHT
 
IFLA_WEIGHT


	)

126 
	mIFLA_OPERSTATE
,

127 
	mIFLA_LINKMODE
,

128 
	mIFLA_LINKINFO
,

129 
	#IFLA_LINKINFO
 
IFLA_LINKINFO


	)

130 
	mIFLA_NET_NS_PID
,

131 
	mIFLA_IFALIAS
,

132 
	mIFLA_NUM_VF
,

133 
	mIFLA_VFINFO_LIST
,

134 
	mIFLA_STATS64
,

135 
	mIFLA_VF_PORTS
,

136 
	mIFLA_PORT_SELF
,

137 
	mIFLA_AF_SPEC
,

138 
	mIFLA_GROUP
,

139 
	mIFLA_NET_NS_FD
,

140 
	mIFLA_EXT_MASK
,

141 
	mIFLA_PROMISCUITY
,

142 
	#IFLA_PROMISCUITY
 
IFLA_PROMISCUITY


	)

143 
	m__IFLA_MAX


147 
	#IFLA_MAX
 (
__IFLA_MAX
 - 1)

	)

150 
	#IFLA_RTA
(
r
((

*)(((*))+ 
	`NLMSG_ALIGN
((
iffomsg
))))

	)

151 
	#IFLA_PAYLOAD
(
n

	`NLMSG_PAYLOAD
,(
iffomsg
))

	)

154 
	mIFLA_INET_UNSPEC
,

155 
	mIFLA_INET_CONF
,

156 
	m__IFLA_INET_MAX
,

159 
	#IFLA_INET_MAX
 (
__IFLA_INET_MAX
 - 1)

	)

192 
	mIFLA_INET6_UNSPEC
,

193 
	mIFLA_INET6_FLAGS
,

194 
	mIFLA_INET6_CONF
,

195 
	mIFLA_INET6_STATS
,

196 
	mIFLA_INET6_MCAST
,

197 
	mIFLA_INET6_CACHEINFO
,

198 
	mIFLA_INET6_ICMP6STATS
,

199 
	m__IFLA_INET6_MAX


202 
	#IFLA_INET6_MAX
 (
__IFLA_INET6_MAX
 - 1)

	)

204 
	sia_chefo
 {

205 
__u32
 
	mmax_asm_n
;

206 
__u32
 
	mtamp
;

207 
__u32
 
	machab_time
;

208 
__u32
 
	ms_time
;

212 
	mIFLA_INFO_UNSPEC
,

213 
	mIFLA_INFO_KIND
,

214 
	mIFLA_INFO_DATA
,

215 
	mIFLA_INFO_XSTATS
,

216 
	m__IFLA_INFO_MAX
,

219 
	#IFLA_INFO_MAX
 (
__IFLA_INFO_MAX
 - 1)

	)

224 
	mIFLA_VLAN_UNSPEC
,

225 
	mIFLA_VLAN_ID
,

226 
	mIFLA_VLAN_FLAGS
,

227 
	mIFLA_VLAN_EGRESS_QOS
,

228 
	mIFLA_VLAN_INGRESS_QOS
,

229 
	m__IFLA_VLAN_MAX
,

232 
	#IFLA_VLAN_MAX
 (
__IFLA_VLAN_MAX
 - 1)

	)

234 
	sia_vn_ags
 {

235 
__u32
 
	mags
;

236 
__u32
 
	mmask
;

240 
	mIFLA_VLAN_QOS_UNSPEC
,

241 
	mIFLA_VLAN_QOS_MAPPING
,

242 
	m__IFLA_VLAN_QOS_MAX


245 
	#IFLA_VLAN_QOS_MAX
 (
__IFLA_VLAN_QOS_MAX
 - 1)

	)

247 
	sia_vn_qos_mpg
 {

248 
__u32
 
	mom
;

249 
__u32
 
	mto
;

254 
	mIFLA_MACVLAN_UNSPEC
,

255 
	mIFLA_MACVLAN_MODE
,

256 
	mIFLA_MACVLAN_FLAGS
,

257 
	m__IFLA_MACVLAN_MAX
,

260 
	#IFLA_MACVLAN_MAX
 (
__IFLA_MACVLAN_MAX
 - 1)

	)

262 
	emacvn_mode
 {

263 
	mMACVLAN_MODE_PRIVATE
 = 1,

264 
	mMACVLAN_MODE_VEPA
 = 2,

265 
	mMACVLAN_MODE_BRIDGE
 = 4,

266 
	mMACVLAN_MODE_PASSTHRU
 = 8,

269 
	#MACVLAN_FLAG_NOPROMISC
 1

	)

274 
	mIFLA_VF_INFO_UNSPEC
,

275 
	mIFLA_VF_INFO
,

276 
	m__IFLA_VF_INFO_MAX
,

279 
	#IFLA_VF_INFO_MAX
 (
__IFLA_VF_INFO_MAX
 - 1)

	)

282 
	mIFLA_VF_UNSPEC
,

283 
	mIFLA_VF_MAC
,

284 
	mIFLA_VF_VLAN
,

285 
	mIFLA_VF_TX_RATE
,

286 
	mIFLA_VF_SPOOFCHK
,

287 
	m__IFLA_VF_MAX
,

290 
	#IFLA_VF_MAX
 (
__IFLA_VF_MAX
 - 1)

	)

292 
	sia_vf_mac
 {

293 
__u32
 
	mvf
;

294 
__u8
 
	mmac
[32];

297 
	sia_vf_vn
 {

298 
__u32
 
	mvf
;

299 
__u32
 
	mvn
;

300 
__u32
 
	mqos
;

303 
	sia_vf_tx_
 {

304 
__u32
 
	mvf
;

305 
__u32
 
	m
;

308 
	sia_vf_oofchk
 {

309 
__u32
 
	mvf
;

310 
__u32
 
	mg
;

329 
	mIFLA_VF_PORT_UNSPEC
,

330 
	mIFLA_VF_PORT
,

331 
	m__IFLA_VF_PORT_MAX
,

334 
	#IFLA_VF_PORT_MAX
 (
__IFLA_VF_PORT_MAX
 - 1)

	)

337 
	mIFLA_PORT_UNSPEC
,

338 
	mIFLA_PORT_VF
,

339 
	mIFLA_PORT_PROFILE
,

340 
	mIFLA_PORT_VSI_TYPE
,

341 
	mIFLA_PORT_INSTANCE_UUID
,

342 
	mIFLA_PORT_HOST_UUID
,

343 
	mIFLA_PORT_REQUEST
,

344 
	mIFLA_PORT_RESPONSE
,

345 
	m__IFLA_PORT_MAX
,

348 
	#IFLA_PORT_MAX
 (
__IFLA_PORT_MAX
 - 1)

	)

350 
	#PORT_PROFILE_MAX
 40

	)

351 
	#PORT_UUID_MAX
 16

	)

352 
	#PORT_SELF_VF
 -1

	)

355 
	mPORT_REQUEST_PREASSOCIATE
 = 0,

356 
	mPORT_REQUEST_PREASSOCIATE_RR
,

357 
	mPORT_REQUEST_ASSOCIATE
,

358 
	mPORT_REQUEST_DISASSOCIATE
,

362 
	mPORT_VDP_RESPONSE_SUCCESS
 = 0,

363 
	mPORT_VDP_RESPONSE_INVALID_FORMAT
,

364 
	mPORT_VDP_RESPONSE_INSUFFICIENT_RESOURCES
,

365 
	mPORT_VDP_RESPONSE_UNUSED_VTID
,

366 
	mPORT_VDP_RESPONSE_VTID_VIOLATION
,

367 
	mPORT_VDP_RESPONSE_VTID_VERSION_VIOALTION
,

368 
	mPORT_VDP_RESPONSE_OUT_OF_SYNC
,

370 
	mPORT_PROFILE_RESPONSE_SUCCESS
 = 0x100,

371 
	mPORT_PROFILE_RESPONSE_INPROGRESS
,

372 
	mPORT_PROFILE_RESPONSE_INVALID
,

373 
	mPORT_PROFILE_RESPONSE_BADSTATE
,

374 
	mPORT_PROFILE_RESPONSE_INSUFFICIENT_RESOURCES
,

375 
	mPORT_PROFILE_RESPONSE_ERROR
,

378 
	sia_pt_vsi
 {

379 
__u8
 
	mvsi_mgr_id
;

380 
__u8
 
	mvsi_ty_id
[3];

381 
__u8
 
	mvsi_ty_vsi
;

382 
__u8
 
	md
[3];

	@/usr/include/linux/if_packet.h

1 #ide
__LINUX_IF_PACKET_H


2 
	#__LINUX_IF_PACKET_H


	)

4 
	~<lux/tys.h
>

6 
	ssockaddr_pkt
 {

7 
	mkt_my
;

8 
	mkt_devi
[14];

9 
__be16
 
	mkt_oc
;

12 
	ssockaddr_
 {

13 
	ml_my
;

14 
__be16
 
	ml_oc
;

15 
	ml_ifdex
;

16 
	ml_hy
;

17 
	ml_pky
;

18 
	ml_h
;

19 
	ml_addr
[8];

24 
	#PACKET_HOST
 0

	)

25 
	#PACKET_BROADCAST
 1

	)

26 
	#PACKET_MULTICAST
 2

	)

27 
	#PACKET_OTHERHOST
 3

	)

28 
	#PACKET_OUTGOING
 4

	)

30 
	#PACKET_LOOPBACK
 5

	)

31 
	#PACKET_FASTROUTE
 6

	)

35 
	#PACKET_ADD_MEMBERSHIP
 1

	)

36 
	#PACKET_DROP_MEMBERSHIP
 2

	)

37 
	#PACKET_RECV_OUTPUT
 3

	)

39 
	#PACKET_RX_RING
 5

	)

40 
	#PACKET_STATISTICS
 6

	)

41 
	#PACKET_COPY_THRESH
 7

	)

42 
	#PACKET_AUXDATA
 8

	)

43 
	#PACKET_ORIGDEV
 9

	)

44 
	#PACKET_VERSION
 10

	)

45 
	#PACKET_HDRLEN
 11

	)

46 
	#PACKET_RESERVE
 12

	)

47 
	#PACKET_TX_RING
 13

	)

48 
	#PACKET_LOSS
 14

	)

49 
	#PACKET_VNET_HDR
 15

	)

50 
	#PACKET_TX_TIMESTAMP
 16

	)

51 
	#PACKET_TIMESTAMP
 17

	)

52 
	#PACKET_FANOUT
 18

	)

54 
	#PACKET_FANOUT_HASH
 0

	)

55 
	#PACKET_FANOUT_LB
 1

	)

56 
	#PACKET_FANOUT_CPU
 2

	)

57 
	#PACKET_FANOUT_FLAG_DEFRAG
 0x8000

	)

59 
	sack_s
 {

60 
	m_cks
;

61 
	m_drs
;

64 
	sack_s_v3
 {

65 
	m_cks
;

66 
	m_drs
;

67 
	m_ze_q_t
;

70 
	uack_s_u
 {

71 
ack_s
 
	ms1
;

72 
ack_s_v3
 
	ms3
;

75 
	sack_auxda
 {

76 
__u32
 
	m_us
;

77 
__u32
 
	m_n
;

78 
__u32
 
	m_n
;

79 
__u16
 
	m_mac
;

80 
__u16
 
	m_t
;

81 
__u16
 
	m_vn_tci
;

82 
__u16
 
	m_ddg
;

86 
	#TP_STATUS_KERNEL
 0x0

	)

87 
	#TP_STATUS_USER
 0x1

	)

88 
	#TP_STATUS_COPY
 0x2

	)

89 
	#TP_STATUS_LOSING
 0x4

	)

90 
	#TP_STATUS_CSUMNOTREADY
 0x8

	)

91 
	#TP_STATUS_VLAN_VALID
 0x10

	)

92 
	#TP_STATUS_BLK_TMO
 0x20

	)

95 
	#TP_STATUS_AVAILABLE
 0x0

	)

96 
	#TP_STATUS_SEND_REQUEST
 0x1

	)

97 
	#TP_STATUS_SENDING
 0x2

	)

98 
	#TP_STATUS_WRONG_FORMAT
 0x4

	)

101 
	#TP_FT_REQ_FILL_RXHASH
 0x1

	)

103 
	sack_hdr
 {

104 
	m_us
;

105 
	m_n
;

106 
	m_n
;

107 
	m_mac
;

108 
	m_t
;

109 
	m_c
;

110 
	m_uc
;

113 
	#TPACKET_ALIGNMENT
 16

	)

114 
	#TPACKET_ALIGN
(
x
(((x)+
TPACKET_ALIGNMENT
-1)&~(TPACKET_ALIGNMENT-1))

	)

115 
	#TPACKET_HDRLEN
 (
	`TPACKET_ALIGN
((
ack_hdr
)+ (
sockaddr_
))

	)

117 
	sack2_hdr
 {

118 
__u32
 
	m_us
;

119 
__u32
 
	m_n
;

120 
__u32
 
	m_n
;

121 
__u16
 
	m_mac
;

122 
__u16
 
	m_t
;

123 
__u32
 
	m_c
;

124 
__u32
 
	m_nc
;

125 
__u16
 
	m_vn_tci
;

126 
__u16
 
	m_ddg
;

129 
	sack_hdr_v1
 {

130 
__u32
 
	m_rxhash
;

131 
__u32
 
	m_vn_tci
;

134 
	sack3_hdr
 {

135 
__u32
 
	m_xt_offt
;

136 
__u32
 
	m_c
;

137 
__u32
 
	m_nc
;

138 
__u32
 
	m_n
;

139 
__u32
 
	m_n
;

140 
__u32
 
	m_us
;

141 
__u16
 
	m_mac
;

142 
__u16
 
	m_t
;

145 
ack_hdr_v1
 
	mhv1
;

149 
	sack_bd_ts
 {

150 
	mts_c
;

152 
	mts_uc
;

153 
	mts_nc
;

157 
	sack_hdr_v1
 {

158 
__u32
 
	mblock_us
;

159 
__u32
 
	mnum_pkts
;

160 
__u32
 
	mofft_to_f_pkt
;

165 
__u32
 
	mblk_n
;

176 
__igd_u64
 
	mq_num
;

203 
ack_bd_ts
 
	mts_f_pkt
, 
	mts_ϡ_pkt
;

206 
	uack_bd_hd_u
 {

207 
ack_hdr_v1
 
	mbh1
;

210 
	sack_block_desc
 {

211 
__u32
 
	mvsi
;

212 
__u32
 
	mofft_to_iv
;

213 
ack_bd_hd_u
 
	mhdr
;

216 
	#TPACKET2_HDRLEN
 (
	`TPACKET_ALIGN
((
ack2_hdr
)+ (
sockaddr_
))

	)

217 
	#TPACKET3_HDRLEN
 (
	`TPACKET_ALIGN
((
ack3_hdr
)+ (
sockaddr_
))

	)

219 
	eack_vsis
 {

220 
	mTPACKET_V1
,

221 
	mTPACKET_V2
,

222 
	mTPACKET_V3


238 
	sack_q
 {

239 
	m_block_size
;

240 
	m_block_
;

241 
	m_ame_size
;

242 
	m_ame_
;

245 
	sack_q3
 {

246 
	m_block_size
;

247 
	m_block_
;

248 
	m_ame_size
;

249 
	m_ame_
;

250 
	m_te_blk_tov
;

251 
	m_sizeof_iv
;

252 
	m_u_q_wd
;

255 
	uack_q_u
 {

256 
ack_q
 
	mq
;

257 
ack_q3
 
	mq3
;

260 
	sck_mq
 {

261 
	mmr_ifdex
;

262 
	mmr_ty
;

263 
	mmr_
;

264 
	mmr_addss
[8];

267 
	#PACKET_MR_MULTICAST
 0

	)

268 
	#PACKET_MR_PROMISC
 1

	)

269 
	#PACKET_MR_ALLMULTI
 2

	)

270 
	#PACKET_MR_UNICAST
 3

	)

	@/usr/include/linux/if_pppox.h

16 #ide
__LINUX_IF_PPPOX_H


17 
	#__LINUX_IF_PPPOX_H


	)

20 
	~<lux/tys.h
>

21 
	~<asm/byd.h
>

23 
	~<lux/sock.h
>

24 
	~<lux/if_h.h
>

25 
	~<lux/if_p2.h
>

30 #ide
AF_PPPOX


31 
	#AF_PPPOX
 24

	)

32 
	#PF_PPPOX
 
AF_PPPOX


	)

38 
__be16
 
	tsid_t
;

39 
	sp_addr
 {

40 
sid_t
 
	msid
;

41 
	mme
[
ETH_ALEN
];

42 
	mdev
[
IFNAMSIZ
];

48 
	s_addr
 {

49 
__be16
 
	m_id
;

50 
_addr
 
	ms_addr
;

56 
	#PX_PROTO_OE
 0

	)

57 
	#PX_PROTO_OL2TP
 1

	)

58 
	#PX_PROTO_PPTP
 2

	)

59 
	#PX_MAX_PROTO
 3

	)

61 
	ssockaddr_pox
 {

62 
__kl__my_t
 
	m_my
;

63 
	m_oc
;

65 
p_addr
 
	mp
;

66 
_addr
 
	m
;

67 } 
	m_addr
;

68 } 
__ibu__
((
cked
));

75 
	ssockaddr_p2
 {

76 
__kl__my_t
 
	m_my
;

77 
	m_oc
;

78 
p2_addr
 
	mp2
;

79 } 
__ibu__
((
cked
));

81 
	ssockaddr_p26
 {

82 
__kl__my_t
 
	m_my
;

83 
	m_oc
;

84 
p26_addr
 
	mp2
;

85 } 
__ibu__
((
cked
));

90 
	ssockaddr_p2v3
 {

91 
__kl__my_t
 
	m_my
;

92 
	m_oc
;

93 
p2v3_addr
 
	mp2
;

94 } 
__ibu__
((
cked
));

96 
	ssockaddr_p2v36
 {

97 
__kl__my_t
 
	m_my
;

98 
	m_oc
;

99 
p2v36_addr
 
	mp2
;

100 } 
__ibu__
((
cked
));

108 
	#PPPOEIOCSFWD
 
	`_IOW
(0xB1 ,0, 
size_t
)

	)

109 
	#PPPOEIOCDFWD
 
	`_IO
(0xB1 ,1)

	)

113 
	#PADI_CODE
 0x09

	)

114 
	#PADO_CODE
 0x07

	)

115 
	#PADR_CODE
 0x19

	)

116 
	#PADS_CODE
 0x65

	)

117 
	#PADT_CODE
 0xa7

	)

118 
	sp_g
 {

119 
__be16
 
	mg_ty
;

120 
__be16
 
	mg_n
;

121 
	mg_da
[0];

122 } 
__ibu__
 ((
cked
));

125 
	#PTT_EOL
 
	`__u_to_be16
(0x0000)

	)

126 
	#PTT_SRV_NAME
 
	`__u_to_be16
(0x0101)

	)

127 
	#PTT_AC_NAME
 
	`__u_to_be16
(0x0102)

	)

128 
	#PTT_HOST_UNIQ
 
	`__u_to_be16
(0x0103)

	)

129 
	#PTT_AC_COOKIE
 
	`__u_to_be16
(0x0104)

	)

130 
	#PTT_VENDOR
 
	`__u_to_be16
(0x0105)

	)

131 
	#PTT_RELAY_SID
 
	`__u_to_be16
(0x0110)

	)

132 
	#PTT_SRV_ERR
 
	`__u_to_be16
(0x0201)

	)

133 
	#PTT_SYS_ERR
 
	`__u_to_be16
(0x0202)

	)

134 
	#PTT_GEN_ERR
 
	`__u_to_be16
(0x0203)

	)

136 
	sp_hdr
 {

137 #i
defed
(
__LITTLE_ENDIAN_BITFIELD
)

138 
__u8
 
	mv
 : 4;

139 
__u8
 
	mty
 : 4;

140 #i
defed
(
__BIG_ENDIAN_BITFIELD
)

141 
__u8
 
	mty
 : 4;

142 
__u8
 
	mv
 : 4;

146 
__u8
 
	mcode
;

147 
__be16
 
	msid
;

148 
__be16
 
	mngth
;

149 
p_g
 
	mg
[0];

150 } 
__ibu__
((
cked
));

153 
	#PPPOE_SES_HLEN
 8

	)

	@/usr/include/linux/if_vlan.h

13 #ide
_LINUX_IF_VLAN_H_


14 
	#_LINUX_IF_VLAN_H_


	)

20 
	evn_iol_cmds
 {

21 
	mADD_VLAN_CMD
,

22 
	mDEL_VLAN_CMD
,

23 
	mSET_VLAN_INGRESS_PRIORITY_CMD
,

24 
	mSET_VLAN_EGRESS_PRIORITY_CMD
,

25 
	mGET_VLAN_INGRESS_PRIORITY_CMD
,

26 
	mGET_VLAN_EGRESS_PRIORITY_CMD
,

27 
	mSET_VLAN_NAME_TYPE_CMD
,

28 
	mSET_VLAN_FLAG_CMD
,

29 
	mGET_VLAN_REALDEV_NAME_CMD
,

30 
	mGET_VLAN_VID_CMD


33 
	evn_ags
 {

34 
	mVLAN_FLAG_REORDER_HDR
 = 0x1,

35 
	mVLAN_FLAG_GVRP
 = 0x2,

36 
	mVLAN_FLAG_LOOSE_BINDING
 = 0x4,

39 
	evn_me_tys
 {

40 
	mVLAN_NAME_TYPE_PLUS_VID
,

41 
	mVLAN_NAME_TYPE_RAW_PLUS_VID
,

42 
	mVLAN_NAME_TYPE_PLUS_VID_NO_PAD
,

43 
	mVLAN_NAME_TYPE_RAW_PLUS_VID_NO_PAD
,

44 
	mVLAN_NAME_TYPE_HIGHEST


47 
	svn_iol_gs
 {

48 
	mcmd
;

49 
	mdevi1
[24];

52 
	mdevi2
[24];

53 
	mVID
;

54 
	mskb_iܙy
;

55 
	mme_ty
;

56 
	mbd_ty
;

57 
	mag
;

58 } 
	mu
;

60 
	mvn_qos
;

	@/usr/include/linux/netfilter.h

1 #ide
__LINUX_NETFILTER_H


2 
	#__LINUX_NETFILTER_H


	)

4 
	~<lux/tys.h
>

6 
	~<lux/sysl.h
>

9 
	#NF_DROP
 0

	)

10 
	#NF_ACCEPT
 1

	)

11 
	#NF_STOLEN
 2

	)

12 
	#NF_QUEUE
 3

	)

13 
	#NF_REPEAT
 4

	)

14 
	#NF_STOP
 5

	)

15 
	#NF_MAX_VERDICT
 
NF_STOP


	)

20 
	#NF_VERDICT_MASK
 0x000000ff

	)

23 
	#NF_VERDICT_FLAG_QUEUE_BYPASS
 0x00008000

	)

26 
	#NF_VERDICT_QMASK
 0xffff0000

	)

27 
	#NF_VERDICT_QBITS
 16

	)

29 
	#NF_QUEUE_NR
(
x
((((x<< 16& 
NF_VERDICT_QMASK
| 
NF_QUEUE
)

	)

31 
	#NF_DROP_ERR
(
x
(((-x<< 16| 
NF_DROP
)

	)

36 
	#NFC_UNKNOWN
 0x4000

	)

37 
	#NFC_ALTERED
 0x8000

	)

40 
	#NF_VERDICT_BITS
 16

	)

42 
	enf__hooks
 {

43 
	mNF_INET_PRE_ROUTING
,

44 
	mNF_INET_LOCAL_IN
,

45 
	mNF_INET_FORWARD
,

46 
	mNF_INET_LOCAL_OUT
,

47 
	mNF_INET_POST_ROUTING
,

48 
	mNF_INET_NUMHOOKS


52 
	mNFPROTO_UNSPEC
 = 0,

53 
	mNFPROTO_IPV4
 = 2,

54 
	mNFPROTO_ARP
 = 3,

55 
	mNFPROTO_BRIDGE
 = 7,

56 
	mNFPROTO_IPV6
 = 10,

57 
	mNFPROTO_DECNET
 = 12,

58 
	mNFPROTO_NUMPROTO
,

61 
	unf__addr
 {

62 
__u32
 
	ml
[4];

63 
__be32
 
	m
;

64 
__be32
 
	m6
[4];

65 
_addr
 
	m
;

66 
6_addr
 
	m6
;

	@/usr/include/linux/pci_regs.h

22 #ide
LINUX_PCI_REGS_H


23 
	#LINUX_PCI_REGS_H


	)

29 
	#PCI_VENDOR_ID
 0x00

	)

30 
	#PCI_DEVICE_ID
 0x02

	)

31 
	#PCI_COMMAND
 0x04

	)

32 
	#PCI_COMMAND_IO
 0x1

	)

33 
	#PCI_COMMAND_MEMORY
 0x2

	)

34 
	#PCI_COMMAND_MASTER
 0x4

	)

35 
	#PCI_COMMAND_SPECIAL
 0x8

	)

36 
	#PCI_COMMAND_INVALIDATE
 0x10

	)

37 
	#PCI_COMMAND_VGA_PALETTE
 0x20

	)

38 
	#PCI_COMMAND_PARITY
 0x40

	)

39 
	#PCI_COMMAND_WAIT
 0x80

	)

40 
	#PCI_COMMAND_SERR
 0x100

	)

41 
	#PCI_COMMAND_FAST_BACK
 0x200

	)

42 
	#PCI_COMMAND_INTX_DISABLE
 0x400

	)

44 
	#PCI_STATUS
 0x06

	)

45 
	#PCI_STATUS_INTERRUPT
 0x08

	)

46 
	#PCI_STATUS_CAP_LIST
 0x10

	)

47 
	#PCI_STATUS_66MHZ
 0x20

	)

48 
	#PCI_STATUS_UDF
 0x40

	)

49 
	#PCI_STATUS_FAST_BACK
 0x80

	)

50 
	#PCI_STATUS_PARITY
 0x100

	)

51 
	#PCI_STATUS_DEVSEL_MASK
 0x600

	)

52 
	#PCI_STATUS_DEVSEL_FAST
 0x000

	)

53 
	#PCI_STATUS_DEVSEL_MEDIUM
 0x200

	)

54 
	#PCI_STATUS_DEVSEL_SLOW
 0x400

	)

55 
	#PCI_STATUS_SIG_TARGET_ABORT
 0x800

	)

56 
	#PCI_STATUS_REC_TARGET_ABORT
 0x1000

	)

57 
	#PCI_STATUS_REC_MASTER_ABORT
 0x2000

	)

58 
	#PCI_STATUS_SIG_SYSTEM_ERROR
 0x4000

	)

59 
	#PCI_STATUS_DETECTED_PARITY
 0x8000

	)

61 
	#PCI_CLASS_REVISION
 0x08

	)

62 
	#PCI_REVISION_ID
 0x08

	)

63 
	#PCI_CLASS_PROG
 0x09

	)

64 
	#PCI_CLASS_DEVICE
 0x0

	)

66 
	#PCI_CACHE_LINE_SIZE
 0x0

	)

67 
	#PCI_LATENCY_TIMER
 0x0d

	)

68 
	#PCI_HEADER_TYPE
 0x0

	)

69 
	#PCI_HEADER_TYPE_NORMAL
 0

	)

70 
	#PCI_HEADER_TYPE_BRIDGE
 1

	)

71 
	#PCI_HEADER_TYPE_CARDBUS
 2

	)

73 
	#PCI_BIST
 0x0

	)

74 
	#PCI_BIST_CODE_MASK
 0x0

	)

75 
	#PCI_BIST_START
 0x40

	)

76 
	#PCI_BIST_CAPABLE
 0x80

	)

84 
	#PCI_BASE_ADDRESS_0
 0x10

	)

85 
	#PCI_BASE_ADDRESS_1
 0x14

	)

86 
	#PCI_BASE_ADDRESS_2
 0x18

	)

87 
	#PCI_BASE_ADDRESS_3
 0x1

	)

88 
	#PCI_BASE_ADDRESS_4
 0x20

	)

89 
	#PCI_BASE_ADDRESS_5
 0x24

	)

90 
	#PCI_BASE_ADDRESS_SPACE
 0x01

	)

91 
	#PCI_BASE_ADDRESS_SPACE_IO
 0x01

	)

92 
	#PCI_BASE_ADDRESS_SPACE_MEMORY
 0x00

	)

93 
	#PCI_BASE_ADDRESS_MEM_TYPE_MASK
 0x06

	)

94 
	#PCI_BASE_ADDRESS_MEM_TYPE_32
 0x00

	)

95 
	#PCI_BASE_ADDRESS_MEM_TYPE_1M
 0x02

	)

96 
	#PCI_BASE_ADDRESS_MEM_TYPE_64
 0x04

	)

97 
	#PCI_BASE_ADDRESS_MEM_PREFETCH
 0x08

	)

98 
	#PCI_BASE_ADDRESS_MEM_MASK
 (~0x0fUL)

	)

99 
	#PCI_BASE_ADDRESS_IO_MASK
 (~0x03UL)

	)

103 
	#PCI_CARDBUS_CIS
 0x28

	)

104 
	#PCI_SUBSYSTEM_VENDOR_ID
 0x2c

	)

105 
	#PCI_SUBSYSTEM_ID
 0x2e

	)

106 
	#PCI_ROM_ADDRESS
 0x30

	)

107 
	#PCI_ROM_ADDRESS_ENABLE
 0x01

	)

108 
	#PCI_ROM_ADDRESS_MASK
 (~0x7ffUL)

	)

110 
	#PCI_CAPABILITY_LIST
 0x34

	)

113 
	#PCI_INTERRUPT_LINE
 0x3

	)

114 
	#PCI_INTERRUPT_PIN
 0x3d

	)

115 
	#PCI_MIN_GNT
 0x3

	)

116 
	#PCI_MAX_LAT
 0x3

	)

119 
	#PCI_PRIMARY_BUS
 0x18

	)

120 
	#PCI_SECONDARY_BUS
 0x19

	)

121 
	#PCI_SUBORDINATE_BUS
 0x1

	)

122 
	#PCI_SEC_LATENCY_TIMER
 0x1b

	)

123 
	#PCI_IO_BASE
 0x1

	)

124 
	#PCI_IO_LIMIT
 0x1d

	)

125 
	#PCI_IO_RANGE_TYPE_MASK
 0x0fUL

	)

126 
	#PCI_IO_RANGE_TYPE_16
 0x00

	)

127 
	#PCI_IO_RANGE_TYPE_32
 0x01

	)

128 
	#PCI_IO_RANGE_MASK
 (~0x0fUL)

	)

129 
	#PCI_SEC_STATUS
 0x1

	)

130 
	#PCI_MEMORY_BASE
 0x20

	)

131 
	#PCI_MEMORY_LIMIT
 0x22

	)

132 
	#PCI_MEMORY_RANGE_TYPE_MASK
 0x0fUL

	)

133 
	#PCI_MEMORY_RANGE_MASK
 (~0x0fUL)

	)

134 
	#PCI_PREF_MEMORY_BASE
 0x24

	)

135 
	#PCI_PREF_MEMORY_LIMIT
 0x26

	)

136 
	#PCI_PREF_RANGE_TYPE_MASK
 0x0fUL

	)

137 
	#PCI_PREF_RANGE_TYPE_32
 0x00

	)

138 
	#PCI_PREF_RANGE_TYPE_64
 0x01

	)

139 
	#PCI_PREF_RANGE_MASK
 (~0x0fUL)

	)

140 
	#PCI_PREF_BASE_UPPER32
 0x28

	)

141 
	#PCI_PREF_LIMIT_UPPER32
 0x2c

	)

142 
	#PCI_IO_BASE_UPPER16
 0x30

	)

143 
	#PCI_IO_LIMIT_UPPER16
 0x32

	)

146 
	#PCI_ROM_ADDRESS1
 0x38

	)

148 
	#PCI_BRIDGE_CONTROL
 0x3e

	)

149 
	#PCI_BRIDGE_CTL_PARITY
 0x01

	)

150 
	#PCI_BRIDGE_CTL_SERR
 0x02

	)

151 
	#PCI_BRIDGE_CTL_ISA
 0x04

	)

152 
	#PCI_BRIDGE_CTL_VGA
 0x08

	)

153 
	#PCI_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

154 
	#PCI_BRIDGE_CTL_BUS_RESET
 0x40

	)

155 
	#PCI_BRIDGE_CTL_FAST_BACK
 0x80

	)

158 
	#PCI_CB_CAPABILITY_LIST
 0x14

	)

160 
	#PCI_CB_SEC_STATUS
 0x16

	)

161 
	#PCI_CB_PRIMARY_BUS
 0x18

	)

162 
	#PCI_CB_CARD_BUS
 0x19

	)

163 
	#PCI_CB_SUBORDINATE_BUS
 0x1

	)

164 
	#PCI_CB_LATENCY_TIMER
 0x1b

	)

165 
	#PCI_CB_MEMORY_BASE_0
 0x1c

	)

166 
	#PCI_CB_MEMORY_LIMIT_0
 0x20

	)

167 
	#PCI_CB_MEMORY_BASE_1
 0x24

	)

168 
	#PCI_CB_MEMORY_LIMIT_1
 0x28

	)

169 
	#PCI_CB_IO_BASE_0
 0x2c

	)

170 
	#PCI_CB_IO_BASE_0_HI
 0x2e

	)

171 
	#PCI_CB_IO_LIMIT_0
 0x30

	)

172 
	#PCI_CB_IO_LIMIT_0_HI
 0x32

	)

173 
	#PCI_CB_IO_BASE_1
 0x34

	)

174 
	#PCI_CB_IO_BASE_1_HI
 0x36

	)

175 
	#PCI_CB_IO_LIMIT_1
 0x38

	)

176 
	#PCI_CB_IO_LIMIT_1_HI
 0x3a

	)

177 
	#PCI_CB_IO_RANGE_MASK
 (~0x03UL)

	)

179 
	#PCI_CB_BRIDGE_CONTROL
 0x3e

	)

180 
	#PCI_CB_BRIDGE_CTL_PARITY
 0x01

	)

181 
	#PCI_CB_BRIDGE_CTL_SERR
 0x02

	)

182 
	#PCI_CB_BRIDGE_CTL_ISA
 0x04

	)

183 
	#PCI_CB_BRIDGE_CTL_VGA
 0x08

	)

184 
	#PCI_CB_BRIDGE_CTL_MASTER_ABORT
 0x20

	)

185 
	#PCI_CB_BRIDGE_CTL_CB_RESET
 0x40

	)

186 
	#PCI_CB_BRIDGE_CTL_16BIT_INT
 0x80

	)

187 
	#PCI_CB_BRIDGE_CTL_PREFETCH_MEM0
 0x100

	)

188 
	#PCI_CB_BRIDGE_CTL_PREFETCH_MEM1
 0x200

	)

189 
	#PCI_CB_BRIDGE_CTL_POST_WRITES
 0x400

	)

190 
	#PCI_CB_SUBSYSTEM_VENDOR_ID
 0x40

	)

191 
	#PCI_CB_SUBSYSTEM_ID
 0x42

	)

192 
	#PCI_CB_LEGACY_MODE_BASE
 0x44

	)

197 
	#PCI_CAP_LIST_ID
 0

	)

198 
	#PCI_CAP_ID_PM
 0x01

	)

199 
	#PCI_CAP_ID_AGP
 0x02

	)

200 
	#PCI_CAP_ID_VPD
 0x03

	)

201 
	#PCI_CAP_ID_SLOTID
 0x04

	)

202 
	#PCI_CAP_ID_MSI
 0x05

	)

203 
	#PCI_CAP_ID_CHSWP
 0x06

	)

204 
	#PCI_CAP_ID_PCIX
 0x07

	)

205 
	#PCI_CAP_ID_HT
 0x08

	)

206 
	#PCI_CAP_ID_VNDR
 0x09

	)

207 
	#PCI_CAP_ID_DBG
 0x0A

	)

208 
	#PCI_CAP_ID_CCRC
 0x0B

	)

209 
	#PCI_CAP_ID_SHPC
 0x0C

	)

210 
	#PCI_CAP_ID_SSVID
 0x0D

	)

211 
	#PCI_CAP_ID_AGP3
 0x0E

	)

212 
	#PCI_CAP_ID_EXP
 0x10

	)

213 
	#PCI_CAP_ID_MSIX
 0x11

	)

214 
	#PCI_CAP_ID_AF
 0x13

	)

215 
	#PCI_CAP_LIST_NEXT
 1

	)

216 
	#PCI_CAP_FLAGS
 2

	)

217 
	#PCI_CAP_SIZEOF
 4

	)

221 
	#PCI_PM_PMC
 2

	)

222 
	#PCI_PM_CAP_VER_MASK
 0x0007

	)

223 
	#PCI_PM_CAP_PME_CLOCK
 0x0008

	)

224 
	#PCI_PM_CAP_RESERVED
 0x0010

	)

225 
	#PCI_PM_CAP_DSI
 0x0020

	)

226 
	#PCI_PM_CAP_AUX_POWER
 0x01C0

	)

227 
	#PCI_PM_CAP_D1
 0x0200

	)

228 
	#PCI_PM_CAP_D2
 0x0400

	)

229 
	#PCI_PM_CAP_PME
 0x0800

	)

230 
	#PCI_PM_CAP_PME_MASK
 0xF800

	)

231 
	#PCI_PM_CAP_PME_D0
 0x0800

	)

232 
	#PCI_PM_CAP_PME_D1
 0x1000

	)

233 
	#PCI_PM_CAP_PME_D2
 0x2000

	)

234 
	#PCI_PM_CAP_PME_D3
 0x4000

	)

235 
	#PCI_PM_CAP_PME_D3cd
 0x8000

	)

236 
	#PCI_PM_CAP_PME_SHIFT
 11

	)

237 
	#PCI_PM_CTRL
 4

	)

238 
	#PCI_PM_CTRL_STATE_MASK
 0x0003

	)

239 
	#PCI_PM_CTRL_NO_SOFT_RESET
 0x0008

	)

240 
	#PCI_PM_CTRL_PME_ENABLE
 0x0100

	)

241 
	#PCI_PM_CTRL_DATA_SEL_MASK
 0x1e00

	)

242 
	#PCI_PM_CTRL_DATA_SCALE_MASK
 0x6000

	)

243 
	#PCI_PM_CTRL_PME_STATUS
 0x8000

	)

244 
	#PCI_PM_PPB_EXTENSIONS
 6

	)

245 
	#PCI_PM_PPB_B2_B3
 0x40

	)

246 
	#PCI_PM_BPCC_ENABLE
 0x80

	)

247 
	#PCI_PM_DATA_REGISTER
 7

	)

248 
	#PCI_PM_SIZEOF
 8

	)

252 
	#PCI_AGP_VERSION
 2

	)

253 
	#PCI_AGP_RFU
 3

	)

254 
	#PCI_AGP_STATUS
 4

	)

255 
	#PCI_AGP_STATUS_RQ_MASK
 0xff000000

	)

256 
	#PCI_AGP_STATUS_SBA
 0x0200

	)

257 
	#PCI_AGP_STATUS_64BIT
 0x0020

	)

258 
	#PCI_AGP_STATUS_FW
 0x0010

	)

259 
	#PCI_AGP_STATUS_RATE4
 0x0004

	)

260 
	#PCI_AGP_STATUS_RATE2
 0x0002

	)

261 
	#PCI_AGP_STATUS_RATE1
 0x0001

	)

262 
	#PCI_AGP_COMMAND
 8

	)

263 
	#PCI_AGP_COMMAND_RQ_MASK
 0xff000000

	)

264 
	#PCI_AGP_COMMAND_SBA
 0x0200

	)

265 
	#PCI_AGP_COMMAND_AGP
 0x0100

	)

266 
	#PCI_AGP_COMMAND_64BIT
 0x0020

	)

267 
	#PCI_AGP_COMMAND_FW
 0x0010

	)

268 
	#PCI_AGP_COMMAND_RATE4
 0x0004

	)

269 
	#PCI_AGP_COMMAND_RATE2
 0x0002

	)

270 
	#PCI_AGP_COMMAND_RATE1
 0x0001

	)

271 
	#PCI_AGP_SIZEOF
 12

	)

275 
	#PCI_VPD_ADDR
 2

	)

276 
	#PCI_VPD_ADDR_MASK
 0x7ff

	)

277 
	#PCI_VPD_ADDR_F
 0x8000

	)

278 
	#PCI_VPD_DATA
 4

	)

282 
	#PCI_SID_ESR
 2

	)

283 
	#PCI_SID_ESR_NSLOTS
 0x1

	)

284 
	#PCI_SID_ESR_FIC
 0x20

	)

285 
	#PCI_SID_CHASSIS_NR
 3

	)

289 
	#PCI_MSI_FLAGS
 2

	)

290 
	#PCI_MSI_FLAGS_64BIT
 0x80

	)

291 
	#PCI_MSI_FLAGS_QSIZE
 0x70

	)

292 
	#PCI_MSI_FLAGS_QMASK
 0x0

	)

293 
	#PCI_MSI_FLAGS_ENABLE
 0x01

	)

294 
	#PCI_MSI_FLAGS_MASKBIT
 0x100

	)

295 
	#PCI_MSI_RFU
 3

	)

296 
	#PCI_MSI_ADDRESS_LO
 4

	)

297 
	#PCI_MSI_ADDRESS_HI
 8

	)

298 
	#PCI_MSI_DATA_32
 8

	)

299 
	#PCI_MSI_MASK_32
 12

	)

300 
	#PCI_MSI_DATA_64
 12

	)

301 
	#PCI_MSI_MASK_64
 16

	)

304 
	#PCI_MSIX_FLAGS
 2

	)

305 
	#PCI_MSIX_FLAGS_QSIZE
 0x7FF

	)

306 
	#PCI_MSIX_FLAGS_ENABLE
 (1 << 15)

	)

307 
	#PCI_MSIX_FLAGS_MASKALL
 (1 << 14)

	)

308 
	#PCI_MSIX_TABLE
 4

	)

309 
	#PCI_MSIX_PBA
 8

	)

310 
	#PCI_MSIX_FLAGS_BIRMASK
 (7 << 0)

	)

313 
	#PCI_MSIX_ENTRY_SIZE
 16

	)

314 
	#PCI_MSIX_ENTRY_LOWER_ADDR
 0

	)

315 
	#PCI_MSIX_ENTRY_UPPER_ADDR
 4

	)

316 
	#PCI_MSIX_ENTRY_DATA
 8

	)

317 
	#PCI_MSIX_ENTRY_VECTOR_CTRL
 12

	)

318 
	#PCI_MSIX_ENTRY_CTRL_MASKBIT
 1

	)

322 
	#PCI_CHSWP_CSR
 2

	)

323 
	#PCI_CHSWP_DHA
 0x01

	)

324 
	#PCI_CHSWP_EIM
 0x02

	)

325 
	#PCI_CHSWP_PIE
 0x04

	)

326 
	#PCI_CHSWP_LOO
 0x08

	)

327 
	#PCI_CHSWP_PI
 0x30

	)

328 
	#PCI_CHSWP_EXT
 0x40

	)

329 
	#PCI_CHSWP_INS
 0x80

	)

333 
	#PCI_AF_LENGTH
 2

	)

334 
	#PCI_AF_CAP
 3

	)

335 
	#PCI_AF_CAP_TP
 0x01

	)

336 
	#PCI_AF_CAP_FLR
 0x02

	)

337 
	#PCI_AF_CTRL
 4

	)

338 
	#PCI_AF_CTRL_FLR
 0x01

	)

339 
	#PCI_AF_STATUS
 5

	)

340 
	#PCI_AF_STATUS_TP
 0x01

	)

344 
	#PCI_X_CMD
 2

	)

345 
	#PCI_X_CMD_DPERR_E
 0x0001

	)

346 
	#PCI_X_CMD_ERO
 0x0002

	)

347 
	#PCI_X_CMD_READ_512
 0x0000

	)

348 
	#PCI_X_CMD_READ_1K
 0x0004

	)

349 
	#PCI_X_CMD_READ_2K
 0x0008

	)

350 
	#PCI_X_CMD_READ_4K
 0x000

	)

351 
	#PCI_X_CMD_MAX_READ
 0x000

	)

353 
	#PCI_X_CMD_SPLIT_1
 0x0000

	)

354 
	#PCI_X_CMD_SPLIT_2
 0x0010

	)

355 
	#PCI_X_CMD_SPLIT_3
 0x0020

	)

356 
	#PCI_X_CMD_SPLIT_4
 0x0030

	)

357 
	#PCI_X_CMD_SPLIT_8
 0x0040

	)

358 
	#PCI_X_CMD_SPLIT_12
 0x0050

	)

359 
	#PCI_X_CMD_SPLIT_16
 0x0060

	)

360 
	#PCI_X_CMD_SPLIT_32
 0x0070

	)

361 
	#PCI_X_CMD_MAX_SPLIT
 0x0070

	)

362 
	#PCI_X_CMD_VERSION
(
x
(((x>> 12& 3

	)

363 
	#PCI_X_STATUS
 4

	)

364 
	#PCI_X_STATUS_DEVFN
 0x000000f

	)

365 
	#PCI_X_STATUS_BUS
 0x0000ff00

	)

366 
	#PCI_X_STATUS_64BIT
 0x00010000

	)

367 
	#PCI_X_STATUS_133MHZ
 0x00020000

	)

368 
	#PCI_X_STATUS_SPL_DISC
 0x00040000

	)

369 
	#PCI_X_STATUS_UNX_SPL
 0x00080000

	)

370 
	#PCI_X_STATUS_COMPLEX
 0x00100000

	)

371 
	#PCI_X_STATUS_MAX_READ
 0x00600000

	)

372 
	#PCI_X_STATUS_MAX_SPLIT
 0x03800000

	)

373 
	#PCI_X_STATUS_MAX_CUM
 0x1c000000

	)

374 
	#PCI_X_STATUS_SPL_ERR
 0x20000000

	)

375 
	#PCI_X_STATUS_266MHZ
 0x40000000

	)

376 
	#PCI_X_STATUS_533MHZ
 0x80000000

	)

380 
	#PCI_SSVID_VENDOR_ID
 4

	)

381 
	#PCI_SSVID_DEVICE_ID
 6

	)

385 
	#PCI_EXP_FLAGS
 2

	)

386 
	#PCI_EXP_FLAGS_VERS
 0x000

	)

387 
	#PCI_EXP_FLAGS_TYPE
 0x00f0

	)

388 
	#PCI_EXP_TYPE_ENDPOINT
 0x0

	)

389 
	#PCI_EXP_TYPE_LEG_END
 0x1

	)

390 
	#PCI_EXP_TYPE_ROOT_PORT
 0x4

	)

391 
	#PCI_EXP_TYPE_UPSTREAM
 0x5

	)

392 
	#PCI_EXP_TYPE_DOWNSTREAM
 0x6

	)

393 
	#PCI_EXP_TYPE_PCI_BRIDGE
 0x7

	)

394 
	#PCI_EXP_TYPE_PCIE_BRIDGE
 0x8

	)

395 
	#PCI_EXP_TYPE_RC_END
 0x9

	)

396 
	#PCI_EXP_TYPE_RC_EC
 0x

	)

397 
	#PCI_EXP_FLAGS_SLOT
 0x0100

	)

398 
	#PCI_EXP_FLAGS_IRQ
 0x3e00

	)

399 
	#PCI_EXP_DEVCAP
 4

	)

400 
	#PCI_EXP_DEVCAP_PAYLOAD
 0x07

	)

401 
	#PCI_EXP_DEVCAP_PHANTOM
 0x18

	)

402 
	#PCI_EXP_DEVCAP_EXT_TAG
 0x20

	)

403 
	#PCI_EXP_DEVCAP_L0S
 0x1c0

	)

404 
	#PCI_EXP_DEVCAP_L1
 0xe00

	)

405 
	#PCI_EXP_DEVCAP_ATN_BUT
 0x1000

	)

406 
	#PCI_EXP_DEVCAP_ATN_IND
 0x2000

	)

407 
	#PCI_EXP_DEVCAP_PWR_IND
 0x4000

	)

408 
	#PCI_EXP_DEVCAP_RBER
 0x8000

	)

409 
	#PCI_EXP_DEVCAP_PWR_VAL
 0x3fc0000

	)

410 
	#PCI_EXP_DEVCAP_PWR_SCL
 0xc000000

	)

411 
	#PCI_EXP_DEVCAP_FLR
 0x10000000

	)

412 
	#PCI_EXP_DEVCTL
 8

	)

413 
	#PCI_EXP_DEVCTL_CERE
 0x0001

	)

414 
	#PCI_EXP_DEVCTL_NFERE
 0x0002

	)

415 
	#PCI_EXP_DEVCTL_FERE
 0x0004

	)

416 
	#PCI_EXP_DEVCTL_URRE
 0x0008

	)

417 
	#PCI_EXP_DEVCTL_RELAX_EN
 0x0010

	)

418 
	#PCI_EXP_DEVCTL_PAYLOAD
 0x00e0

	)

419 
	#PCI_EXP_DEVCTL_EXT_TAG
 0x0100

	)

420 
	#PCI_EXP_DEVCTL_PHANTOM
 0x0200

	)

421 
	#PCI_EXP_DEVCTL_AUX_PME
 0x0400

	)

422 
	#PCI_EXP_DEVCTL_NOSNOOP_EN
 0x0800

	)

423 
	#PCI_EXP_DEVCTL_READRQ
 0x7000

	)

424 
	#PCI_EXP_DEVCTL_BCR_FLR
 0x8000

	)

425 
	#PCI_EXP_DEVSTA
 10

	)

426 
	#PCI_EXP_DEVSTA_CED
 0x01

	)

427 
	#PCI_EXP_DEVSTA_NFED
 0x02

	)

428 
	#PCI_EXP_DEVSTA_FED
 0x04

	)

429 
	#PCI_EXP_DEVSTA_URD
 0x08

	)

430 
	#PCI_EXP_DEVSTA_AUXPD
 0x10

	)

431 
	#PCI_EXP_DEVSTA_TRPND
 0x20

	)

432 
	#PCI_EXP_LNKCAP
 12

	)

433 
	#PCI_EXP_LNKCAP_SLS
 0x0000000

	)

434 
	#PCI_EXP_LNKCAP_MLW
 0x000003f0

	)

435 
	#PCI_EXP_LNKCAP_ASPMS
 0x00000c00

	)

436 
	#PCI_EXP_LNKCAP_L0SEL
 0x00007000

	)

437 
	#PCI_EXP_LNKCAP_L1EL
 0x00038000

	)

438 
	#PCI_EXP_LNKCAP_CLKPM
 0x00040000

	)

439 
	#PCI_EXP_LNKCAP_SDERC
 0x00080000

	)

440 
	#PCI_EXP_LNKCAP_DLLLARC
 0x00100000

	)

441 
	#PCI_EXP_LNKCAP_LBNC
 0x00200000

	)

442 
	#PCI_EXP_LNKCAP_PN
 0xff000000

	)

443 
	#PCI_EXP_LNKCTL
 16

	)

444 
	#PCI_EXP_LNKCTL_ASPMC
 0x0003

	)

445 
	#PCI_EXP_LNKCTL_RCB
 0x0008

	)

446 
	#PCI_EXP_LNKCTL_LD
 0x0010

	)

447 
	#PCI_EXP_LNKCTL_RL
 0x0020

	)

448 
	#PCI_EXP_LNKCTL_CCC
 0x0040

	)

449 
	#PCI_EXP_LNKCTL_ES
 0x0080

	)

450 
	#PCI_EXP_LNKCTL_CLKREQ_EN
 0x100

	)

451 
	#PCI_EXP_LNKCTL_HAWD
 0x0200

	)

452 
	#PCI_EXP_LNKCTL_LBMIE
 0x0400

	)

453 
	#PCI_EXP_LNKCTL_LABIE
 0x0800

	)

454 
	#PCI_EXP_LNKSTA
 18

	)

455 
	#PCI_EXP_LNKSTA_CLS
 0x000

	)

456 
	#PCI_EXP_LNKSTA_CLS_2_5GB
 0x01

	)

457 
	#PCI_EXP_LNKSTA_CLS_5_0GB
 0x02

	)

458 
	#PCI_EXP_LNKSTA_NLW
 0x03f0

	)

459 
	#PCI_EXP_LNKSTA_NLW_SHIFT
 4

	)

460 
	#PCI_EXP_LNKSTA_LT
 0x0800

	)

461 
	#PCI_EXP_LNKSTA_SLC
 0x1000

	)

462 
	#PCI_EXP_LNKSTA_DLLLA
 0x2000

	)

463 
	#PCI_EXP_LNKSTA_LBMS
 0x4000

	)

464 
	#PCI_EXP_LNKSTA_LABS
 0x8000

	)

465 
	#PCI_EXP_SLTCAP
 20

	)

466 
	#PCI_EXP_SLTCAP_ABP
 0x00000001

	)

467 
	#PCI_EXP_SLTCAP_PCP
 0x00000002

	)

468 
	#PCI_EXP_SLTCAP_MRLSP
 0x00000004

	)

469 
	#PCI_EXP_SLTCAP_AIP
 0x00000008

	)

470 
	#PCI_EXP_SLTCAP_PIP
 0x00000010

	)

471 
	#PCI_EXP_SLTCAP_HPS
 0x00000020

	)

472 
	#PCI_EXP_SLTCAP_HPC
 0x00000040

	)

473 
	#PCI_EXP_SLTCAP_SPLV
 0x00007f80

	)

474 
	#PCI_EXP_SLTCAP_SPLS
 0x00018000

	)

475 
	#PCI_EXP_SLTCAP_EIP
 0x00020000

	)

476 
	#PCI_EXP_SLTCAP_NCCS
 0x00040000

	)

477 
	#PCI_EXP_SLTCAP_PSN
 0xfff80000

	)

478 
	#PCI_EXP_SLTCTL
 24

	)

479 
	#PCI_EXP_SLTCTL_ABPE
 0x0001

	)

480 
	#PCI_EXP_SLTCTL_PFDE
 0x0002

	)

481 
	#PCI_EXP_SLTCTL_MRLSCE
 0x0004

	)

482 
	#PCI_EXP_SLTCTL_PDCE
 0x0008

	)

483 
	#PCI_EXP_SLTCTL_CCIE
 0x0010

	)

484 
	#PCI_EXP_SLTCTL_HPIE
 0x0020

	)

485 
	#PCI_EXP_SLTCTL_AIC
 0x00c0

	)

486 
	#PCI_EXP_SLTCTL_PIC
 0x0300

	)

487 
	#PCI_EXP_SLTCTL_PCC
 0x0400

	)

488 
	#PCI_EXP_SLTCTL_EIC
 0x0800

	)

489 
	#PCI_EXP_SLTCTL_DLLSCE
 0x1000

	)

490 
	#PCI_EXP_SLTSTA
 26

	)

491 
	#PCI_EXP_SLTSTA_ABP
 0x0001

	)

492 
	#PCI_EXP_SLTSTA_PFD
 0x0002

	)

493 
	#PCI_EXP_SLTSTA_MRLSC
 0x0004

	)

494 
	#PCI_EXP_SLTSTA_PDC
 0x0008

	)

495 
	#PCI_EXP_SLTSTA_CC
 0x0010

	)

496 
	#PCI_EXP_SLTSTA_MRLSS
 0x0020

	)

497 
	#PCI_EXP_SLTSTA_PDS
 0x0040

	)

498 
	#PCI_EXP_SLTSTA_EIS
 0x0080

	)

499 
	#PCI_EXP_SLTSTA_DLLSC
 0x0100

	)

500 
	#PCI_EXP_RTCTL
 28

	)

501 
	#PCI_EXP_RTCTL_SECEE
 0x01

	)

502 
	#PCI_EXP_RTCTL_SENFEE
 0x02

	)

503 
	#PCI_EXP_RTCTL_SEFEE
 0x04

	)

504 
	#PCI_EXP_RTCTL_PMEIE
 0x08

	)

505 
	#PCI_EXP_RTCTL_CRSSVE
 0x10

	)

506 
	#PCI_EXP_RTCAP
 30

	)

507 
	#PCI_EXP_RTSTA
 32

	)

508 
	#PCI_EXP_RTSTA_PME
 0x10000

	)

509 
	#PCI_EXP_RTSTA_PENDING
 0x20000

	)

510 
	#PCI_EXP_DEVCAP2
 36

	)

511 
	#PCI_EXP_DEVCAP2_ARI
 0x20

	)

512 
	#PCI_EXP_DEVCAP2_LTR
 0x800

	)

513 
	#PCI_EXP_OBFF_MASK
 0xc0000

	)

514 
	#PCI_EXP_OBFF_MSG
 0x40000

	)

515 
	#PCI_EXP_OBFF_WAKE
 0x80000

	)

516 
	#PCI_EXP_DEVCTL2
 40

	)

517 
	#PCI_EXP_DEVCTL2_ARI
 0x20

	)

518 
	#PCI_EXP_IDO_REQ_EN
 0x100

	)

519 
	#PCI_EXP_IDO_CMP_EN
 0x200

	)

520 
	#PCI_EXP_LTR_EN
 0x400

	)

521 
	#PCI_EXP_OBFF_MSGA_EN
 0x2000

	)

522 
	#PCI_EXP_OBFF_MSGB_EN
 0x4000

	)

523 
	#PCI_EXP_OBFF_WAKE_EN
 0x6000

	)

524 
	#PCI_EXP_LNKCTL2
 48

	)

525 
	#PCI_EXP_SLTCTL2
 56

	)

528 
	#PCI_EXT_CAP_ID
(
hd
(hd & 0x0000ffff)

	)

529 
	#PCI_EXT_CAP_VER
(
hd
((hd >> 16& 0xf)

	)

530 
	#PCI_EXT_CAP_NEXT
(
hd
((hd >> 20& 0xffc)

	)

532 
	#PCI_EXT_CAP_ID_ERR
 1

	)

533 
	#PCI_EXT_CAP_ID_VC
 2

	)

534 
	#PCI_EXT_CAP_ID_DSN
 3

	)

535 
	#PCI_EXT_CAP_ID_PWR
 4

	)

536 
	#PCI_EXT_CAP_ID_VNDR
 11

	)

537 
	#PCI_EXT_CAP_ID_ACS
 13

	)

538 
	#PCI_EXT_CAP_ID_ARI
 14

	)

539 
	#PCI_EXT_CAP_ID_ATS
 15

	)

540 
	#PCI_EXT_CAP_ID_SRIOV
 16

	)

541 
	#PCI_EXT_CAP_ID_PRI
 19

	)

542 
	#PCI_EXT_CAP_ID_LTR
 24

	)

543 
	#PCI_EXT_CAP_ID_PASID
 27

	)

546 
	#PCI_ERR_UNCOR_STATUS
 4

	)

547 
	#PCI_ERR_UNC_TRAIN
 0x00000001

	)

548 
	#PCI_ERR_UNC_DLP
 0x00000010

	)

549 
	#PCI_ERR_UNC_POISON_TLP
 0x00001000

	)

550 
	#PCI_ERR_UNC_FCP
 0x00002000

	)

551 
	#PCI_ERR_UNC_COMP_TIME
 0x00004000

	)

552 
	#PCI_ERR_UNC_COMP_ABORT
 0x00008000

	)

553 
	#PCI_ERR_UNC_UNX_COMP
 0x00010000

	)

554 
	#PCI_ERR_UNC_RX_OVER
 0x00020000

	)

555 
	#PCI_ERR_UNC_MALF_TLP
 0x00040000

	)

556 
	#PCI_ERR_UNC_ECRC
 0x00080000

	)

557 
	#PCI_ERR_UNC_UNSUP
 0x00100000

	)

558 
	#PCI_ERR_UNCOR_MASK
 8

	)

560 
	#PCI_ERR_UNCOR_SEVER
 12

	)

562 
	#PCI_ERR_COR_STATUS
 16

	)

563 
	#PCI_ERR_COR_RCVR
 0x00000001

	)

564 
	#PCI_ERR_COR_BAD_TLP
 0x00000040

	)

565 
	#PCI_ERR_COR_BAD_DLLP
 0x00000080

	)

566 
	#PCI_ERR_COR_REP_ROLL
 0x00000100

	)

567 
	#PCI_ERR_COR_REP_TIMER
 0x00001000

	)

568 
	#PCI_ERR_COR_MASK
 20

	)

570 
	#PCI_ERR_CAP
 24

	)

571 
	#PCI_ERR_CAP_FEP
(
x
((x& 31

	)

572 
	#PCI_ERR_CAP_ECRC_GENC
 0x00000020

	)

573 
	#PCI_ERR_CAP_ECRC_GENE
 0x00000040

	)

574 
	#PCI_ERR_CAP_ECRC_CHKC
 0x00000080

	)

575 
	#PCI_ERR_CAP_ECRC_CHKE
 0x00000100

	)

576 
	#PCI_ERR_HEADER_LOG
 28

	)

577 
	#PCI_ERR_ROOT_COMMAND
 44

	)

579 
	#PCI_ERR_ROOT_CMD_COR_EN
 0x00000001

	)

581 
	#PCI_ERR_ROOT_CMD_NONFATAL_EN
 0x00000002

	)

583 
	#PCI_ERR_ROOT_CMD_FATAL_EN
 0x00000004

	)

584 
	#PCI_ERR_ROOT_STATUS
 48

	)

585 
	#PCI_ERR_ROOT_COR_RCV
 0x00000001

	)

587 
	#PCI_ERR_ROOT_MULTI_COR_RCV
 0x00000002

	)

589 
	#PCI_ERR_ROOT_UNCOR_RCV
 0x00000004

	)

591 
	#PCI_ERR_ROOT_MULTI_UNCOR_RCV
 0x00000008

	)

592 
	#PCI_ERR_ROOT_FIRST_FATAL
 0x00000010

	)

593 
	#PCI_ERR_ROOT_NONFATAL_RCV
 0x00000020

	)

594 
	#PCI_ERR_ROOT_FATAL_RCV
 0x00000040

	)

595 
	#PCI_ERR_ROOT_ERR_SRC
 52

	)

598 
	#PCI_VC_PORT_REG1
 4

	)

599 
	#PCI_VC_PORT_REG2
 8

	)

600 
	#PCI_VC_PORT_CTRL
 12

	)

601 
	#PCI_VC_PORT_STATUS
 14

	)

602 
	#PCI_VC_RES_CAP
 16

	)

603 
	#PCI_VC_RES_CTRL
 20

	)

604 
	#PCI_VC_RES_STATUS
 26

	)

607 
	#PCI_PWR_DSR
 4

	)

608 
	#PCI_PWR_DATA
 8

	)

609 
	#PCI_PWR_DATA_BASE
(
x
((x& 0xff

	)

610 
	#PCI_PWR_DATA_SCALE
(
x
(((x>> 8& 3

	)

611 
	#PCI_PWR_DATA_PM_SUB
(
x
(((x>> 10& 7

	)

612 
	#PCI_PWR_DATA_PM_STATE
(
x
(((x>> 13& 3

	)

613 
	#PCI_PWR_DATA_TYPE
(
x
(((x>> 15& 7

	)

614 
	#PCI_PWR_DATA_RAIL
(
x
(((x>> 18& 7

	)

615 
	#PCI_PWR_CAP
 12

	)

616 
	#PCI_PWR_CAP_BUDGET
(
x
((x& 1

	)

626 
	#HT_3BIT_CAP_MASK
 0xE0

	)

627 
	#HT_CAPTYPE_SLAVE
 0x00

	)

628 
	#HT_CAPTYPE_HOST
 0x20

	)

630 
	#HT_5BIT_CAP_MASK
 0xF8

	)

631 
	#HT_CAPTYPE_IRQ
 0x80

	)

632 
	#HT_CAPTYPE_REMAPPING_40
 0xA0

	)

633 
	#HT_CAPTYPE_REMAPPING_64
 0xA2

	)

634 
	#HT_CAPTYPE_UNITID_CLUMP
 0x90

	)

635 
	#HT_CAPTYPE_EXTCONF
 0x98

	)

636 
	#HT_CAPTYPE_MSI_MAPPING
 0xA8

	)

637 
	#HT_MSI_FLAGS
 0x02

	)

638 
	#HT_MSI_FLAGS_ENABLE
 0x1

	)

639 
	#HT_MSI_FLAGS_FIXED
 0x2

	)

640 
	#HT_MSI_FIXED_ADDR
 0x00000000FEE00000ULL

	)

641 
	#HT_MSI_ADDR_LO
 0x04

	)

642 
	#HT_MSI_ADDR_LO_MASK
 0xFFF00000

	)

643 
	#HT_MSI_ADDR_HI
 0x08

	)

644 
	#HT_CAPTYPE_DIRECT_ROUTE
 0xB0

	)

645 
	#HT_CAPTYPE_VCSET
 0xB8

	)

646 
	#HT_CAPTYPE_ERROR_RETRY
 0xC0

	)

647 
	#HT_CAPTYPE_GEN3
 0xD0

	)

648 
	#HT_CAPTYPE_PM
 0xE0

	)

651 
	#PCI_ARI_CAP
 0x04

	)

652 
	#PCI_ARI_CAP_MFVC
 0x0001

	)

653 
	#PCI_ARI_CAP_ACS
 0x0002

	)

654 
	#PCI_ARI_CAP_NFN
(
x
(((x>> 8& 0xff

	)

655 
	#PCI_ARI_CTRL
 0x06

	)

656 
	#PCI_ARI_CTRL_MFVC
 0x0001

	)

657 
	#PCI_ARI_CTRL_ACS
 0x0002

	)

658 
	#PCI_ARI_CTRL_FG
(
x
(((x>> 4& 7

	)

661 
	#PCI_ATS_CAP
 0x04

	)

662 
	#PCI_ATS_CAP_QDEP
(
x
((x& 0x1f

	)

663 
	#PCI_ATS_MAX_QDEP
 32

	)

664 
	#PCI_ATS_CTRL
 0x06

	)

665 
	#PCI_ATS_CTRL_ENABLE
 0x8000

	)

666 
	#PCI_ATS_CTRL_STU
(
x
((x& 0x1f

	)

667 
	#PCI_ATS_MIN_STU
 12

	)

670 
	#PCI_PRI_CTRL
 0x04

	)

671 
	#PCI_PRI_CTRL_ENABLE
 0x01

	)

672 
	#PCI_PRI_CTRL_RESET
 0x02

	)

673 
	#PCI_PRI_STATUS
 0x06

	)

674 
	#PCI_PRI_STATUS_RF
 0x001

	)

675 
	#PCI_PRI_STATUS_UPRGI
 0x002

	)

676 
	#PCI_PRI_STATUS_STOPPED
 0x100

	)

677 
	#PCI_PRI_MAX_REQ
 0x08

	)

678 
	#PCI_PRI_ALLOC_REQ
 0x0

	)

681 
	#PCI_PASID_CAP
 0x04

	)

682 
	#PCI_PASID_CAP_EXEC
 0x02

	)

683 
	#PCI_PASID_CAP_PRIV
 0x04

	)

684 
	#PCI_PASID_CTRL
 0x06

	)

685 
	#PCI_PASID_CTRL_ENABLE
 0x01

	)

686 
	#PCI_PASID_CTRL_EXEC
 0x02

	)

687 
	#PCI_PASID_CTRL_PRIV
 0x04

	)

690 
	#PCI_SRIOV_CAP
 0x04

	)

691 
	#PCI_SRIOV_CAP_VFM
 0x01

	)

692 
	#PCI_SRIOV_CAP_INTR
(
x
((x>> 21

	)

693 
	#PCI_SRIOV_CTRL
 0x08

	)

694 
	#PCI_SRIOV_CTRL_VFE
 0x01

	)

695 
	#PCI_SRIOV_CTRL_VFM
 0x02

	)

696 
	#PCI_SRIOV_CTRL_INTR
 0x04

	)

697 
	#PCI_SRIOV_CTRL_MSE
 0x08

	)

698 
	#PCI_SRIOV_CTRL_ARI
 0x10

	)

699 
	#PCI_SRIOV_STATUS
 0x0

	)

700 
	#PCI_SRIOV_STATUS_VFM
 0x01

	)

701 
	#PCI_SRIOV_INITIAL_VF
 0x0

	)

702 
	#PCI_SRIOV_TOTAL_VF
 0x0

	)

703 
	#PCI_SRIOV_NUM_VF
 0x10

	)

704 
	#PCI_SRIOV_FUNC_LINK
 0x12

	)

705 
	#PCI_SRIOV_VF_OFFSET
 0x14

	)

706 
	#PCI_SRIOV_VF_STRIDE
 0x16

	)

707 
	#PCI_SRIOV_VF_DID
 0x1

	)

708 
	#PCI_SRIOV_SUP_PGSIZE
 0x1

	)

709 
	#PCI_SRIOV_SYS_PGSIZE
 0x20

	)

710 
	#PCI_SRIOV_BAR
 0x24

	)

711 
	#PCI_SRIOV_NUM_BARS
 6

	)

712 
	#PCI_SRIOV_VFM
 0x3

	)

713 
	#PCI_SRIOV_VFM_BIR
(
x
((x& 7

	)

714 
	#PCI_SRIOV_VFM_OFFSET
(
x
((x& ~7

	)

715 
	#PCI_SRIOV_VFM_UA
 0x0

	)

716 
	#PCI_SRIOV_VFM_MI
 0x1

	)

717 
	#PCI_SRIOV_VFM_MO
 0x2

	)

718 
	#PCI_SRIOV_VFM_AV
 0x3

	)

720 
	#PCI_LTR_MAX_SNOOP_LAT
 0x4

	)

721 
	#PCI_LTR_MAX_NOSNOOP_LAT
 0x6

	)

722 
	#PCI_LTR_VALUE_MASK
 0x000003ff

	)

723 
	#PCI_LTR_SCALE_MASK
 0x00001c00

	)

724 
	#PCI_LTR_SCALE_SHIFT
 10

	)

727 
	#PCI_ACS_CAP
 0x04

	)

728 
	#PCI_ACS_SV
 0x01

	)

729 
	#PCI_ACS_TB
 0x02

	)

730 
	#PCI_ACS_RR
 0x04

	)

731 
	#PCI_ACS_CR
 0x08

	)

732 
	#PCI_ACS_UF
 0x10

	)

733 
	#PCI_ACS_EC
 0x20

	)

734 
	#PCI_ACS_DT
 0x40

	)

735 
	#PCI_ACS_CTRL
 0x06

	)

736 
	#PCI_ACS_EGRESS_CTL_V
 0x08

	)

	@/usr/include/linux/socket.h

1 #ide
_LINUX_SOCKET_H


2 
	#_LINUX_SOCKET_H


	)

7 
	#_K_SS_MAXSIZE
 128

	)

8 
	#_K_SS_ALIGNSIZE
 (
	`__ignof__
 (
sockaddr
 *))

	)

11 
	t__kl__my_t
;

13 
	s__kl_sockaddr_age
 {

14 
__kl__my_t
 
	mss_my
;

16 
	m__da
[
_K_SS_MAXSIZE
 - ()];

19 } 
__ibu__
 ((
igd
(
_K_SS_ALIGNSIZE
)));

	@/usr/include/linux/sysinfo.h

1 #ide
_LINUX_SYSINFO_H


2 
	#_LINUX_SYSINFO_H


	)

4 
	~<lux/tys.h
>

6 
	#SI_LOAD_SHIFT
 16

	)

7 
	ssysfo
 {

8 
__kl_lg_t
 
	muime
;

9 
__kl_ulg_t
 
	mlds
[3];

10 
__kl_ulg_t
 
	mtٮm
;

11 
__kl_ulg_t
 
	m䓿m
;

12 
__kl_ulg_t
 
	mshedm
;

13 
__kl_ulg_t
 
	mbufam
;

14 
__kl_ulg_t
 
	mtٮsw
;

15 
__kl_ulg_t
 
	msw
;

16 
__u16
 
	mocs
;

17 
__u16
 
	md
;

18 
__kl_ulg_t
 
	mtٮhigh
;

19 
__kl_ulg_t
 
	mhigh
;

20 
__u32
 
	mmem_un
;

21 
	m_f
[20-2*(
__kl_ulg_t
)-(
__u32
)];

	@/usr/include/linux/types.h

1 #ide
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/tys.h
>

6 #ide
__ASSEMBLY__


8 
	~<lux/posix_tys.h
>

16 #ifde
__CHECKER__


17 
	#__bwi__
 
	`__ibu__
((
bwi
))

	)

19 
	#__bwi__


	)

21 #ifde
__CHECK_ENDIAN__


22 
	#__bwi
 
__bwi__


	)

24 
	#__bwi


	)

27 
__u16
 
	t__bwi
 
	t__16
;

28 
__u16
 
	t__bwi
 
	t__be16
;

29 
__u32
 
	t__bwi
 
	t__32
;

30 
__u32
 
	t__bwi
 
	t__be32
;

31 
__u64
 
	t__bwi
 
	t__64
;

32 
__u64
 
	t__bwi
 
	t__be64
;

34 
__u16
 
	t__bwi
 
	t__sum16
;

35 
__u32
 
	t__bwi
 
	t__wsum
;

46 
	#__igd_u64
 
__u64
 
	`__ibu__
((
	`igd
(8)))

	)

47 
	#__igd_be64
 
__be64
 
	`__ibu__
((
	`igd
(8)))

	)

48 
	#__igd_64
 
__64
 
	`__ibu__
((
	`igd
(8)))

	)

	@/usr/include/xlocale.h

21 #ide
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__lo_ru


31 
__lo_da
 *
	m__los
[13];

34 cڡ *
	m__y_b
;

35 cڡ *
	m__y_tow
;

36 cڡ *
	m__y_tou
;

39 cڡ *
	m__mes
[13];

40 } *
	t__lo_t
;

43 
__lo_t
 
	tlo_t
;

	@/usr/include/_G_config.h

4 #ide
_G_cfig_h


5 
	#_G_cfig_h
 1

	)

9 
	~<bs/tys.h
>

10 
	#__ed_size_t


	)

11 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


12 
	#__ed_wch_t


	)

14 
	#__ed_NULL


	)

15 
	~<ddef.h
>

16 
	#__ed_mbe_t


	)

17 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


18 
	#__ed_wt_t


	)

20 
	~<wch.h
>

21 
	#_G_size_t
 
size_t


	)

24 
__off_t
 
	m__pos
;

25 
__mbe_t
 
	m__e
;

26 } 
	t_G_os_t
;

29 
__off64_t
 
	m__pos
;

30 
__mbe_t
 
	m__e
;

31 } 
	t_G_os64_t
;

32 
	#_G_ssize_t
 
__ssize_t


	)

33 
	#_G_off_t
 
__off_t


	)

34 
	#_G_off64_t
 
__off64_t


	)

35 
	#_G_pid_t
 
__pid_t


	)

36 
	#_G_uid_t
 
__uid_t


	)

37 
	#_G_wch_t
 
wch_t


	)

38 
	#_G_wt_t
 
wt_t


	)

39 
	#_G_64
 
64


	)

40 #i
defed
 
_LIBC
 || defed 
_GLIBCPP_USE_WCHAR_T


41 
	~<gcv.h
>

44 
__gcv_fo
 
	m__cd
;

47 
__gcv_fo
 
	m__cd
;

48 
__gcv__da
 
	m__da
;

49 } 
	m__combed
;

50 } 
	t_G_icv_t
;

53 
	t_G_t16_t
 
	t__ibu__
 ((
	t__mode__
 (
	t__HI__
)));

54 
	t_G_t32_t
 
	t__ibu__
 ((
	t__mode__
 (
	t__SI__
)));

55 
	t_G_ut16_t
 
	t__ibu__
 ((
	t__mode__
 (
	t__HI__
)));

56 
	t_G_ut32_t
 
	t__ibu__
 ((
	t__mode__
 (
	t__SI__
)));

58 
	#_G_HAVE_BOOL
 1

	)

62 
	#_G_HAVE_ATEXIT
 1

	)

63 
	#_G_HAVE_SYS_CDEFS
 1

	)

64 
	#_G_HAVE_SYS_WAIT
 1

	)

65 
	#_G_NEED_STDARG_H
 1

	)

66 
	#_G_va_li
 
__gnuc_va_li


	)

68 
	#_G_HAVE_PRINTF_FP
 1

	)

69 
	#_G_HAVE_MMAP
 1

	)

70 
	#_G_HAVE_MREMAP
 1

	)

71 
	#_G_HAVE_LONG_DOUBLE_IO
 1

	)

72 
	#_G_HAVE_IO_FILE_OPEN
 1

	)

73 
	#_G_HAVE_IO_GETLINE_INFO
 1

	)

75 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

77 
	#_G_OPEN64
 
__ݒ64


	)

78 
	#_G_LSEEK64
 
__lek64


	)

79 
	#_G_MMAP64
 
__mm64


	)

80 
	#_G_FSTAT64
(
fd
,
buf

	`__fx64
 (
_STAT_VER
, fd, buf)

	)

83 
	#_G_HAVE_ST_BLKSIZE
 
	`defed
 (
_STATBUF_ST_BLKSIZE
)

	)

85 
	#_G_BUFSIZ
 8192

	)

88 
	#_G_NAMES_HAVE_UNDERSCORE
 0

	)

89 
	#_G_VTABLE_LABEL_HAS_LENGTH
 1

	)

90 
	#_G_USING_THUNKS
 1

	)

91 
	#_G_VTABLE_LABEL_PREFIX
 "__vt_"

	)

92 
	#_G_VTABLE_LABEL_PREFIX_ID
 
__vt_


	)

95 #i
defed
 
__lulus
 || defed 
__STDC__


96 
	#_G_ARGS
(
ARGLIST

	)
ARGLIST

98 
	#_G_ARGS
(
ARGLIST
()

	)

	@/usr/include/ctype.h

24 #idef 
_CTYPE_H


25 
	#_CTYPE_H
 1

	)

27 
	~<us.h
>

28 
	~<bs/tys.h
>

30 
	g__BEGIN_DECLS


32 #ide
_ISb


41 
	~<dn.h
>

42 #i
__BYTE_ORDER
 =
__BIG_ENDIAN


43 
	#_ISb
(
b
(1 << (b))

	)

45 
	#_ISb
(
b
((b< 8 ? ((1 << (b)<< 8: ((1 << (b)>> 8))

	)

50 
	m_ISu
 = 
_ISb
 (0),

51 
	m_ISlow
 = 
_ISb
 (1),

52 
	m_ISpha
 = 
_ISb
 (2),

53 
	m_ISdig
 = 
_ISb
 (3),

54 
	m_ISxdig
 = 
_ISb
 (4),

55 
	m_ISa
 = 
_ISb
 (5),

56 
	m_ISt
 = 
_ISb
 (6),

57 
	m_ISgph
 = 
_ISb
 (7),

58 
	m_ISbnk
 = 
_ISb
 (8),

59 
	m_ISl
 = 
_ISb
 (9),

60 
	m_ISpun
 = 
_ISb
 (10),

61 
	m_ISnum
 = 
_ISb
 (11)

81 
__cڡ
 **
	$__y_b_loc
 ()

82 
__THROW
 
	`__ibu__
 ((
__cڡ
));

83 
__cڡ
 
__t32_t
 **
	$__y_tow_loc
 ()

84 
__THROW
 
	`__ibu__
 ((
__cڡ
));

85 
__cڡ
 
__t32_t
 **
	$__y_tou_loc
 ()

86 
__THROW
 
	`__ibu__
 ((
__cڡ
));

89 #ide
__lulus


90 
	#__isy
(
c
, 
ty
) \

91 ((*
	`__y_b_loc
 ())[((
c
)] & (
ty
)

	)

92 #i
defed
 
__USE_EXTERN_INLINES


93 
	#__isy_f
(
ty
) \

94 
__ex_le
 \

95 
is
##
	`ty
 (
__c

__THROW
 \

97  (*
	`__y_b_loc
 ())[((
__c
)] & (
_IS
##
ty
; \

98 
	}

	)
}

101 
	#__iscii
(
c
(((c& ~0x7f=0

	)

102 
	#__tscii
(
c
((c& 0x7f

	)

104 
	#__exy
(
me

	`me
 (
__THROW


	)

106 
__BEGIN_NAMESPACE_STD


112 
__exy
 (
ium
);

113 
__exy
 (
iha
);

114 
__exy
 (
isl
);

115 
__exy
 (
isdig
);

116 
__exy
 (
iow
);

117 
__exy
 (
isgph
);

118 
__exy
 (
irt
);

119 
__exy
 (
iun
);

120 
__exy
 (
isa
);

121 
__exy
 (
isu
);

122 
__exy
 (
isxdig
);

126 
	$tow
 (
__c

__THROW
;

129 
	$tou
 (
__c

__THROW
;

131 
__END_NAMESPACE_STD


135 #ifdef 
__USE_ISOC99


136 
__BEGIN_NAMESPACE_C99


138 
	`__exy
 (
isbnk
);

140 
__END_NAMESPACE_C99


143 #ifde
__USE_GNU


145 
	$isy
 (
__c
, 
__mask

__THROW
;

148 #i
defed
 
__USE_SVID
 || defed 
__USE_MISC
 || defed 
__USE_XOPEN


152 
	$iscii
 (
__c

__THROW
;

156 
	$tscii
 (
__c

__THROW
;

160 
	`__exy
 (
_tou
);

161 
	`__exy
 (
_tow
);

165 
	#__tobody
(
c
, 
f
, 
a
, 
gs
) \

166 (
__exnsi__
 \

167 ({ 
__s
; \

168 i( (
c
) > 1) \

170 i(
	`__but_cڡt_p
 (
c
)) \

172 
__c
 = (
c
); \

173 
__s
 = 
__c
 < -128 || __> 255 ? __: (
a
)[__c]; \

176 
__s
 = 
f
 
gs
; \

179 
__s
 = (
a
)[((
c
)]; \

180 
__s
; 
	}
}))

	)

182 #i!
defed
 
__NO_CTYPE


183 #ifde
__isy_f


184 
	$__isy_f
 (
num
)

185 
	$__isy_f
 (
pha
)

186 
	$__isy_f
 (
l
)

187 
	$__isy_f
 (
dig
)

188 
	$__isy_f
 (
low
)

189 
	$__isy_f
 (
gph
)

190 
	$__isy_f
 (
t
)

191 
	$__isy_f
 (
pun
)

192 
	$__isy_f
 (
a
)

193 
	$__isy_f
 (
u
)

194 
	$__isy_f
 (
xdig
)

195 #ifde
__USE_ISOC99


196 
	$__isy_f
 (
bnk
)

198 #i
defed
 
__isy


199 
	#ium
(
c

	`__isy
((c), 
_ISnum
)

	)

200 
	#iha
(
c

	`__isy
((c), 
_ISpha
)

	)

201 
	#isl
(
c

	`__isy
((c), 
_ISl
)

	)

202 
	#isdig
(
c

	`__isy
((c), 
_ISdig
)

	)

203 
	#iow
(
c

	`__isy
((c), 
_ISlow
)

	)

204 
	#isgph
(
c

	`__isy
((c), 
_ISgph
)

	)

205 
	#irt
(
c

	`__isy
((c), 
_ISt
)

	)

206 
	#iun
(
c

	`__isy
((c), 
_ISpun
)

	)

207 
	#isa
(
c

	`__isy
((c), 
_ISa
)

	)

208 
	#isu
(
c

	`__isy
((c), 
_ISu
)

	)

209 
	#isxdig
(
c

	`__isy
((c), 
_ISxdig
)

	)

210 #ifde
__USE_ISOC99


211 
	#isbnk
(
c

	`__isy
((c), 
_ISbnk
)

	)

215 #ifde
__USE_EXTERN_INLINES


216 
__ex_le
 

217 
	`__NTH
 (
	$tow
 (
__c
))

219  
__c
 >-128 && __< 256 ? (*
	`__y_tow_loc
 ())[__c] : __c;

220 
	}
}

222 
__ex_le
 

223 
__NTH
 (
	$tou
 (
__c
))

225  
__c
 >-128 && __< 256 ? (*
	`__y_tou_loc
 ())[__c] : __c;

226 
	}
}

229 #i
__GNUC__
 >2 && 
defed
 
__OPTIMIZE__
 && !defed 
__lulus


230 
	#tow
(
c

	`__tobody
 (c, 
tow
, *
	`__y_tow_loc
 (), (c))

	)

231 
	#tou
(
c

	`__tobody
 (c, 
tou
, *
	`__y_tou_loc
 (), (c))

	)

234 #i
defed
 
__USE_SVID
 || defed 
__USE_MISC
 || defed 
__USE_XOPEN


235 
	#iscii
(
c

	`__iscii
 (c)

	)

236 
	#tscii
(
c

	`__tscii
 (c)

	)

238 
	#_tow
(
c
(((*
	`__y_tow_loc
 ())[((c)])

	)

239 
	#_tou
(
c
(((*
	`__y_tou_loc
 ())[((c)])

	)

245 #ifde
__USE_XOPEN2K8


259 
	~<xlo.h
>

263 
	#__isy_l
(
c
, 
ty
, 
lo
) \

264 ((
lo
)->
__y_b
[((
c
)] & (
ty
)

	)

266 
	#__exy_l
(
me
) \

267 
	`me
 (, 
__lo_t

__THROW


	)

273 
__exy_l
 (
ium_l
);

274 
__exy_l
 (
iha_l
);

275 
__exy_l
 (
isl_l
);

276 
__exy_l
 (
isdig_l
);

277 
__exy_l
 (
iow_l
);

278 
__exy_l
 (
isgph_l
);

279 
__exy_l
 (
irt_l
);

280 
__exy_l
 (
iun_l
);

281 
__exy_l
 (
isa_l
);

282 
__exy_l
 (
isu_l
);

283 
__exy_l
 (
isxdig_l
);

285 
__exy_l
 (
isbnk_l
);

289 
	$__tow_l
 (
__c
, 
__lo_t
 
__l

__THROW
;

290 
	$tow_l
 (
__c
, 
__lo_t
 
__l

__THROW
;

293 
	$__tou_l
 (
__c
, 
__lo_t
 
__l

__THROW
;

294 
	$tou_l
 (
__c
, 
__lo_t
 
__l

__THROW
;

296 #i
__GNUC__
 >2 && 
defed
 
__OPTIMIZE__
 && !defed 
__lulus


297 
	#__tow_l
(
c
, 
lo
) \

298 
	`__tobody
 (
c
, 
__tow_l
, (
lo
)->
__y_tow
, (c,o))

	)

299 
	#__tou_l
(
c
, 
lo
) \

300 
	`__tobody
 (
c
, 
__tou_l
, (
lo
)->
__y_tou
, (c,o))

	)

301 
	#tow_l
(
c
, 
lo

	`__tow_l
 ((c), (lo))

	)

302 
	#tou_l
(
c
, 
lo

	`__tou_l
 ((c), (lo))

	)

306 #ide
__NO_CTYPE


307 
	#__ium_l
(
c
,
l

	`__isy_l
((c), 
_ISnum
, (l))

	)

308 
	#__iha_l
(
c
,
l

	`__isy_l
((c), 
_ISpha
, (l))

	)

309 
	#__isl_l
(
c
,
l

	`__isy_l
((c), 
_ISl
, (l))

	)

310 
	#__isdig_l
(
c
,
l

	`__isy_l
((c), 
_ISdig
, (l))

	)

311 
	#__iow_l
(
c
,
l

	`__isy_l
((c), 
_ISlow
, (l))

	)

312 
	#__isgph_l
(
c
,
l

	`__isy_l
((c), 
_ISgph
, (l))

	)

313 
	#__irt_l
(
c
,
l

	`__isy_l
((c), 
_ISt
, (l))

	)

314 
	#__iun_l
(
c
,
l

	`__isy_l
((c), 
_ISpun
, (l))

	)

315 
	#__isa_l
(
c
,
l

	`__isy_l
((c), 
_ISa
, (l))

	)

316 
	#__isu_l
(
c
,
l

	`__isy_l
((c), 
_ISu
, (l))

	)

317 
	#__isxdig_l
(
c
,
l

	`__isy_l
((c), 
_ISxdig
, (l))

	)

319 
	#__isbnk_l
(
c
,
l

	`__isy_l
((c), 
_ISbnk
, (l))

	)

321 #i
defed
 
__USE_SVID
 || defed 
__USE_MISC


322 
	#__iscii_l
(
c
,
l
(), 
	`__iscii
 (c))

	)

323 
	#__tscii_l
(
c
,
l
(), 
	`__tscii
 (c))

	)

326 
	#ium_l
(
c
,
l

	`__ium_l
 ((c), (l))

	)

327 
	#iha_l
(
c
,
l

	`__iha_l
 ((c), (l))

	)

328 
	#isl_l
(
c
,
l

	`__isl_l
 ((c), (l))

	)

329 
	#isdig_l
(
c
,
l

	`__isdig_l
 ((c), (l))

	)

330 
	#iow_l
(
c
,
l

	`__iow_l
 ((c), (l))

	)

331 
	#isgph_l
(
c
,
l

	`__isgph_l
 ((c), (l))

	)

332 
	#irt_l
(
c
,
l

	`__irt_l
 ((c), (l))

	)

333 
	#iun_l
(
c
,
l

	`__iun_l
 ((c), (l))

	)

334 
	#isa_l
(
c
,
l

	`__isa_l
 ((c), (l))

	)

335 
	#isu_l
(
c
,
l

	`__isu_l
 ((c), (l))

	)

336 
	#isxdig_l
(
c
,
l

	`__isxdig_l
 ((c), (l))

	)

338 
	#isbnk_l
(
c
,
l

	`__isbnk_l
 ((c), (l))

	)

340 #i
defed
 
__USE_SVID
 || defed 
__USE_MISC


341 
	#iscii_l
(
c
,
l

	`__iscii_l
 ((c), (l))

	)

342 
	#tscii_l
(
c
,
l

	`__tscii_l
 ((c), (l))

	)

349 
__END_DECLS


	@/usr/include/linux/hdlc/ioctl.h

1 #ide
__HDLC_IOCTL_H__


2 
	#__HDLC_IOCTL_H__


	)

5 
	#GENERIC_HDLC_VERSION
 4

	)

7 
	#CLOCK_DEFAULT
 0

	)

8 
	#CLOCK_EXT
 1

	)

9 
	#CLOCK_INT
 2

	)

10 
	#CLOCK_TXINT
 3

	)

11 
	#CLOCK_TXFROMRX
 4

	)

14 
	#ENCODING_DEFAULT
 0

	)

15 
	#ENCODING_NRZ
 1

	)

16 
	#ENCODING_NRZI
 2

	)

17 
	#ENCODING_FM_MARK
 3

	)

18 
	#ENCODING_FM_SPACE
 4

	)

19 
	#ENCODING_MANCHESTER
 5

	)

22 
	#PARITY_DEFAULT
 0

	)

23 
	#PARITY_NONE
 1

	)

24 
	#PARITY_CRC16_PR0
 2

	)

25 
	#PARITY_CRC16_PR1
 3

	)

26 
	#PARITY_CRC16_PR0_CCITT
 4

	)

27 
	#PARITY_CRC16_PR1_CCITT
 5

	)

28 
	#PARITY_CRC32_PR0_CCITT
 6

	)

29 
	#PARITY_CRC32_PR1_CCITT
 7

	)

31 
	#LMI_DEFAULT
 0

	)

32 
	#LMI_NONE
 1

	)

33 
	#LMI_ANSI
 2

	)

34 
	#LMI_CCITT
 3

	)

35 
	#LMI_CISCO
 4

	)

38 
	mock_
;

39 
	mock_ty
;

40 
	mloback
;

41 } 
	tsync_rl_gs
;

44 
	mock_
;

45 
	mock_ty
;

46 
	mloback
;

47 
	m_m
;

48 } 
	t1_gs
;

51 
	mcodg
;

52 
	mry
;

53 } 
	tw_hdlc_o
;

56 
	mt391
;

57 
	mt392
;

58 
	mn391
;

59 
	mn392
;

60 
	mn393
;

61 
	mlmi
;

62 
	md
;

63 } 
	t_o
;

66 
	mdlci
;

67 } 
	t_o_pvc
;

70 
	mdlci
;

71 
	mma
[
IFNAMSIZ
];

72 }
	t_o_pvc_fo
;

75 
	mrv
;

76 
	mtimeout
;

77 } 
	tcisco_o
;

	@/usr/include/linux/if_pppol2tp.h

15 #ide
__LINUX_IF_PPPOL2TP_H


16 
	#__LINUX_IF_PPPOL2TP_H


	)

18 
	~<lux/tys.h
>

24 
	sp2_addr
 {

25 
__kl_pid_t
 
	mpid
;

27 
	mfd
;

29 
sockaddr_
 
	maddr
;

31 
__u16
 
	ms_tu
, 
	ms_ssi
;

32 
__u16
 
	md_tu
, 
	md_ssi
;

38 
	sp26_addr
 {

39 
__kl_pid_t
 
	mpid
;

41 
	mfd
;

43 
__u16
 
	ms_tu
, 
	ms_ssi
;

44 
__u16
 
	md_tu
, 
	md_ssi
;

46 
sockaddr_6
 
	maddr
;

52 
	sp2v3_addr
 {

53 
__kl_pid_t
 
	mpid
;

55 
	mfd
;

57 
sockaddr_
 
	maddr
;

59 
__u32
 
	ms_tu
, 
	ms_ssi
;

60 
__u32
 
	md_tu
, 
	md_ssi
;

63 
	sp2v36_addr
 {

64 
__kl_pid_t
 
	mpid
;

66 
	mfd
;

68 
__u32
 
	ms_tu
, 
	ms_ssi
;

69 
__u32
 
	md_tu
, 
	md_ssi
;

71 
sockaddr_6
 
	maddr
;

85 
	mPPPOL2TP_SO_DEBUG
 = 1,

86 
	mPPPOL2TP_SO_RECVSEQ
 = 2,

87 
	mPPPOL2TP_SO_SENDSEQ
 = 3,

88 
	mPPPOL2TP_SO_LNSMODE
 = 4,

89 
	mPPPOL2TP_SO_REORDERTO
 = 5,

94 
	mPPPOL2TP_MSG_DEBUG
 = (1 << 0),

96 
	mPPPOL2TP_MSG_CONTROL
 = (1 << 1),

98 
	mPPPOL2TP_MSG_SEQ
 = (1 << 2),

99 
	mPPPOL2TP_MSG_DATA
 = (1 << 3),

	@/usr/include/linux/netlink.h

1 #ide
__LINUX_NETLINK_H


2 
	#__LINUX_NETLINK_H


	)

4 
	~<lux/sock.h
>

5 
	~<lux/tys.h
>

7 
	#NETLINK_ROUTE
 0

	)

8 
	#NETLINK_UNUSED
 1

	)

9 
	#NETLINK_USERSOCK
 2

	)

10 
	#NETLINK_FIREWALL
 3

	)

11 
	#NETLINK_SOCK_DIAG
 4

	)

12 
	#NETLINK_NFLOG
 5

	)

13 
	#NETLINK_XFRM
 6

	)

14 
	#NETLINK_SELINUX
 7

	)

15 
	#NETLINK_ISCSI
 8

	)

16 
	#NETLINK_AUDIT
 9

	)

17 
	#NETLINK_FIB_LOOKUP
 10

	)

18 
	#NETLINK_CONNECTOR
 11

	)

19 
	#NETLINK_NETFILTER
 12

	)

20 
	#NETLINK_IP6_FW
 13

	)

21 
	#NETLINK_DNRTMSG
 14

	)

22 
	#NETLINK_KOBJECT_UEVENT
 15

	)

23 
	#NETLINK_GENERIC
 16

	)

25 
	#NETLINK_SCSITRANSPORT
 18

	)

26 
	#NETLINK_ECRYPTFS
 19

	)

27 
	#NETLINK_RDMA
 20

	)

28 
	#NETLINK_CRYPTO
 21

	)

30 
	#NETLINK_INET_DIAG
 
NETLINK_SOCK_DIAG


	)

32 
	#MAX_LINKS
 32

	)

34 
	ssockaddr_
 {

35 
__kl__my_t
 
	m_my
;

36 
	m_d
;

37 
__u32
 
	m_pid
;

38 
__u32
 
	m_groups
;

41 
	smsghdr
 {

42 
__u32
 
	mmsg_n
;

43 
__u16
 
	mmsg_ty
;

44 
__u16
 
	mmsg_ags
;

45 
__u32
 
	mmsg_q
;

46 
__u32
 
	mmsg_pid
;

51 
	#NLM_F_REQUEST
 1

	)

52 
	#NLM_F_MULTI
 2

	)

53 
	#NLM_F_ACK
 4

	)

54 
	#NLM_F_ECHO
 8

	)

55 
	#NLM_F_DUMP_INTR
 16

	)

58 
	#NLM_F_ROOT
 0x100

	)

59 
	#NLM_F_MATCH
 0x200

	)

60 
	#NLM_F_ATOMIC
 0x400

	)

61 
	#NLM_F_DUMP
 (
NLM_F_ROOT
|
NLM_F_MATCH
)

	)

64 
	#NLM_F_REPLACE
 0x100

	)

65 
	#NLM_F_EXCL
 0x200

	)

66 
	#NLM_F_CREATE
 0x400

	)

67 
	#NLM_F_APPEND
 0x800

	)

78 
	#NLMSG_ALIGNTO
 4U

	)

79 
	#NLMSG_ALIGN
(
n
(֒)+
NLMSG_ALIGNTO
-1& ~(NLMSG_ALIGNTO-1)

	)

80 
	#NLMSG_HDRLEN
 ((
	`NLMSG_ALIGN
((
msghdr
)))

	)

81 
	#NLMSG_LENGTH
(
n
(֒)+
	`NLMSG_ALIGN
(
NLMSG_HDRLEN
))

	)

82 
	#NLMSG_SPACE
(
n

	`NLMSG_ALIGN
(
	`NLMSG_LENGTH
֒))

	)

83 
	#NLMSG_DATA
(
h
((*)(((*lh+ 
	`NLMSG_LENGTH
(0)))

	)

84 
	#NLMSG_NEXT
(
h
,
n
(֒-
	`NLMSG_ALIGN
(lh)->
msg_n
), \

85 (
msghdr
*)(((*)(
h
)+ 
	`NLMSG_ALIGN
(lh)->
msg_n
)))

	)

86 
	#NLMSG_OK
(
h
,
n
(֒>()(
msghdr
) && \

87 (
h
)->
msg_n
 >(
msghdr
) && \

88 (
h
)->
msg_n
 <(
n
))

	)

89 
	#NLMSG_PAYLOAD
(
h
,
n
(lh)->
msg_n
 - 
	`NLMSG_SPACE
(֒)))

	)

91 
	#NLMSG_NOOP
 0x1

	)

92 
	#NLMSG_ERROR
 0x2

	)

93 
	#NLMSG_DONE
 0x3

	)

94 
	#NLMSG_OVERRUN
 0x4

	)

96 
	#NLMSG_MIN_TYPE
 0x10

	)

98 
	smsgr
 {

99 
	mr
;

100 
msghdr
 
	mmsg
;

103 
	#NETLINK_ADD_MEMBERSHIP
 1

	)

104 
	#NETLINK_DROP_MEMBERSHIP
 2

	)

105 
	#NETLINK_PKTINFO
 3

	)

106 
	#NETLINK_BROADCAST_ERROR
 4

	)

107 
	#NETLINK_NO_ENOBUFS
 5

	)

109 
	s_pktfo
 {

110 
__u32
 
	mgroup
;

113 
	#NET_MAJOR
 36

	)

116 
	mNETLINK_UNCONNECTED
 = 0,

117 
	mNETLINK_CONNECTED
,

129 
	sƩ
 {

130 
__u16
 
	ma_n
;

131 
__u16
 
	ma_ty
;

144 
	#NLA_F_NESTED
 (1 << 15)

	)

145 
	#NLA_F_NET_BYTEORDER
 (1 << 14)

	)

146 
	#NLA_TYPE_MASK
 ~(
NLA_F_NESTED
 | 
NLA_F_NET_BYTEORDER
)

	)

148 
	#NLA_ALIGNTO
 4

	)

149 
	#NLA_ALIGN
(
n
((֒+ 
NLA_ALIGNTO
 - 1& ~(NLA_ALIGNTO - 1))

	)

150 
	#NLA_HDRLEN
 ((
	`NLA_ALIGN
((
Ʃ
)))

	)

	@/usr/include/linux/posix_types.h

1 #ide
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<lux/ddef.h
>

21 #unde
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_bs
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__kl_fd_t
;

29 (*
	t__kl_sighdr_t
)();

32 
	t__kl_key_t
;

33 
	t__kl_mqd_t
;

35 
	~<asm/posix_tys.h
>

	@/usr/include/linux/sysctl.h

22 #ide
_LINUX_SYSCTL_H


23 
	#_LINUX_SYSCTL_H


	)

25 
	~<lux/kl.h
>

26 
	~<lux/tys.h
>

29 
	gcomi
;

31 
	#CTL_MAXNAME
 10

	)

36 
	s__sysl_gs
 {

37 *
	mme
;

38 
	mƒ
;

39 *
	mdv
;

40 
size_t
 *
	md
;

41 *
	mwv
;

42 
size_t
 
	mwn
;

43 
	m__unud
[4];

52 
	mCTL_KERN
=1,

53 
	mCTL_VM
=2,

54 
	mCTL_NET
=3,

55 
	mCTL_PROC
=4,

56 
	mCTL_FS
=5,

57 
	mCTL_DEBUG
=6,

58 
	mCTL_DEV
=7,

59 
	mCTL_BUS
=8,

60 
	mCTL_ABI
=9,

61 
	mCTL_CPU
=10,

62 
	mCTL_ARLAN
=254,

63 
	mCTL_S390DBF
=5677,

64 
	mCTL_SUNRPC
=7249,

65 
	mCTL_PM
=9899,

66 
	mCTL_FRV
=9898,

72 
	mCTL_BUS_ISA
=1

78 
	mINOTIFY_MAX_USER_INSTANCES
=1,

79 
	mINOTIFY_MAX_USER_WATCHES
=2,

80 
	mINOTIFY_MAX_QUEUED_EVENTS
=3

86 
	mKERN_OSTYPE
=1,

87 
	mKERN_OSRELEASE
=2,

88 
	mKERN_OSREV
=3,

89 
	mKERN_VERSION
=4,

90 
	mKERN_SECUREMASK
=5,

91 
	mKERN_PROF
=6,

92 
	mKERN_NODENAME
=7,

93 
	mKERN_DOMAINNAME
=8,

95 
	mKERN_PANIC
=15,

96 
	mKERN_REALROOTDEV
=16,

98 
	mKERN_SPARC_REBOOT
=21,

99 
	mKERN_CTLALTDEL
=22,

100 
	mKERN_PRINTK
=23,

101 
	mKERN_NAMETRANS
=24,

102 
	mKERN_PPC_HTABRECLAIM
=25,

103 
	mKERN_PPC_ZEROPAGED
=26,

104 
	mKERN_PPC_POWERSAVE_NAP
=27,

105 
	mKERN_MODPROBE
=28,

106 
	mKERN_SG_BIG_BUFF
=29,

107 
	mKERN_ACCT
=30,

108 
	mKERN_PPC_L2CR
=31,

110 
	mKERN_RTSIGNR
=32,

111 
	mKERN_RTSIGMAX
=33,

113 
	mKERN_SHMMAX
=34,

114 
	mKERN_MSGMAX
=35,

115 
	mKERN_MSGMNB
=36,

116 
	mKERN_MSGPOOL
=37,

117 
	mKERN_SYSRQ
=38,

118 
	mKERN_MAX_THREADS
=39,

119 
	mKERN_RANDOM
=40,

120 
	mKERN_SHMALL
=41,

121 
	mKERN_MSGMNI
=42,

122 
	mKERN_SEM
=43,

123 
	mKERN_SPARC_STOP_A
=44,

124 
	mKERN_SHMMNI
=45,

125 
	mKERN_OVERFLOWUID
=46,

126 
	mKERN_OVERFLOWGID
=47,

127 
	mKERN_SHMPATH
=48,

128 
	mKERN_HOTPLUG
=49,

129 
	mKERN_IEEE_EMULATION_WARNINGS
=50,

130 
	mKERN_S390_USER_DEBUG_LOGGING
=51,

131 
	mKERN_CORE_USES_PID
=52,

132 
	mKERN_TAINTED
=53,

133 
	mKERN_CADPID
=54,

134 
	mKERN_PIDMAX
=55,

135 
	mKERN_CORE_PATTERN
=56,

136 
	mKERN_PANIC_ON_OOPS
=57,

137 
	mKERN_HPPA_PWRSW
=58,

138 
	mKERN_HPPA_UNALIGNED
=59,

139 
	mKERN_PRINTK_RATELIMIT
=60,

140 
	mKERN_PRINTK_RATELIMIT_BURST
=61,

141 
	mKERN_PTY
=62,

142 
	mKERN_NGROUPS_MAX
=63,

143 
	mKERN_SPARC_SCONS_PWROFF
=64,

144 
	mKERN_HZ_TIMER
=65,

145 
	mKERN_UNKNOWN_NMI_PANIC
=66,

146 
	mKERN_BOOTLOADER_TYPE
=67,

147 
	mKERN_RANDOMIZE
=68,

148 
	mKERN_SETUID_DUMPABLE
=69,

149 
	mKERN_SPIN_RETRY
=70,

150 
	mKERN_ACPI_VIDEO_FLAGS
=71,

151 
	mKERN_IA64_UNALIGNED
=72,

152 
	mKERN_COMPAT_LOG
=73,

153 
	mKERN_MAX_LOCK_DEPTH
=74,

154 
	mKERN_NMI_WATCHDOG
=75,

155 
	mKERN_PANIC_ON_NMI
=76,

163 
	mVM_UNUSED1
=1,

164 
	mVM_UNUSED2
=2,

165 
	mVM_UNUSED3
=3,

166 
	mVM_UNUSED4
=4,

167 
	mVM_OVERCOMMIT_MEMORY
=5,

168 
	mVM_UNUSED5
=6,

169 
	mVM_UNUSED7
=7,

170 
	mVM_UNUSED8
=8,

171 
	mVM_UNUSED9
=9,

172 
	mVM_PAGE_CLUSTER
=10,

173 
	mVM_DIRTY_BACKGROUND
=11,

174 
	mVM_DIRTY_RATIO
=12,

175 
	mVM_DIRTY_WB_CS
=13,

176 
	mVM_DIRTY_EXPIRE_CS
=14,

177 
	mVM_NR_PDFLUSH_THREADS
=15,

178 
	mVM_OVERCOMMIT_RATIO
=16,

179 
	mVM_PAGEBUF
=17,

180 
	mVM_HUGETLB_PAGES
=18,

181 
	mVM_SWAPPINESS
=19,

182 
	mVM_LOWMEM_RESERVE_RATIO
=20,

183 
	mVM_MIN_FREE_KBYTES
=21,

184 
	mVM_MAX_MAP_COUNT
=22,

185 
	mVM_LAPTOP_MODE
=23,

186 
	mVM_BLOCK_DUMP
=24,

187 
	mVM_HUGETLB_GROUP
=25,

188 
	mVM_VFS_CACHE_PRESSURE
=26,

189 
	mVM_LEGACY_VA_LAYOUT
=27,

190 
	mVM_SWAP_TOKEN_TIMEOUT
=28,

191 
	mVM_DROP_PAGECACHE
=29,

192 
	mVM_PERCPU_PAGELIST_FRACTION
=30,

193 
	mVM_ZONE_RECLAIM_MODE
=31,

194 
	mVM_MIN_UNMAPPED
=32,

195 
	mVM_PANIC_ON_OOM
=33,

196 
	mVM_VDSO_ENABLED
=34,

197 
	mVM_MIN_SLAB
=35,

204 
	mNET_CORE
=1,

205 
	mNET_ETHER
=2,

206 
	mNET_802
=3,

207 
	mNET_UNIX
=4,

208 
	mNET_IPV4
=5,

209 
	mNET_IPX
=6,

210 
	mNET_ATALK
=7,

211 
	mNET_NETROM
=8,

212 
	mNET_AX25
=9,

213 
	mNET_BRIDGE
=10,

214 
	mNET_ROSE
=11,

215 
	mNET_IPV6
=12,

216 
	mNET_X25
=13,

217 
	mNET_TR
=14,

218 
	mNET_DECNET
=15,

219 
	mNET_ECONET
=16,

220 
	mNET_SCTP
=17,

221 
	mNET_LLC
=18,

222 
	mNET_NETFILTER
=19,

223 
	mNET_DCCP
=20,

224 
	mNET_IRDA
=412,

230 
	mRANDOM_POOLSIZE
=1,

231 
	mRANDOM_ENTROPY_COUNT
=2,

232 
	mRANDOM_READ_THRESH
=3,

233 
	mRANDOM_WRITE_THRESH
=4,

234 
	mRANDOM_BOOT_ID
=5,

235 
	mRANDOM_UUID
=6

241 
	mPTY_MAX
=1,

242 
	mPTY_NR
=2

248 
	mBUS_ISA_MEM_BASE
=1,

249 
	mBUS_ISA_PORT_BASE
=2,

250 
	mBUS_ISA_PORT_SHIFT
=3

256 
	mNET_CORE_WMEM_MAX
=1,

257 
	mNET_CORE_RMEM_MAX
=2,

258 
	mNET_CORE_WMEM_DEFAULT
=3,

259 
	mNET_CORE_RMEM_DEFAULT
=4,

261 
	mNET_CORE_MAX_BACKLOG
=6,

262 
	mNET_CORE_FASTROUTE
=7,

263 
	mNET_CORE_MSG_COST
=8,

264 
	mNET_CORE_MSG_BURST
=9,

265 
	mNET_CORE_OPTMEM_MAX
=10,

266 
	mNET_CORE_HOT_LIST_LENGTH
=11,

267 
	mNET_CORE_DIVERT_VERSION
=12,

268 
	mNET_CORE_NO_CONG_THRESH
=13,

269 
	mNET_CORE_NO_CONG
=14,

270 
	mNET_CORE_LO_CONG
=15,

271 
	mNET_CORE_MOD_CONG
=16,

272 
	mNET_CORE_DEV_WEIGHT
=17,

273 
	mNET_CORE_SOMAXCONN
=18,

274 
	mNET_CORE_BUDGET
=19,

275 
	mNET_CORE_AEVENT_ETIME
=20,

276 
	mNET_CORE_AEVENT_RSEQTH
=21,

277 
	mNET_CORE_WARNINGS
=22,

288 
	mNET_UNIX_DESTROY_DELAY
=1,

289 
	mNET_UNIX_DELETE_DELAY
=2,

290 
	mNET_UNIX_MAX_DGRAM_QLEN
=3,

296 
	mNET_NF_CONNTRACK_MAX
=1,

297 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_SYN_SENT
=2,

298 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_SYN_RECV
=3,

299 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_ESTABLISHED
=4,

300 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_FIN_WAIT
=5,

301 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_CLOSE_WAIT
=6,

302 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_LAST_ACK
=7,

303 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_TIME_WAIT
=8,

304 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_CLOSE
=9,

305 
	mNET_NF_CONNTRACK_UDP_TIMEOUT
=10,

306 
	mNET_NF_CONNTRACK_UDP_TIMEOUT_STREAM
=11,

307 
	mNET_NF_CONNTRACK_ICMP_TIMEOUT
=12,

308 
	mNET_NF_CONNTRACK_GENERIC_TIMEOUT
=13,

309 
	mNET_NF_CONNTRACK_BUCKETS
=14,

310 
	mNET_NF_CONNTRACK_LOG_INVALID
=15,

311 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_MAX_RETRANS
=16,

312 
	mNET_NF_CONNTRACK_TCP_LOOSE
=17,

313 
	mNET_NF_CONNTRACK_TCP_BE_LIBERAL
=18,

314 
	mNET_NF_CONNTRACK_TCP_MAX_RETRANS
=19,

315 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_CLOSED
=20,

316 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_WAIT
=21,

317 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_ECHOED
=22,

318 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_ESTABLISHED
=23,

319 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_SENT
=24,

320 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_RECD
=25,

321 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_ACK_SENT
=26,

322 
	mNET_NF_CONNTRACK_COUNT
=27,

323 
	mNET_NF_CONNTRACK_ICMPV6_TIMEOUT
=28,

324 
	mNET_NF_CONNTRACK_FRAG6_TIMEOUT
=29,

325 
	mNET_NF_CONNTRACK_FRAG6_LOW_THRESH
=30,

326 
	mNET_NF_CONNTRACK_FRAG6_HIGH_THRESH
=31,

327 
	mNET_NF_CONNTRACK_CHECKSUM
=32,

334 
	mNET_IPV4_FORWARD
=8,

335 
	mNET_IPV4_DYNADDR
=9,

337 
	mNET_IPV4_CONF
=16,

338 
	mNET_IPV4_NEIGH
=17,

339 
	mNET_IPV4_ROUTE
=18,

340 
	mNET_IPV4_FIB_HASH
=19,

341 
	mNET_IPV4_NETFILTER
=20,

343 
	mNET_IPV4_TCP_TIMESTAMPS
=33,

344 
	mNET_IPV4_TCP_WINDOW_SCALING
=34,

345 
	mNET_IPV4_TCP_SACK
=35,

346 
	mNET_IPV4_TCP_RETRANS_COLLAPSE
=36,

347 
	mNET_IPV4_DEFAULT_TTL
=37,

348 
	mNET_IPV4_AUTOCONFIG
=38,

349 
	mNET_IPV4_NO_PMTU_DISC
=39,

350 
	mNET_IPV4_TCP_SYN_RETRIES
=40,

351 
	mNET_IPV4_IPFRAG_HIGH_THRESH
=41,

352 
	mNET_IPV4_IPFRAG_LOW_THRESH
=42,

353 
	mNET_IPV4_IPFRAG_TIME
=43,

354 
	mNET_IPV4_TCP_MAX_KA_PROBES
=44,

355 
	mNET_IPV4_TCP_KEEPALIVE_TIME
=45,

356 
	mNET_IPV4_TCP_KEEPALIVE_PROBES
=46,

357 
	mNET_IPV4_TCP_RETRIES1
=47,

358 
	mNET_IPV4_TCP_RETRIES2
=48,

359 
	mNET_IPV4_TCP_FIN_TIMEOUT
=49,

360 
	mNET_IPV4_IP_MASQ_DEBUG
=50,

361 
	mNET_TCP_SYNCOOKIES
=51,

362 
	mNET_TCP_STDURG
=52,

363 
	mNET_TCP_RFC1337
=53,

364 
	mNET_TCP_SYN_TAILDROP
=54,

365 
	mNET_TCP_MAX_SYN_BACKLOG
=55,

366 
	mNET_IPV4_LOCAL_PORT_RANGE
=56,

367 
	mNET_IPV4_ICMP_ECHO_IGNORE_ALL
=57,

368 
	mNET_IPV4_ICMP_ECHO_IGNORE_BROADCASTS
=58,

369 
	mNET_IPV4_ICMP_SOURCEQUENCH_RATE
=59,

370 
	mNET_IPV4_ICMP_DESTUNREACH_RATE
=60,

371 
	mNET_IPV4_ICMP_TIMEEXCEED_RATE
=61,

372 
	mNET_IPV4_ICMP_PARAMPROB_RATE
=62,

373 
	mNET_IPV4_ICMP_ECHOREPLY_RATE
=63,

374 
	mNET_IPV4_ICMP_IGNORE_BOGUS_ERROR_RESPONSES
=64,

375 
	mNET_IPV4_IGMP_MAX_MEMBERSHIPS
=65,

376 
	mNET_TCP_TW_RECYCLE
=66,

377 
	mNET_IPV4_ALWAYS_DEFRAG
=67,

378 
	mNET_IPV4_TCP_KEEPALIVE_INTVL
=68,

379 
	mNET_IPV4_INET_PEER_THRESHOLD
=69,

380 
	mNET_IPV4_INET_PEER_MINTTL
=70,

381 
	mNET_IPV4_INET_PEER_MAXTTL
=71,

382 
	mNET_IPV4_INET_PEER_GC_MINTIME
=72,

383 
	mNET_IPV4_INET_PEER_GC_MAXTIME
=73,

384 
	mNET_TCP_ORPHAN_RETRIES
=74,

385 
	mNET_TCP_ABORT_ON_OVERFLOW
=75,

386 
	mNET_TCP_SYNACK_RETRIES
=76,

387 
	mNET_TCP_MAX_ORPHANS
=77,

388 
	mNET_TCP_MAX_TW_BUCKETS
=78,

389 
	mNET_TCP_FACK
=79,

390 
	mNET_TCP_REORDERING
=80,

391 
	mNET_TCP_ECN
=81,

392 
	mNET_TCP_DSACK
=82,

393 
	mNET_TCP_MEM
=83,

394 
	mNET_TCP_WMEM
=84,

395 
	mNET_TCP_RMEM
=85,

396 
	mNET_TCP_APP_WIN
=86,

397 
	mNET_TCP_ADV_WIN_SCALE
=87,

398 
	mNET_IPV4_NONLOCAL_BIND
=88,

399 
	mNET_IPV4_ICMP_RATELIMIT
=89,

400 
	mNET_IPV4_ICMP_RATEMASK
=90,

401 
	mNET_TCP_TW_REUSE
=91,

402 
	mNET_TCP_FRTO
=92,

403 
	mNET_TCP_LOW_LATENCY
=93,

404 
	mNET_IPV4_IPFRAG_SECRET_INTERVAL
=94,

405 
	mNET_IPV4_IGMP_MAX_MSF
=96,

406 
	mNET_TCP_NO_METRICS_SAVE
=97,

407 
	mNET_TCP_DEFAULT_WIN_SCALE
=105,

408 
	mNET_TCP_MODERATE_RCVBUF
=106,

409 
	mNET_TCP_TSO_WIN_DIVISOR
=107,

410 
	mNET_TCP_BIC_BETA
=108,

411 
	mNET_IPV4_ICMP_ERRORS_USE_INBOUND_IFADDR
=109,

412 
	mNET_TCP_CONG_CONTROL
=110,

413 
	mNET_TCP_ABC
=111,

414 
	mNET_IPV4_IPFRAG_MAX_DIST
=112,

415 
	mNET_TCP_MTU_PROBING
=113,

416 
	mNET_TCP_BASE_MSS
=114,

417 
	mNET_IPV4_TCP_WORKAROUND_SIGNED_WINDOWS
=115,

418 
	mNET_TCP_DMA_COPYBREAK
=116,

419 
	mNET_TCP_SLOW_START_AFTER_IDLE
=117,

420 
	mNET_CIPSOV4_CACHE_ENABLE
=118,

421 
	mNET_CIPSOV4_CACHE_BUCKET_SIZE
=119,

422 
	mNET_CIPSOV4_RBM_OPTFMT
=120,

423 
	mNET_CIPSOV4_RBM_STRICTVALID
=121,

424 
	mNET_TCP_AVAIL_CONG_CONTROL
=122,

425 
	mNET_TCP_ALLOWED_CONG_CONTROL
=123,

426 
	mNET_TCP_MAX_SSTHRESH
=124,

427 
	mNET_TCP_FRTO_RESPONSE
=125,

431 
	mNET_IPV4_ROUTE_FLUSH
=1,

432 
	mNET_IPV4_ROUTE_MIN_DELAY
=2,

433 
	mNET_IPV4_ROUTE_MAX_DELAY
=3,

434 
	mNET_IPV4_ROUTE_GC_THRESH
=4,

435 
	mNET_IPV4_ROUTE_MAX_SIZE
=5,

436 
	mNET_IPV4_ROUTE_GC_MIN_INTERVAL
=6,

437 
	mNET_IPV4_ROUTE_GC_TIMEOUT
=7,

438 
	mNET_IPV4_ROUTE_GC_INTERVAL
=8,

439 
	mNET_IPV4_ROUTE_REDIRECT_LOAD
=9,

440 
	mNET_IPV4_ROUTE_REDIRECT_NUMBER
=10,

441 
	mNET_IPV4_ROUTE_REDIRECT_SILENCE
=11,

442 
	mNET_IPV4_ROUTE_ERROR_COST
=12,

443 
	mNET_IPV4_ROUTE_ERROR_BURST
=13,

444 
	mNET_IPV4_ROUTE_GC_ELASTICITY
=14,

445 
	mNET_IPV4_ROUTE_MTU_EXPIRES
=15,

446 
	mNET_IPV4_ROUTE_MIN_PMTU
=16,

447 
	mNET_IPV4_ROUTE_MIN_ADVMSS
=17,

448 
	mNET_IPV4_ROUTE_SECRET_INTERVAL
=18,

449 
	mNET_IPV4_ROUTE_GC_MIN_INTERVAL_MS
=19,

454 
	mNET_PROTO_CONF_ALL
=-2,

455 
	mNET_PROTO_CONF_DEFAULT
=-3

462 
	mNET_IPV4_CONF_FORWARDING
=1,

463 
	mNET_IPV4_CONF_MC_FORWARDING
=2,

464 
	mNET_IPV4_CONF_PROXY_ARP
=3,

465 
	mNET_IPV4_CONF_ACCEPT_REDIRECTS
=4,

466 
	mNET_IPV4_CONF_SECURE_REDIRECTS
=5,

467 
	mNET_IPV4_CONF_SEND_REDIRECTS
=6,

468 
	mNET_IPV4_CONF_SHARED_MEDIA
=7,

469 
	mNET_IPV4_CONF_RP_FILTER
=8,

470 
	mNET_IPV4_CONF_ACCEPT_SOURCE_ROUTE
=9,

471 
	mNET_IPV4_CONF_BOOTP_RELAY
=10,

472 
	mNET_IPV4_CONF_LOG_MARTIANS
=11,

473 
	mNET_IPV4_CONF_TAG
=12,

474 
	mNET_IPV4_CONF_ARPFILTER
=13,

475 
	mNET_IPV4_CONF_MEDIUM_ID
=14,

476 
	mNET_IPV4_CONF_NOXFRM
=15,

477 
	mNET_IPV4_CONF_NOPOLICY
=16,

478 
	mNET_IPV4_CONF_FORCE_IGMP_VERSION
=17,

479 
	mNET_IPV4_CONF_ARP_ANNOUNCE
=18,

480 
	mNET_IPV4_CONF_ARP_IGNORE
=19,

481 
	mNET_IPV4_CONF_PROMOTE_SECONDARIES
=20,

482 
	mNET_IPV4_CONF_ARP_ACCEPT
=21,

483 
	mNET_IPV4_CONF_ARP_NOTIFY
=22,

489 
	mNET_IPV4_NF_CONNTRACK_MAX
=1,

490 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_SYN_SENT
=2,

491 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_SYN_RECV
=3,

492 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_ESTABLISHED
=4,

493 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_FIN_WAIT
=5,

494 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_CLOSE_WAIT
=6,

495 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_LAST_ACK
=7,

496 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_TIME_WAIT
=8,

497 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_CLOSE
=9,

498 
	mNET_IPV4_NF_CONNTRACK_UDP_TIMEOUT
=10,

499 
	mNET_IPV4_NF_CONNTRACK_UDP_TIMEOUT_STREAM
=11,

500 
	mNET_IPV4_NF_CONNTRACK_ICMP_TIMEOUT
=12,

501 
	mNET_IPV4_NF_CONNTRACK_GENERIC_TIMEOUT
=13,

502 
	mNET_IPV4_NF_CONNTRACK_BUCKETS
=14,

503 
	mNET_IPV4_NF_CONNTRACK_LOG_INVALID
=15,

504 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_MAX_RETRANS
=16,

505 
	mNET_IPV4_NF_CONNTRACK_TCP_LOOSE
=17,

506 
	mNET_IPV4_NF_CONNTRACK_TCP_BE_LIBERAL
=18,

507 
	mNET_IPV4_NF_CONNTRACK_TCP_MAX_RETRANS
=19,

508 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_CLOSED
=20,

509 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_WAIT
=21,

510 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_ECHOED
=22,

511 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_ESTABLISHED
=23,

512 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_SENT
=24,

513 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_RECD
=25,

514 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_ACK_SENT
=26,

515 
	mNET_IPV4_NF_CONNTRACK_COUNT
=27,

516 
	mNET_IPV4_NF_CONNTRACK_CHECKSUM
=28,

521 
	mNET_IPV6_CONF
=16,

522 
	mNET_IPV6_NEIGH
=17,

523 
	mNET_IPV6_ROUTE
=18,

524 
	mNET_IPV6_ICMP
=19,

525 
	mNET_IPV6_BINDV6ONLY
=20,

526 
	mNET_IPV6_IP6FRAG_HIGH_THRESH
=21,

527 
	mNET_IPV6_IP6FRAG_LOW_THRESH
=22,

528 
	mNET_IPV6_IP6FRAG_TIME
=23,

529 
	mNET_IPV6_IP6FRAG_SECRET_INTERVAL
=24,

530 
	mNET_IPV6_MLD_MAX_MSF
=25,

534 
	mNET_IPV6_ROUTE_FLUSH
=1,

535 
	mNET_IPV6_ROUTE_GC_THRESH
=2,

536 
	mNET_IPV6_ROUTE_MAX_SIZE
=3,

537 
	mNET_IPV6_ROUTE_GC_MIN_INTERVAL
=4,

538 
	mNET_IPV6_ROUTE_GC_TIMEOUT
=5,

539 
	mNET_IPV6_ROUTE_GC_INTERVAL
=6,

540 
	mNET_IPV6_ROUTE_GC_ELASTICITY
=7,

541 
	mNET_IPV6_ROUTE_MTU_EXPIRES
=8,

542 
	mNET_IPV6_ROUTE_MIN_ADVMSS
=9,

543 
	mNET_IPV6_ROUTE_GC_MIN_INTERVAL_MS
=10

547 
	mNET_IPV6_FORWARDING
=1,

548 
	mNET_IPV6_HOP_LIMIT
=2,

549 
	mNET_IPV6_MTU
=3,

550 
	mNET_IPV6_ACCEPT_RA
=4,

551 
	mNET_IPV6_ACCEPT_REDIRECTS
=5,

552 
	mNET_IPV6_AUTOCONF
=6,

553 
	mNET_IPV6_DAD_TRANSMITS
=7,

554 
	mNET_IPV6_RTR_SOLICITS
=8,

555 
	mNET_IPV6_RTR_SOLICIT_INTERVAL
=9,

556 
	mNET_IPV6_RTR_SOLICIT_DELAY
=10,

557 
	mNET_IPV6_USE_TEMPADDR
=11,

558 
	mNET_IPV6_TEMP_VALID_LFT
=12,

559 
	mNET_IPV6_TEMP_PREFERED_LFT
=13,

560 
	mNET_IPV6_REGEN_MAX_RETRY
=14,

561 
	mNET_IPV6_MAX_DESYNC_FACTOR
=15,

562 
	mNET_IPV6_MAX_ADDRESSES
=16,

563 
	mNET_IPV6_FORCE_MLD_VERSION
=17,

564 
	mNET_IPV6_ACCEPT_RA_DEFRTR
=18,

565 
	mNET_IPV6_ACCEPT_RA_PINFO
=19,

566 
	mNET_IPV6_ACCEPT_RA_RTR_PREF
=20,

567 
	mNET_IPV6_RTR_PROBE_INTERVAL
=21,

568 
	mNET_IPV6_ACCEPT_RA_RT_INFO_MAX_PLEN
=22,

569 
	mNET_IPV6_PROXY_NDP
=23,

570 
	mNET_IPV6_ACCEPT_SOURCE_ROUTE
=25,

571 
	m__NET_IPV6_MAX


576 
	mNET_IPV6_ICMP_RATELIMIT
=1

581 
	mNET_NEIGH_MCAST_SOLICIT
=1,

582 
	mNET_NEIGH_UCAST_SOLICIT
=2,

583 
	mNET_NEIGH_APP_SOLICIT
=3,

584 
	mNET_NEIGH_RETRANS_TIME
=4,

585 
	mNET_NEIGH_REACHABLE_TIME
=5,

586 
	mNET_NEIGH_DELAY_PROBE_TIME
=6,

587 
	mNET_NEIGH_GC_STALE_TIME
=7,

588 
	mNET_NEIGH_UNRES_QLEN
=8,

589 
	mNET_NEIGH_PROXY_QLEN
=9,

590 
	mNET_NEIGH_ANYCAST_DELAY
=10,

591 
	mNET_NEIGH_PROXY_DELAY
=11,

592 
	mNET_NEIGH_LOCKTIME
=12,

593 
	mNET_NEIGH_GC_INTERVAL
=13,

594 
	mNET_NEIGH_GC_THRESH1
=14,

595 
	mNET_NEIGH_GC_THRESH2
=15,

596 
	mNET_NEIGH_GC_THRESH3
=16,

597 
	mNET_NEIGH_RETRANS_TIME_MS
=17,

598 
	mNET_NEIGH_REACHABLE_TIME_MS
=18,

603 
	mNET_DCCP_DEFAULT
=1,

608 
	mNET_IPX_PPROP_BROADCASTING
=1,

609 
	mNET_IPX_FORWARDING
=2

614 
	mNET_LLC2
=1,

615 
	mNET_LLC_STATION
=2,

620 
	mNET_LLC2_TIMEOUT
=1,

625 
	mNET_LLC_STATION_ACK_TIMEOUT
=1,

630 
	mNET_LLC2_ACK_TIMEOUT
=1,

631 
	mNET_LLC2_P_TIMEOUT
=2,

632 
	mNET_LLC2_REJ_TIMEOUT
=3,

633 
	mNET_LLC2_BUSY_TIMEOUT
=4,

638 
	mNET_ATALK_AARP_EXPIRY_TIME
=1,

639 
	mNET_ATALK_AARP_TICK_TIME
=2,

640 
	mNET_ATALK_AARP_RETRANSMIT_LIMIT
=3,

641 
	mNET_ATALK_AARP_RESOLVE_TIME
=4

647 
	mNET_NETROM_DEFAULT_PATH_QUALITY
=1,

648 
	mNET_NETROM_OBSOLESCENCE_COUNT_INITIALISER
=2,

649 
	mNET_NETROM_NETWORK_TTL_INITIALISER
=3,

650 
	mNET_NETROM_TRANSPORT_TIMEOUT
=4,

651 
	mNET_NETROM_TRANSPORT_MAXIMUM_TRIES
=5,

652 
	mNET_NETROM_TRANSPORT_ACKNOWLEDGE_DELAY
=6,

653 
	mNET_NETROM_TRANSPORT_BUSY_DELAY
=7,

654 
	mNET_NETROM_TRANSPORT_REQUESTED_WINDOW_SIZE
=8,

655 
	mNET_NETROM_TRANSPORT_NO_ACTIVITY_TIMEOUT
=9,

656 
	mNET_NETROM_ROUTING_CONTROL
=10,

657 
	mNET_NETROM_LINK_FAILS_COUNT
=11,

658 
	mNET_NETROM_RESET
=12

663 
	mNET_AX25_IP_DEFAULT_MODE
=1,

664 
	mNET_AX25_DEFAULT_MODE
=2,

665 
	mNET_AX25_BACKOFF_TYPE
=3,

666 
	mNET_AX25_CONNECT_MODE
=4,

667 
	mNET_AX25_STANDARD_WINDOW
=5,

668 
	mNET_AX25_EXTENDED_WINDOW
=6,

669 
	mNET_AX25_T1_TIMEOUT
=7,

670 
	mNET_AX25_T2_TIMEOUT
=8,

671 
	mNET_AX25_T3_TIMEOUT
=9,

672 
	mNET_AX25_IDLE_TIMEOUT
=10,

673 
	mNET_AX25_N2
=11,

674 
	mNET_AX25_PACLEN
=12,

675 
	mNET_AX25_PROTOCOL
=13,

676 
	mNET_AX25_DAMA_SLAVE_TIMEOUT
=14

681 
	mNET_ROSE_RESTART_REQUEST_TIMEOUT
=1,

682 
	mNET_ROSE_CALL_REQUEST_TIMEOUT
=2,

683 
	mNET_ROSE_RESET_REQUEST_TIMEOUT
=3,

684 
	mNET_ROSE_CLEAR_REQUEST_TIMEOUT
=4,

685 
	mNET_ROSE_ACK_HOLD_BACK_TIMEOUT
=5,

686 
	mNET_ROSE_ROUTING_CONTROL
=6,

687 
	mNET_ROSE_LINK_FAIL_TIMEOUT
=7,

688 
	mNET_ROSE_MAX_VCS
=8,

689 
	mNET_ROSE_WINDOW_SIZE
=9,

690 
	mNET_ROSE_NO_ACTIVITY_TIMEOUT
=10

695 
	mNET_X25_RESTART_REQUEST_TIMEOUT
=1,

696 
	mNET_X25_CALL_REQUEST_TIMEOUT
=2,

697 
	mNET_X25_RESET_REQUEST_TIMEOUT
=3,

698 
	mNET_X25_CLEAR_REQUEST_TIMEOUT
=4,

699 
	mNET_X25_ACK_HOLD_BACK_TIMEOUT
=5,

700 
	mNET_X25_FORWARD
=6

706 
	mNET_TR_RIF_TIMEOUT
=1

711 
	mNET_DECNET_NODE_TYPE
 = 1,

712 
	mNET_DECNET_NODE_ADDRESS
 = 2,

713 
	mNET_DECNET_NODE_NAME
 = 3,

714 
	mNET_DECNET_DEFAULT_DEVICE
 = 4,

715 
	mNET_DECNET_TIME_WAIT
 = 5,

716 
	mNET_DECNET_DN_COUNT
 = 6,

717 
	mNET_DECNET_DI_COUNT
 = 7,

718 
	mNET_DECNET_DR_COUNT
 = 8,

719 
	mNET_DECNET_DST_GC_INTERVAL
 = 9,

720 
	mNET_DECNET_CONF
 = 10,

721 
	mNET_DECNET_NO_FC_MAX_CWND
 = 11,

722 
	mNET_DECNET_MEM
 = 12,

723 
	mNET_DECNET_RMEM
 = 13,

724 
	mNET_DECNET_WMEM
 = 14,

725 
	mNET_DECNET_DEBUG_LEVEL
 = 255

730 
	mNET_DECNET_CONF_LOOPBACK
 = -2,

731 
	mNET_DECNET_CONF_DDCMP
 = -3,

732 
	mNET_DECNET_CONF_PPP
 = -4,

733 
	mNET_DECNET_CONF_X25
 = -5,

734 
	mNET_DECNET_CONF_GRE
 = -6,

735 
	mNET_DECNET_CONF_ETHER
 = -7

742 
	mNET_DECNET_CONF_DEV_PRIORITY
 = 1,

743 
	mNET_DECNET_CONF_DEV_T1
 = 2,

744 
	mNET_DECNET_CONF_DEV_T2
 = 3,

745 
	mNET_DECNET_CONF_DEV_T3
 = 4,

746 
	mNET_DECNET_CONF_DEV_FORWARDING
 = 5,

747 
	mNET_DECNET_CONF_DEV_BLKSIZE
 = 6,

748 
	mNET_DECNET_CONF_DEV_STATE
 = 7

753 
	mNET_SCTP_RTO_INITIAL
 = 1,

754 
	mNET_SCTP_RTO_MIN
 = 2,

755 
	mNET_SCTP_RTO_MAX
 = 3,

756 
	mNET_SCTP_RTO_ALPHA
 = 4,

757 
	mNET_SCTP_RTO_BETA
 = 5,

758 
	mNET_SCTP_VALID_COOKIE_LIFE
 = 6,

759 
	mNET_SCTP_ASSOCIATION_MAX_RETRANS
 = 7,

760 
	mNET_SCTP_PATH_MAX_RETRANS
 = 8,

761 
	mNET_SCTP_MAX_INIT_RETRANSMITS
 = 9,

762 
	mNET_SCTP_HB_INTERVAL
 = 10,

763 
	mNET_SCTP_PRESERVE_ENABLE
 = 11,

764 
	mNET_SCTP_MAX_BURST
 = 12,

765 
	mNET_SCTP_ADDIP_ENABLE
 = 13,

766 
	mNET_SCTP_PRSCTP_ENABLE
 = 14,

767 
	mNET_SCTP_SNDBUF_POLICY
 = 15,

768 
	mNET_SCTP_SACK_TIMEOUT
 = 16,

769 
	mNET_SCTP_RCVBUF_POLICY
 = 17,

774 
	mNET_BRIDGE_NF_CALL_ARPTABLES
 = 1,

775 
	mNET_BRIDGE_NF_CALL_IPTABLES
 = 2,

776 
	mNET_BRIDGE_NF_CALL_IP6TABLES
 = 3,

777 
	mNET_BRIDGE_NF_FILTER_VLAN_TAGGED
 = 4,

778 
	mNET_BRIDGE_NF_FILTER_PPPOE_TAGGED
 = 5,

783 
	mNET_IRDA_DISCOVERY
=1,

784 
	mNET_IRDA_DEVNAME
=2,

785 
	mNET_IRDA_DEBUG
=3,

786 
	mNET_IRDA_FAST_POLL
=4,

787 
	mNET_IRDA_DISCOVERY_SLOTS
=5,

788 
	mNET_IRDA_DISCOVERY_TIMEOUT
=6,

789 
	mNET_IRDA_SLOT_TIMEOUT
=7,

790 
	mNET_IRDA_MAX_BAUD_RATE
=8,

791 
	mNET_IRDA_MIN_TX_TURN_TIME
=9,

792 
	mNET_IRDA_MAX_TX_DATA_SIZE
=10,

793 
	mNET_IRDA_MAX_TX_WINDOW
=11,

794 
	mNET_IRDA_MAX_NOREPLY_TIME
=12,

795 
	mNET_IRDA_WARN_NOREPLY_TIME
=13,

796 
	mNET_IRDA_LAP_KEEPALIVE_TIME
=14,

803 
	mFS_NRINODE
=1,

804 
	mFS_STATINODE
=2,

805 
	mFS_MAXINODE
=3,

806 
	mFS_NRDQUOT
=4,

807 
	mFS_MAXDQUOT
=5,

808 
	mFS_NRFILE
=6,

809 
	mFS_MAXFILE
=7,

810 
	mFS_DENTRY
=8,

811 
	mFS_NRSUPER
=9,

812 
	mFS_MAXSUPER
=10,

813 
	mFS_OVERFLOWUID
=11,

814 
	mFS_OVERFLOWGID
=12,

815 
	mFS_LEASES
=13,

816 
	mFS_DIR_NOTIFY
=14,

817 
	mFS_LEASE_TIME
=15,

818 
	mFS_DQSTATS
=16,

819 
	mFS_XFS
=17,

820 
	mFS_AIO_NR
=18,

821 
	mFS_AIO_MAX_NR
=19,

822 
	mFS_INOTIFY
=20,

823 
	mFS_OCFS2
=988,

828 
	mFS_DQ_LOOKUPS
 = 1,

829 
	mFS_DQ_DROPS
 = 2,

830 
	mFS_DQ_READS
 = 3,

831 
	mFS_DQ_WRITES
 = 4,

832 
	mFS_DQ_CACHE_HITS
 = 5,

833 
	mFS_DQ_ALLOCATED
 = 6,

834 
	mFS_DQ_FREE
 = 7,

835 
	mFS_DQ_SYNCS
 = 8,

836 
	mFS_DQ_WARNINGS
 = 9,

843 
	mDEV_CDROM
=1,

844 
	mDEV_HWMON
=2,

845 
	mDEV_PARPORT
=3,

846 
	mDEV_RAID
=4,

847 
	mDEV_MAC_HID
=5,

848 
	mDEV_SCSI
=6,

849 
	mDEV_IPMI
=7,

854 
	mDEV_CDROM_INFO
=1,

855 
	mDEV_CDROM_AUTOCLOSE
=2,

856 
	mDEV_CDROM_AUTOEJECT
=3,

857 
	mDEV_CDROM_DEBUG
=4,

858 
	mDEV_CDROM_LOCK
=5,

859 
	mDEV_CDROM_CHECK_MEDIA
=6

864 
	mDEV_PARPORT_DEFAULT
=-3

869 
	mDEV_RAID_SPEED_LIMIT_MIN
=1,

870 
	mDEV_RAID_SPEED_LIMIT_MAX
=2

875 
	mDEV_PARPORT_DEFAULT_TIMESLICE
=1,

876 
	mDEV_PARPORT_DEFAULT_SPINTIME
=2

881 
	mDEV_PARPORT_SPINTIME
=1,

882 
	mDEV_PARPORT_BASE_ADDR
=2,

883 
	mDEV_PARPORT_IRQ
=3,

884 
	mDEV_PARPORT_DMA
=4,

885 
	mDEV_PARPORT_MODES
=5,

886 
	mDEV_PARPORT_DEVICES
=6,

887 
	mDEV_PARPORT_AUTOPROBE
=16

892 
	mDEV_PARPORT_DEVICES_ACTIVE
=-3,

897 
	mDEV_PARPORT_DEVICE_TIMESLICE
=1,

902 
	mDEV_MAC_HID_KEYBOARD_SENDS_LINUX_KEYCODES
=1,

903 
	mDEV_MAC_HID_KEYBOARD_LOCK_KEYCODES
=2,

904 
	mDEV_MAC_HID_MOUSE_BUTTON_EMULATION
=3,

905 
	mDEV_MAC_HID_MOUSE_BUTTON2_KEYCODE
=4,

906 
	mDEV_MAC_HID_MOUSE_BUTTON3_KEYCODE
=5,

907 
	mDEV_MAC_HID_ADB_MOUSE_SENDS_KEYCODES
=6

912 
	mDEV_SCSI_LOGGING_LEVEL
=1,

917 
	mDEV_IPMI_POWEROFF_POWERCYCLE
=1,

923 
	mABI_DEFHANDLER_COFF
=1,

924 
	mABI_DEFHANDLER_ELF
=2,

925 
	mABI_DEFHANDLER_LCALL7
=3,

926 
	mABI_DEFHANDLER_LIBCSO
=4,

927 
	mABI_TRACE
=5,

928 
	mABI_FAKE_UTSNAME
=6,

	@/usr/include/endian.h

19 #idef 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<us.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<bs/dn.h
>

41 #ide
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #i
__BYTE_ORDER
 =
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
LO, 
	)
HI

54 #i
__BYTE_ORDER
 =
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
HI, 
	)
LO

59 #ifde
__USE_BSD


61 
	~<bs/bysw.h
>

63 #i
__BYTE_ORDER
 =
__LITTLE_ENDIAN


64 
	#htobe16
(
x

	`__bsw_16
 (x)

	)

65 
	#hte16
(
x
(x)

	)

66 
	#be16toh
(
x

	`__bsw_16
 (x)

	)

67 
	#16toh
(
x
(x)

	)

69 
	#htobe32
(
x

	`__bsw_32
 (x)

	)

70 
	#hte32
(
x
(x)

	)

71 
	#be32toh
(
x

	`__bsw_32
 (x)

	)

72 
	#32toh
(
x
(x)

	)

74 
	#htobe64
(
x

	`__bsw_64
 (x)

	)

75 
	#hte64
(
x
(x)

	)

76 
	#be64toh
(
x

	`__bsw_64
 (x)

	)

77 
	#64toh
(
x
(x)

	)

79 
	#htobe16
(
x
(x)

	)

80 
	#hte16
(
x

	`__bsw_16
 (x)

	)

81 
	#be16toh
(
x
(x)

	)

82 
	#16toh
(
x

	`__bsw_16
 (x)

	)

84 
	#htobe32
(
x
(x)

	)

85 
	#hte32
(
x

	`__bsw_32
 (x)

	)

86 
	#be32toh
(
x
(x)

	)

87 
	#32toh
(
x

	`__bsw_32
 (x)

	)

89 
	#htobe64
(
x
(x)

	)

90 
	#hte64
(
x

	`__bsw_64
 (x)

	)

91 
	#be64toh
(
x
(x)

	)

92 
	#64toh
(
x

	`__bsw_64
 (x)

	)

	@/usr/include/gconv.h

23 #ide
_GCONV_H


24 
	#_GCONV_H
 1

	)

26 
	~<us.h
>

27 
	#__ed_mbe_t


	)

28 
	#__ed_wt_t


	)

29 
	~<wch.h
>

30 
	#__ed_size_t


	)

31 
	#__ed_wch_t


	)

32 
	~<ddef.h
>

35 
	#__UNKNOWN_10646_CHAR
 ((
wch_t
0xfffd)

	)

40 
	m__GCONV_OK
 = 0,

41 
	m__GCONV_NOCONV
,

42 
	m__GCONV_NODB
,

43 
	m__GCONV_NOMEM
,

45 
	m__GCONV_EMPTY_INPUT
,

46 
	m__GCONV_FULL_OUTPUT
,

47 
	m__GCONV_ILLEGAL_INPUT
,

48 
	m__GCONV_INCOMPLETE_INPUT
,

50 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

51 
	m__GCONV_INTERNAL_ERROR


58 
	m__GCONV_IS_LAST
 = 0x0001,

59 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

60 
	m__GCONV_SWAP
 = 0x0004

65 
	g__gcv_
;

66 
	g__gcv__da
;

67 
	g__gcv_lded_obje
;

68 
	g__gcv_s_da
;

72 (*
	t__gcv_f
(
	t__gcv_
 *, 
	t__gcv__da
 *,

73 
	t__cڡ
 **, __const *,

74 **, 
	tsize_t
 *, , );

77 
	$wt_t
 (*
	t__gcv_btowc_f
(
	t__gcv_
 *, );

80 (*
	t__gcv__f
(
	t__gcv_
 *);

81 (*
	t__gcv_d_f
(
	t__gcv_
 *);

85 (*
	t__gcv_s_f
(
	t__gcv_
 *,

86 
	t__gcv__da
 *, *,

87 
	t__cڡ
 *,

88 
	t__cڡ
 **,

89 
	t__cڡ
 *, **,

90 
	tsize_t
 *);

93 (*
	t__gcv_s_cڋxt_f
(*, 
	t__cڡ
 *,

94 
	t__cڡ
 *,

98 (*
	t__gcv_s_quy_f
(
	t__cڡ
 *, __const ***,

99 
	tsize_t
 *);

102 (*
	t__gcv_s__f
) (**, const *);

103 (*
	t__gcv_s_d_f
) (*);

105 
	s__gcv_s_da


108 
__gcv_s_f
 
__s_f
;

109 
__gcv_s_cڋxt_f
 
__s_cڋxt_f
;

110 
__gcv_s_d_f
 
__s_d_f
;

111 *
__da
;

112 
__gcv_s_da
 *
__xt
;

117 
	s__gcv_


119 
__gcv_lded_obje
 *
__shlib_hd
;

120 
__cڡ
 *
__modme
;

122 
__cou
;

124 *
__om_me
;

125 *
__to_me
;

127 
__gcv_f
 
__f
;

128 
__gcv_btowc_f
 
__btowc_f
;

129 
__gcv__f
 
___f
;

130 
__gcv_d_f
 
__d_f
;

134 
__m_eded_om
;

135 
__max_eded_om
;

136 
__m_eded_to
;

137 
__max_eded_to
;

140 
__eful
;

142 *
__da
;

147 
	s__gcv__da


149 *
__outbuf
;

150 *
__outbund
;

154 
__ags
;

158 
__voti_cou
;

162 
___u
;

164 
__mbe_t
 *
__
;

165 
__mbe_t
 
__e
;

169 
__gcv_s_da
 *
__s
;

174 
	s__gcv_fo


176 
size_t
 
__ns
;

177 
__gcv_
 *
__s
;

178 
__exnsi__
 
__gcv__da
 
__da
 
__exr
;

179 } *
	t__gcv_t
;

	@/usr/include/linux/stddef.h

1 #ide
_LINUX_STDDEF_H


2 
	#_LINUX_STDDEF_H


	)

	@/usr/include/wchar.h

24 #ide
_WCHAR_H


26 #i!
defed
 
__ed_mbe_t
 && !defed 
__ed_wt_t


27 
	#_WCHAR_H
 1

	)

28 
	~<us.h
>

31 #ifde
_WCHAR_H


33 
	#__ed___FILE


	)

34 #i
defed
 
__USE_UNIX98
 || defed 
__USE_XOPEN2K


35 
	#__ed_FILE


	)

37 
	~<dio.h
>

39 
	#__ed___va_li


	)

40 
	~<dg.h
>

42 
	~<bs/wch.h
>

45 
	#__ed_size_t


	)

46 
	#__ed_wch_t


	)

47 
	#__ed_NULL


	)

49 #i
defed
 
_WCHAR_H
 || defed 
__ed_wt_t
 || !defed 
__WINT_TYPE__


50 #unde
__ed_wt_t


51 
	#__ed_wt_t


	)

52 
	~<ddef.h
>

56 #ide
_WINT_T


61 
	#_WINT_T


	)

62 
	twt_t
;

66 #i
defed
 
__lulus
 && defed 
_GLIBCPP_USE_NAMESPACES
 \

67 && 
defed
 
__WINT_TYPE__


68 
__BEGIN_NAMESPACE_STD


69 
__WINT_TYPE__
 
	twt_t
;

70 
	g__END_NAMESPACE_STD


75 #i
defed
 
__lulus
 && 
__GNUC_PREREQ
 (4, 4)

76 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

80 #i(
defed
 
_WCHAR_H
 || defed 
__ed_mbe_t
&& !defed 
__mbe_t_defed


81 
	#__mbe_t_defed
 1

	)

85 
	m__cou
;

88 #ifde
__WINT_TYPE__


89 
__WINT_TYPE__
 
	m__wch
;

91 
wt_t
 
	m__wch
;

93 
	m__wchb
[4];

94 } 
	m__vue
;

95 } 
	t__mbe_t
;

97 #unde
__ed_mbe_t


102 #ifde
_WCHAR_H


104 
__BEGIN_NAMESPACE_C99


106 
__mbe_t
 
	tmbe_t
;

107 
	g__END_NAMESPACE_C99


108 #ifde
__USE_GNU


109 
	$__USING_NAMESPACE_C99
(
mbe_t
)

112 #ide
WCHAR_MIN


114 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

115 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

118 #ide
WEOF


119 
	#WEOF
 (0xffffffffu)

	)

124 #i
defed
 
__USE_XOPEN
 && !defed 
__USE_UNIX98


125 
	~<wy.h
>

129 
__BEGIN_DECLS


131 
__BEGIN_NAMESPACE_STD


134 
tm
;

135 
__END_NAMESPACE_STD


139 
	$__USING_NAMESPACE_STD
(
tm
)

142 
__BEGIN_NAMESPACE_STD


144 
wch_t
 *
	$wcsy
 (
wch_t
 *
__ri
 
__de
,

145 
__cڡ
 
wch_t
 *
__ri
 
__c

__THROW
;

147 
wch_t
 *
	$wcy
 (
wch_t
 *
__ri
 
__de
,

148 
__cڡ
 
wch_t
 *
__ri
 
__c
, 
size_t
 
__n
)

149 
__THROW
;

152 
wch_t
 *
	$wcst
 (
wch_t
 *
__ri
 
__de
,

153 
__cڡ
 
wch_t
 *
__ri
 
__c

__THROW
;

155 
wch_t
 *
	$wct
 (
wch_t
 *
__ri
 
__de
,

156 
__cڡ
 
wch_t
 *
__ri
 
__c
, 
size_t
 
__n
)

157 
__THROW
;

160 
	$wcscmp
 (
__cڡ
 
wch_t
 *
__s1
, __cڡ wch_*
__s2
)

161 
__THROW
 
__ibu_pu__
;

163 
	$wccmp
 (
__cڡ
 
wch_t
 *
__s1
, __cڡ wch_*
__s2
, 
size_t
 
__n
)

164 
__THROW
 
__ibu_pu__
;

165 
__END_NAMESPACE_STD


167 #ifde
__USE_XOPEN2K8


169 
	$wcscmp
 (
__cڡ
 
wch_t
 *
__s1
, __cڡ wch_*
__s2

__THROW
;

172 
	$wccmp
 (
__cڡ
 
wch_t
 *
__s1
, __cڡ wch_*
__s2
,

173 
size_t
 
__n

__THROW
;

177 
	~<xlo.h
>

179 
	$wcscmp_l
 (
__cڡ
 
wch_t
 *
__s1
, __cڡ wch_*
__s2
,

180 
__lo_t
 
__loc

__THROW
;

182 
	$wccmp_l
 (
__cڡ
 
wch_t
 *
__s1
, __cڡ wch_*
__s2
,

183 
size_t
 
__n
, 
__lo_t
 
__loc

__THROW
;

186 
__BEGIN_NAMESPACE_STD


189 
	$wcscl
 (
__cڡ
 
wch_t
 *
__s1
, __cڡ wch_*
__s2

__THROW
;

193 
size_t
 
	$wcsxm
 (
wch_t
 *
__ri
 
__s1
,

194 
__cڡ
 
wch_t
 *
__ri
 
__s2
, 
size_t
 
__n

__THROW
;

195 
__END_NAMESPACE_STD


197 #ifde
__USE_XOPEN2K8


203 
	$wcscl_l
 (
__cڡ
 
wch_t
 *
__s1
, __cڡ wch_*
__s2
,

204 
__lo_t
 
__loc

__THROW
;

209 
size_t
 
	$wcsxm_l
 (
wch_t
 *
__s1
, 
__cڡ
 wch_*
__s2
,

210 
size_t
 
__n
, 
__lo_t
 
__loc

__THROW
;

213 
wch_t
 *
	$wcsdup
 (
__cڡ
 
wch_t
 *
__s

__THROW
 
__ibu_mloc__
;

216 
__BEGIN_NAMESPACE_STD


218 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


219 "C++" 
wch_t
 *
	$wcschr
 (
wch_t
 *
__wcs
, wch_
__wc
)

220 
__THROW
 
	`__asm
 ("wcschr"
__ibu_pu__
;

221 "C++" 
__cڡ
 
wch_t
 *
	$wcschr
 (
__cڡ
 
wch_t
 *
__wcs
, wch_
__wc
)

222 
__THROW
 
	`__asm
 ("wcschr"
__ibu_pu__
;

224 
wch_t
 *
	$wcschr
 (
__cڡ
 
wch_t
 *
__wcs
, wch_
__wc
)

225 
__THROW
 
__ibu_pu__
;

228 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


229 "C++" 
wch_t
 *
	$wcchr
 (
wch_t
 *
__wcs
, wch_
__wc
)

230 
__THROW
 
	`__asm
 ("wcchr"
__ibu_pu__
;

231 "C++" 
__cڡ
 
wch_t
 *
	$wcchr
 (
__cڡ
 
wch_t
 *
__wcs
, wch_
__wc
)

232 
__THROW
 
	`__asm
 ("wcchr"
__ibu_pu__
;

234 
wch_t
 *
	$wcchr
 (
__cڡ
 
wch_t
 *
__wcs
, wch_
__wc
)

235 
__THROW
 
__ibu_pu__
;

237 
__END_NAMESPACE_STD


239 #ifde
__USE_GNU


242 
wch_t
 *
	$wcschul
 (
__cڡ
 
wch_t
 *
__s
, wch_
__wc
)

243 
__THROW
 
__ibu_pu__
;

246 
__BEGIN_NAMESPACE_STD


249 
size_t
 
	$wcscn
 (
__cڡ
 
wch_t
 *
__wcs
, __cڡ wch_*
__je
)

250 
__THROW
 
__ibu_pu__
;

253 
size_t
 
	$wcsn
 (
__cڡ
 
wch_t
 *
__wcs
, __cڡ wch_*
__ac
)

254 
__THROW
 
__ibu_pu__
;

256 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


257 "C++" 
wch_t
 *
	$wcbrk
 (
wch_t
 *
__wcs
, 
__cڡ
 wch_*
__ac
)

258 
__THROW
 
	`__asm
 ("wcbrk"
__ibu_pu__
;

259 "C++" 
__cڡ
 
wch_t
 *
	$wcbrk
 (
__cڡ
 
wch_t
 *
__wcs
,

260 
__cڡ
 
wch_t
 *
__ac
)

261 
__THROW
 
	`__asm
 ("wcbrk"
__ibu_pu__
;

263 
wch_t
 *
	$wcbrk
 (
__cڡ
 
wch_t
 *
__wcs
, __cڡ wch_*
__ac
)

264 
__THROW
 
__ibu_pu__
;

267 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


268 "C++" 
wch_t
 *
	$wcsr
 (
wch_t
 *
__hayack
, 
__cڡ
 wch_*
__ed
)

269 
__THROW
 
	`__asm
 ("wcsr"
__ibu_pu__
;

270 "C++" 
__cڡ
 
wch_t
 *
	$wcsr
 (
__cڡ
 
wch_t
 *
__hayack
,

271 
__cڡ
 
wch_t
 *
__ed
)

272 
__THROW
 
	`__asm
 ("wcsr"
__ibu_pu__
;

274 
wch_t
 *
	$wcsr
 (
__cڡ
 
wch_t
 *
__hayack
, __cڡ wch_*
__ed
)

275 
__THROW
 
__ibu_pu__
;

279 
wch_t
 *
	$wcok
 (
wch_t
 *
__ri
 
__s
,

280 
__cڡ
 
wch_t
 *
__ri
 
__dim
,

281 
wch_t
 **
__ri
 
__r

__THROW
;

284 
size_t
 
	$wc
 (
__cڡ
 
wch_t
 *
__s

__THROW
 
__ibu_pu__
;

285 
__END_NAMESPACE_STD


287 #ifde
__USE_XOPEN


289 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


290 "C++" 
wch_t
 *
	$wcswcs
 (
wch_t
 *
__hayack
, 
__cڡ
 wch_*
__ed
)

291 
__THROW
 
	`__asm
 ("wcswcs"
__ibu_pu__
;

292 "C++" 
__cڡ
 
wch_t
 *
	$wcswcs
 (
__cڡ
 
wch_t
 *
__hayack
,

293 
__cڡ
 
wch_t
 *
__ed
)

294 
__THROW
 
	`__asm
 ("wcswcs"
__ibu_pu__
;

296 
wch_t
 *
	$wcswcs
 (
__cڡ
 
wch_t
 *
__hayack
, __cڡ wch_*
__ed
)

297 
__THROW
 
__ibu_pu__
;

301 #ifde
__USE_XOPEN2K8


303 
size_t
 
	$wcn
 (
__cڡ
 
wch_t
 *
__s
, 
size_t
 
__maxn
)

304 
__THROW
 
__ibu_pu__
;

308 
__BEGIN_NAMESPACE_STD


310 #ifde
__CORRECT_ISO_CPP_WCHAR_H_PROTO


311 "C++" 
wch_t
 *
	$wmemchr
 (
wch_t
 *
__s
, wch_
__c
, 
size_t
 
__n
)

312 
__THROW
 
	`__asm
 ("wmemchr"
__ibu_pu__
;

313 "C++" 
__cڡ
 
wch_t
 *
	$wmemchr
 (
__cڡ
 
wch_t
 *
__s
, wch_
__c
,

314 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"
__ibu_pu__
;

317 
wch_t
 *
	$wmemchr
 (
__cڡ
 
wch_t
 *
__s
, wch_
__c
, 
size_t
 
__n
)

318 
__THROW
 
__ibu_pu__
;

322 
	$wmemcmp
 (
__cڡ
 
wch_t
 *
__s1
, __cڡ wch_*
__s2
, 
size_t
 
__n
)

323 
__THROW
 
__ibu_pu__
;

326 
wch_t
 *
	$wmemy
 (
wch_t
 *
__ri
 
__s1
,

327 
__cڡ
 
wch_t
 *
__ri
 
__s2
, 
size_t
 
__n

__THROW
;

331 
wch_t
 *
	$wmemmove
 (
wch_t
 *
__s1
, 
__cڡ
 wch_*
__s2
, 
size_t
 
__n
)

332 
__THROW
;

335 
wch_t
 *
	$wmemt
 (
wch_t
 *
__s
, wch_
__c
, 
size_t
 
__n

__THROW
;

336 
__END_NAMESPACE_STD


338 #ifde
__USE_GNU


341 
wch_t
 *
	$wmempy
 (
wch_t
 *
__ri
 
__s1
,

342 
__cڡ
 
wch_t
 *
__ri
 
__s2
, 
size_t
 
__n
)

343 
__THROW
;

347 
__BEGIN_NAMESPACE_STD


350 
wt_t
 
	$btowc
 (
__c

__THROW
;

354 
	$wob
 (
wt_t
 
__c

__THROW
;

358 
	$mbs
 (
__cڡ
 
mbe_t
 *
__ps

__THROW
 
__ibu_pu__
;

362 
size_t
 
	$mbowc
 (
wch_t
 *
__ri
 
__pwc
,

363 
__cڡ
 *
__ri
 
__s
, 
size_t
 
__n
,

364 
mbe_t
 *
__p

__THROW
;

367 
size_t
 
	$wtomb
 (*
__ri
 
__s
, 
wch_t
 
__wc
,

368 
mbe_t
 *
__ri
 
__ps

__THROW
;

371 
size_t
 
	$__mb
 (
__cڡ
 *
__ri
 
__s
, 
size_t
 
__n
,

372 
mbe_t
 *
__ri
 
__ps

__THROW
;

373 
size_t
 
	$mb
 (
__cڡ
 *
__ri
 
__s
, 
size_t
 
__n
,

374 
mbe_t
 *
__ri
 
__ps

__THROW
;

375 
__END_NAMESPACE_STD


377 #ifde
__USE_EXTERN_INLINES


383 
wt_t
 
	$__btowc_s
 (
__c

	`__asm
 ("btowc");

384 
__ex_le
 
wt_t


385 
	`__NTH
 (
	$btowc
 (
__c
))

386 {  (
	`__but_cڡt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

387 ? (
wt_t

__c
 : 
	`__btowc_s
 (__c)); 
	}
}

389 
	$__wob_s
 (
wt_t
 
__c

	`__asm
 ("wctob");

390 
__ex_le
 

391 
	`__NTH
 (
	$wob
 (
wt_t
 
__wc
))

392 {  (
	`__but_cڡt_p
 (
__wc
&& __w>
L
'\0' && __wc <= L'\x7f'

393 ? (
__wc
 : 
	`__wob_s
 (__wc)); 
	}
}

395 
__ex_le
 
size_t


396 
__NTH
 (
	$mb
 (
__cڡ
 *
__ri
 
__s
, 
size_t
 
__n
,

397 
mbe_t
 *
__ri
 
__ps
))

398 {  (
__ps
 !
NULL


399 ? 
	`mbowc
 (
NULL
, 
__s
, 
__n
, 
__ps
: 
	`__mb
 (__s, __n, NULL)); 
	}
}

402 
__BEGIN_NAMESPACE_STD


405 
size_t
 
	$mbtowcs
 (
wch_t
 *
__ri
 
__d
,

406 
__cڡ
 **
__ri
 
__c
, 
size_t
 
__n
,

407 
mbe_t
 *
__ri
 
__ps

__THROW
;

411 
size_t
 
	$wctombs
 (*
__ri
 
__d
,

412 
__cڡ
 
wch_t
 **
__ri
 
__c
, 
size_t
 
__n
,

413 
mbe_t
 *
__ri
 
__ps

__THROW
;

414 
__END_NAMESPACE_STD


417 #ifdef 
__USE_XOPEN2K8


420 
size_t
 
	$mbowcs
 (
wch_t
 *
__ri
 
__d
,

421 
__cڡ
 **
__ri
 
__c
, 
size_t
 
__nmc
,

422 
size_t
 
__n
, 
mbe_t
 *
__ri
 
__ps

__THROW
;

426 
size_t
 
	$wcombs
 (*
__ri
 
__d
,

427 
__cڡ
 
wch_t
 **
__ri
 
__c
,

428 
size_t
 
__nwc
, size_
__n
,

429 
mbe_t
 *
__ri
 
__ps

__THROW
;

434 #ifde
__USE_XOPEN


436 
	$wcwidth
 (
wch_t
 
__c

__THROW
;

440 
	$wcswidth
 (
__cڡ
 
wch_t
 *
__s
, 
size_t
 
__n

__THROW
;

444 
__BEGIN_NAMESPACE_STD


447 
	$wcod
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

448 
wch_t
 **
__ri
 
__dr

__THROW
;

449 
__END_NAMESPACE_STD


451 #ifde
__USE_ISOC99


452 
__BEGIN_NAMESPACE_C99


454 
	$wcof
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

455 
wch_t
 **
__ri
 
__dr

__THROW
;

456 
	$wcd
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

457 
wch_t
 **
__ri
 
__dr

__THROW
;

458 
__END_NAMESPACE_C99


462 
__BEGIN_NAMESPACE_STD


465 
	$wc
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

466 
wch_t
 **
__ri
 
__dr
, 
__ba

__THROW
;

470 
	$wcoul
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

471 
wch_t
 **
__ri
 
__dr
, 
__ba
)

472 
__THROW
;

473 
__END_NAMESPACE_STD


475 #i
defed
 
__USE_ISOC99
 || (defed 
__GNUC__
 && defed 
__USE_GNU
)

476 
__BEGIN_NAMESPACE_C99


479 
__exnsi__


480 
	$wcl
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

481 
wch_t
 **
__ri
 
__dr
, 
__ba
)

482 
__THROW
;

486 
__exnsi__


487 
	$wcou
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

488 
wch_t
 **
__ri
 
__dr
,

489 
__ba

__THROW
;

490 
__END_NAMESPACE_C99


493 #i
defed
 
__GNUC__
 && defed 
__USE_GNU


496 
__exnsi__


497 
	$wcoq
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

498 
wch_t
 **
__ri
 
__dr
, 
__ba
)

499 
__THROW
;

503 
__exnsi__


504 
	$wcouq
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

505 
wch_t
 **
__ri
 
__dr
,

506 
__ba

__THROW
;

509 #ifde
__USE_GNU


523 
	~<xlo.h
>

527 
	$wc_l
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

528 
wch_t
 **
__ri
 
__dr
, 
__ba
,

529 
__lo_t
 
__loc

__THROW
;

531 
	$wcoul_l
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

532 
wch_t
 **
__ri
 
__dr
,

533 
__ba
, 
__lo_t
 
__loc

__THROW
;

535 
__exnsi__


536 
	$wcl_l
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

537 
wch_t
 **
__ri
 
__dr
,

538 
__ba
, 
__lo_t
 
__loc

__THROW
;

540 
__exnsi__


541 
	$wcou_l
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

542 
wch_t
 **
__ri
 
__dr
,

543 
__ba
, 
__lo_t
 
__loc
)

544 
__THROW
;

546 
	$wcod_l
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

547 
wch_t
 **
__ri
 
__dr
, 
__lo_t
 
__loc
)

548 
__THROW
;

550 
	$wcof_l
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

551 
wch_t
 **
__ri
 
__dr
, 
__lo_t
 
__loc
)

552 
__THROW
;

554 
	$wcd_l
 (
__cڡ
 
wch_t
 *
__ri
 
__Ō
,

555 
wch_t
 **
__ri
 
__dr
,

556 
__lo_t
 
__loc

__THROW
;

560 #ifde
__USE_XOPEN2K8


563 
wch_t
 *
	$wy
 (
wch_t
 *
__ri
 
__de
,

564 
__cڡ
 
wch_t
 *
__ri
 
__c

__THROW
;

568 
wch_t
 *
	$wny
 (
wch_t
 *
__ri
 
__de
,

569 
__cڡ
 
wch_t
 *
__ri
 
__c
, 
size_t
 
__n
)

570 
__THROW
;

577 
__FILE
 *
	$ݒ_wmemam
 (
wch_t
 **
__buoc
, 
size_t
 *
__sizoc

__THROW
;

580 #i
defed
 
__USE_ISOC95
 || defed 
__USE_UNIX98


581 
__BEGIN_NAMESPACE_STD


584 
	$fwide
 (
__FILE
 *
__
, 
__mode

__THROW
;

591 
	`fwtf
 (
__FILE
 *
__ri
 
__am
,

592 
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...)

598 
	`wtf
 (
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...)

601 
	$swtf
 (
wch_t
 *
__ri
 
__s
, 
size_t
 
__n
,

602 
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...)

603 
__THROW
 ;

609 
	`vfwtf
 (
__FILE
 *
__ri
 
__s
,

610 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

611 
__gnuc_va_li
 
__g
)

617 
	`vwtf
 (
__cڡ
 
wch_t
 *
__ri
 
__fm
,

618 
__gnuc_va_li
 
__g
)

622 
	$vswtf
 (
wch_t
 *
__ri
 
__s
, 
size_t
 
__n
,

623 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

624 
__gnuc_va_li
 
__g
)

625 
__THROW
 ;

632 
	`fwsnf
 (
__FILE
 *
__ri
 
__am
,

633 
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...)

639 
	`wsnf
 (
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...)

642 
	$swsnf
 (
__cڡ
 
wch_t
 *
__ri
 
__s
,

643 
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...)

644 
__THROW
 ;

646 #i
defed
 
__USE_ISOC99
 && !defed 
__USE_GNU
 \

647 && (!
defed
 
__LDBL_COMPAT
 || !defed 
__REDIRECT
) \

648 && (
defed
 
__STRICT_ANSI__
 || defed 
__USE_XOPEN2K
)

649 #ifde
__REDIRECT


653 
	`__REDIRECT
 (
fwsnf
, (
__FILE
 *
__ri
 
__am
,

654 
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...),

655 
__isoc99_fwsnf
)

657 
	`__REDIRECT
 (
wsnf
, (
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...),

658 
__isoc99_wsnf
)

660 
	`__REDIRECT_NTH
 (
swsnf
, (
__cڡ
 
wch_t
 *
__ri
 
__s
,

661 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

662 ...), 
__isoc99_swsnf
)

665 
	`__isoc99_fwsnf
 (
__FILE
 *
__ri
 
__am
,

666 
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...);

667 
	`__isoc99_wsnf
 (
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...);

668 
	$__isoc99_swsnf
 (
__cڡ
 
wch_t
 *
__ri
 
__s
,

669 
__cڡ
 
wch_t
 *
__ri
 
__fm
, ...)

670 
__THROW
;

671 
	#fwsnf
 
__isoc99_fwsnf


	)

672 
	#wsnf
 
__isoc99_wsnf


	)

673 
	#swsnf
 
__isoc99_swsnf


	)

677 
__END_NAMESPACE_STD


680 #ifde
__USE_ISOC99


681 
__BEGIN_NAMESPACE_C99


686 
	`vfwsnf
 (
__FILE
 *
__ri
 
__s
,

687 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

688 
__gnuc_va_li
 
__g
)

694 
	`vwsnf
 (
__cڡ
 
wch_t
 *
__ri
 
__fm
,

695 
__gnuc_va_li
 
__g
)

698 
	$vswsnf
 (
__cڡ
 
wch_t
 *
__ri
 
__s
,

699 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

700 
__gnuc_va_li
 
__g
)

701 
__THROW
 ;

703 #i!
defed
 
__USE_GNU
 \

704 && (!
defed
 
__LDBL_COMPAT
 || !defed 
__REDIRECT
) \

705 && (
defed
 
__STRICT_ANSI__
 || defed 
__USE_XOPEN2K
)

706 #ifde
__REDIRECT


707 
	`__REDIRECT
 (
vfwsnf
, (
__FILE
 *
__ri
 
__s
,

708 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

709 
__gnuc_va_li
 
__g
), 
__isoc99_vfwsnf
)

711 
	`__REDIRECT
 (
vwsnf
, (
__cڡ
 
wch_t
 *
__ri
 
__fm
,

712 
__gnuc_va_li
 
__g
), 
__isoc99_vwsnf
)

714 
	`__REDIRECT_NTH
 (
vswsnf
, (
__cڡ
 
wch_t
 *
__ri
 
__s
,

715 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

716 
__gnuc_va_li
 
__g
), 
__isoc99_vswsnf
)

719 
	`__isoc99_vfwsnf
 (
__FILE
 *
__ri
 
__s
,

720 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

721 
__gnuc_va_li
 
__g
);

722 
	`__isoc99_vwsnf
 (
__cڡ
 
wch_t
 *
__ri
 
__fm
,

723 
__gnuc_va_li
 
__g
);

724 
	$__isoc99_vswsnf
 (
__cڡ
 
wch_t
 *
__ri
 
__s
,

725 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

726 
__gnuc_va_li
 
__g

__THROW
;

727 
	#vfwsnf
 
__isoc99_vfwsnf


	)

728 
	#vwsnf
 
__isoc99_vwsnf


	)

729 
	#vswsnf
 
__isoc99_vswsnf


	)

733 
__END_NAMESPACE_C99


737 
__BEGIN_NAMESPACE_STD


742 
wt_t
 
	`fgwc
 (
__FILE
 *
__am
);

743 
wt_t
 
	`gwc
 (
__FILE
 *
__am
);

749 
wt_t
 
	`gwch
 ();

756 
wt_t
 
	`utwc
 (
wch_t
 
__wc
, 
__FILE
 *
__am
);

757 
wt_t
 
	`putwc
 (
wch_t
 
__wc
, 
__FILE
 *
__am
);

763 
wt_t
 
	`putwch
 (
wch_t
 
__wc
);

771 
wch_t
 *
	`fgws
 (wch_*
__ri
 
__ws
, 
__n
,

772 
__FILE
 *
__ri
 
__am
);

778 
	`utws
 (
__cڡ
 
wch_t
 *
__ri
 
__ws
,

779 
__FILE
 *
__ri
 
__am
);

786 
wt_t
 
	`ungwc
 (wt_
__wc
, 
__FILE
 *
__am
);

787 
__END_NAMESPACE_STD


790 #ifde
__USE_GNU


798 
wt_t
 
	`gwc_uocked
 (
__FILE
 *
__am
);

799 
wt_t
 
	`gwch_uocked
 ();

807 
wt_t
 
	`fgwc_uocked
 (
__FILE
 *
__am
);

815 
wt_t
 
	`utwc_uocked
 (
wch_t
 
__wc
, 
__FILE
 *
__am
);

824 
wt_t
 
	`putwc_uocked
 (
wch_t
 
__wc
, 
__FILE
 *
__am
);

825 
wt_t
 
	`putwch_uocked
 (
wch_t
 
__wc
);

834 
wch_t
 *
	`fgws_uocked
 (wch_*
__ri
 
__ws
, 
__n
,

835 
__FILE
 *
__ri
 
__am
);

843 
	`utws_uocked
 (
__cڡ
 
wch_t
 *
__ri
 
__ws
,

844 
__FILE
 *
__ri
 
__am
);

848 
__BEGIN_NAMESPACE_C99


852 
size_t
 
	$wcsime
 (
wch_t
 *
__ri
 
__s
, 
size_t
 
__maxsize
,

853 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

854 
__cڡ
 
tm
 *
__ri
 
__

__THROW
;

855 
__END_NAMESPACE_C99


857 #ifde
__USE_GNU


858 
	~<xlo.h
>

862 
size_t
 
	$wcsime_l
 (
wch_t
 *
__ri
 
__s
, 
size_t
 
__maxsize
,

863 
__cڡ
 
wch_t
 *
__ri
 
__fm
,

864 
__cڡ
 
tm
 *
__ri
 
__
,

865 
__lo_t
 
__loc

__THROW
;

874 #i
defed
 
__USE_UNIX98
 && !defed 
__USE_GNU


875 
	#__ed_iswxxx


	)

876 
	~<wy.h
>

880 #i
__USE_FORTIFY_LEVEL
 > 0 && 
defed
 
__ex_ways_le


881 
	~<bs/wch2.h
>

884 #ifde
__LDBL_COMPAT


885 
	~<bs/wch-ldbl.h
>

888 
__END_DECLS


896 #unde
__ed_mbe_t


897 #unde
__ed_wt_t


	@/usr/include/wctype.h

24 #ide
_WCTYPE_H


26 
	~<us.h
>

27 
	~<bs/tys.h
>

29 #ide
__ed_iswxxx


30 
	#_WCTYPE_H
 1

	)

33 
	#__ed_wt_t


	)

34 
	~<wch.h
>

38 #ide
WEOF


39 
	#WEOF
 (0xffffffffu)

	)

42 #unde
__ed_iswxxx


47 #ide
__iswxxx_defed


48 
	#__iswxxx_defed
 1

	)

50 
__BEGIN_NAMESPACE_C99


53 
	twy_t
;

54 
	g__END_NAMESPACE_C99


56 #ide
_ISwb


61 
	~<dn.h
>

62 #i
__BYTE_ORDER
 =
__BIG_ENDIAN


63 
	#_ISwb
(
b
(1 << (b))

	)

65 
	#_ISwb
(
b
) \

66 ((
b
) < 8 ? () ((1UL << (bit)) << 24) \

67 : ((
b
) < 16 ? () ((1UL << (bit)) << 8) \

68 : ((
b
) < 24 ? () ((1UL << (bit)) >> 8) \

69 : (((1UL << (
b
)>> 24))))

	)

74 
	m__ISwu
 = 0,

75 
	m__ISwlow
 = 1,

76 
	m__ISwpha
 = 2,

77 
	m__ISwdig
 = 3,

78 
	m__ISwxdig
 = 4,

79 
	m__ISwa
 = 5,

80 
	m__ISwt
 = 6,

81 
	m__ISwgph
 = 7,

82 
	m__ISwbnk
 = 8,

83 
	m__ISwl
 = 9,

84 
	m__ISwpun
 = 10,

85 
	m__ISwnum
 = 11,

87 
	m_ISwu
 = 
_ISwb
 (
__ISwu
),

88 
	m_ISwlow
 = 
_ISwb
 (
__ISwlow
),

89 
	m_ISwpha
 = 
_ISwb
 (
__ISwpha
),

90 
	m_ISwdig
 = 
_ISwb
 (
__ISwdig
),

91 
	m_ISwxdig
 = 
_ISwb
 (
__ISwxdig
),

92 
	m_ISwa
 = 
_ISwb
 (
__ISwa
),

93 
	m_ISwt
 = 
_ISwb
 (
__ISwt
),

94 
	m_ISwgph
 = 
_ISwb
 (
__ISwgph
),

95 
	m_ISwbnk
 = 
_ISwb
 (
__ISwbnk
),

96 
	m_ISwl
 = 
_ISwb
 (
__ISwl
),

97 
	m_ISwpun
 = 
_ISwb
 (
__ISwpun
),

98 
	m_ISwnum
 = 
_ISwb
 (
__ISwnum
)

103 
__BEGIN_DECLS


105 
__BEGIN_NAMESPACE_C99


112 
	$iswnum
 (
wt_t
 
__wc

__THROW
;

118 
	$iswpha
 (
wt_t
 
__wc

__THROW
;

121 
	$iswl
 (
wt_t
 
__wc

__THROW
;

125 
	$iswdig
 (
wt_t
 
__wc

__THROW
;

129 
	$iswgph
 (
wt_t
 
__wc

__THROW
;

134 
	$iswlow
 (
wt_t
 
__wc

__THROW
;

137 
	$iswt
 (
wt_t
 
__wc

__THROW
;

142 
	$iswpun
 (
wt_t
 
__wc

__THROW
;

147 
	$iswa
 (
wt_t
 
__wc

__THROW
;

152 
	$iswu
 (
wt_t
 
__wc

__THROW
;

157 
	$iswxdig
 (
wt_t
 
__wc

__THROW
;

162 #ifde
__USE_ISOC99


163 
	$iswbnk
 (
wt_t
 
__wc

__THROW
;

172 
wy_t
 
	$wy
 (
__cڡ
 *
__ݔty

__THROW
;

176 
	$iswy
 (
wt_t
 
__wc
, 
wy_t
 
__desc

__THROW
;

177 
__END_NAMESPACE_C99


184 
__BEGIN_NAMESPACE_C99


187 
__cڡ
 
	t__t32_t
 *
	twns_t
;

188 
__END_NAMESPACE_C99


189 #ifde
__USE_GNU


190 
	$__USING_NAMESPACE_C99
(
wns_t
)

193 
__BEGIN_NAMESPACE_C99


195 
wt_t
 
	$towlow
 (
wt_t
 
__wc

__THROW
;

198 
wt_t
 
	$towu
 (
wt_t
 
__wc

__THROW
;

199 
__END_NAMESPACE_C99


201 
__END_DECLS


208 #ifde
_WCTYPE_H


214 
__BEGIN_DECLS


216 
__BEGIN_NAMESPACE_C99


219 
wns_t
 
	$wns
 (
__cڡ
 *
__ݔty

__THROW
;

222 
wt_t
 
	$towns
 (
wt_t
 
__wc
, 
wns_t
 
__desc

__THROW
;

223 
__END_NAMESPACE_C99


225 #ifde
__USE_XOPEN2K8


227 
	~<xlo.h
>

231 
	$iswnum_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

237 
	$iswpha_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

240 
	$iswl_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

244 
	$iswdig_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

248 
	$iswgph_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

253 
	$iswlow_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

256 
	$iswt_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

261 
	$iswpun_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

266 
	$iswa_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

271 
	$iswu_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

276 
	$iswxdig_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

281 
	$iswbnk_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

285 
wy_t
 
	$wy_l
 (
__cڡ
 *
__ݔty
, 
__lo_t
 
__lo
)

286 
__THROW
;

290 
	$iswy_l
 (
wt_t
 
__wc
, 
wy_t
 
__desc
, 
__lo_t
 
__lo
)

291 
__THROW
;

299 
wt_t
 
	$towlow_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

302 
wt_t
 
	$towu_l
 (
wt_t
 
__wc
, 
__lo_t
 
__lo

__THROW
;

306 
wns_t
 
	$wns_l
 (
__cڡ
 *
__ݔty
, 
__lo_t
 
__lo
)

307 
__THROW
;

310 
wt_t
 
	$towns_l
 (
wt_t
 
__wc
, 
wns_t
 
__desc
,

311 
__lo_t
 
__lo

__THROW
;

315 
__END_DECLS


	@
1
.
1
/usr/include
146
3075
common/action.c
common/ba_action.c
common/client_wds.c
common/cmm_aes.c
common/cmm_asic.c
common/cmm_cfg.c
common/cmm_cmd.c
common/cmm_data.c
common/cmm_data_pci.c
common/cmm_info.c
common/cmm_mac_pci.c
common/cmm_profile.c
common/cmm_sanity.c
common/cmm_sync.c
common/cmm_tkip.c
common/cmm_wep.c
common/cmm_wpa.c
common/crypt_aes.c
common/crypt_arc4.c
common/crypt_hmac.c
common/crypt_md5.c
common/crypt_sha2.c
common/dfs.c
common/ee_prom.c
common/eeprom.c
common/mlme.c
common/netif_block.c
common/rt_ate.c
common/rt_channel.c
common/rtmp_init.c
common/rtmp_init_inf.c
common/rtmp_mcu.c
common/rtmp_timer.c
common/spectrum.c
include/action.h
include/ap.h
include/br_ftph.h
include/cfg80211.h
include/cfg80211extr.h
include/chip/mac_pci.h
include/chip/rt2860.h
include/chip/rtmp_mac.h
include/chip/rtmp_phy.h
include/chlist.h
include/client_wds.h
include/client_wds_cmm.h
include/crypt_aes.h
include/crypt_arc4.h
include/crypt_hmac.h
include/crypt_md5.h
include/crypt_sha2.h
include/dfs.h
include/dot11i_wpa.h
include/eeprom.h
include/firmware.h
include/iface/rtmp_pci.h
include/link_list.h
include/mlme.h
include/netif_block.h
include/oid.h
include/os/rt_linux.h
include/rt_ate.h
include/rt_config.h
include/rtmp.h
include/rtmp_chip.h
include/rtmp_cmd.h
include/rtmp_def.h
include/rtmp_dot11.h
include/rtmp_iface.h
include/rtmp_mcu.h
include/rtmp_os.h
include/rtmp_timer.h
include/rtmp_type.h
include/spectrum.h
include/spectrum_def.h
include/sta_cfg.h
include/vr_ikans.h
include/wpa.h
include/wpa_cmm.h
include/wsc.h
os/linux/br_ftph.c
os/linux/cfg80211.c
os/linux/pci_main_dev.c
os/linux/rt_linux.c
os/linux/rt_main_dev.c
os/linux/rt_pci_rbus.c
os/linux/rt_profile.c
os/linux/rt_rbus_pci_util.c
os/linux/sta_ioctl.c
os/linux/vr_bdlt.c
os/linux/vr_ikans.c
sta/assoc.c
sta/auth.c
sta/auth_rsp.c
sta/connect.c
sta/dls.c
sta/rtmp_ckipmic.c
sta/rtmp_data.c
sta/sanity.c
sta/sta_cfg.c
sta/sync.c
sta/wpa.c
tools/bin2h.c
/usr/include/linux/errno.h
/usr/include/linux/ethtool.h
/usr/include/linux/if_arp.h
/usr/include/linux/kernel.h
/usr/include/linux/netdevice.h
/usr/include/linux/netfilter_bridge.h
/usr/include/linux/pci.h
/usr/include/linux/string.h
/usr/include/linux/time.h
/usr/include/linux/unistd.h
/usr/include/linux/version.h
/usr/include/linux/wireless.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/alloca.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/linux/if.h
/usr/include/linux/if_ether.h
/usr/include/linux/if_link.h
/usr/include/linux/if_packet.h
/usr/include/linux/if_pppox.h
/usr/include/linux/if_vlan.h
/usr/include/linux/netfilter.h
/usr/include/linux/pci_regs.h
/usr/include/linux/socket.h
/usr/include/linux/sysinfo.h
/usr/include/linux/types.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/ctype.h
/usr/include/linux/hdlc/ioctl.h
/usr/include/linux/if_pppol2tp.h
/usr/include/linux/netlink.h
/usr/include/linux/posix_types.h
/usr/include/linux/sysctl.h
/usr/include/endian.h
/usr/include/gconv.h
/usr/include/linux/stddef.h
/usr/include/wchar.h
/usr/include/wctype.h
